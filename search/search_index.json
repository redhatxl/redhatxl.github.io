{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u9996\u9875","text":""},{"location":"#it","title":"\u78ca\u54e5\u7684 IT \u624b\u8bb0","text":"<p>\u5305\u542b\u4e14\u4e0d\u4ec5\u9650\u4e8e \u4e91\u539f\u751f,Devops,Golang,Python,Shell,\u4e91\u67b6\u6784,kubernetes</p> <p>\u64c5\u957f\u56fd\u5185\u5916\u4e3b\u6d41\u4e91\u67b6\u6784</p> <p></p>"},{"location":"#_1","title":"\u4e2a\u4eba\u4fe1\u606f\uff1a","text":"<ul> <li> <p>GitHub</p> </li> <li> <p>\u6398\u91d1</p> </li> <li> <p>\u6155\u8bfe\u7f51</p> </li> <li> <p>51CTO</p> </li> <li> <p>InfoQ</p> </li> </ul>"},{"location":"#_2","title":"\u5176\u4ed6\u7b14\u8bb0","text":"<ul> <li> <p>awesome-kubernetes-notes</p> </li> <li> <p>kubectl-img</p> </li> </ul>"},{"location":"Packer/","title":"\u955c\u50cf\u5b9a\u4e49\u5de5\u5177Packer\u5b9e\u6218","text":""},{"location":"Packer/#_1","title":"\u4e00 \u6982\u8ff0","text":""},{"location":"Packer/#11-packer","title":"1.1 \u4ec0\u4e48\u662fpacker","text":"<p>Packer\u662f\u7528\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u591a\u79cd\u4e91\u8ba1\u7b97\u5e73\u53f0\u4e0a\u521b\u5efa\u5b8c\u5168\u4e00\u81f4\u955c\u50cf\u7684\u5f00\u6e90\u5de5\u5177\u3002Packer\u662f\u7531HashiCorp\u57282013\u5e74\u5de6\u53f3\u63a8\u51fa\u7684\u3002Packer\u53ef\u4ee5\u5728\u5404\u79cd\u4e3b\u6d41\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fd0\u884c\uff0c\u53ef\u4ee5\u9ad8\u901f\u3001\u5e76\u884c\u5728\u591a\u79cd\u4e91\u5e73\u53f0\u4e0a\u521b\u5efa\u955c\u50cf\u3002Packer\u5e76\u4e0d\u80fd\u53d6\u4ee3puppet\u6216\u8005Chef\u4e4b\u7c7b\u7684\u4e3b\u673a\u914d\u7f6e\u5de5\u5177\uff0c\u800c\u662f\u4e92\u4e3a\u8865\u5145-Packer\u5728\u521b\u5efa\u955c\u50cf\u65f6\uff0c\u53ef\u4ee5\u8c03\u7528\u8fd9\u4e9b\u5de5\u5177\u5728\u57fa\u7840\u955c\u50cf\u4e0a\u5b89\u88c5\u3001\u914d\u7f6e\u8f6f\u4ef6\u3002</p> <p>\u955c\u50cf\u662f\u6307\u4e00\u4e2a\u9884\u5148\u5b89\u88c5\u4e86\u8f6f\u4ef6\u3001\u914d\u7f6e\u597d\u4e86\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd9\u4e2a\u955c\u50cf\u53ef\u4ee5\u88ab\u7528\u5f00\u5feb\u901f\u521b\u5efa\u4e91\u4e3b\u673a\u3002\u6bcf\u4e2a\u4e91\u5e73\u53f0\u901a\u5e38\u6709\u4e0d\u540c\u7684\u955c\u50cf\u683c\u5f0f\u3002</p>"},{"location":"Packer/#12-packer","title":"1.2 \u4e3a\u4ec0\u4e48\u4f7f\u7528packer","text":"<p>Packer\u53ea\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u6613\u4e8e\u901a\u8fc7\u7ec8\u7aef\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u5f88\u7b80\u5355\u7684\u653e\u5230\u81ea\u52a8\u5316\u5de5\u5177\u91cc\u8fb9\uff0c\u7528\u6765\u81ea\u52a8\u521b\u5efa\u4efb\u4f55\u7c7b\u578b\u7684\u4e3b\u673a\u955c\u50cf\u3002</p> <p>Packer\u662f\u4e00\u4e2a\u5f00\u653e\u6e90\u4ee3\u7801\u5de5\u5177\uff0c\u53ef\u4ece\u4e00\u4e2a\u6e90\u914d\u7f6e\u4e3a\u591a\u4e2a\u5e73\u53f0\u521b\u5efa\u76f8\u540c\u7684\u673a\u5668\u6620\u50cf\u3002Packer\u8f7b\u5de7\uff0c\u53ef\u5728\u6bcf\u4e2a\u4e3b\u8981\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fd0\u884c\uff0c\u5e76\u4e14\u6027\u80fd\u5353\u8d8a\uff0c\u53ef\u4e3a\u591a\u4e2a\u5e73\u53f0\u5e76\u884c\u521b\u5efa\u673a\u5668\u6620\u50cf\u3002Packer\u4e0d\u4f1a\u53d6\u4ee3Chef\u6216Puppet\u7b49\u914d\u7f6e\u7ba1\u7406\u3002\u5b9e\u9645\u4e0a\uff0c\u5728\u6784\u5efa\u6620\u50cf\u65f6\uff0cPacker\u80fd\u591f\u4f7f\u7528Chef\u6216Puppet\u7b49\u5de5\u5177\u5728\u6620\u50cf\u4e0a\u5b89\u88c5\u8f6f\u4ef6\u3002\u673a\u5668\u6620\u50cf\u662f\u4e00\u4e2a\u9759\u6001\u5355\u5143\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u9884\u5148\u914d\u7f6e\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u5df2\u5b89\u88c5\u7684\u8f6f\u4ef6\uff0c\u7528\u4e8e\u5feb\u901f\u521b\u5efa\u65b0\u7684\u8fd0\u884c\u4e2d\u7684\u673a\u5668\u3002\u673a\u5668\u6620\u50cf\u683c\u5f0f\u968f\u6bcf\u4e2a\u5e73\u53f0\u800c\u53d8\u5316\u3002\u4e00\u4e9b\u793a\u4f8b\u5305\u62ec\u7528\u4e8eEC2\u7684AMI\uff0c\u7528\u4e8eVMware\u7684VMDK / VMX\u6587\u4ef6\uff0c\u7528\u4e8eVirtualBox\u7684OVF\u5bfc\u51fa\u7b49\u3002</p>"},{"location":"Packer/#13","title":"1.3 \u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801","text":"<p>\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u7684\u610f\u601d\u662f\u628a\u57fa\u7840\u8bbe\u65bd\u7684\u5b9e\u73b0\u65b9\u5f0f\u5199\u6210\u4ee3\u7801\u3002\u544a\u522b\u624b\u5de5\u914d\u7f6e\u5404\u7c7b\u8d44\u6e90\u800c\u91c7\u7528\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u83b7\u5f97\u591a\u79cd\u597d\u5904\uff1a</p> <ul> <li>\u53ef\u91cd\u590d-\u53ef\u4ee5\u968f\u65f6\u91cd\u65b0\u521b\u5efa\u57fa\u7840\u67b6\u6784\uff0c\u4f8b\u5982\u5728\u707e\u5907\u73af\u5883\u91cd\u65b0\u521b\u5efa\u751f\u4ea7\u73af\u5883\u3002</li> <li>\u53ef\u4e00\u81f4\u6027-\u5728\u5404\u4e2a\u4e0d\u540c\u7684\u73af\u5883\u4e4b\u95f4\u5b9e\u73b0\u6700\u5927\u7a0b\u5ea6\u7684\u4e00\u81f4\u6027\uff0c\u51cf\u5c11\u73af\u5883\u5dee\u5f02\u5bfc\u81f4\u7684\u751f\u4ea7\u3001\u6d4b\u8bd5\u6548\u7387\u4e0b\u964d\u3002</li> <li>\u53ef\u8ffd\u6eaf\u56de\u6eda-\u73af\u5883\u7684\u6240\u6709\u53d8\u5316\u90fd\u901a\u8fc7\u4ee3\u7801\u5b9e\u73b0\uff0c\u800c\u4ee3\u7801\u7684\u53d8\u5316\u662f\u53ef\u4ee5\u8ffd\u6eaf\u56de\u6eda\u7684\u3002</li> <li>\u5feb\u901f-\u7531\u4e8e\u57fa\u7840\u67b6\u6784\u662f\u901a\u8fc7\u4ee3\u7801\u5b9e\u73b0\u7684\uff0c\u90a3\u4e48\u6539\u53d8\u6216\u8005\u91cd\u5efa\u7cfb\u7edf\u65f6\u5c31\u4f1a\u975e\u5e38\u5feb\uff0c\u662f\u654f\u6377\u5f00\u53d1\u548cDevOps\u4e2d\u5fc5\u4e0d\u53ef\u5c11\u7684\u4e00\u6b65\u3002</li> </ul> <p>Packer\u53ef\u4ee5\u8bf4\u662f\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u7684\u7b2c\u4e00\u6b65\u3002</p> <p>\u5728\u4e91\u539f\u751f\u67b6\u6784\u4e2d\uff0c\u6280\u672f\u8bbe\u65bd\u5373\u4ee3\u7801\u4e0e\u5fae\u670d\u52a1/\u58f0\u660e\u5f0f\u7684API/\u670d\u52a1\u7f51\u683c\u6210\u4e3a\u67b6\u6784\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206</p>"},{"location":"Packer/#14-packer","title":"1.4 packer\u4f18\u70b9","text":"<ul> <li> <p>\u5feb\u901f\u7684\u57fa\u7840\u67b6\u6784\u5b9e\u65bd\uff1aPacker\u521b\u5efa\u7684\u955c\u50cf\u53ef\u4ee5\u8ba9\u8fd0\u7ef4\u4eba\u5458\u51e0\u79d2\u949f\u5185\u521b\u5efa\u4e00\u4e2a\u9884\u5148\u914d\u7f6e\u597d\u7684\u4e91\u4e3b\u673a\uff0c\u800c\u4e0d\u662f\u51e0\u5206\u949f\u751a\u81f3\u51e0\u4e2a\u5c0f\u65f6\u3002\u8fd9\u4e00\u597d\u5904\u4e0d\u4f46\u5bf9\u751f\u4ea7\u73af\u5883\uff0c\u4e5f\u5bf9\u6d4b\u8bd5\u53ca\u5f00\u53d1\u73af\u5883\u6709\u76ca\u3002</p> </li> <li> <p>\u591a\u5e73\u53f0\u517c\u5bb9\uff1a\u7531\u4e8ePacker\u53ef\u4ee5\u4e3a\u591a\u4e2a\u5e73\u53f0\u521b\u5efa\u5b8c\u5168\u4e00\u81f4\u7684\u955c\u50cf\uff0c\u4f60\u53ef\u4ee5\u5728\u817e\u8baf\u4e91\u4e0a\u8fd0\u884c\u751f\u4ea7\u73af\u5883\uff0c\u5728\u81ea\u5df1\u7684\u79c1\u6709\u4e91\u91cc\u8fb9\u8fd0\u884c\u6d4b\u8bd5\u73af\u5883\uff0c\u5728\u81ea\u5df1\u7684vmware\u865a\u62df\u673a\u91cc\u8fd0\u884c\u5f00\u53d1\u73af\u5883\u3002\u800c\u6bcf\u4e2a\u73af\u5883\u90fd\u5b8c\u5168\u4e00\u81f4\u3002</p> </li> <li> <p>\u63d0\u9ad8\u7a33\u5b9a\u6027\uff1aPacker\u5728\u521b\u5efa\u955c\u50cf\u65f6\u5b89\u88c5\u5e76\u914d\u7f6e\u8f6f\u4ef6\u3002\u5b89\u88c5\u6216\u8005\u914d\u7f6e\u6b65\u9aa4\u4e2d\u7684\u95ee\u9898\u4f1a\u5728\u8fd9\u65f6\u5019\u53d1\u73b0\uff0c\u800c\u4e0d\u662f\u5728\u7a7f\u4ef6\u4e91\u4e3b\u673a\u7684\u65f6\u5019\u3002</p> </li> <li> <p>\u63d0\u9ad8\u53ef\u6d4b\u8bd5\u6027\uff1a\u955c\u50cf\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u5f88\u5feb\u7684\u542f\u52a8\u4e00\u4e2a\u4e91\u4e3b\u673a\u5e76\u5bf9\u5176\u8fdb\u884c\u6d4b\u8bd5\u3002\u5982\u679c\u6d4b\u8bd5\u901a\u8fc7\uff0c\u90a3\u5c31\u53ef\u4ee5\u76f8\u4fe1\uff0c\u901a\u8fc7\u8fd9\u4e2a\u955c\u50cf\u521b\u5efa\u7684\u4e91\u4e3b\u673a\u90fd\u4f1a\u901a\u8fc7\u6d4b\u8bd5\u3002</p> </li> </ul>"},{"location":"Packer/#15-packer","title":"1.5 packer\u4e0e\u4f20\u7edf\u521b\u5efa\u955c\u50cf\u5bf9\u6bd4","text":"\u540d\u79f0 \u63a7\u5236\u53f0\u521b\u5efa\u955c\u50cf Packer \u521b\u5efa\u955c\u50cf \u4f7f\u7528\u65b9\u5f0f \u63a7\u5236\u53f0\u70b9\u51fb \u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u6784\u5efa \u53ef\u590d\u7528\u6027 \u4f4e\u3002\u6bcf\u6b21\u90fd\u9700\u6267\u884c\u76f8\u540c\u64cd\u4f5c\uff0c\u4e14\u65e0\u6cd5\u4fdd\u8bc1\u955c\u50cf\u4e00\u81f4\u6027\uff0c\u65e0\u6cd5\u7248\u672c\u5316\u7ba1\u7406 \u9ad8\u3002\u914d\u7f6e\u6587\u4ef6\u62f7\u8d1d\u3001\u4fee\u6539\u5373\u53ef\uff0c\u53ef\u7248\u672c\u5316\u7ba1\u7406 \u64cd\u4f5c\u590d\u6742\u5ea6 \u9ad8\u3002\u5148\u4f7f\u7528\u57fa\u7840\u955c\u50cf\u521b\u5efa\u4e91\u4e3b\u673a\uff0c\u5e76\u81ea\u884c\u767b\u9646\u5230\u4e91\u4e3b\u673a\u4e2d\u8fdb\u884c\u90e8\u7f72\uff0c\u4e4b\u540e\u624b\u52a8\u5236\u4f5c\u955c\u50cf \u4f4e\u3002\u6267\u884c\u914d\u7f6e\u6587\u4ef6\uff0c\u81ea\u52a8\u6267\u884c\u9884\u914d\u7f6e\u81ea\u52a8\u5316\u811a\u672c\uff0c\u7136\u540e\u81ea\u52a8\u6784\u5efa\u955c\u50cf \u521b\u5efa\u65f6\u95f4 \u957f\u3002\u6d41\u7a0b\u5316\u64cd\u4f5c\uff0c\u9700\u8981\u4eba\u5de5\u503c\u5b88\uff0c\u65e0\u6cd5\u51c6\u786e\u7b49\u5f85\u6bcf\u4e2a\u6d41\u7a0b\u7684\u6267\u884c \u77ed\u3002\u81ea\u52a8\u5316\u5de5\u4f5c\u6d41\u64cd\u4f5c\uff0c\u5b8c\u5584\u7684\u8f6e\u8be2\u7b49\u5f85\u673a\u5236\uff0c\u65e0\u7f1d\u8854\u63a5\u6bcf\u4e2a\u6d41\u7a0b"},{"location":"Packer/#_2","title":"\u4e8c \u5e94\u7528\u573a\u666f","text":""},{"location":"Packer/#21","title":"2.1 \u6301\u7eed\u4ea4\u4ed8","text":"<p>Packer\u662f\u7528\u547d\u4ee4\u884c\u9a71\u52a8\u7684\uff0c\u800c\u4e14\u4e0d\u9700\u8981\u5f88\u591a\u8d44\u6e90\u3002\u56e0\u6b64\u53ef\u4ee5\u5f88\u5bb9\u6613\u628aPacker\u653e\u5230\u6301\u7eed\u4ea4\u4ed8\u7684pipeline\u91cc\uff0c\u521b\u5efa\u955c\u50cf\u3002\u5728\u6301\u7eed\u4ea4\u4ed8\u968f\u540e\u7684\u6b65\u9aa4\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u6b64\u955c\u50cf\u8fdb\u884c\u6d4b\u8bd5\uff0c\u770b\u57fa\u7840\u8bbe\u65bd\u7684\u53d8\u5316\u662f\u4e0d\u662f\u80fd\u591f\u901a\u8fc7\u6d4b\u8bd5\u3002\u5982\u679c\u6d4b\u8bd5\u901a\u8fc7\uff0c\u90a3\u5c31\u53ef\u4ee5\u76f8\u4fe1\u5728\u8fd9\u4e00\u955c\u50cf\u57fa\u7840\u4e0a\u642d\u5efa\u7684\u4e91\u4e3b\u673a\u4e5f\u4f1a\u5de5\u4f5c\u3002\u8fd9\u5bf9\u57fa\u7840\u8bbe\u65bd\u53d8\u5316\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u6d4b\u8bd5\u6027\u63d0\u4f9b\u4e86\u57fa\u7840\u3002</p> <p>Packer\u662f\u8f7b\u91cf\u7ea7\u7684\u3001\u53ef\u79fb\u690d\u7684\u548c\u547d\u4ee4\u884c\u9a71\u52a8\u7684\u3002\u8fd9\u4f7f\u5f97\u5b83\u6210\u4e3a\u4e00\u4e2a\u5b8c\u7f8e\u7684\u5de5\u5177\uff0c\u653e\u5728\u60a8\u7684\u8fde\u7eed\u4ea4\u4ed8\u7ba1\u9053\u4e2d\u95f4\u3002Packer\u53ef\u7528\u4e8e\u5728\u5bf9Chef/Puppet\u7684\u6bcf\u6b21\u66f4\u6539\u4e0a\u4e3a\u591a\u4e2a\u5e73\u53f0\u751f\u6210\u65b0\u7684\u673a\u5668\u6620\u50cf\u3002</p> <p>\u4f5c\u4e3a\u8fd9\u4e2a\u7ba1\u9053\u7684\u4e00\u90e8\u5206\uff0c\u53ef\u4ee5\u542f\u52a8\u5e76\u6d4b\u8bd5\u65b0\u521b\u5efa\u7684\u6620\u50cf\uff0c\u4ece\u800c\u9a8c\u8bc1\u57fa\u7840\u7ed3\u6784\u66f4\u6539\u7684\u5de5\u4f5c\u3002\u5982\u679c\u6d4b\u8bd5\u901a\u8fc7\uff0c\u60a8\u53ef\u4ee5\u786e\u4fe1\u6620\u50cf\u5728\u90e8\u7f72\u65f6\u5c06\u5de5\u4f5c\u3002\u8fd9\u4e3a\u57fa\u7840\u8bbe\u65bd\u7684\u53d8\u5316\u5e26\u6765\u4e86\u65b0\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u6d4b\u8bd5\u6027\u3002</p>"},{"location":"Packer/#22-devprod","title":"2.2 dev/prod \u4ea7\u54c1\u6bd4\u4ef7","text":"<p>Packer\u5e2e\u52a9\u4fdd\u6301\u5f00\u53d1\uff0c\u6682\u5b58\u548c\u751f\u4ea7\u5c3d\u53ef\u80fd\u76f8\u4f3c\u3002Packer\u53ef\u7528\u4e8e\u540c\u65f6\u4e3a\u591a\u4e2a\u5e73\u53f0\u751f\u6210\u6620\u50cf\u3002\u56e0\u6b64\uff0c\u5982\u679c\u5c06AWS\u7528\u4e8e\u751f\u4ea7\u800c\u5c06VMware\uff08\u4e5f\u8bb8\u4e0eVagrant\u7ed3\u5408\u4f7f\u7528\uff09\u7528\u4e8e\u5f00\u53d1\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528Packer\u4ece\u540c\u4e00\u6a21\u677f\u540c\u65f6\u751f\u6210AMI\u548cVMware\u8ba1\u7b97\u673a\u3002</p>"},{"location":"Packer/#23","title":"2.3 \u8bbe\u5907/\u6f14\u793a\u521b\u5efa","text":"<p>\u7531\u4e8ePacker\u53ef\u4ee5\u5e76\u884c\u5730\u4e3a\u591a\u4e2a\u5e73\u53f0\u521b\u5efa\u4e00\u81f4\u7684\u6620\u50cf\uff0c\u56e0\u6b64\u975e\u5e38\u9002\u5408\u521b\u5efa\u7535\u5668\u548c\u4e00\u6b21\u6027\u4ea7\u54c1\u6f14\u793a\u3002\u968f\u7740\u8f6f\u4ef6\u7684\u66f4\u6539\uff0c\u60a8\u53ef\u4ee5\u81ea\u52a8\u521b\u5efa\u5e26\u6709\u9884\u5b89\u88c5\u8f6f\u4ef6\u7684\u8bbe\u5907\u3002\u7136\u540e\uff0c\u6f5c\u5728\u7684\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5c06\u8f6f\u4ef6\u90e8\u7f72\u5230\u4ed6\u4eec\u9009\u62e9\u7684\u73af\u5883\u4e2d\u6765\u5f00\u59cb\u4f7f\u7528\u60a8\u7684\u8f6f\u4ef6\u3002\u6253\u5305\u5177\u6709\u590d\u6742\u8981\u6c42\u7684\u8f6f\u4ef6\u4ece\u672a\u5982\u6b64\u7b80\u5355\u3002</p>"},{"location":"Packer/#_3","title":"\u4e09 \u5b89\u88c5","text":""},{"location":"Packer/#31","title":"3.1 \u4e8c\u8fdb\u5236\u5b89\u88c5","text":"<p>\u9009\u62e9\u5408\u9002\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u8fdb\u884c\u5b89\u88c5</p> <p>https://www.packer.io/downloads.html</p> <pre><code>wget https://releases.hashicorp.com/packer/1.5.1/packer_1.5.1_linux_amd64.zip\nunzip packer_1.5.1_linux_amd64.zip\ncp packer /usr/bin/\n</code></pre>"},{"location":"Packer/#32","title":"3.2 \u6e90\u7801\u7f16\u8bd1\u5b89\u88c5","text":""},{"location":"Packer/#321-go","title":"3.2.1 go\u73af\u5883\u5b89\u88c5","text":"<p>\u6b64\u5904\u793a\u4f8b\u4e3aCentOS7</p> <pre><code>cd /opt\nwget -c https://dl.google.com/go/go1.13.6.linux-amd64.tar.gz\ntar -C /usr/local -zxvf  go1.13.6.linux-amd64.tar.gz\ncat &gt;&gt;/etc/profile &lt;&lt;EOF    \nexport GOROOT=/usr/local/go\nexport PATH=\\$PATH:\\$GOROOT/bin\nEOF\nsource /etc/profile\n\nvim .bash_profile\n\nexport GOPATH=$HOME/go\n</code></pre> <p></p>"},{"location":"Packer/#322-packer","title":"3.2.2 packer\u7f16\u8bd1","text":"<pre><code>$ mkdir -p $(go env GOPATH)/src/github.com/hashicorp &amp;&amp; cd $_\n$ git clone https://github.com/hashicorp/packer.git\n$ cd packer\n\n$ make dev\n$ cp $(go env GOPATH)/bin/packer /usr/sbin\n</code></pre>"},{"location":"Packer/#_4","title":"\u56db \u793a\u4f8b","text":""},{"location":"Packer/#41","title":"4.1 \u817e\u8baf\u4e91\u793a\u4f8b","text":""},{"location":"Packer/#411-template","title":"4.1.1 \u7f16\u5199template","text":"<pre><code>{\n  \"variables\": {\n    \"tc_secret_id\": \"{{env `TENCENTCLOUD_ACCESS_KEY`}}\",\n    \"tc_secret_key\": \"{{env `TENCENTCLOUD_SECRET_KEY`}}\"\n  },        \n  \"builders\": [\n    {\n    \"type\": \"tencentcloud-cvm\",\n    \"secret_id\": \"{{user `tc_secret_id` }}\",\n    \"secret_key\": \"{{user `tc_secret_key`}}\",\n    \"region\": \"ap-guangzhou\",\n    \"zone\": \"ap-guangzhou-3\",\n    \"instance_type\": \"S2.SMALL1\",   \n    \"disk_type\": \"CLOUD_PREMIUM\",\n    \"associate_public_ip_address\": true,\n    \"source_image_id\": \"img-9qabwvbn\",\n    \"ssh_username\" : \"root\",\n    \"image_name\": \"nginx-service-v1\"\n  }\n  ],\n  \"provisioners\": [{\n    \"type\": \"shell\",\n    \"inline\": [\n      \"rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\",\n      \"yum install -y nginx\",\n      \"systemctl enable nginx\",\n      \"systemctl start nginx\"\n    ]\n  }]\n}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u4e00\u5f00\u59cb\uff0c\u5f15\u5165\u4e86\u4e24\u4e2a\u53d8\u91cf\uff0c\u5206\u522b\u662ftc_secret_id\u548ctc_secret_key\uff0c\u5b83\u4eec\u7684\u503c\u5206\u522b\u53d6\u81ea\u73af\u5883\u53d8\u91cfTENCENTCLOUD_ACCESS_KEY\u548cTENCENTCLOUD_SECRET_KEY\uff0c\u8fd9\u4e0e\u817e\u8baf\u4e91Terraform\u5e94\u7528\u6307\u5357\u4e2d\u63d0\u5230\u8bbe\u7f6e\u662f\u4e00\u6837\u7684\u3002</p> <p>\u968f\u540e\u7d27\u8ddf\u7684\u662f\u4e00\u4e2abuilder\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6307\u5b9a\u5728\u817e\u8baf\u4e91\u5e7f\u5dde\u5927\u533a\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u955c\u50cfnginx-service-v1\uff0c\u8be5\u955c\u50cf\u7684\u57fa\u7840\u955c\u50cf\u662f\u817e\u8baf\u4e91\u7684\u5171\u6709\u955c\u50cfimg-9qabwvbn\uff0c\u8fd9\u4e2a\u955c\u50cfid\u662f\u4ece\u817e\u8baf\u4e91\u63a7\u5236\u53f0\u67e5\u5230\u7684\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p>builder\u540e\u8fb9\u662f\u4e00\u4e2aprovisioner\u7684\u5b9a\u4e49\uff0c\u6307\u5b9a\u4e86\u51e0\u4e2a\u547d\u4ee4\u884c\u53ca\u53c2\u6570\u3002</p>"},{"location":"Packer/#412","title":"4.1.2 \u6267\u884c","text":"<p>\u968f\u540e\u53ef\u4ee5\u6267\u884c\uff1a</p> <pre><code>TENCENTCLOUD_ACCESS_KEY=AKIDZyGQXbErpY4MPDl7D4g3HH2c5KL8Y8G8\nTENCENTCLOUD_SECRET_KEY=kFUTDk38yZw4xc5JHzRdZFfspWxDE0Xq\n# \u9a8c\u8bc1\u6587\u4ef6\u6b63\u786e\u6027\n[root@VM_0_17_centos data]# packer validate cvm-template.json\nTemplate validated successfully.\n\n# \u6267\u884c\nexport TENCENTCLOUD_ACCESS_KEY=AKIDZyGQXbErpY4MPDl7D4g3HH2c5KL8Y8G8\nexport TENCENTCLOUD_SECRET_KEY=kFUTDk38yZw4xc5JHzRdZFfspWxDE0Xq\npacker build tencent-nginx.json\n</code></pre>"},{"location":"Packer/#413","title":"4.1.3 \u67e5\u770b\u6267\u884c\u7ed3\u679c","text":"<pre><code>[root@VM_0_17_centos data]# packer build cvm-template.json\ntencentcloud-cvm: output will be in this color.\n\n==&gt; tencentcloud-cvm: Trying to check image name: nginx-service-v1...\n    tencentcloud-cvm: Image name: useable\n==&gt; tencentcloud-cvm: Trying to check source image: img-9qabwvbn...\n    tencentcloud-cvm: Image found: CentOS 7.6 64bit\n==&gt; tencentcloud-cvm: Trying to create a new keypair: packer_5e2bb832...\n    tencentcloud-cvm: Keypair created: skey-ae69a70z\n==&gt; tencentcloud-cvm: Trying to create a new vpc...\n    tencentcloud-cvm: Vpc created: vpc-b4ofbh47\n==&gt; tencentcloud-cvm: Trying to create a new subnet...\n    tencentcloud-cvm: Subnet created: subnet-5817hc7k\n==&gt; tencentcloud-cvm: Trying to create a new securitygroup...\n    tencentcloud-cvm: Securitygroup created: sg-d9p13qth\n==&gt; tencentcloud-cvm: Trying to create securitygroup polices...\n    tencentcloud-cvm: Securitygroup polices created\n==&gt; tencentcloud-cvm: Trying to create a new instance...\n    tencentcloud-cvm: Waiting for instance ready\n    tencentcloud-cvm: Instance created: ins-389nxgpa\n==&gt; tencentcloud-cvm: Using ssh communicator to connect: 134.175.96.85\n==&gt; tencentcloud-cvm: Waiting for SSH to become available...\n==&gt; tencentcloud-cvm: Connected to SSH!\n==&gt; tencentcloud-cvm: Provisioning with shell script: /tmp/packer-shell361573813\n==&gt; tencentcloud-cvm: warning: /var/tmp/rpm-tmp.s33FeG: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY\n    tencentcloud-cvm: Retrieving http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n    tencentcloud-cvm: Preparing...                          ########################################\n    tencentcloud-cvm: Updating / installing...\n    tencentcloud-cvm: nginx-release-centos-7-0.el7.ngx      ########################################\n    tencentcloud-cvm: Loaded plugins: fastestmirror, langpacks\n    tencentcloud-cvm: Determining fastest mirrors\n    tencentcloud-cvm: Resolving Dependencies\n    tencentcloud-cvm: --&gt; Running transaction check\n    tencentcloud-cvm: ---&gt; Package nginx.x86_64 1:1.16.1-1.el7.ngx will be installed\n    tencentcloud-cvm: --&gt; Finished Dependency Resolution\n    tencentcloud-cvm:\n    tencentcloud-cvm: Dependencies Resolved\n    tencentcloud-cvm:\n    tencentcloud-cvm: ================================================================================\n    tencentcloud-cvm:  Package       Arch           Version                       Repository     Size\n    tencentcloud-cvm: ================================================================================\n    tencentcloud-cvm: Installing:\n    tencentcloud-cvm:  nginx         x86_64         1:1.16.1-1.el7.ngx            nginx         766 k\n    tencentcloud-cvm:\n    tencentcloud-cvm: Transaction Summary\n    tencentcloud-cvm: ================================================================================\n    tencentcloud-cvm: Install  1 Package\n    tencentcloud-cvm:\n    tencentcloud-cvm: Total download size: 766 k\n    tencentcloud-cvm: Installed size: 2.7 M\n    tencentcloud-cvm: Downloading packages:\n    tencentcloud-cvm: Running transaction check\n    tencentcloud-cvm: Running transaction test\n    tencentcloud-cvm: Transaction test succeeded\n    tencentcloud-cvm: Running transaction\n    tencentcloud-cvm:   Installing : 1:nginx-1.16.1-1.el7.ngx.x86_64                              1/1\n    tencentcloud-cvm: ----------------------------------------------------------------------\n    tencentcloud-cvm:\n    tencentcloud-cvm: Thanks for using nginx!\n    tencentcloud-cvm:\n    tencentcloud-cvm: Please find the official documentation for nginx here:\n    tencentcloud-cvm: * http://nginx.org/en/docs/\n    tencentcloud-cvm:\n    tencentcloud-cvm: Please subscribe to nginx-announce mailing list to get\n    tencentcloud-cvm: the most important news about nginx:\n    tencentcloud-cvm: * http://nginx.org/en/support.html\n    tencentcloud-cvm:\n    tencentcloud-cvm: Commercial subscriptions for nginx are available on:\n    tencentcloud-cvm: * http://nginx.com/products/\n    tencentcloud-cvm:\n    tencentcloud-cvm: ----------------------------------------------------------------------\n    tencentcloud-cvm:   Verifying  : 1:nginx-1.16.1-1.el7.ngx.x86_64                              1/1\n    tencentcloud-cvm:\n    tencentcloud-cvm: Installed:\n    tencentcloud-cvm:   nginx.x86_64 1:1.16.1-1.el7.ngx\n    tencentcloud-cvm:\n    tencentcloud-cvm: Complete!\n==&gt; tencentcloud-cvm: Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.\n==&gt; tencentcloud-cvm: Trying to detach keypair: skey-ae69a70z...\n    tencentcloud-cvm: Keypair detached\n==&gt; tencentcloud-cvm: Trying to create a new image: nginx-service-v1...\n    tencentcloud-cvm: Waiting for image ready\n    tencentcloud-cvm: Image created: img-lw1glokq\n==&gt; tencentcloud-cvm: Cleaning up instance...\n==&gt; tencentcloud-cvm: Cleaning up securitygroup...\n==&gt; tencentcloud-cvm: Cleaning up subnet...\n==&gt; tencentcloud-cvm: Cleaning up vpc...\n==&gt; tencentcloud-cvm: Cleaning up keypair...\nBuild 'tencentcloud-cvm' finished.\n\n==&gt; Builds finished. The artifacts of successful builds are:\n--&gt; tencentcloud-cvm: Tencentcloud images(ap-guangzhou: img-lw1glokq) were created.\n</code></pre>"},{"location":"Packer/#413_1","title":"4.1.3 \u67e5\u770b\u6267\u884c\u7ed3\u679c","text":""},{"location":"Packer/#_5","title":"\u4e94 \u53cd\u601d","text":"<ul> <li>\u5728\u57fa\u7840\u67b6\u6784\u5411kubernetes\u5fae\u670d\u52a1\u67b6\u6784\u7684\u8f6c\u578b\u4e2d\uff0c\u5982\u679c\u67b6\u6784\u5904\u4e8ecloud hosting\uff0c\u6216\u6df7\u5408\u4e91\u67b6\u6784\uff0cPacker\u4e3a\u60a8\u7b80\u5316\u6301\u7eed\u4ea4\u4ed8\u6d41\u7a0b\uff0c\u5feb\u901f\u7684\u955c\u50cf\u6d4b\u8bd5\u3002</li> <li>Packer \u521b\u5efa\u955c\u50cf\u5bf9\u6bd4\u4eba\u5de5\u624b\u52a8\u70b9\u51fb\uff0c\u4ee5\u5176\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\uff0c\u4ee3\u7801\u53ef\u590d\u7528\u6027\uff0c\u7248\u672c\u7ba1\u7406\uff0c\u81ea\u52a8\u5316\u6d41\u7a0b\u7ba1\u7406\u7b49\u3002</li> </ul>"},{"location":"Packer/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.packer.io/intro/index.html</li> <li>https://cloud.tencent.com/developer/article/1474736</li> <li>https://www.mdslq.cn/archives/bc880644.html</li> </ul>"},{"location":"other/","title":"\u78ca\u54e5\u7684 IT \u624b\u8bb0","text":"<p>Info</p> <pre><code>     TODO: \u5f85\u6dfb\u52a0\n</code></pre>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/","title":"1.K8s \u5f00\u53d1\u6982\u5ff5\u7b80\u4ecb","text":""},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#_1","title":"\u4e00 \u8fd0\u884c\u73af\u5883","text":""},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#11-ide","title":"1.1 IDE","text":"<p>\u540e\u671f\u5f00\u53d1\u8981\u6c42\u73af\u5883</p> <ul> <li>IDE\uff1agoland</li> <li>go\u7248\u672c\uff1ago1.16.8</li> <li>kubernetes\uff1av1.21.1</li> </ul>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#12-k8s","title":"1.2 K8s \u76f8\u5173\u4ed3\u5e93","text":"<p>\u5b98\u65b9\u6e90\u7801\u4ed3\u5e93\uff1a https://github.com/kubernetes/kubernetes.git</p> <p></p>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#13-k8s","title":"1.3 K8s \u6e90\u7801\u76ee\u5f55\u7ed3\u6784","text":"<pre><code>$ git clone https://github.com/kubernetes/kubernetes.git\n</code></pre>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#14","title":"1.4 \u9700\u8981\u638c\u63e1\u7684\u77e5\u8bc6\u70b9","text":"<p>\u5b66\u4e60\u9700\u8981\u5177\u5907\u7684\u6280\u80fd</p> <ul> <li>golang\u57fa\u7840</li> <li>k8s\u76f8\u5173\u77e5\u8bc6</li> <li>cobra</li> <li>client-go</li> <li>controller\u76f8\u5173\u7ec4\u4ef6\u53ca\u6d41\u7a0b</li> <li>operator\u5f00\u53d1\u6846\u67b6kubebuilder</li> <li>gin\u6846\u67b6</li> </ul>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#kubernetes-api","title":"\u4e8c kubernetes API \u8ba4\u8bc6","text":"<p>\u5728\u6574\u4e2aKubernetes\u4f53\u7cfb\u67b6\u6784\u4e2d\uff0c\u8d44\u6e90\u662fKubernetes\u6700\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u53ef\u4ee5\u8bf4Kubernetes\u7684\u751f\u6001\u7cfb\u7edf\u90fd\u56f4\u7ed5\u7740\u8d44\u6e90\u8fd0\u4f5c\u3002Kubernetes\u7cfb\u7edf\u867d\u7136\u6709\u76f8\u5f53\u590d\u6742\u548c\u4f17\u591a\u7684\u529f\u80fd\uff0c\u4f46\u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u8d44\u6e90\u63a7\u5236\u7cfb\u7edf\u2014\u2014\u6ce8\u518c\u3001\u7ba1\u7406\u3001\u8c03\u5ea6\u8d44\u6e90\u5e76\u7ef4\u62a4\u8d44\u6e90\u7684\u72b6\u6001\uff0cKubernetes \u4e2d\u6700\u6838\u5fc3\u7684\u5c31\u662f kube-apiserver \u7ec4\u4ef6\uff0c\u5176\u4ed6\u7ec4\u4ef6\u90fd\u662f\u548c kube-apiserver \u8fdb\u884c\u901a\u4fe1\u3002</p>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#21-api","title":"2.1 API \u5bf9\u8c61","text":"<p>\u5728 Kubernetes \u96c6\u7fa4\u4e2d\uff0cKubernetes \u5bf9\u8c61\u662f\u6211\u4eec\u6301\u4e45\u5316\u7684\u5b9e\u4f53\uff0c\u5c31\u662f\u6700\u7ec8\u5b58\u5165 etcd \u4e2d\u7684\u6570\u636e\uff0c\u96c6\u7fa4\u4e2d\u901a\u8fc7\u8fd9\u4e9b\u5b9e\u4f53\u6765\u8868\u793a\u6574\u4e2a\u96c6\u7fa4\u7684\u72b6\u6001\u3002\u5e73\u65f6\u6211\u4eec\u90fd\u662f\u76f4\u63a5\u7f16\u5199 YAML \u8d44\u6e90\u6e05\u5355\u6587\u4ef6\uff0c\u7136\u540e\u901a\u8fc7 kubectl \u6765\u63d0\u4ea4\u521b\u5efa\u5bf9\u5e94\u7684\u8d44\u6e90\u5bf9\u8c61\uff0c\u6620\u5c04\u5230\u96c6\u7fa4\u5185\u90e8\u3002</p> <p>\u8fd9\u4e2a\u5c31\u9700\u8981\u53bb\u4e86\u89e3\u4e0b**<code>\u58f0\u660e\u5f0f API</code>**\u7684\u8bbe\u8ba1\uff0c\u4e3a\u4e86\u53ef\u6269\u5c55\u6027\uff0cKubernetes \u5728\u4e0d\u540c\u7684 API \u8def\u5f84\uff08\u6bd4\u5982<code>/api/v1</code> \u6216\u8005 <code>/apis/batch</code>\uff09\u4e0b\u9762\u652f\u6301\u4e86\u591a\u4e2a API \u7248\u672c\uff0c\u4e0d\u540c\u7684 API \u7248\u672c\u610f\u5473\u7740\u4e0d\u540c\u7ea7\u522b\u7684\u7a33\u5b9a\u6027\u548c\u652f\u6301\uff1a</p> <ul> <li>Alpha \u7ea7\u522b\uff0c\u4f8b\u5982 <code>v1alpha1</code> \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u88ab\u7981\u7528\u7684\uff0c\u53ef\u4ee5\u968f\u65f6\u5220\u9664\u5bf9\u529f\u80fd\u7684\u652f\u6301\uff0c\u6240\u4ee5\u8981\u614e\u7528</li> <li>Beta \u7ea7\u522b\uff0c\u4f8b\u5982 <code>v2beta1</code> \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u542f\u7528\u7684\uff0c\u8868\u793a\u4ee3\u7801\u5df2\u7ecf\u7ecf\u8fc7\u4e86\u5f88\u597d\u7684\u6d4b\u8bd5\uff0c\u4f46\u662f\u5bf9\u8c61\u7684\u8bed\u4e49\u53ef\u80fd\u4f1a\u5728\u968f\u540e\u7684\u7248\u672c\u4e2d\u4ee5\u4e0d\u517c\u5bb9\u7684\u65b9\u5f0f\u66f4\u6539</li> <li>\u7a33\u5b9a\u7ea7\u522b\uff0c\u6bd4\u5982 <code>v1</code> \u8868\u793a\u5df2\u7ecf\u662f\u7a33\u5b9a\u7248\u672c\u4e86\uff0c\u4e5f\u4f1a\u51fa\u73b0\u5728\u540e\u7eed\u7684\u5f88\u591a\u7248\u672c\u4e2d\u3002</li> </ul>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#22-api-path","title":"2.2 API PATH","text":"<p>\u5728 Kubernetes \u96c6\u7fa4\u4e2d\uff0c\u4e00\u4e2a API \u5bf9\u8c61\u5728 Etcd \u91cc\u7684\u5b8c\u6574\u8d44\u6e90\u8def\u5f84\uff0c\u662f\u7531\uff1aGroup\uff08API \u7ec4\uff09\u3001Version\uff08API \u7248\u672c\uff09\u548c Resource\uff08API \u8d44\u6e90\u7c7b\u578b\uff09\u4e09\u4e2a\u90e8\u5206\u7ec4\u6210\u7684\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u7ed3\u6784\uff0c\u6574\u4e2a Kubernetes \u91cc\u7684\u6240\u6709 API \u5bf9\u8c61\uff0c\u5b9e\u9645\u4e0a\u5c31\u53ef\u4ee5\u7528\u5982\u4e0b\u7684\u6811\u5f62\u7ed3\u6784\u8868\u793a\u51fa\u6765\uff1a</p> <p></p>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#23-gvk","title":"2.3 GVK","text":""},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#231","title":"2.3.1 \u6982\u5ff5","text":"<p>GVK = GroupVersionKind\uff0cGVR = GroupVersionResource\u3002</p> <ul> <li>apiVersion\uff1a\u8fd9\u4e2a\u5c31\u662f GV \u3002</li> <li>kind\uff1a\u8fd9\u4e2a\u5c31\u662f K\u3002\u6839\u636e GVK K8s \u5c31\u80fd\u627e\u5230\u4f60\u5230\u5e95\u8981\u521b\u5efa\u4ec0\u4e48\u7c7b\u578b\u7684\u8d44\u6e90\uff0c\u6839\u636e\u4f60\u5b9a\u4e49\u7684 Spec \u521b\u5efa\u597d\u8d44\u6e90\u4e4b\u540e\u5c31\u6210\u4e3a\u4e86 Resource\uff0c\u4e5f\u5c31\u662f GVR\u3002GVK/GVR \u5c31\u662f K8s \u8d44\u6e90\u7684\u5750\u6807\uff0c\u662f\u6211\u4eec\u521b\u5efa/\u5220\u9664/\u4fee\u6539/\u8bfb\u53d6\u8d44\u6e90\u7684\u57fa\u7840\u3002</li> </ul>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#232","title":"2.3.2 \u5173\u7cfb\u56fe","text":"<p>\u6bcf\u4e00\u4e2a\u8d44\u6e90\u90fd\u62e5\u6709\u4e00\u5b9a\u6570\u91cf\u7684\u8d44\u6e90\u64cd\u4f5c\u65b9\u6cd5\uff08\u5373Verbs\uff09\uff0c\u8d44\u6e90\u64cd\u4f5c\u65b9\u6cd5\u7528\u4e8eEtcd\u96c6\u7fa4\u5b58\u50a8\u4e2d\u5bf9\u8d44\u6e90\u5bf9\u8c61\u7684\u589e\u3001\u5220\u3001\u6539\u3001\u67e5\u64cd\u4f5c\u3002\u76ee\u524dKubernetes\u7cfb\u7edf\u652f\u63018\u79cd\u8d44\u6e90\u64cd\u4f5c\u65b9\u6cd5\uff0c\u5206\u522b\u662fcreate\u3001delete\u3001deletecollection\u3001get\u3001list\u3001patch\u3001update\u3001watch\u64cd\u4f5c\u65b9\u6cd5\u3002</p>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#2321-group","title":"2.3.2.1 Group","text":"<p>Group\u5373\u8d44\u6e90\u7ec4\uff0c\u5728kubernetes\u5bf9\u8d44\u6e90\u8fdb\u884c\u5206\u7ec4\u65f6\uff0c\u5bf9\u5e94\u7684\u6570\u636e\u7ed3\u6784\u5c31\u662fGroup\uff0c\u6e90\u7801\u8def\u5f84\uff1ak8s.io/apimachinery/pkg/apis/meta/v1/types.go \uff0c\u5982\u4e0b\uff0c\u53ef\u89c1Group\u6709\u81ea\u5df1\u7684\u540d\u79f0\u548c\u7248\u672c\uff1a</p> <pre><code>type APIGroup struct {\n    TypeMeta `json:\",inline\"`\n    Name string `json:\"name\" protobuf:\"bytes,1,opt,name=name\"`\n    Versions []GroupVersionForDiscovery `json:\"versions\" protobuf:\"bytes,2,rep,name=versions\"`\n    PreferredVersion GroupVersionForDiscovery `json:\"preferredVersion,omitempty\" protobuf:\"bytes,3,opt,name=preferredVersion\"`\n    ServerAddressByClientCIDRs []ServerAddressByClientCIDR `json:\"serverAddressByClientCIDRs,omitempty\" protobuf:\"bytes,4,rep,name=serverAddressByClientCIDRs\"`\n}\n</code></pre> <p>\u5728kubernetes\u4e2d\u6709\u4e24\u79cd\u8d44\u6e90\u7ec4\uff1a</p> <ul> <li>\u6709\u7ec4\u540d\u8d44\u6e90\u7ec4\uff0c\u4f8b\u5982deployment</li> <li>\u65e0\u7ec4\u540d\u8d44\u6e90\u7ec4(\u4e5f\u53eb\u6838\u5fc3\u8d44\u6e90\u7ec4Core Groups)\uff0c\u5b83\u4eec\u90fd\u5f88\u5e38\u89c1\uff0c\u4f8b\u5982\u5355\u4e2apod</li> </ul> <p>deployment\u6709\u7ec4\u540d\uff0cpod\u6ca1\u6709\u7ec4\u540d\uff0c\u54b1\u4eec\u628a\u5b83\u4fe9\u7684OpenAPI\u653e\u5728\u4e00\u8d77\u5bf9\u6bd4\u5c31\u4e00\u76ee\u4e86\u7136\u4e86</p> <p></p>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#2322-version","title":"2.3.2.2 Version","text":"<ul> <li> <p>Version\u5373\u7248\u672c\uff0c\u8fd9\u4e2a\u597d\u7406\u89e3\uff0ckubernetes\u7684\u7248\u672c\u5206\u4e3a\u4e09\u79cd\uff1a</p> </li> <li> <p>Alpha\uff1a\u5185\u90e8\u6d4b\u8bd5\u7248\u672c\uff0c\u5982v1alpha1</p> </li> <li>Beta\uff1a\u7ecf\u5386\u4e86\u5b98\u65b9\u548c\u793e\u533a\u6d4b\u8bd5\u7684\u76f8\u5bf9\u7a33\u5b9a\u7248\uff0c\u5982v1beta1</li> <li>Stable\uff1a\u6b63\u5f0f\u53d1\u5e03\u7248\uff0c\u5982v1\u3001v2</li> </ul> <p>\u5982\u4e0b\u56fe\u7ea2\u6846\uff0c\u8d44\u6e90\u7ec4batch\u4e4b\u4e0b\u6709v1\u548cv2alpha1\u4e24\u4e2a\u7248\u672c\uff0c\u6bcf\u4e2a\u7248\u672c\u4e0b\u90fd\u6709\u591a\u4e2a\u8d44\u6e90\uff1a</p> <p></p> <p>\u6570\u636e\u7ed3\u6784\u6e90\u7801\u8fd8\u662f\u5728types.go\u6587\u4ef6\u4e2d</p> <pre><code>type APIVersions struct {\n    TypeMeta `json:\",inline\"`\n    Versions []string `json:\"versions\" protobuf:\"bytes,1,rep,name=versions\"`\n    ServerAddressByClientCIDRs []ServerAddressByClientCIDR `json:\"serverAddressByClientCIDRs\" protobuf:\"bytes,2,rep,name=serverAddressByClientCIDRs\"`\n}\n</code></pre>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#2323-resource","title":"2.3.2.3  Resource","text":"<ul> <li> <p>Resource\u8d44\u6e90\u5728kubernetes\u4e2d\u7684\u91cd\u8981\u6027\u662f\u4e0d\u8a00\u800c\u55bb\u7684\uff0c\u5e38\u89c1\u7684pod\u3001service\u3001deployment\u8fd9\u4e9b\u90fd\u662f\u8d44\u6e90\uff0c\u4e0b\u9762\u662f\u5173\u4e8e\u8d44\u6e90\u7684\u4e00\u4e9b\u5c0f\u7ed3\uff1a</p> </li> <li> <p>\u5728kubernetes\u73af\u5883\u88ab\u5b9e\u4f8b\u5316\u7684\u8d44\u6e90\u5373\u8d44\u6e90\u5bf9\u8c61(ResourceObject)\uff1b</p> </li> <li>\u8d44\u6e90\u88ab\u5206\u4e3a\u6301\u4e45\u6027\uff08Persistent Entity\uff09\u548c\u975e\u6301\u4e45\u6027\uff08Ephemeral Entity\uff09\uff0c\u6301\u4e45\u6027\u5982deployment\uff0c\u521b\u5efa\u540e\u4f1a\u5728etcd\u4fdd\u5b58\uff0c\u975e\u6301\u4e45\u6027\u5982pod\uff1b</li> </ul> <pre><code>type APIResource struct {\n    Name string `json:\"name\" protobuf:\"bytes,1,opt,name=name\"`\n    SingularName string `json:\"singularName\" protobuf:\"bytes,6,opt,name=singularName\"`\n    Namespaced bool `json:\"namespaced\" protobuf:\"varint,2,opt,name=namespaced\"`\n    Group string `json:\"group,omitempty\" protobuf:\"bytes,8,opt,name=group\"`\n    Version string `json:\"version,omitempty\" protobuf:\"bytes,9,opt,name=version\"`\n    Kind string `json:\"kind\" protobuf:\"bytes,3,opt,name=kind\"`\n    Verbs Verbs `json:\"verbs\" protobuf:\"bytes,4,opt,name=verbs\"`\n    ShortNames []string `json:\"shortNames,omitempty\" protobuf:\"bytes,5,rep,name=shortNames\"`\n    Categories []string `json:\"categories,omitempty\" protobuf:\"bytes,7,rep,name=categories\"`\n    StorageVersionHash string `json:\"storageVersionHash,omitempty\" protobuf:\"bytes,10,opt,name=storageVersionHash\"`\n}\n</code></pre> <p>kubernetes\u4e3a\u8d44\u6e90\u51c6\u5907\u4e868\u79cd\u64cd\u4f5c\uff1acreate\u3001delete\u3001deletecollection\u3001get\u3001list\u3001patch\u3001update\u3001watch\uff0c\u6bcf\u4e00\u79cd\u8d44\u6e90\u90fd\u652f\u6301\u5176\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u8fd9\u5728\u6bcf\u4e2a\u8d44\u6e90\u7684API\u6587\u6863\u4e2d\u53ef\u4ee5\u770b\u5230\uff1b \u8d44\u6e90\u652f\u6301\u4ee5\u547d\u540d\u7a7a\u95f4\uff08namespace\uff09\u8fdb\u884c\u9694\u79bb\uff1b \u8d44\u6e90\u5bf9\u8c61\u63cf\u8ff0\u6587\u4ef6\u5728\u65e5\u5e38\u64cd\u4f5c\u4e2d\u9891\u7e41\u7528\u5230\uff0c\u4e00\u5171\u7531\u4e94\u90e8\u5206\u7ec4\u6210\uff1aapiVersion\u3001kind\u3001metadata\u3001spec\u3001status\uff0c\u4e0b\u56fe\u662f\u5b98\u65b9\u7684deployment\u63cf\u8ff0\u6587\u4ef6\uff0c\u7528\u4e8e\u521b\u5efa3\u4e2anginx pod\uff0c\u5bf9\u7740\u7ea2\u6846\u548c\u6587\u5b57\u5c31\u4e86\u89e3\u6bcf\u4e2a\u90e8\u5206\u7684\u4f5c\u7528\u4e86\uff1a</p> <p></p> <ul> <li>\u4e0a\u56fe\u5e76\u6ca1\u6709status\uff0c\u8be5\u90e8\u5206\u662f\u7528\u6765\u53cd\u5e94\u5f53\u524d\u8d44\u6e90\u5bf9\u8c61\u72b6\u6001\u7684\uff0c\u4f53\u73b0\u5728\u8d44\u6e90\u7684\u6570\u636e\u7ed3\u6784\u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a</li> </ul> <pre><code>type Deployment struct {\n    metav1.TypeMeta `json:\",inline\"`\n    metav1.ObjectMeta `json:\"metadata,omitempty\" protobuf:\"bytes,1,opt,name=metadata\"`\n    Spec DeploymentSpec `json:\"spec,omitempty\" protobuf:\"bytes,2,opt,name=spec\"`\n    Status DeploymentStatus `json:\"status,omitempty\" protobuf:\"bytes,3,opt,name=status\"`\n}\n</code></pre>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#24-apiresources","title":"2.4  APIResources\u6570\u636e\u7ed3\u6784","text":"<ul> <li>APIResource\u662f\u4e2a\u5e38\u7528\u7684\u6570\u636e\u7ed3\u6784\u4e86\uff0c\u53ef\u4ee5\u7528\u6765\u63cf\u8ff0\u8d44\u6e90\uff0c\u4f8b\u5982resource_quota_controller_test.go\u4e2d\u6709\u5bf9\u5176\u7684\u4f7f\u7528\uff1a</li> </ul> <pre><code>func TestDiscoverySync(t *testing.T) {\n    serverResources := []*metav1.APIResourceList{\n        {\n            GroupVersion: \"v1\",\n            APIResources: []metav1.APIResource{\n                {Name: \"pods\", Namespaced: true, Kind: \"Pod\", Verbs: metav1.Verbs{\"create\", \"delete\", \"list\", \"watch\"}},\n            },\n        },\n    }\n    unsyncableServerResources := []*metav1.APIResourceList{\n        {\n            GroupVersion: \"v1\",\n            APIResources: []metav1.APIResource{\n                {Name: \"pods\", Namespaced: true, Kind: \"Pod\", Verbs: metav1.Verbs{\"create\", \"delete\", \"list\", \"watch\"}},\n                {Name: \"secrets\", Namespaced: true, Kind: \"Secret\", Verbs: metav1.Verbs{\"create\", \"delete\", \"list\", \"watch\"}},\n            },\n        },\n    }\n</code></pre>"},{"location":"cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/#25","title":"2.5 \u5b9e\u9645\u64cd\u4f5c","text":"<ul> <li>\u67e5\u770b\u6240\u6709\u8d44\u6e90kubectl api-resources -o wide\uff0c\u53ef\u89c1\u5f53\u524d\u73af\u5883\u7684\u6240\u6709\u8d44\u6e90\uff0c\u53ca\u5176\u76f8\u5173\u5c5e\u6027\uff1a</li> </ul> <pre><code>[root@k8s]# kubectl api-resources -o wide\nNAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND                             VERBS\nbindings                                       v1                                     true         Binding                          [create]\ncomponentstatuses                 cs           v1                                     false        ComponentStatus                  [get list]\nconfigmaps                        cm           v1                                     true         ConfigMap                        [create delete deletecollection get list patch update watch]\nendpoints                         ep           v1                                     true         Endpoints                        [create delete deletecollection get list patch update watch]\nevents                            ev           v1                                     true         Event                            [create delete deletecollection get list patch update watch]\nlimitranges                       limits       v1                                     true         LimitRange                       [create delete deletecollection get list patch update watch]\nnamespaces                        ns           v1                                     false        Namespace                        [create delete get list patch update watch]\n...\n</code></pre> <ul> <li>\u53ea\u770bapps\u8fd9\u4e2agroup\u4e0b\u9762\u7684\u8d44\u6e90kubectl api-resources --api-group apps -o wide\uff1a</li> </ul> <pre><code>[root@k8s]# kubectl api-resources --api-group apps -o wide\nNAME                  SHORTNAMES   APIVERSION   NAMESPACED   KIND                 VERBS\ncontrollerrevisions                apps/v1      true         ControllerRevision   [create delete deletecollection get list patch update watch]\ndaemonsets            ds           apps/v1      true         DaemonSet            [create delete deletecollection get list patch update watch]\ndeployments           deploy       apps/v1      true         Deployment           [create delete deletecollection get list patch update watch]\nreplicasets           rs           apps/v1      true         ReplicaSet           [create delete deletecollection get list patch update watch]\nstatefulsets          sts          apps/v1      true         StatefulSet          [create delete deletecollection get list patch update watch]\n</code></pre> <ul> <li>\u67e5\u770b\u6307\u5b9a\u8d44\u6e90\u7684\u8be6\u60c5kubectl explain configmap\uff1a</li> </ul> <pre><code>[root@k8s]# kubectl explain configmap\nKIND:     ConfigMap\nVERSION:  v1\n\nDESCRIPTION:\n     ConfigMap holds configuration data for pods to consume.\n\nFIELDS:\n   apiVersion   &lt;string&gt;\n     APIVersion defines the versioned schema of this representation of an\n     object. Servers should convert recognized schemas to the latest internal\n     value, and may reject unrecognized values. More info:\n     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md##resources\n\n   binaryData   &lt;map[string]string&gt;\n   ...\n</code></pre> <ul> <li>\u67e5\u770b\u6240\u6709Group\u548cVersion\u7684\u547d\u4ee4kubectl api-versions</li> </ul> <pre><code>[root@k8s]# kubectl api-versions\nadmissionregistration.k8s.io/v1\nadmissionregistration.k8s.io/v1beta1\napiextensions.k8s.io/v1\napiextensions.k8s.io/v1beta1\napiregistration.k8s.io/v1\napiregistration.k8s.io/v1beta1\napps/v1\nauthentication.k8s.io/v1\nauthentication.k8s.io/v1beta1\nauthorization.k8s.io/v1\nauthorization.k8s.io/v1beta1\nautoscaling/v1\nautoscaling/v2beta1\nautoscaling/v2beta2\nbatch/v1\nbatch/v1beta1\ncertificates.k8s.io/v1\ncertificates.k8s.io/v1beta1\ncoordination.k8s.io/v1\ncoordination.k8s.io/v1beta1\ndiscovery.k8s.io/v1beta1\nevents.k8s.io/v1\nevents.k8s.io/v1beta1\nextensions/v1beta1\nflowcontrol.apiserver.k8s.io/v1beta1\nnetworking.k8s.io/v1\nnetworking.k8s.io/v1beta1\nnode.k8s.io/v1\nnode.k8s.io/v1beta1\npolicy/v1beta1\nrbac.authorization.k8s.io/v1\nrbac.authorization.k8s.io/v1beta1\nscheduling.k8s.io/v1\nscheduling.k8s.io/v1beta1\nstorage.k8s.io/v1\nstorage.k8s.io/v1beta1\nv1\nwebapp.com.bolingcavalry/v1\n</code></pre>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/","title":"2.K8s API\u8bbf\u95ee\u65b9\u5f0f","text":"<p>\u901a\u5e38\uff0cKubernetes API \u652f\u6301\u901a\u8fc7\u6807\u51c6 HTTP <code>POST</code>\u3001<code>PUT</code>\u3001<code>DELETE</code> \u548c <code>GET</code> \u5728\u6307\u5b9a PATH \u8def\u5f84\u4e0a\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u548c\u68c0\u7d22\u64cd\u4f5c\uff0c\u5e76\u4f7f\u7528 JSON \u4f5c\u4e3a\u9ed8\u8ba4\u7684\u6570\u636e\u4ea4\u4e92\u683c\u5f0f\u3002</p> <p>\u6bd4\u5982\u73b0\u5728\u6211\u4eec\u8981\u521b\u5efa\u4e00\u4e2a Pod\u5bf9\u8c61\uff0c\u90a3\u4e48\u6211\u4eec\u7684 YAML \u6587\u4ef6\u7684\u58f0\u660e\u5c31\u9700\u8981\u600e\u4e48\u5199\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod1\n  namespace: default\n.......\n</code></pre> <p>\u518d\u5165\u4e00\u4e2aJob\u7684\u8d44\u6e90\u5bf9\u8c61\u5982\u4e0b\uff1a</p> <p>\u5176\u4e2d <code>Job</code> \u5c31\u662f\u8fd9\u4e2a API \u5bf9\u8c61\u7684\u8d44\u6e90\u7c7b\u578b Kind\uff0c\u800c\u8d44\u6e90 Resource \u901a\u5e38\u4e3a Kind \u7684\u5c0f\u5199\u590d\u6570\u8bcd\uff0c\u6bd4\u5982\u8fd9\u91cc\u5c31\u662f <code>jobs</code>\uff0c<code>batch</code> \u5c31\u662f\u5b83\u7684\u7ec4\uff08Group\uff09\uff0c<code>v1</code> \u5c31\u662f\u5b83\u7684\u7248\u672c\uff08Version\uff09\uff0cAPI Group\u3001Version \u548c\u8d44\u6e90\u5c31\u552f\u4e00\u5b9a\u4e49\u4e86\u4e00\u4e2a HTTP \u8def\u5f84\uff0c\u7136\u540e\u5728 kube-apiserver \u7aef\u5bf9\u8fd9\u4e2a URL \u8fdb\u884c\u4e86\u76d1\u542c\uff0c\u7136\u540e\u628a\u5bf9\u5e94\u7684\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e86\u5bf9\u5e94\u7684\u63a7\u5236\u5668\u8fdb\u884c\u5904\u7406\u800c\u5df2\u3002</p> <p></p> <p>Resource \u548c Kind \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\u9700\u8981\u6ce8\u610f\u7684 Resource \u6307\u7684\u662f HTTP Restful API \u8bf7\u6c42\u8def\u5f84\u4e2d\u7684\u8d44\u6e90\uff08\u7406\u89e3 Restful API \u7684\u8d44\u6e90\uff09\uff0c\u800c Kind \u5bf9\u5e94\u7684\u662f\u7cfb\u7edf\u4e2d\u771f\u6b63\u7684\u5b9e\u4f53\uff0c\u8fd9\u4e24\u4e2a\u662f\u6709\u672c\u8d28\u533a\u522b\u7684\u3002</p> <p>\u6bcf\u4e2a Kind \u90fd\u5b58\u5728\u4e8e\u4e00\u4e2a Group \u548c Version \u4e2d , \u5e76\u901a\u8fc7 GroupVersionKind (GVK) \u6765\u6807\u8bc6\uff0cGVR \u548c GVK \u662f\u76f8\u5173\u8054\u7684\uff0cGVK \u901a\u8fc7 GVR \u6807\u8bc6\u7684 HTTP \u8def\u5f84\u6765\u63d0\u4f9b\u670d\u52a1\uff0c\u5c06 GVK \u6620\u5c04\u5230 GVR \u7684\u8fc7\u7a0b\u5c31\u53eb\u505a REST mapping\u3002</p> <p>API \u8bf7\u6c42\u5904\u7406\u8fc7\u7a0b</p> <p></p> <p>\u4e0a\u56fe\u662f Kubernetes API \u5904\u7406\u8bf7\u6c42\u7684\u6574\u4e2a\u6d41\u7a0b\uff1a</p> <ul> <li>HTTP \u8bf7\u6c42\u5148\u7531 <code>DefaultBuildHandlerChain()</code> \u6ce8\u518c\u7684\u4e00\u7cfb\u5217\u8fc7\u6ee4\u5668\u5904\u7406 , \u8fd9\u4e2a\u51fd\u6570\u4f4d\u4e8ek8s.io/apiserver/pkg/server/config.go \u6587\u4ef6\u4e2d\uff0c\u5b83\u5bf9\u8bf7\u6c42\u8fdb\u884c\u4e00\u7cfb\u5217\u8fc7\u6ee4\u64cd\u4f5c\uff0c\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u5c31\u8fd4\u56de\u76f8\u5e94 HTTP \u8fd4\u56de\u7801</li> <li>\u63a5\u4e0b\u6765\u6839\u636e\u8bf7\u6c42\u7684\u8def\u5f84\uff0c\u901a\u8fc7 handler \u8def\u7531\u5230\u5404\u79cd\u7a0b\u5e8f\u4e2d k8s.io/apiserver/pkg/server/handler.go</li> <li>\u6bcf\u4e2a API Group \u90fd\u6ce8\u518c\u4e86\u4e00\u4e2a handler , \u8be6\u60c5\u53c2\u89c1k8s.io/apiserver/pkg/endpoints/groupversion.go\u548c k8s.io/apiserver/pkg/endpoints/installer.go \u5b83\u63a5\u53d7 HTTP \u8bf7\u6c42\u548c\u4e0a\u4e0b\u6587\uff0c\u5e76\u4ece etcd \u4e2d\u68c0\u7d22\u548c\u4f20\u9012\u8bf7\u6c42\u7684\u5bf9\u8c61\u8fdb\u884c\u6570\u636e\u5904\u7406\u3002</li> </ul>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#kubectl","title":"\u4e00 kubectl","text":"<pre><code>$ kubectl get --raw /\n{\n  \"paths\": [\n    \"/api\",\n    \"/api/v1\",\n    \"/apis\",\n    \"/apis/\",\n    ......\n    \"/version\"\n  ]\n}\n</code></pre> <p>\u6bd4\u5982\u6211\u4eec\u6765\u67e5\u770b\u6279\u5904\u7406\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u5728\u6211\u4eec\u5f53\u524d\u8fd9\u4e2a\u7248\u672c\u4e2d\u5b58\u5728\u4e24\u4e2a\u7248\u672c\u7684\u64cd\u4f5c\uff1a/apis/batch/v1 \u548c /apis/batch/v1beta1\uff0c\u5206\u522b\u66b4\u9732\u4e86\u53ef\u4ee5\u67e5\u8be2\u548c\u64cd\u4f5c\u7684\u4e0d\u540c\u5b9e\u4f53\u96c6\u5408\uff0c\u540c\u6837\u6211\u4eec\u8fd8\u662f\u53ef\u4ee5\u901a\u8fc7 kubectl \u6765\u67e5\u8be2\u5bf9\u5e94\u5bf9\u8c61\u4e0b\u9762\u7684\u6570\u636e\uff1a</p> <pre><code>$ kubectl get --raw /apis/batch/v1 | python -m json.tool\n{\n    \"kind\": \"APIResourceList\",\n    \"apiVersion\": \"v1\",\n    \"groupVersion\": \"batch/v1\",\n    \"resources\": [\n        {\n            \"name\": \"cronjobs\",\n            \"singularName\": \"\",\n            \"namespaced\": true,\n            \"kind\": \"CronJob\",\n            \"verbs\": [\n                \"create\",\n                \"delete\",\n                \"deletecollection\",\n                \"get\",\n                \"list\",\n                \"patch\",\n                \"update\",\n                \"watch\"\n            ],\n            \"shortNames\": [\n                \"cj\"\n            ],\n            \"categories\": [\n                \"all\"\n            ],\n            \"storageVersionHash\": \"h/JlFAZkyyY=\"\n        },\n        {\n            \"name\": \"cronjobs/status\",\n            \"singularName\": \"\",\n            \"namespaced\": true,\n            \"kind\": \"CronJob\",\n            \"verbs\": [\n                \"get\",\n                \"patch\",\n                \"update\"\n            ]\n        },\n        {\n            \"name\": \"jobs\",\n            \"singularName\": \"\",\n            \"namespaced\": true,\n            \"kind\": \"Job\",\n            \"verbs\": [\n                \"create\",\n                \"delete\",\n                \"deletecollection\",\n                \"get\",\n                \"list\",\n                \"patch\",\n                \"update\",\n                \"watch\"\n            ],\n            \"categories\": [\n                \"all\"\n            ],\n            \"storageVersionHash\": \"mudhfqk/qZY=\"\n        },\n        {\n            \"name\": \"jobs/status\",\n            \"singularName\": \"\",\n            \"namespaced\": true,\n            \"kind\": \"Job\",\n            \"verbs\": [\n                \"get\",\n                \"patch\",\n                \"update\"\n            ]\n        }\n    ]\n}\n</code></pre>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#_1","title":"\u4e8c \u7a0b\u5e8f\u8bbf\u95ee","text":""},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#21-go-client","title":"2.1 Go Client","text":"<p>\u8981\u83b7\u5f97\u8fd9\u4e2a\u5e93\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4: go get k8s.io/client-go@kubernetes- &lt; kubernetes-version-number &gt; See https://github.com/kubernetes/client-go/releases \u67e5\u770b\u652f\u6301\u54ea\u4e9b\u7248\u672c\u3002</p> <pre><code>package main\n\nimport (\n  \"context\"\n  \"fmt\"\n  \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n  \"k8s.io/client-go/kubernetes\"\n  \"k8s.io/client-go/tools/clientcmd\"\n)\n\nfunc main() {\n  // uses the current context in kubeconfig\n  // path-to-kubeconfig -- for example, /root/.kube/config\n  config, _ := clientcmd.BuildConfigFromFlags(\"\", \"&lt;path-to-kubeconfig&gt;\")\n  // creates the clientset\n  clientset, _ := kubernetes.NewForConfig(config)\n  // access the API to list pods\n  pods, _ := clientset.CoreV1().Pods(\"\").List(context.TODO(), v1.ListOptions{})\n  fmt.Printf(\"There are %d pods in the cluster\\n\", len(pods.Items))\n}\n</code></pre>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#22-python-client","title":"2.2 Python Client","text":"<p>\u8981\u4f7f\u7528 Python \u5ba2\u6237\u7aef\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4: pip install kubernetes \u67e5\u770b Python \u5ba2\u6237\u7aef\u5e93\u9875\u9762\u83b7\u53d6\u66f4\u591a\u5b89\u88c5\u9009\u9879\u3002</p> <p>Python \u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u4e0e kubectl CLI \u76f8\u540c\u7684 kubeconfig \u6587\u4ef6\u6765\u5b9a\u4f4d\u548c\u9a8c\u8bc1 API \u670d\u52a1\u5668\u3002\u770b\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>from kubernetes import client, config\n\nconfig.load_kube_config()\n\nv1=client.CoreV1Api()\nprint(\"Listing pods with their IPs:\")\nret = v1.list_pod_for_all_namespaces(watch=False)\nfor i in ret.items:\n    print(\"%s\\t%s\\t%s\" % (i.status.pod_ip, i.metadata.namespace, i.metadata.name))\n</code></pre>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#postman","title":"\u4e09 postman","text":""},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#31-admin-sa","title":"3.1 \u521b\u5efaadmin sa\u7528\u6237","text":"<ul> <li>\u67e5\u770bsa</li> </ul> <pre><code>cat &gt; CreateServiceAccount.yaml &lt;&lt;EOF\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-user\n  namespace: kube-system\nEOF\nkubectl apply -f CreateServiceAccount.yaml\n</code></pre> <ul> <li>\u67e5\u770bsa</li> </ul> <pre><code>$ kubectl get sa -n kube-system admin-user\nNAME         SECRETS   AGE\nadmin-user   1         11m\n</code></pre>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#32","title":"3.2 \u7528\u6237\u6388\u6743","text":"<p>\u7f16\u5199RoleBinding.yaml\u6587\u4ef6\uff0c\u7ed9\u4e8ecluster-admin\u89d2\u8272</p> <pre><code>cat &gt;RoleBinding.yaml &lt;&lt;EOF\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-user\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: admin-user\n  namespace: kube-system\n\nEOF\n\nkubectl apply -f  RoleBinding.yaml\n</code></pre>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#33","title":"3.3 \u67e5\u770b","text":"<pre><code>$ kubectl get secret -n kube-system | grep admin\nadmin-user-token-cz57l                           kubernetes.io/service-account-token   3      60m\n\n$ kubectl describe secrets `kubectl get secret -n kube-system | grep admin | awk '{print $1}'` -n kube-system\n</code></pre>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#34-tokenapi","title":"3.4 \u4f7f\u7528token\u8fdb\u884c\u6d4b\u8bd5api","text":"<p>\u5728postaman\u4e2d\u5173\u95edSSL\u8ba4\u8bc1\uff08setting\uff09</p>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#35-api","title":"3.5 API\u67e5\u9605","text":"<p>https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/deployment-v1/</p> <p>https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/</p> <p></p>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#curl","title":"\u56db curl\u8bbf\u95ee","text":""},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#41-kubectl-proxy","title":"4.1 kubectl proxy","text":"<p>\u4e0b\u9762\u7684\u547d\u4ee4\u4ee5\u5b83\u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\u7684\u6a21\u5f0f\u8fd0\u884c kubectl\u3002\u5b83\u5904\u7406\u5b9a\u4f4d API \u670d\u52a1\u5668\u548c\u8eab\u4efd\u9a8c\u8bc1\u3002</p> <pre><code>  $ kubectl proxy --port=8080 &amp;\n</code></pre> <pre><code>$ curl http://localhost:8080/api/\n{\n  \"versions\": [\n    \"v1\"\n  ],\n  \"serverAddressByClientCIDRs\": [\n    {\n      \"clientCIDR\": \"0.0.0.0/0\",\n      \"serverAddress\": \"10.0.1.149:443\"\n    }\n  ]\n}\n\n$ curl http://localhost:8080/apis/batch/v1\n{\n  \"kind\": \"APIResourceList\",\n  \"apiVersion\": \"v1\",\n  \"groupVersion\": \"batch/v1\",\n  \"resources\": [\n    {\n      \"name\": \"jobs\",\n      \"singularName\": \"\",\n      \"namespaced\": true,\n      \"kind\": \"Job\",\n      \"verbs\": [\n        \"create\",\n        \"delete\",\n        \"deletecollection\",\n        \"get\",\n        \"list\",\n        \"patch\",\n        \"update\",\n        \"watch\"\n      ],\n      \"categories\": [\n        \"all\"\n      ],\n      \"storageVersionHash\": \"mudhfqk/qZY=\"\n    },\n    {\n      \"name\": \"jobs/status\",\n      \"singularName\": \"\",\n      \"namespaced\": true,\n      \"kind\": \"Job\",\n      \"verbs\": [\n        \"get\",\n        \"patch\",\n        \"update\"\n      ]\n    }\n  ]\n}\n$ curl http://127.0.0.1:8001/apis/batch/v1beta1\n```\n</code></pre>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#42-kubectl","title":"4.2 \u6ca1\u6709 kubectl \u4ee3\u7406","text":"<p>\u901a\u8fc7\u5c06\u8ba4\u8bc1\u4ee4\u724c\u76f4\u63a5\u4f20\u9012\u7ed9 API \u670d\u52a1\u5668\uff0c\u53ef\u4ee5\u907f\u514d\u4f7f\u7528 kubectl \u4ee3\u7406\uff0c\u5982\u4e0b\u6240\u793a:</p> <pre><code># Check all possible clusters, as your .KUBECONFIG may have multiple contexts:\nkubectl config view -o jsonpath='{\"Cluster name\\tServer\\n\"}{range .clusters[*]}{.name}{\"\\t\"}{.cluster.server}{\"\\n\"}{end}'\n\n# Select name of cluster you want to interact with from above output:\nexport CLUSTER_NAME=\"some_server_name\"\n\n# Point to the API server referring the cluster name\nAPISERVER=$(kubectl config view -o jsonpath=\"{.clusters[?(@.name==\\\"$CLUSTER_NAME\\\")].cluster.server}\")\n\n# Gets the token value\nTOKEN=$(kubectl get secrets -o jsonpath=\"{.items[?(@.metadata.annotations['kubernetes\\.io/service-account\\.name']=='default')].data.token}\"|base64 --decode)\n\n# Explore the API with TOKEN\ncurl -X GET $APISERVER/api --header \"Authorization: Bearer $TOKEN\" --insecure\n\n\n{\n  \"kind\": \"APIVersions\",\n  \"versions\": [\n    \"v1\"\n  ],\n  \"serverAddressByClientCIDRs\": [\n    {\n      \"clientCIDR\": \"0.0.0.0/0\",\n      \"serverAddress\": \"10.0.1.149:443\"\n    }\n  ]\n}\n</code></pre> <p>jsonpath</p> <pre><code>APISERVER=$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}')\nTOKEN=$(kubectl get secret $(kubectl get serviceaccount default -o jsonpath='{.secrets[0].name}') -o jsonpath='{.data.token}' | base64 --decode )\ncurl $APISERVER/api --header \"Authorization: Bearer $TOKEN\" --insecure\n{\n  \"kind\": \"APIVersions\",\n  \"versions\": [\n    \"v1\"\n  ],\n  \"serverAddressByClientCIDRs\": [\n    {\n      \"clientCIDR\": \"0.0.0.0/0\",\n      \"serverAddress\": \"10.0.1.149:443\"\n    }\n  ]\n}\n</code></pre>"},{"location":"cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/</li> </ul>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/","title":"3.Client-go \u7684\u4f7f\u7528","text":""},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#client-go","title":"\u4e00 client-go\u7b80\u4ecb","text":"<p>\u8fd1\u671f\u6709\u9700\u6c42\u8981\u5bf9k8s\u7684\u4e00\u4e9b\u6570\u636e\u8fdb\u884c\u81ea\u5b9a\u4e49\u6574\u5408\uff0c\u5229\u7528client-go\u53ef\u4ee5\u5feb\u901f\u65b9\u4fbf\u7684\u5b9e\u73b0\u9700\u6c42\uff0c\u5728K8s\u8fd0\u7ef4\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528kubectl\u3001\u5ba2\u6237\u7aef\u5e93\u6216\u8005REST\u8bf7\u6c42\u6765\u8bbf\u95eeK8S API\u3002\u800c\u5b9e\u9645\u4e0a\uff0c\u65e0\u8bba\u662fkubectl\u8fd8\u662f\u5ba2\u6237\u7aef\u5e93\uff0c\u90fd\u662f\u5c01\u88c5\u4e86REST\u8bf7\u6c42\u7684\u5de5\u5177\u3002client-go\u4f5c\u4e3a\u4e00\u4e2a\u5ba2\u6237\u7aef\u5e93\uff0c\u80fd\u591f\u8c03\u7528K8S API\uff0c\u5b9e\u73b0\u5bf9K8S\u96c6\u7fa4\u4e2d\u8d44\u6e90\u5bf9\u8c61\uff08\u5305\u62ecdeployment\u3001service\u3001ingress\u3001replicaSet\u3001pod\u3001namespace\u3001node\u7b49\uff09\u7684\u589e\u5220\u6539\u67e5\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#_1","title":"\u4e8c \u7b80\u4ecb","text":""},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#21","title":"2.1 \u7ed3\u6784\u56fe","text":"<p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230client-go \u4e2d\u5305\u542b\u56db\u79cdclient\uff0c<code>ClientSet</code>\uff0c<code>DynamicClient</code>\uff0c<code>DiscoveryClient</code>\u90fd\u662f<code>RestClient</code>\u7684\u5177\u4f53\u5b9e\u73b0\u3002</p>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#22","title":"2.2 \u76ee\u5f55\u7ed3\u6784","text":"<pre><code># tree client-go/ -L 1\nclient-go/\n  \u251c\u2500\u2500 discovery\n  \u251c\u2500\u2500 dynamic\n  \u251c\u2500\u2500 informers\n  \u251c\u2500\u2500 kubernetes\n  \u251c\u2500\u2500 listers\n  \u251c\u2500\u2500 plugin\n  \u251c\u2500\u2500 rest\n  \u251c\u2500\u2500 scale\n  \u251c\u2500\u2500 tools\n  \u251c\u2500\u2500 transport\n  \u2514\u2500\u2500 util\n</code></pre> <ul> <li><code>discovery</code>\uff1a\u63d0\u4f9b <code>DiscoveryClient</code> \u53d1\u73b0\u5ba2\u6237\u7aef</li> <li><code>dynamic</code>\uff1a\u63d0\u4f9b <code>DynamicClient</code> \u52a8\u6001\u5ba2\u6237\u7aef</li> <li><code>informers</code>\uff1a\u6bcf\u79cd kubernetes \u8d44\u6e90\u7684 Informer \u5b9e\u73b0</li> <li><code>kubernetes</code>\uff1a\u63d0\u4f9b <code>ClientSet</code> \u5ba2\u6237\u7aef</li> <li><code>listers</code>\uff1a\u4e3a\u6bcf\u4e00\u4e2a Kubernetes \u8d44\u6e90\u63d0\u4f9b Lister \u529f\u80fd\uff0c\u8be5\u529f\u80fd\u5bf9 Get \u548c List \u8bf7\u6c42\u63d0\u4f9b\u53ea\u8bfb\u7684\u7f13\u5b58\u6570\u636e</li> <li><code>plugin</code>\uff1a\u63d0\u4f9b OpenStack\u3001GCP \u548c Azure \u7b49\u4e91\u670d\u52a1\u5546\u6388\u6743\u63d2\u4ef6</li> <li><code>rest</code>\uff1a\u63d0\u4f9b <code>RESTClient</code> \u5ba2\u6237\u7aef\uff0c\u5bf9 Kubernetes API Server \u6267\u884c RESTful \u64cd\u4f5c</li> <li><code>scale</code>\uff1a\u63d0\u4f9b <code>ScaleClient</code> \u5ba2\u6237\u7aef\uff0c\u7528\u4e8e\u6269\u5bb9\u6216\u7f29\u5bb9 Deployment\u3001ReplicaSet\u3001Relication Controller \u7b49\u8d44\u6e90\u5bf9\u8c61</li> <li><code>tools</code>\uff1a\u63d0\u4f9b\u5e38\u7528\u5de5\u5177\uff0c\u4f8b\u5982 SharedInformer\u3001Reflector\u3001DealtFIFO \u53ca Indexers\u3002\u63d0\u4f9b Client \u67e5\u8be2\u548c\u7f13\u5b58\u673a\u5236\uff0c\u4ee5\u51cf\u5c11\u5411 kube-apiserver \u53d1\u8d77\u7684\u8bf7\u6c42\u6570\u7b49</li> <li><code>transport</code>\uff1a\u63d0\u4f9b\u5b89\u5168\u7684 TCP \u8fde\u63a5\uff0c\u652f\u6301 Http Stream\uff0c\u67d0\u4e9b\u64cd\u4f5c\u9700\u8981\u5728\u5ba2\u6237\u7aef\u548c\u5bb9\u5668\u4e4b\u95f4\u4f20\u8f93\u4e8c\u8fdb\u5236\u6d41\uff0c\u4f8b\u5982 exec\u3001attach \u7b49\u64cd\u4f5c\u3002\u8be5\u529f\u80fd\u7531\u5185\u90e8\u7684 spdy \u5305\u63d0\u4f9b\u652f\u6301</li> <li><code>util</code>\uff1a\u63d0\u4f9b\u5e38\u7528\u65b9\u6cd5\uff0c\u4f8b\u5982 WorkQueue \u529f\u80fd\u961f\u5217\u3001Certificate \u8bc1\u4e66\u7ba1\u7406\u7b49</li> </ul>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#_2","title":"\u4e09 \u8ba4\u8bc1","text":"<p>\u8fd9\u91cc\u503c\u5f97\u4e00\u63d0\u7684\u662fgo mod\u901a\u8fc7go client \u5bf9\u63a5k8s\u7684\u65f6\u5019\u6709\u4e2a\u5c0f\u5751 \u90a3\u4e48\u5c31\u662f\u6211\u4eec\u9700\u8981\u5728go mod\u6587\u4ef6\u4e2d\u6307\u5b9ak8s\u7248\u672c \u4e0d\u7136\u4f1a\u9ed8\u8ba4\u62c9\u53bb\u6700\u65b0\u7684k8s\u7248\u672c\u7684\u5305 \u6211\u4eec\u4e5f\u77e5\u9053\u4e0d\u540c\u7684k8s\u7248\u672c\u7684api\u4f1a\u51fa\u73b0\u5dee\u5f02  </p>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#31","title":"3.1 \u8ba4\u8bc1","text":""},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#311-token","title":"3.1.1 token","text":"<pre><code># APISERVER=$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}')\n# TOKEN=$(kubectl get secret $(kubectl get serviceaccount default -o jsonpath='{.secrets[0].name}') -o # jsonpath='{.data.token}' | base64 --decode )\n# curl $APISERVER/api --header \"Authorization: Bearer $TOKEN\" --insecure\n</code></pre>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#client-go_1","title":"\u56db client-go\u56db\u79cd\u7c7b\u578b","text":""},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#41-restclient","title":"4.1 RestClient","text":"<p>RestClient\u662f\u6700\u57fa\u7840\u7684\u5ba2\u6237\u7aef\uff0cRestClient\u57fa\u4e8ehttp request\u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u5b9e\u73b0\u4e86restful\u7684api\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 \u662fRESTClient\u63d0\u4f9b\u7684RESTful\u65b9\u6cd5\u5982Get()\uff0cPut()\uff0cPost()\uff0cDelete()\u8fdb\u884c\u4ea4\u4e92,\u540c\u65f6\u652f\u6301Json \u548c protobuf,\u652f\u6301\u6240\u6709\u539f\u751f\u8d44\u6e90\u548cCRDs\uff0c\u4f46\u662f\uff0c\u4e00\u822c\u800c\u8a00\uff0c\u4e3a\u4e86\u66f4\u4e3a\u4f18\u96c5\u7684\u5904\u7406\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u901a\u8fc7Clientset\u5c01\u88c5RESTClient\uff0c\u7136\u540e\u518d\u5bf9\u5916\u63d0\u4f9b\u63a5\u53e3\u548c\u670d\u52a1\u3002</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    corev1 \"k8s.io/api/core/v1\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    \"k8s.io/client-go/kubernetes/scheme\"\n    \"k8s.io/client-go/rest\"\n    \"k8s.io/client-go/tools/clientcmd\"\n)\n\nvar configFile = \"../config\"\nvar ApiPath = \"api\"\nvar nameSpace = \"kube-system\"\nvar resouce = \"pods\"\n\nfunc main() {\n    // \u751f\u6210config\n    config, err := clientcmd.BuildConfigFromFlags(\"\", configFile)\n    if err != nil {\n        panic(err)\n    }\n    config.APIPath = ApiPath\n    config.GroupVersion = &amp;corev1.SchemeGroupVersion\n    config.NegotiatedSerializer = scheme.Codecs\n\n    // \u751f\u6210restClient\n    restClient, err := rest.RESTClientFor(config)\n    if err != nil {\n        panic(err)\n    }\n    // \u58f0\u660e\u7a7a\u7ed3\u6784\u4f53\n    rest := &amp;corev1.PodList{}\n    if err = restClient.Get().Namespace(nameSpace).Resource(\"pods\").VersionedParams(&amp;metav1.ListOptions{Limit: 500},\n        scheme.ParameterCodec).Do().Into(rest); err != nil {\n        panic(err)\n    }\n    for _, v := range rest.Items {\n        fmt.Printf(\"NameSpace: %v  Name: %v  Status: %v \\n\", v.Namespace, v.Name, v.Status.Phase)\n    }\n}\n</code></pre> <p></p>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#42-clientset","title":"4.2 ClientSet","text":"<p>ClientSet\u5728RestClient\u7684\u57fa\u7840\u4e0a\u5c01\u88c5\u4e86\u5bf9Resouorce\u548cVersion\u7684\u7ba1\u7406\u65b9\u6cd5\u4e00\u4e2aResource\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u800cClientSet\u662f\u591a\u4e2a\u5ba2\u6237\u7aef\u7684\u96c6\u5408</p> <p>\u5176\u64cd\u4f5c\u8d44\u6e90\u5bf9\u8c61\u65f6\u9700\u8981\u6307\u5b9aGroup\u3001\u6307\u5b9aVersion\uff0c\u7136\u540e\u6839\u636eResource\u83b7\u53d6\uff0c\u4f46\u662fclientset\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49crd\u3002</p> <pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/tools/clientcmd\"\n    \"k8s.io/client-go/util/homedir\"\n    \"path/filepath\"\n)\n\n// ~/.kube/config\nfunc ParseConfig(configPath string) (*kubernetes.Clientset, error) {\n    var kubeconfigPath *string\n    if home := homedir.HomeDir(); home != \"\" {\n        kubeconfigPath = flag.String(\"kubeconfig\", filepath.Join(home, \".kube\", \"config\"), \"(optional) absolute path to the kubeconfig file\")\n    } else {\n        kubeconfigPath = flag.String(\"kubeconfig\", configPath, \"absolute path to the kubeconfig file\")\n    }\n    flag.Parse()\n    config, err := clientcmd.BuildConfigFromFlags(\"\", *kubeconfigPath)\n    if err != nil {\n        return nil, err\n    }\n    // \u751f\u6210clientSet\n    clientSet, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        return clientSet, err\n    }\n    return clientSet, nil\n}\n\nfunc ListCm(c *kubernetes.Clientset, ns string) error {\n    configMaps, err := c.CoreV1().ConfigMaps(ns).List(metav1.ListOptions{})\n    if err != nil {\n        return err\n    }\n    for _, cm := range configMaps.Items {\n        fmt.Printf(\"configName: %v, configData: %v \\n\", cm.Name, cm.Data)\n    }\n    return nil\n}\n\nfunc ListNodes(c *kubernetes.Clientset) error {\n    nodeList, err := c.CoreV1().Nodes().List(metav1.ListOptions{})\n    if err != nil {\n        return err\n    }\n    for _, node := range nodeList.Items {\n        fmt.Printf(\"nodeName: %v, status: %v\", node.GetName(), node.GetCreationTimestamp())\n    }\n    return nil\n}\n\nfunc ListPods(c *kubernetes.Clientset, ns string) {\n    pods, err := c.CoreV1().Pods(ns).List(metav1.ListOptions{})\n    if err != nil {\n        panic(err)\n    }\n    for _, v := range pods.Items {\n        fmt.Printf(\"namespace: %v podname: %v podstatus: %v \\n\", v.Namespace, v.Name, v.Status.Phase)\n    }\n}\n\nfunc ListDeployment(c *kubernetes.Clientset, ns string) error {\n    deployments, err := c.AppsV1().Deployments(ns).List(metav1.ListOptions{})\n    if err != nil {\n        return err\n    }\n    for _, v := range deployments.Items {\n        fmt.Printf(\"deploymentname: %v, available: %v, ready: %v\", v.GetName(), v.Status.AvailableReplicas, v.Status.ReadyReplicas)\n    }\n    return nil\n}\n\nfunc main() {\n    var namespace = \"kube-system\"\n    configPath := \"../config\"\n    config, err := ParseConfig(configPath)\n    if err != nil {\n        fmt.Printf(\"load config error: %v\\n\", err)\n    }\n    fmt.Println(\"list pods\")\n    ListPods(config, namespace)\n    fmt.Println(\"list cm\")\n    if err = ListCm(config, namespace); err != nil {\n        fmt.Printf(\"list cm error: %v\", err)\n    }\n    fmt.Println(\"list nodes\")\n    if err = ListNodes(config); err != nil {\n        fmt.Printf(\"list nodes error: %v\", err)\n    }\n    fmt.Println(\"list deployment\")\n    if err = ListDeployment(config, namespace); err != nil {\n        fmt.Printf(\"list deployment error: %v\", err)\n    }\n}\n</code></pre> <p></p>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#43-dynamicclient","title":"4.3 DynamicClient","text":"<p>DynamicClient\u662f\u4e00\u79cd\u52a8\u6001\u5ba2\u6237\u7aef\u5b83\u53ef\u4ee5\u5bf9\u4efb\u4f55\u8d44\u6e90\u8fdb\u884crestful\u64cd\u4f5c\u5305\u62eccrd\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u4e0d\u540c\u4e8e clientset\uff0cdynamic client \u8fd4\u56de\u7684\u5bf9\u8c61\u662f\u4e00\u4e2a map[string]interface{}\uff0c\u5982\u679c\u4e00\u4e2a controller \u4e2d\u9700\u8981\u63a7\u5236\u6240\u6709\u7684 API\uff0c\u53ef\u4ee5\u4f7f\u7528dynamic client\uff0c\u76ee\u524d\u5b83\u5728 garbage collector \u548c namespace controller\u4e2d\u88ab\u4f7f\u7528\u3002 DynamicClient\u7684\u5904\u7406\u8fc7\u7a0b\u5c06Resource\u4f8b\u5982podlist\u8f6c\u6362\u4e3aunstructured\u7c7b\u578b\uff0ck8s\u7684\u6240\u6709resource\u90fd\u53ef\u4ee5\u8f6c\u6362\u4e3a\u8fd9\u4e2a\u7ed3\u6784\u7c7b\u578b\uff0c\u5904\u7406\u5b8c\u4e4b\u540e\u5728\u8f6c\u6362\u4e3apodlist\uff0c\u6574\u4e2a\u8f6c\u6362\u8fc7\u7a0b\u7c7b\u4f3c\u4e8e\u63a5\u53e3\u8f6c\u6362\u5c31\u662f\u901a\u8fc7interface{}\u7684\u65ad\u8a00\u3002</p> <p>Dynamic client \u662f\u4e00\u79cd\u52a8\u6001\u7684 client\uff0c\u5b83\u80fd\u5904\u7406 kubernetes \u6240\u6709\u7684\u8d44\u6e90\uff0c\u53ea\u652f\u6301JSON\u3002</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    apiv1 \"k8s.io/api/core/v1\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    \"k8s.io/apimachinery/pkg/runtime\"\n    \"k8s.io/apimachinery/pkg/runtime/schema\"\n    \"k8s.io/client-go/dynamic\"\n    \"k8s.io/client-go/tools/clientcmd\"\n)\n\nvar namespace = \"kube-system\"\n\nfunc main() {\n\n    config, err := clientcmd.BuildConfigFromFlags(\"\", \"../config\")\n    if err != nil {\n        panic(err)\n    }\n\n    dynamicClient, err := dynamic.NewForConfig(config)\n    if err != nil {\n        panic(err)\n    }\n    // \u5b9a\u4e49\u7ec4\u7248\u672c\u8d44\u6e90\n    gvr := schema.GroupVersionResource{Version: \"v1\", Resource: \"pods\"}\n    unStructObj, err := dynamicClient.Resource(gvr).Namespace(namespace).List(metav1.ListOptions{})\n    if err != nil {\n        panic(err)\n    }\n    podList := &amp;apiv1.PodList{}\n\n    if err = runtime.DefaultUnstructuredConverter.FromUnstructured(unStructObj.UnstructuredContent(), podList); err != nil {\n        panic(err)\n    }\n\n    for _, v := range podList.Items {\n        fmt.Printf(\"namespaces:%v  name:%v status:%v \\n\", v.Namespace, v.Name, v.Status.Phase)\n    }\n}\n</code></pre> <p></p>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#44-discoveryclient","title":"4.4 DiscoveryClient","text":"<p>DiscoveryClient\u662f\u53d1\u73b0\u5ba2\u6237\u7aef\uff0c\u4e3b\u8981\u7528\u4e8e\u53d1\u73b0api server\u652f\u6301\u7684\u8d44\u6e90\u7ec4 \u8d44\u6e90\u7248\u672c \u8d44\u6e90\u4fe1\u606f\uff0ck8s api server \u652f\u6301\u5f88\u591a\u8d44\u6e90\u7ec4 \u8d44\u6e90\u7248\u672c\uff0c\u8d44\u6e90\u4fe1\u606f\uff0c\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7DiscoveryClient\u6765\u67e5\u770b</p> <p>kubectl\u7684api-version\u548capi-resource\u4e5f\u662f\u901a\u8fc7DiscoveryClient\u6765\u5b9e\u73b0\u7684\uff0c\u8fd8\u53ef\u4ee5\u5c06\u4fe1\u606f\u7f13\u5b58\u5728\u672c\u5730cache\uff0c\u4ee5\u51cf\u8f7bapi\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u9ed8\u8ba4\u5728./kube/cache\u548c./kube/http-cache\u4e0b\u3002</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    \"k8s.io/apimachinery/pkg/runtime/schema\"\n    \"k8s.io/client-go/discovery\"\n    \"k8s.io/client-go/tools/clientcmd\"\n)\n\nfunc main() {\n    config, err := clientcmd.BuildConfigFromFlags(\"\", \"../config\")\n    if err != nil {\n        panic(err)\n    }\n    discoverClient, err := discovery.NewDiscoveryClientForConfig(config)\n    if err != nil {\n        panic(err)\n    }\n    _, apiResourceList, err := discoverClient.ServerGroupsAndResources()\n    for _, v := range apiResourceList {\n        gv, err := schema.ParseGroupVersion(v.GroupVersion)\n        if err != nil {\n            panic(err)\n        }\n        for _, resource := range v.APIResources {\n            fmt.Println(\"name:\", resource.Name, \"    \", \"group:\", gv.Group, \"    \", \"version:\", gv.Version)\n        }\n    }\n\n}\n</code></pre> <p></p>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#_3","title":"\u4e94 \u5176\u4ed6","text":"<p>\u5b66\u4e60client-go\uff0c\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u5229\u7528\u5176\u5bf9k8s\u96c6\u7fa4\u8d44\u6e90\u8fdb\u884c\u64cd\u4f5c\uff0ckubeconfig\u2192rest.config\u2192clientset\u2192\u5177\u4f53\u7684client(CoreV1Client)\u2192\u5177\u4f53\u7684\u8d44\u6e90\u5bf9\u8c61(pod)\u2192RESTClient\u2192http.Client\u2192HTTP\u8bf7\u6c42\u7684\u53d1\u9001\u53ca\u54cd\u5e94</p> <p>\u901a\u8fc7clientset\u4e2d\u4e0d\u540c\u7684client\u548cclient\u4e2d\u4e0d\u540c\u8d44\u6e90\u5bf9\u8c61\u7684\u65b9\u6cd5\u5b9e\u73b0\u5bf9kubernetes\u4e2d\u8d44\u6e90\u5bf9\u8c61\u7684\u589e\u5220\u6539\u67e5\u7b49\u64cd\u4f5c\uff0c\u5e38\u7528\u7684client\u6709CoreV1Client\u3001AppsV1beta1Client\u3001ExtensionsV1beta1Client\u7b49\u3002</p> <p>\u672c\u7bc7\u4e3a\u7b80\u5355\u5229\u7528client-go \u5b9e\u73b0\u7b80\u5355\u7684k8s\u8d44\u6e90\u64cd\u4f5c\uff0c\u540e\u671f\u5229\u7528\u4f8b\u5982 kubebuilder \u548c operator-SDK \u7f16\u5199operator\u4e5f\u9700\u8981\u6df1\u5165\u7684\u7406\u89e3\u548c\u5b66\u4e60client-go\u3002\u540e\u671f\u7ee7\u7eed\u7ee7\u7eed\u6df1\u5165\u5b66\u4e60\u3002</p>"},{"location":"cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.voidking.com/dev-k8s-client-go/</li> <li>https://godoc.org/k8s.io/client-go/kubernetes</li> <li>https://github.com/kubernetes/client-go</li> <li>https://pkg.go.dev/k8s.io/client-go/kubernetes</li> <li>https://zhuanlan.zhihu.com/p/202611841?utm_source=wechat_session</li> </ul>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/","title":"4.Cobra+Client-go\u5b9e\u73b0K8s\u63d2\u4ef6\u5f00\u53d1","text":""},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5728\u6211\u4eec\u4f7f\u7528kubectl\u67e5\u770bk8s\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u60f3\u76f4\u63a5\u67e5\u770b\u5bf9\u5e94\u8d44\u6e90\u7684\u5bb9\u5668\u540d\u79f0\u548c\u955c\u50cf\u540d\u79f0\uff0c\u76ee\u524dkubectl\u8fd8\u4e0d\u652f\u6301\u8be5\u9009\u578b\uff0c\u9700\u8981\u6211\u4eecdescribe\u7136\u540e\u6765\u67e5\u770b\uff0c\u5bf9\u4e8e\u96c6\u7fa4\u81ea\u5df1\u6bd4\u8f83\u591a\uff0c\u4e0d\u662f\u5f88\u65b9\u4fbf\uff0c\u56e0\u6b64\u840c\u751f\u81ea\u5df1\u5f00\u53d1kubectl \u63d2\u4ef6\u6765\u5b9e\u73b0\u8be5\u529f\u80fd\u3002</p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#_2","title":"\u4e8c \u76f8\u5173\u6280\u672f","text":""},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#21-cobra","title":"2.1 Cobra","text":"<p>Cobra\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u7a0b\u5e8f\u5e93\uff0c\u5176\u662f\u4e00\u4e2a\u7528\u6765\u7f16\u5199\u547d\u4ee4\u884c\u7684\u795e\u5668\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u811a\u624b\u67b6\uff0c\u7528\u4e8e\u5feb\u901f\u751f\u6210\u57fa\u4e8eCobra\u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528Cobra\u5feb\u901f\u7684\u53bb\u5f00\u53d1\u51fa\u6211\u4eec\u60f3\u8981\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u975e\u5e38\u7684\u65b9\u4fbf\u5feb\u6377\u3002</p> <p>\u8be6\u7ec6\u53ef\u53c2\u8003\uff1aGolang \u5f00\u53d1\u4e4bCobra\u521d\u63a2</p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#22-client-go","title":"2.2 Client-go","text":"<p>\u5728K8s\u8fd0\u7ef4\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528kubectl\u3001\u5ba2\u6237\u7aef\u5e93\u6216\u8005REST\u8bf7\u6c42\u6765\u8bbf\u95eeK8S API\u3002\u800c\u5b9e\u9645\u4e0a\uff0c\u65e0\u8bba\u662fkubectl\u8fd8\u662f\u5ba2\u6237\u7aef\u5e93\uff0c\u90fd\u662f\u5c01\u88c5\u4e86REST\u8bf7\u6c42\u7684\u5de5\u5177\u3002client-go\u4f5c\u4e3a\u4e00\u4e2a\u5ba2\u6237\u7aef\u5e93\uff0c\u80fd\u591f\u8c03\u7528K8S API\uff0c\u5b9e\u73b0\u5bf9K8S\u96c6\u7fa4\u4e2d\u8d44\u6e90\u5bf9\u8c61\uff08\u5305\u62ecdeployment\u3001service\u3001ingress\u3001replicaSet\u3001pod\u3001namespace\u3001node\u7b49\uff09\u7684\u589e\u5220\u6539\u67e5\u7b49\u64cd\u4f5c\u3002</p> <p>\u8be6\u7ec6\u53ef\u53c2\u8003\uff1aK8s\u4e8c\u5f00\u4e4b client-go \u521d\u63a2</p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#23-k8s-krew","title":"2.3 k8s \u63d2\u4ef6krew","text":"<p>Krew \u662f \u7c7b\u4f3c\u4e8e\u7cfb\u7edf\u7684apt\u3001dnf\u6216\u8005brew\u7684 kubectl\u63d2\u4ef6\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u5229\u7528\u5176\u53ef\u4ee5\u8f7b\u677e\u7684\u5b8c\u6210kubectl \u63d2\u4ef6\u7684\u5168\u4e0a\u9762\u5468\u671f\u7ba1\u7406\uff0c\u5305\u62ec\u641c\u7d22\u3001\u4e0b\u8f7d\u3001\u5378\u8f7d\u7b49\u3002</p> <p>kubectl \u5176\u5de5\u5177\u5df2\u7ecf\u6bd4\u8f83\u5b8c\u5584\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e00\u4e9b\u4e2a\u6027\u5316\u7684\u547d\u4ee4\uff0c\u5176\u5b97\u65e8\u662f\u5e0c\u671b\u5f00\u53d1\u8005\u80fd\u4ee5\u72ec\u7acb\u800c\u7d27\u5f20\u5f62\u5f0f\u53d1\u5e03\u81ea\u5b9a\u4e49\u7684kubectl\u5b50\u547d\u4ee4\uff0c\u63d2\u4ef6\u7684\u5f00\u53d1\u8bed\u8a00\u4e0d\u9650\uff0c\u9700\u8981\u5c06\u6700\u7ec8\u7684\u811a\u6b65\u6216\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u7a0b\u5e8f\u4ee5<code>kubectl-</code> \u7684\u524d\u7f00\u547d\u540d\uff0c\u7136\u540e\u653e\u5230PATH\u4e2d\u5373\u53ef\uff0c\u53ef\u4ee5\u4f7f\u7528<code>kubectl plugin list</code>\u67e5\u770b\u76ee\u524d\u5df2\u7ecf\u5b89\u88c5\u7684\u63d2\u4ef6\u3002</p> <p>\u8be6\u7ec6\u53ef\u53c2\u8003\uff1ak8s \u63d2\u4ef6\u7ba1\u7406\u5de5\u5177\u4e4bkrew\u4f7f\u7528</p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#_3","title":"\u4e09 \u63d2\u4ef6\u89c4\u5212","text":"<ul> <li>\u63d2\u4ef6\u547d\u540d\u4e3a\uff1akubeimg\u3002</li> <li>\u76ee\u524d\u4ec5\u7b80\u5355\u5b9e\u73b0\u4e00\u4e2aimage\u547d\u4ee4\uff0c\u7528\u4e8e\u67e5\u770b\u4e0d\u540c\u8d44\u6e90\u5bf9\u8c61(deployments/daemonsets/statefulsets/jobs/cronjobs)\u7684\u540d\u79f0\uff0c\u548c\u5bf9\u5e94\u5bb9\u5668\u540d\u79f0\uff0c\u955c\u50cf\u540d\u79f0\u3002</li> <li>\u652f\u6301json\u683c\u5f0f\u8f93\u51fa\u3002</li> <li>\u6700\u540e\u5c06\u5176\u4f5c\u4e3akrew\u63d2\u4ef6\u4f7f\u7528\u3002</li> <li>\u53ef\u4ee5\u76f4\u63a5\u6839\u636e\u540d\u79f0\u7a7a\u95f4\u6765\u8fdb\u884c\u67e5\u770b\u5bf9\u5e94\u8d44\u6e90\u3002</li> </ul>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#_4","title":"\u56db \u5b9e\u6218\u5f00\u53d1","text":""},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#41","title":"4.1 \u9879\u76ee\u521d\u59cb\u5316","text":"<ul> <li>\u5b89\u88c5cobra</li> </ul> <pre><code>go get -v github.com/spf13/cobra/cobra\n</code></pre> <ul> <li>\u521d\u59cb\u5316\u9879\u76ee</li> </ul> <pre><code> $ ~/workspace/goworkspace/src/github.com/kaliarch/kubeimg \ue0b0 /Users/xuel/workspace/goworkspace/bin/cobra init --pkg-name kubeimg\nYour Cobra application is ready at\n/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/kubeimg\n$ ~/workspace/goworkspace/src/github.com/kaliarch/kubeimg \ue0b0 ls\nLICENSE cmd     main.go\n$ ~/workspace/goworkspace/src/github.com/kaliarch/kubeimg \ue0b0 tree\n\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 cmd\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 root.go\n\u2514\u2500\u2500 main.go\n\n1 directory, 3 files\n</code></pre> <ul> <li>\u521b\u5efago mod\uff0c\u4e0b\u8f7d\u76f8\u5173\u5305</li> </ul> <pre><code>go mod init kubeimg\n</code></pre>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#42","title":"4.2 \u589e\u52a0\u5b50\u547d\u4ee4","text":"<p>\u589e\u52a0\u4e00\u4e2a\u5b50\u547d\u4ee4image\u3002</p> <pre><code>$ /Users/xuel/workspace/goworkspace/bin/cobra add image\nimage created at /Users/xuel/workspace/goworkspace/src/github.com/kaliarch/kubeimg\n</code></pre>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#43","title":"4.3 \u6dfb\u52a0\u53c2\u6570","text":"<pre><code>// Execute adds all child commands to the root command and sets flags appropriately.\n// This is called by main.main(). It only needs to happen once to the rootCmd.\nfunc Execute() {\n    cobra.CheckErr(rootCmd.Execute())\n}\n\nfunc init() {\n    KubernetesConfigFlags = genericclioptions.NewConfigFlags(true)\n    imageCmd.Flags().BoolP(\"deployments\", \"d\", false, \"show deployments image\")\n    imageCmd.Flags().BoolP(\"daemonsets\", \"e\", false, \"show daemonsets image\")\n    imageCmd.Flags().BoolP(\"statefulsets\", \"f\", false, \"show statefulsets image\")\n    imageCmd.Flags().BoolP(\"jobs\", \"o\", false, \"show jobs image\")\n    imageCmd.Flags().BoolP(\"cronjobs\", \"b\", false, \"show cronjobs image\")\n    imageCmd.Flags().BoolP(\"json\", \"j\", false, \"show json format\")\n    KubernetesConfigFlags.AddFlags(rootCmd.PersistentFlags())\n}\n</code></pre>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#44-image","title":"4.4 \u5b9e\u73b0image\u547d\u4ee4","text":"<pre><code>var imageCmd = &amp;cobra.Command{\n    Use:   \"image\",\n    Short: \"show resource image\",\n    Long:  `show k8s resource image`,\n    RunE:  image,\n}\n\nfunc init() {\n    rootCmd.AddCommand(imageCmd)\n}\n</code></pre>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#45-clientset","title":"4.5 \u521d\u59cb\u5316clientset","text":"<pre><code>// ClientSet k8s clientset\nfunc ClientSet(configFlags *genericclioptions.ConfigFlags) *kubernetes.Clientset {\n    config, err := configFlags.ToRESTConfig()\n    if err != nil {\n        panic(\"kube config load error\")\n    }\n    clientSet, err := kubernetes.NewForConfig(config)\n    if err != nil {\n\n        panic(\"gen kube config error\")\n    }\n    return clientSet\n}\n</code></pre>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#46","title":"4.6 \u5b9e\u73b0\u67e5\u770b\u8d44\u6e90\u5bf9\u8c61","text":"<p>\u5229\u7528\u53cd\u5c04\u5b9e\u73b0\u6839\u636e\u4e0d\u540c\u8d44\u6e90\u7c7b\u578b\u67e5\u770b\u5177\u4f53\u5bf9\u5e94\u8d44\u6e90\u955c\u50cf\u53ca\u955c\u50cf\u540d\u79f0\u529f\u80fd\u3002</p> <pre><code>func image(cmd *cobra.Command, args []string) error {\n\n    clientSet := kube.ClientSet(KubernetesConfigFlags)\n    ns, _ := rootCmd.Flags().GetString(\"namespace\")\n    // \u751f\u547d\u4e00\u4e2a\u5168\u5c40\u8d44\u6e90\u5217\u8868\n    var rList []interface{}\n\n    if flag, _ := cmd.Flags().GetBool(\"deployments\"); flag {\n        deployList, err := clientSet.AppsV1().Deployments(ns).List(context.Background(), v1.ListOptions{})\n        if err != nil {\n            fmt.Printf(\"list deployments error: %s\", err.Error())\n        }\n        rList = append(rList, deployList)\n    }\n  ...\n    deployMapList := make([]map[string]string, 0)\n    for i := 0; i &lt; len(rList); i++ {\n        switch t := rList[i].(type) {\n        case *kv1.DeploymentList:\n            for k := 0; k &lt; len(t.Items); k++ {\n                for j := 0; j &lt; len(t.Items[k].Spec.Template.Spec.Containers); j++ {\n                    deployMap := make(map[string]string)\n                    deployMap[\"NAMESPACE\"] = ns\n                    deployMap[\"TYPE\"] = \"deployment\"\n                    deployMap[\"RESOURCE_NAME\"] = t.Items[k].GetName()\n                    deployMap[\"CONTAINER_NAME\"] = t.Items[k].Spec.Template.Spec.Containers[j].Name\n                    deployMap[\"IMAGE\"] = t.Items[k].Spec.Template.Spec.Containers[j].Image\n                    deployMapList = append(deployMapList, deployMap)\n                }\n            }\n</code></pre>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#46_1","title":"4.6 \u5b9e\u73b0\u8f93\u51fa","text":"<p>\u5229\u7528tabel\u6765\u5bf9\u7ed3\u679c\u8fdb\u884c\u8f93\u51fa</p> <pre><code>func GenTable(mapList []map[string]string) *table.Table {\n    t, err := gotable.Create(title...)\n    if err != nil {\n        fmt.Printf(\"create table error: %s\", err.Error())\n        return nil\n    }\n    t.AddRows(mapList)\n    return t\n}\n</code></pre> <p>\u6700\u7ec8\u9879\u76ee\u7ed3\u6784\uff1a</p> <p></p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#_5","title":"\u4e94 \u6d4b\u8bd5","text":"<p>\u5bf9\u5b8c\u6210\u7684\u63d2\u4ef6\u8fdb\u884c\u6d4b\u8bd5\uff0c\u7f16\u8bd1<code>go build</code>\u751f\u6210kubeimg\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u3002</p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#51","title":"5.1 \u67e5\u770b\u5e2e\u52a9","text":"<ul> <li>\u67e5\u770b\u6240\u6709\u5e2e\u52a9</li> </ul> <p>\u5176\u4e2d\u53ef\u4ee5\u770b\u5230cobra\u5e2e\u6211\u4eec\u81ea\u52a8\u751f\u6210\u4e86help\u548ccompletion\u4e24\u4e2a\u547d\u4ee4\uff0c\u53ef\u4ee5\u5feb\u901f\u5b9e\u73b0table\u8865\u5168\uff0c\u652f\u6301bash/fish/zsh/powershell</p> <pre><code>./kubeimg --help\n</code></pre> <p></p> <p></p> <ul> <li>\u67e5\u770bimage\u547d\u4ee4flags</li> </ul> <pre><code>./kubeimg image --help\n</code></pre> <p></p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#51-deployment","title":"5.1 \u67e5\u770bdeployment\u8d44\u6e90","text":"<p>\u4e0d\u77e5\u5730ing\u540d\u79f0\u540d\u79f0\u7a7a\u95f4\uff0c\u9ed8\u8ba4\u67e5\u770b\u6240\u6709\uff0c\u540d\u79f0\u7a7a\u95f4\u4e0b\u7684\u8d44\u6e90</p> <pre><code>./kubeimg image -d\n</code></pre> <p></p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#52","title":"5.2 \u67e5\u770b\u67d0\u4e2a\u540d\u79f0\u7a7a\u95f4\u4e0b\u8d44\u6e90","text":"<pre><code>./kubeimg image -d -n kube-system\n</code></pre>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#53","title":"5.3 \u67e5\u770b\u6240\u6709\u8d44\u6e90","text":"<p>\u53ef\u4ee5\u770b\u5230imlc-operator-controller-manager \u4e00\u4e2apod\u4e2d\u6709\u4e24\u4e2acontainer\u3002</p> <pre><code>./kubeimg image -b -e -d -o -f\n</code></pre> <p></p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#54-json","title":"5.4 json\u683c\u5f0f\u8f93\u51fa","text":"<pre><code>./kubeimg image -o -j\n</code></pre>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#krew","title":"\u516d \u4f5c\u4e3akrew\u63d2\u4ef6\u4f7f\u7528","text":"<p>\u9700\u8981\u5c06\u6700\u7ec8\u7684\u811a\u6b65\u6216\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u7a0b\u5e8f\u4ee5<code>kubectl-</code> \u7684\u524d\u7f00\u547d\u540d\uff0c\u7136\u540e\u653e\u5230PATH\u4e2d\u5373\u53ef\uff0c\u53ef\u4ee5\u4f7f\u7528<code>kubectl plugin list</code>\u67e5\u770b\u76ee\u524d\u5df2\u7ecf\u5b89\u88c5\u7684\u63d2\u4ef6\u3002</p> <pre><code>$ kubectl plugin list\nThe following compatible plugins are available:=\n/usr/local/bin/kubectl-debug\n  - warning: kubectl-debug overwrites existing command: \"kubectl debug\"\n/usr/local/bin/kubectl-v1.10.11\n/usr/local/bin/kubectl-v1.20.0\n/Users/xuel/.krew/bin/kubectl-df_pv\n/Users/xuel/.krew/bin/kubectl-krew\n\n# \u5c06\u81ea\u5df1\u5f00\u53d1\u7684\u63d2\u4ef6\u91cd\u65b0\u547d\u540d\u4e3akubectl-img\u653e\u5230\u53ef\u6267\u884c\u8def\u57fa\u4e0b\n$ cp kubeimg /Users/xuel/.krew/bin/kubectl-img\n\n$ kubectl plugin list\nThe following compatible plugins are available:=\n/usr/local/bin/kubectl-debug\n  - warning: kubectl-debug overwrites existing command: \"kubectl debug\"\n/usr/local/bin/kubectl-v1.10.11\n/usr/local/bin/kubectl-v1.20.0\n/Users/xuel/.krew/bin/kubectl-df_pv\n/Users/xuel/.krew/bin/kubectl-krew\n/Users/xuel/.krew/bin/kubectl-img\n\n$ cp kubeimg /Users/xuel/.krew/bin/kubectl-img\n</code></pre> <p>\u4e4b\u540e\u5c31\u53ef\u4ee5\u60f3\u4f7f\u7528kubectl\u63d2\u4ef6\u4e00\u6837\u4f7f\u7528\u4e86\u3002</p> <p></p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#_6","title":"\u5176\u4ed6","text":"<p>\u76ee\u524d\u5b9e\u73b0\u7684\u6bd4\u8f83\u7b80\u5355\uff0c\u4ee5\u6b64\u6765\u629b\u7816\u5f15\u7389\u7684\u529f\u80fd\uff0c\u540e\u671f\u53ef\u4ee5\u8fdb\u884c\u66f4\u591a\u529f\u80fd\u6216\u5176\u4ed6\u63d2\u4ef6\u7684\u5f00\u53d1\uff0c\u81ea\u5df1\u52a8\u624b\u4e30\u8863\u8db3\u98df\u3002</p> <p>\u76ee\u524d\u5df2\u5f00\u6e90\u5230github\uff0c\u9879\u76ee\u5730\u5740\uff1akubectl-img\uff0c\u4ee5\u4f9b\u5927\u5bb6\u5b66\u4e60\u4ea4\u6d41\u3002</p>"},{"location":"cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/#_7","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://juejin.cn/post/6969183421381738533</li> <li>https://juejin.cn/post/6962869412785487909</li> <li>https://github.com/spf13/cobra</li> </ul>"},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"5.Client-go\u6e90\u7801\u5206\u6790\u4e4bListerWatcher","text":""},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>kubernetes\u6240\u6709API\u5bf9\u8c61\u90fd\u5b58\u50a8\u5728etcd\u4e2d\uff0c\u5e76\u53ea\u80fd\u901a\u8fc7apiserver\u8bbf\u95ee\u3002\u5982\u679c\u5f88\u591a\u5ba2\u6237\u7aef\u9891\u7e41\u7684\u5217\u4e3e\u5168\u91cf\u5bf9\u8c61\uff08\u6bd4\u5982\u5217\u4e3e\u6240\u6709\u7684Pod\uff09\uff0c\u8fd9\u4f1a\u9020\u6210apiserver\u4e0d\u582a\u91cd\u8d1f\u3002</p> <p>ListerWatcher\u662fLister\u548cWatcher\u7684\u7ed3\u5408\u4f53\uff0cListerWatcher\u8d1f\u8d23\u5217\u4e3e\u5168\u91cf\u5bf9\u8c61\uff0cWatcher\u8d1f\u8d23\u76d1\u89c6\uff08\u672c\u6587\u5c06watch\u7ffb\u8bd1\u4e3a\u76d1\u89c6\uff09\u5bf9\u8c61\u7684\u589e\u91cf\u53d8\u5316\u3002</p> <p>\u901a\u8fc7\u5ba2\u6237\u7aef\u7f13\u5b58\uff0c\u81f3\u5728\u6ca1\u6709\u4efb\u4f55\u72b6\u6001\u53d8\u5316\u7684\u60c5\u51b5\u4e0b\u53ea\u9700\u8981\u8bfb\u53d6\u672c\u5730\u7f13\u5b58\u5373\u53ef\uff0c\u51cf\u5c11\u5bf9API-server\u7684\u538b\u529b\u6548\u7387\u63d0\u5347\u663e\u800c\u6613\u89c1\u3002\u901a\u8fc7\u5217\u4e3e\u5168\u91cf\u5bf9\u8c61\u5b8c\u6210\u672c\u5730\u7f13\u5b58\uff0c\u800c\u76d1\u89c6\u589e\u91cf\u5219\u662f\u4e3a\u4e86\u53ca\u65f6\u7684\u5c06apiserver\u7684\u72b6\u6001\u53d8\u5316\u66f4\u65b0\u5230\u672c\u5730\u7f13\u5b58\u3002\u6240\u4ee5\uff0c\u5728apiserver\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u7edd\u5927\u90e8\u5206\u4f20\u8f93\u7684\u662f\u5bf9\u8c61\u7684\u589e\u91cf\u53d8\u5316\uff0c\u5f53\u7136\u5728\u5f02\u5e38\u7684\u60c5\u51b5\u4e0b\u8fd8\u662f\u8981\u91cd\u65b0\u5217\u4e3e\u4e00\u6b21\u5168\u91cf\u5bf9\u8c61\u3002</p> <p>\u672c\u6587\u503c\u5f97\u5ba2\u6237\u7aef\u672c\u5730\u7f13\u5b58\u5c31\u662fIndexer\uff0cclient-go\u4e0d\u4ec5\u5b9e\u73b0\u4e86\u7f13\u5b58\uff0c\u540c\u65f6\u8fd8\u52a0\u4e86\u7d22\u5f15\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u68c0\u7d22\u6548\u7387\u3002</p>"},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#listerwatcher","title":"\u4e8c ListerWatcher","text":"<p>Kubernetes \u63a7\u5236\u9762 (control plane) \u7684\u6838\u5fc3\u662f API \u670d\u52a1\u5668 (API server)\u3002API \u670d\u52a1\u5668\u8d1f\u8d23\u63d0\u4f9b HTTP API\uff0c\u4ee5\u4f9b\u7528\u6237\uff0c\u96c6\u7fa4\u4e2d\u7684\u4e0d\u540c\u90e8\u5206\u548c\u96c6\u7fa4\u5916\u90e8\u7ec4\u4ef6\u76f8\u4e92\u901a\u4fe1\u3002\u63a7\u5236\u5668\u4e5f\u4e0d\u4f8b\u5916\uff0c\u6240\u6709\u63a7\u5236\u5668\u90fd\u901a\u8fc7 API \u83b7\u53d6\u96c6\u7fa4\u7684\u5f53\u524d\u72b6\u6001\uff0c\u4e5f\u901a\u8fc7 API \u5bf9\u96c6\u7fa4\u72b6\u6001\u8fdb\u884c\u4fee\u6539\u3002</p> <p>list-watch\uff0c\u4f5c\u4e3ak8s\u7cfb\u7edf\u4e2d\u7edf\u4e00\u7684\u5f02\u6b65\u6d88\u606f\u4f20\u9012\u65b9\u5f0f\uff0c\u5bf9\u7cfb\u7edf\u7684\u6027\u80fd\u3001\u6570\u636e\u4e00\u81f4\u6027\u8d77\u5230\u5173\u952e\u6027\u7684\u4f5c\u7528\u3002</p> <p></p> <p>\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cKubernetes \u63d0\u4f9b\u4e86 watch \u673a\u5236\u65b9\u4fbf\u5ba2\u6237\u7aef\u5b9e\u65f6\u83b7\u53d6\u96c6\u7fa4\u72b6\u6001\uff0c\u6709\u4e86\u8fd9\u4e2a\u63a5\u53e3\uff0c\u63a7\u5236\u5668\u624d\u5f97\u4ee5\u65e0\u5ef6\u8fdf\uff08\u51c6\u786e\u5730\u8bf4\u662f\u4f4e\u5ef6\u8fdf\uff09\u5730\u5bf9\u72b6\u6001\u53d8\u66f4\u4f5c\u51fa\u54cd\u5e94\u3002\u8fd9\u91cc\u6307\u7684 \"\u72b6\u6001\u53d8\u66f4\"\uff0c\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684**\u4e8b\u4ef6 (event)**\u3002</p>"},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#21-eventtype","title":"2.1 EventType","text":"<pre><code>// EventType defines the possible types of events.\ntype EventType string\n\nconst (\n    Added    EventType = \"ADDED\"\n    Modified EventType = \"MODIFIED\"\n    Deleted  EventType = \"DELETED\"\n    Bookmark EventType = \"BOOKMARK\"\n    Error    EventType = \"ERROR\"\n)\n</code></pre>"},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#22-listerwatcher","title":"2.2 ListerWatcher\u5b9a\u4e49","text":"<pre><code>// \u590d\u5236\u4ee3\u7801\n// client-go/tools/cache/listwatch.go\n// Lister is any object that knows how to perform an initial list.\ntype Lister interface {\n    // List should return a list type object; the Items field will be extracted, and the\n    // ResourceVersion field will be used to start the watch in the right place.\n    List(options metav1.ListOptions) (runtime.Object, error)\n}\n\n// Watcher is any object that knows how to start a watch on a resource.\ntype Watcher interface {\n    // Watch should begin a watch at the specified version.\n    Watch(options metav1.ListOptions) (watch.Interface, error)\n}\n\n// ListerWatcher is any object that knows how to perform an initial list and start a watch on a resource.\ntype ListerWatcher interface {\n    Lister\n    Watcher\n}\n</code></pre>"},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#23-listwatcher","title":"2.3 \u521b\u5efaListWatcher\u5bf9\u8c61","text":"<pre><code>// NewListWatchFromClient creates a new ListWatch from the specified client, resource, namespace and field selector.\nfunc NewListWatchFromClient(c Getter, resource string, namespace string, fieldSelector fields.Selector) *ListWatch {\n    optionsModifier := func(options *metav1.ListOptions) {\n        options.FieldSelector = fieldSelector.String()\n    }\n    return NewFilteredListWatchFromClient(c, resource, namespace, optionsModifier)\n}\n</code></pre>"},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_2","title":"\u4e09 \u5c0f\u8bd5\u725b\u5200","text":"<pre><code>$ kubectl proxy\n# \u8fdb\u884clistwatch default\u540d\u79f0\u7a7a\u95f4\u4e0b\u7684pods\n$ curl \"127.0.0.1:8001/api/v1/namespaces/default/pods?watch=1\"\n# \u521b\u5efapod\u8fdb\u884c\u89c2\u5bdf\n$ kubectl run nginx --image=nginx\n</code></pre> <pre><code>{\"type\":\"ADDED\",\"object\":{\"kind\":\"Pod\",\"apiVersion\":\"v1\",\"metadata\":{\"name\":\"nginx\",\"namespace\":\"default\",\"uid\":\"8d0548ce-fb67-4b71-93ec-59ad67b429d9\",\"resourceVersion\":\"2925331\",\"creationTimestamp\":\"2022-01-20T07:32:22Z\",\"labels\":{\"run\":\"nginx\"},\"managedFields\":[{\"manager\":\"kubectl-run\",\"operation\":\"Update\",\"apiVersion\":\"v1\",\"time\":\"2022-01-20T07:32:22Z\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:labels\":{\".\":{},\"f:run\":{}}},\"f:spec\":{\"f:containers\":{\"k:{\\\"name\\\":\\\"nginx\\\"}\":{\".\":{},\"f:image\":{},\"f:imagePullPolicy\":{},\"f:name\":{},\"f:resources\":{},\"f:terminationMessagePath\":{},\"f:terminationMessagePolicy\":{}}},\"f:dnsPolicy\":{},\"f:enableServiceLinks\":{},\"f:restartPolicy\":{},\"f:schedulerName\":{},\"f:securityContext\":{},\"f:terminationGracePeriodSeconds\":{}}}}]},\"spec\":{\"volumes\":[{\"name\":\"kube-api-access-nc5v8\",\"projected\":{\"sources\":[{\"serviceAccountToken\":{\"expirationSeconds\":3607,\"path\":\"token\"}},{\"configMap\":{\"name\":\"kube-root-ca.crt\",\"items\":[{\"key\":\"ca.crt\",\"path\":\"ca.crt\"}]}},{\"downwardAPI\":{\"items\":[{\"path\":\"namespace\",\"fieldRef\":{\"apiVersion\":\"v1\",\"fieldPath\":\"metadata.namespace\"}}]}}],\"defaultMode\":420}}],\"containers\":[{\"name\":\"nginx\",\"image\":\"nginx\",\"resources\":{},\"volumeMounts\":[{\"name\":\"kube-api-access-nc5v8\",\"readOnly\":true,\"mountPath\":\"/var/run/secrets/kubernetes.io/serviceaccount\"}],\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"imagePullPolicy\":\"Always\"}],\"restartPolicy\":\"Always\",\"terminationGracePeriodSeconds\":30,\"dnsPolicy\":\"ClusterFirst\",\"serviceAccountName\":\"default\",\"serviceAccount\":\"default\",\"securityContext\":{},\"schedulerName\":\"default-scheduler\",\"tolerations\":[{\"key\":\"node.kubernetes.io/not-ready\",\"operator\":\"Exists\",\"effect\":\"NoExecute\",\"tolerationSeconds\":300},{\"key\":\"node.kubernetes.io/unreachable\",\"operator\":\"Exists\",\"effect\":\"NoExecute\",\"tolerationSeconds\":300}],\"priority\":0,\"enableServiceLinks\":true,\"preemptionPolicy\":\"PreemptLowerPriority\"},\"status\":{\"phase\":\"Pending\",\"qosClass\":\"BestEffort\"}}}\n</code></pre>"},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_3","title":"\u56db \u4ee3\u7801\u5b9e\u73b0","text":"<p>\u7f16\u5199\u4ee3\u7801\u5bf9default\u540d\u79f0\u7a7a\u95f4\u4e0b\u7684configmap\u8fdb\u884clist watch\u3002</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    v1 \"k8s.io/api/core/v1\"\n    \"k8s.io/apimachinery/pkg/api/meta\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    \"k8s.io/apimachinery/pkg/fields\"\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/tools/cache\"\n    \"k8s.io/client-go/tools/clientcmd\"\n    \"k8s.io/client-go/util/homedir\"\n    \"os\"\n    \"os/signal\"\n    \"path/filepath\"\n)\n\nfunc Must(e interface{}) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc InitClientSet() (*kubernetes.Clientset, error) {\n    kubeconfig := filepath.Join(homedir.HomeDir(), \".kube\", \"config\")\n    restConfig, err := clientcmd.BuildConfigFromFlags(\"\", kubeconfig)\n    if err != nil {\n        return nil, err\n    }\n    return kubernetes.NewForConfig(restConfig)\n}\n\nfunc InitListerWatcher(clientSet *kubernetes.Clientset, resource, namespace string, fieldSelector fields.Selector) cache.ListerWatcher {\n    restClient := clientSet.CoreV1().RESTClient()\n    return cache.NewListWatchFromClient(restClient, resource, namespace, fieldSelector)\n}\n\nfunc main() {\n    clientSet, err := InitClientSet()\n    if err != nil {\n        panic(err)\n    }\n\n    // \u4ec0\u4e48\u5e38\u91cf\n    resource := \"configmaps\"\n    namespace := \"default\"\n\n    configMapListerWatcher := InitListerWatcher(clientSet, resource, namespace, fields.Everything())\n\n    // 1. list\u64cd\u4f5c\n    listObj, err := configMapListerWatcher.List(metav1.ListOptions{})\n\n    // meta \u5305\u5c01\u88c5\u4e86\u4e00\u4e9b\u5904\u7406 runtime.Object \u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u5c4f\u853d\u4e86\u53cd\u5c04\u548c\u7c7b\u578b\u8f6c\u6362\u7684\u8fc7\u7a0b\uff0c\n    // \u63d0\u53d6\u51fa\u7684 items \u7c7b\u578b\u4e3a []runtime.Object\n    items, err := meta.ExtractList(listObj)\n    if err != nil {\n        Must(err)\n    }\n    fmt.Println(\"list result:\")\n    for _, item := range items {\n        configmaps, ok := item.(*v1.ConfigMap)\n        if !ok {\n            return\n        }\n        fmt.Printf(\"namespace: %s, resource name:%s\\n\", configmaps.Namespace, configmaps.Name)\n    }\n\n    // 2. watch \u64cd\u4f5c\n    listMetaInterface, err := meta.ListAccessor(listObj)\n    if err != nil {\n        Must(err)\n    }\n    resourceVersion := listMetaInterface.GetResourceVersion()\n\n    watchObj, err := configMapListerWatcher.Watch(metav1.ListOptions{\n        ResourceVersion: resourceVersion,\n    })\n\n    // \u63a5\u6536\u4fe1\u53f7\n    stopCh := make(chan os.Signal)\n    signal.Notify(stopCh, os.Interrupt)\n    fmt.Println(\"Start watching...\")\n    for {\n        select {\n        case &lt;-stopCh:\n            fmt.Println(\"exit\")\n            return\n        case event, ok := &lt;-watchObj.ResultChan():\n            if !ok {\n                fmt.Println(\"Broken channel\")\n                break\n            }\n            configmaps, ok := event.Object.(*v1.ConfigMap)\n            if !ok {\n                return\n            }\n            fmt.Printf(\"eventType: %s, watch obj:%s\\n\", event.Type, configmaps.Name)\n        }\n    }\n}\n</code></pre> <p>\u8fdb\u884c\u521b\u5efaconfigmap\u6d4b\u8bd5</p> <p></p>"},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_4","title":"\u4e94 \u603b\u7ed3","text":"<ul> <li>ListerWatcher\u5c31\u662f\u4e3aSharedIndexInformer\u5217\u4e3e\u5168\u91cf\u5bf9\u8c61\u3001\u76d1\u89c6\u5bf9\u8c61\u589e\u91cf\u53d8\u5316\u8bbe\u8ba1\u7684\u63a5\u53e3\uff0c\u5b9e\u73b0\u5c31\u662fClientset\u7684List\u548cWatch\u51fd\u6570\uff1b</li> <li>SharedIndexInformer\u5229\u7528ListerWatcher\u5b9e\u73b0\u4e86\u672c\u5730\u7f13\u5b58\u4e0eapiserver\u4e4b\u95f4\u7684\u72b6\u6001\u4e00\u81f4\u6027\uff1b</li> <li>\u4e0d\u4ec5\u53ef\u4ee5\u63d0\u5347\u5ba2\u6237\u7aef\u8bbf\u95eeAPI\u5bf9\u8c61\u7684\u6548\u7387\uff0c\u540c\u65f6\u53ef\u4ee5\u5c06\u5bf9\u8c61\u7684\u589e\u91cf\u53d8\u5316\u56de\u8c03\u7ed9\u4f7f\u7528\u8005\uff1b</li> <li>\u4ece\u539f\u7406\u4e0a\u8bb2\uff0c\u53ef\u4ee5\u7528etcd\u7684clientv3.Client\u5b9e\u73b0ListerWatcher\uff0cSharedIndexInformer\u540c\u6b65etcd\u7684\u5bf9\u8c61\uff0c\u8fd9\u6837\u4e00\u4e9b\u7b80\u5355\u7684\u9192\u76ee\u5c31\u53ef\u4ee5\u590d\u7528SharedIndexInformer\u4e86\uff0c\u6bd5\u7adf\u4e0d\u662f\u6240\u6709\u7684\u9879\u76ee\u90fd\u9700\u8981\u4e00\u4e2aapiserver\uff1b</li> </ul>"},{"location":"cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_5","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>https://blog.csdn.net/weixin_42663840/article/details/114379569</li> </ul>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"6.Client-go\u6e90\u7801\u5206\u6790\u4e4bReflector","text":""},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>Reflector \u662f\u4fdd\u8bc1 Informer \u53ef\u9760\u6027\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5728\u4e22\u5931\u4e8b\u4ef6\uff0c\u6536\u5230\u5f02\u5e38\u4e8b\u4ef6\uff0c\u5904\u7406\u4e8b\u4ef6\u5931\u8d25\u7b49\u591a\u79cd\u5f02\u5e38\u60c5\u51b5\u4e0b\u9700\u8981\u8003\u8651\u7684\u7ec6\u8282\u5f88\u591a\u3002\u5355\u72ec\u7684listwatcher\u7f3a\u5c11\u91cd\u65b0\u8fde\u63a5\u548c\u91cd\u65b0\u540c\u6b65\u673a\u5236\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\u3002\u5176\u5bf9\u4e8b\u4ef6\u54cd\u5e94\u662f\u540c\u6b65\u7684\uff0c\u5982\u679c\u6267\u884c\u590d\u6742\u7684\u64cd\u4f5c\u4f1a\u5f15\u8d77\u963b\u585e\uff0c\u9700\u8981\u5f15\u5165\u961f\u5217; </p>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#reflector","title":"\u4e8c Reflector","text":"<p>Reflector\u53ef\u4ee5\u6210\u4e3a\u53cd\u5c04\u5668\uff0c\u5c06etcd\u4e2d\u7684\u6570\u636e\u53cd\u5c04\u5230\u5b58\u50a8\uff08DeltaFIFO\uff09\u4e2d\u3002Reflector\u901a\u8fc7\u5176\u5185\u90e8\u7684List\u64cd\u4f5c\u83b7\u53d6\u6240\u6709\u8d44\u6e90\u5bf9\u8c61\u6570\u636e\uff0c\u4fdd\u5b58\u5230\u672c\u5730\u5b58\u50a8\uff0c\u4e4b\u540eWatch\u76d1\u89c6\u8d44\u6e90\u53d8\u5316\uff0c\u89e6\u53d1\u5bf9\u5e94\u4e8b\u4ef6\u5904\u7406\uff0c\u4f8b\u5982Add\u3001Update\u3001Delete\u7b49\u3002</p> <p>Reflector \u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u4f4d\u4e8e <code>staging/src/k8s.io/client-go/tools/cache/reflector.go</code> \u4e0b\u9762\uff1a</p> <pre><code>// k8s.io/client-go/tools/cache/reflector.go\n\ntype Reflector struct {\n    // name \u6807\u8bc6\u8fd9\u4e2a\u53cd\u5c04\u5668\u7684\u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3a \u6587\u4ef6:\u884c\u6570\uff08\u6bd4\u5982reflector.go:125\uff09\n  // \u9ed8\u8ba4\u540d\u5b57\u901a\u8fc7 k8s.io/apimachinery/pkg/util/naming/from_stack.go \u4e0b\u9762\u7684 GetNameFromCallsite \u51fd\u6570\u751f\u6210\n    name string\n\n  // \u671f\u671b\u653e\u5230 Store \u4e2d\u7684\u7c7b\u578b\u540d\u79f0\uff0c\u5982\u679c\u63d0\u4f9b\uff0c\u5219\u662f expectedGVK \u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\n  // \u5426\u5219\u5c31\u662f expectedType \u7684\u5b57\u7b26\u4e32\uff0c\u5b83\u4ec5\u4ec5\u7528\u4e8e\u663e\u793a\uff0c\u4e0d\u7528\u4e8e\u89e3\u6790\u6216\u8005\u6bd4\u8f83\u3002\n    expectedTypeName string\n    // An example object of the type we expect to place in the store.\n    // Only the type needs to be right, except that when that is\n    // `unstructured.Unstructured` the object's `\"apiVersion\"` and\n    // `\"kind\"` must also be right.\n  // \u653e\u5230 Store \u4e2d\u7684\u5bf9\u8c61\u7c7b\u578b\n    expectedType reflect.Type\n    // \u5982\u679c\u662f\u975e\u7ed3\u6784\u5316\u7684\uff0c\u671f\u671b\u653e\u5728 Sotre \u4e2d\u7684\u5bf9\u8c61\u7684 GVK\n    expectedGVK *schema.GroupVersionKind\n    // \u4e0e watch \u6e90\u540c\u6b65\u7684\u76ee\u6807 Store\n    store Store\n    // \u7528\u6765\u6267\u884c lists \u548c watches \u64cd\u4f5c\u7684 listerWatcher \u63a5\u53e3\uff08\u6700\u91cd\u8981\u7684\uff09\n    listerWatcher ListerWatcher\n\n    // backoff manages backoff of ListWatch\n    backoffManager wait.BackoffManager\n\n    resyncPeriod time.Duration\n    // ShouldResync \u4f1a\u5468\u671f\u6027\u7684\u88ab\u8c03\u7528\uff0c\u5f53\u8fd4\u56de true \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8c03\u7528 Store \u7684 Resync \u64cd\u4f5c\n    ShouldResync func() bool\n    // clock allows tests to manipulate time\n    clock clock.Clock\n    // paginatedResult defines whether pagination should be forced for list calls.\n    // It is set based on the result of the initial list call.\n    paginatedResult bool\n    // Kubernetes \u8d44\u6e90\u5728 APIServer \u4e2d\u90fd\u662f\u6709\u7248\u672c\u7684\uff0c\u5bf9\u8c61\u7684\u4efb\u4f55\u4fee\u6539(\u6dfb\u52a0\u3001\u5220\u9664\u3001\u66f4\u65b0)\u90fd\u4f1a\u9020\u6210\u8d44\u6e90\u7248\u672c\u66f4\u65b0\uff0clastSyncResourceVersion \u5c31\u662f\u6307\u7684\u8fd9\u4e2a\u7248\u672c\n    lastSyncResourceVersion string\n    // \u5982\u679c\u4e4b\u524d\u7684 list \u6216 watch \u5e26\u6709 lastSyncResourceVersion \u7684\u8bf7\u6c42\u4e2d\u662f\u4e00\u4e2a HTTP 410\uff08Gone\uff09\u7684\u5931\u8d25\u8bf7\u6c42\uff0c\u5219 isLastSyncResourceVersionGone \u4e3a true\n    isLastSyncResourceVersionGone bool\n    // lastSyncResourceVersionMutex \u7528\u4e8e\u4fdd\u8bc1\u5bf9 lastSyncResourceVersion \u7684\u8bfb/\u5199\u8bbf\u95ee\u3002\n    lastSyncResourceVersionMutex sync.RWMutex\n    // WatchListPageSize is the requested chunk size of initial and resync watch lists.\n    // If unset, for consistent reads (RV=\"\") or reads that opt-into arbitrarily old data\n    // (RV=\"0\") it will default to pager.PageSize, for the rest (RV != \"\" &amp;&amp; RV != \"0\")\n    // it will turn off pagination to allow serving them from watch cache.\n    // NOTE: It should be used carefully as paginated lists are always served directly from\n    // etcd, which is significantly less efficient and may lead to serious performance and\n    // scalability problems.\n    WatchListPageSize int64\n}\n\n// NewReflector \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u53cd\u5c04\u5668\u5bf9\u8c61\uff0c\u5c06\u4f7f\u7ed9\u5b9a\u7684 Store \u4fdd\u6301\u4e0e\u670d\u52a1\u5668\u4e2d\u6307\u5b9a\u7684\u8d44\u6e90\u5bf9\u8c61\u7684\u5185\u5bb9\u540c\u6b65\u3002\n// \u53cd\u5c04\u5668\u53ea\u628a\u5177\u6709 expectedType \u7c7b\u578b\u7684\u5bf9\u8c61\u653e\u5230 Store \u4e2d\uff0c\u9664\u975e expectedType \u662f nil\u3002\n// \u5982\u679c resyncPeriod \u662f\u975e0\uff0c\u90a3\u4e48\u53cd\u5c04\u5668\u4f1a\u5468\u671f\u6027\u5730\u68c0\u67e5 ShouldResync \u51fd\u6570\u6765\u51b3\u5b9a\u662f\u5426\u8c03\u7528 Store \u7684 Resync \u64cd\u4f5c\n// `ShouldResync==nil` \u610f\u5473\u7740\u603b\u662f\u8981\u6267\u884c Resync \u64cd\u4f5c\u3002\n// \u8fd9\u4f7f\u5f97\u4f60\u53ef\u4ee5\u4f7f\u7528\u53cd\u5c04\u5668\u5468\u671f\u6027\u5730\u5904\u7406\u6240\u6709\u7684\u5168\u91cf\u548c\u589e\u91cf\u7684\u5bf9\u8c61\u3002\nfunc NewReflector(lw ListerWatcher, expectedType interface{}, store Store, resyncPeriod time.Duration) *Reflector {\n  // \u9ed8\u8ba4\u7684\u53cd\u5c04\u5668\u540d\u79f0\u4e3a file:line\n    return NewNamedReflector(naming.GetNameFromCallsite(internalPackages...), lw, expectedType, store, resyncPeriod)\n}\n\n// NewNamedReflector \u4e0e NewReflector \u4e00\u6837\uff0c\u53ea\u662f\u6307\u5b9a\u4e86\u4e00\u4e2a name \u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\nfunc NewNamedReflector(name string, lw ListerWatcher, expectedType interface{}, store Store, resyncPeriod time.Duration) *Reflector {\n    realClock := &amp;clock.RealClock{}\n    r := &amp;Reflector{\n        name:          name,\n        listerWatcher: lw,\n        store:         store,\n        backoffManager: wait.NewExponentialBackoffManager(800*time.Millisecond, 30*time.Second, 2*time.Minute, 2.0, 1.0, realClock),\n        resyncPeriod:   resyncPeriod,\n        clock:          realClock,\n    }\n    r.setExpectedType(expectedType)\n    return r\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_2","title":"\u4e09 \u6d41\u7a0b","text":"<ul> <li> <p>Reflector.Run()\u8c03\u7528ListAndWatch(), \u542f\u52a8\u4e00\u4e2a\u5b50\u534f\u7a0b\uff08goroutine\uff09\u6267\u884cList\uff0c\u4e3b\u534f\u7a0b\u963b\u585e\u7b49\u5f85List\u6267\u884c\u5b8c\u6210\u3002</p> </li> <li> <p>Meta.ExtractList(list)\u628aList\u7ed3\u679c\u8f6c\u5316\u6210runtime.Object\u6570\u7ec4\u3002</p> </li> <li> <p>r.syncWith(items, resourceVersion)\u5199\u5165DeltaFIFO\uff0c\u5168\u91cf\u540c\u6b65\u5230Indexer\u3002</p> </li> <li> <p>r.resyncChan()\u4e5f\u662f\u5728\u4e00\u4e2a\u5b50\u534f\u7a0b\u91cc\u6267\u884c\u3002</p> </li> <li> <p>\u5faa\u73af\u6267\u884cr.ListerWatcher.Watch(optiopns)\u3002</p> </li> <li> <p>r.WatchHandler\u589e\u91cf\u540c\u6b65runtime.Object\u5230indexer\u3002</p> </li> <li> <p>List\u53ea\u505a\u4e00\u6b21\u5168\u91cf\u540c\u6b65\uff0cwatch\u6301\u7eed\u505a\u589e\u91cf\u540c\u6b65\u3002</p> </li> </ul>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#reflector_1","title":"\u56db Reflector\u5173\u952e\u65b9\u6cd5","text":""},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#41","title":"4.1 \u6784\u9020\u65b9\u6cd5","text":"<pre><code>// NewReflector \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u53cd\u5c04\u5668\u5bf9\u8c61\uff0c\u5c06\u4f7f\u7ed9\u5b9a\u7684 Store \u4fdd\u6301\u4e0e\u670d\u52a1\u5668\u4e2d\u6307\u5b9a\u7684\u8d44\u6e90\u5bf9\u8c61\u7684\u5185\u5bb9\u540c\u6b65\u3002\n// \u53cd\u5c04\u5668\u53ea\u628a\u5177\u6709 expectedType \u7c7b\u578b\u7684\u5bf9\u8c61\u653e\u5230 Store \u4e2d\uff0c\u9664\u975e expectedType \u662f nil\u3002\n// \u5982\u679c resyncPeriod \u662f\u975e0\uff0c\u90a3\u4e48\u53cd\u5c04\u5668\u4f1a\u5468\u671f\u6027\u5730\u68c0\u67e5 ShouldResync \u51fd\u6570\u6765\u51b3\u5b9a\u662f\u5426\u8c03\u7528 Store \u7684 Resync \u64cd\u4f5c\n// `ShouldResync==nil` \u610f\u5473\u7740\u603b\u662f\u8981\u6267\u884c Resync \u64cd\u4f5c\u3002\n// \u8fd9\u4f7f\u5f97\u4f60\u53ef\u4ee5\u4f7f\u7528\u53cd\u5c04\u5668\u5468\u671f\u6027\u5730\u5904\u7406\u6240\u6709\u7684\u5168\u91cf\u548c\u589e\u91cf\u7684\u5bf9\u8c61\u3002\nfunc NewReflector(lw ListerWatcher, expectedType interface{}, store Store, resyncPeriod time.Duration) *Reflector {\n  // \u9ed8\u8ba4\u7684\u53cd\u5c04\u5668\u540d\u79f0\u4e3a file:line\n    return NewNamedReflector(naming.GetNameFromCallsite(internalPackages...), lw, expectedType, store, resyncPeriod)\n}\n\n// NewNamedReflector \u4e0e NewReflector \u4e00\u6837\uff0c\u53ea\u662f\u6307\u5b9a\u4e86\u4e00\u4e2a name \u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\nfunc NewNamedReflector(name string, lw ListerWatcher, expectedType interface{}, store Store, resyncPeriod time.Duration) *Reflector {\n    realClock := &amp;clock.RealClock{}\n    r := &amp;Reflector{\n        name:          name,\n        listerWatcher: lw,\n        store:         store,\n        backoffManager: wait.NewExponentialBackoffManager(800*time.Millisecond, 30*time.Second, 2*time.Minute, 2.0, 1.0, realClock),\n        resyncPeriod:   resyncPeriod,\n        clock:          realClock,\n    }\n    r.setExpectedType(expectedType)\n    return r\n}\n\n//\u65b0\u5efaIndexer\u548creflector\nfunc NewNamespaceKeyedIndexerAndReflector(lw ListerWatcher, expectedType interface{}, resyncPeriod time.Duration) (indexer Indexer, reflector *Reflector) {\n    indexer = NewIndexer(MetaNamespaceKeyFunc, Indexers{NamespaceIndex: MetaNamespaceIndexFunc})\n    reflector = NewReflector(lw, expectedType, indexer, resyncPeriod)\n    return indexer, reflector\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#42-run","title":"4.2 Run\u65b9\u6cd5","text":"<pre><code>// Run \u91cd\u590d\u4f7f\u7528\u53cd\u5c04\u5668\u7684 ListAndWatch \u6765\u83b7\u53d6\u6240\u6709\u5bf9\u8c61\u548c\u540e\u7eed\u589e\u91cf\u3002\u5f53 stopCh \u5173\u95ed\u65f6\uff0c\u8fd0\u884c\u5c06\u9000\u51fa\nfunc (r *Reflector) Run(stopCh &lt;-chan struct{}) {\n    klog.V(2).Infof(\"Starting reflector %s (%s) from %s\", r.expectedTypeName, r.resyncPeriod, r.name)\n    wait.BackoffUntil(func() {\n        if err := r.ListAndWatch(stopCh); err != nil {\n            r.watchErrorHandler(r, err)\n        }\n    }, r.backoffManager, true, stopCh)\n    klog.V(2).Infof(\"Stopping reflector %s (%s) from %s\", r.expectedTypeName, r.resyncPeriod, r.name)\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#43-listwatch","title":"4.3 ListWatch","text":"<ul> <li> <p>List\u90e8\u5206\u903b\u8f91\uff1a\u8bbe\u7f6e\u5206\u9875\u53c2\u6570\uff1b\u6267\u884clist\u65b9\u6cd5\uff1b\u5c06list\u7ed3\u679c\u540c\u6b65\u8fdbDeltaFIFO\u961f\u5217\u4e2d\uff0c\u5176\u5b9e\u662f\u8c03\u7528store\u4e2d\u7684Replace\u65b9\u6cd5\u3002</p> </li> <li> <p>\u5b9a\u65f6\u540c\u6b65\uff1a\u5b9a\u65f6\u540c\u6b65\u4ee5\u534f\u7a0b\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u4f7f\u7528\u5b9a\u65f6\u5668\u5b9e\u73b0\u5b9a\u671f\u540c\u6b65\uff0cStore\u4e2d\u7684Resync\u64cd\u4f5c\u3002</p> </li> <li> <p>Watch\u90e8\u5206\u903b\u8f91\uff1a\u5728for\u5faa\u73af\u91cc\uff1b\u6267\u884cwatch\u51fd\u6570\u83b7\u53d6resultchan\uff1b\u76d1\u542cresultchan\u4e2d\u6570\u636e\u5e76\u5904\u7406\uff1b</p> </li> </ul> <pre><code>// ListAndWatch \u51fd\u6570\u9996\u5148\u5217\u51fa\u6240\u6709\u7684\u5bf9\u8c61\uff0c\u5e76\u5728\u8c03\u7528\u7684\u65f6\u5019\u83b7\u5f97\u8d44\u6e90\u7248\u672c\uff0c\u7136\u540e\u4f7f\u7528\u8be5\u8d44\u6e90\u7248\u672c\u6765\u8fdb\u884c watch \u64cd\u4f5c\u3002\n// \u5982\u679c ListAndWatch \u6ca1\u6709\u521d\u59cb\u5316 watch \u6210\u529f\u5c31\u4f1a\u8fd4\u56de\u9519\u8bef\u3002\nfunc (r *Reflector) ListAndWatch(stopCh &lt;-chan struct{}) error {\n    klog.V(3).Infof(\"Listing and watching %v from %s\", r.expectedTypeName, r.name)\n    var resourceVersion string\n\n    options := metav1.ListOptions{ResourceVersion: r.relistResourceVersion()}\n\n  // 1.List\u90e8\u5206\u903b\u8f91\uff1a\u8bbe\u7f6e\u5206\u9875\u53c2\u6570\uff1b\u6267\u884clist\u65b9\u6cd5\uff1b\u5c06list\u7ed3\u679c\u540c\u6b65\u8fdbDeltaFIFO\u961f\u5217\u4e2d\uff1b\n    if err := func() error {\n        initTrace := trace.New(\"Reflector ListAndWatch\", trace.Field{\"name\", r.name})\n        defer initTrace.LogIfLong(10 * time.Second)\n        var list runtime.Object\n        var paginatedResult bool\n        var err error\n        listCh := make(chan struct{}, 1)\n        panicCh := make(chan interface{}, 1)\n        go func() {\n            defer func() {\n                if r := recover(); r != nil {\n                    panicCh &lt;- r\n                }\n            }()\n            // Attempt to gather list in chunks, if supported by listerWatcher, if not, the first\n            // list request will return the full response.\n            pager := pager.New(pager.SimplePageFunc(func(opts metav1.ListOptions) (runtime.Object, error) {\n                return r.listerWatcher.List(opts)\n            }))\n            switch {\n            case r.WatchListPageSize != 0:\n                pager.PageSize = r.WatchListPageSize\n            case r.paginatedResult:\n                // We got a paginated result initially. Assume this resource and server honor\n                // paging requests (i.e. watch cache is probably disabled) and leave the default\n                // pager size set.\n            case options.ResourceVersion != \"\" &amp;&amp; options.ResourceVersion != \"0\":\n                // User didn't explicitly request pagination.\n                //\n                // With ResourceVersion != \"\", we have a possibility to list from watch cache,\n                // but we do that (for ResourceVersion != \"0\") only if Limit is unset.\n                // To avoid thundering herd on etcd (e.g. on master upgrades), we explicitly\n                // switch off pagination to force listing from watch cache (if enabled).\n                // With the existing semantic of RV (result is at least as fresh as provided RV),\n                // this is correct and doesn't lead to going back in time.\n                //\n                // We also don't turn off pagination for ResourceVersion=\"0\", since watch cache\n                // is ignoring Limit in that case anyway, and if watch cache is not enabled\n                // we don't introduce regression.\n                pager.PageSize = 0\n            }\n\n            list, paginatedResult, err = pager.List(context.Background(), options)\n            if isExpiredError(err) || isTooLargeResourceVersionError(err) {\n                r.setIsLastSyncResourceVersionUnavailable(true)\n                // Retry immediately if the resource version used to list is unavailable.\n                // The pager already falls back to full list if paginated list calls fail due to an \"Expired\" error on\n                // continuation pages, but the pager might not be enabled, the full list might fail because the\n                // resource version it is listing at is expired or the cache may not yet be synced to the provided\n                // resource version. So we need to fallback to resourceVersion=\"\" in all to recover and ensure\n                // the reflector makes forward progress.\n                list, paginatedResult, err = pager.List(context.Background(), metav1.ListOptions{ResourceVersion: r.relistResourceVersion()})\n            }\n            close(listCh)\n        }()\n        select {\n        case &lt;-stopCh:\n            return nil\n        case r := &lt;-panicCh:\n            panic(r)\n        case &lt;-listCh:\n        }\n        if err != nil {\n            return fmt.Errorf(\"failed to list %v: %v\", r.expectedTypeName, err)\n        }\n\n        // We check if the list was paginated and if so set the paginatedResult based on that.\n        // However, we want to do that only for the initial list (which is the only case\n        // when we set ResourceVersion=\"0\"). The reasoning behind it is that later, in some\n        // situations we may force listing directly from etcd (by setting ResourceVersion=\"\")\n        // which will return paginated result, even if watch cache is enabled. However, in\n        // that case, we still want to prefer sending requests to watch cache if possible.\n        //\n        // Paginated result returned for request with ResourceVersion=\"0\" mean that watch\n        // cache is disabled and there are a lot of objects of a given type. In such case,\n        // there is no need to prefer listing from watch cache.\n        if options.ResourceVersion == \"0\" &amp;&amp; paginatedResult {\n            r.paginatedResult = true\n        }\n\n        r.setIsLastSyncResourceVersionUnavailable(false) // list was successful\n        initTrace.Step(\"Objects listed\")\n    // \n        listMetaInterface, err := meta.ListAccessor(list)\n        if err != nil {\n            return fmt.Errorf(\"unable to understand list result %#v: %v\", list, err)\n        }\n    // \u83b7\u53d6\u8d44\u6e90\u7248\u672c\u53f7\n        resourceVersion = listMetaInterface.GetResourceVersion()\n        initTrace.Step(\"Resource version extracted\")\n    // \u5c06\u8d44\u6e90\u5bf9\u8c61\u8f6c\u6362\u4e3a\u8d44\u6e90\u5217\u8868\uff0c\u8bb2runtime.Object \u5bf9\u8c61\u8f6c\u6362\u4e3a[]runtime.Object\u5bf9\u8c61\n        items, err := meta.ExtractList(list)\n        if err != nil {\n            return fmt.Errorf(\"unable to understand list result %#v (%v)\", list, err)\n        }\n        initTrace.Step(\"Objects extracted\")\n    // \u5c06\u8d44\u6e90\u5bf9\u8c61\u5217\u8868\u4e2d\u7684\u8d44\u6e90\u548c\u7248\u672c\u53f7\u5b58\u50a8\u5728store\u4e2d\n        if err := r.syncWith(items, resourceVersion); err != nil {\n            return fmt.Errorf(\"unable to sync list result: %v\", err)\n        }\n        initTrace.Step(\"SyncWith done\")\n        r.setLastSyncResourceVersion(resourceVersion)\n        initTrace.Step(\"Resource version updated\")\n        return nil\n    }(); err != nil {\n        return err\n    }\n\n  // 2.\u5b9a\u65f6\u540c\u6b65\uff1a\u5b9a\u65f6\u540c\u6b65\u4ee5\u534f\u7a0b\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u4f7f\u7528\u5b9a\u65f6\u5668\u5b9e\u73b0\u5b9a\u671f\u540c\u6b65\n    resyncerrc := make(chan error, 1)\n    cancelCh := make(chan struct{})\n    defer close(cancelCh)\n    go func() {\n        resyncCh, cleanup := r.resyncChan()\n        defer func() {\n            cleanup() // Call the last one written into cleanup\n        }()\n        for {\n            select {\n            case &lt;-resyncCh:\n            case &lt;-stopCh:\n                return\n            case &lt;-cancelCh:\n                return\n            }\n      // \u5982\u679cShouldResync \u4e3anil\u6216\u8005\u8c03\u7528\u8fd4\u56detrue\uff0c\u5219\u6267\u884cStore\u4e2d\u7684Resync\u64cd\u4f5c\n            if r.ShouldResync == nil || r.ShouldResync() {\n                klog.V(4).Infof(\"%s: forcing resync\", r.name)\n        // \u5c06indexer\u7684\u6570\u636e\u548cdeltafifo\u8fdb\u884c\u540c\u6b65\n                if err := r.store.Resync(); err != nil {\n                    resyncerrc &lt;- err\n                    return\n                }\n            }\n            cleanup()\n            resyncCh, cleanup = r.resyncChan()\n        }\n    }()\n\n  // 3.\u5728for\u5faa\u73af\u91cc\uff1b\u6267\u884cwatch\u51fd\u6570\u83b7\u53d6resultchan\uff1b\u76d1\u542cresultchan\u4e2d\u6570\u636e\u5e76\u5904\u7406\uff1b\n    for {\n        // give the stopCh a chance to stop the loop, even in case of continue statements further down on errors\n        select {\n        case &lt;-stopCh:\n            return nil\n        default:\n        }\n\n        timeoutSeconds := int64(minWatchTimeout.Seconds() * (rand.Float64() + 1.0))\n        options = metav1.ListOptions{\n            ResourceVersion: resourceVersion,\n            // We want to avoid situations of hanging watchers. Stop any wachers that do not\n            // receive any events within the timeout window.\n            TimeoutSeconds: &amp;timeoutSeconds,\n            // To reduce load on kube-apiserver on watch restarts, you may enable watch bookmarks.\n            // Reflector doesn't assume bookmarks are returned at all (if the server do not support\n            // watch bookmarks, it will ignore this field).\n            AllowWatchBookmarks: true,\n        }\n\n        // start the clock before sending the request, since some proxies won't flush headers until after the first watch event is sent\n        start := r.clock.Now()\n        w, err := r.listerWatcher.Watch(options)\n        if err != nil {\n            // If this is \"connection refused\" error, it means that most likely apiserver is not responsive.\n            // It doesn't make sense to re-list all objects because most likely we will be able to restart\n            // watch where we ended.\n            // If that's the case begin exponentially backing off and resend watch request.\n            if utilnet.IsConnectionRefused(err) {\n                &lt;-r.initConnBackoffManager.Backoff().C()\n                continue\n            }\n            return err\n        }\n\n        if err := r.watchHandler(start, w, &amp;resourceVersion, resyncerrc, stopCh); err != nil {\n            if err != errorStopRequested {\n                switch {\n                case isExpiredError(err):\n                    // Don't set LastSyncResourceVersionUnavailable - LIST call with ResourceVersion=RV already\n                    // has a semantic that it returns data at least as fresh as provided RV.\n                    // So first try to LIST with setting RV to resource version of last observed object.\n                    klog.V(4).Infof(\"%s: watch of %v closed with: %v\", r.name, r.expectedTypeName, err)\n                default:\n                    klog.Warningf(\"%s: watch of %v ended with: %v\", r.name, r.expectedTypeName, err)\n                }\n            }\n            return nil\n        }\n    }\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#44-lastsyncresourceversion","title":"4.4 LastSyncResourceVersion","text":"<p>\u83b7\u53d6\u4e0a\u4e00\u6b21\u540c\u6b65\u7684\u8d44\u6e90\u7248\u672c</p> <pre><code>func (r *Reflector) LastSyncResourceVersion() string {\n    r.lastSyncResourceVersionMutex.RLock()\n    defer r.lastSyncResourceVersionMutex.RUnlock()\n    return r.lastSyncResourceVersion\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#45-resyncchan","title":"4.5 resyncChan","text":"<p>\u8fd4\u56de\u4e00\u4e2a\u5b9a\u65f6\u901a\u9053\u548c\u6e05\u7406\u51fd\u6570\uff0c\u6e05\u7406\u51fd\u6570\u5c31\u662f\u505c\u6b62\u8ba1\u65f6\u5668\u3002\u8fd9\u8fb9\u7684\u5b9a\u65f6\u91cd\u65b0\u540c\u6b65\u662f\u4f7f\u7528\u5b9a\u65f6\u5668\u5b9e\u73b0\u7684\u3002</p> <pre><code>func (r *Reflector) resyncChan() (&lt;-chan time.Time, func() bool) {\n    if r.resyncPeriod == 0 {\n        return neverExitWatch, func() bool { return false }\n    }\n    // The cleanup function is required: imagine the scenario where watches\n    // always fail so we end up listing frequently. Then, if we don't\n    // manually stop the timer, we could end up with many timers active\n    // concurrently.\n    t := r.clock.NewTimer(r.resyncPeriod)\n    return t.C(), t.Stop\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#46-syncwith","title":"4.6 syncWith","text":"<p>\u5c06\u4eceapiserver list\u7684\u8d44\u6e90\u5bf9\u8c61\u7ed3\u679c\u540c\u6b65\u8fdbDeltaFIFO\u961f\u5217\u4e2d\uff0c\u8c03\u7528\u961f\u5217\u7684Replace\u65b9\u6cd5\u5b9e\u73b0\u3002</p> <pre><code>func (r *Reflector) syncWith(items []runtime.Object, resourceVersion string) error {\n    found := make([]interface{}, 0, len(items))\n    for _, item := range items {\n        found = append(found, item)\n    }\n    return r.store.Replace(found, resourceVersion)\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#47-watchhandler","title":"4.7 watchHandler","text":"<p>watch\u7684\u5904\u7406\uff1a\u63a5\u6536watch\u7684\u63a5\u53e3\u4f5c\u4e3a\u53c2\u6570\uff0cwatch\u63a5\u53e3\u5bf9\u5916\u65b9\u6cd5\u662fStop\u548cResultchan,\u524d\u8005\u5173\u95ed\u7ed3\u679c\u901a\u9053\uff0c\u540e\u8005\u83b7\u53d6\u901a\u9053\u3002</p> <pre><code>func (r *Reflector) watchHandler(start time.Time, w watch.Interface, resourceVersion *string, errc chan error, stopCh &lt;-chan struct{}) error {\n    eventCount := 0\n\n    // Stopping the watcher should be idempotent and if we return from this function there's no way\n    // we're coming back in with the same watch interface.\n    defer w.Stop()\n\nloop:\n    for {\n        select {\n        case &lt;-stopCh:\n            return errorStopRequested\n        case err := &lt;-errc:\n            return err\n        case event, ok := &lt;-w.ResultChan():\n            if !ok {\n                break loop\n            }\n            if event.Type == watch.Error {\n                return apierrors.FromObject(event.Object)\n            }\n            if r.expectedType != nil {\n                if e, a := r.expectedType, reflect.TypeOf(event.Object); e != a {\n                    utilruntime.HandleError(fmt.Errorf(\"%s: expected type %v, but watch event object had type %v\", r.name, e, a))\n                    continue\n                }\n            }\n      // \u5224\u65ad\u671f\u5f85\u7684\u7c7b\u578b\u548c\u76d1\u542c\u5230\u7684\u4e8b\u4ef6\u7c7b\u578b\u662f\u5426\u4e00\u81f4\n            if r.expectedGVK != nil {\n                if e, a := *r.expectedGVK, event.Object.GetObjectKind().GroupVersionKind(); e != a {\n                    utilruntime.HandleError(fmt.Errorf(\"%s: expected gvk %v, but watch event object had gvk %v\", r.name, e, a))\n                    continue\n                }\n            }\n      // \u83b7\u53d6\u4e8b\u4ef6\u5bf9\u8c61\n            meta, err := meta.Accessor(event.Object)\n            if err != nil {\n                utilruntime.HandleError(fmt.Errorf(\"%s: unable to understand watch event %#v\", r.name, event))\n                continue\n            }\n            newResourceVersion := meta.GetResourceVersion()\n      // \u5bf9\u4e8b\u4ef6\u7c7b\u578b\u8fdb\u884c\u5224\u65ad\uff0c\u5e76\u8fdb\u884c\u5bf9\u5e94\u64cd\u4f5c\n            switch event.Type {\n            case watch.Added:\n                err := r.store.Add(event.Object)\n                if err != nil {\n                    utilruntime.HandleError(fmt.Errorf(\"%s: unable to add watch event object (%#v) to store: %v\", r.name, event.Object, err))\n                }\n            case watch.Modified:\n                err := r.store.Update(event.Object)\n                if err != nil {\n                    utilruntime.HandleError(fmt.Errorf(\"%s: unable to update watch event object (%#v) to store: %v\", r.name, event.Object, err))\n                }\n            case watch.Deleted:\n                // TODO: Will any consumers need access to the \"last known\n                // state\", which is passed in event.Object? If so, may need\n                // to change this.\n                err := r.store.Delete(event.Object)\n                if err != nil {\n                    utilruntime.HandleError(fmt.Errorf(\"%s: unable to delete watch event object (%#v) from store: %v\", r.name, event.Object, err))\n                }\n            case watch.Bookmark:\n        // \u8868\u793a\u76d1\u542c\u5df2\u5728\u6b64\u5904\u540c\u6b65\uff0c\u53ea\u9700\u66f4\u65b0\n                // A `Bookmark` means watch has synced here, just update the resourceVersion\n            default:\n                utilruntime.HandleError(fmt.Errorf(\"%s: unable to understand watch event %#v\", r.name, event))\n            }\n            *resourceVersion = newResourceVersion\n            r.setLastSyncResourceVersion(newResourceVersion)\n            if rvu, ok := r.store.(ResourceVersionUpdater); ok {\n                rvu.UpdateResourceVersion(newResourceVersion)\n            }\n            eventCount++\n        }\n    }\n\n    watchDuration := r.clock.Since(start)\n    if watchDuration &lt; 1*time.Second &amp;&amp; eventCount == 0 {\n        return fmt.Errorf(\"very short watch: %s: Unexpected watch close - watch lasted less than a second and no items received\", r.name)\n    }\n    klog.V(4).Infof(\"%s: Watch close - %v total %v items received\", r.name, r.expectedTypeName, eventCount)\n    return nil\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#48-relistresourceversion","title":"4.8 relistResourceVersion","text":"<p><code>relistResourceVersion</code> \u51fd\u6570\u83b7\u5f97\u53cd\u5c04\u5668 relist \u7684\u8d44\u6e90\u7248\u672c\uff0c\u5982\u679c\u8d44\u6e90\u7248\u672c\u975e 0\uff0c\u5219\u8868\u793a\u6839\u636e\u8d44\u6e90\u7248\u672c\u53f7\u7ee7\u7eed\u83b7\u53d6\uff0c\u5f53\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u9047\u5230\u7f51\u7edc\u6545\u969c\u6216\u8005\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\u4e2d\u65ad\uff0c\u4e0b\u6b21\u518d\u8fde\u63a5\u65f6\uff0c\u4f1a\u6839\u636e\u8d44\u6e90\u7248\u672c\u53f7\u7ee7\u7eed\u4f20\u8f93\u672a\u5b8c\u6210\u7684\u90e8\u5206\u3002\u53ef\u4ee5\u4f7f\u672c\u5730\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u4e0eEtcd\u96c6\u7fa4\u4e2d\u7684\u6570\u636e\u4fdd\u6301\u4e00\u81f4\uff0c\u8be5\u51fd\u6570\u5b9e\u73b0\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>// \u5982\u679c\u6700\u540e\u4e00\u6b21relist\u7684\u7ed3\u679c\u662fHTTP 410\uff08Gone\uff09\u72b6\u6001\u7801\uff0c\u5219\u8fd4\u56de\"\"\uff0c\u8fd9\u6837relist\u5c06\u901a\u8fc7quorum\u8bfb\u53d6etcd\u4e2d\u53ef\u7528\u7684\u6700\u65b0\u8d44\u6e90\u7248\u672c\u3002\n// \u8fd4\u56de\u4f7f\u7528 lastSyncResourceVersion\uff0c\u8fd9\u6837\u53cd\u5c04\u5668\u5c31\u4e0d\u4f1a\u4f7f\u7528\u5728relist\u7ed3\u679c\u6216watch\u4e8b\u4ef6\u4e2dwatch\u5230\u7684\u8d44\u6e90\u7248\u672c\u66f4\u8001\u7684\u8d44\u6e90\u7248\u672c\u8fdb\u884crelist\u4e86\nfunc (r *Reflector) relistResourceVersion() string {\n    r.lastSyncResourceVersionMutex.RLock()\n    defer r.lastSyncResourceVersionMutex.RUnlock()\n\n    if r.isLastSyncResourceVersionUnavailable {\n    // \u56e0\u4e3a\u53cd\u5c04\u5668\u4f1a\u8fdb\u884c\u5206\u9875List\u8bf7\u6c42\uff0c\u5982\u679c lastSyncResourceVersion \u8fc7\u671f\u4e86\uff0c\u6240\u6709\u7684\u5206\u9875\u5217\u8868\u8bf7\u6c42\u5c31\u90fd\u4f1a\u8df3\u8fc7 watch \u7f13\u5b58\n    // \u6240\u4ee5\u8bbe\u7f6e ResourceVersion=\"\"\uff0c\u7136\u540e\u518d\u6b21 List\uff0c\u91cd\u65b0\u5efa\u7acb\u53cd\u5c04\u5668\u5230\u6700\u65b0\u7684\u53ef\u7528\u8d44\u6e90\u7248\u672c\uff0c\u4ece etcd \u4e2d\u8bfb\u53d6\uff0c\u4fdd\u6301\u4e00\u81f4\u6027\u3002\n        return \"\"\n    }\n    if r.lastSyncResourceVersion == \"\" {\n    // \u53cd\u5c04\u5668\u6267\u884c\u7684\u521d\u59cb List \u64cd\u4f5c\u7684\u65f6\u5019\u4f7f\u75280\u4f5c\u4e3a\u8d44\u6e90\u7248\u672c\u3002\n        return \"0\"\n    }\n    return r.lastSyncResourceVersion\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_3","title":"\u4e94 \u6574\u4f53\u6d41\u7a0b","text":"<pre><code>// k8s.io/client-go/informers/apps/v1/deployment.go\n\n// NewFilteredDeploymentInformer \u4e3a Deployment \u6784\u9020\u4e00\u4e2a\u65b0\u7684 Informer\u3002\n// \u603b\u662f\u503e\u5411\u4e8e\u4f7f\u7528\u4e00\u4e2a informer \u5de5\u5382\u6765\u83b7\u53d6\u4e00\u4e2a shared informer\uff0c\u800c\u4e0d\u662f\u83b7\u53d6\u4e00\u4e2a\u72ec\u7acb\u7684 informer\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u5185\u5b58\u5360\u7528\u548c\u670d\u52a1\u5668\u7684\u8fde\u63a5\u6570\u3002\nfunc NewFilteredDeploymentInformer(client kubernetes.Interface, namespace string, resyncPeriod time.Duration, indexers cache.Indexers, tweakListOptions internalinterfaces.TweakListOptionsFunc) cache.SharedIndexInformer {\n    return cache.NewSharedIndexInformer(\n        &amp;cache.ListWatch{\n            ListFunc: func(options metav1.ListOptions) (runtime.Object, error) {\n                if tweakListOptions != nil {\n                    tweakListOptions(&amp;options)\n                }\n                return client.AppsV1().Deployments(namespace).List(context.TODO(), options)\n            },\n            WatchFunc: func(options metav1.ListOptions) (watch.Interface, error) {\n                if tweakListOptions != nil {\n                    tweakListOptions(&amp;options)\n                }\n                return client.AppsV1().Deployments(namespace).Watch(context.TODO(), options)\n            },\n        },\n        &amp;appsv1.Deployment{},\n        resyncPeriod,\n        indexers,\n    )\n}\n</code></pre> <p>\u4ece\u4e0a\u9762\u4ee3\u7801\u6211\u4eec\u5c31\u53ef\u4ee5\u770b\u51fa\u6765\u5f53\u6211\u4eec\u53bb\u8c03\u7528\u4e00\u4e2a\u8d44\u6e90\u5bf9\u8c61\u7684 Informer() \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u53bb\u8c03\u7528\u4e0a\u9762\u7684 <code>NewFilteredDeploymentInformer</code> \u51fd\u6570\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u800c\u5728\u521d\u59cb\u5316\u7684\u4f7f\u7528\u5c31\u4f20\u5165\u4e86 <code>cache.ListWatch</code> \u5bf9\u8c61\uff0c\u5176\u4e2d\u5c31\u6709 List \u548c Watch \u7684\u5b9e\u73b0\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4\u524d\u9762\u53cd\u5c04\u5668\u5728 ListAndWatch \u91cc\u9762\u8c03\u7528\u7684 ListWatcher \u7684 List \u64cd\u4f5c\u662f\u5728\u4e00\u4e2a\u5177\u4f53\u7684\u8d44\u6e90\u5bf9\u8c61\u7684 Informer \u4e2d\u5b9e\u73b0\u7684\uff0c\u6bd4\u5982\u6211\u4eec\u8fd9\u91cc\u5c31\u662f\u901a\u8fc7\u7684 ClientSet \u5ba2\u6237\u7aef\u4e0e APIServer \u4ea4\u4e92\u83b7\u53d6\u5230 Deployment \u7684\u8d44\u6e90\u5217\u8868\u6570\u636e\u7684\uff0c\u901a\u8fc7\u5728 ListFunc \u4e2d\u7684 <code>client.AppsV1().Deployments(namespace).List(context.TODO(), options)</code> \u5b9e\u73b0\u7684\u3002</p> <ol> <li> <p>\u83b7\u53d6\u5230\u4e86\u5168\u91cf\u7684 List \u6570\u636e\u8fc7\u540e\uff0c\u901a\u8fc7 <code>listMetaInterface.GetResourceVersion()</code> \u6765\u83b7\u53d6\u8d44\u6e90\u7684\u7248\u672c\u53f7\uff0cResourceVersion\uff08\u8d44\u6e90\u7248\u672c\u53f7\uff09\u975e\u5e38\u91cd\u8981\uff0cKubernetes \u4e2d\u6240\u6709\u7684\u8d44\u6e90\u90fd\u62e5\u6709\u8be5\u5b57\u6bb5\uff0c\u5b83\u6807\u8bc6\u5f53\u524d\u8d44\u6e90\u5bf9\u8c61\u7684\u7248\u672c\u53f7\uff0c\u6bcf\u6b21\u4fee\u6539\uff08CUD\uff09\u5f53\u524d\u8d44\u6e90\u5bf9\u8c61\u65f6\uff0cKubernetes API Server \u90fd\u4f1a\u66f4\u6539 ResourceVersion\uff0c\u8fd9\u6837 client-go \u6267\u884c Watch \u64cd\u4f5c\u65f6\u53ef\u4ee5\u6839\u636eResourceVersion \u6765\u786e\u5b9a\u5f53\u524d\u8d44\u6e90\u5bf9\u8c61\u662f\u5426\u53d1\u751f\u4e86\u53d8\u5316\u3002</p> </li> <li> <p>\u7136\u540e\u901a\u8fc7 meta.ExtractList \u51fd\u6570\u5c06\u8d44\u6e90\u6570\u636e\u8f6c\u6362\u6210\u8d44\u6e90\u5bf9\u8c61\u5217\u8868\uff0c\u5c06 <code>runtime.Object</code> \u5bf9\u8c61\u8f6c\u6362\u6210 <code>[]runtime.Object</code> \u5bf9\u8c61\uff0c\u56e0\u4e3a\u5168\u91cf\u83b7\u53d6\u7684\u662f\u4e00\u4e2a\u8d44\u6e90\u5217\u8868\u3002</p> </li> <li> <p>\u63a5\u4e0b\u6765\u662f\u901a\u8fc7\u53cd\u5c04\u5668\u7684 <code>syncWith</code> \u51fd\u6570\u5c06\u8d44\u6e90\u5bf9\u8c61\u5217\u8868\u4e2d\u7684\u8d44\u6e90\u5bf9\u8c61\u548c\u8d44\u6e90\u7248\u672c\u53f7\u5b58\u50a8\u5728 Store \u4e2d\uff0c\u8fd9\u4e2a\u4f1a\u5728\u540e\u9762\u7684\u7ae0\u8282\u4e2d\u8be6\u7ec6\u8bf4\u660e\u3002</p> </li> <li> <p>\u6700\u540e\u5904\u7406\u5b8c\u6210\u540e\u901a\u8fc7 <code>r.setLastSyncResourceVersion(resourceVersion)</code> \u64cd\u4f5c\u6765\u8bbe\u7f6e\u6700\u65b0\u7684\u8d44\u6e90\u7248\u672c\u53f7\uff0c\u5176\u4ed6\u7684\u5c31\u662f\u542f\u52a8\u4e00\u4e2a goroutine \u53bb\u5b9a\u671f\u68c0\u67e5\u662f\u5426\u9700\u8981\u6267\u884c Resync \u64cd\u4f5c\uff0c\u8c03\u7528\u5b58\u50a8\u4e2d\u7684 <code>r.store.Resync()</code> \u6765\u6267\u884c\u3002</p> </li> <li> <p>\u7d27\u63a5\u7740\u5c31\u662f Watch \u64cd\u4f5c\u4e86\uff0cWatch \u64cd\u4f5c\u901a\u8fc7 HTTP \u534f\u8bae\u4e0e APIServer \u5efa\u7acb\u957f\u8fde\u63a5\uff0c\u63a5\u6536Kubernetes API Server \u53d1\u6765\u7684\u8d44\u6e90\u53d8\u66f4\u4e8b\u4ef6\uff0c\u548c List \u64cd\u4f5c\u4e00\u6837\uff0cWatch \u7684\u771f\u6b63\u5b9e\u73b0\u4e5f\u662f\u5177\u4f53\u7684 Informer \u521d\u59cb\u5316\u7684\u65f6\u5019\u4f20\u5165\u7684\uff0c\u6bd4\u5982\u4e0a\u9762\u7684 Deployment Informer \u4e2d\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f20\u5165\u7684 WatchFunc\uff0c\u5e95\u5c42\u4e5f\u662f\u901a\u8fc7 ClientSet \u5ba2\u6237\u7aef\u5bf9 Deployment \u6267\u884c Watch \u64cd\u4f5c <code>client.AppsV1().Deployments(namespace).Watch(context.TODO(), options)</code> \u5b9e\u73b0\u7684\u3002</p> </li> <li> <p>\u83b7\u5f97 watch \u7684\u8d44\u6e90\u6570\u636e\u540e\uff0c\u901a\u8fc7\u8c03\u7528 <code>r.watchHandler</code> \u6765\u5904\u7406\u8d44\u6e90\u7684\u53d8\u66f4\u4e8b\u4ef6\uff0c\u5f53\u89e6\u53d1Add \u4e8b\u4ef6\u3001Update \u4e8b\u4ef6\u3001Delete \u4e8b\u4ef6\u65f6\uff0c\u5c06\u5bf9\u5e94\u7684\u8d44\u6e90\u5bf9\u8c61\u66f4\u65b0\u5230\u672c\u5730\u7f13\u5b58\uff08DeltaFIFO\uff09\u4e2d\u5e76\u66f4\u65b0 ResourceVersion \u8d44\u6e90\u7248\u672c\u53f7\u3002</p> </li> </ol> <p>\u8fd9\u5c31\u662f Reflector \u53cd\u5c04\u5668\u4e2d\u6700\u6838\u5fc3\u7684 <code>ListAndWatch</code> \u5b9e\u73b0\uff0c\u4ece\u4e0a\u9762\u7684\u5b9e\u73b0\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u83b7\u53d6\u5230\u7684\u6570\u636e\u6700\u7ec8\u90fd\u6d41\u5411\u4e86\u672c\u5730\u7684 Store\uff0c\u4e5f\u5c31\u662f DeltaFIFO\uff0c\u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u6765\u5206\u6790 DeltaFIFO \u7684\u5b9e\u73b0\u3002</p>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_4","title":"\u516d \u5c0f\u8bd5\u725b\u5200","text":"<pre><code>package main\n\nimport (\n    \"fmt\"\n    corev1 \"k8s.io/api/core/v1\"\n    \"k8s.io/apimachinery/pkg/fields\"\n    \"k8s.io/apimachinery/pkg/util/wait\"\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/tools/cache\"\n    \"k8s.io/client-go/tools/clientcmd\"\n    \"k8s.io/client-go/util/homedir\"\n    \"path/filepath\"\n    \"time\"\n)\n\nfunc Must(e interface{}) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc InitClientSet() (*kubernetes.Clientset, error) {\n    kubeconfig := filepath.Join(homedir.HomeDir(), \".kube\", \"config\")\n    restConfig, err := clientcmd.BuildConfigFromFlags(\"\", kubeconfig)\n    if err != nil {\n        return nil, err\n    }\n    return kubernetes.NewForConfig(restConfig)\n}\n\n// \u751f\u6210listwatcher\nfunc InitListerWatcher(clientSet *kubernetes.Clientset, resource, namespace string, fieldSelector fields.Selector) cache.ListerWatcher {\n    restClient := clientSet.CoreV1().RESTClient()\n    return cache.NewListWatchFromClient(restClient, resource, namespace, fieldSelector)\n}\n\n// \u751f\u6210pods reflector\nfunc InitPodsReflector(clientSet *kubernetes.Clientset, store cache.Store) *cache.Reflector {\n    resource := \"pods\"\n    namespace := \"default\"\n    resyncPeriod := 0 * time.Second\n    expectedType := &amp;corev1.Pod{}\n    lw := InitListerWatcher(clientSet, resource, namespace, fields.Everything())\n\n    return cache.NewReflector(lw, expectedType, store, resyncPeriod)\n}\n\n// \u751f\u6210 DeltaFIFO\nfunc InitDeltaQueue(store cache.Store) cache.Queue {\n    return cache.NewDeltaFIFOWithOptions(cache.DeltaFIFOOptions{\n        // store \u5b9e\u73b0\u4e86 KeyListerGetter\n        KnownObjects: store,\n        // EmitDeltaTypeReplaced \u8868\u793a\u961f\u5217\u6d88\u8d39\u8005\u7406\u89e3 Replaced DeltaType\u3002\n        // \u5728\u6dfb\u52a0 `Replaced` \u4e8b\u4ef6\u7c7b\u578b\u4e4b\u524d\uff0c\u5bf9 Replace() \u7684\u8c03\u7528\u7684\u5904\u7406\u65b9\u5f0f\u4e0e Sync() \u76f8\u540c\u3002\n        // \u51fa\u4e8e\u5411\u540e\u517c\u5bb9\u7684\u76ee\u7684\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a false\u3002\n        // \u5f53\u4e3a true \u65f6\uff0c\u5c06\u4e3a\u4f20\u9012\u7ed9 Replace() \u8c03\u7528\u7684\u9879\u76ee\u53d1\u9001\u201c\u66ff\u6362\u201d\u4e8b\u4ef6\u3002\u5f53\u4e3a false \u65f6\uff0c\u5c06\u53d1\u9001 `Sync` \u4e8b\u4ef6\u3002\n        EmitDeltaTypeReplaced: true,\n    })\n\n}\nfunc InitStore() cache.Store {\n    return cache.NewStore(cache.MetaNamespaceKeyFunc)\n}\n\nfunc main() {\n    clientSet, err := InitClientSet()\n    Must(err)\n    // \u7528\u4e8e\u5728processfunc\u4e2d\u83b7\u53d6\n    store := InitStore()\n    // queue\n    DeleteFIFOQueue := InitDeltaQueue(store)\n    // \u751f\u6210podReflector\n    podReflector := InitPodsReflector(clientSet, DeleteFIFOQueue)\n\n    stopCh := make(chan struct{})\n    defer close(stopCh)\n    go podReflector.Run(stopCh)\n    //\u542f\u52a8\n    ProcessFunc := func(obj interface{}) error {\n        // \u6700\u5148\u6536\u5230\u7684\u4e8b\u4ef6\u4f1a\u88ab\u6700\u5148\u5904\u7406\n        for _, d := range obj.(cache.Deltas) {\n            switch d.Type {\n            case cache.Sync, cache.Replaced, cache.Added, cache.Updated:\n                if _, exists, err := store.Get(d.Object); err == nil &amp;&amp; exists {\n                    if err := store.Update(d.Object); err != nil {\n                        return err\n                    }\n                } else {\n                    if err := store.Add(d.Object); err != nil {\n                        return err\n                    }\n                }\n            case cache.Deleted:\n                if err := store.Delete(d.Object); err != nil {\n                    return err\n                }\n            }\n            pods, ok := d.Object.(*corev1.Pod)\n            if !ok {\n                return fmt.Errorf(\"not config: %T\", d.Object)\n            }\n\n            fmt.Printf(\"Type:%s: Name:%s\\n\", d.Type, pods.Name)\n        }\n        return nil\n    }\n\n    fmt.Println(\"Start syncing...\")\n\n    wait.Until(func() {\n        for {\n            _, err := DeleteFIFOQueue.Pop(ProcessFunc)\n            Must(err)\n        }\n    }, time.Second, stopCh)\n}\n</code></pre>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_5","title":"\u4e03 \u603b\u7ed3","text":"<p>\u901a\u8fc7\u672c\u6587\uff0c\u53ef\u4ee5\u4e86\u89e3Reflector\u901a\u8fc7ListWatcher\u4eceKubernetes API\u4e2d\u83b7\u53d6\u5bf9\u8c61\u7684\u6d41\u7a0b\uff0c\u4ee5\u53ca\u5b58\u50a8\u5230store\u4e2d\uff0c\u540e\u7eed\u4f1a\u5bf9DeltaFIFO\u8fdb\u884c\u6e90\u7801\u7814\u8bfb\uff0c\u901a\u8fc7\u7ed3\u5408informer\uff0c\u6765\u52a0\u6df1\u5bf9\u6574\u4e2ainformer\u7684\u7406\u89e3\u3002</p>"},{"location":"cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://blog.csdn.net/u013276277/article/details/108592288</li> <li>https://www.jianshu.com/p/1daeae7b6970</li> </ul>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"7.Client-go\u6e90\u7801\u5206\u6790\u4e4bDeltaFIFO","text":""},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u5728\u4e4b\u524d\u7684 <code>Reflector</code> \u5b66\u4e60\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u5728 <code>ListAndWatch</code> \u65b9\u6cd5\u4e2d\uff0c\u5bf9\u8d44\u6e90\u7684\u5168\u91cf <code>List</code> \u6700\u540e\u8c03\u7528\u7684\u5176\u5b9e\u662f <code>Reflector</code> \u4f20\u5165\u7684 <code>Store</code> \u4e2d\u7684 <code>Replace</code>  \u65b9\u6cd5\uff0c\u5728\u5b9a\u65f6\u540c\u6b65\u4e2d\uff0c\u8c03\u7528\u7684\u662f<code>Store</code>\u7684<code>Resync</code>\u65b9\u6cd5\uff0c\u90a3\u4e48\u90fd\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5462\uff0c\u672c\u6587\u5373\u5c06\u4ece\u6e90\u7801\u5c55\u5f00\u5206\u6790\u3002</p> <p><code>DeltaFIFO</code>\u662fK8s\u4e2d\u7528\u6765\u5b58\u50a8\u5904\u7406\u6570\u636e\u7684<code>Queue</code>\uff0c\u76f8\u8f83\u4e8e\u4f20\u7edf\u7684<code>FIFO</code>,\u5b83\u4e0d\u4ec5\u4ec5\u5b58\u50a8\u4e86\u6570\u636e\u4fdd\u8bc1\u4e86\u5148\u8fdb\u5148\u51fa\uff0c\u800c\u4e14\u5b58\u50a8\u6709K8s \u8d44\u6e90\u5bf9\u8c61\u7684\u7c7b\u578b\u3002\u5176\u662f\u8fde\u63a5<code>Reflector</code>(\u751f\u4ea7\u8005)\u548c<code>indexer</code>(\u6d88\u8d39\u8005)\u7684\u91cd\u8981\u901a\u9053\u3002</p>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_2","title":"\u4e8c \u6e90\u7801","text":"<p>\u5728\u8fd9\u91cc\u6211\u4eec\u7740\u91cd\u770b\u51e0\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u65b9\u6cd5\u53ca\u51fd\u6570\uff0c\u7406\u89e3DeltaFIFO\u7684\u91cd\u8981\u51e0\u4e2a\u5c5e\u6027\u53ca\u65b9\u6cd5\uff0c\u5177\u4f53\u66f4\u7ec6\u7684Queue\uff0cFIFO\u7b49\u65b9\u6cd5\u9700\u8981\u53bb\u67e5\u770b\u66f4\u8be6\u7ec6\u7684\u6e90\u7801\u3002</p>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#21-deltafifo","title":"2.1 DeltaFIFO\u7ed3\u6784","text":"<pre><code>// Delta \u7ed3\u6784\u4f53\ntype Delta struct {\n    Type   DeltaType\n    Object interface{}\n}\n\ntype DeltaType string\n\n// Change type definition\nconst (\n    Added   DeltaType = \"Added\"\n    Updated DeltaType = \"Updated\"\n    Deleted DeltaType = \"Deleted\"\n // \u5f53\u9047\u5230 watch \u9519\u8bef\uff0c\u4e0d\u5f97\u4e0d\u8fdb\u884c\u91cd\u65b0list\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1 Replaced\u3002\n  // \u6211\u4eec\u4e0d\u77e5\u9053\u88ab\u66ff\u6362\u7684\u5bf9\u8c61\u662f\u5426\u53d1\u751f\u4e86\u53d8\u5316\u3002\n    Replaced DeltaType = \"Replaced\"\n    // Sync \u662f\u9488\u5bf9\u5468\u671f\u6027\u91cd\u65b0\u540c\u6b65\u671f\u95f4\u7684\u5408\u6210\u4e8b\u4ef6\n    Sync DeltaType = \"Sync\"\n)\n\ntype DeltaFIFO struct {\n    // lock/cond \u4fdd\u62a4\u5bf9\u201c\u9879\u76ee\u201d\u548c\u201c\u961f\u5217\u201d\u7684\u8bbf\u95ee,\u786e\u4fdd\u7ebf\u7a0b\u5b89\u5168\n    lock sync.RWMutex\n  // cond\u5b9e\u73b0\u4e00\u4e2a\u6761\u4ef6\u53d8\u91cf\uff0c\u4e00\u4e2a\u96c6\u5408\u70b9 \uff0c\u7528\u4e8e\u7b49\u5f85\u6216\u5ba3\u5e03\u53d1\u751f\u7684goroutine\u4e8b\u4ef6\u3002\n  // \u6bcf\u4e2aCond\u90fd\u6709\u4e00\u4e2a\u9501L\uff08\u901a\u5e38\u662f* Mutex\u6216* RWMutex\uff09\uff0c\n  // \u66f4\u6539\u6761\u4ef6\u65f6\u5fc5\u987b\u4fdd\u7559 \u8c03\u7528Wait\u65b9\u6cd5\u65f6\u3002\u7b2c\u4e00\u6b21\u4f7f\u7528\u540e\u4e0d\u5f97\u590d\u5236\u6761\u4ef6\u3002\n    cond sync.Cond\n\n    // `items` maps a key to a Deltas.\n    // items\u4e3a\u540c\u4e00\u7c7b\u5bf9\u8c61\u7684\u53d8\u5316delta\u53d8\u5316\u5217\u8868\n    items map[string]Deltas\n\n    // `queue` maintains FIFO order of keys for consumption in Pop().\n    // There are no duplicates in `queue`.\n    // \u4e3a\u4e86\u4fdd\u8bc1\u987a\u5e8f\n    queue []string\n\n  // \u5982\u679c\u8c03\u7528Replace()\u7b2c\u4e00\u6b21\u586b\u5145\u5b8c\u6210\uff0c\u5219populated\u8bbe\u7f6e\u4e3atrue\n    populated bool\n    // \u7b2c\u4e00\u6b21\u8c03\u7528Replace\u63d2\u5165\u7684\u9879\u76ee\u6570\n    initialPopulationCount int\n\n    // \u8ba1\u7b97item\u7684key\n    keyFunc KeyFunc\n\n    // \u662f\u540e\u9762\u7684indexer\n    knownObjects KeyListerGetter\n\n    closed bool\n\n    // emitDeltaTypeReplaced is whether to emit the Replaced or Sync\n    // DeltaType when Replace() is called (to preserve backwards compat).\n    emitDeltaTypeReplaced bool\n}\n</code></pre> <p>\u4ece\u6e90\u7801\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51faDelta\u67095\u79cd\u7c7b\u578b\uff0c\u524d\u9762\u589e\u5220\u6539\u987e\u540d\u601d\u4e49\u90fd\u662f\u5728watch\u4e2d\u76d1\u63a7\u5bf9\u8c61\u7684\u53d8\u5316\uff0c\u5bf9\u4e8eReplaced\u548cSync\u7528\u4e8e\u9996\u6b21\u548c\u5f02\u5e38\u60c5\u51b5\u786e\u4fddindexer\u4e2d\u7684\u6570\u636e\u548cetcd\u4e2d\u7684\u4fdd\u6301\u4e00\u81f4\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u51faDeltaFIFO\u4e2d\u91cd\u8981\u7684\u51e0\u4e2a\u5c5e\u6027\u3002</p> <ul> <li> <p>queue\uff1a\u5b58\u50a8\u8d44\u6e90\u5bf9\u8c61\u7684key\u3002</p> </li> <li> <p>items\uff1a\u5b58\u50a8\u67d0\u4e2a\u5bf9\u8c61\u7684\u4e00\u7c7b\u884c\u4e3a\uff0c\u987a\u5e8f\u7684\u4fdd\u5b58\u540c\u4e00\u4e2a\u5bf9\u8c61\u7684\u4e00\u7cfb\u5217\u53d8\u5316\u884c\u4e3a\uff0ckey\u4e3akeyFunc\u8ba1\u7b97\u7684\u503c\uff0cvalue\u4e3adelta\u7684\u5217\u8868\u3002</p> </li> <li>keyFunc:\u7528\u4e8e\u8ba1\u7b97items\u7684key\u3002</li> </ul> <p>DeltaFIFO \u4ed6\u4f1a\u4fdd\u7559\u5173\u4e8e\u8d44\u6e90\u5bf9\u8c61obj\u7684\u64cd\u4f5c\u7c7b\u578b\uff0c\u961f\u5217\u4e2d\u4f1a\u5b58\u5728\u4e0d\u540c\u64cd\u4f5c\u7c7b\u578b\u7684\u540c\u4e00\u4e2a\u8d44\u6e90\u5bf9\u8c61\uff0cqueue\u7684key\u901a\u8fc7Keyof\u51fd\u6570\u8ba1\u7b97\u5f97\u5230 \uff0citems\u5b57\u6bb5\u901a\u8fc7map\u6570\u636e\u7ed3\u6784\u65b9\u5f0f\u5b58\u50a8\uff0cvaluse\u5b58\u50a8\u7684\u662f\u5bf9\u8c61\u7684deltas\u6570\u7ec4\u3002</p> <p></p> <p>\u4f8b\u5982\u7528\u6237\u521b\u5efa\u4e00\u4e2aPod\uff0c\u90a3\u4e48\u8be5Delat\u5c31\u8bf4\u4e00\u4e2a\u5e26\u6709Added\u7c7b\u578b\u7684Pod\uff0c\u5e26\u4e0a\u7c7b\u578b\u4e3a\u4e86\u540e\u7eed\u8ddf\u8fdb\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u63a7\u5236\u5668\u6267\u884c\u4e0d\u540c\u7684\u4e1a\u52a1\u903b\u8f91\u3002</p>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#22-queueactionlocked","title":"2.2 queueActionLocked","text":"<p>\u6211\u4eec\u67e5\u770bDeltaFIFO\u7684\u65b9\u6cd5\uff0c\u4f8b\u5982Add/Update/Delete\u90fd\u8c03\u7528\u4e86<code>queueActionLocked</code>\u65b9\u6cd5\uff0c\u5177\u4f53\u5bf9\u8be5\u65b9\u6cd5\u8fdb\u884c\u5206\u6790\u3002</p> <pre><code>// DeltaFIFO \u7684Add\u65b9\u6cd5\nfunc (f *DeltaFIFO) Add(obj interface{}) error {\n   f.lock.Lock()\n   defer f.lock.Unlock()\n   f.populated = true\n   return f.queueActionLocked(Added, obj)\n}\n</code></pre> <ul> <li>queueActionLocked</li> </ul> <p>\u5927\u4f53\u6b65\u9aa4\u53ef\u4ee5\u5206\u4e3a\uff1a\u83b7\u53d6\u5bf9\u8c61\u952e\uff0c\u5c06\u65b0\u5bf9\u8c61\u6dfb\u52a0\u81f3\u5bf9\u8c61\u5217\u8868\u4e2d\uff0c\u5bf9delete\u7c7b\u578b\u8fdb\u884c\u53bb\u91cd\uff0c\u5982\u679c\u5bf9\u8c61\u4e0d\u5728queue\u4e2d\uff0c\u5c06\u5176key\u5b58\u50a8\u5230queue\u4e2d\uff0c\u6700\u7ec8\u5b8c\u6210\u6dfb\u52a0\u5bf9\u8c61\u5230items\u4e2d\u548c\u66f4\u65b0queue\u3002</p> <pre><code>// \nfunc (f *DeltaFIFO) queueActionLocked(actionType DeltaType, obj interface{}) error {\n  //  \u83b7\u53d6\u5bf9\u8c61\u952e\n    id, err := f.KeyOf(obj)\n    if err != nil {\n        return KeyError{obj, err}\n    }\n  // \u4e34\u65f6\u5b58\u50a8\u65e7\u5bf9\u8c61\u5217\u8868\n    oldDeltas := f.items[id]\n  // \u5c06\u5bf9\u8c61\u6dfb\u52a0\u81f3\u65b0\u5bf9\u8c61\u5217\u8868\u4e2d\n    newDeltas := append(oldDeltas, Delta{actionType, obj})\n  // \u5bf9\u4e8edelete \u7c7b\u578b\u8fdb\u884c\u53bb\u91cd\uff0c\u56e0\u4e3a\u66f4\u65b0\u7c7b\u578b\u53ef\u80fd\u66f4\u65b0\u67d0\u4e2a\u5b57\u6bb5\u5b58\u5728\u5f02\u5e38\u3002\n    newDeltas = dedupDeltas(newDeltas)\n  // \u5224\u65adqueue\u4e2d\u662f\u5426\u5b58\u50a8\u6709\u5bf9\u8c61key\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u4e4b\u524d\u5c06\u5176\u6dfb\u52a0\u81f3queue\u4e2d\n    if len(newDeltas) &gt; 0 {\n        if _, exists := f.items[id]; !exists {\n            f.queue = append(f.queue, id)\n        }\n        f.items[id] = newDeltas\n    // \u901a\u77e5\u6240\u6709\u7684\u6d88\u8d39\u8005\u89e3\u9664\u963b\u585e\n        f.cond.Broadcast()\n    } else {\n        // This never happens, because dedupDeltas never returns an empty list\n        // when given a non-empty list (as it is here).\n        // If somehow it happens anyway, deal with it but complain.\n        if oldDeltas == nil {\n            klog.Errorf(\"Impossible dedupDeltas for id=%q: oldDeltas=%#+v, obj=%#+v; ignoring\", id, oldDeltas, obj)\n            return nil\n        }\n        klog.Errorf(\"Impossible dedupDeltas for id=%q: oldDeltas=%#+v, obj=%#+v; breaking invariant by storing empty Deltas\", id, oldDeltas, obj)\n    // \u751f\u6210\u6700\u7ec8\u7684\u5bf9\u8c61items\n        f.items[id] = newDeltas\n        return fmt.Errorf(\"Impossible dedupDeltas for id=%q: oldDeltas=%#+v, obj=%#+v; broke DeltaFIFO invariant by storing empty Deltas\", id, oldDeltas, obj)\n    }\n    return nil\n}\n</code></pre> <ul> <li>KeyOf</li> </ul> <p>\u5728queueActionLocked\u4e2d\u83b7\u53d6DeltaFIFO\u6700\u65b0\u7684\u5bf9\u8c61\u952e\u4f7f\u7528\u7684\u662fKeyOf\u65b9\u6cd5\uff0c\u9996\u5148\u5224\u8bfb\u5bf9\u8c61\u662f\u5426\u4e3adelta\u5207\u7247\uff0c\u5229\u7528\u6700\u65b0\u7684delta\u5bf9\u8c61\u8fdb\u884c\u64cd\u4f5c\uff0c\u76f4\u63a5\u8c03\u7528\u7684DeltaFIFO\u4e2d\u7684keyFunc\uff0c\u5728K8s\u4e2d\u5982\u679c\u4e0d\u4f20\u5165\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7684\u662fMetaNamespaceKeyFunc\uff0c\u8be5\u51fd\u6570\u8fd4\u56de\u7684\u662f/\uff0c\u9664\u975e\u4e3a\u7a7a\uff0c\u5219\u76f4\u63a5\u4f7f\u7528\u5bf9\u8c61\u540d\u79f0\u4f5c\u4e3akey\u3002 <pre><code>// DeltaFIFO \u7684\u5bf9\u8c61\u952e\u8ba1\u7b97\u51fd\u6570\nfunc (f *DeltaFIFO) KeyOf(obj interface{}) (string, error) {\n // \u5224\u65ad\u662f\u5426\u662f Delta \u5207\u7247\n  if d, ok := obj.(Deltas); ok {\n  if len(d) == 0 {\n   return \"\", KeyError{obj, ErrZeroLengthDeltasObject}\n  }\n  // \u4f7f\u7528\u6700\u65b0\u7248\u672c\u7684\u5bf9\u8c61\u8fdb\u884c\u8ba1\u7b97\n  obj = d.Newest().Object\n }\n if d, ok := obj.(DeletedFinalStateUnknown); ok {\n  return d.Key, nil\n }\n  // \u5177\u4f53\u8ba1\u7b97\u8fd8\u662f\u8981\u770b\u521d\u59cb\u5316 DeltaFIFO \u4f20\u5165\u7684 KeyFunc \u51fd\u6570\n return f.keyFunc(obj)\n}\n\n// Newest \u8fd4\u56de\u6700\u65b0\u7684 Delta\uff0c\u5982\u679c\u6ca1\u6709\u5219\u8fd4\u56de nil\u3002\nfunc (d Deltas) Newest() *Delta {\n if n := len(d); n &gt; 0 {\n  return &amp;d[n-1]\n }\n return nil\n}\n</code></pre>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#23-replace","title":"2.3 Replace","text":"<p>\u5728\u4e4b\u524d\u7684 <code>Reflector</code> \u5b66\u4e60\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u5728 <code>ListAndWatch</code> \u65b9\u6cd5\u4e2d\uff0c\u5bf9\u8d44\u6e90\u7684\u5168\u91cf <code>List</code> \u6700\u540e\u8c03\u7528\u7684\u5176\u5b9e\u662f <code>Reflector</code> \u4f20\u5165\u7684 <code>Store</code> \u4e2d\u7684 <code>Replace</code>  \u65b9\u6cd5\u3002</p> <p>Replace\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8e\u5bf9\u8c61\u7684\u5168\u91cf\u66f4\u65b0\u4e0a\uff0c\u7531\u4e8e DeltaFIFO \u5bf9\u5916\u8f93\u51fa\u7684\u5c31\u662f\u6240\u6709\u76ee\u6807\u7684\u589e\u91cf\u53d8\u5316\uff0c\u6240\u4ee5\u6bcf\u6b21\u5168\u91cf\u66f4\u65b0\u90fd\u8981\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5df2\u7ecf\u5220\u9664\uff0c\u56e0\u4e3a\u5728\u5168\u91cf\u66f4\u65b0\u524d\u53ef\u80fd\u6ca1\u6709\u6536\u5230\u76ee\u6807\u5220\u9664\u7684\u8bf7\u6c42\u3002\u8fd9\u4e00\u70b9\u4e0e cache \u4e0d\u540c\uff0ccache \u7684Replace() \u76f8\u5f53\u4e8e\u91cd\u5efa\uff0c\u56e0\u4e3a cache \u5c31\u662f\u5bf9\u8c61\u5168\u91cf\u7684\u4e00\u79cd\u5185\u5b58\u6620\u5c04\uff0c\u6240\u4ee5Replace() \u5c31\u7b49\u4e8e\u91cd\u5efa\u3002</p> <pre><code>func (f *DeltaFIFO) Replace(list []interface{}, resourceVersion string) error {\n    f.lock.Lock()\n    defer f.lock.Unlock()\n  // \u6784\u9020\u4e00\u4e2aset\n    keys := make(sets.String, len(list))\n\n    // \u65e7\u7248\u672c\u5ba2\u6237\u7aefList\u64cd\u4f5cSync\uff0c\u518d\u6b64\u4e3a\u4e86\u5411\u540e\u517c\u5bb9\n    action := Sync\n    if f.emitDeltaTypeReplaced {\n        action = Replaced\n    }\n\n    // \u5bf9\u4f20\u5165\u7684\u5bf9\u8c61\u5217\u5207\u7247\u8fdb\u884c\u904d\u5386\u5e76\u6dfb\u52a0\u81f3DeltaFIFO\u4e2d\u3002\n    for _, item := range list {\n    // \u83b7\u53d6\u5bf9\u8c61key\n        key, err := f.KeyOf(item)\n        if err != nil {\n            return KeyError{item, err}\n        }\n    // \u5229\u7528Set\u96c6\u5408\u4fdd\u5b58\u5904\u7406\u8fc7\u7684\u5bf9\u8c61\u952e\n        keys.Insert(key)\n        if err := f.queueActionLocked(action, item); err != nil {\n            return fmt.Errorf(\"couldn't enqueue object: %v\", err)\n        }\n    }\n\n  // \u5224\u65ad\u662f\u5426\u6709Indexer\u5b58\u50a8\uff0c\u5982\u679c\u6ca1\u6709Indexer\uff0c\u90a3\u4e48\u5c31\u7ef4\u62a4\u81ea\u5df1\u7684Queue\n  // \u5982\u679c\u8001\u5bf9\u8c61\u4e0d\u5728Queue\u4e2d\uff0c\u5219\u5220\u9664\u5bf9\u8c61\uff0c\u5426\u5219\u66f4\u65b0\u4e3a\u6700\u65b0\u7684\u5bf9\u8c61\n    if f.knownObjects == nil {\n        // Do deletion detection against our own list.\n        queuedDeletions := 0\n\n    // \u5bf9\u5bf9\u8c61\u6267\u884c\u66f4\u65b0\n        for k, oldItem := range f.items {\n            if keys.Has(k) {\n                continue\n            }\n            // Delete pre-existing items not in the new list.\n            // This could happen if watch deletion event was missed while\n            // disconnected from apiserver.\n            var deletedObj interface{}\n            if n := oldItem.Newest(); n != nil {\n                deletedObj = n.Object\n            }\n            queuedDeletions++\n      // \u56e0\u4e3a\u53ef\u80fd\u961f\u5217\u4e2d\u5df2\u7ecf\u5b58\u5728 Deleted \u7c7b\u578b\u7684\u5143\u7d20\u4e86\uff0c\u907f\u514d\u91cd\u590d\uff0c\u6240\u4ee5\u91c7\u7528 DeletedFinalStateUnknown \n            if err := f.queueActionLocked(Deleted, DeletedFinalStateUnknown{k, deletedObj}); err != nil {\n                return err\n            }\n        }\n   // \u5982\u679cpopulated\u4e3afalse\uff0c\u5219\u8bf4\u660e\u7b2c\u4e00\u6b21\u5165\u7684\u961f\u5217\u5bf9\u8c61\u4e3a\u64cd\u4f5c\u5b8c\u6210\n        if !f.populated {\n            f.populated = true\n            // \u8bb0\u5f55\u7b2c\u4e00\u6b21\u8bbe\u7f6e\u7684\u5bf9\u8c61\u6570\u91cf\n            f.initialPopulationCount = keys.Len() + queuedDeletions\n        }\n\n        return nil\n    }\n\n    // \u68c0\u6d4b\u4e0d\u5728\u961f\u5217\u4e2d\u7684\u5220\u9664\u5bf9\u8c61\n    knownKeys := f.knownObjects.ListKeys()\n    queuedDeletions := 0\n    for _, k := range knownKeys {\n        if keys.Has(k) {\n            continue\n        }\n    // \u6839\u636ekey\u4eceindexer\u4e2d\u8fdb\u884c\u83b7\u53d6\n        deletedObj, exists, err := f.knownObjects.GetByKey(k)\n        if err != nil {\n            deletedObj = nil\n            klog.Errorf(\"Unexpected error %v during lookup of key %v, placing DeleteFinalStateUnknown marker without object\", err, k)\n        } else if !exists {\n            deletedObj = nil\n            klog.Infof(\"Key %v does not exist in known objects store, placing DeleteFinalStateUnknown marker without object\", k)\n        }\n        queuedDeletions++\n    // \u5c06\u5bf9\u8c61\u5220\u9664\u7684delta\u653e\u5165\u961f\u5217\n        if err := f.queueActionLocked(Deleted, DeletedFinalStateUnknown{k, deletedObj}); err != nil {\n            return err\n        }\n    }\n\n    if !f.populated {\n        f.populated = true\n        f.initialPopulationCount = keys.Len() + queuedDeletions\n    }\n\n    return nil\n}\n</code></pre>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#24-resync","title":"2.4 Resync","text":"<p>\u5728\u5b9a\u65f6\u540c\u6b65\u4e2d\uff0c\u8c03\u7528\u7684\u662f<code>Store</code>\u7684<code>Resync</code>\u65b9\u6cd5\uff0cResync \u91cd\u65b0\u540c\u6b65\uff0c\u5e26\u6709 Sync \u7c7b\u578b\u7684 Delta \u5bf9\u8c61\uff0c\u5982\u679cf.knownObjects\u4e5f\u5c31\u662fIndexer\u4e0d\u5b58\u5728\uff0c\u5219\u4e0d\u6267\u884cResync\u64cd\u4f5c\u3002</p> <pre><code>func (f *DeltaFIFO) Resync() error {\n    f.lock.Lock()\n    defer f.lock.Unlock()\n    // \u5982\u679c\u6ca1\u6709indexer\uff0c\u5219\u4e0d\u6267\u884c\n    if f.knownObjects == nil {\n        return nil\n    }\n  // \u83b7\u53d6indexer\u7684key\u5217\u8868\n    keys := f.knownObjects.ListKeys()\n    for _, k := range keys {\n        if err := f.syncKeyLocked(k); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n// \u5177\u4f53\u7684resync\u64cd\u4f5c\nfunc (f *DeltaFIFO) syncKeyLocked(key string) error {\n  // \u83b7\u53d6key\n    obj, exists, err := f.knownObjects.GetByKey(key)\n  // \u5982\u679c\u9519\u8bef\u6216\u4e0d\u5b58\u5728\u5219\u76f4\u63a5\u8fd4\u56de\n    if err != nil {\n        klog.Errorf(\"Unexpected error %v during lookup of key %v, unable to queue object for sync\", err, key)\n        return nil\n    } else if !exists {\n        klog.Infof(\"Key %v does not exist in known objects store, unable to queue object for sync\", key)\n        return nil\n    }\n\n    // If we are doing Resync() and there is already an event queued for that object,\n    // we ignore the Resync for it. This is to avoid the race, in which the resync\n    // comes with the previous value of object (since queueing an event for the object\n    // doesn't trigger changing the underlying store &lt;knownObjects&gt;.\n  // \u6839\u636eKeyOf\u83b7\u53d6\u5230key\n    id, err := f.KeyOf(obj)\n    if err != nil {\n        return KeyError{obj, err}\n    }\n  // \u5982\u679cDeltaFIFO\u4e2d\u8be5key\u6709\u503c\uff0c\u5219\u6682\u65f6\u5148\u4e0d\u66f4\u65b0\uff0c\u7b49\u6700\u540e\u4e00\u4e2a\u5bf9\u8c61\u64cd\u4f5c\u5b8c\u6210\u540e\u6267\u884c\u6700\u540e\u72b6\u6001\u7684\u66f4\u65b0\n    if len(f.items[id]) &gt; 0 {\n        return nil\n    }\n  // \u6dfb\u52a0\u5bf9\u8c61\u540c\u6b65\u7684\u8fd9\u4e2a Delta\n    if err := f.queueActionLocked(Sync, obj); err != nil {\n        return fmt.Errorf(\"couldn't queue object: %v\", err)\n    }\n    return nil\n}\n</code></pre>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#25-pop","title":"2.5 Pop","text":"<p>\u6700\u540e\u8981\u770b\u4e0b\u5bf9DeltaFIFO\u4e2d\u5bf9\u8c61\u7684\u6d88\u8d39\uff0c\u5b9e\u9645\u662f\u5229\u7528Pop\u51fd\u6570\uff0c\u5177\u4f53\u5bf9\u4e8e\u6570\u636e\u6d41\u5411\u7684\u5904\u7406\u662f\u901a\u8fc7PopProcessFunc\u5b9e\u73b0\u3002Pop \u4f1a\u7b49\u5230\u4e00\u4e2a\u5143\u7d20\u51c6\u5907\u597d\u540e\u518d\u8fdb\u884c\u5904\u7406\uff0c\u5982\u679c\u6709\u591a\u4e2a\u5143\u7d20\u51c6\u5907\u597d\u4e86\uff0c\u5219\u6309\u7167\u5b83\u4eec\u88ab\u6dfb\u52a0\u6216\u66f4\u65b0\u7684\u987a\u5e8f\u8fd4\u56de\u3002\u5728\u5904\u7406\u4e4b\u524d\uff0c\u5143\u7d20\u4f1a\u4ece\u961f\u5217\uff08\u548c\u5b58\u50a8\uff09\u4e2d\u79fb\u9664\uff0c\u6240\u4ee5\u5982\u679c\u6ca1\u6709\u6210\u529f\u5904\u7406\uff0c\u5e94\u8be5\u7528 AddIfNotPresent() \u51fd\u6570\u628a\u5b83\u6dfb\u52a0\u56de\u6765\u3002 \u5904\u7406\u51fd\u6570\u662f\u5728\u6709\u9501\u7684\u60c5\u51b5\u4e0b\u8c03\u7528\u7684\uff0c\u6240\u4ee5\u66f4\u65b0\u5176\u4e2d\u9700\u8981\u548c\u961f\u5217\u540c\u6b65\u7684\u6570\u636e\u7ed3\u6784\u662f\u5b89\u5168\u7684\u3002</p> <pre><code>func (f *DeltaFIFO) Pop(process PopProcessFunc) (interface{}, error) {\n   f.lock.Lock()\n   defer f.lock.Unlock()\n   for {\n      for len(f.queue) == 0 {\n         // \u5f53\u961f\u5217\u4e3a\u7a7a\u65f6\uff0cPop() \u7684\u8c03\u7528\u4f1a\u88ab\u963b\u585e\u4f4f\uff0c\u76f4\u5230\u65b0\u7684\u5143\u7d20\u63d2\u5165\u961f\u5217\u540e\n         // \u5f53\u8c03\u7528 Close() \u65f6\uff0c\u8bbe\u7f6e f.closed \u5e76\u5e7f\u64ad\u6761\u4ef6\u3002\n         if f.closed {\n            return nil, ErrFIFOClosed\n         }\n\n         f.cond.Wait()\n      }\n      // \u83b7\u53d6\u6700\u5148\u8fdb\u5165\u7684\u5143\u7d20\u8fdb\u884c\u5904\u7406\n      id := f.queue[0]\n      // \u4ece\u961f\u5217\u5220\u9664\u7b2c\u4e00\u5143\u7d20\n      f.queue = f.queue[1:]\n      if f.initialPopulationCount &gt; 0 {\n         f.initialPopulationCount--\n      }\n      // \u83b7\u53d6\u88ab\u5f39\u51fa\u7684\u5bf9\u8c61\n      item, ok := f.items[id]\n      if !ok {\n         // This should never happen\n         klog.Errorf(\"Inconceivable! %q was in f.queue but not f.items; ignoring.\", id)\n         continue\n      }\n      // \u4eceitems\u4e2d\u5220\u9664\u5f39\u51fa\u7684\u5143\u7d20\n      delete(f.items, id)\n      // \u5229\u7528process\u5bf9item\u8fdb\u884c\u5904\u7406\n      err := process(item)\n      if e, ok := err.(ErrRequeue); ok {\n         // \u5982\u679c\u5904\u7406\u672a\u6210\u529f\uff0c\u9700\u8981\u8c03\u7528 addIfNotPresent \u52a0\u56de\u961f\u5217\n         f.addIfNotPresent(id, item)\n         err = e.Err\n      }\n      // Don't need to copyDeltas here, because we're transferring\n      // ownership to the caller.\n      return item, err\n   }\n}\n</code></pre>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_3","title":"\u4e09 \u5c0f\u8bd5\u725b\u5200","text":"<pre><code>package main\n\nimport (\n    \"fmt\"\n    corev1 \"k8s.io/api/core/v1\"\n    \"k8s.io/apimachinery/pkg/fields\"\n    \"k8s.io/apimachinery/pkg/util/wait\"\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/tools/cache\"\n    \"k8s.io/client-go/tools/clientcmd\"\n    \"k8s.io/client-go/util/homedir\"\n    \"path/filepath\"\n    \"time\"\n)\n\nfunc Must(e interface{}) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc InitClientSet() (*kubernetes.Clientset, error) {\n    kubeconfig := filepath.Join(homedir.HomeDir(), \".kube\", \"config\")\n    restConfig, err := clientcmd.BuildConfigFromFlags(\"\", kubeconfig)\n    if err != nil {\n        return nil, err\n    }\n    return kubernetes.NewForConfig(restConfig)\n}\n\n// \u751f\u6210listwatcher\nfunc InitListerWatcher(clientSet *kubernetes.Clientset, resource, namespace string, fieldSelector fields.Selector) cache.ListerWatcher {\n    restClient := clientSet.CoreV1().RESTClient()\n    return cache.NewListWatchFromClient(restClient, resource, namespace, fieldSelector)\n}\n\n// \u751f\u6210pods reflector\nfunc InitPodsReflector(clientSet *kubernetes.Clientset, store cache.Store) *cache.Reflector {\n    resource := \"pods\"\n    namespace := \"default\"\n    resyncPeriod := 0 * time.Second\n    expectedType := &amp;corev1.Pod{}\n    lw := InitListerWatcher(clientSet, resource, namespace, fields.Everything())\n\n    return cache.NewReflector(lw, expectedType, store, resyncPeriod)\n}\n\n// \u751f\u6210 DeltaFIFO\nfunc InitDeltaQueue(store cache.Store) cache.Queue {\n    return cache.NewDeltaFIFOWithOptions(cache.DeltaFIFOOptions{\n        // store \u5b9e\u73b0\u4e86 KeyListerGetter\n        KnownObjects: store,\n        // EmitDeltaTypeReplaced \u8868\u793a\u961f\u5217\u6d88\u8d39\u8005\u7406\u89e3 Replaced DeltaType\u3002\n        // \u5728\u6dfb\u52a0 `Replaced` \u4e8b\u4ef6\u7c7b\u578b\u4e4b\u524d\uff0c\u5bf9 Replace() \u7684\u8c03\u7528\u7684\u5904\u7406\u65b9\u5f0f\u4e0e Sync() \u76f8\u540c\u3002\n        // \u51fa\u4e8e\u5411\u540e\u517c\u5bb9\u7684\u76ee\u7684\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a false\u3002\n        // \u5f53\u4e3a true \u65f6\uff0c\u5c06\u4e3a\u4f20\u9012\u7ed9 Replace() \u8c03\u7528\u7684\u9879\u76ee\u53d1\u9001\u201c\u66ff\u6362\u201d\u4e8b\u4ef6\u3002\u5f53\u4e3a false \u65f6\uff0c\u5c06\u53d1\u9001 `Sync` \u4e8b\u4ef6\u3002\n        EmitDeltaTypeReplaced: true,\n    })\n\n}\nfunc InitStore() cache.Store {\n    return cache.NewStore(cache.MetaNamespaceKeyFunc)\n}\n\nfunc main() {\n    clientSet, err := InitClientSet()\n    Must(err)\n    // \u7528\u4e8e\u5728processfunc\u4e2d\u83b7\u53d6\n    store := InitStore()\n    // queue\n    DeleteFIFOQueue := InitDeltaQueue(store)\n    // \u751f\u6210podReflector\n    podReflector := InitPodsReflector(clientSet, DeleteFIFOQueue)\n\n    stopCh := make(chan struct{})\n    defer close(stopCh)\n    go podReflector.Run(stopCh)\n    // \u5bf9\u5355\u4e2a\u5143\u7d20\u8fdb\u884c\u5904\u7406\uff0c\u5143\u7d20ke\u4e3a namespace/name\uff0cvalue \u4e3adelta\u5217\u8868\n  // delta\u5bf9\u8c61\u4e3aDeltaType\u548cruntimeobject\n    ProcessFunc := func(obj interface{}) error {\n        // \u6700\u5148\u6536\u5230\u7684\u4e8b\u4ef6\u4f1a\u88ab\u6700\u5148\u5904\u7406\n        for _, d := range obj.(cache.Deltas) {\n            switch d.Type {\n            case cache.Sync, cache.Replaced, cache.Added, cache.Updated:\n                if _, exists, err := store.Get(d.Object); err == nil &amp;&amp; exists {\n                    if err := store.Update(d.Object); err != nil {\n                        return err\n                    }\n                } else {\n                    if err := store.Add(d.Object); err != nil {\n                        return err\n                    }\n                }\n            case cache.Deleted:\n                if err := store.Delete(d.Object); err != nil {\n                    return err\n                }\n            }\n            pods, ok := d.Object.(*corev1.Pod)\n            if !ok {\n                return fmt.Errorf(\"not config: %T\", d.Object)\n            }\n\n            fmt.Printf(\"Type:%s: Name:%s\\n\", d.Type, pods.Name)\n        }\n        return nil\n    }\n\n    fmt.Println(\"Start syncing...\")\n\n    wait.Until(func() {\n        for {\n            _, err := DeleteFIFOQueue.Pop(ProcessFunc)\n            Must(err)\n        }\n    }, time.Second, stopCh)\n}\n</code></pre> <p>\u9996\u5148\u521b\u5efastore\uff0c\u5728\u521b\u5efaDeltaFIFO\uff0c\u4e4b\u540e\u901a\u8fc7\u521d\u59cb\u5316Reflector\uff0c\u5c06DeltaFIFO\u4f5c\u4e3astore\u7a7f\u5165\uff0cReflector\u8fd0\u884c\u8d77\u6765\u540e\uff0c\u5bf9K8s APIserver\u8fdb\u884cListWatch\u64cd\u4f5c\uff0c\u5c06List\u7684\u6570\u636e\u5b58\u50a8\u5230DeltaFIFO\u4e2d\uff0c\u901a\u8fc7\u81ea\u5b9a\u4e49ProcessFunc \u6765\u5bf9DeltaFIFO\u7684\u5143\u7d20\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_4","title":"\u56db \u6d41\u7a0b\u603b\u7ed3","text":"<p>Reflector \u901a\u8fc7 ListAndWatch \u9996\u5148\u83b7\u53d6\u5168\u91cf\u7684\u8d44\u6e90\u5bf9\u8c61\u6570\u636e\uff0c\u7136\u540e\u8c03\u7528 DeltaFIFO \u7684 Replace() \u65b9\u6cd5\u5168\u91cf\u63d2\u5165\u961f\u5217\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u5b9a\u65f6\u540c\u6b65\uff0c\u5219\u5b9a\u65f6\u66f4\u65b0Indexer\u4e2d\u7684\u5185\u5bb9\uff0c\u540e\u7eed\u901a\u8fc7 Watch \u64cd\u4f5c\u6839\u636e\u8d44\u6e90\u5bf9\u8c61\u7684\u64cd\u4f5c\u7c7b\u578b\u8c03\u7528 DeltaFIFO \u7684 Add\u3001Update\u3001Delete \u65b9\u6cd5\u3002\u5bf9\u4e8ePop \u51fa\u6765\u7684\u5143\u7d20\u5982\u4f55\u5904\u7406\uff0c\u5c31\u8981\u770b Pop \u7684\u56de\u8c03\u51fd\u6570 <code>PopProcessFunc</code> \u4e86\u3002 </p>"},{"location":"cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://cloud.tencent.com/developer/article/1692474</li> </ul>"},{"location":"cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"8.Client-go\u6e90\u7801\u5206\u6790\u4e4bInformer","text":""},{"location":"cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>Informer \u662f Client-go \u4e2d\u7684\u4e00\u4e2a\u6838\u5fc3\u5de5\u5177\u5305\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5e26\u6709\u672c\u5730\u7f13\u5b58\u548c\u7d22\u5f15\u673a\u5236\u7684\u3001\u53ef\u4ee5\u6ce8\u518c EventHandler \u7684 client\uff0c\u672c\u5730\u7f13\u5b58\u88ab\u79f0\u4e3a Store\uff0c\u7d22\u5f15\u88ab\u79f0\u4e3a Index\u3002Informer \u4e2d\u4e3b\u8981\u5305\u542b Controller\u3001Reflector\u3001DeltaFIFO\u3001LocalStore\u3001Lister \u548c Processor \u516d\u4e2a\u7ec4\u4ef6\uff0c\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u4eceController\u6765\u8bb2\uff0c\u5355\u72ec\u62ffController\u6765\u5c06\uff0c\u6ce8\u610fInformer\u4e2d\u7684Controller\u548c\u6211\u4eecK8s\u5185\u90e8\u4f20\u7edf\u7684controller\u4e0d\u662f\u4e00\u4e2a\u6982\u5ff5\u3002</p> <p>\u6e90\u56fe\u5730\u5740\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u6253\u5f00\u539f\u56fe\u5b66\u4e60\u3002</p> <p></p>"},{"location":"cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_2","title":"\u4e8c \u5904\u7406\u6d41\u7a0b","text":"<p>\u6211\u4eec\u4eca\u5929\u5c55\u5f00\u7684controller struct\uff0c\u4e0d\u65ad\u4eceDeltaFIFO\u4e2d\u5f39\u51fa\u5bf9\u8c61\uff0c\u5e76\u548c\u5185\u5b58\u5b58\u50a8\u5bf9\u8c61Indexer\u540c\u6b65\uff0c\u968f\u540e\u8c03\u7528\u7528\u6237\u6ce8\u518c\u7684\u56de\u8c03\u51fd\u6570ResourceEventHandlers\u3002</p> <ul> <li>Informer \u9996\u5148\u4f1a list/watch apiserver\uff0cInformer \u6240\u4f7f\u7528\u7684 Reflector \u5305\u8d1f\u8d23\u4e0e apiserver \u5efa\u7acb\u8fde\u63a5\uff0cReflector \u4f7f\u7528 ListAndWatch \u7684\u65b9\u6cd5\uff0c\u4f1a\u5148\u4ece apiserver \u4e2d list \u8be5\u8d44\u6e90\u7684\u6240\u6709\u5b9e\u4f8b\uff0clist \u4f1a\u62ff\u5230\u8be5\u5bf9\u8c61\u6700\u65b0\u7684 resourceVersion\uff0c\u7136\u540e\u4f7f\u7528 watch \u65b9\u6cd5\u76d1\u542c\u8be5 resourceVersion \u4e4b\u540e\u7684\u6240\u6709\u53d8\u5316\uff0c\u82e5\u4e2d\u9014\u51fa\u73b0\u5f02\u5e38\uff0creflector \u5219\u4f1a\u4ece\u65ad\u5f00\u7684 resourceVersion \u5904\u91cd\u73b0\u5c1d\u8bd5\u76d1\u542c\u6240\u6709\u53d8\u5316\uff0c\u4e00\u65e6\u8be5\u5bf9\u8c61\u7684\u5b9e\u4f8b\u6709\u521b\u5efa\u3001\u5220\u9664\u3001\u66f4\u65b0\u52a8\u4f5c\uff0cReflector \u90fd\u4f1a\u6536\u5230\u201d\u4e8b\u4ef6\u901a\u77e5\u201d\uff0c\u8fd9\u65f6\uff0c\u8be5\u4e8b\u4ef6\u53ca\u5b83\u5bf9\u5e94\u7684 API \u5bf9\u8c61\u8fd9\u4e2a\u7ec4\u5408\uff0c\u88ab\u79f0\u4e3a\u589e\u91cf\uff08Delta\uff09\uff0c\u5b83\u4f1a\u88ab\u653e\u8fdb DeltaFIFO \u4e2d\u3002</li> <li>Informer \u4f1a\u4e0d\u65ad\u5730\u4ece\u8fd9\u4e2a DeltaFIFO \u4e2d\u8bfb\u53d6\u589e\u91cf\uff0c\u6bcf\u62ff\u51fa\u4e00\u4e2a\u5bf9\u8c61\uff0cInformer \u5c31\u4f1a\u5224\u65ad\u8fd9\u4e2a\u589e\u91cf\u7684\u65f6\u95f4\u7c7b\u578b\uff0c\u7136\u540e\u521b\u5efa\u6216\u66f4\u65b0\u672c\u5730\u7684\u7f13\u5b58\uff0c\u4e5f\u5c31\u662f store\u3002</li> <li>\u5982\u679c\u4e8b\u4ef6\u7c7b\u578b\u662f Added\uff08\u6dfb\u52a0\u5bf9\u8c61\uff09\uff0c\u90a3\u4e48 Informer \u4f1a\u901a\u8fc7 Indexer \u7684\u5e93\u628a\u8fd9\u4e2a\u589e\u91cf\u91cc\u7684 API \u5bf9\u8c61\u4fdd\u5b58\u5230\u672c\u5730\u7684\u7f13\u5b58\u4e2d\uff0c\u5e76\u4e3a\u5b83\u521b\u5efa\u7d22\u5f15\uff0c\u82e5\u4e3a\u5220\u9664\u64cd\u4f5c\uff0c\u5219\u5728\u672c\u5730\u7f13\u5b58\u4e2d\u5220\u9664\u8be5\u5bf9\u8c61\u3002</li> <li>DeltaFIFO \u518d pop \u8fd9\u4e2a\u4e8b\u4ef6\u5230 controller \u4e2d\uff0ccontroller \u4f1a\u8c03\u7528\u4e8b\u5148\u6ce8\u518c\u7684 ResourceEventHandler \u56de\u8c03\u51fd\u6570\u8fdb\u884c\u5904\u7406\u3002</li> <li>\u5728 ResourceEventHandler \u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u5176\u5b9e\u53ea\u662f\u505a\u4e86\u4e00\u4e9b\u5f88\u7b80\u5355\u7684\u8fc7\u6ee4\uff0c\u7136\u540e\u5c06\u5173\u5fc3\u53d8\u66f4\u7684 Object \u653e\u5230 workqueue \u91cc\u9762\u3002</li> <li>Controller \u4ece workqueue \u91cc\u9762\u53d6\u51fa Object\uff0c\u542f\u52a8\u4e00\u4e2a worker \u6765\u6267\u884c\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u4e1a\u52a1\u903b\u8f91\u901a\u5e38\u662f\u8ba1\u7b97\u76ee\u524d\u96c6\u7fa4\u7684\u72b6\u6001\u548c\u7528\u6237\u5e0c\u671b\u8fbe\u5230\u7684\u72b6\u6001\u6709\u591a\u5927\u7684\u533a\u522b\uff0c\u7136\u540e\u8ba9 apiserver \u5c06\u72b6\u6001\u6f14\u5316\u5230\u7528\u6237\u5e0c\u671b\u8fbe\u5230\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u4e3a deployment \u521b\u5efa\u65b0\u7684 pods\uff0c\u6216\u8005\u662f\u6269\u5bb9/\u7f29\u5bb9 deployment\u3002</li> <li>\u5728worker\u4e2d\u5c31\u53ef\u4ee5\u4f7f\u7528 lister \u6765\u83b7\u53d6 resource\uff0c\u800c\u4e0d\u7528\u9891\u7e41\u7684\u8bbf\u95ee apiserver\uff0c\u56e0\u4e3a apiserver \u4e2d resource \u7684\u53d8\u66f4\u90fd\u4f1a\u53cd\u6620\u5230\u672c\u5730\u7684 cache \u4e2d\u3002</li> </ul>"},{"location":"cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_3","title":"\u4e09 \u6e90\u7801\u5206\u6790","text":"<p>\u6211\u4eec\u4ece\u6e90\u7801\u4e2d\u770b\u5230controller\u5305\u542b\uff0cconfig\u914d\u7f6e\uff0creflecotr\uff0c\u53ca\u9501\uff0c\u5176\u4e2dconfig\u5f88\u91cd\u8981\uff0c\u5305\u542b\u4e86controller\u7684\u8bbe\u7f6e\u3002</p> <pre><code>type controller struct {\n    config         Config\n    reflector      *Reflector\n    reflectorMutex sync.RWMutex\n    clock          clock.Clock\n}\n\n// Config contains all the settings for one of these low-level controllers.\ntype Config struct {\n    // DeltaFIFO\n    Queue\n\n    // ListerWatcher\n    ListerWatcher\n\n    // \u5904\u7406pop\u51fa\u6765\u7684\u5143\u7d20\u65b9\u6cd5\n    Process ProcessFunc\n\n    // \u5177\u4f53\u8d44\u6e90\u5bf9\u8c61\n    ObjectType runtime.Object\n\n    // \u5168\u91cfresync\u5468\u671f\u95f4\u9694\n    FullResyncPeriod time.Duration\n\n    // ShouldResync is periodically used by the reflector to determine\n    // whether to Resync the Queue. If ShouldResync is `nil` or\n    // returns true, it means the reflector should proceed with the\n    // resync.\n    ShouldResync ShouldResyncFunc\n\n    // If true, when Process() returns an error, re-enqueue the object.\n    // TODO: add interface to let you inject a delay/backoff or drop\n    //       the object completely if desired. Pass the object in\n    //       question to this interface as a parameter.  This is probably moot\n    //       now that this functionality appears at a higher level.\n    RetryOnError bool\n\n    // Called whenever the ListAndWatch drops the connection with an error.\n    WatchErrorHandler WatchErrorHandler\n\n    // WatchListPageSize is the requested chunk size of initial and relist watch lists.\n    WatchListPageSize int64\n}\n\ntype Controller interface {\n    // \u8fd0\u884ccontroller\n    Run(stopCh &lt;-chan struct{})\n  // \u5224\u65ad\u662f\u5426\u540c\u6b65\u5b8c\u6210\n    HasSynced() bool\n    // LastSyncResourceVersion delegates to the Reflector when there\n    // is one, otherwise returns the empty string\n  // \u83b7\u53d6\u6700\u540e\u4e00\u6b21\u540c\u6b65\u7684resourceversion\n    LastSyncResourceVersion() string\n}\n</code></pre>"},{"location":"cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#31-newinformer","title":"3.1 newInformer\u521b\u5efa","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5728\u6e90\u7801\u4e2d\u5148\u5355\u72ec\u770b\u770bcontroller\u7684\u5b9e\u73b0\uff0c\u521b\u5efa\u4e00\u4e2aInformer\u9700\u8981\u4f20\u5165ListerWatcher\uff0c\u8d44\u6e90\u5bf9\u8c61\uff0c\u53caResourceEventHandler\uff0c\u4ee5\u53caStore\u3002</p> <pre><code>// client-go/tools/cache/controller.go\nfunc newInformer(\n    lw ListerWatcher,\n    objType runtime.Object,\n    resyncPeriod time.Duration,\n    h ResourceEventHandler,\n    clientState Store,\n) Controller {\n    // \u5b58\u50a8\u8d44\u6e90DeltaFIFO\n    fifo := NewDeltaFIFOWithOptions(DeltaFIFOOptions{\n        KnownObjects:          clientState,\n        EmitDeltaTypeReplaced: true,\n    })\n\n    cfg := &amp;Config{\n        Queue:            fifo,\n        ListerWatcher:    lw,\n        ObjectType:       objType,\n        FullResyncPeriod: resyncPeriod,\n        RetryOnError:     false,\n\n    // \u5bf9\u4f60pop\u51fa\u53bb\u7684\u8d44\u6e90\u8fdb\u884c\u64cd\u4f5c\n        Process: func(obj interface{}) error {\n            // from oldest to newest\n            for _, d := range obj.(Deltas) {\n                switch d.Type {\n                case Sync, Replaced, Added, Updated:\n                    if old, exists, err := clientState.Get(d.Object); err == nil &amp;&amp; exists {\n            // store \u4e2d\u66f4\u65b0\u8d44\u6e90\n                        if err := clientState.Update(d.Object); err != nil {\n                            return err\n                        }\n                        h.OnUpdate(old, d.Object)\n                    } else {\n                        if err := clientState.Add(d.Object); err != nil {\n                            return err\n                        }\n                        h.OnAdd(d.Object)\n                    }\n                case Deleted:\n                    if err := clientState.Delete(d.Object); err != nil {\n                        return err\n                    }\n                    h.OnDelete(d.Object)\n                }\n            }\n            return nil\n        },\n    }\n    return New(cfg)\n}\n</code></pre>"},{"location":"cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#32-run","title":"3.2 Run","text":"<p>controller\u7684run\u51fd\u6570\u5b9e\u9645\u4e0a\u521b\u5efareflector\u4e4b\u540e\u5e76reflector\u4e2d\u7684run\u3002</p> <pre><code>func (c *controller) Run(stopCh &lt;-chan struct{}) {\n    defer utilruntime.HandleCrash()\n    go func() {\n        &lt;-stopCh\n        c.config.Queue.Close()\n    }()\n    r := NewReflector(\n        c.config.ListerWatcher,\n        c.config.ObjectType,\n        c.config.Queue,\n        c.config.FullResyncPeriod,\n    )\n    r.ShouldResync = c.config.ShouldResync\n    r.WatchListPageSize = c.config.WatchListPageSize\n    r.clock = c.clock\n    if c.config.WatchErrorHandler != nil {\n        r.watchErrorHandler = c.config.WatchErrorHandler\n    }\n\n    c.reflectorMutex.Lock()\n    c.reflector = r\n    c.reflectorMutex.Unlock()\n\n    var wg wait.Group\n  // \u8fd0\u884creflector\u7684run\u51fd\u6570\n    wg.StartWithChannel(stopCh, r.Run)\n  // \u4ece\u961f\u5217\u4e2dpop\u5bf9\u8c61\u8d44\u6e90\u5e76\u8fdb\u884c\u5904\u7406\n    wait.Until(c.processLoop, time.Second, stopCh)\n    wg.Wait()\n}\n// \u4eceDeltaFIFO\u4e2d\u5f39\u51fa\u5143\u7d20\uff0c\u901a\u8fc7\u7528\u6237\u7a7f\u5165\u7684PopProcessFunc\u8fdb\u884c\u5904\u7406\nfunc (c *controller) processLoop() {\n    for {\n        obj, err := c.config.Queue.Pop(PopProcessFunc(c.config.Process))\n        if err != nil {\n            if err == ErrFIFOClosed {\n                return\n            }\n            if c.config.RetryOnError {\n                // This is the safe way to re-enqueue.\n                c.config.Queue.AddIfNotPresent(obj)\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#33-hassynced","title":"3.3 HasSynced","text":"<p>\u5176\u5b9e\u662f\u8c03\u7528FIFO\u4e2d\u7684\uff0c\u5224\u65ad\u88ab\u63d2\u5165\u7684\u8d44\u6e90\u88abpop\u5904\u7406\u5b8c\u6210\uff0c\u8fd4\u56detrue</p> <pre><code>// Returns true once this controller has completed an initial resource listing\nfunc (c *controller) HasSynced() bool {\n    return c.config.Queue.HasSynced()\n}\n</code></pre>"},{"location":"cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_4","title":"\u56db \u5c0f\u8bd5\u725b\u5200","text":"<pre><code>func Must(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n// \u751f\u6210clientset\nfunc InitClientSet() *kubernetes.Clientset {\n    configFlags := genericclioptions.NewConfigFlags(false)\n    restConfig, err := configFlags.ToRESTConfig()\n    Must(err)\n    return kubernetes.NewForConfigOrDie(restConfig)\n}\n\nfunc main() {\n    clientSet := InitClientSet()\n  // \u6784\u9020pod listwatcher\n    podlw := cache.NewListWatchFromClient(clientSet.CoreV1().RESTClient(), \"pods\", \"default\", fields.Everything())\n  // \u751f\u6210PodInformer\uff0c\u6dfb\u52a0\u4e8b\u4ef6\uff0c\u5728\u6b64\u4e8b\u4ef6\u4ec5\u4ec5\u662f\u6253\u5370\u51fapod\u5bf9\u8c61\u540d\u79f0\n    _, controller := cache.NewInformer(podlw, &amp;corev1.Pod{}, 0, cache.ResourceEventHandlerFuncs{\n        AddFunc: func(obj interface{}) {\n            podObj, _ := obj.(*corev1.Pod)\n            fmt.Println(\"addfunc\", podObj.GetName())\n        },\n        UpdateFunc: func(oldObj, newObj interface{}) {\n            oldpodObj, _ := oldObj.(*corev1.Pod)\n            newpodObj, _ := oldObj.(*corev1.Pod)\n            fmt.Println(\"addfunc\", newpodObj.GetName())\n            fmt.Println(\"addfunc\", oldpodObj.GetName())\n        },\n        DeleteFunc: func(obj interface{}) {\n            podObj, _ := obj.(*corev1.Pod)\n            fmt.Println(\"deletefunc\", podObj.GetName())\n        },\n    })\n\n    stopCh := make(chan struct{})\n    defer close(stopCh)\n    go controller.Run(stopCh)\n\n    cache.WaitForCacheSync(stopCh, controller.HasSynced)\n\n    &lt;-stopCh\n}\n</code></pre> <p>Informer\u5e2e\u6211\u4eec\u505a\u4e86\u9488\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684\u5bf9\u8c61\u64cd\u4f5c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5173\u7cfbHandler\uff0c\u5728\u540c\u6b65\u5468\u671f\u4e2d\u5982\u679c\u8bbe\u7f6e\u975e0\uff0c\u5219\u5b9a\u65f6\u540c\u6b65\u4e2d\u4f1a\u4ea7\u751fSYNC\u4e8b\u4ef6\uff0c\u89e6\u53d1updateFunc\u64cd\u4f5c\u3002</p>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"9.Client-go\u6e90\u7801\u5206\u6790\u4e4bSharedInformer","text":""},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u4e0a\u7bc7\u5355\u72ec\u5c31Informer\u4e2d\u7684controller\u6765\u770b\uff0cprocessFunc\u4ee5\u4e00\u4e2a\u53c2\u6570\u5355\u72ec\u7a7f\u5165NewInformer\u4e2d\uff0c\u5982\u679c\u6709\u53e6\u4e00\u4e2a\u7a0b\u5e8f\u9700\u8981\u5904\u7406\u76f8\u540c\u7684\u8d44\u6e90\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u53e6\u5916\u518d\u521b\u5efa\u4e00\u4e2aInformer\u5bf9\u8c61\uff0c\u800c\u961f\u5217\u4e5f\u65e0\u6cd5\u590d\u7528\uff0c\u961f\u5217\u4e0d\u80fd\u88ab\u4e24\u4e2a\u6d88\u8d39\u8005\u540c\u65f6\u6d88\u8d39\uff0c\u56e0\u6b64\u5728Client-go\u4e2d\u53c8\u8bbe\u8ba1\u6709ShareInformer\uff0c\u540e\u7eed\u7684\u793a\u4f8b\u5305\u62ecK8s\u7684\u63a7\u5236\u5668\u4e2d\u4e5f\u90fd\u9002\u7528\u7684\u662f\u6b64\u7c7b\u5171\u4eab\u578b\u7684\u5bf9\u8c61\u3002</p>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_2","title":"\u4e8c \u76f8\u5173\u6982\u5ff5","text":""},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#21-informer","title":"2.1 \u8d44\u6e90Informer","text":"<ul> <li>\u6bcf\u4e00\u79cd\u8d44\u6e90\u90fd\u5b9e\u73b0\u4e86Informer\u673a\u5236\uff0c\u5141\u8bb8\u76d1\u63a7\u4e0d\u540c\u7684\u8d44\u6e90\u4e8b\u4ef6</li> <li>\u6bcf\u4e00\u4e2aInformer\u90fd\u4f1a\u5b9e\u73b0Informer\u548cLister\u65b9\u6cd5</li> </ul> <pre><code>type PodInformer interface {\n  Informer() cache.SharedIndexInformer\n  Lister() v1.PodLister\n}\n</code></pre>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#22-sharedinformer","title":"2.2 SharedInformer","text":"<p>\u82e5\u540c\u4e00\u4e2a\u8d44\u6e90\u7684Informer\u88ab\u5b9e\u4f8b\u5316\u4e86\u591a\u6b21\uff0c\u6bcf\u4e2aInformer\u4f7f\u7528\u4e00\u4e2aReflector\uff0c\u90a3\u4e48\u4f1a\u8fd0\u884c\u8fc7\u591a\u76f8\u540c\u7684ListAndWatch\uff0c\u592a\u591a\u91cd\u590d\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\u4f1a\u5bfc\u81f4api-server\u8d1f\u8f7d\u8fc7\u91cd</p> <p>SharedInformer\u53ef\u4ee5\u4f7f\u540c\u4e00\u7c7b\u8d44\u6e90Informer\u5171\u4eab\u4e00\u4e2aReflector\u3002\u5185\u90e8\u5b9a\u4e49\u4e86\u4e00\u4e2amap\u5b57\u6bb5\uff0c\u7528\u4e8e\u5b58\u653e\u6240\u6709Infromer\u7684\u5b57\u6bb5\u3002</p> <p>\u901a\u5e38\u4f1a\u4f7f\u7528informerFactory\u6765\u7ba1\u7406\u63a7\u5236\u5668\u9700\u8981\u7684\u591a\u4e2a\u8d44\u6e90\u5bf9\u8c61\u7684informer\u5b9e\u4f8b\uff0c\u4f8b\u5982\u521b\u5efa\u4e00\u4e2adeployment\u7684Informer</p> <pre><code>// \u521b\u5efa\u4e00\u4e2ainformer factory\nsharedInformerFactory := informers.NewSharedInformerFactory(clientSet, 0)\n// factory\u5df2\u7ecf\u4e3a\u6240\u6709k8s\u7684\u5185\u7f6e\u8d44\u6e90\u5bf9\u8c61\u63d0\u4f9b\u4e86\u521b\u5efa\u5bf9\u5e94informer\u5b9e\u4f8b\u7684\u65b9\u6cd5\uff0c\u8c03\u7528\u5177\u4f53informer\u5b9e\u4f8b\u7684Lister\u6216Informer\u65b9\u6cd5\n// \u5c31\u5b8c\u6210\u4e86\u5c06informer\u6ce8\u518c\u5230factory\u7684\u8fc7\u7a0b\ndeploymentLister := sharedInformerFactory.Apps().V1().Deployments().Lister()\n// \u542f\u52a8\u6ce8\u518c\u5230factory\u7684\u6240\u6709informer\nkubeInformerFactory.Start(stopCh)\n</code></pre> <p>SharedInformer\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u5305\u542b\u6dfb\u52a0\u4e8b\u4ef6\uff0c\u5f53\u6709\u8d44\u6e90\u53d8\u5316\u65f6\uff0c\u4f1a\u56de\u6389\u901a\u77e5\u4f7f\u7528\u8005\uff0c\u542f\u52a8\u51fd\u6570\u53ca\u83b7\u53d6\u662f\u5426\u5168\u5229\u537f\u5bf9\u8c61\u5df2\u7ecf\u540c\u6b65\u5230\u672c\u5730\u5b58\u50a8\u4e2d\u3002</p> <pre><code>type SharedInformer interface {\n    // \u6dfb\u52a0\u8d44\u6e90\u4e8b\u4ef6\u5904\u7406\u5668\uff0c\u5f53\u6709\u8d44\u6e90\u53d8\u5316\u65f6\u5c31\u4f1a\u901a\u8fc7\u56de\u8c03\u901a\u77e5\u4f7f\u7528\u8005\n    AddEventHandler(handler ResourceEventHandler)\n    AddEventHandlerWithResyncPeriod(handler ResourceEventHandler, resyncPeriod time.Duration)\n\n    // \u83b7\u53d6\u4e00\u4e2a Store \u5bf9\u8c61\n    GetStore() Store\n    // \u4e3b\u8981\u662f\u7528\u6765\u5c06 Reflector \u548c DeltaFIFO \u7ec4\u5408\u5230\u4e00\u8d77\u5de5\u4f5c\n    GetController() Controller\n\n    // SharedInformer \u7684\u6838\u5fc3\u5b9e\u73b0\uff0c\u542f\u52a8\u5e76\u8fd0\u884c\u8fd9\u4e2a SharedInformer\n    // \u5f53 stopCh \u5173\u95ed\u65f6\u5019\uff0cinformer \u624d\u4f1a\u9000\u51fa\n    Run(stopCh &lt;-chan struct{})\n\n    // \u544a\u8bc9\u4f7f\u7528\u8005\u5168\u91cf\u7684\u5bf9\u8c61\u662f\u5426\u5df2\u7ecf\u540c\u6b65\u5230\u4e86\u672c\u5730\u5b58\u50a8\u4e2d\n    HasSynced() bool\n    // \u6700\u65b0\u540c\u6b65\u8d44\u6e90\u7684\u7248\u672c\n    LastSyncResourceVersion() string\n}\n\n// SharedIndexInformer\u5728SharedInformer\u57fa\u7840\u4e0a\u6269\u5c55\u4e86\u6dfb\u52a0\u548c\u83b7\u53d6Indexers\u7684\u80fd\u529b\ntype SharedIndexInformer interface {\n    SharedInformer\n    // \u5728\u542f\u52a8\u4e4b\u524d\u6dfb\u52a0 indexers \u5230 informer \u4e2d\n    AddIndexers(indexers Indexers) error\n    GetIndexer() Indexer\n}\n</code></pre>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_3","title":"\u4e09 \u6e90\u7801\u5206\u6790","text":""},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#31-sharedinformerfactory","title":"3.1 SharedInformerFactory","text":"<p>SharedInformerFactory \u4e3a\u6240\u6709\u5df2\u77e5 API \u7ec4\u7248\u672c\u4e2d\u7684\u8d44\u6e90\u63d0\u4f9b\u5171\u4eabinformer</p> <pre><code>type SharedInformerFactory interface {\n    internalinterfaces.SharedInformerFactory\n    ForResource(resource schema.GroupVersionResource) (GenericInformer, error)\n    WaitForCacheSync(stopCh &lt;-chan struct{}) map[reflect.Type]bool\n\n    Admissionregistration() admissionregistration.Interface\n    Internal() apiserverinternal.Interface\n    Apps() apps.Interface\n    Autoscaling() autoscaling.Interface\n    Batch() batch.Interface\n    Certificates() certificates.Interface\n    Coordination() coordination.Interface\n    Core() core.Interface\n    Discovery() discovery.Interface\n    Events() events.Interface\n    Extensions() extensions.Interface\n    Flowcontrol() flowcontrol.Interface\n    Networking() networking.Interface\n    Node() node.Interface\n    Policy() policy.Interface\n    Rbac() rbac.Interface\n    Scheduling() scheduling.Interface\n    Storage() storage.Interface\n}\n</code></pre> <p>\u8fd9\u91cc\u7684informer\u5b9e\u73b0\u662fshareIndexInformer NewSharedInformerFactory\u8c03\u7528\u4e86NewSharedInformerFactoryWithOptions\uff0c\u5c06\u8fd4\u56de\u4e00\u4e2asharedInformerFactory\u5bf9\u8c61</p> <pre><code>type sharedInformerFactory struct {\n    client           kubernetes.Interface\n  //\u5173\u6ce8\u7684namepace\uff0c\u53ef\u4ee5\u901a\u8fc7WithNamespace Option\u914d\u7f6e\n    namespace        string\n    tweakListOptions internalinterfaces.TweakListOptionsFunc\n    lock             sync.Mutex\n    defaultResync    time.Duration\n    customResync     map[reflect.Type]time.Duration\n  //\u9488\u5bf9\u6bcf\u79cd\u7c7b\u578b\u8d44\u6e90\u5b58\u50a8\u4e00\u4e2ainformer\uff0cinformer\u7684\u7c7b\u578b\u662fShareIndexInformer\n    informers map[reflect.Type]cache.SharedIndexInformer\n    // startedInformers is used for tracking which informers have been started.\n    // This allows Start() to be called multiple times safely.\n    startedInformers map[reflect.Type]bool\n}\n\n// SharedInformerFactory \u6784\u9020\u65b9\u6cd5\nfunc NewSharedInformerFactoryWithOptions(client kubernetes.Interface, defaultResync time.Duration, options ...SharedInformerOption) SharedInformerFactory {\n    factory := &amp;sharedInformerFactory{\n        client:           client,\n        namespace:        v1.NamespaceAll,\n        defaultResync:    defaultResync,\n    // \u521d\u59cb\u5316map\n        informers:        make(map[reflect.Type]cache.SharedIndexInformer),\n        startedInformers: make(map[reflect.Type]bool),\n        customResync:     make(map[reflect.Type]time.Duration),\n    }\n\n    // Apply all options\n    for _, opt := range options {\n        factory = opt(factory)\n    }\n\n    return factory\n}\n</code></pre>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#32-start","title":"3.2 Start","text":"<p>\u542f\u52a8factory\u4e0b\u7684\u6240\u6709informer\uff0c\u5176\u5b9e\u5c31\u662f\u542f\u52a8\u6bcf\u4e2ainformer\u4e2d\u7684Reflector</p> <pre><code>// Start initializes all requested informers.\nfunc (f *sharedInformerFactory) Start(stopCh &lt;-chan struct{}) {\n    f.lock.Lock()\n    defer f.lock.Unlock()\n  // \u542f\u52a8informers\u4e2d\u6240\u6709informer\n    for informerType, informer := range f.informers {\n        if !f.startedInformers[informerType] {\n            go informer.Run(stopCh)\n            f.startedInformers[informerType] = true\n        }\n    }\n}\n</code></pre>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#33-waitforcachesync","title":"3.3 WaitForCacheSync","text":"<ul> <li>sharedInformerFactory\u7684WaitForCacheSync\u5c06\u4f1a\u4e0d\u65ad\u8c03\u7528factory\u6301\u6709\u7684\u6240\u6709informer\u7684HasSynced\u65b9\u6cd5\uff0c\u76f4\u5230\u8fd4\u56detrue</li> <li>\u800cinformer\u7684HasSynced\u65b9\u6cd5\u8c03\u7528\u7684\u81ea\u5df1\u6301\u6709\u7684controller\u7684HasSynced\u65b9\u6cd5\uff08informer\u7ed3\u6784\u6301\u6709controller\u5bf9\u8c61\uff0c\u4e0b\u6587\u4f1a\u5206\u6790informer\u7684\u7ed3\u6784\uff09</li> <li>informer\u4e2d\u7684controller\u7684HasSynced\u65b9\u6cd5\u5219\u8c03\u7528\u7684\u662fcontroller\u6301\u6709\u7684deltaFIFO\u5bf9\u8c61\u7684HasSynced\u65b9\u6cd5</li> </ul> <p>\u4e5f\u5c31\u8bf4sharedInformerFactory\u7684WaitForCacheSync\u65b9\u6cd5\u5224\u65adinformer\u7684cache\u662f\u5426\u540c\u6b65\uff0c\u6700\u7ec8\u770b\u7684\u662finformer\u4e2d\u7684deltaFIFO\u662f\u5426\u540c\u6b65\u4e86\u3002</p> <pre><code>func (f *sharedInformerFactory) WaitForCacheSync(stopCh &lt;-chan struct{}) map[reflect.Type]bool {\n    informers := func() map[reflect.Type]cache.SharedIndexInformer {\n        f.lock.Lock()\n        defer f.lock.Unlock()\n\n        informers := map[reflect.Type]cache.SharedIndexInformer{}\n        for informerType, informer := range f.informers {\n            if f.startedInformers[informerType] {\n                informers[informerType] = informer\n            }\n        }\n        return informers\n    }()\n\n    res := map[reflect.Type]bool{}\n    for informType, informer := range informers {\n    // \u8c03\u7528Informer\u4e2d\u7684HasSynced\n        res[informType] = cache.WaitForCacheSync(stopCh, informer.HasSynced)\n    }\n    return res\n}\n</code></pre>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#34-informerfor","title":"3.4 InformerFor","text":"<p>\u53ea\u6709\u5411factory\u4e2d\u6dfb\u52a0informer\uff0cfactory\u624d\u6709\u610f\u4e49\uff0cobj: informer\u5173\u6ce8\u7684\u8d44\u6e90\u5982deployment{} newFunc: \u4e00\u4e2a\u77e5\u9053\u5982\u4f55\u521b\u5efa\u6307\u5b9ainformer\u7684\u65b9\u6cd5\uff0ck8s\u4e3a\u6bcf\u4e00\u4e2a\u5185\u7f6e\u7684\u5bf9\u8c61\u90fd\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u6bd4\u5982\u521b\u5efadeployment\u7684ShareIndexInformer\u7684\u65b9\u6cd5</p> <pre><code>func (f *sharedInformerFactory) InformerFor(obj runtime.Object, newFunc internalinterfaces.NewInformerFunc) cache.SharedIndexInformer {\n    f.lock.Lock()\n    defer f.lock.Unlock()\n  // \u83b7\u53d6\u5bf9\u8c61\u7c7b\u578b\n    informerType := reflect.TypeOf(obj)\n    informer, exists := f.informers[informerType]\n    if exists {\n        return informer\n    }\n\n    resyncPeriod, exists := f.customResync[informerType]\n    if !exists {\n        resyncPeriod = f.defaultResync\n    }\n  // \u6839\u636e\u7528\u6237\u4f20\u5165\u7684informer\u751f\u6210\u65b9\u6cd5\u751f\u6210informer\n    informer = newFunc(f.client, resyncPeriod)\n  // \u5c06informer\u6dfb\u52a0\u8fdbSharedIndexInformer\n    f.informers[informerType] = informer\n\n    return informer\n}\n</code></pre> <p>shareIndexInformer\u5bf9\u5e94\u7684newFunc\u7684\u5b9e\u73b0\uff0cclient-go\u4e2d\u5df2\u7ecf\u4e3a\u6240\u6709\u5185\u7f6e\u5bf9\u8c61\u90fd\u63d0\u4f9b\u4e86NewInformerFunc\uff0c\u4f8b\u5982podinformer\u3002</p> <pre><code>// podinformer \u63a5\u53e3\uff0c\u5305\u542bInformer/Lister\u4e24\u4e2a\u65b9\u6cd5\ntype PodInformer interface {\n    Informer() cache.SharedIndexInformer\n    Lister() v1.PodLister\n}\n\n// podInformer\u7ed3\u6784\u4f53\uff0c\u5305\u542bSharedInformerFactory\u63a5\u53e3\u548cns\ntype podInformer struct {\n    factory          internalinterfaces.SharedInformerFactory\n    tweakListOptions internalinterfaces.TweakListOptionsFunc\n    namespace        string\n}\n\nfunc NewPodInformer(client kubernetes.Interface, namespace string, resyncPeriod time.Duration, indexers cache.Indexers) cache.SharedIndexInformer {\n    return NewFilteredPodInformer(client, namespace, resyncPeriod, indexers, nil)\n}\n\n// \u771f\u6b63\u751f\u6210SharedIndexInformer\uff0c\u5728\u5176\u4e2d\u6dfb\u52a0\u4e86eventHandler\nfunc NewFilteredPodInformer(client kubernetes.Interface, namespace string, resyncPeriod time.Duration, indexers cache.Indexers, tweakListOptions internalinterfaces.TweakListOptionsFunc) cache.SharedIndexInformer {\n    return cache.NewSharedIndexInformer(\n        &amp;cache.ListWatch{\n            ListFunc: func(options metav1.ListOptions) (runtime.Object, error) {\n                if tweakListOptions != nil {\n                    tweakListOptions(&amp;options)\n                }\n                return client.CoreV1().Pods(namespace).List(context.TODO(), options)\n            },\n            WatchFunc: func(options metav1.ListOptions) (watch.Interface, error) {\n                if tweakListOptions != nil {\n                    tweakListOptions(&amp;options)\n                }\n                return client.CoreV1().Pods(namespace).Watch(context.TODO(), options)\n            },\n        },\n        &amp;corev1.Pod{},\n        resyncPeriod,\n        indexers,\n    )\n}\n\nfunc (f *podInformer) defaultInformer(client kubernetes.Interface, resyncPeriod time.Duration) cache.SharedIndexInformer {\n    return NewFilteredPodInformer(client, f.namespace, resyncPeriod, cache.Indexers{cache.NamespaceIndex: cache.MetaNamespaceIndexFunc}, f.tweakListOptions)\n}\n\nfunc (f *podInformer) Informer() cache.SharedIndexInformer {\n    return f.factory.InformerFor(&amp;corev1.Pod{}, f.defaultInformer)\n}\n\nfunc (f *podInformer) Lister() v1.PodLister {\n    return v1.NewPodLister(f.Informer().GetIndexer())\n}\n</code></pre> <p>\u8c03\u7528sharedInformerFactory.Core().V1().Pods()\uff0c\u5c31\u6389\u7528\u4e86podInformer\u6784\u9020\u51fd\u6570\uff0c\u751f\u6210Podinformer\u5bf9\u8c61\u3002</p> <pre><code>// Pods returns a PodInformer.\nfunc (v *version) Pods() PodInformer {\n   return &amp;podInformer{factory: v.factory, namespace: v.namespace, tweakListOptions: v.tweakListOptions}\n}\n</code></pre> <p>cache \u5305\u66b4\u9732\u7684 Informer \u521b\u5efa\u65b9\u6cd5\u6709\u4ee5\u4e0b 5 \u4e2a\uff1a</p> <ul> <li>New</li> <li>NewInformer</li> <li>NewIndexerInformer</li> <li>NewSharedInformer</li> <li>NewSharedIndexInformer</li> </ul> <p>\u5b83\u4eec\u6709\u7740\u4e0d\u540c\u7a0b\u5ea6\u7684\u62bd\u8c61\u548c\u5c01\u88c5\uff0cNewSharedIndexInformer \u662f\u5176\u4e2d\u62bd\u8c61\u7a0b\u5ea6\u6700\u4f4e\uff0c\u5c01\u88c5\u7a0b\u5ea6\u6700\u9ad8\u7684\u4e00\u4e2a\uff0c\u4f46\u5373\u4f7f\u662f NewSharedIndexInformer\uff0c\u4e5f\u6ca1\u6709\u5c01\u88c5\u5177\u4f53\u7684\u8d44\u6e90\u7c7b\u578b\uff0c\u9700\u8981\u63a5\u6536 ListerWatcher \u548c Indexers \u4f5c\u4e3a\u53c2\u6570\uff1a</p> <pre><code>func NewSharedIndexInformer(\n    lw ListerWatcher,\n    exampleObject runtime.Object,\n    defaultEventHandlerResyncPeriod time.Duration,\n    indexers Indexers,\n) SharedIndexInformer {}\n</code></pre>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#35-sharedprocessor","title":"3.5 sharedProcessor","text":"<p>sharedProcessor \u6709\u4e00\u4e2aprocessorListener \u7684\u96c6\u5408\uff0c\u53ef\u4ee5\u5c06\u4e00\u4e2a\u901a\u77e5\u5bf9\u8c61\u5206\u53d1\u7ed9\u5b83\u7684\u76d1\u542c\u5668\u3002\u6709\u4e24\u79cd\u5206\u53d1\u64cd\u4f5c\u3002\u540c\u6b65\u5206\u53d1\u5230\u4fa6\u542c\u5668\u7684\u5b50\u96c6\uff0c(a) \u5728\u5076\u5c14\u8c03\u7528 shouldResync \u65f6\u91cd\u65b0\u8ba1\u7b97\uff0c(b) \u6bcf\u4e2a\u4fa6\u542c\u5668\u6700\u521d\u90fd\u88ab\u653e\u5165\u3002\u975e\u540c\u6b65\u5206\u53d1\u5230\u6bcf\u4e2a\u4fa6\u542c\u5668\u3002\u5728SharedInformer\u4e2d\u6709\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u5c5e\u6027sharedProcessor\uff0c\u5176\u5305\u542b\u4e86processorListener\uff0c\u6765\u901a\u77e5\u4ecesharedProcessor\u5230ResourceEventHandler\uff0c\u5176\u4f7f\u7528\u4e24\u4e2a\u65e0\u7f13\u51b2chanel\uff0c\u4e24\u4e2agoroutines\u548c\u4e00\u4e2a\u65e0\u754c\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u4e00\u4e2a goroutine \u8fd0\u884c <code>pop()</code>\uff0c\u5b83\u4f7f\u7528\u73af\u5f62\u7f13\u51b2\u533a\u4e2d\u7684\u5b58\u50a8\u5c06\u901a\u77e5\u4ece <code>addCh</code> \u6cf5\u5230 <code>nextCh</code>\uff0c\u800c <code>nextCh</code> \u6ca1\u6709\u8ddf\u4e0a\u3002\u53e6\u4e00\u4e2a goroutine \u8fd0\u884c <code>run()</code>\uff0c\u5b83\u63a5\u6536\u6765\u81ea <code>nextCh</code> \u7684\u901a\u77e5\u5e76\u540c\u6b65\u8c03\u7528\u9002\u5f53\u7684\u5904\u7406\u7a0b\u5e8f\u65b9\u6cd5\u3002</p> <pre><code>type sharedProcessor struct {\n  // \u6240\u6709processor\u662f\u5426\u90fd\u5df2\u7ecf\u542f\u52a8\n   listenersStarted bool\n   listenersLock    sync.RWMutex\n   // \u901a\u7528\u5904\u7406\u5217\u8868\n   listeners        []*processorListener\n   // \u5b9a\u65f6\u540c\u6b65\u7684\u5904\u7406\u5217\u8868\n   syncingListeners []*processorListener\n   clock            clock.Clock\n   wg               wait.Group\n}\n\n// processorListener \u901a\u77e5\ntype processorListener struct {\n    nextCh chan interface{}\n    addCh  chan interface{}  // \u6dfb\u52a0\u4e8b\u4ef6\u7684\u901a\u9053\n\n    handler ResourceEventHandler\n\n    // pendingNotifications \u662f\u4e00\u4e2a\u65e0\u8fb9\u754c\u7684\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u7528\u4e8e\u4fdd\u5b58\u6240\u6709\u5c1a\u672a\u5206\u53d1\u7684\u901a\u77e5\n    pendingNotifications buffer.RingGrowing\n\n    requestedResyncPeriod time.Duration\n\n    resyncPeriod time.Duration\n\n    nextResync time.Time\n\n    resyncLock sync.Mutex\n}\n</code></pre> <ul> <li>add\uff1a\u4e8b\u4ef6\u6dfb\u52a0\u901a\u8fc7addCh\u901a\u9053\u63a5\u53d7\uff0cnotification\u5c31\u662f\u4e8b\u4ef6\uff0c\u4e5f\u5c31\u662f\u4eceDeltaFIFO\u5f39\u51fa\u7684Deltas\uff0caddCh\u662f\u4e00\u4e2a\u65e0\u7f13\u51b2\u901a\u9053\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c06\u5176\u770b\u4f5c\u4e00\u4e2a\u4e8b\u4ef6\u5206\u53d1\u5668\uff0c\u4eceDeltaFIFO\u5f39\u51fa\u7684\u5bf9\u8c61\u9700\u8981\u9010\u4e00\u9001\u5230\u591a\u4e2a\u5904\u7406\u5668\uff0c\u5982\u679c\u5904\u7406\u5668\u6ca1\u6709\u53ca\u65f6\u5904\u7406addCh\u5219\u4f1a\u88ab\u963b\u585e\u3002</li> </ul> <pre><code>func (p *processorListener) add(notification interface{}) {\n    p.addCh &lt;- notification\n}\n</code></pre> <ul> <li>pop\uff1a\u5229\u7528golang select\u6765\u540c\u65f6\u5904\u7406\u591a\u4e2achannel\uff0c\u76f4\u5230\u81f3\u5c11\u6709\u4e00\u4e2acase\u8868\u8fbe\u5f0f\u6ee1\u8db3\u6761\u4ef6\u4e3a\u6b62\u3002</li> </ul> <pre><code>func (p *processorListener) pop() {\n    defer utilruntime.HandleCrash()\n  // \u901a\u77e5run\u505c\u6b62\u51fd\u6570\u8fd0\u884c\n    defer close(p.nextCh) // Tell .run() to stop\n\n    var nextCh chan&lt;- interface{}\n    var notification interface{}\n    for {\n        select {\n    // \u7531\u4e8enextCh\u8fd8\u6ca1\u6709\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u5728\u6b64\u4f1azuse\n        case nextCh &lt;- notification:\n            // \u901a\u77e5\u5206\u53d1\uff0c\n            var ok bool\n            notification, ok = p.pendingNotifications.ReadOne()\n            if !ok { // \u6ca1\u6709\u4e8b\u4ef6\u88abPop\uff0c\u5219\u8bbe\u7f6enextCh\u4e3anil\n                nextCh = nil // Disable \u8fd9\u4e2a select\u7684 case\n            }\n    // \u4ecep.addCh \u4e2d\u8bfb\u53d6\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u6d88\u8d39addCh\n        case notificationToAdd, ok := &lt;-p.addCh:\n            if !ok { // \u5982\u679c\u5173\u95ed\u5219\u76f4\u63a5\u9000\u51fa\n                return\n            }\n      // pendingNotifications \u4e3a\u7a7a\uff0c\u5219\u8bf4\u660e\u6ca1\u6709notification \u53bbpop\n            if notification == nil { \n                // \u628a\u521a\u521a\u83b7\u53d6\u7684\u4e8b\u4ef6\u901a\u8fc7 p.nextCh \u53d1\u9001\u7ed9\u5904\u7406\u5668\n                notification = notificationToAdd\n                nextCh = p.nextCh\n            } else { \n        // \u4e0a\u4e00\u4e2a\u4e8b\u4ef6\u8fd8\u6ca1\u53d1\u9001\u5b8c\u6210\uff08\u5df2\u7ecf\u6709\u4e00\u4e2a\u901a\u77e5\u7b49\u5f85\u53d1\u9001\uff09\uff0c\u5c31\u5148\u653e\u5230\u7f13\u51b2\u901a\u9053\u4e2d\n                p.pendingNotifications.WriteOne(notificationToAdd)\n            }\n        }\n    }\n}\n</code></pre> <p>run() \u548c pop() \u662f processorListener \u7684\u4e24\u4e2a\u6700\u6838\u5fc3\u7684\u51fd\u6570\uff0cprocessorListener \u5c31\u662f\u5b9e\u73b0\u4e86\u4e8b\u4ef6\u7684\u7f13\u51b2\u548c\u5904\u7406\uff0c\u5728\u6ca1\u6709\u4e8b\u4ef6\u7684\u65f6\u5019\u53ef\u4ee5\u963b\u585e\u5904\u7406\u5668\uff0c\u5f53\u4e8b\u4ef6\u8f83\u591a\u662f\u53ef\u4ee5\u628a\u4e8b\u4ef6\u7f13\u51b2\u8d77\u6765\uff0c\u5b9e\u73b0\u4e86\u4e8b\u4ef6\u5206\u53d1\u5668\u4e0e\u5904\u7406\u5668\u7684\u5f02\u6b65\u5904\u7406\u3002processorListener \u7684 run() \u548c pop() \u51fd\u6570\u5176\u5b9e\u90fd\u662f\u901a\u8fc7 sharedProcessor \u542f\u52a8\u7684\u534f\u7a0b\u6765\u8c03\u7528\u7684\uff0c\u6240\u4ee5\u4e0b\u9762\u6211\u4eec\u518d\u6765\u5bf9 sharedProcessor \u8fdb\u884c\u5206\u6790\u4e86\u3002\u9996\u5148\u770b\u4e0b\u5982\u4f55\u6dfb\u52a0\u4e00\u4e2a processorListener\uff1a</p> <pre><code>// \u6dfb\u52a0\u5904\u7406\u5668\nfunc (p *sharedProcessor) addListener(listener *processorListener) {\n    p.listenersLock.Lock()  // \u52a0\u9501\n    defer p.listenersLock.Unlock()\n  // \u8c03\u7528 addListenerLocked \u51fd\u6570\n    p.addListenerLocked(listener)\n  // \u5982\u679c\u4e8b\u4ef6\u5904\u7406\u5217\u8868\u4e2d\u7684\u5904\u7406\u5668\u5df2\u7ecf\u542f\u52a8\u4e86\uff0c\u5219\u624b\u52a8\u542f\u52a8\u4e0b\u9762\u7684\u4e24\u4e2a\u534f\u7a0b\n  // \u76f8\u5f53\u4e8e\u542f\u52a8\u540e\u4e86\n    if p.listenersStarted {  \n    // \u901a\u8fc7 wait.Group \u542f\u52a8\u4e24\u4e2a\u534f\u7a0b\uff0c\u5c31\u662f\u4e0a\u9762\u6211\u4eec\u63d0\u5230\u7684 run \u548c pop \u51fd\u6570\n        p.wg.Start(listener.run)\n        p.wg.Start(listener.pop)\n    }\n}\n\n// \u5c06\u5904\u7406\u5668\u6dfb\u52a0\u5230\u5904\u7406\u5668\u7684\u5217\u8868\u4e2d\nfunc (p *sharedProcessor) addListenerLocked(listener *processorListener) {\n  // \u6dfb\u52a0\u5230\u901a\u7528\u5904\u7406\u5668\u5217\u8868\u4e2d\n    p.listeners = append(p.listeners, listener)  \n  // \u6dfb\u52a0\u5230\u9700\u8981\u5b9a\u65f6\u540c\u6b65\u7684\u5904\u7406\u5668\u5217\u8868\u4e2d\n    p.syncingListeners = append(p.syncingListeners, listener)\n}\n</code></pre> <p>\u8fd9\u91cc\u6dfb\u52a0\u5904\u7406\u5668\u7684\u51fd\u6570 addListener \u5176\u5b9e\u5728 sharedIndexInformer \u4e2d\u7684 AddEventHandler \u51fd\u6570\u4e2d\u5c31\u4f1a\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u6765\u6dfb\u52a0\u5904\u7406\u5668\u3002\u7136\u540e\u5c31\u662f\u4e8b\u4ef6\u5206\u53d1\u7684\u51fd\u6570\u5b9e\u73b0\uff1a</p> <pre><code>func (p *sharedProcessor) distribute(obj interface{}, sync bool) {\n    p.listenersLock.RLock()\n    defer p.listenersLock.RUnlock()\n  // sync \u8868\u793a obj \u5bf9\u8c61\u662f\u5426\u662f\u540c\u6b65\u4e8b\u4ef6\u5bf9\u8c61\n  // \u5c06\u5bf9\u8c61\u5206\u53d1\u7ed9\u6bcf\u4e00\u4e2a\u4e8b\u4ef6\u5904\u7406\u5668\u5217\u8868\u4e2d\u7684\u5904\u7406\u5668\n    if sync {\n        for _, listener := range p.syncingListeners {\n            listener.add(obj)\n        }\n    } else {\n        for _, listener := range p.listeners {\n            listener.add(obj)\n        }\n    }\n}\n</code></pre> <p>\u7136\u540e\u5c31\u662f\u5c06 sharedProcessor \u8fd0\u884c\u8d77\u6765\uff1a</p> <pre><code>func (p *sharedProcessor) run(stopCh &lt;-chan struct{}) {\n    func() {\n        p.listenersLock.RLock()\n        defer p.listenersLock.RUnlock()\n    // \u904d\u5386\u6240\u6709\u7684\u5904\u7406\u5668\uff0c\u4e3a\u5904\u7406\u5668\u542f\u52a8\u4e24\u4e2a\u540e\u53f0\u534f\u7a0b\uff1arun \u548c pop \u64cd\u4f5c\n    // \u540e\u7eed\u6dfb\u52a0\u7684\u5904\u7406\u5668\u5c31\u662f\u5728\u4e0a\u9762\u7684 addListener \u4e2d\u53bb\u542f\u52a8\u7684\n        for _, listener := range p.listeners {\n            p.wg.Start(listener.run)\n            p.wg.Start(listener.pop)\n        }\n    // \u6807\u8bb0\u4e3a\u6240\u6709\u5904\u7406\u5668\u90fd\u5df2\u542f\u52a8\n        p.listenersStarted = true\n    }()\n  // \u7b49\u5f85\u9000\u51fa\u4fe1\u53f7\n    &lt;-stopCh\n  // \u63a5\u6536\u5230\u9000\u51fa\u4fe1\u53f7\u540e\uff0c\u5173\u95ed\u6240\u6709\u7684\u5904\u7406\u5668\n    p.listenersLock.RLock()\n    defer p.listenersLock.RUnlock()\n  // \u904d\u5386\u6240\u6709\u5904\u7406\u5668\n    for _, listener := range p.listeners {\n    // \u5173\u95ed addCh\uff0cpop \u4f1a\u505c\u6b62\uff0cpop \u4f1a\u901a\u77e5 run \u505c\u6b62\n        close(listener.addCh) \n    }\n  // \u7b49\u5f85\u6240\u6709\u534f\u7a0b\u9000\u51fa\uff0c\u5c31\u662f\u4e0a\u9762\u6240\u6709\u5904\u7406\u5668\u4e2d\u542f\u52a8\u7684\u4e24\u4e2a\u534f\u7a0b pop \u4e0e run\n    p.wg.Wait() \n}\n</code></pre> <p>\u5230\u8fd9\u91cc sharedProcessor \u5c31\u5b8c\u6210\u4e86\u5bf9 ResourceEventHandler \u7684\u5c01\u88c5\u5904\u7406\uff0c\u5f53\u7136\u6700\u7ec8 sharedProcessor \u8fd8\u662f\u5728 SharedInformer \u4e2d\u53bb\u8c03\u7528\u7684\u3002</p> <p>sharedIndexInformer\u7684HandleDeltas\u5904\u7406\u4ecedeltaFIFO pod\u51fa\u6765\u7684\u589e\u91cf\u65f6\uff0c\u5148\u5c1d\u8bd5\u66f4\u65b0\u5230\u672c\u5730\u7f13\u5b58cache\uff0c\u66f4\u65b0\u6210\u529f\u7684\u8bdd\u4f1a\u8c03\u7528processor.distribute\u65b9\u6cd5\u5411processor\u4e2d\u7684listener\u6dfb\u52a0notification\uff0clistener\u542f\u52a8\u4e4b\u540e\u4f1a\u4e0d\u65ad\u83b7\u53d6notification\u56de\u8c03\u7528\u6237\u7684EventHandler\u65b9\u6cd5\u3002</p> <p>\u5728\u6b64\u5c31\u4e0d\u5728\u8fc7\u5ea6\u5c55\u5f00\uff0c\u66f4\u8be6\u7ec6\u7684\u5185\u5bb9\u8fd8\u9700\u8981\u53bb\u770bk8s\u6e90\u7801\u3002</p>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_4","title":"\u56db \u5c0f\u8bd5\u725b\u5200","text":""},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#41-event","title":"4.1 \u6dfb\u52a0event\u4e8b\u4ef6","text":"<p>\u6dfb\u52a0\u6709AddEventHandler\uff0c\u9996\u6b21list\u5173\u6ce8\u7684\u8d44\u6e90\u540e\uff0c\u540e\u671f\u901a\u8fc7watch\u5224\u65ad\u8d44\u6e90\u72b6\u6001\u6267\u884c\u76f8\u5e94\u64cd\u4f5c\uff0c\u901a\u8fc7indexer\u6765\u7f13\u5b58\u4e2d\u83b7\u53d6\u5bf9\u8c61\u3002</p> <pre><code>func Muste(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\nfunc InitClientSet() *kubernetes.Clientset {\n    kubeconfig := filepath.Join(homedir.HomeDir(), \".kube\", \"config\")\n    restConfig, err := clientcmd.BuildConfigFromFlags(\"\", kubeconfig)\n    Muste(err)\n    return kubernetes.NewForConfigOrDie(restConfig)\n}\n\nfunc main() {\n    clientSet := InitClientSet()\n  // \u521d\u59cb\u5316sharedInformerFactory\n    sharedInformerFactory := informers.NewSharedInformerFactory(clientSet, 0)\n  // \u751f\u6210podInformer\n    podInformer := sharedInformerFactory.Core().V1().Pods()\n  // \u751f\u6210\u5177\u4f53informer/indexer\n    informer := podInformer.Informer()\n    indexer := podInformer.Lister()\n  // \u6dfb\u52a0Event\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\n    informer.AddEventHandler(cache.ResourceEventHandlerFuncs{\n        func(obj interface{}) {\n            podObj := obj.(*corev1.Pod)\n\n            fmt.Printf(\"AddFunc: %s\\n\", podObj.GetName())\n\n        },\n        func(oldObj, newObj interface{}) {\n            oldPodObj := oldObj.(*corev1.Pod)\n            newPodObj := newObj.(*corev1.Pod)\n\n            fmt.Printf(\"old: %s\\n\", oldPodObj.GetName())\n            fmt.Printf(\"new: %s\\n\", newPodObj.GetName())\n\n        },\n        func(obj interface{}) {\n            podObj := obj.(*corev1.Pod)\n            fmt.Printf(\"deleteFunc: %s\\n\", podObj.GetName())\n        },\n    })\n\n    stopCh := make(chan struct{})\n    defer close(stopCh)\n  // \u542f\u52a8informer\n    sharedInformerFactory.Start(stopCh)\n  // \u7b49\u5f85\u540c\u6b65\u5b8c\u6210\n  sharedInformerFactory.WaitForCacheSync(stopCh)\n\n // \u5229\u7528indexer\u83b7\u53d6\u8d44\u6e90\n    pods, err := indexer.List(labels.Everything())\n    Muste(err)\n    for _, items := range pods {\n        fmt.Printf(\"namespace: %s, name:%s\\n\", items.GetNamespace(), items.GetName())\n    }\n    &lt;-stopCh\n}\n</code></pre>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#42-gink8s","title":"4.2 \u901a\u8fc7Gin\u5b9e\u73b0K8s\u8d44\u6e90\u83b7\u53d6","text":""},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#421","title":"4.2.1 \u5355\u4e2a\u8d44\u6e90\u5bf9\u8c61\u83b7\u53d6","text":"<p>\u901a\u8fc7\u751f\u6210deployinformer,\u901a\u8fc7gin\u6846\u67b6\u66b4\u9732\u8bbf\u95ee\u5165\u53e3\uff0c\u901a\u8fc7informer\u4e2d\u7684indexer\u6765\u83b7\u53d6deployment\u8d44\u6e90\u3002</p> <pre><code>func main() {\n\n    clientSet, err := initClientSet()\n    if err != nil {\n        log.Fatal(err)\n    }\n    sharedInformerFactory := informers.NewSharedInformerFactory(clientSet, 0)\n  // \u83b7\u53d6deployinformeer\n    deployInformer := sharedInformerFactory.Apps().V1().Deployments()\n    _ = deployInformer.Informer()\n    lister := deployInformer.Lister()\n    stopCh := make(chan struct{})\n    sharedInformerFactory.Start(stopCh)\n    sharedInformerFactory.WaitForCacheSync(stopCh)\n\n    // http://localhost:8888/deploy?labels[k8s-app]=kube-dns\n    r := gin.Default()\n    r.GET(\"/deploy\", func(c *gin.Context) {\n        var set map[string]string\n    // \u901a\u8fc7labels\u8fc7\u6ee4deploy\n        if content, ok := c.GetQueryMap(\"labels\"); ok {\n            set = content\n        }\n        selectQuery := labels.SelectorFromSet(set)\n\n        podList, err := lister.List(selectQuery)\n        if err != nil {\n            c.JSON(400, gin.H{\n                \"msg\": err.Error(),\n            })\n            return\n        }\n        c.JSON(200, gin.H{\n            \"data\": podList,\n        })\n\n    })\n\n    r.Run(\":8888\")\n\n    //&lt;-stopCh\n\n}\n</code></pre> <p></p>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#422","title":"4.2.2 \u6839\u636e\u8def\u5f84\u53c2\u6570\u83b7\u53d6\u4e0d\u540c\u8d44\u6e90","text":"<p>\u4e4b\u524d\u7684\u793a\u4f8b\u53ef\u4ee5\u83b7\u53d6\u5236\u5b9a\u8d44\u6e90\uff0c\u4e0b\u9762\u793a\u4f8b\u5c06gvr\u901a\u8fc7gin\u8def\u5f84\u53c2\u6570\u4f20\u9012\u8fdb\u6765\uff0c\u8fdb\u800c\u5b9e\u73b0\u4e00\u4e2aAPI\u53ef\u4ee5\u83b7\u53d6K8s\u6240\u6709\u8d44\u6e90\u3002</p> <pre><code>func main() {\n    clientSet := InitClientSet()\n    sharedInformerFactory := informers.NewSharedInformerFactory(clientSet, 0)\n    stopCh := make(chan struct{})\n    defer close(stopCh)\n\n    engin := gin.Default()\n    // \u6784\u9020\u4e00\u4e2a\u901a\u7528\u7684\u6839\u636e\u4e0d\u540cgroup/version/kind \u83b7\u53d6\u5bf9\u8c61\u7c7b\u578b\n    //http://localhost:8888/core/v1/pods\n    engin.GET(\"/:group/:version/:resource\", func(c *gin.Context) {\n        g, v, r := c.Param(\"group\"), c.Param(\"version\"), c.Param(\"resource\")\n    // \u5982\u679c\u662fcore\u7ec4\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32\n        if g == \"core\" {\n            g = \"\"\n        }\n        gvr := schema.GroupVersionResource{g, v, r}\n        genericInformer, _ := sharedInformerFactory.ForResource(gvr)\n        _ = genericInformer.Informer()\n        sharedInformerFactory.Start(stopCh)\n        sharedInformerFactory.WaitForCacheSync(stopCh)\n        items, err := genericInformer.Lister().List(labels.Everything())\n        if err != nil {\n            c.JSON(500, gin.H{\n                \"msg\": err,\n            })\n        }\n        c.JSON(200, gin.H{\n            \"msg\": items,\n        })\n    })\n\n    engin.Run(\":8888\")\n}\n</code></pre> <p></p> <p></p>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_5","title":"\u603b\u7ed3","text":"<p>\u5728\u4ee5\u4e0a\u7684\u5185\u5bb9\u4e2d\uff0c\u6211\u4eec\u5206\u6790\u4e86 informers \u5305\u7684\u6e90\u4ee3\u7801\uff0c\u5e76\u7b80\u5355\u6d4b\u8bd5\u4e86informer\u7684\u539f\u7406\uff0c\u66f4\u8be6\u7ec6\u7684\u5185\u5bb9\u8fd8\u662f\u9700\u8981\u81ea\u5df1\u53bb\u770b\u6e90\u7801\u9886\u4f1a\uff0c\u540e\u7eed\u770b\u5b8cindexer\u540e\uff0c\u6211\u4eec\u81ea\u5df1\u624b\u52a8\u53bb\u7f16\u5199\u4e00\u4e2aController\u6765\u52a0\u6df1\u5bf9Informer\u6574\u4e2a\u6d41\u7a0b\u7684\u7406\u89e3\u3002</p>"},{"location":"cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://jimmysong.io/kubernetes-handbook/develop/client-go-informer-sourcecode-analyse.html</li> </ul>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"10.Client-go\u6e90\u7801\u5206\u6790\u4e4bIndexer","text":""},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u4ece\u4e0a\u6587\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5728SharedInformer\u5728HandleDeltas\u5bf9pop\u51fa\u6765\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u4e00\u90e8\u5206\u8fdb\u884c\u7ef4\u62a4indexer\uff0c\u4e00\u90e8\u5206\u8fdb\u884c\u4e8b\u4ef6\u7684\u5206\u53d1\uff0c\u90a3\u4e48\u5728Informer\u4e3a\u4ec0\u4e48\u9700\u8981Indexer\u5462\uff0c</p>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#indexer","title":"\u4e8c Indexer\u529f\u80fd","text":"<p>Indexer\u5b57\u9762\u4e0a\u770b\u662f\u7d22\u5f15\u5668\uff0c\u5c31\u662fInformer\u7684LocalStore\u3002\u53ef\u4ee5\u7c7b\u6bd4\u6570\u636e\u5e93\u7684\u7d22\u5f15\uff0c\u7d22\u5f15\u662f\u4e3a\u52a0\u5feb\u6570\u636e\u5e93\u67e5\u8be2\u800c\u505a\u7684\u6570\u636e\u6620\u5c04\uff0c\u7d22\u5f15\u662f\u5bf9\u5b58\u50a8\u7684\u6269\u5c55\u548c\u5305\u88c5\uff0c\u4f7f\u5f97\u6309\u7167\u67d0\u4e9b\u6761\u4ef6\u67e5\u8be2\u901f\u5ea6\u4f1a\u975e\u5e38\u5feb\u3002</p>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_2","title":"\u4e09 \u6e90\u7801\u5206\u6790","text":"<p>Indexer\u5c31\u662f\u4e00\u79cd\u63a5\u53e3\uff0c\u800c\u5728Informer\u4e2d\uff0c\u5b9e\u73b0Indexer\u63a5\u53e3\u7684struct\u5c31\u662f<code>threadSafeStore</code>\u3002\u6211\u4eec\u4ece\u4e24\u4e2a\u65b9\u9762\u2014\u2014\u6210\u5458\u53ca\u65b9\u6cd5\u6765\u8ba4\u8bc6\u8fd9\u4e2astruct\u3002</p>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#31-indexer","title":"3.1 Indexer\u63a5\u53e3","text":"<pre><code>type Indexer interface {\n  // \u7ee7\u627fStore\u63a5\u53e3 \n    Store\n\n  // \u68c0\u7d22 \u5339\u914d\u547d\u540d\u7d22\u5f15\u51fd\u6570\u7684\u5bf9\u8c61\u5217\u8868\n  // indexName\u7d22\u5f15\u51fd\u6570\u540d\uff0cobj\u662f\u5bf9\u8c61\n  // \u8ba1\u7b97obj\u5728indexName\u7d22\u5f15\u51fd\u6570\u4e2d\u7684\u6240\u6709\u7d22\u5f15\u952e\uff0c\u901a\u8fc7\u7d22\u5f15\u952e\u628a\u6240\u6709\u7684\u5bf9\u8c61\u53d6\u51fa\u6765\n    Index(indexName string, obj interface{}) ([]interface{}, error)\n\n  // \u83b7\u53d6 indexName \u4e0b\u7684 \u7d22\u5f15\u503c\u4e3a indexedValue \u96c6\u5408\u7684\u6240\u6709 key\n    IndexKeys(indexName, indexedValue string) ([]string, error)\n\n  // \u7d22\u5f15\u51fd\u6570indexName  \u4e2d\u7d22\u5f15\u952e\u4e3aindexKey \u7684\u5bf9\u8c61\n    ListIndexFuncValues(indexName string) []string\n\n    // \u8fd4\u56de\u503c\u4e0d\u662f\u5bf9\u8c61\u952e\uff0c\u800c\u662f\u6240\u6709\u5bf9\u8c61\n    ByIndex(indexName, indexedValue string) ([]interface{}, error)\n    // GetIndexer return the indexers\n    GetIndexers() Indexers\n\n  // \u5728\u5b58\u50a8\u4e2d\u6dfb\u52a0\u66f4\u591a\u7684indexers\uff0c\u589e\u52a0\u66f4\u591a\u7684\u7d22\u5f15\u51fd\u6570\n    AddIndexers(newIndexers Indexers) error\n}\n</code></pre> <p>indexer\u5728 store\u5b58\u50a8\u7684\u57fa\u7840\u4e4b\u4e0a\uff0c\u62d3\u5c55\u4e86\u5bf9\u5bf9\u8c61\u67e5\u627e\u7684\u7d22\u5f15\u80fd\u529b\u3002\u8bf4\u767d\u4e86\uff0c\u5176\u5b9e\u5c31\u662f\u901a\u8fc7map\u7ed3\u6784\u5b9e\u73b0\u4e0d\u901a\u7ef4\u5ea6\u7684\u8d44\u6e90\u67e5\u627e\u3002</p> <p></p> <pre><code>// \u6620\u5c04\u7d22\u5f15\u952e\u548c\u5bf9\u8c61\u952e\ntype Index map[string]sets.String\n\n// \u7d22\u5f15\u5668\u540d\u79f0\u4e8e\u7d22\u5f15\u51fd\u6570\u6620\u5c04\uff0c\u5b58\u50a8\u7d22\u5f15\u5206\u7c7b\ntype Indexers map[string]IndexFunc\n\n// \u7d22\u5f15\u5668\u540d\u79f0\u4e8eindex\u7684\u7d22\u5f15\u6620\u5c04\ntype Indices map[string]Index\n</code></pre>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#32-cache","title":"3.2 cache","text":"<p>Indexer \u63a5\u53e3\u5177\u4f53\u5b9e\u73b0\u7c7b\u578b\u4e3acache\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u7ebf\u7a0b\u5b89\u5168\u7684store\u5373ThreadSafeStore\u548c\u8ba1\u7b97key\u503c\u7684\u51fd\u6570KeyFunc\uff0c\u5176\u4e2d\u7ee7\u627f\u4e86ThreadSafeStore\u7684\u76f8\u5173\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230cache\u4e2d\u5b9e\u73b0ThreadSafeStore\u63a5\u53e3\u65b9\u6cd5\uff0c\u53ea\u8981\u662f\u8c03\u7528\u7684\u5305\u542b\u7684 ThreadSafeStore \u64cd\u4f5c\u63a5\u53e3\uff0c\u6240\u4ee5\u6211\u4eec\u7740\u91cd\u770b\u4e0bThreadSafeStore\u63a5\u53e3threadSafeMap\u65b9\u6cd5\u7684\u5177\u4f53\u7684\u5b9e\u73b0\u3002</p> <p></p> <pre><code>// tools/cache/store.go\n\n// cache \u662findexer\u7684\u5b9e\u73b0\uff0c\u5176\u4e2d\ntype cache struct {\n    // \u7ebf\u7a0b\u5b89\u5168\u7684\u7d22\u5f15\n    cacheStorage ThreadSafeStore\n    // keyFunc is used to make the key for objects stored in and retrieved from items, and\n    // keyFunc \u8ba1\u7b97\u5bf9\u8c61\u952e\n    keyFunc KeyFunc\n}\n\ntype KeyFunc func(obj interface{}) (string, error)\n\n// ThreadSafeStore\u4e5f\u662f\u4e00\u63a5\u53e3\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u5bf9store\u7684\u76f8\u5173\u589e\u5220\u6539\u67e5\uff0c\u53ca\u83b7\u53d6key\u76f8\u5173\u65b9\u6cd5\ntype ThreadSafeStore interface {\n    Add(key string, obj interface{})\n    Update(key string, obj interface{})\n    Delete(key string)\n    Get(key string) (item interface{}, exists bool)\n    List() []interface{}\n    ListKeys() []string\n    Replace(map[string]interface{}, string)\n    Index(indexName string, obj interface{}) ([]interface{}, error)\n    IndexKeys(indexName, indexKey string) ([]string, error)\n    ListIndexFuncValues(name string) []string\n    ByIndex(indexName, indexKey string) ([]interface{}, error)\n    GetIndexers() Indexers\n\n    // AddIndexers adds more indexers to this store.  If you call this after you already have data\n    // in the store, the results are undefined.\n    AddIndexers(newIndexers Indexers) error\n    // Resync is a no-op and is deprecated\n    Resync() error\n}\n\n// Add \u63d2\u5165\u4e00\u4e2a\u5143\u7d20\u5230 cache \u4e2d\nfunc (c *cache) Add(obj interface{}) error {\n    key, err := c.keyFunc(obj)  // \u751f\u6210\u5bf9\u8c61\u952e\n    if err != nil {\n        return KeyError{obj, err}\n    }\n  // \u5c06\u5bf9\u8c61\u6dfb\u52a0\u5230\u5e95\u5c42\u7684 ThreadSafeStore \u4e2d\n    c.cacheStorage.Add(key, obj)\n    return nil\n}\n\n// \u66f4\u65b0cache\u4e2d\u7684\u5bf9\u8c61\nfunc (c *cache) Update(obj interface{}) error {\n    key, err := c.keyFunc(obj)\n    if err != nil {\n        return KeyError{obj, err}\n    }\n    c.cacheStorage.Update(key, obj)\n    return nil\n}\n</code></pre>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#33-threadsafemap","title":"3.3 threadSafeMap","text":"<p>threadSafeMap\u662f\u5177\u4f53ThreadSafeStore\u63a5\u53e3\u7684\u5b9e\u73b0,\u5176\u5185\u90e8items\u4e3a\u6700\u5e95\u5c42\u5b58\u50a8\u5177\u4f53\u7684\u8d44\u6e90\u5bf9\u8c61\uff0cindexers\u4e3a\u8ba1\u7b97\u7d22\u5f15\u952e\u7684\u65b9\u6cd5\uff0cindeces\u4e3a\u5b58\u50a8\u901a\u8fc7indexers\u4e2d\u7d22\u5f15\u952e\u8ba1\u7b97\u51fa\u4e0d\u540c\u7c7b\u578b\u7684\u7d22\u5f15\u952e\u3002</p> <pre><code>// threadSafeMap \u5b9e\u73b0\u4e86 ThreadSafeStore\ntype threadSafeMap struct {\n   lock  sync.RWMutex\n   // \u5177\u4f53\u5b58\u50a8\u5e95\u5c42\u5143\u7d20\u7684\u5185\u5bb9\n   items map[string]interface{}\n\n   // \u7d22\u5f15\u5668\u540d\u79f0\u4e8e\u7d22\u5f15\u952e\u51fd\u6570\u6620\u5c04\n   indexers Indexers\n   // type Indices map[string]Index\n   indices Indices\n}\n</code></pre> <p>threadSafeMap \u7684Add\u65b9\u6cd5\uff0c\u901a\u8fc7\u7d22\u5f15key\u8ba1\u7b97\u5bf9\u8c61\u5c06\u5176\u6dfb\u52a0\u5230items\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5148\u53bb\u5224\u65ad\u83b7\u53d6\u8001\u7684\u5bf9\u8c61\uff0c\u4e4b\u540e\u5c06\u5176\u66f4\u65b0\u5230items\uff0c\u7136\u540e\u8c03\u7528updateIndices\u65b9\u6cd5\uff0c\u5b9e\u73b0\u66f4\u65b0indices\u3002</p> <pre><code>func (c *threadSafeMap) Add(key string, obj interface{}) {\n    c.lock.Lock()\n    defer c.lock.Unlock()\n    oldObject := c.items[key]\n    c.items[key] = obj\n    c.updateIndices(oldObject, obj, key)\n}\n\n// updateIndices modifies the objects location in the managed indexes, if this is an update, you must provide an oldObj\n// updateIndices must be called from a function that already has a lock on the cache\nfunc (c *threadSafeMap) updateIndices(oldObj interface{}, newObj interface{}, key string) {\n    // \u5982\u679c\u6709\u65e7\u5bf9\u8c61\uff0c\u5148\u4ece\u7d22\u5f15\u4e2d\u5220\u9664\u8be5\u5bf9\u8c61\n    if oldObj != nil {\n        c.deleteFromIndices(oldObj, key)\n    }\n  // \u5f00\u59cb\u5faa\u73af\u7d22\u5f15\u5668\uff0c\u5229\u7528\u7d22\u5f15\u5668\u8ba1\u7b97\u5bf9\u8c61\u7684\u7d22\u5f15\u952e\n    for name, indexFunc := range c.indexers {\n        indexValues, err := indexFunc(newObj)\n        if err != nil {\n            panic(fmt.Errorf(\"unable to calculate an index entry for key %q on index %q: %v\", key, name, err))\n        }\n    // \u83b7\u53d6\u5f53\u524d\u7d22\u5f15\u5668\u7684\u7d22\u5f15\n        index := c.indices[name]\n    // \u521d\u59cb\u5316\u4e00\u4e2a\u7d22\u5f15\n        if index == nil {\n            index = Index{}\n            c.indices[name] = index\n        }\n\n        for _, indexValue := range indexValues {\n            set := index[indexValue]\n            if set == nil {\n                set = sets.String{}\n                index[indexValue] = set\n            }\n            set.Insert(key)\n        }\n    }\n}\n\n//  \u5220\u9664\u5bf9\u8c61\u7d22\u5f15\nfunc (c *threadSafeMap) deleteFromIndices(obj interface{}, key string) {\n  // \u5faa\u73af\u6240\u6709\u7684\u7d22\u5f15\u5668\n    for name, indexFunc := range c.indexers {\n    // \u83b7\u53d6\u5220\u9664\u5bf9\u8c61\u7684\u7d22\u5f15\u952e\u5217\u8868\n        indexValues, err := indexFunc(obj)\n        if err != nil {\n            panic(fmt.Errorf(\"unable to calculate an index entry for key %q on index %q: %v\", key, name, err))\n        }\n    // \u83b7\u53d6\u5f53\u524d\u7d22\u5f15\u5668\u7684\u7d22\u5f15\n        index := c.indices[name]\n        if index == nil {\n            continue\n        }\n        for _, indexValue := range indexValues {\n      // \u83b7\u53d6\u7d22\u5f15\u952e\u5bf9\u5e94\u7684\u5bf9\u8c61\u952e\u5217\u8868\n            set := index[indexValue]\n            if set != nil {\n        // \u4ece\u5bf9\u8c61\u952e\u5217\u8868\u4e2d\u5220\u9664\u5f53\u524d\u8981\u5220\u9664\u7684\u5bf9\u8c61\u952e\n                set.Delete(key)\n\n                // \u5982\u679c\u5f53\u96c6\u5408\u4e3a\u7a7a\u7684\u65f6\u5019\u4e0d\u5220\u9664set\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u8dd1\u6ee1\n        // `kubernetes/kubernetes/issues/84959`.\n        if len(set) == 0 {\n                    delete(index, indexValue)\n                }\n            }\n        }\n    }\n}\n</code></pre> <p>\u770b\u4e86threadSafeMap\u7684add\u65b9\u6cd5\uff0c\u5176\u4ed6\u7684update/delete\u4e5f\u7c7b\u4f3c\uff0c\u63a5\u4e0b\u6765\u770b\u4e0b\u5b83\u7684\u7d22\u5f15\u65b9\u6cd5\u3002</p> <pre><code>// ByIndex \u6839\u636e\u5236\u5b9a\u7684indexName\u548cindexedValue\uff0c\u8fd4\u56de\u7ed9\u5b9a\u7d22\u5f15\u4e2d\u7684\u7d22\u5f15\u503c\u5217\u8868\nfunc (c *threadSafeMap) ByIndex(indexName, indexedValue string) ([]interface{}, error) {\n    c.lock.RLock()\n    defer c.lock.RUnlock()\n  // \u83b7\u53d6\u7d22\u5f15\u952e\u8ba1\u7b97\u51fd\u6570\n    indexFunc := c.indexers[indexName]\n    if indexFunc == nil {\n        return nil, fmt.Errorf(\"Index with name %s does not exist\", indexName)\n    }\n  // \u83b7\u53d6indexName\u7684\u6240\u6709\u7d22\u5f15\n    index := c.indices[indexName]\n  // \u83b7\u53d6\u6307\u5b9a\u7d22\u5f15\u952e\u7684\u6240\u6709\u5bf9\u8c61\u952e\n    set := index[indexedValue]\n    list := make([]interface{}, 0, set.Len())\n  // \u904d\u5386\u5bf9\u8c61\u952e\u83b7\u53d6\u5bf9\u8c61\n    for key := range set {\n        list = append(list, c.items[key])\n    }\n\n    return list, nil\n}\n</code></pre> <p>\u9664\u4e86ByIndex\u65b9\u6cd5\u5916\u8fd8\u6709Index/IndexKeys\u7b49\u5176\u4ed6\uff0c\u66f4\u8be6\u7ec6\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u81ea\u884c\u67e5\u770b\u6e90\u7801\u3002\u8fd9\u91cc\u6211\u4eec\u5c31\u5c06 ThreadSafeMap \u7684\u5b9e\u73b0\u8fdb\u884c\u4e86\u5206\u6790\u8bf4\u660e\u3002\u5c31\u662f\u5bf9map \u4e2d\u5bf9\u8c61\u6570\u636e\u8fdb\u884c\u5b58\u50a8\uff0c\u4e4b\u540e\u5c31\u662f\u5c31\u662f\u7ef4\u62a4\u7d22\u5f15\uff0c\u65b9\u4fbf\u6839\u636e\u7d22\u5f15\u6765\u67e5\u627e\u5230\u5bf9\u5e94\u7684\u5bf9\u8c61\u3002</p>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_3","title":"\u56db \u5c0f\u8bd5\u725b\u5200","text":"<p>\u4e3a\u4e86\u66f4\u76f4\u89c2\u7684\u7406\u89e3index\uff0c\u8fdb\u884c\u5b9e\u9645\u7f16\u7801\u6d4b\u8bd5\u3002</p>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#41","title":"4.1 \u81ea\u5b9a\u4e49\u6570\u636e\u6d4b\u8bd5","text":"<pre><code>const (\n    namespaceIndex = \"namespaceIndex\"\n    nodeNameIndex  = \"nodeNameIndex\"\n)\n\nfunc namespaceFunc(obj interface{}) ([]string, error) {\n    o, err := meta.Accessor(obj)\n    if err != nil {\n        return []string{\"\"}, err\n    }\n    return []string{o.GetNamespace()}, nil\n}\n\nfunc nodeNameFunc(obj interface{}) ([]string, error) {\n    o, ok := obj.(*corev1.Pod)\n    if !ok {\n        return []string{\"\"}, nil\n    }\n    return []string{o.Spec.NodeName}, nil\n}\n\nfunc main() {\n\n    indexer := cache.NewIndexer(cache.MetaNamespaceKeyFunc, cache.Indexers{\n        namespaceIndex: namespaceFunc,\n        nodeNameIndex:  nodeNameFunc,\n    })\n\n    podList := []corev1.Pod{\n        corev1.Pod{\n            ObjectMeta: metav1.ObjectMeta{\n                Name:      \"pod1\",\n                Namespace: \"default\",\n            },\n            Spec: corev1.PodSpec{\n                NodeName: \"node1\",\n            },\n        },\n        corev1.Pod{\n            ObjectMeta: metav1.ObjectMeta{\n                Name:      \"pod2\",\n                Namespace: \"default\",\n            },\n            Spec: corev1.PodSpec{\n                NodeName: \"node2\",\n            },\n        },\n        corev1.Pod{\n            ObjectMeta: metav1.ObjectMeta{\n                Name:      \"pod3\",\n                Namespace: \"podns\",\n            },\n            Spec: corev1.PodSpec{\n                NodeName: \"node2\",\n            },\n        },\n    }\n\n    for idx, item := range podList {\n\n        err := indexer.Add(&amp;podList[idx])\n        if err != nil {\n            panic(err)\n        }\n        fmt.Printf(\"add %d,%s to indexer\\n\", idx, item.GetName())\n    }\n\n    // \u5f00\u59cb\u5229\u7528\u4e0d\u540c\u7d22\u5f15\u952e\u5bf9indexer\u4e2d\u7684\u5bf9\u8c61\u8fdb\u884c\u7d22\u5f15\u83b7\u53d6\n\n    if items, err := indexer.ByIndex(namespaceIndex, \"default\"); err != nil {\n        fmt.Println(\"get index err:%s\", err)\n    } else {\n        for _, podobj := range items {\n            if pod, ok := podobj.(*corev1.Pod); ok {\n                fmt.Printf(\"use indexkey:%s,value:%s, podName:%s,namespace:%s,nodeName:%s\\n\",\n                    namespaceIndex, \"default\", pod.GetName(), pod.GetNamespace(), pod.Spec.NodeName)\n            }\n        }\n    }\n\n    if items, err := indexer.ByIndex(nodeNameIndex, \"node2\"); err != nil {\n        fmt.Println(\"get index err:%s\", err)\n    } else {\n        for _, podobj := range items {\n            if pod, ok := podobj.(*corev1.Pod); ok {\n                fmt.Printf(\"use indexkey:%s,value:%s, podName:%s,namespace:%s,nodeName:%s\\n\",\n                    nodeNameIndex, \"node2\", pod.GetName(), pod.GetNamespace(), pod.Spec.NodeName)\n            }\n        }\n    }\n\n    fmt.Println(\"-----indexkeys---\")\n\n    if list, err := indexer.IndexKeys(namespaceIndex, \"default\"); err != nil {\n        fmt.Println(err)\n    } else {\n        fmt.Print(list)\n    }\n}\n</code></pre> <p>\u8f93\u51fa\u793a\u4f8b</p> <pre><code>add 0,pod1 to indexer\nadd 1,pod2 to indexer\nadd 2,pod3 to indexer\nuse indexkey:namespaceIndex,value:default, podName:pod1,namespace:default,nodeName:node1\nuse indexkey:namespaceIndex,value:default, podName:pod2,namespace:default,nodeName:node2\nuse indexkey:nodeNameIndex,value:node2, podName:pod2,namespace:default,nodeName:node2\nuse indexkey:nodeNameIndex,value:node2, podName:pod3,namespace:podns,nodeName:node2\n-----indexkeys\n[default/pod1 default/pod2]\n</code></pre> <p>debug\u67e5\u770b\u6570\u636e\u7ed3\u6784\uff1a</p> <p></p> <pre><code>/*\n\u8ba1\u7b97\u6240\u6709key\nindexers\n{\n    namespaceIndex: namespaceFunc,\n    nodeNameIndex: nodeNameFunc,\n}\n\nindices\n{\n    namespaceIndex: {\n        \"default\":[\"pod1\",\"pod2\"],\n     \"kube-system\":[\"pod2\",\"pod3\"]\n    },\n    nodeNameIndex: {\n        \"node1\":[\"pod1\",\"pod2\"],\n        \"node2\":[\"pod2\",\"pod3\"]\n    },\n}\n\nindex {\n    \"default\":[\"pod1\",\"pod2\"]\n}\n*/\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u5b9a\u4e49\u7684\u4e86\u4e24\u4e2a\u7d22\u5f15\u952e\u751f\u6210\u51fd\u6570\uff1a namespaceFunc \u4e0e nodeNameFunc\uff0c\u4e00\u4e2a\u6839\u636e\u8d44\u6e90\u5bf9\u8c61\u7684\u547d\u540d\u7a7a\u95f4\u6765\u8fdb\u884c\u7d22\u5f15\uff0c\u4e00\u4e2a\u6839\u636e\u8d44\u6e90\u5bf9\u8c61\u6240\u5728\u7684\u8282\u70b9\u8fdb\u884c\u7d22\u5f15\u3002\u7136\u540e\u5b9a\u4e49\u4e863\u4e2a Pod\uff0c\u524d\u4e24\u4e2a\u5728 default \u547d\u540d\u7a7a\u95f4\u4e0b\u9762\uff0c\u53e6\u5916\u4e00\u4e2a\u5728 kube-system \u547d\u540d\u7a7a\u95f4\u4e0b\u9762\uff0c\u7136\u540e\u901a\u8fc7 index.Add \u51fd\u6570\u6dfb\u52a0 Pod \u8d44\u6e90\u5bf9\u8c61\u3002\u7136\u540e\u901a\u8fc7 index.ByIndex \u51fd\u6570\u67e5\u8be2\u5728\u540d\u4e3a namespace \u7684\u7d22\u5f15\u5668\u4e0b\u9762\u5339\u914d\u7d22\u5f15\u952e\u4e3a default \u7684 Pod \u5217\u8868\u3002\u4e5f\u5c31\u662f\u67e5\u8be2 default \u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0b\u9762\u7684\u6240\u6709 Pod\uff0c\u8fd9\u91cc\u5c31\u662f\u524d\u4e24\u4e2a\u5b9a\u4e49\u7684 Pod\u3002Indexers \u662f\u5b58\u50a8\u7d22\u5f15\u7684\uff0cIndices \u91cc\u9762\u662f\u5b58\u50a8\u7684\u771f\u6b63\u7684\u6570\u636e\uff08\u5bf9\u8c61\u952e\uff09\u3002</p>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#42-sharedinformer","title":"4.2 \u901a\u8fc7SharedInformer\u4e2d\u83b7\u53d6","text":"<pre><code>// \u751f\u6210clientset\nfunc InitClientSet() *kubernetes.Clientset {\n    configFlags := genericclioptions.NewConfigFlags(false)\n    restConfig, err := configFlags.ToRESTConfig()\n    Must(err)\n    return kubernetes.NewForConfigOrDie(restConfig)\n}\n\nfunc main() {\n\n    clientSet := InitClientSet()\n\n    shareInformerFactory := informers.NewSharedInformerFactory(clientSet, 0)\n\n    podInformer := shareInformerFactory.Core().V1().Pods()\n\n    informer := podInformer.Informer()\n    indexer := informer.GetIndexer()\n\n    stopCh := make(chan struct{})\n    shareInformerFactory.Start(stopCh)\n    shareInformerFactory.WaitForCacheSync(stopCh)\n\n    // \u4eceindexer\u4e2d\u83b7\u53d6\n\n    items, err := indexer.ByIndex(cachetools.NamespaceIndex, metav1.NamespaceDefault)\n    Must(err)\n\n    // \u901a\u8fc7indexer\u7684ByIndex\u4e2d\u83b7\u53d6\u5185\u5bb9\uff0c\u904d\u5386pod\u5bf9\u8c61\n    for _, item := range items {\n        pod, ok := item.(*corev1.Pod)\n        if ok {\n            fmt.Printf(\"indexName:%s, namespace:%s, podname:%s\\n\",\n                cachetools.NamespaceIndex, metav1.NamespaceDefault, pod.GetName())\n        }\n    }\n}\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c:</p> <pre><code>indexName:namespace, namespace:default, podname:etcd-0\nindexName:namespace, namespace:default, podname:podname1\nindexName:namespace, namespace:default, podname:smartkm-api-k8s-exampledeploy-7cddf8cbf4-hn7f9\nindexName:namespace, namespace:default, podname:etcd-1\nindexName:namespace, namespace:default, podname:etcd-2\nindexName:namespace, namespace:default, podname:smartkm-api-k8s-exampledeploy-7cddf8cbf4-ztv2k\n</code></pre> <p>\u4f7f\u7528shareInformerFactory\u521b\u5efa\u4e00\u4e2apodinformer\uff0c\u4e4b\u540e\u83b7\u53d6\u5230indexer\uff0c\u901a\u8fc7indexer\u7684ByIndex\u6765\u83b7\u53d6indexName\u4e3anamespace\uff0cvalue\u4e3adefault\u4e0b\u7684pod\uff0c\u5728\u6b64\u4e3a\u629b\u7816\u5f15\u7389\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7informer.AddIndexers() \u6765\u6dfb\u52a0\u81ea\u5b9a\u4e49indexer\u6765\u8fbe\u5230\u6269\u5c55\u6027\uff0c\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u6765\u83b7\u53d6\u4e0d\u540c\u7684\u5bf9\u8c61\u3002</p>"},{"location":"cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.jianshu.com/p/76e7b1a57d2c</li> <li>https://mp.weixin.qq.com/s/-qiB1KilhwtcjI61m_x3jA</li> </ul>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"11.Client-go\u6e90\u7801\u5206\u6790\u4e4bWorkQueue","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u5728\u4e0a\u6587SharedInformer\u4e2d\uff0c\u6700\u540e\u5c06\u8d44\u6e90\u5bf9\u8c61\u5df2\u7ecf\u5199\u5165\u5230\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u6b64\u540e\u6211\u4eec\u76f4\u63a5\u5904\u7406\u8fd9\u4e9b\u6570\u636e\u5373\u53ef\uff0c\u4f46\u662f\u6211\u4eec\u4f7f\u7528golang\u4e2d\u7684chanel\u6765\u5904\u7406\u4f1a\u5b58\u5728\u5904\u7406\u6548\u7387\u4f4e\uff0c\u5b58\u5728\u6570\u636e\u5927\u5e76\u53d1\u91cf\uff0c\u6570\u636e\u79ef\u538b\u7b49\u5176\u4ed6\u5f02\u5e38\u60c5\u51b5\uff0c\u4e3a\u6b64client-go\u5355\u72ec\u5c06workqueue\u63d0\u51fa\u6765\uff0c\u4f5c\u4e3a\u516c\u5171\u7ec4\u4ef6\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5728Kubernetes\u5185\u90e8\u4f7f\u7528\uff0c\u8fd8\u53ef\u4ee5\u4f9bClient-go\u4f7f\u7528\uff0c\u7528\u6237\u4fa7\u53ef\u4ee5\u901a\u8fc7Workqueue\u76f8\u5173\u65b9\u6cd5\u8fdb\u884c\u66f4\u52a0\u7075\u6d3b\u7684\u961f\u5217\u5904\u7406\uff0c\u5982\u5931\u8d25\u91cd\u8bd5\uff0c\u5ef6\u8fdf\u5165\u961f\uff0c\u9650\u901f\u63a7\u5236\u7b49\uff0c\u5b9e\u73b0\u975e\u963b\u585e\u5f02\u6b65\u903b\u8f91\u5904\u7406\u3002</p>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#workqueue","title":"\u4e8c WorkQueue\u76f8\u5173\u6982\u5ff5\u53ca\u6784\u6210","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#21","title":"2.1 \u5206\u7c7b","text":"<p>WorkQueue \u652f\u6301 3 \u79cd\u961f\u5217\uff0c\u5e76\u63d0\u4f9b\u4e86 3 \u79cd\u63a5\u53e3\uff0c\u4e0d\u540c\u961f\u5217\u5b9e\u73b0\u53ef\u5e94\u5bf9\u4e0d\u540c\u7684\u4f7f\u7528\u573a\u666f\uff0c\u5206\u522b\u4ecb\u7ecd\u5982\u4e0b\u3002</p> <ul> <li>Interface\uff1a\u901a\u7528\u961fFIFO \u961f\u5217\u63a5\u53e3\uff0c\u5148\u8fdb\u5148\u51fa\u961f\u5217\uff0c\u5e76\u652f\u6301\u53bb\u91cd\u673a\u5236\u3002</li> <li>DelayingInterface\uff1a\u5ef6\u8fdf\u961f\u5217\u63a5\u53e3\uff0c\u57fa\u4e8e Interface \u63a5\u53e3\u5c01\u88c5\uff0c\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\u540e\u518d\u5c06\u5143\u7d20\u5b58\u5165\u961f\u5217\u3002</li> <li>RateLimitingInterface\uff1a\u9650\u901f\u961f\u5217\u63a5\u53e3\uff0c\u57fa\u4e8e DelayingInterface \u63a5\u53e3\u5c01\u88c5\uff0c\u652f\u6301\u5143\u7d20\u5b58\u5165\u961f\u5217\u65f6\u8fdb\u884c\u901f\u7387\u9650\u5236\u3002</li> </ul> <p></p> <p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\uff0cworkqueue.RateLimitingInterface \u96c6\u6210\u4e86 DelayingInterface\uff0cDelayingInterface \u96c6\u6210\u4e86 Interface\uff0c\u6700\u7ec8\u7531 rateLimitingType \u8fdb\u884c\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 rateLimit \u9650\u901f\u3001delay \u5ef6\u65f6\u5165\u961f(\u7531\u4f18\u5148\u7ea7\u961f\u5217\u901a\u8fc7\u5c0f\u9876\u5806\u5b9e\u73b0)\u3001queue \u961f\u5217\u5904\u7406 \u4e09\u5927\u6838\u5fc3\u80fd\u529b\uff0c\u53e6\u5916\uff0c\u5728\u4ee3\u7801\u4e2d\u53ef\u770b\u5230 K8s \u5b9e\u73b0\u4e86\u4e09\u79cd RateLimiter\uff1aBucketRateLimiter, ItemExponentialFailureRateLimiter, ItemFastSlowRateLimiter\u3002</p>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#22","title":"2.2 \u7279\u5f81","text":"<p>WorkQueue \u79f0\u4e3a\u5de5\u4f5c\u961f\u5217\uff0cKubernetes \u7684 WorkQueue \u961f\u5217\u4e0e\u666e\u901a FIFO\uff08\u5148\u8fdb\u5148\u51fa\uff0cFirst-In, First-Out\uff09\u961f\u5217\u76f8\u6bd4\uff0c\u5b9e\u73b0\u7565\u663e\u590d\u6742\uff0c\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u5728\u4e8e\u6807\u8bb0\u548c\u53bb\u91cd\uff0c\u5e76\u652f\u6301\u5982\u4e0b\u7279\u6027\u3002</p> <ul> <li>\u6709\u5e8f\uff1a\u6309\u7167\u6dfb\u52a0\u987a\u5e8f\u5904\u7406\u5143\u7d20\uff08item\uff09\u3002</li> <li>\u53bb\u91cd\uff1a\u76f8\u540c\u5143\u7d20\u5728\u540c\u4e00\u65f6\u95f4\u4e0d\u4f1a\u88ab\u91cd\u590d\u5904\u7406\uff0c\u4f8b\u5982\u4e00\u4e2a\u5143\u7d20\u5728\u5904\u7406\u4e4b\u524d\u88ab\u6dfb\u52a0\u4e86\u591a\u6b21\uff0c\u5b83\u53ea\u4f1a\u88ab\u5904\u7406\u4e00\u6b21\u3002</li> <li>\u5e76\u53d1\u6027\uff1a\u591a\u751f\u4ea7\u8005\u548c\u591a\u6d88\u8d39\u8005\u3002</li> <li>\u6807\u8bb0\u673a\u5236\uff1a\u652f\u6301\u6807\u8bb0\u529f\u80fd\uff0c\u6807\u8bb0\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u88ab\u5904\u7406\uff0c\u4e5f\u5141\u8bb8\u5143\u7d20\u5728\u5904\u7406\u65f6\u91cd\u65b0\u6392\u961f\u3002</li> <li>\u901a\u77e5\u673a\u5236\uff1aShutDown \u65b9\u6cd5\u901a\u8fc7\u4fe1\u53f7\u91cf\u901a\u77e5\u961f\u5217\u4e0d\u518d\u63a5\u6536\u65b0\u7684\u5143\u7d20\uff0c\u5e76\u901a\u77e5 metric goroutine \u9000\u51fa\u3002</li> <li>\u5ef6\u8fdf\uff1a\u652f\u6301\u5ef6\u8fdf\u961f\u5217\uff0c\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\u540e\u518d\u5c06\u5143\u7d20\u5b58\u5165\u961f\u5217\u3002</li> <li>\u9650\u901f\uff1a\u652f\u6301\u9650\u901f\u961f\u5217\uff0c\u5143\u7d20\u5b58\u5165\u961f\u5217\u65f6\u8fdb\u884c\u901f\u7387\u9650\u5236\u3002\u9650\u5236\u4e00\u4e2a\u5143\u7d20\u88ab\u91cd\u65b0\u6392\u961f\uff08Reenqueued\uff09\u7684\u6b21\u6570\u3002</li> <li>Metric\uff1a\u652f\u6301 metric \u76d1\u63a7\u6307\u6807\uff0c\u53ef\u7528\u4e8e Prometheus \u76d1\u63a7\u3002</li> </ul>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_2","title":"\u4e09 \u6e90\u7801\u5206\u6790","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#31","title":"3.1 \u901a\u7528\u961f\u5217","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#311","title":"3.1.1 \u961f\u5217\u63a5\u53e3","text":"<p>\u901a\u7528\u961f\u5217FIFO \u961f\u5217\u652f\u6301\u6700\u57fa\u672c\u7684\u961f\u5217\u65b9\u6cd5\uff0c\u4f8b\u5982\u63d2\u5165\u5143\u7d20\u3001\u83b7\u53d6\u5143\u7d20\u3001\u83b7\u53d6\u961f\u5217\u957f\u5ea6\u7b49\u3002\u53e6\u5916\uff0cWorkQueue \u4e2d\u7684\u9650\u901f\u53ca\u5ef6\u8fdf\u961f\u5217\u90fd\u57fa\u4e8e Interface \u63a5\u53e3\u5b9e\u73b0\uff0c\u5176\u63d0\u4f9b\u5982\u4e0b\u65b9\u6cd5\uff1a</p> <pre><code>// k8s.io/client-go/util/workqueue/queue.go\ntype Interface interface {\n  // \u4e3a\u961f\u5217\u6dfb\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\n    Add(item interface{})\n  // \u83b7\u53d6\u961f\u5217\u957f\u5ea6\n    Len() int\n  // \u4ece\u5934\u90e8\u83b7\u53d6\u4e00\u4e2a\u5143\u7d20\n    Get() (item interface{}, shutdown bool)\n  // \u6807\u8bb0\u4e00\u4e2a\u5143\u7d20\u5904\u7406\u5b8c\u6210\n    Done(item interface{})\n  // \u5173\u95ed\u961f\u5217\n    ShutDown()\n  // \u83b7\u53d6\u961f\u5217\u662f\u5426\u6b63\u5728\u5173\u95ed\n    ShuttingDown() bool\n}\n</code></pre>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#312","title":"3.1.2 \u961f\u5217\u5b9e\u73b0","text":"<p>\u901a\u7528\u961f\u5217\u5177\u4f53\u5b9e\u73b0\u4e3aType\uff0c\u5176\u4e2d\u6709\u975e\u5e38\u91cd\u8981\u7684\u4e09\u4e2a\u5c5e\u6027\uff0cqueue\u4e3a\u4e00\u4e2a\u4efb\u610f\u7c7b\u578b\u5143\u7d20\u7684slice\uff0c\u662f\u5177\u4f53\u5b58\u50a8\u5143\u7d20\u7684\u5730\u65b9\uff0c\u5176\u5b9e\u4e00\u4e2a\uff1bdirty\u8868\u793a\u5143\u7d20\u5728\u5185\u5b58\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u5143\u7d20\u8fdb\u884c\u53bb\u91cd\uff1bprocessing\u8868\u793a\u5f53\u524d\u6b63\u5728\u5904\u7406\u4e2d\u7684\u5143\u7d20\u3002</p> <pre><code>// \u5177\u4f53queue\u7684\u5b9e\u73b0\ntype Type struct {\n    // \u5b58\u50a8\u5177\u4f53\u5143\u7d20\uff0c\u7c7b\u578b\u4e3aslice\n    queue []t\n    // \u5b9a\u4e49\u6240\u6709\u7684\u5143\u7d20\u88ab\u5904\u7406\uff0c\u662f\u4ee5map\u7c7b\u578b\uff0c\u53ef\u4ee5\u5bf9\u5143\u7d20\u53bb\u91cd\n    dirty set\n    // \u6807\u8bb0\u5143\u7d20\u662f\u5426\u6b63\u5728\u5904\u7406\u3002\n  // \u6709\u4e9b\u5143\u7d20\u53ef\u80fd\u540c\u65f6\u5b58\u5728processing\u548cdirty\u4e2d\uff0c\u5f53\u5904\u7406\u5b8c\u8fd9\u4e2a\u5143\u7d20\uff0c\u4ece\u96c6\u5408\u5220\u9664\u7684\u65f6\u5019\uff0c\u5982\u679c\u53d1\u73b0\u5143\u7d20\u8fd8\u5728dirty\u96c6\u5408\u4e2d\uff0c\u5728\u6b64\u5c06\u5176\u6dfb\u52a0\u81f3queue\u961f\u5217\u4e2d\n    processing set\n\n    cond *sync.Cond\n\n    shuttingDown bool\n\n    metrics queueMetrics\n\n    unfinishedWorkUpdatePeriod time.Duration\n    clock                      clock.Clock\n}\n\n// \u7a7a\u7ed3\u6784\u4f53\ntype empty struct{}\n// t\u4e3a\u7a7a\u63a5\u53e3\u7c7b\u578b\uff0c\u8868\u793a\u4efb\u610f\u7c7b\u578b\ntype t interface{}  \n// set \u96c6\u5408\uff0c\u7528 map \u6765\u6a21\u62df set \u96c6\u5408\uff08\u5143\u7d20\u4e0d\u91cd\u590d\uff09\uff0c\u66f4\u5feb\u6548\u7387\u7684\u67e5\u627e\u5143\u7d20\ntype set map[t]empty\n</code></pre>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#313","title":"3.1.3 \u901a\u7528\u961f\u5217\u65b9\u6cd5","text":"<ul> <li>Add</li> </ul> <p>Add\u65b9\u6cd5\u4e3a\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u5230item\u4e2d\uff0c\u9996\u5148\u4f1a\u5224\u65ad\u961f\u5217\u662f\u5426\u5173\u95ed\uff0c\u5176\u6b21\u4f1a\u5224\u65ad\u5143\u7d20\u662f\u5426\u4ee5\u53ca\u5b58\u5728dirty\u4e2d\uff0c\u5982\u679c\u5728\u5219\u8fd4\u56de\u5b9e\u73b0\u53bb\u91cd\uff0c\u540c\u65f6\u5224\u65ad\u5143\u7d20\u662f\u5426\u6b63\u5728\u5904\u7406\u4e2d\uff0c\u5982\u679c\u5b58\u5728\u5143\u7d20\u5904\u7406\u4e2d\uff0c\u5219\u4e0d\u5c06\u5176\u6dfb\u52a0\u8fdbqueue\u4e2d\uff0c\u800c\u662f\u7b49\u540e\u671f\u6807\u8bb0Done\u65f6\u5019\uff0c\u5c06dirty\u4e2d\u7684\u5143\u7d20\u6dfb\u52a0\u8fdb\u5165queue\u4e2d\uff0c\u5982\u679c\u6ca1\u6709\u6b63\u5728\u5904\u7406\uff0c\u5219\u5143\u7d20\u6210\u529f\u6dfb\u52a0\u8fdbqueue\u4e2d\u3002</p> <pre><code>func (q *Type) Add(item interface{}) {\n    q.cond.L.Lock()\n    defer q.cond.L.Unlock()\n  // \u5982\u679c\u961f\u5217\u5df2\u7ecf\u5173\u95ed\u5219\u76f4\u63a5\u8fd4\u56de\n    if q.shuttingDown {\n        return\n    }\n  // \u5982\u679cdirty\u4e2d\u5df2\u7ecf\u6709\u8be5\u5143\u7d20\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u76ee\u7684\u662f\u5b9e\u73b0\u53bb\u91cd\n    if q.dirty.has(item) {\n        return\n    }\n\n    q.metrics.add(item)\n  // \u6dfb\u52a0\u5143\u7d20\u5230dirty\u4e2d\n    q.dirty.insert(item)\n  // \u5982\u679c\u5143\u7d20\u6b63\u5728\u5904\u7406\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\n    if q.processing.has(item) {\n        return\n    }\n  // \u6dfb\u52a0\u5143\u7d20\u5230queue\u4e2d\n    q.queue = append(q.queue, item)\n  // \u901a\u77e5\u5176\u4ed6\u534f\u7a0b\u63a5\u89e6\u963b\u585e\n    q.cond.Signal()\n}\n</code></pre> <ul> <li>Get</li> </ul> <p>Get\u65b9\u6cd5\uff0c\u4ece\u961f\u5217\u5934\u90e8\u5f39\u51fa\u4e00\u4e2a\u5143\u7d20\u5c06\u653e\u5230proocessing\u96c6\u5408\u4e2d\uff0c\u4ecedirty\u96c6\u5408\u4e2d\u79fb\u9664\u3002</p> <pre><code>func (q *Type) Get() (item interface{}, shutdown bool) {\n    q.cond.L.Lock()\n    defer q.cond.L.Unlock()\n  // \u5982\u679c\u961f\u5217\u4e3a\u5173\u95ed\uff0c\u4e14\u961f\u5217\u957f\u5ea6\u4e3a0\uff0c\u5219\u8fdb\u884c\u963b\u585e\uff0c\u5f85\u5143\u7d20\u6dfb\u52a0\u8fdb\u961f\u5217\u53d1\u9001\u89e3\u9664\u963b\u585e\u901a\u77e5\u6267\u884c\n    for len(q.queue) == 0 &amp;&amp; !q.shuttingDown {\n        q.cond.Wait()\n    }\n  // \u5982\u679c\u961f\u5217\u957f\u5ea6\u4e3a0\uff0c\u5219\u5173\u95ed\u961f\u5217\n    if len(q.queue) == 0 {\n        // We must be shutting down.\n        return nil, true\n    }\n  // \u4ece\u961f\u5217\u5934\u90e8\u586b\u51fa\u7b2c\u4e00\u4e2a\u5143\u7d20\n    item, q.queue = q.queue[0], q.queue[1:]\n\n    q.metrics.get(item)\n  // \u5c06\u5143\u7d20\u63d2\u5165\u5230processing\u4e2d\uff0c\u6807\u8bb0\u4e3a\u6b63\u5728\u5904\u7406\n    q.processing.insert(item)\n  // \u4ecedirty\u4e2d\u5220\u9664\u961f\u5217\n    q.dirty.delete(item)\n\n    return item, false\n}\n</code></pre> <ul> <li>Done</li> </ul> <p>Done\u65b9\u6cd5\u6807\u793a\u5143\u7d20\u4ee5\u5904\u7406\u5b8c\u6210\uff0c\u8be5\u65b9\u6cd5\u4e3a\u4e86\u4fdd\u8bc1\u540c\u4e00\u65f6\u523b\u4e0d\u80fd\u6709\u4e24\u4e2a\u76f8\u540c\u7684\u5143\u7d20\u88ab\u5904\u7406\uff0c\u5982\u679c\u6b63\u5728\u5904\u7406\u4e00\u4e2a\u5143\u7d20\uff0c\u7531\u6dfb\u52a0\u8fdb\u6765\u540c\u6837\u7684\u4e00\u4e2a\uff0c\u5148\u5c06\u5176\u6dfb\u52a0\u8fdbdirty\u4e2d\uff0c\u5728Done\u65b9\u6cd5\u4e2d\uff0c\u518d\u68c0\u67e5dirty\u5c06\u65b0\u5143\u7d20\u91cd\u65b0\u5165\u961f\u5217\u3002</p> <pre><code>func (q *Type) Done(item interface{}) {\n    q.cond.L.Lock()\n    defer q.cond.L.Unlock()\n\n    q.metrics.done(item)\n    // \u5c06processing\u4e2d\u7684\u5143\u7d20\u79fb\u9664\n    q.processing.delete(item)\n  // \u5224\u65ad\u5143\u7d20\u662f\u5426\u8fd8\u5728dirty\u4e2d\uff0c\u5982\u679c\u5728\u5219\u5c06\u5176\u91cd\u65b0\u6dfb\u52a0\u81f3queue\u4e2d\n    if q.dirty.has(item) {\n        q.queue = append(q.queue, item)\n        q.cond.Signal()\n    }\n}\n</code></pre> <p>\u6bd4\u8f83\u91cd\u8981\u7684\u5c31\u8fd9\u4e09\u4e2a\u65b9\u6cd5\uff0c\u5176\u4ed6\u7684Len/ShutDown\u6bd4\u8f83\u7b80\u5355\uff0c\u53ef\u4ee5\u81ea\u5df1\u53bb\u53c2\u8003\u6e90\u7801\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u6b63\u5e38\u5904\u74061\u5143\u7d20\u65f6\u5019\uff0c\u65b0\u6dfb\u52a0\u8fdb\u6765\u76841\u4e0d\u4f1a\u7acb\u5373\u88ab\u5b58\u5165\u5230queue\u4e2d\uff0c\u800c\u662f\u5f85processing\u4e2d1\u6807\u8bb0Done\u7684\u65f6\u5019\uff0c\u518d\u5c06\u5176\u63d2\u5165\u5230queue\u4e2d\uff0c\u8fdb\u884c\u540e\u7eed\u5904\u7406\uff0c\u6ce8\u610fdirty\u548cprocessing\u90fd\u662fHash Map\u7c7b\u578b\uff0c\u5176\u4e0d\u7528\u8003\u8651\u65e0\u5e8f\uff0c\u53ea\u4fdd\u8bc1\u53bb\u91cd\u5373\u53ef\u3002</p>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#32","title":"3.2 \u5ef6\u8fdf\u961f\u5217","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#321","title":"3.2.1 \u5ef6\u8fdf\u961f\u5217\u63a5\u53e3","text":"<p>\u8be5\u63a5\u53e3\u6d89\u53ca\u7684\u76ee\u7684\u5c31\u662f\u53ef\u4ee5\u907f\u514d\u67d0\u4e9b\u5931\u8d25\u7684<code>items</code>\u9677\u5165\u70ed\u5faa\u73af. \u56e0\u4e3a\u67d0\u4e9b<code>item</code>\u5728\u51fa\u961f\u5217\u8fdb\u884c\u5904\u7406\u6709\u53ef\u80fd\u5931\u8d25, \u5931\u8d25\u4e86\u7528\u6237\u5c31\u6709\u53ef\u80fd\u5c06\u8be5\u5931\u8d25\u7684<code>item</code>\u91cd\u65b0\u8fdb\u961f\u5217, \u5982\u679c\u77ed\u65f6\u95f4\u5185\u53c8\u51fa\u961f\u5217\u6709\u53ef\u80fd\u8fd8\u662f\u4f1a\u5931\u8d25(\u56e0\u4e3a\u77ed\u65f6\u95f4\u5185\u6574\u4e2a\u73af\u5883\u53ef\u80fd\u6ca1\u6709\u6539\u53d8\u7b49\u7b49), \u6240\u4ee5\u53ef\u80fd\u53c8\u91cd\u65b0\u8fdb\u961f\u5217\u7b49\u7b49, \u56e0\u6b64\u9677\u5165\u4e86\u4e00\u79cd<code>hot-loop</code>. \u6240\u4ee5\u5c31\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86<code>AddAfter</code>\u65b9\u6cd5, \u53ef\u4ee5\u5141\u8bb8\u7528\u6237\u544a\u8bc9<code>DelayingInterface</code>\u8fc7\u591a\u957f\u65f6\u95f4\u628a\u8be5<code>item</code>\u52a0\u5165\u961f\u5217\u4e2d.</p> <pre><code>type DelayingInterface interface {\n    Interface\n  // \u5728\u6b64\u523b\u8fc7duration\u65f6\u95f4\u540e\u518d\u52a0\u5165\u5230queue\u4e2d \n    AddAfter(item interface{}, duration time.Duration)\n}\n</code></pre>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#322","title":"3.2.2 \u5ef6\u8fdf\u961f\u5217\u5b9e\u73b0","text":"<p>\u5ef6\u8fdf\u961f\u5217\u7684\u5b9e\u73b0\u4e3adelayingType\uff0c\u5176\u7ee7\u627f\u4e86\u901a\u7528\u63a5\u53e3\uff0c\u5728\u5176\u57fa\u7840\u4e0a\u4e3b\u8981\u65b0\u589e\u4e86waitingForAddCh\u5b57\u6bb5\uff0c\u6765\u5b9e\u73b0\u5ef6\u8fdf\u7684\u529f\u80fd</p> <p>waitingForAddCh\uff1a\u5176\u9ed8\u8ba4\u521d\u59cb\u5927\u5c0f\u4e3a 1000\uff0c\u901a\u8fc7 AddAfter \u65b9\u6cd5\u63d2\u5165\u5143\u7d20\u65f6\uff0c\u662f\u975e\u963b\u585e\u72b6\u6001\u7684\uff0c\u53ea\u6709\u5f53\u63d2\u5165\u7684\u5143\u7d20\u5927\u4e8e\u6216\u7b49\u4e8e 1000 \u65f6\uff0c\u5ef6\u8fdf\u961f\u5217\u624d\u4f1a\u5904\u4e8e\u963b\u585e\u72b6\u6001\u3002waitingForAddCh \u5b57\u6bb5\u4e2d\u7684\u6570\u636e\u901a\u8fc7 goroutine \u8fd0\u884c\u7684 waitingLoop \u51fd\u6570\u6301\u4e45\u8fd0\u884c\u3002</p> <p>waitFor: \u4fdd\u5b58\u4e86\u5305\u62ec\u6570\u636e<code>data</code>\u548c\u8be5<code>item</code>\u4ec0\u4e48\u65f6\u95f4\u8d77(<code>readyAt</code>)\u5c31\u53ef\u4ee5\u8fdb\u5165\u961f\u5217\u4e86. waitForPriorityQueue:waitForPriorityQueue \u4e3a waitFor \u9879\u76ee\u5b9e\u73b0\u4f18\u5148\u7ea7\u961f\u5217\uff0c\u662f\u7528\u4e8e\u4fdd\u5b58<code>waitFor</code>\u7684\u4f18\u5148\u961f\u5217, \u6309<code>readyAt</code>\u65f6\u95f4\u4ece\u65e9\u5230\u665a\u6392\u5e8f\uff0c\u5f62\u6210\u4e00\u4e2a\u4f18\u5148\u7ea7\u961f\u5217\uff0c \u5148<code>ready</code>\u7684<code>item</code>\u5148\u51fa\u961f\u5217.</p> <pre><code>type delayingType struct {\n    Interface\n\n    // clock tracks time for delayed firing\n    clock clock.Clock\n\n    // stopCh lets us signal a shutdown to the waiting loop\n    stopCh chan struct{}\n  // \u4fdd\u8bc1\u4ec5\u4ec5\u53d1\u9001\u4e00\u6b21\u5173\u95ed\u4fe1\u53f7\n    stopOnce sync.Once\n\n  // \u5728\u89e6\u53d1\u4e4b\u524d\u786e\u4fdd\u7b49\u5f85\u7684\u65f6\u95f4\u4e0d\u8d85\u8fc7maxWait\n    heartbeat clock.Ticker\n\n  // waitingForAddCh\u662f\u4e00\u4e2a\u7f13\u51b2channel\n    waitingForAddCh chan *waitFor\n\n    // \u8bb0\u5f55\u91cd\u8bd5\u6b21\u6570\n    metrics retryMetrics\n}\n\n// \u4fdd\u5b58\u4e86\u5305\u62ec\u6570\u636e`data`\u548c\u8be5`item`\u4ec0\u4e48\u65f6\u95f4\u8d77(`readyAt`)\u5c31\u53ef\u4ee5\u8fdb\u5165\u961f\u5217\u4e86.\ntype waitFor struct {\n    data    t\n    readyAt time.Time\n    // index in the priority queue (heap)\n    index int\n}\n// waitForPriorityQueue \u4e3a waitFor \u9879\u76ee\u5b9e\u73b0\u4f18\u5148\u7ea7\u961f\u5217\n// \u662f\u7528\u4e8e\u4fdd\u5b58`waitFor`\u7684\u4f18\u5148\u961f\u5217, \u6309`readyAt`\u65f6\u95f4\u4ece\u65e9\u5230\u665a\u6392\u5e8f. \u5148`ready`\u7684`item`\u5148\u51fa\u961f\u5217.\ntype waitForPriorityQueue []*waitFor\n</code></pre>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#323","title":"3.2.3 \u5ef6\u8fdf\u961f\u5217\u65b9\u6cd5","text":"<ul> <li>AddAfter</li> </ul> <p>AddAfter\u65b9\u6cd5\u4e3a\u5ef6\u8fdf\u961f\u5217\u6dfb\u52a0\u5143\u7d20\uff0c\u9664\u4e86\u5177\u4f53\u5143\u7d20\u5916\uff0c\u8fd8\u9700\u8981\u4f20\u5165\u5ef6\u8fdf\u591a\u957f\u65f6\u95f4\u3002</p> <pre><code>func (q *delayingType) AddAfter(item interface{}, duration time.Duration) {\n    // don't add if we're already shutting down\n    if q.ShuttingDown() {\n        return\n    }\n\n    q.metrics.retry()\n\n    // \u5982\u679c\u4f20\u5165\u7684\u65f6\u95f4\u5c0f\u4e8e\u7b49\u4e8e0\u5219\u7acb\u5373\u6dfb\u52a0\n    if duration &lt;= 0 {\n        q.Add(item)\n        return\n    }\n\n\n    select {\n    case &lt;-q.stopCh:\n        // unblock if ShutDown() is called\n    // \u6784\u9020\u4e00\u4e2awaitFor\u5bf9\u8c61\u4f20\u5165\u5230waitingForAddCh\u901a\u9053\u4e2d\n    case q.waitingForAddCh &lt;- &amp;waitFor{data: item, readyAt: q.clock.Now().Add(duration)}:\n    }\n}\n</code></pre> <ul> <li>waitingLoop</li> </ul> <p>waitingLoop \u65b9\u6cd5\u4e00\u76f4\u8fd0\u884c\u5230\u5de5\u4f5c\u961f\u5217\u5173\u95ed\uff0c\u5e76\u68c0\u67e5\u8981\u6dfb\u52a0\u7684\u9879\u76ee\u5217\u8868\uff0c\u5229\u7528channel(q.waitingForAddCh)\u4e00\u76f4\u63a5\u53d7\u4eceAddAfter\u8fc7\u6765\u7684waitFor\uff0c\u5c06\u5df2\u7ecfready\u7684item\u6dfb\u52a0\u5230\u961f\u5217\u4e2d\u3002</p> <pre><code>func (q *delayingType) waitingLoop() {\n    defer utilruntime.HandleCrash()\n  // \u521b\u5efa\u4e00\u4e2a\u5360\u4f4dchannel\uff0c\u5f53list\u6ca1\u6709\u5143\u7d20\u7684\u65f6\u5019\uff0c\u5229\u7528\u5176\u5b9e\u73b0\u7b49\u5f85\n    never := make(&lt;-chan time.Time)\n\n    // \u6784\u9020\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5f53\u7b49\u5f85\u961f\u5217\u5934\u90e8\u7684\u5143\u7d20\u51c6\u5907\u597d\u540e\uff0c\u8be5\u5b9a\u65f6\u5668\u5931\u6548\n  var nextReadyAtTimer clock.Timer\n\n  // \u6784\u9020\u4e00\u4e2a\u4f18\u5148\u961f\u5217\n    waitingForQueue := &amp;waitForPriorityQueue{}\n    heap.Init(waitingForQueue)\n    // \u5229\u7528map\u5b9e\u73b0\u53bb\u91cd\uff0c\u5982\u679c\u5728\u6b64\u6dfb\u52a0\u76f8\u540c\u5143\u7d20\uff0c\u4ec5\u5b9e\u73b0\u66f4\u65b0\u65f6\u95f4\n    waitingEntryByData := map[t]*waitFor{}\n\n    for {\n        if q.Interface.ShuttingDown() {\n            return\n        }\n\n        now := q.clock.Now()\n        // \u5982\u679c\u4f18\u5148\u961f\u5217\u6709\u5143\u7d20\n        for waitingForQueue.Len() &gt; 0 {\n            entry := waitingForQueue.Peek().(*waitFor)\n      // \u5982\u679c\u961f\u5217\u5934\u90e8\u7684\u5143\u7d20\u65f6\u95f4\u5df2\u7ecf\u5927\u4e8e\u73b0\u5728\u65f6\u95f4\uff0c\u5219\u8868\u660e\u6574\u4e2a\u4f18\u5148\u7ea7\u961f\u5217\u4e2d\u7684\u5143\u7d20\u90fd\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c\u8fd8\u6ca1\u5230\u63d2\u5165\u5143\u7d20\u7684\u65f6\u95f4\uff0c\u5219\u76f4\u63a5break\n      // \u7b2c\u4e00\u4e2a\u5143\u7d20\u65f6\u95f4\u662f\u6700\u5c0f\u7684\n            if entry.readyAt.After(now) {\n                break\n            }\n            // \u5426\u5219\u8bf4\u660e\u4ee5\u53ca\u6539\u5230\u4e86\u63d2\u5165\u6570\u636e\u65f6\u95f4\u4e86\uff0c\u6267\u884c\u63d2\u5165\u5230\u901a\u7528\u961f\u5217\u4e2d\n            entry = heap.Pop(waitingForQueue).(*waitFor)\n            q.Add(entry.data)\n      // \u5e76\u4ece\u4f18\u5148\u7ea7\u961f\u5217\u5220\u9664\n            delete(waitingEntryByData, entry.data)\n        }\n        // \u5f53\u4f18\u5148\u7ea7\u961f\u5217\u4e2d\u6ca1\u6709\u5143\u7d20\uff0c\u5219\u5728\u540e\u9762\u8fdb\u884c\u7b49\u5f85\n        nextReadyAt := never\n    // \u5982\u679c\u4f18\u5148\u7ea7\u961f\u5217\u4e2d\u6709\u5143\u7d20\n        if waitingForQueue.Len() &gt; 0 {\n            if nextReadyAtTimer != nil {\n                nextReadyAtTimer.Stop()\n            }\n\n      // \u83b7\u53d6\u7b2c\u4e00\u4e2a\u5143\u7d20\n            entry := waitingForQueue.Peek().(*waitFor)\n      // \u6784\u9020\u4e00\u4e2anextReady\u65f6\u95f4\u7b49\u5f85\u5668\n            nextReadyAtTimer = q.clock.NewTimer(entry.readyAt.Sub(now))\n            nextReadyAt = nextReadyAtTimer.C()\n        }\n\n        select {\n        case &lt;-q.stopCh:\n            return\n        // \u5b9a\u65f6\u5668\uff0c\u5982\u679c\u8fc7\u4e00\u6bb5\u65f6\u95f4\u5728\u6ca1\u6709\u4efb\u4f55\u6570\u636e\uff0c\u5219\u8fdb\u884c\u4e00\u6b21\u5927\u5faa\u73af\n        case &lt;-q.heartbeat.C():\n            // continue the loop, which will add ready items\n\n        case &lt;-nextReadyAt:\n            // continue the loop, which will add ready items\n\n    // addAfter\u653e\u5165\u7684\u5143\u7d20\u4ece\u8be5\u5904\u83b7\u53d6\n        case waitEntry := &lt;-q.waitingForAddCh:\n      // \u5982\u679c\u5143\u7d20\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c\u5219\u6dfb\u52a0\u5230\u4f18\u5148\u7ea7\u961f\u5217\u4e2d\n            if waitEntry.readyAt.After(q.clock.Now()) {\n                insert(waitingForQueue, waitingEntryByData, waitEntry)\n            } else {\n        // \u65f6\u95f4\u5230\u4e86\u5219\u6dfb\u52a0\u8fdb\u901a\u7528\u961f\u5217\n                q.Add(waitEntry.data)\n            }\n            // \u5c06channel\u4e2d\u7684\u5143\u7d20\u5168\u90e8\u53d6\u51fa\u6765\n            drained := false\n            for !drained {\n                select {\n                case waitEntry := &lt;-q.waitingForAddCh:\n                    if waitEntry.readyAt.After(q.clock.Now()) {\n                        insert(waitingForQueue, waitingEntryByData, waitEntry)\n                    } else {\n                        q.Add(waitEntry.data)\n                    }\n                default:\n                    drained = true\n                }\n            }\n        }\n    }\n}\n\n// \u6dfb\u52a0\u5143\u7d20\u81f3\u4f18\u5148\u7ea7\u961f\u5217\uff0c\u5982\u679c\u5143\u7d20\u76f8\u540c\u5219\u8fdb\u884c\u66f4\u65b0\u65f6\u95f4\nfunc insert(q *waitForPriorityQueue, knownEntries map[t]*waitFor, entry *waitFor) {\n    // \u5224\u65ad\u961f\u5217\u4e2d\u662f\u5426\u5df2\u7ecf\u5b58\u5728\u8be5\u5143\u7d20\n    existing, exists := knownEntries[entry.data]\n  // \u5982\u679c\u5b58\u5219\uff0c\u5219\u76f4\u63a5\u66f4\u65b0\u5143\u7d20\n    if exists {\n        if existing.readyAt.After(entry.readyAt) {\n            existing.readyAt = entry.readyAt\n            heap.Fix(q, existing.index)\n        }\n\n        return\n    }\n    // \u4e0d\u5b58\u5728\u5219\u6dfb\u52a0\u8fdb\u4f18\u5148\u7ea7\u961f\u5217\n    heap.Push(q, entry)\n    knownEntries[entry.data] = entry\n}\n</code></pre> <p>\u81f3\u6b64\u5c31\u5b8c\u6210\u4e86\u9650\u901f\u961f\u5217\u7684\u6e90\u7801\u5206\u6790\uff0c\u5176\u5728\u901a\u7528\u961f\u5217\u4e4b\u4e0a\u6784\u9020\u4f18\u5148\u7ea7\u961f\u5217\uff0c\u5982\u679c\u65f6\u95f4\u6ca1\u5230\u7684\u6dfb\u52a0\u5230\u4f18\u5148\u7ea7\u961f\u5217\u4e2d\uff0c\u5f85\u65f6\u95f4\u5230\u4e86\u6dfb\u52a0\u5230\u901a\u7528\u961f\u5217\u4e2d\u8fdb\u884c\u6b63\u5e38\u5904\u7406\uff0c\u5176\u4e2d\u4f18\u5148\u7ea7\u961f\u5217\u5b9e\u73b0\u5229\u7528\u4e86golang\u5e95\u5c42\u5e93heap\uff0c\u53c8\u5174\u8da3\u7684\u53ef\u4ee5\u8fdb\u4e00\u6b65\u9605\u8bfb\u6e90\u7801\u3002</p>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#33","title":"3.3 \u9650\u901f\u961f\u5217","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#331","title":"3.3.1 \u9650\u901f\u961f\u5217\u63a5\u53e3","text":"<p>\u9650\u901f\u961f\u5217\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u5728\u5143\u7d20\u5165\u5bf9\u901f\u5ea6\u6709\u4e00\u5b9a\u9650\u5236\uff0c\u5176\u5229\u7528\u5ef6\u8fdf\u961f\u5217\u7684\u7279\u6027\u5b9e\u73b0\u5bf9\u5143\u7d20\u63d2\u5165\u961f\u5217\u7684\u901f\u5ea6\u63a7\u5236\uff0c\u56e0\u6b64\u9650\u901f\u961f\u5217\u4e5f\u662f\u6269\u5c55\u7684\u5ef6\u8fdf\u961f\u5217\uff0c\u65b0\u589e\u6709AddRateLimited\u3001Forget\u3001NumRequeues 3\u4e2a\u65b9\u6cd5\u3002</p> <pre><code>type RateLimitingInterface interface {\n    DelayingInterface\n\n    // \u589e\u52a0\u4e00\u4e2a\u5143\u7d20\u5927\u9650\u901f\u961f\u5217\n    AddRateLimited(item interface{})\n\n  // \u8868\u793a\u5b8c\u6210\u8be5\u5143\u7d20\u91cd\u8bd5\uff0c\u4e22\u5f03\u6389\u8be5\u5143\u7d20\n    Forget(item interface{})\n\n    // \u67e5\u8be2\u5143\u7d20\u5165\u961f\u5217\u7684\u6b21\u6570\n    NumRequeues(item interface{}) int\n}\n</code></pre>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#332","title":"3.3.2 \u9650\u901f\u961f\u5217\u5b9e\u73b0","text":"<p>\u6211\u4eec\u770b\u5176\u4e2d\u4e3b\u8981\u8fd8\u662f\u8c03\u7528rateLimiter \u7684\u63a5\u53e3\u65b9\u6cd5\uff0c</p> <pre><code>// rateLimitingType \u662f\u9650\u901f\u961f\u5217\u7684\u5177\u4f53\u5b9e\u73b0\ntype rateLimitingType struct {\n  // \u7ee7\u627f\u5ef6\u8fdf\u961f\u5217\n    DelayingInterface\n    // \u65b0\u589e\u9650\u901f\u63a5\u53e3\n    rateLimiter RateLimiter\n}\n\n// \u83b7\u53d6\u5230\u9650\u901f\u5668\u5ef6\u8fdf\u65f6\u95f4\uff0c\u7136\u540e\u52a0\u5165\u5230\u5ef6\u8fdf\u961f\u5217\nfunc (q *rateLimitingType) AddRateLimited(item interface{}) {\n    q.DelayingInterface.AddAfter(item, q.rateLimiter.When(item))\n}\n\n// \u901a\u8fc7\u9650\u901f\u5668\u83b7\u53d6\u5143\u7d20\u52a0\u5165\u961f\u5217\u7684\u6b21\u6570\nfunc (q *rateLimitingType) NumRequeues(item interface{}) int {\n    return q.rateLimiter.NumRequeues(item)\n}\n\n// \u901a\u8fc7\u9650\u901f\u5668\u4e22\u5f03\u5143\u7d20\nfunc (q *rateLimitingType) Forget(item interface{}) {\n    q.rateLimiter.Forget(item)\n}\n</code></pre>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#333","title":"3.3.3 \u9650\u901f\u5668\u65b9\u6cd5","text":"<pre><code>// \u9650\u901f\u5668\u63a5\u53e3\ntype RateLimiter interface {\n    // \u83b7\u53d6\u5143\u7d20\u7b49\u5f85\u65f6\u95f4\n    When(item interface{}) time.Duration\n    // \u91ca\u653e\u6307\u5b9a\u5143\u7d20\n    Forget(item interface{})\n    // \u8fd4\u56de\u67d0\u4e2a\u5bf9\u8c61\u91cd\u65b0\u5165\u961f\u5217\u6b21\u6570\n    NumRequeues(item interface{}) int\n}\n</code></pre> <ul> <li>BucketRateLimiter</li> </ul> <p>\u4ee4\u724c\u6876\u7b97\u6cd5\u662f\u901a\u8fc7 Go \u8bed\u8a00\u7684\u7b2c\u4e09\u65b9\u5e93 golang.org/x/time/rate \u5b9e\u73b0\u7684\u3002\u4ee4\u724c\u6876\u7b97\u6cd5\u5185\u90e8\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5b58\u653e token\uff08\u4ee4\u724c\uff09\u7684\u201c\u6876\u201d\uff0c\u521d\u59cb\u65f6\u201c\u6876\u201d\u662f\u7a7a\u7684\uff0ctoken \u4f1a\u4ee5\u56fa\u5b9a\u901f\u7387\u5f80\u201c\u6876\u201d\u91cc\u586b\u5145\uff0c\u76f4\u5230\u5c06\u5176\u586b\u6ee1\u4e3a\u6b62\uff0c\u591a\u4f59\u7684 token \u4f1a\u88ab\u4e22\u5f03\u3002\u6bcf\u4e2a\u5143\u7d20\u90fd\u4f1a\u4ece\u4ee4\u724c\u6876\u5f97\u5230\u4e00\u4e2a token\uff0c\u53ea\u6709\u5f97\u5230 token \u7684\u5143\u7d20\u624d\u5141\u8bb8\u901a\u8fc7\uff08accept\uff09\uff0c\u800c\u6ca1\u6709\u5f97\u5230 token \u7684\u5143\u7d20\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002\u4ee4\u724c\u6876\u7b97\u6cd5\u901a\u8fc7\u63a7\u5236\u53d1\u653e token \u6765\u8fbe\u5230\u9650\u901f\u76ee\u7684\u3002</p> <p></p> <pre><code>type BucketRateLimiter struct {\n    *rate.Limiter\n}\n\n\nfunc (r *BucketRateLimiter) When(item interface{}) time.Duration {\n    return r.Limiter.Reserve().Delay()\n}\n\nfunc (r *BucketRateLimiter) NumRequeues(item interface{}) int {\n    return 0\n}\n\nfunc (r *BucketRateLimiter) Forget(item interface{}) {\n}\n</code></pre> <p>\u5728\u5b9e\u4f8b\u5316 rate.NewLimiter \u540e\uff0c\u4f20\u5165 r \u548c b \u4e24\u4e2a\u53c2\u6570\uff0c\u5176\u4e2d r \u53c2\u6570\u8868\u793a\u6bcf\u79d2\u5f80\u201c\u6876\u201d\u91cc\u586b\u5145\u7684 token \u6570\u91cf\uff0cb \u53c2\u6570\u8868\u793a\u4ee4\u724c\u6876\u7684\u5927\u5c0f\uff08\u5373\u4ee4\u724c\u6876\u6700\u591a\u5b58\u653e\u7684 token \u6570\u91cf\uff09\u3002\u6211\u4eec\u5047\u5b9a r \u4e3a 10\uff0cb \u4e3a 100\u3002\u5047\u8bbe\u5728\u4e00\u4e2a\u9650\u901f\u5468\u671f\u5185\u63d2\u5165\u4e86 1000 \u4e2a\u5143\u7d20\uff0c\u901a\u8fc7 r.Limiter.Reserve().Delay \u51fd\u6570\u8fd4\u56de\u6307\u5b9a\u5143\u7d20\u5e94\u8be5\u7b49\u5f85\u7684\u65f6\u95f4\uff0c\u90a3\u4e48\u524d b\uff08\u5373 100\uff09\u4e2a\u5143\u7d20\u4f1a\u88ab\u7acb\u523b\u5904\u7406\uff0c\u800c\u540e\u9762\u5143\u7d20\u7684\u5ef6\u8fdf\u65f6\u95f4\u5206\u522b\u4e3a item100/100ms\u3001item101/200ms\u3001item102/300ms\u3001item103/400ms\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002</p> <pre><code>func DefaultControllerRateLimiter() RateLimiter {\n    return NewMaxOfRateLimiter(\n        NewItemExponentialFailureRateLimiter(5*time.Millisecond, 1000*time.Second),\n        // 10 qps, 100 bucket size.  This is only for retry speed and its only the overall factor (not per item)\n    // \u9ed8\u8ba4\u4ee4\u724c\u6876\u9650\u901f\u5668\n        &amp;BucketRateLimiter{Limiter: rate.NewLimiter(rate.Limit(10), 100)},\n    )\n}\n</code></pre> <ul> <li>ItemExponentialFailureRateLimiter</li> </ul> <p>\u6392\u961f\u6307\u6570\u7b97\u6cd5\u5c06\u76f8\u540c\u5143\u7d20\u7684\u6392\u961f\u6570\u4f5c\u4e3a\u6307\u6570\uff0c\u6392\u961f\u6570\u589e\u5927\uff0c\u901f\u7387\u9650\u5236\u5448\u6307\u6570\u7ea7\u589e\u957f\uff0c\u4f46\u5176\u6700\u5927\u503c\u4e0d\u4f1a\u8d85\u8fc7 maxDelay\u3002\u5143\u7d20\u7684\u6392\u961f\u6570\u7edf\u8ba1\u662f\u6709\u9650\u901f\u5468\u671f\u7684\uff0c\u4e00\u4e2a\u9650\u901f\u5468\u671f\u662f\u6307\u4ece\u6267\u884c AddRateLimited \u65b9\u6cd5\u5230\u6267\u884c\u5b8c Forget \u65b9\u6cd5\u4e4b\u95f4\u7684\u65f6\u95f4\u3002\u5982\u679c\u8be5\u5143\u7d20\u88ab Forget \u65b9\u6cd5\u5904\u7406\u5b8c\uff0c\u5219\u6e05\u7a7a\u6392\u961f\u6570\u3002\u6392\u961f\u6307\u6570\u7b97\u6cd5\u7684\u6838\u5fc3\u5b9e\u73b0\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>func (r *ItemExponentialFailureRateLimiter) When(item interface{}) time.Duration {\n    r.failuresLock.Lock()\n    defer r.failuresLock.Unlock()\n\n    exp := r.failures[item]\n    r.failures[item] = r.failures[item] + 1\n\n    // The backoff is capped such that 'calculated' value never overflows.\n    backoff := float64(r.baseDelay.Nanoseconds()) * math.Pow(2, float64(exp))\n    if backoff &gt; math.MaxInt64 {\n        return r.maxDelay\n    }\n\n    calculated := time.Duration(backoff)\n    if calculated &gt; r.maxDelay {\n        return r.maxDelay\n    }\n\n    return calculated\n}\n\nfunc (r *ItemExponentialFailureRateLimiter) NumRequeues(item interface{}) int {\n    r.failuresLock.Lock()\n    defer r.failuresLock.Unlock()\n\n    return r.failures[item]\n}\n\nfunc (r *ItemExponentialFailureRateLimiter) Forget(item interface{}) {\n    r.failuresLock.Lock()\n    defer r.failuresLock.Unlock()\n\n    delete(r.failures, item)\n}\n</code></pre> <p>failures \u5b57\u6bb5\u7528\u4e8e\u7edf\u8ba1\u5143\u7d20\u6392\u961f\u6570\uff0c\u6bcf\u5f53 AddRateLimited \u65b9\u6cd5\u63d2\u5165\u65b0\u5143\u7d20\u65f6\uff0c\u4f1a\u4e3a\u8be5\u5b57\u6bb5\u52a0 1\uff1b\u53e6\u5916\uff0cbaseDelay \u5b57\u6bb5\u662f\u6700\u521d\u7684\u9650\u901f\u5355\u4f4d\uff08\u9ed8\u8ba4\u4e3a 5ms\uff09\uff0cmaxDelay \u5b57\u6bb5\u662f\u6700\u5927\u9650\u901f\u5355\u4f4d\uff08\u9ed8\u8ba4\u4e3a 1000s\uff09</p> <p>\u9650\u901f\u961f\u5217\u5229\u7528\u5ef6\u8fdf\u961f\u5217\u7684\u7279\u6027\uff0c\u5ef6\u8fdf\u591a\u4e2a\u76f8\u540c\u5143\u7d20\u7684\u63d2\u5165\u65f6\u95f4\uff0c\u8fbe\u5230\u9650\u901f\u76ee\u7684\u3002</p> <p>\u6211\u4eec\u5047\u5b9a baseDelay \u662f 1 * time.Millisecond\uff0cmaxDelay \u662f 1000 * time.Second\u3002\u5047\u8bbe\u5728\u4e00\u4e2a\u9650\u901f\u5468\u671f\u5185\u901a\u8fc7 AddRateLimited \u65b9\u6cd5\u63d2\u5165 10 \u4e2a\u76f8\u540c\u5143\u7d20\uff0c\u90a3\u4e48\u7b2c 1 \u4e2a\u5143\u7d20\u4f1a\u901a\u8fc7\u5ef6\u8fdf\u961f\u5217\u7684 AddAfter \u65b9\u6cd5\u63d2\u5165\u5e76\u8bbe\u7f6e\u5ef6\u8fdf\u65f6\u95f4\u4e3a 1ms\uff08\u5373 baseDelay\uff09\uff0c\u7b2c 2 \u4e2a\u76f8\u540c\u5143\u7d20\u7684\u5ef6\u8fdf\u65f6\u95f4\u4e3a 2ms\uff0c\u7b2c 3 \u4e2a\u76f8\u540c\u5143\u7d20\u7684\u5ef6\u8fdf\u65f6\u95f4\u4e3a 4ms\uff0c\u7b2c 4 \u4e2a\u76f8\u540c\u5143\u7d20\u7684\u5ef6\u8fdf\u65f6\u95f4\u4e3a 8ms\uff0c\u7b2c 5 \u4e2a\u76f8\u540c\u5143\u7d20\u7684\u5ef6\u8fdf\u65f6\u95f4\u4e3a 16ms\u2026\u2026\u7b2c 10 \u4e2a\u76f8\u540c\u5143\u7d20\u7684\u5ef6\u8fdf\u65f6\u95f4\u4e3a 512ms\uff0c\u6700\u957f\u5ef6\u8fdf\u65f6\u95f4\u4e0d\u8d85\u8fc7 1000s\uff08\u5373 maxDelay\uff09\u3002</p> <ul> <li>ItemFastSlowRateLimiter</li> </ul> <p>\u8ba1\u6570\u5668\u7b97\u6cd5\u662f\u9650\u901f\u7b97\u6cd5\u4e2d\u6700\u7b80\u5355\u7684\u4e00\u79cd\uff0c\u5176\u539f\u7406\u662f\uff1a\u9650\u5236\u4e00\u6bb5\u65f6\u95f4\u5185\u5141\u8bb8\u901a\u8fc7\u7684\u5143\u7d20\u6570\u91cf\uff0c\u4f8b\u5982\u5728 1 \u5206\u949f\u5185\u53ea\u5141\u8bb8\u901a\u8fc7 100 \u4e2a\u5143\u7d20\uff0c\u6bcf\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u8ba1\u6570\u5668\u81ea\u589e 1\uff0c\u5f53\u8ba1\u6570\u5668\u6570\u5230 100 \u7684\u9608\u503c\u4e14\u8fd8\u5728\u9650\u901f\u5468\u671f\u5185\u65f6\uff0c\u5219\u4e0d\u5141\u8bb8\u5143\u7d20\u518d\u901a\u8fc7\u3002\u4f46 WorkQueue \u5728\u6b64\u57fa\u7840\u4e0a\u6269\u5c55\u4e86 fast \u548c slow \u901f\u7387\u3002</p> <p>\u8ba1\u6570\u5668\u7b97\u6cd5\u63d0\u4f9b\u4e86 4 \u4e2a\u4e3b\u8981\u5b57\u6bb5\uff1afailures\u3001fastDelay\u3001slowDelay \u53ca maxFastAttempts\u3002\u5176\u4e2d\uff0cfailures \u5b57\u6bb5\u7528\u4e8e\u7edf\u8ba1\u5143\u7d20\u6392\u961f\u6570\uff0c\u6bcf\u5f53 AddRateLimited \u65b9\u6cd5\u63d2\u5165\u65b0\u5143\u7d20\u65f6\uff0c\u4f1a\u4e3a\u8be5\u5b57\u6bb5\u52a0 1\uff1b\u800c fastDelay \u548c slowDelay \u5b57\u6bb5\u662f\u7528\u4e8e\u5b9a\u4e49 fast\u3001slow \u901f\u7387\u7684\uff1b\u53e6\u5916\uff0cmaxFastAttempts \u5b57\u6bb5\u7528\u4e8e\u63a7\u5236\u4ece fast \u901f\u7387\u8f6c\u6362\u5230 slow \u901f\u7387\u3002\u8ba1\u6570\u5668\u7b97\u6cd5\u6838\u5fc3\u5b9e\u73b0\u7684\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>type ItemFastSlowRateLimiter struct {\n    failuresLock sync.Mutex\n    failures     map[interface{}]int\n\n    maxFastAttempts int\n    fastDelay       time.Duration\n    slowDelay       time.Duration\n}\n\nfunc (r *ItemFastSlowRateLimiter) When(item interface{}) time.Duration {\n    r.failuresLock.Lock()\n    defer r.failuresLock.Unlock()\n\n    r.failures[item] = r.failures[item] + 1\n\n    if r.failures[item] &lt;= r.maxFastAttempts {\n        return r.fastDelay\n    }\n\n    return r.slowDelay\n}\n\nfunc (r *ItemFastSlowRateLimiter) NumRequeues(item interface{}) int {\n    r.failuresLock.Lock()\n    defer r.failuresLock.Unlock()\n\n    return r.failures[item]\n}\n\nfunc (r *ItemFastSlowRateLimiter) Forget(item interface{}) {\n    r.failuresLock.Lock()\n    defer r.failuresLock.Unlock()\n\n    delete(r.failures, item)\n}\n</code></pre> <p>\u5047\u8bbe fastDelay \u662f 5 * time.Millisecond\uff0cslowDelay \u662f 10 * time.Second\uff0cmaxFastAttempts \u662f 3\u3002\u5728\u4e00\u4e2a\u9650\u901f\u5468\u671f\u5185\u901a\u8fc7 AddRateLimited \u65b9\u6cd5\u63d2\u5165 4 \u4e2a\u76f8\u540c\u7684\u5143\u7d20\uff0c\u90a3\u4e48\u524d 3 \u4e2a\u5143\u7d20\u4f7f\u7528 fastDelay \u5b9a\u4e49\u7684 fast \u901f\u7387\uff0c\u5f53\u89e6\u53d1 maxFastAttempts \u5b57\u6bb5\u65f6\uff0c\u7b2c 4 \u4e2a\u5143\u7d20\u4f7f\u7528 slowDelay \u5b9a\u4e49\u7684 slow \u901f\u7387\u3002</p> <ul> <li>MaxOfRateLimiter</li> </ul> <pre><code>type MaxOfRateLimiter struct {\n    limiters []RateLimiter\n}\nfunc (r *MaxOfRateLimiter) When(item interface{}) time.Duration {\n    ret := time.Duration(0)\n    for _, limiter := range r.limiters {\n        curr := limiter.When(item)\n        if curr &gt; ret {\n            ret = curr\n        }\n    }\n\n    return ret\n}\n\nfunc (r *MaxOfRateLimiter) NumRequeues(item interface{}) int {\n    ret := 0\n    for _, limiter := range r.limiters {\n        curr := limiter.NumRequeues(item)\n        if curr &gt; ret {\n            ret = curr\n        }\n    }\n\n    return ret\n}\n\nfunc (r *MaxOfRateLimiter) Forget(item interface{}) {\n    for _, limiter := range r.limiters {\n        limiter.Forget(item)\n    }\n}\n</code></pre> <p>\u6df7\u5408\u6a21\u5f0f\u662f\u5c06\u591a\u79cd\u9650\u901f\u7b97\u6cd5\u6df7\u5408\u4f7f\u7528\uff0c\u5373\u591a\u79cd\u9650\u901f\u7b97\u6cd5\u540c\u65f6\u751f\u6548\u3002\u4f8b\u5982\uff0c\u540c\u65f6\u4f7f\u7528\u6392\u961f\u6307\u6570\u7b97\u6cd5\u548c\u4ee4\u724c\u6876\u7b97\u6cd5\uff0c\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>func DefaultControllerRateLimiter() RateLimiter {\n    return NewMaxOfRateLimiter(\n        NewItemExponentialFailureRateLimiter(5*time.Millisecond, 1000*time.Second),\n        // 10 qps, 100 bucket size.  This is only for retry speed and its only the overall factor (not per item)\n        &amp;BucketRateLimiter{Limiter: rate.NewLimiter(rate.Limit(10), 100)},\n    )\n}\n</code></pre>"},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_3","title":"\u56db \u5c0f\u8bd5\u725b\u5200","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#41","title":"4.1 \u901a\u7528\u961f\u5217","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#42","title":"4.2 \u5ef6\u8fdf\u961f\u5217","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#43","title":"4.3 \u9650\u901f\u961f\u5217","text":""},{"location":"cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://mp.weixin.qq.com/s/-qiB1KilhwtcjI61m_x3jA</li> <li>https://xie.infoq.cn/article/63258ead84821bc3e276de1f7</li> <li>https://www.jianshu.com/p/d42da5d5f586</li> </ul>"},{"location":"cloud-native/develop/12-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Controller/","title":"12.\u81ea\u5b9a\u4e49\u5b9e\u73b0Controller","text":""},{"location":"cloud-native/develop/12-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Controller/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u901a\u8fc7\u4e4b\u524d\u7684\u6587\u7ae0\uff0c\u5230\u76ee\u524d\u53ef\u4ee5\u5bf9client-go\u4e2d\u7684Informer\u673a\u5236\u6709\u4e86\u5168\u5c40\u7684\u8ba4\u8bc6\uff0c\u5e76\u9488\u5bf9\u5176\u4e2d\u6bcf\u4e00\u4e2a\u7ec4\u4ef6\u529f\u80fd\u4e5f\u6709\u4e86\u6df1\u5165\u7684\u7406\u89e3\uff0c\u672c\u6587\u5c06\u4ece\u4e00\u4e2a\u5b9e\u9645\u4f8b\u5b50\uff0c\u5b8c\u6574\u5b9e\u73b0\u4e00\u4e2a\u81ea\u5b9a\u4e49\u63a7\u5236\u5668\uff0c\u52a0\u6df1\u5bf9controller\u7684\u8ba4\u8bc6\u3002</p>"},{"location":"cloud-native/develop/12-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Controller/#informer","title":"\u4e8c \u56de\u987eInformer\u6d41\u7a0b","text":"<ul> <li>\u9996\u5148\u5728\u63a7\u5236\u5668\u542f\u52a8\u65f6\uff0c\u901a\u8fc7\u8fd0\u884cInformer\u7684run\u51fd\u6570\uff0c\u6267\u884cReflector\u4e2d\u7684run\uff0c\u5168\u91cf\u7684list kubernetes\u4e2d\u7684\u8d44\u6e90\u5bf9\u8c61\u5230deltaFIFO\u4e2d\u3002</li> <li>Reflector \u901a\u8fc7 ListAndWatch \u9996\u5148\u83b7\u53d6\u5168\u91cf\u7684\u8d44\u6e90\u5bf9\u8c61\u6570\u636e\uff0c\u7136\u540e\u901a\u8fc7 syncWith \u51fd\u6570\u5168\u91cf\u66ff\u6362(Replace) \u5230 DeltaFIFO queue/items \u4e2d\uff0c\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u5b9a\u65f6\u540c\u6b65\uff0c\u5219\u5b9a\u65f6\u66f4\u65b0Indexer\u4e2d\u7684\u5185\u5bb9\uff0c\u4e4b\u540e\u901a\u8fc7\u6301\u7eed\u76d1\u542c Watch(\u76ee\u6807\u8d44\u6e90\u7c7b\u578b) \u589e\u91cf\u4e8b\u4ef6\uff0c\u5e76\u53bb\u91cd\u66f4\u65b0\u5230 DeltaFIFO queue/items \u4e2d\uff0c\u7b49\u5f85\u88ab\u6d88\u8d39\u3002</li> <li>sharedIndexInformer\u7684HandleDeltas\u5904\u7406\u4ecedeltaFIFO pod\u51fa\u6765\u7684\u589e\u91cf\u65f6\uff0c\u5148\u5c1d\u8bd5\u66f4\u65b0\u5230\u672c\u5730\u7f13\u5b58cache\uff0c\u66f4\u65b0\u6210\u529f\u7684\u8bdd\u4f1a\u8c03\u7528processor.distribute\u65b9\u6cd5\u5411processor\u4e2d\u7684listener\u6dfb\u52a0notification\uff0clistener\u542f\u52a8\u4e4b\u540e\u4f1a\u4e0d\u65ad\u83b7\u53d6notification\u56de\u8c03\u7528\u6237\u7684EventHandler\u65b9\u6cd5\u3002</li> <li>\u5f53\u7528\u6237\u6ce8\u518c\u7684EventHandler\u6536\u5230\u4e8b\u4ef6\u540e\uff0c\u5c06\u5176\u6dfb\u52a0\u8fdbworkqueue\u4e2d\u3002</li> <li>\u4e4b\u540e\u8fd0\u884c\u7528\u6237\u81ea\u5b9a\u4e49\u7684processNextItem\uff0c\u4e0d\u65ad\u4eceworkqueue\u4e2d\u83b7\u53d6\u5bf9\u8c61\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u4e1a\u52a1\u903b\u8f91\u5904\u7406\uff0c\u5982\u679c\u5904\u7406\u53d1\u751f\u5f02\u5e38\uff0c\u5219\u91cd\u65b0\u5165\u961f\u5217\uff0c\u5982\u679c\u5904\u7406\u6210\u529f\uff0c\u5219forget\u8c03\u6539\u5bf9\u8c61\u3002</li> </ul>"},{"location":"cloud-native/develop/12-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Controller/#_2","title":"\u4e09 \u63a7\u5236\u5668\u903b\u8f91","text":"<p>K8s\u63a7\u5236\u5668\u662f\u4e00\u4e3b\u52a8\u7684\u8c03\u534f\u8fc7\u7a0b\uff0cwatch\u4e00\u4e9b\u8d44\u6e90\u5bf9\u8c61\u671f\u671b\u72b6\u6001\uff0c\u4e5f\u4f1awatch\u5b9e\u9645\u72b6\u6001\uff0c\u4e4b\u540e\u901a\u8fc7\u63a7\u5236\u5668\u53d1\u9001\u6267\u884c\u52a8\u4f5c\u6307\u4ee4\uff0c\u8ba9\u5bf9\u8c61\u7684\u5f53\u524d\u72b6\u6001\u5f80\u671f\u671b\u72b6\u6001\u903c\u8fd1\u3002</p> <pre><code>for {\n  desired := getDesiredState()\n  current := getCurrentState()\n  makeChanges(desired, current)\n}\n</code></pre> <p>\u66f4\u591a\u7684\u89c4\u5219\uff0c\u53ef\u4ee5\u53bb\u770bk8s\u5174\u8da3\u5c0f\u7ec4\u7684\u63a7\u5236\u5668\u6307\u5357\uff1ahttps://github.com/kubernetes/community/blob/master/contributors/devel/sig-api-machinery/controllers.md</p>"},{"location":"cloud-native/develop/12-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Controller/#_3","title":"\u56db \u7f16\u7a0b\u5b9e\u73b0","text":"<ul> <li>\u7f16\u7801</li> </ul> <pre><code>// kubernetes/staging/src/k8s.io/client-go/examples/workqueue\n\n// \u5b9a\u4e49\u63a7\u5236\u5668\u7ed3\u6784\u4f53\uff0c\u5305\u542bindexer/queue/informer\ntype Controller struct {\n    indexer  cache.Indexer\n  // \u4f7f\u7528\u9650\u901f\u961f\u5217\n    queue    workqueue.RateLimitingInterface\n    informer cache.Controller\n}\n\n// \u63a7\u5236\u5668\u6784\u9020\u65b9\u6cd5\nfunc NewController(queue workqueue.RateLimitingInterface, indexer cache.Indexer, informer cache.Controller) *Controller {\n    return &amp;Controller{\n        informer: informer,\n        indexer:  indexer,\n        queue:    queue,\n    }\n}\n\n// \u4ece\u9650\u901f\u961f\u5217\u4e2d\u83b7\u53d6\u4e00\u4e2a\u6267\u884csyncToStdout\u4e1a\u52a1\u8def\u5f84\u8fdb\u884c\u5904\u7406\nfunc (c *Controller) processNextItem() bool {\n    // \u4ece\u961f\u5217\u4e2d\u83b7\u53d6\u4e00\u4e2a\u5143\u7d20\u8fdb\u884c\u5904\u7406\n    key, quit := c.queue.Get()\n    if quit {\n        return false\n    }\n  // \u544a\u8bc9\u961f\u5217\u6211\u4eec\u5904\u7406\u5b8c\u8fd9\u4e2a\u952e\u3002\u8fd9\u4e3a\u5176\u4ed6worker\u89e3\u9501\u8be5key\n  // \u8fd9\u5141\u8bb8\u5b89\u5168\u7684\u5e76\u884c\u5904\u7406\uff0c\u56e0\u4e3a\u5177\u6709\u76f8\u540ckey\u7684\u4e24\u4e2a pod \u6c38\u8fdc\u4e0d\u4f1a\u5e76\u884c\u5904\u7406\u3002\n    defer c.queue.Done(key)\n\n    // \u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\u65b9\u6cd5\u5904\u7406key\n    err := c.syncToStdout(key.(string))\n    // \u9519\u8bef\u5904\u7406\n    c.handleErr(err, key)\n    return true\n}\n\n// syncToStdout \u662f\u63a7\u5236\u5668\u7684\u4e1a\u52a1\u903b\u8f91\u3002\u5728\u8fd9\u4e2a\u63a7\u5236\u5668\u4e2d\uff0c\u5b83\u53ea\u662f\u5c06\u6709\u5173 pod \u7684\u4fe1\u606f\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa\u3002\u5982\u679c\u53d1\u751f\u9519\u8bef\uff0c\u5b83\u5fc5\u987b\u7b80\u5355\u5730\u8fd4\u56de\u9519\u8bef\u3002\u91cd\u8bd5\u903b\u8f91\u4e0d\u5e94\u8be5\u662f\u4e1a\u52a1\u903b\u8f91\u7684\u4e00\u90e8\u5206\u3002\nfunc (c *Controller) syncToStdout(key string) error {\n  // \u4ece\u521aindexer\u4e2d\u83b7\u53d6key\n    obj, exists, err := c.indexer.GetByKey(key)\n    if err != nil {\n        klog.Errorf(\"Fetching object with key %s from store failed with %v\", key, err)\n        return err\n    }\n\n    if !exists {\n        fmt.Printf(\"Pod %s does not exist anymore\\n\", key)\n    } else {\n        // \u5927\u5bb6pod\u540d\u79f0\u5230\u63a7\u5236\u53f0\n        fmt.Printf(\"Sync/Add/Update for Pod %s\\n\", obj.(*v1.Pod).GetName())\n    }\n    return nil\n}\n\n// \u68c0\u67e5\u662f\u5426\u53d1\u751f\u9519\u8bef\u5e76\u786e\u4fdd\u91cd\u8bd5\nfunc (c *Controller) handleErr(err error, key interface{}) {\n    if err == nil {\n\n    // \u5904\u7406\u6210\u529f\u5219Forget\u8be5key\n        c.queue.Forget(key)\n        return\n    }\n\n    // \u5982\u679c\u51fa\u73b0\u95ee\u9898\uff0c\u6b64\u63a7\u5236\u5668\u4f1a\u91cd\u8bd5 5 \u6b21\u3002\u4e4b\u540e\uff0c\u5b83\u505c\u6b62\u5c1d\u8bd5\u3002\n    if c.queue.NumRequeues(key) &lt; 5 {\n        klog.Infof(\"Error syncing pod %v: %v\", key, err)\n\n        // \u5c06key \u4ece\u65b0\u5165\u961f\u5217\n        c.queue.AddRateLimited(key)\n        return\n    }\n  // \u5982\u679c\u8fd8\u662f\u5f02\u5e38\uff0c\u5219forget\u8be5key\n    c.queue.Forget(key)\n    // \u5411\u5916\u90e8\u5b9e\u4f53\u62a5\u544a\uff0c\u5373\u4f7f\u7ecf\u8fc7\u591a\u6b21\u91cd\u8bd5\uff0c\u6211\u4eec\u4e5f\u65e0\u6cd5\u6210\u529f\u5904\u7406\u6b64\u5bc6\u94a5\uff0c\u4e22\u5f03\u4e86\u8be5key\n    runtime.HandleError(err)\n    klog.Infof(\"Dropping pod %q out of the queue: %v\", key, err)\n}\n\n// controller\u7684run\u51fd\u6570\nfunc (c *Controller) Run(threadiness int, stopCh chan struct{}) {\n    defer runtime.HandleCrash()\n\n    // \u5982\u679c\u53d1\u751f\u5f02\u5e38\u505c\u6b62\u961f\u5217\n    defer c.queue.ShutDown()\n    klog.Info(\"Starting Pod controller\")\n  // \u5728goroutine\u4e2d\u8fd0\u884cinformer.Run()\n    go c.informer.Run(stopCh)\n\n    // \u7b49\u5f85\u6240\u6709\u6ce8\u518c\u7684informer\u90fd\u542f\u52a8\u5b8c\u6210\uff0c\u5f00\u59cb\u8fd0\u884c\u961f\u5217\n    if !cache.WaitForCacheSync(stopCh, c.informer.HasSynced) {\n        runtime.HandleError(fmt.Errorf(\"Timed out waiting for caches to sync\"))\n        return\n    }\n  // \u542f\u52a8\u591a\u4e2a\u643a\u7a0b\u8fd0\u884crunWorker\n    for i := 0; i &lt; threadiness; i++ {\n        go wait.Until(c.runWorker, time.Second, stopCh)\n    }\n\n    &lt;-stopCh\n    klog.Info(\"Stopping Pod controller\")\n}\n\n// \u4e0d\u65ad\u7684\u8fd0\u884cprocessNextItem\nfunc (c *Controller) runWorker() {\n    for c.processNextItem() {\n    }\n}\n\nfunc main() {\n    var kubeconfig string\n    var master string\n\n    flag.StringVar(&amp;kubeconfig, \"kubeconfig\", \"\", \"absolute path to the kubeconfig file\")\n    flag.StringVar(&amp;master, \"master\", \"\", \"master url\")\n    flag.Parse()\n\n    // creates the connection\n    config, err := clientcmd.BuildConfigFromFlags(master, kubeconfig)\n    if err != nil {\n        klog.Fatal(err)\n    }\n\n    // \u83b7\u53d6clientSet\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        klog.Fatal(err)\n    }\n\n    // \u521b\u5efapodListWatcher\n    podListWatcher := cache.NewListWatchFromClient(clientset.CoreV1().RESTClient(), \"pods\", v1.NamespaceDefault, fields.Everything())\n\n    // \u521b\u5efa\u9650\u901f\u961f\u5217\n    queue := workqueue.NewRateLimitingQueue(workqueue.DefaultControllerRateLimiter())\n\n  // \u521b\u5efaIndexerInformer\uff0c\u83b7\u53d6indexer\u548cinformer\n    indexer, informer := cache.NewIndexerInformer(podListWatcher, &amp;v1.Pod{}, 0, cache.ResourceEventHandlerFuncs{\n        AddFunc: func(obj interface{}) {\n            key, err := cache.MetaNamespaceKeyFunc(obj)\n            if err == nil {\n                queue.Add(key)\n            }\n        },\n        UpdateFunc: func(old interface{}, new interface{}) {\n            key, err := cache.MetaNamespaceKeyFunc(new)\n            if err == nil {\n                queue.Add(key)\n            }\n        },\n        DeleteFunc: func(obj interface{}) {\n            // IndexerInformer uses a delta queue, therefore for deletes we have to use this\n            // key function.\n            key, err := cache.DeletionHandlingMetaNamespaceKeyFunc(obj)\n            if err == nil {\n                queue.Add(key)\n            }\n        },\n    }, cache.Indexers{})\n  // \u6784\u9020controller\n    controller := NewController(queue, indexer, informer)\n\n    // \u6dfb\u52a0\u54e5\u6d4b\u8bd5pod\n    indexer.Add(&amp;v1.Pod{\n        ObjectMeta: meta_v1.ObjectMeta{\n            Name:      \"mypod\",\n            Namespace: v1.NamespaceDefault,\n        },\n    })\n\n    // \u542f\u52a8controller\n    stop := make(chan struct{})\n    defer close(stop)\n    go controller.Run(1, stop)\n\n    // Wait forever\n    select {}\n}\n</code></pre> <ul> <li>\u8fd0\u884c\u6d4b\u8bd5</li> </ul> <pre><code>add/update/delete pod:smartkm-api-k8s-exampledeploy-7cddf8cbf4-hn7f9\nadd/update/delete pod:etcd-1\nadd/update/delete pod:etcd-2\nadd/update/delete pod:etcd-0\nadd/update/delete pod:podname1\nadd/update/delete pod:smartkm-api-k8s-exampledeploy-7cddf8cbf4-ztv2k\nadd/update/delete pod:po\nadd/update/delete pod:po\nPod default/po does not exist anymore\n</code></pre> <p>\u5f53\u6211\u4eec\u521b\u5efa\u4e00\u4e2apod\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u5728\u63a7\u5236\u53f0\u5df2\u7ecf\u6253\u5370\u51fa\u6211\u4eec\u7684pod\u540d\u79f0\uff0c\u5220\u9664pod\u540e\u6253\u5370\u51fa\u4e0d\u5b58\u5728\u6539\u5bf9\u8c61\u3002</p>"},{"location":"cloud-native/develop/12-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Controller/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://mp.weixin.qq.com/s/-qiB1KilhwtcjI61m_x3jA</li> </ul>"},{"location":"cloud-native/develop/13-%E8%AE%A4%E8%AF%86CRD/","title":"13.\u8ba4\u8bc6CRD","text":""},{"location":"cloud-native/develop/13-%E8%AE%A4%E8%AF%86CRD/#_1","title":"\u53c2\u8003\u8d44\u6599","text":""},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/","title":"K8s Operator \u5f00\u53d1\u4e4b kubebuilder \u5b9e\u6218","text":""},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5bf9\u4e8e\u4e1a\u52a1\u5e94\u7528\uff0c\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u5148k8s\u5185\u7f6e\u8d44\u6e90\u8fdb\u884c\u4e00\u7cfb\u5217\u8fd0\u7ef4\u64cd\u4f5c\uff0c\u56e0\u6b64\u7f16\u5199\u4e1a\u52a1\u7684operator\u5fc5\u4e0d\u53ef\u5c11\uff0c\u5728\u6b64\u4e86\u89e3\u5230kubebuilder \u662f\u793e\u533a\u8ba4\u53ef\u5ea6\u5f88\u9ad8\u7684\u4e00\u79cd\u5b98\u65b9\u3001\u6807\u51c6\u5316 Operator \u6846\u67b6\uff0c\u53ef\u4ee5\u5229\u7528\u5176\u975e\u5e38\u65b9\u4fbf\u7684\u7f16\u5199\u4e1a\u52a1operator\uff0c\u4ee5\u6b64\u6765\u6269\u5c55 Kubernetes API</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#11-kubebuilder","title":"1.1 kubebuilder\u662f\u4ec0\u4e48","text":"<p>Kubebuilder \u662f\u4e00\u4e2a\u4f7f\u7528 CRDs \u6784\u5efa K8s API \u7684 SDK\uff0c\u4e3b\u8981\u662f\uff1a</p> <ul> <li>\u63d0\u4f9b\u811a\u624b\u67b6\u5de5\u5177\u521d\u59cb\u5316 CRDs \u5de5\u7a0b\uff0c\u81ea\u52a8\u751f\u6210 boilerplate \u4ee3\u7801\u548c\u914d\u7f6e\uff1b</li> <li>\u63d0\u4f9b\u4ee3\u7801\u5e93\u5c01\u88c5\u5e95\u5c42\u7684 K8s go-client\uff1b</li> </ul> <p>\u65b9\u4fbf\u7528\u6237\u4ece\u96f6\u5f00\u59cb\u5f00\u53d1 CRDs\uff0cControllers \u548c Admission Webhooks \u6765\u6269\u5c55 K8s\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#12","title":"1.2 \u529f\u80fd","text":"<p>\u81ea\u5b9a\u4e49\u8d44\u6e90 CRD\uff08Custom Resource Definition\uff09\u53ef\u4ee5\u6269\u5c55 Kubernetes API\uff0c\u638c\u63e1 CRD \u662f\u6210\u4e3a Kubernetes \u9ad8\u7ea7\u73a9\u5bb6\u7684\u5fc5\u5907\u6280\u80fd\uff0c\u672c\u6587\u5c06\u4ecb\u7ecd CRD \u548c Controller \u7684\u6982\u5ff5\uff0c\u5e76\u5bf9 CRD \u7f16\u5199\u6846\u67b6 Kubebuilder \u8fdb\u884c\u6df1\u5165\u5206\u6790\uff0c\u8ba9\u60a8\u771f\u6b63\u7406\u89e3\u5e76\u80fd\u5feb\u901f\u5f00\u53d1 CRD\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#13","title":"1.3 \u57fa\u672c\u6982\u5ff5","text":"<ul> <li>CRD (Custom Resource Definition): \u5141\u8bb8\u7528\u6237\u81ea\u5b9a\u4e49 Kubernetes \u8d44\u6e90\uff0c\u662f\u4e00\u4e2a\u7c7b\u578b\uff1b</li> <li>CR (Custom Resourse): CRD \u7684\u4e00\u4e2a\u5177\u4f53\u5b9e\u4f8b\uff1b</li> <li>webhook: \u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u79cd HTTP \u56de\u8c03\uff0c\u4f1a\u6ce8\u518c\u5230 apiserver \u4e0a\u3002\u5728 apiserver \u7279\u5b9a\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u4f1a\u67e5\u8be2\u5df2\u6ce8\u518c\u7684 webhook\uff0c\u5e76\u628a\u76f8\u5e94\u7684\u6d88\u606f\u8f6c\u53d1\u8fc7\u53bb\u3002</li> </ul> <p>\u6309\u7167\u5904\u7406\u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u4e00\u822c\u53ef\u4ee5\u5c06\u5176\u5206\u4e3a\u4e24\u7c7b\uff1a\u4e00\u7c7b\u53ef\u80fd\u4f1a\u4fee\u6539\u4f20\u5165\u5bf9\u8c61\uff0c\u79f0\u4e3a mutating webhook\uff1b\u4e00\u7c7b\u5219\u4f1a\u53ea\u8bfb\u4f20\u5165\u5bf9\u8c61\uff0c\u79f0\u4e3a validating webhook\u3002</p> <ul> <li>\u5de5\u4f5c\u961f\u5217: controller \u7684\u6838\u5fc3\u7ec4\u4ef6\u3002\u5b83\u4f1a\u76d1\u63a7\u96c6\u7fa4\u5185\u7684\u8d44\u6e90\u53d8\u5316\uff0c\u5e76\u628a\u76f8\u5173\u7684\u5bf9\u8c61\uff0c\u5305\u62ec\u5b83\u7684\u52a8\u4f5c\u4e0e key\uff0c\u4f8b\u5982 Pod \u7684\u4e00\u4e2a Create \u52a8\u4f5c\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u4e8b\u4ef6\u5b58\u50a8\u4e8e\u8be5\u961f\u5217\u4e2d\uff1b</li> <li>controller :\u5b83\u4f1a\u5faa\u73af\u5730\u5904\u7406\u4e0a\u8ff0\u5de5\u4f5c\u961f\u5217\uff0c\u6309\u7167\u5404\u81ea\u7684\u903b\u8f91\u628a\u96c6\u7fa4\u72b6\u6001\u5411\u9884\u671f\u72b6\u6001\u63a8\u52a8\u3002\u4e0d\u540c\u7684 controller \u5904\u7406\u7684\u7c7b\u578b\u4e0d\u540c\uff0c\u6bd4\u5982 replicaset controller \u5173\u6ce8\u7684\u662f\u526f\u672c\u6570\uff0c\u4f1a\u5904\u7406\u4e00\u4e9b Pod \u76f8\u5173\u7684\u4e8b\u4ef6\uff1b</li> <li>operator:operator \u662f\u63cf\u8ff0\u3001\u90e8\u7f72\u548c\u7ba1\u7406 kubernetes \u5e94\u7528\u7684\u4e00\u5957\u673a\u5236\uff0c\u4ece\u5b9e\u73b0\u4e0a\u6765\u8bf4\uff0c\u53ef\u4ee5\u5c06\u5176\u7406\u89e3\u4e3a CRD \u914d\u5408\u53ef\u9009\u7684 webhook \u4e0e controller \u6765\u5b9e\u73b0\u7528\u6237\u4e1a\u52a1\u903b\u8f91\uff0c\u5373 operator = CRD + webhook + controller\u3002</li> </ul>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#_2","title":"\u4e8c \u67b6\u6784\u5373\u57fa\u672c\u6982\u5ff5","text":""},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#21","title":"2.1 \u67b6\u6784\u56fe","text":""},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#22","title":"2.2 \u57fa\u7840\u6982\u5ff5","text":""},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#221-gvksgvrs","title":"2.2.1 GVKs&amp;GVRs","text":"<p>GVK = GroupVersionKind\uff0cGVR = GroupVersionResource\u3002</p> <ul> <li> <p>API Group &amp; Versions\uff08GV\uff09 API Group \u662f\u76f8\u5173 API \u529f\u80fd\u7684\u96c6\u5408\uff0c\u6bcf\u4e2a Group \u62e5\u6709\u4e00\u6216\u591a\u4e2a Versions\uff0c\u7528\u4e8e\u63a5\u53e3\u7684\u6f14\u8fdb\u3002</p> </li> <li> <p>Kinds &amp; Resources\uff08GVR\uff09 \u6bcf\u4e2a GV \u90fd\u5305\u542b\u591a\u4e2a API \u7c7b\u578b\uff0c\u79f0\u4e3a Kinds\uff0c\u5728\u4e0d\u540c\u7684 Versions \u4e4b\u95f4\u540c\u4e00\u4e2a Kind \u5b9a\u4e49\u53ef\u80fd\u4e0d\u540c\uff0c Resource \u662f Kind \u7684\u5bf9\u8c61\u6807\u8bc6\uff08resource type\uff09\uff0c\u4e00\u822c\u6765\u8bf4 Kinds \u548c Resources \u662f 1:1 \u7684\uff0c\u6bd4\u5982 pods Resource \u5bf9\u5e94 Pod Kind\uff0c\u4f46\u662f\u6709\u65f6\u5019\u76f8\u540c\u7684 Kind \u53ef\u80fd\u5bf9\u5e94\u591a\u4e2a Resources\uff0c\u6bd4\u5982 Scale Kind \u53ef\u80fd\u5bf9\u5e94\u5f88\u591a Resources\uff1adeployments/scale\uff0creplicasets/scale\uff0c\u5bf9\u4e8e CRD \u6765\u8bf4\uff0c\u53ea\u4f1a\u662f 1:1 \u7684\u5173\u7cfb\u3002</p> </li> </ul> <p>\u6bcf\u4e00\u4e2a GVK \u90fd\u5173\u8054\u7740\u4e00\u4e2a package \u4e2d\u7ed9\u5b9a\u7684 root Go type\uff0c\u6bd4\u5982 apps/v1/Deployment \u5c31\u5173\u8054\u7740 K8s \u6e90\u7801\u91cc\u9762 k8s.io/api/apps/v1 package \u4e2d\u7684 Deployment struct\uff0c\u6211\u4eec\u63d0\u4ea4\u7684\u5404\u7c7b\u8d44\u6e90\u5b9a\u4e49 YAML \u6587\u4ef6\u90fd\u9700\u8981\u5199\uff1a</p> <p>apiVersion\uff1a\u8fd9\u4e2a\u5c31\u662f GV \u3002 kind\uff1a\u8fd9\u4e2a\u5c31\u662f K\u3002</p> <p>\u6839\u636e GVK K8s \u5c31\u80fd\u627e\u5230\u4f60\u5230\u5e95\u8981\u521b\u5efa\u4ec0\u4e48\u7c7b\u578b\u7684\u8d44\u6e90\uff0c\u6839\u636e\u4f60\u5b9a\u4e49\u7684 Spec \u521b\u5efa\u597d\u8d44\u6e90\u4e4b\u540e\u5c31\u6210\u4e3a\u4e86 Resource\uff0c\u4e5f\u5c31\u662f GVR\u3002GVK/GVR \u5c31\u662f K8s \u8d44\u6e90\u7684\u5750\u6807\uff0c\u662f\u6211\u4eec\u521b\u5efa/\u5220\u9664/\u4fee\u6539/\u8bfb\u53d6\u8d44\u6e90\u7684\u57fa\u7840\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#223-scheme","title":"2.2.3 Scheme","text":"<p>\u6bcf\u4e00\u7ec4 Controllers \u90fd\u9700\u8981\u4e00\u4e2a Scheme\uff0c\u63d0\u4f9b\u4e86 Kinds \u4e0e\u5bf9\u5e94 Go types \u7684\u6620\u5c04\uff0c\u4e5f\u5c31\u662f\u8bf4\u7ed9\u5b9a Go type \u5c31\u77e5\u9053\u4ed6\u7684 GVK\uff0c\u7ed9\u5b9a GVK \u5c31\u77e5\u9053\u4ed6\u7684 Go type\uff0c\u6bd4\u5982\u8bf4\u6211\u4eec\u7ed9\u5b9a\u4e00\u4e2a Scheme: \"tutotial.kubebuilder.io/api/v1\".CronJob{} \u8fd9\u4e2a Go type \u6620\u5c04\u5230 batch.tutotial.kubebuilder.io/v1 \u7684 CronJob GVK\uff0c\u90a3\u4e48\u4ece Api Server \u83b7\u53d6\u5230\u4e0b\u9762\u7684 JSON: <pre><code>{\n    \"kind\": \"CronJob\",\n    \"apiVersion\": \"batch.tutorial.kubebuilder.io/v1\",\n    ...\n}\n</code></pre> \u5c31\u80fd\u6784\u9020\u51fa\u5bf9\u5e94\u7684 Go type\u4e86\uff0c\u901a\u8fc7\u8fd9\u4e2a Go type \u4e5f\u80fd\u6b63\u786e\u5730\u83b7\u53d6 GVR \u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u63a7\u5236\u5668\u53ef\u4ee5\u901a\u8fc7\u8be5 Go type \u83b7\u53d6\u5230\u671f\u671b\u72b6\u6001\u4ee5\u53ca\u5176\u4ed6\u8f85\u52a9\u4fe1\u606f\u8fdb\u884c\u8c03\u8c10\u903b\u8f91\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#224-manager","title":"2.2.4 Manager","text":"<p>Kubebuilder \u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5177\u6709 3 \u4e2a\u804c\u8d23\uff1a</p> <ul> <li>\u8d1f\u8d23\u8fd0\u884c\u6240\u6709\u7684 Controllers\uff1b</li> <li>\u521d\u59cb\u5316\u5171\u4eab caches\uff0c\u5305\u542b listAndWatch \u529f\u80fd\uff1b</li> <li>\u521d\u59cb\u5316 clients \u7528\u4e8e\u4e0e Api Server \u901a\u4fe1\u3002</li> </ul>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#225-cache","title":"2.2.5 Cache","text":"<p>Kubebuilder \u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u5728 Controller \u8fdb\u7a0b\u91cc\u9762\u6839\u636e Scheme \u540c\u6b65 Api Server \u4e2d\u6240\u6709\u8be5 Controller \u5173\u5fc3 GVKs \u7684 GVRs\uff0c\u5176\u6838\u5fc3\u662f GVK -&gt; Informer \u7684\u6620\u5c04\uff0cInformer \u4f1a\u8d1f\u8d23\u76d1\u542c\u5bf9\u5e94 GVK \u7684 GVRs \u7684\u521b\u5efa/\u5220\u9664/\u66f4\u65b0\u64cd\u4f5c\uff0c\u4ee5\u89e6\u53d1 Controller \u7684 Reconcile \u903b\u8f91\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#226-controller","title":"2.2.6 Controller","text":"<p>Kubebuidler \u4e3a\u6211\u4eec\u751f\u6210\u7684\u811a\u624b\u67b6\u6587\u4ef6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5b9e\u73b0 Reconcile \u65b9\u6cd5\u5373\u53ef\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#227-client","title":"2.2.7 Client","text":"<p>\u5728\u5b9e\u73b0 Controller \u7684\u65f6\u5019\u4e0d\u53ef\u907f\u514d\u5730\u9700\u8981\u5bf9\u67d0\u4e9b\u8d44\u6e90\u7c7b\u578b\u8fdb\u884c\u521b\u5efa/\u5220\u9664/\u66f4\u65b0\uff0c\u5c31\u662f\u901a\u8fc7\u8be5 Clients \u5b9e\u73b0\u7684\uff0c\u5176\u4e2d\u67e5\u8be2\u529f\u80fd\u5b9e\u9645\u67e5\u8be2\u662f\u672c\u5730\u7684 Cache\uff0c\u5199\u64cd\u4f5c\u76f4\u63a5\u8bbf\u95ee Api Server\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#228-index","title":"2.2.8 Index","text":"<p>\u7531\u4e8e Controller \u7ecf\u5e38\u8981\u5bf9 Cache \u8fdb\u884c\u67e5\u8be2\uff0cKubebuilder \u63d0\u4f9b Index utility \u7ed9 Cache \u52a0\u7d22\u5f15\u63d0\u5347\u67e5\u8be2\u6548\u7387\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#229-finalizer","title":"2.2.9 Finalizer","text":"<p>\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8d44\u6e90\u88ab\u5220\u9664\u4e4b\u540e\uff0c\u6211\u4eec\u867d\u7136\u80fd\u591f\u88ab\u89e6\u53d1\u5220\u9664\u4e8b\u4ef6\uff0c\u4f46\u662f\u8fd9\u4e2a\u65f6\u5019\u4ece Cache \u91cc\u9762\u65e0\u6cd5\u8bfb\u53d6\u4efb\u4f55\u88ab\u5220\u9664\u5bf9\u8c61\u7684\u4fe1\u606f\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5bfc\u81f4\u5f88\u591a\u5783\u573e\u6e05\u7406\u5de5\u4f5c\u56e0\u4e3a\u4fe1\u606f\u4e0d\u8db3\u65e0\u6cd5\u8fdb\u884c\uff0cK8s \u7684 Finalizer \u5b57\u6bb5\u7528\u4e8e\u5904\u7406\u8fd9\u79cd\u60c5\u51b5\u3002\u5728 K8s \u4e2d\uff0c\u53ea\u8981\u5bf9\u8c61 ObjectMeta \u91cc\u9762\u7684 Finalizers \u4e0d\u4e3a\u7a7a\uff0c\u5bf9\u8be5\u5bf9\u8c61\u7684 delete \u64cd\u4f5c\u5c31\u4f1a\u8f6c\u53d8\u4e3a update \u64cd\u4f5c\uff0c\u5177\u4f53\u8bf4\u5c31\u662f update  deletionTimestamp \u5b57\u6bb5\uff0c\u5176\u610f\u4e49\u5c31\u662f\u544a\u8bc9 K8s \u7684 GC\u201c\u5728deletionTimestamp \u8fd9\u4e2a\u65f6\u523b\u4e4b\u540e\uff0c\u53ea\u8981 Finalizers \u4e3a\u7a7a\uff0c\u5c31\u7acb\u9a6c\u5220\u9664\u6389\u8be5\u5bf9\u8c61\u201d\u3002</p> <p>\u6240\u4ee5\u4e00\u822c\u7684\u4f7f\u7528\u59ff\u52bf\u5c31\u662f\u5728\u521b\u5efa\u5bf9\u8c61\u65f6\u628a Finalizers \u8bbe\u7f6e\u597d\uff08\u4efb\u610f string\uff09\uff0c\u7136\u540e\u5904\u7406 DeletionTimestamp \u4e0d\u4e3a\u7a7a\u7684 update \u64cd\u4f5c\uff08\u5b9e\u9645\u662f delete\uff09\uff0c\u6839\u636e Finalizers \u7684\u503c\u6267\u884c\u5b8c\u6240\u6709\u7684 pre-delete hook\uff08\u6b64\u65f6\u53ef\u4ee5\u5728 Cache \u91cc\u9762\u8bfb\u53d6\u5230\u88ab\u5220\u9664\u5bf9\u8c61\u7684\u4efb\u4f55\u4fe1\u606f\uff09\u4e4b\u540e\u5c06 Finalizers \u7f6e\u4e3a\u7a7a\u5373\u53ef\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#2210-ownerreference","title":"2.2.10 OwnerReference","text":"<p>K8s GC \u5728\u5220\u9664\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u4efb\u4f55 ownerReference \u662f\u8be5\u5bf9\u8c61\u7684\u5bf9\u8c61\u90fd\u4f1a\u88ab\u6e05\u9664\uff0c\u4e0e\u6b64\u540c\u65f6\uff0cKubebuidler \u652f\u6301\u6240\u6709\u5bf9\u8c61\u7684\u53d8\u66f4\u90fd\u4f1a\u89e6\u53d1 Owner \u5bf9\u8c61 controller \u7684 Reconcile \u65b9\u6cd5\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#kubebuilder","title":"\u4e09 \u5b9e\u6218kubebuilder","text":""},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#31","title":"3.1 \u9700\u6c42\u73af\u5883","text":"<ul> <li>go version v1.15+.</li> <li>docker version 17.03+.</li> <li>kubectl version v1.11.3+.</li> <li>kustomize v3.1.0+</li> <li>Kind \u672c\u5730\u5f00\u53d1\u53ef\u5b89\u88c5kind</li> </ul> <p>\u80fd\u591f\u8bbf\u95ee Kubernetes v1.11.3+ \u96c6\u7fa4</p> <ul> <li>\u73af\u5883 \u521b\u5efa:k8s.io\u548csigs.k8s.io\u4e24\u4e2a\u76ee\u5f55<ul> <li>k8s.io\u76f4\u63a5\u62c9\u53bbk8s\u9879\u76ee\u6e90\u7801\uff0c\u5e76\u5c06\u5176\u4e2dkubernetes/staging/src/k8s.io\u62f7\u8d1d\u51fa\u6765\u5373\u53ef</li> <li>sigs.k8s.io \u9700\u8981\u521b\u5efa\u76ee\u5f55\uff0cclone k8s-sigs/controller-runtime\u9879\u76ee</li> </ul> </li> </ul> <pre><code># \u5728gopath\u7684src\u76ee\u5f55\u4e0b\u62c9\u53d6k8s\u6e90\u7801\n$ pwd\n/Users/xuel/workspace/goworkspace/src\n$ ls\ngithub.com        golang.org        google.golang.org gopkg.in\n# \u62f7\u8d1dk8s\u6e90\u7801\u4e2d\u7684k8s.io\u5230\u4e0a\u5c42\u76ee\u5f55\n$ cp -R kubernetes/staging/src/k8s.io k8s.io\n\n# \u5728gopath \u4e2d\u521b\u5efasigs.k8s.io,\u5e76clone controller-runtime\n$ mkdir /Users/xuel/workspace/goworkspace/src/sigs.k8s.io &amp;&amp; cd sigs.k8s.io &amp;&amp; git clone https://github.com/kubernetes-sigs/controller-runtime.git\n\n$ ls\ndrwxr-xr-x  24 xuel  staff   768B Jan  3 18:46 github.com\ndrwxr-xr-x   3 xuel  staff    96B Mar 22  2020 golang.org\ndrwxr-xr-x   3 xuel  staff    96B May 21  2020 google.golang.org\ndrwxr-xr-x   3 xuel  staff    96B May 21  2020 gopkg.in\ndrwxr-xr-x  28 xuel  staff   896B Jan 28 19:53 k8s.io\ndrwxr-xr-x  41 xuel  staff   1.3K Jan 28 19:52 kubernetes\ndrwxr-xr-x   3 xuel  staff    96B Jan 28 19:57 sigs.k8s.io\n</code></pre>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#32","title":"3.2 \u521b\u5efa\u9879\u76ee","text":"<ul> <li>\u521b\u5efa\u76ee\u5f55\uff0c\u521d\u59cb\u5316\u7cfb\u7edf <pre><code>$ kubebuilder init --domain imoc-operator\n</code></pre> \u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a </li> </ul>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#33-api","title":"3.3 \u521b\u5efaAPI","text":"<p>\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 API\uff08\u7ec4/\u7248\u672c\uff09\u4e3a \u201cwebapp/v1\u201d\uff0c\u5e76\u5728\u4e0a\u9762\u521b\u5efa\u65b0\u7684 Kind(CRD) \u201cGuestbook\u201d\u3002 <pre><code>kubebuilder create api --group webapp --version v1 --kind Guestbook\n</code></pre> \u5982\u679c\u4f60\u5728 Create Resource [y/n] \u548c Create Controller [y/n] \u4e2d\u6309y\uff0c\u90a3\u4e48\u8fd9\u5c06\u521b\u5efa\u6587\u4ef6 api/v1/guestbook_types.go \uff0c\u8be5\u6587\u4ef6\u4e2d\u5b9a\u4e49\u76f8\u5173 API \uff0c\u800c\u9488\u5bf9\u4e8e\u8fd9\u4e00\u7c7b\u578b (CRD) \u7684\u5bf9\u8d26\u4e1a\u52a1\u903b\u8f91\u751f\u6210\u5728 controller/guestbook_controller.go \u6587\u4ef6\u4e2d\u3002 </p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#34-controller","title":"3.4 \u7f16\u8bd1\u8fd0\u884ccontroller","text":"<p>kubebuilder\u81ea\u52a8\u751f\u6210\u7684controller\u6e90\u7801\u5730\u5740\u662f\uff1a<code>$GOPATH/src/helloworld/controllers/guestbook_controller.go</code> \uff0c \u5185\u5bb9\u5982\u4e0b\uff1a </p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#35-crd","title":"3.5 \u5b89\u88c5crd\u5230\u96c6\u7fa4","text":"<ul> <li>\u5c06 CRD \u5b89\u88c5\u5230\u96c6\u7fa4\u4e2d <pre><code>make install\n</code></pre> </li> <li>\u8fd0\u884c\u63a7\u5236\u5668\uff08\u8fd9\u5c06\u5728\u524d\u53f0\u8fd0\u884c\uff0c\u5982\u679c\u4f60\u60f3\u8ba9\u5b83\u4e00\u76f4\u8fd0\u884c\uff0c\u8bf7\u5207\u6362\u5230\u65b0\u7684\u7ec8\u7aef\uff09\u3002 <pre><code>make run\n</code></pre> \u6b64\u65f6\u63a7\u5236\u53f0\u8f93\u51fa\u4ee5\u4e0b\u5185\u5bb9\uff0c\u8fd9\u91cc\u8981\u6ce8\u610f\uff0ccontroller\u662f\u5728kubebuilder\u7535\u8111\u4e0a\u8fd0\u884c\u7684\uff0c\u4e00\u65e6\u4f7f\u7528Ctrl+c\u4e2d\u65ad\u63a7\u5236\u53f0\uff0c\u5c31\u4f1a\u5bfc\u81f4controller\u505c\u6b62\uff1a </li> </ul>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#36-guestbook","title":"3.6 \u521b\u5efaGuestbook\u8d44\u6e90\u7684\u5b9e\u4f8b","text":"<ul> <li>\u73b0\u5728kubernetes\u5df2\u7ecf\u90e8\u7f72\u4e86Guestbook\u7c7b\u578b\u7684CRD\uff0c\u800c\u4e14\u5bf9\u5e94\u7684controller\u4e5f\u5df2\u6b63\u5728\u8fd0\u884c\u4e2d\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u521b\u5efaGuestbook\u7c7b\u578b\u7684\u5b9e\u4f8b\u4e86(\u76f8\u5f53\u4e8e\u6709\u4e86pod\u7684\u5b9a\u4e49\u540e\uff0c\u624d\u53ef\u4ee5\u521b\u5efapod)\uff1b</li> <li>kubebuilder\u5df2\u7ecf\u81ea\u52a8\u521b\u5efa\u4e86\u4e00\u4e2a\u7c7b\u578b\u7684\u90e8\u7f72\u6587\u4ef6\uff1a$GOPATH/src/helloworld/config/samples/webapp_v1_guestbook.yaml \uff0c\u5185\u5bb9\u5982\u4e0b\uff0c\u5f88\u7b80\u5355\uff0c\u63a5\u4e0b\u6765\u54b1\u4eec\u5c31\u7528\u8fd9\u4e2a\u6587\u4ef6\u6765\u521b\u5efaGuestbook\u5b9e\u4f8b\uff1a <pre><code>apiVersion: webapp.com.bolingcavalry/v1\nkind: Guestbook\nmetadata:\n  name: guestbook-sample\nspec:\n  # Add fields here\n  foo: bar\n</code></pre></li> </ul>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#361-pod","title":"3.6.1 \u5b89\u88c5pod","text":"<p><pre><code>$ kubectl apply -f config/samples/\n$ kubectl get Guestbook\n</code></pre> </p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#37-controllerdocker","title":"3.7 \u5c06controller\u5236\u4f5c\u4e3adocker\u955c\u50cf","text":"<ol> <li>\u81f3\u6b64\uff0c\u54b1\u4eec\u5df2\u7ecf\u4f53\u9a8c\u8fc7\u4e86kubebuilder\u7684\u57fa\u672c\u529f\u80fd\uff0c\u4e0d\u8fc7\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2dcontroller\u4e00\u822c\u90fd\u4f1a\u8fd0\u884c\u5728kubernetes\u73af\u5883\u5185\uff0c\u50cf\u4e0a\u9762\u8fd9\u79cd\u8fd0\u884c\u5728kubernetes\u4e4b\u5916\u7684\u65b9\u5f0f\u5c31\u4e0d\u5408\u9002\u4e86\uff0c\u54b1\u4eec\u6765\u8bd5\u8bd5\u5c06\u5176\u505a\u6210docker\u955c\u50cf\u7136\u540e\u5728kubernetes\u73af\u5883\u8fd0\u884c\uff1b</li> <li>\u8fd9\u91cc\u6709\u4e2a\u8981\u6c42\uff0c\u5c31\u662f\u60a8\u8981\u6709\u4e2akubernetes\u53ef\u4ee5\u8bbf\u95ee\u7684\u955c\u50cf\u4ed3\u5e93\uff0c\u4f8b\u5982\u5c40\u57df\u7f51\u5185\u7684Harbor\uff0c\u6216\u8005\u516c\u5171\u7684hub.docker.com\uff0c\u6211\u8fd9\u4e3a\u4e86\u64cd\u4f5c\u65b9\u4fbf\u9009\u62e9\u4e86hub.docker.com\uff0c\u4f7f\u7528\u5b83\u7684\u524d\u63d0\u662f\u62e5\u6709hub.docker.com\u7684\u6ce8\u518c\u5e10\u53f7\uff1b</li> <li>\u5728kubebuilder\u7535\u8111\u4e0a\uff0c\u6253\u5f00\u4e00\u4e2a\u63a7\u5236\u53f0\uff0c\u6267\u884cdocker login\u547d\u4ee4\u767b\u5f55\uff0c\u6839\u636e\u63d0\u793a\u8f93\u5165hub.docker.com\u7684\u5e10\u53f7\u548c\u5bc6\u7801\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u5f53\u524d\u63a7\u5236\u53f0\u4e0a\u6267\u884cdocker push\u547d\u4ee4\u5c06\u955c\u50cf\u63a8\u9001\u5230hub.docker.com\u4e0a\u4e86\uff08\u8fd9\u4e2a\u7f51\u7ad9\u7684\u7f51\u7edc\u5f88\u5dee\uff0c\u53ef\u80fd\u8981\u767b\u5f55\u597d\u51e0\u6b21\u624d\u80fd\u6210\u529f\uff09\uff1b</li> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u6784\u5efadocker\u955c\u50cf\u5e76\u63a8\u9001\u5230hub.docker.com\uff0c\u955c\u50cf\u540d\u4e3abolingcavalry/guestbook:002\uff1a <pre><code>make docker-build docker-push IMG=bolingcavalry/guestbook:002\n</code></pre></li> <li>hub.docker.com\u7684\u7f51\u7edc\u72b6\u51b5\u4e0d\u662f\u4e00\u822c\u7684\u5dee\uff0ckubebuilder\u7535\u8111\u4e0a\u7684docker\u4e00\u5b9a\u8981\u8bbe\u7f6e\u955c\u50cf\u52a0\u901f\uff0c\u4e0a\u8ff0\u547d\u4ee4\u5982\u679c\u906d\u9047\u8d85\u65f6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\u51e0\u6b21\uff0c\u6b64\u5916\uff0c\u6784\u5efa\u8fc7\u7a0b\u4e2d\u8fd8\u4f1a\u4e0b\u8f7d\u8bf8\u591ago\u6a21\u5757\u7684\u4f9d\u8d56\uff0c\u4e5f\u9700\u8981\u60a8\u8010\u5fc3\u7b49\u5f85\uff0c\u4e5f\u5f88\u5bb9\u6613\u9047\u5230\u7f51\u7edc\u95ee\u9898\uff0c\u9700\u8981\u591a\u6b21\u91cd\u8bd5\uff0c\u6240\u4ee5\uff0c\u6700\u597d\u662f\u4f7f\u7528\u5c40\u57df\u7f51\u5185\u642d\u5efa\u7684Habor\u670d\u52a1\uff1b</li> <li> <p>\u6700\u7ec8\uff0c\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\u8f93\u51fa\u5982\u4e0b\uff1a <pre><code>[root@kubebuilder helloworld]# make docker-build docker-push IMG=bolingcavalry/guestbook:002\n</code></pre> build\u4f1a\u94fe\u63a5\u56fd\u5916\u7f51\u7ad9\uff0c\u9700\u8981\u6ce8\u610f\u7ffb\u5899 \u955c\u50cf\u63a8\u9001\u4e0a\u53bb\u540e\uff0c\u53ef\u4ee5\u67e5\u770b\u955c\u50cf\u4fe1\u606f  <pre><code>$  make docker-build docker-push IMG=127.0.0.1:5000/guesstbook:v1\n/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/bin/controller-gen object:headerFile=\"hack/boilerplate.go.txt\" paths=\"./...\"\ngo fmt ./...\ngo vet ./...\n/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/bin/controller-gen \"crd:trivialVersions=true,preserveUnknownFields=false\" rbac:roleName=manager-role webhook paths=\"./...\" output:crd:artifacts:config=config/crd/bases\nmkdir -p /Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/testbin\ntest -f /Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/testbin/setup-envtest.sh || curl -sSLo /Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/testbin/setup-envtest.sh https://raw.githubusercontent.com/kubernetes-sigs/controller-runtime/v0.7.0/hack/setup-envtest.sh\nsource /Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/testbin/setup-envtest.sh; fetch_envtest_tools /Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/testbin; setup_envtest_env /Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/testbin; go test ./... -coverprofile cover.out\nfetching envtest tools@1.19.2 (into '/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/testbin')\nx bin/\nx bin/etcd\nx bin/kubectl\nx bin/kube-apiserver\nsetting up env vars\n?       github.com/kaliarch/imoc-operator       [no test files]\n?       github.com/kaliarch/imoc-operator/api/v1        [no test files]\nok      github.com/kaliarch/imoc-operator/controllers   12.959s coverage: 0.0% of statements\ndocker build -t 127.0.0.1:5000/guesstbook:v1 .\nSending build context to Docker daemon  335.5MB\nStep 1/14 : FROM golang:1.15 as builder\n1.15: Pulling from library/golang\nb9a857cbf04d: Pull complete \nd557ee20540b: Pull complete \n3b9ca4f00c2e: Pull complete \n667fd949ed93: Pull complete \n547cc43be03d: Pull complete \n0977886e8147: Pull complete \ncceccf7c7738: Pull complete \nDigest: sha256:de97bab9325c4c3904f8f7fec8eb469169a1d247bdc97dcab38c2c75cf4b4c5d\nStatus: Downloaded newer image for golang:1.15\n ---&gt; 5f46b413e8f5\nStep 2/14 : WORKDIR /workspace\n ---&gt; Running in 597efa584096\nRemoving intermediate container 597efa584096\n ---&gt; a21979056316\nStep 3/14 : COPY go.mod go.mod\n ---&gt; b6c4b03d5126\nStep 4/14 : COPY go.sum go.sum\n ---&gt; f1af7c95cdc8\nStep 5/14 : RUN go mod download\n ---&gt; Running in baf57375b805\nRemoving intermediate container baf57375b805\n ---&gt; 62e488ee06f5\nStep 6/14 : COPY main.go main.go\n ---&gt; 72c3d023e770\nStep 7/14 : COPY api/ api/\n ---&gt; b164eb864a85\nStep 8/14 : COPY controllers/ controllers/\n ---&gt; 843af6a782ec\nStep 9/14 : RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 GO111MODULE=on go build -a -o manager main.go\n ---&gt; Running in af2881daee7c\nRemoving intermediate container af2881daee7c\n ---&gt; cf6ef1542da6\nStep 10/14 : FROM gcr.io/distroless/static:nonroot\nnonroot: Pulling from distroless/static\n9e4425256ce4: Pull complete \nDigest: sha256:b89b98ea1f5bc6e0b48c8be6803a155b2a3532ac6f1e9508a8bcbf99885a9152\nStatus: Downloaded newer image for gcr.io/distroless/static:nonroot\n ---&gt; 88055b6758df\nStep 11/14 : WORKDIR /\n ---&gt; Running in 35900ca6d19f\nRemoving intermediate container 35900ca6d19f\n ---&gt; 902a3991fa3b\nStep 12/14 : COPY --from=builder /workspace/manager .\n ---&gt; 5af066bf1214\nStep 13/14 : USER 65532:65532\n ---&gt; Running in b44fbfb3c52b\nRemoving intermediate container b44fbfb3c52b\n ---&gt; 6ca11554d8fa\nStep 14/14 : ENTRYPOINT [\"/manager\"]\n ---&gt; Running in 716538bf799a\nRemoving intermediate container 716538bf799a\n ---&gt; a98e090c1e68\nSuccessfully built a98e090c1e68\nSuccessfully tagged 127.0.0.1:5000/guesstbook:v1\ndocker push 127.0.0.1:5000/guesstbook:v1\nThe push refers to repository [127.0.0.1:5000/guesstbook]\nbabc932481e7: Pushed \n8651333b21e7: Pushed \nv1: digest: sha256:5dbb4e549c0dff1a4edba19ea5a35f9e21deeabe2fcefbc6b6358fb849dd61e2 size: 739\n$ curl -XGET http://127.0.0.1:5000/v2/_catalog                   \n{\"repositories\":[\"guesstbook\"]}\n</code></pre></p> </li> <li> <p>\u90e8\u7f72controller \u955c\u50cf\u5230\u96c6\u7fa4\u5185 <pre><code>$ make deploy IMG=127.0.0.1:5000/guesstbook:v1\n/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/bin/controller-gen \"crd:trivialVersions=true,preserveUnknownFields=false\" rbac:roleName=manager-role webhook paths=\"./...\" output:crd:artifacts:config=config/crd/bases\ncd config/manager &amp;&amp; /Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/bin/kustomize edit set image controller=127.0.0.1:5000/guesstbook:v1\n/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/imoc-operator/bin/kustomize build config/default | kubectl apply -f -\nnamespace/imoc-operator-system created\ncustomresourcedefinition.apiextensions.k8s.io/guestbooks.webapp.com.bolingcavalry configured\nrole.rbac.authorization.k8s.io/imoc-operator-leader-election-role created\nclusterrole.rbac.authorization.k8s.io/imoc-operator-manager-role created\nclusterrole.rbac.authorization.k8s.io/imoc-operator-metrics-reader created\nclusterrole.rbac.authorization.k8s.io/imoc-operator-proxy-role created\nrolebinding.rbac.authorization.k8s.io/imoc-operator-leader-election-rolebinding created\nclusterrolebinding.rbac.authorization.k8s.io/imoc-operator-manager-rolebinding created\nclusterrolebinding.rbac.authorization.k8s.io/imoc-operator-proxy-rolebinding created\nconfigmap/imoc-operator-manager-config created\nservice/imoc-operator-controller-manager-metrics-service created\ndeployment.apps/imoc-operator-controller-manager created\n</code></pre></p> </li> <li> <p>\u67e5\u770b\u90e8\u7f72\u8fdb\u96c6\u7fa4\u7684\u63a7\u5236\u5668 \u67e5\u770b\u955c\u50cf\u62c9\u53d6\u5f02\u5e38\uff0c </p> </li> <li> <p>\u5728\u6b64\u4f7f\u7528\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93</p> </li> </ol> <p><pre><code>$ sudo docker login --username=1123845260@qq.com registry.cn-shanghai.aliyuncs.com\n$ sudo docker pull registry.cn-shanghai.aliyuncs.com/kaliarch/slate:[\u955c\u50cf\u7248\u672c\u53f7]\n\n$ sudo docker login --username=1123845260@qq.com registry.cn-shanghai.aliyuncs.com\n$ sudo docker tag [ImageId] registry.cn-shanghai.aliyuncs.com/kaliarch/slate:[\u955c\u50cf\u7248\u672c\u53f7]\n$ sudo docker push registry.cn-shanghai.aliyuncs.com/kaliarch/slate:[\u955c\u50cf\u7248\u672c\u53f7]\n\n1. \u767b\u9646\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\n\u5bc6\u7801\uff1a\u963f\u91cc\u63a7\u5236\u53f0\u8d26\u53f7\n\n2. \u4fee\u6539tag\ndocker tag 127.0.0.1:5000/guesstbook:v1 registry.cn-shanghai.aliyuncs.com/kaliarch/guesstbook:v1\n3. \u63a8\u9001\u955c\u50cf\ndocker push registry.cn-shanghai.aliyuncs.com/kaliarch/guesstbook:v1\n</code></pre> </p> <p>\u91cd\u65b0\u90e8\u7f72 <pre><code>make deploy IMG=registry.cn-shanghai.aliyuncs.com/kaliarch/guesstbook:v1\n</code></pre> \u67e5\u770b\u5df2\u7ecf\u6210\u529f\u8fd0\u884c </p> <ol> <li> <p>\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f  \u663e\u793a\u8fd9\u4e2apod\u5b9e\u9645\u4e0a\u6709\u4e24\u4e2a\u5bb9\u5668\uff0c\u7528kubectl describe\u547d\u4ee4\u7ec6\u770b\uff0c\u5206\u522b\u662fkube-rbac-proxy\u548cmanager</p> </li> <li> <p>\u67e5\u770b\u65e5\u5fd7</p> </li> </ol> <pre><code>kubectl logs -f imoc-operator-controller-manager-648b4877c6-4bpp9 -n imoc-operator-system  -c manager\n</code></pre>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#_3","title":"\u56db \u6e05\u7406","text":""},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#41-kubebuilder","title":"4.1 \u6e05\u7406kubebuilder","text":"<pre><code>make uninstall\n</code></pre>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#42-kind","title":"4.2 \u6e05\u7406kind","text":"<pre><code>kind delete cluster\n</code></pre>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#_4","title":"\u4e94 \u5176\u4ed6","text":"<p>\u901a\u8fc7\u4e86\u89e3\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 Kubebuilder \u63d0\u4f9b\u7684\u529f\u80fd\u5bf9\u4e8e\u5feb\u901f\u7f16\u5199 CRD \u548c Controller \u662f\u5341\u5206\u6709\u5e2e\u52a9\u7684\uff0c\u65e0\u8bba\u662f\u4e91\u539f\u751f\u4e2d\u77e5\u540d\u7684\u5f00\u6e90\u9879\u76ee\u4f8b\u5982 Istio\u3001Knative \u7b49\u77e5\u540d\u9879\u76ee\u8fd8\u662f\u5404\u79cd\u81ea\u5b9a\u4e49 Operators\uff0c\u90fd\u5927\u91cf\u4f7f\u7528\u4e86 CRD\uff0c\u5c06\u5404\u79cd\u7ec4\u4ef6\u62bd\u8c61\u4e3a CRD\uff0c\u636e\u6b64\u53ef\u4ee5\u5c06\u4e3a\u81ea\u5df1\u4e1a\u52a1\u7f16\u5199\u5bf9\u5e94\u7684CRD\uff0c\u4f7f\u5f97\u4e1a\u52a1\u66f4\u52a0\u751f\u4e8e\u4e91\u957f\u4e8e\u4e91\u3002</p>"},{"location":"cloud-native/develop/K8s%20Operator%20%E5%BC%80%E5%8F%91%E4%B9%8B%20kubebuilder%20%E5%AE%9E%E6%88%98/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://cloudnative.to/kubebuilder/quick-start.html</li> <li>https://www.cnblogs.com/alisystemsoftware/p/11580202.html</li> <li>https://blog.csdn.net/boling_cavalry/article/details/113089414</li> <li>https://zhuanlan.zhihu.com/p/83957726 </li> </ul>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/","title":"K8s-CRD \u5b9e\u6218","text":""},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#_1","title":"\u4e00 \u6982\u8ff0","text":""},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#11-crd","title":"1.1 CRD\u7b80\u4ecb","text":"<p>Custom resources\uff1a\u662f\u5bf9K8S API\u7684\u6269\u5c55\uff0c\u4ee3\u8868\u4e86\u4e00\u4e2a\u7279\u5b9a\u7684kubetnetes\u7684\u5b9a\u5236\u5316\u5b89\u88c5\u3002\u5728\u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684\u96c6\u7fa4\u4e2d\uff0c\u81ea\u5b9a\u4e49\u8d44\u6e90\u53ef\u4ee5\u52a8\u6001\u6ce8\u518c\u5230\u96c6\u7fa4\u4e2d\u3002\u6ce8\u518c\u5b8c\u6bd5\u4ee5\u540e\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7kubelet\u521b\u5efa\u548c\u8bbf\u95ee\u8fd9\u4e2a\u81ea\u5b9a\u4e49\u7684\u5bf9\u8c61\uff0c\u7c7b\u4f3c\u4e8e\u64cd\u4f5cpod\u4e00\u6837\u3002</p> <p>Custom controllers\uff1aCustom resources\u53ef\u4ee5\u8ba9\u7528\u6237\u7b80\u5355\u7684\u5b58\u50a8\u548c\u83b7\u53d6\u7ed3\u6784\u5316\u6570\u636e\u3002\u53ea\u6709\u7ed3\u5408\u63a7\u5236\u5668\u624d\u80fd\u53d8\u6210\u4e00\u4e2a\u771f\u6b63\u7684declarative API\uff08\u88ab\u58f0\u660e\u8fc7\u7684API\uff09\u3002\u63a7\u5236\u5668\u53ef\u4ee5\u628a\u8d44\u6e90\u66f4\u65b0\u6210\u7528\u6237\u60f3\u8981\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u901a\u8fc7\u4e00\u7cfb\u5217\u64cd\u4f5c\u7ef4\u62a4\u548c\u53d8\u66f4\u72b6\u6001\u3002\u5b9a\u5236\u5316\u63a7\u5236\u5668\u662f\u7528\u6237\u53ef\u4ee5\u5728\u8fd0\u884c\u4e2d\u7684\u96c6\u7fa4\u5185\u90e8\u7f72\u548c\u66f4\u65b0\u7684\u4e00\u4e2a\u63a7\u5236\u5668\uff0c\u5b83\u72ec\u7acb\u4e8e\u96c6\u7fa4\u672c\u8eab\u7684\u751f\u547d\u5468\u671f\u3002 \u5b9a\u5236\u5316\u63a7\u5236\u5668\u53ef\u4ee5\u548c\u4efb\u4f55\u4e00\u79cd\u8d44\u6e90\u4e00\u8d77\u5de5\u4f5c\uff0c\u5f53\u548c\u5b9a\u5236\u5316\u8d44\u6e90\u7ed3\u5408\u4f7f\u7528\u65f6\u5c24\u5176\u6709\u6548\u3002</p> <p>Operator\u6a21\u5f0f \u662f\u4e00\u4e2acustomer controllers\u548cCustom resources\u7ed3\u5408\u7684\u4f8b\u5b50\u3002\u5b83\u53ef\u4ee5\u5141\u8bb8\u5f00\u53d1\u8005\u5c06\u7279\u6b8a\u5e94\u7528\u7f16\u7801\u81f3kubernetes\u7684\u6269\u5c55API\u5185\u3002</p>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#12","title":"1.2 \u4f7f\u7528\u573a\u666f","text":"<p>\u5176\u5b9ecrd\u5728\u5f88\u591ak8s\u5468\u8fb9\u5f00\u6e90\u9879\u76ee\u4e2d\u6709\u4f7f\u7528\uff0c\u6bd4\u5982ingress-controller \u3001istio \u3001hpa\u548c\u4f17\u591a\u7684operator\u3002</p> <p>\u5982\u4f55\u6dfb\u52a0\u4e00\u4e2aCustom resources\u5230\u6211\u7684kubernetes\u96c6\u7fa4\u5462\uff1f kubernetes\u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\u5c06Custom resources\u6dfb\u52a0\u5230\u96c6\u7fa4\u3002</p> <p>Custom Resource Definitions (CRDs)\uff1a\u66f4\u6613\u7528\u3001\u4e0d\u9700\u8981\u7f16\u7801\u3002\u4f46\u662f\u7f3a\u4e4f\u7075\u6d3b\u6027\u3002 API Aggregation\uff1a\u9700\u8981\u7f16\u7801\uff0c\u5141\u8bb8\u901a\u8fc7\u805a\u5408\u5c42\u7684\u65b9\u5f0f\u63d0\u4f9b\u66f4\u52a0\u5b9a\u5236\u5316\u7684\u5b9e\u73b0\u3002 \u672c\u6587\u91cd\u70b9\u8bb2\u89e3Custom Resource Definitions (CRD\uff09\u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#13","title":"1.3 \u901a\u4fd7\u8bb2\u89e3","text":"<ul> <li>\u5728k8s\u4e2d\uff0c\u6240\u6709\u7684\u4e1c\u897f\u90fd\u53eb\u505a\u8d44\u6e90\uff08Resource\uff09\uff0c \u4e5f\u5c31\u662fyaml\u4e2dKind\u5b57\u6bb5</li> <li>\u9664\u8fc7K8s\u96c6\u7fa4\u4e2d\u5e38\u89c1\u7684deployment\u8fd9\u4e9b\u8d44\u6e90\u5916\uff0ckube\u5141\u8bb8\u7528\u6237\u81ea\u5b9a\u4e49\u8d44\u6e90\uff08Custom Resource\uff09\uff0c\u4e5f\u5c31CR</li> <li>CRD \u5176\u5b9e\u5e76\u4e0d\u662f\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u800c\u662f\u6211\u4eec\u81ea\u5b9a\u4e49\u8d44\u6e90\u7684\u5b9a\u4e49\uff08\u6765\u63cf\u8ff0\u6211\u4eec\u5b9a\u4e49\u7684\u8d44\u6e90\u662f\u4ec0\u4e48\u6837\u5b50\uff09</li> <li>\u5bf9\u4e8e\u4e00\u4e2aCRD\u6765\u8bb2\uff0c\u5176\u672c\u8d28\u5c31\u662f\u4e00\u4e2a Open Api \u7684 schema\uff0c\u65e0\u8bba\u662fk8s\u81ea\u7531\u8d44\u6e90\uff0c\u8fd8\u662f\u7528\u6237\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u90fd\u9700\u8981yaml\u6765\u63cf\u8ff0\uff0c\u4f46\u662f\u5982\u679c\u4fdd\u969cyaml\u7684\u89c4\u8303\u6027\u548c\u5408\u6cd5\u6027\uff0c\u5c31\u662fschema\u6765\u505a\uff0c\u5c31\u662f\u60f3\u96c6\u7fa4\u6ce8\u518c\u4e00\u79cd\u65b0\u8d44\u6e90\uff0c\u5e76\u544a\u77e5 ApiServer\uff0c\u8fd9\u79cd\u8d44\u6e90\u600e\u4e48\u600e\u4e48\u88ab\u5408\u6cd5\u7684\u5b9a\u4e49\u3002</li> </ul>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#_2","title":"\u4e8c \u67b6\u6784","text":""},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#21","title":"2.1 \u67b6\u6784\u56fe","text":""},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#22","title":"2.2 \u67b6\u6784\u8be6\u89e3","text":"<p>\u5f53\u60a8\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 CustomResourceDefinition (CRD)\u65f6\uff0cKubernetes API Server \u5c06\u4e3a\u60a8\u6307\u5b9a\u7684\u6bcf\u4e2a\u7248\u672c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 RESTful \u8d44\u6e90\u8def\u5f84\u3002CRD \u53ef\u4ee5\u662f\u547d\u540d\u7a7a\u95f4\u7684\uff0c\u4e5f\u53ef\u4ee5\u662f\u96c6\u7fa4\u8303\u56f4\u7684\uff0c\u8fd9\u5728 CRD \u7684\u8303\u56f4\u5b57\u6bb5\u4e2d\u6307\u5b9a\u4e86\u3002\u4e0e\u73b0\u6709\u7684\u5185\u7f6e\u5bf9\u8c61\u4e00\u6837\uff0c\u5220\u9664\u540d\u79f0\u7a7a\u95f4\u5c06\u5220\u9664\u8be5\u540d\u79f0\u7a7a\u95f4\u4e2d\u7684\u6240\u6709\u81ea\u5b9a\u4e49\u5bf9\u8c61\u3002Customresourcedefinition \u672c\u8eab\u662f\u975e\u547d\u540d\u7a7a\u95f4\u7684\uff0c\u5bf9\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u53ef\u7528\u3002</p>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#_3","title":"\u4e09 \u5b9e\u6218","text":""},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#31","title":"3.1 \u73af\u5883","text":""},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#32","title":"3.2 \u81ea\u5b9a\u4e49\u8d44\u6e90","text":""},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#321-crontabl_crdyaml","title":"3.2.1 crontabl_crd.yaml","text":"<ul> <li>\u5185\u5bb9</li> </ul> <pre><code>apiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  # \u79f0\u5fc5\u987b\u4e0e\u4e0b\u9762\u7684spec\u5b57\u6bb5\u5339\u914d\uff0c\u683c\u5f0f\u4e3a: &lt;plural&gt;.&lt;group&gt;\n  name: crontabs.crd.test.com\nspec:\n  # \u7528\u4e8eREST API\u7684\u7ec4\u540d\u79f0: /apis/&lt;group&gt;/&lt;version&gt;\n  group: crd.test.com\n  versions:\n  - name: v1\n    # \u6bcf\u4e2a\u7248\u672c\u90fd\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u6807\u5fd7\u542f\u7528/\u7981\u7528\u3002\n    served: true\n    # \u5fc5\u987b\u5c06\u4e00\u4e2a\u4e14\u53ea\u6709\u4e00\u4e2a\u7248\u672c\u6807\u8bb0\u4e3a\u5b58\u50a8\u7248\u672c\u3002\n    storage: true\n  scope: Namespaced  # \u6307\u5b9acrd\u8d44\u6e90\u4f5c\u7528\u8303\u56f4\u5728\u547d\u540d\u7a7a\u95f4\u6216\u96c6\u7fa4\n  names:\n    # URL\u4e2d\u4f7f\u7528\u7684\u590d\u6570\u540d\u79f0: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;\n    plural: crontabs\n    # \u5728CLI(shell\u754c\u9762\u8f93\u5165\u7684\u53c2\u6570)\u4e0a\u7528\u4f5c\u522b\u540d\u5e76\u7528\u4e8e\u663e\u793a\u7684\u5355\u6570\u540d\u79f0\n    singular: crontab\n    kind: CronTab\n    # \u77ed\u540d\u79f0\u5141\u8bb8\u77ed\u5b57\u7b26\u4e32\u5339\u914dCLI\u4e0a\u7684\u8d44\u6e90\uff0c\u610f\u8bc6\u5c31\u662f\u80fd\u901a\u8fc7kubectl \u5728\u67e5\u770b\u8d44\u6e90\u7684\u65f6\u5019\u4f7f\u7528\u8be5\u8d44\u6e90\u7684\u7b80\u540d\u79f0\u6765\u83b7\u53d6\u3002\n    shortNames:\n    - ct\n</code></pre> <ul> <li>\u90e8\u7f72crd</li> </ul> <pre><code>[root@master concrd]# kubectl apply -f crontab_crd.yaml \ncustomresourcedefinition.apiextensions.k8s.io/crontabs.crd.test.com created\n[root@master concrd]# kubectl get crd |grep crontab\ncrontabs.crd.test.com                             2021-05-19T06:42:02Z\n</code></pre> <p>\u7136\u540e\u5728\u4ee5\u4e0b\u5730\u65b9\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u540d\u79f0\u7a7a\u95f4 RESTful API \u7aef\u70b9:</p> <pre><code>/apis/stable.example.com/v1/namespaces/*/crontabs/...\n</code></pre>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#322-test_crontabyaml","title":"3.2.2 test_crontab.yaml","text":"<ul> <li>\u5185\u5bb9</li> </ul> <pre><code>apiVersion: crd.test.com/v1\nkind: CronTab\nmetadata:\n  name: my-test-crontab\nspec:\n  cronSpec: \"* * * * */10\"\n  image: my-test-image\n  replicas: 2\n</code></pre> <ul> <li>\u90e8\u7f72</li> </ul> <pre><code>[root@master concrd]# kubectl apply -f test_crontabl.yaml \ncrontab.crd.test.com/my-test-crontab created\n[root@master concrd]# kubectl get ct\nNAME              AGE\nmy-test-crontab   6s\n[root@master concrd]# kubectl  get ct my-test-crontab -oyaml\napiVersion: crd.test.com/v1\nkind: CronTab\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"crd.test.com/v1\",\"kind\":\"CronTab\",\"metadata\":{\"annotations\":{},\"name\":\"my-test-crontab\",\"namespace\":\"default\"},\"spec\":{\"cronSpec\":\"* * * * */10\",\"image\":\"my-test-image\",\"replicas\":2}}\n  creationTimestamp: \"2021-05-19T06:44:26Z\"\n  generation: 1\n  name: my-test-crontab\n  namespace: default\n  resourceVersion: \"67685692\"\n  selfLink: /apis/crd.test.com/v1/namespaces/default/crontabs/my-test-crontab\n  uid: fc78e12d-6b0f-4dc5-b6a7-75459d333eef\nspec:\n  cronSpec: '* * * * */10'\n  image: my-test-image\n  replicas: 2\n</code></pre>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#33-validations","title":"3.3 validations","text":"<p>validation\u8fd9\u4e2a\u9a8c\u8bc1\u662f\u4e3a\u4e86\u5728\u521b\u5efa\u597d\u81ea\u5b9a\u4e49\u8d44\u6e90\u540e\uff0c\u901a\u8fc7\u8be5\u8d44\u6e90\u521b\u5efa\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u5bf9\u8c61\u7684\u5b57\u6bb5\u4e2d\u5b58\u5728\u65e0\u6548\u503c\uff0c\u5219\u521b\u5efa\u8be5\u5bf9\u8c61\u7684\u8bf7\u6c42\u5c06\u88ab\u62d2\u7edd\uff0c\u5426\u5219\u4f1a\u88ab\u521b\u5efa\u3002\u6211\u4eec\u53ef\u4ee5\u5728crd\u6587\u4ef6\u4e2d\u6dfb\u52a0\u201cvalidation:\u201d\u5b57\u6bb5\u6765\u6dfb\u52a0\u76f8\u5e94\u7684\u9a8c\u8bc1\u673a\u5236\u3002</p>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#331-crontab_validations_crdyaml","title":"3.3.1 crontab_validations_crd.yaml","text":"<pre><code>apiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  # \u79f0\u5fc5\u987b\u4e0e\u4e0b\u9762\u7684spec\u5b57\u6bb5\u5339\u914d\uff0c\u683c\u5f0f\u4e3a: &lt;plural&gt;.&lt;group&gt;\n  name: crontabs.crd.test.com\nspec:\n  # \u7528\u4e8eREST API\u7684\u7ec4\u540d\u79f0: /apis/&lt;group&gt;/&lt;version&gt;\n  group: crd.test.com\n  versions:\n  - name: v1\n    # \u6bcf\u4e2a\u7248\u672c\u90fd\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u6807\u5fd7\u542f\u7528/\u7981\u7528\u3002\n    served: true\n    # \u5fc5\u987b\u5c06\u4e00\u4e2a\u4e14\u53ea\u6709\u4e00\u4e2a\u7248\u672c\u6807\u8bb0\u4e3a\u5b58\u50a8\u7248\u672c\u3002\n    storage: true\n  scope: Namespaced # \u6307\u5b9acrd\u8d44\u6e90\u4f5c\u7528\u8303\u56f4\u5728\u547d\u540d\u7a7a\u95f4\u6216\u96c6\u7fa4\n  names:\n    # URL\u4e2d\u4f7f\u7528\u7684\u590d\u6570\u540d\u79f0: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;\n    plural: crontabs\n    # \u5728CLI(shell\u754c\u9762\u8f93\u5165\u7684\u53c2\u6570)\u4e0a\u7528\u4f5c\u522b\u540d\u5e76\u7528\u4e8e\u663e\u793a\u7684\u5355\u6570\u540d\u79f0\n    singular: crontab\n    kind: CronTab\n    # \u77ed\u540d\u79f0\u5141\u8bb8\u77ed\u5b57\u7b26\u4e32\u5339\u914dCLI\u4e0a\u7684\u8d44\u6e90\uff0c\u610f\u8bc6\u5c31\u662f\u80fd\u901a\u8fc7kubectl \u5728\u67e5\u770b\u8d44\u6e90\u7684\u65f6\u5019\u4f7f\u7528\u8be5\u8d44\u6e90\u7684\u7b80\u540d\u79f0\u6765\u83b7\u53d6\u3002\n    shortNames:\n    - ct\n  validation:\n    openAPIV3Schema:\n      properties:\n        spec:\n          properties:\n            cronSpec: #\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\u3001\u7b26\u5408\u6b63\u5219\u89c4\u5219\n              type: string\n              pattern: '^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'\n            replicas: #\u8bbe\u7f6e\u526f\u672c\u6570\u7684\u9650\u5236\n              type: integer\n              minimum: 1\n              maximum: 10\n</code></pre>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#332-test_validations_crontabyaml","title":"3.3.2 test_validations_crontab.yaml","text":"<pre><code>apiVersion: crd.test.com/v1\nkind: CronTab\nmetadata:\n  name: my-test-crontab\nspec:\n  cronSpec: \"* * * * */10\"\n  image: my-test-image\n  replicas: 21\n</code></pre> <ul> <li>\u6d4b\u8bd5\u4e0d\u7b26\u5408\u89c4\u8303\u7684replicase</li> </ul> <pre><code>[root@master concrd]# kubectl apply -f test_validation_crontab.yaml \nThe CronTab \"my-test-crontab\" is invalid: spec.replicas: Invalid value: 10: spec.replicas in body should be less than or equal to 10\n</code></pre>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#34-additionalprintercolumns","title":"3.4 additionalPrinterColumns","text":"<p>\u4eceKubernetes 1.11\u5f00\u59cb\uff0ckubectl\u4f7f\u7528\u670d\u52a1\u5668\u7aef\u6253\u5370\u3002\u670d\u52a1\u5668\u51b3\u5b9a\u7531kubectl get\u547d\u4ee4\u663e\u793a\u54ea\u4e9b\u5217\u5373\u5728\u6211\u4eec\u83b7\u53d6\u4e00\u4e2a\u5185\u7f6e\u8d44\u6e90\u7684\u65f6\u5019\u4f1a\u663e\u793a\u51fa\u4e00\u4e9b\u5217\u8868\u4fe1\u606f(\u6bd4\u5982\uff1akubectl get nodes)\u3002\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528CustomResourceDefinition\u81ea\u5b9a\u4e49\u8fd9\u4e9b\u5217\uff0c\u5f53\u6211\u4eec\u5728\u67e5\u770b\u81ea\u5b9a\u4e49\u8d44\u6e90\u4fe1\u606f\u7684\u65f6\u5019\u663e\u793a\u51fa\u6211\u4eec\u9700\u8981\u7684\u5217\u8868\u4fe1\u606f\u3002\u901a\u8fc7\u5728crd\u6587\u4ef6\u4e2d\u6dfb\u52a0\u201cadditionalPrinterColumns:\u201d\u5b57\u6bb5\uff0c\u5728\u8be5\u5b57\u6bb5\u4e0b\u58f0\u660e\u9700\u8981\u6253\u5370\u5217\u7684\u7684\u4fe1\u606f</p>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#341-crontab_crd_additionalprintercolumnsyaml","title":"3.4.1 crontab_crd_additionalPrinterColumns.yaml","text":"<pre><code>apiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  # \u79f0\u5fc5\u987b\u4e0e\u4e0b\u9762\u7684spec\u5b57\u6bb5\u5339\u914d\uff0c\u683c\u5f0f\u4e3a: &lt;plural&gt;.&lt;group&gt;\n  name: crontabs.crd.test.com\nspec:\n  # \u7528\u4e8eREST API\u7684\u7ec4\u540d\u79f0: /apis/&lt;group&gt;/&lt;version&gt;\n  group: crd.test.com\n  versions:\n  - name: v1\n    # \u6bcf\u4e2a\u7248\u672c\u90fd\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u6807\u5fd7\u542f\u7528/\u7981\u7528\u3002\n    served: true\n    # \u5fc5\u987b\u5c06\u4e00\u4e2a\u4e14\u53ea\u6709\u4e00\u4e2a\u7248\u672c\u6807\u8bb0\u4e3a\u5b58\u50a8\u7248\u672c\u3002\n    storage: true\n  scope: Namespaced # \u6307\u5b9acrd\u8d44\u6e90\u4f5c\u7528\u8303\u56f4\u5728\u547d\u540d\u7a7a\u95f4\u6216\u96c6\u7fa4\n  names:\n    # URL\u4e2d\u4f7f\u7528\u7684\u590d\u6570\u540d\u79f0: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;\n    plural: crontabs\n    # \u5728CLI(shell\u754c\u9762\u8f93\u5165\u7684\u53c2\u6570)\u4e0a\u7528\u4f5c\u522b\u540d\u5e76\u7528\u4e8e\u663e\u793a\u7684\u5355\u6570\u540d\u79f0\n    singular: crontab\n    kind: CronTab\n    # \u77ed\u540d\u79f0\u5141\u8bb8\u77ed\u5b57\u7b26\u4e32\u5339\u914dCLI\u4e0a\u7684\u8d44\u6e90\uff0c\u610f\u8bc6\u5c31\u662f\u80fd\u901a\u8fc7kubectl \u5728\u67e5\u770b\u8d44\u6e90\u7684\u65f6\u5019\u4f7f\u7528\u8be5\u8d44\u6e90\u7684\u7b80\u540d\u79f0\u6765\u83b7\u53d6\u3002\n    shortNames:\n    - ct\n  validation:\n    openAPIV3Schema:\n      properties:\n        spec:\n          properties:\n            cronSpec: #\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\u3001\u7b26\u5408\u6b63\u5219\u89c4\u5219\n              type: string\n              pattern: '^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'\n            replicas: #\u8bbe\u7f6e\u526f\u672c\u6570\u7684\u9650\u5236\n              type: integer\n              minimum: 1\n              maximum: 10\n  additionalPrinterColumns:\n  - name: Replicas\n    type: integer\n    JSONPath: .spec.replicas\n  - name: Age\n    type: date\n    JSONPath: .metadata.creationTimestamp\n</code></pre> <ul> <li>\u90e8\u7f72</li> </ul> <pre><code>[root@master concrd]# kubectl apply -f crontab_crd_additionalPrinterColumns.yaml \ncustomresourcedefinition.apiextensions.k8s.io/crontabs.crd.test.com created\n[root@master concrd]# kubectl get crd |grep crontab\ncrontabs.crd.test.com                             2021-05-19T06:42:02Z\n</code></pre>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#342-test_additionalprintercolumns_crontabyml","title":"3.4.2 test_additionalPrinterColumns_crontab.yml","text":"<ul> <li>\u5185\u5bb9</li> </ul> <pre><code>apiVersion: crd.test.com/v1\nkind: CronTab\nmetadata:\n  name: my-test-crontab\nspec:\n  cronSpec: \"* * * * */10\"\n  image: my-test-image\n  replicas: 2\n</code></pre> <ul> <li>\u67e5\u770b</li> </ul> <pre><code>[root@master concrd]# kubectl  get ct\nNAME              REPLICAS   AGE\nmy-test-crontab   2          178m\n</code></pre>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#35-subresources","title":"3.5 subresources","text":"<p>\u4e00\u822c\u6211\u4eec\u8981\u662f\u6ca1\u6709\u5728\u81ea\u5b9a\u4e49\u8d44\u6e90\u5f53\u4e2d\u914d\u7f6e\u5173\u4e8e\u8d44\u6e90\u5bf9\u8c61\u7684\u4f38\u7f29\u548c\u72b6\u6001\u4fe1\u606f\u7684\u4e00\u4e9b\u76f8\u5173\u914d\u7f6e\u7684\u8bdd\uff0c\u90a3\u4e48\u5728\u5f53\u6211\u4eec\u901a\u8fc7\u8be5\u81ea\u5b9a\u4e49\u8d44\u6e90\u521b\u5efa\u5bf9\u8c61\u540e\uff0c\u53c8\u60f3\u901a\u8fc7\u201ckubectl scale\u201d\u6765\u5f39\u6027\u7684\u6269\u5c55\u8be5\u5bf9\u8c61\u7684\u5bb9\u5668\u7684\u65f6\u5019\u5c31\u4f1a\u65e0\u80fd\u4e3a\u529b\u3002\u800cCRD\u53ef\u4ee5\u5141\u8bb8\u6211\u4eec\u6dfb\u52a0\u8be5\u65b9\u9762\u7684\u76f8\u5173\u914d\u7f6e\u58f0\u660e\uff0c\u4ece\u800c\u8fbe\u5230\u6211\u4eec\u53ef\u4ee5\u5bf9\u81ea\u5b9a\u4e49\u8d44\u6e90\u5bf9\u8c61\u7684\u4f38\u7f29\u5904\u7406\u3002\u6dfb\u52a0\u201c subresources:\u201d\u5b57\u6bb5\u6765\u58f0\u660e\u72b6\u6001\u548c\u4f38\u7f29\u4fe1\u606f\u3002</p>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#351-crontab_crd_subresourcesyml","title":"3.5.1 crontab_crd_subresources.yml","text":"<pre><code>apiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  # \u79f0\u5fc5\u987b\u4e0e\u4e0b\u9762\u7684spec\u5b57\u6bb5\u5339\u914d\uff0c\u683c\u5f0f\u4e3a: &lt;plural&gt;.&lt;group&gt;\n  name: crontabs.crd.test.com\nspec:\n  # \u7528\u4e8eREST API\u7684\u7ec4\u540d\u79f0: /apis/&lt;group&gt;/&lt;version&gt;\n  group: crd.test.com\n  versions:\n  - name: v1\n    # \u6bcf\u4e2a\u7248\u672c\u90fd\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u6807\u5fd7\u542f\u7528/\u7981\u7528\u3002\n    served: true\n    # \u5fc5\u987b\u5c06\u4e00\u4e2a\u4e14\u53ea\u6709\u4e00\u4e2a\u7248\u672c\u6807\u8bb0\u4e3a\u5b58\u50a8\u7248\u672c\u3002\n    storage: true\n  scope: Namespaced # \u6307\u5b9acrd\u8d44\u6e90\u4f5c\u7528\u8303\u56f4\u5728\u547d\u540d\u7a7a\u95f4\u6216\u96c6\u7fa4\n  names:\n    # URL\u4e2d\u4f7f\u7528\u7684\u590d\u6570\u540d\u79f0: /apis/&lt;group&gt;/&lt;version&gt;/&lt;plural&gt;\n    plural: crontabs\n    # \u5728CLI(shell\u754c\u9762\u8f93\u5165\u7684\u53c2\u6570)\u4e0a\u7528\u4f5c\u522b\u540d\u5e76\u7528\u4e8e\u663e\u793a\u7684\u5355\u6570\u540d\u79f0\n    singular: crontab\n    kind: CronTab\n    # \u77ed\u540d\u79f0\u5141\u8bb8\u77ed\u5b57\u7b26\u4e32\u5339\u914dCLI\u4e0a\u7684\u8d44\u6e90\uff0c\u610f\u8bc6\u5c31\u662f\u80fd\u901a\u8fc7kubectl \u5728\u67e5\u770b\u8d44\u6e90\u7684\u65f6\u5019\u4f7f\u7528\u8be5\u8d44\u6e90\u7684\u7b80\u540d\u79f0\u6765\u83b7\u53d6\u3002\n    shortNames:\n    - ct\n  validation:\n    openAPIV3Schema:\n      properties:\n        spec:\n          properties:\n            cronSpec: #\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\u3001\u7b26\u5408\u6b63\u5219\u89c4\u5219\n              type: string\n              pattern: '^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'\n            replicas: #\u8bbe\u7f6e\u526f\u672c\u6570\u7684\u9650\u5236\n              type: integer\n              minimum: 1\n              maximum: 10\n  additionalPrinterColumns:\n  - name: Replicas\n    type: integer\n    JSONPath: .spec.replicas\n  - name: Age\n    type: date\n    JSONPath: .metadata.creationTimestamp\n  subresources:\n    scale:\n      specReplicasPath: .spec.replicas\n      statusReplicasPath: .status.replicas\n</code></pre>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#352","title":"3.5.2 \u6d4b\u8bd5","text":"<pre><code>[root@master concrd]# kubectl  apply -f crontab_crd_subresources.yml \ncustomresourcedefinition.apiextensions.k8s.io/crontabs.crd.test.com configured\n[root@master concrd]# kubectl  get ct\nNAME              REPLICAS   AGE\nmy-test-crontab   2          3h1m\n[root@master concrd]# kubectl scale --replicas=5 crontabs/my-test-crontab\ncrontab.crd.test.com/my-test-crontab scaled\n[root@master concrd]# kubectl  get ct\nNAME              REPLICAS   AGE\nmy-test-crontab   5          3h1m\n</code></pre>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#_4","title":"\u6e05\u7406","text":"<ul> <li>\u5220\u9664\u81ea\u5b9a\u4e49\u8d44\u6e90</li> </ul> <pre><code>kubectl delete  ct my-test-crontab\n</code></pre> <ul> <li>\u6e05\u7406crd</li> </ul> <pre><code>kubectl delete crd crontabs.crd.test.com\n</code></pre>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#_5","title":"\u56db \u6ce8\u610f\u4e8b\u9879","text":""},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#_6","title":"\u4e94 \u603b\u7ed3","text":"<p>\u529f\u80fd\u4e0a\uff1aCRD \u4f7f\u5f97 Kubernetes \u5df2\u6709\u7684\u8d44\u6e90\u548c\u80fd\u529b\u53d8\u6210\u4e86\u4e50\u9ad8\u79ef\u6728\uff0c\u6211\u4eec\u5f88\u8f7b\u677e\u5c31\u53ef\u4ee5\u5229\u7528\u8fd9\u4e9b\u79ef\u6728\u62d3\u5c55 Kubernetes \u539f\u751f\u4e0d\u5177\u5907\u7684\u80fd\u529b\u3002</p> <p>\u4ea7\u54c1\u4e0a\uff1a\u57fa\u4e8e Kubernetes \u505a\u7684\u4ea7\u54c1\u65e0\u6cd5\u907f\u514d\u7684\u9700\u8981\u8ba9\u6211\u4eec\u5c06\u4ea7\u54c1\u672f\u8bed\u5411 Kube \u672f\u8bed\u9760\u62e2\uff0c\u6bd4\u5982\u4e00\u4e2a\u670d\u52a1\u5c31\u662f\u4e00\u4e2a Deployment\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u5c31\u662f\u4e00\u4e2a Pod \u4e4b\u7c7b\u3002\u4f46\u662f CRD \u5141\u8bb8\u6211\u4eec\u81ea\u5df1\u57fa\u4e8e\u4ea7\u54c1\u521b\u5efa\u6982\u5ff5\uff08\u6216\u8005\u8bf4\u8d44\u6e90\uff09\uff0c\u8ba9 Kube \u5df2\u6709\u7684\u8d44\u6e90\u4e3a\u6211\u4eec\u7684\u6982\u5ff5\u670d\u52a1\uff0c\u8fd9\u53ef\u4ee5\u4f7f\u4ea7\u54c1\u66f4\u4e13\u6ce8\u4e0e\u89e3\u51b3\u7684\u573a\u666f\uff0c\u800c\u4e0d\u662f\u5982\u4f55\u601d\u8003\u5982\u4f55\u5c06\u573a\u666f\u5e94\u7528\u5230 Kubernetes\u3002</p>"},{"location":"cloud-native/develop/K8s-CRD%E5%AE%9E%E6%88%98/#_7","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://blog.csdn.net/weixin_41806245/article/details/94451734</li> <li>https://juejin.cn/post/6844903965482713096</li> <li>https://juejin.cn/post/6844904199029784589</li> <li>https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/</li> <li>https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#validation</li> </ul>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/","title":"Kubernetes AdmissionWebhook","text":""},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#_1","title":"\u524d\u8a00","text":"<p>Kubernetes \u5bf9 API \u8bbf\u95ee\u63d0\u4f9b\u4e86\u4e09\u79cd\u5b89\u5168\u8bbf\u95ee\u63a7\u5236\u63aa\u65bd\uff1a\u8ba4\u8bc1\u3001\u6388\u6743\u548c Admission Control\u3002\u8ba4\u8bc1\u89e3\u51b3\u7528\u6237\u662f\u8c01\u7684\u95ee\u9898\uff0c\u6388\u6743\u89e3\u51b3\u7528\u6237\u80fd\u505a\u4ec0\u4e48\u7684\u95ee\u9898\uff0cAdmission Control \u5219\u662f\u8d44\u6e90\u7ba1\u7406\u65b9\u9762\u7684\u4f5c\u7528\u3002\u901a\u8fc7\u5408\u7406\u7684\u6743\u9650\u7ba1\u7406\uff0c\u80fd\u591f\u4fdd\u8bc1\u7cfb\u7edf\u7684\u5b89\u5168\u53ef\u9760\u3002</p> <p>\u672c\u6587\u4e3b\u8981\u8bb2\u8bb2Admission\u4e2dValidatingAdmissionWebhook\u548cMutatingAdmissionWebhook\u3002</p>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#admissionwebhook","title":"\u4e00 AdmissionWebhook\u7b80\u4ecb","text":"<p>\u6211\u4eec\u77e5\u9053k8s\u5728\u5404\u4e2a\u65b9\u9762\u90fd\u5177\u5907\u53ef\u6269\u5c55\u6027\uff0c\u6bd4\u5982\u901a\u8fc7cni\u5b9e\u73b0\u591a\u79cd\u7f51\u7edc\u6a21\u578b\uff0c\u901a\u8fc7csi\u5b9e\u73b0\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u901a\u8fc7cri\u5b9e\u73b0\u591a\u79cd\u5bb9\u5668\u8fd0\u884c\u65f6\u7b49\u7b49\u3002\u800cAdmissionWebhook\u5c31\u662f\u53e6\u5916\u4e00\u79cd\u53ef\u6269\u5c55\u7684\u624b\u6bb5\u3002 \u9664\u4e86\u5df2\u7f16\u8bd1\u7684Admission\u63d2\u4ef6\u5916\uff0c\u53ef\u4ee5\u5f00\u53d1\u81ea\u5df1\u7684Admission\u63d2\u4ef6\u4f5c\u4e3a\u6269\u5c55\uff0c\u5e76\u5728\u8fd0\u884c\u65f6\u914d\u7f6e\u4e3awebhook\u3002</p> <p>Admission webhooks\u662fHTTP\u56de\u8c03\uff0c\u5b83\u63a5\u6536Admission\u8bf7\u6c42\u5e76\u5bf9\u5b83\u4eec\u505a\u4e00\u4e9b\u4e8b\u60c5\u3002\u53ef\u4ee5\u5b9a\u4e49\u4e24\u79cd\u7c7b\u578b\u7684Admission webhook\uff0cValidatingAdmissionWebhook\u548cMutatingAdmissionWebhook\u3002</p> <p>\u5982\u679c\u542f\u7528\u4e86MutatingAdmission\uff0c\u5f53\u5f00\u59cb\u521b\u5efa\u4e00\u79cdk8s\u8d44\u6e90\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u521b\u5efa\u8bf7\u6c42\u4f1a\u53d1\u5230\u4f60\u6240\u7f16\u5199\u7684controller\u4e2d\uff0c\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u505a\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\u3002\u6bd4\u5982\u6211\u4eec\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u4f1a\u7edf\u4e00\u505a\u4e00\u4e9b\u529f\u80fd\u6027\u589e\u5f3a\uff0c\u5f53\u4e1a\u52a1\u5f00\u53d1\u521b\u5efa\u4e86\u65b0\u7684deployment\uff0c\u6211\u4eec\u4f1a\u6267\u884c\u4e00\u4e9b\u6ce8\u5165\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u654f\u611f\u4fe1\u606faksk\uff0c\u6216\u662f\u4e00\u4e9b\u4f18\u5316\u7684init\u811a\u672c\u3002</p> <p>\u800c\u4e0e\u6b64\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7ValidatingAdmissionWebhook \u662f\u6309\u7167\u4f60\u81ea\u5b9a\u4e49\u7684\u903b\u8f91\u662f\u5426\u5141\u8bb8\u8d44\u6e90\u7684\u521b\u5efa\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u5728\u5b9e\u9645\u751f\u4ea7k8s\u96c6\u7fa4\u4e2d\uff0c\u5904\u4e8e\u7a33\u5b9a\u6027\u8003\u8651\uff0c\u6211\u4eec\u8981\u6c42\u521b\u5efa\u7684deployment \u5fc5\u987b\u8bbe\u7f6erequest\u548climit\u3002</p>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#11-admissionwebhook","title":"1.1 \u4ec0\u4e48\u662fAdmissionWebhook","text":"<p>\u4ec0\u4e48\u662fAdmissionWebhook\uff0c\u5c31\u8981\u5148\u4e86\u89e3K8S\u4e2d\u7684admission controller, \u6309\u7167\u5b98\u65b9\u7684\u89e3\u91ca\u662f\uff1a admission controller\u662f\u62e6\u622a(\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1)API Server\u8bf7\u6c42\u7684\u7f51\u5173\uff0c\u5e76\u4e14\u53ef\u4ee5\u4fee\u6539\u8bf7\u6c42\u5bf9\u8c61\u6216\u62d2\u7edd\u8bf7\u6c42\u3002 </p> <p>\u7b80\u800c\u8a00\u4e4b\uff0c\u5b83\u53ef\u4ee5\u8ba4\u4e3a\u662f\u62e6\u622a\u5668\uff0c\u7c7b\u4f3cweb\u6846\u67b6\u4e2d\u7684middleware\u3002</p> <p>K8S\u9ed8\u8ba4\u63d0\u4f9b\u5f88\u591a\u5185\u7f6e\u7684admission controller\uff0c\u901a\u8fc7kube-apiserver\u542f\u52a8\u547d\u4ee4\u53c2\u6570\u53ef\u4ee5 \u67e5\u770b\u5230\u652f\u6301\u7684admission controller plugin\u6709\u54ea\u4e9b\u3002</p> <pre><code>[root@node220]# kube-apiserver --help |grep enable-admission-plugins\n\n# \u652f\u6301\u7684plugin\u6709\u5982\u4e0b\nAlwaysAdmit, AlwaysDeny, AlwaysPullImages, \nDefaultStorageClass, DefaultTolerationSeconds, DenyEscalatingExec, \nDenyExecOnPrivileged, EventRateLimit, ExtendedResourceToleration, \nImagePolicyWebhook, Initializers, LimitPodHardAntiAffinityTopology, \nLimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, \nNamespaceExists, NamespaceLifecycle, NodeRestriction, \nOwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, \nPersistentVolumeLabel, PodNodeSelector, PodPreset, PodSecurityPolicy, \nPodTolerationRestriction, Priority, ResourceQuota, SecurityContextDeny, \nServiceAccount, StorageObjectInUseProtection, ValidatingAdmissionWebhook. \n</code></pre> <p>\u8fd9\u91ccenable\u7684admission-plugins\u5982\u4e0b</p> <pre><code>--enable-admission-plugins=PersistentVolumeClaimResize,NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,NodeRestriction,ValidatingAdmissionWebhook,MutatingAdmissionWebhook \n</code></pre> <p>\u8fd9\u91cc\u4e0d\u5bf9\u6bcf\u4e2aplugin\u8be6\u7ec6\u8bf4\u660e\uff0c\u7f51\u4e0a\u90fd\u53ef\u4ee5\u641c\u5230\u76f8\u5173\u8d44\u6599\u3002 \u603b\u4f53\u6765\u8bf4\uff0cadmission-plugins\u5206\u4e3a\u4e09\u5927\u7c7b\uff1a</p> <p>1.\u4fee\u6539\u7c7b\u578b(mutating)</p> <p>2.\u9a8c\u8bc1\u7c7b\u578b(validating)</p> <p>3.\u65e2\u662f\u4fee\u6539\u53c8\u662f\u9a8c\u8bc1\u7c7b\u578b(mutating&amp;validating)</p> <p>\u8fd9\u4e9badmission plugin\u6784\u6210\u4e00\u4e2a\u987a\u5e8f\u94fe\uff0c\u5148\u540e\u987a\u5e8f\u51b3\u5b9a\u8c01\u5148\u8c03\u7528\uff0c\u4f46\u4e0d\u4f1a\u5f71\u54cd\u4f7f\u7528\u3002</p> <p>\u8fd9\u91cc\u5173\u5fc3\u7684plugin\u6709**\u4e24\u4e2a**\uff1a</p> <ul> <li>MutatingAdmissionWebhook: \u505a\u4fee\u6539\u64cd\u4f5c\u7684AdmissionWebhook </li> <li>ValidatingAdmissionWebhook: \u505a\u9a8c\u8bc1\u64cd\u4f5c\u7684AdmissionWebhook</li> </ul> <p>\u5f15\u7528kubernetes\u5b98\u65b9\u535a\u5ba2\u7684\u4e00\u5f20\u56fe\u6765\u8bf4\u660eMutatingAdmissionWebhook\u548cValidatingAdmissionWebhook\u6240\u5904\u7684\u4f4d\u7f6e:</p> <p></p> <p>\u89e3\u91ca\u4e0b\u8fd9\u4e2a\u8fc7\u7a0b\uff1a</p> <p>1.api\u8bf7\u6c42\u5230\u8fbeK8S API Server</p> <p>2.\u8bf7\u6c42\u8981\u5148\u7ecf\u8fc7\u8ba4\u8bc1</p> <ul> <li>kubectl\u8c03\u7528\u9700\u8981kubeconfig</li> <li>\u76f4\u63a5\u8c03\u7528K8S api\u9700\u8981\u8bc1\u4e66+bearToken</li> <li>client-go\u8c03\u7528\u4e5f\u9700\u8981kubeconfig</li> </ul> <p>3.\u6267\u884c\u4e00\u8fde\u4e32\u7684admission controller\uff0c\u5305\u62ecMutatingAdmissionWebhook\u548cValidatingAdmissionWebhook, \u5148\u4e32\u884c\u6267\u884cMutatingAdmission\u7684Webhook list 4.\u5bf9\u8bf7\u6c42\u5bf9\u8c61\u7684schema\u8fdb\u884c\u6821\u9a8c 5.\u5e76\u884c\u6267\u884cValidatingAdmission\u7684Webhook list 6.\u6700\u540e\u5199\u5165etcd</p>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#12-initializers-vs-admissionwebhook","title":"1.2 Initializers vs AdmissionWebhook\u533a\u522b","text":"<p>\u4e8c\u8005\u90fd\u80fd\u5b9e\u73b0\u52a8\u6001\u53ef\u6269\u5c55\u8f7d\u5165admission controller\uff0c Initializers\u662f\u4e32\u884c\u6267\u884c\uff0c\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u5bb9\u6613\u5bfc\u81f4\u5bf9\u8c61\u505c\u7559\u5728uninitialized\u72b6\u6001\uff0c\u5f71\u54cd\u7ee7\u7eed\u8c03\u5ea6\u3002 Alpha Initializers\u7279\u6027\u5728k8s 1.14\u7248\u672c\u88ab\u79fb\u9664\u4e86\uff0c\u8be6\u60c5\u89c1https://github.com/kubernetes/apimachinery/issues/60\u3002 \u76f8\u6bd4Initializers\uff0c\u5b98\u65b9\u66f4\u63a8\u8350AdmissionWebhook\uff1bMutatingAdmissionWebhook\u662f\u4e32\u884c\u6267\u884c\uff0cValidatingAdmissionWebhook\u662f\u5e76\u884c\u6267\u884c\uff0c\u6027\u80fd\u66f4\u597d\u3002</p>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#admissionwebhook_1","title":"\u4e8c AdmissionWebhook\u5e94\u7528\u573a\u666f","text":"<p>Istio\u76f8\u4fe1\u5927\u5bb6\u90fd\u6709\u542c\u8fc7\uff0cIstio\u5c31\u662f\u91c7\u7528AdmissionWebhook\u5b9e\u73b0sidecar\u5bb9\u5668\u81ea\u52a8\u6ce8\u5165\u3002\u6211\u76ee\u524d\u7528\u5230\u7684\u5e94\u7528\u573a\u666f\u6709\u4e24\u4e2a\uff0c\u5f53\u7136\u80af\u5b9a\u8fd8\u6709\u5176\u5b83\u5e94\u7528\u573a\u666f\u3002</p> <ul> <li>\u81ea\u52a8\u6253\u6807\u7b7e \u6bd4\u5982\u542f\u52a8\u4e00\u4e2a\u5e94\u7528\uff0c\u5e94\u7528\u5305\u62ecdeployment\u3001service\u3001ingress\uff1b \u600e\u4e48\u5feb\u901f\u8fc7\u6ee4\u51fa\u54ea\u4e9b\u8d44\u6e90\u5c5e\u4e8e\u5e94\u7528? \u5728K8S\u4e2d\uff0cpod\u3001service\u3001ingress \u90fd\u662f\u72ec\u7acb\u7684\u8d44\u6e90\uff0c\u901a\u8fc7\u7ed9\u8fd9\u4e9b\u8d44\u6e90\u6253\u4e0alabel\uff0c\u662f\u6700\u5feb\u901f\u7684\u65b9\u5f0f\u3002</li> <li>\u81ea\u52a8\u6ce8\u5165sidecar\u5bb9\u5668 \u5e94\u7528\u542f\u52a8\u540e\uff0c\u5e94\u7528\u7684\u76d1\u63a7\u3001\u65e5\u5fd7\u5982\u4f55\u5904\u7406\uff1f\u501f\u52a9sidecar\u5bb9\u5668\u6ce8\u5165\u5230\u5176pod\u4e2d</li> </ul> <p>\u6536\u96c6\u5e94\u7528\u65e5\u5fd7\u7684sidecar\u5bb9\u5668\u53ef\u4ee5\u50cf\u4e0b\u56fe\u6240\u793a\uff0c\u5e94\u7528\u76d1\u63a7\u7684sidecar\u5bb9\u5668\u7c7b\u4f3c</p> <p></p>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#admissionwebhook_2","title":"\u5b9e\u6218\u5f00\u53d1admissionwebhook","text":""},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#_2","title":"\u524d\u63d0\u6761\u4ef6","text":"<ul> <li>k8s\u7248\u672c\u9700\u81f3\u5c11v1.9</li> <li>\u786e\u4fdd\u542f\u7528\u4e86 MutatingAdmissionWebhook and ValidatingAdmissionWebhook admission controllers</li> <li>\u786e\u5b9a \u542f\u7528\u4e86http://admissionregistration.k8s.io/v1beta1</li> </ul>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#admission-webhook-server","title":"\u5199\u4e00\u4e2a admission webhook server","text":"<p>\u5b98\u65b9\u63d0\u4f9b\u4e86\u6709\u4e2ademo\u3002\u5927\u5bb6\u53ef\u4ee5\u8be6\u7ec6\u7814\u7a76\uff0c\u6838\u5fc3\u601d\u60f3\u5c31\u662f\uff1a webhook\u5904\u7406apiservers\u53d1\u9001\u7684AdmissionReview\u8bf7\u6c42\uff0c\u5e76\u5c06\u5176\u51b3\u5b9a\u4f5c\u4e3aAdmissionReview\u5bf9\u8c61\u53d1\u9001\u56de\u53bb\u3002</p> <pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"flag\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n\n    \"k8s.io/api/admission/v1beta1\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    \"k8s.io/klog\"\n    // TODO: try this library to see if it generates correct json patch\n    // https://github.com/mattbaird/jsonpatch\n)\n\n// toAdmissionResponse is a helper function to create an AdmissionResponse\n// with an embedded error\nfunc toAdmissionResponse(err error) *v1beta1.AdmissionResponse {\n    return &amp;v1beta1.AdmissionResponse{\n        Result: &amp;metav1.Status{\n            Message: err.Error(),\n        },\n    }\n}\n\n// admitFunc is the type we use for all of our validators and mutators\ntype admitFunc func(v1beta1.AdmissionReview) *v1beta1.AdmissionResponse\n\n// serve handles the http portion of a request prior to handing to an admit\n// function\nfunc serve(w http.ResponseWriter, r *http.Request, admit admitFunc) {\n    var body []byte\n    if r.Body != nil {\n        if data, err := ioutil.ReadAll(r.Body); err == nil {\n            body = data\n        }\n    }\n\n    // verify the content type is accurate\n    contentType := r.Header.Get(\"Content-Type\")\n    if contentType != \"application/json\" {\n        klog.Errorf(\"contentType=%s, expect application/json\", contentType)\n        return\n    }\n\n    klog.V(2).Info(fmt.Sprintf(\"handling request: %s\", body))\n\n    // The AdmissionReview that was sent to the webhook\n    requestedAdmissionReview := v1beta1.AdmissionReview{}\n\n    // The AdmissionReview that will be returned\n    responseAdmissionReview := v1beta1.AdmissionReview{}\n\n    deserializer := codecs.UniversalDeserializer()\n    if _, _, err := deserializer.Decode(body, nil, &amp;requestedAdmissionReview); err != nil {\n        klog.Error(err)\n        responseAdmissionReview.Response = toAdmissionResponse(err)\n    } else {\n        // pass to admitFunc\n        responseAdmissionReview.Response = admit(requestedAdmissionReview)\n    }\n\n    // Return the same UID\n    responseAdmissionReview.Response.UID = requestedAdmissionReview.Request.UID\n\n    klog.V(2).Info(fmt.Sprintf(\"sending response: %v\", responseAdmissionReview.Response))\n\n    respBytes, err := json.Marshal(responseAdmissionReview)\n    if err != nil {\n        klog.Error(err)\n    }\n    if _, err := w.Write(respBytes); err != nil {\n        klog.Error(err)\n    }\n}\n\nfunc serveAlwaysDeny(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, alwaysDeny)\n}\n\nfunc serveAddLabel(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, addLabel)\n}\n\nfunc servePods(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, admitPods)\n}\n\nfunc serveAttachingPods(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, denySpecificAttachment)\n}\n\nfunc serveMutatePods(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, mutatePods)\n}\n\nfunc serveConfigmaps(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, admitConfigMaps)\n}\n\nfunc serveMutateConfigmaps(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, mutateConfigmaps)\n}\n\nfunc serveCustomResource(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, admitCustomResource)\n}\n\nfunc serveMutateCustomResource(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, mutateCustomResource)\n}\n\nfunc serveCRD(w http.ResponseWriter, r *http.Request) {\n    serve(w, r, admitCRD)\n}\n\nfunc main() {\n    var config Config\n    config.addFlags()\n    flag.Parse()\n\n    http.HandleFunc(\"/always-deny\", serveAlwaysDeny)\n    http.HandleFunc(\"/add-label\", serveAddLabel)\n    http.HandleFunc(\"/pods\", servePods)\n    http.HandleFunc(\"/pods/attach\", serveAttachingPods)\n    http.HandleFunc(\"/mutating-pods\", serveMutatePods)\n    http.HandleFunc(\"/configmaps\", serveConfigmaps)\n    http.HandleFunc(\"/mutating-configmaps\", serveMutateConfigmaps)\n    http.HandleFunc(\"/custom-resource\", serveCustomResource)\n    http.HandleFunc(\"/mutating-custom-resource\", serveMutateCustomResource)\n    http.HandleFunc(\"/crd\", serveCRD)\n    server := &amp;http.Server{\n        Addr:      \":443\",\n        TLSConfig: configTLS(config),\n    }\n    server.ListenAndServeTLS(\"\", \"\")\n}\n</code></pre>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#admission-webhooks","title":"\u52a8\u6001\u914d\u7f6eadmission webhooks","text":"<p>\u60a8\u53ef\u4ee5\u901a\u8fc7ValidatingWebhookConfiguration\u6216MutatingWebhookConfiguration\u52a8\u6001\u914d\u7f6e\u54ea\u4e9b\u8d44\u6e90\u53d7\u5165\u53e3webhooks\u7684\u9650\u5236\u3002</p> <p>\u5177\u4f53\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: admissionregistration.k8s.io/v1beta1\nkind: ValidatingWebhookConfiguration\nmetadata:\n  name: &lt;name of this configuration object&gt;\nwebhooks:\n- name: &lt;webhook name, e.g., pod-policy.example.io&gt;\n  rules:\n  - apiGroups:\n    - \"\"\n    apiVersions:\n    - v1\n    operations:\n    - CREATE\n    resources:\n    - pods\n    scope: \"Namespaced\"\n  clientConfig:\n    service:\n      namespace: &lt;namespace of the front-end service&gt;\n      name: &lt;name of the front-end service&gt;\n    caBundle: &lt;pem encoded ca cert that signs the server cert used by the webhook&gt;\n  admissionReviewVersions:\n  - v1beta1\n  timeoutSeconds: 1\n</code></pre>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#_3","title":"\u603b\u7ed3","text":"<p>\u6700\u540e\u6211\u4eec\u6765\u603b\u7ed3\u4e0b webhook Admission \u7684\u4f18\u52bf\uff1a</p> <ul> <li>webhook \u53ef\u52a8\u6001\u6269\u5c55 Admission \u80fd\u529b\uff0c\u6ee1\u8db3\u81ea\u5b9a\u4e49\u5ba2\u6237\u7684\u9700\u6c42</li> <li>\u4e0d\u9700\u8981\u91cd\u542f API Server\uff0c\u53ef\u901a\u8fc7\u521b\u5efa webhook configuration \u70ed\u52a0\u8f7d webhook admission</li> </ul>"},{"location":"cloud-native/develop/Kubernetes%20AdmissionWebhook/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://banzaicloud.com/blog/k8s-admission-webhooks/</li> <li>https://cloud.tencent.com/developer/article/1445760</li> <li>https://github.com/kubernetes/kubernetes/blob/v1.13.0/test/images/webhook/main.go</li> <li>https://zhuanlan.zhihu.com/p/136173524</li> </ul>"},{"location":"cloud-native/develop/x-DeltaFIFO%E5%92%8Cindexer%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94/","title":"x-DeltaFIFO \u4e0e Indexer\u5173\u7cfb","text":""},{"location":"cloud-native/develop/x-DeltaFIFO%E5%92%8Cindexer%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u5728\u521a\u5f00\u59cb\u770bDeltaFIFO\u7684\u65f6\u5019\uff0c\u4e0d\u592a\u6e05\u695a\u5177\u4f53\u7684\u6570\u636e\u5b58\u50a8\u5728\u54ea\u91cc\uff0c\u5177\u4f53\u6570\u636e\u6d41\u5411\u4f55\u5904\uff0c\u672c\u6587\u901a\u8fc7\u7a0b\u5e8fdebug\u53ef\u4ee5\u66f4\u76f4\u89c2\u7684\u770b\u51faDeltaFIFO\u4e2d\u7684\u5c5e\u6027\u4e0eIndexer\u5173\u7cfb\u3002</p>"},{"location":"cloud-native/develop/x-DeltaFIFO%E5%92%8Cindexer%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94/#deltafifo","title":"\u4e8c DeltaFIFO\u6570\u636e\u7ed3\u6784","text":"<pre><code>type DeltaFIFO struct {\n    // lock/cond protects access to 'items' and 'queue'.\n    lock sync.RWMutex\n    cond sync.Cond\n\n    // `items` maps a key to a Deltas.\n    // Each such Deltas has at least one Delta.\n    items map[string]Deltas\n\n    // `queue` maintains FIFO order of keys for consumption in Pop().\n    // There are no duplicates in `queue`.\n    // A key is in `queue` if and only if it is in `items`.\n    queue []string\n\n    // populated is true if the first batch of items inserted by Replace() has been populated\n    // or Delete/Add/Update/AddIfNotPresent was called first.\n    populated bool\n    // initialPopulationCount is the number of items inserted by the first call of Replace()\n    initialPopulationCount int\n\n    // keyFunc is used to make the key used for queued item\n    // insertion and retrieval, and should be deterministic.\n    keyFunc KeyFunc\n\n    // knownObjects list keys that are \"known\" --- affecting Delete(),\n    // Replace(), and Resync()\n    knownObjects KeyListerGetter\n\n    // Used to indicate a queue is closed so a control loop can exit when a queue is empty.\n    // Currently, not used to gate any of CRED operations.\n    closed bool\n\n    // emitDeltaTypeReplaced is whether to emit the Replaced or Sync\n    // DeltaType when Replace() is called (to preserve backwards compat).\n    emitDeltaTypeReplaced bool\n}\n\n// state of the object before it was deleted.\ntype Delta struct {\n    Type   DeltaType\n    Object interface{}\n}\n\n// Deltas is a list of one or more 'Delta's to an individual object.\n// The oldest delta is at index 0, the newest delta is the last one.\ntype Deltas []Delta\n</code></pre> <p>DeltaFIFO\u4e2d\u5b58\u50a8\u7684\u5185\u5bb9</p> <p>key\uff1a\u662f\u901a\u8fc7keyFunc\u8ba1\u7b97\u83b7\u53d6\u7684\uff0c\u9ed8\u8ba4\u4f7f\u7528cache.MetaNamespaceKeyFunc\u6765\u83b7\u53d6\uff0c\u4e3anamespace/resourcename\uff0c\u4f8b\u5982\u4e0b\u56fe\u4e2d\u7684default/etcd-2</p> <p>value\uff1a\u662f\u5177\u4f53\u7684\u5bf9\u8c61Deltas\u5207\u7247\uff0c\u5185\u90e8\u5305\u542bType\u548cObject\uff0c\u5176\u4e2dType\u4e3aDeltaType\uff0c\u4e3a\u5173\u6ce8\u8d44\u6e90\u7684\u64cd\u4f5c\u7c7b\u578b\u3002</p> <p>object\u4e3a\u5177\u4f53\u5bf9\u8c61\u7684\u5728k8s\u8d44\u6e90\u4e2d\u7684\u5143\u6570\u636e\u3002</p> <p></p>"},{"location":"cloud-native/develop/x-DeltaFIFO%E5%92%8Cindexer%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94/#indexer","title":"\u4e09 Indexer\u6570\u636e\u7ed3\u6784\u56fe","text":"<pre><code>type cache struct {\n    // cacheStorage bears the burden of thread safety for the cache\n    cacheStorage ThreadSafeStore\n    // keyFunc is used to make the key for objects stored in and retrieved from items, and\n    // should be deterministic.\n    keyFunc KeyFunc\n}\n\n// threadSafeMap implements ThreadSafeStore\ntype threadSafeMap struct {\n    lock  sync.RWMutex\n    items map[string]interface{}\n\n    // indexers maps a name to an IndexFunc\n    indexers Indexers\n    // indices maps a name to an Index\n    indices Indices\n}\n</code></pre> <p>Indexer\u4e3aDeltaFIFO\u4e2d\u7684knownObjects\uff0c\u5305\u542bkeyFunc\u548ccacheStorage</p> <p></p>"},{"location":"cloud-native/develop/x-DeltaFIFO%E5%92%8Cindexer%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94/#_2","title":"\u56db \u5bf9\u6bd4","text":"<p>\u53ef\u4ee5\u5bf9\u6bd4\u6765\u770b\uff0c\u5728DeltaFIFO\u4e2d\u7684item\u7684value\u4e2d\u662f\u4e00\u4e2adeltas\u5207\u7247\uff0c\u5185\u90e8\u7684\u503c\u5305\u542btype\u548c\u5177\u4f53\u7684object\u5bf9\u8c61</p> <p>indexer\u4e2ditem\u7684\u503c\u76f4\u63a5\u662f\u5bf9\u8c61\u672c\u8eab\u3002</p>"},{"location":"cloud-native/develop/x-DeltaFIFO%E5%92%8Cindexer%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94/#_3","title":"\u603b\u7ed3","text":"<p>DeltaFIFO\u4e2d\u7684Item\u5b58\u50a8\u4e86\u5177\u4f53\u7684\u5143\u7d20\uff0c\u4e3a\u4e86\u540e\u671f\u4fbf\u4e8e\u7d22\u5f15\uff0c\u5728\u5185\u90e8\u8fd8\u5305\u542b\u4e86\u4e00\u4e2aknownObjects\uff0c\u5176\u5185\u90e8\u540c\u6837\u5b58\u50a8\u4e86\u4e00\u4efd\u6570\u636e\uff0cdeltaFIFO\u6700\u540ePop\u51fa\u6765\u6570\u636e\u540e\u6dfb\u52a0\u81f3indexer\u4e2d\uff0c\u548c\u8c03\u7528\u7528\u6237\u6ce8\u518c\u7684resourceEventHandler\u3002</p>"},{"location":"cloud-native/develop/x-Informer%E5%AE%9E%E6%88%98%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96K8s%E4%BA%8B%E4%BB%B6%E8%87%B3ElasticSearch/","title":"x-Informer\u5b9e\u6218\u4e4b\u6301\u4e45\u5316K8s\u4e8b\u4ef6\u81f3ElasticSearch","text":""},{"location":"cloud-native/develop/x-Informer%E5%AE%9E%E6%88%98%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96K8s%E4%BA%8B%E4%BB%B6%E8%87%B3ElasticSearch/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u5728\u7cfb\u5217\u6587\u7ae0\u4e2d\u8be6\u7ec6\u8bb2\u89e3\u4e86Informer\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u672c\u5c4a\u756a\u5916\u83b7\u53d6K8s\u7684\u4e8b\u4ef6\uff0c\u5c06\u5176\u5b58\u50a8\u5230Elasticsearch\uff0c\u53ef\u4ee5\u5229\u7528inforrmer\u673a\u5236\u56de\u53bb\u5230\u5e94\u7528\u7684\u65f6\u95f4\u8fdb\u884c\u5916\u90e8\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u6216\u8005\u8fdb\u884c\u8fc7\u6ee4\u5206\u7c7b\u5c55\u793a\uff0c\u6216\u8fdb\u884c\u6570\u636e\u5e94\u7528\u5206\u6790\u544a\u8b66\u7b49\u3002</p>"},{"location":"cloud-native/develop/x-Informer%E5%AE%9E%E6%88%98%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96K8s%E4%BA%8B%E4%BB%B6%E8%87%B3ElasticSearch/#es","title":"\u4e8c ES\u90e8\u7f72","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5\u7b80\u5355\uff0c\u91c7\u7528Docker\u542f\u52a8es\u3002</p> <pre><code>docker run --name es01 -d -p 9200:9200 -p 9300:9300 -e \"discovery.type=single-node\" -e  \"ES_JAVA_OPTS=-Xms512m -Xmx512m\" elasticsearch:latest\n\n# \u4f7f\u7528head\u5ba2\u6237\u7aef\u94fe\u63a5\ndocker pull mobz/elasticsearch-head:5\n# \u542f\u52a8header \u5bb9\u5668\ndocker run -d --name my-es_admin -p 9100:9100 mobz/elasticsearch-head:5\n</code></pre> <p>\u542f\u52a8\u540e\uff0ces\u6b63\u5e38\uff0c\u4e3a\u4e86\u66f4\u65b9\u4fbf\u64cd\u4f5ces\uff0c\u4f7f\u7528head\u63d2\u4ef6\u6765\uff0c\u63d2\u4ef6\u94fe\u63a5\u5f02\u5e38\uff0c\u9700\u8981\u4fee\u6539es\u914d\u7f6e\uff0c\u5e76\u91cd\u542f\u5bb9\u5668</p> <p></p> <pre><code># \u8fdb\u5165\u5bb9\u5668\n$ docker exec -it es01 /bin/bash\n\n# \u8fdb\u5165\u5bb9\u5668\u540e\u8bbe\u7f6e\u53c2\u6570\n# http.cors.enabled: true\n# http.cors.allow-origin: \"*\"\necho 'http.cors.enabled: true' &gt;&gt; config/elasticsearch.yml\necho 'http.cors.allow-origin: \"*\"' &gt;&gt; config/elasticsearch.yml\n# \u8bbe\u7f6e\u5b8c\u6210\uff0c\u9000\u51fa\u540e\u91cd\u542f\u5bb9\u5668\ndocker restart es01\n</code></pre> <p>\u4fee\u6539\u914d\u7f6e\u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7head\u7ec4\u4ef6\u6b63\u5e38\u94fe\u63a5es\u96c6\u7fa4</p> <p></p> <p>\u521b\u5efa\u7d22\u5f15\uff1a</p> <p></p>"},{"location":"cloud-native/develop/x-Informer%E5%AE%9E%E6%88%98%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96K8s%E4%BA%8B%E4%BB%B6%E8%87%B3ElasticSearch/#_2","title":"\u4e09 \u4ee3\u7801","text":"<pre><code>var client *elastic.Client\nvar host = \"http://127.0.0.1:9200/\"\n\n//\u521d\u59cb\u5316\nfunc init() {\n    errorlog := log.New(os.Stdout, \"APP\", log.LstdFlags)\n    var err error\n    // \u8fd9\u4e2a\u5730\u65b9\u6709\u4e2a\u5c0f\u5751 \u4e0d\u52a0\u4e0aelastic.SetSniff(false) \u4f1a\u8fde\u63a5\u4e0d\u4e0a\n    client, err = elastic.NewClient(elastic.SetSniff(false), elastic.SetErrorLog(errorlog), elastic.SetURL(host))\n    if err != nil {\n        panic(err)\n    }\n    info, code, err := client.Ping(host).Do(context.Background())\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"Elasticsearch returned with code %d and version %s\\n\", code, info.Version.Number)\n\n    esversion, err := client.ElasticsearchVersion(host)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"Elasticsearch version %s\\n\", esversion)\n\n}\n\nfunc Must(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n\nfunc main() {\n    rand.Seed(time.Now().UnixNano())\n    config, err := clientcmd.BuildConfigFromFlags(\"\", \"/Users/xuel/.kube/config\")\n    Must(err)\n\n    clientset, err := kubernetes.NewForConfig(config)\n    Must(err)\n    sharedInformers := informers.NewSharedInformerFactory(clientset, 0)\n    stopChan := make(chan struct{})\n    defer close(stopChan)\n\n  // \u5728\u6b64\u4f7f\u7528event informer\uff0c\n    eventInformer := sharedInformers.Events().V1beta1().Events().Informer()\n    addChan := make(chan v1beta1.Event)\n    deleteChan := make(chan v1beta1.Event)\n    eventInformer.AddEventHandlerWithResyncPeriod(cache.ResourceEventHandlerFuncs{\n        AddFunc: func(obj interface{}) {\n            unstructObj, err := runtime.DefaultUnstructuredConverter.ToUnstructured(obj)\n            Must(err)\n            event := &amp;v1beta1.Event{}\n            err = runtime.DefaultUnstructuredConverter.FromUnstructured(unstructObj, event)\n            Must(err)\n            addChan &lt;- *event\n        },\n        UpdateFunc: func(oldObj, newObj interface{}) {\n        },\n        DeleteFunc: func(obj interface{}) {\n        },\n    }, 0)\n\n    go func() {\n        for {\n            select {\n            case event := &lt;-addChan:\n                str, err := json.Marshal(&amp;event)\n                Must(err)\n                fmt.Printf(\"\u63d2\u5165k8s\u4e8b\u4ef6\u5185\u5bb9\uff1a%s\", string(str))\n                esinsert(str)\n                break\n            case &lt;-deleteChan:\n                break\n            }\n        }\n    }()\n    eventInformer.Run(stopChan)\n}\n\nfunc esinsert(str []byte) {\n    index := \"k8s_informer\"\n    dbtype := \"doc\"\n\n    put1, err := client.Index().\n        Index(index).\n        Type(dbtype).\n        Id(\"1\").BodyString(string(str)).\n        Do(context.Background())\n    if err != nil {\n        fmt.Println(\"Insert es error: %s\", err)\n    }\n    fmt.Println(\"insert success\", put1)\n}\n</code></pre>"},{"location":"cloud-native/develop/x-Informer%E5%AE%9E%E6%88%98%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96K8s%E4%BA%8B%E4%BB%B6%E8%87%B3ElasticSearch/#_3","title":"\u56db \u6d4b\u8bd5","text":"<p>\u63d2\u5165\u6570\u636e\u540e\u4f7f\u7528es\u67e5\u8be2\uff1a</p> <p></p> <pre><code>curl  -H \"Content-Type: application/json\" -XGET 'http://127.0.0.1:9200/k8s_informer/doc/_search?pretty' -d '{\"query\":{\"match_all\":{}}}'\n</code></pre> <p></p> <p>\u89e6\u53d1k8s\u4e8b\u4ef6\uff0c\u4f1a\u81ea\u52a8\u8bb0\u5f55\u4e0b\u6765</p> <p></p>"},{"location":"cloud-native/develop/x-Informer%E5%AE%9E%E6%88%98%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96K8s%E4%BA%8B%E4%BB%B6%E8%87%B3ElasticSearch/#_4","title":"\u5176\u4ed6","text":"<p>\u53ef\u4ee5\u5229\u7528inforrmer\u673a\u5236\u56de\u53bb\u5230\u5e94\u7528\u7684\u65f6\u95f4\u8fdb\u884c\u5916\u90e8\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u6216\u8005\u8fdb\u884c\u8fc7\u6ee4\u5206\u7c7b\u8fdb\u884c\u56fe\u50cf\u8bdd\u5c55\u793a\uff0c\u6216\u8fdb\u884c\u6570\u636e\u5e94\u7528\u5206\u6790\u544a\u8b66\u7b49\u3002</p> <p>\u5728\u672c\u793a\u4f8b\u4e2d\u4ec5\u4ec5\u4f7f\u7528\u4e86event \u4e8b\u4ef6\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u4e8b\u4ef6\uff0c\u4e14\u4ec5\u5173\u6ce8\u4e86addfunc\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5173\u6ce8update/delete\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/","title":"Ceph\u673a\u5668\u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#ceph_1","title":"\u4e00 Ceph\u673a\u5668\u6982\u8ff0","text":""},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#11","title":"1.1 \u6982\u8ff0","text":"<p>\u8fd1\u671f\u8fdb\u884c\u4e1a\u52a1\u5bb9\u5668\u540e\u6539\u9020\uff0c\u90e8\u7f72K8S\u9700\u8981\u4e3a\u5176\u63d0\u4f9b\u5b58\u50a8\uff0c\uff0c\u5728\u9009\u578b\u4e2d\u672c\u5730\u5b58\u50a8\u4e0d\u53ef\u8de8node\uff0cNFS\u5171\u4eab\u5b58\u50a8\u4e0d\u597d\u505a\u9ad8\u53ef\u7528\uff0c\u56e0\u6b64\u9009\u578bCeph\u6765\u4e3ak8s\u63d0\u4f9b\u5b58\u50a8\u7c7b\uff0c\u4ee5\u5907\u540e\u7528 Ceph\u662f\u4e00\u79cd\u4e3a\u4f18\u79c0\u7684\u6027\u80fd\u3001\u53ef\u9760\u6027\u548c\u53ef\u6269\u5c55\u6027\u800c\u8bbe\u8ba1\u7684\u7edf\u4e00\u7684\u3001\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002Ceph\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002\u56e0\u4e3a\u5b83\u8fd8\u652f\u6301\u5757\u5b58\u50a8\u3001\u5bf9\u8c61\u5b58\u50a8\uff0c\u6240\u4ee5\u5f88\u81ea\u7136\u7684\u88ab\u7528\u505a\u4e91\u8ba1\u7b97\u6846\u67b6openstack\u6216cloudstack\u6574\u4e2a\u5b58\u50a8\u540e\u7aef\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u5355\u72ec\u4f5c\u4e3a\u5b58\u50a8\uff0c\u4f8b\u5982\u90e8\u7f72\u4e00\u5957\u96c6\u7fa4\u4f5c\u4e3a\u5bf9\u8c61\u5b58\u50a8\u3001SAN\u5b58\u50a8\u3001NAS\u5b58\u50a8\u7b49\u3002\u53ef\u4ee5\u4f5c\u4e3ak8s\u7684\u5b58\u50a8\u7c7b\uff0c\u6765\u65b9\u4fbf\u5bb9\u5668\u6301\u4e45\u5316\u5b58\u50a8\u3002</p>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#12","title":"1.2 \u652f\u6301\u683c\u5f0f","text":"<ul> <li> <p>\u5bf9\u8c61\u5b58\u50a8\uff1a\u5373radosgw,\u517c\u5bb9S3\u63a5\u53e3\u3002\u901a\u8fc7rest api\u4e0a\u4f20\u3001\u4e0b\u8f7d\u6587\u4ef6\u3002</p> </li> <li> <p>\u6587\u4ef6\u7cfb\u7edf\uff1aposix\u63a5\u53e3\u3002\u53ef\u4ee5\u5c06ceph\u96c6\u7fa4\u770b\u505a\u4e00\u4e2a\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u5230\u672c\u5730\u3002</p> </li> <li> <p>\u5757\u5b58\u50a8\uff1a\u5373rbd\u3002\u6709kernel rbd\u548clibrbd\u4e24\u79cd\u4f7f\u7528\u65b9\u5f0f\u3002\u652f\u6301\u5feb\u7167\u3001\u514b\u9686\u3002\u76f8\u5f53\u4e8e\u4e00\u5757\u786c\u76d8\u6302\u5230\u672c\u5730\uff0c\u7528\u6cd5\u548c\u7528\u9014\u548c\u786c\u76d8\u4e00\u6837\u3002\u6bd4\u5982\u5728OpenStack\u9879\u76ee\u91cc\uff0cCeph\u7684\u5757\u8bbe\u5907\u5b58\u50a8\u53ef\u4ee5\u5bf9\u63a5OpenStack\u7684\u540e\u7aef\u5b58\u50a8</p> </li> </ul>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#13","title":"1.3 \u4f18\u52bf","text":"<ul> <li> <p>\u7edf\u4e00\u5b58\u50a8\uff1a\u867d\u7136ceph\u5e95\u5c42\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f46\u7531\u4e8e\u5728\u4e0a\u5c42\u5f00\u53d1\u4e86\u652f\u6301\u5bf9\u8c61\u548c\u5757\u7684\u63a5\u53e3</p> </li> <li> <p>\u9ad8\u6269\u5c55\u6027\uff1a\u6269\u5bb9\u65b9\u4fbf\u3001\u5bb9\u91cf\u5927\u3002\u80fd\u591f\u7ba1\u7406\u4e0a\u5343\u53f0\u670d\u52a1\u5668\u3001EB\u7ea7\u7684\u5bb9\u91cf\u3002</p> </li> <li> <p>\u9ad8\u53ef\u9760\u6027\uff1a\u652f\u6301\u591a\u4efd\u5f3a\u4e00\u81f4\u6027\u526f\u672c\uff0cEC\u3002\u526f\u672c\u80fd\u591f\u57ae\u4e3b\u673a\u3001\u673a\u67b6\u3001\u673a\u623f\u3001\u6570\u636e\u4e2d\u5fc3\u5b58\u653e\u3002\u6240\u4ee5\u5b89\u5168\u53ef\u9760\u3002\u5b58\u50a8\u8282\u70b9\u53ef\u4ee5\u81ea\u7ba1\u7406\u3001\u81ea\u52a8\u4fee\u590d\u3002\u65e0\u5355\u70b9\u6545\u969c\uff0c\u5bb9\u9519\u6027\u5f3a\u3002</p> </li> <li> <p>\u9ad8\u6027\u80fd\uff1a\u56e0\u4e3a\u662f\u591a\u4e2a\u526f\u672c\uff0c\u56e0\u6b64\u5728\u8bfb\u5199\u64cd\u4f5c\u65f6\u5019\u80fd\u591f\u505a\u5230\u9ad8\u5ea6\u5e76\u884c\u5316\u3002\u7406\u8bba\u4e0a\uff0c\u8282\u70b9\u8d8a\u591a\uff0c\u6574\u4e2a\u96c6\u7fa4\u7684IOPS\u548c\u541e\u5410\u91cf\u8d8a\u9ad8\u3002\u53e6\u5916\u4e00\u70b9ceph\u5ba2\u6237\u7aef\u8bfb\u5199\u6570\u636e\u76f4\u63a5\u4e0e\u5b58\u50a8\u8bbe\u5907(osd) \u4ea4\u4e92\u3002</p> </li> </ul>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#14","title":"1.4 \u6838\u5fc3\u7ec4\u4ef6","text":"<ul> <li> <p>Ceph OSDs:Ceph OSD \u5b88\u62a4\u8fdb\u7a0b\uff08 Ceph OSD \uff09\u7684\u529f\u80fd\u662f\u5b58\u50a8\u6570\u636e\uff0c\u5904\u7406\u6570\u636e\u7684\u590d\u5236\u3001\u6062\u590d\u3001\u56de\u586b\u3001\u518d\u5747\u8861\uff0c\u5e76\u901a\u8fc7\u68c0\u67e5\u5176\u4ed6OSD \u5b88\u62a4\u8fdb\u7a0b\u7684\u5fc3\u8df3\u6765\u5411 Ceph Monitors \u63d0\u4f9b\u4e00\u4e9b\u76d1\u63a7\u4fe1\u606f\u3002\u5f53 Ceph \u5b58\u50a8\u96c6\u7fa4\u8bbe\u5b9a\u4e3a\u67092\u4e2a\u526f\u672c\u65f6\uff0c\u81f3\u5c11\u9700\u89812\u4e2a OSD \u5b88\u62a4\u8fdb\u7a0b\uff0c\u96c6\u7fa4\u624d\u80fd\u8fbe\u5230 active+clean \u72b6\u6001\uff08 Ceph \u9ed8\u8ba4\u67093\u4e2a\u526f\u672c\uff0c\u4f46\u4f60\u53ef\u4ee5\u8c03\u6574\u526f\u672c\u6570\uff09\u3002</p> </li> <li> <p>Monitors:  Ceph Monitor\u7ef4\u62a4\u7740\u5c55\u793a\u96c6\u7fa4\u72b6\u6001\u7684\u5404\u79cd\u56fe\u8868\uff0c\u5305\u62ec\u76d1\u89c6\u5668\u56fe\u3001 OSD \u56fe\u3001\u5f52\u7f6e\u7ec4\uff08 PG \uff09\u56fe\u3001\u548c CRUSH \u56fe\u3002 Ceph \u4fdd\u5b58\u7740\u53d1\u751f\u5728Monitors \u3001 OSD \u548c PG\u4e0a\u7684\u6bcf\u4e00\u6b21\u72b6\u6001\u53d8\u66f4\u7684\u5386\u53f2\u4fe1\u606f\uff08\u79f0\u4e3a epoch \uff09\u3002</p> </li> <li> <p>MDSs:  Ceph \u5143\u6570\u636e\u670d\u52a1\u5668\uff08 MDS \uff09\u4e3a Ceph \u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u5143\u6570\u636e\uff08\u4e5f\u5c31\u662f\u8bf4\uff0cCeph \u5757\u8bbe\u5907\u548c Ceph \u5bf9\u8c61\u5b58\u50a8\u4e0d\u4f7f\u7528MDS \uff09\u3002\u5143\u6570\u636e\u670d\u52a1\u5668\u4f7f\u5f97 POSIX \u6587\u4ef6\u7cfb\u7edf\u7684\u7528\u6237\u4eec\uff0c\u53ef\u4ee5\u5728\u4e0d\u5bf9 Ceph \u5b58\u50a8\u96c6\u7fa4\u9020\u6210\u8d1f\u62c5\u7684\u524d\u63d0\u4e0b\uff0c\u6267\u884c\u8bf8\u5982 ls\u3001find \u7b49\u57fa\u672c\u547d\u4ee4\u3002</p> </li> </ul>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#_1","title":"\u4e8c \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#21","title":"2.1 \u4e3b\u673a\u4fe1\u606f","text":"\u4e3b\u673a\u540d \u64cd\u4f5c\u7cfb\u7edf \u914d\u7f6e K8S\u7ec4\u4ef6 CEPH\u7ec4\u4ef6 \u79c1\u7f51IP SSH\u7aef\u53e3 \u7528\u6237\u540d\u5bc6\u7801 master CentOS 7.4 64bit 4C8G + 500G\u786c\u76d8 admin,osd, mon 172.16.60.2 2001/22 root/uWWKWnjySO7Zocuh node01 CentOS 7.4 64bit 4C8G + 500G\u786c\u76d8 osd, mon 172.16.60.3 2002/22 root/IZ5lReaUBz3QOkLh node02 CentOS 7.4 64bit 4C8G + 500G\u786c\u76d8 osd, mon 172.16.60.4 2003/22 root/nUMFlg9a4zpzDMcE"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#22","title":"2.2 \u78c1\u76d8\u51c6\u5907","text":"<p>\u9700\u8981\u5728\u4e09\u53f0\u4e3b\u673a\u521b\u5efa\u78c1\u76d8,\u5e76\u6302\u8f7d\u5230\u4e3b\u673a\u7684/var/local/osd{0,1,2}</p> <pre><code>[root@master ~]# mkfs.xfs /dev/vdc\n[root@master ~]# mkdir -p /var/local/osd0\n[root@master ~]# mount /dev/vdc /var/local/osd0/\n\n\n[root@node01 ~]# mkfs.xfs /dev/vdc\n[root@node01 ~]# mkdir -p /var/local/osd1\n[root@node01 ~]# mount /dev/vdc /var/local/osd1/\n\n[root@node02 ~]# mkfs.xfs /dev/vdc \n[root@node02 ~]# mkdir -p /var/local/osd2\n[root@node02 ~]# mount /dev/vdc /var/local/osd2/\n\n\u5c06\u78c1\u76d8\u6dfb\u52a0\u8fdb\u5165fstab\u4e2d\uff0c\u786e\u4fdd\u5f00\u673a\u81ea\u52a8\u6302\u8f7d\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#23-hosts","title":"2.3 \u914d\u7f6e\u5404\u4e3b\u673ahosts\u6587\u4ef6","text":"<pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n172.16.60.2 master\n172.16.60.3 node01\n172.16.60.4 node02\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#24-sshnode1node2","title":"2.4 \u7ba1\u7406\u8282\u70b9ssh\u514d\u5bc6\u94a5\u767b\u5f55node1/node2","text":"<pre><code>[root@master ~]# ssh-keygen -t rsa\n[root@master ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@node01\n[root@master ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@node02\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#25-masterceph-deploy","title":"2.5 master\u8282\u70b9\u5b89\u88c5ceph-deploy\u5de5\u5177","text":"<pre><code># \u5404\u8282\u70b9\u5747\u66f4\u65b0ceph\u7684yum\u6e90\nvim /etc/yum.repos.d/ceph.repo \n\n[ceph]\nname=ceph\nbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/x86_64/\ngpgcheck=0\npriority =1\n[ceph-noarch]\nname=cephnoarch\nbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/noarch/\ngpgcheck=0\npriority =1\n[ceph-source]\nname=Ceph source packages\nbaseurl=http://mirrors.aliyun.com/ceph/rpm-jewel/el7/SRPMS\ngpgcheck=0\npriority=1\n\n# \u5b89\u88c5ceph-deploy\u5de5\u5177\nyum clean all &amp;&amp; yum makecache\nyum -y install ceph-deploy\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#26-monitor","title":"2.6 \u521b\u5efamonitor\u670d\u52a1","text":"<p>\u521b\u5efamonitor\u670d\u52a1,\u6307\u5b9amaster\u8282\u70b9\u7684hostname</p> <pre><code>[root@master ~]# mkdir /etc/ceph &amp;&amp; cd /etc/ceph\n[root@master ceph]# ceph-deploy new master\n[root@master ceph]# ll\ntotal 12\n-rw-r--r-- 1 root root  195 Sep  3 10:56 ceph.conf\n-rw-r--r-- 1 root root 2915 Sep  3 10:56 ceph-deploy-ceph.log\n-rw------- 1 root root   73 Sep  3 10:56 ceph.mon.keyring\n\n\n[root@master ceph]# cat ceph.conf \n[global]\nfsid = 5b9eb8d2-1c12-4f6d-ae9c-85078795794b\nmon_initial_members = master\nmon_host = 172.16.60.2\nauth_cluster_required = cephx\nauth_service_required = cephx\nauth_client_required = cephx\nosd_pool_default_size = 2\n\n\u914d\u7f6e\u6587\u4ef6\u7684\u9ed8\u8ba4\u526f\u672c\u6570\u4ece3\u6539\u62102\uff0c\u8fd9\u6837\u53ea\u6709\u4e24\u4e2aosd\u4e5f\u80fd\u8fbe\u5230active+clean\u72b6\u6001\uff0c\u628a\u4e0b\u9762\u8fd9\u884c\u52a0\u5165\u5230[global]\u6bb5\uff08\u53ef\u9009\u914d\u7f6e\uff09\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#27-ceph","title":"2.7 \u6240\u6709\u8282\u70b9\u5b89\u88c5ceph","text":"<pre><code># \u5404\u8282\u70b9\u5b89\u88c5\u8f6f\u4ef6\u5305\nyum -y install yum-plugin-priorities epel-release\n# master\u8282\u70b9\u5229\u7528ceph-deply \u90e8\u7f72ceph\n\n[root@master ceph]# ceph-deploy install master node01 node02\n\n[root@master ceph]# ceph --version\nceph version 10.2.11 (e4b061b47f07f583c92a050d9e84b1813a35671e)\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#28","title":"2.8 \u90e8\u7f72\u76f8\u5173\u670d\u52a1","text":"<pre><code># \u5b89\u88c5ceph monitor\n[root@master ceph]# ceph-deploy mon create master\n\n# \u6536\u96c6\u8282\u70b9\u7684keyring\u6587\u4ef6\n[root@master ceph]# ceph-deploy  gatherkeys master\n\n# \u521b\u5efaosd\n[root@master ceph]# ceph-deploy osd prepare master:/var/local/osd0 node01:/var/local/osd1 node02:/var/local/osd2\n\n# \u6743\u9650\u4fee\u6539\n[root@master ceph]# chmod 777 -R /var/local/osd{0..2}\n[root@master ceph]# chmod 777 -R /var/local/osd{0..2}/*\n\n# \u6fc0\u6d3bosd\n[root@master ceph]# ceph-deploy osd activate master:/var/local/osd0 node01:/var/local/osd1 node02:/var/local/osd2\n\n# \u67e5\u770b\u72b6\u6001\n[root@master ceph]# ceph-deploy osd list master node01 node02\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#29","title":"2.9 \u7edf\u4e00\u914d\u7f6e","text":"<p>\u7528ceph-deploy\u628a\u914d\u7f6e\u6587\u4ef6\u548cadmin\u5bc6\u94a5\u62f7\u8d1d\u5230\u6240\u6709\u8282\u70b9\uff0c\u8fd9\u6837\u6bcf\u6b21\u6267\u884cCeph\u547d\u4ee4\u884c\u65f6\u5c31\u65e0\u9700\u6307\u5b9amonitor\u5730\u5740\u548cceph.client.admin.keyring\u4e86</p> <pre><code>[root@master ceph]# ceph-deploy admin master node01 node02\n\n# \u5404\u8282\u70b9\u4fee\u6539ceph.client.admin.keyring\u6743\u9650\uff1a\n[root@master ceph]# chmod +r /etc/ceph/ceph.client.admin.keyring\n\n\n# \u67e5\u770b\u72b6\u6001\n[root@master ceph]# ceph health\nHEALTH_OK\n[root@master ceph]# ceph -s\n    cluster 5b9eb8d2-1c12-4f6d-ae9c-85078795794b\n     health HEALTH_OK\n     monmap e1: 1 mons at {master=172.16.60.2:6789/0}\n            election epoch 3, quorum 0 master\n     osdmap e15: 3 osds: 3 up, 3 in\n            flags sortbitwise,require_jewel_osds\n      pgmap v27: 64 pgs, 1 pools, 0 bytes data, 0 objects\n            15681 MB used, 1483 GB / 1499 GB avail\n                  64 active+clean\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#210-mds","title":"2.10 \u90e8\u7f72MDS\u670d\u52a1","text":"<p>\u6211\u4eec\u5728node01/node02\u4e0a\u5b89\u88c5\u90e8\u7f72MDS\u670d\u52a1</p> <pre><code>[root@master ceph]# ceph-deploy mds create node01 node02\n\n# \u67e5\u770b\u72b6\u6001\n[root@master ceph]# ceph mds stat\ne3:, 2 up:standby\n[root@master ~]# ceph mon stat\ne1: 1 mons at {master=172.16.60.2:6789/0}, election epoch 4, quorum 0 master\n\n# \u67e5\u770b\u670d\u52a1\n[root@master ceph]# systemctl list-unit-files |grep ceph\nceph-create-keys@.service                     static  \nceph-disk@.service                            static  \nceph-mds@.service                             disabled\nceph-mon@.service                             enabled \nceph-osd@.service                             enabled \nceph-radosgw@.service                         disabled\nceph-mds.target                               enabled \nceph-mon.target                               enabled \nceph-osd.target                               enabled \nceph-radosgw.target                           enabled \nceph.target                                   enabled \n</code></pre> <p>\u81f3\u6b64\uff0c\u57fa\u672c\u4e0a\u5b8c\u6210\u4e86ceph\u5b58\u50a8\u96c6\u7fa4\u7684\u642d\u5efa\u3002 </p>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#ceph_2","title":"\u4e09 \u521b\u5efaceph\u6587\u4ef6\u7cfb\u7edf","text":""},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#31","title":"3.1 \u521b\u5efa\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u5173\u4e8e\u521b\u5efa\u5b58\u50a8\u6c60 \u786e\u5b9a pg_num \u53d6\u503c\u662f\u5f3a\u5236\u6027\u7684\uff0c\u56e0\u4e3a\u4e0d\u80fd\u81ea\u52a8\u8ba1\u7b97\u3002\u4e0b\u9762\u662f\u51e0\u4e2a\u5e38\u7528\u7684\u503c\uff1a * \u5c11\u4e8e 5 \u4e2a OSD \u65f6\u53ef\u628a pg_num \u8bbe\u7f6e\u4e3a 128 * OSD \u6570\u91cf\u5728 5 \u5230 10 \u4e2a\u65f6\uff0c\u53ef\u628a pg_num \u8bbe\u7f6e\u4e3a 512 * OSD \u6570\u91cf\u5728 10 \u5230 50 \u4e2a\u65f6\uff0c\u53ef\u628a pg_num \u8bbe\u7f6e\u4e3a 4096 * OSD \u6570\u91cf\u5927\u4e8e 50 \u65f6\uff0c\u4f60\u5f97\u7406\u89e3\u6743\u8861\u65b9\u6cd5\u3001\u4ee5\u53ca\u5982\u4f55\u81ea\u5df1\u8ba1\u7b97 pg_num \u53d6\u503c * \u81ea\u5df1\u8ba1\u7b97 pg_num \u53d6\u503c\u65f6\u53ef\u501f\u52a9 pgcalc \u5de5\u5177 \u3000\u3000\u968f\u7740 OSD \u6570\u91cf\u7684\u589e\u52a0\uff0c\u6b63\u786e\u7684 pg_num \u53d6\u503c\u53d8\u5f97\u66f4\u52a0\u91cd\u8981\uff0c\u56e0\u4e3a\u5b83\u663e\u8457\u5730\u5f71\u54cd\u7740\u96c6\u7fa4\u7684\u884c\u4e3a\u3001\u4ee5\u53ca\u51fa\u9519\u65f6\u7684\u6570\u636e\u6301\u4e45\u6027\uff08\u5373\u707e\u96be\u6027\u4e8b\u4ef6\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u7684\u6982\u7387\uff09\u3002 </p> <pre><code>[root@master ceph]# ceph osd pool create cephfs_data &lt;pg_num&gt; \n[root@master ceph]# ceph osd pool create cephfs_metadata &lt;pg_num&gt;\n\n[root@master ~]# ceph osd pool ls \nrbd\n[root@master ~]#  ceph osd pool create kube 128\npool 'kube' created\n[root@master ~]# ceph osd pool ls              \nrbd\nkube\n\n# \u67e5\u770b\u8bc1\u4e66\n[root@master ~]# ceph auth list\ninstalled auth entries:\n\nmds.node01\n        key: AQB56m1dE42rOBAA0yRhsmQb3QMEaTsQ71jHdg==\n        caps: [mds] allow\n        caps: [mon] allow profile mds\n        caps: [osd] allow rwx\nmds.node02\n        key: AQB66m1dWuhWKhAAtbiZN7amGcjUh6Rj/HNFkg==\n        caps: [mds] allow\n        caps: [mon] allow profile mds\n        caps: [osd] allow rwx\nosd.0\n        key: AQA46W1daFx3IxAAE1esQW+t1fWJDfEQd+167w==\n        caps: [mon] allow profile osd\n        caps: [osd] allow *\nosd.1\n        key: AQBA6W1daJG9IxAAQwETgrVc3awkEZejDSaaow==\n        caps: [mon] allow profile osd\n        caps: [osd] allow *\nosd.2\n        key: AQBI6W1dot4/GxAAle3Ii3/D38RmwNC4yTCoPg==\n        caps: [mon] allow profile osd\n        caps: [osd] allow *\nclient.admin\n        key: AQBu4W1d90dZKxAAH/kta03cP5znnCcWeOngzQ==\n        caps: [mds] allow *\n        caps: [mon] allow *\n        caps: [osd] allow *\nclient.bootstrap-mds\n        key: AQBv4W1djJ1uHhAACzBcXjVoZFgLg3lN+KEv8Q==\n        caps: [mon] allow profile bootstrap-mds\nclient.bootstrap-mgr\n        key: AQCS4W1dna9COBAAiWPu7uk3ItJxisVIwn2duA==\n        caps: [mon] allow profile bootstrap-mgr\nclient.bootstrap-osd\n        key: AQBu4W1dxappOhAA5FanGhQhAOUlizqa5uMG3A==\n        caps: [mon] allow profile bootstrap-osd\nclient.bootstrap-rgw\n        key: AQBv4W1dpwvsDhAAyp58v08XttJWzLoHWVHZow==\n        caps: [mon] allow profile bootstrap-rgw\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#32","title":"3.2 \u521b\u5efa\u5ba2\u6237\u7aef\u5bc6\u94a5","text":"<pre><code># \u521b\u5efakeyring\n[root@master ~]# ceph auth get-or-create client.kube mon 'allow r' osd 'allow rwx pool=kube' -o /etc/ceph/ceph.client.kube.keyring\n[root@master ~]# ceph auth list\n\n# \u5c06\u5bc6\u94a5\u62f7\u8d1d\u5230node1\u548cnode2\n[root@master ceph]# scp ceph.client.kube.keyring root@node01:/etc/ceph/\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#33-k8s","title":"3.3 \u90e8\u7f72\u8fdbk8s","text":"<pre><code>[root@master storageclass]# cat ceph-secret.yaml \napiVersion: v1\nkind: Secret\nmetadata:\n  name: ceph-admin-secret\n  namespace: kube-system\ntype: \"kubernetes.io/rbd\"\ndata:\n  # ceph auth get-key client.admin |base64\n  key: QVFCRitmUmM1c1FuR3hBQUtBeFl5cFNJaW4wbHFoQVh6NlRvQ2c9PQ==\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ceph-client-secret\n  namespace: kube-system\ntype: \"kubernetes.io/rdb\"\ndata:\n  # ceph auth get-key client.kube |base64\n  key: QVFCMEovVmM2a3laSGhBQUxkOEszQlJEUlQyaGk0b09FSnJZL1E9PQ== \n\n\n[root@master storageclass]# cat ceph-storageclass.yaml \napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: ceph-rdb\nprovisioner: ceph.com/rbd\nreclaimPolicy: Retain\nparameters:\n  monitors: 10.234.2.204:6789\n  pool: kube\n  adminId: admin\n  adminSecretName: ceph-admin-secret\n  adminSecretNamespace: kube-system\n  userId: kube\n  userSecretName: ceph-client-secret\n  userSecretNamespace: kube-system\n  fsType: xfs\n  imageFormat: \"2\"\n  imageFeatures: \"layering\"\n\n[root@master storageclass]# kubectl get sc\nNAME       PROVISIONER    AGE\nceph-rdb   ceph.com/rbd   2m13s\n</code></pre> <p>\u200b   </p> <p>\u00b7</p>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#_2","title":"\u56db \u5378\u8f7d","text":"<pre><code>\u6e05\u7406\u673a\u5668\u4e0a\u7684ceph\u76f8\u5173\u914d\u7f6e\uff1a\n\u505c\u6b62\u6240\u6709\u8fdb\u7a0b\uff1a stop ceph-all\n\u5378\u8f7d\u6240\u6709ceph\u7a0b\u5e8f\uff1aceph-deploy uninstall [{ceph-node}]\n\u5220\u9664ceph\u76f8\u5173\u7684\u5b89\u88c5\u5305\uff1aceph-deploy purge {ceph-node} [{ceph-data}]\n\u5220\u9664ceph\u76f8\u5173\u7684\u914d\u7f6e\uff1aceph-deploy purgedata {ceph-node} [{ceph-data}]\n\u5220\u9664key\uff1aceph-deploy forgetkeys\n\n\u5378\u8f7dceph-deploy\u7ba1\u7406\uff1ayum -y remove ceph-deploy\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#cephfs","title":"\u4e94 Cephfs","text":""},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#51","title":"5.1 \u80cc\u666f","text":"<p>\u56e0\u4e3a\u4e0a\u4e00\u7bc7\u6587\u6863\u4e2d\u63cf\u8ff0\u7684\u4f7f\u7528RBD\u6a21\u5f0f\u521b\u5efa\u7684pvc\u4e0d\u652f\u6301RWM(readwriteMany)\uff0c\u53ea\u652f\u6301 RWO(ReadWriteOnce)\u548cROM(ReadOnlyMany)</p> <p>k8s \u4e0d\u652f\u6301\u8de8\u8282\u70b9\u6302\u8f7d\u540c\u4e00Ceph RBD\uff0c\u652f\u6301\u8de8\u8282\u70b9\u6302\u8f7d CephFS\uff0c\u8ba9\u6240\u6709\u7684\u4efb\u52a1\u90fd\u8c03\u5ea6\u5230\u6307\u5b9anode\u4e0a\u6267\u884c\uff0c\u6765\u4fdd\u8bc1\u9488\u5bf9RBD\u7684\u64cd\u4f5c\u5728\u540c\u4e00\u8282\u70b9\u4e0a\u3002</p>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#52-cephfs","title":"5.2 \u521b\u5efacephfs","text":"<p>\u5728ceph\u670d\u52a1\u5668\u521b\u5efacephfs\u6587\u4ef6\u7cfb\u7edf</p> <pre><code>ceph osd pool create fs_kube_data 128\nceph osd pool create fs_kube_metadata 128\nceph fs new cephfs fs_kube_metadata fs_kube_data\n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#53-cephf-k8sstorage-class","title":"5.3 cephf \u4f5c\u4e3ak8s\u7684storage class","text":"<p>\u5b98\u65b9\u652f\u6301storage class\u7684\u5b58\u50a8\u7c7b\u578b\u91cc\uff0c\u76ee\u524d\u6ca1\u6709cephfs\u3002\u76ee\u524dk8s\uff08v1.10\uff09\u7684\u786e\u662f\u4e0d\u652f\u6301cephfs\u7528\u4f5cstorage class\u7684\uff0c\u4f46\u662f\u6211\u4eec\u5df2\u7ecf\u6709\u4e86ceph\u96c6\u7fa4\uff0c\u800cRBD\u53c8\u4e0d\u652f\u6301 ReadWriteMany\uff0c\u8fd9\u6837\u5c31\u6ca1\u529e\u6cd5\u505a\u5171\u4eab\u5b58\u50a8\u7c7b\u578b\u7684Volume\u4e86\uff0c\u4f7f\u7528\u573a\u666f\u4f1a\u53d7\u4e00\u4e9b\u9650\u5236\u3002\u800c\u4e3a\u4e86\u8fd9\u4e2a\u573a\u666f\u518d\u5355\u72ec\u53bb\u7ef4\u62a4\u4e00\u5957glusterfs\uff0c\u53c8\u5f88\u4e0d\u5212\u7b97\uff0c\u5f53\u7136\u662f\u80fd\u7528cephfs\u505astorage class\u6700\u5b8c\u7f8e\u5566\u3002 \u2003\u2003\u793e\u533a\u5176\u5b9e\u662f\u6709\u9879\u76ee\u505a\u8fd9\u4e2a\u7684\uff0c\u5c31\u662f external storage\uff0c\u53ea\u662f\u73b0\u5728\u8fd8\u5728\u5b75\u5316\u5668\u91cc\u3002\u6240\u8c13external storage\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a controller\uff0c\u5b83\u4f1a\u53bb\u76d1\u542c apiserver \u7684storage class api\u7684\u53d8\u5316\uff0c\u5f53\u53d1\u73b0\u6709cephfs\u7684\u8bf7\u6c42\uff0c\u5b83\u4f1a\u62ff\u6765\u5904\u7406\uff1a\u6839\u636e\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u521b\u5efaPV\uff0c\u5e76\u5c06PV\u7684\u521b\u5efa\u8bf7\u6c42\u53d1\u7ed9api server\uff1bPV\u521b\u5efa\u540e\u518d\u5c06\u5176\u4e0ePVC\u7ed1\u5b9a\u3002 \u2003\u2003\u540c\u65f6\uff0ccontroller\u7684 cephfs-provisioner\u4f1a\u8c03\u7528 cephfs_provisioner.py \u811a\u672c\u53bbcephfs\u96c6\u7fa4\u4e0a\u53bb\u521b\u5efa\u76ee\u5f55\uff0c\u76ee\u5f55\u540d\u89c4\u5219\u4e3a \"kubernetes-dynamic-pvc-%s\", uuid.NewUUID()\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0cexternal-storage\u4f5c\u4e3aceph\u96c6\u7fa4\u7684\u4e00\u4e2a\u7528\u6237\uff0c\u81ea\u5df1\u7ef4\u62a4\u4e86\u4e0d\u540cPVC\u548ccephfs\u76ee\u5f55\u7684\u5bf9\u5e94\u5173\u7cfb\u3002</p> <pre><code># \u521b\u5efa\u6587\u4ef6\u7cfb\u7edf\n[root@master cephfsdemo]#ceph osd pool create fs_kube_data 128\n[root@master cephfsdemo]#ceph osd pool create fs_kube_metadata 128\n[root@master cephfsdemo]#ceph fs new cephfs fs_kube_metadata fs_kube_data\n\n[root@master cephfsdemo]# ceph fs ls\nname: cephfs, metadata pool: fs_kube_metadata, data pools: [fs_kube_data ]\n# \u90e8\u7f72\u8fdbk8s\n[root@master deploy]# git clone https://github.com/kubernetes-incubator/external-storage.git\n[root@master deploy]# cd /dockerdata/workspace/storageclass/external-storage-master/ceph/cephfs/deploy\n[root@master deploy]# ls\nnon-rbac  rbac  README.md\n\n# README.md\u5185\u6709\u542f\u7528rbac\u7684\u5b89\u88c5\u65b9\u5f0f\n[root@master deploy]# kubectl create ns cephfs\n[root@master deploy]# NAMESPACE=cephfs\n[root@master deploy]# sed -r -i \"s/namespace: [^ ]+/namespace: $NAMESPACE/g\" ./rbac/*.yaml\n[root@master deploy]# sed -r -i \"N;s/(name: PROVISIONER_SECRET_NAMESPACE.*\\n[[:space:]]*)value:.*/\\1value: $NAMESPACE/\" ./rbac/deployment.yaml\n[root@master deploy]# kubectl -n $NAMESPACE apply -f ./rbac\n[root@master deploy]# kubectl -n $NAMESPACE apply -f ./rbac\nclusterrole.rbac.authorization.k8s.io/cephfs-provisioner unchanged\nclusterrolebinding.rbac.authorization.k8s.io/cephfs-provisioner unchanged\ndeployment.extensions/cephfs-provisioner created\nrole.rbac.authorization.k8s.io/cephfs-provisioner created\nrolebinding.rbac.authorization.k8s.io/cephfs-provisioner created\nserviceaccount/cephfs-provisioner created\n\n# \u5f85pod\u8d77\u6765\u540e\u53ef\u4ee5\u90e8\u7f72cephfs\u7684\u5b58\u50a8\u7c7b\n[root@master ~]# kubectl get po -n cephfs\nNAME                                  READY   STATUS    RESTARTS   AGE\ncephfs-provisioner-5dbd449769-sppgk   1/1     Running   0          3m45s\n\n\n# \u521b\u5efaceph\u7684\u5bc6\u94a5\n[root@master cephfsdemo]# cat ceph-secret.yaml \napiVersion: v1\nkind: Secret\nmetadata:\n  name: ceph-admin-secret\n  namespace: cephfs\ntype: \"kubernetes.io/rbd\"\ndata:\n  # ceph auth get-key client.admin |base64\n  key: QVFCRitmUmM1c1FuR3hBQUtBeFl5cFNJaW4wbHFoQVh6NlRvQ2c9PQ==\n[root@master cephfsdemo]# kubectl get secret -n cephfs\nNAME                                                                       TYPE                                  DATA   AGE\nceph-admin-secret                                                          kubernetes.io/rbd                     1      94s\nceph-kubernetes-dynamic-user-c3f1789f-a4a0-11ea-b7d7-d61a8e0f81b2-secret   Opaque                                1      51s\ncephfs-provisioner-token-p7nl4                                             kubernetes.io/service-account-token   3      43m\ndefault-token-w6p8s                                                        kubernetes.io/service-account-token   3      43m\n\n\n[root@master deploy]# cat cephfs-sc.yaml\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: cephfs\n  namespace: kube-system\nprovisioner: ceph.com/cephfs\nparameters:\n    monitors: 10.234.2.204:6789         # \u914d\u7f6e\u4e3aceph\u7684mon\u5730\u5740\n    adminId: admin\n    adminSecretName: ceph-admin-secret      # \u914d\u7f6e\u4e3aceph\u7684admin \u7684secret\n    adminSecretNamespace: \"cephfs\"\n\n[root@master cephfsdemo]# kubectl apply -f cephfs-sc.yaml \nstorageclass.storage.k8s.io/cephfs created\n[root@master cephfsdemo]# kubectl get sc\nNAME       PROVISIONER       AGE\nceph-rdb   ceph.com/rbd      174m\ncephfs     ceph.com/cephfs   6s\n\n\n# \u521b\u5efapvc\n\n[root@master cephfsdemo]# cat cephfs-pvc.yaml \nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: claim\n  annotations:\n    volume.beta.kubernetes.io/storage-class: \"cephfs\"\nspec:\n  accessModes:\n    - ReadWriteMany     # \u5b9a\u4e49\u8bbf\u95ee\u6a21\u5f0f\u4e3a\u591a\u91cd\u8bfb\u5199\n  resources:\n    requests:\n      storage: 1Gi\n\n\n[root@master cephfsdemo]# kubectl get pvc\nNAME    STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nclaim   Bound    pvc-c43afcb6-a4a0-11ea-b644-facf8ddba000   1Gi        RWX            cephfs         2m28s\n\n# \u521b\u5efa\u7528\u4e8e\u6d4b\u8bd5\u7684cephfs\u7684pod\n[root@master cephfsdemo]# cat cephfs-pod.yaml \nkind: Pod\napiVersion: v1\nmetadata:\n  name: test-pod\nspec:\n  nodeSelector: \n    kubernetes.io/hostname: node1       # \u4f7f\u7528nodeselect\u6307\u5b9a\u8fd0\u884c\u5728node1\u4e0a\u9762\n  containers:\n  - name: test-pod\n    image: nginx:latest\n    volumeMounts:\n      - name: pvc\n        mountPath: \"/mnt\"                       # \u6302\u8f7d\u76ee\u5f55\u4e3a/mnt\n  restartPolicy: \"Never\"\n  volumes:\n    - name: pvc\n      persistentVolumeClaim:\n        claimName: claim\n\n[root@master cephfsdemo]# cat cephfs-pod2.yaml \nkind: Pod\napiVersion: v1\nmetadata:\n  name: test-pod2\nspec:\n  nodeSelector: \n    kubernetes.io/hostname: node2       # \u6307\u5b9a\u8fd0\u884c\u5728node2\u4e0a\n  containers:\n  - name: test-pod2\n    image: nginx:latest\n    volumeMounts:\n      - name: pvc\n        mountPath: \"/data\"              # \u6302\u8f7d\u76ee\u5f55/data\n  restartPolicy: \"Never\"\n  volumes:\n    - name: pvc\n      persistentVolumeClaim:\n        claimName: claim\n\n# \u8fd0\u884c\u5bb9\u5668\u540e\n[root@master cephfsdemo]# kubectl get pod -owide\nNAME        READY   STATUS    RESTARTS   AGE     IP             NODE    NOMINATED NODE   READINESS GATES\ntest-pod    1/1     Running   1          8m41s   10.244.1.87    node1   &lt;none&gt;           &lt;none&gt;\ntest-pod2   1/1     Running   0          16s     10.244.2.125   node2   &lt;none&gt;           &lt;none&gt;\n\n# \u67e5\u770b\u6302\u8f7d\u76ee\u5f55\n[root@master cephfsdemo]# kubectl exec -it test-pod -- mount |grep /mnt\n10.234.2.204:6789:/volumes/kubernetes/kubernetes/kubernetes-dynamic-pvc-c3f177f7-a4a0-11ea-b7d7-d61a8e0f81b2 on /mnt type ceph (rw,relatime,name=kubernetes-dynamic-user-c3f1789f-a4a0-11ea-b7d7-d61a8e0f81b2,secret=&lt;hidden&gt;,acl)\n[root@master cephfsdemo]# kubectl exec -it test-pod2 -- mount |grep /data\n10.234.2.204:6789:/volumes/kubernetes/kubernetes/kubernetes-dynamic-pvc-c3f177f7-a4a0-11ea-b7d7-d61a8e0f81b2 on /data type ceph (rw,relatime,name=kubernetes-dynamic-user-c3f1789f-a4a0-11ea-b7d7-d61a8e0f81b2,secret=&lt;hidden&gt;,acl)\n\n# \u8fdb\u5165\u5230pod\u4e2d\u6d4b\u8bd5\n[root@master ~]# kubectl exec -it test-pod -- sh\n# cd /mnt\n# ls\n# lls\nsh: 5: lls: not found\n# touch 1\ntouch: cannot touch '1': Input/output error\n</code></pre> <p>\u4f46\u662f\u53d1\u73b0\u65e0\u6cd5\u6b63\u5e38\u6302\u8f7d\uff0c\u9700\u8981linux\u5bbf\u4e3b\u673akernel\u7248\u672c4.10\u4ee5\u4e0a\uff0c\u53ef\u53c2\u8003\uff1ahttps://github.com/kubernetes-incubator/external-storage/issues/345</p>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#54-kernel","title":"5.4 \u5347\u7ea7\u7cfb\u7edfkernel","text":"<pre><code>[root@master updatakernel]# rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\n[root@master updatakernel]# rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm\nRetrieving http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm\nRetrieving http://elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm\nPreparing...                          ################################# [100%]\nUpdating / installing...\n   1:elrepo-release-7.0-4.el7.elrepo  ################################# [100%]\n[root@master updatakernel]# yum --disablerepo=\"*\" --enablerepo=\"elrepo-kernel\" list available\n\n[root@master updatakernel]# yum --enablerepo=elrepo-kernel install kernel-ml\n# \u914d\u7f6egrub\u65b0\u589e\n[root@master ~]# cat /etc/default/grub \nGRUB_DEFAULT=0\n\n# \u751f\u6210grub\n[root@master ~]# grub2-mkconfig -o /boot/grub2/grub.cfg\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-4.4.225-1.el7.elrepo.x86_64\nFound initrd image: /boot/initramfs-4.4.225-1.el7.elrepo.x86_64.img\nFound linux image: /boot/vmlinuz-3.10.0-514.el7.x86_64\nFound initrd image: /boot/initramfs-3.10.0-514.el7.x86_64.img\nFound linux image: /boot/vmlinuz-0-rescue-689a0c92792f4df1aed088d246dfaaba\nFound initrd image: /boot/initramfs-0-rescue-689a0c92792f4df1aed088d246dfaaba.img\ndone\n\n# \u6ce8\u91ca/boot/grub2/grub.cfg \u4e2d\u8001\u7684grub\u4fe1\u606f\n\n[root@master ~]# uname -rs\nLinux 5.7.0-1.el7.elrepo.x86_64 \n[root@master ~]# \n</code></pre>"},{"location":"cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/#_3","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>ceph\u5b98\u65b9\u6587\u6863 </li> <li>ceph\u4e2d\u6587\u5f00\u6e90\u793e\u533a</li> <li>CentOS 7\u90e8\u7f72 Ceph\u5206\u5e03\u5f0f\u5b58\u50a8\u67b6\u6784</li> <li> <p>http://www.voidcn.com/article/p-cizuiqdb-bxp.html</p> </li> <li> <p>https://github.com/kubernetes-incubator/external-storage/issues/345</p> </li> <li>https://www.jianshu.com/p/726bd9f37220</li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/","title":"\u6700\u5c0f\u5316K8s\u73af\u5883\u90e8\u7f72\u4e4bMinikube","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u6700\u8fd1\u9700\u8981\u7ed9\u5f00\u53d1\u76f8\u5173\u540c\u65f6\u57f9\u8badK8s\uff0c\u96c6\u7fa4\u65b9\u5f0f\u90e8\u7f72\u8d1f\u8d23\u4e14\u5360\u7528\u8d44\u6e90\u591a\uff0c\u7b80\u5355\u5feb\u6377\u9ad8\u6548\u7684\u5355\u673a\u7248K8s\u73af\u5883\uff0c\u53ef\u8c13\u5f00\u53d1\u4eba\u5458\u4e0d\u9519\u7684\u9009\u62e9\uff0cminikube\u5c31\u662f\u4e3a\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u800c\u884d\u751f\u51fa\u6765\u7684\u5de5\u5177\uff0c\u5b83\u57fa\u4e8ego\u8bed\u8a00\u5f00\u53d1\uff0c \u662f\u4e00\u4e2a\u6613\u4e8e\u5728\u672c\u5730\u8fd0\u884c Kubernetes \u7684\u5de5\u5177\uff0c\u53ef\u5728\u4f60\u7684\u7b14\u8bb0\u672c\u7535\u8111\u4e0a\u7684\u865a\u62df\u673a\u5185\u8f7b\u677e\u521b\u5efa\u5355\u673a\u7248 Kubernetes \u96c6\u7fa4\u3002\u4fbf\u4e8e\u5c1d\u8bd5 Kubernetes \u6216\u4f7f\u7528 Kubernetes \u65e5\u5e38\u5f00\u53d1\u3002\u53ef\u4ee5\u5728\u5355\u673a\u73af\u5883\u4e0b\u5feb\u901f\u642d\u5efa\u53ef\u7528\u7684k8s\u96c6\u7fa4\uff0c\u975e\u5e38\u9002\u5408\u6d4b\u8bd5\u548c\u672c\u5730\u5f00\u53d1\u3002\u5982\u679c\u6ca1\u6709\u670d\u52a1\u5668\u6216\u5728\u672c\u5730\u7b14\u8bb0\u672c\u5b89\u88c5\uff0c\u5219\u53ef\u4ee5\u5728\u7ebf\u4f7f\u7528https://labs.play-with-k8s.com/\u6765\u4f53\u9a8cK8s\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#minikube","title":"\u4e8c Minikube\u7b80\u4ecb","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#21","title":"2.1 \u4e3b\u8981\u7ec4\u4ef6","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#localkube","title":"localkube","text":"<p>\u4e3a\u4e86\u8fd0\u884c\u548c\u7ba1\u7406 Kubernetes \u7684\u7ec4\u4ef6\uff0cMinikube \u4e2d\u4f7f\u7528\u4e86 Spread's \u7684 localkube\uff0clocalkube \u662f\u4e00\u4e2a\u72ec\u7acb\u7684 Go \u8bed\u8a00\u7684\u4e8c\u8fdb\u5236\u5305\uff0c\u5305\u542b\u4e86\u6240\u6709 Kubernetes \u7684\u4e3b\u8981\u7ec4\u4ef6\uff0c\u5e76\u4e14\u4ee5\u4e0d\u540c\u7684 goroutine \u6765\u8fd0\u884c\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#libmachine","title":"libmachine","text":"<p>\u4e3a\u4e86\u652f\u6301 MacOS \u548c Windows\uff0cMinikube \u5728\u5185\u90e8\u4f7f\u7528 libmachine \u521b\u5efa\u6216\u9500\u6bc1\u865a\u62df\u673a\uff0c\u53ef\u4ee5\u5c06\u5b83\u7406\u89e3\u4e3a\u4e00\u4e2a\u865a\u62df\u673a\u7684\u9a71\u52a8\u7a0b\u5e8f\u3002\u81f3\u4e8e\u5728 Linux \u4e0a\uff0c\u7531\u4e8e\u96c6\u7fa4\u53ef\u4ee5\u76f4\u63a5\u672c\u5730\u8fd0\u884c\uff0c\u6240\u4ee5\u907f\u514d\u8bbe\u7f6e\u865a\u62df\u673a\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#22","title":"2.2 \u542f\u52a8\u6d41\u7a0b","text":"<ul> <li>\u901a\u8fc7 libmachine \u542f\u52a8\u865a\u62df\u673a\uff0c\u751f\u6210 Docker \u76f8\u5173\u8bc1\u4e66\u53ca\u914d\u7f6e\u6587\u4ef6\uff0c\u542f\u52a8 Docker;</li> <li>\u751f\u6210 Kubernetes \u76f8\u5173\u914d\u7f6e\u6587\u4ef6\u548c addons\uff0c\u4ee5\u53ca\u76f8\u5173\u8bc1\u4e66\uff0c\u62f7\u8d1d\u81f3\u865a\u62df\u673a;</li> <li>\u57fa\u4e8e\u4e4b\u524d\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u751f\u6210\u542f\u52a8\u811a\u672c\uff0c\u542f\u52a8 Kubernetes \u96c6\u7fa4\uff0c\u5e76\u53ef\u4ee5\u901a\u8fc7 Client \u8fdb\u884c\u8bbf\u95ee\u3002</li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#macoswindows","title":"MacOS/Windows","text":"<ul> <li>minikube -&gt; libmachine -&gt; virtualbox/hyper V -&gt; linux VM -&gt; localkube</li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#linux","title":"Linux","text":"<ul> <li>minikube -&gt; docker -&gt; localkube</li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#_2","title":"\u4e09 \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#31-mac","title":"3.1 Mac\u5b89\u88c5","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#311","title":"3.1.1 \u9884\u5148\u6761\u4ef6","text":"<ul> <li>virtual box\u5b89\u88c5</li> </ul> <p>\u53ef\u4ee5\u4ece\u6b64\u94fe\u63a5\u4e0b\u8f7d\uff1ahttps://www.virtualbox.org/wiki/Downloads</p> <ul> <li>kubectl \u5b89\u88c5</li> </ul> <pre><code>brew install kubectl\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#312","title":"3.1.2 \u5b89\u88c5","text":"<p>\u5b98\u65b9\u51fa\u54c1\u7684minikube\uff0c\u9ed8\u8ba4\u8fde\u63a5\u7684\u662fgoogle\u5b98\u65b9\u7ad9\u70b9\uff0c\u7531\u4e8e\u4f17\u6240\u5468\u77e5\u7684\u539f\u56e0\u53ef\u4ee5\u5229\u7528\u963f\u91cc\u4e91\u4fee\u6539\u8fc7\u7684minikube\uff0c\u76ee\u524d\u5df2\u7ecf\u66ff\u6362\u4e86\u5176\u4e2d\u56fd\u5916\u7684\u955c\u50cf\u6e90</p> <pre><code>curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v0.30.0/minikube-darwin-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#313","title":"3.1.3 \u542f\u52a8","text":"<pre><code>minikube start --vm-driver=virtualbox --registry-mirror=https://registry.docker-cn.com\n</code></pre> <p>\u6ce8\uff1a\u5982\u679c\u9996\u6b21\u5931\u8d25\u4e86(\u6bd4\u5982\uff1a\u6b65\u9aa4\u4e00\u4e2d\u7684\u5b89\u5168\u8bbe\u7f6e\u6ca1\u52fe\u9009\uff0c\u5bfc\u81f4\u65e0\u6cd5\u542f\u7528\uff09\uff0c\u53ef\u4ee5\u5148\u5c1d\u8bd5minikute delete \u5220\u9664\u539f\u6765\u7684machine\u3002</p> <p></p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#32-linux","title":"3.2 Linux\u670d\u52a1\u5668\u5b89\u88c5","text":"<ul> <li>\u57fa\u7840\u73af\u5883</li> </ul> <pre><code>CentOS 7.8\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#321-docker","title":"3.2.1 docker\u5b89\u88c5","text":"<p>``` yum install -y yum-utils device-mapper-persistent-data lvm2 wget yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo yum clean all &amp;&amp; yum makecache fast yum -y install docker-ce systemctl start docker <pre><code>#### 3.2.2 kubelet\u5b89\u88c5\n\n```shell\ncurl -LO https://storage.googleapis.com/kubernetes-release/release/v1.18.0/bin/linux/amd64/kubectl &amp;&amp;\\\nchmod +x ./kubectl &amp;&amp;\\\nmv ./kubectl /usr/bin/kubectl\n</code></pre></p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#323-minikube","title":"3.2.3 minikube\u5b89\u88c5","text":"<pre><code>$ curl -Lo minikube https://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v1.18.1/minikube-linux-amd64 &amp;&amp; $ chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/\n\n# \u4f7f\u7528docker\u9a71\u52a8\u4e0d\u80fd\u4f7f\u7528root\u7528\u6237\uff0c\u65b0\u5efaminikube\u7528\u6237\u7528\u4e8e\u542f\u52a8\n$ useradd minikube\n$ usermod -a -G docker minikube\n$ su minikube\n# \u5207\u6362\u5230minikube\u7528\u6237\u8fdb\u884c\u5b89\u88c5\n$ minikube start --driver=docker\n\ud83d\ude04  Centos 7.9.2009 (amd64) \u4e0a\u7684 minikube v1.18.1\n\ud83c\udf89  minikube 1.20.0 is available! Download it: https://github.com/kubernetes/minikube/releases/tag/v1.20.0\n\ud83d\udca1  To disable this notice, run: 'minikube config set WantUpdateNotification false'\n\n\u2728  \u6839\u636e\u7528\u6237\u914d\u7f6e\u4f7f\u7528 docker \u9a71\u52a8\u7a0b\u5e8f\n\ud83d\udc4d  Starting control plane node minikube in cluster minikube\n\ud83d\ude9c  Pulling base image ...\n\ud83d\udd25  Creating docker container (CPUs=2, Memory=2200MB) ...\n    &gt; kubelet.sha256: 64 B / 64 B [--------------------------] 100.00% ? p/s 0s\n    &gt; kubectl.sha256: 64 B / 64 B [--------------------------] 100.00% ? p/s 0s\n    &gt; kubeadm.sha256: 64 B / 64 B [--------------------------] 100.00% ? p/s 0s\n    &gt; kubectl: 38.37 MiB / 38.37 MiB [---------------] 100.00% 2.68 MiB p/s 14s\n    &gt; kubeadm: 37.40 MiB / 37.40 MiB [---------------] 100.00% 2.18 MiB p/s 17s\n    &gt; kubelet: 108.73 MiB / 108.73 MiB [-------------] 100.00% 4.11 MiB p/s 26s\n\n    \u25aa Generating certificates and keys ...\n    \u25aa Booting up control plane ...\n    \u25aa Configuring RBAC rules ...\n\ud83d\udd0e  Verifying Kubernetes components...\n    \u25aa Using image registry.cn-hangzhou.aliyuncs.com/google_containers/storage-provisioner:v4 (global image repository)\n\ud83c\udf1f  Enabled addons: storage-provisioner, default-storageclass\n\ud83d\udca1  kubectl not found. If you need it, try: 'minikube kubectl -- get pods -A'\n\ud83c\udfc4  Done! kubectl is now configured to use \"minikube\" cluster and \"default\" namespace by default\n\n### \u67e5\u770b\u4fe1\u606f\n$ kubectl cluster-info\n### \u8fdb\u5165\u5230minikube\n$ minikube ssh\n$ docker ps\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#_3","title":"\u56db \u4f7f\u7528","text":"<p>\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u53ef\u4ee5\u6253\u5f00\u63a7\u5236\u9762\u677f\uff0c\u81ea\u52a8\u8df3\u8f6c\u6d4f\u89c8\u5668\u67e5\u770b</p> <pre><code>minikube dashboard\n</code></pre> <p>\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u865a\u62df\u673aip</p> <pre><code>minikube ip\n</code></pre> <p>\u67e5\u770b\u72b6\u6001\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4</p> <pre><code>minikube status\n</code></pre> <p>\u5176\u4ed6\u547d\u4ee4\u53ef\u4ee5\u4f7f\u7528minikube \u2014help\u67e5\u770b\u5e2e\u52a9\uff0c\u5982\u4e0b</p> <pre><code>\u279c  bin minikube --help\nMinikube is a CLI tool that provisions and manages single-node Kubernetes clusters optimized for development workflows.\n\nUsage:\n  minikube [command]\n\nAvailable Commands:\n  addons         Modify minikube's kubernetes addons\n  cache          Add or delete an image from the local cache.\n  completion     Outputs minikube shell completion for the given shell (bash or zsh)\n  config         Modify minikube config\n  dashboard      Access the kubernetes dashboard running within the minikube cluster\n  delete         Deletes a local kubernetes cluster\n  docker-env     Sets up docker env variables; similar to '$(docker-machine env)'\n  help           Help about any command\n  ip             Retrieves the IP address of the running cluster\n  logs           Gets the logs of the running instance, used for debugging minikube, not user code\n  mount          Mounts the specified directory into minikube\n  profile        Profile sets the current minikube profile\n  service        Gets the kubernetes URL(s) for the specified service in your local cluster\n  ssh            Log into or run a command on a machine with SSH; similar to 'docker-machine ssh'\n  ssh-key        Retrieve the ssh identity key path of the specified cluster\n  start          Starts a local kubernetes cluster\n  status         Gets the status of a local kubernetes cluster\n  stop           Stops a running local kubernetes cluster\n  update-check   Print current and latest version number\n  update-context Verify the IP address of the running cluster in kubeconfig.\n  version        Print the version of minikube\n\nFlags:\n      --alsologtostderr                  log to standard error as well as files\n  -b, --bootstrapper string              The name of the cluster bootstrapper that will set up the kubernetes cluster. (default \"kubeadm\")\n  -h, --help                             help for minikube\n      --log_backtrace_at traceLocation   when logging hits line file:N, emit a stack trace (default :0)\n      --log_dir string                   If non-empty, write log files in this directory\n      --logtostderr                      log to standard error instead of files\n  -p, --profile string                   The name of the minikube VM being used.\n                                            This can be modified to allow for multiple minikube instances to be run independently (default \"minikube\")\n      --stderrthreshold severity         logs at or above this threshold go to stderr (default 2)\n  -v, --v Level                          log level for V logs\n      --vmodule moduleSpec               comma-separated list of pattern=N settings for file-filtered logging\n\nUse \"minikube [command] --help\" for more information about a command.\n</code></pre> <p>\u968f\u540e\u4f7f\u7528k8s\u7684\u547d\u4ee4\u5373\u53ef\u5728\u672c\u673a\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5982</p> <pre><code>kubectl get pods\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/kubernetes/minikube</li> <li>https://minikube.sigs.k8s.io/docs/start/</li> <li>https://zhuanlan.zhihu.com/p/38268410</li> <li>https://kubernetes.io/blog/2016/07/minikube-easily-run-kubernetes-locally/</li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/","title":"\u6700\u5c0f\u5316K8s\u73af\u5883\u90e8\u7f72\u4e4bK3s","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>K3s \u662f rancher \u516c\u53f8\u5f00\u53d1\u7ef4\u62a4\u7684\u4e00\u5957 K8s \u53d1\u884c\u7248\u3002\u6240\u8c13\u53d1\u884c\u7248\uff0c\u5c31\u7c7b\u4f3c\u4e8e debian \u4e4b\u4e8e Linux\u3002\u5185\u6838\u673a\u5236\u8fd8\u662f\u548c K8s \u4e00\u6837\uff0c\u4f46\u662f\u5254\u9664\u4e86\u5f88\u591a\u5916\u90e8\u4f9d\u8d56\u4ee5\u53ca K8s \u7684 alpha\u3001beta \u7279\u6027\uff0c\u540c\u65f6\u6539\u53d8\u4e86\u90e8\u7f72\u65b9\u5f0f\u548c\u8fd0\u884c\u65b9\u5f0f\uff0c\u76ee\u7684\u662f\u8f7b\u91cf\u5316 K8s\uff0c\u5e76\u5c06\u5176\u5e94\u7528\u4e8e IoT \u8bbe\u5907\uff08\u6bd4\u5982\u6811\u8393\u6d3e\uff09\u3002 \u7b80\u5355\u6765\u8bf4\uff0cK3s \u5c31\u662f\u9609\u5272\u7248 K8s\uff0c\u6d88\u8017\u8d44\u6e90\u6781\u5c11\u3002 K3s **\u5b98\u7f51\u6587\u6863**\u4e2d\u6709\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u672c\u6587\u4e0b\u9762\u5927\u90e8\u5206\u4e5f\u662f\u57fa\u4e8e\u6b64\u6587\u6863\u8fdb\u884c\u90e8\u7f72\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#k3s","title":"\u4e8c K3s\u7b80\u4ecb","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#21","title":"2.1 \u7b80\u4ecb","text":"<p>k3s\u662f\u7ecfCNCF\u4e00\u81f4\u6027\u8ba4\u8bc1\u7684Kubernetes\u53d1\u884c\u7248\uff0c\u4e13\u4e3a\u7269\u8054\u7f51\u53ca\u8fb9\u7f18\u8ba1\u7b97\u8bbe\u8ba1\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#22","title":"2.2 \u7279\u70b9","text":"<ul> <li>\u5b8c\u7f8e\u9002\u914d\u8fb9\u7f18\u73af\u5883\uff1ak3s\u662f\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684\u3001\u7ecf\u8fc7CNCF\u8ba4\u8bc1\u7684Kubernetes\u53d1\u884c\u7248\uff0c\u4e13\u4e3a\u65e0\u4eba\u503c\u5b88\u3001\u8d44\u6e90\u53d7\u9650\u3001\u504f\u8fdc\u5730\u533a\u6216\u7269\u8054\u7f51\u8bbe\u5907\u5185\u90e8\u7684\u751f\u4ea7\u5de5\u4f5c\u8d1f\u8f7d\u800c\u8bbe\u8ba1\u3002</li> <li> <p>\u7b80\u5355\u4e14\u5b89\u5168\uff1ak3s\u88ab\u6253\u5305\u6210\u5355\u4e2a\u5c0f\u4e8e60MB\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u8fd0\u884c\u5b89\u88c5\u3001\u8fd0\u884c\u548c\u81ea\u52a8\u66f4\u65b0\u751f\u4ea7Kubernetes\u96c6\u7fa4\u6240\u9700\u7684\u4f9d\u8d56\u6027\u548c\u6b65\u9aa4\u3002</p> </li> <li> <p>\u9488\u5bf9ARM\u8fdb\u884c\u4f18\u5316\uff1aARM64\u548cARMv7\u90fd\u652f\u6301\u4e8c\u8fdb\u5236\u6587\u4ef6\u548c\u591a\u6e90\u955c\u50cf\u3002k3s\u5728\u5c0f\u5230\u6811\u8393\u6d3e\u6216\u5927\u5230 AWS a1.4xlarge 32GiB\u670d\u52a1\u5668\u7684\u73af\u5883\u4e2d\u5747\u80fd\u51fa\u8272\u5de5\u4f5c\u3002</p> </li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#23","title":"2.3 \u5de5\u4f5c\u539f\u7406","text":"<p>\u8fd9\u53ef\u4ee5\u770b\u51fa\u6765\uff0cK8s \u6240\u6709\u63a7\u5236\u9762\u7ec4\u4ef6\u6700\u7ec8\u90fd\u4ee5\u8fdb\u7a0b\u7684\u5f62\u5f0f\u8fd0\u884c\u5728 server node \u4e0a\uff0c\u4e0d\u518d\u4ee5\u9759\u6001pod\u7684\u5f62\u5f0f\u3002\u6570\u636e\u5e93\u4f7f\u7528 SQLite \uff0c\u6ca1\u6709etcd \u90a3\u4e48\u91cd\u4e86\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u6211\u4eec\u5b89\u88c5\u90e8\u7f72\u597d K3s \u540e\uff0c\u4f7f\u7528<code>kubectl get po -n kube-system</code> \u65f6\uff0c\u5219\u4e0d\u4f1a\u6709 apiserver\u3001scheduler \u7b49\u63a7\u5236\u9762\u7684pod\u4e86\u3002</p> <p>Agent \u7aef kubelet \u548c kube proxy \u90fd\u662f\u8fdb\u7a0b\u5316\u4e86\uff0c\u6b64\u5916\u5bb9\u5668\u8fd0\u884c\u65f6\u4e5f\u7531docker \u6539\u4e3a containerd\u3002</p> <p>server node \u548c agent node \u901a\u8fc7\u7279\u6b8a\u7684\u4ee3\u7406\u901a\u9053\u8fde\u63a5\u3002</p> <p>\u4ece\u8fd9\u4e2a\u8fd0\u884c\u673a\u5236\u786e\u5b9e\u80fd\u611f\u53d7\u5230 K3s \u6781\u5927\u7684\u8f7b\u91cf\u5316\u4e86 K8s\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#24","title":"2.4 \u67b6\u6784 &amp; \u8fd0\u884c\u673a\u5236","text":"<p>\u867d\u8bf4 K3s \u5176\u5185\u6838\u5c31\u662f\u4e2a K8s\uff0c\u4f46\u662f\u4ed6\u7684\u6574\u4f53\u67b6\u6784\u548c\u8fd0\u884c\u673a\u5236\u90fd\u88ab rancher \u9b54\u6539\u4e86\u3002K3s \u76f8\u8f83\u4e8e K8s \u5176\u8f83\u5927\u7684\u4e0d\u540c\u70b9\u5982\u4e0b\uff1a</p> <ul> <li>\u5b58\u50a8etcd \u4f7f\u7528 \u5d4c\u5165\u7684 sqlite \u66ff\u4ee3\uff0c\u4f46\u662f\u53ef\u4ee5\u5916\u63a5 etcd \u5b58\u50a8</li> <li>apiserver \u3001schedule \u7b49\u7ec4\u4ef6\u5168\u90e8\u7b80\u5316\uff0c\u5e76\u4ee5\u8fdb\u7a0b\u7684\u5f62\u5f0f\u8fd0\u884c\u5728\u8282\u70b9\u4e0a</li> <li>\u7f51\u7edc\u63d2\u4ef6\u4f7f\u7528 Flannel\uff0c \u53cd\u5411\u4ee3\u7406\u5165\u53e3\u4f7f\u7528 traefik \u4ee3\u66ff ingress nginx</li> <li>\u9ed8\u8ba4\u4f7f\u7528 local-path-provisioner \u63d0\u4f9b\u672c\u5730\u5b58\u50a8\u5377</li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#_2","title":"\u4e09 \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#31","title":"3.1 \u811a\u672c\u5b89\u88c5","text":"<pre><code>curl -sfL https://get.k3s.io | sh -\n\n# \u56fd\u5185\u7528\u6237\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\u52a0\u901f\u5b89\u88c5\uff1a\ncurl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh -\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#32","title":"3.2 \u4e8c\u8fdb\u5236\u90e8\u7f72","text":"<pre><code>wget -c https://github.com/k3s-io/k3s/releases/download/v1.21.3%2Bk3s1/k3s\n# \u542f\u52a8server\n./k3s server &amp;\n\n# \u542f\u52a8agent\n\n# On a different node run the below. NODE_TOKEN comes from\n# /var/lib/rancher/k3s/server/node-token on your server\nsudo k3s agent --server https://myserver:6443 --token ${NODE_TOKEN}\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#_3","title":"\u56db \u6d4b\u8bd5","text":"<pre><code>$./k3s kubectl get nodes\nNAME            STATUS   ROLES                  AGE     VERSION\nvm-0-3-centos   Ready    control-plane,master   2m22s   v1.21.3+k3s1\n</code></pre> <ul> <li>\u4f7f\u7528kubectl\u7ba1\u7406</li> </ul> <pre><code># \u914d\u7f6e\u6587\u4ef6\u5728Kubeconfig is written to /etc/rancher/k3s/k3s.yaml\ncurl -LO https://storage.googleapis.com/kubernetes-release/release/v1.18.0/bin/linux/amd64/kubectl &amp;&amp;\\\nchmod +x ./kubectl &amp;&amp; mv ./kubectl /usr/bin/kubectl\n\n# \u914d\u7f6e\u6587\u4ef6\n$ cp /etc/rancher/k3s/k3s.yaml .kube/config\n$ kubectl get nodes\nNAME            STATUS   ROLES                  AGE     VERSION\nvm-0-3-centos   Ready    control-plane,master   5m37s   v1.21.3+k3s1\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.rancher.cn/k3s/</li> <li>https://github.com/k3s-io/k3s</li> <li>https://docs.rancher.cn/k3s/</li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/","title":"\u6700\u5c0f\u5316K8s\u73af\u5883\u90e8\u7f72\u4e4bKind","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>kind \u5373 Kubernetes In Docker\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u5c06 k8s \u6240\u9700\u8981\u7684\u6240\u6709\u7ec4\u4ef6\uff0c\u5168\u90e8\u90e8\u7f72\u5728\u4e00\u4e2adocker\u5bb9\u5668\u4e2d\uff0c\u662f\u4e00\u5957\u5f00\u7bb1\u5373\u7528\u7684 k8s \u73af\u5883\u642d\u5efa\u65b9\u6848\u3002\u4f7f\u7528 kind \u642d\u5efa\u7684\u96c6\u7fa4\u65e0\u6cd5\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528\uff0c\u4f46\u662f\u5982\u679c\u4f60\u53ea\u662f\u60f3\u5728\u672c\u5730\u7b80\u5355\u7684\u73a9\u73a9 k8s\uff0c\u4e0d\u60f3\u5360\u7528\u592a\u591a\u7684\u8d44\u6e90\uff0c\u90a3\u4e48\u4f7f\u7528 kind \u662f\u4f60\u4e0d\u9519\u7684\u9009\u62e9\u3002\u540c\u6837\uff0ckind \u8fd8\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5e2e\u4f60\u672c\u5730\u7684 k8s \u6e90\u4ee3\u7801\u6253\u6210\u5bf9\u5e94\u7684\u955c\u50cf\uff0c\u65b9\u4fbf\u6d4b\u8bd5\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#kind","title":"\u4e8c Kind\u7b80\u4ecb","text":"<p>kind\uff08Kubernetes IN Docker\uff09 \u662f\u4e00\u4e2a\u57fa\u4e8e docker \u6784\u5efa Kubernetes \u96c6\u7fa4\u7684\u5de5\u5177\uff0c\u975e\u5e38\u9002\u5408\u7528\u6765\u5728\u672c\u5730\u642d\u5efa\u57fa\u4e8e Kubernetes \u7684\u5f00\u53d1/\u6d4b\u8bd5\u73af\u5883\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#21-kind","title":"2.1 kind\u542f\u52a8\u6d41\u7a0b","text":"<ol> <li>\u67e5\u770b\u672c\u5730\u4e0a\u662f\u5426\u5b58\u5728\u4e00\u4e2a\u57fa\u7840\u7684\u5b89\u88c5\u955c\u50cf\uff0c\u9ed8\u8ba4\u662f kindest/node:v1.13.4\uff0c\u8fd9\u4e2a\u955c\u50cf\u91cc\u9762\u5305\u542b\u4e86\u9700\u8981\u5b89\u88c5\u7684\u6240\u6709\u4e1c\u897f\uff0c\u5305\u62ec\u4e86 kubectl\u3001kubeadm\u3001kubelet \u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u4ee5\u53ca\u5b89\u88c5\u5bf9\u5e94\u7248\u672c k8s \u6240\u9700\u8981\u7684\u955c\u50cf\uff0c\u90fd\u4ee5 tar \u538b\u7f29\u5305\u7684\u5f62\u5f0f\u653e\u5728\u955c\u50cf\u5185\u7684\u4e00\u4e2a\u8def\u5f84\u4e0b</li> <li>\u51c6\u5907\u4f60\u7684 node\uff0c\u8fd9\u91cc\u5c31\u662f\u505a\u4e00\u4e9b\u542f\u52a8\u5bb9\u5668\u3001\u89e3\u538b\u955c\u50cf\u4e4b\u7c7b\u7684\u5de5\u4f5c</li> <li>\u751f\u6210\u5bf9\u5e94\u7684 kubeadm \u7684\u914d\u7f6e\uff0c\u4e4b\u540e\u901a\u8fc7 kubeadm \u5b89\u88c5\uff0c\u5b89\u88c5\u4e4b\u540e\u8fd8\u4f1a\u505a\u53e6\u5916\u7684\u4e00\u4e9b\u64cd\u4f5c\uff0c\u6bd4\u5982\u50cf\u6211\u521a\u624d\u4ec5\u5b89\u88c5\u5355\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u4f1a\u5e2e\u4f60\u5220\u6389 master \u8282\u70b9\u4e0a\u7684\u6c61\u70b9\uff0c\u5426\u5219\u5bf9\u4e8e\u6ca1\u6709\u5bb9\u5fcd\u7684 pod \u65e0\u6cd5\u90e8\u7f72\u3002</li> <li>\u542f\u52a8\u5b8c\u6bd5</li> </ol>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#22-kind-vs-minikube","title":"2.2 Kind vs Minikube","text":"<ul> <li> <p>Kind \u4e0d\u662f\u6253\u5305\u4e00\u4e2a\u865a\u62df\u5316\u955c\u50cf\uff0c\u800c\u662f\u76f4\u63a5\u8bb2 K8S \u7ec4\u4ef6\u8fd0\u884c\u5728 Docker\u3002</p> </li> <li> <p>\u4e0d\u9700\u8981\u8fd0\u884c GuestOS \u5360\u7528\u8d44\u6e90\u66f4\u4f4e\u3002</p> </li> <li>\u4e0d\u57fa\u4e8e\u865a\u62df\u5316\u6280\u672f\uff0c\u53ef\u4ee5\u5728 VM \u4e2d\u4f7f\u7528\u3002</li> <li> <p>\u6587\u4ef6\u66f4\u5c0f\uff0c\u66f4\u5229\u4e8e\u79fb\u690d\u3002</p> </li> <li> <p>\u652f\u6301\u591a\u8282\u70b9 K8S \u96c6\u7fa4\u548c HA</p> </li> </ul> <p>Kind \u652f\u6301\u591a\u89d2\u8272\u7684\u8282\u70b9\u90e8\u7f72\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u63a7\u5236\u4f60\u9700\u8981\u51e0\u4e2a Master \u8282\u70b9\uff0c\u51e0\u4e2a Worker \u8282\u70b9\uff0c\u4ee5\u66f4\u597d\u7684\u6a21\u62df\u751f\u4ea7\u4e2d\u7684\u5b9e\u9645\u73af\u5883\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#_2","title":"\u4e09 \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#31-macos","title":"3.1 MacOS\u5b89\u88c5","text":"<pre><code>brew install kind\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#32-linux","title":"3.2 Linux\u7cfb\u7edf\u5b89\u88c5","text":"<p>Kind \u7684\u5b89\u88c5\u4e0d\u5305\u62ec kubectl\u548cdocker\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5728\u670d\u52a1\u5668\u5b89\u88c5Kubectl\u548cDocker</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#321-docker","title":"3.2.1 docker\u5b89\u88c5","text":"<p>```yum install -y yum-utils device-mapper-persistent-data lvm2 wget yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo yum clean all &amp;&amp; yum makecache fast yum -y install docker-ce systemctl start docker <pre><code>#### 3.2.2 kubelet\u5b89\u88c5\n\n```shell\ncurl -LO https://storage.googleapis.com/kubernetes-release/release/v1.18.0/bin/linux/amd64/kubectl &amp;&amp;\\\nchmod +x ./kubectl &amp;&amp;\\\nmv ./kubectl /usr/bin/kubectl\n</code></pre></p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#323-kind","title":"3.2.3 Kind\u5b89\u88c5","text":"<pre><code>wget https://github.com/kubernetes-sigs/kind/releases/download/0.2.1/kind-linux-amd64\nmv kind-linux-amd64 kind\nchmod +x kind\nmv kind /usr/local/bin\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#_3","title":"\u56db \u4f7f\u7528","text":"<pre><code># \u521b\u5efa\u96c6\u7fa4\n$ kind create cluster\n\n$ kubectl get po -A\nNAMESPACE     NAME                                         READY   STATUS    RESTARTS   AGE\nkube-system   coredns-86c58d9df4-vwm4m                     1/1     Running   0          6m37s\nkube-system   coredns-86c58d9df4-xxk8s                     1/1     Running   0          6m37s\nkube-system   etcd-kind-control-plane                      1/1     Running   0          5m35s\nkube-system   kube-apiserver-kind-control-plane            1/1     Running   0          5m49s\nkube-system   kube-controller-manager-kind-control-plane   1/1     Running   0          5m23s\nkube-system   kube-proxy-d8zn6                             1/1     Running   0          6m37s\nkube-system   kube-scheduler-kind-control-plane            1/1     Running   0          5m40s\nkube-system   weave-net-llqf9                              2/2     Running   1          6m37s\n$ kubectl get nodes\nNAME                 STATUS   ROLES    AGE     VERSION\nkind-control-plane   Ready    master   6m57s   v1.13.4\n$ docker ps -a\nCONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                  NAMES\n9a1318b80b5a   kindest/node:v1.13.4   \"/usr/local/bin/entr\u2026\"   7 minutes ago   Up 7 minutes   33895/tcp, 127.0.0.1:33895-&gt;6443/tcp   kind-control-plane\n$ docker images\nREPOSITORY     TAG       IMAGE ID       CREATED       SIZE\nkindest/node   v1.13.4   eaecf3d2c4de   2 years ago   1.58GB\n$ kubectl cluster-info\nKubernetes master is running at https://localhost:33895\nKubeDNS is running at https://localhost:33895/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#_4","title":"\u4e94 \u9ad8\u9636\u4f7f\u7528","text":"<p>\u6211\u4eec\u8981\u4f7f\u7528\u672c\u5730\u6587\u4ef6\u5b58\u50a8hostpath</p> <ul> <li>\u7531\u4e8e\u4f7f\u7528mac\u9700\u8981share \u76ee\u5f55\uff0c\u8bb0\u5f97\u6dfb\u52a0\u5b8c\u6210\u540e\u5e94\u7528\u91cd\u542f</li> </ul> <p></p> <pre><code>kind: Cluster\napiVersion: kind.x-k8s.io/v1alpha4\nnodes:\n- role: control-plane\n- role: worker\n- role: worker\n- role: worker\n  # add a mount from /path/to/my/files on the host to /files on the node\n  extraMounts:\n  - hostPath: /path/to/my/files/\n    containerPath: /files\n    # optional: if set, the mount is read-only.\n    # default false\n    readOnly: true\n    # optional: if set, the mount needs SELinux relabeling.\n    # default false\n    selinuxRelabel: false\n    # optional: set propagation mode (None, HostToContainer or Bidirectional)\n    # see https://kubernetes.io/docs/concepts/storage/volumes/#mount-propagation\n    # default None\n    propagation: HostToContainer\n        image: kindest/node:v1.21.1\n\n\nkind create cluster --config=kind-cluster.yaml\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.psvmc.cn/article/2021-02-27-kubernetes-start-3-kind.html</li> <li>https://kind.sigs.k8s.io/docs/user/quick-start</li> <li>https://github.com/kubernetes-sigs/kind</li> <li>https://docs.docker.com/desktop/mac/</li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/","title":"\u6700\u5c0f\u5316K8s\u73af\u5883\u90e8\u7f72\u4e4bMicroK8s","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>MicroK8s\u662f\u76ee\u524d\u6700\u5c0f\u3001\u6700\u5feb\u4e0eKubernetes\u5168\u9762\u517c\u5bb9\u7684\u96c6\u7fa4\u7cfb\u7edf\uff0c\u4e3b\u8981\u7528\u4e8e\u5de5\u4f5c\u7ad9\u548c\u5c0f\u578b\u56e2\u961f\uff0c\u4f46\u662f\u76ee\u524d\u955c\u50cf\u5e76\u6ca1\u6709\u4e0esnap\u6253\u5305\u5728\u4e00\u8d77\uff0c\u8fd8\u5728gcr.io\u4e0a\uff0c\u56fd\u5185\u4e0b\u8f7d\u4e0a\u8fd8\u662f\u6709\u95ee\u9898\u3002MicroK8s\u9002\u5408\u79bb\u7ebf\u5f00\u53d1\u3001\u539f\u578b\u5f00\u53d1\u548c\u6d4b\u8bd5\uff0c\u5c24\u5176\u662f\u8fd0\u884cVM\u4f5c\u4e3a\u5c0f\u3001\u4fbf\u5b9c\u3001\u53ef\u9760\u7684k8s\u7528\u4e8eCI/CD\u3002\u652f\u6301arm\u67b6\u6784\uff0c\u4e5f\u9002\u5408\u5f00\u53d1 IoT \u5e94\u7528\uff0c\u901a\u8fc7 MicroK8s \u90e8\u7f72\u5e94\u7528\u5230\u5c0f\u578bLinux\u8bbe\u5907\u4e0a\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/#microk8s","title":"\u4e8c MicroK8s\u7279\u70b9","text":"<ul> <li>MicroK8\u8f7b\u5de7 \uff1a\u56e2\u961f\u6210\u5458\u5e0c\u671b\u6700\u5c0f\u7684Kubernetes\u7528\u4e8e\u7b14\u8bb0\u672c\u7535\u8111\u548c\u5de5\u4f5c\u7ad9\u7684\u5f00\u53d1\u3002 MicroK8s\u63d0\u4f9b\u4e86\u8f7b\u91cf\u7ea7\u7684\u72ec\u7acbKubernetes\uff0c\u5728Ubuntu\u4e0a\u8fd0\u884c\u65f6\uff0c\u5b83\u4e0eAzure AKS\uff0cAmazon EKS\u548cGoogle GKE\u517c\u5bb9\u3002</li> <li>MicroK8\u5f88\u7b80\u5355 \uff1aMicroK8s\u901a\u8fc7\u5355\u8f6f\u4ef6\u5305\u5b89\u88c5\u6765\u6700\u5927\u7a0b\u5ea6\u5730\u51cf\u5c11\u7ba1\u7406\u548c\u64cd\u4f5c\uff0c\u8be5\u8f6f\u4ef6\u5305\u6ca1\u6709\u6d3b\u52a8\u90e8\u4ef6\uff08\u5f00\u7bb1\u5373\u7528\uff09\uff0c\u5e76\u4e14\u5305\u62ec\u6240\u6709\u4f9d\u8d56\u9879\u3002</li> <li>MicroK8\u662f\u5b89\u5168\u7684 \uff1a\u5bf9\u4e8e\u6240\u6709\u5b89\u5168\u95ee\u9898\uff0c\u66f4\u65b0\u59cb\u7ec8\u53ef\u7528\uff0c\u5e76\u4e14\u53ef\u4ee5\u7acb\u5373\u5e94\u7528\u6216\u5b89\u6392\u66f4\u65b0\u4ee5\u9002\u5408\u4f01\u4e1a\u7684\u7ef4\u62a4\u5468\u671f\u3002 \u6b64\u5916\uff0cMicroK8\u5177\u6709\u6700\u65b0\u7684\u9694\u79bb\u529f\u80fd\uff0c\u53ef\u5728\u5de5\u4f5c\u7ad9\u4e0a\u5b89\u5168\u8fd0\u884c\u3002 \u901a\u8fc7\u5c06Kubernetes\uff0cDocker.io\uff0ciptables\u548cCNI\u7684\u6240\u6709\u4e8c\u8fdb\u5236\u6587\u4ef6\u6253\u5305\u5728\u5355\u4e2asnap\u8f6f\u4ef6\u5305\u4e2d\uff0c\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u79cd\u9694\u79bb\u3002</li> <li>MicroK8\u662f\u6700\u65b0\u7684 \uff1aMicroK8s\u8ddf\u8e2a\u4e0a\u6e38Kubernetes\uff0c\u5e76\u5728\u4e0a\u6e38Kubernetes\u53d1\u884c\u7684\u540c\u4e00\u5929\u53d1\u5e03beta\uff0c\u53d1\u884c\u5019\u9009\u7248\u672c\u548c\u6700\u7ec8\u7248\u672c\u3002 \u60a8\u53ef\u4ee5\u8ddf\u8e2a\u6700\u65b0\u7684Kubernetes\u6216\u575a\u6301\u4f7f\u7528\u4ece1.10\u5f00\u59cb\u7684\u4efb\u4f55Kubernetes\u7248\u672c\u3002 \u5f53\u51fa\u73b0\u65b0\u7684\u4e3b\u8981Kubernetes\u7248\u672c\u65f6\uff0c\u60a8\u53ef\u4ee5\u81ea\u52a8\u5347\u7ea7\u6216\u4f7f\u7528\u5355\u4e2a\u547d\u4ee4\u8fdb\u884c\u5347\u7ea7\u3002</li> <li>MicroK8\u662f\u5168\u9762\u7684 \uff1aMicroK8s\u5305\u62ec\u7cbe\u9009\u7684\u6e05\u5355\uff0c\u7528\u4e8e\u5e38\u89c1\u7684Kubernetes\u529f\u80fd\u548c\u670d\u52a1\u3002 MicroK8\u5e26\u6709Docker\u6ce8\u518c\u8868\uff0c\u4f7f\u7528\u6237\u53ef\u4ee5\u5728\u7b14\u8bb0\u672c\u7535\u8111\u4e0a\u5236\u4f5c\uff0c\u63a8\u9001\u548c\u90e8\u7f72\u5bb9\u5668\u3002</li> </ul>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/#_2","title":"\u4e09 \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/#31","title":"3.1 \u8fd0\u884c\u73af\u5883","text":"<ul> <li>\u64cd\u4f5c\u7cfb\u7edf Ubuntu 18.04 LTS \u621616.04 LTS \u73af\u5883 (\u6216\u5176\u4ed6\u652f\u6301 <code>snapd</code> \u7684\u64cd\u4f5c\u7cfb\u7edf- see the snapd documentation)\u3002</li> <li>\u81f3\u5c11 20G \u78c1\u76d8\u7a7a\u95f4\uff0c \uff08\u5efa\u8bae\uff094G \u5185\u5b58\u3002</li> </ul> <pre><code>$ snap install microk8s --classic\n2021-08-06T16:56:05+08:00 INFO Waiting for automatic snapd restart...\nmicrok8s (1.21/stable) v1.21.3 from Canonical\u2713 installed\n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/#_3","title":"\u56db \u4f7f\u7528","text":"<pre><code>$ microk8s kubectl get nodes\nNAME             STATUS     ROLES    AGE    VERSION\nvm-0-17-ubuntu   NotReady   &lt;none&gt;   2m7s   v1.21.3-3+90fd5f3d2aea0a\n$ microk8s kubectl get services\nNAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE\nkubernetes   ClusterIP   10.152.183.1   &lt;none&gt;        443/TCP   2m27s\n\n# \u68c0\u6d4b\u670d\u52a1\u72b6\u6001\n$ microk8s status --wait-ready\n\n# \u542f\u7528\u76f8\u5173\u7ec4\u5efa\n$ microk8s enable dashboard dns registry istio\n\n# \u67e5\u770bk8s\n$ microk8s kubectl get all --all-namespaces\n\n# \u8bbf\u95eedashboard\n$ microk8s dashboard-proxy\n\n# \u4f7f\u7528\u4ee5\u6709kubectl\u7ba1\u7406\n$ sudo microk8s kubectl config view --raw &gt; $HOME/.kube/config\n\n# \u67e5\u770b\u63d2\u4ef6\n$ microk8s.status\n</code></pre> <p>\u4f7f\u7528\u5bbf\u4e3b\u673akubectl\u7ba1\u7406\u96c6\u7fa4</p> <pre><code>$ curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.18.0/bin/linux/amd64/kubectl &amp;&amp;\\\nchmod +x ./kubectl &amp;&amp;\\\n$ mv ./kubectl /usr/bin/kubectl\n\n$ microk8s kubectl config view --raw &gt; $HOME/.kube/config\n$ kubectl get po -A\nNAMESPACE     NAME                                      READY   STATUS     RESTARTS   AGE\nkube-system   calico-kube-controllers-f7868dd95-s4c5m   0/1     Pending    0          5m33s\nkube-system   calico-node-8mxlc                         0/1     Init:0/3   0          5m27s \n</code></pre>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/#_4","title":"\u4e94 \u5176\u4ed6","text":"<p>\u4e0eMinikube\u4e0d\u540c\uff0cIT\u7ba1\u7406\u5458\u6216\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u4f7f\u7528MicroK8s\u521b\u5efa\u591a\u8282\u70b9\u96c6\u7fa4\u3002\u5982\u679cMicroK8s\u5728Linux\u4e0a\u8fd0\u884c\uff0c\u751a\u81f3\u4e0d\u9700\u8981VM\u3002\u5728Windows\u548cmacOS\u4e0a\uff0cMicroK8s\u4f7f\u7528\u540d\u4e3aMultipass\u7684VM\u6846\u67b6\u4e3aKubernetes\u96c6\u7fa4\u521b\u5efaVM\u3002</p>"},{"location":"cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li> <p>https://github.com/ubuntu/microk8s</p> </li> <li> <p>https://microk8s.io/</p> </li> </ul>"},{"location":"cloud-native/operator/other/CronHPA/","title":"CronHPA\u521d\u63a2","text":""},{"location":"cloud-native/operator/other/CronHPA/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5728\u76ee\u524d\u5927\u90e8\u5206\u4e92\u8054\u7f51\u4f01\u4e1a\u800c\u8a00\uff0c\u5e94\u7528\u7684\u8d1f\u8f7d\u5448\u73b0\u660e\u663e\u7684\u5cf0\u8c37\u5206\u5e03\uff0c\u6709\u4e00\u5b9a\u7684\u89c4\u5f8b\u53ef\u5faa\uff0c\u4f8b\u5982\u8ba2\u9910\u5e94\u7528\uff0c\u5728\u4e2d\u534812\u70b9\uff0c\u4e0b\u53486\u70b9\uff0c\u4ee5\u53ca\u665a\u4e0a9\u70b9\u7b49\u5448\u73b0\u660e\u663e\u7684\u5cf0\u503c\u6d41\u91cf\uff0c\u5176\u5e94\u7528\u8d1f\u8f7d\u4e5f\u8fbe\u5230\u6700\u9ad8\uff0c\u4e0d\u901a\u7c7b\u578b\u7684\u4e1a\u52a1\u66f4\u5177\u957f\u65f6\u95f4\u7684\u76d1\u63a7\u6570\u636e\u4ee5\u53ca\u4e1a\u52a1\u7528\u6237\u753b\u50cf\uff0c\u80fd\u591f\u7cbe\u786e\u7684\u9884\u77e5\u5e94\u7528\u7684\u9ad8\u5cf0\u671f\uff0c\u4e00\u822c\u5bf9\u4e8e\u5e94\u7528\u8d44\u6e90\u7684\u6ce2\u5cf0\u548c\u6ce2\u8c37\u4e4b\u95f4\u76f8\u5dee3-4\u500d\uff0c\u800c\u4e14\u6ce2\u5cf0\u6765\u4e34\u53ef\u80fd\u4e0d\u662f\u7f13\u6162\u4e0a\u5347\uff0c\u800c\u662f\u77ac\u95f4\u8d1f\u8f7d\u62c9\u6ee1\u3002</p> <p>\u5bf9\u4e8e\u4f20\u7edf\u7684IDC\u4e1a\u52a1\uff0c\u53ef\u80fd\u5728\u6d3b\u52a8\u5927\u4fc3\u6216\u8005\u4e1a\u52a1\u63a8\u5e7f\u671f\u95f4\u4f1a\u63d0\u524d\u589e\u52a0\u670d\u52a1\u5668\uff0c\u4ee5\u6a2a\u5411\u6269\u5c55\uff0c\u63d0\u5347\u670d\u52a1\u6574\u4f53\u670d\u52a1\u80fd\u529b\uff0c\u5728\u4e91\u8ba1\u7b97\u4e0b\uff0c\u4e91\u5382\u5546\u57fa\u672c\u90fd\u6709\u5f39\u6027\u4f38\u7f29\u670d\u52a1\uff0c\u5bf9\u4e8e\u4e1a\u52a1\u7684\u6a2a\u5411\u6269\u5c55\uff0c\u53ef\u4ee5\u5c06\u4e1a\u52a1\u62bd\u8c61\u4e3a\u65e0\u72b6\u6001\u5e94\u7528\uff0c\u8fdb\u800c\u6839\u636e\u4e0d\u901a\u7684\u76d1\u63a7\u6307\u6807\u6765\u8fbe\u5230\u52a8\u6001\u4f38\u7f29\uff0c\u5bf9\u4e8e\u5927\u91cf\u9884\u77e5\u5e76\u53d1\uff0c\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u56fa\u5b9a\u65f6\u95f4\uff0c\u5bf9\u540e\u53f0\u8ba1\u7b97\u8d44\u6e90\u8fdb\u884c\u5b9a\u70b9\u6269\u6240\u5bb9\uff0c\u4ee5\u8fbe\u5230\u52a8\u6001\u7684\u6700\u5c0f\u5316\u6210\u672c\u6ee1\u8db3\u5e94\u7528\u4e1a\u52a1\u9700\u6c42\u3002</p> <p>\u5728\u4e91\u539f\u751f\u4e2d\uff0c\u5bb9\u5668\u7684\u51fa\u73b0\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u66f4\u52a0\u6807\u51c6\u3001\u8f7b\u91cf\u3001\u81ea\u52a8\u7684\u52a8\u6001\u6269\u6240\u5bb9\uff0c\u5728Kubernetes\u4e2d\uff0c\u53ea\u7528\u7b80\u5355\u7684\u4fee\u590dreplicase\u6570\u5373\u53ef\u5b8c\u6210\uff0c\u5bf9\u4e8e\u5f39\u6027\u6269\u6240\u5bb9\u53ea\u7528\u5b9a\u4e49HPA\u5373\u53ef\uff0c\u6839\u636e\u4e0d\u540c\u7684metric\u6765\u52a8\u6001\u8c03\u6574\u526f\u672c\u6570\u91cf\uff0c\u4f46\u662f\u5bf9\u4e8e\u5c16\u523a\u5f62\u7684\u4e1a\u52a1\u5cf0\u503c\uff0c\u7531\u4e8eHPA\u4e2d\u540e\u7aefPOD\u7684\u62c9\u8d77\u5ef6\u8fdf\uff0c\u663e\u7136\u5728\u8fd9\u79cd\u573a\u666f\u662f\u4e0d\u80fd\u5f88\u597d\u7684\u6ee1\u8db3\u7528\u6237\u9700\u6c42\u3002\u4f46\u662f\u5982\u679c\u53ea\u662f\u4eba\u5de5\u624b\u52a8\u7684\u63d0\u524d\u6269\u5c55POD\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u5468\u671f\u6027\u7684\u4e1a\u52a1\u663e\u7136\u4e5f\u662f\u4e0d\u5408\u7406\u3002</p>"},{"location":"cloud-native/operator/other/CronHPA/#_2","title":"\u4e8c \u65b9\u6848","text":""},{"location":"cloud-native/operator/other/CronHPA/#21-hpa","title":"2.1 HPA","text":"<p>\u5bf9\u4e8e\u6807\u51c6\u7684 HPA \u662f\u57fa\u4e8e\u6307\u6807\u9608\u503c\u8fdb\u884c\u4f38\u7f29\u7684\uff0c\u5e38\u89c1\u7684\u6307\u6807\u4e3b\u8981\u662f CPU\u3001\u5185\u5b58\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49\u6307\u6807\u4f8b\u5982 QPS\u3001\u8fde\u63a5\u6570\u7b49\u8fdb\u884c\u4f38\u7f29\u3002\u4f46\u662f\u8fd9\u91cc\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff1a\u57fa\u4e8e\u8d44\u6e90\u7684\u4f38\u7f29\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u5ef6\uff0c\u8fd9\u4e2a\u65f6\u5ef6\u4e3b\u8981\u5305\u542b\uff1a\u91c7\u96c6\u65f6\u5ef6(\u5206\u949f\u7ea7) + \u5224\u65ad\u65f6\u5ef6(\u5206\u949f\u7ea7) + \u4f38\u7f29\u65f6\u5ef6(\u5206\u949f\u7ea7)\u3002\u800c\u5bf9\u4e8e\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u8d1f\u8f7d\u7684\u5cf0\u503c\u6bdb\u523a\u8fd8\u662f\u975e\u5e38\u5c16\u9510\u7684\uff0c\u8fd9\u6709\u53ef\u80fd\u4f1a\u7531\u4e8e HPA \u5206\u949f\u7ea7\u522b\u7684\u4f38\u7f29\u65f6\u5ef6\u9020\u6210\u8d1f\u8f7d\u6570\u76ee\u65e0\u6cd5\u53ca\u65f6\u53d8\u5316\uff0c\u77ed\u65f6\u95f4\u5185\u5e94\u7528\u7684\u6574\u4f53\u8d1f\u8f7d\u98d9\u9ad8\uff0c\u54cd\u5e94\u65f6\u95f4\u53d8\u6162\u3002\u7279\u522b\u662f\u5bf9\u4e8e\u4e00\u4e9b\u6e38\u620f\u4e1a\u52a1\u800c\u8a00\uff0c\u7531\u4e8e\u8d1f\u8f7d\u8fc7\u9ad8\u5e26\u6765\u7684\u4e1a\u52a1\u6296\u52a8\u4f1a\u9020\u6210\u73a9\u5bb6\u975e\u5e38\u5dee\u7684\u4f53\u9a8c\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u573a\u666f\uff0c\u76ee\u524d\u963f\u91cc\u63d0\u4f9b\u4e86 <code>kube-cronhpa-controller</code>\uff0c\u4e13\u95e8\u5e94\u5bf9\u8d44\u6e90\u753b\u50cf\u5b58\u5728\u5468\u671f\u6027\u7684\u573a\u666f\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u6839\u636e\u8d44\u6e90\u753b\u50cf\u7684\u5468\u671f\u6027\u89c4\u5f8b\uff0c\u5b9a\u4e49 time schedule\uff0c\u63d0\u524d\u6269\u5bb9\u597d\u8d44\u6e90\uff0c\u800c\u5728\u6ce2\u8c37\u5230\u6765\u540e\u5b9a\u65f6\u56de\u6536\u8d44\u6e90\u3002\u5e95\u5c42\u518d\u7ed3\u5408 <code>cluster-autoscaler</code> \u7684\u8282\u70b9\u4f38\u7f29\u80fd\u529b\uff0c\u63d0\u4f9b\u8d44\u6e90\u6210\u672c\u7684\u8282\u7ea6\u3002</p>"},{"location":"cloud-native/operator/other/CronHPA/#22-cronhpa","title":"2.2 CronHPA","text":"<p>Cronhpa \uff0c\u5229\u7528\u5e95\u5c42\u4f7f\u7528\u7684\u662f<code>go-cron</code>,\u56e0\u6b64\u652f\u6301\u66f4\u591a\u7684\u89c4\u5219\u3002</p> <pre><code>  Field name   | Mandatory? | Allowed values  | Allowed special characters\n  ----------   | ---------- | --------------  | --------------------------\n  Seconds      | Yes        | 0-59            | * / , -\n  Minutes      | Yes        | 0-59            | * / , -\n  Hours        | Yes        | 0-23            | * / , -\n  Day of month | Yes        | 1-31            | * / , - ?\n  Month        | Yes        | 1-12 or JAN-DEC | * / , -\n  Day of week  | Yes        | 0-6 or SUN-SAT  | * / , - ?    \n</code></pre> <p><code>kubernetes-cronhpa-controller</code> is a kubernetes cron horizontal pod autoscaler controller using <code>crontab</code> like scheme. You can use <code>CronHorizontalPodAutoscaler</code> with any kind object defined in kubernetes which support <code>scale</code> subresource(such as <code>Deployment</code> and <code>StatefulSet</code>).</p>"},{"location":"cloud-native/operator/other/CronHPA/#_3","title":"\u4e09 \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/operator/other/CronHPA/#31","title":"3.1 \u4e0b\u8f7d\u76f8\u5173\u8d44\u6e90","text":"<pre><code>git clone https://github.com/AliyunContainerService/kubernetes-cronhpa-controller.git\n</code></pre>"},{"location":"cloud-native/operator/other/CronHPA/#32","title":"3.2 \u5b89\u88c5","text":"<ul> <li>install CRD</li> </ul> <pre><code>kubectl apply -f config/crds/autoscaling_v1beta1_cronhorizontalpodautoscaler.yaml\n</code></pre> <ul> <li>install RBAC settings</li> </ul> <pre><code># create ClusterRole \nkubectl apply -f config/rbac/rbac_role.yaml\n\n# create ClusterRolebinding and ServiceAccount \nkubectl apply -f config/rbac/rbac_role_binding.yaml\n\n[root@master ~]# kubectl api-resources  |grep cronhpa\ncronhorizontalpodautoscalers      cronhpa      autoscaling.alibabacloud.com   true         CronHorizontalPodAutoscaler\n</code></pre> <ul> <li>deploy kubernetes-cronhpa-controller</li> </ul> <pre><code>kubectl apply -f config/deploy/deploy.yaml\n</code></pre> <ul> <li>verify installation</li> </ul> <pre><code>kubectl get deploy kubernetes-cronhpa-controller -n kube-system -o wide \n\n\u279c  kubernetes-cronhpa-controller git:(master) \u2717 kubectl get deploy kubernetes-cronhpa-controller -n kube-system\nNAME                            DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-cronhpa-controller   1         1         1            1           49s\n</code></pre>"},{"location":"cloud-native/operator/other/CronHPA/#_4","title":"\u56db \u6d4b\u8bd5","text":"<p>\u8fdb\u5165examples folder\u76ee\u5f55</p> <ul> <li>\u90e8\u7f72\u521b\u5efaworkload\u548ccronhpa</li> </ul> <pre><code>kubectl apply -f examples/deployment_cronhpa.yaml \n</code></pre> <ul> <li>\u67e5\u770bdeploy\u526f\u672c\u6570</li> </ul> <pre><code>kubectl get deploy nginx-deployment-basic \n\n\u279c  kubernetes-cronhpa-controller git:(master) \u2717 kubectl get deploy nginx-deployment-basic\nNAME                     DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment-basic   2         2         2            2           9s\n</code></pre> <ul> <li>\u67e5\u770bcronhpa status</li> </ul> <pre><code>[root@master kubernetes-cronhpa-controller]# kubectl describe cronhpa cronhpa-sample \n'Name:         cronhpa-sample\nNamespace:    default\nLabels:       controller-tools.k8s.io=1.0\nAnnotations:  kubectl.kubernetes.io/last-applied-configuration:\n                {\"apiVersion\":\"autoscaling.alibabacloud.com/v1beta1\",\"kind\":\"CronHorizontalPodAutoscaler\",\"metadata\":{\"annotations\":{},\"labels\":{\"controll...\nAPI Version:  autoscaling.alibabacloud.com/v1beta1\nKind:         CronHorizontalPodAutoscaler\nMetadata:\n  Creation Timestamp:  2020-07-31T07:27:12Z\n  Generation:          5\n  Resource Version:    67753389\n  Self Link:           /apis/autoscaling.alibabacloud.com/v1beta1/namespaces/default/cronhorizontalpodautoscalers/cronhpa-sample\n  UID:                 3be95264-9b08-4efc-b9f9-db1aca7a80d8\nSpec:\n  Exclude Dates:  &lt;nil&gt;\n  Jobs:\n    Name:         scale-down\n    Run Once:     false\n    Schedule:     30 */1 * * * *\n    Target Size:  1\n    Name:         scale-up\n    Run Once:     false\n    Schedule:     0 */1 * * * *\n    Target Size:  3\n  Scale Target Ref:\n    API Version:  apps/v1beta2\n    Kind:         Deployment\n    Name:         nginx-deployment-basic\nStatus:\n  Conditions:\n    Job Id:           184b967e-a149-488d-b4ae-765f9a792f93\n    Last Probe Time:  2020-07-31T07:28:31Z\n    Message:          cron hpa job scale-down executed successfully. current replicas:3, desired replicas:1.\n    Name:             scale-down\n    Run Once:         false\n    Schedule:         30 */1 * * * *\n    State:            Succeed\n    Target Size:      1\n    Job Id:           870b014f-cfbc-4f60-a628-16f2995c288d\n    Last Probe Time:  2020-07-31T07:28:01Z\n    Message:          cron hpa job scale-up executed successfully. current replicas:1, desired replicas:3.\n    Name:             scale-up\n    Run Once:         false\n    Schedule:         0 */1 * * * *\n    State:            Succeed\n    Target Size:      3\n  Exclude Dates:      &lt;nil&gt;\n  Scale Target Ref:\n    API Version:  apps/v1beta2\n    Kind:         Deployment\n    Name:         nginx-deployment-basic\nEvents:\n  Type    Reason   Age   From                            Message\n  ----    ------   ----  ----                            -------\n  Normal  Succeed  87s   cron-horizontal-pod-autoscaler  cron hpa job scale-down executed successfully. current replicas:2, desired replicas:1.\n  Normal  Succeed  57s   cron-horizontal-pod-autoscaler  cron hpa job scale-up executed successfully. current replicas:1, desired replicas:3.\n  Normal  Succeed  27s   cron-horizontal-pod-autoscaler  cron hpa job scale-down executed successfully. current replicas:3, desired replicas:1.\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u8bbe\u5b9a\u7684\u662f\u6bcf\u5206\u949f\u7684\u7b2c 0 \u79d2\u6269\u5bb9\u5230 3 \u4e2a Pod\uff0c\u6bcf\u5206\u949f\u7684\u7b2c 30s \u7f29\u5bb9\u5230 1 \u4e2a Pod\u3002\u5982\u679c\u6267\u884c\u6b63\u5e38\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 30s \u5185\u770b\u5230\u8d1f\u8f7d\u6570\u76ee\u7684\u4e24\u6b21\u53d8\u5316\u3002\u53ef\u4ee5\u901a\u8fc7\u67e5\u770bpod\u7684\u589e\u52a0\u548c\u7f29\u51cf\u60c5\u51b5\uff0c\u53ef\u4ee5\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u66f4\u5bb9\u6613\u7684\u6765\u5b9a\u65f6\u63a7\u5236POD\u6570\u91cf\uff0c\u4ece\u800c\u5728\u6ce2\u6bb5\u6027\u4e1a\u52a1\u4e2d\uff0c\u6700\u5927\u6548\u7387\u5229\u7528\u8d44\u6e90\u3002</p>"},{"location":"cloud-native/operator/other/CronHPA/#_5","title":"\u4e94 \u53cd\u601d","text":"<p>\u76ee\u524d\u5bf9\u4e8e\u65e0\u72b6\u6001\u5e94\u7528\u53ef\u4ee5\u914d\u5408HPA\uff0c\u6216CronHPA\u6765\u5e94\u5bf9\u6a2a\u5411\u6269\u5c55\u7684\u538b\u529b\uff0c\u5bf9\u4e8e\u6709\u72b6\u6001\u5e94\u7528\uff0c\u53ef\u501f\u52a9Vertical Pod Autoscaler\uff08VPA\uff09\u6765\u8fdb\u884c\u5b9e\u73b0\uff0c\u6839\u636e\u4e1a\u52a1\u7528\u6237\u753b\u50cf\uff0c\u7cbe\u786e\u7684\u9884\u4f30\u5bb9\u91cf\u6c34\u4f4d\uff0c\u6700\u5c0f\u5316\u7684\u6210\u672c\u6765\u81ea\u52a8\u5316\u7684\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\u3002</p>"},{"location":"cloud-native/operator/other/CronHPA/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.lagou.com/lgeduarticle/8604.html</li> <li>https://github.com/AliyunContainerService/kubernetes-cronhpa-controller</li> </ul>"},{"location":"cloud-native/operator/other/k8s%20%E9%9B%86%E7%BE%A4etcd%E6%8E%92%E9%94%99/","title":"k8s \u96c6\u7fa4etcd\u6392\u9519","text":"<p>\u67e5\u770betcd\u7684pv\u88ab\u5360\u7528</p> <p></p> <pre><code>MountVolume.WaitForAttach failed for volume \"pvc-03fd17c7-f766-4629-accf-49f2e4857b07\" : rbd image kube/kubernetes-dynamic-pvc-14e0ccd9-83b0-4bd8-af16-0a200d356c8d is still being used\n</code></pre> <p>\u5728node04 \u67e5\u770b</p> <p></p> <p>\u5f3a\u5236\u5378\u8f7d</p> <p></p> <p>rbd unmap -o force /dev/rbd0</p> <p></p> <p>\u2014 </p> <p>\u91cd\u7f6e\u7f51\u7edc</p> <pre><code>#\u5728master\u8282\u70b9\u4e4b\u5916\u7684\u8282\u70b9\u8fdb\u884c\u64cd\u4f5c\nkubeadm reset\nsystemctl stop kubelet\nsystemctl stop docker\nrm -rf /var/lib/cni/\nrm -rf /var/lib/kubelet/*\nrm -rf /etc/cni/\nifconfig cni0 down\nipvsadm --clear \nifconfig flannel.1 down\nifconfig docker0 down\nip link delete cni0\nip link delete flannel.1\n##\u91cd\u542fkubelet\nsystemctl restart kubelet\n##\u91cd\u542fdocker\nsystemctl restart docker\n\niptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X\niptables -F &amp;&amp; iptables -X &amp;&amp; iptables -F -t nat &amp;&amp; iptables -X -t nat &amp;&amp; ip link del kube-ipvs0 &amp;&amp; ip link del nodelocaldns\n\nmodprobe -r ipip\nlsmod\n</code></pre> <p>\u5220\u9664tunl</p> <pre><code>Linux\u5220\u9664tunnel\u7684\u65b9\u6cd5\n\u6d4b\u8bd5lvs\u7684\u65f6\u5019\uff0c\u6dfb\u52a0\u4e86\u4e00\u4e2aIP tunnel\uff0c\u5982\u4e0b\uff1a\n\n/sbin/ifconfig tunl0 $VIP broadcast $VIP netmask 255.255.255.255 up\n\n/sbin/route add -host $VIP dev tunl0\n\n\u6d4b\u8bd5\u5b8c\u6bd5\u540e\uff0c\u5220\u9664\u8be5IP tunnel\u65f6\uff0c\u6b7b\u6d3b\u5220\u4e0d\u6389\uff0c\u63d0\u793a\u201cioctl\uff1aoperation not permitted\u201d\uff0c\u5f53\u7136\u6211\u662f\u7528root\u6743\u9650\u3002\n\n\u4e0b\u9762\u662f\u6211\u7684\u4e00\u4e9b\u5c1d\u8bd5\u8fc7\u7a0b\uff1a\n/sbin/ifconfig -a\n\u2015-\u6655\uff0c\u8fd8\u662f\u770b\u5230\u4e86tunl0\u597d\u7aef\u7aef\u7684\u5728\u90a3\u91cc\n\n/sbin/ifconfig tunl0 down\n\u2015-ping VIP,\u4ecd\u7136ping\u7684\u901a\n\nip tunnel del tunl0\n\u2015-\u63d0\u793aioctl\uff1aoperation not permitted\n\nip tunnel show\n\u2015-\u8fd8\u662f\u770b\u5230\u4e86tunl0\u597d\u7aef\u7aef\u7684\u5728\u90a3\u91cc\n</code></pre> <p>calico \u5f02\u5e38\uff1bhttps://stackoverflow.com/questions/54465963/calico-node-is-not-ready-bird-is-not-ready-bgp-not-established</p> <p>\u2014 </p> <p>https://www.cnblogs.com/00986014w/p/13683909.html</p> <p>https://cloud.tencent.com/developer/article/1469532?from=information.detail.rbd:%20unmap%20failed:%20(16)%20device%20or%20resource%20busy</p> <p>https://cloud.tencent.com/developer/article/1469533?from=article.detail.1469532</p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/","title":"\u8bb0\u4e00\u6b21K8smaster \u8282\u70b9\u4e00\u6b21\u6392\u9519\u5b9e\u6218","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#_1","title":"\u4e00 \u80cc\u666f","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#11-master01master03","title":"1.1 \u76d1\u63a7\u62a5\u8b66master01/master03\u6709\u544a\u8b66","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#12-api-server-pod","title":"1.2 \u767b\u9646\u67e5\u770bapi-server pod\u72b6\u6001","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#_2","title":"\u4e8c \u64cd\u4f5c","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#21-pod","title":"2.1 \u67e5\u770bpod\u4fe1\u606f","text":"<ul> <li>\u67e5\u770bpod\u72b6\u6001</li> </ul> <ul> <li>\u67e5\u770b\u65e5\u5fd7</li> </ul> <pre><code>[root@master01 ssl]# kubectl logs -f -n kube-system kube-apiserver-master01\n</code></pre> <ul> <li>\u67e5\u770b\u76d1\u63a7\u4fe1\u606f</li> </ul>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#22","title":"2.2 \u68c0\u6d4b\u8bc1\u4e66","text":"<p>\u4e0d\u77e5\u9053\u8bc1\u4e66\u5728\u54ea\u91cc\uff0c\u53ef\u4ee5\u67e5\u770bapiserver\u670d\u52a1\u4f7f\u7528\u7684\u8bc1\u4e66\u8fdb\u884c\u9a8c\u8bc1\u3002</p> <pre><code>curl --cacert /etc/kubernetes/ssl/ca.crt --cert =/etc/kubernetes/ssl/apiserver-kubelet-client.crt --key /etc/kubernetes/ssl/apiserver-kubelet-client.key https://127.0.0.1:6443/healthz\n</code></pre> <p></p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#master","title":"\u4e09 master\u5185\u5b58\u592a\u5c0f","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#31","title":"3.1 \u7f16\u5199\u811a\u672c","text":"<pre><code>#!/bin/bash\n\n#\u5185\u5b58\u4f7f\u7528\u8d85\u8fc7\u9600\u503c\nWARN_LINE=20\n# \u65e5\u5fd7\u8bb0\u5f55\u6587\u4ef6\nLOG_DIR=/var/log/memfree/\n[ ! -d ${LOG_DIR} ] &amp;&amp; mkdir -p ${LOG_DIR}\nLOG_FILE=$(date +%F)-memefree.log\nLOG_TOTLE=${LOG_DIR}${LOG_FILE}\n\n# \u5185\u5b58\u603b\u91cf\nMEM_TOTLE=$(free  -m | awk 'NR==2{print $2}')\n\n# \u5185\u5b58\u4f7f\u7528\u91cf\n#MEM_USE=$(free  -m | awk 'NR==2{print $3}')\n\n# \u5185\u5b58\u7a7a\u95f2\nMEM_FREE=$(free  -m | awk 'NR==2{print $4}')\n# \u5df2\u4f7f\u7528\u767e\u5206\u6bd4\n#USE_PERCENT=$(printf \"%5f\" `echo \"scale=5;${MEM_USE}/${MEM_TOTLE}\"|bc`)\nUSE_PERCENT=$(awk -v use=${MEM_FREE} -v totle=${MEM_TOTLE} 'BEGIN{printf \"%0.0f\",use/totle*100}')\n\necho ${USE_PERCENT}\nif [[ ${USE_PERCENT} -le ${WARN_LINE} ]];then\n        echo \"---------$(date +%F\" \"%T) mem free begin---------\" &gt;&gt; ${LOG_TOTLE}\n        echo \"\u5185\u5b58\u91ca\u653e\u524d\uff0c\u4f7f\u7528\u60c5\u51b5\u5982\u4e0b:\" &gt;&gt; ${LOG_TOTLE}\n        free -m &amp;&gt;&gt;${LOG_TOTLE}\n        sync\n        echo 1 &gt; /proc/sys/vm/drop_caches\n        echo 2 &gt; /proc/sys/vm/drop_caches\n        echo 3 &gt; /proc/sys/vm/drop_caches\n        echo \"\u5185\u5b58\u91ca\u653e\u7ed3\u675f\u540e\uff0c\u4f7f\u7528\u60c5\u51b5\u5982\u4e0b:\" &gt;&gt; ${LOG_TOTLE}\n        free -m &amp;&gt;&gt;${LOG_TOTLE}\n        echo \"---------$(date +%F\" \"%T) mem free end---------\" &gt;&gt; ${LOG_TOTLE}\nfi\n</code></pre>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#32","title":"3.2 \u5236\u4f5c\u5b9a\u65f6\u4efb\u52a1","text":"<ul> <li>\u67e5\u770b\u6267\u884c\u540e\u7ed3\u679c</li> </ul>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/#_3","title":"\u56db \u53cd\u601d","text":"<p>\u4e4b\u540e\u96c6\u7fa4\u518d\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u7c7b\u4f3c\u5185\u5b58\u4e0d\u8db3\u7684\u60c5\u51b5\u3002</p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/","title":"\u8bb0\u4e00\u6b21\u7ebf\u4e0ak8s\u8282\u70b9\u7ef4\u62a4","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u6536\u5230\u6d4b\u8bd5\u73af\u5883\u96c6\u7fa4\u544a\u8b66\uff0c\u767b\u9646K8s\u96c6\u7fa4\u8fdb\u884c\u3002</p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#_2","title":"\u4e8c \u6545\u969c\u5b9a\u4f4d","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#21-pod","title":"2.1 \u67e5\u770bpod","text":"<p>\u67e5\u770bkube-system node2\u8282\u70b9calico pod\u5f02\u5e38</p> <p></p> <ul> <li>\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f,\u67e5\u770bnode2\u8282\u70b9\u6ca1\u6709\u5b58\u50a8\u7a7a\u95f4\uff0ccgroup\u6cc4\u9732</li> </ul> <p></p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#22","title":"2.2 \u67e5\u770b\u5b58\u50a8","text":"<ul> <li>\u767b\u9646node2\u67e5\u770b\u670d\u52a1\u5668\u5b58\u50a8\u4fe1\u606f\uff0c\u76ee\u524d\u7a7a\u95f4\u8fd8\u5f88\u5145\u8db3</li> </ul> <ul> <li>\u96c6\u7fa4\u4f7f\u7528\u5230\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u4e3aceph\uff0c\u56e0\u6b64\u67e5\u770bceph\u96c6\u7fa4\u72b6\u6001</li> </ul>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#_3","title":"\u4e09 \u64cd\u4f5c","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#31-ceph","title":"3.1 ceph\u4fee\u590d","text":"<p>\u76ee\u524d\u67e5\u770b\u5230ceph\u96c6\u7fa4\u5f02\u5e38\uff0c\u53ef\u80fd\u5bfc\u81f4node2\u8282\u70b9cgroup\u6cc4\u9732\u5f02\u5e38\uff0c\u8fdb\u884c\u624b\u52a8\u4fee\u590dceph\u96c6\u7fa4\u3002</p> <pre><code>\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u6027\uff08inconsistent\uff09\u6307\u5bf9\u8c61\u7684\u5927\u5c0f\u4e0d\u6b63\u786e\u3001\u6062\u590d\u7ed3\u675f\u540e\u67d0\u526f\u672c\u51fa\u73b0\u4e86\u5bf9\u8c61\u4e22\u5931\u7684\u60c5\u51b5\u3002\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u6027\u4f1a\u5bfc\u81f4\u6e05\u7406\u5931\u8d25\uff08scrub error\uff09\u3002\nCEPH\u5728\u5b58\u50a8\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u7279\u6b8a\u539f\u56e0\uff0c\u53ef\u80fd\u9047\u5230\u5bf9\u8c61\u4fe1\u606f\u5927\u5c0f\u548c\u7269\u7406\u78c1\u76d8\u4e0a\u5b9e\u9645\u5927\u5c0f\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u8fd9\u4e5f\u4f1a\u5bfc\u81f4\u6e05\u7406\u5931\u8d25\u3002\n</code></pre> <p></p> <p>\u7531\u56fe\u53ef\u77e5\uff0cpg\u7f16\u53f71.7c \u5b58\u5728\u95ee\u9898\uff0c\u8fdb\u884c\u4fee\u590d\u3002</p> <ul> <li>pg\u4fee\u590d</li> </ul> <pre><code>ceph pg repair 1.7c\n</code></pre> <p></p> <ul> <li>\u8fdb\u884c\u4fee\u590d\u540e\uff0c\u7a0d\u7b49\u4e00\u4f1a\uff0c\u518d\u6b21\u8fdb\u884c\u67e5\u770b\uff0cceph\u96c6\u7fa4\u5df2\u7ecf\u4fee\u590d</li> </ul> <p></p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#32-pod","title":"3.2 \u8fdb\u884cpod\u4fee\u590d","text":"<p>\u5bf9\u5f02\u5e38pod\u8fdb\u884c\u5220\u9664\uff0c\u7531\u4e8e\u6709\u63a7\u5236\u5668\uff0c\u4f1a\u91cd\u65b0\u62c9\u8d77\u6700\u65b0\u7684pod</p> <p></p> <p>\u67e5\u770bpod\u8fd8\u662f\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u5206\u6790\u53ef\u80fd\u7531\u4e8eceph\u5f02\u5e38\uff0c\u5bfc\u81f4node2\u8282\u70b9cgroup\u6cc4\u9732\uff0c\u7f51\u4e0a\u68c0\u7d22\u91cd\u65b0\u7f16\u8bd1</p> <ol> <li> <p>Google\u4e00\u756a\u540e\u53d1\u73b0\u4e0ehttps://github.com/rootsongjc/kubernetes-handbook/issues/313 \u8fd9\u4e2a\u540c\u5b66\u7684\u95ee\u9898\u57fa\u672c\u4e00\u81f4\u3002     \u5b58\u5728\u7684\u53ef\u80fd\u6709\uff0c</p> </li> <li> <p>Kubelet \u5bbf\u4e3b\u673a\u7684 Linux \u5185\u6838\u8fc7\u4f4e - Linux version 3.10.0-862.el7.x86_64</p> </li> <li>\u53ef\u4ee5\u901a\u8fc7\u7981\u7528kmem\u89e3\u51b3</li> </ol> <p>\u67e5\u770b\u7cfb\u7edf\u5185\u6838\u5374\u662f\u4f4e\u7248\u672c</p> <p></p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#33","title":"3.3 \u6545\u969c\u518d\u6b21\u5b9a\u4f4d","text":"<p>\u6700\u540e\uff0c\u56e0\u4e3a\u5728\u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019runc\u7684\u903b\u8f91\u4f1a\u9ed8\u8ba4\u6253\u5f00\u5bb9\u5668\u7684kmem accounting\uff0c\u5bfc\u81f43.10\u5185\u6838\u53ef\u80fd\u7684\u6cc4\u6f0f\u95ee\u9898</p> <p>\u5728\u6b64\u9700\u8981\u5bf9no space left\u7684\u670d\u52a1\u5668\u8fdb\u884c reboot\u91cd\u542f\uff0c\u5373\u53ef\u89e3\u51b3\u95ee\u9898\uff0c\u51fa\u73b0\u95ee\u9898\u7684\u53ef\u80fd\u4e3a\u6bb5\u65f6\u95f4\u5185\u5220\u9664\u5927\u91cf\u7684pod\u6240\u81f4\u3002</p> <p>\u521d\u6b65\u601d\u8def\uff0c\u53ef\u4ee5\u5728\u4eca\u540e\u7684\u96c6\u7fa4\u7ba1\u7406\u6c47\u603b\uff0c\u5bf9\u670d\u52a1\u5668\u8fdb\u884c\u7ef4\u4fee\uff0c\u901a\u8fc7\u5220\u9664\u8282\u70b9\uff0c\u5e76\u5bf9\u8282\u70b9\u8fdb\u884creboot\u5904\u7406</p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#34-node2","title":"3.4 \u5bf9node2\u8282\u70b9\u8fdb\u884c\u7ef4\u62a4","text":""},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#341-node2","title":"3.4.1 \u6807\u8bb0node2\u4e3a\u4e0d\u53ef\u8c03\u5ea6","text":"<pre><code>kubectl cordon node02\n</code></pre>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#342-node2pod","title":"3.4.2 \u9a71\u9010node2\u8282\u70b9\u4e0a\u7684pod","text":"<pre><code>kubectl drain node02 --delete-local-data --ignore-daemonsets --force\n</code></pre> <p>--delete-local-data  \u5220\u9664\u672c\u5730\u6570\u636e\uff0c\u5373\u4f7femptyDir\u4e5f\u5c06\u5220\u9664\uff1b --ignore-daemonsets  \u5ffd\u7565DeamonSet\uff0c\u5426\u5219DeamonSet\u88ab\u5220\u9664\u540e\uff0c\u4ecd\u4f1a\u81ea\u52a8\u91cd\u5efa\uff1b --force  \u4e0d\u52a0force\u53c2\u6570\u53ea\u4f1a\u5220\u9664\u8be5node\u8282\u70b9\u4e0a\u7684ReplicationController, ReplicaSet, DaemonSet,StatefulSet or Job\uff0c\u52a0\u4e0a\u540e\u6240\u6709pod\u90fd\u5c06\u5220\u9664\uff1b</p> <p></p> <p>\u76ee\u524d\u67e5\u770b\u57fa\u672cnode2\u7684pod\u5747\u5df2\u5254\u9664\u5b8c\u6bd5</p> <p></p> <p></p> <p>\u6b64\u65f6\u4e0e\u9ed8\u8ba4\u8fc1\u79fb\u4e0d\u540c\u7684\u662f\uff0cpod\u4f1a<code>\u5148\u91cd\u5efa\u518d\u7ec8\u6b62</code>\uff0c\u6b64\u65f6\u7684**\u670d\u52a1\u4e2d\u65ad\u65f6\u95f4=\u91cd\u5efa\u65f6\u95f4+\u670d\u52a1\u542f\u52a8\u65f6\u95f4+readiness\u63a2\u9488\u68c0\u6d4b\u6b63\u5e38\u65f6\u95f4**\uff0c\u5fc5\u987b\u7b49\u5230<code>1/1 Running</code>\u670d\u52a1\u624d\u4f1a\u6b63\u5e38\u3002\u56e0\u6b64\u5728\u5355\u526f\u672c\u65f6\u8fc1\u79fb\u65f6\uff0c\u670d\u52a1\u7ec8\u7aef\u662f\u4e0d\u53ef\u907f\u514d\u7684\u3002</p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#343-node02","title":"3.4.3 \u5bf9node02\u8fdb\u884c\u91cd\u542f","text":"<p>\u91cd\u542f\u540enode02\u5df2\u7ecf\u4fee\u590d\u5b8c\u6210\u3002</p> <p>\u5bf9node02\u8fdb\u884c\u6062\u590d</p> <ul> <li>\u6062\u590dnode02\u53ef\u4ee5\u6b63\u5e38\u8c03\u5ea6</li> </ul> <pre><code>kubectl uncordon node02\n</code></pre> <p></p>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#_4","title":"\u56db \u53cd\u601d","text":"<ul> <li>\u540e\u671f\u53ef\u4ee5\u5bf9\u90e8\u7f72k8s \u96c6\u7fa4\u5185\u6838\u8fdb\u884c\u5347\u7ea7\u3002</li> <li>\u96c6\u7fa4\u5185\u53ef\u80fdpod\u7684\u5f02\u5e38\uff0c\u7531\u4e8e\u5e95\u5c42\u5b58\u50a8\u6216\u8005\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\uff0c\u9700\u8981\u5177\u4f53\u5b9a\u4f4d\u5230\u95ee\u9898\u8fdb\u884c\u9488\u5bf9\u6027\u4fee\u590d\u3002</li> </ul>"},{"location":"cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://blog.csdn.net/yanggd1987/article/details/108139436</li> </ul>"},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/","title":"K8s\u53ef\u89c6\u5316\u5de5\u5177\u4e4bKUR8","text":""},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#k8skur8","title":"K8s\u53ef\u89c6\u5316\u5de5\u5177\u4e4bKUR8","text":""},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#kur8","title":"\u4e00 KUR8\u7b80\u4ecb","text":"<p>KUR8 \u662f\u4e00\u4e2a Kubernetes \u62d3\u6251\u7ed3\u6784\u548c Prometheus \u6307\u6807\u7684\u53ef\u89c6\u5316\u6982\u89c8\u5f00\u6e90\u5de5\u5177\uff0c\u53ea\u9700\u8981\u4f7f\u7528\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u548c RBAC \u6388\u6743\u7684\u6743\u9650\u76f4\u63a5\u90e8\u7f72\u5230\u4f60\u7684 Kubernetes \u96c6\u7fa4\u4e2d\u5373\u53ef\u3002KUR8 \u5c06\u5728\u672c\u5730\u542f\u52a8\uff0c\u8ba9\u60a8\u4e00\u76ee\u4e86\u7136\u5730\u76d1\u63a7 Kubernetes \u96c6\u7fa4\u3002</p>"},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#_1","title":"\u4e8c \u529f\u80fd","text":""},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#21","title":"2.1 \u53ef\u89c6\u5316\u7ed3\u6784","text":"<p>**\u7ed3\u6784\uff1a**\u6d4f\u89c8 <code>Structure</code> \u9875\u9762\u53ef\u4ee5\u4ee5\u8f7b\u677e\u67e5\u770b\u4f60\u7684\u63a7\u5236\u5e73\u9762\u548c\u5de5\u4f5c\u8282\u70b9\u53ca\u5176\u6240\u6709 pod\uff0c\u5355\u51fb\u7ec4\u4ef6\u53ef\u67e5\u770b\u6709\u5173\u5176\u5143\u6570\u636e\u3001\u72b6\u6001\u548c\u89c4\u8303\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8f7b\u677e\u67e5\u627e\u6709\u5173\u4ece\u5bb9\u5668\u5230\u5165\u53e3\u7684\u4efb\u4f55\u5185\u5bb9\u7684\u955c\u50cf ID \u6216 IP \u5730\u5740\u7684\u4fe1\u606f\u3002</p> <p></p>"},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#22","title":"2.2 \u53ef\u89c6\u5316\u96c6\u7fa4\u72b6\u6001","text":"<p>**\u6307\u6807\uff1a**\u4f7f\u7528\u6211\u4eec\u7cbe\u9009\u7684\u6307\u6807\u4eea\u8868\u677f\u4e00\u76ee\u4e86\u7136\u5730\u4e86\u89e3\u96c6\u7fa4\u7684\u72b6\u6001\u3002</p>"},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#23","title":"2.3 \u81ea\u5b9a\u4e49\u6307\u6807","text":"<p>**\u81ea\u5b9a\u4e49\u6307\u6807\uff1a**\u4f7f\u7528\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u6307\u6807\u9875\u9762\u6765\u4f7f\u7528 PROMQL \u81ea\u52a8\u5b8c\u6210\u67e5\u8be2\u60f3\u8981\u7684\u4efb\u4f55\u6307\u6807</p>"},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#24","title":"2.4 \u62a5\u8b66","text":"<p>**\u62a5\u8b66\uff1a**\u4f60\u7684\u6240\u6709 Prometheus \u62a5\u8b66\u90fd\u4f1a\u663e\u793a\u5728 <code>Alerts</code> \u9009\u9879\u5361\u4e2d\uff0c\u67e5\u660e\u662f\u5426\u6709\u4efb\u4f55\u8b66\u62a5\u6b63\u5728\u89e6\u53d1\u4ee5\u53ca\u5b83\u4eec\u5c5e\u4e8e\u54ea\u4e9b\u89c4\u5219\u7ec4\u3002</p>"},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#_2","title":"\u4e09 \u90e8\u7f72","text":""},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#31-kur8","title":"3.1 \u90e8\u7f72KUR8","text":"<p>K8s\u96c6\u7fa4\u90e8\u7f72\uff0c\u7531\u4e8e\u5e94\u7528\u9700\u8981\u8bfb\u53d6K8s API\uff0c\u6240\u4ee5\u9700\u8981\u4e3a\u671f\u6388\u4e88RBAC\u6743\u9650\u3002</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: kur8-depl\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: kur8\n  template:\n    metadata:\n      labels:\n        app: kur8\n    spec:\n      containers:\n        - name: kur8\n          image: kur8/dashboard:latest\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kur8-srv\n  labels:\n    prometheus: cluster-monitoring\n    k8s-app: kube-state-metrics\nspec:\n  selector:\n    app: kur8\n  type: ClusterIP\n  ports:\n    - name: kur8\n      protocol: TCP\n      port: 3000\n      targetPort: 3000\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n name: fabric8-rbac\nsubjects:\n - kind: ServiceAccount\n   # Reference to upper's `metadata.name`\n   name: default\n   # Reference to upper's `metadata.namespace`\n   namespace: default\nroleRef:\n kind: ClusterRole\n name: cluster-admin\n apiGroup: rbac.authorization.k8s.io\n</code></pre> <p></p> <p>\u4f7f\u7528\u7aef\u53e3\u6620\u5c04\u8fdb\u884c\u67e5\u770b</p> <pre><code>kubectl port-forward deployment/kur8-depl 3068:3068\n</code></pre> <p>\u6d4f\u89c8\u5668\u8bbf\u95ee\uff1ahttp://localhost:3068</p>"},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#32-prometheus","title":"3.2 \u90e8\u7f72Prometheus","text":"<p>\u5982\u679c\u60a8\u6ca1\u6709\u5b89\u88c5 Prometheus \u5b9e\u4f8b\uff0c\u8bf7\u9996\u5148\u514b\u9686\u5b58\u50a8\u5e93\uff1a</p> <pre><code>git clone https://github.com/oslabs-beta/KUR8\n</code></pre> <p>\u5728 KUR8 \u76ee\u5f55\u4e2d\u8fd0\u884c\uff1a</p> <pre><code>kubectl create -f infra/manifests/setup\n</code></pre> <p>\u8bbe\u7f6e\u5b8c\u6210\u540e\u8fd0\u884c\uff1a</p> <pre><code>kubectl create -f infra/manifests/\n</code></pre> <p>\u5982\u679c\u60a8\u60f3\u5c06 Kur8 \u8fde\u63a5\u5230 Prometheus\uff0c\u8bf7\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6253\u5f00\u7aef\u53e3\uff1a</p> <pre><code>kubectl --namespace monitoring port-forward svc/prometheus-k8s 9090\n</code></pre> <p>\u73b0\u5728\u4f60\u5c31\u53ef\u4ee5\u5728 KUR8 \u4e2d\u67e5\u770b Prometheus \u9009\u9879\u5361\uff0c\u67e5\u770b\u548c\u521b\u5efa\u60a8\u7684\u81ea\u5b9a\u4e49\u4eea\u8868\u677f\u3002</p>"},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#_3","title":"\u56db \u6d4b\u8bd5","text":""},{"location":"cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/oslabs-beta/KUR8#structure</li> </ul>"},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/","title":"K8s\u5feb\u6377\u64cd\u4f5c\u5de5\u5177\u4e4bK9s","text":""},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u901a\u5e38\u6211\u4eec\u5728\u67e5\u770bK8s\u96c6\u7fa4\u7684\u65f6\u5019\uff0c\u5982\u679c\u6ca1\u6709web\u754c\u9762\uff0c\u9700\u8981\u5229\u7528kubectl\u547d\u4ee4\u6765\u67e5\u770b\uff0c\u8f93\u5165\u5f88\u957f\u7684\u547d\u4ee4\uff0c\u5355\u4e0d\u4e00\u5b9a\u4e00\u6b21\u6027\u5bf9\uff0c\u800c\u4e14\u91cd\u590d\u547d\u4ee4\u9700\u8981\u518d\u6b21\u8f93\u5165\uff0c\u4e3a\u4e86\u89e3\u51b3\u8be5\u95ee\u9898\uff0cK9s\u53ef\u4ee5\u5e2e\u6211\u4eec\u5feb\u901f\u5b9e\u73b0\u67e5\u770bK8s\u5404\u7c7b\u8d44\u6e90\uff0c\u7f16\u8f91\uff0c\u4fee\u6539\uff0c\u66f4\u65b0\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/#k9s","title":"\u4e8c K9s\u7b80\u4ecb","text":""},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/#21-k9s","title":"2.1 K9s\u7b80\u4ecb","text":"<p>K9s\u662f\u4e00\u4e2a\u57fa\u4e8e\u7ec8\u7aef\u7684UI\uff0c\u7528\u4e8e\u4e0eKubernetes\u96c6\u7fa4\u4ea4\u4e92\u3002\u8fd9\u4e2a\u9879\u76ee\u7684\u76ee\u7684\u662f\u4f7f\u5bfc\u822a\u3001\u89c2\u5bdf\u548c\u7ba1\u7406\u5df2\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u66f4\u5bb9\u6613\u3002K9s\u4e0d\u65ad\u5730\u76d1\u89c6Kubernetes\u7684\u53d8\u5316\uff0c\u5e76\u63d0\u4f9b\u540e\u7eed\u547d\u4ee4\u6765\u4e0e\u89c2\u5bdf\u5230\u7684\u8d44\u6e90\u4ea4\u4e92\u3002</p>"},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/#22","title":"2.2 \u7279\u6027","text":"<ul> <li> <p>\u4fe1\u606f\u89e6\u624b\u53ef\u53ca</p> </li> <li> <ul> <li>\u8ddf\u8e2a <code>Kubernetes</code> \u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u8d44\u6e90\u7684\u5b9e\u65f6\u6d3b\u52a8</li> </ul> </li> <li> <p>\u5904\u7406 <code>Kubernetes</code> \u6807\u51c6\u8d44\u6e90\u548c\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49</p> </li> <li> <p>\u96c6\u7fa4\u6307\u6807</p> </li> <li> <ul> <li>\u8ddf\u8e2a\u4e0e <code>Pod</code>\uff0c\u5bb9\u5668\u548c\u8282\u70b9\u7b49\u8d44\u6e90\u5173\u8054\u7684\u5b9e\u65f6\u6307\u6807</li> </ul> </li> <li> <p>\u9ad8\u7ea7\u7279\u6027</p> </li> <li> <ul> <li>\u63d0\u4f9b\u6807\u51c6\u7684\u96c6\u7fa4\u7ba1\u7406\u547d\u4ee4\uff0c\u4f8b\u5982\u65e5\u5fd7\uff0c\u6269\u5c55\uff0c\u7aef\u53e3\u8f6c\u53d1\uff0c\u91cd\u542f</li> </ul> </li> <li>\u5b9a\u4e49\u81ea\u5df1\u7684\u547d\u4ee4\u5feb\u6377\u65b9\u5f0f\uff0c\u4ee5\u901a\u8fc7\u547d\u4ee4\u522b\u540d\u548c\u70ed\u952e\u5feb\u901f\u5bfc\u822a</li> <li>\u652f\u6301\u63d2\u4ef6\u6269\u5c55 <code>k9s</code> \u6765\u521b\u5efa\u5c5e\u4e8e\u81ea\u5df1\u7684\u96c6\u7fa4\u64cd\u4f5c\u7ba1\u7406\u547d\u4ee4</li> <li> <p>\u5f3a\u5927\u7684\u8fc7\u6ee4\u6a21\u5f0f\uff0c\u5141\u8bb8\u7528\u6237\u5411\u4e0b\u94bb\u53d6\u5e76\u67e5\u770b\u4e0e\u5de5\u4f5c\u8d1f\u8f7d\u76f8\u5173\u7684\u8d44\u6e90</p> </li> <li> <p>\u5916\u89c2\u53ef\u5b9a\u5236</p> </li> <li> <ul> <li>\u901a\u8fc7 <code>K9s</code> \u76ae\u80a4\u5b9a\u4e49\u81ea\u5df1\u7684\u5916\u89c2</li> </ul> </li> <li> <p>\u81ea\u5b9a\u4e49/\u5b89\u6392\u8981\u6309\u8d44\u6e90\u663e\u793a\u7684\u5217</p> </li> <li> <p>Pulses-\u96c6\u7fa4\u4e8b\u52a1\u72b6\u6001\u7684\u9876\u7ea7\u4eea\u8868\u677f</p> </li> </ul>"},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/#_2","title":"\u4e09 \u5b89\u88c5\u90e8\u7f72","text":"<ul> <li>MacOS</li> </ul> <pre><code> # Via Homebrew\n brew install derailed/k9s/k9s\n # Via MacPort\n sudo port install k9s\n</code></pre> <ul> <li>Linux</li> </ul> <pre><code> # Via LinuxBrew\n brew install derailed/k9s/k9s\n # Via PacMan\n pacman -S k9s\n</code></pre> <ul> <li>Windows</li> </ul> <p><code>shell l   # Via scoop   scoop install k9s   # Via chocolatey   choco install k9s</code></p>"},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/#_3","title":"\u56db \u4f7f\u7528","text":""},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/#41","title":"4.1 \u547d\u4ee4","text":"<pre><code>$ k9s -h\nK9s is a CLI to view and manage your Kubernetes clusters.\n\nUsage:\n  k9s [flags]\n  k9s [command]\n\nAvailable Commands:\n  completion  generate the autocompletion script for the specified shell\n  help        Help about any command\n  info        Print configuration info\n  version     Print version/build info\n\nFlags:\n  -A, --all-namespaces                 Launch K9s in all namespaces\n      --as string                      Username to impersonate for the operation\n      --as-group stringArray           Group to impersonate for the operation\n      --certificate-authority string   Path to a cert file for the certificate authority\n      --client-certificate string      Path to a client certificate file for TLS\n      --client-key string              Path to a client key file for TLS\n      --cluster string                 The name of the kubeconfig cluster to use\n  -c, --command string                 Overrides the default resource to load when the application launches\n      --context string                 The name of the kubeconfig context to use\n      --crumbsless                     Turn K9s crumbs off\n      --headless                       Turn K9s header off\n  -h, --help                           help for k9s\n      --insecure-skip-tls-verify       If true, the server's caCertFile will not be checked for validity\n      --kubeconfig string              Path to the kubeconfig file to use for CLI requests\n      --logFile string                 Specify the log file (default \"/var/folders/wn/367g1v9n1bv0sg1k8qldzym80000gn/T/k9s-xuel.log\")\n  -l, --logLevel string                Specify a log level (info, warn, debug, trace, error) (default \"info\")\n      --logoless                       Turn K9s logo off\n  -n, --namespace string               If present, the namespace scope for this CLI request\n      --readonly                       Sets readOnly mode by overriding readOnly configuration setting\n  -r, --refresh int                    Specify the default refresh rate as an integer (sec) (default 2)\n      --request-timeout string         The length of time to wait before giving up on a single server request\n      --screen-dump-dir string         Sets a path to a dir for a screen dumps\n      --token string                   Bearer token for authentication to the API server\n      --user string                    The name of the kubeconfig user to use\n      --write                          Sets write mode by overriding the readOnly configuration setting\n\nUse \"k9s [command] --help\" for more information about a command.\n</code></pre> <p>\u53ef\u4ee5\u901a\u8fc7<code>k9s info</code>\u67e5\u770bk9s\u7684\u914d\u7f6e\u6587\u4ef6\u4fe1\u606f</p> <p></p>"},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/#42","title":"4.2 \u4f7f\u7528","text":"<p>\u76f4\u63a5\u8f93\u5165k9s\u5219\u76f4\u63a5\u8fdb\u5165\u9700\u8981\u67e5\u770b\u7684K8s\u96c6\u7fa4\u5185\u90e8\u3002</p> <p></p> <ul> <li>\u5bf9Pod\u8d44\u6e90\u8fdb\u884c\u67e5\u770b\uff1a</li> </ul> <p><code>d</code>\uff1adescribe pod</p> <p><code>l</code>\uff1alogs pod</p> <p><code>a</code>\uff1aattach pod</p> <p><code>e</code>\uff1aedit pod</p> <ul> <li>\u5bf9\u5176\u4ed6\u8d44\u6e90\u8fdb\u884c\u67e5\u770b</li> </ul> <p></p> <p><code>:svc</code>\uff1a\u67e5\u770bsvc\u8d44\u6e90</p> <p><code>:deploy</code>\uff1a\u67e5\u770bdeploy\u8d44\u6e90</p> <p><code>:cm</code>\uff1a\u67e5\u770bconfigmap\u8d44\u6e90</p> <p><code>:rb</code>\uff1a\u67e5\u770brbac\u8d44\u6e90</p>"},{"location":"cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/derailed/k9s</li> <li>https://k9scli.io/</li> </ul>"},{"location":"cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/","title":"K8s\u65e5\u5fd7\u67e5\u770b\u5229\u5668\u4e4bkubetail","text":""},{"location":"cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>Kubetail \u662f\u4e00\u4e2a\u5c0f\u578b bash \u811a\u672c\uff0c\u5176\u80fd\u591f\u5c06\u6765\u81ea\u4e8e\u591a\u4e2a pod \u7684\u65e5\u5fd7\u805a\u5408\u5230\u540c\u4e00\u6570\u636e\u6d41\u4e2d\u3002Kubetail \u7684\u521d\u59cb\u7248\u672c\u4e0d\u63d0\u4f9b\u8fc7\u6ee4\u6216\u9ad8\u4eae\u529f\u80fd\uff0c\u4f46\u5176\u76ee\u524d\u5df2\u7ecf\u5728 GitHub \u4e0a\u6dfb\u52a0\u4e86\u4e00\u4e2a\u5206\u652f\uff0c\u8be5\u5206\u652f\u652f\u6301\u4f7f\u7528 multitail \u5de5\u5177\u6784\u5efa\u65e5\u5fd7\u5e76\u5bf9\u65e5\u5fd7\u7740\u8272\u3002</p> <p>\u5bf9\u4e8e\u65e5\u5e38\u5982\u679c\u4e0d\u501f\u52a9\u65e5\u5fd7\u7cfb\u7edf\uff0c\u5bf9\u4e8e\u4e00\u4e2adeployment\u591a\u4e2a\u526f\u672c\uff0c\u67e5\u770b\u65e5\u5fd7\u5982\u679c\u5206\u591a\u4e2a\u7ec8\u7aef\u67e5\u770b\u5355\u72ec\u5bf9\u5e94\u4e00\u4e2apod\u975e\u5f97\u7684\u9ebb\u70e6\u800c\u4e14\u4e0d\u4fbf\u4e8e\u89c2\u5bdf\uff0c\u6b64\u523bkubetail\u53ef\u4ee5\u5c06\u591a\u4e2apod\u65e5\u5fd7\u8fdb\u884c\u805a\u5408\uff0c\u975e\u5e38\u65b9\u4fbf\u65e5\u5e38\u67e5\u770b\u3002</p>"},{"location":"cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/#_2","title":"\u4e8c \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/#21-macos","title":"2.1 macos\u5b89\u88c5","text":"<pre><code>brew tap johanhaleby/kubetail &amp;&amp; brew install kubetail\n</code></pre>"},{"location":"cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/#22-linux","title":"2.2 Linux\u5b89\u88c5","text":"<pre><code>wget https://github.com/johanhaleby/kubetail/archive/1.6.12.tar.gz\ntar -zxvf 1.6.12.tar.gz\ncd kubetail-1.6.12/\ncp kubetail /usr/bin/\n\n# \u914d\u7f6e\u547d\u4ee4\u8865\u5168\ncp completion/kubetail.bash /etc/bash_completion.d/\n</code></pre>"},{"location":"cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/#_3","title":"\u4e09 \u57fa\u672c\u7528\u6cd5","text":"<ul> <li>\u8bed\u6cd5</li> </ul> <pre><code>$\u00a0kubetail\u00a0&lt;search\u00a0term&gt;\u00a0[-h]\u00a0[-c]\u00a0[-n]\u00a0[-t]\u00a0[-l]\u00a0[-d]\u00a0[-p]\u00a0[-s]\u00a0[-b]\u00a0[-k]\u00a0[-v]\u00a0[-r]\u00a0[-i]\u00a0\n</code></pre> <ul> <li>\u53c2\u6570\u89e3\u91ca\uff1a</li> </ul> <pre><code>-c\uff1a\u6307\u5b9a\u591a\u5bb9\u5668 Pod \u4e2d\u7684\u5bb9\u5668\u540d\u79f0\n-t\uff1a\u6307\u5b9a Kubeconfig \u6587\u4ef6\u4e2d\u7684 Context\n-l\uff1a\u6807\u7b7e\u8fc7\u6ee4\u5668\uff0c\u4f7f\u7528\u00a0-l \u53c2\u6570\u4e4b\u540e\uff0c\u4f1a\u5ffd\u7565 Pod \u540d\u79f0\n-n\uff1a\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\n-s\uff1a\u6307\u5b9a\u8fd4\u56de\u4e00\u4e2a\u76f8\u5bf9\u65f6\u95f4\u4e4b\u540e\u7684\u65e5\u5fd7\uff0c\u4f8b\u5982 5s\uff0c2m \u6216\u8005 3h\uff0c\u7f3a\u7701\u662f 10s\n-b\uff1a\u662f\u5426\u4f7f\u7528 line-buffered\uff0c\u7f3a\u7701\u4e3a\u00a0false\n-k\uff1a\u6307\u5b9a\u8f93\u51fa\u5185\u5bb9\u7684\u5177\u4f53\u7740\u8272\u90e8\u5206\uff0cpod\uff1a\u53ea\u7ed9 pod \u540d\u79f0\u4e0a\u8272\uff0cline\uff1a\u6574\u884c\u4e0a\u8272\uff08\u7f3a\u7701\uff09\uff0cfalse\uff1a\u4e0d\u4e0a\u8272\n</code></pre> <ul> <li>\u5b9e\u4f8b\uff1a</li> </ul> <pre><code>$\u00a0kubetail\u00a0my-pod-v1\n$\u00a0kubetail\u00a0my-pod-v1\u00a0-c\u00a0my-container\n$\u00a0kubetail\u00a0my-pod-v1\u00a0-t\u00a0int1-context\u00a0-c\u00a0my-container\n$\u00a0kubetail\u00a0'(service|consumer|thing)'\u00a0-e\u00a0regex\n$\u00a0kubetail\u00a0-l\u00a0service=my-service\n$\u00a0kubetail\u00a0--selector\u00a0service=my-service\u00a0--since\u00a010m\n$\u00a0kubetail\u00a0--tail\u00a01\n</code></pre>"},{"location":"cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/#_4","title":"\u56db \u6d4b\u8bd5","text":"<pre><code> xuel@kaliarchmacbookpro \ue0b0 ~ \ue0b0 kubectl get po -n default |grep smart\nsmart-bc8c658cf-6ffpx                2/2       Running   3          2d\nsmart-5f99d9bdcc-lqr8g                  1/1       Running   0          84d\nsmart-765dbf6f-7fvjn                  2/2       Running   0          84d\nsmart-765dbf6f-wjz42                  2/2       Running   0          84d\n\n# ns\u5199\u5728\u6700\u540e\n xuel@kaliarchmacbookpro \ue0b0 ~ \ue0b0 kubetail smart-celery-765dbf6f -n default\nWill tail 4 logs...\n</code></pre>"},{"location":"cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/#_5","title":"\u4e94 \u5176\u4ed6","text":"<p>kubetail\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u67e5\u770b\u591a\u4e2a\u5bb9\u5668\u65e5\u5fd7\uff0c\u5176\u672c\u8eab\u4e3ashell\u811a\u672c\uff0c\u5b89\u88c5\u975e\u5e38\u65b9\u4fbf\uff0c\u5728\u6ca1\u6709\u4f7f\u7528\u65e5\u5fd7\u7cfb\u7edf\u67e5\u770b\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u767b\u5f55\u96c6\u7fa4\u4f7f\u7528kubetail\u4e00\u4e2adeployment\u591a\u4e2apod\u526f\u672c\u975e\u5e38\u7684\u65b9\u4fbf\u3002 </p>"},{"location":"cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/#_6","title":"\u516d \u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/johanhaleby/kubetail</li> </ul>"},{"location":"cloud-native/operator/tools/K8s%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%E4%B9%8Bsniff/","title":"K8s \u7f51\u7edc\u6293\u5305\u4e4bsniff","text":""},{"location":"cloud-native/operator/tools/K8s%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%E4%B9%8Bsniff/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://mp.weixin.qq.com/s/zIfhiD7Ch8hb2MAEO1O5fg</li> </ul>"},{"location":"cloud-native/operator/tools/K8s%E8%89%B2%E5%BD%A9%E8%BE%93%E5%87%BA%E5%B7%A5%E5%85%B7%E4%B9%8Bkubecolor/","title":"K8s\u8272\u5f69\u8f93\u51fa\u5de5\u5177\u4e4bkubecolor","text":""},{"location":"cloud-native/operator/tools/K8s%E8%89%B2%E5%BD%A9%E8%BE%93%E5%87%BA%E5%B7%A5%E5%85%B7%E4%B9%8Bkubecolor/#_1","title":"\u4e00 \u80cc\u666f","text":"<p><code>kubectl</code>\u547d\u4ee4\u662fk8s\u7684<code>CLI</code>\u5de5\u5177\uff0c\u5982\u679c\u4f60\u662f\u7ef4\u62a4K8s\u96c6\u7fa4\u7684\u7ba1\u7406\u5458\u6216\u8005\u662f\u5f00\u53d1\u53ef\u5728Kubernetes\u4e0a\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1\u4eba\u5458\uff0c\u90a3\u51e0\u4e4e\u6bcf\u5929\u90fd\u4f1a\u4f7f\u7528kubectl\uff0c\u4f46\u662f\u5c3d\u7ba1kubectl\u5df2\u7ecf\u5f88\u597d\uff0c\u5b83\u4f9d\u65e7\u6709\u4e9b\u5730\u65b9\u8ba9\u4eba\u5341\u5206\u7684\u5934\u75bc\u3002\u6bd4\u5982<code>\u7f3a\u5c11\u989c\u8272</code>\uff0ckubectl\u7684\u8f93\u51fa<code>\u6709\u65f6\u4e0d\u5bb9\u6613\u9605\u8bfb\uff0c\u7531\u4e8ekubectl\u6709\u65f6\u4f1a\u8f93\u51fa\u5f88\u957f\u7684\u5185\u5bb9\uff0c\u56e0\u6b64\u5f88\u96be\u627e\u5230\u6240\u9700\u7684\u5185\u5bb9</code>\u3002\u56e0\u6b64\u5982\u679c\u6709\u4e2a\u80fd\u9ad8\u4eae\u989c\u8272\u663e\u793a\u8f93\u51fa\u7684\u5de5\u5177\uff0c\u770b\u8d77\u6765\u5c31\u76f8\u5bf9\u7684\u66f4\u52a0\u76f4\u89c2\u4e86\uff0c\u6240\u4ee5<code>kubecolor</code>\u6765\u4e86\u3002</p>"},{"location":"cloud-native/operator/tools/K8s%E8%89%B2%E5%BD%A9%E8%BE%93%E5%87%BA%E5%B7%A5%E5%85%B7%E4%B9%8Bkubecolor/#_2","title":"\u4e8c \u5b89\u88c5","text":""},{"location":"cloud-native/operator/tools/K8s%E8%89%B2%E5%BD%A9%E8%BE%93%E5%87%BA%E5%B7%A5%E5%85%B7%E4%B9%8Bkubecolor/#21-mac","title":"2.1 mac\u5b89\u88c5","text":"<pre><code>$ brew install dty1er/tap/kubecolor\n</code></pre> <p>\u6211\u8fd9\u8fb9\u7ec8\u7aef\u4f7f\u7528\u7684\u662f<code>iterm2</code>\u548c<code>oh-my-zsh</code>\uff0c\u56e0\u6b64\u8fd9\u91cc\u76f4\u63a5\u5728<code>vim ./.zshrc</code>\u4fee\u6539\u5c31\u53ef\u4ee5\u4e86,\u6bd4\u5982\u6211\u7684\u6587\u4ef6\u5185\u5bb9</p> <pre><code># kubectl get resource\nalias kubectl=\"kubecolor\"\nalias k=\"kubecolor\"\nalias kn=\"kubectl get nodes -o wide\"\nalias kp=\"kubectl get pods -o wide\"\nalias kd=\"kubectl get deployment -o wide\"\nalias ks=\"kubectl get svc -o wide\"\n# kubectl describe resources\nalias kdp=\"kubectl describe pod\"\nalias kdd=\"kubectl describe deployment\"\nalias kds=\"kubectl describe service\"\nalias kdn=\"kubectl describe node\"\n</code></pre>"},{"location":"cloud-native/operator/tools/K8s%E8%89%B2%E5%BD%A9%E8%BE%93%E5%87%BA%E5%B7%A5%E5%85%B7%E4%B9%8Bkubecolor/#22-go","title":"2.2 go \u5b89\u88c5","text":"<pre><code>$ go get -u github.com/dty1er/kubecolor/cmd/kubecolor\n</code></pre>"},{"location":"cloud-native/operator/tools/K8s%E8%89%B2%E5%BD%A9%E8%BE%93%E5%87%BA%E5%B7%A5%E5%85%B7%E4%B9%8Bkubecolor/#_3","title":"\u4e09 \u4f7f\u7528","text":"<ul> <li>\u67e5\u770bk8s\u8d44\u6e90</li> </ul> <ul> <li>describe</li> </ul>"},{"location":"cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/","title":"Kubernetes \u516d\u6b3e\u5907\u4efd\u8fd8\u539f\u5de5\u5177","text":""},{"location":"cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u4f20\u7edf\u7684\u5907\u4efd\u548c\u707e\u96be\u6062\u590d\u5e94\u7528\u7a0b\u5e8f\u5f80\u5f80\u4e0d\u80fd\u5f88\u597d\u5730\u5728\u5bb9\u5668\u5316\u73af\u5883\u4e2d\u53d1\u6325\u4f5c\u7528\u3002\u8fd9\u4e9b\u7c7b\u578b\u7684\u6570\u636e\u4fdd\u62a4\u4ea7\u54c1\u5e38\u5e38\u4fa7\u91cd\u4e8e\u4fdd\u62a4\u5355\u4e2a\u670d\u52a1\u5668\u4ee5\u53ca\u8fd0\u884c\u5728\u4e0a\u9762\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u4f46\u662f\u5728Kubernetes\u73af\u5883\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u901a\u5e38\u662f\u5e7f\u6cdb\u5206\u5e03\u7684\uff0c\u6709\u65f6\u9700\u8981\u542f\u52a8\u591a\u4e91\u548c\u591a\u4e2a\u6570\u636e\u4e2d\u5fc3\u3002\u6b64\u5916\uff0c\u5bb9\u5668\u5f80\u5f80\u5177\u6709\u9ad8\u5ea6\u77ac\u65f6\u6027\uff0c\u8fd9\u4e5f\u7ed9\u5907\u4efd\u5e94\u7528\u5e26\u6765\u91cd\u5927\u6311\u6218\u3002\u56e0\u6b64\uff0c\u5145\u5206\u4fdd\u62a4\u8fd9\u4e9b\u5e94\u7528\u7684\u552f\u4e00\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528\u4e13\u95e8\u4e3aKubernetes\u6253\u9020\u7684\u5907\u4efd\u5de5\u5177\u3002</p> <p>\u867d\u7136\u4e0d\u50cf\u4f20\u7edf\u7684\u5907\u4efd\u548c\u707e\u96be\u6062\u590d\u7684\u4ea7\u54c1\u90a3\u6837\u666e\u904d\uff0c\u4f46\u5982\u4eca\u4e5f\u51fa\u73b0\u4e86\u8bb8\u591aKubernetes\u5907\u4efd\u5de5\u5177\u53ef\u4f9b\u4f7f\u7528\u3002Veeam\u5728\u5ba3\u5e03\u4e0eKasten\u5408\u4f5c\u63d0\u4f9bKubernetes\u539f\u751f\u5907\u4efd\u4ea7\u54c1\u51e0\u4e2a\u6708\u540e\uff0c\u4e8e9\u670825\u65e5\u6536\u8d2d\u4e86Kasten\uff0c\u8fd9\u52a0\u901f\u4e86\u4e24\u5bb6\u516c\u53f8\u4ea7\u54c1\u7684\u6574\u5408\u3002\u540c\u6837\uff0cZerto\u4e5f\u5ba3\u5e03\u4e86\u5176Zerto for Kubernetes\u4ea7\u54c1\uff0c\u8be5\u4ea7\u54c1\u5c06\u4e8e2021\u5e74\u4e0a\u5e02\u3002Cohesity\u6700\u8fd1\u4e5f\u63a8\u51fa\u4e86\u81ea\u5df1\u7684\u4fdd\u62a4Kubernetes\u5e94\u7528\u3002\u5f88\u660e\u663e\uff0cKubernetes\u5728\u5907\u4efd\u9886\u57df\u6b63\u5728\u83b7\u5f97\u5e7f\u6cdb\u7684\u5e94\u7528\u3002</p> <p>\u5728\u672c\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u7814\u7a766\u6b3e\u77e5\u540d\u7684Kubernetes\u5907\u4efd\u5de5\u5177\u7684\u7279\u70b9\u548c\u529f\u80fd\u3002\u5728\u4e86\u89e3\u5177\u4f53\u7684\u5907\u4efd\u5de5\u5177\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u9009\u62e9Kubernetes\u5907\u4efd\u5de5\u5177\u9700\u8981\u8003\u8651\u7684\u4e3b\u8981\u56e0\u7d20\uff1a</p> <ul> <li>**\u6570\u636e\u4fdd\u62a4\u9700\u6c42\uff1a**\u4e00\u4e2a\u4f01\u4e1a\u5e94\u8be5\u9996\u5148\u8003\u8651\u5176Kubernetes\u67b6\u6784\u548c\u5907\u4efd\u9700\u6c42\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5b83\u4f7f\u7528\u7684\u662f\u57fa\u4e8e\u4e91\u7684Kubernetes\u96c6\u7fa4\uff0c\u5b83\u5c06\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u80fd\u5728\u8be5\u4f01\u4e1a\u4f7f\u7528\u7684\u4e91\u4e2d\u5de5\u4f5c\u7684\u4ea7\u54c1\u3002\u540c\u6837\uff0c\u4e00\u4e2a\u62e5\u6709\u591a\u4e2a\u96c6\u7fa4\u7684\u4f01\u4e1a\u53ef\u80fd\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u80fd\u591f\u8fdb\u884c\u8de8\u96c6\u7fa4\u6062\u590d\u7684\u4ea7\u54c1\u3002</li> <li>**\u4e3b\u8981\u7279\u6027\uff1a**\u529f\u80fd\u7279\u6027\u662f\u4e3b\u8981\u7684\u8003\u8651\u56e0\u7d20\u3002\u8bf7\u8bb0\u4f4f\uff0c\u4e0d\u662f\u6bcf\u4e2aKubernetes\u5907\u4efd\u4ea7\u54c1\u90fd\u6709GUI\u754c\u9762\u6216\u8005\u90fd\u80fd\u591f\u521b\u5efa\u8c03\u5ea6\u7684\u5907\u4efd\u3002\u4e00\u5bb6\u4f01\u4e1a\u5728\u786e\u5b9a\u4e00\u4e2a\u4ea7\u54c1\u4e4b\u524d\uff0c\u5fc5\u987b\u8003\u8651\u54ea\u4e9b\u529f\u80fd\u662f\u6700\u91cd\u8981\u7684\u3002</li> <li>**\u5b89\u5168\u548c\u5408\u89c4\u6027\uff1a**\u4f01\u4e1a\u9009\u62e9\u4e00\u4e2a\u4e0e\u5b89\u5168\u548c\u5408\u89c4\u6027\u76f8\u5339\u914d\u7684\u4ea7\u54c1\u975e\u5e38\u91cd\u8981\u3002\u4e00\u4e9bKubernete\u5907\u4efd\u5de5\u5177\u9ad8\u5ea6\u91cd\u89c6\u5b89\u5168\uff0c\u800c\u5176\u4ed6\u4ea7\u54c1\u5219\u6bd4\u8f83\u5b9e\u7528\uff0c\u6ca1\u6709\u63d0\u4f9b\u5b89\u5168\u65b9\u9762\u7684\u529f\u80fd\u3002</li> <li>**\u603b\u6210\u672c\uff1a**\u4ef7\u683c\u5f53\u7136\u4e5f\u662f\u4e00\u4e2a\u5341\u5206\u91cd\u8981\u7684\u8003\u8651\u56e0\u7d20\uff0c\u4f46\u4f01\u4e1a\u9700\u8981\u4e86\u89e3\u5230\u603b\u6210\u672c\u4e5f\u8bb8\u4e0d\u4ec5\u4ec5\u53ea\u5305\u62ec\u8ba2\u9605\u7684\u4ef7\u683c\u3002\u5382\u5546\u4e5f\u8bb8\u8fd8\u4f1a\u8981\u6c42\u4f01\u4e1a\u8d2d\u4e70\u6280\u672f\u652f\u6301\u3002</li> <li>**\u5148\u8bd5\u540e\u4e70\uff1a**\u4e00\u65e6\u4f01\u4e1a\u7f29\u5c0f\u4e86\u5176\u6f5c\u5728\u9009\u9879\u7684\u5217\u8868\uff0c\u5b83\u5e94\u8be5\u4e86\u89e3\u8fd9\u4e9bKubernetes\u5907\u4efd\u5de5\u5177\u662f\u5426\u63d0\u4f9b\u514d\u8d39\u8bd5\u7528\u3002\u8fd9\u5c06\u4f7f\u4f01\u4e1a\u6709\u673a\u4f1a\u5728\u627f\u8bfa\u8d2d\u4e70\u4e4b\u524d\u5145\u5206\u8bc4\u4f30\u8be5\u4ea7\u54c1\u662f\u5426\u6ee1\u8db3\u5176\u9700\u8981\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/#_2","title":"\u4e8c \u5de5\u5177","text":""},{"location":"cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/#21-rancher","title":"2.1 Rancher","text":"<p>Rancher Labs\u5e76\u4e0d\u662f\u4e00\u5bb6\u5907\u4efd\u4ea7\u54c1\u5382\u5546\uff0c\u800c\u662f\u4e00\u5bb6\u4e3a\u4f7f\u7528\u5bb9\u5668\u7684\u4f01\u4e1a\u63d0\u4f9b\u5b8c\u6574\u89e3\u51b3\u65b9\u6848\u5806\u6808\u7684\u516c\u53f8\u3002\u5176\u65d7\u8230\u4ea7\u54c1Rancher\u662f\u76ee\u524d\u4e1a\u754c\u5e94\u7528\u6700\u4e3a\u5e7f\u6cdb\u7684Kubernetes\u7ba1\u7406\u5e73\u53f0\uff0c\u8be5\u4ea7\u54c1\u63d0\u4f9bKubernetes\u5907\u4efd\u529f\u80fd\u3002</p> <p>Rancher\u662f\u4e3a\u4e86\u4e0e\u5404\u79cd\u5bb9\u5668\u8f6f\u4ef6\u4e00\u8d77\u4f7f\u7528\u800c\u6784\u5efa\u7684\uff0c\u56e0\u6b64\u5176\u5907\u4efd\u7684\u5de5\u4f5c\u65b9\u5f0f\u4e5f\u6709\u6240\u4e0d\u540c\uff0c\u8fd9\u53d6\u51b3\u4e8e\u4f01\u4e1a\u4f7f\u7528\u7684\u662f\u54ea\u79cd\u7c7b\u578b\u7684\u5bb9\u5668\u3002\u4f8b\u5982\uff0c\u4f7f\u7528Docker\u5bb9\u5668\u7684\u4f01\u4e1a\u9700\u8981\u4f7f\u7528\u4e00\u4e9b\u7cfb\u5217Docker\u547d\u4ee4\u6765\u521b\u5efa\u4e00\u4e2atarball\uff0c\u4f5c\u4e3aRancher server\u6570\u636e\u7684\u5907\u4efd\u3002</p> <p>Rancher\u76ee\u524d\u652f\u6301\u5bf9\u5176K3s\u53d1\u884c\u7248\u3001RKE\u548cDocker\u90e8\u7f72\u8fdb\u884c\u5907\u4efd\u3002\u8fdb\u884c\u5907\u4efd\u4e4b\u540e\uff0c\u5982\u679c\u4f60\u8bef\u5220\u4e86\u67d0\u4e9b\u8282\u70b9\u6216\u96c6\u7fa4\uff0c\u53ef\u4ee5\u6839\u636e\u4ee5\u4e0b\u6559\u7a0b\u64cd\u4f5c\u6062\u590d\uff1a</p> <p>\u8bef\u5220\u8282\u70b9\u6216\u96c6\u7fa4\u600e\u4e48\u529e\uff1f\u8fd9\u91cc\u6709\u4e00\u9897\u540e\u6094\u836f</p>"},{"location":"cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/#22-kubedr","title":"2.2 KubeDR","text":"<p>KubeDR\u662fCatalogic Software\u516c\u53f8\u7684\u5f00\u6e90Kubernetes\u5907\u4efd\u5de5\u5177\uff0c\u8fd9\u4e2a\u5de5\u5177\u662f\u4e3a\u4e86\u7b80\u5316\u590d\u6742\u7684Kubernetes\u90e8\u7f72\u5907\u4efd\u4efb\u52a1\u800c\u5f00\u53d1\u7684\u3002KubeDR\u4e0d\u9700\u8981\u7ba1\u7406\u5458\u6807\u8bb0\u4ed6\u4eec\u9700\u8981\u4fdd\u62a4\u7684\u8d44\u6e90\uff0c\u800c\u662f\u81ea\u52a8\u5907\u4efd\u96c6\u7fa4\u914d\u7f6e\u3001\u5176\u5143\u6570\u636e\u548c\u8bc1\u4e66\u3002</p> <p>KubeDR\u4e5f\u7b80\u5316\u4e86\u5907\u4efd\u6d41\u7a0b\u3002\u7531\u4e8e\u5b83\u5907\u4efd\u4e86\u6240\u6709\u7684\u96c6\u7fa4\u7ec4\u4ef6\uff0c\u5b83\u53ef\u4ee5\u6267\u884c\u81ea\u52a8\u96c6\u7fa4\u6062\u590d\uff0c\u5e76\u8f7b\u677e\u91cd\u5efa\u4e00\u4e2a\u6545\u969c\u7684\u96c6\u7fa4\u3002</p> <p>KubeDR\u5907\u4efdKubernetes\u6570\u636e\u5230AWS S3\u5e76\u4e14\u652f\u6301\u4f7f\u7528\u4fdd\u7559\u653f\u7b56\u3002\u8be5\u8f6f\u4ef6\u8fd8\u63d0\u4f9b\u4e86\u81ea\u52a8\u6e05\u7406\u3001\u6839\u636e\u9700\u8981\u6682\u505c\u548c\u6062\u590d\u5907\u4efd\u7b49\u529f\u80fd\u3002</p> <ul> <li>https://github.com/catalogicsoftware/kubedr</li> <li>https://catalogicsoftware.com/clab-docs/kubedr/userguide/</li> </ul>"},{"location":"cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/#23-kasten-k10","title":"2.3 Kasten K10","text":"<p>Kasten Inc.\u5c06\u5176Kubernetes\u6570\u636e\u4fdd\u62a4\u4ea7\u54c1K10\u63a8\u5411\u5e02\u573a\uff0c\u4f46\u5b83\u4e0d\u4ec5\u4ec5\u662f\u4e00\u4e2aKubernetes\u5907\u4efd\u4ea7\u54c1\uff0c\u800c\u662f\u4e00\u4e2a\u6570\u636e\u7ba1\u7406\u5e73\u53f0\u3002K10\u662f\u6784\u5efa\u5728\u4f01\u4e1a\u7684Kubernetes\u96c6\u7fa4\u4e0a\u81ea\u5df1\u7684\u547d\u540d\u7a7a\u95f4\u5185\u8fd0\u884c\u7684\uff0c\u5e76\u652f\u6301\u6240\u6709\u4e3b\u8981\u7684Kubernetes\u53d1\u884c\u7248\u3002\u5b83\u5e26\u6709\u4e00\u4e2a\u76f4\u89c2\u7684\u3001\u57fa\u4e8eGUI\u4eea\u8868\u677f\u7684\u7ba1\u7406\u5de5\u5177\uff0c\u652f\u6301\u547d\u4ee4\u884c\u3002\u8be5\u8f6f\u4ef6\u901a\u8fc7\u81ea\u52a8\u53d1\u73b0\u5e94\u7528\u7a0b\u5e8f\uff0c\u5305\u62ec\u90a3\u4e9b\u8de8\u5377\u6216\u6570\u636e\u5e93\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u7b80\u5316\u4e86\u5907\u4efd\u8fc7\u7a0b\u3002\u6b64\u5916\uff0cK10\u8fd8\u5305\u62ec\u8bb8\u591a\u5b89\u5168\u529f\u80fd\uff0c\u5982\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff08RBAC\uff09\u548c\u5bf9\u9759\u6b62\u548c\u6d3b\u52a8\u7684\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\u3002</p> <p>\u6700\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cK10\u5bf9\u5404\u79cd\u884c\u4e1a\u6807\u51c6\u7684\u652f\u6301\u3002\u9664\u4e86\u652f\u6301\u4f17\u591aKubernetes\u53d1\u884c\u7248\uff0cK10\u8fd8\u652f\u6301PostgreSQL\u3001MongoDB\u3001MySQL\u3001Cassandra\u548cAWS\u5173\u7cfb\u578b\u6570\u636e\u5e93\u670d\u52a1\u7b49\u6570\u636e\u670d\u52a1\u3002\u6b64\u5916\uff0c\u5b83\u8fd8\u652f\u6301\u4f17\u591a\u5382\u5546\u548c\u4e91\u63d0\u4f9b\u5546\u7684\u5b58\u50a8\uff0c\u5305\u62ecNetApp\u3001\u5fae\u8f6f\u7b49\u3002</p> <ul> <li>https://www.veeam.com/cn/kubernetes-native-backup-and-restore.html?ad=menu-products</li> </ul>"},{"location":"cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/#24-portworx-px-backup","title":"2.4 Portworx PX-Backup","text":"<p>PX-Backup\u662f\u7531Portworx\u63a8\u51fa\u7684\u4e00\u6b3e\u4f01\u4e1a\u7ea7\u5e94\u7528\uff0c\u4e13\u4e3aKubernetes\u63d0\u4f9b\u6570\u636e\u4fdd\u62a4\u3002\u5b83\u7684\u6784\u5efa\u662f\u4e3a\u4e86\u5728\u547d\u540d\u7a7a\u95f4\u3001Pod\u6216\u6807\u7b7e\u7ea7\u522b\u4e0a\u5907\u4efd\u4efb\u4f55Kubernetes\u5e94\u7528\uff0c\u5e76\u4e0e\u591a\u4e2a\u547d\u540d\u7a7a\u95f4\u4e00\u8d77\u5de5\u4f5c\u3002</p> <p>PX-Backup\u7684\u53ef\u6269\u5c55\u6027\u4f7f\u7ba1\u7406\u5458\u80fd\u591f\u6309\u9700\u521b\u5efa\u5907\u4efd\uff0c\u6216\u4e00\u952e\u8f7b\u677e\u8c03\u5ea6\u6570\u767e\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u5907\u4efd\u3002PX-Backup\u652f\u6301\u8de8\u8d8a\u591a\u4e2a\u6570\u636e\u5e93\u7684\u5e94\u7528\uff0c\u5e76\u80fd\u5c06\u5e94\u7528\u8fd8\u539f\u5230\u5fae\u8f6f\u3001\u4e9a\u9a6c\u900a\u6216\u8c37\u6b4c\u4e91\u7aef\u3002</p>"},{"location":"cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/#25-triliovault","title":"2.5 TrilioVault","text":"<p>Trilio\u7684\u4e91\u539f\u751fKubernetes\u6570\u636e\u4fdd\u62a4\u4ea7\u54c1TrilioVault\u662f\u4e00\u6b3e\u53ef\u65e0\u9650\u6269\u5c55\u7684\u5907\u4efd\u4ea7\u54c1\uff0c\u7ba1\u7406\u5458\u53ef\u4ee5\u4ece\u7ea2\u5e3dOperatorHub\u5b89\u88c5\u3002\u8be5\u8f6f\u4ef6\u53ef\u4ee5\u6267\u884c\u57fa\u4e8e\u5feb\u7167\u7684\u5907\u4efd\u548c\u8fd8\u539f\u64cd\u4f5c\u5230\u4e91\u7aef\u3002\u7136\u800c\uff0cTrilioVault\u662f\u6ca1\u6709\u4efb\u4f55\u4e91\u9501\u5b9a\u7684\uff0c\u8fd9\u610f\u5473\u7740\u7ba1\u7406\u5458\u53ef\u4ee5\u4ece\u4efb\u4f55\u4e91\uff08\u751a\u81f3\u662f\u6df7\u5408\u4e91\uff09\u4e0a\u8fd0\u884c\u7684Kubernetes\u6216OpenShift\u96c6\u7fa4\u4e2d\u5907\u4efd\u5e94\u7528\u7a0b\u5e8f\u6216\u5c06\u5176\u8fd8\u539f\u3002</p> <p>TrilioVault\u652f\u6301\u6309\u9700\u6216\u8ba1\u5212\u589e\u91cf\u5907\u4efd\u3002\u5b83\u63d0\u4f9b\u5bb9\u5668\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u65f6\u95f4\u70b9\u6062\u590d\u3002\u7ba1\u7406\u5458\u53ef\u4ee5\u5c06\u5e94\u7528\u7a0b\u5e8f\u6062\u590d\u5230\u5176\u539f\u59cb\u547d\u540d\u7a7a\u95f4\u6216\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4\u3002\u6b64\u5916\uff0cTrilioVault\u8fd8\u80fd\u8ba9\u6388\u6743\u7528\u6237\u6267\u884c\u81ea\u52a9\u5f0f\u5e94\u7528\u6062\u590d\u3002</p>"},{"location":"cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/#26-velero","title":"2.6 Velero","text":"<p>Velero\u662f\u4e00\u4e2a\u5f00\u6e90\u7684Kubernetes\u96c6\u7fa4\u7684\u5907\u4efd\u548c\u707e\u96be\u6062\u590d\u5de5\u5177\u3002\u5b83\u4f7f\u7ba1\u7406\u5458\u80fd\u591f\u8fd0\u884c\u6574\u4e2a\u96c6\u7fa4\u6216\u5355\u4e2a\u547d\u540d\u7a7a\u95f4\u6216\u8005\u662f\u6807\u7b7e\u7684\u8ba1\u5212\u5907\u4efd\u3002\u6b64\u5916\uff0c\u5b83\u7684Backup Hooks\u529f\u80fd\u8ba9\u7ba1\u7406\u5458\u53ef\u4ee5\u9009\u62e9\u5728\u5907\u4efd\u4e4b\u524d\u6216\u4e4b\u540e\u6267\u884c\u81ea\u5b9a\u4e49\u64cd\u4f5c\uff0c\u4ee5\u53ca\u5bf9\u5907\u4efd\u5e94\u7528\u4fdd\u7559\u8ba1\u5212\u3002</p> <p>\u9664\u4e86\u4f5c\u4e3aKubernetes\u5907\u4efd\u548c\u707e\u96be\u6062\u590d\u5de5\u5177\u5916\uff0c\u4f01\u4e1a\u8fd8\u53ef\u4ee5\u5c06Velero\u4f5c\u4e3a\u8fc1\u79fb\u5de5\u5177\u3002Velero\u5141\u8bb8\u7ba1\u7406\u5458\u5c06Kubernetes\u8d44\u6e90\u4ece\u4e00\u4e2a\u96c6\u7fa4\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u96c6\u7fa4\u3002</p>"},{"location":"cloud-native/operator/tools/k8s%E6%8F%92%E4%BB%B6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E4%B9%8Bkrew/","title":"k8s \u63d2\u4ef6\u7ba1\u7406\u5de5\u5177\u4e4bkrew","text":"<p>## \u4e00 \u7b80\u4ecb</p> <p>Krew \u662f \u7c7b\u4f3c\u4e8e\u7cfb\u7edf\u7684apt\u3001dnf\u6216\u8005brew\u7684 kubectl\u63d2\u4ef6\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u5229\u7528\u5176\u53ef\u4ee5\u8f7b\u677e\u7684\u5b8c\u6210kubectl \u63d2\u4ef6\u7684\u5168\u4e0a\u9762\u5468\u671f\u7ba1\u7406\uff0c\u5305\u62ec\u641c\u7d22\u3001\u4e0b\u8f7d\u3001\u5378\u8f7d\u7b49\u3002</p> <p>kubectl \u5176\u5de5\u5177\u5df2\u7ecf\u6bd4\u8f83\u5b8c\u5584\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e00\u4e9b\u4e2a\u6027\u5316\u7684\u547d\u4ee4\uff0c\u5176\u5b97\u65e8\u662f\u5e0c\u671b\u5f00\u53d1\u8005\u80fd\u4ee5\u72ec\u7acb\u800c\u7d27\u5f20\u5f62\u5f0f\u53d1\u5e03\u81ea\u5b9a\u4e49\u7684kubectl\u5b50\u547d\u4ee4\uff0c\u63d2\u4ef6\u7684\u5f00\u53d1\u8bed\u8a00\u4e0d\u9650\uff0c\u9700\u8981\u5c06\u6700\u7ec8\u7684\u811a\u6b65\u6216\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u7a0b\u5e8f\u4ee5<code>kubectl-</code> \u7684\u524d\u7f00\u547d\u540d\uff0c\u7136\u540e\u653e\u5230PATH\u4e2d\u5373\u53ef\uff0c\u53ef\u4ee5\u4f7f\u7528<code>kubectl plugin list</code>\u67e5\u770b\u76ee\u524d\u5df2\u7ecf\u5b89\u88c5\u7684\u63d2\u4ef6\u3002</p> <p>## \u4e8c \u5b89\u88c5\u914d\u7f6e</p> <ul> <li>\u786e\u4fdd\u8282\u70b9\u5b89\u88c5\u6709git\u5de5\u5177</li> </ul> <pre><code># yum -y install git\n</code></pre> <ul> <li>\u5b89\u88c5</li> </ul> <pre><code>(\n  set -x; cd \"$(mktemp -d)\" &amp;&amp;\n  OS=\"$(uname | tr '[:upper:]' '[:lower:]')\" &amp;&amp;\n  ARCH=\"$(uname -m | sed -e 's/x86_64/amd64/' -e 's/\\(arm\\)\\(64\\)\\?.*/\\1\\2/' -e 's/aarch64$/arm64/')\" &amp;&amp;\n  curl -fsSLO \"https://github.com/kubernetes-sigs/krew/releases/latest/download/krew.tar.gz\" &amp;&amp;\n  tar zxvf krew.tar.gz &amp;&amp;\n  KREW=./krew-\"${OS}_${ARCH}\" &amp;&amp;\n  \"$KREW\" install krew\n)\n</code></pre> <ul> <li>\u6dfb\u52a0\u73af\u5883\u53d8\u91cf</li> </ul> <pre><code>export PATH=\"${KREW_ROOT:-$HOME/.krew}/bin:$PATH\"\nsource ~/.bashrc\n</code></pre> <ul> <li>\u786e\u8ba4\u63d2\u4ef6\u5b89\u88c5</li> </ul> <pre><code> # kubectl plugin list\n/usr/local/bin/kubectl-debug\n/usr/local/bin/kubectl-v1.10.11\n/usr/local/bin/kubectl-v1.20.0\n/Users/xuel/.krew/bin/kubectl-df_pv\n/Users/xuel/.krew/bin/kubectl-krew\n// \u6216\u8005\n</code></pre> <p>## \u4e09 \u4f7f\u7528</p> <pre><code>kubectl krew update                               # \u66f4\u65b0\nkubectl krew search               # \u663e\u793a\u6240\u6709\u63d2\u4ef6\nkubectl krew install view-secret  # \u5b89\u88c5\u540d\u4e3aview-secret\u7684\u63d2\u4ef6\nkubectl view-secret               # \u4f7f\u7528\u8be5\u63d2\u4ef6\nkubectl krew upgrade              # \u5347\u7ea7\u5b89\u88c5\u7684\u63d2\u4ef6\nkubectl krew remove view-secret   # \u5378\u8f7d\u63d2\u4ef6\n</code></pre> <p>krew\u81ea\u8eab\u4e5f\u4f5c\u4e3a\u4e00\u4e2a\u201ckubectl \u63d2\u4ef6\u201d\uff0c\u56e0\u6b64\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4<code>kubectl krew upgrade</code>\u547d\u4ee4\u6765\u5347\u7ea7krew\u3002</p> <p>### 3.1 \u5b89\u88c5\u63d2\u4ef6</p> <p>kubectl \u65e0\u6cd5\u76f4\u63a5\u67e5\u770bpv\u7684\u5927\u5c0f\u76f8\u5173\u4fe1\u606f\uff0c\u53ef\u4ee5\u5b89\u88c5\u4e00\u4e2a\u67e5\u770bpv\u5927\u5c0f\u7684\u63d2\u4ef6</p> <pre><code># kubectl krew install df-pv\nUpdated the local copy of plugin index.\nInstalling plugin: df-pv\nInstalled plugin: df-pv\n\\\n | Use this plugin:\n |    kubectl df-pv\n | Documentation:\n |    https://github.com/yashbhutwala/kubectl-df-pv\n\n#  kubectl krew list\nPLUGIN  VERSION\ndf-pv   v0.2.7\nkrew    v0.4.1\n</code></pre> <p>### 3.2 \u4f7f\u7528</p> <pre><code># kubectl df-pv\n</code></pre> <p></p> <p>### 3.3 \u5378\u8f7d</p> <pre><code>kubectl krew uninstall df-pv\n</code></pre> <p>## \u56db \u5176\u4ed6</p> <p>K8s\u793e\u533a\u4e3a\u65b9\u4fbf\u5176\u4ed6\u5f00\u53d1\u8fd9\u5f00\u53d1\u63d2\u4ef6\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2ahttps://github.com/kubernetes/cli-runtime\u9879\u76ee\uff0c\u4fbf\u4e8e\u6211\u4eec\u4f7f\u7528Go\u8bed\u8a00\u7f16\u5199kubectl\u63d2\u4ef6\u3002 </p> <p>\u5b98\u65b9\u4e5f\u7ed9\u4e86\u4e00\u4e2a\u4f7f\u7528Go\u7f16\u5199kubectl\u63d2\u4ef6\u7684\u4f8b\u5b50https://github.com/kubernetes/sample-cli-plugin\u3002</p> <p>krew \u4ec5\u4ec5\u517c\u5bb9kubectl v1.12\u6216\u66f4\u9ad8\u7248\u672c\u3002</p> <p>## \u53c2\u8003\u94fe\u63a5</p> <ul> <li> <p>https://krew.sigs.k8s.io/docs/user-guide/quickstart/</p> </li> <li> <p>https://github.com/kubernetes-sigs/krew/blob/master/docs/KREW_ARCHITECTURE.md</p> </li> <li>https://github.com/kubernetes-sigs/krew</li> <li>https://blog.51cto.com/u_3241766/2452592</li> </ul>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/","title":"\u4e91\u539f\u751f\u5907\u4efd\u6062\u590d\u4e4bvelero\u5b9e\u6218","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>Kubernetes \u96c6\u7fa4\u5907\u4efd\u662f\u4e00\u5927\u96be\u70b9\u3002\u867d\u7136\u53ef\u4ee5\u901a\u8fc7Etcd v3\u5907\u4efd\u4e0e\u6062\u590d\u6765\u5b9e\u73b0K8S\u96c6\u7fa4\u5907\u4efd\uff0c\u4f46\u662f\u8fd9\u79cd\u5907\u4efd\u5f88\u96be\u6062\u590d\u5355\u4e2a <code>Namespace</code>\u3002</p> <p>\u5bf9\u4e8eK8s\u96c6\u7fa4\u6570\u636e\u7684\u5907\u4efd\u548c\u6062\u590d\uff0c\u4ee5\u53ca\u590d\u5236\u5f53\u524d\u96c6\u7fa4\u6570\u636e\u5230\u5176\u4ed6\u96c6\u7fa4\u7b49\u90fd\u975e\u5e38\u65b9\u4fbf\u3002\u53ef\u4ee5\u5728\u4e24\u4e2a\u96c6\u7fa4\u95f4\u514b\u9686\u5e94\u7528\u548c\u547d\u540d\u7a7a\u95f4\uff0c\u6765\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u6027\u7684\u5f00\u53d1\u73af\u5883\u3002</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#velero_1","title":"\u4e8c  Velero\u6982\u8ff0","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#21-velero","title":"2.1 \u4ec0\u4e48\u662fVelero","text":"<p>Velero \u662f\u4e00\u4e2a\u4e91\u539f\u751f\u7684\u707e\u96be\u6062\u590d\u548c\u8fc1\u79fb\u5de5\u5177\uff0c\u5b83\u672c\u8eab\u4e5f\u662f\u5f00\u6e90\u7684, \u91c7\u7528 Go \u8bed\u8a00\u7f16\u5199\uff0c\u53ef\u4ee5\u5b89\u5168\u7684\u5907\u4efd\u3001\u6062\u590d\u548c\u8fc1\u79fbKubernetes\u96c6\u7fa4\u8d44\u6e90\u548c\u6301\u4e45\u5377\u3002</p> <p>Velero \u662f\u897f\u73ed\u7259\u8bed\uff0c\u610f\u601d\u662f\u5e06\u8239\uff0c\u975e\u5e38\u7b26\u5408 Kubernetes \u793e\u533a\u7684\u547d\u540d\u98ce\u683c\u3002Velero \u7684\u5f00\u53d1\u516c\u53f8 Heptio\uff0c\u4e4b\u524d\u5df2\u88ab VMware \u6536\u8d2d\uff0c\u5176\u521b\u59cb\u4eba2014\u5c31\u804c\u4e8eGoogle\uff0c\u5f53\u65f6\u88ab\u8ba4\u4e3a\u662f Kubernetes \u6838\u5fc3\u6210\u5458\u3002</p> <p>Velero \u662f\u4e00\u79cd\u4e91\u539f\u751f\u7684Kubernetes\u4f18\u5316\u65b9\u6cd5\uff0c\u652f\u6301\u6807\u51c6\u7684K8S\u96c6\u7fa4\uff0c\u65e2\u53ef\u4ee5\u662f\u79c1\u6709\u4e91\u5e73\u53f0\u4e5f\u53ef\u4ee5\u662f\u516c\u6709\u4e91\u3002\u9664\u4e86\u707e\u5907\u4e4b\u5916\u5b83\u8fd8\u80fd\u505a\u8d44\u6e90\u79fb\u8f6c\uff0c\u652f\u6301\u628a\u5bb9\u5668\u5e94\u7528\u4ece\u4e00\u4e2a\u96c6\u7fa4\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u96c6\u7fa4\u3002</p> <p>Heptio Velero ( \u4ee5\u524d\u7684\u540d\u5b57\u4e3a ARK) \u662f\u4e00\u6b3e\u7528\u4e8e Kubernetes \u96c6\u7fa4\u8d44\u6e90\u548c\u6301\u4e45\u5b58\u50a8\u5377\uff08PV\uff09\u7684\u5907\u4efd\u3001\u8fc1\u79fb\u4ee5\u53ca\u707e\u96be\u6062\u590d\u7b49\u7684\u5f00\u6e90\u5de5\u5177\u3002</p> <p>\u4f7f\u7528velero\u53ef\u4ee5\u5bf9\u96c6\u7fa4\u8fdb\u884c\u5907\u4efd\u548c\u6062\u590d\uff0c\u964d\u4f4e\u96c6\u7fa4DR\u9020\u6210\u7684\u5f71\u54cd\u3002velero\u7684\u57fa\u672c\u539f\u7406\u5c31\u662f\u5c06\u96c6\u7fa4\u7684\u6570\u636e\u5907\u4efd\u5230\u5bf9\u8c61\u5b58\u50a8\u4e2d\uff0c\u5728\u6062\u590d\u7684\u65f6\u5019\u5c06\u6570\u636e\u4ece\u5bf9\u8c61\u5b58\u50a8\u4e2d\u62c9\u53d6\u4e0b\u6765\u3002\u53ef\u4ee5\u4ece\u5b98\u65b9\u6587\u6863\u67e5\u770b\u53ef\u63a5\u6536\u7684\u5bf9\u8c61\u5b58\u50a8\uff0c\u672c\u5730\u5b58\u50a8\u53ef\u4ee5\u4f7f\u7528Minio\u3002\u4e0b\u9762\u6f14\u793a\u4f7f\u7528velero\u5c06openstack\u4e0a\u7684openshift\u96c6\u7fa4\u5907\u4efd\u6062\u590d\u5230\u963f\u91cc\u4e91\u7684openshift\u4e0a\u3002</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#22-velero","title":"2.2 Velero\u5de5\u4f5c\u6d41\u7a0b","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#221","title":"2.2.1 \u6d41\u7a0b\u56fe","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#222","title":"2.2.2 \u5907\u4efd\u8fc7\u7a0b","text":"<ol> <li>\u672c\u5730 <code>Velero</code> \u5ba2\u6237\u7aef\u53d1\u9001\u5907\u4efd\u6307\u4ee4\u3002</li> <li><code>Kubernetes</code> \u96c6\u7fa4\u5185\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a <code>Backup</code> \u5bf9\u8c61\u3002</li> <li><code>BackupController</code> \u76d1\u6d4b <code>Backup</code> \u5bf9\u8c61\u5e76\u5f00\u59cb\u5907\u4efd\u8fc7\u7a0b\u3002</li> <li><code>BackupController</code> \u4f1a\u5411 <code>API Server</code> \u67e5\u8be2\u76f8\u5173\u6570\u636e\u3002</li> <li><code>BackupController</code> \u5c06\u67e5\u8be2\u5230\u7684\u6570\u636e\u5907\u4efd\u5230\u8fdc\u7aef\u7684\u5bf9\u8c61\u5b58\u50a8\u3002</li> </ol>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#23-velero","title":"2.3 Velero\u7684\u7279\u6027","text":"<p><code>Velero</code> \u76ee\u524d\u5305\u542b\u4ee5\u4e0b\u7279\u6027\uff1a</p> <ul> <li>\u652f\u6301 <code>Kubernetes</code> \u96c6\u7fa4\u6570\u636e\u5907\u4efd\u548c\u6062\u590d</li> <li>\u652f\u6301\u590d\u5236\u5f53\u524d <code>Kubernetes</code> \u96c6\u7fa4\u7684\u8d44\u6e90\u5230\u5176\u5b83 <code>Kubernetes</code> \u96c6\u7fa4</li> <li>\u652f\u6301\u590d\u5236\u751f\u4ea7\u73af\u5883\u5230\u5f00\u53d1\u4ee5\u53ca\u6d4b\u8bd5\u73af\u5883</li> </ul>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#24-velero","title":"2.4 Velero\u7ec4\u5efa","text":"<p><code>Velero</code> \u7ec4\u4ef6\u4e00\u5171\u5206\u4e24\u90e8\u5206\uff0c\u5206\u522b\u662f\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u3002</p> <ul> <li>\u670d\u52a1\u7aef\uff1a\u8fd0\u884c\u5728\u4f60 <code>Kubernetes</code> \u7684\u96c6\u7fa4\u4e2d</li> <li>\u5ba2\u6237\u7aef\uff1a\u662f\u4e00\u4e9b\u8fd0\u884c\u5728\u672c\u5730\u7684\u547d\u4ee4\u884c\u7684\u5de5\u5177\uff0c\u9700\u8981\u5df2\u914d\u7f6e\u597d <code>kubectl</code> \u53ca\u96c6\u7fa4 <code>kubeconfig</code> \u7684\u673a\u5668\u4e0a</li> </ul>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#25","title":"2.5 \u652f\u6301\u5907\u4efd\u5b58\u50a8","text":"<ul> <li>AWS S3 \u4ee5\u53ca\u517c\u5bb9 S3 \u7684\u5b58\u50a8\uff0c\u6bd4\u5982\uff1aMinio</li> <li>Azure BloB \u5b58\u50a8</li> <li>Google Cloud \u5b58\u50a8</li> <li>Aliyun OSS \u5b58\u50a8(https://github.com/AliyunContainerService/velero-plugin)</li> </ul> <p>\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/heptio/velero</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#26","title":"2.6 \u9002\u5e94\u573a\u666f","text":"<ul> <li><code>\u707e\u5907\u573a\u666f</code>\uff1a\u63d0\u4f9b\u5907\u4efd\u6062\u590dk8s\u96c6\u7fa4\u7684\u80fd\u529b</li> <li><code>\u8fc1\u79fb\u573a\u666f</code>\uff1a\u63d0\u4f9b\u62f7\u8d1d\u96c6\u7fa4\u8d44\u6e90\u5230\u5176\u4ed6\u96c6\u7fa4\u7684\u80fd\u529b\uff08\u590d\u5236\u540c\u6b65\u5f00\u53d1\uff0c\u6d4b\u8bd5\uff0c\u751f\u4ea7\u73af\u5883\u7684\u96c6\u7fa4\u914d\u7f6e\uff0c\u7b80\u5316\u73af\u5883\u914d\u7f6e\uff09</li> </ul>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#27-etcd","title":"2.7 \u4e0eetcd\u7684\u533a\u522b","text":"<p>\u4e0e Etcd \u5907\u4efd\u76f8\u6bd4\uff0c\u76f4\u63a5\u5907\u4efd <code>Etcd</code> \u662f\u5c06\u96c6\u7fa4\u7684\u5168\u90e8\u8d44\u6e90\u5907\u4efd\u8d77\u6765\u3002\u800c <code>Velero</code> \u5c31\u662f\u53ef\u4ee5\u5bf9 <code>Kubernetes</code> \u96c6\u7fa4\u5185\u5bf9\u8c61\u7ea7\u522b\u8fdb\u884c\u5907\u4efd\u3002\u9664\u4e86\u5bf9 <code>Kubernetes</code> \u96c6\u7fa4\u8fdb\u884c\u6574\u4f53\u5907\u4efd\u5916\uff0c<code>Velero</code> \u8fd8\u53ef\u4ee5\u901a\u8fc7\u5bf9 <code>Type</code>\u3001<code>Namespace</code>\u3001<code>Label</code> \u7b49\u5bf9\u8c61\u8fdb\u884c\u5206\u7c7b\u5907\u4efd\u6216\u8005\u6062\u590d\u3002</p> <p>\u6ce8\u610f: \u5907\u4efd\u8fc7\u7a0b\u4e2d\u521b\u5efa\u7684\u5bf9\u8c61\u662f\u4e0d\u4f1a\u88ab\u5907\u4efd\u7684\u3002</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#_2","title":"\u4e09 \u5907\u4efd\u8fc7\u7a0b","text":"<p><code>Velero</code> \u5728 <code>Kubernetes</code> \u96c6\u7fa4\u4e2d\u521b\u5efa\u4e86\u5f88\u591a <code>CRD</code> \u4ee5\u53ca\u76f8\u5173\u7684\u63a7\u5236\u5668\uff0c\u8fdb\u884c\u5907\u4efd\u6062\u590d\u7b49\u64cd\u4f5c\u5b9e\u8d28\u4e0a\u662f\u5bf9\u76f8\u5173 <code>CRD</code> \u7684\u64cd\u4f5c\u3002</p> <pre><code># Velero \u5728 Kubernetes \u96c6\u7fa4\u4e2d\u521b\u5efa\u7684 CRD\n$ kubectl -n velero get crds -l component=velero\nNAME                                CREATED AT\nbackups.velero.io                   2019-08-28T03:19:56Z\nbackupstoragelocations.velero.io    2019-08-28T03:19:56Z\ndeletebackuprequests.velero.io      2019-08-28T03:19:56Z\ndownloadrequests.velero.io          2019-08-28T03:19:56Z\npodvolumebackups.velero.io          2019-08-28T03:19:56Z\npodvolumerestores.velero.io         2019-08-28T03:19:56Z\nresticrepositories.velero.io        2019-08-28T03:19:56Z\nrestores.velero.io                  2019-08-28T03:19:56Z\nschedules.velero.io                 2019-08-28T03:19:56Z\nserverstatusrequests.velero.io      2019-08-28T03:19:56Z\nvolumesnapshotlocations.velero.io   2019-08-28T03:19:56Z\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#31","title":"3.1 \u4fdd\u969c\u6570\u636e\u4e00\u81f4\u6027","text":"<p>\u5bf9\u8c61\u5b58\u50a8\u7684\u6570\u636e\u662f\u552f\u4e00\u7684\u6570\u636e\u6e90\uff0c\u4e5f\u5c31\u662f\u8bf4 <code>Kubernetes</code> \u96c6\u7fa4\u5185\u7684\u63a7\u5236\u5668\u4f1a\u68c0\u67e5\u8fdc\u7a0b\u7684 <code>OSS</code> \u5b58\u50a8\uff0c\u53d1\u73b0\u6709\u5907\u4efd\u5c31\u4f1a\u5728\u96c6\u7fa4\u5185\u521b\u5efa\u76f8\u5173 <code>CRD</code> \u3002\u5982\u679c\u53d1\u73b0\u8fdc\u7aef\u5b58\u50a8\u6ca1\u6709\u5f53\u524d\u96c6\u7fa4\u5185\u7684 <code>CRD</code> \u6240\u5173\u8054\u7684\u5b58\u50a8\u6570\u636e\uff0c\u90a3\u4e48\u5c31\u4f1a\u5220\u9664\u5f53\u524d\u96c6\u7fa4\u5185\u7684 <code>CRD</code>\u3002</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#32","title":"3.2 \u652f\u6301\u7684\u540e\u7aef\u5b58\u50a8","text":"<p><code>Velero</code> \u652f\u6301\u4e24\u79cd\u5173\u4e8e\u540e\u7aef\u5b58\u50a8\u7684 <code>CRD</code>\uff0c\u5206\u522b\u662f <code>BackupStorageLocation</code> \u548c <code>VolumeSnapshotLocation</code>\u3002</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#321-backupstoragelocation","title":"3.2.1 BackupStorageLocation","text":"<p><code>BackupStorageLocation</code> \u4e3b\u8981\u7528\u6765\u5b9a\u4e49 <code>Kubernetes</code> \u96c6\u7fa4\u8d44\u6e90\u7684\u6570\u636e\u5b58\u653e\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u96c6\u7fa4\u5bf9\u8c61\u6570\u636e\uff0c\u4e0d\u662f <code>PVC</code> \u7684\u6570\u636e\u3002\u4e3b\u8981\u652f\u6301\u7684\u540e\u7aef\u5b58\u50a8\u662f <code>S3</code> \u517c\u5bb9\u7684\u5b58\u50a8\uff0c\u6bd4\u5982\uff1a<code>Mino</code> \u548c\u963f\u91cc\u4e91 <code>OSS</code> \u7b49\u3002</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#3211-minio","title":"3.2.1.1 Minio","text":"<pre><code>apiVersion: velero.io/v1\nkind: BackupStorageLocation\nmetadata:\n  name: default\n  namespace: velero\nspec:\n# \u53ea\u6709 aws gcp azure\n  provider: aws\n  # \u5b58\u50a8\u4e3b\u8981\u914d\u7f6e\n  objectStorage:\n  # bucket \u7684\u540d\u79f0\n    bucket: myBucket\n    # bucket\u5185\u7684\n    prefix: backup\n# \u4e0d\u540c\u7684 provider \u4e0d\u540c\u7684\u914d\u7f6e\n  config:\n    #bucket\u5730\u533a\n    region: us-west-2\n    # s3\u8ba4\u8bc1\u4fe1\u606f\n    profile: \"default\"\n    # \u4f7f\u7528 Minio \u7684\u65f6\u5019\u52a0\u4e0a\uff0c\u9ed8\u8ba4\u4e3a false\n    # AWS \u7684 S3 \u53ef\u4ee5\u652f\u6301\u4e24\u79cd Url Bucket URL\n    # 1 Path style URL\uff1a http://s3endpoint/BUCKET\n    # 2 Virtual-hosted style URL\uff1a http://oss-cn-beijing.s3endpoint \u5c06 Bucker Name \u653e\u5230\u4e86 Host Header\u4e2d\n    # 3 \u963f\u91cc\u4e91\u4ec5\u4ec5\u652f\u6301 Virtual hosted \u5982\u679c\u4e0b\u9762\u5199\u4e0a true, \u963f\u91cc\u4e91 OSS \u4f1a\u62a5\u9519 403\n    s3ForcePathStyle: \"false\"\n    # s3\u7684\u5730\u5740\uff0c\u683c\u5f0f\u4e3a http://minio:9000\n    s3Url: http://minio:9000\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#3212-oss","title":"3.2.1.2 \u963f\u91ccOSS","text":"<pre><code>apiVersion: velero.io/v1\nkind: BackupStorageLocation\nmetadata:\n  labels:\n    component: velero\n  name: default\n  namespace: velero\nspec:\n  config:\n    region: oss-cn-beijing\n    s3Url: http://oss-cn-beijing.aliyuncs.com\n    s3ForcePathStyle: \"false\"\n  objectStorage:\n    bucket: build-jenkins\n    prefix: \"\"\n  provider: aws\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#322-volumesnapshotlocation","title":"3.2.2 VolumeSnapshotLocation","text":"<p>VolumeSnapshotLocation \u4e3b\u8981\u7528\u6765\u7ed9 PV \u505a\u5feb\u7167\uff0c\u9700\u8981\u4e91\u63d0\u4f9b\u5546\u63d0\u4f9b\u63d2\u4ef6\u3002\u963f\u91cc\u4e91\u5df2\u7ecf\u63d0\u4f9b\u4e86\u63d2\u4ef6\uff0c\u8fd9\u4e2a\u9700\u8981\u4f7f\u7528 CSI \u7b49\u5b58\u50a8\u673a\u5236\u3002\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e13\u95e8\u7684\u5907\u4efd\u5de5\u5177 <code>Restic</code>\uff0c\u628a PV \u6570\u636e\u5907\u4efd\u5230\u963f\u91cc\u4e91 OSS \u4e2d\u53bb(\u5b89\u88c5\u65f6\u9700\u8981\u81ea\u5b9a\u4e49\u9009\u9879)\u3002</p> <pre><code># \u5b89\u88c5\u65f6\u9700\u8981\u81ea\u5b9a\u4e49\u9009\u9879\n--use-restic\n\n# \u8fd9\u91cc\u6211\u4eec\u5b58\u50a8 PV \u4f7f\u7528\u7684\u662f OSS \u4e5f\u5c31\u662f BackupStorageLocation\uff0c\u56e0\u6b64\u4e0d\u7528\u521b\u5efa VolumeSnapshotLocation \u5bf9\u8c61\n--use-volume-snapshots=false\n</code></pre> <p>Restic \u662f\u4e00\u6b3e GO \u8bed\u8a00\u5f00\u53d1\u7684\u6570\u636e\u52a0\u5bc6\u5907\u4efd\u5de5\u5177\uff0c\u987e\u540d\u601d\u4e49\uff0c\u53ef\u4ee5\u5c06\u672c\u5730\u6570\u636e\u52a0\u5bc6\u540e\u4f20\u8f93\u5230\u6307\u5b9a\u7684\u4ed3\u5e93\u3002\u652f\u6301\u7684\u4ed3\u5e93\u6709 Local\u3001SFTP\u3001Aws S3\u3001Minio\u3001OpenStack Swift\u3001Backblaze B2\u3001Azure BS\u3001Google Cloud storage\u3001Rest Server\u3002</p> <p>\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/restic/restic</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#velerominio","title":"\u56db \u5b9e\u8df5velero\u5907\u4efdminio","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#41","title":"4.1 \u73af\u5883\u8981\u6c42","text":"<ul> <li>kubernetes &gt;1.7;</li> </ul>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#42-velero","title":"4.2 \u90e8\u7f72velero","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#421-velero","title":"4.2.1 \u4e0b\u8f7dvelero","text":"<pre><code>wget https://github.com/vmware-tanzu/velero/releases/download/v1.4.2/velero-v1.4.2-linux-amd64.tar.gz\ntar -zxvf velero-v1.4.2-linux-amd64.tar.gz\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#422-minio","title":"4.2.2 \u5b89\u88c5minio","text":"<pre><code>cd velero-v1.4.2-linux-amd64\n[root@master velero-v1.4.2-linux-amd64]# cat examples/minio/00-minio-deployment.yaml \n---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: velero\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: velero\n  name: minio\n  labels:\n    component: minio\nspec:\n  strategy:\n    type: Recreate\n  selector:\n    matchLabels:\n      component: minio\n  template:\n    metadata:\n      labels:\n        component: minio\n    spec:\n      volumes:\n      - name: storage\n        emptyDir: {}\n      - name: config\n        emptyDir: {}\n      containers:\n      - name: minio\n        image: minio/minio:latest\n        imagePullPolicy: IfNotPresent\n        args:\n        - server\n        - /storage\n        - --config-dir=/config\n        env:\n        - name: MINIO_ACCESS_KEY\n          value: \"minio\"\n        - name: MINIO_SECRET_KEY\n          value: \"minio123\"\n        ports:\n        - containerPort: 9000\n        volumeMounts:\n        - name: storage\n          mountPath: \"/storage\"\n        - name: config\n          mountPath: \"/config\"\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  namespace: velero\n  name: minio\n  labels:\n    component: minio\nspec:\n  # ClusterIP is recommended for production environments.\n  # Change to NodePort if needed per documentation,\n  # but only if you run Minio in a test/trial environment, for example with Minikube.\n  type: ClusterIP\n  ports:\n    - port: 9000\n      targetPort: 9000\n      protocol: TCP\n  selector:\n    component: minio\n\n---\napiVersion: batch/v1\nkind: Job\nmetadata:\n  namespace: velero\n  name: minio-setup\n  labels:\n    component: minio\nspec:\n  template:\n    metadata:\n      name: minio-setup\n    spec:\n      restartPolicy: OnFailure\n      volumes:\n      - name: config\n        emptyDir: {}\n      containers:\n      - name: mc\n        image: minio/mc:latest\n        imagePullPolicy: IfNotPresent\n        command:\n        - /bin/sh\n        - -c\n        - \"mc --config-dir=/config config host add velero http://minio:9000 minio minio123 &amp;&amp; mc --config-dir=/config mb -p velero/velero\"\n        volumeMounts:\n        - name: config\n          mountPath: \"/config\"\n</code></pre> <p>\u7531\u4e0a\u9762\u8d44\u6e90\u6e05\u6de1\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u5b89\u88c5minio\u7684\u65f6\u5019</p> <p>MINIO_ACCESS_KEY\uff1aminio</p> <p>MINIO_SECRET_KEY\uff1aminio123</p> <p>service\u7684\u5730\u5740\u4e3a\uff1ahttp://minio:9000\uff0c\u7c7b\u578b\u4e3aClusterIP\uff0c\u6211\u4eec\u53ef\u4ee5\u6620\u5c04\u4e3aNodePort\u67e5\u770b</p> <p>\u6700\u540e\u6267\u884c\u4e86\u4e00\u4e2ajob\u6765\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u4e3a\uff1avelero/velero\u7684bucket\uff0c\u5728\u521b\u5efa\u7684\u65f6\u5019\u9002\u5e94\u4e86</p> <ul> <li>\u5b89\u88c5</li> </ul> <pre><code>[root@master velero-v1.4.2-linux-amd64]# kubectl apply -f examples/minio/00-minio-deployment.yaml \nnamespace/velero created\ndeployment.apps/minio created\nservice/minio created\njob.batch/minio-setup created\n[root@master velero-v1.4.2-linux-amd64]# kubectl get all -n velero \nNAME                       READY   STATUS              RESTARTS   AGE\npod/minio-fdd868c5-xv52k   0/1     ContainerCreating   0          14s\npod/minio-setup-hktjb      0/1     ContainerCreating   0          14s\n\n\nNAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\nservice/minio   ClusterIP   10.233.39.204   &lt;none&gt;        9000/TCP   14s\n\n\nNAME                    READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/minio   0/1     1            0           14s\n\nNAME                             DESIRED   CURRENT   READY   AGE\nreplicaset.apps/minio-fdd868c5   1         1         0       14s\n\n\n\nNAME                    COMPLETIONS   DURATION   AGE\njob.batch/minio-setup   0/1           14s        14s\n</code></pre> <p>\u5f85\u670d\u52a1\u90fd\u5df2\u7ecf\u542f\u52a8\u5b8c\u6bd5\uff0c\u53ef\u4ee5\u767b\u5f55minio\u67e5\u770bvelero/velero\u7684bucket\u662f\u5426\u521b\u5efa\u6210\u529f\u3002</p> <p>\u4fee\u6539svc\uff0c\u767b\u5f55\u67e5\u770b</p> <pre><code>[root@master velero-v1.4.2-linux-amd64]# kubectl get svc -n velero minio \nNAME    TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\nminio   NodePort   10.233.39.204   &lt;none&gt;        9000:30401/TCP   2m26s\n</code></pre> <p></p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#423-velero","title":"4.2.3 \u5b89\u88c5velero","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#4231","title":"4.2.3.1 \u521b\u5efa\u5bc6\u94a5","text":"<p>\u5b89\u88c5velero\u9700\u8981\u521b\u5efa\u80fd\u6b63\u5e38\u767b\u5f55minio\u7684\u5bc6\u94a5</p> <pre><code>cat &gt; credentials-velero &lt;&lt;EOF\n[default]\naws_access_key_id = minio\naws_secret_access_key = minio123\nEOF\n# \u5b89\u88c5velero\ncp velero /usr/bin/\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#4232-k8svelero","title":"4.2.3.2 K8s\u96c6\u7fa4\u5b89\u88c5velero","text":"<pre><code># \u542f\u7528\u5feb\u901f\u8865\u5168\nvelero completion bash\n\nvelero install \\\n     --provider aws \\\n     --plugins velero/velero-plugin-for-aws:v1.0.0 \\\n     --bucket velero \\\n     --secret-file ./credentials-velero \\\n     --use-volume-snapshots=false \\\n     --backup-location-config region=minio,s3ForcePathStyle=\"true\",s3Url=http://minio.velero.svc:9000\n\n[root@master velero-v1.4.2-linux-amd64]# velero install      --provider aws      --plugins velero/velero-plugin-for-aws:v1.0.0      --bucket velero      --secret-file ./credentials-velero      --use-volume-snapshots=false      --backup-location-config region=minio,s3ForcePathStyle=\"true\",s3Url=http://minio.velero.svc:9000\nCustomResourceDefinition/backups.velero.io: attempting to create resource\nCustomResourceDefinition/backups.velero.io: created\nCustomResourceDefinition/backupstoragelocations.velero.io: attempting to create resource\nCustomResourceDefinition/backupstoragelocations.velero.io: created\nCustomResourceDefinition/deletebackuprequests.velero.io: attempting to create resource\nCustomResourceDefinition/deletebackuprequests.velero.io: created\nCustomResourceDefinition/downloadrequests.velero.io: attempting to create resource\nCustomResourceDefinition/downloadrequests.velero.io: created\nCustomResourceDefinition/podvolumebackups.velero.io: attempting to create resource\nCustomResourceDefinition/podvolumebackups.velero.io: created\nCustomResourceDefinition/podvolumerestores.velero.io: attempting to create resource\nCustomResourceDefinition/podvolumerestores.velero.io: created\nCustomResourceDefinition/resticrepositories.velero.io: attempting to create resource\nCustomResourceDefinition/resticrepositories.velero.io: created\nCustomResourceDefinition/restores.velero.io: attempting to create resource\nCustomResourceDefinition/restores.velero.io: created\nCustomResourceDefinition/schedules.velero.io: attempting to create resource\nCustomResourceDefinition/schedules.velero.io: created\nCustomResourceDefinition/serverstatusrequests.velero.io: attempting to create resource\nCustomResourceDefinition/serverstatusrequests.velero.io: created\nCustomResourceDefinition/volumesnapshotlocations.velero.io: attempting to create resource\nCustomResourceDefinition/volumesnapshotlocations.velero.io: created\nWaiting for resources to be ready in cluster...\nNamespace/velero: attempting to create resource\nNamespace/velero: already exists, proceeding\nNamespace/velero: created\nClusterRoleBinding/velero: attempting to create resource\nClusterRoleBinding/velero: created\nServiceAccount/velero: attempting to create resource\nServiceAccount/velero: created\nSecret/cloud-credentials: attempting to create resource\nSecret/cloud-credentials: created\nBackupStorageLocation/default: attempting to create resource\nBackupStorageLocation/default: created\nDeployment/velero: attempting to create resource\nDeployment/velero: created\nVelero is installed! \u26f5 Use 'kubectl logs deployment/velero -n velero' to view the status.\n\n[root@master velero-v1.4.2-linux-amd64]# kubectl api-versions |grep velero\nvelero.io/v1\n\n[root@master velero-v1.4.2-linux-amd64]# kubectl get pod -n velero\nNAME                      READY   STATUS      RESTARTS   AGE\nminio-fdd868c5-xv52k      1/1     Running     0          56m\nminio-setup-hktjb         0/1     Completed   0          56m\nvelero-56fbc5d69c-8v2q7   1/1     Running     0          32m\n</code></pre> <p>\u81f3\u6b64velero\u5c31\u5df2\u7ecf\u5168\u90e8\u90e8\u7f72\u5b8c\u6210\u3002</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#43-velero","title":"4.3 velero\u547d\u4ee4","text":"<pre><code>$ velero create backup NAME [flags]\n\n# \u5254\u9664 namespace\n--exclude-namespaces stringArray                  namespaces to exclude from the backup\n\n# \u5254\u9664\u8d44\u6e90\u7c7b\u578b\n--exclude-resources stringArray                   resources to exclude from the backup, formatted as resource.group, such as storageclasses.storage.k8s.io\n\n# \u5305\u542b\u96c6\u7fa4\u8d44\u6e90\u7c7b\u578b \n--include-cluster-resources optionalBool[=true]   include cluster-scoped resources in the backup\n\n# \u5305\u542b namespace\n--include-namespaces stringArray                  namespaces to include in the backup (use '*' for all namespaces) (default *)\n\n# \u5305\u542b namespace \u8d44\u6e90\u7c7b\u578b\n--include-resources stringArray                   resources to include in the backup, formatted as resource.group, such as storageclasses.storage.k8s.io (use '*' for all resources)\n\n# \u7ed9\u8fd9\u4e2a\u5907\u4efd\u52a0\u4e0a\u6807\u7b7e\n--labels mapStringString                          labels to apply to the backup\n-o, --output string                               Output display format. For create commands, display the object but do not send it to the server. Valid formats are 'table', 'json', and 'yaml'. 'table' is not valid for the install command.\n\n# \u5bf9\u6307\u5b9a\u6807\u7b7e\u7684\u8d44\u6e90\u8fdb\u884c\u5907\u4efd\n-l, --selector labelSelector                      only back up resources matching this label selector (default &lt;none&gt;)\n\n# \u5bf9 PV \u521b\u5efa\u5feb\u7167\n--snapshot-volumes optionalBool[=true]            take snapshots of PersistentVolumes as part of the backup\n\n# \u6307\u5b9a\u5907\u4efd\u7684\u4f4d\u7f6e\n--storage-location string                         location in which to store the backup\n\n# \u5907\u4efd\u6570\u636e\u591a\u4e45\u5220\u6389\n\n--ttl duration                                    how long before the backup can be garbage collected (default 720h0m0s)\n\n# \u6307\u5b9a\u5feb\u7167\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u54ea\u4e00\u4e2a\u516c\u6709\u4e91\u9a71\u52a8\n--volume-snapshot-locations strings               list of locations (at most one per provider) where volume snapshots should be stored\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#44","title":"4.4 \u6d4b\u8bd5","text":"<p>velero\u975e\u5e38\u7684\u4eba\u6027\u5316\uff0c\u5728\u5b89\u88c5\u5305\u4e2d\u5df2\u7ecf\u4e3a\u6211\u4eec\u51c6\u5907\u597d\u4e86\u6d4b\u8bd5demo\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u6d4b\u8bd5demo\u6765\u8fdb\u884c\u6d4b\u8bd5\u9a8c\u8bc1\u3002</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#441","title":"4.4.1 \u521b\u5efa\u6d4b\u8bd5\u5e94\u7528","text":"<pre><code>[root@master velero-v1.4.2-linux-amd64]# kubectl apply -f examples/nginx-app/base.yaml\nnamespace/nginx-example created\ndeployment.apps/nginx-deployment created\nservice/my-nginx created\n[root@master velero-v1.4.2-linux-amd64]# kubectl get all -n nginx-example\nNAME                                   READY   STATUS              RESTARTS   AGE\npod/nginx-deployment-f4769bfdf-8jrsz   0/1     ContainerCreating   0          12s\npod/nginx-deployment-f4769bfdf-sqfp4   0/1     ContainerCreating   0          12s\nNAME               TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE\nservice/my-nginx   LoadBalancer   10.233.10.49   &lt;pending&gt;     80:32401/TCP   13s\nNAME                               READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/nginx-deployment   0/2     2            0           14s\nNAME                                         DESIRED   CURRENT   READY   AGE\nreplicaset.apps/nginx-deployment-f4769bfdf   2         2         0       14s\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#442","title":"4.4.2 \u6267\u884c\u5907\u4efd","text":"<pre><code>[root@master velero-v1.4.2-linux-amd64]# velero backup create nginx-backup --include-namespaces nginx-example\nBackup request \"nginx-backup\" submitted successfully.\nRun `velero backup describe nginx-backup` or `velero backup logs nginx-backup` for more details.\n[root@master velero-v1.4.2-linux-amd64]# velero backup describe nginx-backup\nName:         nginx-backup\nNamespace:    velero\nLabels:       velero.io/storage-location=default\nAnnotations:  velero.io/source-cluster-k8s-gitversion=v1.15.5\n              velero.io/source-cluster-k8s-major-version=1\n              velero.io/source-cluster-k8s-minor-version=1\nPhase:  Completed\nErrors:    0\nWarnings:  0\nNamespaces:\n  Included:  nginx-example\n  Excluded:  &lt;none&gt;\nResources:\n  Included:        *\n  Excluded:        &lt;none&gt;\n  Cluster-scoped:  auto\nLabel selector:  &lt;none&gt;\nStorage Location:  default\nVelero-Native Snapshot PVs:  auto\nTTL:  720h0m0s\n\nHooks:  &lt;none&gt;\n\nBackup Format Version:  1\n\nStarted:    2020-07-21 19:12:16 +0800 CST\nCompleted:  2020-07-21 19:12:24 +0800 CST\n\nExpiration:  2020-08-20 19:12:16 +0800 CST\n\nTotal items to be backed up:  23\nItems backed up:              23\n\nVelero-Native Snapshots: &lt;none included&gt;\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#443","title":"4.4.3 \u67e5\u770b\u5907\u4efd\u4fe1\u606f","text":"<ul> <li>\u767b\u5f55minio\u67e5\u770b\u5907\u4efd\u4fe1\u606f</li> </ul> <ul> <li>\u67e5\u770b\u76ee\u5f55\u7ed3\u6784</li> </ul>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#444","title":"4.4.4 \u8fdb\u884c\u6062\u590d\u6d4b\u8bd5","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#4441-nginx","title":"4.4.4.1 \u5220\u9664nginx\u670d\u52a1","text":"<pre><code>[root@master velero-v1.4.2-linux-amd64]# kubectl delete -f examples/nginx-app/base.yaml \nnamespace \"nginx-example\" deleted\ndeployment.apps \"nginx-deployment\" deleted\nservice \"my-nginx\" deleted\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#4442-nginx","title":"4.4.4.2 \u6062\u590dnginx\u670d\u52a1","text":"<pre><code>[root@master velero-v1.4.2-linux-amd64]# velero restore create --from-backup nginx-backup --wait\nRestore request \"nginx-backup-20200722134728\" submitted successfully.\nWaiting for restore to complete. You may safely press ctrl-c to stop waiting - your restore will continue in the background.\n\nRestore completed with status: Completed. You may check for more information using the commands `velero restore describe nginx-backup-20200722134728` and `velero restore logs nginx-backup-20200722134728`.\n[root@master velero-v1.4.2-linux-amd64]# kubectl  get pods -n nginx-example\nNAME                               READY   STATUS    RESTARTS   AGE\nnginx-deployment-f4769bfdf-8jrsz   1/1     Running   0          7s\nnginx-deployment-f4769bfdf-sqfp4   1/1     Running   0          7s\n</code></pre> <p>\u6ce8\u610f\uff1a<code>velero restore</code> \u6062\u590d\u4e0d\u4f1a\u8986\u76d6<code>\u5df2\u6709\u7684\u8d44\u6e90</code>\uff0c\u53ea\u6062\u590d\u5f53\u524d\u96c6\u7fa4\u4e2d<code>\u4e0d\u5b58\u5728\u7684\u8d44\u6e90</code>\u3002\u5df2\u6709\u7684\u8d44\u6e90\u4e0d\u4f1a\u56de\u6eda\u5230\u4e4b\u524d\u7684\u7248\u672c\uff0c\u5982\u9700\u8981\u56de\u6eda\uff0c\u9700\u5728restore\u4e4b\u524d\u63d0\u524d\u5220\u9664\u73b0\u6709\u7684\u8d44\u6e90\u3002</p> <p></p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#velerooss","title":"\u4e94 \u5b9e\u8df5velero\u5907\u4efdOSS","text":"<p>\u672c\u5b9e\u4f8b\u5b9e\u8df5\u5982\u4f55\u5728\u963f\u91cc\u4e91\u5bb9\u5668\u670d\u52a1 ACK \u4f7f\u7528 Velero \u5b8c\u6210\u5907\u4efd\u548c\u8fc1\u79fb\u3002</p> <p>ACK \u63d2\u4ef6\u5730\u5740\uff1ahttps://github.com/AliyunContainerService/velero-plugin</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#51-oss-bucket","title":"5.1 \u521b\u5efaOSS bucket","text":"<p>\u7531\u4e8e\u4e3a\u4f4e\u9891\u5b58\u50a8\uff0c\u7c7b\u578b\u4e3a\u4f4e\u9891\u8bbf\u95ee\u5b58\u50a8\uff0c\u6743\u9650\u4e3a\u79c1\u6709</p> <p></p> <ul> <li>\u521b\u5efabucket\uff0c\u5728\u914d\u7f6evelero \u7684prefix\u4e2d\u7528\u5230</li> </ul> <p></p> <ul> <li>\u914d\u7f6e\u5bf9\u8c61\u5b58\u50a8\u751f\u547d\u5468\u671f</li> </ul> <p></p> <p></p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#52-ram","title":"5.2 \u521b\u5efa\u963f\u91cc\u4e91RAM\u7528\u6237","text":"<p>\u5728\u6b64\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u963f\u91cc\u4e91RAM\u7528\u6237\uff0c\u7528\u4e8e\u64cd\u4f5cOSS\u4ee5\u53caACK\u8d44\u6e90\u3002</p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#521","title":"5.2.1 \u65b0\u5efa\u6743\u9650\u7b56\u7565","text":"<p>\u7b56\u7565\u5185\u5bb9\uff1a</p> <pre><code>{\n\"Version\": \"1\",\n\"Statement\": [\n    {\n        \"Action\": [\n            \"ecs:DescribeSnapshots\",\n            \"ecs:CreateSnapshot\",\n            \"ecs:DeleteSnapshot\",\n            \"ecs:DescribeDisks\",\n            \"ecs:CreateDisk\",\n            \"ecs:Addtags\",\n            \"oss:PutObject\",\n            \"oss:GetObject\",\n            \"oss:DeleteObject\",\n            \"oss:GetBucket\",\n            \"oss:ListObjects\"\n        ],\n        \"Resource\": [\n            \"*\"\n        ],\n        \"Effect\": \"Allow\"\n    }\n]\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#522","title":"5.2.2 \u65b0\u5efa\u7528\u6237","text":"<p>\u5728\u65b0\u5efa\u7528\u6237\u7684\u65f6\u5019\u8981\u9009\u62e9 <code>\u7f16\u7a0b\u8bbf\u95ee</code>\uff0c\u6765\u83b7\u53d6 <code>AccessKeyID</code> \u548c <code>AccessKeySecret</code>\uff0c\u8fd9\u91cc\u8bf7\u521b\u5efa\u4e00\u4e2a\u65b0\u7528\u4e8e\u7528\u4e8e\u5907\u4efd\uff0c\u4e0d\u8981\u4f7f\u7528\u8001\u7528\u6237\u7684 AK \u548c AS\u3002</p> <p></p>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#53","title":"5.3 \u90e8\u7f72\u670d\u52a1\u7aef","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#531-velero","title":"5.3.1 \u62c9\u53d6velero\u63d2\u4ef6","text":"<pre><code>git clone https://github.com/AliyunContainerService/velero-plugin\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#532","title":"5.3.2 \u914d\u7f6e\u53c2\u6570","text":"<ul> <li>\u4fee\u6539 <code>install/credentials-velero</code> \u6587\u4ef6\uff0c\u5c06\u65b0\u5efa\u7528\u6237\u4e2d\u83b7\u5f97\u7684 <code>AccessKeyID</code> \u548c <code>AccessKeySecret</code> \u586b\u5165\u3002</li> </ul> <pre><code>ALIBABA_CLOUD_ACCESS_KEY_ID=&lt;ALIBABA_CLOUD_ACCESS_KEY_ID&gt;\nALIBABA_CLOUD_ACCESS_KEY_SECRET=&lt;ALIBABA_CLOUD_ACCESS_KEY_SECRET&gt;\n</code></pre> <ul> <li> </li> </ul> <p>1.\u521b\u5efa velero \u547d\u540d\u7a7a\u95f4 \u548c \u963f\u91cc\u4e91 secret</p> <pre><code># \u521b\u5efa velero \u547d\u540d\u7a7a\u95f4\n$ kubectl create namespace velero\n\n# \u521b\u5efa\u963f\u91cc\u4e91 secret\n$ kubectl create secret generic cloud-credentials --namespace velero --from-file cloud=install/credentials-velero\n</code></pre> <p>2.\u66ff\u6362crd\u4e2d\u5bf9\u8c61\u5b58\u50a8\u4fe1\u606f\uff0c\u90e8\u7f72crd\u548cvelero</p> <pre><code># OSS Bucket \u540d\u79f0\n$ BUCKET=devops-k8s-backup\n\n# OSS \u6240\u5728\u53ef\u7528\u533a\n$ REGION=cn-shanghai\n\n# bucket \u540d\u5b57\n$ prefix=velero\n\n# \u90e8\u7f72 velero CRD\n$ kubectl apply -f install/00-crds.yaml\n\n# \u66ff\u6362 OSS Bucket \u4e0e OSS \u6240\u5728\u53ef\u7528\u533a\n$ sed -i \"s#&lt;BUCKET&gt;#$BUCKET#\" install/01-velero.yaml\n$ sed -i \"s#&lt;REGION&gt;#$REGION#\" install/01-velero.yaml\n\n# \u66ff\u6362bucket \u4e2d\u540d\u5b57prifix\n\n\n# \u67e5\u770b\u5dee\u5f02\n[root@master velero-plugin]# git diff install/01-velero.yaml\ndiff --git a/install/01-velero.yaml b/install/01-velero.yaml\nindex 5669860..7dd4c5a 100644\n--- a/install/01-velero.yaml\n+++ b/install/01-velero.yaml\n@@ -31,10 +31,10 @@ metadata:\n   namespace: velero\n spec:\n   config:\n-    region: &lt;REGION&gt;\n+    region: cn-shanghai\n   objectStorage:\n-    bucket: &lt;BUCKET&gt;\n-    prefix: \"\"\n+    bucket: devops-k8s-backup\n+    prefix: \"velero\"\n   provider: alibabacloud\n\n ---\n@@ -47,7 +47,7 @@ metadata:\n   namespace: velero\n spec:\n   config:\n-    region: &lt;REGION&gt;\n+    region: cn-shanghai\n   provider: alibabacloud\n\n ---\n\n# \u521b\u5efa\u8ba4\u8bc1secret\nkubectl create namespace velero\n\n\n# \u90e8\u7f72velero\n$ kubectl apply -f install/\n\n# \u67e5\u770bvelero\n$ kubectl  get pods -n velero\n[root@master velero-plugin]# kubectl  get pods -n velero   \nNAME                     READY   STATUS      RESTARTS   AGE\nvelero-fcc8d77b8-569jz   1/1     Running     0          45s\n\n\n# \u67e5\u770b\u4f4d\u7f6e\n[root@master velero-plugin]# velero get backup-locations\nNAME      PROVIDER       BUCKET/PREFIX              ACCESS MODE\ndefault   alibabacloud   devops-k8s-backup/velero   ReadWrite\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#oss-bucket-velero","title":"\u8bbe\u7f6e\u5907\u4efd OSS Bucket \u4e0e \u53ef\u7528\u533a \u5e76\u90e8\u7f72 velero","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#54","title":"5.4 \u5907\u4efd\u6062\u590d","text":""},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#541","title":"5.4.1 \u5907\u4efd","text":"<pre><code>$ velero backup create nginx-example --include-namespaces nginx-example\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#542","title":"5.4.2 \u6062\u590d","text":"<pre><code> velero restore create --from-backup nginx-example\n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#543","title":"5.4.3 \u5468\u671f\u6027\u4efb\u52a1","text":"<pre><code># Create a backup every 6 hours\nvelero create schedule NAME --schedule=\"0 */6 * * *\"\n\n# Create a backup every 6 hours with the @every notation\nvelero create schedule NAME --schedule=\"@every 6h\"\n\n# Create a daily backup of the web namespace\nvelero create schedule NAME --schedule=\"@every 24h\" --include-namespaces web\n\n# Create a weekly backup, each living for 90 days (2160 hours)\nvelero create schedule NAME --schedule=\"@every 168h\" --ttl 2160h0m0s\n\n\n# \u6bcf\u65e5\u5bf9anchnet-devops-dev/anchnet-devops-test/anchnet-devops-prod/anchnet-devops-common-test \u540d\u79f0\u7a7a\u95f4\u8fdb\u884c\u5907\u4efd\nvelero create schedule anchnet-devops-dev --schedule=\"@every 24h\" --include-namespaces anchnet-devops-dev \nvelero create schedule anchnet-devops-test --schedule=\"@every 24h\" --include-namespaces anchnet-devops-test\nvelero create schedule anchnet-devops-prod --schedule=\"@every 24h\" --include-namespaces anchnet-devops-prod \nvelero create schedule anchnet-devops-common-test --schedule=\"@every 24h\" --include-namespaces anchnet-devops-common-test \n</code></pre>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#_3","title":"\u516d \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5728velero\u5907\u4efd\u7684\u65f6\u5019\uff0c\u5907\u4efd\u8fc7\u7a0b\u4e2d\u521b\u5efa\u7684\u5bf9\u8c61\u662f\u4e0d\u4f1a\u88ab\u5907\u4efd\u7684\u3002</li> <li> <p><code>velero restore</code> \u6062\u590d\u4e0d\u4f1a\u8986\u76d6<code>\u5df2\u6709\u7684\u8d44\u6e90</code>\uff0c\u53ea\u6062\u590d\u5f53\u524d\u96c6\u7fa4\u4e2d<code>\u4e0d\u5b58\u5728\u7684\u8d44\u6e90</code>\u3002\u5df2\u6709\u7684\u8d44\u6e90\u4e0d\u4f1a\u56de\u6eda\u5230\u4e4b\u524d\u7684\u7248\u672c\uff0c\u5982\u9700\u8981\u56de\u6eda\uff0c\u9700\u5728restore\u4e4b\u524d\u63d0\u524d\u5220\u9664\u73b0\u6709\u7684\u8d44\u6e90\u3002</p> </li> <li> <p>\u540e\u671f\u53ef\u4ee5\u8bb2velero\u4f5c\u4e3a\u4e00\u4e2acrontjob\u6765\u8fd0\u884c\uff0c\u5b9a\u671f\u5907\u4efd\u6570\u636e\u3002</p> </li> <li> <p>\u5728\u9ad8\u7248\u672c1.16.x\u4e2d\uff0c\u62a5\u9519<code>error: unable to recognize \"filebeat.yml\": no matches for kind \"DaemonSet\" in version \"extensions/v1beta1\"</code> ,\u5c06yml\u914d\u7f6e\u6587\u4ef6\u5185\u7684api\u63a5\u53e3\u4fee\u6539\u4e3a apps/v1 \uff0c\u5bfc\u81f4\u539f\u56e0\u4e3a\u4e4b\u95f4\u4f7f\u7528\u7684kubernetes \u7248\u672c\u662f1.14.x\u7248\u672c\uff0c1.16.x \u7248\u672c\u653e\u5f03\u90e8\u5206API\u652f\u6301\uff01</p> </li> </ul>"},{"location":"cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/#_4","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>https://www.hi-linux.com/posts/60858.html</li> <li>https://zhuanlan.zhihu.com/p/92853124</li> <li>https://www.cnblogs.com/charlieroro/p/11738322.html</li> <li>https://bingohuang.com/heptio-velero-intro/</li> <li>https://mp.weixin.qq.com/s/2WEgLm717u9QNh6MI4_Sxw</li> <li>https://velero.io/</li> <li>https://github.com/heptio/velero</li> <li>https://github.com/heptio/velero-community</li> <li>https://www.cncf.io/webinars/kubernetes-backup-and-migration-strategies-using-project-velero/</li> <li>https://developer.aliyun.com/article/705007</li> <li>https://github.com/AliyunContainerService/velero-plugin</li> <li>https://developer.aliyun.com/article/726863</li> <li>https://cloud.tencent.com/developer/article/1653649</li> </ul>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/","title":"\u67b6\u6784\u56fe\u795e\u5668DaC\u4e4bDiagram","text":""},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u901a\u8fc7\u56fe\u53ef\u4ee5\u7528 Python \u4ee3\u7801\u7ed8\u5236\u4e91\u7cfb\u7edf\u67b6\u6784\u3002\u5b83\u7684\u8bde\u751f\u662f\u4e3a\u4e86\u5728\u6ca1\u6709\u4efb\u4f55\u8bbe\u8ba1\u5de5\u5177\u7684\u60c5\u51b5\u4e0b\u5bf9\u4e00\u4e2a\u65b0\u7684\u7cfb\u7edf\u67b6\u6784\u8bbe\u8ba1\u8fdb\u884c\u539f\u578b\u5316\u3002\u60a8\u8fd8\u53ef\u4ee5\u63cf\u8ff0\u6216\u53ef\u89c6\u5316\u73b0\u6709\u7684\u7cfb\u7edf\u4f53\u7cfb\u7ed3\u6784\u3002\u56fe\u76ee\u524d\u652f\u6301\u7684\u4e3b\u8981\u4f9b\u5e94\u5546\u5305\u62ec: AWS\uff0cAzure\uff0cGCP\uff0cKubernetes\uff0c\u963f\u91cc\u5df4\u5df4\u4e91\uff0c\u7532\u9aa8\u6587\u4e91\u7b49\u3002\u5b83\u8fd8\u652f\u6301 On-Premise \u8282\u70b9\u3001 SaaS \u4ee5\u53ca\u4e3b\u8981\u7684\u7f16\u7a0b\u6846\u67b6\u548c\u8bed\u8a00\u3002</p> <p>\u4ee3\u7801\u5173\u7cfb\u56fe\u8fd8\u5141\u8bb8\u60a8\u8ddf\u8e2a\u4efb\u4f55\u7248\u672c\u63a7\u5236\u7cfb\u7edf\u4e2d\u7684\u4f53\u7cfb\u7ed3\u6784\u5173\u7cfb\u56fe\u66f4\u6539\u3002\u6ce8\u610f: \u5b83\u4e0d\u63a7\u5236\u4efb\u4f55\u5b9e\u9645\u7684\u4e91\u8d44\u6e90\uff0c\u4e5f\u4e0d\u751f\u6210\u4e91\u5f62\u6210\u6216\u5730\u5f62\u4ee3\u7801\u3002\u5b83\u53ea\u662f\u7528\u4e8e\u7ed8\u5236\u4e91\u7cfb\u7edf\u4f53\u7cfb\u7ed3\u6784\u56fe\u3002</p> <p>\u76f8\u6bd4\u4e8e\u5728 UI \u4e0a\u5bf9\u5404\u79cd\u56fe\u6807\u8fdb\u884c\u62d6\u62fd\u548c\u8c03\u6574\uff0c\u8fd9\u79cdDaC(Diagram as Code)\u65b9\u5f0f\u66f4\u7b26\u5408\u6211\u4eec\u7a0b\u5e8f\u5458\u7684\u4f7f\u7528\u4e60\u60ef\u3002</p>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#_2","title":"\u4e8c \u652f\u6301\u8303\u56f4","text":""},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#_3","title":"\u4e09 \u793a\u4f8b\u56fe\u7247","text":""},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#_4","title":"\u56db \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#41-python","title":"4.1 Python\u73af\u5883","text":"<p>python\u73af\u5883\u7248\u672c\u4e3a3.6\u4ee5\u4e0a\uff0c\u7531\u4e8e\u6211\u672c\u5730python\u73af\u5883\u7ba1\u7406\u4f7f\u7528anconda\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u5de5\u5177\u3002</p> <pre><code> conda create -n py-diagrams python=3.6\nconda activate py-diagrams\n</code></pre>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#42-graphviz","title":"4.2 graphviz\u5b89\u88c5","text":"<p>\u5b83\u4f7f\u7528Graphviz\u6765\u5448\u73b0\u56fe\u8868\uff0c\u56e0\u6b64\u60a8\u9700\u8981\u5b89\u88c5Graphviz\u6765\u4f7f\u7528\u56fe\u8868\u3002\u5b89\u88c5graphviz\uff08\u6216\u5df2\u7ecf\u5b89\u88c5\uff09\u4e4b\u540e\uff0c\u5b89\u88c5\u8fd9\u4e9b\u5173\u7cfb\u56fe\u3002</p> <pre><code>apt-get install graphviz\n\n# macos\n\nbrew install graphviz\n</code></pre>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#_5","title":"\u4e94 \u4f7f\u7528","text":""},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#51","title":"5.1 \u7f16\u5199\u4ee3\u7801","text":"<pre><code># diagram.py\nfrom diagrams import Diagram\nfrom diagrams.aws.compute import EC2\nfrom diagrams.aws.database import RDS\nfrom diagrams.aws.network import ELB\n\nwith Diagram(\"Grouped Workers\", show=False, direction=\"TB\"):\n    ELB(\"lb\") &gt;&gt; [EC2(\"worker1\"),\n                  EC2(\"worker2\"),\n                  EC2(\"worker3\"),\n                  EC2(\"worker4\"),\n                  EC2(\"worker5\")] &gt;&gt; RDS(\"events\")\n</code></pre>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#52","title":"5.2 \u751f\u6210\u56fe\u7247","text":"<pre><code>python diagram.py\n</code></pre>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#_6","title":"\u516d \u903b\u8f91\u7b80\u4ecb","text":""},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#61","title":"6.1 \u7ed8\u56fe\u5bf9\u8c61","text":""},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#611-diagram","title":"6.1.1 Diagram","text":"<p><code>Diagram</code>\uff1a\u8fd9\u662f\u8868\u793a\u56fe\u7684\u6700\u4e3b\u8981\u7684\u5bf9\u8c61\uff0c\u4ee3\u8868\u4e00\u4e2a\u67b6\u6784\u56fe</p> <p>\u4f7f\u7528 <code>Diagram</code> \u7c7b\u6765\u521b\u5efa\u56fe\u73af\u5883\u4e0a\u4e0b\u6587\uff0c\u4f7f\u7528 <code>with</code> \u8bed\u6cd5\u6765\u4f7f\u7528\u8fd9\u4e2a\u4e0a\u4e0b\u6587\u3002<code>Diagram</code> \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4f1a\u88ab\u7528\u4f5c\u67b6\u6784\u56fe\u7684\u540d\u79f0\u4ee5\u53ca\u8f93\u51fa\u7684\u56fe\u7247\u6587\u4ef6\u540d\uff08\u8f6c\u6362\u4e3a\u5c0f\u5199+\u4e0b\u5212\u7ebf\uff09\u3002</p> <p><code>Diagram</code> \u652f\u6301\u53c2\u6570\uff1a</p> <ul> <li><code>outformat</code>\uff1a\u6307\u5b9a\u8f93\u51fa\u56fe\u7247\u7684\u7c7b\u578b\uff0c\u9ed8\u8ba4\u662f <code>png</code>\uff0c\u53ef\u4ee5\u662f <code>png</code>\u3001<code>jpg</code>\u3001<code>svg</code> \u548c <code>pdf</code></li> <li><code>show</code>\uff1a\u6307\u5b9a\u662f\u5426\u663e\u793a\u56fe\u7247\uff0c\u9ed8\u8ba4\u662f <code>False</code></li> <li><code>graph_attr</code>\u3001<code>node_attr</code> \u548c <code>edge_attr</code>\uff1a\u6307\u5b9a <code>Graphviz</code> \u5c5e\u6027\u9009\u9879\uff0c\u7528\u6765\u63a7\u5236\u56fe\u3001\u70b9\u3001\u7ebf\u7684\u6837\u5f0f\uff0c\u8be6\u60c5\u67e5\u770b \u53c2\u8003\u94fe\u63a5</li> </ul>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#612-node","title":"6.1.2 Node","text":"<p><code>Node</code>\uff1a\u8868\u793a\u4e00\u4e2a\u8282\u70b9\u6216\u7cfb\u7edf\u7ec4\u4ef6\uff0c\u6bd4\u5982<code>\u5feb\u901f\u5f00\u59cb</code>\u4e2d\u7684<code>SLB</code>\u3001<code>ECS</code>\u548c<code>RDS</code>\u90fd\u662f\u67b6\u6784\u56fe\u4e2d\u7684\u8282\u70b9\u3002</p> <p>\u8282\u70b9\u4e4b\u95f4\u7684\u5173\u7cfb\u4f7f\u7528\u64cd\u4f5c\u7b26\u6765\u8868\u793a\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li><code>&gt;&gt;</code>\uff1a\u5de6\u8282\u70b9\u6307\u5411\u53f3\u8282\u70b9</li> <li><code>&lt;&lt;</code>\uff1a\u53f3\u8282\u70b9\u6307\u5411\u5de6\u8282\u70b9</li> <li><code>-</code>\uff1a\u8282\u70b9\u4e92\u76f8\u8fde\u63a5\uff0c\u6ca1\u6709\u65b9\u5411</li> </ul>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#613-cluster","title":"6.1.3 Cluster","text":"<p><code>Cluster</code>\uff1a\u8868\u793a\u96c6\u7fa4\u6216\u5206\u7ec4\uff0c\u53ef\u5c06\u591a\u4e2a\u8282\u70b9\u653e\u5230\u4e00\u4e2a\u96c6\u7fa4\u4e2d\uff0c\u5b83\u4e5f\u662f\u4e00\u4e2a\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\uff0c\u4f7f\u7528 <code>with</code> \u8bed\u6cd5\u3002</p>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#62","title":"6.2 \u8d21\u732e\u4e91\u5382\u5546","text":"<p>\u9700\u8981\u5728 <code>resources/aws</code> \u6587\u4ef6\u5939\u4e2d\u66f4\u65b0\u8d44\u6e90\u56fe\u7247\uff0c\u7136\u540e\u6267\u884c <code>./autogen.sh</code> \u5373\u53ef\u3002<code>./autogen.sh</code> \u4f1a\u5bf9 <code>resources/</code> \u505a\u8fd9\u4e48\u51e0\u4ef6\u4e8b\uff1a</p> <ul> <li>\u5c06\u7279\u5b9a\u4e91\u4f9b\u5e94\u5546\u7684 <code>svg</code> \u56fe\u7247\u8f6c\u6362\u4e3a <code>png</code></li> <li>\u5c06\u7279\u5b9a\u4e91\u4f9b\u5e94\u5546\u7684\u56fe\u7247\u8c03\u6574\u4e3a\u5706\u89d2\u56fe\u7247</li> <li>\u81ea\u52a8\u751f\u6210\u8282\u70b9\u7c7b\u4ee3\u7801</li> <li>\u81ea\u52a8\u751f\u6210\u6587\u6863</li> <li>\u4f7f\u7528 <code>black</code> \u683c\u5f0f\u5316\u81ea\u52a8\u751f\u6210\u7684\u4ee3\u7801</li> </ul>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#63","title":"6.3 \u81ea\u5b9a\u4e49\u56fe\u7247","text":"<ul> <li>\u5b9a\u4e49\u56fe\u7247\u53d8\u91cf\uff0c\u5c06\u94fe\u63a5\u5730\u5740urlretrieve\u4e3aicon\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u3002</li> </ul> <pre><code>from urllib.request import urlretrieve\n\nfrom diagrams import Cluster, Diagram\nfrom diagrams.aws.database import Aurora\nfrom diagrams.custom import Custom\nfrom diagrams.k8s.compute import Pod\n\n# Download an image to be used into a Custom Node class\n#rabbitmq_url = \"https://jpadilla.github.io/rabbitmqapp/assets/img/icon.png\"\nrabbitmq_url = \"https://img2018.cnblogs.com/blog/1538609/201907/1538609-20190720105324996-496731759.jpg\"\nrabbitmq_icon = \"rabbitmq.png\"\nurlretrieve(rabbitmq_url, rabbitmq_icon)\n\nwith Diagram(\"01-Broker Consumers\", show=False):\n    with Cluster(\"Consumers\"):\n        consumers = [\n            Pod(\"worker\"),\n            Pod(\"worker\"),\n            Pod(\"worker\")]\n\n    queue = Custom(\"Message queue\", rabbitmq_icon)\n\n    queue &gt;&gt; consumers &gt;&gt; Aurora(\"Database\")\n</code></pre> <ul> <li>\u751f\u6210\u56fe\u7247</li> </ul>"},{"location":"cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/#_7","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li> <p>https://github.com/mingrammer/diagrams</p> </li> <li> <p>https://github.com/blushft/go-diagrams</p> </li> <li> <p>https://diagrams.mingrammer.com/docs/getting-started/installation</p> </li> <li> <p>https://diagrams.mingrammer.com/docs/getting-started/examples</p> </li> <li> <p>https://blog.csdn.net/wangbinxin001/article/details/104344692</p> </li> <li>https://www.tonyballantyne.com/graphs.html</li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/","title":"Velero \u4e8c\u6b21\u5f00\u53d1","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#_1","title":"\u4e00 \u51c6\u5907\u5de5\u4f5c","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#11","title":"1.1 \u5f00\u59cb\u4e4b\u524d","text":"<ul> <li>\u719f\u6089\u884c\u4e3a\u51c6\u5219Code of Conduct\u3002 </li> <li>\u53c2\u9605 CONTRIBUTING.md\u4ee5\u83b7\u53d6\u5f00\u53d1\u51c6\u5219\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#12","title":"1.2 \u521b\u5efa\u8bbe\u8ba1\u6587\u6863","text":"<p>\u62e5\u6709\u4e00\u4e2a\u9ad8\u5c42\u6b21\u7684\u8bbe\u8ba1\u6587\u6863\uff0c\u5176\u4e2d\u5305\u542b\u5efa\u8bae\u7684\u53d8\u66f4\u548c\u5f71\u54cd\uff0c\u53ef\u4ee5\u5e2e\u52a9\u7ef4\u62a4\u4eba\u5458\u8bc4\u4f30\u662f\u5426\u5e94\u8be5\u5408\u5e76\u4e00\u4e2a\u4e3b\u8981\u53d8\u66f4\u3002\u8981\u53d1\u51fa\u8bbe\u8ba1\u62c9\u8bf7\u6c42\uff0c\u53ef\u4ee5\u5c06 design/_ template.md \u6587\u4ef6\u4e2d\u7684\u6a21\u677f\u590d\u5236\u5230\u65b0\u7684 Markdown \u6587\u4ef6\u4e2d\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#13","title":"1.3 \u5bfb\u627e\u8def\u5f84","text":"<p>\u4f60\u53ef\u4ee5\u52a0\u5165 Velero \u793e\u533a\uff0c\u4ee5\u4e0d\u540c\u7684\u65b9\u5f0f\u505a\u51fa\u8d21\u732e\uff0c\u5305\u62ec\u5e2e\u52a9\u6211\u4eec\u8bbe\u8ba1\u6216\u6d4b\u8bd5\u65b0\u529f\u80fd\u3002\u5bf9\u4e8e\u4efb\u4f55\u6211\u4eec\u8003\u8651\u6dfb\u52a0\u7684\u91cd\u8981\u7279\u6027\uff0c\u6211\u4eec\u4ece\u8bbe\u8ba1\u6587\u6863\u5f00\u59cb\u3002\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u4e00\u4e2a\u6b63\u5728\u8fdb\u884c\u4e2d\u7684\u65b0\u8bbe\u8ba1\u7684\u5217\u8868: https://github.com/vmware-tanzu/velero/pulls?q=is%3aopen+is%3apr+label%3adesign\u3002\u8bf7\u968f\u65f6\u56de\u987e\u5e76\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\u60a8\u7684\u8f93\u5165\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528: + 1: \u548c \u5bf9\u95ee\u9898\u8fdb\u884c\u6295\u7968\uff0c\u6b63\u5982\u6211\u4eec\u7684\u529f\u80fd\u589e\u5f3a\u8bf7\u6c42\u548c Bug \u95ee\u9898\u6a21\u677f\u4e2d\u6240\u89e3\u91ca\u7684\u90a3\u6837\u3002\u8fd9\u5c06\u5e2e\u52a9\u6211\u4eec\u91cf\u5316\u95ee\u9898\u7684\u91cd\u8981\u6027\u5e76\u5bf9\u5176\u8fdb\u884c\u4f18\u5148\u6392\u5e8f\u3002\u5173\u4e8e\u5982\u4f55\u4e0e\u6211\u4eec\u7684\u7ef4\u62a4\u8005\u548c\u793e\u533a\u8054\u7cfb\u7684\u4fe1\u606f\uff0c\u53c2\u52a0\u6211\u4eec\u7684\u5728\u7ebf\u4f1a\u8bae\uff0c\u6216\u8005\u627e\u5230\u597d\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u4ece\u6211\u4eec\u7684 Velero \u793e\u533a\u9875\u9762\u5f00\u59cb\u3002\u8bf7\u6d4f\u89c8\u6211\u4eec\u7684\u8d44\u6e90\u5217\u8868\uff0c\u5305\u62ec\u8fc7\u53bb\u7684\u5728\u7ebf\u793e\u533a\u4f1a\u8bae\u3001\u535a\u5ba2\u6587\u7ae0\u548c\u5176\u4ed6\u8d44\u6e90\u7684\u64ad\u653e\u5217\u8868\uff0c\u4ee5\u5e2e\u52a9\u60a8\u719f\u6089\u6211\u4eec\u7684\u9879\u76ee: Velero \u8d44\u6e90\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#_2","title":"\u4e8c \u5f00\u59cb\u5f00\u53d1","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#21","title":"2.1 \u66f4\u65b0\u751f\u6210\u6587\u4ef6","text":"<p>\u4f1apull\u4e00\u4e2avelero/build-image \u7684\u955c\u50cf</p> <p></p> <p>\u5982\u679c\u60a8\u505a\u4e86\u4ee5\u4e0b\u66f4\u6539\uff0c\u8bf7\u8fd0\u884c make update \u4ee5\u91cd\u65b0\u751f\u6210\u6587\u4ef6:</p> <ul> <li>Add/edit/remove command line flags and/or their help text</li> <li>Add/edit/remove commands or subcommands</li> <li>Add new API types</li> <li>Add/edit/remove plugin protobuf message or service definitions</li> </ul> <p></p> <p>\u4e0b\u9762\u7684\u6587\u4ef6\u662f\u4ece\u6e90\u4ee3\u7801\u81ea\u52a8\u751f\u6210\u7684:</p> <ul> <li>The clientset</li> <li>Listers</li> <li>Shared informers</li> <li>Documentation</li> <li>Protobuf/gRPC types</li> </ul> <p>\u60a8\u53ef\u4ee5\u8fd0\u884c make verify \u4ee5\u786e\u4fdd\u6240\u6709\u751f\u6210\u7684\u6587\u4ef6\uff08clientset\u3001listers\u3001shared informers\u3001docs\uff09\u90fd\u662f\u6700\u65b0\u7684\u3002</p> <p></p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#22-linting","title":"2.2 Linting","text":"<p>\u60a8\u53ef\u4ee5\u8fd0\u884c make lint \u6765\u6267\u884c\u6784\u5efa\u6620\u50cf\u4e2d\u7684 golangci-lint\uff0c\u6216\u8005\u6267\u884c\u6784\u5efa\u6620\u50cf\u5916\u90e8\u7684 local-lint\u3002\u4e24\u8005\u90fd\u4f7f lint \u548c\u4f7f\u5c40\u90e8-lint \u5c06\u53ea\u8fd0\u884c\u4e34\u65f6\u5bf9\u53d8\u5316\u3002</p> <p>\u4f7f\u7528 lint-all \u5bf9\u6574\u4e2a\u4ee3\u7801\u5e93\u8fd0\u884c linter\u3002 \u9ed8\u8ba4\u7684 linter \u662f\u901a\u8fc7 LINTERS \u53d8\u91cf\u5728 Makefile \u4e2d\u5b9a\u4e49\u7684\u3002 \u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c\u547d\u4ee4\u6765\u8986\u76d6\u9ed8\u8ba4\u7684 linter \u5217\u8868 </p> <pre><code>$ make lint LINTERS=gosec\n</code></pre> <p></p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#23","title":"2.3 \u5355\u5143\u6d4b\u8bd5","text":"<pre><code>make test\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#24-vendor","title":"2.4 vendor \u4f9d\u8d56","text":"<p>\u5982\u679c\u60a8\u9700\u8981\u6dfb\u52a0\u6216\u66f4\u65b0\u4f9b\u5e94\u5546\u4f9d\u8d56\u9879\uff0c\u8bf7\u53c2\u9605\u4f9b\u5e94\u5546\uff1aVendoring dependencies.</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#25","title":"2.5 \u4f7f\u7528\u4e3b\u5206\u652f","text":"<p>\u5982\u679c\u60a8\u6b63\u5728\u5f00\u53d1\u6216\u4f7f\u7528\u4e3b\u5206\u652f\uff0c\u8bf7\u6ce8\u610f\u60a8\u53ef\u80fd\u9700\u8981\u66f4\u65b0 Velero CRD \u4ee5\u5728\u5176\u4ed6\u5f00\u53d1\u5de5\u4f5c\u5b8c\u6210\u65f6\u83b7\u5f97\u65b0\u7684\u66f4\u6539\u3002</p> <pre><code>$ velero install --crds-only --dry-run -o yaml | kubectl apply -f -\n</code></pre> <p></p> <p>\u6ce8\u610f: \u5982\u679c Velero CLI \u65e0\u6cd5\u53d1\u73b0 Kubernetes \u9996\u9009\u7684 CRD API \u7248\u672c\uff0c\u5219\u53ef\u4ee5\u66f4\u6539\u9ed8\u8ba4\u7684 CRD API \u7248\u672c(v1beta1\u6216 v1)\u3002Kubernetes \u7248\u672c &lt; 1.16\u7684\u9996\u9009 CRD API \u7248\u672c\u662f v1beta1; </p> <p>Kubernetes \u7248\u672c &gt; = 1.16\u7684\u9996\u9009 CRD API \u7248\u672c\u662f v1\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#tilt-velero","title":"\u4e09 \u4f7f\u7528 Tilt \u8fdb\u884c\u5feb\u901f\u8fed\u4ee3 Velero \u5f00\u53d1","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#31","title":"3.1 \u6982\u8981","text":"<p>\u672c\u6587\u6863\u63cf\u8ff0\u4e86\u5982\u4f55\u5c06 Tilt \u4e0e\u4efb\u4f55\u96c6\u7fa4\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u5b9e\u73b0\u7b80\u5316\u7684\u5de5\u4f5c\u6d41\uff0c\u4ece\u800c\u63d0\u4f9b\u7b80\u5355\u7684\u90e8\u7f72\u548c\u5feb\u901f\u7684\u8fed\u4ee3\u6784\u5efa\u3002\u8fd9\u79cd\u8bbe\u7f6e\u5141\u8bb8\u7ee7\u7eed\u90e8\u7f72 Velero \u670d\u52a1\u5668\uff0c\u5982\u679c\u6307\u5b9a\uff0c\u5219\u5141\u8bb8\u4efb\u4f55\u63d0\u4f9b\u7a0b\u5e8f\u63d2\u4ef6\u6216 restic daemonset\u3002\u5b83\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b8c\u6210\u8fd9\u9879\u5de5\u4f5c:</p> <ul> <li>\u90e8\u7f72\u5fc5\u8981\u7684 Kubernetes \u8d44\u6e90\uff0c\u4f8b\u5982 Velero CRD \u548c Velero \u90e8\u7f72</li> <li>\u4e3a Velero \u548c\uff08\u5982\u679c\u6307\u5b9a\uff09\u63d0\u4f9b\u7a0b\u5e8f\u63d2\u4ef6\u6784\u5efa\u672c\u5730\u4e8c\u8fdb\u5236\u6587\u4ef6\u4f5c\u4e3a local_resource</li> <li>\u8c03\u7528 docker_build \u5c06\u4efb\u4f55\u4e8c\u8fdb\u5236\u6587\u4ef6\u5b9e\u65f6\u66f4\u65b0\u5230\u5bb9\u5668/\u521d\u59cb\u5316\u5bb9\u5668\u4e2d\u5e76\u89e6\u53d1\u91cd\u65b0\u542f\u52a8</li> </ul> <p>Tilt \u4f1a\u5728 velero/tilt-resources \u4e0b\u5bfb\u627e\u914d\u7f6e\u6587\u4ef6\u3002\u6b64\u76ee\u5f55\u4e2d\u7684\u5927\u591a\u6570\u6587\u4ef6\u90fd\u88ab gitignored \u5ffd\u7565\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u6839\u636e\u9700\u8981\u914d\u7f6e\u60a8\u7684\u8bbe\u7f6e\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#32","title":"3.2 \u5148\u51b3\u6761\u4ef6","text":"<ol> <li>Docker v19.03\u6216\u66f4\u65b0\u7684 </li> <li>Kubernetes cluster v1.10\u6216\u66f4\u9ad8\u7248\u672c(\u4e0d\u4e00\u5b9a\u662f Kind) </li> <li>Tilt v0.12.0\u6216\u66f4\u65b0\u7248\u672c </li> <li>\u5728\u672c\u5730\u514b\u9686 Velero \u9879\u76ee\u5b58\u50a8\u5e93</li> <li>\u8bbf\u95ee S3 \u5bf9\u8c61\u5b58\u50a8</li> <li>\u514b\u9686\u60a8\u60f3\u8981\u66f4\u6539\u548c\u90e8\u7f72\u7684\u4efb\u4f55\u63d0\u4f9b\u7a0b\u5e8f\u63d2\u4ef6 (\u53ef\u9009\u7684\uff0c\u5fc5\u987b\u914d\u7f6e\u4e3a\u7531 Velero Tilt \u7684\u8bbe\u7f6e\u90e8\u7f72\uff0c\u66f4\u591a\u4fe1\u606f\u89c1\u4e0b)</li> </ol> <p>\u6ce8\u610f: \u8981\u6b63\u786e\u914d\u7f6e\u4f60\u4f7f\u7528\u7684\u4efb\u4f55\u63d2\u4ef6\uff0c\u8bf7\u53c2\u8003\u63d2\u4ef6\u6587\u6863\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#33","title":"3.3 \u5165\u95e8","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#331","title":"3.3.1 \u914d\u7f6e","text":"<ul> <li>\u5c06 velero/tilt-resources/examples \u4e0b\u7684\u6240\u6709\u793a\u4f8b\u6587\u4ef6\u590d\u5236\u5230 velero/tilt-resources \u4e2d\u3002</li> <li>\u914d\u7f6e velero_v1_backupstoragelocation.yaml \u6587\u4ef6\u548c\u5b58\u50a8\u51ed\u8bc1/\u5bc6\u94a5\u7684\u4e91\u6587\u4ef6\u3002</li> <li>\u8fd0\u884c<code>tilt up</code></li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#332-tilt","title":"3.3.2 \u521b\u5efa tilt \u8bbe\u7f6e\u6587\u4ef6","text":"<p>\u521b\u5efa\u4e00\u4e2a\u540d\u4e3atilt-settings.json \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u653e\u5728velero/tilt-resources \u7684\u672c\u5730\u526f\u672c\u4e2d\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u590d\u5236\u5e76\u7c98\u8d34\u5728 velero/tilt-resources/examples \u4e2d\u627e\u5230\u7684\u793a\u4f8b\u6587\u4ef6\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>{\n    \"default_registry\": \"\",\n    \"enable_providers\": [\n        \"aws\",\n        \"gcp\",\n        \"azure\",\n        \"csi\"\n    ],\n    \"providers\": {\n        \"aws\": \"../velero-plugin-for-aws\",\n        \"gcp\": \"../velero-plugin-for-gcp\",\n        \"azure\": \"../velero-plugin-for-microsoft-azure\",\n        \"csi\": \"../velero-plugin-for-csi\"\n    },\n    \"allowed_contexts\": [\n        \"development\"\n    ],\n    \"enable_restic\": false,\n    \"create_backup_locations\": true,\n    \"setup-minio\": true,\n    \"enable_debug\": false,\n    \"debug_continue_on_start\": true\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#333-tilt-settingsjson","title":"3.3.3 tilt-settings.json \u5b57\u6bb5","text":"<ul> <li>default_registry\uff1a(String, default=\u201d\")\uff0c\u5982\u679c\u4f60\u9700\u8981\u63a8\u9001\u955c\u50cf\u5230\u955c\u50cf\u4ed3\u5e93\u9700\u8981\u6539\u5b57\u6bb5\uff0c\u66f4\u8be6\u7ec6\u53ef\u53c2\u8003\uff1aTilt *documentation</li> <li>provider_repos\uff1a(Array[]String, default=[])\uff0c\u60a8\u8981\u66f4\u6539\u7684\u6240\u6709\u63d0\u4f9b\u7a0b\u5e8f\u63d2\u4ef6\u7684\u8def\u5f84\u5217\u8868\u3002\u6bcf\u4e2a\u63d0\u4f9b\u8005\u5fc5\u987b\u6709\u4e00\u4e2atilt-provider.json \u6587\u4ef6\u6765\u63cf\u8ff0\u5982\u4f55\u6784\u5efa\u63d0\u4f9b\u8005\u3002</li> <li> <p>enable_providers (Array[]String, default=[]):\u8981\u542f\u7528\u7684\u63d0\u4f9b\u7a0b\u5e8f\u63d2\u4ef6\u5217\u8868\u3002\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u9605\u63d0\u4f9b\u7a0b\u5e8f\u63d2\u4ef6\u3002\u6ce8\u610f: \u5f53\u4e0d\u5bf9\u63d2\u4ef6\u8fdb\u884c\u66f4\u6539\u65f6\uff0c\u4e0d\u9700\u8981\u5c06\u5b83\u4eec\u52a0\u8f7d\u5230 Tilt \u4e2d: \u53ef\u4ee5\u5728 Velero \u90e8\u7f72\u4e2d\u6307\u5b9a\u4e00\u4e2a\u73b0\u6709\u7684\u6620\u50cf\u548c\u7248\u672c\uff0cTilt \u5c06\u52a0\u8f7d\u8fd9\u4e9b\u5185\u5bb9\u3002</p> </li> <li> <p>allowed_contexts (Array, default=[]):\u5141\u8bb8 Tilt \u4f7f\u7528\u7684 kubeconfig \u4e0a\u4e0b\u6587\u5217\u8868\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u5173\u4e8e *allow_k8s_contexts \u7684 Tilt \u6587\u6863\u3002\u6ce8\u610f\uff1a Kind \u662f\u81ea\u52a8\u5141\u8bb8\u7684\u3002</p> </li> <li>enable_restic (Bool, default=false):\u6307\u793a\u662f\u5426\u90e8\u7f72restic Daemonset\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a true\uff0cTilt \u5c06\u67e5\u627e\u5305\u542b Velero restic DaemonSet \u914d\u7f6e\u7684 velero/tilt-resources/restic.yaml \u6587\u4ef6\u3002</li> <li>create_backup_locations (Bool, default=false):\u6307\u793a\u662f\u5426\u521b\u5efa\u4e00\u4e2a\u6216\u591a\u4e2a\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a true\uff0cTilt \u5c06\u67e5\u627e velero/tilt-resources/velero_v1_backupstoragelocation.yaml \u6587\u4ef6\uff0c\u5176\u4e2d\u81f3\u5c11\u5305\u542b\u4e00\u4e2a Velero \u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u7684\u914d\u7f6e\u3002</li> <li> <p>setup-minio (Bool, default=false):\u5982\u679c\u8981\u5728\u96c6\u7fa4\u5185\u8fd0\u884c\u7684 Minio \u5b9e\u4f8b\u4e2d\u914d\u7f6e\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\uff0c\u8bf7\u5c06\u6b64\u914d\u7f6e\u4e3a true\u3002</p> </li> <li> <p>enable_debug (Bool, default=false):\u5982\u679c\u8981\u4f7f\u7528 Delve \u8c03\u8bd5 velero \u8fdb\u7a0b\uff0c\u8bf7\u5c06\u6b64\u914d\u7f6e\u4e3a true\u3002</p> </li> <li>debug_continue_on_start (Bool, default=true):\u5982\u679c\u60a8\u5e0c\u671b velero \u8fdb\u7a0b\u5728\u8c03\u8bd5\u6a21\u5f0f\u4e0b\u5728\u542f\u52a8\u65f6\u7ee7\u7eed\uff0c\u8bf7\u5c06\u6b64\u914d\u7f6e\u4e3a true\u3002\u8bf7\u53c2\u9605  Delve CLI documentation \u6587\u6863\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#34-kubernetes","title":"3.4 \u521b\u5efa\u8981\u90e8\u7f72\u7684 Kubernetes \u8d44\u6e90\u6587\u4ef6","text":"<p>\u5728 velero/tilt-resources/examples \u76ee\u5f55\u4e2d\uff0c\u63d0\u4f9b\u4e86\u6240\u6709\u9700\u8981\u7684 Kubernetes \u8d44\u6e90\u6587\u4ef6\uff0c\u4ee5\u4fbf\u968f\u65f6\u4f7f\u7528\u793a\u4f8b\u3002\u4f60\u53ea\u9700\u8981\u5c06\u5b83\u4eec\u79fb\u52a8\u5230 velero/tilt-resources \u7ea7\u522b\u3002</p> <p>\u56e0\u4e3a Velero Kubernetes \u7684\u90e8\u7f72\u548c\u6062\u590d\u7684 DaemonSet \u5305\u542b\u6240\u6709\u8981\u4f7f\u7528\u7684\u63d2\u4ef6\u7684\u914d\u7f6e\uff0c\u6240\u4ee5\u8fd9\u4e9b\u8d44\u6e90\u7684\u6587\u4ef6\u5e94\u8be5\u7531\u7528\u6237\u63d0\u4f9b\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u9009\u62e9\u52a0\u8f7d\u54ea\u4e2a\u63d0\u4f9b\u8005\u63d2\u4ef6\u4f5c\u4e3a init \u5bb9\u5668\u3002\u76ee\u524d\uff0c\u6240\u63d0\u4f9b\u7684\u6837\u4f8b\u6587\u4ef6\u5df2\u7ecf\u914d\u7f6e\u4e86 Velero \u652f\u6301\u7684\u6240\u6709\u63d2\u4ef6\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u8981\u968f\u610f\u5220\u9664\u4efb\u4f55\u63d2\u4ef6\u3002</p> <p>\u4e3a\u4e86\u4f7f Velero \u5b8c\u5168\u8fd0\u884c\uff0c\u5b83\u8fd8\u9700\u8981\u81f3\u5c11\u4e00\u4e2a\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u3002\u63d0\u4f9b\u4e86\u4e00\u4e2a\u793a\u4f8b\u6587\u4ef6\uff0c\u9700\u8981\u4f7f\u7528\u5bf9\u8c61\u5b58\u50a8\u7684\u7279\u5b9a\u914d\u7f6e\u5bf9\u5176\u8fdb\u884c\u4fee\u6539\u3002\u8bf7\u53c2\u9605\u4e0b\u4e00\u5c0f\u8282\u4ee5\u83b7\u5f97\u66f4\u591a\u5173\u4e8e\u6b64\u7684\u8be6\u7ec6\u4fe1\u606f\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#35-backup-storage-location","title":"3.5 \u914d\u7f6e\u4e00\u4e2abackup storage location","text":"<p>\u60a8\u5fc5\u987b\u914d\u7f6e velero/tilt-resources/velero _ v1 _ backupstoragellocation\u3002\u6839\u636e\u60a8\u7684\u5b58\u50a8\u63d0\u4f9b\u7a0b\u5e8f\u4f7f\u7528\u9002\u5f53\u7684\u503c\u3002\u53c2\u8003plugin documentation\uff0c\u4e86\u89e3\u7279\u5b9a\u63d0\u4f9b\u8005\u7684\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u914d\u7f6e\u9700\u8981\u54ea\u4e9b\u5b57\u6bb5/\u503c\u5bf9\u3002</p> <p>\u4e0b\u9762\u662f\u4e3a Velero \u914d\u7f6e\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u7684\u4e00\u4e9b\u65b9\u6cd5\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#351","title":"3.5.1 \u4f7f\u7528\u516c\u6709\u4e91\u5b58\u50a8","text":"<p>\u6309\u7167\u63d0\u4f9b\u7a0b\u5e8f\u6587\u6863\u6765\u914d\u7f6e\u5b58\u50a8\u3002\u6211\u4eec\u6709\u4e00\u4e2a\u6240\u6709\u5df2\u77e5\u5bf9\u8c61\u5b58\u50a8\u63d0\u4f9b\u7a0b\u5e8f\u7684\u5217\u8868\uff0c\u4ee5\u53ca\u76f8\u5e94\u7684 Velero \u63d2\u4ef6\u3002list of all known object storage providers </p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#352-minio","title":"3.5.2 \u4f7f\u7528MinIO\u4f5c\u4e3a\u5bf9\u8c61\u5b58\u50a8","text":"<p>\u6ce8\u610f\uff1a\u8981\u5c06 MinIO \u7528\u4f5c\u5bf9\u8c61\u5b58\u50a8\uff0c\u60a8\u9700\u8981\u4f7f\u7528 <code>AWS</code> plugin\uff0c\u5e76\u5c06\u5b58\u50a8\u4f4d\u7f6e\u914d\u7f6e\u4e3a\u5c06 spec.provider \u8bbe\u7f6e\u4e3a aws\uff0c\u5c06 spec.config.region \u8bbe\u7f6e\u4e3a minio\u3002\u4f8b\u5b50\uff1a</p> <pre><code>spec:\n  config:\n    region: minio\n    s3ForcePathStyle: \"true\"\n    s3Url: http://minio.velero.svc:9000\n  objectStorage:\n    bucket: velero\n  provider: aws\n</code></pre> <p>\u4ee5\u4e0b\u662f\u4f7f\u7528 MinIO \u4f5c\u4e3a\u5b58\u50a8\u7684\u4e24\u79cd\u65b9\u6cd5:</p> <ol> <li>\u4f5c\u4e3a\u5728\u96c6\u7fa4\u5185\u8fd0\u884c\u7684 MinIO \u5b9e\u4f8b\uff08\u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8fd9\u6837\u505a\uff01\uff09</li> </ol> <p>\u5728tilt-settings.json \u6587\u4ef6\u4e2d\uff0c\u8bbe\u7f6e\u201csetup-minio\u201d\uff1atrue\u3002\u8fd9\u5c06\u914d\u7f6e\u4e00\u4e2a Kubernetes \u90e8\u7f72\uff0c\u5176\u4e2d\u5305\u542b\u96c6\u7fa4\u5185\u6b63\u5728\u8fd0\u884c\u7684 MinIO \u5b9e\u4f8b\u3002\u5728\u96c6\u7fa4\u5916\u516c\u5f00 MinIO \u9700\u8981\u989d\u5916\u7684\u6b65\u9aa4( extra steps)\u3002</p> <p>\u8981\u8bbf\u95ee\u8fd9\u4e2a\u5b58\u50a8\uff0c\u60a8\u9700\u8981\u4f7f\u7528 kubectl port-forward-n svc/MinIO 9000\u5c06 MinIO \u7aef\u53e3\u8f6c\u53d1\u5230\u672c\u5730\u8ba1\u7b97\u673a\uff0c\u4ece\u800c\u5728\u96c6\u7fa4\u4e4b\u5916\u66b4\u9732 MinIO\u3002\u901a\u8fc7\u5728 BSL \u914d\u7f6e\u4e2d\u6dfb\u52a0 publicUrl: http://localhost:9000\uff0c\u66f4\u65b0 BSL \u914d\u7f6e\uff0c\u5c06\u5176\u4f5c\u4e3a\u5176\u201c\u516c\u5171 URL\u201d\u3002\u8fd9\u5bf9\u4e8e\u4e0b\u8f7d\u5907\u4efd\u6587\u4ef6\u662f\u5fc5\u8981\u7684\u3002</p> <p>\u6ce8\u610f\uff1a\u4f7f\u7528\u6b64\u8bbe\u7f6e\uff0c\u5f53\u60a8\u7684\u96c6\u7fa4\u7ec8\u6b62\u65f6\uff0c\u5176\u4e2d\u7684\u5b58\u50a8\u548c\u4efb\u4f55\u5907\u4efd/\u6062\u590d\u4e5f\u4f1a\u7ec8\u6b62\u3002</p> <ol> <li>\u4f5c\u4e3a\u5728 Docker \u5bb9\u5668\u4e2d\u672c\u5730\u8fd0\u884c\u7684\u72ec\u7acb MinIO \u5b9e\u4f8b \u8bf7\u53c2\u9605these instructions\u4ee5\u5728\u60a8\u7684\u8ba1\u7b97\u673a\u4e0a\u672c\u5730\u8fd0\u884c MinIO\uff0c\u4f5c\u4e3a\u72ec\u7acb\u7684\u800c\u4e0d\u662f\u5728 Pod \u4e0a\u8fd0\u884c\u5b83\u3002</li> </ol> <p>\u8bf7\u53c2\u9605\u6211\u4eec\u7684locations documentation\u4ee5\u4e86\u89e3\u66f4\u591a\u5907\u4efd\u4f4d\u7f6e\u7684\u5de5\u4f5c\u539f\u7406\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#36-secret","title":"3.6 \u914d\u7f6e\u63d0\u4f9b\u8005\u51ed\u636e\uff08secret\uff09","text":"<p>\u65e0\u8bba\u60a8\u4f7f\u7528\u4ec0\u4e48\u5bf9\u8c61\u5b58\u50a8\u63d0\u4f9b\u7a0b\u5e8f\uff0c\u90fd\u8981\u5728 velero/tilt-resources/cloud \u6587\u4ef6\u4e2d\u914d\u7f6e\u51ed\u636e\u3002\u9605\u8bfb\u63d2\u4ef6\u6587\u6863\uff0c\u4e86\u89e3\u63d0\u4f9b\u8005\u7684\u51ed\u636e\u9700\u8981\u54ea\u4e9b\u5b57\u6bb5/\u503c\u5bf9\u3002Tilt \u6587\u4ef6\u5c06\u8c03\u7528 Kustomize \u5728\u786c\u7f16\u7801\u7684\u5bc6\u94a5 secret.cloud-credentials \u4e0b\u521b\u5efa\u79d8\u5bc6\u3002\u540d\u79f0\u7a7a\u95f4\u4e2d\u7684 data.cloud\u3002\u5728 velero/tilt-resources/examples/cloud \u4e2d\uff0c\u6709\u4e00\u4e2a\u4e3a MinIO \u5b58\u50a8\u51ed\u8bc1\u6b63\u786e\u683c\u5f0f\u5316\u7684\u793a\u4f8b\u51ed\u8bc1\u6587\u4ef6\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#37-delve","title":"3.7 \u4f7f\u7528 Delve \u914d\u7f6e\u8c03\u8bd5","text":"<p>\u5982\u679c\u60a8\u5e0c\u671b\u8c03\u8bd5 Velero \u8fdb\u7a0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c06\u5b57\u6bb5 enable _ debug \u8bbe\u7f6e\u4e3a true \u5728 tilt-resources/tile-settings \u4e2d\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f\u3002Json \u6587\u4ef6\u3002\u8fd9\u5c06\u4f7f\u60a8\u80fd\u591f\u4f7f\u7528\u6df1\u5165\u6765\u8c03\u8bd5\u8fdb\u7a0b\u3002\u901a\u8fc7\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f\uff0c\u5c06\u5728\u8c03\u8bd5\u6a21\u5f0f\u4e0b\u6784\u5efa Velero \u53ef\u6267\u884c\u6587\u4ef6(\u4f7f\u7528 flags-gcflags = \u201c-n-l\u201d\u7981\u7528\u4f18\u5316\u548c\u5185\u8054) \uff0c\u5e76\u5728\u4f7f\u7528 <code>dlv exec</code>\u7684 Velero \u90e8\u7f72\u4e2d\u542f\u52a8\u8be5\u8fdb\u7a0b\u3002</p> <p>\u8c03\u8bd5\u670d\u52a1\u5668\u5c06\u63a5\u53d7\u7aef\u53e32345\u4e0a\u7684\u8fde\u63a5\uff0c\u800c Tilt \u88ab\u914d\u7f6e\u4e3a\u5c06\u8be5\u7aef\u53e3\u8f6c\u53d1\u5230\u672c\u5730\u8ba1\u7b97\u673a\u3002\u4e00\u65e6 Tilt \u8fd0\u884c\u5e76\u4e14 Velero \u8d44\u6e90\u51c6\u5907\u5c31\u7eea\uff0c\u60a8\u5c31\u53ef\u4ee5\u8fde\u63a5\u5230\u8c03\u8bd5\u670d\u52a1\u5668\u5f00\u59cb\u8c03\u8bd5\u3002\u8981\u8fde\u63a5\u5230\u4f1a\u8bdd\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728\u672c\u5730\u8fd0\u884c dlv connect 127.0.0.1:2345\u6765\u4f7f\u7528\u6df1\u5165\u7684 CLI\u3002\u6709\u5173\u5982\u4f55\u4f7f\u7528\u6df1\u5165\u7814\u7a76\u7684\u66f4\u591a\u6307\u5bfc\uff0c\u8bf7\u53c2\u9605 Delve CLI documentation\u3002\u94bb\u7814\u4e5f\u53ef\u4ee5\u5728\u8bb8\u591aeditors and IDEs.</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u5904\u4e8e\u8c03\u8bd5\u6a21\u5f0f\u65f6\uff0cVelero \u8fdb\u7a0b\u5c06\u5728\u542f\u52a8\u65f6\u7ee7\u7eed\u3002\u8fd9\u610f\u5473\u7740\u8fdb\u7a0b\u5c06\u4e00\u76f4\u8fd0\u884c\uff0c\u76f4\u5230\u8bbe\u7f6e\u4e86\u65ad\u70b9\u3002\u53ef\u4ee5\u901a\u8fc7\u5728\u503e\u659c\u8d44\u6e90/\u5e73\u94fa\u8bbe\u7f6e\u4e2d\u5c06\u5b57\u6bb5 debug _ continue _ on _ start \u8bbe\u7f6e\u4e3a false \u6765\u7981\u7528\u6b64\u9009\u9879\u3002Json \u6587\u4ef6\u3002\u5f53\u6b64\u8bbe\u7f6e\u88ab\u7981\u7528\u65f6\uff0cVelero \u8fdb\u7a0b\u5c06\u4e0d\u4f1a\u7ee7\u7eed\u8fd0\u884c\uff0c\u76f4\u5230\u901a\u8fc7\u60a8\u7684\u6df1\u5165\u4f1a\u8bdd\u53d1\u51fa\u4e00\u4e2a continue \u6307\u4ee4\u3002</p> <p>\u9000\u51fa\u8c03\u8bd5\u4f1a\u8bdd\u65f6\uff0cCLI \u548c\u7f16\u8f91\u5668\u96c6\u6210\u901a\u5e38\u4f1a\u8be2\u95ee\u662f\u5426\u5e94\u8be5\u505c\u6b62\u8fdc\u7a0b\u8fdb\u7a0b\u3002\u4fdd\u6301\u8fdc\u7a0b\u8fdb\u7a0b\u8fd0\u884c\u5e76\u65ad\u5f00\u4e0e\u8c03\u8bd5\u4f1a\u8bdd\u7684\u8fde\u63a5\u975e\u5e38\u91cd\u8981\u3002\u901a\u8fc7\u505c\u6b62\u8fdc\u7a0b\u8fdb\u7a0b\uff0c\u8fd9\u5c06\u5bfc\u81f4 Velero \u5bb9\u5668\u505c\u6b62\u548c\u835a\u91cd\u65b0\u542f\u52a8\u3002\u5982\u679c\u6b63\u5728\u8fdb\u884c\u5907\u4efd\uff0c\u90a3\u4e48\u8fd9\u4e9b\u5907\u4efd\u5c06\u5904\u4e8e\u4e0d\u65b0\u9c9c\u72b6\u6001\uff0c\u56e0\u4e3a\u5728 Velero pod \u91cd\u65b0\u542f\u52a8\u65f6\u5b83\u4eec\u4e0d\u4f1a\u6062\u590d\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#38-tilt","title":"3.8 \u8fd0\u884cTilt","text":"<p>\u8981\u542f\u52a8\u60a8\u7684\u5f00\u53d1\u73af\u5883\uff0c\u8bf7\u8fd0\u884c\uff1a</p> <pre><code>tilt up\n</code></pre> <p>\u8fd9\u5c06\u8f93\u51fa\u5730\u5740\u5230\u4e00\u4e2a\u7f51\u7edc\u6d4f\u89c8\u5668\u754c\u9762\uff0c\u5728\u90a3\u91cc\u4f60\u53ef\u4ee5\u76d1\u89c6\u503e\u659c\u7684\u72b6\u6001\u548c\u6bcf\u4e2a\u503e\u659c\u8d44\u6e90\u7684\u65e5\u5fd7\u3002\u7ecf\u8fc7\u77ed\u6682\u7684\u65f6\u95f4\u540e\uff0c\u60a8\u5e94\u8be5\u5df2\u7ecf\u6709\u4e86\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684\u5f00\u53d1\u73af\u5883\uff0c\u73b0\u5728\u5e94\u8be5\u80fd\u591f\u521b\u5efa\u5907\u4efd/\u6062\u590d\u5e76\u5b8c\u5168\u64cd\u4f5c Velero \u4e86\u3002</p> <p>\u6ce8\u610f\uff1a\u9000\u51fa Tilt \u540e\u8fd0\u884c\u503e\u659c\u5411\u4e0b\u5c06 Tiltfile \u4e2d\u6307\u5b9a\u7684will delete all resources </p> <p>\u63d0\u793a\uff1a\u4e3a velero/_tuiltbuild/local/velero \u521b\u5efa\u522b\u540d\uff0c\u60a8\u4e0d\u5fc5\u8fd0\u884c make local \u6765\u83b7\u5f97 Velero CLI \u7684\u66f4\u65b0\u7248\u672c\uff0c\u53ea\u9700\u4f7f\u7528\u522b\u540d\u5373\u53ef\u3002</p> <p>\u8bf7\u53c2\u9605\u6587\u6863how Velero works.</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#39","title":"3.9 \u63d0\u4f9b\u63d2\u4ef6","text":"<p>\u63d0\u4f9b\u8005\u5fc5\u987b\u63d0\u4f9b\u4e00\u4e2atilt-provider.json \u6587\u4ef6\u6765\u63cf\u8ff0\u5982\u4f55\u6784\u5efa\u5b83\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>{\n  \"plugin_name\": \"velero-plugin-for-aws\",\n  \"context\": \".\",\n  \"image\": \"velero/velero-plugin-for-aws\",\n  \"live_reload_deps\": [\n    \"velero-plugin-for-aws\"\n  ],\n  \"go_main\": \"./velero-plugin-for-aws\"\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#310","title":"3.10 \u5b9e\u65f6\u66f4\u65b0","text":"<p>\u6bcf\u4e2a\u914d\u7f6e\u4e3a\u7531 Velero \u7684 Tilt \u8bbe\u7f6e\u90e8\u7f72\u7684\u63d0\u4f9b\u8005\u63d2\u4ef6\u90fd\u6709\u4e00\u4e2a live _ reload_deps \u5217\u8868\u3002\u8fd9\u5b9a\u4e49\u4e86 Tilt \u5e94\u8be5\u76d1\u89c6\u7684\u6587\u4ef6\u548c/\u6216\u76ee\u5f55\u7684\u66f4\u6539\u3002\u4fee\u6539\u4f9d\u8d56\u9879\u540e\uff0cTilt \u5728\u672c\u5730\u8ba1\u7b97\u673a\u4e0a\u91cd\u65b0\u6784\u5efa\u63d0\u4f9b\u7a0b\u5e8f\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5c06\u4e8c\u8fdb\u5236\u6587\u4ef6\u590d\u5236\u5230 init \u5bb9\u5668\uff0c\u5e76\u89e6\u53d1 Velero \u5bb9\u5668\u7684\u91cd\u65b0\u542f\u52a8\u3002\u8fd9\u6bd4\u4e3a\u6bcf\u6b21\u66f4\u6539\u91cd\u65b0\u751f\u6210\u5bb9\u5668\u6620\u50cf\u8981\u5feb\u5f97\u591a\u3002\u5b83\u8fd8\u6709\u52a9\u4e8e\u4fdd\u6301\u6bcf\u4e2a\u5f00\u53d1\u6620\u50cf\u7684\u5927\u5c0f\u5c3d\u53ef\u80fd\u5c0f(\u5bb9\u5668\u6620\u50cf\u4e0d\u9700\u8981\u6574\u4e2a go \u5de5\u5177\u94fe\u3001\u6e90\u4ee3\u7801\u3001\u6a21\u5757\u4f9d\u8d56\u6027\u7b49)\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#_3","title":"\u56db \u4ece\u6e90\u4ee3\u7801\u6784\u5efa","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#41","title":"4.1 \u5148\u51b3\u6761\u4ef6","text":"<ul> <li>\u8bbf\u95ee Kubernetes \u96c6\u7fa4\uff0c\u7248\u672c 1.7 \u6216\u66f4\u9ad8\u7248\u672c\u3002 </li> <li>\u96c6\u7fa4\u4e0a\u7684 DNS \u670d\u52a1\u5668 </li> <li>\u5b89\u88c5\u4e86 kubectl </li> <li>Go \u5b89\u88c5\uff08\u6700\u4f4e\u7248\u672c 1.8\uff09</li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#42","title":"4.2 \u83b7\u53d6\u6e90\u7801","text":"<ul> <li>\u4ece\u6700\u65b0\u6e90\u7801\u83b7\u53d6</li> </ul> <pre><code>mkdir $HOME/go\nexport GOPATH=$HOME/go\ngo get github.com/vmware-tanzu/velero   \n</code></pre> <p>\u54ea\u91cc\u662f Go \u7684\u5bfc\u5165\u8def\u5f84\u3002 </p> <p>\u5bf9\u4e8e Go \u5f00\u53d1\uff0c\u5efa\u8bae\u5c06 Go \u5bfc\u5165\u8def\u5f84\uff08\u672c\u4f8b\u4e2d\u4e3a $HOME/go\uff09\u6dfb\u52a0\u5230\u60a8\u7684\u8def\u5f84\u4e2d\u3002</p> <ul> <li>\u5236\u5b9a\u7248\u672c\u62c9\u53d6</li> </ul> <p>\u4ecerelease page\u4e0b\u8f7d\u540d\u4e3a Source code \u7684\u5f52\u6863\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a src/ github.com/vmware-tanzu/velero </p> <p>\u6587\u4ef6\u5728 Go \u5bfc\u5165\u8def\u5f84\u4e2d\u89e3\u538b\u7f29\u3002\u6ce8\u610f\uff0cMakefile \u76ee\u6807\u5047\u5b9a\u4ece git \u5b58\u50a8\u5e93\u6784\u5efa\u3002\u5f53\u4ece\u5b58\u6863\u6784\u5efa\u65f6\uff0c\u60a8\u53ea\u80fd\u4f7f\u7528\u4e0b\u9762\u63cf\u8ff0\u7684 go build \u547d\u4ee4\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#43","title":"4.3 \u6784\u5efa","text":"<p>\u6839\u636e\u60a8\u7684\u9700\u8981\uff0c\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u65b9\u6cd5\u6765\u5efa\u7acb velero\u3002\u8fd9\u4e00\u8282\u6982\u8ff0\u4e86\u4e3b\u8981\u7684\u53ef\u80fd\u6027\u3002\u5f53\u4f7f\u7528 make \u8fdb\u884c\u6784\u5efa\u65f6\uff0c\u5b83\u5c06\u628a\u4e8c\u8fdb\u5236\u6587\u4ef6\u653e\u5728<code>_ output/bin/$GOOS/$GOARCH</code>\u4e0b\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230 darwin \u7684\u4e8c\u8fdb\u5236\u6587\u4ef6: _ output/bin/darwin/amd64/velero\uff0c\u4ee5\u53ca linux \u7684\u4e8c\u8fdb\u5236\u6587\u4ef6:<code>_ output/bin/linux/amd64/velero</code>\u3002Make \u8fd8\u5c06\u62fc\u63a5\u7248\u672c\u548c git \u63d0\u4ea4\u4fe1\u606f\uff0c\u4ee5\u4fbf velero \u7248\u672c\u663e\u793a\u9002\u5f53\u7684\u8f93\u51fa\u3002</p> <p>\u6ce8\u610f: velero install \u8fd8\u5c06\u4f7f\u7528\u7248\u672c\u4fe1\u606f\u6765\u786e\u5b9a\u8981\u90e8\u7f72\u54ea\u4e2a\u6807\u8bb0\u7684\u6620\u50cf\u3002\u5982\u679c\u60a8\u60f3\u8986\u76d6\u90e8\u7f72\u7684\u6620\u50cf\uff0c\u8bf7\u4f7f\u7528\u6620\u50cf\u6807\u5fd7(\u53c2\u89c1\u4e0b\u9762\u5173\u4e8e\u5982\u4f55\u6784\u5efa\u6620\u50cf\u7684\u8bf4\u660e)\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#44","title":"4.4 \u6784\u5efa\u4e8c\u8fdb\u5236","text":"<p>\u8981\u5728\u672c\u5730\u673a\u5668\u4e0a\u6784\u5efa\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u548c\u67b6\u6784\u7f16\u8bd1\u7684 velero \u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u4e24\u4e2a\u547d\u4ee4\u4e4b\u4e00:</p> <pre><code>go build ./cmd/velero\nmake local\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#45","title":"4.5 \u4ea4\u53c9\u7f16\u8bd1","text":"<p>\u8981\u5728\u672c\u5730\u673a\u5668\u4e0a\u7684\u6784\u5efa\u5bb9\u5668\u4e2d\u6784\u5efa\u9488\u5bf9 linux/amd64 \u7684 velero \u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u8bf7\u8fd0\u884c\uff1a</p> <p>\u5bf9\u4e8e\u4efb\u4f55\u7279\u5b9a\u5e73\u53f0\uff0c\u8fd0\u884c make build--\u3002 \u4f8b\u5982\uff0c\u8981\u4e3a Mac \u6784\u5efa\uff0c\u8bf7\u8fd0\u884c make build-darwin-amd64\u3002 Velero \u7684 Makefile \u6709\u4e00\u4e2a\u65b9\u4fbf\u7684\u76ee\u6807\uff0call-build\uff0c\u5b83\u6784\u5efa\u4ee5\u4e0b\u5e73\u53f0\uff1a <ul> <li>linux-amd64</li> <li>linux-arm</li> <li>linux-arm64</li> <li>linux-ppc64le</li> <li>darwin-amd64</li> <li>windows-amd64</li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#46-velero","title":"4.6 \u7f16\u8bd1\u955c\u50cf\u548c\u5347\u7ea7velero","text":"<p>\u5982\u679c\u5728\u5b89\u88c5 Velero \u540e\uff0c\u60a8\u60f3\u5c06\u5176\u90e8\u7f72\u4f7f\u7528\u7684\u6620\u50cf\u66f4\u6539\u4e3a\u5305\u542b\u60a8\u7684\u4ee3\u7801\u66f4\u6539\u7684\u6620\u50cf\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u66f4\u65b0\u6620\u50cf\u6765\u5b9e\u73b0\uff1a</p> <pre><code>kubectl -n velero set image deploy/velero velero=myimagerepo/velero:$VERSION\n</code></pre> <p>\u8981\u6784\u5efa Velero \u5bb9\u5668\u6620\u50cf\uff0c\u60a8\u9700\u8981\u5148\u914d\u7f6e buildx\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#47-buildx","title":"4.7 Buildx","text":"<p>Docker Buildx \u662f\u4e00\u4e2a CLI \u63d2\u4ef6\uff0c\u5b83\u901a\u8fc7 Moby BuildKit builder \u5de5\u5177\u5305\u63d0\u4f9b\u7684\u7279\u6027\u6765\u6269\u5c55 Docker \u547d\u4ee4\u3002\u5b83\u63d0\u4f9b\u4e86\u4e0e docker \u6784\u5efa\u76f8\u540c\u7684\u7528\u6237\u4f53\u9a8c\uff0c\u5e76\u5177\u6709\u8bb8\u591a\u65b0\u7279\u6027\uff0c\u6bd4\u5982\u521b\u5efa\u6709\u4f5c\u7528\u57df\u7684\u6784\u5efa\u5b9e\u4f8b\u548c\u5e76\u53d1\u6784\u5efa\u591a\u4e2a\u8282\u70b9\u3002</p> <p>\u66f4\u591a\u4fe1\u606f\u53ef\u53c2\u8003\uff1a docker docs and in the buildx github repo.</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#48","title":"4.8 \u955c\u50cf\u6784\u5efa","text":"<p>\u8bbe\u7f6e $REGISTRY \u73af\u5883\u53d8\u91cf\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u60f3\u521b\u5efa gcr.io/my-REGISTRY/velero:main \u56fe\u50cf\uff0c\u5c06 $REGISTRY \u8bbe\u7f6e\u4e3a gcr.io/my-REGISTRY\u3002\u5982\u679c\u672a\u8bbe\u7f6e\u6b64\u53d8\u91cf\uff0c\u5219\u9ed8\u8ba4\u503c\u4e3a velero\u3002</p> <p>\u53ef\u4ee5\u9009\u62e9\uff0c\u8bbe\u7f6e \u200b$VERSION \u73af\u5883\u53d8\u91cf\u6765\u66f4\u6539\u56fe\u50cf\u6807\u8bb0\u6216 $BIN \u6765\u66f4\u6539\u8981\u4e3a\u5176\u6784\u5efa\u5bb9\u5668\u56fe\u50cf\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u7136\u540e\uff0c\u8dd1:</p> <p>\u6ce8\u610f\uff1a\u8981\u4e3a velero \u548c velero-restic-restore-helper \u6784\u5efa\u6784\u5efa\u5bb9\u5668\u955c\u50cf\uff0c\u8bf7\u8fd0\u884c\uff1amake all-containers</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#49","title":"4.9 \u5c06\u5bb9\u5668\u6620\u50cf\u53d1\u5e03\u5230\u6ce8\u518c\u8868","text":"<p>\u8981\u5c06\u5bb9\u5668\u6620\u50cf\u53d1\u5e03\u5230\u6ce8\u518c\u8868\uff0c\u9700\u8981\u8fdb\u884c\u4ee5\u4e0b\u4e00\u6b21\u6027\u8bbe\u7f6e\uff1a</p> <ol> <li> <p>\u5982\u679c\u60a8\u6b63\u5728\u6784\u5efa\u8de8\u5e73\u53f0\u5bb9\u5668\u6620\u50cf</p> </li> <li> <p><code>bash    $ docker run --rm --privileged multiarch/qemu-user-static --reset -p yes</code></p> </li> <li> <p>\u521b\u5efa\u5e76\u5f15\u5bfc\u4e00\u4e2a\u65b0\u7684 docker buildx \u6784\u5efa\u5668</p> </li> </ol> <pre><code>$ docker buildx create --use --name builder\n  builder\n$ docker buildx inspect --bootstrap\n  [+] Building 2.6s (1/1) FINISHED\n  =&gt; [internal] booting buildkit                                2.6s\n  =&gt; =&gt; pulling image moby/buildkit:buildx-stable-1             1.9s\n  =&gt; =&gt; creating container buildx_buildkit_builder0             0.7s\nName:   builder\nDriver: docker-container\n\nNodes:\nName:      builder0\nEndpoint:  unix:///var/run/docker.sock\nStatus:    running\nPlatforms: linux/amd64, linux/arm64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6\n</code></pre> <p>\u6ce8\u610f\uff1a\u5982\u679c\u6ca1\u6709\u4e0a\u8ff0\u8bbe\u7f6e\uff0c docker buildx inspect --bootstrap \u7684\u8f93\u51fa\u5c06\u662f\uff1a</p> <pre><code>$ docker buildx inspect --bootstrap\nName:   default\nDriver: docker\n\nNodes:\nName:      default\nEndpoint:  default\nStatus:    running\nPlatforms: linux/amd64, linux/arm64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6\n</code></pre> <p>\u5e76\u4e14 REGISTRY=myrepo BUILDX_OUTPUT_TYPE=registry make \u5bb9\u5668\u5c06\u5931\u8d25\u5e76\u663e\u793a\u4ee5\u4e0b\u9519\u8bef</p> <pre><code>$ REGISTRY=ashishamarnath BUILDX_PLATFORMS=linux/arm64 BUILDX_OUTPUT_TYPE=registry make container\nauto-push is currently not implemented for docker driver\nmake: *** [container] Error 1\n</code></pre> <p>\u5b8c\u6210\u4e0a\u8ff0\u4e00\u6b21\u6027\u8bbe\u7f6e\u540e\uff0c\u73b0\u5728 docker buildx inspect --bootstrap \u7684\u8f93\u51fa\u5e94\u8be5\u662f\u8fd9\u6837\u7684</p> <pre><code>$ docker buildx inspect --bootstrap\nName:   builder\nDriver: docker-container\n\nNodes:\nName:      builder0\nEndpoint:  unix:///var/run/docker.sock\nStatus:    running\nPlatforms: linux/amd64, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v\n</code></pre> <p>\u73b0\u5728\u901a\u8fc7\u8fd0\u884c make container \u547d\u4ee4\u5e76\u5c06 $BUILDX_OUTPUT_TYPE \u8bbe\u7f6e\u4e3a registry \u6765\u6784\u5efa\u548c\u63a8\u9001\u5bb9\u5668\u955c\u50cf</p> <pre><code>$ REGISTRY=myrepo BUILDX_OUTPUT_TYPE=registry make container\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#410","title":"4.10 \u8de8\u5e73\u53f0\u7f16\u8bd1","text":"<p>\u652f\u6301\u7684 Docker buildx \u5e73\u53f0\uff1a</p> <ul> <li><code>linux/amd64</code></li> <li><code>linux/arm64</code></li> <li><code>linux/arm/v7</code></li> <li><code>linux/ppc64le</code></li> </ul> <p>\u5bf9\u4e8e\u4efb\u4f55\u7279\u5b9a\u5e73\u53f0\uff0c\u8fd0\u884c BUILDX_PLATFORMS=/ make container  <p>\u4f8b\u5982\uff0c\u8981\u4e3a arm64 \u6784\u5efa\u6620\u50cf\uff0c\u8bf7\u8fd0\u884c\uff1a</p> <pre><code>BUILDX_PLATFORMS=linux/arm64 make container\n</code></pre> <p>\u6ce8\u610f\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c$BUILDX_PLATFORMS \u8bbe\u7f6e\u4e3a linux/amd64 \u4f7f\u7528 buildx\uff0c\u60a8\u8fd8\u53ef\u4ee5\u540c\u65f6\u6784\u5efa\u6240\u6709\u652f\u6301\u7684\u5e73\u53f0\u5e76\u5c06\u591a\u67b6\u6784\u6620\u50cf\u63a8\u9001\u5230\u6ce8\u518c\u8868\u3002\u4f8b\u5982\uff1a</p> <pre><code>REGISTRY=myrepo VERSION=foo BUILDX_PLATFORMS=linux/amd64,linux/arm64,linux/arm/v7,linux/ppc64le BUILDX_OUTPUT_TYPE=registry make all-containers\n</code></pre> <p>\u6ce8\u610f: \u5f53\u540c\u65f6\u4e3a\u591a\u4e8e1\u4e2a\u5e73\u53f0\u6784\u5efa\u65f6\uff0c\u60a8\u9700\u8981\u5c06 BUILDX _ output _ type \u8bbe\u7f6e\u4e3a\u6ce8\u518c\u8868\uff0c\u56e0\u4e3a\u672c\u5730\u591a\u62f1\u56fe\u50cf\u5c1a\u4e0d\u53d7\u652f\u6301\u3002\u6ce8\u610f: \u5982\u679c\u4f60\u60f3\u66f4\u65b0\u56fe\u7247\u4f46\u4e0d\u6539\u53d8\u5b83\u7684\u540d\u5b57\uff0c\u4f60\u5fc5\u987b\u89e6\u53d1 Kubernetes \u9009\u62e9\u65b0\u7684\u56fe\u7247\u3002\u4e00\u79cd\u65b9\u6cd5\u662f\u5220\u9664 Velero \u90e8\u7f72 pod:</p> <pre><code>kubectl -n velero delete pods -l deploy=velero\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#_4","title":"\u4e94 \u672c\u5730\u8fd0\u884c","text":"<p>\u5728\u5f00\u53d1\u4e2d\u672c\u5730\u8fd0\u884c Velero</p> <p>\u5728\u672c\u5730\u8fd0\u884c Velero \u670d\u52a1\u5668\u53ef\u4ee5\u52a0\u901f\u8fed\u4ee3\u5f00\u53d1\u3002\u8fd9\u6837\u5c31\u65e0\u9700\u5728\u6bcf\u6b21\u66f4\u6539\u65f6\u91cd\u5efa Velero \u670d\u52a1\u5668\u6620\u50cf\u5e76\u5c06\u5176\u91cd\u65b0\u90e8\u7f72\u5230\u96c6\u7fa4\u4e2d\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#51-velero","title":"5.1 \u4f7f\u7528\u8fdc\u7a0b\u96c6\u7fa4\u5728\u672c\u5730\u8fd0\u884c Velero","text":"<p>Velero \u4ee5 Kubernetes API \u670d\u52a1\u5668\u4f5c\u4e3a\u7aef\u70b9(\u6839\u636e kubeconfig \u914d\u7f6e)\u8fd0\u884c\uff0c\u56e0\u6b64 Velero \u670d\u52a1\u5668\u548c\u5ba2\u6237\u673a\u4f7f\u7528\u76f8\u540c\u7684\u5ba2\u6237\u673a-go \u4e0e Kubernetes \u8fdb\u884c\u901a\u4fe1\u3002\u8fd9\u610f\u5473\u7740 Velero \u670d\u52a1\u5668\u53ef\u4ee5\u50cf\u5728\u8fdc\u7a0b\u96c6\u7fa4\u4e2d\u8fd0\u884c\u4e00\u6837\u5728\u672c\u5730\u8fd0\u884c\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#52","title":"5.2 \u5148\u51b3\u6761\u4ef6","text":"<p>\u5728\u8fd0\u884c Velero \u65f6\uff0c\u60a8\u9700\u8981\u786e\u4fdd\u8bbe\u7f6e\u4ee5\u4e0b\u6240\u6709\u6743\u9650: </p> <ul> <li>\u4ece\u6e90\u96c6\u7fa4\u548c\u540d\u79f0\u7a7a\u95f4\u8bfb\u53d6\u6240\u6709\u6570\u636e\u7684\u8bbf\u95ee\u6743\u9650</li> <li>\u5bf9\u6765\u81ea\u6e90\u96c6\u7fa4\u548c\u547d\u540d\u7a7a\u95f4\u7684\u6240\u6709\u6570\u636e\u7684\u8bfb\u53d6\u6743\u9650</li> <li> <p>\u5199\u8bbf\u95ee\u76ee\u6807\u96c6\u7fa4\u548c\u547d\u540d\u7a7a\u95f4</p> </li> <li> <p>\u5199\u8bbf\u95ee\u76ee\u6807\u96c6\u7fa4\u548c\u547d\u540d\u7a7a\u95f4</p> </li> <li>\u5bf9\u5377\u7684\u8bfb/\u5199\u8bbf\u95ee</li> <li>\u5bf9\u5907\u4efd\u6570\u636e\u7684\u5bf9\u8c61\u5b58\u50a8\u8fdb\u884c\u8bfb/\u5199\u8bbf\u95ee</li> <li>BackupStorageLocationVelero \u670d\u52a1\u5668\u7684\u5bf9\u8c61\u5b9a\u4e49</li> <li>\u53ef\u9009VolumeSnapshotLocation Velero \u670d\u52a1\u5668\u7684\u5bf9\u8c61\u5b9a\u4e49\uff0c\u7528\u4e8e\u62cd\u6444 PV \u5feb\u7167</li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#53","title":"5.3 \u6b65\u9aa4","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#531-velero","title":"5.3.1 \u5b89\u88c5velero","text":"<p>\u8bf7\u53c2\u9605\u6709\u5173\u5982\u4f55\u5728\u67d0\u4e9b\u7279\u5b9a\u63d0\u4f9b\u5546\u4e2d\u5b89\u88c5 Velero \u7684\u6587\u6863\uff1aInstall overview</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#532","title":"5.3.2 \u5c06\u90e8\u7f72\u89c4\u6a21\u7f29\u5c0f\u5230\u96f6","text":"<p>\u4f7f\u7528 velero install \u547d\u4ee4\u5c06 Velero \u5b89\u88c5\u5230\u96c6\u7fa4\u4e2d\u540e\uff0c\u60a8\u5c06 Velero \u90e8\u7f72\u7f29\u5c0f\u5230 0\uff0c\u8fd9\u6837\u5b83\u5c31\u4e0d\u4f1a\u540c\u65f6\u5728\u8fdc\u7a0b\u96c6\u7fa4\u4e0a\u8fd0\u884c\uff0c\u5e76\u53ef\u80fd\u5bfc\u81f4\u4e8b\u60c5\u4e0d\u540c\u6b65\uff1a</p> <pre><code>kubectl scale --replicas=0 deployment velero -n velero\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#533-velero","title":"5.3.3 \u5728\u672c\u5730\u542f\u52a8Velero\u670d\u52a1\u5668","text":"<ul> <li> <p>\u8981\u5728\u672c\u5730\u8fd0\u884c\u670d\u52a1\u5668\uff0c\u8bf7\u6839\u636e\u6240\u9700\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u4f7f\u7528\u5b8c\u6574\u8def\u5f84\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528 Mac\uff0c\u5e76\u4f7f\u7528 AWS \u4f5c\u4e3a\u63d0\u4f9b\u7a0b\u5e8f\uff0c\u4e0b\u9762\u662f\u5982\u4f55\u4f7f\u7528\u5b8c\u6574\u8def\u5f84\u8fd0\u884c\u4ece\u6e90\u4ee3\u7801\u6784\u5efa\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6: <code>AWS_SHARED_CREDENTIALS_FILE=&lt;path-to-credentials-file&gt; ./_output/bin/darwin/amd64/velero</code>.\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u5c06 velero \u4e8c\u8fdb\u5236\u6587\u4ef6\u6dfb\u52a0\u5230 PATH \u4e2d\u3002</p> </li> <li> <p>\u542f\u52a8\u670d\u52a1\u5668\uff1avelero \u670d\u52a1\u5668 [CLI \u6807\u5fd7]\u3002\u4ee5\u4e0b CLI \u6807\u5fd7\u53ef\u80fd\u6709\u52a9\u4e8e\u81ea\u5b9a\u4e49\uff0c\u4f46\u8bf7\u53c2\u9605 velero server --help \u4ee5\u83b7\u53d6\u5b8c\u6574\u8be6\u7ec6\u4fe1\u606f\uff1a</p> </li> <li>--log-level\uff1a\u8bbe\u7f6e Velero \u670d\u52a1\u5668\u7684\u65e5\u5fd7\u7ea7\u522b\uff08\u9ed8\u8ba4\u4fe1\u606f\uff0c\u4f7f\u7528 debug \u8fdb\u884c\u6700\u591a\u7684\u65e5\u5fd7\u8bb0\u5f55\uff09</li> <li>--kubeconfig\uff1a\u8bbe\u7f6e Velero \u670d\u52a1\u5668\u7528\u6765\u4e0e Kubernetes apiserver \u901a\u4fe1\u7684 kubeconfig \u6587\u4ef6\u7684\u8def\u5f84\uff08\u9ed8\u8ba4\u4e3a $ KUBECONFIG\uff09</li> <li>--namespace\uff1aVelero \u670d\u52a1\u5668\u5e94\u5728\u5176\u4e2d\u67e5\u627e\u5907\u4efd\u3001\u8ba1\u5212\u3001\u6062\u590d\u7684\u96c6\u5408\u547d\u540d\u7a7a\u95f4\uff08\u9ed8\u8ba4 velero\uff09</li> <li>--plugin-dir\uff1a\u8bbe\u7f6eVelero\u670d\u52a1\u5668\u67e5\u627e\u63d2\u4ef6\u7684\u76ee\u5f55\uff08\u9ed8\u8ba4/plugins\uff09<ul> <li>--plugin-dir \u6807\u5fd7\u8981\u6c42\u63d2\u4ef6\u4e8c\u8fdb\u5236\u6587\u4ef6\u5b58\u5728\u4e8e\u672c\u5730\uff0c\u5e76\u5e94\u8bbe\u7f6e\u4e3a\u5305\u542b\u6b64\u6784\u5efa\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u76ee\u5f55\u3002</li> </ul> </li> <li>--metrics-address\uff1a\u8bbe\u7f6e\u66b4\u9732 Prometheus \u6307\u6807\u7684\u7ed1\u5b9a\u5730\u5740\u548c\u7aef\u53e3\uff08\u9ed8\u8ba4\uff1a8085\uff09</li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#_5","title":"\u516d \u4ee3\u7801\u6807\u51c6","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#61-pr","title":"6.1 \u6253\u5361\u4e00\u4e2apr","text":"<p>\u5f53\u5f00\u542f\u62c9\u53d6\u8bf7\u6c42\u65f6\uff0c\u8bf7\u586b\u5199\u63d0\u4f9b\u6a21\u677f\u7684\u6e05\u5355\u3002\u8fd9\u5c06\u5e2e\u52a9\u5176\u4ed6\u4eba\u6b63\u786e\u5730\u5206\u7c7b\u548c\u5ba1\u67e5\u60a8\u7684\u62c9\u8bf7\u6c42\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#62","title":"6.2 \u6dfb\u52a0\u66f4\u65b0\u65e5\u5fd7","text":"<p>\u4f5c\u8005\u9700\u8981\u5728\u5176\u62c9\u53d6\u8bf7\u6c42\u4e2d\u5305\u542b\u4e00\u4e2a\u66f4\u6539\u65e5\u5fd7\u6587\u4ef6\u3002\u66f4\u6539\u65e5\u5fd7\u6587\u4ef6\u5e94\u8be5\u662f\u5728\u66f4\u6539\u65e5\u5fd7/\u672a\u53d1\u5e03\u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u7684\u65b0\u6587\u4ef6\u3002\u6587\u4ef6\u5e94\u8be5\u9075\u5faa pr-\u7528\u6237\u540d\u7684\u53d8\u6570\u547d\u540d\u539f\u5219\uff0c\u6587\u4ef6\u7684\u5185\u5bb9\u5e94\u8be5\u662f\u4f60\u7684\u6587\u672c\u66f4\u65b0\u65e5\u5fd7\u3002</p> <pre><code>velero/changelogs/unreleased   &lt;- folder\n    000-username            &lt;- file\n</code></pre> <p>\u5c06\u5176\u6dfb\u52a0\u5230 PR \u4e2d\u3002</p> <p>\u5982\u679c PR \u4e0d\u4fdd\u8bc1\u66f4\u6539\u65e5\u5fd7\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u5728 PR \u4e0a\u5e94\u7528 changelog-not-required \u6807\u7b7e\u6765\u8df3\u8fc7\u5bf9\u66f4\u6539\u65e5\u5fd7\u7684 CI \u68c0\u67e5\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#63","title":"6.3 \u7248\u6743\u5934\u90e8","text":"<p>\u6bcf\u5f53\u4fee\u6539\u6e90\u4ee3\u7801\u6587\u4ef6\u65f6\uff0c\u7248\u6743\u58f0\u660e\u5e94\u8be5\u66f4\u65b0\u4e3a\u6211\u4eec\u7684\u6807\u51c6\u7248\u6743\u58f0\u660e\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u5e94\u8be5\u8bfb\u4f5c\u201c Velero \u8d21\u732e\u8005\u7684\u7248\u6743\u201d\u5bf9\u4e8e\u65b0\u6587\u4ef6\uff0c\u5fc5\u987b\u6dfb\u52a0\u5b8c\u6574\u7684\u7248\u6743\u548c\u8bb8\u53ef\u6807\u9898\u3002\u8bf7\u6ce8\u610f\uff0c\u6587\u6863\u6587\u4ef6\u4e0d\u9700\u8981\u7248\u6743\u6807\u9898\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#64","title":"6.4 \u4ee3\u7801","text":"<ul> <li>\u65e5\u5fd7\u6d88\u606f\u5927\u5199\u3002</li> <li>\u9519\u8bef\u6d88\u606f\u4fdd\u6301\u5c0f\u5199\u3002</li> <li> <p>\u4ec5\u5bf9\u4ece\u975e velero \u4ee3\u7801\u76f4\u63a5\u8fd4\u56de\u7684\u9519\u8bef\uff08\u4f8b\u5982\u5bf9 Kubernetes \u670d\u52a1\u5668\u7684 API \u8c03\u7528\uff09\u5305\u88c5/\u6dfb\u52a0\u5806\u6808\u3002</p> </li> <li> <p><code>bash   errors.WithStack(err)</code></p> </li> <li> <p>\u66f4\u559c\u6b22\u4f7f\u7528 Kubernetes \u5305\u96c6\u4e2d\u7684\u5b9e\u7528\u7a0b\u5e8f\u3002</p> </li> <li> <p><code>bash   k8s.io/apimachinery/pkg/util/sets</code></p> </li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#65","title":"6.5 \u5bfc\u5305","text":"<p>\u5bf9\u4e8e\u5bfc\u5165\uff0c\u6211\u4eec\u4f7f\u7528\u4ee5\u4e0b\u7ea6\u5b9a\uff1a</p> <pre><code>&lt;group&gt;&lt;version&gt;&lt;api | client | informer | ...&gt;\n</code></pre> <p>Example</p> <pre><code>import (\n    corev1api \"k8s.io/api/core/v1\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    corev1client \"k8s.io/client-go/kubernetes/typed/core/v1\"\n    corev1listers \"k8s.io/client-go/listers/core/v1\"\n\n    velerov1api \"github.com/vmware-tanzu/velero/pkg/apis/velero/v1\"\n    velerov1client \"github.com/vmware-tanzu/velero/pkg/generated/clientset/versioned/typed/velero/v1\"\n)\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#66-mocks","title":"6.6 Mocks","text":"<p>\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u5305\u6765\u4e3a\u6211\u4eec\u7684\u63a5\u53e3\u751f\u6210\u6a21\u62df\u3002</p> <p>\u793a\u4f8b\uff1a\u5982\u679c\u4f60\u60f3\u6539\u53d8\u8fd9\u4e2a\u6a21\u62df:https://github.com/vmware-tanzu/velero/blob/v1.5.1/pkg/restic/mocks/restorer.go</p> <p>\u8fd0\u884c\uff1a</p> <pre><code>go get github.com/vektra/mockery/.../\ncd pkg/restic\nmockery -name=Restorer\n</code></pre> <p>\u53ef\u80fd\u9700\u8981\u8fd0\u884c make update \u6765\u66f4\u65b0\u5bfc\u5165\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#67-kubernetes","title":"6.7 Kubernetes \u6807\u7b7e","text":"<p>\u5728\u751f\u6210\u6807\u7b7e\u503c\u65f6\uff0c\u8bf7\u786e\u4fdd\u5c06\u5b83\u4eec\u4f20\u9012\u5230\u6807\u7b7e\u4e2d\u3002GetValidName () helper \u51fd\u6570\u3002\u8fd9\u5c06\u6709\u52a9\u4e8e\u786e\u4fdd\u503c\u662f\u8981\u5b58\u50a8\u548c\u67e5\u8be2\u7684\u9002\u5f53\u957f\u5ea6\u548c\u683c\u5f0f\u3002\u4e00\u822c\u6765\u8bf4\uff0cuid \u4f5c\u4e3a\u6807\u7b7e\u503c\u6301\u4e45\u5b58\u5728\u662f\u5b89\u5168\u7684\u3002\u6b64\u51fd\u6570\u4e0e\u6ca1\u6709\u9650\u5236\u7684\u6ce8\u91ca\u503c\u65e0\u5173\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#68-dco-sign-off","title":"6.8 DCO Sign off","text":"<p>\u8be5\u9879\u76ee\u7684\u6240\u6709\u4f5c\u8005\u4fdd\u7559\u5bf9\u5176\u4f5c\u54c1\u7684\u7248\u6743\u3002\u7136\u800c\uff0c\u4e3a\u4e86\u786e\u4fdd\u4ed6\u4eec\u53ea\u63d0\u4ea4\u4ed6\u4eec\u6709\u6743\u7684\u4f5c\u54c1\uff0c\u6211\u4eec\u8981\u6c42\u6bcf\u4e2a\u4eba\u901a\u8fc7\u7b7e\u7f72\u4ed6\u4eec\u7684\u4f5c\u54c1\u6765\u627f\u8ba4\u8fd9\u4e00\u70b9\u3002</p> <p>\u672c repo \u4e2d\u7684\u4efb\u4f55\u7248\u6743\u58f0\u660e\u90fd\u5e94\u5c06\u4f5c\u8005\u6307\u5b9a\u4e3a\u201cVelero \u8d21\u732e\u8005\u201d\u3002</p> <p>\u8981\u5728\u4f60\u7684\u4f5c\u54c1\u4e0a\u7b7e\u540d\uff0c\u53ea\u9700\u8981\u5728\u63d0\u4ea4\u6d88\u606f\u7684\u672b\u5c3e\u52a0\u4e0a\u8fd9\u6837\u4e00\u884c:</p> <pre><code>Signed-off-by: Joe Beda &lt;joe@heptio.com&gt;\n</code></pre> <p>\u8fd9\u53ef\u4ee5\u901a\u8fc7 git commit \u7684 --signoff \u9009\u9879\u8f7b\u677e\u5b8c\u6210\u3002</p> <p>\u901a\u8fc7\u8fd9\u6837\u505a\uff0c\u60a8\u58f0\u660e\u60a8\u53ef\u4ee5\u8bc1\u660e\u4ee5\u4e0b\u5185\u5bb9\uff1a(from https://developercertificate.org/):</p> <pre><code>Developer Certificate of Origin\nVersion 1.1\n\nCopyright (C) 2004, 2006 The Linux Foundation and its contributors.\n1 Letterman Drive\nSuite D4700\nSan Francisco, CA, 94129\n\nEveryone is permitted to copy and distribute verbatim copies of this\nlicense document, but changing it is not allowed.\n\n\nDeveloper's Certificate of Origin 1.1\n\nBy making a contribution to this project, I certify that:\n\n(a) The contribution was created in whole or in part by me and I\n    have the right to submit it under the open source license\n    indicated in the file; or\n\n(b) The contribution is based upon previous work that, to the best\n    of my knowledge, is covered under an appropriate open source\n    license and I have the right under that license to submit that\n    work with modifications, whether created in whole or in part\n    by me, under the same open source license (unless I am\n    permitted to submit under a different license), as indicated\n    in the file; or\n\n(c) The contribution was provided directly to me by some other\n    person who certified (a), (b) or (c) and I have not modified\n    it.\n\n(d) I understand and agree that this project and the contribution\n    are public and that a record of the contribution (including all\n    personal information I submit with it, including my sign-off) is\n    maintained indefinitely and may be redistributed consistent with\n    this project or the open source license(s) involved.\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#_6","title":"\u516d \u7f51\u7ad9\u5f15\u5bfc","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#61","title":"6.1 \u672c\u5730\u8fd0\u884c","text":"<p>\u5bf9\u7f51\u7ad9\u8fdb\u884c\u66f4\u6539\u65f6\uff0c\u8bf7\u5728\u63d0\u4ea4 PR \u4e4b\u524d\u5728\u672c\u5730\u8fd0\u884c\u8be5\u7f51\u7ad9\u5e76\u624b\u52a8\u9a8c\u8bc1\u60a8\u7684\u66f4\u6539\u3002 \u5728\u9879\u76ee\u7684\u6839\u76ee\u5f55\uff0c\u8fd0\u884c\uff1a</p> <pre><code>make serve-docs\n</code></pre> <p>\u8fd9\u4f1a\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u6240\u6709 Hugo \u4f9d\u8d56\u9879\u3002 \u6216\u8005\uff0c\u4e3a\u4e86\u5feb\u901f\u52a0\u8f7d\u7f51\u7ad9\uff0c\u5728 velero/site/ \u76ee\u5f55\u4e0b\u8fd0\u884c\uff1a</p> <pre><code>hugo serve\n</code></pre> <p>\u6709\u5173\u5982\u4f55\u5728\u672c\u5730\u8fd0\u884c\u7f51\u7ad9\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6211\u4eec\u7684 Hugo documentation\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#62_1","title":"6.2 \u6dfb\u52a0\u535a\u5ba2\u6587\u7ae0","text":"<p>\u8981\u6dfb\u52a0\u535a\u5ba2\u6587\u7ae0\uff0c\u8bf7\u5728 /site/content/posts/ \u6587\u4ef6\u5939\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Markdown (.MD) \u6587\u4ef6\u3002\u4e00\u7bc7\u535a\u5ba2\u6587\u7ae0\u9700\u8981\u4ee5\u4e0b\u524d\u8a00\u3002</p> <pre><code>title: \"Title of the blog\"\nexcerpt: Brief summary of thee blog post that appears as a preview on velero.io/blogs\nauthor_name: Jane Smith\nslug: URL-For-Blog\n# Use different categories that apply to your blog. This is used to connect related blogs on the site\ncategories: ['velero','release']\n# Image to use for blog. The path is relative to the site/static/ folder\nimage: /img/posts/example-image.jpg\n# Tag should match author to drive author pages. Tags can have multiple values.\ntags: ['Velero Team', 'Nolan Brubaker']\n</code></pre> <p>\u4f8b\u5982\uff0c\u5728\u6807\u7b7e\u5b57\u6bb5\u4e2d\u5305\u542b author_name \u503c\uff0c\u4ee5\u4fbf\u5217\u51fa\u4f5c\u8005\u5e16\u5b50\u7684\u9875\u9762\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0chttps://velero.io/tags/carlisia-campos/.</p> <p>\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u535a\u5ba2\u90fd\u6709\u4e00\u4e2a\u72ec\u7279\u7684\u56fe\u50cf\u53ef\u4ee5\u5728\u535a\u5ba2\u4e3b\u9875\u4e0a\u4f7f\u7528\uff0c\u4f46\u5982\u679c\u60a8\u4e0d\u5305\u542b\u56fe\u50cf\uff0c\u5219\u5c06\u4f7f\u7528\u9ed8\u8ba4\u7684 Velero \u5fbd\u6807\u3002\u4f7f\u7528\u5c0f\u4e8e 70KB \u7684\u56fe\u50cf\u5e76\u5c06\u5176\u6dfb\u52a0\u5230 /site/static/img/posts \u6587\u4ef6\u5939\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#_7","title":"\u4e03 \u6587\u6863\u98ce\u683c","text":"<p>\u53c2\u8003\uff1ahttps://velero.io/docs/v1.5/style-guide/</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/#_8","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/tilt-dev/tilt</li> <li>https://tilt.dev/</li> <li>https://velero.io/docs/v1.5/tilt/</li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/","title":"Velero \u4f7f\u7528","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#_1","title":"\u4e00 \u707e\u96be\u6062\u590d","text":"<p>\u4f7f\u7528\u8ba1\u5212\u548c\u53ea\u8bfb\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u5982\u679c\u60a8\u5b9a\u671f\u5907\u4efd\u96c6\u7fa4\u7684\u8d44\u6e90\uff0c\u90a3\u4e48\u5728\u53d1\u751f\u610f\u5916\u4e8b\u6545(\u5982\u670d\u52a1\u4e2d\u65ad)\u65f6\uff0c\u60a8\u5c31\u80fd\u591f\u8fd4\u56de\u5230\u4ee5\u524d\u7684\u72b6\u6001\u3002\u4e0e Velero \u4e00\u8d77\u8fd9\u6837\u505a\u770b\u8d77\u6765\u5982\u4e0b</p> <ol> <li>\u5728\u96c6\u7fa4\u4e0a\u9996\u6b21\u8fd0\u884c Velero \u670d\u52a1\u5668\u540e\uff0c\u8bbe\u7f6e\u6bcf\u65e5\u5907\u4efd\uff08\u6839\u636e\u9700\u8981\u66ff\u6362\u547d\u4ee4\u4e2d\u7684 \uff09\uff1a <pre><code>velero schedule create &lt;SCHEDULE NAME&gt; --schedule \"0 7 * * *\"\n</code></pre> <p>\u8fd9\u5c06\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a &lt; schedule name &gt;-&lt; timestamp &gt; \u7684 Backup \u5bf9\u8c61\u3002\u9ed8\u8ba4\u7684\u5907\u4efd\u4fdd\u6301\u671f(\u8868\u793a\u4e3a TTL (\u751f\u5b58\u65f6\u95f4))\u4e3a30\u5929(720\u5c0f\u65f6) ; \u60a8\u53ef\u4ee5\u4f7f\u7528 -- TTL &lt; duration &gt; \u6807\u5fd7\u6839\u636e\u9700\u8981\u66f4\u6539\u8fd9\u4e2a\u503c\u3002\u6709\u5173\u5907\u4efd\u8fc7\u671f\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 velero \u5982\u4f55\u5de5\u4f5c\u3002</p> <ol> <li>\u707e\u96be\u53d1\u751f\u4e86\uff0c\u60a8\u9700\u8981\u91cd\u65b0\u521b\u5efa\u60a8\u7684\u8d44\u6e90\u3002</li> <li>\u5c06\u60a8\u7684\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u66f4\u65b0\u4e3a\u53ea\u8bfb\u6a21\u5f0f\uff08\u8fd9\u53ef\u4ee5\u9632\u6b62\u5728\u8fd8\u539f\u8fc7\u7a0b\u4e2d\u5728\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u521b\u5efa\u6216\u5220\u9664\u5907\u4efd\u5bf9\u8c61\uff09</li> </ol> <pre><code>kubectl patch backupstoragelocation &lt;STORAGE LOCATION NAME&gt; \\\n    --namespace velero \\\n    --type merge \\\n    --patch '{\"spec\":{\"accessMode\":\"ReadOnly\"}}'\n</code></pre> <ol> <li>\u4f7f\u7528\u6700\u65b0\u7684 Velero \u5907\u4efd\u521b\u5efa\u8fd8\u539f\uff1a</li> </ol> <pre><code>velero restore create --from-backup &lt;SCHEDULE NAME&gt;-&lt;TIMESTAMP&gt;\n</code></pre> <ol> <li>\u51c6\u5907\u597d\u540e\uff0c\u5c06\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u6062\u590d\u4e3a\u8bfb\u5199\u6a21\u5f0f\uff1a</li> </ol> <pre><code>kubectl patch backupstoragelocation &lt;STORAGE LOCATION NAME&gt; \\\n   --namespace velero \\\n   --type merge \\\n   --patch '{\"spec\":{\"accessMode\":\"ReadWrite\"}}'\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#_2","title":"\u4e8c \u96c6\u7fa4\u8fc1\u79fb","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#21","title":"2.1 \u6267\u884c\u8fc1\u79fb","text":"<p>\u4f7f\u7528 Backups \u548c Restores Velero \u53ef\u4ee5\u5e2e\u52a9\u60a8\u5c06\u8d44\u6e90\u4ece\u4e00\u4e2a\u96c6\u7fa4\u79fb\u690d\u5230\u53e6\u4e00\u4e2a\u96c6\u7fa4\uff0c\u53ea\u8981\u60a8\u5c06\u6bcf\u4e2a Velero \u5b9e\u4f8b\u6307\u5411\u76f8\u540c\u7684\u4e91\u5bf9\u8c61\u5b58\u50a8\u4f4d\u7f6e\u3002\u6b64\u573a\u666f\u5047\u8bbe\u60a8\u7684\u96c6\u7fa4\u7531\u76f8\u540c\u7684\u4e91\u63d0\u4f9b\u5546\u6258\u7ba1\u3002\u6ce8\u610f\uff0cVelero \u5e76\u4e0d\u652f\u6301\u8de8\u4e91\u63d0\u4f9b\u8005\u8fc1\u79fb\u6301\u4e45\u5377\u5feb\u7167\u3002\u5982\u679c\u60a8\u5e0c\u671b\u5728\u4e91\u5e73\u53f0\u4e4b\u95f4\u8fc1\u79fb\u5377\u6570\u636e\uff0c\u8bf7\u542f\u7528 restic\uff0c\u5b83\u5c06\u5728\u6587\u4ef6\u7cfb\u7edf\u7ea7\u5907\u4efd\u5377\u5185\u5bb9\u3002</p> <ol> <li>\uff08\u96c6\u7fa4 1\uff09\u5047\u8bbe\u60a8\u8fd8\u6ca1\u6709\u4f7f\u7528 Velero \u8c03\u5ea6\u64cd\u4f5c\u68c0\u67e5\u70b9\u6570\u636e\uff0c\u60a8\u9700\u8981\u5148\u5907\u4efd\u6574\u4e2a\u96c6\u7fa4\uff08\u6839\u636e\u9700\u8981\u66ff\u6362 \uff09\uff1a <pre><code>velero backup create &lt;BACKUP-NAME&gt;\n</code></pre> <p>\u9ed8\u8ba4\u5907\u4efd\u4fdd\u7559\u671f\uff0c\u8868\u793a\u4e3a TTL\uff08\u751f\u5b58\u65f6\u95f4\uff09\uff0c\u4e3a 30 \u5929\uff08720 \u5c0f\u65f6\uff09\uff1b\u60a8\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4f7f\u7528 --ttl  \u6807\u5fd7\u8fdb\u884c\u66f4\u6539\u3002\u6709\u5173\u5907\u4efd\u5230\u671f\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 velero \u7684\u5de5\u4f5c\u539f\u7406\u3002 <ol> <li>(Cluster 2)\u914d\u7f6e BackupStorageLocations \u548c VolumeSnapshotLocations\uff0c\u6307\u5411 Cluster 1\u4f7f\u7528\u7684\u4f4d\u7f6e\uff0c\u4f7f\u7528 velero \u5907\u4efd\u4f4d\u7f6e create \u548c velero \u5feb\u7167\u4f4d\u7f6e create\u3002\u4f7f\u7528 -- access-mode = ReadOnly \u6807\u5fd7\u521b\u5efa velero \u5907\u4efd\u4f4d\u7f6e create\uff0c\u786e\u4fdd\u5c06 BackupStorageLocations \u914d\u7f6e\u4e3a\u53ea\u8bfb\u3002</li> <li>\uff08\u96c6\u7fa4 2\uff09\u786e\u4fdd\u5df2\u521b\u5efa Velero \u5907\u4efd\u5bf9\u8c61\u3002 Velero \u8d44\u6e90\u4e0e\u4e91\u5b58\u50a8\u4e2d\u7684\u5907\u4efd\u6587\u4ef6\u540c\u6b65\u3002</li> </ol> <pre><code>velero backup describe &lt;BACKUP-NAME&gt;\n</code></pre> <p>\u6ce8\u610f\uff1a\u9ed8\u8ba4\u540c\u6b65\u95f4\u9694\u4e3a 1 \u5206\u949f\uff0c\u56e0\u6b64\u8bf7\u52a1\u5fc5\u7b49\u5f85\u518d\u68c0\u67e5\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 --backup-sync-period \u6807\u5fd7\u5c06\u6b64\u95f4\u9694\u914d\u7f6e\u5230 Velero \u670d\u52a1\u5668\u3002</p> <ol> <li>\uff08\u96c6\u7fa4 2\uff09\u4e00\u65e6\u60a8\u786e\u8ba4\u6b63\u786e\u7684\u5907\u4efd () \u73b0\u5728\u5b58\u5728\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6062\u590d\u6240\u6709\u5185\u5bb9\uff1a <pre><code>velero restore create --from-backup &lt;BACKUP-NAME&gt;\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#22","title":"2.2 \u9a8c\u8bc1\u4e24\u4e2a\u96c6\u7fa4","text":"<p>\u68c0\u67e5\u7b2c\u4e8c\u4e2a\u96c6\u7fa4\u662f\u5426\u6309\u9884\u671f\u8fd0\u884c\uff1a</p> <ol> <li>(Cluster 2) Run:</li> </ol> <pre><code>velero restore get\n</code></pre> <ol> <li>Then run:</li> </ol> <pre><code>velero restore describe &lt;RESTORE-NAME-FROM-GET-COMMAND&gt;\n</code></pre> <p>\u5982\u679c\u9047\u5230\u95ee\u9898\uff0c\u8bf7\u786e\u4fdd Velero \u5728\u4e24\u4e2a\u96c6\u7fa4\u7684\u76f8\u540c\u547d\u540d\u7a7a\u95f4\u4e2d\u8fd0\u884c\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#_3","title":"\u4e09 \u8d44\u6e90\u8fc7\u6ee4","text":"<p>\u6309\u547d\u540d\u7a7a\u95f4\u3001\u7c7b\u578b\u6216\u6807\u7b7e\u7b5b\u9009\u5bf9\u8c61\u3002</p> <p>\u5f53\u4e0d\u4f7f\u7528\u8fc7\u6ee4\u9009\u9879\u65f6\uff0cVelero \u5305\u62ec\u5907\u4efd\u6216\u6062\u590d\u4e2d\u7684\u6240\u6709\u5bf9\u8c61\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#31","title":"3.1 \u5305\u542b","text":"<ul> <li>\u2013include-namespaces</li> <li> <p>\u5907\u4efd\u547d\u540d\u7a7a\u95f4\u53ca\u5176\u5bf9\u8c61\u3002</p> </li> <li> <p>```bash   velero backup create  --include-namespaces  <pre><code>* \u8fd8\u539f\u4e24\u4e2a\u540d\u79f0\u7a7a\u95f4\u53ca\u5176\u5bf9\u8c61\u3002\n\n```shell\nvelero restore create &lt;backup-name&gt; --include-namespaces &lt;namespace1&gt;,&lt;namespace2&gt;\n</code></pre> <li> <p>\u2013include-resources</p> </li> <li> <p>\u5907\u4efd\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u90e8\u7f72\u3002</p> </li> <pre><code>velero backup create &lt;backup-name&gt; --include-resources deployments\n</code></pre> <ul> <li>\u6062\u590d\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u90e8\u7f72\u548c\u914d\u7f6e\u6620\u5c04\u3002</li> </ul> <pre><code>velero restore create &lt;backup-name&gt; --include-resources deployments,configmaps\n</code></pre> <ul> <li>\u5907\u4efd\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u90e8\u7f72\u3002</li> </ul> <pre><code>velero backup create &lt;backup-name&gt; --include-resources deployments --include-namespaces &lt;namespace&gt;\n</code></pre> <ul> <li>\u2013include-cluster-resources</li> </ul> <p>\u6b64\u9009\u9879\u53ef\u4ee5\u5177\u6709\u4e09\u4e2a\u53ef\u80fd\u7684\u503c\uff1a</p> <ul> <li> <ul> <li>true: \u5305\u542b\u6240\u6709\u96c6\u7fa4\u8303\u56f4\u7684\u8d44\u6e90\u3002</li> </ul> </li> <li>false\uff1a\u4e0d\u5305\u62ec\u96c6\u7fa4\u8303\u56f4\u7684\u8d44\u6e90\u3002</li> <li> <p>nil \uff1a\uff08\u201c\u81ea\u52a8\u201d\u6216\u672a\u63d0\u4f9b\uff09</p> <ul> <li>\u5907\u4efd\u6216\u6062\u590d\u6240\u6709\u547d\u540d\u7a7a\u95f4\u65f6\u5305\u62ec\u96c6\u7fa4\u8303\u56f4\u7684\u8d44\u6e90\u3002\u9ed8\u8ba4\u503c\uff1a\u771f\u3002</li> <li>\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u8fc7\u6ee4\u65f6\uff0c\u4e0d\u5305\u62ec\u96c6\u7fa4\u8303\u56f4\u7684\u8d44\u6e90\u3002\u9ed8\u8ba4\u503c\uff1a\u5047\u3002</li> <li>\u5982\u679c\u7531\u81ea\u5b9a\u4e49\u64cd\u4f5c\uff08\u4f8b\u5982 PVC-&gt;PV\uff09\u89e6\u53d1\uff0c\u67d0\u4e9b\u76f8\u5173\u7684\u96c6\u7fa4\u8303\u56f4\u8d44\u6e90\u53ef\u80fd\u4ecd\u4f1a\u88ab\u5907\u4efd/\u6062\u590d\uff0c\u9664\u975e --include-cluster-resources=false\u3002</li> </ul> </li> <li> <p>\u5907\u4efd\u6574\u4e2a\u96c6\u7fa4\uff0c\u5305\u62ec\u96c6\u7fa4\u8303\u56f4\u5185\u7684\u8d44\u6e90\u3002</p> </li> </ul> <pre><code>    velero backup create &lt;backup-name&gt;\n</code></pre> <ol> <li>\u4ec5\u6062\u590d\u96c6\u7fa4\u4e2d\u7684\u547d\u540d\u7a7a\u95f4\u8d44\u6e90\u3002       </li> </ol> <pre><code>velero restore create &lt;backup-name&gt; --include-cluster-resources=false\n</code></pre> <ol> <li>\u5907\u4efd\u547d\u540d\u7a7a\u95f4\u5e76\u5305\u542b\u96c6\u7fa4\u8303\u56f4\u7684\u8d44\u6e90\u3002</li> </ol> <pre><code>velero backup create &lt;backup-name&gt; --include-namespaces &lt;namespace&gt; --include-cluster-resources=true \n</code></pre> <ul> <li>\u2013selector</li> <li> <p>\u5305\u542b\u4e0e\u6807\u7b7e\u9009\u62e9\u5668\u5339\u914d\u7684\u8d44\u6e90\u3002</p> </li> <li> <p><code>bash   velero backup create &lt;backup-name&gt; --selector &lt;key&gt;=&lt;value&gt;</code></p> </li> </ul>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#32","title":"3.2 \u6392\u9664","text":"<p>\u4ece\u5907\u4efd\u4e2d\u6392\u9664\u7279\u5b9a\u8d44\u6e90\u3002</p> <p>\u901a\u914d\u7b26\u6392\u9664\u88ab\u5ffd\u7565\u3002</p> <ul> <li>\u2013exclude-namespaces</li> <li> <p>\u6392\u9664\u547d\u540d\u7a7a\u95f4 \u4ece\u96c6\u7fa4\u5907\u4efd\u4e2d\u6392\u9664 kube-system\u3002</p> <pre><code>velero backup create &lt;backup-name&gt; --exclude-namespaces kube-system\n</code></pre> </li> <li> <p>\u5728\u8fd8\u539f\u671f\u95f4\u6392\u9664\u4e24\u4e2a\u547d\u540d\u7a7a\u95f4\u3002</p> <pre><code>velero restore create &lt;backup-name&gt; --exclude-namespaces &lt;namespace1&gt;,&lt;namespace2&gt;\n</code></pre> </li> <li> <p>\u2013 exclude-resources</p> </li> <li> <p>\u4ece\u5907\u4efd\u4e2d\u6392\u9664\u79d8\u5bc6\u3002</p> <pre><code>velero backup create &lt;backup-name&gt; --exclude-resources secrets\n</code></pre> </li> <li> <p>\u6392\u9664\u673a\u5bc6\u548c\u89d2\u8272\u7ed1\u5b9a\u3002</p> <pre><code>velero backup create &lt;backup-name&gt; --exclude-resources secrets,rolebindings\n</code></pre> </li> <li> <p>velero.io/exclude-from-backup=true</p> </li> </ul> <p>\u5e26\u6709 velero.io/exclude-from-backup=true \u6807\u7b7e\u7684\u8d44\u6e90\u4e0d\u5305\u542b\u5728\u5907\u4efd\u4e2d\uff0c\u5373\u4f7f\u5b83\u5305\u542b\u5339\u914d\u7684\u9009\u62e9\u5668\u6807\u7b7e\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#backup-reference","title":"\u56db Backup Reference","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#41","title":"4.1 \u4ece\u5907\u4efd\u4e2d\u6392\u9664\u7279\u5b9a\u9879\u76ee","text":"<p>\u5373\u4f7f\u5b83\u4eec\u4e0e\u5907\u4efd\u89c4\u8303\u4e2d\u5b9a\u4e49\u7684\u8d44\u6e90/\u540d\u79f0\u7a7a\u95f4/\u6807\u7b7e\u9009\u62e9\u5668\u5339\u914d\uff0c\u4e5f\u53ef\u4ee5\u6392\u9664\u5907\u4efd\u4e2d\u7684\u5355\u4e2a\u9879\u3002\u8981\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u6807\u7b7e\u7684\u9879\u76ee\u5982\u4e0b:</p> <pre><code>kubectl label -n &lt;ITEM_NAMESPACE&gt; &lt;RESOURCE&gt;/&lt;NAME&gt; velero.io/exclude-from-backup=true\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#42","title":"4.2 \u6307\u5b9a\u7279\u5b9a\u79cd\u7c7b\u8d44\u6e90\u7684\u5907\u4efd\u987a\u5e8f","text":"<p>\u8981\u6309\u7167\u7279\u5b9a\u987a\u5e8f\u5907\u4efd\u7279\u5b9a\u7c7b\u578b\u7684\u8d44\u6e90\uff0c\u53ef\u4ee5\u4f7f\u7528 option-ordered-resources \u6307\u5b9a\u5c06 sort \u6620\u5c04\u5230\u8be5\u7c7b\u578b\u7279\u5b9a\u8d44\u6e90\u7684\u6709\u5e8f\u5217\u8868\u3002\u8d44\u6e90\u540d\u79f0\u7528\u9017\u53f7\u5206\u9694\uff0c\u540d\u79f0\u683c\u5f0f\u4e3a\u201c namespace/resourcename\u201d\u3002\u5bf9\u4e8e\u7fa4\u96c6\u8303\u56f4\u8d44\u6e90\uff0c\u53ea\u9700\u4f7f\u7528\u8d44\u6e90\u540d\u79f0\u3002\u6620\u5c04\u4e2d\u7684\u952e\u503c\u5bf9\u7528\u5206\u53f7\u5206\u9694\u3002\u5584\u826f\u7684\u540d\u5b57\u662f\u590d\u6570\u5f62\u5f0f\u3002</p> <pre><code>velero backup create backupName --include-cluster-resources=true --ordered-resources 'pods=ns1/pod1,ns1/pod2;persistentvolumes=pv4,pv8' --include-namespaces=ns1\n\nvelero backup create backupName --ordered-resources 'statefulsets=ns1/sts1,ns1/sts0' --include-namespaces=ns1\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#backup-hooks","title":"\u4e94 Backup Hooks","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#51-backup-hooks","title":"5.1 Backup Hooks","text":"<p>\u5728\u6267\u884c\u5907\u4efd\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u547d\u4ee4\uff0c\u4ee5\u4fbf\u5728\u5907\u4efd pod \u65f6\u5728 pod \u4e2d\u7684\u5bb9\u5668\u4e2d\u6267\u884c\u3002\u8fd9\u4e9b\u547d\u4ee4\u53ef\u4ee5\u914d\u7f6e\u4e3a\u5728\u4efb\u4f55\u81ea\u5b9a\u4e49\u64cd\u4f5c\u5904\u7406(\u201c pre\u201dhooks)\u4e4b\u524d\u8fd0\u884c\uff0c\u6216\u8005\u5728\u6240\u6709\u81ea\u5b9a\u4e49\u64cd\u4f5c\u5b8c\u6210\u5e76\u5907\u4efd\u4e86\u81ea\u5b9a\u4e49\u64cd\u4f5c\u6307\u5b9a\u7684\u4efb\u4f55\u9644\u52a0\u9879(\u201c post\u201dhooks)\u4e4b\u540e\u8fd0\u884c\u3002\u6ce8\u610f\uff0c\u94a9\u5b50\u4e0d\u4f1a\u5728\u5bb9\u5668\u7684 shell \u4e2d\u6267\u884c\u3002</p> <p>\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u6307\u5b9a\u94a9\u5b50\uff1apod \u672c\u8eab\u7684\u6ce8\u91ca\u548c\u5907\u4efd\u89c4\u8303\u4e2d\u7684\u6ce8\u91ca\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#52-hooks-pod","title":"5.2 \u5c06 Hooks \u6307\u5b9a\u4e3a Pod \u6ce8\u91ca","text":"<p>\u60a8\u53ef\u4ee5\u5728 pod \u4e0a\u4f7f\u7528\u4ee5\u4e0b\u6ce8\u89e3\u8ba9 Velero \u5728\u5907\u4efd pod \u65f6\u6267\u884c\u4e00\u4e2a\u94a9\u5b50\uff1a</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#521-pre-hooks","title":"5.2.1 Pre hooks","text":"<ul> <li>pre.hook.backup.velero.io/container</li> </ul> <p>\u5e94\u6267\u884c\u547d\u4ee4\u7684\u5bb9\u5668\u3002\u9ed8\u8ba4\u4e3a pod \u4e2d\u7684\u7b2c\u4e00\u4e2a\u5bb9\u5668\u3002\u53ef\u9009\u7684\u3002</p> <ul> <li>pre.hook.backup.velero.io/command</li> </ul> <p>\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002\u5982\u679c\u9700\u8981\u591a\u4e2a\u53c2\u6570\uff0c\u5c06\u547d\u4ee4\u6307\u5b9a\u4e3a JSON \u6570\u7ec4\uff0c\u4f8b\u5982 [\"/usr/bin/uname\", \"-a\"]</p> <ul> <li>pre.hook.backup.velero.io/on-error</li> </ul> <p>\u5982\u679c\u547d\u4ee4\u8fd4\u56de\u975e\u96f6\u9000\u51fa\u4ee3\u7801\uff0c\u8be5\u600e\u4e48\u529e\u3002\u9ed8\u8ba4\u4e3a\u5931\u8d25\u3002\u6709\u6548\u503c\u4e3a\u5931\u8d25\u5e76\u7ee7\u7eed\u3002\u53ef\u9009\u7684\u3002</p> <ul> <li>pre.hook.backup.velero.io/timeout</li> </ul> <p>\u7b49\u5f85\u547d\u4ee4\u6267\u884c\u7684\u65f6\u95f4\u3002\u5982\u679c\u547d\u4ee4\u8d85\u8fc7\u8d85\u65f6\uff0c\u5219\u8ba4\u4e3a\u6302\u94a9\u9519\u8bef\u3002\u9ed8\u8ba4\u4e3a 30 \u79d2\u3002\u53ef\u9009\u7684\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#522-post-hooks","title":"5.2.2 Post hooks","text":"<ul> <li>post.hook.backup.velero.io/container</li> </ul> <p>\u5e94\u6267\u884c\u547d\u4ee4\u7684\u5bb9\u5668\u3002\u9ed8\u8ba4\u4e3a pod \u4e2d\u7684\u7b2c\u4e00\u4e2a\u5bb9\u5668\u3002\u53ef\u9009\u7684\u3002</p> <ul> <li>post.hook.backup.velero.io/command</li> </ul> <p>\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002\u5982\u679c\u9700\u8981\u591a\u4e2a\u53c2\u6570\uff0c\u5c06\u547d\u4ee4\u6307\u5b9a\u4e3a JSON \u6570\u7ec4\uff0c\u4f8b\u5982 [\"/usr/bin/uname\", \"-a\"]</p> <ul> <li>post.hook.backup.velero.io/on-error</li> </ul> <p>\u5982\u679c\u547d\u4ee4\u8fd4\u56de\u975e\u96f6\u9000\u51fa\u4ee3\u7801\uff0c\u8be5\u600e\u4e48\u529e\u3002\u9ed8\u8ba4\u4e3a\u5931\u8d25\u3002\u6709\u6548\u503c\u4e3a\u5931\u8d25\u5e76\u7ee7\u7eed\u3002\u53ef\u9009\u7684\u3002</p> <ul> <li>post.hook.backup.velero.io/\u8d85\u65f6</li> </ul> <p>\u7b49\u5f85\u547d\u4ee4\u6267\u884c\u7684\u65f6\u95f4\u3002\u5982\u679c\u547d\u4ee4\u8d85\u8fc7\u8d85\u65f6\uff0c\u5219\u8ba4\u4e3a\u6302\u94a9\u9519\u8bef\u3002\u9ed8\u8ba4\u4e3a 30 \u79d2\u3002\u53ef\u9009\u7684\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#53","title":"5.3 \u5728\u5907\u4efd\u89c4\u8303\u4e2d\u6307\u5b9a\u94a9\u5b50","text":"<p>\u8bf7\u53c2\u9605\u6709\u5173\u5907\u4efd API \u7c7b\u578b\u7684\u6587\u6863\uff0c\u4e86\u89e3\u5982\u4f55\u5728\u5907\u4efd\u89c4\u8303\u4e2d\u6307\u5b9a\u6302\u94a9\u3002Backup API Type</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#54-fsfreeze","title":"5.4 \u4f7f\u7528 fsfreeze \u7684\u94a9\u5b50\u793a\u4f8b","text":"<p>\u6b64\u793a\u4f8b\u5c06\u5f15\u5bfc\u60a8\u4f7f\u7528 pre \u548c post \u6302\u94a9\u6765\u51bb\u7ed3\u6587\u4ef6\u7cfb\u7edf\u3002\u51bb\u7ed3\u6587\u4ef6\u7cfb\u7edf\u6709\u52a9\u4e8e\u786e\u4fdd\u5728\u62cd\u6444\u5feb\u7167\u4e4b\u524d\u6240\u6709\u6302\u8d77\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\u90fd\u5df2\u5b8c\u6210\u3002</p> <p>\u672c\u793a\u4f8b\u4f7f\u7528 examples/nginx-app/with-pv.yaml\u3002\u6309\u7167\u60a8\u7684\u63d0\u4f9b\u5546\u7684steps for your provider\u6b64\u793a\u4f8b\u3002</p>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#55-annotations","title":"5.5 Annotations","text":"<p>Velero example/nginx-app/with-pv.yaml\u4f5c\u4e3a\u5c06 pre \u548c post \u94a9\u5b50\u6ce8\u91ca\u76f4\u63a5\u6dfb\u52a0\u5230\u58f0\u660e\u5f0f\u90e8\u7f72\u7684\u793a\u4f8b\u3002\u4e0b\u9762\u662f\u5c31\u5730\u66f4\u65b0\u5bf9\u8c61\u7684\u793a\u4f8b\u3002</p> <pre><code>kubectl annotate pod -n nginx-example -l app=nginx \\\n    pre.hook.backup.velero.io/command='[\"/sbin/fsfreeze\", \"--freeze\", \"/var/log/nginx\"]' \\\n    pre.hook.backup.velero.io/container=fsfreeze \\\n    post.hook.backup.velero.io/command='[\"/sbin/fsfreeze\", \"--unfreeze\", \"/var/log/nginx\"]' \\\n    post.hook.backup.velero.io/container=fsfreeze\n</code></pre> <p>\u73b0\u5728\u901a\u8fc7\u521b\u5efa\u5907\u4efd\u6765\u6d4b\u8bd5 pre \u548c post \u6302\u94a9\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Velero \u65e5\u5fd7\u6765\u9a8c\u8bc1 pre \u548c post \u6302\u94a9\u662f\u5426\u6b63\u5728\u8fd0\u884c\u5e76\u65e0\u9519\u8bef\u9000\u51fa\u3002</p> <pre><code>velero backup create nginx-hook-test\n\nvelero backup get nginx-hook-test\nvelero backup logs nginx-hook-test | grep hookCommand\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#56","title":"5.6 \u4f7f\u7528\u591a\u4e2a\u547d\u4ee4","text":"<p>\u8981\u4f7f\u7528\u591a\u4e2a\u547d\u4ee4\uff0c\u8bf7\u5c06\u76ee\u6807\u547d\u4ee4\u5305\u88c5\u5728\u4e00\u4e2a shell \u4e2d\uff0c\u5e76\u7528 ;\u3001&amp;&amp; \u6216\u5176\u4ed6 shell \u6761\u4ef6\u7ed3\u6784\u5c06\u5b83\u4eec\u5206\u5f00\u3002</p> <pre><code>    pre.hook.backup.velero.io/command='[\"/bin/bash\", \"-c\", \"echo hello &gt; hello.txt &amp;&amp; echo goodbye &gt; goodbye.txt\"]'\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#restore-reference","title":"\u516d Restore Reference","text":""},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#61","title":"6.1 \u6062\u590d\u5230\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4","text":"<p>Velero \u53ef\u4ee5\u5c06\u8d44\u6e90\u8fd8\u539f\u5230\u4e0e\u5907\u4efd\u5b83\u4eec\u7684\u547d\u540d\u7a7a\u95f4\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u3002\u4e3a\u6b64\uff0c\u8bf7\u4f7f\u7528 --namespace-mappings \u6807\u5fd7\uff1a</p> <pre><code>velero restore create RESTORE_NAME \\\n  --from-backup BACKUP_NAME \\\n  --namespace-mappings old-ns-1:new-ns-1,old-ns-2:new-ns-2\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#62","title":"6.2 \u5f53\u7528\u6237\u5220\u9664\u8fd8\u539f\u5bf9\u8c61\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48","text":"<p>\u8fd8\u539f\u5bf9\u8c61\u8868\u793a\u8fd8\u539f\u64cd\u4f5c\u3002\u8fd8\u539f\u5bf9\u8c61\u6709\u4e24\u79cd\u7c7b\u578b\u7684\u5220\u9664\uff1a</p> <ol> <li>\u4f7f\u7528 velero restore delete \u5220\u9664\u3002\u6b64\u547d\u4ee4\u5c06\u5220\u9664\u4ee3\u8868\u5b83\u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\u53ca\u5176\u5355\u72ec\u7684\u65e5\u5fd7\u548c\u7ed3\u679c\u6587\u4ef6\u3002\u4f46\u662f\uff0c\u5b83\u4e0d\u4f1a\u4ece\u96c6\u7fa4\u4e2d\u5220\u9664\u5b83\u521b\u5efa\u7684\u4efb\u4f55\u5bf9\u8c61\u3002</li> <li>\u4f7f\u7528 kubectl -n velero delete restore \u5220\u9664\u3002\u6b64\u547d\u4ee4\u5c06\u5220\u9664\u4ee3\u8868\u8fd8\u539f\u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u4f46\u4e0d\u4f1a\u5220\u9664\u5bf9\u8c61\u5b58\u50a8\u4e2d\u7684\u65e5\u5fd7/\u7ed3\u679c\u6587\u4ef6\uff0c\u6216\u5728\u96c6\u7fa4\u4e2d\u8fd8\u539f\u671f\u95f4\u521b\u5efa\u7684\u4efb\u4f55\u5bf9\u8c61\u3002</li> </ol>"},{"location":"cloud-native/operator/tools/velero/Velero%20%E4%BD%BF%E7%94%A8/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://velero.io/docs/v1.5/disaster-case/</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/","title":"Velero\u6e90\u7801\u7814\u8bfb\u4e00","text":""},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#_1","title":"\u4e00 \u5f15\u8a00","text":"<p>\u5728\u4e91\u539f\u751f\u7684\u5f00\u6e90\u9879\u76ee\u91cc\uff0cvelero\u57fa\u672c\u4e0a\u662f\u5bb9\u5668\u5907\u4efd\u9879\u76ee\u7684\u6807\u6746\uff0c\u793e\u533a\u7684\u6d3b\u8dc3\u7a0b\u5ea6\u4e5f\u6bd4\u8f83\u9ad8\uff0c\u6709\u4e9b\u5c0f\u4f01\u4e1a\u751a\u81f3\u7528velero\u6765\u4e3a\u4e00\u4e9b\u975e\u5173\u952e\u4e1a\u52a1\u8fdb\u884c\u5907\u4efd\u6062\u590d\u3002\u719f\u6089\u4e86\u89e3velero\u7684\u4ee3\u7801\u903b\u8f91\uff0c\u6709\u52a9\u4e8e\u7406\u89e3Kubernetes\u4e16\u754c\u4e2d\u7684\u5907\u4efd\u4e0e\u6062\u590d\u7684\u601d\u8def\u3002\u672c\u6587\u5c06\u5c1d\u8bd5\u5bf9velero\u7684\u4ee3\u7801\u8fdb\u884c\u6df1\u5165\u7684\u5206\u6790\uff0c\u56e0\u4e3a\u7bc7\u5e45\u539f\u56e0\uff0c\u672c\u6587\u5c06\u5206\u4e3a\u591a\u4e2a\u90e8\u5206\uff0c\u6bcf\u4e2a\u90e8\u5206\u72ec\u7acb\u6210\u7bc7\u3002\u672c\u6587\u662f\u8fd9\u4e2a\u7cfb\u5217\u7684\u7b2c\u4e00\u7bc7\uff0c\u5c06\u4ee5velero v1.5.3\u4ee3\u7801\u4e3a\u57fa\u7840\uff0c\u4f1a\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bvelero\u7684\u4ee3\u7801\u7ed3\u6784\uff0c\u6a21\u5757\u7ed3\u6784\uff0c\u518d\u5bf9velero\u7684API\u8fdb\u884c\u4e00\u4e2a\u7b80\u5355\u68b3\u7406\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#_2","title":"\u4e8c \u4ee3\u7801\u7ed3\u6784","text":"<p>\u8fdb\u5165velero\u7684\u4ee3\u7801\u76ee\u5f55\uff0c\u5305\u542b\u4ee3\u7801\u7684\u4e3b\u8981\u67094\u4e2a\u76ee\u5f55\uff1a</p> <pre><code>cmd/\ninternal/\npkg/\nthird_party/\n</code></pre> <p>\u5176\u4e2d\uff0c<code>cmd/</code>\u662f<code>main.go</code>\u6240\u5728\u7684\u76ee\u5f55\uff0c\u8fd9\u91cc<code>cmd/</code>\u6709\u4e24\u4e2amain\u7684\u5b9e\u73b0\uff0c\u4e00\u4e2a\u662fvelero\u7684\u4e3b\u4f53\uff0c\u53e6\u4e00\u4e2a\u662f<code>velero-restic-restore-helper</code>\uff0c\u8fd9\u4e2a<code>velero-restic-restore-helper</code>\u6211\u4eec\u5c06\u5728\u6062\u590d\u8fc7\u7a0b\u4e2d\u8bb2\u3002</p> <p><code>internal/</code>\u5b9e\u73b0\u4e86\u5c11\u6570\u51e0\u4e2a\u65b9\u6cd5\u4e0e\u7ed3\u6784\uff0c\u4f1a\u88ab<code>pkg/</code>\u91cc\u9762\u7528\u5230\u7684\u903b\u8f91\u8c03\u7528\u5230\uff0c\u800c\u4e14\u5b9e\u73b0\u4e5f\u4e0d\u591a\uff0c\u5176\u5b9e\u5b8c\u5168\u53ef\u4ee5\u5408\u5e76\u5165<code>pkg/</code>\u4e2d\u3002<code>third_party/</code>\u5c31\u662f\u5f15\u7528\u5230\u7684<code>vendor</code>\u7684\u4ee3\u7801\u3002\u56e0\u6b64\uff0c\u4e3b\u8981\u7684\u4ee3\u7801\u90fd\u5728<code>pkg/</code>\u4e2d\u3002</p> <p><code>pkg/</code>\u91cc\u6709\u8fd9\u4e9b\u76ee\u5f55\uff1a</p> <pre><code>drwxr-xr-x   3 xuel  staff    96B Jun  3 20:40 apis\ndrwxr-xr-x   7 xuel  staff   224B Jun  3 20:40 archive\ndrwxr-xr-x  23 xuel  staff   736B Jun  3 20:40 backup\ndrwxr-xr-x  30 xuel  staff   960B Jun  3 20:40 builder\ndrwxr-xr-x   4 xuel  staff   128B Jun  3 20:40 buildinfo\ndrwxr-xr-x  10 xuel  staff   320B Jun  3 20:40 client\ndrwxr-xr-x   7 xuel  staff   224B Jun  3 20:40 cmd\ndrwxr-xr-x  31 xuel  staff   992B Jun  3 20:40 controller\ndrwxr-xr-x   4 xuel  staff   128B Jun  3 20:40 discovery\ndrwxr-xr-x   4 xuel  staff   128B Jun  3 20:40 features\ndrwxr-xr-x   5 xuel  staff   160B Jun  3 20:40 generated\ndrwxr-xr-x  10 xuel  staff   320B Jun  3 20:40 install\ndrwxr-xr-x   3 xuel  staff    96B Jun  3 20:40 kuberesource\ndrwxr-xr-x   4 xuel  staff   128B Jun  3 20:40 label\ndrwxr-xr-x   3 xuel  staff    96B Jun  3 20:40 metrics\ndrwxr-xr-x   7 xuel  staff   224B Jun  3 20:40 persistence\ndrwxr-xr-x   8 xuel  staff   256B Jun  3 20:40 plugin\ndrwxr-xr-x   4 xuel  staff   128B Jun  3 20:40 podexec\ndrwxr-xr-x  27 xuel  staff   864B Jun  3 20:40 restic\ndrwxr-xr-x  39 xuel  staff   1.2K Jun  3 20:40 restore\ndrwxr-xr-x  18 xuel  staff   576B Jun  3 20:40 test\ndrwxr-xr-x  10 xuel  staff   320B Jun  3 20:40 util\ndrwxr-xr-x   3 xuel  staff    96B Jun  3 20:40 volume\n</code></pre> <p>\u4e0b\u9762\u6211\u4eec\u5bf9\u6bd4\u8f83\u91cd\u8981\u7684\u76ee\u5f55\u505a\u4e00\u4e9b\u4ecb\u7ecd\u3002</p> <ul> <li>apis</li> </ul> <p>\u5b9a\u4e49\u4e86velero\u7684API\uff0c\u540e\u9762\u7ae0\u8282\u4f1a\u628aAPI\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b</p> <ul> <li>backup</li> </ul> <p>\u5907\u4efd\u76f8\u5173\u7684\u903b\u8f91\uff0c\u4e3b\u8981\u88abbackup controller\u7528\u5230</p> <ul> <li>cmd</li> </ul> <p>velero\u7684\u5ba2\u6237\u7aef\u547d\u4ee4\u5b9e\u73b0\uff0c\u4ee5\u53ca\u670d\u52a1\u7aef\u5b9e\u4f8b\u7684\u5b9e\u73b0</p> <ul> <li>controller</li> </ul> <p>\u5bf9\u5e94\u6bcf\u4e2aAPI\u5b9e\u73b0\u7684controller\uff0c\u4ee5\u53ca\u5176\u5b83\u4e0d\u5bf9\u5e94API\u7684controller</p> <ul> <li>persistence</li> </ul> <p>\u5b9e\u73b0\u4e86velero\u5bf9\u5bf9\u8c61\u5b58\u50a8\u7684\u64cd\u4f5c\uff0c\u901a\u8fc7plugin\u5bf9\u63a5\u5177\u4f53\u7684\u5bf9\u8c61\u5b58\u50a8\u5b9e\u73b0\u65b9\uff08\u5982aws\uff09</p> <ul> <li>plugin</li> </ul> <p>velero\u5b9e\u73b0\u4e86\u4e00\u4e2aplugin\u7684\u6846\u67b6\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2aplugin\u7684\u63a5\u53e3\uff0c\u5e76\u628a\u8bf8\u5982\u5bf9\u8c61\u5b58\u50a8\uff0c\u5907\u4efd\u6062\u590d\u7684action\uff0cCSI\u64cd\u4f5c\u7b49\u7528plugin\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002</p> <ul> <li>restic</li> </ul> <p>\u5c01\u88c5\u4e86restic\u76f8\u5173\u7684\u64cd\u4f5c</p> <ul> <li>restore</li> </ul> <p>\u6062\u590d\u76f8\u5173\u903b\u8f91\uff0c\u4e3b\u8981\u88abrestore controller\u7528\u5230</p> <p>\u5bf9\u4e8e\u5176\u5b83\u7684\u4e00\u4e9b\u76ee\u5f55\uff0c\u6211\u4eec\u5c06\u4f1a\u5728\u540e\u9762\u6587\u7ae0\u7cfb\u5217\u4ecb\u7ecd\u5404\u4e2a\u6a21\u5757\u6216\u903b\u8f91\u65f6\u5019\uff0c\u4f1a\u628a\u76f8\u5173\u7528\u5230\u7684\u76ee\u5f55\u634e\u5e26\u7684\u63d0\u5230\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#_3","title":"\u4e09 \u6a21\u5757\u7ed3\u6784","text":"<p>velero\u7684\u6a21\u5757\u7ed3\u6784\u5927\u81f4\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u9996\u5148\uff0cvelero\u66b4\u9732\u7ed9\u666e\u901a\u7528\u6237\u7684\u662f\u4e00\u4e2a\u5ba2\u6237\u7aef\u547d\u4ee4<code>velero</code>\uff0c\u547d\u4ee4\u5c01\u88c5\u4e86\u5404\u79cd\u53c2\u6570\uff0c\u53ef\u4ee5\u6267\u884c\u5b89\u88c5\u3001\u914d\u7f6e\u3001\u5907\u4efd\u3001\u6062\u590d\u7b49\u64cd\u4f5c\u3002\u670d\u52a1\u7aef\u901a\u8fc7<code>velero install</code>\u6765\u5b89\u88c5\uff0c\u5c06velero\u670d\u52a1\u7aef\u90e8\u7f72\u6210Deployment\uff0c\u5e76\u4e14\u4f1a\u6839\u636e\u53c2\u6570\u628a\u76f8\u5173\u7684plugin\u7684\u955c\u50cf\u4e00\u8d77\u90e8\u7f72\u5728velero\u7684deployment\u4e2d\u3002</p> <p>\u670d\u52a1\u7aef\u7684\u5b9e\u73b0\u53ef\u4ee5\u7c7b\u6bd4\u6210\u4e00\u4e2a\u5178\u578b\u7684kubebuild\u7684operator\uff0c\u9996\u5148\u5b9a\u4e49\u4e0d\u540c\u7684CR\uff0c\u4e5f\u5c31\u662fAPI\uff0c\u4e0b\u9762\u662fcontroller\u7684\u5b9e\u73b0\uff0c\u6700\u4e0b\u9762\u7684restic\u8868\u793a\u5e95\u5c42\u7684\u6570\u636e\u62f7\u8d1d\u5c42\u7528\u7684\u662frestic\u3002\u4e2d\u95f4controller\u5c42\u9700\u8981\u7528\u5230\u4e00\u4e9b\u76f8\u5bf9\u6bd4\u8f83\u72ec\u7acb\u7684\u670d\u52a1\u65f6\uff0c\u90fd\u4f1a\u901a\u8fc7\u63d2\u4ef6\u7cfb\u7edf\u6765\u5bf9\u63a5\u5230\u5185\u90e8\u6216\u8005\u5916\u90e8\u7684\u63d2\u4ef6\u670d\u52a1\u3002<code>velero.io/plugins</code>\u5c31\u4ee3\u8868\u5185\u90e8\u7684\u63d2\u4ef6\u5b9e\u73b0\uff0c\u5176\u5b83\u90fd\u662f\u5916\u90e8\u7684\u63d2\u4ef6\u5b9e\u73b0\uff0c\u7531velero\u6216\u8005\u7b2c\u4e09\u65b9\u5382\u5546\u6765\u5b9e\u73b0\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#api","title":"\u4e09 API","text":""},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#31-backupstoragelocation","title":"3.1 BackupStorageLocation","text":"<p>\u5907\u4efd\u4ed3\u5e93\u5730\u5740\uff08BSL\uff09\u3002\u8fd9\u91ccvelero\u4e3b\u8981\u628aS3\u5bf9\u8c61\u5b58\u50a8\u5c01\u88c5\u8fdb\u6765\u4f5c\u4e3a\u5907\u4efd\u4ed3\u5e93\u7684\u5730\u5740\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u5b9e\u9645\u7684\u4f8b\u5b50\uff1a</p> <pre><code>    spec:\n      accessMode: ReadWrite\n      backupSyncPeriod: 3m0s\n      config:\n        insecureSkipTLSVerify: \"true\"\n        region: default\n        s3ForcePathStyle: \"true\"\n        s3Url: http://132.198.139.59:9010\n      objectStorage:\n        bucket: test\n        prefix: host-cluster\n      provider: aws\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#32-volumesnapshotlocation","title":"3.2 VolumeSnapshotLocation","text":"<p>\u5377\u5feb\u7167\u5730\u5740\uff08VSL\uff09\u3002velero\u5b9a\u4e49\u4e86\u4e00\u4e2aVolumeSnapshotter\u7684\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u9700\u8981\u88ab\u7b2c\u4e09\u65b9\u5b58\u50a8\u5382\u5546\u5b9e\u73b0\uff0c\u6765\u63d0\u4f9b\u5377\u5feb\u7167\u7684\u529f\u80fd\u3002\u4f46\u662f\u8fd9\u91cc\u7684\u5feb\u7167\u8ddfCSI\u7684\u5feb\u7167\u6bd4\u8f83\u5bb9\u6613\u6df7\u6dc6\uff0c\u6bd4\u5982\uff0cVelero\u5907\u4efd\u5b9e\u6218 - \u57fa\u4e8eCeph\u7684CSI\u5feb\u7167\u8fd9\u7bc7\u6587\u7ae0\u63d0\u5230\u7684\u5feb\u7167\u5b9e\u9645\u4e0a\u662f\u53c2\u80032\u7684CSI\u63d2\u4ef6\u63d0\u4f9b\u7684\u5feb\u7167\u80fd\u529b\uff0c\u8ddfVSL\u5176\u5b9e\u6ca1\u6709\u5173\u7cfb\u3002</p> <p>\u5e38\u7528\u7684AWS\u63d2\u4ef6\uff08\u53c2\u80033\uff09\u5b9e\u73b0\u4e86VolumeSnapshotter\uff0c\u4f46\u5982\u679c\u4e0d\u7528\u6807\u51c6\u7684AWS S3\u5feb\u7167\u670d\u52a1\uff0c\u800c\u662f\u4f7f\u7528\u4e86CSI\u63a5\u53e3\u6765\u505a\u5feb\u7167\uff0c\u90a3\u4e48\u5176\u5b9e\u5e76\u6ca1\u6709\u7528\u5230AWS\u7684\u5feb\u7167\u63d2\u4ef6\u529f\u80fd\uff0c\u53ea\u662f\u7528\u4e86\u5bf9\u8c61\u5b58\u50a8\u7684\u63d2\u4ef6\u63a5\u53e3\uff0c\u56e0\u6b64\u4e5f\u6ca1\u6709\u6d89\u53ca\u5230VSL\u3002</p> <p>\u4e00\u53e5\u8bdd\u603b\u7ed3\uff0c\u5982\u679c\u7528\u5230\u4e86\u7b2c\u4e09\u65b9\u5b58\u50a8\u5382\u5546\u7684\u5feb\u7167\u529f\u80fd\uff08\u4f8b\u5982\u53c2\u80034\uff09\uff0c\u90a3\u5c31\u4f1a\u7528\u5230VSL\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#33-backup","title":"3.3 Backup","text":"<p>\u5907\u4efd\u3001\u6062\u590d\u7684API\u662fvelero\u7684\u6838\u5fc3API\uff0c\u5907\u4efd\u4e3b\u8981\u5305\u542b\u4e86\u51e0\u7c7b\u53c2\u6570\uff1a</p> <ul> <li>\u8d44\u6e90\u7684\u9009\u62e9\uff0c\u6bd4\u5982\u5305\u542b\u7684namespace\uff0c\u4e0d\u5305\u542b\u7684\u8d44\u6e90\u7b49</li> <li>\u63a7\u5236\u53c2\u6570\uff0c\u6bd4\u5982\u662f\u5426\u505a\u5feb\u7167\uff0c\u662f\u5426\u7528restic\u505a\u5907\u4efd\u7b49</li> <li>BSL\uff0cVSL</li> <li>hook</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#34-restore","title":"3.4 Restore","text":"<p>\u6062\u590d\u7684API\u9996\u5148\u9700\u8981\u5907\u4efdCR\u7684\u540d\u5b57\uff0c\u7136\u540e\u4e5f\u5305\u542b\u51e0\u7c7b\u53c2\u6570\uff1a</p> <ul> <li>\u8d44\u6e90\u7684\u9009\u62e9\uff0c\u6bd4\u5982\u6062\u590d\u54ea\u4e2anamespace\uff0c\u6216\u8005\u67d0\u4e2a\u8d44\u6e90</li> <li>\u63a7\u5236\u53c2\u6570\uff0c\u63a7\u5236namespace\u540d\u5b57\u7684\u6620\u5c04\uff0c\u4ee5\u53ca\u662f\u5426\u6062\u590dPV</li> <li>hook</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#35-schedule","title":"3.5 Schedule","text":"<ul> <li>Schedule\u5176\u5b9e\u5c31\u662f\u4e00\u4e2aCronjob\u7684\u5b57\u7b26\u4e32\u52a0\u4e0a\u4e00\u4e2a\u5907\u4efdAPI\u7684Spec\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#36-podvolumebackup","title":"3.6 PodVolumeBackup","text":"<ul> <li>PodVolumeBackup\u4e3b\u8981\u662fvelero\u5185\u90e8\u4f7f\u7528\u7684\u4e00\u4e2aAPI\uff0c\u5b83\u5c01\u88c5\u4e86restic\u5907\u4efd\u4e00\u4e2aPod\u7684\u4e00\u4e2aPV\u7684\u64cd\u4f5c\uff0c\u7136\u540eCR\u7684Status\u4f1a\u5f97\u5230restic\u7684\u5c42\u9762\u4e00\u4e2asnapshotID\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#37-podvolumerestore","title":"3.7 PodVolumeRestore","text":"<ul> <li>PodVolumeRestore\u5c01\u88c5\u4e86restic\u6062\u590d\u4e00\u4e2aPod\u7684PV\u7684\u64cd\u4f5c\uff0c\u4e0a\u9762PodVolumeBackup Status\u7684snapshotID\u662f\u4e00\u4e2a\u5173\u952e\u53c2\u6570\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#38-resticrepository","title":"3.8 ResticRepository","text":"<ul> <li>\u8ddf\u4e0a\u9762PodVolumeBackup\u3001PodVolumeRestore\u7c7b\u4f3c\uff0cResticRepository\u4e5f\u662f\u4e00\u4e2a\u5185\u90e8\u4f7f\u7528\u7684API\uff0c\u5c01\u88c5\u4e86restic\u9700\u8981\u7684\u4e00\u4e2a\u4ed3\u5e93\u7684\u4fe1\u606f\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#39-deletebackuprequest","title":"3.9 DeleteBackupRequest","text":"<ul> <li>velero\u628a\u5220\u9664\u4e00\u4e2a\u5907\u4efd\u4ee5\u53ca\u76f8\u5173\u8d44\u6e90\u7684\u64cd\u4f5c\u5c01\u88c5\u5230DeleteBackupRequest\u91cc\uff0c\u5f53\u4e00\u4e2aDeleteBackupRequest CR\u88ab\u521b\u5efa\u540e\uff0c\u63a7\u5236\u903b\u8f91\u4f1a\u5c1d\u8bd5\u5220\u9664\u6b63\u5728\u8fdb\u884c\u4e2d\u7684\u5907\u4efd\uff0c\u5bf9\u5907\u4efd\u7684\u8d44\u6e90\uff0c\u6bd4\u5982\u5f53\u524d\u96c6\u7fa4\u4e2d\u751f\u6210\u7684PV\u7684Volumesnapshot\u7b49\uff0c\u90fd\u4f1a\u4e00\u8d77\u6e05\u7406\u6389\u3002\u4f46\u662f\u5bf9\u4e8e\u5bf9\u8c61\u5b58\u50a8\u4e2d\u5907\u4efd\u7684\u6570\u636e\u5305\uff0c\u5e76\u4e0d\u4f1a\u5220\u9664\uff0c\u8fd9\u4e2a\u5220\u9664\u7531\u53e6\u4e00\u4e2a\u63a7\u5236\u5668\u5728\u5907\u4efd\u7559\u5b58\u5468\u671f\u8d85\u65f6\u540e\u6765\u5b8c\u6210\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%B8%80/#_4","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>https://velero.cn/d/13-velero</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/","title":"velero \u6e90\u7801\u6df1\u5165\u5206\u6790\u4e8c","text":""},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_1","title":"\u4e00 \u5f15\u8a00","text":"<p>velero\u7684\u63d2\u4ef6\u7cfb\u7edf\u7406\u89e3\u8d77\u6765\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4e09\u90e8\u5206\uff0c\u4e00\u662f\u8ddf\u53c2\u80031\u7684<code>go-plugin</code>\u5e93\u7684\u96c6\u6210\uff0c\u4e8c\u662f\u63d2\u4ef6\u6846\u67b6\u90e8\u5206\uff0c\u4e09\u662f\u63d2\u4ef6\u7684\u5ba2\u6237\u7aef\u7ba1\u7406\u90e8\u5206\uff0c\u672c\u6587\u4e3b\u8981\u4f1a\u56f4\u7ed5\u8fd9\u4e09\u90e8\u5206\u5c55\u5f00\uff0c\u6765\u6df1\u5165\u7684\u5206\u6790\u4e00\u4e0bvelero\u7684\u63d2\u4ef6\u7cfb\u7edf\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_2","title":"\u4e8c \u80cc\u666f","text":"<p><code>go-plugin</code>\u8fd9\u4e2agithub\u9879\u76ee\u662f\u8457\u540d\u7684\u5f00\u6e90\u8f6f\u4ef6\u516c\u53f8Hashicorp\u7684\u4e00\u4e2a\u9879\u76ee\uff0c\u6700\u521d\u7528\u6765\u5f53\u4f5cHashicorp\u5176\u5b83\u9879\u76ee\u7684\u4e00\u4e2a\u5de5\u5177\u3002<code>go-plugin</code>\u4e3b\u8981\u662f\u4e3ago\u8bed\u8a00\u5199\u7684\u7528\u6765\u652f\u6301RPC\u6216\u8005gRPC\u7684\u4e00\u4e2a\u63d2\u4ef6\u7cfb\u7edf\uff0c\u4f46\u662f\uff0c\u53ea\u80fd\u7528\u6765\u652f\u6301\u672c\u5730\u7684\u53ef\u9760\u7f51\u7edc\uff0c\u4e0d\u652f\u6301\u8fdc\u7a0b\u7684\u5b9e\u9645\u7f51\u7edc\u3002</p> <p>velero\u4f7f\u7528<code>go-plugin</code>\u4e3b\u8981\u662f\u4e3a\u4e86\u4e0e\u4e0d\u540c\u7684\u5b58\u50a8\u5382\u5546\u66f4\u597d\u7684\u96c6\u6210\uff0c\u5c3d\u91cf\u964d\u4f4e\u4e0e\u5916\u90e8\u4e0d\u540c\u5382\u5546\u7684\u8026\u5408\u5ea6\u3002\u53c2\u80033\u7ed9\u51fa\u4e86\u76ee\u524d\u5b9e\u73b0velero\u63d2\u4ef6\u7684\u5382\u5546\uff0c\u90e8\u5206\u5382\u5546\u65e2\u652f\u6301\u5bf9\u8c61\u5b58\u50a8\u7684\u63d2\u4ef6\uff0c\u4e5f\u652f\u6301\u5feb\u7167\u7684\u63d2\u4ef6\u5b9e\u73b0\u3002\u6bd4\u8f83\u5e38\u89c1\u7684\u63d2\u4ef6\u5b9e\u73b0\u6709\uff1aAWS\uff0cCSI\uff0cAzsure\u7b49\u3002</p> <p>\u9664\u4e86\u4e0a\u9762\u8fd9\u4e9b\u5382\u5546\u7684\u96c6\u6210\uff0cvelero\u8fd8\u628a\u5907\u4efd\u6062\u590d\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u4e00\u4e9b\u64cd\u4f5c\uff08Action\uff09\uff0c\u4f8b\u5982\u5bf9PV\u3001Pod\u3001StorageClass\u7b49\u8d44\u6e90\u7684\u64cd\u4f5c\uff0c\u4e5f\u62bd\u8c61\u51fa\u6765\u53d8\u6210\u4e86\u63d2\u4ef6\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_3","title":"\u4e09 \u6574\u4f53\u89c6\u56fe","text":"<p>velero\u901a\u8fc7<code>go-plugin</code>\u6784\u9020\u4e86\u4e00\u4e2a\u4e24\u7ea7\u7684\u63d2\u4ef6\u7cfb\u7edf\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5176\u4e2d\u7b2c\u4e00\u7ea7\u5b9a\u4e49\u4e86\u4e3b\u8981\u7684\u63d2\u4ef6\u7c7b\u578b\uff0c\u6bcf\u4e00\u4e2a\u63d2\u4ef6\u4f1a\u5b9e\u73b0<code>go-plugin</code>\u5b9a\u4e49\u7684\u63a5\u53e3\u3002\u800c\u6bcf\u4e2a\u4e00\u7ea7\u63d2\u4ef6\uff0c\u90fd\u53ef\u4ee5\u5b9a\u4e49\u5177\u4f53\u7684gRPC\u7684\u901a\u8baf\u63a5\u53e3\uff0c\u5e76\u4e14\u53ef\u4ee5\u5305\u542b\u4e0d\u540c\u7684\u5b50\u63d2\u4ef6\u64cd\u4f5c\uff0c\u4ece\u800c\u5b9e\u73b0\u4e8c\u7ea7\u63d2\u4ef6\u7684\u5b9a\u4e49\u3002</p> <p>\u4f8b\u5982\uff0c<code>BackupItemAction</code>\u5b9a\u4e49\u4e86\u4e00\u4e2a\u63a5\u53e3\uff0cPV\uff0cPod\u7b49\u64cd\u4f5c\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e2a\u63a5\u53e3\uff0c\u4ece\u800c\u6269\u5c55\u4e86<code>BackupItemAction</code>\u7684\u4e8c\u7ea7\u63d2\u4ef6\u64cd\u4f5c\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_4","title":"\u56db \u63d2\u4ef6\u96c6\u6210","text":"<p>plugin.go\u5b9a\u4e49\u4e86\u63d2\u4ef6\u5e93\u7684RPC\u548cGRPC\u63d2\u4ef6\u63a5\u53e3:</p> <pre><code>type Plugin interface {\n    Server(*MuxBroker) (interface{}, error)\n    Client(*MuxBroker, *rpc.Client) (interface{}, error)\n}\n\ntype GRPCPlugin interface {\n    GRPCServer(*GRPCBroker, *grpc.Server) error\n    GRPCClient(context.Context, *GRPCBroker, *grpc.ClientConn) (interface{}, error)\n}\n</code></pre> <p>\u5982\u679c\u4e0d\u60f3\u652f\u6301RPC\u7684\u63d2\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762<code>plugin.go</code>\u4e2d\u5b9a\u4e49\u7684<code>NetRPCUnsupportedPlugin</code>\uff0c\u7136\u540e\u5b9e\u73b0<code>GRPCPlugin</code>\u5b9a\u4e49\u7684\u63a5\u53e3\u6765\u96c6\u6210\u3002</p> <p>velero\u540c\u63d2\u4ef6\u5e93\u7684\u96c6\u6210\u5206\u4e3a\u51e0\u4e2a\u90e8\u5206\uff1a</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#41","title":"4.1 \u5b9e\u73b0\u4e86\u4e0a\u9762\u63d2\u4ef6\u63a5\u53e3\u7684\u90e8\u5206","text":"<p>\u5b9e\u73b0\u4e86<code>GRPCPlugin</code>\u63a5\u53e3\u7684\u4e3b\u8981\u662f\u8fd9\u51e0\u4e2a\u6587\u4ef6\uff1a</p> <pre><code>    pkg/plugin/framework/backup_item_action.go\n    pkg/plugin/framework/restore_item_action.go\n    pkg/plugin/framework/object_store.go\n    pkg/plugin/framework/volume_snapshotter.go\n    pkg/plugin/framework/plugin_lister.go\n    pkg/plugin/framework/delete_item_action.go\n</code></pre> <p>\u5176\u4e2d\uff0c<code>delete_item_action</code>\u662fvelero\u65b0\u5f15\u5165\u7684\u4e00\u4e2a\u63d2\u4ef6\u63a5\u53e3\uff0c\u76ee\u524d\u5e76\u6ca1\u6709\u670d\u52a1\u7aef\u7684\u5b9e\u73b0\u65b9\uff0c\u56e0\u6b64\u540e\u9762\u7684\u6587\u7ae0\u4e2d\u4f1a\u7565\u8fc7\u8fd9\u4e2a\u63d2\u4ef6\u3002\u6240\u6709\u7684\u63d2\u4ef6\u90fd\u5b9e\u73b0\u4e86<code>GRPCServer</code>\u548c<code>GRPCClient</code>\u8fd9\u4e24\u4e2a\u63a5\u53e3\uff0c\u4f1a\u5728\u4e0b\u4e00\u7ae0\u63d2\u4ef6\u6846\u67b6\u4e2d\u8be6\u7ec6\u9610\u8ff0\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#42-velero","title":"4.2 velero\u5bf9\u63d2\u4ef6\u64cd\u4f5c\u7684\u63a5\u53e3\u5b9a\u4e49","text":"<p>\u5bf9\u4e0a\u9762\u7684\u6bcf\u4e00\u4e2a\u63d2\u4ef6\u7c7b\u578b\uff0cvelero\u4f1a\u5b9a\u4e49\u4e00\u4e2a\u5c5e\u4e8e\u8fd9\u4e2a\u63d2\u4ef6\u7c7b\u578b\u7684\u72ec\u7279\u63a5\u53e3\uff08\u5373\u4e0a\u4e00\u8282\u8bf4\u7684\u4e8c\u7ea7\u63d2\u4ef6\uff09\uff0c\u4ee5\u5b9e\u73b0\u5bf9\u6bcf\u4e00\u79cd\u63d2\u4ef6\u7c7b\u578b\u7684\u901a\u8baf\u9700\u6c42\u3002\u5177\u4f53\u7684\u63a5\u53e3\u5b9a\u4e49\u4f1a\u5728\u540e\u7eed\u90e8\u5206\u5c55\u5f00\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#43-grpc","title":"4.3 \u5b9e\u73b0gRPC\u7684\u5ba2\u6237/\u670d\u52a1\u7aef\u7684\u90e8\u5206","text":"<p>\u5ba2\u6237\u7aef\u7684\u5b9e\u73b0\uff1a</p> <pre><code>    pkg/plugin/framework/backup_item_action_client.go\n    pkg/plugin/framework/restore_item_action_client.go\n    pkg/plugin/framework/object_store_client.go\n    pkg/plugin/framework/volume_snapshotter_client.go\n    pkg/plugin/framework/plugin_lister_client.go\n</code></pre> <p>\u670d\u52a1\u7aef\u7684\u5b9e\u73b0\uff1a</p> <pre><code>    pkg/plugin/framework/backup_item_action_server.go\n    pkg/plugin/framework/restore_item_action_server.go\n    pkg/plugin/framework/object_store_server.go\n    pkg/plugin/framework/volume_snapshotter_server.go\n    pkg/plugin/framework/plugin_lister_server.go\n</code></pre> <p>gRPC\u7684\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u88ab\u5c01\u88c5\u6210\u7ed3\u6784\u4f53\uff0c\u7136\u540e\u4f1a\u88ab\u67d0\u4e2a\u63d2\u4ef6\u7c7b\u578b\u7684<code>GRPCServer</code>\u548c<code>GRPCClient</code>\u5b9e\u73b0\u8fd4\u56de\uff0c\u8fd4\u56de\u7684\u7ed3\u679c\u6700\u7ec8\u53ef\u4ee5\u5f97\u5230\u7b2c\u4e8c\u7ea7\u7684\u67d0\u4e2a\u5177\u4f53\u7684\u63d2\u4ef6\u64cd\u4f5c\u7684\u5b9e\u73b0\uff0c\u4ece\u800c\u5b9e\u73b0\u4e24\u7ea7\u7684\u63d2\u4ef6\u5c01\u88c5\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#44-protocol-buffer","title":"4.4 Protocol buffer\u7684\u5b9a\u4e49\u4ee5\u53ca\u81ea\u52a8\u4ea7\u751f\u7684\u4ee3\u7801","text":"<p><code>pkg/plugin/velero/</code>\u4e0b\u9762\u662fvelero\u5b9a\u4e49\u7684\u4e0d\u540c\u63d2\u4ef6\u7c7b\u578b\u7684\u63a5\u53e3\uff0c<code>pkg/plugin/proto/</code>\u662fprotocol buffer\u7684\u5b9a\u4e49\uff0c<code>pkg/plugin/generated/</code>\u662fprotocol buffer\u751f\u6210\u7684\u4ee3\u7801\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#45","title":"4.5 \u4f7f\u7528\u63d2\u4ef6\u5e93\u7684\u670d\u52a1","text":"<ol> <li>\u4e3b\u8981\u5305\u62ec\u63d2\u4ef6\u7684\u521d\u59cb\u5316\u6ce8\u518c\uff0cvelero\u5bf9\u63d2\u4ef6\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\uff0c\u4ee5\u53ca\u63d2\u4ef6\u5ba2\u6237\u7aef\u7684\u5206\u53d1\uff0c\u5c06\u5728\u4e0b\u4e00\u8282\u5c55\u5f00\u3002</li> </ol> <p>\u901a\u8fc7\u4e0e<code>go-plugin</code>\u7684\u96c6\u6210\uff0cvelero\u5bf9\u4e0d\u540c\u79cd\u7c7b\u7684\u63d2\u4ef6\u6784\u5efa\u4e86\u4e0d\u540c\u7684gRPC\u901a\u9053\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ul> <li>\u63d2\u4ef6\u7684\u4f7f\u7528\u7aef\uff08\u5de6\u4fa7\u5f69\u8272\uff09</li> </ul> <p>\u5de6\u4fa7velero\u7684\u5907\u4efd\u6216\u8005\u6062\u590d\u903b\u8f91\u4e2d\uff0c\u5728\u9700\u8981\u4f7f\u7528\u63d2\u4ef6\u7684\u5730\u65b9\uff0c\u9996\u5148\u8981\u62ff\u5230\u4e0d\u540c\u7684\u63d2\u4ef6\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef\uff0c\u7136\u540e\u8c03\u7528\u63d2\u4ef6\u64cd\u4f5c\u7684\u63a5\u53e3\u3002\u4f8b\u5982\u5907\u4efd\u7684\u64cd\u4f5c\u662f<code>BackupItemAction</code>\u8fd9\u4e2a\u63a5\u53e3\uff0c\u63a5\u53e3\u7684\u5b9e\u73b0\u4f1a\u6839\u636e\u63d2\u4ef6\u64cd\u4f5c\u7684\u540d\u5b57\u5bf9\u5e94\u5230\u76f8\u5e94\u7684\u5ba2\u6237\u7aef\u5165\u53e3\uff0c\u901a\u8fc7\u63a5\u53e3\u5b9e\u73b0\u8fdc\u7a0b\u7684\u670d\u52a1\u8c03\u7528\u3002</p> <ul> <li>gRPC\u7684\u8fde\u63a5\u90e8\u5206\uff08\u4e2d\u95f4\u7ea2\u8272\uff09</li> </ul> <p>\u4e2d\u95f4\u7684gRPC\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5c31\u662f\u4e0a\u9762\u7b2c3\u70b9\u7684\u5b9e\u73b0\u90e8\u5206\u3002</p> <ul> <li>\u63d2\u4ef6\u7684\u5b9e\u73b0\u7aef\uff08\u53f3\u4fa7\u5f69\u8272\uff09</li> </ul> <p>\u63d2\u4ef6\u7684API\u8bf7\u6c42\u5230\u4e86\u670d\u52a1\u7aef\u4e4b\u540e\uff0c\u4f1a\u6839\u636e\u6ce8\u518c\u7684\u64cd\u4f5c\u628a\u8bf7\u6c42\u5b9a\u5411\u5230\u5b9e\u9645\u7684\u63d2\u4ef6\u5b9e\u73b0\u4e2d\uff0c\u4ece\u800c\u5b8c\u6210\u6574\u4e2a\u63d2\u4ef6\u7684\u8bf7\u6c42\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_5","title":"\u4e94 \u63d2\u4ef6\u6846\u67b6","text":"<p>\u63d2\u4ef6\u6846\u67b6\u7684\u4e3b\u8981\u4ee3\u7801\u5728<code>pkg/plugin/framework/</code>\u3002\u63d2\u4ef6\u6846\u67b6\u4e3b\u8981\u5b9a\u4e49\u4e86\u63d2\u4ef6\u7684\u5404\u4e2a\u7c7b\u578b\u4ee5\u53ca\u6570\u636e\u7ed3\u6784\uff0c\u5e76\u5b9e\u73b0\u4e86\u670d\u52a1\u7aef\u540c<code>go-plugin</code>\u7684\u96c6\u6210\u3002\u4ee5\u4e0b\u662f\u63d2\u4ef6\u6846\u67b6\u7684\u6570\u636e\u7ed3\u6784\u5173\u7cfb\u56fe\uff1a</p> <p></p> <p>\u63d2\u4ef6\u6846\u67b6\u7684\u6838\u5fc3\u662f<code>Server</code>\uff0c\u5176\u4e2d\u4e3b\u8981\u5305\u62ec\u4e86velero\u5b9e\u73b0\u7684\u7b2c\u4e00\u7ea7\u63d2\u4ef6\u7684\u6307\u9488\u3002\u6bcf\u4e00\u4e2a\u7b2c\u4e00\u7ea7\u63d2\u4ef6\u4f1a\u5d4c\u5165\u4e00\u4e2a<code>PluginBase</code>\u7684\u7ed3\u6784\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4e3b\u8981\u4f5c\u7528\u662f\u6307\u5411\u4e00\u4e2a<code>ServerMux</code>\u7684\u7ed3\u6784\u3002<code>ServerMux</code>\u5305\u542b\u7684\u6570\u636e\u7ed3\u6784\u4f1a\u5b9a\u4f4d\u5230\u7b2c\u4e8c\u7ea7\u63d2\u4ef6\u64cd\u4f5c\uff0c\u5e76\u5b9e\u73b0\u6ce8\u518c\u63d2\u4ef6\u64cd\u4f5c\u3001<code>Get</code>\u7b49\u64cd\u4f5c\uff0c\u4ece\u800c\u53ef\u4ee5\u5f97\u5230\u6bcf\u4e00\u4e2a\u5177\u4f53\u7684\u7b2c\u4e8c\u7ea7\u63d2\u4ef6\u64cd\u4f5c\u7684\u5b9e\u73b0\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#51","title":"5.1 \u63d2\u4ef6\u7c7b\u578b\u7684\u5b9e\u73b0","text":"<p>\u5bf9\u6bcf\u4e00\u4e2a\u4e00\u7ea7\u63d2\u4ef6\uff0c\u90fd\u8981\u5b9e\u73b0<code>go-plugin</code>\u63d2\u4ef6\u5e93\u7684<code>plugin</code>\u63a5\u53e3\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f<code>BackupItemActionPlugin</code>\u7684\u5b9e\u73b0\uff0c\u5728<code>pkg/plugin/framework/backup_item_action.go</code>\uff1a</p> <pre><code>type BackupItemActionPlugin struct {\n    plugin.NetRPCUnsupportedPlugin\n    *pluginBase\n}\n\n// GRPCClient returns a clientDispenser for BackupItemAction gRPC clients.\nfunc (p *BackupItemActionPlugin) GRPCClient(_ context.Context, _ *plugin.GRPCBroker, clientConn *grpc.ClientConn) (interface{}, error) {\n    return newClientDispenser(p.clientLogger, clientConn, newBackupItemActionGRPCClient), nil\n}\n\n// GRPCServer registers a BackupItemAction gRPC server.\nfunc (p *BackupItemActionPlugin) GRPCServer(_ *plugin.GRPCBroker, server *grpc.Server) error {\n    proto.RegisterBackupItemActionServer(server, &amp;BackupItemActionGRPCServer{mux: p.serverMux})\n    return nil\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c<code>BackupItemActionPlugin</code>\u7684<code>GRPCClient</code>\u4e3b\u8981\u662f\u8fd4\u56de\u4e00\u4e2a<code>BackupItemAction</code>\u7684gRPC\u5ba2\u6237\u7aef\u7684\u5206\u53d1\u5668\uff0c\u5e76\u4e14\u53c2\u6570\u4f1a\u5e26\u4e00\u4e2agRPC\u7684\u901a\u9053\uff1b\u800c<code>GRPCServer</code>\u4e3b\u8981\u662f\u4e3a\u4e86\u6ce8\u518c\u4e00\u4e2a<code>BackupItemAction</code>\u7684gRPC\u670d\u52a1\u7aef\u7684\u5b9e\u73b0\uff0c\u5728\u670d\u52a1\u7aef\u521d\u59cb\u5316\u65f6\u4f1a\u88ab<code>go-plugin</code>\u8c03\u7528\u5230\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#52","title":"5.2 \u63d2\u4ef6\u64cd\u4f5c\u63a5\u53e3\u5b9a\u4e49","text":"<p>velero\u5bf9\u6bcf\u4e2a\u63d2\u4ef6\u64cd\u4f5c\u7684\u63a5\u53e3\u5b9a\u4e49\u5728<code>pkg/plugin/velero/</code>\u4e0b\u9762\uff0c\u4f8b\u5982\uff0c\u62ff\u5907\u4efd\u7684\u64cd\u4f5c\u4e3e\u4f8b\uff0c<code>pkg/plugin/velero/backup_item_action.go</code>\u5b9a\u4e49\u7684\u63a5\u53e3\u662f\u8fd9\u6837\uff1a</p> <pre><code>type BackupItemAction interface {\n    AppliesTo() (ResourceSelector, error)\n    Execute(item runtime.Unstructured, backup *api.Backup) (runtime.Unstructured, []ResourceIdentifier, error)\n}\n\n// ResourceIdentifier describes a single item by its group, resource, namespace, and name.\ntype ResourceIdentifier struct {\n    schema.GroupResource\n    Namespace string\n    Name      string\n}\n</code></pre> <p>\u6062\u590d\u64cd\u4f5c\u7684\u63a5\u53e3\u770b\u8d77\u6765\u4e00\u6837\uff0c\u4f46\u5176\u5b9e\u53c2\u6570\u7c7b\u578b\u548c\u8fd4\u56de\u503c\u4e0d\u4e00\u6837\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5217\u51fa\u3002</p> <p><code>AppliesTo</code>\u63a5\u53e3\u7684\u5b9e\u73b0\u4e3b\u8981\u662f\u4e3a\u4e86\u5bf9\u6267\u884c\u64cd\u4f5c\u7684\u8d44\u6e90\u505a\u8fdb\u4e00\u6b65\u7684\u7b5b\u9009\uff0c\u800c<code>Execute</code>\u4e3b\u8981\u662f\u4e3a\u4e86\u6267\u884c\u5177\u4f53\u7684\u52a8\u4f5c\uff0c\u7136\u540e\u8fd4\u56de\u8fd9\u4e2a\u8d44\u6e90\u3002\u4f8b\u5982\uff0c\u5bf9\u5377\u5feb\u7167\u7684\u5907\u4efd\u6765\u8bf4\uff0c<code>Execute</code>\u7684\u5b9e\u73b0\u53ef\u80fd\u4f1a\u53bb\u521b\u5efa\u4e00\u4e2aPVC\u7684<code>VolumeSnapshot</code>\u3002</p> <p>\u5907\u4efd\u3001\u6062\u590d\u7b49\u64cd\u4f5c\u7684\u5b9e\u73b0\u5927\u90e8\u5206\u662f\u5728velero\u5185\u90e8\u5b9e\u73b0\uff0c\u50cf\u5bf9\u8c61\u4ed3\u5e93\u548c\u5377\u5feb\u7167\u4e3b\u8981\u662f\u5916\u90e8\u7684\u63d2\u4ef6\u6765\u5b9e\u73b0\u3002</p> <p>\u5bf9\u8c61\u4ed3\u5e93\u7684\u63a5\u53e3\uff0c\u5728<code>pkg/plugin/velero/object_store.go</code>:</p> <pre><code>type ObjectStore interface {\n    Init(config map[string]string) error\n    PutObject(bucket, key string, body io.Reader) error\n    ObjectExists(bucket, key string) (bool, error)\n    GetObject(bucket, key string) (io.ReadCloser, error)\n    ListCommonPrefixes(bucket, prefix, delimiter string) ([]string, error)\n    ListObjects(bucket, prefix string) ([]string, error)\n    DeleteObject(bucket, key string) error\n    CreateSignedURL(bucket, key string, ttl time.Duration) (string, error)\n}\n</code></pre> <p>\u5377\u5feb\u7167\u63a5\u53e3\u5b9a\u4e49\u5728<code>pkg/plugin/velero/volume_snapshotter.go</code>\uff1a</p> <pre><code>type VolumeSnapshotter interface {\n    Init(config map[string]string) error\n    CreateVolumeFromSnapshot(snapshotID, volumeType, volumeAZ string, iops *int64) (volumeID string, err error)\n    GetVolumeID(pv runtime.Unstructured) (string, error)\n    SetVolumeID(pv runtime.Unstructured, volumeID string) (runtime.Unstructured, error)\n    GetVolumeInfo(volumeID, volumeAZ string) (string, *int64, error)\n    CreateSnapshot(volumeID, volumeAZ string, tags map[string]string) (snapshotID string, err error)\n    DeleteSnapshot(snapshotID string) error\n}\n</code></pre> <p><code>PluginLister</code>\u662f\u4e00\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684\u63d2\u4ef6\u7c7b\u578b\uff0c\u5b83\u7684\u4f5c\u7528\u5c31\u662f\u4e3a\u4e86\u80fd\u5f97\u5230\u5f53\u524dvelero\u670d\u52a1\u7aef\u652f\u6301\u7684\u6240\u6709\u63d2\u4ef6\u7684\u7c7b\u578b\u3002<code>PluginLister</code>\u7684\u5b9e\u73b0\u4e5f\u76f8\u5bf9\u6bd4\u8f83\u76f4\u63a5\uff0c\u670d\u52a1\u7aef\u7684\u5b9e\u73b0\u5c31\u662f\u628a\u5728\u63d2\u4ef6\u6846\u67b6\u7684<code>Server</code>\u4e2d\u6ce8\u518c\u7684\u6240\u6709\u7684\u4e8c\u7ea7\u63d2\u4ef6\u90fd\u5217\u51fa\u6765\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#53","title":"5.3 \u5185\u90e8\u63d2\u4ef6","text":"<p><code>pkg/cmd/server/plugin/plugin.go</code>\u53ef\u4ee5\u770b\u5230velero\u6ce8\u518c\u7684\u5185\u90e8\u63d2\u4ef6\u7c7b\u578b\uff1a</p> <pre><code>                RegisterBackupItemAction(\"velero.io/pv\", newPVBackupItemAction).\n                RegisterBackupItemAction(\"velero.io/pod\", newPodBackupItemAction).\n        ...\n        ...\n</code></pre> <p>\u8fd9\u91cc<code>newPVBackupItemAction</code>\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u7ed3\u6784\uff1a</p> <pre><code>func newPVBackupItemAction(logger logrus.FieldLogger) (interface{}, error) {\n    return backup.NewPVCAction(logger), nil\n}\n</code></pre> <p>\u8fd9\u4e2a\u7ed3\u6784\u5c31\u662f\u4e8c\u7ea7\u63d2\u4ef6\u64cd\u4f5c\u7684\u5177\u4f53\u5b9e\u73b0\u3002\u4f8b\u5982\uff0c\u8fd9\u91cc\u7684<code>NewPVCAction</code>\u7684\u5b9e\u73b0\u5728<code>pkg/backup/backup_pv_action.go</code>\uff0c\u8fd9\u91cc\u4f1a\u8fd4\u56de\u4e00\u4e2a<code>PVCAction</code>\u7684\u7ed3\u6784\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86<code>AppliesTo</code>\u548c<code>Execute</code>\u8fd9\u4e24\u4e2avelero\u5b9a\u4e49\u7684\u63a5\u53e3\u3002</p> <p>\u5176\u5b83\u7684\u5185\u90e8\u63d2\u4ef6\u5b9e\u73b0\u673a\u5236\u7c7b\u4f3c\uff0c\u672c\u6587\u5c31\u4e0d\u518d\u5c55\u5f00\u3002\u5177\u4f53\u7684\u5b9e\u73b0\u53ef\u4ee5\u53bb<code>pkg/backup/</code>\u548c<code>pkg/restore/</code>\u4e0b\u9762\u53c2\u8003\u5e26<code>_action.go</code>\u540e\u7f00\u7684\u6587\u4ef6\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#54","title":"5.4 \u5916\u90e8\u63d2\u4ef6","text":"<p>\u8fd9\u91cc\u7a0d\u5fae\u5206\u6790\u4e00\u4e0b\u6bd4\u8f83\u5e38\u89c1\u7684\u5916\u90e8\u63d2\u4ef6\uff1a</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#541-csi","title":"5.4.1 CSI\u63d2\u4ef6","text":"<p>\u9996\u5148\u770b<code>main.go</code>\uff0c\u6ce8\u518c\u7684\u63d2\u4ef6\u7c7b\u578b\u662f\u5907\u4efd\u548c\u6062\u590d\u7684\u64cd\u4f5c\uff0c\u800c\u6ca1\u6709\u6ce8\u518c<code>VolumeSnapshotter</code>\u7c7b\u578b\u7684\u63d2\u4ef6\uff1a</p> <pre><code>func main() {\n    veleroplugin.NewServer().\n        BindFlags(pflag.CommandLine).\n        RegisterBackupItemAction(\"velero.io/csi-pvc-backupper\", newPVCBackupItemAction).\n        RegisterBackupItemAction(\"velero.io/csi-volumesnapshot-backupper\", newVolumeSnapshotBackupItemAction).\n        RegisterBackupItemAction(\"velero.io/csi-volumesnapshotclass-backupper\", newVolumesnapshotClassBackupItemAction).\n        RegisterBackupItemAction(\"velero.io/csi-volumesnapshotcontent-backupper\", newVolumeSnapContentBackupItemAction).\n        RegisterRestoreItemAction(\"velero.io/csi-pvc-restorer\", newPVCRestoreItemAction).\n        RegisterRestoreItemAction(\"velero.io/csi-volumesnapshot-restorer\", newVolumeSnapshotRestoreItemAction).\n        RegisterRestoreItemAction(\"velero.io/csi-volumesnapshotclass-restorer\", newVolumeSnapshotClassRestoreItemAction).\n        RegisterRestoreItemAction(\"velero.io/csi-volumesnapshotcontent-restorer\", newVolumeSnapshotContentRestoreItemAction).\n        Serve()\n}\n</code></pre> <p>\u8fdb\u4e00\u6b65\u53bb\u770b<code>internal/backup/</code>\u6216\u8005<code>internal/restore/</code>\u7684\u5b9e\u73b0\uff0c\u53ef\u4ee5\u770b\u5230\u4e3b\u8981\u7684\u903b\u8f91\u4e5f\u6bd4\u8f83\u76f4\u63a5\u3002CSI\u63d2\u4ef6\u4e3b\u8981\u4f1a\u9488\u5bf9PVC\uff0cVolumeSnapshot\uff0cVolumeSnapshotClass\u548cVolumeSnapshotContent\u8fd9\u51e0\u4e2aCSI\u652f\u6301\u7684\u8d44\u6e90\u5b9e\u73b0<code>AppliesTo</code>\u548c<code>Execute</code>\u8fd9\u4e24\u4e2a\u63a5\u53e3\u3002\u5177\u4f53\u5b9e\u73b0\u4e86\u903b\u8f91\u8fd9\u91cc\u5c31\u4e0d\u5c55\u5f00 \uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u5df1\u53bb\u770bCSI\u63d2\u4ef6\u7684\u4ee3\u7801\uff0c\u89c1\u53c2\u80034\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#542-aws","title":"5.4.2 AWS\u63d2\u4ef6","text":"<p>AWS\u63d2\u4ef6\u4e4b\u6240\u4ee5\u6bd4\u8f83\u5e38\u7528\u662f\u56e0\u4e3a\u5927\u90e8\u5206\u7684\u5bf9\u8c61\u5b58\u50a8\u90fd\u5b9e\u73b0\u4e86AWS\u7684S3\u63a5\u53e3\uff0c\u56e0\u6b64\u5927\u90e8\u5206\u7684\u516c\u6709\u4e91\u5bf9\u8c61\u5b58\u50a8\u90fd\u53ef\u4ee5\u901a\u8fc7AWS\u63d2\u4ef6\u6765\u652f\u6301\u3002\u770b<code>main.go</code>\uff1a</p> <pre><code>func main() {\n    veleroplugin.NewServer().\n        BindFlags(pflag.CommandLine).\n        RegisterObjectStore(\"velero.io/aws\", newAwsObjectStore).\n        RegisterVolumeSnapshotter(\"velero.io/aws\", newAwsVolumeSnapshotter).\n        Serve()\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230AWS\u63d2\u4ef6\u5b9e\u73b0\u7684\u662f<code>ObjectStore</code>\u548c<code>VolumeSnapshotter</code>\u7684\u63a5\u53e3\u3002\u800c\u5b9e\u9645\u4e0a\u7531\u4e8eAWS\u7684S3\u63a5\u53e3\u7684\u5e7f\u6cdb\u6027\uff0c\u6211\u4eec\u5927\u90e8\u5206\u7528\u5230\u7684\u90fd\u662f<code>ObjectStore</code>\u7684\u63d2\u4ef6\u5b9e\u73b0\uff0c\u7528\u6765\u5bf9\u63a5\u4e0d\u540c\u7684\u5bf9\u8c61\u5b58\u50a8\u3002\u5177\u4f53\u7684\u903b\u8f91\u4e5f\u4e0d\u5c55\u5f00\uff0c\u8bfb\u8005\u53ef\u4ee5\u53bb\u53c2\u80035\u8fdb\u4e00\u6b65\u67e5\u9605AWS\u63d2\u4ef6\u7684\u4ee3\u7801\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_6","title":"\u516d \u670d\u52a1\u7aef\u521d\u59cb\u5316","text":"<p>\u63d2\u4ef6\u6846\u67b6\u5bf9\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u53ef\u4ee5\u53c2\u8003\u4e0a\u9762AWS\u63d2\u4ef6\u7684<code>main.go</code>\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u65b0\u7684<code>Server</code>\u521b\u5efa\u51fa\u6765\uff0c\u6ce8\u518c\u4e86\u4e00\u4e9b\u63d2\u4ef6\u4e4b\u540e\uff0c\u5c31\u662f\u8c03\u7528<code>Serve()</code>\u8fd9\u4e2a\u51fd\u6570\uff08<code>pkg/plugin/framework/server.go</code>\uff09\uff1a</p> <pre><code>    var pluginIdentifiers []PluginIdentifier\n    ...\n  ...\n\n    pluginLister := NewPluginLister(pluginIdentifiers...)\n\n    plugin.Serve(&amp;plugin.ServeConfig{\n        HandshakeConfig: Handshake(),\n        Plugins: map[string]plugin.Plugin{\n            string(PluginKindBackupItemAction):  s.backupItemAction,\n            string(PluginKindVolumeSnapshotter): s.volumeSnapshotter,\n            string(PluginKindObjectStore):       s.objectStore,\n            string(PluginKindPluginLister):      NewPluginListerPlugin(pluginLister),\n            string(PluginKindRestoreItemAction): s.restoreItemAction,\n            string(PluginKindDeleteItemAction):  s.deleteItemAction,\n        },\n        GRPCServer: plugin.DefaultGRPCServer,\n    })\n</code></pre> <p><code>Serve()</code>\u8fd9\u4e2a\u51fd\u6570\u5927\u81f4\u505a\u4e86\u51e0\u4ef6\u4e8b\u60c5\uff1a</p> <ol> <li>\u5bf9\u6240\u6709\u4e00\u7ea7\u63d2\u4ef6\u7c7b\u578b\u751f\u6210\u4e8c\u7ea7\u63d2\u4ef6ID\u5e76\u5168\u90e8\u4fdd\u5b58\u5230<code>pluginIdentifiers</code>\u6570\u7ec4\u4e2d</li> <li>\u521d\u59cb\u5316<code>go-plugin</code>\u7684<code>ServeConfig</code>\u5e76\u7528<code>Serve()</code>\u6765\u670d\u52a1</li> </ol> <p>\u7b2c\u4e8c\u6b65\u4e2d\uff0c<code>go-plugin</code>\u4f1a\u628a\u6240\u6709\u7684\u63d2\u4ef6\u90fd\u8c03\u7528\u4e00\u904d\u6bcf\u4e2a\u63d2\u4ef6\u5b9e\u73b0\u7684<code>GRPCServer()</code>\u63a5\u53e3\uff0c\u4ece\u800c\u628a\u6bcf\u4e2a\u4e00\u7ea7\u63d2\u4ef6\u7684\u670d\u52a1\u7aef\u5b9e\u73b0\u6ce8\u518c\u5230<code>go-plugin</code>\u4e2d\uff0c\u7136\u540e\u8fdb\u884c\u5178\u578b\u7684\u670d\u52a1\u7aef\u7684\u76d1\u542c\u4e0e\u670d\u52a1\u8fc7\u7a0b\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_7","title":"\u63d2\u4ef6\u5ba2\u6237\u7aef\u7ba1\u7406","text":"<p>\u63d2\u4ef6\u5ba2\u6237\u7aef\u7ba1\u7406\u7684\u4ee3\u7801\u5728<code>pkg/plugin/clientmgmt/</code>\u3002\u5ba2\u6237\u7aef\u7ba1\u7406\u90e8\u5206\u4e3b\u8981\u5b9a\u4e49\u4e86\u7ba1\u7406\u5ba2\u6237\u7aef\u76f8\u5173\u7684\u51e0\u4e2a\u6570\u636e\u7ed3\u6784\u548c\u65b9\u6cd5\uff0c\u628a\u4e8c\u7ea7\u63d2\u4ef6\u7684\u4f7f\u7528\u8ddf\u5907\u4efd\u6062\u590d\u7b49\u4e3b\u8981\u903b\u8f91\u5bf9\u63a5\u8d77\u6765\u3002\u4ee5\u4e0b\u662f\u63d2\u4ef6\u5ba2\u6237\u7aef\u7ba1\u7406\u7684\u6570\u636e\u7ed3\u6784\u5173\u7cfb\u56fe\uff1a</p> <p></p> <p>\u7531\u4e0a\u9762\u7684\u5173\u7cfb\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c<code>Manager</code>\u662f\u6838\u5fc3\u7684\u7ed3\u6784\uff0c\u5b83\u5305\u542b\u4e86<code>Registry</code>\u548c\u4e00\u4e2a<code>RestartableProcess</code>\u7684\u96c6\u5408\u3002<code>Register</code>\u7528\u6765\u7ba1\u7406\u63d2\u4ef6\u7684\u6ce8\u518c\u548c\u5206\u53d1\uff0c\u800c<code>RestartableProcess</code>\u5219\u628a\u4e8c\u7ea7\u63d2\u4ef6\u5c01\u88c5\u6210\u4e00\u4e2a\u7c7b\u4f3c\u8fdb\u7a0b\u7684\u7ed3\u6784\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u8fdb\u884c\u64cd\u63a7\uff0c\u5e76\u4e14\u5f97\u5230\u8be5\u63d2\u4ef6\u7684\u4fe1\u606f\u3002\u800c<code>Manager</code>\u672c\u8eab\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217<code>Get</code>\u65b9\u6cd5\u6765\u5f97\u5230\u63d2\u4ef6\u7684\u5ba2\u6237\u7aef\uff0c\u4ece\u800c\u65b9\u4fbf\u7684\u4f7f\u7528\u63d2\u4ef6\u7684\u670d\u52a1\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_8","title":"\u63d2\u4ef6\u6ce8\u518c","text":"<p><code>Registry</code>\uff08<code>pkg/plugin/clientmgmt/registry.go</code>\uff09\u5b9e\u73b0\u4e86\u63d2\u4ef6\u7684\u6ce8\u518c\uff0c\u4e3b\u8981\u7684\u65b9\u6cd5\u662f<code>DiscoverPlugins</code>\uff1a</p> <pre><code>func (r *registry) DiscoverPlugins() error {\n    plugins, err := r.readPluginsDir(r.dir)\n    if err != nil {\n        return err\n    }\n\n    // Start by adding velero's internal plugins\n    commands := []string{os.Args[0]}\n    // Then add the discovered plugin executables\n    commands = append(commands, plugins...)\n\n    return r.discoverPlugins(commands)\n}\n</code></pre> <p>\u8fd9\u91cc<code>commands</code>\u4f1a\u5305\u62ec<code>velero</code>\u81ea\u5df1\u8fd9\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u53e6\u5916\u4f1a\u5305\u62ecvelero\u7684pod\u91cc\u9762<code>/plugins</code>\u4e0b\u9762\u7684<code>velero-plugin-for-csi</code>\uff0c<code>velero-plugin-for-aws</code>\u7b49\u5916\u90e8\u7684\u63d2\u4ef6\u7a0b\u5e8f\u3002</p> <p><code>discoverPlugins</code>\u4f1a\u5bf9\u6bcf\u4e2a<code>command</code>\u5c01\u88c5\u4e00\u4e2a<code>Process</code>\uff0c\u7136\u540e\u901a\u8fc7<code>Process</code>\u7684\u63d2\u4ef6\u5206\u53d1\u5f97\u5230<code>PluginLister</code>\u8fd9\u4e2a\u63d2\u4ef6\uff0c\u5e76\u4e14\u6267\u884c<code>PluginLister</code>\u7684<code>ListPlugins()</code>\u63a5\u53e3\uff0c\u5c31\u5f97\u5230\u5168\u90e8\u7684\u63d2\u4ef6\u540d\u5b57\u4ee5\u53ca\u7c7b\u578b\u3002\u6700\u7ec8\u6240\u6709\u7684\u4e8c\u7ea7\u63d2\u4ef6\u4fe1\u606f\u4f1a\u88ab\u8bb0\u5f55\u5728<code>Registry</code>\u7684<code>pluginsByID</code>\u548c<code>pluginsByKind</code>\u8fd9\u4e24\u4e2amap\u4e2d\uff0c\u4f7f\u7528\u7684\u65f6\u5019\u53ea\u8981\u901a\u8fc7\u63d2\u4ef6\u7684\u540d\u5b57\u6765\u8bbf\u95ee\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_9","title":"\u63d2\u4ef6\u5206\u53d1","text":"<p>\u5f53\u4f7f\u7528\u63d2\u4ef6\u7684\u65f6\u5019\uff0c\u4f1a\u7528\u5230\u63d2\u4ef6\u5ba2\u6237\u7aef\u7684\u5206\u53d1\u529f\u80fd\u6765\u5f97\u5230\u5177\u4f53\u7684\u4e00\u4e2a\u63d2\u4ef6\u5ba2\u6237\u7aef\u7684\u5b9e\u4f8b\uff0c\u4ece\u800c\u4f7f\u7528\u63d2\u4ef6\u7684\u670d\u52a1\u3002\u63d2\u4ef6\u5ba2\u6237\u7aef\u7684\u5206\u53d1\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4e24\u6b65\uff1a</p> <ol> <li>\u901a\u8fc7<code>Manager</code>\u7684<code>Get</code>\u65b9\u6cd5\u5f97\u5230\u4e00\u4e2a\u63d2\u4ef6\u7684\u4ee3\u7406\u5b9e\u4f8b</li> </ol> <p><code>pkg/plugin/clientmgmt/</code>\u4e0b\u9762\u4e3a\u6bcf\u4e00\u4e2a\u63d2\u4ef6\u7c7b\u578b\u5b9e\u73b0\u4e86\u4e00\u4e2a\u4ee3\u7406\u7ed3\u6784\u3002\u4f8b\u5982<code>restartable_backup_item_action.go</code>\u5b9e\u73b0\u4e86<code>restartableBackupItemAction</code>\uff0c\u800c\u8fd9\u4e2a\u4ee3\u7406\u7ed3\u6784\u5b9e\u73b0\u4e86\u76f8\u540c\u7684<code>AppliesTo()</code>\u3001<code>Execute()</code>\u63a5\u53e3\u3002</p> <ol> <li>\u901a\u8fc7\u8fd9\u4e2a\u4ee3\u7406\u5b9e\u4f8b\u6765\u5f97\u5230\u5b9e\u9645\u7684\u5ba2\u6237\u7aef\u5b9e\u4f8b\uff0c\u7136\u540e\u7528\u5ba2\u6237\u7aef\u5b9e\u4f8b\u7684<code>AppliesTo</code>\u548c<code>Execute</code>\u63a5\u53e3\u6765\u4f7f\u7528\u63d2\u4ef6</li> </ol> <p>\u4f8b\u5982\uff0c<code>restartableBackupItemAction</code>\u4f1a\u4f7f\u7528<code>RestartableProcess</code>\u63d0\u4f9b\u7684\u65b9\u6cd5\u6765\u5f97\u5230\u5177\u4f53\u7684\u63d2\u4ef6\u5ba2\u6237\u7aef\u5b9e\u4f8b\uff0c\u4ece\u800c\u4f7f\u7528\u5ba2\u6237\u7aef\u7684<code>AppliesTo()</code>\u3001<code>Execute()</code>\u5b9e\u73b0\u3002</p> <p>\u4e0a\u9762\u76841.\u6bd4\u8f83\u76f4\u63a5\uff0c\u4f46\u662f2.\u7684\u5b9e\u73b0\u8fc7\u7a0b\u76f8\u5bf9\u6765\u8bf4\u6709\u4e00\u70b9\u590d\u6742\uff0c\u6d89\u53ca\u5230\u591a\u4e2a\u6a21\u5757\uff0c\u5305\u62ec<code>go-plugin</code>\u63d2\u4ef6\u5e93\u8fd9\u8fb9\u7684\u914d\u5408\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u4ee5<code>BackupItemAction</code>\u4e3a\u4f8b\u7684\u7b80\u5316\u7684\u65f6\u5e8f\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u63d2\u4ef6\u5206\u53d1\u7684\u8fc7\u7a0b\u4f1a\u901a\u8fc7<code>go-plugin</code>\u63d2\u4ef6\u5e93\u53bb\u8c03\u7528\u6bcf\u4e2a\u4e00\u7ea7\u63d2\u4ef6\u5b9e\u73b0\u7684<code>GRPCClient()</code>\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u4f1a\u8fd4\u56de\u4e00\u4e2a<code>clientDispenser</code>\u7684\u7ed3\u6784\uff0c\u5176\u4e2d\u8bb0\u5f55\u4e86\u8fd9\u4e2a\u63d2\u4ef6\u7684<code>GRPCClient</code>\u7684\u521d\u59cb\u5316\u65b9\u6cd5\uff0c\u4f8b\u5982<code>newBackupItemActionGRPCClient</code>\u3002\u8c03\u7528\u8fd9\u4e2a\u521d\u59cb\u5316\u65b9\u6cd5\u4f1a\u5f97\u5230\u4e00\u4e2a<code>BackupItemActionGRPCClient</code>\u7684\u5b9e\u4f8b\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u5b9e\u73b0\u4e86\u63d2\u4ef6\u5ba2\u6237\u7aef\u7684<code>AppliesTo</code>\u63a5\u53e3\uff0c\u63d2\u4ef6\u7684\u7528\u6237\u6700\u7ec8\u4f1a\u7528\u5230\u8fd9\u4e2a\u63a5\u53e3\u6765\u83b7\u5f97\u670d\u52a1\u7aef\u7684\u63d2\u4ef6\u64cd\u4f5c\u670d\u52a1\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%20%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90%E4%BA%8C/#_10","title":"\u603b\u7ed3","text":"<p>\u901a\u8fc7\u4e0a\u9762\u7684\u5206\u6790\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0cvelero\u5b9e\u73b0\u7684\u8fd9\u4e00\u5957\u63d2\u4ef6\u7cfb\u7edf\u7684\u786e\u53ef\u4ee5\u628a\u5f88\u591a\u8ddf\u6838\u5fc3\u5907\u4efd\u3001\u6062\u590d\u6d41\u7a0b\u4e0d\u76f8\u5173\u7684\u64cd\u4f5c\u89e3\u8026\uff0c\u653e\u5230\u5404\u4e2a\u63d2\u4ef6\u4e2d\u5b9e\u73b0\uff0c\u5e76\u4e14\u4e0d\u540c\u7684\u5382\u5546\u53ef\u4ee5\u6bd4\u8f83\u65b9\u4fbf\u7684\u5b9e\u73b0\u81ea\u5df1\u7684\u63d2\u4ef6\u652f\u6301\u3002\u5f53\u66f4\u591a\u7684\u5382\u5546\u8fdb\u6765\u652f\u6301velero\u7684\u63d2\u4ef6\u4e4b\u540e\uff0cvelero\u5c31\u53ef\u4ee5\u505a\u5230\u6ca1\u6709\u5382\u5546\u9501\u5b9a\uff0c\u800c\u4e14\u53ef\u4ee5\u5728\u66f4\u591a\u7684\u5e73\u53f0\u63d0\u4f9b\u5907\u4efd\u3001\u6062\u590d\u4ee5\u53ca\u8fc1\u79fb\u7684\u529f\u80fd\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0cvelero\u5b9e\u73b0\u4e86\u63d2\u4ef6\u4e0e\u6838\u5fc3\u903b\u8f91\u89e3\u8026\u7684\u76ee\u7684\uff0c\u8ba9\u63d2\u4ef6\u7684\u5b9e\u73b0\u65b9\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u662fvelero\u8ddf<code>go-plugin</code>\u7684\u96c6\u6210\u8fd8\u662f\u7565\u590d\u6742\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/","title":"Velero plugin system","text":""},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/#velero","title":"\u4e00 velero\u63d2\u4ef6","text":""},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/#_1","title":"\u4e8c \u63d2\u4ef6\u79cd\u7c7b","text":"<p>Velero \u76ee\u524d\u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u63d2\u4ef6: </p> <ul> <li>\u5bf9\u8c61\u5b58\u50a8-\u6301\u4e45\u5316\u5e76\u68c0\u7d22\u5907\u4efd\u3001\u5907\u4efd\u65e5\u5fd7\u6587\u4ef6\u3001\u8fd8\u539f\u8b66\u544a/\u9519\u8bef\u6587\u4ef6\u3001\u8fd8\u539f\u65e5\u5fd7\u3002</li> <li>\u5377 Snapshotter \u2014\u2014\u4ece\u5377(\u5907\u4efd\u671f\u95f4)\u548c\u5377(\u6062\u590d\u671f\u95f4)\u521b\u5efa\u5feb\u7167\u3002</li> <li>\u5907\u4efd\u9879\u76ee\u64cd\u4f5c-\u5728\u5c06\u5355\u4e2a\u9879\u76ee\u5b58\u50a8\u5230\u5907\u4efd\u6587\u4ef6\u4e4b\u524d\uff0c\u5bf9\u5b83\u4eec\u6267\u884c\u4efb\u610f\u903b\u8f91\u3002</li> <li>\u6062\u590d\u9879\u76ee\u64cd\u4f5c\u2014\u2014\u5728\u5e93\u4f2f\u5185\u7279\u96c6\u7fa4\u4e2d\u6062\u590d\u5355\u4e2a\u9879\u76ee\u4e4b\u524d\uff0c\u5bf9\u5b83\u4eec\u6267\u884c\u4efb\u610f\u903b\u8f91\u3002</li> </ul> <p>Velero \u53ef\u4ee5\u5728\u4e00\u4e2a\u5355\u4e00\u7684\u3001\u53ef\u6062\u590d\u7684\u8fc7\u7a0b\u4e2d\u6258\u7ba1\u591a\u4e2a\u63d2\u4ef6\u3002\u63d2\u4ef6\u53ef\u4ee5\u662f\u4efb\u4f55\u652f\u6301\u7684\u7c7b\u578b\u3002\u53bb\u627emain.go\uff0c\u53bb\u5427\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/#_2","title":"\u4e09 \u6e90\u7801\u7814\u8bfb","text":""},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/#_3","title":"\u56db \u6784\u5efa\u63d2\u4ef6","text":"<ul> <li>\u6784\u5efa\u63d2\u4ef6</li> </ul> <pre><code>$ make\n</code></pre> <ul> <li>\u6784\u5efa\u4e00\u4e2a\u955c\u50cf</li> </ul> <pre><code>$ make container\n</code></pre> <ul> <li>\u6784\u5efa\u51fa\u6765\u9ed8\u8ba4\u7684\u540d\u79f0\u4e3a\uff1a <code>velero/velero-plugin-example:master</code>\uff0c\u5982\u679c\u60f3\u81ea\u5b9a\u4e49\u8fd0\u884c\u4e0b\u9762\u547d\u4ee4</li> </ul> <pre><code>$ IMAGE=your-repo/your-name VERSION=your-version-tag make container \n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/#_4","title":"\u4e94 \u90e8\u7f72\u63d2\u4ef6","text":"<p>\u8981\u5c06\u63d2\u4ef6\u6620\u50cf\u90e8\u7f72\u5230 Velero \u670d\u52a1\u5668</p> <ul> <li>\u5c06\u955c\u50cf\u62c9\u53d6\u5230\u90e8\u7f72\u96c6\u7fa4node\u8282\u70b9\u4e0a\u3002</li> <li>\u8fd0\u884c<code>velero plugin add &lt;registry/image:version&gt;</code></li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/#_5","title":"\u516d \u4f7f\u7528\u63d2\u4ef6","text":"<p>\u5f53\u63d2\u4ef6\u88ab\u90e8\u7f72\u65f6\uff0c\u5b83\u53ea\u80fd\u88ab\u4f7f\u7528\u3002\u4e3a\u4e86\u4f7f\u63d2\u4ef6\u6709\u6548\uff0c\u4f60\u5fc5\u987b\u4fee\u6539\u4f60\u7684\u914d\u7f6e:</p>"},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/#61","title":"6.1 \u5907\u4efd\u5b58\u50a8","text":"<ol> <li> <p>\u8fd0\u884c<code>kubectl edit backupstoragelocation &lt;location-name&gt; -n &lt;velero-namespace&gt;</code>,\u4f8b\u5982\u8fd0\u884c\uff1a<code>kubectl edit backupstoragelocation default -n velero</code>\u6216\u8005<code>velero backup-location create &lt;location-name&gt; --provider &lt;provider-name&gt;</code></p> </li> <li> <p>\u66f4\u6539 spec.provider \u7684\u503c\u4ee5\u542f\u7528\u5bf9\u8c61\u5b58\u50a8\u63d2\u4ef6\u3002</p> </li> <li>\u4fdd\u5b58\u9000\u51fa\uff0c\u63d2\u4ef6\u5c06\u5728\u4e0b\u6b21\u5907\u4efd\u6062\u590d\u4e2d\u4f7f\u7528\u3002</li> </ol>"},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/#62","title":"6.2 \u5377\u5feb\u7167\u5b58\u50a8","text":"<ol> <li> <p>\u8fd0\u884c<code>kubectl edit volumesnapshotlocation &lt;location-name&gt; -n &lt;velero-namespace&gt;</code>,\u4f8b\u5982\u8fd0\u884c\uff1a<code>kubectl edit volumesnapshotlocation default -n velero</code>\u6216\u8005<code>velero snapshot-location create &lt;location-name&gt; --provider &lt;provider-name&gt;</code></p> </li> <li> <p>\u66f4\u6539 spec.provider \u7684\u503c\u4ee5\u542f\u7528\u5377\u5feb\u7167\u63d2\u4ef6\u3002</p> </li> <li>\u4fdd\u5b58\u9000\u51fa\uff0c\u63d2\u4ef6\u5c06\u5728\u4e0b\u6b21\u5907\u4efd\u6062\u590d\u4e2d\u4f7f\u7528\u3002</li> </ol>"},{"location":"cloud-native/operator/tools/velero/velero-plugin-system/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://velero.io/docs/main/overview-plugins/</li> <li>https://github.com/vmware-tanzu/velero-plugin-example/tree/main</li> <li>https://github.com/vmware-tanzu/velero-plugin-for-csi</li> <li>https://github.com/AliyunContainerService/velero-plugin</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/","title":"velero\u5165\u95e8","text":""},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#_1","title":"\u4e00 \u6982\u8ff0","text":"<p>Velero\uff08\u4ee5\u524d\u79f0\u4e3a Heptio Ark\uff09\u4e3a\u60a8\u63d0\u4f9b\u4e86\u7528\u4e8e\u5907\u4efd\u548c\u6062\u590d Kubernetes \u96c6\u7fa4\u8d44\u6e90\u548c\u6301\u4e45\u5377\u7684\u5de5\u5177\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e91\u63d0\u4f9b\u5546\u6216\u672c\u5730\u8fd0\u884c Velero\u3002 Velero \u8ba9\u60a8\uff1a</p> <ul> <li>\u5907\u4efd\u60a8\u7684\u96c6\u7fa4\u5e76\u5728\u4e22\u5931\u65f6\u6062\u590d\u3002</li> <li>\u5c06\u96c6\u7fa4\u8d44\u6e90\u8fc1\u79fb\u5230\u5176\u4ed6\u96c6\u7fa4\u3002</li> <li>\u5c06\u60a8\u7684\u751f\u4ea7\u96c6\u7fa4\u590d\u5236\u5230\u5f00\u53d1\u548c\u6d4b\u8bd5\u96c6\u7fa4\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#velero_1","title":"\u4e8c velero\u7ec4\u6210","text":"<ul> <li>\u5728\u96c6\u7fa4\u4e0a\u8fd0\u884c\u7684\u670d\u52a1\u5668</li> <li>\u672c\u5730\u8fd0\u884c\u7684\u547d\u4ee4\u884c\u5ba2\u6237\u7aef</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#velero_2","title":"\u4e09 velero\u5de5\u4f5c\u539f\u7406","text":"<p>\u6bcf\u4e2a Velero \u64cd\u4f5c\u2014\u2014\u6309\u9700\u5907\u4efd\u3001\u8ba1\u5212\u5907\u4efd\u3001\u8fd8\u539f\u2014\u2014\u90fd\u662f\u4e00\u4e2a\u5b9a\u5236\u8d44\u6e90\uff0c\u4f7f\u7528 Kubernetes \u5b9a\u5236\u8d44\u6e90\u5b9a\u4e49(CRD)\u5b9a\u4e49\uff0c\u5e76\u5b58\u50a8\u5728 etcd \u4e2d\u3002Velero \u8fd8\u5305\u62ec\u5904\u7406\u81ea\u5b9a\u4e49\u8d44\u6e90\u4ee5\u6267\u884c\u5907\u4efd\u3001\u6062\u590d\u548c\u6240\u6709\u76f8\u5173\u64cd\u4f5c\u7684\u63a7\u5236\u5668\u3002\u60a8\u53ef\u4ee5\u5907\u4efd\u6216\u8fd8\u539f\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u5bf9\u8c61\uff0c\u6216\u8005\u53ef\u4ee5\u6309\u7c7b\u578b\u3001\u547d\u540d\u7a7a\u95f4\u548c/\u6216\u6807\u7b7e\u7b5b\u9009\u5bf9\u8c61\u3002Velero \u662f\u707e\u96be\u6062\u590d\u7528\u4f8b\u7684\u7406\u60f3\u9009\u62e9\uff0c\u4e5f\u9002\u7528\u4e8e\u5728\u96c6\u7fa4\u4e0a\u6267\u884c\u7cfb\u7edf\u64cd\u4f5c(\u6bd4\u5982\u5347\u7ea7)\u4e4b\u524d\u5bf9\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u8fdb\u884c\u5feb\u7167\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#31","title":"3.1 \u6309\u9700\u5907\u4efd","text":"<ul> <li>\u5c06\u590d\u5236\u7684 Kubernetes \u5bf9\u8c61\u7684 tarball \u4e0a\u4f20\u5230\u4e91\u5bf9\u8c61\u5b58\u50a8\u4e2d\u3002</li> <li>\u60a8\u53ef\u4ee5\u9009\u62e9\u6307\u5b9a\u8981\u5728\u5907\u4efd\u671f\u95f4\u6267\u884c\u7684\u5907\u4efd\u6302\u94a9\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u544a\u8bc9\u6570\u636e\u5e93\u5728\u62cd\u6444\u5feb\u7167\u4e4b\u524d\u5c06\u5176\u5185\u5b58\u7f13\u51b2\u533a\u5237\u65b0\u5230\u78c1\u76d8\u3002\u66f4\u591a\u5173\u4e8e\u5907\u7528\u94a9\u5b50\u3002</li> </ul> <p>\u60a8\u53ef\u4ee5\u9009\u62e9\u6307\u5b9a\u8981\u5728\u5907\u4efd\u671f\u95f4\u6267\u884c\u7684\u5907\u4efd\u6302\u94a9\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u544a\u8bc9\u6570\u636e\u5e93\u5728\u62cd\u6444\u5feb\u7167\u4e4b\u524d\u5c06\u5176\u5185\u5b58\u7f13\u51b2\u533a\u5237\u65b0\u5230\u78c1\u76d8\u3002\u66f4\u591a\u5173\u4e8e\u5907\u7528\u94a9\u5b50\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u96c6\u7fa4\u5907\u4efd\u5e76\u975e\u4e25\u683c\u539f\u5b50\u6027\u7684\u3002\u5982\u679c\u5728\u5907\u4efd\u65f6\u6b63\u5728\u521b\u5efa\u6216\u7f16\u8f91 Kubernetes \u5bf9\u8c61\uff0c\u5219\u5b83\u4eec\u53ef\u80fd\u4e0d\u4f1a\u5305\u542b\u5728\u5907\u4efd\u4e2d\u3002\u6355\u83b7\u4e0d\u4e00\u81f4\u4fe1\u606f\u7684\u51e0\u7387\u5f88\u4f4e\uff0c\u4f46\u6709\u53ef\u80fd\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#32","title":"3.2 \u8ba1\u5212\u5907\u4efd","text":"<p>\u8ba1\u5212\u64cd\u4f5c\u5141\u8bb8\u60a8\u5b9a\u671f\u5907\u4efd\u6570\u636e\u3002\u7b2c\u4e00\u6b21\u5907\u4efd\u5728\u7b2c\u4e00\u6b21\u521b\u5efa\u8ba1\u5212\u65f6\u6267\u884c\uff0c\u540e\u7eed\u5907\u4efd\u6309\u8ba1\u5212\u7684\u6307\u5b9a\u65f6\u95f4\u95f4\u9694\u8fdb\u884c\u3002\u8fd9\u4e9b\u95f4\u9694\u7531 Cron \u8868\u8fbe\u5f0f\u6307\u5b9a\u3002</p> <p>\u8ba1\u5212\u5907\u4efd\u4ee5\u540d\u79f0 - \u4fdd\u5b58\uff0c\u5176\u4e2d  \u7684\u683c\u5f0f\u4e3a YYYYMMDDhhmmss\u3002"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#33","title":"3.3 \u6062\u590d","text":"<p>\u6062\u590d\u64cd\u4f5c\u5141\u8bb8\u60a8\u4ece\u5148\u524d\u521b\u5efa\u7684\u5907\u4efd\u4e2d\u6062\u590d\u6240\u6709\u5bf9\u8c61\u548c\u6301\u4e45\u5377\u3002\u60a8\u8fd8\u53ef\u4ee5\u4ec5\u6062\u590d\u5bf9\u8c61\u548c\u6301\u4e45\u5377\u7684\u7b5b\u9009\u5b50\u96c6\u3002 Velero \u652f\u6301\u591a\u4e2a\u547d\u540d\u7a7a\u95f4\u91cd\u6620\u5c04\u2014\u2014\u4f8b\u5982\uff0c\u5728\u5355\u4e2a\u8fd8\u539f\u4e2d\uff0c\u547d\u540d\u7a7a\u95f4\u201cabc\u201d\u4e2d\u7684\u5bf9\u8c61\u53ef\u4ee5\u5728\u547d\u540d\u7a7a\u95f4\u201cdef\u201d\u4e0b\u91cd\u65b0\u521b\u5efa\uff0c\u547d\u540d\u7a7a\u95f4\u201c123\u201d\u4e2d\u7684\u5bf9\u8c61\u53ef\u4ee5\u5728\u201c456\u201d\u4e0b\u91cd\u65b0\u521b\u5efa\u3002</p> <p>\u8fd8\u539f\u7684\u9ed8\u8ba4\u540d\u79f0\u4e3a -\uff0c\u5176\u4e2d  \u7684\u683c\u5f0f\u4e3a YYYYMMDDhhmmss\u3002\u60a8\u8fd8\u53ef\u4ee5\u6307\u5b9a\u81ea\u5b9a\u4e49\u540d\u79f0\u3002\u6062\u590d\u7684\u5bf9\u8c61\u8fd8\u5305\u62ec\u4e00\u4e2a\u5e26\u6709\u952e velero.io/restore-name \u548c\u503c  \u7684\u6807\u7b7e\u3002 <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u4ee5\u8bfb\u5199\u6a21\u5f0f\u521b\u5efa\u3002\u4f46\u662f\uff0c\u5728\u8fd8\u539f\u671f\u95f4\uff0c\u60a8\u53ef\u4ee5\u5c06\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u914d\u7f6e\u4e3a\u53ea\u8bfb\u6a21\u5f0f\uff0c\u8fd9\u5c06\u7981\u7528\u8be5\u5b58\u50a8\u4f4d\u7f6e\u7684\u5907\u4efd\u521b\u5efa\u548c\u5220\u9664\u3002\u8fd9\u6709\u52a9\u4e8e\u786e\u4fdd\u5728\u8fd8\u539f\u65b9\u6848\u671f\u95f4\u4e0d\u4f1a\u65e0\u610f\u4e2d\u521b\u5efa\u6216\u5220\u9664\u5907\u4efd\u3002</p> <p>\u60a8\u53ef\u4ee5\u9009\u62e9\u6307\u5b9a\u8981\u5728\u8fd8\u539f\u671f\u95f4\u6216\u8d44\u6e90\u8fd8\u539f\u540e\u6267\u884c\u7684\u8fd8\u539f\u6302\u94a9\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u5728\u6570\u636e\u5e93\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u6267\u884c\u81ea\u5b9a\u4e49\u6570\u636e\u5e93\u8fd8\u539f\u64cd\u4f5c\u3002\u66f4\u591a\u5173\u4e8e\u6062\u590d\u94a9\u5b50\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#34","title":"3.4 \u5907\u4efd\u5de5\u4f5c\u6d41","text":"<ul> <li>Velero \u5ba2\u6237\u7aef\u8c03\u7528 Kubernetes API \u670d\u52a1\u5668\u4ee5\u521b\u5efa\u5907\u4efd\u5bf9\u8c61\u3002</li> <li>BackupController \u6ce8\u610f\u5230\u65b0\u7684 Backup \u5bf9\u8c61\u5e76\u6267\u884c\u9a8c\u8bc1\u3002</li> <li>BackupController \u5f00\u59cb\u5907\u4efd\u8fc7\u7a0b\u3002\u5b83\u901a\u8fc7\u5411 API \u670d\u52a1\u5668\u67e5\u8be2\u8d44\u6e90\u6765\u6536\u96c6\u8981\u5907\u4efd\u7684\u6570\u636e\u3002</li> <li>BackupController \u8c03\u7528\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\uff08\u4f8b\u5982 AWS S3\uff09\u6765\u4e0a\u4f20\u5907\u4efd\u6587\u4ef6\u3002</li> </ul> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cvelero backup create \u4e3a\u4efb\u4f55\u6301\u4e45\u5377\u5236\u4f5c\u78c1\u76d8\u5feb\u7167\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u9644\u52a0\u6807\u5fd7\u6765\u8c03\u6574\u5feb\u7167\u3002\u8fd0\u884c velero backup create --help \u4ee5\u67e5\u770b\u53ef\u7528\u6807\u5fd7\u3002\u53ef\u4ee5\u4f7f\u7528\u9009\u9879 --snapshot-volumes=false \u7981\u7528\u5feb\u7167\u3002</p> <p></p>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#35-api","title":"3.5 \u5907\u4efd\u7684 API \u7248\u672c","text":"<p>Velero \u4f7f\u7528 Kubernetes API \u670d\u52a1\u5668\u7684\u9996\u9009\u7248\u672c\u4e3a\u6bcf\u4e2a\u7ec4/\u8d44\u6e90\u5907\u4efd\u8d44\u6e90\u3002\u6062\u590d\u8d44\u6e90\u65f6\uff0c\u76ee\u6807\u96c6\u7fa4\u4e2d\u5fc5\u987b\u5b58\u5728\u76f8\u540c\u7684 API \u7ec4/\u7248\u672c\u624d\u80fd\u6210\u529f\u6062\u590d\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u5907\u4efd\u7684\u96c6\u7fa4\u5728 things API \u7ec4\u4e2d\u6709\u4e00\u4e2a gizmos \u8d44\u6e90\uff0c\u5177\u6709 group/versions things/v1alpha1\u3001 things/v1beta1\u548c things/v1\uff0c\u800c\u670d\u52a1\u5668\u7684\u9996\u9009\u7ec4/\u7248\u672c\u662f things/v1\uff0c\u90a3\u4e48\u6240\u6709 gizmos \u90fd\u5c06\u4ece things/v1 API \u7aef\u70b9\u5907\u4efd\u3002\u5f53\u8fd8\u539f\u8fd9\u4e2a\u96c6\u7fa4\u7684\u5907\u4efd\u65f6\uff0c\u76ee\u6807\u96c6\u7fa4\u5fc5\u987b\u5177\u6709 things/v1\u7aef\u70b9\uff0c\u4ee5\u4fbf\u8fd8\u539f gizmos\u3002\u8bf7\u6ce8\u610f\uff0cthings/v1\u4e0d\u9700\u8981\u6210\u4e3a\u76ee\u6807\u96c6\u7fa4\u4e2d\u7684\u9996\u9009\u7248\u672c; \u5b83\u53ea\u9700\u8981\u5b58\u5728\u5373\u53ef\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#36","title":"3.6 \u8bbe\u7f6e\u5907\u4efd\u5230\u671f","text":"<p>\u5728\u521b\u5efa\u5907\u4efd\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u6807\u5fd7 -- TTL &lt; duration &gt; \u6765\u6307\u5b9a TTL (\u751f\u5b58\u65f6\u95f4)\u3002\u5982\u679c Velero \u53d1\u73b0\u73b0\u6709\u7684\u5907\u4efd\u8d44\u6e90\u5df2\u7ecf\u8fc7\u671f\uff0c\u5b83\u4f1a\u5220\u9664:</p> <ul> <li>\u5907\u4efd\u8d44\u6e90</li> <li>\u81ea\u4e91\u5bf9\u8c61\u5b58\u50a8\u7684\u5907\u4efd\u6587\u4ef6</li> <li>\u6240\u6709 PersistentVolume \u5feb\u7167</li> <li>\u6240\u6709\u76f8\u5173\u7684\u6062\u590d</li> </ul> <p>TTL \u6807\u5fd7\u5141\u8bb8\u7528\u6237\u5728\u8868\u5355 -- TTL 24h0m0s \u4e2d\u6307\u5b9a\u4ee5\u5c0f\u65f6\u3001\u5206\u949f\u548c\u79d2\u4e3a\u5355\u4f4d\u7684\u503c\u6765\u6307\u5b9a\u5907\u4efd\u4fdd\u6301\u671f\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u5e94\u7528\u9ed8\u8ba4 TTL \u503c\u4e3a30\u5929\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#37","title":"3.7 \u5bf9\u8c61\u5b58\u50a8\u540c\u6b65","text":"<p>\u628a\u5bf9\u8c61\u7684\u5b58\u50a8\u89c6\u4e3a\u771f\u7406\u7684\u6e90\u6cc9\u3002\u5b83\u4e0d\u65ad\u5730\u68c0\u67e5\u662f\u5426\u59cb\u7ec8\u5b58\u5728\u6b63\u786e\u7684\u5907\u4efd\u8d44\u6e90\u3002\u5982\u679c\u5b58\u50a8\u6876\u4e2d\u6709\u4e00\u4e2a\u683c\u5f0f\u6b63\u786e\u7684\u5907\u4efd\u6587\u4ef6\uff0c\u4f46\u662f\u5728 Kubernetes API \u4e2d\u6ca1\u6709\u76f8\u5e94\u7684\u5907\u4efd\u8d44\u6e90\uff0cVelero \u4f1a\u540c\u6b65\u4ece\u5bf9\u8c61\u5b58\u50a8\u5230 Kubernetes \u7684\u4fe1\u606f\u3002</p> <p>\u8fd9\u5141\u8bb8\u8fd8\u539f\u529f\u80fd\u5728\u96c6\u7fa4\u8fc1\u79fb\u573a\u666f\u4e2d\u5de5\u4f5c\uff0c\u5728\u8fd9\u79cd\u573a\u666f\u4e2d\uff0c\u539f\u59cb\u5907\u4efd\u5bf9\u8c61\u5728\u65b0\u96c6\u7fa4\u4e2d\u4e0d\u5b58\u5728\u3002</p> <p>\u540c\u6837\uff0c\u5982\u679c\u5907\u4efd\u5bf9\u8c61\u5b58\u5728\u4e8e Kubernetes \u4f46\u4e0d\u5728\u5bf9\u8c61\u5b58\u50a8\u4e2d\uff0c\u90a3\u4e48\u5b83\u5c06\u4ece Kubernetes \u5220\u9664\uff0c\u56e0\u4e3a\u5907\u4efd tarball \u4e0d\u518d\u5b58\u5728\u3002</p>"},{"location":"cloud-native/operator/tools/velero/velero%E5%85%A5%E9%97%A8/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://velero.io/docs/v1.6/</li> <li>https://github.com/vmware-tanzu/velero-plugin-for-aws</li> </ul>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"Velero\u6e90\u7801\u5206\u6790","text":""},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#velero","title":"Velero \u63a7\u5236\u5668\u6d41\u7a0b","text":""},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_1","title":"\u4e00 \u63a7\u5236\u5668\u901a\u7528","text":"<p>\u5728 velero \u6240\u6709\u7684\u4e1a\u52a1\u903b\u8f91\u63a7\u5236\u5668\u4e2d\u90fd\u5305\u542b\u901a\u7528\u63a7\u5236\u5668</p> <pre><code>// velero/pkg/controller/generic_controller.go\n\n\n// \u901a\u7528\u63a7\u5236\u5668\ntype genericController struct {\n    name             string                                                     //\u901a\u7528\u63a7\u5236\u5668\u540d\u79f0\n    queue            workqueue.RateLimitingInterface    // \u9650\u901f\u961f\u5217\n    logger           logrus.FieldLogger                             // \u65e5\u5fd7\n    syncHandler      func(key string) error                     // \u540c\u6b65\u51fd\u6570\n    resyncFunc       func()                                                     // \u91cd\u65b0\u540c\u6b65\u65b9\u6cd5\n    resyncPeriod     time.Duration                                      // \u91cd\u65b0\u540c\u6b65\u5468\u671f\n    cacheSyncWaiters []cache.InformerSynced                     // cacheSync\n}\n\n// \n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#11-run","title":"1.1 Run\u65b9\u6cd5","text":"<p>\u5728\u63a7\u5236\u5668\u4e2d\u5b9a\u4e49\u6709\u63a7\u5236\u5668\u5b9e\u73b0\u7684\u63a5\u53e3</p> <pre><code>// velero/pkg/controller/interface.go \n\n// \u4ee3\u8868\u4e00\u4e2a\u53ef\u8fd0\u884c\u7684\u7ec4\u5efa\ntype Interface interface {\n    // Run runs the component.\n    Run(ctx context.Context, workers int) error\n}\n</code></pre> <p>\u901a\u7528\u63a5\u53e3\u5177\u4f53 Run \u65b9\u6cd5\u5b9e\u73b0</p> <pre><code>// velero/pkg/controller/generic_controller.go\n\nfunc (c *genericController) Run(ctx context.Context, numWorkers int) error {\n  // \u5fc5\u987b\u63d0\u4f9bsyncHandler\u548cresyncFunc\n    if c.syncHandler == nil &amp;&amp; c.resyncFunc == nil {\n        // programmer error\n        panic(\"at least one of syncHandler or resyncFunc is required\")\n    }\n\n    var wg sync.WaitGroup\n    // \u6700\u540e\u5904\u7406\n    defer func() {\n        c.logger.Info(\"Waiting for workers to finish their work\")\n        // \u5173\u95ed\u961f\u5217\n        c.queue.ShutDown()\n\n        // We have to wait here in the deferred function instead of at the bottom of the function body\n        // because we have to shut down the queue in order for the workers to shut down gracefully, and\n        // we want to shut down the queue via defer and not at the end of the body.\n    // \u7b49\u5f85\u6240\u6709\u7684 worker waitgroup\u5b8c\u6210\n        wg.Wait()\n\n        c.logger.Info(\"All workers have finished\")\n\n    }()\n\n    c.logger.Info(\"Starting controller\")\n    defer c.logger.Info(\"Shutting down controller\")\n\n    // only want to log about cache sync waiters if there are any\n  // \u5982\u679c\u5b58\u5728\u7f13\u5b58syncwaiter\uff0c\u7b49\u5f85informer sync\u5b8c\u6210\n    if len(c.cacheSyncWaiters) &gt; 0 {\n        c.logger.Info(\"Waiting for caches to sync\")\n    // \u7b49\u5f85sync \u5b8c\u6210\n        if !cache.WaitForCacheSync(ctx.Done(), c.cacheSyncWaiters...) {\n            return errors.New(\"timed out waiting for caches to sync\")\n        }\n        c.logger.Info(\"Caches are synced\")\n    }\n    // \u5f00\u59cb\u6267\u884csyncHandler\n    if c.syncHandler != nil {\n        wg.Add(numWorkers)\n        for i := 0; i &lt; numWorkers; i++ {\n            go func() {\n        // \u8fd0\u884crunWorker\n                wait.Until(c.runWorker, time.Second, ctx.Done())\n                wg.Done()\n            }()\n        }\n    }\n\n  // \u5199\u6210\u8fd0\u884cresync\n    if c.resyncFunc != nil {\n        if c.resyncPeriod == 0 {\n            // Programmer error\n            panic(\"non-zero resyncPeriod is required\")\n        }\n\n        wg.Add(1)\n        go func() {\n\n            wait.Until(c.resyncFunc, c.resyncPeriod, ctx.Done())\n            wg.Done()\n        }()\n    }\n\n    &lt;-ctx.Done()\n\n    return nil\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#12-runworker","title":"1.2 runWorker","text":"<p>runWorker \u65b9\u6cd5\u5c31\u662f\u4e0d\u65ad\u8fd0\u884c processNextWorkItem\u3002</p> <pre><code>func (c *genericController) runWorker() {\n    // continually take items off the queue (waits if it's\n    // empty) until we get a shutdown signal from the queue\n    for c.processNextWorkItem() {\n    }\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#13-processnextworkitem","title":"1.3 processNextWorkItem","text":"<p>processNextWorkItem \u65b9\u6cd5\uff0c\u4e2d\u4e3b\u8981\u662f\u4ece\u9650\u901f\u961f\u5217\u83b7\u53d6\u5143\u7d20\uff0c\u5e76\u8c03\u7528\u7528\u6237\u5b9e\u73b0\u7684 syncHandler \u4e1a\u52a1\u903b\u8f91\u65b9\u6cd5\u5bf9\u5143\u7d20\u8fdb\u884c\u5904\u7406\uff0c\u5982\u679c\u5904\u7406\u9519\u8bef\u5219\u518d\u6b21\u5ef6\u8fdf\u6dfb\u52a0\u81f3\u961f\u5217\uff0c\u7b49\u5f85\u4e0b\u4e00\u6b21\u5904\u7406\u3002</p> <pre><code>func (c *genericController) processNextWorkItem() bool {\n  // \u4eceworkqueue\u83b7\u53d6\u5143\u7d20\n    key, quit := c.queue.Get()\n  // \u5982\u679cshutdown\uff0c\u5219\u76f4\u63a5\u8fd4\u56defalse\n    if quit {\n        return false\n    }\n\n  // \u6700\u540e\u6807\u8bb0\u6539\u5143\u7d20\u4ee5\u53ca\u5904\u7406\u5b8c\u6210\n    defer c.queue.Done(key)\n    // \u901a\u8fc7syncHandler \u5904\u7406\u5177\u4f53\u4e1a\u52a1\u903b\u8f91\n    err := c.syncHandler(key.(string))\n    if err == nil {\n        // \u6807\u8bb0\u6539\u5143\u7d20\u5904\u7406\u5b8c\u6210\n        c.queue.Forget(key)\n        return true\n    }\n\n    c.logger.WithError(err).WithField(\"key\", key).Error(\"Error in syncHandler, re-adding item to queue\")\n    // \u518d\u6b21\u5ef6\u8fdf\u6dfb\u52a0\u81f3\u961f\u5217\u4e2d\n    c.queue.AddRateLimited(key)\n\n    return true\n}\n\n// \u5229\u7528MetaNamespaceKeyFunc \u83b7\u53d6\u5143\u7d20namespace/resourcename \u6dfb\u52a0\u8fdb\u961f\u5217\nfunc (c *genericController) enqueue(obj interface{}) {\n    key, err := cache.MetaNamespaceKeyFunc(obj)\n    if err != nil {\n        c.logger.WithError(errors.WithStack(err)).\n            Error(\"Error creating queue key, item not added to queue\")\n        return\n    }\n\n    c.queue.Add(key)\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#backup_controller","title":"\u4e8c backup_controller","text":"<p>backupController \u5177\u6709\u4ee5\u4e0b\u65b9\u6cd5</p> <p></p>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#21","title":"2.1 \u521d\u59cb\u5316","text":"<pre><code>// velero/pkg/controller/backup_controller.go \n\n//\ntype backupController struct {\n    *genericController\n    discoveryHelper             discovery.Helper\n    backupper                   pkgbackup.Backupper\n    lister                      velerov1listers.BackupLister\n    client                      velerov1client.BackupsGetter\n    kbClient                    kbclient.Client\n    clock                       clock.Clock\n    backupLogLevel              logrus.Level\n    newPluginManager            func(logrus.FieldLogger) clientmgmt.Manager\n    backupTracker               BackupTracker\n    defaultBackupLocation       string\n    defaultVolumesToRestic      bool\n    defaultBackupTTL            time.Duration\n    snapshotLocationLister      velerov1listers.VolumeSnapshotLocationLister\n    defaultSnapshotLocations    map[string]string\n    metrics                     *metrics.ServerMetrics\n    backupStoreGetter           persistence.ObjectBackupStoreGetter\n    formatFlag                  logging.Format\n    volumeSnapshotLister        snapshotv1beta1listers.VolumeSnapshotLister\n    volumeSnapshotContentLister snapshotv1beta1listers.VolumeSnapshotContentLister\n}\n\n// backupController \u6784\u9020\u65b9\u6cd5\nfunc NewBackupController(\n    backupInformer velerov1informers.BackupInformer,\n    client velerov1client.BackupsGetter,\n    discoveryHelper discovery.Helper,\n    backupper pkgbackup.Backupper,\n    logger logrus.FieldLogger,\n    backupLogLevel logrus.Level,\n    newPluginManager func(logrus.FieldLogger) clientmgmt.Manager,\n    backupTracker BackupTracker,\n    kbClient kbclient.Client,\n    defaultBackupLocation string,\n    defaultVolumesToRestic bool,\n    defaultBackupTTL time.Duration,\n    volumeSnapshotLocationLister velerov1listers.VolumeSnapshotLocationLister,\n    defaultSnapshotLocations map[string]string,\n    metrics *metrics.ServerMetrics,\n    formatFlag logging.Format,\n    volumeSnapshotLister snapshotv1beta1listers.VolumeSnapshotLister,\n    volumeSnapshotContentLister snapshotv1beta1listers.VolumeSnapshotContentLister,\n    backupStoreGetter persistence.ObjectBackupStoreGetter,\n) Interface {\n    c := &amp;backupController{\n        genericController:           newGenericController(Backup, logger),\n        discoveryHelper:             discoveryHelper,\n        backupper:                   backupper,\n        lister:                      backupInformer.Lister(),\n        client:                      client,\n        clock:                       &amp;clock.RealClock{},\n        backupLogLevel:              backupLogLevel,\n        newPluginManager:            newPluginManager,\n        backupTracker:               backupTracker,\n        kbClient:                    kbClient,\n        defaultBackupLocation:       defaultBackupLocation,\n        defaultVolumesToRestic:      defaultVolumesToRestic,\n        defaultBackupTTL:            defaultBackupTTL,\n        snapshotLocationLister:      volumeSnapshotLocationLister,\n        defaultSnapshotLocations:    defaultSnapshotLocations,\n        metrics:                     metrics,\n        formatFlag:                  formatFlag,\n        volumeSnapshotLister:        volumeSnapshotLister,\n        volumeSnapshotContentLister: volumeSnapshotContentLister,\n        backupStoreGetter:           backupStoreGetter,\n    }\n    // \u5229\u7528\u5916\u90e8\u4f20\u5165\u7684processBackup \u6765\u91cd\u65b0\u8d4b\u503c\u901a\u7528\u63a7\u5236\u5668\u7684\uff0c\u4e5f\u5c31\u662f\u5177\u4f53\u8be5\u63a7\u5236\u5668\u5b9e\u73b0\u7684\u4e1a\u52a1\u903b\u8f91\n    c.syncHandler = c.processBackup\n  // \u91cd\u65b0\u540c\u6b65\u7684\u65b9\u6cd5\n    c.resyncFunc = c.resync\n    c.resyncPeriod = time.Minute\n\n  // \u6dfb\u52a0backup resourceEventHandler\n    backupInformer.Informer().AddEventHandler(\n        cache.ResourceEventHandlerFuncs{\n            AddFunc: func(obj interface{}) {\n        // \u9996\u5148\u5224\u65ad\u662f\u5426\u662fbackup\u5bf9\u8c61\n                backup := obj.(*velerov1api.Backup)\n\n                switch backup.Status.Phase {\n        // \u4ec5\u5904\u7406\u65b0\u7684backups\n                case \"\", velerov1api.BackupPhaseNew:\n                    // only process new backups\n                default:\n                    c.logger.WithFields(logrus.Fields{\n                        \"backup\": kubeutil.NamespaceAndName(backup),\n                        \"phase\":  backup.Status.Phase,\n                    }).Debug(\"Backup is not new, skipping\")\n                    return\n                }\n                // \u83b7\u53d6\u5bf9\u8c61key\n                key, err := cache.MetaNamespaceKeyFunc(backup)\n                if err != nil {\n                    c.logger.WithError(err).WithField(Backup, backup).Error(\"Error creating queue key, item not added to queue\")\n                    return\n                }\n        // \u5c06\u5176\u6dfb\u52a0\u8fdb\u961f\u5217\n                c.queue.Add(key)\n            },\n        },\n    )\n\n    return c\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#22-processbackup","title":"2.2 processBackup","text":"<p>controller\u9996\u5148\u8fd0\u884c\u7684processBackup</p> <pre><code>func (c *backupController) processBackup(key string) error {\n    log := c.logger.WithField(\"key\", key)\n\n    log.Debug(\"Running processBackup\")\n  // \u5206\u5272key\n    ns, name, err := cache.SplitMetaNamespaceKey(key)\n    if err != nil {\n        log.WithError(err).Errorf(\"error splitting key\")\n        return nil\n    }\n\n    log.Debug(\"Getting backup\")\n  // \u83b7\u53d6\u5907\u4efd\u5bf9\u8c61\n    original, err := c.lister.Backups(ns).Get(name)\n    if apierrors.IsNotFound(err) {\n        log.Debugf(\"backup %s not found\", name)\n        return nil\n    }\n    if err != nil {\n        return errors.Wrap(err, \"error getting backup\")\n    }\n\n  // \u68c0\u6d4b\u5f53\u524d\u5907\u4efd\u7684\u72b6\u6001\uff0c\u4e07\u4e00\u6709\u591a\u4e2a\u63a7\u5236\u5668\u5b9e\u4f8b\u6b63\u5728\u8fd0\u884c\uff0c\u63a7\u5236\u5668 A \u6709\u53ef\u80fd\u6210\u529f\u5c06\u9636\u6bb5\u66f4\u6539\u4e3a InProgress\uff0c\u800c\u63a7\u5236\u5668 B \u5c1d\u8bd5\u4fee\u8865\u9636\u6bb5\u5931\u8d25\u3002\u5f53\u63a7\u5236\u5668 B \u91cd\u65b0\u5904\u7406\u76f8\u540c\u7684\u5907\u4efd\u65f6\uff0c\u5b83\u5c06\u663e\u793a\u4e3a New\uff08\u901a\u77e5\u8005\u5c1a\u672a\u770b\u5230\u66f4\u65b0\uff09\u6216 InProgress\u3002\u5728\u524d\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0c\u8865\u4e01\u5c1d\u8bd5\u5c06\u518d\u6b21\u5931\u8d25\uff0c\u76f4\u5230\u901a\u77e5\u8005\u770b\u5230\u66f4\u65b0\u3002\u5728\u540e\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0c\u5728\u901a\u77e5\u8005\u770b\u5230 InProgress \u7684\u66f4\u65b0\u540e\uff0c\u6211\u4eec\u4ecd\u7136\u9700\u8981\u6b64\u68c0\u67e5\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u8fd4\u56de nil \u4ee5\u6307\u793a\u6211\u4eec\u5df2\u5b8c\u6210\u5904\u7406\u6b64\u5bc6\u94a5\uff08\u5373\u4f7f\u5b83\u662f\u7a7a\u64cd\u4f5c\uff09\u3002\n    switch original.Status.Phase {\n    case \"\", velerov1api.BackupPhaseNew:\n        // only process new backups\n    default:\n        return nil\n    }\n    // \u5904\u7406prepareBackupRequest\n    log.Debug(\"Preparing backup request\")\n    request := c.prepareBackupRequest(original)\n\n  // \u5982\u679c\u9a8c\u8bc1\u6b63\u5e38\uff0c\u6807\u8bb0\u6b63\u5728\u5904\u7406\n    if len(request.Status.ValidationErrors) &gt; 0 {\n        request.Status.Phase = velerov1api.BackupPhaseFailedValidation\n    } else {\n        request.Status.Phase = velerov1api.BackupPhaseInProgress\n        request.Status.StartTimestamp = &amp;metav1.Time{Time: c.clock.Now()}\n    }\n\n    // \u66f4\u65b0\u5907\u4efd\u4efb\u52a1\u72b6\u6001\n    updatedBackup, err := patchBackup(original, request.Backup, c.client)\n    if err != nil {\n        return errors.Wrapf(err, \"error updating Backup status to %s\", request.Status.Phase)\n    }\n    // \n    original = updatedBackup\n    request.Backup = updatedBackup.DeepCopy()\n\n    if request.Status.Phase == velerov1api.BackupPhaseFailedValidation {\n        return nil\n    }\n\n    c.backupTracker.Add(request.Namespace, request.Name)\n    defer c.backupTracker.Delete(request.Namespace, request.Name)\n\n  // \u8fd0\u884cbackup\n    log.Debug(\"Running backup\")\n    // \u83b7\u53d6\u5b9a\u65f6\u5907\u4efd\u7684\u540d\u79f0\n    backupScheduleName := request.GetLabels()[velerov1api.ScheduleNameLabel]\n    c.metrics.RegisterBackupAttempt(backupScheduleName)\n\n    // \u6267\u884c\u5e76\u4e0a\u4f20\u5907\u4efd\n    if err := c.runBackup(request); err != nil {\n        // \u5373\u4f7f runBackup \u5728\u5c06\u5de5\u4ef6\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\u50a8\u4e4b\u524d\u8bbe\u7f6e\u4e86\u5907\u4efd\u7684\u9636\u6bb5\uff0c\u6211\u4eec\u4e5f\u5fc5\u987b\u5728\u6b64\u5904\u518d\u6b21\u68c0\u67e5\u9519\u8bef\u5e76\u5728\u53d1\u73b0\u9519\u8bef\u65f6\u66f4\u65b0\u9636\u6bb5\uff0c\u56e0\u4e3a\u5728\u5c06\u5de5\u4ef6\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\u50a8\u65f6\u53ef\u80fd\u4f1a\u51fa\u9519\uff0c\u8fd9\u5c06\u5bfc\u81f4\u5907\u4efd\u5931\u8d25\u3002\n        log.WithError(err).Error(\"backup failed\")\n        request.Status.Phase = velerov1api.BackupPhaseFailed\n    }\n\n    switch request.Status.Phase {\n    case velerov1api.BackupPhaseCompleted:\n        c.metrics.RegisterBackupSuccess(backupScheduleName)\n    case velerov1api.BackupPhasePartiallyFailed:\n        c.metrics.RegisterBackupPartialFailure(backupScheduleName)\n    case velerov1api.BackupPhaseFailed:\n        c.metrics.RegisterBackupFailed(backupScheduleName)\n    case velerov1api.BackupPhaseFailedValidation:\n        c.metrics.RegisterBackupValidationFailure(backupScheduleName)\n    }\n\n    log.Debug(\"Updating backup's final status\")\n    if _, err := patchBackup(original, request.Backup, c.client); err != nil {\n        log.WithError(err).Error(\"error updating backup's final status\")\n    }\n\n    return nil\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#23-runbackup","title":"2.3 runBackup","text":"<p>runBackup\u8fd0\u884c\u5e76\u4e0a\u4f20\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u5907\u4efd\uff0c\u6b64\u51fd\u6570\u8fd4\u56de\u7684\u4efb\u4f55\u9519\u8bef\u90fd\u4f1a\u5bfc\u81f4\u5907\u4efd\u5931\u8d25\uff1b\u5982\u679c\u4e3a\u8fd4\u56de\u5907\u4efd\u9519\u8bef\uff0c\u68c0\u67e5\u5907\u4efd\u72b6\u6001\u9519\u8bef\u5b57\u6bb5\u4ee5\u67e5\u770b\u5907\u4efd\u662f\u5426\u90e8\u5206\u5931\u8d25\u3002</p> <p>\u8bbe\u7f6e\u4e34\u65f6\u5907\u4efd\u65e5\u5fd7\u6587\u4ef6\uff0c\u8bbe\u7f6e\u5907\u4efd\u6587\u4ef6\uff0c\u83b7\u53d6\u5907\u4efd\u5bf9\u8c61actions\uff0c\u8bbe\u7f6e\u5907\u4efd\u5b58\u50a8\u4ee5\u68c0\u67e5\u5907\u4efd\u662f\u5426\u5b58\u5728\uff0c\u6267\u884cbackupController\u4e2d\u7684\u4f20\u9012\u8fdb\u6765\u7684backupper\u6267\u884cBackup\u52a8\u4f5c\uff0c</p> <p>\u5982\u679c\u542f\u7528EnableCSI\uff0c\u5219\u8fdb\u884cvolumeSnapshotLister\uff0c\u548cvolumeSnapshotContentLister \u7684List\u64cd\u4f5c\u83b7\u53d6\u5217\u8868\u3002</p> <p>\u8bb0\u5f55\u5907\u4efd\u5bf9\u8c61\u72b6\u6001\u4e2dWarnings \u548c Errors\u6570\u5b57\uff0c\u91cd\u65b0\u5b9e\u4f8b\u5316\u5907\u4efd\u5b58\u50a8persistBackup\uff0c</p> <pre><code>func (c *backupController) runBackup(backup *pkgbackup.Request) error {\n  // \u8bbe\u7f6e\u5907\u4efd\n    c.logger.WithField(Backup, kubeutil.NamespaceAndName(backup)).Info(\"Setting up backup log\")\n    // \u5236\u5b9a\u65e5\u5fd7\u6587\u4ef6\n    logFile, err := ioutil.TempFile(\"\", \"\")\n    if err != nil {\n        return errors.Wrap(err, \"error creating temp file for backup log\")\n    }\n    gzippedLogFile := gzip.NewWriter(logFile)\n    // Assuming we successfully uploaded the log file, this will have already been closed below. It is safe to call\n    // close multiple times. If we get an error closing this, there's not really anything we can do about it.\n    defer gzippedLogFile.Close()\n    defer closeAndRemoveFile(logFile, c.logger.WithField(Backup, kubeutil.NamespaceAndName(backup)))\n\n  // \u65e5\u5fd7\u5305\u542b\u5907\u4efd\u65e5\u5fd7\u548c\u6807\u51c6\u63a7\u5236\u5b83\u8f93\u51fa\uff0c\u65e5\u5fd7\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u6392\u67e5\u4e0a\u4f20\u53d1\u751f\u4e86\u4ec0\u4e48\u4e8b\u60c5\uff0c\u540c\u65f6\u53ef\u4ee5\u5728\u5931\u8d25\u65f6\u67e5\u770b\u539f\u56e0\u3002\n    logger := logging.DefaultLogger(c.backupLogLevel, c.formatFlag)\n    logger.Out = io.MultiWriter(os.Stdout, gzippedLogFile)\n\n    logCounter := logging.NewLogCounterHook()\n    logger.Hooks.Add(logCounter)\n\n    backupLog := logger.WithField(Backup, kubeutil.NamespaceAndName(backup))\n    // \u8bbe\u7f6e\u5907\u4efd\u4e34\u65f6\u6587\u4ef6\n    backupLog.Info(\"Setting up backup temp file\")\n    backupFile, err := ioutil.TempFile(\"\", \"\")\n    if err != nil {\n        return errors.Wrap(err, \"error creating temp file for backup\")\n    }\n    defer closeAndRemoveFile(backupFile, backupLog)\n\n    backupLog.Info(\"Setting up plugin manager\")\n  // \u8bbe\u7f6eplugin manager\n    pluginManager := c.newPluginManager(backupLog)\n    defer pluginManager.CleanupClients()\n\n    backupLog.Info(\"Getting backup item actions\")\n  // \u83b7\u53d6\u5907\u4efd\u5bf9\u8c61\u7684actions\n    actions, err := pluginManager.GetBackupItemActions()\n    if err != nil {\n        return err\n    }\n    // \u5f00\u83b7\u53d6\u5907\u4efd\u5b58\u50a8\n    backupLog.Info(\"Setting up backup store to check for backup existence\")\n    backupStore, err := c.backupStoreGetter.Get(backup.StorageLocation, pluginManager, backupLog)\n    if err != nil {\n        return err\n    }\n    // \u5982\u679c\u5907\u4efd\u5df2\u7ecf\u5b58\u5728\uff0c\u6216\u68c0\u6d4b\u53d1\u751f\u9519\u8bef\uff0c\u5219\u8fd4\u56de\u9519\u8bef\n    exists, err := backupStore.BackupExists(backup.StorageLocation.Spec.StorageType.ObjectStorage.Bucket, backup.Name)\n    if exists || err != nil {\n        backup.Status.Phase = velerov1api.BackupPhaseFailed\n        backup.Status.CompletionTimestamp = &amp;metav1.Time{Time: c.clock.Now()}\n        if err != nil {\n            return errors.Wrapf(err, \"error checking if backup already exists in object storage\")\n        }\n        return errors.Errorf(\"backup already exists in object storage\")\n    }\n\n  // \u5f00\u59cb\u6267\u884c\u5907\u4efd\uff0c\u5c06\u9519\u8bef\u6dfb\u52a0\u5230fatalErrs\n    var fatalErrs []error\n    if err := c.backupper.Backup(backupLog, backup, backupFile, actions, pluginManager); err != nil {\n        fatalErrs = append(fatalErrs, err)\n    }\n\n  // \u5224\u65ad\u5982\u679c\u542f\u7528EnableCSI\n    // Empty slices here so that they can be passed in to the persistBackup call later, regardless of whether or not CSI's enabled.\n    // This way, we only make the Lister call if the feature flag's on.\n    var volumeSnapshots []*snapshotv1beta1api.VolumeSnapshot\n    var volumeSnapshotContents []*snapshotv1beta1api.VolumeSnapshotContent\n    if features.IsEnabled(velerov1api.CSIFeatureFlag) {\n    // \u83b7\u53d6\u53ef\u4ee5\u4e3avelero.io/backup-name\u7684selector\n        selector := label.NewSelectorForBackup(backup.Name)\n\n    // \u5982\u679cvolumeSnapshotLister \u4e0d\u4e3anil\uff0c\u5219\u6839\u636e\u6807\u7b7e\u9009\u62e9\u5c06\u7ed3\u679c\u5b58\u50a8\u5230volumeSnapshots \u5217\u8868\u4e2d\n        if c.volumeSnapshotLister != nil {\n            volumeSnapshots, err = c.volumeSnapshotLister.List(selector)\n            if err != nil {\n                backupLog.Error(err)\n            }\n        }\n        // \u5982\u679cvolumeSnapshotContentLister \u4e0d\u4e3anil\uff0c\u5219\u6839\u636e\u6807\u7b7e\u5c06volumeSnapshotCountent \u6dfb\u52a0\u8fdbvolumeSnapshotContents\u5217\u8868\u4e2d\n        if c.volumeSnapshotContentLister != nil {\n            volumeSnapshotContents, err = c.volumeSnapshotContentLister.List(selector)\n            if err != nil {\n                backupLog.Error(err)\n            }\n        }\n    }\n\n    // \u5728\u5e8f\u5217\u5316\u548c\u4e0a\u4f20\u4e4b\u524d\u6807\u8bb0\u5b8c\u6210\u65f6\u95f4\u6233\u3002\u5426\u5219\uff0c\u5bf9\u8c61\u5b58\u50a8\u4e2d\u7684 JSON \u6587\u4ef6\u7684 CompletionTimestamp \u4e3a\u201cnull\u201d\u3002\n    backup.Status.CompletionTimestamp = &amp;metav1.Time{Time: c.clock.Now()}\n    // \u904d\u5386VolumeSnapshots\uff0c\u8fdb\u884c\u5b8c\u6210VolumeSnapshotsCompleted\u8bb0\u6570\n    backup.Status.VolumeSnapshotsAttempted = len(backup.VolumeSnapshots)\n    for _, snap := range backup.VolumeSnapshots {\n        if snap.Status.Phase == volume.SnapshotPhaseCompleted {\n            backup.Status.VolumeSnapshotsCompleted++\n        }\n    }\n    // \u8bb0\u5f55backupmetrics\n    recordBackupMetrics(backupLog, backup.Backup, backupFile, c.metrics)\n    // \u5173\u95ed\u65e5\u5fd7\n    if err := gzippedLogFile.Close(); err != nil {\n        c.logger.WithField(Backup, kubeutil.NamespaceAndName(backup)).WithError(err).Error(\"error closing gzippedLogFile\")\n    }\n    // \u8bb0\u5f55\u5907\u4efd\u5bf9\u8c61\u72b6\u6001\u4e2dWarnings \u548c Errors\u6570\u5b57\n    backup.Status.Warnings = logCounter.GetCount(logrus.WarnLevel)\n    backup.Status.Errors = logCounter.GetCount(logrus.ErrorLevel)\n\n    // \u5c06 finalize \u9636\u6bb5\u5206\u914d\u5230\u5c3d\u53ef\u80fd\u63a5\u8fd1\u7ed3\u675f\u7684\u4f4d\u7f6e\uff0c\u4ee5\u4fbf\u6355\u83b7\u8bb0\u5f55\u5230 backupLog \u7684\u4efb\u4f55\u9519\u8bef\u3002\u8fd9\u662f\u5728\u5c06\u5de5\u4ef6\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\u50a8\u4e4b\u524d\u5b8c\u6210\u7684\uff0c\u4ee5\u4fbf\u5bf9\u8c61\u5b58\u50a8\u4e2d\u5907\u4efd\u7684 JSON \u8868\u793a\u5177\u6709\u7ec8\u7aef\u9636\u6bb5\u96c6\u3002\n    switch {\n    case len(fatalErrs) &gt; 0:\n        backup.Status.Phase = velerov1api.BackupPhaseFailed\n    case logCounter.GetCount(logrus.ErrorLevel) &gt; 0:\n        backup.Status.Phase = velerov1api.BackupPhasePartiallyFailed\n    default:\n        backup.Status.Phase = velerov1api.BackupPhaseCompleted\n    }\n\n    // \u91cd\u65b0\u5b9e\u4f8b\u5316\u5907\u4efd\u5b58\u50a8\uff0c\u56e0\u4e3a\u81ea\u539f\u59cb\u5b9e\u4f8b\u5316\u4ee5\u6765\u51ed\u636e\u53ef\u80fd\u5df2\u66f4\u6539\uff0c\u5982\u679c\u8fd9\u662f\u4e00\u4e2a\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u5907\u4efd\n    backupLog.Info(\"Setting up backup store to persist the backup\")\n    backupStore, err = c.backupStoreGetter.Get(backup.StorageLocation, pluginManager, backupLog)\n    if err != nil {\n        return err\n    }\n    // \u6267\u884c\u6301\u4e45\u5316\u5907\u4efd\n    if errs := persistBackup(backup, backupFile, logFile, backupStore, c.logger.WithField(Backup, kubeutil.NamespaceAndName(backup)), volumeSnapshots, volumeSnapshotContents); len(errs) &gt; 0 {\n        fatalErrs = append(fatalErrs, errs...)\n    }\n\n    c.logger.WithField(Backup, kubeutil.NamespaceAndName(backup)).Info(\"Backup completed\")\n\n    // \u5982\u679c\u6211\u4eec\u8fd4\u56de\u4e00\u4e2a\u975e\u96f6\u9519\u8bef\uff0c\u8c03\u7528\u51fd\u6570\u4f1a\u5c06\u5907\u4efd\u7684\u9636\u6bb5\u66f4\u65b0\u4e3a\u5931\u8d25\u3002\n    return kerrors.NewAggregate(fatalErrs)\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#24-resync","title":"2.4 resync","text":"<p>resync\u65b9\u6cd5\uff0c\u5229\u7528backupController\u4f20\u5165\u7684BackupLister \u8fdb\u884clist\uff0cgetLastSuccessBySchedule \u4e3a\u6bcf\u4e2a\u8ba1\u5212\u67e5\u627e\u6700\u8fd1\u5b8c\u6210\u7684\u5907\u4efd\uff0c\u5e76\u8fd4\u56de\u8ba1\u5212\u540d\u79f0 -&gt; \u6700\u8fd1\u5b8c\u6210\u5907\u4efd\u7684\u5b8c\u6210\u65f6\u95f4\u7684\u6620\u5c04\u3002\u6b64\u6620\u5c04\u5305\u542b\u4e00\u4e2a\u7528\u4e8e ad-hocnon-scheduled \u5907\u4efd\u7684\u6761\u76ee\uff0c\u5176\u4e2d\u952e\u662f\u7a7a\u5b57\u7b26\u4e32\u3002</p> <pre><code>func (c *backupController) resync() {\n    // \u91cd\u65b0\u8ba1\u7b97 backup_total \u6307\u6807\n    backups, err := c.lister.List(labels.Everything())\n    if err != nil {\n        c.logger.Error(err, \"Error computing backup_total metric\")\n    } else {\n        c.metrics.SetBackupTotal(int64(len(backups)))\n    }\n\n    // \u91cd\u65b0\u8ba1\u7b97\u6bcf\u4e2a\u8ba1\u5212\u7684 backup_last_successful_timestamp \u6307\u6807\uff08\u5305\u62ec\u7a7a\u8ba1\u5212\uff0c\u5373\u4e34\u65f6\u5907\u4efd\uff09\n    for schedule, timestamp := range getLastSuccessBySchedule(backups) {\n        c.metrics.SetBackupLastSuccessfulTimestamp(schedule, timestamp)\n    }\n}\n\n// \u6839\u636elist\u51fa\u6765\u7684backups\uff0c\u83b7\u53d6schedule\u6700\u65b0\u7684\u5907\u4efd\nfunc getLastSuccessBySchedule(backups []*velerov1api.Backup) map[string]time.Time {\n    lastSuccessBySchedule := map[string]time.Time{}\n    for _, backup := range backups {\n        if backup.Status.Phase != velerov1api.BackupPhaseCompleted {\n            continue\n        }\n        if backup.Status.CompletionTimestamp == nil {\n            continue\n        }\n\n        schedule := backup.Labels[velerov1api.ScheduleNameLabel]\n        timestamp := backup.Status.CompletionTimestamp.Time\n\n        if timestamp.After(lastSuccessBySchedule[schedule]) {\n            lastSuccessBySchedule[schedule] = timestamp\n        }\n    }\n\n    return lastSuccessBySchedule\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#25-preparebackuprequest","title":"2.5 prepareBackupRequest","text":"<p>\u5bf9\u8f93\u5165\u53c2\u6570\u8fdb\u884c\u89e3\u6790\u5e76\u5904\u7406\uff0c\u6700\u603b\u9632\u62a4backup.Request\u5bf9\u8c61</p> <pre><code>func (c *backupController) prepareBackupRequest(backup *velerov1api.Backup) *pkgbackup.Request {\n  // \u4e3a\u4e86\u9632\u6b62\u4fee\u6539\u539f\u59cb\u5bf9\u8c61\uff0c\u5728\u6b64\u8fdb\u884c\u6df1\u5ea6copy\n    request := &amp;pkgbackup.Request{\n        Backup: backup.DeepCopy(), // don't modify items in the cache\n    }\n\n  // \u8bbe\u7f6e\u5907\u4efd\u4e3b\u7248\u672c\uff0c\u65b0\u7248\u672c\u4f7f\u7528tatus.FormatVersion\n    request.Status.Version = pkgbackup.BackupVersion\n    request.Status.FormatVersion = pkgbackup.BackupFormatVersion\n    // \u8bbe\u7f6e\u5907\u4efdTTL\n    if request.Spec.TTL.Duration == 0 {\n        request.Spec.TTL.Duration = c.defaultBackupTTL\n    }\n\n    // calculate expiration\n    request.Status.Expiration = &amp;metav1.Time{Time: c.clock.Now().Add(request.Spec.TTL.Duration)}\n    // \u9ed8\u8ba4\u4e0d\u4f7f\u7528restic\n    if request.Spec.DefaultVolumesToRestic == nil {\n        request.Spec.DefaultVolumesToRestic = &amp;c.defaultVolumesToRestic\n    }\n\n    // \u67e5\u627e\u53ef\u98df\u7528\u7684bsl\uff0c\u5982\u679c\u7528\u6237\u672a\u6307\u5b9a\uff0c\u5219\u4f7f\u7528default\u7684bsl\n    var serverSpecified bool\n    if request.Spec.StorageLocation == \"\" {\n        // when the user doesn't specify a location, use the server default unless there is an existing BSL marked as default\n        // TODO(2.0) c.defaultBackupLocation will be deprecated\n        request.Spec.StorageLocation = c.defaultBackupLocation\n\n        locationList, err := storage.ListBackupStorageLocations(context.Background(), c.kbClient, request.Namespace)\n        if err == nil {\n            for _, location := range locationList.Items {\n                if location.Spec.Default {\n                    request.Spec.StorageLocation = location.Name\n                    break\n                }\n            }\n        }\n        serverSpecified = true\n    }\n\n    // get the storage location, and store the BackupStorageLocation API obj on the request\n  // \u83b7\u53d6storage location\uff0c\u5e76\u5b58\u50a8BackupStorageLocation API\u5bf9\u8c61\u5230\u8bf7\u6c42\u4e2d\n    storageLocation := &amp;velerov1api.BackupStorageLocation{}\n    if err := c.kbClient.Get(context.Background(), kbclient.ObjectKey{\n        Namespace: request.Namespace,\n        Name:      request.Spec.StorageLocation,\n    }, storageLocation); err != nil {\n        if apierrors.IsNotFound(err) {\n            if serverSpecified {\n                // TODO(2.0) remove this. For now, without mentioning \"server default\" it could be confusing trying to grasp where the default came from.\n                request.Status.ValidationErrors = append(request.Status.ValidationErrors, fmt.Sprintf(\"an existing backup storage location wasn't specified at backup creation time and the server default '%s' doesn't exist. Please address this issue (see `velero backup-location -h` for options) and create a new backup. Error: %v\", request.Spec.StorageLocation, err))\n            } else {\n                request.Status.ValidationErrors = append(request.Status.ValidationErrors, fmt.Sprintf(\"an existing backup storage location wasn't specified at backup creation time and the default '%s' wasn't found. Please address this issue (see `velero backup-location -h` for options) and create a new backup. Error: %v\", request.Spec.StorageLocation, err))\n            }\n        } else {\n            request.Status.ValidationErrors = append(request.Status.ValidationErrors, fmt.Sprintf(\"error getting backup storage location: %v\", err))\n        }\n    } else {\n\n    // \u5b58\u50a8storageLocation API\u5bf9\u8c61\u5230request\u4e2d\n        request.StorageLocation = storageLocation\n        // \u66f4\u65b0storageLocation \u7684\u8bbf\u95ee\u6a21\u5f0f\n        if request.StorageLocation.Spec.AccessMode == velerov1api.BackupStorageLocationAccessModeReadOnly {\n            request.Status.ValidationErrors = append(request.Status.ValidationErrors,\n                fmt.Sprintf(\"backup can't be created because backup storage location %s is currently in read-only mode\", request.StorageLocation.Name))\n        }\n    }\n  // \u589e\u52a0label\u4e3a\u4e86\u66f4\u65b9\u4fbf\u7684\u8fc7\u6ee4\n    if request.Labels == nil {\n        request.Labels = make(map[string]string)\n    }\n    request.Labels[velerov1api.StorageLocationLabel] = label.GetValidName(request.Spec.StorageLocation)\n\n  // \u6821\u9a8c\u5e76\u83b7\u53d6vsl\u5e76\u5b58\u50a8VolumeSnapshotLocation API  \u5bf9\u8c61\u5230request\u4e2d\n    if locs, errs := c.validateAndGetSnapshotLocations(request.Backup); len(errs) &gt; 0 {\n        request.Status.ValidationErrors = append(request.Status.ValidationErrors, errs...)\n    } else {\n        request.Spec.VolumeSnapshotLocations = nil\n        for _, loc := range locs {\n            request.Spec.VolumeSnapshotLocations = append(request.Spec.VolumeSnapshotLocations, loc.Name)\n            request.SnapshotLocations = append(request.SnapshotLocations, loc)\n        }\n    }\n\n  // \u83b7\u53d6\u96c6\u7fa4\u7248\u672c\u7684\u6240\u6709\u4fe1\u606f - \u5bf9\u672a\u6765\u7684\u8df3\u8fc7\u7ea7\u8fc1\u79fb\u5f88\u6709\u7528\n    if request.Annotations == nil {\n        request.Annotations = make(map[string]string)\n    }\n    request.Annotations[velerov1api.SourceClusterK8sGitVersionAnnotation] = c.discoveryHelper.ServerVersion().String()\n    request.Annotations[velerov1api.SourceClusterK8sMajorVersionAnnotation] = c.discoveryHelper.ServerVersion().Major\n    request.Annotations[velerov1api.SourceClusterK8sMinorVersionAnnotation] = c.discoveryHelper.ServerVersion().Minor\n\n  // \u6821\u9a8cincluded/excluded \u8d44\u6e90\n    for _, err := range collections.ValidateIncludesExcludes(request.Spec.IncludedResources, request.Spec.ExcludedResources) {\n        request.Status.ValidationErrors = append(request.Status.ValidationErrors, fmt.Sprintf(\"Invalid included/excluded resource lists: %v\", err))\n    }\n\n  // \u6821\u9a8cincluded/excluded \u540d\u79f0\u7a7a\u95f4\n    for _, err := range collections.ValidateIncludesExcludes(request.Spec.IncludedNamespaces, request.Spec.ExcludedNamespaces) {\n        request.Status.ValidationErrors = append(request.Status.ValidationErrors, fmt.Sprintf(\"Invalid included/excluded namespace lists: %v\", err))\n    }\n\n    return request\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/velero%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#26-backup","title":"2.6 Backup","text":"<p>\u5728\u6267\u884crunBackup\u4e2d\uff0c\u5185\u90e8\u9488\u5bf9k8s\u8d44\u6e90\u5bf9\u8c61\u5177\u4f53\u7684\u5907\u4efd\u903b\u8f91\u5b9e\u73b0\u662f\u5728velero/pkg/backup \u76ee\u5f55\u4e0b</p> <pre><code>//velero/pkg/backup/backup.go\n\nfunc (kb *kubernetesBackupper) Backup(log logrus.FieldLogger, backupRequest *Request, backupFile io.Writer, actions []velero.BackupItemAction, volumeSnapshotterGetter VolumeSnapshotterGetter) error {\n  // \u83b7\u53d6\u538b\u7f29\u5199\u5165\u5bf9\u8c61tw\n    gzippedData := gzip.NewWriter(backupFile)\n    defer gzippedData.Close()\n\n    tw := tar.NewWriter(gzippedData)\n    defer tw.Close()\n\n    log.Info(\"Writing backup version file\")\n    if err := kb.writeBackupVersion(tw); err != nil {\n        return errors.WithStack(err)\n    }\n    // \u83b7\u53d6includesexcludes\u7684namespace\u548cresource\u5e76\u8d4b\u503c\u7ed9backuprequest\n    backupRequest.NamespaceIncludesExcludes = getNamespaceIncludesExcludes(backupRequest.Backup)\n    log.Infof(\"Including namespaces: %s\", backupRequest.NamespaceIncludesExcludes.IncludesString())\n    log.Infof(\"Excluding namespaces: %s\", backupRequest.NamespaceIncludesExcludes.ExcludesString())\n\n    backupRequest.ResourceIncludesExcludes = collections.GetResourceIncludesExcludes(kb.discoveryHelper, backupRequest.Spec.IncludedResources, backupRequest.Spec.ExcludedResources)\n    log.Infof(\"Including resources: %s\", backupRequest.ResourceIncludesExcludes.IncludesString())\n    log.Infof(\"Excluding resources: %s\", backupRequest.ResourceIncludesExcludes.ExcludesString())\n    log.Infof(\"Backing up all pod volumes using restic: %t\", *backupRequest.Backup.Spec.DefaultVolumesToRestic)\n\n    var err error\n  // \u83b7\u53d6resourceHooks\u5e76\u8d4b\u503c\u7ed9backupRequest\n    backupRequest.ResourceHooks, err = getResourceHooks(backupRequest.Spec.Hooks.Resources, kb.discoveryHelper)\n    if err != nil {\n        return err\n    }\n    // \u83b7\u53d6bresolvedAction\u5e76\u8d4b\u503c\u7ed9backupRequest\n    backupRequest.ResolvedActions, err = resolveActions(actions, kb.discoveryHelper)\n    if err != nil {\n        return err\n    }\n\n    backupRequest.BackedUpItems = map[itemKey]struct{}{}\n\n    podVolumeTimeout := kb.resticTimeout\n    if val := backupRequest.Annotations[velerov1api.PodVolumeOperationTimeoutAnnotation]; val != \"\" {\n        parsed, err := time.ParseDuration(val)\n        if err != nil {\n            log.WithError(errors.WithStack(err)).Errorf(\"Unable to parse pod volume timeout annotation %s, using server value.\", val)\n        } else {\n            podVolumeTimeout = parsed\n        }\n    }\n\n    ctx, cancelFunc := context.WithTimeout(context.Background(), podVolumeTimeout)\n    defer cancelFunc()\n    // \u83b7\u53d6resticBackupper\n    var resticBackupper restic.Backupper\n    if kb.resticBackupperFactory != nil {\n        resticBackupper, err = kb.resticBackupperFactory.NewBackupper(ctx, backupRequest.Backup)\n        if err != nil {\n            return errors.WithStack(err)\n        }\n    }\n\n    // set up a temp dir for the itemCollector to use to temporarily\n    // store items as they're scraped from the API.\n  // \u751f\u6210\u7a7a\u76ee\u5f55\u6765\u5b58\u50a8\u5907\u4efd\u6587\u4ef6\n    tempDir, err := ioutil.TempDir(\"\", \"\")\n    if err != nil {\n        return errors.Wrap(err, \"error creating temp dir for backup\")\n    }\n    defer os.RemoveAll(tempDir)\n    // \u751f\u6210\u5177\u4f53collector \u5bf9\u8c61\n    collector := &amp;itemCollector{\n        log:                   log,\n        backupRequest:         backupRequest,\n        discoveryHelper:       kb.discoveryHelper,\n        dynamicFactory:        kb.dynamicFactory,\n        cohabitatingResources: cohabitatingResources(),\n        dir:                   tempDir,\n    }\n    // \u83b7\u53d6\u6240\u6709item\n    items := collector.getAllItems()\n    log.WithField(\"progress\", \"\").Infof(\"Collected %d items matching the backup spec from the Kubernetes API (actual number of items backed up may be more or less depending on velero.io/exclude-from-backup annotation, plugins returning additional related items to back up, etc.)\", len(items))\n\n    backupRequest.Status.Progress = &amp;velerov1api.BackupProgress{TotalItems: len(items)}\n    patch := fmt.Sprintf(`{\"status\":{\"progress\":{\"totalItems\":%d}}}`, len(items))\n    if _, err := kb.backupClient.Backups(backupRequest.Namespace).Patch(context.TODO(), backupRequest.Name, types.MergePatchType, []byte(patch), metav1.PatchOptions{}); err != nil {\n        log.WithError(errors.WithStack((err))).Warn(\"Got error trying to update backup's status.progress.totalItems\")\n    }\n\n    itemBackupper := &amp;itemBackupper{\n        backupRequest:           backupRequest,\n        tarWriter:               tw,\n        dynamicFactory:          kb.dynamicFactory,\n        discoveryHelper:         kb.discoveryHelper,\n        resticBackupper:         resticBackupper,\n        resticSnapshotTracker:   newPVCSnapshotTracker(),\n        volumeSnapshotterGetter: volumeSnapshotterGetter,\n        itemHookHandler: &amp;hook.DefaultItemHookHandler{\n            PodCommandExecutor: kb.podCommandExecutor,\n        },\n    }\n\n    // helper struct to send current progress between the main\n    // backup loop and the gouroutine that periodically patches\n    // the backup CR with progress updates\n    type progressUpdate struct {\n        totalItems, itemsBackedUp int\n    }\n\n    // the main backup process will send on this channel once\n    // for every item it processes.\n    update := make(chan progressUpdate)\n\n    // the main backup process will send on this channel when\n    // it's done sending progress updates\n    quit := make(chan struct{})\n\n    // This is the progress updater goroutine that receives\n    // progress updates on the 'update' channel. It patches\n    // the backup CR with progress updates at most every second,\n    // but it will not issue a patch if it hasn't received a new\n    // update since the previous patch. This goroutine exits\n    // when it receives on the 'quit' channel.\n    go func() {\n        ticker := time.NewTicker(1 * time.Second)\n        var lastUpdate *progressUpdate\n        for {\n            select {\n            case &lt;-quit:\n                ticker.Stop()\n                return\n            case val := &lt;-update:\n                lastUpdate = &amp;val\n            case &lt;-ticker.C:\n                if lastUpdate != nil {\n                    backupRequest.Status.Progress.TotalItems = lastUpdate.totalItems\n                    backupRequest.Status.Progress.ItemsBackedUp = lastUpdate.itemsBackedUp\n\n                    patch := fmt.Sprintf(`{\"status\":{\"progress\":{\"totalItems\":%d,\"itemsBackedUp\":%d}}}`, lastUpdate.totalItems, lastUpdate.itemsBackedUp)\n                    if _, err := kb.backupClient.Backups(backupRequest.Namespace).Patch(context.TODO(), backupRequest.Name, types.MergePatchType, []byte(patch), metav1.PatchOptions{}); err != nil {\n                        log.WithError(errors.WithStack((err))).Warn(\"Got error trying to update backup's status.progress\")\n                    }\n                    lastUpdate = nil\n                }\n            }\n        }\n    }()\n\n    backedUpGroupResources := map[schema.GroupResource]bool{}\n    totalItems := len(items)\n\n    for i, item := range items {\n        log.WithFields(map[string]interface{}{\n            \"progress\":  \"\",\n            \"resource\":  item.groupResource.String(),\n            \"namespace\": item.namespace,\n            \"name\":      item.name,\n        }).Infof(\"Processing item\")\n\n        // use an anonymous func so we can defer-close/remove the file\n        // as soon as we're done with it\n        func() {\n            var unstructured unstructured.Unstructured\n\n            f, err := os.Open(item.path)\n            if err != nil {\n                log.WithError(errors.WithStack(err)).Error(\"Error opening file containing item\")\n                return\n            }\n            defer f.Close()\n            defer os.Remove(f.Name())\n\n            if err := json.NewDecoder(f).Decode(&amp;unstructured); err != nil {\n                log.WithError(errors.WithStack(err)).Error(\"Error decoding JSON from file\")\n                return\n            }\n\n            if backedUp := kb.backupItem(log, item.groupResource, itemBackupper, &amp;unstructured, item.preferredGVR); backedUp {\n                backedUpGroupResources[item.groupResource] = true\n            }\n        }()\n\n        // updated total is computed as \"how many items we've backed up so far, plus\n        // how many items we know of that are remaining\"\n        totalItems = len(backupRequest.BackedUpItems) + (len(items) - (i + 1))\n\n        // send a progress update\n        update &lt;- progressUpdate{\n            totalItems:    totalItems,\n            itemsBackedUp: len(backupRequest.BackedUpItems),\n        }\n\n        log.WithFields(map[string]interface{}{\n            \"progress\":  \"\",\n            \"resource\":  item.groupResource.String(),\n            \"namespace\": item.namespace,\n            \"name\":      item.name,\n        }).Infof(\"Backed up %d items out of an estimated total of %d (estimate will change throughout the backup)\", len(backupRequest.BackedUpItems), totalItems)\n    }\n\n    // no more progress updates will be sent on the 'update' channel\n    quit &lt;- struct{}{}\n\n    // back up CRD for resource if found. We should only need to do this if we've backed up at least\n    // one item for the resource and IncludeClusterResources is nil. If IncludeClusterResources is false\n    // we don't want to back it up, and if it's true it will already be included.\n    if backupRequest.Spec.IncludeClusterResources == nil {\n        for gr := range backedUpGroupResources {\n            kb.backupCRD(log, gr, itemBackupper)\n        }\n    }\n\n    // do a final update on progress since we may have just added some CRDs and may not have updated\n    // for the last few processed items.\n    backupRequest.Status.Progress.TotalItems = len(backupRequest.BackedUpItems)\n    backupRequest.Status.Progress.ItemsBackedUp = len(backupRequest.BackedUpItems)\n\n    patch = fmt.Sprintf(`{\"status\":{\"progress\":{\"totalItems\":%d,\"itemsBackedUp\":%d}}}`, len(backupRequest.BackedUpItems), len(backupRequest.BackedUpItems))\n    if _, err := kb.backupClient.Backups(backupRequest.Namespace).Patch(context.TODO(), backupRequest.Name, types.MergePatchType, []byte(patch), metav1.PatchOptions{}); err != nil {\n        log.WithError(errors.WithStack((err))).Warn(\"Got error trying to update backup's status.progress\")\n    }\n\n    log.WithField(\"progress\", \"\").Infof(\"Backed up a total of %d items\", len(backupRequest.BackedUpItems))\n\n    return nil\n}\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/","title":"\u8de8\u5e73\u53f0\u6570\u636e\u5907\u4efd\u5de5\u5177\u4e4brestic\u8be6\u89e3","text":""},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>Restic \u662f\u4e00\u6b3e GO \u8bed\u8a00\u5f00\u53d1\u7684\u5f00\u6e90\u514d\u8d39\u4e14\u5feb\u901f\u3001\u9ad8\u6548\u548c\u5b89\u5168\u7684\u8de8\u5e73\u53f0\u5907\u4efd\u5de5\u5177\u3002Restic \u4f7f\u7528\u52a0\u5bc6\u6280\u672f\u6765\u4fdd\u8bc1\u4f60\u7684\u6570\u636e\u5b89\u5168\u6027\u548c\u5b8c\u6574\u6027\uff0c\u53ef\u4ee5\u5c06\u672c\u5730\u6570\u636e\u52a0\u5bc6\u540e\u4f20\u8f93\u5230\u6307\u5b9a\u7684\u5b58\u50a8\u3002</p> <p>Restic \u540c\u6837\u652f\u6301\u589e\u91cf\u5907\u4efd\uff0c\u53ef\u968f\u65f6\u5907\u4efd\u548c\u6062\u590d\u5907\u4efd\u3002Restic \u652f\u6301\u5927\u591a\u6570\u4e3b\u6d41\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6bd4\u5982\uff1aLinux\u3001macOS\u3001Windows \u4ee5\u53ca\u4e00\u4e9b\u8f83\u5c0f\u4f17\u7684\u64cd\u4f5c\u7cfb\u7edf FreeBSD \u548c OpenBSD \u7b49\u3002</p>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#restic_1","title":"\u4e8c restic\u7b80\u4ecb","text":""},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#21-restic","title":"2.1 restic \u652f\u6301\u7c7b\u578b","text":"<ul> <li>\u672c\u5730\u5b58\u50a8</li> <li>SFTP</li> <li>REST Server</li> <li>Amazon S3</li> <li>Minio Server</li> <li>OpenStack Swift</li> <li>Backblaze B2</li> <li>Microsoft Azure Blob Storage</li> <li>Google Cloud Storage</li> <li>\u901a\u8fc7 Rclone \u6302\u8f7d\u7684\u5b58\u50a8 (\u6bd4\u5982\uff1aGoogle Drive\u3001OneDrive \u7b49)</li> </ul>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#22-restic-rclone","title":"2.2 Restic \u4e0e Rclone \u533a\u522b","text":""},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#221","title":"2.2.1 \u76f8\u540c\u70b9","text":"<ul> <li>\u4e24\u8005\u90fd\u662f\u57fa\u4e8e\u547d\u4ee4\u884c\u7684\u5f00\u6e90\u6587\u4ef6\u540c\u6b65\u548c\u5907\u4efd\u5de5\u5177\u3002</li> <li>\u4e24\u8005\u90fd\u652f\u6301\u5c06\u6587\u4ef6\u5907\u4efd\u5230\u672c\u5730\u3001\u8fdc\u7a0b\u670d\u52a1\u5668\u6216\u5bf9\u8c61\u5b58\u50a8\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#222","title":"2.2.2 \u5f02\u540c","text":"<ul> <li>Rclone \u9762\u5411\u7684\u662f\u6587\u4ef6\u540c\u6b65\uff0c\u5373\u4fdd\u8bc1\u4e24\u7aef\u6587\u4ef6\u7684\u4e00\u81f4\uff0c\u4e5f\u53ef\u4ee5\u589e\u91cf\u5907\u4efd\u3002</li> <li>Restic \u9762\u5411\u7684\u662f\u6587\u4ef6\u5907\u4efd\u548c\u52a0\u5bc6\uff0c\u6587\u4ef6\u5148\u52a0\u5bc6\u518d\u4f20\u8f93\u5907\u4efd\uff0c\u800c\u4e14\u662f\u589e\u91cf\u5907\u4efd\uff0c\u5373\u6bcf\u6b21\u53ea\u5907\u4efd\u53d8\u5316\u7684\u90e8\u5206\u3002</li> <li>Rclone \u4ed3\u5e93\u914d\u7f6e\u4fdd\u5b58\u5728\u672c\u5730\uff0c\u5907\u4efd\u7684\u6587\u4ef6\u4f1a\u4fdd\u6301\u539f\u6837\u7684\u540c\u6b65\u4e8e\u5b58\u50a8\u4ed3\u5e93\u4e2d\u3002</li> <li>Restic \u914d\u7f6e\u4fe1\u606f\u76f4\u63a5\u5199\u5728\u4ed3\u5e93\uff0c\u53ea\u8981\u6709\u4ed3\u5e93\u5bc6\u7801\uff0c\u5728\u4efb\u4f55\u5b89\u88c5\u4e86 Restic \u7684\u8ba1\u7b97\u673a\u4e0a\u90fd\u53ef\u4ee5\u64cd\u4f5c\u4ed3\u5e93\u3002</li> <li>Rclone \u4e0d\u8bb0\u5f55\u6587\u4ef6\u7248\u672c\uff0c\u65e0\u6cd5\u6839\u636e\u67d0\u4e00\u6b21\u5907\u4efd\u627e\u56de\u7279\u5b9a\u65f6\u95f4\u70b9\u4e0a\u7684\u6587\u4ef6\u3002</li> <li>Restic \u6bcf\u6b21\u5907\u4efd\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u5feb\u7167\uff0c\u8bb0\u5f55\u5f53\u524d\u65f6\u95f4\u70b9\u7684\u6587\u4ef6\u7ed3\u6784\uff0c\u53ef\u4ee5\u627e\u56de\u7279\u5b9a\u65f6\u95f4\u70b9\u7684\u6587\u4ef6\u3002</li> <li>Rclone \u53ef\u4ee5\u5728\u914d\u7f6e\u7684\u591a\u4e2a\u5b58\u50a8\u7aef\u4e4b\u95f4\u4f20\u8f93\u6587\u4ef6\u3002</li> </ul> <p>\u603b\u7684\u6765\u8bf4\uff0cRclone \u548c Restic \u5404\u6709\u6240\u957f\uff0c\u8981\u6839\u636e\u4e0d\u540c\u7684\u4e1a\u52a1\u9700\u6c42\u9009\u62e9\u4f7f\u7528\u3002\u6bd4\u5982\uff1a\u7f51\u7ad9\u6570\u636e\u7684\u589e\u91cf\u5907\u4efd\uff0c\u7528 Resitc \u5c31\u6bd4\u8f83\u5408\u9002\u3002\u800c\u5e38\u89c4\u6587\u4ef6\u7684\u8fdc\u7a0b\u5907\u4efd\u5f52\u6863\uff0c\u7528 Rclone \u5c31\u5f88\u5408\u9002\u3002</p>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#23-restic","title":"2.3 Restic\u8bbe\u8ba1\u539f\u5219","text":"<p>Restic \u662f\u4e00\u4e2a\u53ef\u4ee5\u6b63\u786e\u8fdb\u884c\u5907\u4efd\u7684\u7a0b\u5e8f\uff0c\u5176\u8bbe\u8ba1\u9075\u5faa\u4ee5\u4e0b\u539f\u5219\uff1a </p> <ul> <li>\u7b80\u5355\uff1a\u5907\u4efd\u5e94\u8be5\u662f\u4e00\u4e2a\u987a\u7545\u7684\u8fc7\u7a0b\uff0c\u5426\u5219\u60a8\u53ef\u80fd\u4f1a\u60f3\u8df3\u8fc7\u5b83\u3002 Restic \u5e94\u8be5\u6613\u4e8e\u914d\u7f6e\u548c\u4f7f\u7528\uff0c\u4ee5\u4fbf\u5728\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u4ee5\u76f4\u63a5\u6062\u590d\u5b83\u3002\u540c\u6837\uff0c\u6062\u590d\u6570\u636e\u4e0d\u5e94\u8be5\u5f88\u590d\u6742\u3002 </li> <li>\u5feb\u901f\uff1a\u7528restic\u5907\u4efd\u4f60\u7684\u6570\u636e\u5e94\u8be5\u53ea\u53d7\u4f60\u7684\u7f51\u7edc\u6216\u786c\u76d8\u5e26\u5bbd\u7684\u9650\u5236\uff0c\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u6bcf\u5929\u5907\u4efd\u4f60\u7684\u6587\u4ef6\u3002\u5982\u679c\u9700\u8981\u592a\u591a\u65f6\u95f4\uff0c\u6ca1\u6709\u4eba\u4f1a\u8fdb\u884c\u5907\u4efd\u3002\u6062\u590d\u5907\u4efd\u5e94\u8be5\u53ea\u4f20\u8f93\u8981\u6062\u590d\u7684\u6587\u4ef6\u6240\u9700\u7684\u6570\u636e\uff0c\u8fd9\u6837\u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u5f88\u5feb\u3002 </li> <li>\u53ef\u9a8c\u8bc1\uff1a\u6bd4\u5907\u4efd\u66f4\u91cd\u8981\u7684\u662f\u6062\u590d\uff0c\u56e0\u6b64restic\u4f7f\u60a8\u53ef\u4ee5\u8f7b\u677e\u9a8c\u8bc1\u6240\u6709\u6570\u636e\u662f\u5426\u53ef\u4ee5\u6062\u590d\u3002</li> <li>\u5b89\u5168\uff1aRestic \u4f7f\u7528\u52a0\u5bc6\u6280\u672f\u6765\u4fdd\u8bc1\u60a8\u6570\u636e\u7684\u673a\u5bc6\u6027\u548c\u5b8c\u6574\u6027\u3002\u5047\u8bbe\u5b58\u50a8\u5907\u4efd\u6570\u636e\u7684\u4f4d\u7f6e\u4e0d\u662f\u53d7\u4fe1\u4efb\u7684\u73af\u5883\uff08\u4f8b\u5982\uff0c\u7cfb\u7edf\u7ba1\u7406\u5458\u7b49\u5176\u4ed6\u4eba\u80fd\u591f\u8bbf\u95ee\u60a8\u7684\u5907\u4efd\u7684\u5171\u4eab\u7a7a\u95f4\uff09\u3002 Restic \u65e8\u5728\u4fdd\u62a4\u60a8\u7684\u6570\u636e\u514d\u53d7\u6b64\u7c7b\u653b\u51fb\u8005\u7684\u4fb5\u5bb3\u3002 </li> <li>\u9ad8\u6548\uff1a\u968f\u7740\u6570\u636e\u7684\u589e\u957f\uff0c\u989d\u5916\u7684\u5feb\u7167\u5e94\u8be5\u53ea\u5360\u7528\u5b9e\u9645\u589e\u91cf\u7684\u5b58\u50a8\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0c\u5728\u5c06\u91cd\u590d\u6570\u636e\u5b9e\u9645\u5199\u5165\u5b58\u50a8\u540e\u7aef\u4e4b\u524d\uff0c\u5e94\u8be5\u5bf9\u5176\u8fdb\u884c\u53bb\u91cd\uff0c\u4ee5\u8282\u7701\u5b9d\u8d35\u7684\u5907\u4efd\u7a7a\u95f4\u3002</li> </ul>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#24","title":"2.4 \u76f8\u5173\u672f\u8bed","text":"<ul> <li> <p>Repository\uff1a\u5907\u4efd\u671f\u95f4\u4ea7\u751f\u7684\u6240\u6709\u6570\u636e\u90fd\u4ee5\u7ed3\u6784\u5316\u5f62\u5f0f\u53d1\u9001\u5e76\u5b58\u50a8\u5728\u5b58\u50a8\u5e93\u4e2d\uff0c\u4f8b\u5982\u5728\u5177\u6709\u591a\u4e2a\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\u7cfb\u7edf\u5c42\u6b21\u7ed3\u6784\u4e2d\u3002\u5b58\u50a8\u5e93\u5b9e\u73b0\u5fc5\u987b\u80fd\u591f\u5b8c\u6210\u8bb8\u591a\u64cd\u4f5c\uff0c\u4f8b\u5982\u5217\u51fa\u5185\u5bb9\u3002v0.12.0\u4e2d\u5df2\u652f\u6301\u7684\u5b58\u50a8\u670d\u52a1\u5305\u62ec\uff1aaws s3\uff0cminio server\uff0cWasabi\uff0c Aliyun OSS\uff0c OpenStack Swift\uff0cBacklbaze B2\uff0cAzure Blob Storage\uff0cGoogle Cloud Storage\uff0crclone*</p> </li> <li> <p>Blob\uff1aBlob \u5c06\u591a\u4e2a\u6570\u636e\u5b57\u8282\u4e0e\u8bc6\u522b\u4fe1\u606f\uff08\u5982\u6570\u636e\u7684 SHA-256 \u54c8\u5e0c\u53ca\u5176\u957f\u5ea6\uff09,\u52a0\u5bc6\u7684\u6570\u636e\u5757\u53ca\u5143\u6570\u636e\uff0c\u5176\u4e2d\u5143\u6570\u636e\u5305\u62ec\u957f\u5ea6\uff0cSHA-256 \u54c8\u5e0c\u4fe1\u606f\u3002\u6570\u636e\u5757\u53ef\u4ee5\u5b58\u653e\u6587\u4ef6\u6570\u636e\uff08data\uff09\uff0c\u4e5f\u53ef\u4ee5\u5b58\u653e\u76ee\u5f55\u7ed3\u6784\u6570\u636e\uff08tree\uff09\u3002Blob\u7684\u5927\u5c0f\u5728512KiB\u52308MiB\u4e4b\u95f4\uff0c\u56e0\u6b64\u5c0f\u4e8e512KB\u7684\u6587\u4ef6\u4e0d\u4f1a\u88ab\u62c6\u5206\u3002Restic\u7684\u5b9e\u73b0\u76ee\u6807\u662f\u8ba9Blob\u5e73\u5747\u5927\u5c0f\u4e3a1MiB\u3002</p> </li> <li> <p>Pack\uff1a\u4e00\u4e2a\u5305\u7ed3\u5408\u4e86\u4e00\u4e2a\u6216\u591a\u4e2a Blob\uff0c\u4f8b\u5982\u5728\u5355\u4e2a\u6587\u4ef6\u4e2d\u3002Restic\u4e2d\u7684\u5355\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u5305\u62ec\u4e00\u4e2a\u6216\u591a\u4e2aBlob\uff0c\u4e00\u65e6\u521b\u5efa\u4e0d\u518d\u4fee\u6539\u3002</p> </li> </ul> <p>\u4e00\u822c\u53ea\u521b\u5efa\u4e0d\u5220\u9664\uff0c\u4ec5prune\u64cd\u4f5c\u4f1a\u5220\u9664\u4e0d\u518d\u88ab\u5f15\u7528\u7684\u6570\u636e\u3002</p> <ul> <li> <p>Snapshot\uff1a\u5feb\u7167\u4ee3\u8868\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u5df2\u5907\u4efd\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u7684\u72b6\u6001\u3002\u8fd9\u91cc\u7684\u72b6\u6001\u662f\u6307\u5185\u5bb9\u548c\u5143\u6570\u636e\uff0c\u5982\u6587\u4ef6\u6216\u76ee\u5f55\u53ca\u5176\u5185\u5bb9\u7684\u540d\u79f0\u548c\u4fee\u6539\u65f6\u95f4\u3002</p> </li> <li> <p>Storage ID\uff1aPack\u6587\u4ef6\u7684SHA256\u54c8\u5e0c\u503c\uff0c\u901a\u8fc7\u8fd9\u4e2aID\u53ef\u4ee5\u5728\u4ed3\u5e93\u4e2d\u52a0\u8f7d\u9700\u8981\u7684\u6570\u636e\u6587\u4ef6\u3002Restic\u5c06\u8fd9\u4e2aID\u4f5c\u4e3aPack\u7684\u6587\u4ef6\u540d\uff0c\u4e5f\u5c31\u662f\u6587\u4ef6\u7684SHA256\u54c8\u5e0c\u503c\u3002Pack\u6587\u4ef6\u540d\u5373\u54c8\u5e0c\u503c\u7684\u8bbe\u8ba1\u4e5f\u53ef\u4ee5\u65b9\u4fbf\u7684\u68c0\u9a8c\u6570\u636e\u6587\u4ef6\u662f\u5426\u88ab\u6539\u52a8\u8fc7\u3002</p> </li> </ul>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#restic_2","title":"\u4e09 \u5b89\u88c5restic","text":""},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#31-yum","title":"3.1 yum\u5b89\u88c5","text":"<pre><code>yum install yum-plugin-copr\nyum copr enable copart/restic\nyum install restic\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#32-docker","title":"3.2 docker\u5b89\u88c5","text":"<pre><code>docker pull restic/restic\n</code></pre> <p>\u66f4\u591a\u4fe1\u606f\u53ef\u53c2\u8003\uff1ahttps://github.com/Lobaro/restic-backup-docker</p>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#33","title":"3.3 \u6e90\u7801\u5b89\u88c5","text":"<pre><code>$ git clone https://github.com/restic/restic\n\n$ cd restic\n\n$ go run build.go\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#34","title":"3.4 \u914d\u7f6e\u81ea\u52a8\u8865\u5168","text":"<pre><code>$ sudo ./restic generate --bash-completion /etc/bash_completion.d/restic\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#_2","title":"\u56db \u5b9e\u6218","text":"<p>\u5c06\u4fdd\u5b58\u5907\u4efd\u7684\u5730\u65b9\u79f0\u4e3a\u201c\u5b58\u50a8\u5e93\u201d\u3002\u672c\u7ae0\u89e3\u91ca\u4e86\u5982\u4f55\u521b\u5efa(\u201c init\u201d)\u8fd9\u6837\u7684\u5b58\u50a8\u5e93\u3002\u5b58\u50a8\u5e93\u53ef\u4ee5\u5b58\u50a8\u5728\u672c\u5730\uff0c\u4e5f\u53ef\u4ee5\u5b58\u50a8\u5728\u8fdc\u7a0b\u670d\u52a1\u5668\u6216\u670d\u52a1\u5668\u4e0a\u3002</p>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#41-sftp","title":"4.1 sftp\u4e3b\u673a\u95f4\u5907\u4efd","text":""},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#411","title":"4.1.1 \u4e3b\u673a\u95f4\u514d\u5bc6\u94a5\u4e92\u4fe1","text":"<p>\u4ece\u4e3b\u673aA\u5907\u4efd\u6570\u636e\u5230\u4e3b\u673aB\uff0c\u9700\u8981\u4e3b\u673aA\u5230\u4e3b\u673aB\u514d\u5bc6\u94a5\u548c\u4e92\u4fe1</p> <pre><code>ssh-keygen -t rsa\nssh-copy-id -i /root/.ssh/id_rsa.pub root@106.53.117.41\n</code></pre> <p></p>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#412-a","title":"4.1.2 \u5728\u670d\u52a1\u5668A\u521b\u5efa\u5907\u4efd","text":"<p>\u521d\u59cb\u5316\u5907\u4efd\uff0c/data\u4e3a B\u670d\u52a1\u5668\u76ee\u5f55\u3002</p> <p>\u67e5\u770bB\u670d\u52a1\u5668</p> <p></p>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#413","title":"4.1.3 \u5907\u4efd\u64cd\u4f5c","text":"<ul> <li>\u6267\u884c\u6570\u636e\u5907\u4efd</li> </ul> <pre><code>restic -r sftp:root@106.53.117.41:/data backup ./\n</code></pre> <ul> <li>\u67e5\u770b\u5907\u4efd</li> </ul> <pre><code>restic -r sftp:root@106.53.117.41:/data snapshots\n</code></pre> <ul> <li>\u67e5\u770b\u5907\u4efd\u5185\u5bb9</li> </ul> <pre><code>restic -r sftp:root@106.53.117.41:/data ls 875a2a32\n</code></pre> <ul> <li>\u6062\u590d\u5feb\u7167</li> </ul> <pre><code>restic -r sftp:root@106.53.117.41:/data restore 875a2a32 -t ./\nrestic -r sftp:root@106.53.117.41:/data restore 875a2a32 --target ./\n</code></pre> <ul> <li>\u5220\u9664\u5907\u4efd</li> </ul> <pre><code>restic -r sftp:root@106.53.117.41:/data forget 875a2a32\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#414","title":"4.1.4 \u514d\u5bc6\u7801","text":"<p>\u4e0a\u9762\u5907\u4efd\u7684\u65f6\u5019\uff0c\u90fd\u9700\u8981\u8f93\u5165\u5bc6\u7801\uff0c\u80af\u5b9a\u4e0d\u9002\u5408\u811a\u672c\u81ea\u52a8\u5907\u4efd\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u4f7f\u7528<code>--password-file</code>\u53c2\u6570\u6765\u8fbe\u5230\u81ea\u52a8\u8bfb\u53d6\u5bc6\u7801\u7684\u6b65\u9aa4\u3002</p> <pre><code>#\u5148\u5c06\u5bc6\u7801\uff0c\u6bd4\u5982moerats\u4fdd\u5b58\u5728/root/resticpasswd\u6587\u672c\u4e2d\necho 'xxzx@789' &gt; /root/resticpasswd\n#\u7136\u540e\u5728\u5907\u4efd\u547d\u4ee4\u4e2d\u52a0--password-file\u53c2\u6570\u6765\u8bfb\u53d6\u6587\u672c\u4e2d\u7684\u5bc6\u7801\uff0c\u8fd9\u91cc\u4ee5sftp\u4e3a\u4f8b\nrestic -r sftp:root@106.53.117.41:/data --verbose backup ./ --password-file /root/resticpasswd\n</code></pre>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#42","title":"4.2 \u5bf9\u8c61\u5b58\u50a8\u5907\u4efd","text":"<p>\u652f\u6301\u57fa\u4e8es3\u534f\u8bae\u7684\u540e\u7aef\u5bf9\u8c61\u5b58\u50a8\uff0c\u4f8b\u5982minio\u6216\u8005\u817e\u8baf/\u963f\u91cc\u5bf9\u8c61\u5b58\u50a8</p>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#421","title":"4.2.1 \u963f\u91cc\u4e91\u5bf9\u8c61\u5b58\u50a8","text":"<pre><code>$ export AWS_ACCESS_KEY_ID=&lt;YOUR-OSS-ACCESS-KEY-ID&gt;\n$ export AWS_SECRET_ACCESS_KEY=&lt;YOUR-OSS-SECRET-ACCESS-KEY&gt;\n\n$ ./restic -o s3.bucket-lookup=dns -o s3.region=&lt;OSS-REGION&gt; -r s3:https://&lt;OSS-ENDPOINT&gt;/&lt;OSS-BUCKET-NAME&gt; init\n$ restic -o s3.bucket-lookup=dns -o s3.region=oss-eu-west-1 -r s3:https://oss-eu-west-1.aliyuncs.com/bucketname init\n\nrestic -o s3.bucket-lookup=dns -o oss-cn-beijing.aliyuncs.com -r s3:https://xueltestoss.oss-cn-beijing.aliyuncs.com init\n</code></pre> <ul> <li>\u521b\u5efarepository</li> </ul> <pre><code>export AWS_ACCESS_KEY_ID=xxxxxxxxxxxxxxxxxxx\nexport AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxxxxx\nrestic -o s3.bucket-lookup=dns -o s3.region=oss-cn-beijing.aliyuncs.com -r s3:https://xueltestoss.oss-cn-beijing.aliyuncs.com/xueltestoss init\n</code></pre> <p>\u5bf9\u8c61\u5b58\u50a8\u4e0a\u6587\u4ef6</p> <p></p> <ul> <li>\u514d\u5bc6\u94a5</li> </ul> <pre><code>#\u5148\u5c06\u5bc6\u7801\uff0c\u6bd4\u5982moerats\u4fdd\u5b58\u5728/root/resticpasswd\u6587\u672c\u4e2d\necho 'xxzx@789' &gt; /root/resticpasswd\n#\u7136\u540e\u5728\u5907\u4efd\u547d\u4ee4\u4e2d\u52a0--password-file\u53c2\u6570\u6765\u8bfb\u53d6\u6587\u672c\u4e2d\u7684\u5bc6\u7801\uff0c\u8fd9\u91cc\u4ee5sftp\u4e3a\u4f8b\n</code></pre> <ul> <li>\u6267\u884c\u5907\u4efd</li> </ul> <pre><code>restic -r s3:https://oss-cn-beijing.aliyuncs.com/xueltestoss --password-file /root/resticpasswd backup /data/\n</code></pre> <p></p> <p>\u5176\u4ed6\u6062\u590d\u64cd\u4f5c\u57fa\u672c\u4e0a\u548csftp\u7684\u4e00\u81f4\u3002</p>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#_3","title":"\u5176\u4ed6","text":"<p>restic \u662f\u4e00\u4e2a\u5f88\u4e0d\u9519\u7684\u6570\u636e\u5907\u4efd\u65b9\u6848\uff0crclone\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u6570\u636e\u540c\u6b65\u65b9\u6848\uff0c\u4ee5\u53caminio\u4f5c\u4e3a\u6570\u636e\u5b58\u50a8\uff0c\u96c6\u6210\u5728\u4e00\u8d77\u771f\u7684\u5f88\u4e0d\u9519\u3002</p>"},{"location":"cloud-native/operator/tools/velero/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E4%B9%8Brestic/#_4","title":"\u53c2\u8003\u6587\u7ae0","text":"<ul> <li>https://restic.readthedocs.io/en/v0.12.0/design.html</li> <li>https://github.com/restic/restic</li> <li>https://restic.net/</li> </ul>"},{"location":"cloud-native/other/KEDA/","title":"KEDA\u521d\u63a2","text":""},{"location":"cloud-native/other/KEDA/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://keda.sh/</li> <li>https://github.com/kedacore/keda</li> </ul>"},{"location":"cloud-native/other/KubeEdge/","title":"KubeEdge\u521d\u63a2","text":""},{"location":"cloud-native/other/KubeEdge/#_1","title":"\u524d\u8a00","text":"<p>\u7269\u8054\u7f51\u5df2\u7ecf\u4ea7\u751f\u4e86\u6570\u91cf\u60ca\u4eba\u7684\u6570\u636e\uff0c\u968f\u77405G\u7f51\u7edc\u7684\u90e8\u7f72\uff0c\u8fd9\u4e9b\u6570\u636e\u5c06\u5448\u6307\u6570\u7ea7\u589e\u957f\u3002\u7ba1\u7406\u548c\u4f7f\u7528\u8fd9\u4e9b\u6570\u636e\u662f\u4e00\u4e2a\u6311\u6218\u3002</p> <p>\u65e0\u8bba\u662f\u4ece\u4ea4\u901a\u6444\u50cf\u5934\u3001\u6c14\u8c61\u4f20\u611f\u5668\u3001\u7535\u8868\u7b49\u4f1a\u4ea7\u751f\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u4e0e\u667a\u80fd\u57ce\u5e02\u73af\u5883\u4e2d\uff0c\u5176\u4ed6\u6444\u50cf\u5934\u548c\u4f20\u611f\u5668\u7684\u6570\u636e\u76f8\u7ed3\u5408\uff0c\u5728\u4e00\u4e2a\u4e2d\u5fc3\u4f4d\u7f6e\u5904\u7406\u8d77\u6765\u53ef\u80fd\u4f1a\u592a\u591a\uff0c\u5c24\u5176\u662f\u5f53\u4f60\u5728\u9884\u671f\u8bbe\u5907\u4f1a\u5bf9\u4e8b\u4ef6\u505a\u51fa\u53cd\u5e94\u65f6\u3002</p> <p>\u8d85\u5927\u89c4\u6a21\u4e91\u8ba1\u7b97\u73af\u5883\u4e2d\u5df2\u88ab\u666e\u904d\u4f7f\u7528\u7684Kubernetes\uff08\u7b80\u79f0K8s\uff09\uff0c\u5e26\u5165\u5230\u7269\u8054\u7f51\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\u4e2d\u3002**\u65b0\u6210\u7acb\u7684Kubernetes\u7269\u8054\u7f51\u8fb9\u7f18\u5de5\u4f5c\u7ec4\u5c06\u91c7\u7528\u8fd0\u884c\u5bb9\u5668\u7684\u7406\u5ff5\u5e76\u6269\u5c55\u5230\u8fb9\u7f18\uff0c\u4fc3\u8fdbK8s\u5728\u8fb9\u7f18\u73af\u5883\u4e2d\u7684\u9002\u7528\u3002</p> <ul> <li> <p>\u652f\u6301\u5c06\u5de5\u4e1a\u7269\u8054\u7f51IIoT\u7684\u8fde\u63a5\u8bbe\u5907\u6570\u91cf\u6269\u5c55\u5230\u767e\u4e07\u91cf\u7ea7\uff0c\u65e2\u53ef\u652f\u6301IP\u8bbe\u5907\u4ee5\u76f4\u8fde\u65b9\u5f0f\u63a5\u5165K8s\u4e91\u5e73\u53f0\uff0c\u53c8\u53ef\u652f\u6301\u975eIP\u8bbe\u5907\u901a\u8fc7\u7269\u8054\u7f51\u7f51\u5173\u63a5\u5165\u3002</p> </li> <li> <p>\u5229\u7528\u8fb9\u7f18\u8282\u70b9\uff0c\u8ba9\u8ba1\u7b97\u66f4\u8d34\u8fd1\u8bbe\u5907\u4fa7\uff0c\u4ee5\u4fbf\u51cf\u5c11\u5ef6\u8fdf\u3001\u964d\u4f4e\u5e26\u5bbd\u9700\u6c42\u548c\u63d0\u9ad8\u53ef\u9760\u6027\uff0c\u6ee1\u8db3\u7528\u6237\u5b9e\u65f6\u3001\u667a\u80fd\u3001\u6570\u636e\u805a\u5408\u548c\u5b89\u5168\u9700\u6c42\uff1a</p> </li> <li> <p>\u5c06\u6d41\u6570\u636e\u5e94\u7528\u90e8\u7f72\u5230\u8fb9\u7f18\u8282\u70b9\uff0c\u964d\u4f4e\u8bbe\u5907\u548c\u4e91\u5e73\u53f0\u4e4b\u95f4\u901a\u4fe1\u7684\u5e26\u5bbd\u9700\u6c42\u3002</p> </li> <li> <p>\u90e8\u7f72\u65e0\u670d\u52a1\u5668\u5e94\u7528\u6846\u67b6\uff0c\u4f7f\u5f97\u8fb9\u7f18\u4fa7\u65e0\u9700\u4e0e\u4e91\u7aef\u901a\u8baf\uff0c\u4fbf\u53ef\u5bf9\u67d0\u4e9b\u7d27\u6025\u60c5\u51b5\u505a\u51fa\u5feb\u901f\u54cd\u5e94\u3002</p> </li> <li> <p>\u5728\u6df7\u5408\u4e91\u548c\u8fb9\u7f18\u73af\u5883\u4e2d\u63d0\u4f9b\u901a\u7528\u63a7\u5236\u5e73\u53f0\uff0c\u4ee5\u7b80\u5316\u7ba1\u7406\u548c\u64cd\u4f5c\u3002</p> </li> </ul>"},{"location":"cloud-native/other/KubeEdge/#_2","title":"\u4e00 \u80cc\u666f","text":""},{"location":"cloud-native/other/KubeEdge/#11-kubeedge","title":"1.1 KubeEdge\u7b80\u4ecb","text":"<p>KubeEdge \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u7cfb\u7edf\uff0c\u53ef\u5c06\u672c\u673a\u5bb9\u5668\u5316\u5e94\u7528\u7f16\u6392\u548c\u7ba1\u7406\u6269\u5c55\u5230\u8fb9\u7f18\u7aef\u8bbe\u5907\u3002 \u5b83\u57fa\u4e8eKubernetes\u6784\u5efa\uff0c\u4e3a\u7f51\u7edc\u548c\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u6838\u5fc3\u57fa\u7840\u67b6\u6784\u652f\u6301\uff0c\u5e76\u5728\u4e91\u7aef\u548c\u8fb9\u7f18\u7aef\u90e8\u7f72\u5e94\u7528\uff0c\u540c\u6b65\u5143\u6570\u636e\u3002KubeEdge \u8fd8\u652f\u6301 MQTT \u534f\u8bae\uff0c\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u7f16\u5199\u5ba2\u6237\u903b\u8f91\uff0c\u5e76\u5728\u8fb9\u7f18\u7aef\u542f\u7528\u8bbe\u5907\u901a\u4fe1\u7684\u8d44\u6e90\u7ea6\u675f\u3002KubeEdge \u5305\u542b\u4e91\u7aef\u548c\u8fb9\u7f18\u7aef\u4e24\u90e8\u5206\u3002</p>"},{"location":"cloud-native/other/KubeEdge/#12-kubeedge","title":"1.2 KubeEdge\u7279\u70b9","text":""},{"location":"cloud-native/other/KubeEdge/#_3","title":"\u8fb9\u7f18\u8ba1\u7b97","text":"<p>\u901a\u8fc7\u5728\u8fb9\u7f18\u7aef\u8fd0\u884c\u4e1a\u52a1\u903b\u8f91\uff0c\u53ef\u4ee5\u5728\u672c\u5730\u4fdd\u62a4\u548c\u5904\u7406\u5927\u91cf\u6570\u636e\u3002KubeEdge \u51cf\u5c11\u4e86\u8fb9\u548c\u4e91\u4e4b\u95f4\u7684\u5e26\u5bbd\u8bf7\u6c42\uff0c\u52a0\u5feb\u54cd\u5e94\u901f\u5ea6\uff0c\u5e76\u4fdd\u62a4\u5ba2\u6237\u6570\u636e\u9690\u79c1\u3002</p>"},{"location":"cloud-native/other/KubeEdge/#_4","title":"\u7b80\u5316\u5f00\u53d1","text":"<p>\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u7f16\u5199\u5e38\u89c4\u7684\u57fa\u4e8e http \u6216 mqtt \u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5bb9\u5668\u5316\u5e76\u5728\u8fb9\u7f18\u6216\u4e91\u7aef\u4efb\u4f55\u5730\u65b9\u8fd0\u884c\u3002</p>"},{"location":"cloud-native/other/KubeEdge/#kubernetes","title":"Kubernetes \u539f\u751f\u652f\u6301","text":"<p>\u4f7f\u7528 KubeEdge \u7528\u6237\u53ef\u4ee5\u5728\u8fb9\u7f18\u8282\u70b9\u4e0a\u7f16\u6392\u5e94\u7528\u3001\u7ba1\u7406\u8bbe\u5907\u5e76\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f/\u8bbe\u5907\u72b6\u6001\uff0c\u5c31\u5982\u540c\u5728\u4e91\u7aef\u64cd\u4f5c Kubernetes \u96c6\u7fa4\u4e00\u6837\u3002</p>"},{"location":"cloud-native/other/KubeEdge/#_5","title":"\u4e30\u5bcc\u7684\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u7528\u6237\u53ef\u4ee5\u8f7b\u677e\u5730\u5c06\u590d\u6742\u7684\u673a\u5668\u5b66\u4e60\u3001\u56fe\u50cf\u8bc6\u522b\u3001\u4e8b\u4ef6\u5904\u7406\u7b49\u9ad8\u5c42\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u5230\u8fb9\u7f18\u7aef\u3002</p>"},{"location":"cloud-native/other/KubeEdge/#kubeedge_1","title":"\u4e8c KubeEdge\u7b80\u4ecb","text":""},{"location":"cloud-native/other/KubeEdge/#21-kubeedge","title":"2.1 KubeEdge\u67b6\u6784","text":""},{"location":"cloud-native/other/KubeEdge/#22","title":"2.2 \u67b6\u6784\u8be6\u89e3","text":""},{"location":"cloud-native/other/KubeEdge/#221","title":"2.2.1 \u4e91\u4e0a\u90e8\u5206","text":"<ul> <li>CloudHub: CloudHub \u662f\u4e00\u4e2a Web Socket \u670d\u52a1\u7aef\uff0c\u8d1f\u8d23\u76d1\u542c\u4e91\u7aef\u7684\u53d8\u5316, \u7f13\u5b58\u5e76\u53d1\u9001\u6d88\u606f\u5230 EdgeHub\u3002</li> <li>EdgeController: EdgeController \u662f\u4e00\u4e2a\u6269\u5c55\u7684 Kubernetes \u63a7\u5236\u5668\uff0c\u7ba1\u7406\u8fb9\u7f18\u8282\u70b9\u548c Pods \u7684\u5143\u6570\u636e\u786e\u4fdd\u6570\u636e\u80fd\u591f\u4f20\u9012\u5230\u6307\u5b9a\u7684\u8fb9\u7f18\u8282\u70b9\u3002</li> <li>DeviceController: DeviceController \u662f\u4e00\u4e2a\u6269\u5c55\u7684 Kubernetes \u63a7\u5236\u5668\uff0c\u7ba1\u7406\u8fb9\u7f18\u8bbe\u5907\uff0c\u786e\u4fdd\u8bbe\u5907\u4fe1\u606f\u3001\u8bbe\u5907\u72b6\u6001\u7684\u4e91\u8fb9\u540c\u6b65\u3002</li> </ul>"},{"location":"cloud-native/other/KubeEdge/#222","title":"2.2.2 \u8fb9\u7f18\u90e8\u5206","text":"<ul> <li>EdgeHub: EdgeHub \u662f\u4e00\u4e2a Web Socket \u5ba2\u6237\u7aef\uff0c\u8d1f\u8d23\u4e0e\u8fb9\u7f18\u8ba1\u7b97\u7684\u4e91\u670d\u52a1\uff08\u4f8b\u5982 KubeEdge \u67b6\u6784\u56fe\u4e2d\u7684 Edge Controller\uff09\u4ea4\u4e92\uff0c\u5305\u62ec\u540c\u6b65\u4e91\u7aef\u8d44\u6e90\u66f4\u65b0\u3001\u62a5\u544a\u8fb9\u7f18\u4e3b\u673a\u548c\u8bbe\u5907\u72b6\u6001\u53d8\u5316\u5230\u4e91\u7aef\u7b49\u529f\u80fd\u3002</li> <li>Edged: Edged \u662f\u8fd0\u884c\u5728\u8fb9\u7f18\u8282\u70b9\u7684\u4ee3\u7406\uff0c\u7528\u4e8e\u7ba1\u7406\u5bb9\u5668\u5316\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</li> <li>EventBus: EventBus \u662f\u4e00\u4e2a\u4e0e MQTT \u670d\u52a1\u5668\uff08mosquitto\uff09\u4ea4\u4e92\u7684 MQTT \u5ba2\u6237\u7aef\uff0c\u4e3a\u5176\u4ed6\u7ec4\u4ef6\u63d0\u4f9b\u8ba2\u9605\u548c\u53d1\u5e03\u529f\u80fd\u3002</li> <li>ServiceBus: ServiceBus\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u8fb9\u7f18\u7684HTTP\u5ba2\u6237\u7aef\uff0c\u63a5\u53d7\u6765\u81ea\u4e91\u4e0a\u670d\u52a1\u7684\u8bf7\u6c42\uff0c\u4e0e\u8fd0\u884c\u5728\u8fb9\u7f18\u7aef\u7684HTTP\u670d\u52a1\u5668\u4ea4\u4e92\uff0c\u63d0\u4f9b\u4e86\u4e91\u4e0a\u670d\u52a1\u901a\u8fc7HTTP\u534f\u8bae\u8bbf\u95ee\u8fb9\u7f18\u7aefHTTP\u670d\u52a1\u5668\u7684\u80fd\u529b\u3002</li> <li>DeviceTwin: DeviceTwin \u8d1f\u8d23\u5b58\u50a8\u8bbe\u5907\u72b6\u6001\u5e76\u5c06\u8bbe\u5907\u72b6\u6001\u540c\u6b65\u5230\u4e91\uff0c\u5b83\u8fd8\u4e3a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u67e5\u8be2\u63a5\u53e3\u3002</li> <li>MetaManager: MetaManager \u662f\u6d88\u606f\u5904\u7406\u5668\uff0c\u4f4d\u4e8e Edged \u548c Edgehub \u4e4b\u95f4\uff0c\u5b83\u8d1f\u8d23\u5411\u8f7b\u91cf\u7ea7\u6570\u636e\u5e93\uff08SQLite\uff09\u5b58\u50a8/\u68c0\u7d22\u5143\u6570\u636e\u3002</li> </ul>"},{"location":"cloud-native/other/KubeEdge/#_6","title":"\u4e09 \u5b9e\u6218\u90e8\u7f72","text":""},{"location":"cloud-native/other/KubeEdge/#31-keadm","title":"3.1 keadm\u90e8\u7f72","text":"<p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u76ee\u524d\u652f\u6301<code>keadm</code>Ubuntu \u548c CentOS \u64cd\u4f5c\u7cfb\u7edf\u3002RaspberryPi \u652f\u6301\u6b63\u5728\u8fdb\u884c\u4e2d\u3002</li> <li>\u9700\u8981\u8d85\u7ea7\u7528\u6237\u6743\u9650\uff08\u6216 root \u6743\u9650\uff09\u624d\u80fd\u8fd0\u884c\u3002</li> </ul>"},{"location":"cloud-native/other/KubeEdge/#311-kubeedge","title":"3.1.1 \u8bbe\u7f6e\u4e91\u7aef\uff08KubeEdge \u4e3b\u8282\u70b9\uff09","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b<code>10000</code>\uff0c<code>10002</code>\u8fb9\u7f18\u8282\u70b9\u9700\u8981\u53ef\u4ee5\u8bbf\u95ee Cloudcore \u4e2d\u7684\u7aef\u53e3\u548c\u7aef\u53e3\u3002</p> <p><code>keadm init</code>\u5c06\u5b89\u88c5 cloudcore\uff0c\u751f\u6210\u8bc1\u4e66\u5e76\u5b89\u88c5 CRD\u3002\u5b83\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u4ee5\u8bbe\u7f6e\u7279\u5b9a\u7248\u672c\u7684\u6807\u5fd7\u3002</p> <p>\u91cd\u8981\u8bf4\u660e\uff1a 1. kubeconfig \u6216 master \u4e2d\u81f3\u5c11\u4e00\u4e2a\u5fc5\u987b\u6b63\u786e\u914d\u7f6e\uff0c\u4ee5\u4fbf\u7528\u4e8e\u9a8c\u8bc1 k8s \u96c6\u7fa4\u7684\u7248\u672c\u548c\u5176\u4ed6\u4fe1\u606f\u30021.\u8bf7\u786e\u4fdd\u8fb9\u7f18\u8282\u70b9\u53ef\u4ee5\u4f7f\u7528\u4e91\u8282\u70b9\u7684\u672c\u5730IP\u8fde\u63a5\u4e91\u8282\u70b9\uff0c\u6216\u8005\u60a8\u9700\u8981\u4f7f\u7528<code>--advertise-address</code>\u6807\u5fd7\u6307\u5b9a\u4e91\u8282\u70b9\u7684\u516c\u5171IP \u30021. <code>--advertise-address</code>\uff081.3\u7248\u672c\u540e\u624d\u6709\u6548\uff09\u662f\u4e91\u7aef\u66b4\u9732\u7684\u5730\u5740\uff08\u4f1a\u52a0\u5165\u5230CloudCore\u8bc1\u4e66\u7684SAN\u4e2d\uff09\uff0c\u9ed8\u8ba4\u503c\u4e3a\u672c\u5730IP\u3002</p> <p>\u4f8b\u5b50\uff1a</p> <pre><code># keadm init --advertise-address=\"THE-EXPOSED-IP\"(only work since 1.3 release)\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>Kubernetes version verification passed, KubeEdge installation will start...\n...\nKubeEdge cloudcore is running, For logs visit:  /var/log/kubeedge/cloudcore.log\n</code></pre>"},{"location":"cloud-native/other/KubeEdge/#312-kubeedge","title":"3.1.2 \u8bbe\u7f6e\u8fb9\u7f18\u7aef\uff08KubeEdge \u5de5\u4f5c\u8282\u70b9\uff09","text":"<ul> <li>\u4ece\u4e91\u7aef\u83b7\u53d6\u4ee4\u724c</li> </ul> <p><code>keadm gettoken</code>\u5728**\u4e91\u7aef**\u8fd0\u884c\u5c06\u8fd4\u56de\u4ee4\u724c\uff0c\u8be5\u4ee4\u724c\u5c06\u5728\u52a0\u5165\u8fb9\u7f18\u8282\u70b9\u65f6\u4f7f\u7528\u3002</p> <pre><code># keadm gettoken\n27a37ef16159f7d3be8fae95d588b79b3adaaf92727b72659eb89758c66ffda2.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1OTAyMTYwNzd9.JBj8LLYWXwbbvHKffJBpPd5CyxqapRQYDIXtFZErgYE\n</code></pre> <ul> <li>\u52a0\u5165\u8fb9\u7f18\u8282\u70b9</li> </ul> <p><code>keadm join</code>\u5c06\u5b89\u88c5 edgecore \u548c mqtt\u3002\u5b83\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u4ee5\u8bbe\u7f6e\u7279\u5b9a\u7248\u672c\u7684\u6807\u5fd7\u3002</p> <p>\u4f8b\u5b50\uff1a</p> <pre><code># keadm join --cloudcore-ipport=192.168.20.50:10000 --token=27a37ef16159f7d3be8fae95d588b79b3adaaf92727b72659eb89758c66ffda2.eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1OTAyMTYwNzd9.JBj8LLYWXwbbvHKffJBpPd5CyxqapRQYDIXtFZErgYE\n</code></pre> <ul> <li>\u91cd\u8981\u8bf4\u660e\uff1a 1. <code>--cloudcore-ipport</code>flag \u662f\u5f3a\u5236\u6027\u6807\u5fd7\u30021. \u5982\u679c\u8981\u81ea\u52a8\u4e3a\u8fb9\u7f18\u8282\u70b9\u7533\u8bf7\u8bc1\u4e66\uff0c<code>--token</code>\u5219\u9700\u8981\u30021.\u4e91\u7aef\u548c\u8fb9\u7f18\u7aef\u4f7f\u7528\u7684kubeEdge\u7248\u672c\u8981\u4e00\u81f4\u3002</li> </ul> <p>\u8f93\u51fa\uff1a</p> <pre><code>Host has mosquit+ already installed and running. Hence skipping the installation steps !!!\n...\nKubeEdge edgecore is running, For logs visit:  /var/log/kubeedge/edgecore.log\n</code></pre>"},{"location":"cloud-native/other/KubeEdge/#32","title":"3.2 \u4e8c\u8fdb\u5236\u90e8\u7f72","text":"<p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u9700\u8981\u8d85\u7ea7\u7528\u6237\u6743\u9650\uff08\u6216 root \u6743\u9650\uff09\u624d\u80fd\u8fd0\u884c\u3002</li> </ul>"},{"location":"cloud-native/other/KubeEdge/#321-kubeedge","title":"3.2.1 \u8bbe\u7f6e\u4e91\u7aef\uff08KubeEdge \u4e3b\u8282\u70b9\uff09","text":"<ul> <li>\u521b\u5efa CRD</li> </ul> <pre><code>kubectl apply -f https://raw.githubusercontent.com/kubeedge/kubeedge/master/build/crds/devices/devices_v1alpha2_device.yaml\nkubectl apply -f https://raw.githubusercontent.com/kubeedge/kubeedge/master/build/crds/devices/devices_v1alpha2_devicemodel.yaml\nkubectl apply -f https://raw.githubusercontent.com/kubeedge/kubeedge/master/build/crds/reliablesyncs/cluster_objectsync_v1alpha1.yaml\nkubectl apply -f https://raw.githubusercontent.com/kubeedge/kubeedge/master/build/crds/reliablesyncs/objectsync_v1alpha1.yaml\n</code></pre> <ul> <li>\u51c6\u5907\u914d\u7f6e\u6587\u4ef6</li> </ul> <pre><code># cloudcore --minconfig &gt; cloudcore.yaml\n</code></pre> <p>\u8be6\u60c5\u8bf7\u53c2\u8003\u4e91\u914d\u7f6e\u3002</p> <ul> <li>\u8fd0\u884c</li> </ul> <pre><code># cloudcore --config cloudcore.yaml\n</code></pre>"},{"location":"cloud-native/other/KubeEdge/#322-kubeedge","title":"3.2.2 \u8bbe\u7f6e\u8fb9\u7f18\u7aef\uff08KubeEdge \u5de5\u4f5c\u8282\u70b9\uff09","text":""},{"location":"cloud-native/other/KubeEdge/#3221","title":"3.2.2.1 \u51c6\u5907\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li>\u751f\u6210\u914d\u7f6e\u6587\u4ef6</li> </ul> <pre><code># edgecore --minconfig &gt; edgecore.yaml\n</code></pre> <ul> <li>\u5728\u4e91\u7aef\u83b7\u53d6\u4ee3\u5e01\u503c\uff1a</li> </ul> <pre><code># kubectl get secret -nkubeedge tokensecret -o=jsonpath='{.data.tokendata}' | base64 -d\n</code></pre> <ul> <li>\u66f4\u65b0 edgecore \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u4ee4\u724c\u503c\uff1a</li> </ul> <pre><code># sed -i -e \"s|token: .*|token: ${token}|g\" edgecore.yaml\n</code></pre> <p>\u8fd9<code>token</code>\u5c31\u662f\u4e0a\u9762\u6b65\u9aa4\u5f97\u5230\u7684\u3002</p> <p>\u8be6\u60c5\u8bf7\u53c2\u8003edge\u7684\u914d\u7f6e\u3002</p>"},{"location":"cloud-native/other/KubeEdge/#3222","title":"3.2.2.2 \u8fd0\u884c","text":"<p>\u5982\u679c\u8981\u5728\u540c\u4e00\u53f0\u4e3b\u673a\u4e0a\u8fd0\u884c cloudcore \u548c edgecore\uff0c\u8bf7\u5148\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code># export CHECK_EDGECORE_ENVIRONMENT=\"false\"\n</code></pre> <p>\u542f\u52a8\u8fb9\u7f18\u6838\uff1a</p> <pre><code># edgecore --config edgecore.yaml\n</code></pre> <p>\u8fd0\u884c<code>edgecore -h</code>\u4ee5\u83b7\u53d6\u5e2e\u52a9\u4fe1\u606f\u5e76\u6839\u636e\u9700\u8981\u6dfb\u52a0\u9009\u9879\u3002</p>"},{"location":"cloud-native/other/KubeEdge/#_7","title":"\u56db \u53cd\u601d","text":"<p>K8s\u6b63\u5728\u5411\u8fb9\u7f18\u8ba1\u7b97\u6e17\u900f\uff0c\u5b83\u4e3a\u8fb9\u7f18\u4fa7\u7684\u5e94\u7528\u90e8\u7f72\u63d0\u4f9b\u4e86\u4fbf\u5229\u6027\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u8f6c\u53d8\u4e86\u8fb9\u7f18\u5e94\u7528\u4e0e\u786c\u4ef6\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u5c06\u4e24\u8005\u7684\u8026\u5408\u5ea6\u964d\u4f4e\u3002\u901a\u8fc7KubeEdge\uff0c\u62d3\u5c55\u201c\u8fb9\u7f18\u573a\u666f\u201d\uff0c\u53ef\u5e2e\u52a9\u7528\u6237\u52a0\u901f\u5b9e\u73b0\u4e91\u8fb9\u534f\u540c\uff0c\u5728\u6d77\u91cf\u8fb9\u3001\u7aef\u8bbe\u5907\u4e0a\u5b8c\u6210\u5927\u89c4\u6a21\u5e94\u7528\u7684\u7edf\u4e00\u4ea4\u4ed8\u3001\u8fd0\u7ef4\u4e0e\u7ba1\u63a7\u3002</p> <p>\u636eGartner\u4f30\u8ba1\uff0c\u52302025\u5e74\uff0c\u8d85\u8fc775%\u7684\u4f01\u4e1a\u751f\u6210\u6570\u636e\u53ef\u4ee5\u5728\u4f20\u7edf\u6570\u636e\u4e2d\u5fc3\u548c\u4e91\u4e4b\u5916\u521b\u5efa\u548c\u5904\u7406\uff0c\u50cfKubernetes\u8fd9\u6837\u7684\u7f16\u6392\u7cfb\u7edf\u524d\u666f\u5149\u660e\uff0c\u5b83\u5df2\u7ecf\u88ab\u8bc1\u660e\u662f\u5b8c\u6210\u8fd9\u4e00\u4efb\u52a1\u7684\u6700\u4f73\u5de5\u5177\u3002</p>"},{"location":"cloud-native/other/KubeEdge/#_8","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>https://github.com/kubeedge/kubeedge/blob/master/README_zh.md</li> <li>https://www.cncf.io/blog/2020/09/25/kubernetes-could-be-the-one-to-make-the-internet-of-things-iot-reach-its-potential/</li> </ul>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/","title":"Kubectl\u63d2\u4ef6\u5f00\u53d1\u53ca\u5f00\u6e90\u53d1\u5e03\u5206\u4eab","text":""},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#_1","title":"\u524d\u8a00","text":"<p>\u5341\u5e74\u4e91\u8ba1\u7b97\u6d6a\u6f6e\u4e0b\uff0cDevOps\u3001\u5bb9\u5668\u3001\u5fae\u670d\u52a1\u7b49\u6280\u672f\u98de\u901f\u53d1\u5c55\uff0c\u4e91\u539f\u751f\u6210\u4e3a\u6f6e\u6d41\u3002\u4f01\u4e1a\u4e91\u5316\u4ece\u201cON Cloud\u201d\u8d70\u5411\u201cIN Cloud\u201d\uff0c\u6210\u4e3a\u201c\u65b0\u4e91\u539f\u751f\u4f01\u4e1a\u201d\uff0c\u65b0\u751f\u80fd\u529b\u4e0e\u65e2\u6709\u80fd\u529b\u7acb\u800c\u4e0d\u7834\u3001\u6709\u673a\u534f\u540c\uff0c\u5b9e\u73b0\u8d44\u6e90\u9ad8\u6548\u3001\u5e94\u7528\u654f\u6377\u3001\u4e1a\u52a1\u667a\u80fd\u3001\u5b89\u5168\u53ef\u4fe1\u3002\u6574\u4e2a\u4e91\u539f\u751f\u6982\u5ff5\u5f88\u5927\uff0c\u7ec6\u5316\u5230\u53ef\u80fd\u662f\u6211\u4eec\u5728\u771f\u5b9e\u573a\u666f\u4e2d\u9047\u5230\u7684\u4e00\u4e9b\u5c0f\u95ee\u9898\uff0c\u672c\u6587\u5c31\u9488\u5bf9\u65e5\u5e38\u5de5\u4f5c\u4e2d\u9047\u5230\u7684\u81ea\u5df1\u7684\u5c0f\u9700\u6c42\uff0c\u53ca\u89e3\u51b3\u601d\u8def\u65b9\u6cd5\uff0c\u5206\u4eab\u7ed9\u5927\u5bb6\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#_2","title":"\u4e00 \u80cc\u666f","text":"<p>\u5728\u6211\u65e5\u5e38\u4f7f\u7528kubectl\u67e5\u770bk8s\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u60f3\u76f4\u63a5\u67e5\u770b\u5bf9\u5e94\u8d44\u6e90\u7684\u5bb9\u5668\u540d\u79f0\u548c\u955c\u50cf\u540d\u79f0\uff0c\u76ee\u524dkubectl\u8fd8\u4e0d\u652f\u6301\u8be5\u9009\u578b\uff0c\u9700\u8981\u6211\u4eecdescribe\u7136\u540e\u6765\u67e5\u770b\uff0c\u5bf9\u4e8e\u96c6\u7fa4\u81ea\u5df1\u6bd4\u8f83\u591a\uff0c\u4e0d\u662f\u5f88\u65b9\u4fbf\uff0c\u56e0\u6b64\u840c\u751f\u4e86\u81ea\u5df1\u5f00\u53d1kubectl \u63d2\u4ef6\u6765\u5b9e\u73b0\u8be5\u529f\u80fd\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#_3","title":"\u4e8c \u76f8\u5173\u6280\u672f","text":"<p>\u9996\u5148\u9700\u8981\u8c03\u7528kubernetes\u9700\u8981\u4f7f\u7528client-go\u9879\u76ee\u6765\u5b9e\u73b0\u5bf9Kubernetes\u8d44\u6e90\u7684\u83b7\u53d6\uff0c\u5bf9\u4e8e\u63d2\u4ef6\u4f7f\u7528Golang\u8bed\u8a00\u5f00\u53d1\uff0c\u56e0\u4e3a\u662f\u5ba2\u6237\u7aef\u6267\u884c\uff0c\u4e3a\u4e86\u65b9\u4fbf\u96c6\u6210\u5230\u53ca\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u91c7\u7528\u548cK8s\u76f8\u540c\u7684\u547d\u4ee4\u884c\u811a\u624b\u67b6\u5de5\u5177Cobra\uff0c\u6700\u540e\u5c06\u5176\u5f00\u6e90\u53d1\u5e03\u5230Github\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#21-golang","title":"2.1 Golang","text":"<p>\u5728\u4e91\u539f\u751f\u5f00\u53d1\u4e2d\uff0cGoogle\u975e\u5e38\u591a\u7684\u5f00\u6e90\u9879\u76ee\u90fd\u662f\u4f7f\u7528Golang\u5f00\u53d1\uff0c\u5176\u8de8\u5e73\u53f0\u7f16\u8bd1\u540e\u53ef\u4ee5\u53d1\u5e03\u5230\u591a\u4e2a\u5e73\u53f0\uff0c\u6211\u4eec\u5f00\u53d1\u7684\u63d2\u4ef6\u57fa\u4e8eGolang\uff0c\u540e\u7eed\u4e5f\u5c31\u652f\u6301\u591a\u5e73\u53f0\u4f7f\u7528\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#22-cobra","title":"2.2 Cobra","text":"<p>Cobra\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u7a0b\u5e8f\u5e93\uff0c\u5176\u662f\u4e00\u4e2a\u7528\u6765\u7f16\u5199\u547d\u4ee4\u884c\u7684\u795e\u5668\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u811a\u624b\u67b6\uff0c\u7528\u4e8e\u5feb\u901f\u751f\u6210\u57fa\u4e8eCobra\u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528Cobra\u5feb\u901f\u7684\u53bb\u5f00\u53d1\u51fa\u6211\u4eec\u60f3\u8981\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u975e\u5e38\u7684\u65b9\u4fbf\u5feb\u6377\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#23-client-go","title":"2.3 Client-go","text":"<p>\u5728K8s\u8fd0\u7ef4\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528kubectl\u3001\u5ba2\u6237\u7aef\u5e93\u6216\u8005REST\u8bf7\u6c42\u6765\u8bbf\u95eeK8S API\u3002\u800c\u5b9e\u9645\u4e0a\uff0c\u65e0\u8bba\u662fkubectl\u8fd8\u662f\u5ba2\u6237\u7aef\u5e93\uff0c\u90fd\u662f\u5c01\u88c5\u4e86REST\u8bf7\u6c42\u7684\u5de5\u5177\u3002client-go\u4f5c\u4e3a\u4e00\u4e2a\u5ba2\u6237\u7aef\u5e93\uff0c\u80fd\u591f\u8c03\u7528K8S API\uff0c\u5b9e\u73b0\u5bf9K8S\u96c6\u7fa4\u4e2d\u8d44\u6e90\u5bf9\u8c61\uff08\u5305\u62ecdeployment\u3001service\u3001ingress\u3001replicaSet\u3001pod\u3001namespace\u3001node\u7b49\uff09\u7684\u589e\u5220\u6539\u67e5\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#24-krew","title":"2.4 krew","text":"<p>Krew \u662f \u7c7b\u4f3c\u4e8e\u7cfb\u7edf\u7684apt\u3001dnf\u6216\u8005brew\u7684 kubectl\u63d2\u4ef6\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u5229\u7528\u5176\u53ef\u4ee5\u8f7b\u677e\u7684\u5b8c\u6210kubectl \u63d2\u4ef6\u7684\u5168\u4e0a\u9762\u5468\u671f\u7ba1\u7406\uff0c\u5305\u62ec\u641c\u7d22\u3001\u4e0b\u8f7d\u3001\u5378\u8f7d\u7b49\u3002</p> <p>kubectl \u5176\u5de5\u5177\u5df2\u7ecf\u6bd4\u8f83\u5b8c\u5584\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e00\u4e9b\u4e2a\u6027\u5316\u7684\u547d\u4ee4\uff0c\u5176\u5b97\u65e8\u662f\u5e0c\u671b\u5f00\u53d1\u8005\u80fd\u4ee5\u72ec\u7acb\u800c\u7d27\u5f20\u5f62\u5f0f\u53d1\u5e03\u81ea\u5b9a\u4e49\u7684kubectl\u5b50\u547d\u4ee4\uff0c\u63d2\u4ef6\u7684\u5f00\u53d1\u8bed\u8a00\u4e0d\u9650\uff0c\u9700\u8981\u5c06\u6700\u7ec8\u7684\u811a\u6b65\u6216\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u7a0b\u5e8f\u4ee5<code>kubectl-</code> \u7684\u524d\u7f00\u547d\u540d\uff0c\u7136\u540e\u653e\u5230PATH\u4e2d\u5373\u53ef\uff0c\u53ef\u4ee5\u4f7f\u7528<code>kubectl plugin list</code>\u67e5\u770b\u76ee\u524d\u5df2\u7ecf\u5b89\u88c5\u7684\u63d2\u4ef6\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#24-github","title":"2.4 Github\u53d1\u5e03\u76f8\u5173\u5de5\u5177","text":"<ul> <li>Github Action</li> </ul> <p>\u5982\u679c\u4f60\u9700\u8981\u67d0\u4e2a action\uff0c\u4e0d\u5fc5\u81ea\u5df1\u5199\u590d\u6742\u7684\u811a\u672c\uff0c\u76f4\u63a5\u5f15\u7528\u4ed6\u4eba\u5199\u597d\u7684 action \u5373\u53ef\uff0c\u6574\u4e2a\u6301\u7eed\u96c6\u6210\u8fc7\u7a0b\uff0c\u5c31\u53d8\u6210\u4e86\u4e00\u4e2a actions \u7684\u7ec4\u5408\u3002Github\u662f\u505a\u4e86\u4e00\u4e2a\u5546\u5e97\u7684\u529f\u80fd\u3002\u8fd9\u6837\u5927\u5bb6\u5c31\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\u81ea\u5df1\u7684Action\uff0c\u7136\u540e\u65b9\u4fbf\u522b\u4eba\u590d\u7528\u3002\u540c\u65f6\u4e5f\u53ef\u4ee5\u7edf\u4e00\u81ea\u5df1\u7684\u6216\u8005\u7ec4\u7ec7\u5728\u6784\u5efa\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u516c\u5171\u6d41\u7a0b\u3002</p> <ul> <li>gorelease</li> </ul> <p>GoReleaser \u91c7\u7528 Golang \u5f00\u53d1\uff0c\u662f\u4e00\u6b3e\u7528\u4e8e Golang \u9879\u76ee\u7684\u81ea\u52a8\u53d1\u5e03\u5de5\u5177\u3002\u65e0\u9700\u592a\u591a\u914d\u7f6e\uff0c\u53ea\u9700\u8981\u51e0\u884c\u547d\u4ee4\u5c31\u53ef\u4ee5\u8f7b\u677e\u5b9e\u73b0\u8de8\u5e73\u53f0\u7684\u5305\u7f16\u8bd1\u3001\u6253\u5305\u548c\u53d1\u5e03\u5230 Github\u3001Gitlab \u7b49\u7248\u672c\u4ed3\u5e93\u79cd\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#_4","title":"\u4e09 \u63d2\u4ef6\u89c4\u5212","text":"<ul> <li>\u63d2\u4ef6\u547d\u540d\u4e3a\uff1akubectl-img</li> <li>\u76ee\u524d\u4ec5\u7b80\u5355\u5b9e\u73b0\u4e00\u4e2aimage\u547d\u4ee4\uff0c\u7528\u4e8e\u67e5\u770b\u4e0d\u540c\u8d44\u6e90\u5bf9\u8c61(deployments/daemonsets/statefulsets/jobs/cronjobs)\u7684\u540d\u79f0\uff0c\u548c\u5bf9\u5e94\u5bb9\u5668\u540d\u79f0\uff0c\u955c\u50cf\u540d\u79f0\u3002</li> <li>\u652f\u6301json\u683c\u5f0f\u8f93\u51fa\u3002</li> <li>\u6700\u540e\u5c06\u5176\u4f5c\u4e3akrew\u63d2\u4ef6\u4f7f\u7528\u3002</li> <li>\u53ef\u4ee5\u76f4\u63a5\u6839\u636e\u540d\u79f0\u7a7a\u95f4\u6765\u8fdb\u884c\u67e5\u770b\u5bf9\u5e94\u8d44\u6e90\u3002</li> </ul>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#_5","title":"\u56db \u5f00\u53d1","text":""},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#41","title":"4.1 \u9879\u76ee\u521d\u59cb\u5316","text":"<ul> <li>\u5b89\u88c5cobra</li> </ul> <p>\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u5b89\u88c5cobra\uff0c\u540e\u53bb\u57fa\u4e8e\u6539\u547d\u4ee4\u884c\u5de5\u5177\u6765\u751f\u6210\u9879\u76ee\u811a\u624b\u67b6\uff0cK8s\u4e2d\u5f88\u591a\u7ec4\u5efa\u4e5f\u662f\u7528\u7684\u6539\u6846\u67b6\u6765\u751f\u6210\u7684\u3002</p> <pre><code>go get -v github.com/spf13/cobra/cobra \n</code></pre> <ul> <li>\u521d\u59cb\u5316\u9879\u76ee</li> </ul> <pre><code>$ cobra init --pkg-name kubectl-img\n$ ls\nLICENSE cmd     main.go\n$ tree\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 cmd\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 root.go\n\u2514\u2500\u2500 main.go\n</code></pre> <ul> <li>\u521b\u5efago mod\uff0c\u4e0b\u8f7d\u76f8\u5173\u5305</li> </ul> <pre><code>go mod init github.com/redhatxl/kubectl-img\n</code></pre>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#42","title":"4.2 \u589e\u52a0\u5b50\u547d\u4ee4","text":"<p>\u589e\u52a0\u4e00\u4e2a\u5b50\u547d\u4ee4image\uff0c\u5728\u6b64\u4e3a\u6211\u4eec\u7684\u63d2\u4ef6\u6dfb\u52a0\u5b50\u547d\u4ee4\u3002</p> <pre><code>$ cobra add image\n</code></pre>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#43","title":"4.3 \u6dfb\u52a0\u53c2\u6570","text":"<p>\u901a\u8fc7\u5b50\u547d\u4ee4+flag\u5f62\u5f0f\uff0c\u663e\u793a\u4e0d\u540c\u7684\u8d44\u6e90\u955c\u50cf\u540d\u79f0\u3002</p> <pre><code>func Execute() {\n    cobra.CheckErr(rootCmd.Execute())\n}\n\nfunc init() {\n    KubernetesConfigFlags = genericclioptions.NewConfigFlags(true)\n    imageCmd.Flags().BoolP(\"deployments\", \"d\", false, \"show deployments image\")\n    imageCmd.Flags().BoolP(\"daemonsets\", \"e\", false, \"show daemonsets image\")\n    imageCmd.Flags().BoolP(\"statefulsets\", \"f\", false, \"show statefulsets image\")\n    imageCmd.Flags().BoolP(\"jobs\", \"o\", false, \"show jobs image\")\n    imageCmd.Flags().BoolP(\"cronjobs\", \"b\", false, \"show cronjobs image\")\n    imageCmd.Flags().BoolP(\"json\", \"j\", false, \"show json format\")\n    KubernetesConfigFlags.AddFlags(rootCmd.PersistentFlags())\n}\n</code></pre>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#44-image","title":"4.4 \u5b9e\u73b0image\u547d\u4ee4","text":"<p>\u6ce8\u518c\u5b50\u547d\u4ee4\uff0c\u5e76\u4fee\u6539\u547d\u4ee4\u4f7f\u7528\u8bf4\u660e\u3002</p> <pre><code>var imageCmd = &amp;cobra.Command{\n    Use:   \"image\",\n    Short: \"show resource image\",\n    Long:  `show k8s resource image`,\n    RunE:  image,\n}\n\nfunc init() {\n    rootCmd.AddCommand(imageCmd)\n}\n</code></pre>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#45-clientset","title":"4.5 \u521d\u59cb\u5316clientset","text":"<p>\u7531\u4e8e\u9700\u8981\u8c03\u7528K8s\u8d44\u6e90\uff0c\u5728\u6b64\u6211\u4eec\u4f7f\u7528Client-go\u4e2d\u7684ClientSet\u6765\u6839\u636e\u7528\u6237\u8f93\u5165\u7684\u4e0d\u540cflag\u6765\u83b7\u53d6\u4e0d\u540c\u7684\u8d44\u6e90\u955c\u50cf\u3002</p> <pre><code>// ClientSet k8s clientset\nfunc ClientSet(configFlags *genericclioptions.ConfigFlags) *kubernetes.Clientset {\n    config, err := configFlags.ToRESTConfig()\n    if err != nil {\n        panic(\"kube config load error\")\n    }\n    clientSet, err := kubernetes.NewForConfig(config)\n    if err != nil {\n\n        panic(\"gen kube config error\")\n    }\n    return clientSet\n}\n</code></pre>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#46","title":"4.6 \u5b9e\u73b0\u67e5\u770b\u8d44\u6e90\u5bf9\u8c61","text":"<p>\u5229\u7528\u53cd\u5c04\u5b9e\u73b0\u6839\u636e\u4e0d\u540c\u8d44\u6e90\u7c7b\u578b\u67e5\u770b\u5177\u4f53\u5bf9\u5e94\u8d44\u6e90\u955c\u50cf\u53ca\u955c\u50cf\u540d\u79f0\u529f\u80fd\u3002</p> <pre><code>func image(cmd *cobra.Command, args []string) error {\n\n    clientSet := kube.ClientSet(KubernetesConfigFlags)\n    ns, _ := rootCmd.Flags().GetString(\"namespace\")\n    // \u751f\u547d\u4e00\u4e2a\u5168\u5c40\u8d44\u6e90\u5217\u8868\n    var rList []interface{}\n\n    if flag, _ := cmd.Flags().GetBool(\"deployments\"); flag {\n        deployList, err := clientSet.AppsV1().Deployments(ns).List(context.Background(), v1.ListOptions{})\n        if err != nil {\n            fmt.Printf(\"list deployments error: %s\", err.Error())\n        }\n        rList = append(rList, deployList)\n    }\n  ...\n    deployMapList := make([]map[string]string, 0)\n    for i := 0; i &lt; len(rList); i++ {\n        switch t := rList[i].(type) {\n        case *kv1.DeploymentList:\n            for k := 0; k &lt; len(t.Items); k++ {\n                for j := 0; j &lt; len(t.Items[k].Spec.Template.Spec.Containers); j++ {\n                    deployMap := make(map[string]string)\n                    deployMap[\"NAMESPACE\"] = ns\n                    deployMap[\"TYPE\"] = \"deployment\"\n                    deployMap[\"RESOURCE_NAME\"] = t.Items[k].GetName()\n                    deployMap[\"CONTAINER_NAME\"] = t.Items[k].Spec.Template.Spec.Containers[j].Name\n                    deployMap[\"IMAGE\"] = t.Items[k].Spec.Template.Spec.Containers[j].Image\n                    deployMapList = append(deployMapList, deployMap)\n                }\n            }\n</code></pre>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#46_1","title":"4.6 \u5b9e\u73b0\u8f93\u51fa","text":"<p>\u5229\u7528table\u6765\u5bf9\u7ed3\u679c\u8fdb\u884c\u8f93\u51fa,\uff0c\u540c\u6837\u6269\u5c55json\u8f93\u51fa</p> <pre><code>func GenTable(mapList []map[string]string) *table.Table {\n    t, err := gotable.Create(title...)\n    if err != nil {\n        fmt.Printf(\"create table error: %s\", err.Error())\n        return nil\n    }\n    t.AddRows(mapList)\n    return t\n}\n</code></pre> <p>\u6700\u7ec8\u9879\u76ee\u7ed3\u6784\uff1a</p> <p></p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#47-krew","title":"4.7 \u96c6\u6210krew","text":"<p>\u9700\u8981\u5c06\u6700\u7ec8\u7684\u811a\u6b65\u6216\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u7a0b\u5e8f\u4ee5<code>kubectl-</code> \u7684\u524d\u7f00\u547d\u540d\uff0c\u7136\u540e\u653e\u5230PATH\u4e2d\u5373\u53ef\uff0c\u53ef\u4ee5\u4f7f\u7528<code>kubectl plugin list</code>\u67e5\u770b\u76ee\u524d\u5df2\u7ecf\u5b89\u88c5\u7684\u63d2\u4ef6\u3002</p> <pre><code>$ kubectl plugin list\nThe following compatible plugins are available:=\n/usr/local/bin/kubectl-debug\n  - warning: kubectl-debug overwrites existing command: \"kubectl debug\"\n/usr/local/bin/kubectl-v1.10.11\n/usr/local/bin/kubectl-v1.20.0\n/Users/xuel/.krew/bin/kubectl-df_pv\n/Users/xuel/.krew/bin/kubectl-krew\n\n# \u5c06\u81ea\u5df1\u5f00\u53d1\u7684\u63d2\u4ef6\u91cd\u65b0\u547d\u540d\u4e3akubectl-img\u653e\u5230\u53ef\u6267\u884c\u8def\u57fa\u4e0b\n$ cp kubectl-img /Users/xuel/.krew/bin/kubectl-img\n\n$ kubectl plugin list\nThe following compatible plugins are available:=\n/usr/local/bin/kubectl-debug\n  - warning: kubectl-debug overwrites existing command: \"kubectl debug\"\n/usr/local/bin/kubectl-v1.10.11\n/usr/local/bin/kubectl-v1.20.0\n/Users/xuel/.krew/bin/kubectl-df_pv\n/Users/xuel/.krew/bin/kubectl-krew\n/Users/xuel/.krew/bin/kubectl-img\n</code></pre>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#49","title":"4.9 \u4f7f\u7528","text":"<pre><code>$ kubectl img image -h\nshow k8s resource image\n\nUsage:\n  kubectl-img image [flags]\n\nFlags:\n  -b, --cronjobs       show cronjobs image\n  -e, --daemonsets     show daemonsets image\n  -d, --deployments    show deployments image\n  -h, --help           help for image\n  -o, --jobs           show jobs image\n  -j, --json           show json format\n  -f, --statefulsets   show statefulsets image\n\nGlobal Flags:\n      --as string                      Username to impersonate for the operation\n      --as-group stringArray           Group to impersonate for the operation, this flag can be repeated to specify multiple groups.\n      --cache-dir string               Default cache directory (default \"/Users/xuel/.kube/cache\")\n      --certificate-authority string   Path to a cert file for the certificate authority\n      --client-certificate string      Path to a client certificate file for TLS\n      --client-key string              Path to a client key file for TLS\n      --cluster string                 The name of the kubeconfig cluster to use\n      --context string                 The name of the kubeconfig context to use\n      --insecure-skip-tls-verify       If true, the server's certificate will not be checked for validity. This will make your HTTPS connections insecure\n      --kubeconfig string              Path to the kubeconfig file to use for CLI requests.\n  -n, --namespace string               If present, the namespace scope for this CLI request\n      --request-timeout string         The length of time to wait before giving up on a single server request. Non-zero values should contain a corresponding time unit (e.g. 1s, 2m, 3h). A value of zero means don't timeout requests. (default \"0\")\n  -s, --server string                  The address and port of the Kubernetes API server\n      --tls-server-name string         Server name to use for server certificate validation. If it is not provided, the hostname used to contact the server is used\n      --token string                   Bearer token for authentication to the API server\n      --user string                    The name of the kubeconfig user to use\n</code></pre> <ul> <li>\u67e5\u770b\u8d44\u6e90</li> </ul> <pre><code># View the images of all deployments of the entire kubernetes cluster\nkubectl img image --deployments\n# View the images of all deployments of the entire kubernetes cluster\nkubectl img image --deployments -n default\n</code></pre> <ul> <li>\u67e5\u770b\u6240\u6709\u8d44\u6e90</li> </ul> <pre><code># view all resource \nkubectl img image -bedof\n</code></pre> <ul> <li>json\u683c\u5f0f\u8f93\u51fa</li> </ul> <pre><code># Table display is used by default\nkubectl img image --deployments -n default -j\n</code></pre>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#_6","title":"\u4e94 \u5f00\u6e90\u53d1\u5e03","text":"<p>\u5b8c\u6210\u4ee3\u7801\u7f16\u5199\u540e\uff0c\u4e3a\u4e86\u66f4\u591a\u670b\u53cb\u5b66\u4e60\u4ea4\u6d41\uff0c\u5c06\u5176\u53d1\u5e03\u5230github\u4e0a\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#51-github-action","title":"5.1 Github Action","text":"<p>\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u521b\u5efa.github/workflows/ci.yml\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b</p> <pre><code>name: ci\non:\n  push:\n  pull_request:\njobs:\n  goreleaser:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@master\n      - name: Setup Go\n        uses: actions/setup-go@v1\n        with:\n          go-version: 1.16\n      - name: GoReleaser\n        uses: goreleaser/goreleaser-action@v1\n        with:\n          version: latest\n          args: release --snapshot --rm-dist\n</code></pre> <p></p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#52-go-report-card","title":"5.2 GO Report Card","text":"<p>\u6dfb\u52a0go\u9879\u76ee\u62a5\u544a\uff1ahttps://goreportcard.com/</p> <p></p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#53-goreleaser","title":"5.3 GoReleaser","text":"<p>\u5bf9\u4e8egolang\u9879\u76ee\uff0c\u53ef\u4ee5\u4f7f\u7528GoReleaser\u6765\u53d1\u5e03\u4e00\u4e2a\u6f02\u4eae\u7684release\u3002</p> <p>\u7531\u4e8e\u4f7f\u7528\u7684\u7684 MacOS \uff0c\u8fd9\u91cc\u4f7f\u7528 <code>brew</code> \u6765\u5b89\u88c5\uff1a</p> <pre><code>brew install goreleaser\n</code></pre> <p>\u5728\u9879\u76ee\u6839\u76ee\u5f55\u751f\u6210 <code>.goreleaser.yml</code> \u914d\u7f6e\uff1a</p> <pre><code>goreleaser init\n</code></pre> <p>\u914d\u7f6e\u597d\u4e86\u4ee5\u540e\u8981\u8bb0\u5f97\u5f80 <code>.gitignore</code> \u52a0\u4e0a <code>dist</code>\uff0c\u56e0\u4e3a goreleaser \u4f1a\u9ed8\u8ba4\u628a\u7f16\u8bd1\u7f16\u8bd1\u597d\u7684\u6587\u4ef6\u8f93\u51fa\u5230 <code>dist</code> \u76ee\u5f55\u4e2d\u3002</p> <pre><code># This is an example .goreleaser.yml file with some sensible defaults.\n# Make sure to check the documentation at https://goreleaser.com\nbefore:\n  hooks:\n    # You may remove this if you don't use go modules.\n    - go mod tidy\n    # you may remove this if you don't need go generate\n    - go generate ./...\nbuilds:\n  - env:\n      - CGO_ENABLED=0\n    goos:\n      - linux\n      - windows\n      - darwin\narchives:\n  - replacements:\n      darwin: Darwin\n      linux: Linux\n      windows: Windows\n      386: i386\n      amd64: x86_64\nchecksum:\n  name_template: 'checksums.txt'\nsnapshot:\n  name_template: \"{{ incpatch .Version }}-next\"\nchangelog:\n  sort: asc\n  filters:\n    exclude:\n      - '^docs:'\n      - '^test:'\n\nproject_name: kubectl-img\n</code></pre> <p>goreleaser \u914d\u7f6e\u597d\u540e\uff0c\u53ef\u4ee5\u5148\u7f16\u8bd1\u6d4b\u8bd5\u4e00\u4e0b\uff1a</p> <p>\u6ce8\u610f\uff1a \u9996\u6b21\u4f7f\u7528 goreleaser \u8981\u914d\u7f6e GITHUB_TOKEN \uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u7533\u8bf7\uff0c\u7533\u8bf7\u597d\u4e4b\u540e\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u914d\u7f6e <code>GITHUB_TOKEN</code></p> <pre><code>export GITHUB_TOKEN=&lt;YOUR_TOKEN&gt;\n</code></pre> <p>\u786e\u4fdd\u6ca1\u6709\u95ee\u9898\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u64cd\u4f5c git \u548c goreleaser \u6765\u53d1\u5e03 release \u4e86\u3002</p> <pre><code>git add .\ngit commit -m \"add goreleaser\"\ngit tag -a v0.0.2 -m \"First release\"\ngit push origin main\ngit push origin v0.0.2\n</code></pre> <p>\u5168\u90e8\u641e\u5b9a\u540e\uff0c\u4e00\u884c\u547d\u4ee4\u8d77\u98de\uff1a</p> <pre><code>$ goreleaser release --rm-dist\n   \u2022 releasing...     \n   \u2022 loading config file       file=.goreleaser.yaml\n   \u2022 loading environment variables\n   \u2022 getting and validating git state\n      \u2022 building...               commit=98703b3b9d9ac7f4661c5669c1e164d2cf3675d2 latest tag=v1.0.0\n   \u2022 parsing tag      \n   \u2022 running before hooks\n      \u2022 running                   hook=go mod tidy\n      \u2022 running                   hook=go generate ./...\n   \u2022 setting defaults \n      \u2022 DEPRECATED: skipped windows/arm64 build on Go &lt; 1.17 for compatibility, check https://goreleaser.com/deprecations/#builds-for-windowsarm64 for more info.\n   \u2022 checking distribution directory\n      \u2022 --rm-dist is set, cleaning it up\n   \u2022 loading go mod information\n   \u2022 build prerequisites\n   \u2022 writing effective config file\n      \u2022 writing                   config=dist/config.yaml\n   \u2022 generating changelog\n      \u2022 writing                   changelog=dist/CHANGELOG.md\n   \u2022 building binaries\n      \u2022 building                  binary=/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/kubectl-img/dist/kubectl-img_linux_386/kubectl-img\n      \u2022 building                  binary=/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/kubectl-img/dist/kubectl-img_linux_amd64/kubectl-img\n      \u2022 building                  binary=/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/kubectl-img/dist/kubectl-img_darwin_arm64/kubectl-img\n      \u2022 building                  binary=/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/kubectl-img/dist/kubectl-img_linux_arm64/kubectl-img\n      \u2022 building                  binary=/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/kubectl-img/dist/kubectl-img_windows_amd64/kubectl-img.exe\n      \u2022 building                  binary=/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/kubectl-img/dist/kubectl-img_windows_386/kubectl-img.exe\n      \u2022 building                  binary=/Users/xuel/workspace/goworkspace/src/github.com/kaliarch/kubectl-img/dist/kubectl-img_darwin_amd64/kubectl-img\n   \u2022 archives         \n      \u2022 creating                  archive=dist/kubectl-img_1.0.0_Linux_i386.tar.gz\n      \u2022 creating                  archive=dist/kubectl-img_1.0.0_Darwin_x86_64.tar.gz\n      \u2022 creating                  archive=dist/kubectl-img_1.0.0_Linux_x86_64.tar.gz\n      \u2022 creating                  archive=dist/kubectl-img_1.0.0_Windows_x86_64.tar.gz\n      \u2022 creating                  archive=dist/kubectl-img_1.0.0_Linux_arm64.tar.gz\n      \u2022 creating                  archive=dist/kubectl-img_1.0.0_Windows_i386.tar.gz\n      \u2022 creating                  archive=dist/kubectl-img_1.0.0_Darwin_arm64.tar.gz\n   \u2022 calculating checksums\n   \u2022 storing release metadata\n      \u2022 writing                   file=dist/artifacts.json\n      \u2022 writing                   file=dist/metadata.json\n   \u2022 publishing       \n      \u2022 scm releases     \n         \u2022 creating or updating release repo=redhatxl/kubectl-img tag=v1.0.0\n         \u2022 release updated           url=https://github.com/redhatxl/kubectl-img/releases/tag/v1.0.0\n         \u2022 uploading to release      file=dist/checksums.txt name=checksums.txt\n         \u2022 uploading to release      file=dist/kubectl-img_1.0.0_Linux_i386.tar.gz name=kubectl-img_1.0.0_Linux_i386.tar.gz\n         \u2022 uploading to release      file=dist/kubectl-img_1.0.0_Linux_x86_64.tar.gz name=kubectl-img_1.0.0_Linux_x86_64.tar.gz\n         \u2022 uploading to release      file=dist/kubectl-img_1.0.0_Windows_i386.tar.gz name=kubectl-img_1.0.0_Windows_i386.tar.gz\n         \u2022 uploading to release      file=dist/kubectl-img_1.0.0_Linux_arm64.tar.gz name=kubectl-img_1.0.0_Linux_arm64.tar.gz\n         \u2022 uploading to release      file=dist/kubectl-img_1.0.0_Darwin_x86_64.tar.gz name=kubectl-img_1.0.0_Darwin_x86_64.tar.gz\n         \u2022 uploading to release      file=dist/kubectl-img_1.0.0_Windows_x86_64.tar.gz name=kubectl-img_1.0.0_Windows_x86_64.tar.gz\n         \u2022 uploading to release      file=dist/kubectl-img_1.0.0_Darwin_arm64.tar.gz name=kubectl-img_1.0.0_Darwin_arm64.tar.gz\n   \u2022 announcing       \n   \u2022 release succeeded after 183.24s\n</code></pre> <p>\u67e5\u770b\u53d1\u5e03\u597d\u7684release</p> <p></p> <p>\u5728\u9879\u76eeReadme\u4e2d\u6dfb\u52a0\u4e0d\u540c\u5e73\u53f0\u7684\u5b89\u88c5\u65b9\u5f0f\u3002</p> <p>Linux</p> <pre><code>export release=v1.0.0\ncurl -L -o kubectl-img.tar.gz https://github.com/redhatxl/kubectl-img/releases/download/${release}/kubectl-img_${release}_Linux_arm64.tar.gz\ntar -xvf kubectl-img.tar.gz\ncp kubectl-img /usr/local/bin/kubectl-img\n# use kubectl krew\ncp kubectl-img $HOME/.krew/bin\n</code></pre> <p>OSX</p> <pre><code>export release=v1.0.0\ncurl -L -o kubectl-img.tar.gz https://github.com/redhatxl/kubectl-img/releases/download/${release}/kubectl-img_${release}_Darwin_x86_64.tar.gz\ntar -xvf kubectl-img.tar.gz\nmv kubectl-img /usr/local/bin/kubectl-img\n# use kubectl krew\ncp kubectl-img $HOME/.krew/bin\n</code></pre> <p>Windows</p> <p>In PowerShell v5+</p> <pre><code>$url = \"https://github.com/redhatxl/kubectl-img/releases/download/v1.0.0/kubectl-img_1.0.0_Windows_x86_64.tar.gz\"\n$output = \"$PSScriptRoot\\kubectl-img.zip\"\n\nInvoke-WebRequest -Uri $url -OutFile $output\nExpand-Archive \"$PSScriptRoot\\kubectl-img.zip\" -DestinationPath \"$PSScriptRoot\\kubectl-img\"\n</code></pre>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#54-badges","title":"5.4 Badges \u5c55\u793a\u795e\u5668","text":"<p>\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e2a\u5c55\u793a Badges \u7684\u795e\u5668\uff1ahttps://shields.io/ \u3002\u8fd9\u4e2a\u7f51\u7ad9\u63d0\u4f9b\u5404\u79cd\u5404\u6837\u7684 Badges \uff0c\u5982\u679c\u4f60\u613f\u610f\uff0c\u5b8c\u5168\u53ef\u4ee5\u628a\u4f60\u7684 GitHub README.md \u586b\u6ee1\uff0c\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u81ea\u53d6\u3002</p> <p></p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#_7","title":"\u516d \u603b\u7ed3","text":"<p>\u76ee\u524d\u5b9e\u73b0\u7684\u6bd4\u8f83\u7b80\u5355\uff0c\u4ee5\u6b64\u6765\u629b\u7816\u5f15\u7389\u7684\u529f\u80fd\uff0c\u540e\u671f\u53ef\u4ee5\u8fdb\u884c\u66f4\u591a\u529f\u80fd\u6216\u5176\u4ed6\u63d2\u4ef6\u7684\u5f00\u53d1\uff0c\u81ea\u5df1\u52a8\u624b\u4e30\u8863\u8db3\u98df\u3002\u4ece\u6280\u672f\u89d2\u5ea6\u770b\uff0c\u4ee5\u5bb9\u5668\u3001\u5fae\u670d\u52a1\u4ee5\u53ca\u52a8\u6001\u7f16\u6392\u4e3a\u4ee3\u8868\u7684\u4e91\u539f\u751f\u6280\u672f\u84ec\u52c3\u53d1\u5c55\uff0c\u6210\u4e3a\u8d4b\u80fd\u4e1a\u52a1\u521b\u65b0\u7684\u91cd\u8981\u63a8\u52a8\u529b\uff0c\u5e76\u5df2\u7ecf\u5e94\u7528\u5230\u4f01\u4e1a\u6838\u5fc3\u4e1a\u52a1\u3002\u4ece\u5e02\u573a\u89d2\u5ea6\u770b\uff0c\u4e91\u539f\u751f\u6280\u672f\u5df2\u5728\u91d1\u878d\u3001\u5236\u9020\u3001\u4e92\u8054\u7f51\u7b49\u591a\u4e2a\u884c\u4e1a\u5f97\u5230\u5e7f\u6cdb\u9a8c\u8bc1\uff0c\u652f\u6301\u7684\u4e1a\u52a1\u573a\u666f\u4e5f\u6108\u52a0\u4e30\u5bcc\uff0c\u884c\u4e1a\u751f\u6001\u65e5\u6e10\u7e41\u8363\u3002</p> <p>\u672c\u6587\u4ece\u65e5\u5e38\u5de5\u4f5c\u4e2d\u6700\u5c0f\u7684\u5207\u5165\u70b9\uff0c\u4ece0\u52301\u5b9e\u6218K8s\u63d2\u4ef6\u5f00\u53d1\u5e76\u5f00\u6e90\u7684\u601d\u8def\u53ca\u8fc7\u7a0b\uff0c\u5e0c\u671b\u76f8\u5173\u540c\u5b66\u53ef\u4ee5\u4e00\u5757\u4ea4\u6d41\u5b66\u4e60\u3002\u6700\u8fd1\u7531\u4e8e\u4e1a\u52a1\u5f00\u53d1Operator\uff0c\u4e5f\u5728\u7814\u8bfbK8s\u63a7\u5236\u5668\u76f8\u5173\u4ee3\u7801\uff0c\u5e76\u505a\u4e86\u4e00\u4e9b\u81ea\u5df1\u7684\u7b14\u8bb0\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u4e00\u5757\u4ea4\u6d41\u5b66\u4e60\uff0c\u535a\u5ba2\u5730\u5740:kaliarch blog\u3002</p>"},{"location":"cloud-native/other/Kubectl%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%8F%8A%E5%BC%80%E6%BA%90%E5%88%86%E4%BA%AB/#_8","title":"\u5176\u4ed6","text":"<ul> <li>kubectl-img</li> </ul>"},{"location":"cloud-native/other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/","title":"Kubernetes\u5f00\u53d1\u6392\u9519\u6742\u8bb0","text":""},{"location":"cloud-native/other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/#kubernetes","title":"Kubernetes\u5f00\u53d1\u6392\u9519\u6742\u8bb0","text":""},{"location":"cloud-native/other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/#_1","title":"\u524d\u8a00","text":"<p>\u5728\u4e91\u539f\u751f\u5f00\u53d1\u4e2d\uff0c\u56de\u9047\u5230\u5f88\u591a\u6bd4\u8f83\u7ec6\u5c0f\u7684\u70b9\uff0c\u5728\u6b64\u5355\u72ec\u8bb0\u5f55\u3002</p>"},{"location":"cloud-native/other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/#pod","title":"\u4e00 \u5355\u4e2aPOD\u5305\u542b\u591a\u4e2a\u5bb9\u5668","text":"<p>\u5728\u5229\u7528client-go\u5f00\u53d1K8s\u521b\u5efaPOD\u65f6\u5019\uff0c\u4e00\u4e2aPOD\u5305\u542b\u591a\u4e2a\u5bb9\u5668\uff0c\u7ecf\u8fc7\u6d4b\u8bd5\uff0cContainer\u5217\u8868\u4e0e\u987a\u5e8f\u6709\u5173\uff0c\u7b2c\u4e00\u4e2acontainer\u9700\u8981\u65f6\u4e3b\u5bb9\u5668\uff0c\u8981\u6709\u4e00\u5b9a\u7684\u5148\u540e\u987a\u5e8f\u3002</p> <p></p>"},{"location":"cloud-native/other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/#_2","title":"\u4e8c \u4f20\u9012\u5b57\u6bb5\u7c7b\u578b\u9700\u8981\u8fdb\u884c\u8f6c\u6362","text":"<p>\u6216\u8005\u4f7f\u7528\"k8s.io/utils/pointer\"\u4e2d\u7684\u5177\u4f53\u7c7b\u578b\u8f6c\u6307\u9488</p> <p></p>"},{"location":"cloud-native/other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/#podserviceaccount","title":"\u4e09 \u521b\u5efapod\u67e5\u770b\u6ca1\u6709\u6302\u8f7dserviceaccount","text":"<p>\u9700\u8981\u5728pod\u7684spec\u6307\u5b9a<code>AutomountServiceAccountToken</code>\u4e3atrue</p> <p></p> <p></p>"},{"location":"cloud-native/other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/#todo","title":"\u56db TODO","text":""},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/","title":"Kubernetes\u751f\u6210kubeconfig","text":""},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5728\u516c\u53f8\u4e2d\uff0c\u4e3a\u5f00\u53d1\u4eba\u5458\u548c\u56e2\u961f\u521b\u5efa\u9694\u79bb\u73af\u5883\u975e\u5e38\u6709\u7528\uff0c\u5c24\u5176\u662f\u5bf9\u4e8e\u57f9\u8bad\u3002 \u5982\u679c\u60a8\u6b63\u5728\u8003\u8651 Kubernetes\uff0c\u60a8\u9700\u8981\u786e\u4fdd\u5f00\u53d1\u4eba\u5458\u5bf9\u5b83\u611f\u5230\u6ee1\u610f\uff0c\u5e76\u4e3a\u4ed6\u4eec\u63d0\u4f9b\u4e00\u4e2a\u5b89\u5168\u7684\u5730\u65b9\u73a9\u800d\u5c06\u6709\u52a9\u4e8e\u4ed6\u4eec\u638c\u63e1\u8be5\u6280\u672f\u3002</p> <p>\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u5c24\u5176\u5982\u6b64\uff0c\u60a8\u9700\u8981\u5728\u9694\u79bb\u73af\u5883\u4e2d\u6d4b\u8bd5\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u7136\u540e\u518d\u5c06\u5176\u53d1\u5e03\u7ed9\u5176\u4ed6\u56e2\u961f\u4f7f\u7528\u3002 \u5f53\u5de5\u4f5c\u8d1f\u8f7d\u592a\u91cd\u800c\u65e0\u6cd5\u5728\u5355\u53f0\u7b14\u8bb0\u672c\u7535\u8111\u4e0a\u8fd0\u884c\u65f6\uff0c\u5b83\u4e5f\u5f88\u6709\u7528\uff08\u4f8b\u5982\uff1a\u6d4b\u8bd5\u673a\u5668\u5b66\u4e60\u7b97\u6cd5\uff09\u3002</p> <p>\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\uff0c\u7136\u540e\u4f7f\u7528 Kubernetes \u7684\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236 (RBAC) \u7cfb\u7edf\u521b\u5efa\u4e00\u4e2a\u53ea\u80fd\u8bbf\u95ee\u8be5\u7279\u5b9a\u547d\u540d\u7a7a\u95f4\u7684\u670d\u52a1\u5e10\u6237\u3002 \u6700\u540e\uff0c\u6211\u4eec\u5c06\u5bfc\u51fa\u8bbf\u95ee\u8be5\u547d\u540d\u7a7a\u95f4\u6240\u9700\u7684\u914d\u7f6e\u3002</p>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#rbac","title":"\u4e8c RBAC\u7b80\u4ecb","text":"<p>RBAC\u91cc\u9762\u7684\u51e0\u79cd\u8d44\u6e90\u5173\u7cfb\u56fe</p> <pre><code>                  |--- Role --- RoleBinding                \u53ea\u5728\u6307\u5b9anamespace\u4e2d\u751f\u6548\nServiceAccount ---|\n                  |--- ClusterRole --- ClusterRoleBinding  \u4e0d\u53d7namespace\u9650\u5236\uff0c\u5728\u6574\u4e2aK8s\u96c6\u7fa4\u4e2d\u751f\u6548\n</code></pre>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#_2","title":"\u4e09 \u5b9e\u6218","text":""},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#31-ns","title":"3.1 \u521b\u5efans","text":"<pre><code>kubectl create namespace mynamespace\n</code></pre>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#32","title":"3.2 \u4f7f\u7528\u6743\u9650\u521b\u5efa\u670d\u52a1\u8d26\u6237","text":"<pre><code>cat &gt; access.yaml&lt;&lt; EOF\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: mynamespace-user\n  namespace: mynamespace\n\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: mynamespace-user-full-access\n  namespace: mynamespace\nrules:\n- apiGroups: [\"\", \"extensions\", \"apps\"]\n  resources: [\"*\"]\n  verbs: [\"*\"]\n- apiGroups: [\"batch\"]\n  resources:\n  - jobs\n  - cronjobs\n  verbs: [\"*\"]\n\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: mynamespace-user-view\n  namespace: mynamespace\nsubjects:\n- kind: ServiceAccount\n  name: mynamespace-user\n  namespace: mynamespace\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: mynamespace-user-full-access\nEOF\n</code></pre> <p>\u5982\u60a8\u6240\u89c1\uff0c\u5728 Role \u5b9a\u4e49\u4e2d\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86\u5bf9\u8be5\u547d\u540d\u7a7a\u95f4\u4e2d\u6240\u6709\u5185\u5bb9\u7684\u5b8c\u5168\u8bbf\u95ee\u6743\u9650\uff0c\u5305\u62ec\u8bf8\u5982\u4f5c\u4e1a\u6216 cronjob \u4e4b\u7c7b\u7684\u6279\u5904\u7406\u7c7b\u578b\u3002 \u56e0\u4e3a\u5b83\u662f\u4e00\u4e2a\u89d2\u8272\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a ClusterRole\uff0c\u6240\u4ee5\u5b83\u5c06\u88ab\u5e94\u7528\u4e8e\u5355\u4e2a\u547d\u540d\u7a7a\u95f4\uff1amynamespace\u3002 \u6709\u5173 Kubernetes \u4e2d\u89d2\u8272\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b\u5b98\u65b9\u6587\u6863\u3002</p> <pre><code>kubectl create -f access.yaml\n</code></pre>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#33-secret","title":"3.3 \u83b7\u53d6secret","text":"<p>\u521b\u5efasa\u7528\u6237\u540e\uff0c\u7cfb\u7edf\u4f1a\u4e3asa\u521b\u5efa\u5bf9\u5e94\u7684secret\u3002</p> <p>\u6211\u4eec\u73b0\u5728\u9700\u8981\u505a\u7684\u7b2c\u4e00\u4ef6\u4e8b\u662f\u83b7\u53d6\u670d\u52a1\u5e10\u6237\u7684\u79d8\u5bc6\u540d\u79f0\u3002\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5e76\u590d\u5236\u5bc6\u94a5\u7684\u540d\u79f0\u3002</p> <pre><code>$ kubectl describe sa mynamespace-user -n mynamespace\n\nName:                mynamespace-user\nNamespace:           mynamespace\nLabels:              &lt;none&gt;\nAnnotations:         &lt;none&gt;\nImage pull secrets:  &lt;none&gt;\nMountable secrets:   mynamespace-user-token-tncrk\nTokens:              mynamespace-user-token-tncrk\nEvents:              &lt;none&gt;\n$ skubectl get secret -n mynamespace\nNAME                           TYPE                                  DATA   AGE\nmynamespace-user-token-tncrk   kubernetes.io/service-account-token   3      16m\n</code></pre> <p>\u6211\u4eec\u73b0\u5728\u9700\u8981\u83b7\u53d6\u670d\u52a1\u5e10\u6237\u7684\u4ee4\u724c\u548c\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 kubectl \u8bfb\u53d6\u5b83\u4eec\u3002\u73b0\u5728\uff0c\u7531\u4e8e Kubernetes \u7684\u79d8\u5bc6\u662f base64 \u7f16\u7801\u7684\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5bf9\u5b83\u4eec\u8fdb\u884c\u89e3\u7801</p>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#331-token","title":"3.3.1 \u83b7\u53d6token","text":"<pre><code>kubectl get secret mynamespace-user-token-xxxxx -n mynamespace -o \"jsonpath={.data.token}\" | base64 -D\n\nkubectl get secret -n mynamespace mynamespace-user-token-tncrk -o \"jsonpath={.data.token}\" |base64 -D\neyJhbGciOiJSUzI1NiIsImtpZCI6Ik1fVDJTS1NhM0V1enlHTGFuN3BfNGZmOVM2bm9RTmdLZjlqWlpnbzA3ZEEifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJteW5hbWVzcGFjZSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJteW5hbWVzcGFjZS11c2VyLXRva2VuLXRuY3JrIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6Im15bmFtZXNwYWNlLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIzNTcxNDg4YS1mOTc5LTQ1YjMtOTE4ZS1jNjJkYmJhYzlmMjIiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6bXluYW1lc3BhY2U6bXluYW1lc3BhY2UtdXNlciJ9.oTghGOFPxyv0cJhQnrD7NdxPsil2JVZedJw5oIlHvlgY7B5ZMYbwhj9qd01GuZ5mjgiqKQJfndsf0fRziUR2TmgM4BQM-4MP8DJKG4eLW9zJx7pvrnFR-Ktf89AK-jHkmKg-yP7WS940NxeYctANh-sR4LJzJ-tRExNSOx54ZLW-dn4TuDo1pXj1DtOrHJsvhrP0CFaQWNTV1gDlucIKGo4dCU0LRiE1P1bgaHI4GBLTP2ez9VYtG24j9LLksvKWgWHu7zOKJlA2g1UDfgfrhu7dZltrhEbObLvu6hP57gSPSxH94ibSGAGhOWmAobqaxcKvGNqhbNO6KnmCjsFAqg%\n</code></pre>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#332-ca","title":"3.3.2 \u83b7\u53d6ca","text":"<pre><code>kubectl get secrets mynamespace-user-token-tncrk -n mynamespace  -o \"jsonpath={.data['ca\\.crt']}\"\nLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJeE1URXhOREF5TkRnME5sb1hEVE14TVRFeE1qQXlORGcwTmxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBS2dPClpZdUdQWFVTc1ZWejBRSmRlTzNLK2JNQjl1TWNkc2xuTUlYdmI5Rmt3WjNCbjRNTHZaYUFrTC9RT2tNdkhEU1MKOTV4RElPTXRDZmJHWElKbEFJZ3YySUpTRUF6YmNNRE5hb2ZwZmpBVXVzUXd6TUhkdjVoRzRJbkg1UzRGdVFMaAp6Vm5jV1lFTDFORDFFZy9hWnMrTDFJemtGSHc1N1J3Q3hBY3dJcDY4azdLeFUyN24yOHYrVzVCY29HVWR0NGVoCkVaYVFOcGpNamRic3dHa1QwQVlLNFNWc1B2dDY5a2RsYlJld3gzYms5UEpYUFRqeWNkNmFMbUtDQk0yU1M0Q3EKbkJUM2NmS2l6ZGFza3VBTkFmWWQ4S0h4NE9rSXBMSHErM2JSeDltWDZYOUpXS1JIWVppM0VMZTVZa1NRcGQ3ZAo3ZXRKVmpsV0pFa3UwS3E5cW5VQ0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZMK2Q0NDdvMmpPbXN4dmE5TG5wTHpWVjdoRlFNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFCQlRnT2NPeVduWHJ5RTZ2YS9HNGlTU3c0MGZpNUZ2VnY0N0JMT0FBYUFjeURTNzFraQpnYmVERC9maUVSVkxWbi82Z1ZoektkaDRvMHZwaUxjNEZGejBhV1lhQlN6RVpnS1N5YzV5ejVxSndTNlJ4MjhSCmU5dEpsRUFWM3BYbXNTT3ppY2hRdVdiWkQ1NVFTT3ZXaEsvd3AveGxzR3ZEZSt4S0VMUmJTTGJmNzNCZzZvQ1gKTnZWWi9hSmovbk04WXhJOFZidzd1czZpK1FFMVRCVmpWZU1jSGlpTDByUlpnNkhEejY5THR4Qk1kRW9WQlJmbAp6TXdybE5laDJmbzFjTHpsRU1sVHIzUU93ZC9Rd0IyQ1MwcTZVOGRoZ1pVYkpTVmhWMHBCYVFDRmpLTS9jamFpCm96ajcvc2tUYjVhaDVqQVFqbFZBQi83cjlWVHk1U253eUg0QQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==%\n</code></pre>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#34-kubeconfig","title":"3.4 \u521b\u5efakubeconfig","text":"<p>\u6211\u4eec\u73b0\u5728\u62e5\u6709\u6240\u9700\u7684\u4e00\u5207\u3002\u5269\u4e0b\u7684\u552f\u4e00\u4e8b\u60c5\u5c31\u662f\u4f7f\u7528\u6211\u4eec\u4e4b\u524d\u6536\u96c6\u7684\u6570\u636e\u521b\u5efa Kube \u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>apiVersion: v1\nkind: Config\npreferences: {}\n\n# Define the cluster\nclusters:\n- cluster:\n    certificate-authority-data: PLACE CERTIFICATE HERE\n    # You'll need the API endpoint of your Cluster here:\n    server: https://YOUR_KUBERNETES_API_ENDPOINT\n  name: my-cluster\n\n# Define the user\nusers:\n- name: mynamespace-user\n  user:\n    as-user-extra: {}\n    client-key-data: PLACE CERTIFICATE HERE\n    token: PLACE USER TOKEN HERE\n\n# Define the context: linking a user to a cluster\ncontexts:\n- context:\n    cluster: my-cluster\n    namespace: mynamespace\n    user: mynamespace-user\n  name: mynamespace\n\n# Define current context\ncurrent-context: mynamespace\n</code></pre>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#_3","title":"\u56db \u4e00\u952e\u811a\u672c","text":""},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#41-namespacekube-config","title":"4.1 \u521b\u5efa\u5bf9\u6307\u5b9anamespace\u6709\u6240\u6709\u6743\u9650\u7684kube-config","text":"<pre><code>#!/bin/bash\n#\n# This Script based on  https://jeremievallee.com/2018/05/28/kubernetes-rbac-namespace-user.html\n# K8s'RBAC doc:         https://kubernetes.io/docs/reference/access-authn-authz/rbac\n# Gitlab'CI/CD doc:     hhttps://docs.gitlab.com/ee/user/permissions.html#running-pipelines-on-protected-branches\n#\n# In honor of the remarkable Windson\n\nBASEDIR=\"$(dirname \"$0\")\"\nfolder=\"$BASEDIR/kube_config\"\n\necho -e \"All namespaces is here: \\n$(kubectl get ns|awk 'NR!=1{print $1}')\"\necho \"endpoint server if local network you can use $(kubectl cluster-info |awk '/Kubernetes/{print $NF}')\"\n\nnamespace=$1\nendpoint=$(echo \"$2\" | sed -e 's,https\\?://,,g')\n\nif [[ -z \"$endpoint\" || -z \"$namespace\" ]]; then\n    echo \"Use \"$(basename \"$0\")\" NAMESPACE ENDPOINT\";\n    exit 1;\nfi\n\nif ! kubectl get ns|awk 'NR!=1{print $1}'|grep -w \"$namespace\";then kubectl create ns \"$namespace\";else echo \"namespace: $namespace was exist.\" ;fi\n\necho \"---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: $namespace-user\n  namespace: $namespace\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: $namespace-user-full-access\n  namespace: $namespace\nrules:\n- apiGroups: ['', 'extensions', 'apps', 'metrics.k8s.io']\n  resources: ['*']\n  verbs: ['*']\n- apiGroups: ['batch']\n  resources:\n  - jobs\n  - cronjobs\n  verbs: ['*']\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: $namespace-user-view\n  namespace: $namespace\nsubjects:\n- kind: ServiceAccount\n  name: $namespace-user\n  namespace: $namespace\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: $namespace-user-full-access\n---\n# https://kubernetes.io/zh/docs/concepts/policy/resource-quotas/\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: $namespace-compute-resources\n  namespace: $namespace\nspec:\n  hard:\n    pods: \"10\"\n    services: \"10\"\n    persistentvolumeclaims: \"5\"\n    requests.cpu: \"1\"\n    requests.memory: 2Gi\n    limits.cpu: \"2\"\n    limits.memory: 4Gi\" | kubectl apply -f -\nkubectl -n $namespace describe quota $namespace-compute-resources\nmkdir -p $folder\ntokenName=$(kubectl get sa $namespace-user -n $namespace -o \"jsonpath={.secrets[0].name}\")\ntoken=$(kubectl get secret $tokenName -n $namespace -o \"jsonpath={.data.token}\" | base64 --decode)\ncertificate=$(kubectl get secret $tokenName -n $namespace -o \"jsonpath={.data['ca\\.crt']}\")\n\necho \"apiVersion: v1\nkind: Config\npreferences: {}\nclusters:\n- cluster:\n    certificate-authority-data: $certificate\n    server: https://$endpoint\n  name: $namespace-cluster\nusers:\n- name: $namespace-user\n  user:\n    as-user-extra: {}\n    client-key-data: $certificate\n    token: $token\ncontexts:\n- context:\n    cluster: $namespace-cluster\n    namespace: $namespace\n    user: $namespace-user\n  name: $namespace\ncurrent-context: $namespace\" &gt; $folder/$namespace.kube.conf\n</code></pre>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#42-namespacekube-confignamespace","title":"4.2 \u521b\u5efa\u5bf9\u6307\u5b9anamespace\u6709\u6240\u6709\u6743\u9650\u7684kube-config\uff08\u5728\u5df2\u6709\u7684namespace\u4e2d\u521b\u5efa\uff09","text":"<pre><code>#!/bin/bash\n\n\nBASEDIR=\"$(dirname \"$0\")\"\nfolder=\"$BASEDIR/kube_config\"\n\necho -e \"All namespaces is here: \\n$(kubectl get ns|awk 'NR!=1{print $1}')\"\necho \"endpoint server if local network you can use $(kubectl cluster-info |awk '/Kubernetes/{print $NF}')\"\n\nnamespace=$1\nendpoint=$(echo \"$2\" | sed -e 's,https\\?://,,g')\n\nif [[ -z \"$endpoint\" || -z \"$namespace\" ]]; then\n    echo \"Use \"$(basename \"$0\")\" NAMESPACE ENDPOINT\";\n    exit 1;\nfi\n\n\necho \"---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: $namespace-user\n  namespace: $namespace\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: $namespace-user-full-access\n  namespace: $namespace\nrules:\n- apiGroups: ['', 'extensions', 'apps', 'metrics.k8s.io']\n  resources: ['*']\n  verbs: ['*']\n- apiGroups: ['batch']\n  resources:\n  - jobs\n  - cronjobs\n  verbs: ['*']\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: $namespace-user-view\n  namespace: $namespace\nsubjects:\n- kind: ServiceAccount\n  name: $namespace-user\n  namespace: $namespace\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: $namespace-user-full-access\" | kubectl apply -f -\n\nmkdir -p $folder\ntokenName=$(kubectl get sa $namespace-user -n $namespace -o \"jsonpath={.secrets[0].name}\")\ntoken=$(kubectl get secret $tokenName -n $namespace -o \"jsonpath={.data.token}\" | base64 --decode)\ncertificate=$(kubectl get secret $tokenName -n $namespace -o \"jsonpath={.data['ca\\.crt']}\")\n\necho \"apiVersion: v1\nkind: Config\npreferences: {}\nclusters:\n- cluster:\n    certificate-authority-data: $certificate\n    server: https://$endpoint\n  name: $namespace-cluster\nusers:\n- name: $namespace-user\n  user:\n    as-user-extra: {}\n    client-key-data: $certificate\n    token: $token\ncontexts:\n- context:\n    cluster: $namespace-cluster\n    namespace: $namespace\n    user: $namespace-user\n  name: $namespace\ncurrent-context: $namespace\" &gt; $folder/$namespace.kube.conf\n</code></pre>"},{"location":"cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.toutiao.com/i6942467217019666952?wid=1639197385733</li> <li>https://jeremievallee.com/2018/05/28/kubernetes-rbac-namespace-user.html</li> </ul>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/","title":"Kuberntes\u4e2d\u7684\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0","text":""},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#kuberntes","title":"Kuberntes\u4e2d\u7684\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0","text":""},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#k8s","title":"K8S \u670d\u52a1\u53d1\u73b0\u4e4b\u65c5","text":"<p>Kubernetes \u670d\u52a1\u53d1\u73b0\u662f\u4e00\u4e2a\u7ecf\u5e38\u8ba9\u6211\u4ea7\u751f\u56f0\u60d1\u7684\u4e3b\u9898\u4e4b\u4e00\u3002\u672c\u6587\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>\u7f51\u7edc\u65b9\u9762\u7684\u80cc\u666f\u77e5\u8bc6</li> <li>\u6df1\u5165\u4e86\u89e3 Kubernetes \u670d\u52a1\u53d1\u73b0</li> </ul> <p>\u8981\u4e86\u89e3\u670d\u52a1\u53d1\u73b0\uff0c\u9996\u5148\u8981\u4e86\u89e3\u80cc\u540e\u7684\u7f51\u7edc\u77e5\u8bc6\u3002\u8fd9\u90e8\u5206\u5185\u5bb9\u76f8\u5bf9\u6d45\u663e\uff0c\u5982\u679c\u8bfb\u8005\u719f\u77e5\u8fd9\u4e00\u90e8\u5206\uff0c\u5b8c\u5168\u53ef\u4ee5\u8df3\u8fc7\uff0c\u76f4\u63a5\u9605\u8bfb\u670d\u52a1\u53d1\u73b0\u90e8\u5206\u3002</p> <p>\u5f00\u59cb\u4e4b\u524d\u8fd8\u6709\u4e00\u4e2a\u9700\u8981\u63d0\u9192\u7684\u4e8b\u60c5\u5c31\u662f\uff0c\u4e3a\u4e86\u8be6\u7ec6\u63cf\u8ff0\u8fd9\u4e00\u8fc7\u7a0b\uff0c\u672c\u6587\u7565\u957f\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#k8s_1","title":"K8S \u7f51\u7edc\u57fa\u7840","text":"<p>\u8981\u5f00\u59cb\u670d\u52a1\u53d1\u73b0\u7684\u63a2\u7d22\u4e4b\u524d\uff0c\u9700\u8981\u7406\u89e3\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ol> <li>Kubernetes \u5e94\u7528\u8fd0\u884c\u5728\u5bb9\u5668\u4e4b\u4e2d\uff0c\u5bb9\u5668\u5904\u4e8e Pod \u4e4b\u5185\u3002</li> <li>\u6bcf\u4e2a Pod \u90fd\u4f1a\u9644\u7740\u5728\u540c\u4e00\u4e2a\u5927\u7684\u6241\u5e73\u7684 IP \u7f51\u7edc\u4e4b\u4e2d\uff0c\u88ab\u79f0\u4e3a Pod \u7f51\u7edc\uff08\u901a\u5e38\u662f VXLAN \u53e0\u52a0\u7f51\u7edc\uff09\u3002</li> <li>\u6bcf\u4e2a Pod \u90fd\u6709\u81ea\u5df1\u7684\u552f\u4e00\u7684 IP \u5730\u5740\uff0c\u8fd9\u4e2a IP \u5730\u5740\u5728 Pod \u7f51\u7edc\u4e2d\u662f\u53ef\u8def\u7531\u7684\u3002</li> </ol> <p></p> <p>\u4e0a\u8ff0\u4e09\u4e2a\u56e0\u7d20\u7ed3\u5408\u8d77\u6765\uff0c\u8ba9\u6bcf\u4e2a\u5e94\u7528\uff08\u5e94\u7528\u7684\u7ec4\u4ef6\u548c\u670d\u52a1\uff09\u65e0\u9700\u901a\u8fc7 NAT \u4e4b\u7c7b\u7684\u7f51\u7edc\u8fc7\u7a0b\uff0c\u5c31\u80fd\u591f\u76f4\u63a5\u901a\u4fe1\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#_1","title":"\u52a8\u6001\u7f51\u7edc","text":"<p>\u5728\u5bf9\u5e94\u7528\u8fdb\u884c\u6a2a\u5411\u6269\u5bb9\u65f6\uff0c\u4f1a\u5728 Pod \u7f51\u7edc\u4e2d\u52a0\u5165\u65b0\u7684 Pod\uff0c\u65b0 Pod \u81ea\u7136\u4e5f\u4f34\u968f\u7740\u65b0\u7684 IP \u5730\u5740\uff1b\u5982\u679c\u5bf9\u5e94\u7528\u8fdb\u884c\u7f29\u5bb9\uff0c\u65e7\u7684 Pod \u53ca\u5176 IP \u4f1a\u88ab\u5220\u9664\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u770b\u8d77\u6765\u5f88\u662f\u6df7\u4e71\u3002</p> <p>\u5e94\u7528\u7684\u6eda\u52a8\u66f4\u65b0\u548c\u64a4\u56de\u4e5f\u5b58\u5728\u540c\u6837\u7684\u60c5\u5f62\u2014\u2014\u52a0\u5165\u65b0\u7248\u672c\u7684\u65b0 Pod\uff0c\u6216\u8005\u79fb\u9664\u65e7\u7248\u672c\u7684\u65e7 Pod\u3002\u65b0 Pod \u4f1a\u52a0\u5165\u65b0 IP \u5230 Pod \u7f51\u7edc\u4e2d\uff0c\u88ab\u7ec8\u7ed3\u7684\u65e7 Pod \u4f1a\u5220\u9664\u5176\u73b0\u5b58 IP\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u5176\u5b83\u56e0\u7d20\uff0c\u6bcf\u4e2a\u5e94\u7528\u670d\u52a1\u90fd\u9700\u8981\u5bf9\u7f51\u7edc\u8fdb\u884c\u76d1\u63a7\uff0c\u5e76\u7ba1\u7406\u4e00\u4e2a\u5065\u5eb7 Pod \u7684\u5217\u8868\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u975e\u5e38\u75db\u82e6\uff0c\u53e6\u5916\u5728\u6bcf\u4e2a\u5e94\u7528\u4e2d\u7f16\u5199\u8fd9\u4e2a\u903b\u8f91\u4e5f\u662f\u5f88\u4f4e\u6548\u7684\u3002\u5e78\u8fd0\u7684\u662f\uff0cKubernetes \u7528\u4e00\u4e2a\u5bf9\u8c61\u5b8c\u6210\u4e86\u8fd9\u4e2a\u8fc7\u7a0b\u2014\u2014Service\u3002</p> <p>\u628a\u8fd9\u4e2a\u5bf9\u8c61\u53eb\u505a Service \u662f\u4e2a\u574f\u4e3b\u610f\uff0c\u6211\u4eec\u5df2\u7ecf\u7528\u8fd9\u4e2a\u5355\u8bcd\u6765\u5f62\u5bb9\u5e94\u7528\u7684\u8fdb\u7a0b\u6216\u7ec4\u4ef6\u4e86\u3002</p> <p>\u8fd8\u6709\u4e00\u4e2a\u503c\u5f97\u6ce8\u610f\u7684\u4e8b\u60c5\uff1aKubernetes \u6267\u884c IP \u5730\u5740\u7ba1\u7406\uff08IPAM\uff09\u804c\u8d23\uff0c\u5bf9 Pod \u7f51\u7edc\u4e0a\u5df2\u4f7f\u7528\u548c\u53ef\u7528\u7684 IP \u5730\u5740\u8fdb\u884c\u8ddf\u8e2a\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#service","title":"Service \u5e26\u6765\u7a33\u5b9a\u6027","text":"<p>Kubernetes Service \u5bf9\u8c61\u5728\u4e00\u7ec4\u63d0\u4f9b\u670d\u52a1\u7684 Pod \u4e4b\u524d\u521b\u5efa\u4e00\u4e2a\u7a33\u5b9a\u7684\u7f51\u7edc\u7aef\u70b9\uff0c\u5e76\u4e3a\u8fd9\u4e9b Pod \u8fdb\u884c\u8d1f\u8f7d\u5206\u914d\u3002</p> <p>\u4e00\u822c\u4f1a\u5728\u4e00\u7ec4\u5b8c\u6210\u540c\u6837\u5de5\u4f5c\u7684 Pod \u4e4b\u524d\u653e\u7f6e\u4e00\u4e2a Service \u5bf9\u8c61\u3002\u4f8b\u5982\u53ef\u4ee5\u5728\u4f60\u7684 Web \u524d\u7aef Pod \u524d\u65b9\u63d0\u4f9b\u4e00\u4e2a Service\uff0c\u5728\u8ba4\u8bc1\u670d\u52a1 Pod \u4e4b\u524d\u63d0\u4f9b\u53e6\u4e00\u4e2a\u3002\u884c\u4f7f\u4e0d\u540c\u804c\u8d23\u7684 Pod \u4e4b\u524d\u5c31\u4e0d\u5e94\u8be5\u7528\u5355\u4e00\u7684 Service \u4e86\u3002</p> <p>\u5ba2\u6237\u7aef\u548c Service \u901a\u4fe1\uff0cService \u8d1f\u8d23\u628a\u6d41\u91cf\u8d1f\u8f7d\u5747\u8861\u7ed9 Pod\u3002</p> <p></p> <p>\u5728\u4e0a\u56fe\u4e2d\uff0c\u5e95\u90e8\u7684 Pod \u4f1a\u56e0\u4e3a\u4f38\u7f29\u3001\u66f4\u65b0\u3001\u6545\u969c\u7b49\u60c5\u51b5\u53d1\u751f\u53d8\u5316\uff0c\u800c Service \u4f1a\u5bf9\u8fd9\u4e9b\u53d8\u5316\u8fdb\u884c\u8ddf\u8e2a\u3002\u540c\u65f6 Service \u7684\u540d\u5b57\u3001IP \u548c\u7aef\u53e3\u90fd\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#k8s-service","title":"K8S Service \u89e3\u6790","text":"<p>\u53ef\u4ee5\u628a Kubernetes Service \u7406\u89e3\u4e3a\u524d\u7aef\u548c\u540e\u7aef\u4e24\u90e8\u5206\uff1a</p> <ul> <li>\u524d\u7aef\uff1a\u540d\u79f0\u3001IP \u548c\u7aef\u53e3\u7b49\u4e0d\u53d8\u7684\u90e8\u5206\u3002</li> <li>\u540e\u7aef\uff1a\u7b26\u5408\u7279\u5b9a\u6807\u7b7e\u9009\u62e9\u6761\u4ef6\u7684 Pod \u96c6\u5408\u3002</li> </ul> <p>\u524d\u7aef\u662f\u7a33\u5b9a\u53ef\u9760\u7684\uff0c\u5b83\u7684\u540d\u79f0\u3001IP \u548c\u7aef\u53e3\u5728 Service \u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u4e2d\u90fd\u4e0d\u4f1a\u6539\u53d8\u3002\u524d\u7aef\u7684\u7a33\u5b9a\u6027\u610f\u5473\u7740\u65e0\u9700\u62c5\u5fc3\u5ba2\u6237\u7aef DNS \u7f13\u5b58\u8d85\u65f6\u7b49\u95ee\u9898\u3002</p> <p>\u540e\u7aef\u662f\u9ad8\u5ea6\u52a8\u6001\u7684\uff0c\u5176\u4e2d\u5305\u62ec\u4e00\u7ec4\u7b26\u5408\u6807\u7b7e\u9009\u62e9\u6761\u4ef6\u7684 Pod\uff0c\u4f1a\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u7684\u65b9\u5f0f\u8fdb\u884c\u8bbf\u95ee\u3002</p> <p></p> <p>\u8fd9\u91cc\u7684\u8d1f\u8f7d\u5747\u8861\u662f\u4e00\u4e2a\u7b80\u5355\u7684 4 \u5c42\u8f6e\u8be2\u3002\u5b83\u5de5\u4f5c\u5728\u8fde\u63a5\u5c42\u9762\uff0c\u6240\u4ee5\u540c\u4e00\u4e2a\u8fde\u63a5\u91cc\u53d1\u8d77\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u8fdb\u5165\u540c\u4e00\u4e2a Pod\u3002\u56e0\u4e3a\u5728 4 \u5c42\u5de5\u4f5c\uff0c\u6240\u4ee5\u5bf9\u4e8e 7 \u5c42\u7684 HTTP \u5934\u6216\u8005 Cookie \u4e4b\u7c7b\u7684\u4e1c\u897f\u662f\u65e0\u6cd5\u611f\u77e5\u7684\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#_2","title":"\u5c0f\u7ed3","text":"<p>\u5e94\u7528\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\uff0c\u5728 Kubernetes \u4e2d\u4f53\u73b0\u4e3a Pod \u7684\u5f62\u5f0f\u3002Kubernetes \u96c6\u7fa4\u4e2d\u7684\u6240\u6709 Pod \u90fd\u5904\u4e8e\u540c\u4e00\u4e2a\u5e73\u9762\u7684 Pod \u7f51\u7edc\uff0c\u6709\u81ea\u5df1\u7684 IP \u5730\u5740\u3002\u8fd9\u610f\u5473\u7740\u6240\u6709\u7684 Pod \u4e4b\u95f4\u90fd\u80fd\u76f4\u63a5\u8fde\u63a5\u3002\u7136\u800c Pod \u662f\u4e0d\u7a33\u5b9a\u7684\uff0c\u53ef\u80fd\u56e0\u4e3a\u5404\u79cd\u56e0\u7d20\u521b\u5efa\u548c\u9500\u6bc1\u3002</p> <p>Kubernetes \u63d0\u4f9b\u4e86\u7a33\u5b9a\u7684\u7f51\u7edc\u7aef\u70b9\uff0c\u79f0\u4e3a Service\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u5904\u4e8e\u4e00\u7ec4\u76f8\u4f3c\u7684 Pod \u524d\u65b9\uff0c\u63d0\u4f9b\u4e86\u7a33\u5b9a\u7684\u540d\u79f0\u3001IP \u548c\u7aef\u53e3\u3002\u5ba2\u6237\u7aef\u8fde\u63a5\u5230 Service\uff0cService \u628a\u6d41\u91cf\u8d1f\u8f7d\u5747\u8861\u7ed9 Pod\u3002</p> <p>\u63a5\u4e0b\u6765\u804a\u804a\u670d\u52a1\u53d1\u73b0\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#k8s_2","title":"\u6df1\u5165 K8S \u670d\u52a1\u53d1\u73b0","text":"<p>\u6df1\u5165\u4e86\u89e3 Kubernetes \u670d\u52a1\u53d1\u73b0</p> <p>\u670d\u52a1\u53d1\u73b0\u5b9e\u9645\u4e0a\u5305\u542b\u4e24\u4e2a\u529f\u80fd\u70b9\uff1a</p> <ol> <li>\u670d\u52a1\u6ce8\u518c</li> <li>\u670d\u52a1\u53d1\u73b0</li> </ol>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#_3","title":"\u670d\u52a1\u6ce8\u518c","text":"<p>\u670d\u52a1\u6ce8\u518c\u8fc7\u7a0b\u6307\u7684\u662f\u5728\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u767b\u8bb0\u4e00\u4e2a\u670d\u52a1\uff0c\u4ee5\u4fbf\u8ba9\u5176\u5b83\u670d\u52a1\u53d1\u73b0\u3002</p> <p></p> <p>Kubernetes \u4f7f\u7528 DNS \u4f5c\u4e3a\u670d\u52a1\u6ce8\u518c\u8868\u3002</p> <p>\u4e3a\u4e86\u6ee1\u8db3\u8fd9\u4e00\u9700\u8981\uff0c\u6bcf\u4e2a Kubernetes \u96c6\u7fa4\u90fd\u4f1a\u5728 kube-system \u547d\u540d\u7a7a\u95f4\u4e2d\u7528 Pod \u7684\u5f62\u5f0f\u8fd0\u884c\u4e00\u4e2a DNS \u670d\u52a1\uff0c\u901a\u5e38\u79f0\u4e4b\u4e3a\u96c6\u7fa4 DNS\u3002</p> <p>\u6bcf\u4e2a Kubernetes \u670d\u52a1\u90fd\u4f1a\u81ea\u52a8\u6ce8\u518c\u5230\u96c6\u7fa4 DNS \u4e4b\u4e2d\u3002</p> <p>\u6ce8\u518c\u8fc7\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a</p> <ol> <li>\u5411 API Server \u7528 POST \u65b9\u5f0f\u63d0\u4ea4\u4e00\u4e2a\u65b0\u7684 Service \u5b9a\u4e49\uff1b</li> <li>\u8fd9\u4e2a\u8bf7\u6c42\u9700\u8981\u7ecf\u8fc7\u8ba4\u8bc1\u3001\u9274\u6743\u4ee5\u53ca\u5176\u5b83\u7684\u51c6\u5165\u7b56\u7565\u68c0\u67e5\u8fc7\u7a0b\u4e4b\u540e\u624d\u4f1a\u653e\u884c\uff1b</li> <li>Service \u5f97\u5230\u4e00\u4e2a ClusterIP\uff08\u865a\u62df IP \u5730\u5740\uff09\uff0c\u5e76\u4fdd\u5b58\u5230\u96c6\u7fa4\u6570\u636e\u4ed3\u5e93\uff1b</li> <li>\u5728\u96c6\u7fa4\u8303\u56f4\u5185\u4f20\u64ad Service \u914d\u7f6e\uff1b</li> <li>\u96c6\u7fa4 DNS \u670d\u52a1\u5f97\u77e5\u8be5 Service \u7684\u521b\u5efa\uff0c\u636e\u6b64\u521b\u5efa\u5fc5\u8981\u7684 DNS A \u8bb0\u5f55\u3002</li> </ol> <p>\u4e0a\u9762\u8fc7\u7a0b\u4e2d\uff0c\u7b2c 5 \u4e2a\u6b65\u9aa4\u662f\u5173\u952e\u73af\u8282\u3002\u96c6\u7fa4 DNS \u4f7f\u7528\u7684\u662f CoreDNS\uff0c\u4ee5 Kubernetes \u539f\u751f\u5e94\u7528\u7684\u5f62\u5f0f\u8fd0\u884c\u3002</p> <p>CoreDNS \u5b9e\u73b0\u4e86\u4e00\u4e2a\u63a7\u5236\u5668\uff0c\u4f1a\u5bf9 API Server \u8fdb\u884c\u76d1\u542c\uff0c\u4e00\u65e6\u53d1\u73b0\u6709\u65b0\u5efa\u7684 Service \u5bf9\u8c61\uff0c\u5c31\u521b\u5efa\u4e00\u4e2a\u4ece Service \u540d\u79f0\u6620\u5c04\u5230 ClusterIP \u7684\u57df\u540d\u8bb0\u5f55\u3002\u8fd9\u6837 Service \u5c31\u4e0d\u5fc5\u81ea\u884c\u5411 DNS \u8fdb\u884c\u6ce8\u518c\uff0cCoreDNS \u63a7\u5236\u5668\u4f1a\u5173\u6ce8\u65b0\u521b\u5efa\u7684 Service \u5bf9\u8c61\uff0c\u5e76\u5b9e\u73b0\u540e\u7eed\u7684 DNS \u8fc7\u7a0b\u3002</p> <p>DNS \u4e2d\u6ce8\u518c\u7684\u540d\u79f0\u5c31\u662f metadata.name\uff0c\u800c ClusterIP \u5219\u7531 Kubernetes \u81ea\u884c\u5206\u914d\u3002</p> <p></p> <p>Service \u5bf9\u8c61\u6ce8\u518c\u5230\u96c6\u7fa4 DNS \u4e4b\u4e2d\u540e\uff0c\u5c31\u80fd\u591f\u88ab\u8fd0\u884c\u5728\u96c6\u7fa4\u4e2d\u7684\u5176\u5b83 Pod \u53d1\u73b0\u4e86\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#endpoint","title":"Endpoint \u5bf9\u8c61","text":"<p>Service \u7684\u524d\u7aef\u521b\u5efa\u6210\u529f\u5e76\u6ce8\u518c\u5230\u670d\u52a1\u6ce8\u518c\u8868\uff08DNS\uff09\u4e4b\u540e\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u540e\u7aef\u7684\u5de5\u4f5c\u4e86\u3002\u540e\u7aef\u5305\u542b\u4e00\u4e2a Pod \u5217\u8868\uff0cService \u5bf9\u8c61\u4f1a\u628a\u6d41\u91cf\u5206\u53d1\u7ed9\u8fd9\u4e9b Pod\u3002</p> <p>\u6beb\u65e0\u7591\u95ee\uff0c\u8fd9\u4e2a Pod \u5217\u8868\u9700\u8981\u662f\u6700\u65b0\u7684\u3002</p> <p>Service \u5bf9\u8c61\u6709\u4e00\u4e2a Label Selector \u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u662f\u4e00\u4e2a\u6807\u7b7e\u5217\u8868\uff0c\u7b26\u5408\u5217\u8868\u6761\u4ef6\u7684 Pod \u5c31\u4f1a\u88ab\u670d\u52a1\u7eb3\u5165\u5230\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\u8303\u56f4\u4e4b\u4e2d\u3002\u53c2\u89c1\u4e0b\u56fe\uff1a</p> <p></p> <p>Kubernetes \u81ea\u52a8\u4e3a\u6bcf\u4e2a Service \u521b\u5efa Endpoints \u5bf9\u8c61\u3002Endpoints \u5bf9\u8c61\u7684\u804c\u8d23\u5c31\u662f\u4fdd\u5b58\u4e00\u4e2a\u7b26\u5408 Service \u6807\u7b7e\u9009\u62e9\u5668\u6807\u51c6\u7684 Pod \u5217\u8868\uff0c\u8fd9\u4e9b Pod \u5c06\u63a5\u6536\u6765\u81ea Service \u7684\u6d41\u91cf\u3002</p> <p>\u4e0b\u9762\u7684\u56fe\u4e2d\uff0cService \u4f1a\u9009\u62e9\u4e24\u4e2a Pod\uff0c\u5e76\u4e14\u8fd8\u5c55\u793a\u4e86 Service \u7684 Endpoints \u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u91cc\u5305\u542b\u4e86\u4e24\u4e2a\u7b26\u5408 Service \u9009\u62e9\u6807\u51c6\u7684 Pod \u7684 IP\u3002</p> <p>\u5728\u540e\u9762\u6211\u4eec\u5c06\u89e3\u91ca\u7f51\u7edc\u5982\u4f55\u628a ClusterIP \u6d41\u91cf\u8f6c\u53d1\u7ed9 Pod IP \u7684\u8fc7\u7a0b\uff0c\u8fd8\u4f1a\u5f15\u7528\u5230 Endpoints \u5bf9\u8c61\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#_4","title":"\u670d\u52a1\u53d1\u73b0","text":"<p>\u5047\u8bbe\u6211\u4eec\u5728\u4e00\u4e2a Kubernetes \u96c6\u7fa4\u4e2d\u6709\u4e24\u4e2a\u5e94\u7528\uff0cmy-app \u548c your-app\uff0cmy-app \u7684 Pod \u7684\u524d\u7aef\u662f\u4e00\u4e2a \u540d\u4e3a my-app-svc \u7684 Service \u5bf9\u8c61\uff1byour-app Pod \u4e4b\u524d\u7684 Service \u5c31\u662f your-app-svc\u3002</p> <p>\u8fd9\u4e24\u4e2a Service \u5bf9\u8c61\u5bf9\u5e94\u7684 DNS \u8bb0\u5f55\u662f\uff1a</p> <ul> <li>my-app-svc\uff1a10.0.0.10</li> <li>your-app-svc\uff1a10.0.0.20</li> </ul> <p></p> <p>\u8981\u4f7f\u7528\u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff0c\u6bcf\u4e2a Pod \u90fd\u9700\u8981\u77e5\u9053\u96c6\u7fa4 DNS \u7684\u4f4d\u7f6e\u624d\u80fd\u4f7f\u7528\u5b83\u3002\u56e0\u6b64\u6bcf\u4e2a Pod \u4e2d\u7684\u6bcf\u4e2a\u5bb9\u5668\u7684 /etc/resolv.conf \u6587\u4ef6\u90fd\u88ab\u914d\u7f6e\u4e3a\u4f7f\u7528\u96c6\u7fa4 DNS \u8fdb\u884c\u89e3\u6790\u3002</p> <p>\u5982\u679c my-app \u4e2d\u7684 Pod \u60f3\u8981\u8fde\u63a5\u5230 your-app \u4e2d\u7684 Pod\uff0c\u5c31\u5f97\u5411 DNS \u670d\u52a1\u5668\u53d1\u8d77\u5bf9\u57df\u540d your-app-svc \u7684\u67e5\u8be2\u3002\u5047\u8bbe\u5b83\u4eec\u672c\u5730\u7684 DNS \u89e3\u6790\u7f13\u5b58\u4e2d\u6ca1\u6709\u8fd9\u4e2a\u8bb0\u5f55\uff0c\u5219\u9700\u8981\u628a\u67e5\u8be2\u63d0\u4ea4\u5230\u96c6\u7fa4 DNS \u670d\u52a1\u5668\u3002\u4f1a\u5f97\u5230 you-app-svc \u7684 ClusterIP\uff08VIP\uff09\u3002</p> <p>\u8fd9\u91cc\u6709\u4e2a\u524d\u63d0\u5c31\u662f my-app \u9700\u8981\u77e5\u9053\u76ee\u6807\u670d\u52a1\u7684\u540d\u79f0\u3002</p> <p>\u81f3\u6b64\uff0cmy-app \u4e2d\u7684 Pod \u5f97\u5230\u4e86\u4e00\u4e2a\u76ee\u6807 IP \u5730\u5740\uff0c\u7136\u800c\u8fd9\u53ea\u662f\u4e2a\u865a\u62df IP\uff0c\u5728\u8f6c\u5165\u76ee\u6807 Pod \u4e4b\u524d\uff0c\u8fd8\u6709\u4e9b\u7f51\u7edc\u5de5\u4f5c\u8981\u505a\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#_5","title":"\u7f51\u7edc","text":"<p>\u4e00\u4e2a Pod \u5f97\u5230\u4e86 Service \u7684 ClusterIP \u4e4b\u540e\uff0c\u5c31\u5c1d\u8bd5\u5411\u8fd9\u4e2a IP \u53d1\u9001\u6d41\u91cf\u3002\u7136\u800c ClusterIP \u6240\u5728\u7684\u7f51\u7edc\u88ab\u79f0\u4e3a Service Network\uff0c\u8fd9\u4e2a\u7f51\u7edc\u6709\u70b9\u7279\u522b\u2014\u2014\u6ca1\u6709\u8def\u7531\u6307\u5411\u5b83\u3002</p> <p>\u56e0\u4e3a\u6ca1\u6709\u8def\u7531\uff0c\u6240\u6709\u5bb9\u5668\u628a\u53d1\u73b0\u8fd9\u79cd\u5730\u5740\u7684\u6d41\u91cf\u90fd\u53d1\u9001\u5230\u4e86\u7f3a\u7701\u7f51\u5173\uff08\u540d\u4e3a CBR0 \u7684\u7f51\u6865\uff09\u3002\u8fd9\u4e9b\u6d41\u91cf\u4f1a\u88ab\u8f6c\u53d1\u7ed9 Pod \u6240\u5728\u8282\u70b9\u7684\u7f51\u5361\u4e0a\u3002\u8282\u70b9\u7684\u7f51\u7edc\u6808\u4e5f\u540c\u6837\u6ca1\u6709\u8def\u7531\u80fd\u5230\u8fbe Service Network\uff0c\u6240\u4ee5\u53ea\u80fd\u53d1\u9001\u5230\u81ea\u5df1\u7684\u7f3a\u7701\u7f51\u5173\u3002\u8def\u7531\u5230\u8282\u70b9\u7f3a\u7701\u7f51\u5173\u7684\u6570\u636e\u5305\u4f1a\u901a\u8fc7 Node \u5185\u6838\u2014\u2014\u8fd9\u91cc\u6709\u4e86\u53d8\u5316\u3002</p> <p>\u56de\u987e\u4e00\u4e0b\u524d\u9762\u7684\u5185\u5bb9\u3002\u9996\u5148 Service \u5bf9\u8c61\u7684\u914d\u7f6e\u662f\u5168\u96c6\u7fa4\u8303\u56f4\u6709\u6548\u7684\uff0c\u53e6\u5916\u8fd8\u4f1a\u518d\u6b21\u8bf4\u5230 Endpoints \u5bf9\u8c61\u3002\u6211\u4eec\u8981\u5728\u56de\u987e\u4e2d\u53d1\u73b0\u4ed6\u4eec\u5404\u81ea\u5728\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\u7684\u804c\u8d23\u3002</p> <p>\u6bcf\u4e2a Kubernetes \u8282\u70b9\u4e0a\u90fd\u4f1a\u8fd0\u884c\u4e00\u4e2a\u53eb\u505a kube-proxy \u7684\u7cfb\u7edf\u670d\u52a1\u3002\u8fd9\u662f\u4e00\u4e2a\u57fa\u4e8e Pod \u8fd0\u884c\u7684 Kubernetes \u539f\u751f\u5e94\u7528\uff0c\u5b83\u6240\u5b9e\u73b0\u7684\u63a7\u5236\u5668\u4f1a\u76d1\u63a7 API Server \u4e0a Service \u7684\u53d8\u5316\uff0c\u5e76\u636e\u6b64\u521b\u5efa iptables \u6216\u8005 IPVS \u89c4\u5219\uff0c\u8fd9\u4e9b\u89c4\u5219\u544a\u77e5\u8282\u70b9\uff0c\u6355\u83b7\u76ee\u6807\u4e3a Service \u7f51\u7edc\u7684\u62a5\u6587\uff0c\u5e76\u8f6c\u53d1\u7ed9 Pod IP\u3002</p> <p>\u6709\u8da3\u7684\u662f\uff0ckube-proxy \u5e76\u4e0d\u662f\u4e00\u4e2a\u666e\u904d\u610f\u4e49\u4e0a\u7684\u4ee3\u7406\u3002\u5b83\u7684\u5de5\u4f5c\u4e0d\u8fc7\u662f\u521b\u5efa\u548c\u7ba1\u7406 iptables/IPVS \u89c4\u5219\u3002\u8fd9\u4e2a\u547d\u540d\u7684\u539f\u56e0\u662f\u5b83\u8fc7\u53bb\u4f7f\u7528 unserspace \u6a21\u5f0f\u7684\u4ee3\u7406\u3002</p> <p>\u6bcf\u4e2a\u65b0 Service \u5bf9\u8c61\u7684\u914d\u7f6e\uff0c\u5176\u4e2d\u5305\u542b\u5b83\u7684 ClusterIP \u4ee5\u53ca Endpoints \u5bf9\u8c61\uff08\u5176\u4e2d\u5305\u542b\u5065\u5eb7 Pod \u7684\u5217\u8868\uff09\uff0c\u90fd\u4f1a\u88ab\u53d1\u9001\u7ed9 \u6bcf\u4e2a\u8282\u70b9\u4e0a\u7684 kube-proxy \u8fdb\u7a0b\u3002</p> <p>kube-proxy \u4f1a\u521b\u5efa iptables \u6216\u8005 IPVS \u89c4\u5219\uff0c\u544a\u77e5\u8282\u70b9\u6355\u83b7\u76ee\u6807\u4e3a Service ClusterIP \u7684\u6d41\u91cf\uff0c\u5e76\u6839\u636e Endpoints \u5bf9\u8c61\u7684\u5185\u5bb9\u8f6c\u53d1\u7ed9\u5bf9\u5e94\u7684 Pod\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u6bcf\u6b21\u8282\u70b9\u5185\u6838\u5904\u7406\u5230\u76ee\u6807\u4e3a Service \u7f51\u7edc\u7684\u6570\u636e\u5305\u65f6\uff0c\u90fd\u4f1a\u5bf9\u6570\u636e\u5305\u7684 Header \u8fdb\u884c\u6539\u5199\uff0c\u628a\u76ee\u6807 IP \u6539\u4e3a Service Endpoints \u5bf9\u8c61\u4e2d\u7684\u5065\u5eb7 Pod \u7684 IP\u3002</p> <p>\u539f\u672c\u4f7f\u7528\u7684 iptables \u6b63\u5728\u88ab IPVS \u53d6\u4ee3\uff08Kubernetes 1.11 \u8fdb\u5165\u7a33\u5b9a\u671f\uff09\u3002\u957f\u8bdd\u77ed\u8bf4\uff0ciptables \u662f\u4e00\u4e2a\u5305\u8fc7\u6ee4\u5668\uff0c\u5e76\u975e\u4e3a\u8d1f\u8f7d\u5747\u8861\u8bbe\u8ba1\u7684\u3002IPVS \u662f\u4e00\u4e2a 4 \u5c42\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5176\u6027\u80fd\u548c\u5b9e\u73b0\u65b9\u5f0f\u90fd\u6bd4 iptables \u66f4\u9002\u5408\u8fd9\u79cd\u4f7f\u7528\u573a\u666f\u3002</p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#_6","title":"\u603b\u7ed3","text":"<p>\u9700\u8981\u6d88\u5316\u7684\u5185\u5bb9\u5f88\u591a\uff0c\u7b80\u5355\u56de\u987e\u4e00\u4e0b\u3002</p> <p>\u521b\u5efa\u65b0\u7684 Service \u5bf9\u8c61\u65f6\uff0c\u4f1a\u5f97\u5230\u4e00\u4e2a\u865a\u62df IP\uff0c\u88ab\u79f0\u4e3a ClusterIP\u3002\u670d\u52a1\u540d\u53ca\u5176 ClusterIP \u88ab\u81ea\u52a8\u6ce8\u518c\u5230\u96c6\u7fa4 DNS \u4e2d\uff0c\u5e76\u4e14\u4f1a\u521b\u5efa\u76f8\u5173\u7684 Endpoints \u5bf9\u8c61\u7528\u4e8e\u4fdd\u5b58\u7b26\u5408\u6807\u7b7e\u6761\u4ef6\u7684\u5065\u5eb7 Pod \u7684\u5217\u8868\uff0cService \u5bf9\u8c61\u4f1a\u5411\u5217\u8868\u4e2d\u7684 Pod \u8f6c\u53d1\u6d41\u91cf\u3002</p> <p>\u4e0e\u6b64\u540c\u65f6\u96c6\u7fa4\u4e2d\u6240\u6709\u8282\u70b9\u90fd\u4f1a\u914d\u7f6e\u76f8\u5e94\u7684 iptables/IPVS \u89c4\u5219\uff0c\u76d1\u542c\u76ee\u6807\u4e3a ClusterIP \u7684\u6d41\u91cf\u5e76\u8f6c\u53d1\u7ed9\u771f\u5b9e\u7684 Pod IP\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4e00\u4e2a Pod \u9700\u8981\u7528 Service \u8fde\u63a5\u5176\u5b83 Pod\u3002\u9996\u5148\u5411\u96c6\u7fa4 DNS \u53d1\u51fa\u67e5\u8be2\uff0c\u628a Service \u540d\u79f0\u89e3\u6790\u4e3a ClusterIP\uff0c\u7136\u540e\u628a\u6d41\u91cf\u53d1\u9001\u7ed9\u4f4d\u4e8e Service \u7f51\u7edc\u7684 ClusterIP \u4e0a\u3002</p> <p>\u7136\u800c\u6ca1\u6709\u5230 Service \u7f51\u7edc\u7684\u8def\u7531\uff0c\u6240\u4ee5 Pod \u628a\u6d41\u91cf\u53d1\u9001\u7ed9\u5b83\u7684\u7f3a\u7701\u7f51\u5173\u3002\u8fd9\u4e00\u884c\u4e3a\u5bfc\u81f4\u6d41\u91cf\u88ab\u8f6c\u53d1\u7ed9 Pod \u6240\u5728\u8282\u70b9\u7684\u7f51\u5361\uff0c\u7136\u540e\u662f\u8282\u70b9\u7684\u7f3a\u7701\u7f51\u5173\u3002\u8fd9\u4e2a\u64cd\u4f5c\u4e2d\uff0c\u8282\u70b9\u7684\u5185\u6838\u4fee\u6539\u4e86\u6570\u636e\u5305 Header \u4e2d\u7684\u76ee\u6807 IP\uff0c\u4f7f\u5176\u8f6c\u5411\u5065\u5eb7\u7684 Pod\u3002</p> <p></p>"},{"location":"cloud-native/other/Kuberntes%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/#_7","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://nigelpoulton.com/demystifying-kubernetes-service-discovery/</li> <li>https://mp.weixin.qq.com/s/va1k7p-an6mAgm1xGyPkLQ</li> </ul>"},{"location":"cloud-native/other/Prometheus/","title":"Prometheus \u5b8c\u5168\u7b14\u8bb0","text":""},{"location":"cloud-native/other/Prometheus/#_1","title":"\u4e00 \u6982\u8ff0","text":"<p>Prometheus \u662f\u4e00\u4e2a\u5f00\u6e90\u76d1\u63a7\u7cfb\u7edf\uff0c\u5b83\u524d\u8eab\u662f SoundCloud\u7684\u544a\u8b66\u5de5\u5177\u5305\u3002\u4ece 2012 \u5e74\u5f00\u59cb\uff0c\u8bb8\u591a\u516c\u53f8\u548c\u7ec4\u7ec7\u5f00\u59cb\u4f7f\u7528 Prometheus\u3002\u8be5\u9879\u76ee\u7684\u5f00\u53d1\u4eba\u5458\u548c\u7528\u6237\u793e\u533a\u975e\u5e38\u6d3b\u8dc3\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u5f00\u53d1\u4eba\u5458\u548c\u7528\u6237\u53c2\u4e0e\u5230\u8be5\u9879\u76ee\u4e2d\u3002\u76ee\u524d\u5b83\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u4e14\u4e0d\u4f9d\u8d56\u4e8e\u4efb\u4f55\u516c\u53f8\u3002\u4e3a\u4e86\u5f3a\u8c03\u8fd9\u70b9\u548c\u660e\u786e\u8be5\u9879\u76ee\u6cbb\u7406\u7ed3\u6784\uff0cPrometheus \u5728 2016 \u5e74\u7ee7Kurberntes \u4e4b\u540e\uff0c\u52a0\u5165\u4e86 Cloud Native Computing Foundation\u3002</p>"},{"location":"cloud-native/other/Prometheus/#11-prometheus","title":"1.1 prometheus\u6838\u5fc3\u6982\u5ff5","text":""},{"location":"cloud-native/other/Prometheus/#111","title":"1.1.1 \u6570\u636e\u6a21\u578b","text":"<p>Prometheus \u4ece\u6839\u672c\u4e0a\u5b58\u50a8\u7684\u6240\u6709\u6570\u636e\u90fd\u662f\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff08Time Serie Data\uff0c\u7b80\u79f0\u65f6\u5e8f\u6570\u636e\uff09\u3002\u65f6\u5e8f\u6570\u636e\u662f\u5177\u6709\u65f6\u95f4\u6233\u7684\u6570\u636e\u6d41\uff0c\u8be5\u6570\u636e\u6d41\u5c5e\u4e8e\u67d0\u4e2a\u5ea6\u91cf\u6307\u6807\uff08Metric\uff09\u548c\u8be5\u5ea6\u91cf\u6307\u6807\u4e0b\u7684\u591a\u4e2a\u6807\u7b7e\uff08Label\uff09\u3002\u9664\u4e86\u63d0\u4f9b\u5b58\u50a8\u529f\u80fd\uff0cPrometheus \u8fd8\u53ef\u4ee5\u5229\u7528\u67e5\u8be2\u8868\u8fbe\u5f0f\u6765\u6267\u884c\u975e\u5e38\b\u7075\u6d3b\u548c\u590d\u6742\u7684\u67e5\u8be2\u3002</p> <ul> <li>\u5ea6\u91cf\u6307\u6807\u548c\u6807\u7b7e</li> </ul> <p>\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\uff08Time Serie\uff0c\u7b80\u79f0\u65f6\u5e8f\uff09\u7531\u5ea6\u91cf\u6307\u6807\u548c\u4e00\u7ec4\u6807\u7b7e\u952e\u503c\u5bf9\u552f\u4e00\u786e\u5b9a\u3002</p> <p>\u5ea6\u91cf\u6307\u6807\u540d\u79f0\u63cf\u8ff0\u4e86\u88ab\u76d1\u63a7\u7cfb\u7edf\u7684\u67d0\u4e2a\u6d4b\u91cf\u7279\u5f81\uff08\u6bd4\u5982 http_requests_total \u8868\u793a http \u8bf7\u6c42\u603b\u6570\uff09\u3002\u5ea6\u91cf\u6307\u6807\u540d\u79f0\u7531 ASCII \u5b57\u6bcd\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf\u548c\u5192\u53f7\u7ec4\u6210\uff0c\u987b\u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f <code>[a-zA-Z_:][a-zA-Z0-9_:]*</code>\u3002</p> <p>\u6807\u7b7e\u5f00\u542f\u4e86 Prometheus \u7684\u591a\u7ef4\u6570\u636e\u6a21\u578b\u3002\u5bf9\u4e8e\u540c\u4e00\u4e2a\u5ea6\u91cf\u6307\u6807\uff0c\u4e0d\u540c\u6807\u7b7e\u503c\u7ec4\u5408\u4f1a\u5f62\u6210\u7279\u5b9a\u7ef4\u5ea6\u7684\u65f6\u5e8f\u3002Prometheus \u7684\u67e5\u8be2\u8bed\u8a00\u53ef\u4ee5\u901a\u8fc7\u5ea6\u91cf\u6307\u6807\u548c\u6807\u7b7e\u5bf9\u65f6\u5e8f\u6570\u636e\u8fdb\u884c\u8fc7\u6ee4\u548c\u805a\u5408\u3002\u6539\u53d8\u4efb\u4f55\u5ea6\u91cf\u6307\u6807\u4e0a\u7684\u4efb\u4f55\u6807\u7b7e\u503c\uff0c\u90fd\u4f1a\u5f62\u6210\u65b0\u7684\u65f6\u5e8f\u3002\u6807\u7b7e\u540d\u79f0\u53ef\u4ee5\u5305\u542b ASCII \u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e0b\u5212\u7ebf\uff0c\u987b\u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f <code>[a-zA-Z_][a-zA-Z0-9_]*</code>\uff0c\u5e26\u6709 _ \u4e0b\u5212\u7ebf\u7684\u6807\u7b7e\u540d\u79f0\u4fdd\u7559\u4e3a\u5185\u90e8\u4f7f\u7528\u3002\u6807\u7b7e\u503c\u53ef\u4ee5\u5305\u542b\u4efb\u610f Unicode \u5b57\u7b26\uff0c\u5305\u62ec\u4e2d\u6587\u3002</p> <ul> <li>\u91c7\u6837\u503c\uff08Sample\uff09</li> </ul> <p>\u65f6\u5e8f\u6570\u636e\u5176\u5b9e\u5c31\u662f\u4e00\u7cfb\u5217\u91c7\u6837\u503c\u3002\u6bcf\u4e2a\u91c7\u6837\u503c\u5305\u62ec\uff1a</p> <ul> <li>\u4e00\u4e2a 64 \u4f4d\u7684\u6d6e\u70b9\u6570\u503c</li> <li> <p>\u4e00\u4e2a\u7cbe\u786e\u5230\u6beb\u79d2\u7684\u65f6\u95f4\u6233</p> </li> <li> <p>\u6ce8\u89e3\uff08Notation\uff09</p> </li> </ul> <p>\u4e00\u4e2a\u6ce8\u89e3\u7531\u4e00\u4e2a\u5ea6\u91cf\u6307\u6807\u548c\u4e00\u7ec4\u6807\u7b7e\u952e\u503c\u5bf9\u6784\u6210\u3002\u5f62\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>[metric name]{[label name]=[label value], ...}\n</code></pre> <p>\u4f8b\u5982\uff0c\u5ea6\u91cf\u6307\u6807\u4e3a api_http_requests_total\uff0c\u6807\u7b7e\u4e3a method=\"POST\"\u3001handler=\"/messages\" \u7684\u6ce8\u89e3\u8868\u793a\u5982\u4e0b\uff1a</p> <pre><code>api_http_requests_total{method=\"POST\", handler=\"/messages\"}\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#112","title":"1.1.2 \u5ea6\u91cf\u6307\u6807\u7c7b\u578b","text":"<ul> <li>\u8ba1\u6570\u5668\uff08Counter\uff09</li> </ul> <p>\u8ba1\u6570\u5668\u662f\u4e00\u79cd\u7d2f\u8ba1\b\u578b\u7684\u5ea6\u91cf\u6307\u6807\uff0c\u5b83\u662f\u4e00\u4e2a\u53ea\u80fd\u9012\u589e\u7684\u6570\u503c\u3002\u8ba1\u6570\u5668\u4e3b\u8981\u7528\u4e8e\u7edf\u8ba1\u7c7b\u4f3c\u4e8e\u670d\u52a1\u8bf7\u6c42\u6570\u3001\u4efb\u52a1\u5b8c\u6210\u6570\u548c\u9519\u8bef\u51fa\u73b0\u6b21\u6570\u8fd9\u6837\u7684\u6570\u636e\u3002</p> <ul> <li>\u8ba1\u91cf\u5668\uff08Gauge\uff09</li> </ul> <p>\u8ba1\u91cf\u5668\u8868\u793a\u4e00\u4e2a\u65e2\u53ef\u4ee5\u589e\u52a0, \u53c8\u53ef\u4ee5\u51cf\u5c11\u7684\u5ea6\u91cf\u6307\u6807\u503c\u3002\u8ba1\u91cf\u5668\u4e3b\u8981\u7528\u4e8e\u6d4b\u91cf\u7c7b\u4f3c\u4e8e\u6e29\u5ea6\u3001\u5185\u5b58\u4f7f\u7528\u91cf\u8fd9\u6837\u7684\u77ac\u65f6\u6570\u636e\u3002</p> <ul> <li>\u76f4\u65b9\u56fe\uff08Histogram\uff09</li> </ul> <p>\u76f4\u65b9\u56fe\u5bf9\u89c2\u5bdf\u7ed3\u679c\uff08\u901a\u5e38\u662f\u8bf7\u6c42\u6301\u7eed\u65f6\u95f4\u6216\u8005\u54cd\u5e94\u5927\u5c0f\u8fd9\u6837\u7684\u6570\u636e\uff09\u8fdb\u884c\u91c7\u6837\uff0c\u5e76\u5728\u53ef\u914d\u7f6e\u7684\u6876\u4e2d\u5bf9\u5176\u8fdb\u884c\u7edf\u8ba1\u3002\u6709\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u6765\u4ea7\u751f\u76f4\u65b9\u56fe\uff08\u5047\u8bbe\u5ea6\u91cf\u6307\u6807\u4e3a \uff09\uff1a <ul> <li>\u6309\u6876\u8ba1\u6570\uff0c\u76f8\u5f53\u4e8e <code>&lt;basename&gt;_bucket{le=\"&lt;upper inclusive bound&gt;\"}</code></li> <li>\b\u91c7\u6837\u503c\u603b\u548c\uff0c\u76f8\u5f53\u4e8e <code>&lt;basename&gt;_sum</code></li> <li> <p>\u91c7\u6837\u503c\u603b\u6570\uff0c\b\u76f8\u5f53\u4e8e <code>&lt;basename&gt;_count</code> \uff0c\u4e5f\u7b49\u540c\u4e8e\u628a\u6240\u6709\u91c7\u6837\u503c\u653e\u5230\u4e00\u4e2a\u6876\u91cc\u6765\u8ba1\u6570 <code>&lt;basename&gt;_bucket{le=\"+Inf\"}</code></p> </li> <li> <p>\u6c47\u603b\uff08Summary\uff09</p> </li> </ul> <p>\u7c7b\u4f3c\u4e8e\u76f4\u65b9\u56fe\uff0c\u6c47\u603b\u4e5f\u5bf9\u89c2\u5bdf\u7ed3\u679c\u8fdb\u884c\u91c7\u6837\u3002\u9664\u4e86\u53ef\u4ee5\u7edf\u8ba1\b\u91c7\u6837\u503c\u603b\u548c\u548c\u603b\u6570\uff0c\u5b83\u8fd8\u80fd\u591f\u6309\u5206\u4f4d\u6570\b\u7edf\u8ba1\u3002\u6709\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u6765\u4ea7\u751f\u6c47\u603b\uff08\u5047\u8bbe\u5ea6\u91cf\u6307\u6807\u4e3a \uff09\uff1a <ul> <li>\u6309\b\u5206\u4f4d\u6570\uff0c\u4e5f\u5c31\u662f\u91c7\u6837\u503c\u5c0f\u4e8e\u8be5\u5206\u4f4d\u6570\u7684\b\u4e2a\u6570\u5360\u603b\u6570\u7684\u6bd4\u4f8b\u5c0f\u4e8e \u03c6\uff0c\u76f8\u5f53\u4e8e <code>&lt;basename&gt;{quantile=\"&lt;\u03c6&gt;\"}</code></li> <li>\b\u91c7\u6837\u503c\u603b\u548c\uff0c\u76f8\u5f53\u4e8e <code>&lt;basename&gt;_sum</code></li> <li>\u91c7\u6837\u503c\u603b\u6570\uff0c\b\u76f8\u5f53\u4e8e <code>&lt;basename&gt;_count</code></li> </ul>"},{"location":"cloud-native/other/Prometheus/#113-jobinstance","title":"1.1.3 \u4efb\u52a1\uff08Job\uff09\u548c\u5b9e\u4f8b\uff08Instance\uff09","text":"<p>\u5728 Prometheus \u91cc\uff0c\u53ef\u4ee5\u4ece\u4e2d\u6293\u53d6\u91c7\u6837\u503c\u7684\u7aef\u70b9\u79f0\u4e3a\u5b9e\u4f8b\uff0c\u4e3a\u4e86\u6027\u80fd\u6269\u5c55\u800c\u590d\u5236\u51fa\u6765\u7684\u591a\u4e2a\u8fd9\u6837\u7684\u5b9e\u4f8b\u5f62\u6210\u4e86\u4e00\u4e2a\u4efb\u52a1\u3002</p> <p>\u4f8b\u5982\u4e0b\u9762\u7684 api-server \u4efb\u52a1\u6709\u56db\u4e2a\u76f8\u540c\u7684\u5b9e\u4f8b\uff1a</p> <pre><code>job: api-server\ninstance 1: 1.2.3.4:5670\ninstance 2: 1.2.3.4:5671\ninstance 3: 5.6.7.8:5670\ninstance 4: 5.6.7.8:5671\n</code></pre> <p>Prometheus \u6293\u53d6\u5b8c\u91c7\u6837\u503c\u540e\uff0c\u4f1a\u81ea\u52a8\u7ed9\u91c7\u6837\u503c\u6dfb\u52a0\u4e0b\u9762\u7684\u6807\u7b7e\u548c\u503c\uff1a</p> <ul> <li>job: \b\u6293\u53d6\u6240\u5c5e\u4efb\u52a1\u3002</li> <li>instance: \u6293\u53d6\u6765\u6e90\u5b9e\u4f8b</li> </ul> <p>\u53e6\u5916\u6bcf\u6b21\u6293\u53d6\u65f6\uff0cPrometheus \u8fd8\u4f1a\u81ea\u52a8\u5728\u4ee5\u4e0b\u65f6\u5e8f\u91cc\u63d2\u5165\u91c7\u6837\u503c\uff1a</p> <ul> <li><code>up{job=\"[job-name]\", instance=\"instance-id\"}</code>\uff1a\u91c7\u6837\u503c\u4e3a 1 \u8868\u793a\u5b9e\u4f8b\u5065\u5eb7\uff0c\u5426\u5219\u4e3a\u4e0d\u5065\u5eb7</li> <li><code>scrape_duration_seconds{job=\"[job-name]\", instance=\"[instance-id]\"}</code>\uff1a\u91c7\u6837\u503c\u4e3a\u672c\u6b21\u6293\u53d6\u6d88\u8017\u65f6\u95f4</li> <li><code>scrape_samples_post_metric_relabeling{job=\"&lt;job-name&gt;\", instance=\"&lt;instance-id&gt;\"}</code>\uff1a\u91c7\u6837\u503c\u4e3a\u91cd\u65b0\b\u6253\u6807\u7b7e\u540e\u7684\u91c7\u6837\u503c\u4e2a\u6570</li> <li><code>scrape_samples_scraped{job=\"&lt;job-name&gt;\", instance=\"&lt;instance-id&gt;\"}</code>\uff1a\u91c7\u6837\u503c\b\u4e3a\u672c\u6b21\u6293\u53d6\u5230\u7684\u91c7\u6837\u503c\u4e2a\u6570</li> </ul>"},{"location":"cloud-native/other/Prometheus/#12-prometheus","title":"1.2 prometheus\u7279\u70b9","text":"<ul> <li>\u591a\u7ef4\u5ea6\u6570\u636e\u6a21\u578b\uff0c\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u7531\u4e00\u4e2a\u5ea6\u91cf\u6307\u6807\u548c\u591a\u4e2a\u6807\u7b7e\u952e\u503c\u5bf9\u786e\u5b9a</li> <li>\u7075\u6d3b\u7684\u67e5\u8be2\u8bed\u8a00\uff0c\u5bf9\u6536\u96c6\u7684\u65f6\u8bb8\u6570\u636e\u8fdb\u884c\u91cd\u7ec4</li> <li>\u5f3a\u5927\u7684\u6570\u636e\u53ef\u89c6\u5316\u529f\u80fd\uff0c\u9664\u4e86\u5185\u7f6e\u7684\u6d4f\u89c8\u5668\uff0c\u4e5f\u652f\u6301grafana\u96c6\u6210</li> <li>\u9ad8\u6548\u5b58\u50a8\uff0c\u5185\u5b58\u52a0\u672c\u5730\u78c1\u76d8\uff0c\u53ef\u901a\u8fc7\u529f\u80fd\u5206\u7247\u548c\u8054\u76df\u6765\u62d3\u5c55\u6027\u80fd</li> <li>\u8fd0\u7ef4\u7b80\u5355\uff0c\u53ea\u4f9d\u8d56\u4e8e\u672c\u5730\u78c1\u76d8\uff0cgo\u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\u6ca1\u6709\u4efb\u4f55\u5176\u4ed6\u4f9d\u8d56</li> <li>\u7cbe\u7b80\u544a\u8b66</li> <li>\u975e\u5e38\u591a\u7684\u5ba2\u6237\u7aef\u5e93</li> <li>\u63d0\u4f9b\u4e86\u8bb8\u591a\u5bfc\u51fa\u5668\u6765\u6536\u96c6\u5e38\u7528\u7cfb\u7edf\u6307\u6807</li> </ul>"},{"location":"cloud-native/other/Prometheus/#13-altermanager","title":"1.3 altermanager \u6838\u5fc3\u6982\u5ff5","text":""},{"location":"cloud-native/other/Prometheus/#131","title":"1.3.1 \u5206\u7ec4","text":"<p>\u5206\u7ec4\u5c06\u7c7b\u4f3c\u6027\u8d28\u7684\u8b66\u62a5\u5206\u7c7b\u4e3a\u5355\u4e2a\u901a\u77e5\u3002\u5728\u8bb8\u591a\u7cfb\u7edf\u4e00\u6b21\u6027\u5931\u8d25\u5e76\u4e14\u6570\u767e\u5230\u6570\u5343\u4e2a\u8b66\u62a5\u53ef\u80fd\u540c\u65f6\u53d1\u751f\u7684\u8f83\u5927\u4e2d\u65ad\u671f\u95f4\uff0c\u8fd9\u5c24\u5176\u6709\u7528\u3002</p> <p>\u793a\u4f8b\uff1a\u53d1\u751f\u7f51\u7edc\u5206\u533a\u65f6\uff0c\u7fa4\u96c6\u4e2d\u6b63\u5728\u8fd0\u884c\u6570\u5341\u6216\u6570\u767e\u4e2a\u670d\u52a1\u5b9e\u4f8b\u3002\u4e00\u534a\u7684\u670d\u52a1\u5b9e\u4f8b\u65e0\u6cd5\u518d\u8bbf\u95ee\u6570\u636e\u5e93\u3002Prometheus\u4e2d\u7684\u8b66\u62a5\u89c4\u5219\u914d\u7f6e\u4e3a\u5728\u6bcf\u4e2a\u670d\u52a1\u5b9e\u4f8b\u65e0\u6cd5\u4e0e\u6570\u636e\u5e93\u901a\u4fe1\u65f6\u53d1\u9001\u8b66\u62a5\u3002\u7ed3\u679c\uff0c\u6570\u767e\u4e2a\u8b66\u62a5\u88ab\u53d1\u9001\u5230Alertmanager\u3002</p> <p>\u4f5c\u4e3a\u7528\u6237\uff0c\u4eba\u4eec\u53ea\u60f3\u83b7\u5f97\u5355\u4e2a\u9875\u9762\uff0c\u540c\u65f6\u4ecd\u80fd\u591f\u786e\u5207\u5730\u770b\u5230\u54ea\u4e9b\u670d\u52a1\u5b9e\u4f8b\u53d7\u5230\u5f71\u54cd\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u5c06Alertmanager\u914d\u7f6e\u4e3a\u6309\u7fa4\u96c6\u548calertname\u5bf9\u8b66\u62a5\u8fdb\u884c\u5206\u7ec4\uff0c\u4ee5\u4fbf\u53d1\u9001\u5355\u4e2a\u7d27\u51d1\u901a\u77e5\u3002</p> <p>\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u8def\u7531\u6811\u914d\u7f6e\u8b66\u62a5\u7684\u5206\u7ec4\uff0c\u5206\u7ec4\u901a\u77e5\u7684\u5b9a\u65f6\u4ee5\u53ca\u8fd9\u4e9b\u901a\u77e5\u7684\u63a5\u6536\u5668\u3002</p>"},{"location":"cloud-native/other/Prometheus/#132","title":"1.3.2 \u6291\u5236","text":"<p>\u5982\u679c\u67d0\u4e9b\u5176\u4ed6\u8b66\u62a5\u5df2\u7ecf\u89e6\u53d1\uff0c\u5219\u6291\u5236\u662f\u6291\u5236\u67d0\u4e9b\u8b66\u62a5\u7684\u901a\u77e5\u7684\u6982\u5ff5\u3002\u793a\u4f8b\uff1a\u6b63\u5728\u89e6\u53d1\u8b66\u62a5\uff0c\u901a\u77e5\u65e0\u6cd5\u8bbf\u95ee\u6574\u4e2a\u96c6\u7fa4\u3002Alertmanager\u53ef\u4ee5\u914d\u7f6e\u4e3a\u5728\u8be5\u7279\u5b9a\u8b66\u62a5\u89e6\u53d1\u65f6\u5c06\u4e0e\u8be5\u96c6\u7fa4\u6709\u5173\u7684\u6240\u6709\u5176\u4ed6\u8b66\u62a5\u9759\u97f3\u3002\u8fd9\u53ef\u4ee5\u9632\u6b62\u6570\u767e\u6216\u6570\u5343\u4e2a\u4e0e\u5b9e\u9645\u95ee\u9898\u65e0\u5173\u7684\u89e6\u53d1\u8b66\u62a5\u7684\u901a\u77e5\u3002\u901a\u8fc7Alertmanager\u7684\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u7981\u6b62\u3002</p>"},{"location":"cloud-native/other/Prometheus/#133","title":"1.3.3 \u6c89\u9ed8","text":"<p>\u6c89\u9ed8\u662f\u5728\u7ed9\u5b9a\u65f6\u95f4\u5185\u7b80\u5355\u5730\u9759\u97f3\u8b66\u62a5\u7684\u7b80\u5355\u65b9\u6cd5\u3002\u57fa\u4e8e\u5339\u914d\u5668\u914d\u7f6e\u9759\u9ed8\uff0c\u5c31\u50cf\u8def\u7531\u6811\u4e00\u6837\u3002\u68c0\u67e5\u4f20\u5165\u8b66\u62a5\u5b83\u4eec\u662f\u5426\u5339\u914d\u6d3b\u52a8\u9759\u9ed8\u7684\u6240\u6709\u76f8\u7b49\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u5668\u3002\u5982\u679c\u4ed6\u4eec\u8fd9\u6837\u505a\uff0c\u5219\u4e0d\u4f1a\u53d1\u9001\u8be5\u8b66\u62a5\u7684\u901a\u77e5\u3002\u5728Alertmanager\u7684Web\u754c\u9762\u4e2d\u914d\u7f6e\u4e86\u9759\u97f3\u3002</p>"},{"location":"cloud-native/other/Prometheus/#134","title":"1.3.4 \u5ba2\u6237\u7aef\u884c\u4e3a","text":"<p>Alertmanager\u5bf9\u5176\u5ba2\u6237\u7684\u884c\u4e3a\u6709\u7279\u6b8a\u8981\u6c42\u3002\u8fd9\u4e9b\u4ec5\u9002\u7528\u4e8e\u4e0d\u4f7f\u7528Prometheus\u53d1\u9001\u8b66\u62a5\u7684\u9ad8\u7ea7\u7528\u4f8b\u3002</p>"},{"location":"cloud-native/other/Prometheus/#135","title":"1.3.5 \u9ad8\u53ef\u7528","text":"<p>Alertmanager\u652f\u6301\u914d\u7f6e\u4ee5\u521b\u5efa\u7528\u4e8e\u9ad8\u53ef\u7528\u6027\u7684\u96c6\u7fa4\u3002\u8fd9\u53ef\u4ee5\u4f7f\u7528--cluster- *\u6807\u5fd7\u8fdb\u884c\u914d\u7f6e\u3002\u91cd\u8981\u7684\u662f\u4e0d\u8981\u5728Prometheus\u548c\u5b83\u7684Alertmanagers\u4e4b\u95f4\u52a0\u8f7d\u5e73\u8861\u6d41\u91cf\uff0c\u800c\u662f\u5c06Prometheus\u6307\u5411\u6240\u6709Alertmanagers\u7684\u5217\u8868\u3002</p>"},{"location":"cloud-native/other/Prometheus/#_2","title":"\u4e8c \u67b6\u6784","text":""},{"location":"cloud-native/other/Prometheus/#21-prometheus","title":"2.1 prometheus\u67b6\u6784\u56fe","text":""},{"location":"cloud-native/other/Prometheus/#22-altermanager","title":"2.2 altermanager\u67b6\u6784\u56fe","text":""},{"location":"cloud-native/other/Prometheus/#_3","title":"\u4e09 \u4e0e\u5176\u4ed6\u76d1\u63a7\u7cfb\u7edf\u5bf9\u4e0d","text":""},{"location":"cloud-native/other/Prometheus/#31-prometheus-vs-zabbix","title":"3.1 Prometheus vs. Zabbix","text":"<ul> <li>Zabbix \u4f7f\u7528\u7684\u662f C \u548c PHP, Prometheus \u4f7f\u7528 Golang, \u6574\u4f53\u800c\u8a00 Prometheus \u8fd0\u884c\u901f\u5ea6\u66f4\u5feb\u4e00\u70b9\u3002</li> <li>Zabbix \u5c5e\u4e8e\u4f20\u7edf\u4e3b\u673a\u76d1\u63a7\uff0c\u4e3b\u8981\u7528\u4e8e\u7269\u7406\u4e3b\u673a\u3001\u4ea4\u6362\u673a\u3001\u7f51\u7edc\u7b49\u76d1\u63a7\uff0cPrometheus \u4e0d\u4ec5\u9002\u7528\u4e3b\u673a\u76d1\u63a7\uff0c\u8fd8\u9002\u7528\u4e8e Cloud\u3001SaaS\u3001Openstack\u3001Container \u76d1\u63a7\u3002</li> <li>Zabbix \u5728\u4f20\u7edf\u4e3b\u673a\u76d1\u63a7\u65b9\u9762\uff0c\u6709\u66f4\u4e30\u5bcc\u7684\u63d2\u4ef6\u3002</li> <li>Zabbix \u53ef\u4ee5\u5728 WebGui \u4e2d\u914d\u7f6e\u5f88\u591a\u4e8b\u60c5\uff0cPrometheus \u9700\u8981\u624b\u52a8\u4fee\u6539\u6587\u4ef6\u914d\u7f6e\u3002\u3001</li> </ul>"},{"location":"cloud-native/other/Prometheus/#32-prometheus-vs-nagios","title":"3.2 Prometheus vs. Nagios","text":"<ul> <li>Nagios \u6570\u636e\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49 Labels, \u4e0d\u652f\u6301\u67e5\u8be2\uff0c\u544a\u8b66\u4e5f\u4e0d\u652f\u6301\u53bb\u566a\u3001\u5206\u7ec4, \u6ca1\u6709\u6570\u636e\u5b58\u50a8\uff0c\u5982\u679c\u60f3\u67e5\u8be2\u5386\u53f2\u72b6\u6001\uff0c\u9700\u8981\u5b89\u88c5\u63d2\u4ef6\u3002</li> <li>Nagios \u662f\u4e0a\u4e16\u7eaa 90 \u5e74\u4ee3\u7684\u76d1\u63a7\u7cfb\u7edf\uff0c\u6bd4\u8f83\u9002\u5408\u5c0f\u96c6\u7fa4\u6216\u9759\u6001\u7cfb\u7edf\u7684\u76d1\u63a7Nagios \u592a\u53e4\u8001\uff0c\u5f88\u591a\u7279\u6027\u90fd\u6ca1\u6709\uff0cPrometheus \u8981\u4f18\u79c0\u5f88\u591a\u3002</li> </ul>"},{"location":"cloud-native/other/Prometheus/#33-prometheus-vs-sensu","title":"3.3 Prometheus vs Sensu","text":"<ul> <li>Sensu \u5e7f\u4e49\u4e0a\u8bb2\u662f Nagios \u7684\u5347\u7ea7\u7248\u672c\uff0c\u5b83\u89e3\u51b3\u4e86\u5f88\u591a Nagios \u7684\u95ee\u9898\uff0c\u5982\u679c\u4f60\u5bf9 Nagios \u5f88\u719f\u6089\uff0c\u4f7f\u7528 Sensu \u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002</li> <li>Sensu \u4f9d\u8d56 RabbitMQ \u548c Redis\uff0c\u6570\u636e\u5b58\u50a8\u4e0a\u6269\u5c55\u6027\u66f4\u597d\u3002</li> </ul>"},{"location":"cloud-native/other/Prometheus/#34-prometheus-vs-influxdb","title":"3.4 Prometheus vs InfluxDB","text":"<ul> <li>InfluxDB \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u4e3b\u8981\u7528\u4e8e\u5b58\u50a8\u6570\u636e\uff0c\u5982\u679c\u60f3\u642d\u5efa\u76d1\u63a7\u544a\u8b66\u7cfb\u7edf\uff0c\u9700\u8981\u4f9d\u8d56\u5176\u4ed6\u7cfb\u7edf\u3002</li> <li>InfluxDB \u5728\u5b58\u50a8\u6c34\u5e73\u6269\u5c55\u4ee5\u53ca\u9ad8\u53ef\u7528\u65b9\u9762\u505a\u7684\u66f4\u597d, \u6bd5\u7adf\u6838\u5fc3\u662f\u6570\u636e\u5e93\u3002</li> </ul>"},{"location":"cloud-native/other/Prometheus/#_4","title":"\u56db \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/other/Prometheus/#41-prometheus","title":"4.1 prometheus\u5b89\u88c5","text":"<ul> <li>\u4e8c\u8fdb\u5236\u5b89\u88c5</li> </ul> <pre><code>cd /opt &amp;&amp; wget https://github.com/prometheus/prometheus/releases/download/v2.12.0/prometheus-2.12.0.linux-amd64.tar.gz \ntar -zxf prometheus-2.12.0.linux-amd64.tar.gz\nmv prometheus-2.12.0.linux-amd64 prometheus\nchown root.root prometheus -R\n\n# \u914d\u7f6e\u4e3a\u670d\u52a1\ncat &gt;/usr/lib/systemd/system/prometheus.service &lt;&lt;EOF\n[Unit]\nDescription=Prometheus\nDocumentation=https://prometheus.io/\nAfter=network.target\n\n[Service]\nType=simple\nExecStart=/opt/prometheus/prometheus --config.file=/opt/prometheus/prometheus.yml\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n# \u8bbe\u7f6e\u670d\u52a1\u5f00\u673a\u81ea\u542f\u52a8\nsystemctl enable prometheus\nsystemctl start prometheus\n\n# \u76f4\u63a5\u542f\u52a8\nnohup ./prometheus --config.file=prometheus.yml 2&gt;&amp;1 1&gt;prometheus.log &amp;\n\n# \u67e5\u770b\u670d\u52a1\n[root@VM_0_13_centos pushgateway]# netstat -lntup |grep prometheus\ntcp6       0      0 :::9090                 :::*                    LISTEN      16655/prometheus\n</code></pre> <ul> <li>\u6e90\u7801\u7f16\u8bd1\u5b89\u88c5</li> </ul> <pre><code>$ go get github.com/prometheus/prometheus/cmd/...\n$ prometheus --config.file=your_config.yml\n\n\n# \u6216\u8005make build\n$ mkdir -p $GOPATH/src/github.com/prometheus\n$ cd $GOPATH/src/github.com/prometheus\n$ git clone https://github.com/prometheus/prometheus.git\n$ cd prometheus\n$ make build\n$ ./prometheus --config.file=your_config.yml\n</code></pre> <ul> <li>docker\u5b89\u88c5</li> </ul> <pre><code>docker run --name prometheus -d -p 127.0.0.1:9090:9090 prom/prometheus\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#42-alertmanager","title":"4.2 alertmanager\u5b89\u88c5","text":"<ul> <li>\u4e8c\u8fdb\u5236\u5b89\u88c5</li> </ul> <pre><code>cd /opt &amp;&amp; wget -c https://github.com/prometheus/alertmanager/releases/download/v0.18.0/alertmanager-0.18.0.linux-amd64.tar.gz\ntar zxf alertmanager-0.18.0.linux-amd64.tar.gz\nmv alertmanager-0.18.0.linux-amd64 alertmanager\nchown root.root alertmanager -R\n\n# \u914d\u7f6e\u670d\u52a1\ncat &gt;/usr/lib/systemd/system/alertmanager.service &lt;&lt;EOF\n[Unit]\nDescription=Alertmanager\nDocumentation=https://prometheus.io/\nAfter=network.target\n\n[Service]\nType=simple\nExecStart=/opt/alertmanager/alertmanager --config.file=/opt/alertmanager/alertmanager.yml\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n# \u8bbe\u7f6e\u670d\u52a1\u5f00\u673a\u81ea\u542f\u52a8\nsystemctl enable alertmanager\nsystemctl start alertmanager\n\n# \u76f4\u63a5\u542f\u52a8\nnohup ./alertmanager --config.file=alertmanager.yml 2&gt;&amp;1 1&gt;alertmanager.log &amp;\n\n# \u67e5\u770b\u670d\u52a1\n[root@VM_0_13_centos pushgateway]# netstat -lntup |grep alertmanager\ntcp6       0      0 :::9094                 :::*                    LISTEN      17237/alertmanager\ntcp6       0      0 :::9093                 :::*                    LISTEN      17237/alertmanager\nudp6       0      0 :::9094                 :::*                                17237/alertmanager\n</code></pre> <ul> <li>\u7f16\u8bd1\u5b89\u88c5</li> </ul> <pre><code>$ GO15VENDOREXPERIMENT=1 go get github.com/prometheus/alertmanager/cmd/...\n# cd $GOPATH/src/github.com/prometheus/alertmanager\n$ alertmanager --config.file=&lt;your_file&gt;\n\n# \u624b\u52a8\u6e90\u7801\u6784\u5efa\n$ mkdir -p $GOPATH/src/github.com/prometheus\n$ cd $GOPATH/src/github.com/prometheus\n$ git clone https://github.com/prometheus/alertmanager.git\n$ cd alertmanager\n$ make build\n$ ./alertmanager --config.file=&lt;your_file&gt;\n\n# amtool\u6784\u5efa\n$ make build BINARIES=amtool\n</code></pre> <ul> <li>docker\u5b89\u88c5</li> </ul> <pre><code>docker pull quay.io/prometheus/alertmanager\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#43-node_export","title":"4.3 node_export\u5b89\u88c5","text":"<p>\u5229\u7528node_export\u6765\u76d1\u63a7\u4e3b\u673a\uff0c\u5b98\u65b9\u4e5f\u63d0\u4f9b\u4e86\u5f88\u591a\u5176\u4ed6\u7684export\u53ef\u4ee5\u7528\u6765\u76f4\u63a5\u4f7f\u7528</p> <ul> <li>\u4e8c\u8fdb\u5236\u5b89\u88c5</li> </ul> <pre><code>cd /opt &amp;&amp; wget -c https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz\ntar zxf node_exporter-0.18.1.linux-amd64.tar.gz\nmv node_exporter-0.18.1.linux-amd64 node_exporter\nchown root.root node_exporter -R\n\n# \u914d\u7f6e\u670d\u52a1\ncat &gt;/usr/lib/systemd/system/node_exporter.service &lt;&lt;EOF\n[Unit]\nDescription=node_exporter\nDocumentation=https://prometheus.io/\nAfter=network.target\n\n[Service]\nType=simple\nExecStart=/opt/node_exporter/node_exporter\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n# \u8bbe\u7f6e\u670d\u52a1\u5f00\u673a\u81ea\u542f\u52a8\nsystemctl enable node_exporter\nsystemctl start node_exporter\n\n# \u76f4\u63a5\u542f\u52a8\nnohup ./node_exporter --config.file=node_exporter.yml 2&gt;&amp;1 1&gt;node_exporter.log &amp;\n\n# \u67e5\u770b\u670d\u52a1\n[root@VM_0_13_centos pushgateway]# netstat -lntup |grep node_export\ntcp6       0      0 :::9100                 :::*                    LISTEN      4551/node_exporter\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#44-pushgateway","title":"4.4 pushgateway","text":"<ul> <li>\u5b89\u88c5</li> </ul> <pre><code>cd /opt &amp;&amp; wget -c https://github.com/prometheus/pushgateway/releases/download/v0.9.1/pushgateway-0.9.1.linux-amd64.tar.gz\ntar zxf pushgateway-0.9.1.linux-amd64.tar.gz\nmv pushgateway-0.9.1.linux-amd64 pushgateway\nchown root.root pushgateway -R\n\n# \u914d\u7f6e\u670d\u52a1\ncat &gt;/usr/lib/systemd/system/pushgateway.service &lt;&lt;EOF\n[Unit]\nDescription=pushgateway\nDocumentation=https://prometheus.io/\nAfter=network.target\n\n[Service]\nType=simple\nExecStart=/opt/pushgateway/pushgateway\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n# \u8bbe\u7f6e\u670d\u52a1\u5f00\u673a\u81ea\u542f\u52a8\nsystemctl enable pushgateway\nsystemctl start pushgateway\n\n# \u76f4\u63a5\u542f\u52a8\nnohup ./pushgateway --config.file=node_exporter.yml 2&gt;&amp;1 1&gt;node_exporter.log &amp;\n\n# \u67e5\u770b\u670d\u52a1\n[root@VM_0_13_centos pushgateway]# netstat -lntup |grep push\ntcp6       0      0 :::9091                 :::*                    LISTEN      5982/pushgateway\n</code></pre> <ul> <li>\u67e5\u770bweb\u9875\u9762</li> </ul> <ul> <li>shell\u547d\u4ee4\u521b\u5efa</li> </ul> <pre><code>echo \"some_metric 3.14\" | curl --data-binary @- http://localhost:9091/metrics/job/some_job\n</code></pre> <ul> <li>\u53d1\u9001\u590d\u6742\u6570\u636e</li> </ul> <pre><code>cat &lt;&lt;EOF | curl --data-binary @- http://localhost:9091/metrics/job/some_job/instance/some_instance\n# TYPE some_metric counter\nsome_metric{label=\"val1\"} 42\n# TYPE another_metric gauge\n# HELP another_metric Just an example.\nanother_metric 2398.283\nEOF\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#45-grafana","title":"4.5 Grafana\u914d\u7f6e","text":""},{"location":"cloud-native/other/Prometheus/#451-grafana","title":"4.5.1 grafana\u5b89\u88c5","text":"<ul> <li>\u5b89\u88c5grafana</li> </ul> <pre><code>wget https://dl.grafana.com/oss/release/grafana-6.3.3-1.x86_64.rpm \nsudo yum localinstall grafana-6.3.3-1.x86_64.rpm -y\n\nsystemctl enable grafana-server.service\nsystemctl start grafana-server.service\n# web\u9875\u97623000 \u767b\u5f55\u4fe1\u606f\uff1aadmin/admin\n\n# \u5b89\u88c5\u63d2\u4ef6\ngrafana-cli plugins install grafana-piechart-panel\nsystemctl restart grafana-server\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#452","title":"4.5.2 \u6dfb\u52a0\u6570\u636e\u6e90","text":"<p>\u6dfb\u52a0prometheus\uff0c\u586b\u5199prometheus\u7684\u7ba1\u7406\u5730\u5740</p> <p></p> <ul> <li>\u5bfc\u5165dashboard</li> </ul> <p>\u901a\u8fc7https://grafana.com/grafana/dashboards\u4e2d\u83b7\u53d6</p> <ul> <li>\u914d\u7f6edashboard</li> </ul> <p></p> <p></p>"},{"location":"cloud-native/other/Prometheus/#453-grafana","title":"4.5.3 grafana\u544a\u8b66\u90ae\u4ef6\u914d\u7f6e","text":"<ul> <li>\u4fee\u6539grafana\u914d\u7f6e\u6587\u4ef6\uff0c\u6dfb\u52a0email\u914d\u7f6e</li> </ul> <pre><code># \u4fee\u6539/etc/grafana/grafana.ini\n\n[smtp]\nenabled = true\nhost = smtxxxxxxom:465\nuser = 1xxxxxxxxx\n# If the password contains # or ; you have to wrap it with trippel quotes. Ex \"\"\"#password;\"\"\"\npassword = xxxxxxxxxxxx\n;cert_file =\n;key_file =\n;skip_verify = false\nfrom_address = 1xxxxxxxxxxx3316@163.com\n;from_name = Grafana\n;ehlo_identity = dashboard.example.com\n</code></pre> <ul> <li>grafana web\u754c\u9762\u914d\u7f6eNotification channels</li> </ul>"},{"location":"cloud-native/other/Prometheus/#44-alter","title":"4..4 alter\u914d\u7f6e","text":"<p>\u26a0\ufe0f\uff1aTemplate variables are not supported in alert queries\uff0c\u5728\u67e5\u8be2\u4e2d\u4e0d\u80fd\u4f7f\u7528\u6a21\u7248\u8bed\u6cd5\uff0c\u4e0d\u7136\u65e0\u6cd5\u521b\u5efa\u544a\u8b66</p> <p></p> <p></p> <p>\u544a\u8b66\u6d4b\u8bd5</p> <p></p> <p>\u67e5\u770b\u544a\u8b66\u5386\u53f2</p> <p></p> <p>\u544a\u8b66\u89e6\u53d1</p> <p></p> <p></p>"},{"location":"cloud-native/other/Prometheus/#promql","title":"\u4e94 PromQL","text":"<p>PromQL\uff08Prometheus Query Language\uff09\u662f Prometheus \u81ea\u5df1\u5f00\u53d1\u7684\u8868\u8fbe\u5f0f\u8bed\u8a00\uff0c\u8bed\u8a00\u8868\u73b0\u529b\u5f88\u4e30\u5bcc\uff0c\u5185\u7f6e\u51fd\u6570\u4e5f\u5f88\u591a\u3002\u4f7f\u7528\u5b83\b\u53ef\u4ee5\u5bf9\u65f6\u5e8f\u6570\u636e\u8fdb\u884c\u7b5b\u9009\u548c\u805a\u5408\u3002</p>"},{"location":"cloud-native/other/Prometheus/#51-promql","title":"5.1 PromQL\u8bed\u6cd5","text":""},{"location":"cloud-native/other/Prometheus/#511","title":"5.1.1 \u6570\u636e\u7c7b\u578b","text":"<p>PromQL \u8868\u8fbe\u5f0f\u8ba1\u7b97\u51fa\u6765\u7684\u503c\u6709\u4ee5\u4e0b\u51e0\u79cd\u7c7b\u578b\uff1a</p> <ul> <li>\u77ac\u65f6\u5411\u91cf (Instant vector): \u4e00\u7ec4\u65f6\u5e8f\uff0c\u6bcf\u4e2a\u65f6\u5e8f\u53ea\u6709\u4e00\u4e2a\u91c7\u6837\u503c</li> <li>\u533a\u95f4\u5411\u91cf (Range vector): \u4e00\u7ec4\u65f6\u5e8f\uff0c\u6bcf\u4e2a\u65f6\u5e8f\u5305\u542b\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u591a\u4e2a\u91c7\u6837\u503c</li> <li>\u6807\u91cf\u6570\u636e (Scalar): \u4e00\u4e2a\u6d6e\u70b9\u6570</li> <li>\u5b57\u7b26\u4e32 (String): \u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6682\u65f6\u672a\u7528</li> </ul>"},{"location":"cloud-native/other/Prometheus/#512","title":"5.1.2 \u65f6\u5e8f\u9009\u62e9\u5668","text":"<ul> <li>\u77ac\u65f6\u5411\u91cf\u9009\u62e9\u5668</li> </ul> <p>\u77ac\u65f6\u5411\u91cf\u9009\u62e9\u5668\u7528\u6765\u9009\u62e9\u4e00\u7ec4\u65f6\u5e8f\u5728\u67d0\u4e2a\u91c7\u6837\u70b9\u7684\u91c7\u6837\u503c\u3002</p> <p>\u6700\u7b80\u5355\u7684\u60c5\u51b5\u5c31\u662f\u6307\u5b9a\u4e00\u4e2a\u5ea6\u91cf\u6307\u6807\uff0c\u9009\u62e9\u51fa\u6240\u6709\u5c5e\u4e8e\u8be5\u5ea6\u91cf\u6307\u6807\u7684\u65f6\u5e8f\u7684\u5f53\u524d\u91c7\u6837\u503c\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>http_requests_total\n</code></pre> <p>\b\u53ef\u4ee5\u901a\u8fc7\u5728\u540e\u9762\u6dfb\u52a0\u7528\u5927\u62ec\u53f7\u5305\u56f4\u8d77\u6765\u7684\u4e00\u7ec4\u6807\u7b7e\u952e\u503c\u5bf9\u6765\u5bf9\u65f6\u5e8f\u8fdb\u884c\u8fc7\u6ee4\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\u7b5b\u9009\u51fa\u4e86 job \b\u4e3a prometheus\uff0c\u5e76\u4e14 group \u4e3a canary \u7684\u65f6\u5e8f\uff1a</p> <pre><code>http_requests_total{job=\"prometheus\", group=\"canary\"}\n</code></pre> <p>\u5339\u914d\u6807\u7b7e\b\u503c\u65f6\u53ef\u4ee5\u662f\u7b49\u4e8e\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u603b\u5171\u6709\u4e0b\u9762\u51e0\u79cd\u5339\u914d\u64cd\u4f5c\u7b26\uff1a</p> <ul> <li>=\uff1a\u5b8c\u5168\u76f8\u7b49</li> <li>!=: \u4e0d\u76f8\u7b49</li> <li>=~: \u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d</li> <li>!~: \u6b63\u5219\u8868\u8fbe\u5f0f\u4e0d\u5339\u914d</li> </ul> <p>\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\u7b5b\u9009\u51fa\u4e86 environment \u4e3a staging \u6216 testing \u6216 development\uff0c\u5e76\u4e14 method \u4e0d\u662f GET \u7684\u65f6\u5e8f\uff1a</p> <pre><code>http_requests_total{environment=~\"staging|testing|development\",method!=\"GET\"}\n</code></pre> <p>\u5ea6\u91cf\u6307\u6807\u540d\u53ef\u4ee5\u4f7f\u7528\u5185\u90e8\u6807\u7b7e <code>__name__</code> \u6765\u5339\u914d\uff0c\u8868\u8fbe\u5f0f <code>http_requests_total</code> \b\u4e5f\u53ef\u4ee5\u5199\u6210 <code>{__name__=\"http_requests_total\"}</code>\u3002\u8868\u8fbe\u5f0f <code>{__name__=~\"job:.*\"}</code> \u5339\u914d\u6240\u6709\b\b\u5ea6\u91cf\b\u6307\u6807\u540d\u79f0\u4ee5 <code>job:</code> \u6253\u5934\u7684\u65f6\u5e8f\u3002</p> <ul> <li>\u533a\u95f4\u5411\u91cf\u9009\u62e9\u5668</li> </ul> <p>\u533a\u95f4\u5411\u91cf\u9009\u62e9\u5668\u7c7b\u4f3c\u4e8e\u77ac\u65f6\u5411\u91cf\u9009\u62e9\u5668\uff0c\u4e0d\u540c\u7684\u662f\u5b83\u9009\u62e9\u7684\u662f\u8fc7\u53bb\u4e00\u6bb5\u65f6\u95f4\u7684\u91c7\u6837\u503c\u3002\u53ef\u4ee5\u901a\u8fc7\u5728\u77ac\u65f6\u5411\u91cf\u9009\u62e9\u5668\u540e\u9762\u6dfb\u52a0\u5305\u542b\u5728 <code>[]</code> \u91cc\u7684\u65f6\u957f\u6765\u5f97\u5230\u533a\u95f4\u5411\u91cf\u9009\u62e9\u5668\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\u9009\u51fa\u4e86\u6240\u6709\u5ea6\u91cf\u6307\u6807\u4e3a http_requests_total \u4e14 job \u4e3a prometheus \u7684\u65f6\u5e8f\u5728\u8fc7\u53bb 5 \u5206\u949f\u7684\u91c7\u6837\u503c\u3002</p> <pre><code>http_requests_total{job=\"prometheus\"}[5m]\n</code></pre> <p>\u65f6\u957f\u7684\u5355\u4f4d\u53ef\u4ee5\u662f\u4e0b\u9762\u51e0\u79cd\u4e4b\u4e00\uff1a</p> <ul> <li>s\uff1aseconds</li> <li>m\uff1aminutes</li> <li>h\uff1ahours</li> <li>d\uff1adays</li> <li>w\uff1aweeks</li> <li> <p>y\uff1ayears</p> </li> <li> <p>\u504f\u79fb\b\u4fee\u9970\u5668</p> </li> </ul> <p>\u524d\u9762\u4ecb\u7ecd\u7684\u9009\u62e9\u5668\u9ed8\u8ba4\u90fd\u662f\u4ee5\u5f53\u524d\u65f6\u95f4\u4e3a\u57fa\u51c6\u65f6\u95f4\uff0c\u504f\u79fb\u4fee\u9970\u5668\u7528\u6765\u8c03\u6574\u57fa\u51c6\u65f6\u95f4\uff0c\u4f7f\u5176\u5f80\u524d\u504f\u79fb\u4e00\u6bb5\u65f6\u95f4\u3002\b\u504f\u79fb\u4fee\u9970\u5668\u7d27\u8ddf\u5728\u9009\u62e9\u5668\u540e\u9762\uff0c\u4f7f\u7528 <code>offset</code> \u6765\u6307\u5b9a\u8981\u504f\u79fb\u7684\u91cf\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\u9009\u62e9\u5ea6\u91cf\u540d\u79f0\u4e3a http_requests_total \u7684\b\u6240\u6709\u65f6\u5e8f\u5728 5 \u5206\u949f\u524d\u7684\u91c7\u6837\u503c\u3002</p> <pre><code>http_requests_total offset 5m\n</code></pre> <p>\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\u9009\u62e9 http_requests_total \u5ea6\u91cf\u6307\u6807\u5728 1 \u5468\u524d\u7684\u8fd9\u4e2a\u65f6\u95f4\u70b9\u8fc7\u53bb 5 \u5206\u949f\u7684\u91c7\u6837\u503c\u3002</p> <pre><code>http_requests_total[5m] offset 1w\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#52-promql","title":"5.2 PromQL\u64cd\u4f5c\u7b26","text":""},{"location":"cloud-native/other/Prometheus/#521","title":"5.2.1 \u4e8c\u5143\u64cd\u4f5c\u7b26","text":"<p>PromQL \u7684\u4e8c\u5143\u64cd\u4f5c\u7b26\u652f\u6301\u57fa\u672c\u7684\u903b\u8f91\u548c\u7b97\u672f\u8fd0\u7b97\uff0c\u5305\u542b\u7b97\u672f\u7c7b\u3001\u6bd4\u8f83\u7c7b\u548c\u903b\u8f91\u7c7b\b\u4e09\u5927\u7c7b\u3002</p> <ul> <li>\u7b97\u672f\u7c7b\u4e8c\u5143\u64cd\u4f5c\u7b26</li> </ul> <p>\u7b97\u672f\u7c7b\u4e8c\u5143\u64cd\u4f5c\u7b26\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>+\uff1a\u52a0</li> <li>-\uff1a\u51cf</li> <li>*\uff1a\u4e58</li> <li>/\uff1a\u9664</li> <li>%\uff1a\u6c42\u4f59</li> <li>^\uff1a\u4e58\u65b9</li> </ul> <p>\u7b97\u672f\u7c7b\u4e8c\u5143\u64cd\u4f5c\u7b26\u53ef\u4ee5\b\u4f7f\u7528\u5728\u6807\u91cf\u4e0e\u6807\u91cf\u3001\u5411\u91cf\u4e0e\u6807\u91cf\uff0c\u4ee5\u53ca\u5411\u91cf\u4e0e\u5411\u91cf\u4e4b\u95f4</p> <p>\u4e8c\u5143\u64cd\u4f5c\u7b26\u4e0a\u4e0b\u6587\u91cc\u7684\u5411\u91cf\u7279\u6307\u77ac\u65f6\u5411\u91cf\uff0c\u4e0d\u5305\u62ec\u533a\u95f4\u5411\u91cf\u3002</p> <ul> <li>\u6807\u91cf\u4e0e\u6807\u91cf\u4e4b\u95f4\uff0c\u7ed3\u679c\u5f88\u660e\u663e\uff0c\u8ddf\u901a\u5e38\u7684\u7b97\u672f\u8fd0\u7b97\u4e00\u81f4\u3002</li> <li>\u5411\u91cf\u4e0e\u6807\u91cf\u4e4b\u95f4\uff0c\u76f8\u5f53\u4e8e\u628a\u6807\u91cf\u8ddf\u5411\u91cf\u91cc\u7684\u6bcf\u4e00\u4e2a\u6807\u91cf\u8fdb\u884c\u8fd0\u7b97\uff0c\u8fd9\u4e9b\b\u8ba1\u7b97\u7ed3\u679c\u7ec4\u6210\u4e86\u4e00\u4e2a\u65b0\u7684\u5411\u91cf\u3002</li> <li> <p>\u5411\u91cf\u4e0e\u5411\u91cf\u4e4b\u95f4\uff0c\u4f1a\u7a0d\u5fae\u9ebb\u70e6\u4e00\u4e9b\u3002\b\u8fd0\u7b97\u7684\u65f6\u5019\b\u9996\u5148\u4f1a\u4e3a\u5de6\u8fb9\u5411\u91cf\u91cc\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u5728\u53f3\u8fb9\u5411\u91cf\u91cc\u53bb\u5bfb\u627e\u4e00\u4e2a\u5339\u914d\u5143\u7d20\uff08\u5339\u914d\u89c4\u5219\u540e\u9762\u4f1a\u8bb2\uff09\uff0c\u7136\u540e\b\u5bf9\u8fd9\u4e24\u4e2a\u5339\u914d\u5143\u7d20\u6267\u884c\u8ba1\u7b97\uff0c\u8fd9\u6837\u6bcf\u5bf9\u5339\u914d\u5143\u7d20\u7684\u8ba1\u7b97\u7ed3\u679c\u7ec4\u6210\u4e86\u4e00\u4e2a\u65b0\u7684\u5411\u91cf\u3002\u5982\u679c\u6ca1\u6709\u627e\u5230\u5339\u914d\u5143\u7d20\uff0c\u5219\u8be5\u5143\u7d20\u4e22\u5f03\u3002</p> </li> <li> <p>\u6bd4\u8f83\u7c7b\u4e8c\u5143\u64cd\u4f5c\u7b26</p> </li> </ul> <p>\u6bd4\u8f83\u7c7b\u4e8c\u5143\u64cd\u4f5c\u7b26\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>== (equal)</li> <li>!= (not-equal)</li> <li>&gt; (greater-than)</li> <li>&lt; (less-than)</li> <li>&gt;= (greater-or-equal)</li> <li>&lt;= (less-or-equal)</li> </ul> <p>\u6bd4\u8f83\u7c7b\u4e8c\u5143\u64cd\u4f5c\u7b26\u540c\u6837\u53ef\u4ee5\b\u4f7f\u7528\u5728\u6807\u91cf\u4e0e\u6807\u91cf\u3001\u5411\u91cf\u4e0e\u6807\u91cf\uff0c\u4ee5\u53ca\u5411\u91cf\u4e0e\u5411\u91cf\u4e4b\u95f4\u3002\u9ed8\u8ba4\u6267\u884c\u7684\u662f\u8fc7\u6ee4\uff0c\u4e5f\u5c31\u662f\u4fdd\u7559\u503c\u3002\u53ef\u4ee5\u901a\u8fc7\u5728\u8fd0\u7b97\u7b26\u540e\u9762\u8ddf <code>bool</code> \u4fee\u9970\u7b26\u6765\u4f7f\u5f97\u8fd4\u56de\u503c 0 \u548c 1\uff0c\u800c\u4e0d\u662f\u8fc7\u6ee4\u3002</p> <ul> <li>\u6807\u91cf\u4e0e\u6807\u91cf\u4e4b\u95f4\uff0c\u5fc5\u987b\u8ddf bool \u4fee\u9970\u7b26\uff0c\u56e0\u6b64\u7ed3\u679c\u53ea\u53ef\u80fd\u662f 0\uff08false\uff09 \u6216 1\uff08true\uff09\u3002</li> <li>\u5411\u91cf\u4e0e\u6807\u91cf\u4e4b\u95f4\uff0c\u76f8\u5f53\u4e8e\u628a\u5411\u91cf\u91cc\u7684\u6bcf\u4e00\u4e2a\u6807\u91cf\u8ddf\u6807\u91cf\u8fdb\u884c\u6bd4\u8f83\uff0c\u7ed3\u679c\b\u4e3a\u771f\u5219\u4fdd\u7559\uff0c\u5426\u5219\u4e22\u5f03\u3002\u5982\u679c\u540e\u9762\u8ddf\u4e86 bool \u4fee\u9970\u7b26\uff0c\u5219\u7ed3\u679c\u5206\u522b\u4e3a 1 \u548c 0\u3002</li> <li> <p>\u5411\u91cf\u4e0e\u5411\u91cf\u4e4b\u95f4\uff0c\u8fd0\u7b97\u8fc7\u7a0b\u7c7b\u4f3c\u4e8e\u7b97\u672f\u7c7b\u64cd\u4f5c\u7b26\uff0c\u53ea\u4e0d\u8fc7\b\u5982\u679c\u6bd4\u8f83\u7ed3\u679c\b\u4e3a\u771f\u5219\u4fdd\u7559\u5de6\u8fb9\u7684\u503c\uff08\u5305\u62ec\u5ea6\u91cf\u6307\u6807\u548c\u6807\u7b7e\u8fd9\u4e9b\u5c5e\u6027\uff09\uff0c\u5426\u5219\u4e22\u5f03\uff0c\b\u6ca1\u627e\u5230\u5339\u914d\u4e5f\u662f\u4e22\u5f03\u3002\u5982\u679c\u540e\u9762\u8ddf\u4e86 bool \u4fee\u9970\u7b26\uff0c\u5219\u4fdd\u7559\u548c\u4e22\u5f03\u65f6\u7ed3\u679c\u76f8\u5e94\u4e3a 1 \u548c 0\u3002</p> </li> <li> <p>\u903b\u8f91\u7c7b\u4e8c\u5143\u64cd\u4f5c\u7b26</p> </li> </ul> <p>\u903b\u8f91\u64cd\u4f5c\u7b26\u4ec5\u7528\u4e8e\b\u5411\u91cf\u4e0e\u5411\u91cf\u4e4b\u95f4\u3002</p> <ul> <li>and\uff1a\u4ea4\u96c6</li> <li>or\uff1a\u5408\u96c6</li> <li>unless\uff1a\u8865\u96c6</li> </ul> <p>\u5177\u4f53\u8fd0\u7b97\u89c4\u5219\u5982\u4e0b\uff1a</p> <ul> <li><code>vector1 and vector2</code> \u7684\u7ed3\u679c\u7531\u5728 vector2 \u91cc\u6709\u5339\u914d\uff08\u6807\u7b7e\u952e\u503c\u5bf9\u7ec4\u5408\u76f8\u540c\uff09\u5143\u7d20\u7684 vector1 \u91cc\u7684\u5143\u7d20\u7ec4\u6210\u3002</li> <li><code>vector1 or vector2</code> \u7684\u7ed3\u679c\u7531\u6240\u6709 vector1 \u91cc\u7684\u5143\u7d20\u52a0\u4e0a\u5728 vector1 \u91cc\u6ca1\u6709\u5339\u914d\uff08\u6807\u7b7e\u952e\u503c\u5bf9\u7ec4\u5408\u76f8\u540c\uff09\u5143\u7d20\u7684 \bvector2 \u91cc\u7684\u5143\u7d20\u7ec4\u6210\u3002</li> <li> <p><code>vector1 unless vector2</code> \u7684\b\u7ed3\u679c\u7531\u5728 vector2 \u91cc\u6ca1\u6709\u5339\u914d\uff08\u6807\u7b7e\u952e\u503c\u5bf9\u7ec4\u5408\u76f8\u540c\uff09\u5143\u7d20\u7684 vector1 \u91cc\u7684\u5143\u7d20\u7ec4\u6210\u3002</p> </li> <li> <p>\u4e8c\u5143\u64cd\u4f5c\u7b26\u4f18\u5148\u7ea7</p> </li> </ul> <p>PromQL \u7684\u5404\u7c7b\u4e8c\u5143\u64cd\u4f5c\u7b26\u8fd0\u7b97\u4f18\u5148\u7ea7\u5982\u4e0b\uff1a</p> <ol> <li>^</li> <li>*, /, %</li> <li>+, -</li> <li>==, !=, &lt;=, &lt;, &gt;=, &gt;</li> <li>and, unless</li> <li>or</li> </ol>"},{"location":"cloud-native/other/Prometheus/#522","title":"5.2.2 \u5411\u91cf\u5339\u914d","text":"<p>\u524d\u9762\u7b97\u672f\u7c7b\u548c\u6bd4\u8f83\u7c7b\u64cd\u4f5c\u7b26\u90fd\u9700\u8981\u5728\u5411\u91cf\u4e4b\u95f4\u8fdb\u884c\u5339\u914d\u3002\b\u5171\u6709\u4e24\u79cd\u5339\u914d\u7c7b\u578b\uff0c<code>one-to-one</code> \u548c <code>many-to-one</code> / <code>one-to-many</code>\u3002</p> <ul> <li>One-to-one \u5411\u91cf\u5339\u914d</li> </ul> <p>\u76f8\u540c\u5219\u4e3a\u5339\u914d\uff0c\u5e76\u4e14\b\u53ea\u4f1a\u6709\u4e00\u4e2a\u5339\u914d\b\u5143\u7d20\u3002\u53ef\u4ee5\u4f7f\u7528 <code>ignoring</code> \u5173\u952e\u8bcd\u6765\u5ffd\u7565\u4e0d\u53c2\u4e0e\u5339\u914d\u7684\u6807\u7b7e\uff0c\u6216\u8005\u4f7f\u7528 <code>on</code>\u5173\u952e\u8bcd\u6765\u6307\u5b9a\u8981\u53c2\u4e0e\u5339\u914d\u7684\u6807\u7b7e\u3002\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) &lt;vector expr&gt;\n&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) &lt;vector expr&gt;\n</code></pre> <p>\u6bd4\u5982\u5bf9\u4e8e\u4e0b\u9762\u7684\u8f93\u5165\uff1a</p> <pre><code>method_code:http_errors:rate5m{method=\"get\", code=\"500\"}  24\nmethod_code:http_errors:rate5m{method=\"get\", code=\"404\"}  30\nmethod_code:http_errors:rate5m{method=\"put\", code=\"501\"}  3\nmethod_code:http_errors:rate5m{method=\"post\", code=\"500\"} 6\nmethod_code:http_errors:rate5m{method=\"post\", code=\"404\"} 21\n\nmethod:http_requests:rate5m{method=\"get\"}  600\nmethod:http_requests:rate5m{method=\"del\"}  34\nmethod:http_requests:rate5m{method=\"post\"} 120\n</code></pre> <p>\u6267\u884c\u4e0b\u9762\u7684\u67e5\u8be2\uff1a</p> <pre><code>method_code:http_errors:rate5m{code=\"500\"} / ignoring(code) method:http_requests:rate5m\n</code></pre> <p>\u5f97\u5230\u7684\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>{method=\"get\"}  0.04            //  24 / 600\n{method=\"post\"} 0.05            //   6 / 120\n</code></pre> <p>\u4e5f\u5c31\u662f\u6bcf\u4e00\u79cd method \u91cc code \u4e3a 500 \u7684\u8bf7\u6c42\u6570\u5360\u603b\u6570\u7684\u767e\u5206\u6bd4\u3002\u7531\u4e8e method \u4e3a put \u548c del \u7684\u6ca1\u6709\u5339\u914d\u5143\u7d20\u6240\u4ee5\u6ca1\u6709\u51fa\u73b0\u5728\u7ed3\u679c\u91cc\u3002</p> <ul> <li>Many-to-\bone / one-to-many \u5411\u91cf\u5339\u914d</li> </ul> <p>\u8fd9\u79cd\u5339\u914d\u6a21\u5f0f\u4e0b\uff0c\u67d0\u4e00\u8fb9\u4f1a\u6709\u591a\u4e2a\u5143\u7d20\u8ddf\u53e6\u4e00\u8fb9\u7684\u5143\u7d20\u5339\u914d\u3002\u8fd9\u65f6\u5c31\u9700\u8981\u4f7f\u7528 <code>group_left</code> \u6216 <code>group_right</code> \u7ec4\u4fee\u9970\u7b26\u6765\u6307\u660e\u54ea\u8fb9\u5339\u914d\u5143\u7d20\u8f83\u591a\uff0c\u5de6\u8fb9\u591a\u5219\u7528 group_left\uff0c\u53f3\u8fb9\u591a\u5219\u7528 group_right\u3002\u5176\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;\n&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;\n&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;\n&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;\n</code></pre> <p>\u7ec4\u4fee\u9970\u7b26\u53ea\u9002\u7528\u4e8e\u7b97\u672f\u7c7b\u548c\u6bd4\u8f83\u7c7b\u64cd\u4f5c\u7b26\u3002</p> <p>\u5bf9\u4e8e\u524d\u9762\u7684\u8f93\u5165\uff0c\u6267\u884c\u4e0b\u9762\u7684\u67e5\u8be2\uff1a</p> <pre><code>method_code:http_errors:rate5m / ignoring(code) group_left method:http_requests:rate5m\n</code></pre> <p>\u5c06\u5f97\u5230\u4e0b\u9762\u7684\u7ed3\u679c\uff1a</p> <pre><code>{method=\"get\", code=\"500\"}  0.04            //  24 / 600\n{method=\"get\", code=\"404\"}  0.05            //  30 / 600\n{method=\"post\", code=\"500\"} 0.05            //   6 / 120\n{method=\"post\", code=\"404\"} 0.175           //  21 / 120\n</code></pre> <p>\u4e5f\u5c31\u662f\u6bcf\u79cd method \u7684\u6bcf\u79cd code \b\u9519\u8bef\u6b21\u6570\u5360\u6bcf\u79cd method \u8bf7\u6c42\u6570\u7684\u6bd4\u4f8b\u3002\u8fd9\u91cc\u5339\u914d\u7684\u65f6\u5019 ignoring \u4e86 code\uff0c\u624d\u4f7f\u5f97\u4e24\u8fb9\u53ef\u4ee5\u5f62\u6210 Many-to-\bone \u5f62\u5f0f\u7684\u5339\u914d\u3002\b\u7531\u4e8e\u5de6\u8fb9\u591a\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528 group_left \u6765\u6307\u660e\u3002</p> <p>Many-to-\bone / one-to-many \u8fc7\u4e8e\u9ad8\u7ea7\u548c\u590d\u6742\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u4f7f\u7528\u3002\u5f88\u591a\u65f6\u5019\u901a\u8fc7 ignoring \u5c31\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\u3002</p>"},{"location":"cloud-native/other/Prometheus/#523","title":"5.2.3 \u805a\u5408\u64cd\u4f5c\u7b26","text":"<p>PromQL \u7684\u805a\u5408\u64cd\u4f5c\u7b26\u7528\u6765\u5c06\u5411\u91cf\u91cc\u7684\u5143\u7d20\u805a\u5408\u5f97\b\u66f4\u5c11\u3002\u603b\u5171\u6709\u4e0b\u9762\u8fd9\u4e9b\u805a\u5408\u64cd\u4f5c\u7b26\uff1a</p> <ul> <li>sum\uff1a\u6c42\u548c</li> <li>min\uff1a\u6700\u5c0f\u503c</li> <li>max\uff1a\u6700\u5927\u503c</li> <li>avg\uff1a\u5e73\u5747\u503c</li> <li>stddev\uff1a\u6807\u51c6\u5dee</li> <li>stdvar\uff1a\u65b9\u5dee</li> <li>count\uff1a\b\u5143\u7d20\u4e2a\u6570</li> <li>count_values\uff1a\u7b49\u4e8e\u67d0\u503c\u7684\u5143\u7d20\u4e2a\u6570</li> <li>bottomk\uff1a\u6700\u5c0f\u7684 k \u4e2a\u5143\u7d20</li> <li>topk\uff1a\u6700\u5927\u7684 k \u4e2a\u5143\u7d20</li> <li>quantile\uff1a\u5206\u4f4d\u6570</li> </ul> <p>\u805a\u5408\u64cd\u4f5c\u7b26\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>&lt;aggr-op&gt;([parameter,] &lt;vector expression&gt;) [without|by (&lt;label list&gt;)]\n</code></pre> <p>\u5176\u4e2d <code>without</code> \u7528\u6765\u6307\u5b9a\u4e0d\u9700\u8981\u4fdd\u7559\u7684\u6807\u7b7e\uff08\u4e5f\u5c31\u662f\u8fd9\u4e9b\u6807\u7b7e\u7684\u591a\u4e2a\u503c\u4f1a\u88ab\u805a\u5408\uff09\uff0c\u800c <code>by</code> \u6b63\u597d\u76f8\u53cd\uff0c\u7528\u6765\u6307\u5b9a\u9700\u8981\u4fdd\u7559\u7684\u6807\u7b7e\uff08\u4e5f\u5c31\u662f\u6309\u8fd9\u4e9b\u6807\u7b7e\u6765\u805a\u5408\uff09\u3002</p> <p>\u4e0b\u9762\u6765\u770b\u51e0\u4e2a\u793a\u4f8b\uff1a</p> <pre><code>sum(http_requests_total) without (instance)\n</code></pre> <p>http_requests_total \u5ea6\u91cf\u6307\u6807\u5e26\u6709 application\u3001instance\b \u548c group \u4e09\u4e2a\u6807\u7b7e\u3002\u4e0a\u9762\u7684\u8868\u8fbe\u5f0f\u4f1a\u5f97\u5230\u6bcf\u4e2a application \u7684\b\u6bcf\u4e2a group \u5728\u6240\u6709 instance \u4e0a\u7684\u8bf7\u6c42\u603b\u6570\u3002\b\u6548\u679c\u7b49\u540c\u4e8e\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>sum(http_requests_total) by (application, group)\n</code></pre> <p>\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5f97\u5230\u6240\u6709 application \u7684\u6240\u6709 group \u7684\u6240\u6709 instance \u7684\u8bf7\u6c42\u603b\u6570\u3002</p> <pre><code>sum(http_requests_total)\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#53","title":"5.3 \u51fd\u6570","text":"<p>Prometheus \u5185\u7f6e\u4e86\u4e00\u4e9b\u51fd\u6570\u6765\u8f85\u52a9\u8ba1\u7b97\uff0c\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e9b\u5178\u578b\u7684\uff0c\u5b8c\u6574\u7684\u5217\u8868\u8bf7\u53c2\u8003 \u5b98\u65b9\u6587\u6863\u3002</p> <ul> <li>abs()\uff1a\u7edd\u5bf9\u503c</li> <li>sqrt()\uff1a\u5e73\u65b9\u6839</li> <li>exp()\uff1a\u6307\u6570\u8ba1\u7b97</li> <li>ln()\uff1a\u81ea\u7136\u5bf9\u6570</li> <li>ceil()\uff1a\u5411\u4e0a\u53d6\u6574</li> <li>floor()\uff1a\u5411\u4e0b\b\u53d6\u6574</li> <li>round()\uff1a\u56db\u820d\u4e94\u5165\u53d6\u6574</li> <li>delta()\uff1a\u8ba1\u7b97\u533a\u95f4\u5411\u91cf\u91cc\u6bcf\u4e00\u4e2a\u65f6\u5e8f\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u7684\u5dee\u503c</li> <li>sort()\uff1a\u6392\u5e8f</li> </ul>"},{"location":"cloud-native/other/Prometheus/#_5","title":"\u516d \u914d\u7f6e\u544a\u8b66\u89c4\u5219","text":"<p>\u5c06\u62a5\u8b66\u96c6\u6210\u5230\u777f\u8c61\u4e91</p>"},{"location":"cloud-native/other/Prometheus/#61-prometheusaltermanager","title":"6.1 prometheus\u96c6\u6210altermanager","text":"<pre><code># \u7f16\u8f91prometheus.yml\n\nalerting:\n  alertmanagers:\n  - static_configs:\n    - targets:\n       - 'localhost:9093'\n\nrule_files:\n  - \"onealter.yml\"\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#62-rule_files","title":"6.2 \u7f16\u5199rule_files\u89c4\u5219\u6587\u4ef6","text":"<pre><code># \u7f16\u5199onealter.yml\ngroups:\n  - name: test-rule\n    rules:\n      - alert: \u8282\u70b9\u5185\u5b58\u4f7f\u7528\u91cf\n        expr: (node_memory_MemTotal_bytes - (node_memory_MemFree_bytes+node_memory_Buffers_bytes+node_memory_Cached_bytes )) / node_memory_MemTotal_bytes * 100 &gt; 40\n        for: 1m\n        labels:\n          user: prometheus\n        annotations:\n          summary: \"{{$labels.instance}}:\u5185\u5b58\u8d85\u8fc740%\"\n          description: \"{{$labels.instance}}:\u5185\u5b58\u8d85\u8fc740%\"\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#63-altermanagerymlwebhook","title":"6.3 \u7f16\u8f91altermanager.yml\u914d\u7f6ewebhook\u56de\u8c03","text":"<pre><code># \u7f16\u8f91\n\nglobal:\n  resolve_timeout: 5m\n\nroute:\n  group_by: ['alertname']\n  group_wait: 10s\n  group_interval: 10s\n  repeat_interval: 1h\n  receiver: 'team-X-pager'\nreceivers:\n- name: 'team-X-pager'\n  webhook_configs:\n  - url: 'http://api.aiops.com/alert/api/event/prometheus/f307ded7-9a96-4e34-101d-dfc421a8743a'\n    send_resolved: true\ninhibit_rules:\n  - source_match:\n      severity: 'critical'\n    target_match:\n      severity: 'warning'\n    equal: ['alertname', 'dev', 'instance']\n</code></pre>"},{"location":"cloud-native/other/Prometheus/#64-alter","title":"6.4 \u67e5\u770balter\u544a\u8b66","text":""},{"location":"cloud-native/other/Prometheus/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>\u5b98\u7f51</li> <li>Alermanager</li> <li>\u7b2c\u4e09\u65b9\u63d2\u4ef6</li> <li>routing tree edit</li> <li>grafana dashboard</li> </ul>"},{"location":"cloud-native/other/helm-doc/","title":"Helm doc","text":""},{"location":"cloud-native/other/helm-doc/#helm-doc","title":"helm-doc","text":""},{"location":"cloud-native/other/helm-doc/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://cloud.tencent.com/developer/inventory/9885/article/1766912</li> </ul>"},{"location":"cloud-native/other/helmfile/","title":"helmfile","text":""},{"location":"cloud-native/other/helmfile/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://cloud.tencent.com/developer/article/1766822</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/","title":"Inside Kubernetes controller","text":""},{"location":"cloud-native/other/inside-kubernetes%20controller/#_1","title":"\u524d\u8a00","text":"<p>\u4e00\u6587\u8be6\u89e3Kubernetes controller</p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#_2","title":"\u4e00 \u9ad8\u5c42\u67b6\u6784","text":""},{"location":"cloud-native/other/inside-kubernetes%20controller/#11-k8s","title":"1.1 K8s\u67b6\u6784","text":"<ul> <li> <p>Api-server\uff1aapi-server \u8d1f\u8d23\u63a5\u6536\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u5bf9\u8d44\u6e90\u5bf9\u8c61\u7684CRUD\u8bf7\u6c42\uff0c\u5e76\u53bb\u6267\u884c\u3002</p> </li> <li> <p>controller-manager\uff1a</p> </li> <li>\u63a7\u5236\u7ba1\u7406\u8d44\u6e90\uff08deployment\uff0cservice\uff0creplicaset\uff0cdaemonset\uff0cjob\uff0ccronjob\uff0cendpoint\uff0cstatefulset\uff09</li> <li>\u662f\u63a7\u5236\u5668\u7684\u96c6\u5408\u7ec4\uff0c\u6253\u5305\u5230\u540c\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u3002</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#12-controller","title":"1.2 Controller \u76f8\u5173","text":""},{"location":"cloud-native/other/inside-kubernetes%20controller/#121","title":"1.2.1 \u63a7\u5236\u5faa\u73af","text":"<p>A. \u63a7\u5236\u5faa\u73af\u6982\u5ff5\uff1a\u4e5f\u79f0\u4e3a\u8c03\u8c10\uff0c\u901a\u8fc7\u8d44\u6e90\u7684\u671f\u671b\u72b6\u6001\u548c\u771f\u5b9e\u72b6\u6001\u901a\u8fc7\u4e00\u4e9b\u4e86\u7684\u89c2\u6d4b\u3001\u5206\u6790\u3001\u6267\u884c\u5bf9\u5e94\u52a8\u4f5c\uff0c\u4f7f\u5f97\u771f\u5b9e\u72b6\u6001\u5f80\u671f\u671b\u72b6\u6001\u903c\u8fd1\u3002</p> <p>B. \u63a7\u5236\u5faa\u73af\u6d41\u7a0b\uff1a</p> <ul> <li>\u83b7\u53d6\u5f53\u524d\u8d44\u6e90\u7684\u771f\u5b9e\u72b6\u6001\u3002</li> <li>\u6539\u53d8\u8d44\u6e90\u72b6\u6001\u5230\u671f\u671b\u72b6\u6001\u3002</li> <li>\u66f4\u65b0\u8d44\u6e90\u72b6\u6001\u3002</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#122-replicaset-control","title":"1.2.2 ReplicaSet Control \u5faa\u73af\u793a\u4f8b","text":"<p>\u5982\u56fereplicaset \u63a7\u5236\u5668\u67e5\u770b\u671f\u671b\u4e3a3\u4e2a\u526f\u672c\uff0c\u76ee\u524d2\u4e2a\uff0c\u6240\u4ee5\u6267\u884c\u52a8\u4f5c\u589e\u52a0\u4e00\u4e2a\u526f\u672c\u3002</p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#1221-pod","title":"1.2.2.1 POD \u521b\u5efa","text":"<ol> <li>\u7528\u6237\u901a\u8fc7kubect\u5e94\u7528\u4e86\u4e00\u4e2areplicaset \u8d44\u6e90\u6e05\u5355\uff0capi-server\u5c06\u5176\u5b58\u50a8\u5230etcd\u4e2d\uff0creplicaset \u8d44\u6e90\u521b\u5efa\u3002</li> </ol> <ol> <li>Replicates \u63a7\u5236\u5668\u68c0\u6d4b\u5230replicaset\u8d44\u6e90\u521b\u5efa\uff0c\u6ca1\u6709spec.nodeName \u7684\u7a7apod\u5f00\u59cb\u521b\u5efa\uff0ckubelet\u68c0\u6d4b\u5230pod\u4f46\u662f\u76ee\u524d\u8fd8\u4e0d\u77e5\u9053\u8be5pod\u88ab\u8c03\u5ea6\u5230\u90a3\u4e2anode\u4e0a\u9762\u6267\u884c\u3002\u901a\u8fc7schedule\u5f00\u59cb\u8c03\u5ea6\u3002</li> </ol> <ol> <li>\u8c03\u5ea6\u5668\u68c0\u6d4b\u5230pod\u88ab\u521b\u5efa\uff0c\u7531\u4e8epod.spec.nodeName\u4e3a\u7a7a\uff0c\u8c03\u5ea6\u5668\u5c06\u5176\u6dfb\u52a0\u5230\u8c03\u5ea6\u961f\u5217\u4e2d\uff0c\u540e\u671f\u8fdb\u884c\u8c03\u5ea6\u7b97\u6cd5\u8fdb\u884c\u8c03\u5ea6\u3002</li> </ol> <ol> <li>kubelet\u68c0\u6d4b\u5230pod\u521b\u5efa\u4e8b\u4ef6\uff0c\u7531\u4e8epod.specc.nodeName\u4e3a\u7a7a\uff0c\u5148\u8df3\u8fc7\u5904\u7406\u3002</li> </ol> <ol> <li>\u8c03\u5ea6\u5668\u4ece\u8c03\u5ea6\u961f\u5217\u4e2d\u5f39\u51fapod\uff0c\u5f00\u59cb\u4e3apod\u5206\u914dnode\u8282\u70b9\uff0c\u4e4b\u524d\u66f4\u65b0pod\u7684pod.Spec.nodeName\u5b57\u6bb5</li> </ol> <ol> <li>Kubelet \u68c0\u6d4b\u5230pod\u66f4\u65b0\uff0c\u9009\u62e9\u5230podName \u7684node\u8282\u70b9\uff0c\u5f00\u59cb\u542f\u52a8\u5bb9\u5668\u3002</li> </ol> <ol> <li>kubelet \u53d1\u9001\u8bf7\u6c42\u7ed9api-server, api-server \u66f4\u65b0pod\u7684\u5b57\u6bb5 pod.status\u5230etcd\u4e2d\u3002</li> </ol>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#1222-pod","title":"1.2.2.2 POD \u9500\u6bc1","text":"<p>\u73b0\u5728\u7531\u4e8e\u67d0\u79cd\u60c5\u51b5POD\u5f00\u59cb\u9500\u6bc1\u3002</p> <p></p> <ol> <li>kubelet \u53d1\u9001\u8bf7\u6c42\u5230api-server \u4e0a\uff0capi-server \u66f4\u65b0etcd\u4e2dpod.Status \u5b57\u6bb5\u3002</li> </ol> <p></p> <ol> <li>ReplicaSet Controller \u68c0\u6d4b\u5230Pod\u66f4\u65b0\uff0c\u5f00\u59cb\u6267\u884cPod\u5220\u9664\u3002</li> </ol> <p></p> <ol> <li>replicaset controller \u8c03\u8c10Pod\u5230\u671f\u671b\u72b6\u6001\uff0c\u5f00\u59cb\u5faa\u73af2-10\u6b65\u9aa4\u3002</li> </ol> <p>api-server\u8d1f\u8d23\u8d44\u6e90crud\uff0cschedule\u8d1f\u8d23\u8d44\u6e90\u8c03\u5ea6\uff0ckubelet\u8d1f\u8d23\u5bb9\u5668\u521b\u5efa\uff0ccontroller\u8d1f\u8d23\u8c03\u8c10\u8d44\u6e90\uff0c\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u4e13\u6ce8\u4e8e\u81ea\u5df1\u7684\u804c\u8d23\uff0c\u7ec4\u6210\u4e00\u4e2a\u6709\u673a\u7684\u7edf\u4e00\u4f53\u3002</p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#13","title":"1.3 \u4e8b\u4ef6","text":"<p>\u4ec0\u4e48\u65f6\u5019\u63a7\u5236\u5668\u5f00\u59cb\u6267\u884c\u63a7\u5236\u5faa\u73af\u5462\uff0cEvent\u662f\u975e\u5e38\u5173\u952e\u7684\u56e0\u7d20\uff0c\u4f8b\u5982\uff1aAdded\u3001Modifie\u3001Deleted\uff0cError...</p> <p>\u5bf9\u4e8eKubeernetes\uff0c\u8fd9\u79cd\u6709\u5206\u5e03\u5f0f\u7ec4\u4ef6\u7ec4\u6210\u7684\u7cfb\u7edf\uff0cEvent\u662f\u975e\u5e38\u7684\u91cd\u8981\uff0c\u901a\u8fc7\u4ed6\u53bb\u8054\u7cfb\u5176\u4ed6\u7684\u7ec4\u4ef6\u3002</p> <p>\u4e8b\u4ef6\u89e6\u53d1\u5728k8s\u4e2d\u88ab\u5206\u4e3a\u4e24\u7c7b\uff0c\u4e00\u4e2a\u662fEdge-driven Triggers(\u8fb9\u7f18\u89e6\u53d1)\uff0cLevel-driven Triggers(\u6c34\u5e73\u89e6\u53d1)\u3002</p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#131","title":"1.3.1 \u8fb9\u7f18\u89e6\u53d1","text":"<p>\u8fb9\u7f18\u89e6\u53d1\u5c31\u662f\u5f53\u8d44\u6e90\u526f\u672c\u6570\u91cf\u7684\u589e\u52a0\u6216\u7f29\u51cf\u3002</p> <p>\u4f46\u662f\u4ec5\u4ec5\u6709\u8fb9\u7f18\u89e6\u53d1\u4f1a\u5b58\u5728\u4e00\u5b9a\u95ee\u9898\uff0c\u5047\u8bbe\u7531\u4e8e\u7f51\u7edc\u539f\u56e0\u6216\u7a0b\u5e8fbug\uff0c\u8fb9\u7f18\u4e8b\u4ef6\u53d1\u751f\u4e22\u5931\uff0c\u90a3\u4e48\u8c03\u8c10\u5c31\u6ca1\u6709\u53d1\u751f\uff0c\u8d44\u6e90\u526f\u672c\u6570\u91cf\u4e5f\u5c31\u672a\u53d1\u751f\u53d8\u5316\u3002</p> <p></p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#132","title":"1.3.2 \u6c34\u5e73\u89e6\u53d1","text":"<p>\u5782\u76f4\u89e6\u53d1\u4f1a\u9047\u5230\u8fd9\u79cd\u4e22\u5931\u7684\u95ee\u9898\uff0c\u63a7\u5236\u5668\u5728\u6bcf\u6b21\u91cd\u65b0\u540c\u6b65\u95f4\u9694\u65f6\u8fdb\u884c\u534f\u8c03\uff0c\u8fd9\u6837\u63a7\u5236\u5668\u53ef\u4ee5\u4f7f\u72b6\u6001\u66f4\u63a5\u8fd1\u671f\u671b\u72b6\u6001\u3002</p> <p></p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#14","title":"1.4 \u63a7\u5236\u5668\u7684\u7ec4\u4ef6","text":""},{"location":"cloud-native/other/inside-kubernetes%20controller/#141","title":"1.4.1 \u672f\u8bed\u8868","text":"<ul> <li>Kind\uff1aAPI \u5bf9\u8c61\u7684\u79cd\u7c7b\uff0c\u4f8b\u5982deployment\uff0cservice\u3002</li> <li>Resource\uff1akind\u4e2d\u8d44\u6e90\u7684\u5b9e\u4f53\uff0c\u88ab\u4f5c\u4e3ahttp endpoint\uff0c\u4ee5\u5c0f\u5199\u6216\u590d\u6570\u5f62\u5f0f\u8868\u793a\u3002</li> <li>Object\uff1aAPI \u5bf9\u8c61\u7684\u5b9e\u4f53\uff0c\u88ab\u6301\u4e45\u5316\u5b58\u50a8\u5728etcd\u4e2d\u3002</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#142","title":"1.4.2 \u63a7\u5236\u5668\u7684\u5e93","text":"<ul> <li>Client-go\uff1a</li> <li>informer</li> <li>lister</li> <li>workQueue</li> <li>api-machinery\uff1a</li> <li>runtime.Object</li> <li>scheme</li> <li>Code-generator</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#143-sdk","title":"1.4.3 \u81ea\u5b9a\u4e49\u63a7\u5236\u5668SDK","text":"<ul> <li>\u6846\u67b6\uff1akubebuilder\u3001Operator SDK</li> <li>\u9ad8\u7ea7\u5e93\uff1acontroller-runtime\u3001controller-tools</li> <li>\u4f4e\u7ea7\u5e93\uff1aclient-go\u3001api-machinery</li> <li>\u7ec4\u4ef6\uff1ainformer\u3001lister\u3001workqueue\u3001scheme\u3001runtime.Object</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#144","title":"1.4.4 \u63a7\u5236\u5668\u7684\u5e93","text":"<ul> <li>Client-go\uff1a</li> <li>kubernetes \u5b98\u65b9client\u5e93\u3002</li> <li>\u8fd9\u4e2a\u662fkubernetes\u5f00\u53d1\u5de5\u5177\u3002</li> <li>Api-machinery\uff1a</li> <li>kubernetes API \u5bf9\u8c61 &amp; kubernetes API \u5bf9\u8c61\u5e93</li> <li>\u63a7\u5236\u5668\u7ba1\u7406API \u5bf9\u8c61\u4f7f\u7528\u3002</li> <li>Code-generator\uff1a</li> <li>informer\uff0clister\uff0cclientset\uff0cdeepcopy \u6e90\u7801\u751f\u6210\uff0c\u4f7f\u7528\u8fd9\u4e2a\u8fdb\u884c\u63a7\u5236\u5668\u5f00\u53d1\u3002</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#145","title":"1.4.5 \u63a7\u5236\u5668\u4e0b\u7684\u7ec4\u4ef6","text":"<ul> <li>Informer\uff1awatch \u5bf9\u8c61\u4e8b\u4ef6\u548c\u8d85\u96be\u5403\u6570\u636e\u5728\u5185\u5b58\u7f13\u5b58\u4e2d\u3002</li> <li>Lister\uff1a\u5438\u6536\u5bf9\u8c61\u6570\u636e\u5728\u5185\u5b58\u7f13\u5b58\u4e2d\u3002</li> <li>WorkQueue\uff1a\u961f\u5217\u5b58\u50a8\u63a7\u5236\u5faa\u73afitem\u3002</li> <li>runtime.Object\uff1aAPI \u5bf9\u8c61\u63a5\u53e3\u3002</li> <li>Scheme\uff1a\u8054\u7cfbgo type \u548ckubernetes API\u3002</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#-client-go","title":"\u4e8c \u4f4e\u5c42\u67b6\u6784-client-go","text":""},{"location":"cloud-native/other/inside-kubernetes%20controller/#21-informer","title":"2.1 Informer","text":"<p>Informer watches \u5bf9\u8c61\u4e8b\u4ef6\uff08added\uff0cupdated\uff0cdeleted\uff09</p> <p>\u5f53\u63a7\u5236\u5668\u6bcf\u6b21\u5411api\u670d\u52a1\u5668\u67e5\u8be2\u5bf9\u8c61\u72b6\u6001\u65f6\uff0c\u76d1\u89c6\u5bf9\u8c61\u66f4\u6539\uff0capi\u670d\u52a1\u5668\u9ad8\u8d1f\u8f7d\u3002</p> <p>informer watch api\uff0c\u901a\u8fc7controller\u8bbe\u7f6e\u5173\u8054cache\u3002</p> <pre><code>func main() {\n ...\n clientset, err := kubernetes.NewForConfig(config)\n // Create InformerFactory\n informerFactory := informers.NewSharedInformerFactory(clientset, time.Second*30)\n // Create pod informer by informerFactory\n podInformer := informerFactory.Core().V1().Pods()\n // Add EventHandler to informer\n podInformer.Informer().AddEventHandler(cache.ResourceEventHandlerFuncs{\n AddFunc: func(new interface{}) { log.Println(\"Added\") },\n UpdateFunc: func(old, new interface{}) { log.Println(\"Updated\") },\n DeleteFunc: func(old interface{}) { log.Println(\"Deleted\") },\n })\n // Start Go routines\n informerFactory.Start(wait.NeverStop)\n // Wait until finish caching with List API\n informerFactory.WaitForCacheSync(wait.NeverStop)\n // Create Pod Lister\n podLister := podInformer.Lister()\n // Get List of pods\n _, err = podLister.List(labels.Nothing())\n \u2026\n}\n</code></pre>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#211-shared-informer","title":"2.1.1 Shared Informer","text":"<p>\u5f53\u6211\u4eec\u4f7f\u7528Informer\uff0c\u6211\u4eec\u4e0d\u76f4\u63a5\u4f7f\u7528informer\u81ea\u5df1\uff0c\u800c\u662f\u4f7f\u7528\u5171\u4eabinformer\u3002</p> <p>\u5171\u4eabinformer \u5171\u4eab\u76f8\u540c\u7684\u8d44\u6e90\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#212-informer-workqueue","title":"2.1.2 Informer \u548cworkqueue","text":"<ol> <li>Reflector list &amp; watch api-server</li> <li>Reflector\u5c06\u5bf9\u8c61\u6dfb\u52a0\u5230Delta FIFO \u961f\u5217\u4e2d</li> <li>informer \u4eceDelta FIFO\u4e2d\u5f39\u51fa\u5bf9\u8c61</li> <li>\u5c06\u5bf9\u8c61\u6dfb\u52a0\u5230Indexer</li> <li>Indexer \u5b58\u50a8\u5bf9\u8c61\u5230\u5b89\u5168\u7ebf\u7a0b\u5b58\u50a8\u4e2d</li> <li>informer \u8bbe\u7f6e\u4e8b\u4ef6reference</li> <li>\u7528\u6237\u81ea\u5b9a\u4e49\u7684Controller\uff0c\u4e8b\u4ef6Handlers \u5c06\u5bf9\u8c61\u6dfb\u52a0\u81f3workqueue\uff0c</li> <li>\u8fdb\u7a0b\u83b7\u53d6key\uff0cprocess item</li> <li>\u83b7\u53d6\u5bf9\u8c61\u7684key\u4eceindexer reference\u4e2d\u3002</li> </ol>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#213-informer","title":"2.1.3 Informer \u8be6\u89e3","text":"<p>Informer \u6574\u4f53\u67b6\u6784</p> <p></p> <p></p> <ol> <li>reflector \u5f00\u59cblistAndWatch api\u5bf9\u8c61\u4e2d\u7684\u7528\u6237\u521b\u5efa\u7684\u5fc3\u8d44\u6e90pod\u5bf9\u8c61\u3002</li> </ol> <p></p> <ol> <li>informer \u4eceDeltaFIFO \u961f\u5217\u4e2dPop\u521d\u4e8b\u4ef6\u3002</li> </ol> <p></p> <ol> <li>HandleDelta</li> </ol> <p></p> <ol> <li>indexer.Add \u589e\u52a0\u4e8b\u4ef6\u5230\u5185\u5b58\u5b58\u50a8\u4e2d</li> </ol> <p></p> <ol> <li>\u5f00\u59cb\u5faa\u73af\u5f39\u51fa\u4e8b\u4ef6\u5e76\u8fdb\u884c\u5904\u7406</li> </ol> <p></p> <ol> <li>\u540e\u671fget or list \u8bf7\u6c42\u90fd\u4eceindexer\u4e2d\u83b7\u53d6\u3002</li> </ol> <p>Informer \u548c\u5176\u7ec4\u4ef6</p> <ul> <li>Informer\uff1awatch \u4e00\u4e2a\u5bf9\u8c61\u4e8b\u4ef6\u5e76\u4e14\u5b58\u50a8\u5728\u5185\u5b58\u7f13\u5b58\u4e2d</li> <li>Reflector\uff1alistAndWatch api-server</li> <li>DeltaFIFO\uff1aFIFO \u961f\u5217\u5b58\u50a8\u5bf9\u8c61\u4e34\u65f6</li> <li>Indexer\uff1a\u8bbe\u7f6e\u6216\u8005\u83b7\u53d6\u5bf9\u8c61</li> <li>Store\uff1a\u5b58\u50a8\u5bf9\u8c61</li> <li>Lister\uff1a\u83b7\u53d6\u5bf9\u8c61\u5728\u5185\u5b58\u901a\u8fc7index</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#22-workqueue","title":"2.2 WorkQueue","text":"<p>WorkQueue\u4e0d\u540c\u4e8eDeltaFIFO\u961f\u5217\uff0c</p> <p>WorkQueue\u662f\u4f7f\u7528\u5b58\u50a8Contrl Loop \u7684item\u3002</p> <p>\u8c03\u8c10\u5c06\u6267\u884cWorkQWueue\u4e2d\u7684\u5185\u5bb9\u3002</p> <p>\u611f\u89c9\u7684\u63a7\u5236\u5b58\u50a8enqueues item \u5230\u5de5\u4f5c\u961f\u5217\u4e2d\uff0c\u5f53\u4e8b\u4ef6\u53d1\u751f\u65f6\u3002</p> <p></p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#221-workqueue","title":"2.2.1 WorkQueue \u7b80\u5355\u4ee3\u7801","text":"<pre><code>func main() {\n ...\n clientset, err := kubernetes.NewForConfig(config)\n // Create InformerFactory\n informerFactory := informers.NewSharedInformerFactory(clientset, time.Second*30)\n // Create pod informer by informerFactory\n podInformer := informerFactory.Core().V1().Pods()\n // Create RateLimitQueue\n queue := workqueue.NewRateLimitingQueue(workqueue.DefaultControllerRateLimiter())\n // shutdown when process ends\n defer queue.ShutDown()\n // Add EventHandler to informer\n podInformer.Informer().AddEventHandler(cache.ResourceEventHandlerFuncs{\n AddFunc: func(old interface{}) {\nvar key string\nvar err error\nif key, err = cache.MetaNamespaceKeyFunc(old); err != nil {\nruntime.HandleError(err)\nreturn\n}\nqueue.Add(key)\nlog.Println(\"Added: \" + key)\n},\n UpdateFunc: func(old, new interface{}) { \u2026 },\n DeleteFunc: func(old interface{}) { \u2026 },\n })\n \u2026\n}\n</code></pre>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#222-workqueue","title":"2.2.2 WorkQueue \u8be6\u89e3","text":"<p>\u6574\u4f53\u793a\u610f\u56fe</p> <p></p> <p></p> <ol> <li>Reflector watch k8s-api \u5c06\u5176\u4e2d\u8d44\u6e90\u53d1\u9001\u5230DeltaFIFO\u4e2d</li> </ol> <p></p> <ol> <li>Informer EventHandler \u4eceDeltaFIFO\u4e2dpop\u51fa\u6570\u636e\u3002</li> </ol> <p></p> <ol> <li>Informer EventHandler \u8c03\u7528\u8d44\u6e90\u4e8b\u4ef6\u51fd\u6570\uff0c\u4f8b\u5982\uff1aAddFunc\u3001UpdateFunc\u3001DeleteFunc\u6765\u5c06\u4e8b\u4ef6\u5bf9\u8c61\u653e\u8fdbWorkQueue\u4e2d\u3002</li> </ol> <p>\u6ce8\u610f\uff1a\u518d\u6b21\u6dfb\u52a0\u7684key\u4e3a\u8d44\u6e90\u7684\u552f\u4e00\u6807\u793a\uff0c\u540e\u671f\u4f7f\u7528\u7684\u65f6\u5019\u4eceindex\u4e2d\u4e4b\u95f4\u83b7\u53d6\uff0c\u4ece\u800c\u51cf\u8f7bapi-server \u7684\u538b\u529b\u3002</p> <p></p> <ol> <li>workqueue.Add \u8fdb\u5165WorkQueue\u4e2d\uff0c\u4f8b\u5982namespace/name\u3001default/nginx</li> </ol> <p></p> <p></p> <p>\u5faa\u73af3-4\uff0c\u5904\u7406\u4e8b\u4ef6\u653e\u5165\u961f\u5217\u4e2d\u3002</p> <p></p> <ol> <li>\u7528\u6237\u81ea\u5b9a\u4e49\u7684controller \u903b\u8f91\u4eceWorkQueue\u4e2d\u83b7\u53d6\u5bf9\u8c61\u8fdb\u884c\u5904\u7406\u3002</li> </ol>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#223-informer-resync-period","title":"2.2.3 Informer Resync Period","text":"<p>Informer \u91cd\u65b0\u540c\u6b65\u5468\u671f</p> <p>\u91cd\u65b0\u540c\u6b65\u5468\u671f\u5bf9\u4e8eInformer\u662f\u53ef\u9009\u7684\u3002</p> <p>Informer\u76d1\u89c6api\u670d\u52a1\u5668\u4e0a\u7684\u5bf9\u8c61\u4e8b\u4ef6\u3002</p> <p>\u518d\u540c\u6b65\u671f\u8fc7\u540e\uff0c\u65e0\u8bba\u53d1\u751f\u4ec0\u4e48\u4e8b\u4ef6\uff0cUpdateFunc\u88ab\u56de\u8c03\u3002\u7ed3\u679c\uff0c\u8c03\u8c10\u5c06\u518d\u6b21\u6267\u884c\u3002</p> <p></p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#23-controller-cycle-main-logic","title":"2.3 Controller Cycle Main Logic","text":"<p>\u5b8c\u6574\u793a\u610f\u56fe\uff1a</p> <p></p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#231-controller-cycle","title":"2.3.1 Controller Cycle","text":"<ol> <li>\u5047\u8bbe\u7528\u6237\u521b\u5efa\u4e86\u4e24\u4e2apod\uff0c\u751f\u6210\u4e86\u4e24\u4e2aupdate \u4e8b\u4ef6</li> </ol> <ol> <li>informer \u6267\u884cUpdateFunc</li> </ol> <ol> <li>Informer \u8c03\u7528workQueue.Add \u51fd\u6570 \u589e\u52a0\u4e8b\u4ef6\u5230WorkQueue\u4e2d\u3002</li> </ol> <ol> <li>\u7a0b\u5e8f\u5904\u7406\u8c03\u7528workqueue.Get \u83b7\u53d6\u4e8b\u4ef6</li> </ol> <ol> <li>\u8c03\u8c10\u5904\u7406\u5177\u4f53\u66f4\u65b0\u4e1a\u52a1\u903b\u8f91\u3002</li> </ol> <ol> <li>\u5f53\u8c03\u8c10\u6210\u529f\u540e\uff0c\u5904\u7406\u7a0b\u5e8f\u8fdb\u884cworkQueue.Forget/workQueue.Done\uff0c\u8fd9\u4e2aitem\u4eceworkQueue\u4e2d\u79fb\u9664\u3002</li> </ol> <p>\u5f53\u8c03\u8c10\u662f\u9519\u8bef\u7ed3\u675f\u540e\uff0cworkQueue \u589e\u52a0\u901f\u7387\u9650\u5236\uff0c\u5e76\u4e14\u63a7\u5236\u5668\u91cd\u65b0\u5165\u961fitem\uff0c\u5e76\u4e14\u5f00\u59cb\u65b0\u4e00\u8f6e\u8c03\u8c10\u3002</p> <p></p> <p>\u6bcf\u6b21\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u9879\u90fd\u4f1a\u7ee7\u7eed\u5b58\u50a8\u5728\u5de5\u4f5c\u961f\u5217\u4e2d,\u63a7\u5236\u5668\u5904\u7406\u5de5\u4f5c\u961f\u5217\u4e2d\u7684\u9879\u5e76\u6267\u884c\u534f\u8c03\u3002\u8be5\u5faa\u73af\u6301\u7eed\u4e0d\u65ad\uff0c\u76f4\u5230\u63a7\u5236\u5668\u505c\u6b62\u3002</p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#232","title":"2.3.2 \u63a7\u5236\u5668\u57fa\u672c\u7b56\u7565","text":"<p>\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\uff0c\u5199\u5411api-server\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u76f4\u63a5\u66f4\u65b0\u7f13\u5b58\u4e2d\u7684\u5bf9\u8c61\uff0c\u5f88\u96be\u4fdd\u8bc1\u5176\u4e00\u81f4\u6027\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u5728\u66f4\u65b0\u5bf9\u8c61\u65f6\u4f7f\u7528DeepCopy\uff08\u83b7\u53d6\u514b\u9686\u6570\u636e\uff09\u3002</p> <p>\u4f8b\u5982\u4ee3\u7801\uff1akubernetes/pkg/controller/replicaset/replica_set.go</p> <pre><code>rs = rs.DeepCopy()\nnewStatus := calculateStatus(rs, filteredPods, manageReplicasErr)\n// Always updates status as pods come up or die.\nupdatedRS, err := updateReplicaSetStatus(rsc.kubeClient.AppsV1(). \u21e8\nReplicaSets(rs.Namespace), rs, newStatus)\n</code></pre>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#233","title":"2.3.3 \u63a7\u5236\u5668\u4e3b\u903b\u8f91","text":"<ul> <li>worker\uff1a\u65e0\u9650\u5faa\u73af processNextWorkItem\u3002</li> <li>processNet WorkItem\uff1a\u64cd\u4f5cWorkQueue(Get, Add)\u5e76\u4e14\u8c03\u7528\u8c03\u8c10\u903b\u8f91\u3002</li> <li>syncHandler\uff1a\u8fd9\u5c31\u662f\u8c03\u8c10\u5177\u4f53\u903b\u8f91\u3002</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#234-replicaset-controller","title":"2.3.4 ReplicaSet Controller \u6e90\u7801","text":"<p>\u57fa\u4e8eK8s v1.16</p> <ul> <li>worker\uff1ahttps://github.com/kubernetes/kubernetes/blob/release-1.16/pkg/controller/replicaset/replica_set.go#L432</li> <li>processNextWorkItem\uff1ahttps://github.com/kubernetes/kubernetes/blob/release-1.16/pkg/controller/replicaset/replica_set.go#L437</li> <li>syncReplicaSet\uff1ahttps://github.com/kubernetes/kubernetes/blob/release-1.16/pkg/controller/replicaset/replica_set.go#L562</li> </ul>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#_3","title":"\u5176\u4ed6","text":"<p>Informer \u4eceetcd \u540c\u6b65\u5bf9\u8c61\u6570\u636e\u5230\u5185\u5b58\u4e2d\u3002</p> <p>\u518d\u6b21\u9700\u8981\u8003\u8651\u5185\u5b58\u6570\u636e\u662f\u5426\u548cetcd\u6570\u636e\u4e0d\u76f8\u540c\u5462\u3002</p> <p>\u8fd9\u662f\u6ca1\u6709\u95ee\u9898\u7684\uff0c\u5bf9\u8c61\u6709resourceVersion\uff0c\u5982\u679cetcd\u7684resourceVersion \u4e8e\u5185\u5b58\u7f13\u5b58\u4e2d\u7684resourceVersion\u4e0d\u540c\uff0cController\u5728\u66f4\u65b0\u5bf9\u8c61\u72b6\u6001\u65f6\u51fa\u9519\uff0c\u63a7\u5236\u5668\u8bf7\u6c42\u8c03\u8c10\uff0c\u76f4\u5230\u8fc1\u79fb\u5b8c\u6210\u3002</p>"},{"location":"cloud-native/other/inside-kubernetes%20controller/#review","title":"review","text":"<ul> <li>Informer\uff1a\u901a\u8fc7eventandler\u5c06Control Loop\u7684\u9879\u6dfb\u52a0\u5230WorkQueue\u4e2d</li> <li>Lister\uff1a\u901a\u8fc7Indexer\u4ece\u5185\u5b58\u7f13\u5b58\u4e2d\u83b7\u53d6\u5bf9\u8c61\u6570\u636e</li> <li>WorkQueue\uff1a\u5b58\u50a8\u63a7\u5236\u5faa\u73af\u9879\u7684\u961f\u5217\u3002\u8be5\u9879\u662fReconcile Logic\u7684\u76ee\u6807\u3002\u5982\u679c\u5728\u8c03\u89e3\u7ed3\u675f\u65f6\u53d1\u751f\u9519\u8bef\uff0c\u63a7\u5236\u5668\u5c06\u9879\u8bf7\u6c42\u5230\u5de5\u4f5c\u961f\u5217\u3002\u63a7\u5236\u5668\u518d\u6b21\u6267\u884cReconcile\u3002</li> </ul>"},{"location":"cloud-native/other/ks-develop/","title":"ksdevelop","text":""},{"location":"cloud-native/other/ks-develop/#_1","title":"\u4e00 \u62c9\u53d6\u4ee3\u7801","text":"<pre><code>cd /Users/xuel/workspace/goworkspace/src/github.com/redhatxl\ncd kubesphere\ngit clone https://github.com/redhatxl/kubesphere.git \ngit remote add upstream https://github.com/kubesphere/kubesphere.git\n\ngit remote set-url --push upstream no_push\ngit remote -v       \n\norigin  https://github.com/redhatxl/kubesphere.git (fetch)\norigin  https://github.com/redhatxl/kubesphere.git (push)\nupstream        https://github.com/kubesphere/kubesphere.git (fetch)\nupstream        no_push (push)\n</code></pre>"},{"location":"cloud-native/other/ks-develop/#_2","title":"\u4e8c \u6570\u636e\u7ed3\u6784","text":"<pre><code>.\n\u251c\u2500\u2500 CONTRIBUTING.md\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 OWNERS\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 README_zh.md\n\u251c\u2500\u2500 api                     // api \u6587\u6863\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 api-rules\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ks-openapi-spec\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 openapi-spec\n\u251c\u2500\u2500 build                   // \u6784\u5efa\u6210\u5236\u54c1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ks-apiserver\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 ks-controller-manager\n\u251c\u2500\u2500 cmd                     // \u547d\u4ee4\u5165\u53e3\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 controller-manager\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 ks-apiserver\n\u251c\u2500\u2500 config              // \u751f\u6210crds\u7b49\u914d\u7f6e\u6587\u4ef6\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 crds\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 gateway\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ks-core\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 watches.yaml\n\u251c\u2500\u2500 docs                    // \u5e2e\u52a9\u6587\u6863\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 build-multiarch-images.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 images\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 powered-by-kubesphere.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 roadmap.md\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 hack                    // \u5feb\u901f\u751f\u64cd\u4f5c\u7b49\u811a\u672c\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 boilerplate.go.txt\n\u251c\u2500\u2500 install             // \u5e9f\u5f03\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ingress-controller\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 swagger-ui\n\u251c\u2500\u2500 kube\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pkg\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 plugin\n\u251c\u2500\u2500 pkg                     // \u4e3b\u8981\u4e1a\u52a1\u903b\u8f91\u76ee\u5f55\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 api             // k8s api\u76ee\u5f55\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 apis            // crds\u5b9a\u4e49api\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 apiserver\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 client      // used by code-generator, informer/lister/clientset\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 constants\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 controller  // controllers\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 informers\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 kapis           // KubeSphere specific apis, api path starts with /kapis\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 models\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 server\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 simple\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 test\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 tools.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 utils\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 version\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 webhook\n\u251c\u2500\u2500 staging\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 README.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 publishing\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u251c\u2500\u2500 test\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 e2e\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 network\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 testdata\n\u251c\u2500\u2500 tools\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 cmd\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 tools.go\n\u2514\u2500\u2500 vendor\n    \u251c\u2500\u2500 code.cloudfoundry.org\n    \u251c\u2500\u2500 github.com\n    \u251c\u2500\u2500 go.etcd.io\n    \u251c\u2500\u2500 go.mongodb.org\n    \u251c\u2500\u2500 go.starlark.net\n    \u251c\u2500\u2500 go.uber.org\n    \u251c\u2500\u2500 golang.org\n    \u251c\u2500\u2500 gomodules.xyz\n    \u251c\u2500\u2500 google.golang.org\n    \u251c\u2500\u2500 gopkg.in\n    \u251c\u2500\u2500 gotest.tools\n    \u251c\u2500\u2500 helm.sh\n    \u251c\u2500\u2500 honnef.co\n    \u251c\u2500\u2500 istio.io\n    \u251c\u2500\u2500 k8s.io\n    \u251c\u2500\u2500 kubesphere.io\n    \u251c\u2500\u2500 modules.txt\n    \u2514\u2500\u2500 sigs.k8s.io\n</code></pre>"},{"location":"cloud-native/other/ks-develop/#_3","title":"\u4e09 \u672c\u5730\u6784\u5efa","text":"<pre><code>$ make test    // takes a really long time\n$ make all     // build ks-apiserver/ks-controller-manager \n\n$ make ks-apiserver\n$ go build -o bin/cmd/ks-apiserver cmd/ks-apiserver/apiserver.go\n\n\n$ \u83b7\u53d6\u914d\u7f6e\u6587\u4ef6\n$ bin/cmd/ks-apiserver  --kubeconfig ~/.kube/config\n</code></pre>"},{"location":"cloud-native/other/ks-develop/#_4","title":"\u56db \u672c\u5730\u90e8\u7f72\u6700\u5c0f\u5316","text":"<pre><code>kubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.2.1/kubesphere-installer.yaml\n\nkubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.2.1/cluster-configuration.yaml\n</code></pre>"},{"location":"cloud-native/other/ks-develop/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://kubesphere.com.cn/forum/d/2956-kubesphere/3</li> <li>https://github.com/kubesphere/community/blob/master/developer-guide/development/quickstart.md</li> <li>https://github.com/kubesphere/community/tree/master/developer-guide/development</li> </ul>"},{"location":"cloud-native/other/kubectl-graph/","title":"Kubectl-graph","text":""},{"location":"cloud-native/other/kubectl-graph/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/steveteuber/kubectl-graph</li> <li>https://cloud.tencent.com/developer/inventory/9885/article/1767831</li> </ul>"},{"location":"cloud-native/other/vitess/","title":"vitess","text":""},{"location":"cloud-native/other/vitess/#_1","title":"\u4e00 \u6982\u8ff0","text":""},{"location":"cloud-native/other/vitess/#11-vitess","title":"1.1 vitess\u662f\u4ec0\u4e48","text":"<p>Vitess\u662f\u4e00\u4e2a\u7528\u4e8e\u90e8\u7f72\u3001\u6269\u5c55\u548c\u7ba1\u7406\u5927\u578bMySQL\u5b9e\u4f8b\u96c6\u7fa4\u7684\u6570\u636e\u5e93\u89e3\u51b3\u65b9\u6848\u3002Vitess\u96c6Mysql\u6570\u636e\u5e93\u7684\u5f88\u591a\u91cd\u8981\u7279\u6027\u548cNoSQL\u6570\u636e\u5e93\u7684\u53ef\u6269\u5c55\u6027\u4e8e\u4e00\u4f53\u3002\u5b83\u7684\u67b6\u6784\u8bbe\u8ba1\u4f7f\u5f97\u60a8\u53ef\u4ee5\u50cf\u5728\u7269\u7406\u673a\u4e0a\u4e00\u6837\u5728\u516c\u5171\u4e91\u6216\u79c1\u6709\u4e91\u67b6\u6784\u4e2d\u6709\u6548\u8fd0\u884c\u3002\u5b83\u7ed3\u5408\u5e76\u6269\u5c55\u4e86\u8bb8\u591a\u91cd\u8981\u7684MySQL\u529f\u80fd\uff0c\u540c\u65f6\u517c\u5177NoSQL\u6570\u636e\u5e93\u7684\u53ef\u6269\u5c55\u6027\u3002 Vitess\u53ef\u4ee5\u5e2e\u52a9\u60a8\u89e3\u51b3\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <ol> <li>\u652f\u6301\u60a8\u5bf9MySQL\u6570\u636e\u5e93\u8fdb\u884c\u5206\u7247\u6765\u6269\u5c55MySQL\u6570\u636e\u5e93\uff0c\u5e94\u7528\u7a0b\u5e8f\u65e0\u9700\u505a\u592a\u591a\u66f4\u6539\u3002</li> <li>\u4ece\u7269\u7406\u673a\u8fc1\u79fb\u5230\u79c1\u6709\u4e91\u6216\u516c\u5171\u4e91\u3002</li> <li>\u90e8\u7f72\u548c\u7ba1\u7406\u5927\u91cf\u7684MySQL\u5b9e\u4f8b\u3002</li> </ol> <p>Vitess\u5305\u62ec\u4f7f\u7528\u4e0e\u672c\u673a\u67e5\u8be2\u534f\u8bae\u517c\u5bb9\u7684JDBC\u548cGo\u6570\u636e\u5e93\u9a71\u52a8\u3002\u6b64\u5916\uff0c\u5b83\u8fd8\u5b9e\u73b0\u4e86mysql\u670d\u52a1\u5668\u534f\u8bae\uff0c\u8be5\u534f\u8bae\u51e0\u4e4e\u4e0e\u4efb\u4f55\u5176\u4ed6\u8bed\u8a00\u90fd\u517c\u5bb9\u3002</p> <p>\u81ea2011\u5e74\u4ee5\u6765\uff0cVitess\u4e00\u76f4\u4e3aYouTube\u6240\u6709\u7684\u6570\u636e\u5e93\u63d0\u4f9b\u670d\u52a1\uff0c\u73b0\u5728\u5df2\u88ab\u8bb8\u591a\u4f01\u4e1a\u91c7\u7528\u5e76\u5e94\u7528\u4e8e\u5b9e\u9645\u751f\u4ea7\u3002</p>"},{"location":"cloud-native/other/vitess/#12","title":"1.2 \u7279\u6027","text":""},{"location":"cloud-native/other/vitess/#121","title":"1.2.1 \u6027\u80fd\u63d0\u5347","text":"<ul> <li>\u8fde\u63a5\u6c60 - \u5c06\u524d\u7aef\u5e94\u7528\u7a0b\u5e8f\u4ee5\u591a\u8def\u590d\u7528\u7684\u65b9\u5f0f\u6620\u5c04\u5230MySQL\u8fde\u63a5\u6c60\u4ee5\u4f18\u5316\u6027\u80fd\u3002</li> <li>\u67e5\u8be2\u7ed3\u679c\u91cd\u7528 \u2013 \u5bf9\u4e8e\u76f8\u540c\u7ed3\u679c\u96c6\u7684\u67e5\u8be2\uff0c\u591a\u4e2a\u67e5\u8be2\u5e76\u53d1\u67e5\u8be2\u65f6\uff0cvttablet\u4f1a\u8bc6\u522b\u548c\u7ba1\u7406\u76f8\u540c\u67e5\u8be2\uff0c\u7b49\u5f85\u7b2c\u4e00\u4e2a\u67e5\u8be2\u7ed3\u679c\u5b8c\u6210\uff0c\u5e76\u53d1\u9001\u7ed9\u6240\u6709\u7684\u8c03\u7528\u8005\u3002</li> <li>\u4e8b\u52a1\u7ba1\u7406 \u2013 \u9650\u5236\u5e76\u53d1\u4e8b\u52a1\u6570\u3001\u7ba1\u7406\u4e8b\u52a1\u8d85\u65f6\u65f6\u95f4\u4ee5\u4f18\u5316\u603b\u4f53\u541e\u5410\u91cf\u3002</li> </ul>"},{"location":"cloud-native/other/vitess/#122","title":"1.2.2 \u4fdd\u62a4\u673a\u5236","text":"<ul> <li>\u67e5\u8be2\u91cd\u5199\u548c\u6e05\u7406 \u2013 \u907f\u514d\u6f2b\u65e0\u76ee\u7684\u7684\u66f4\u65b0\uff0c\u5bf9\u5927\u67e5\u8be2\u6dfb\u52a0limits\u3002</li> <li>\u67e5\u8be2\u9ed1\u540d\u5355 \u2013 \u53ef\u901a\u8fc7\u81ea\u5b9a\u4e49\u89c4\u5219\u4ee5\u9632\u6b62\u53ef\u80fd\u5b58\u5728\u95ee\u9898\u7684\u67e5\u8be2\u547d\u4e2d\u6570\u636e\u5e93\u3002</li> <li>\u67e5\u8be2\u8d85\u65f6 \u2013 \u53ef\u81ea\u5b9a\u4e49\u67e5\u8be2\u8d85\u65f6\u65f6\u95f4\u503c\uff0cVitess\u5c06\u5e72\u6389\u8d85\u65f6\u7684\u67e5\u8be2\u3002</li> <li>\u8868\u522b\u8bbf\u95ee\u6743\u9650\u63a7\u5236\u5b9a\u4e49 \u2013 \u53ef\u4ee5\u9488\u5bf9\u4e0d\u540c\u7684\u63a5\u5165\u7528\u6237\u6307\u5b9a\u8868\u7684\u8bbf\u95ee\u63a7\u5236\u6743\u9650 (ACLs)\u3002</li> </ul>"},{"location":"cloud-native/other/vitess/#123","title":"1.2.3 \u76d1\u63a7","text":"<ul> <li>\u6027\u80fd\u5206\u6790: Vitess\u63d0\u4f9b\u5de5\u5177\u53ef\u8ba9\u60a8\u76d1\u63a7\uff0c\u8bca\u65ad\u548c\u5206\u6790\u6570\u636e\u5e93\u6027\u80fd\u3002</li> <li>\u6d41\u5f0f\u67e5\u8be2 \u2013 \u4f7f\u7528\u4f20\u5165\u67e5\u8be2\u5217\u8868\u6765\u63d0\u4f9bOLAP\u5de5\u4f5c\u3002</li> <li>\u66f4\u65b0\u6d41 \u2013 \u670d\u52a1\u5668\u6d41\u5f0f\u4f20\u8f93\u6570\u636e\u5e93\u4e2d\u66f4\u6539\u7684\u884c\u5217\u8868\uff0c\u53ef\u7528\u4f5c\u5c06\u66f4\u6539\u4f20\u64ad\u5230\u5176\u4ed6\u6570\u636e\u5b58\u50a8\u7684\u673a\u5236\u3002</li> </ul>"},{"location":"cloud-native/other/vitess/#124","title":"1.2.4 \u62d3\u6251\u7ba1\u7406\u5de5\u5177","text":"<ul> <li>Master\u7ba1\u7406\u5de5\u5177\uff08\u7528\u4e8ereparent\u5904\u7406\uff09</li> <li>\u57fa\u4e8eWeb GUI\u7684\u7ba1\u7406\u7aef</li> <li>\u53ef\u5de5\u4f5c\u4e8e\u591a\u4e2a\u6570\u636e\u4e2d\u5fc3/\u533a\u57df\u7684\u8bbe\u8ba1</li> </ul>"},{"location":"cloud-native/other/vitess/#125","title":"1.2.5 \u62c6\u5206","text":"<ul> <li>\u51e0\u4e4e\u65e0\u7f1d\u7684\u52a8\u6001\u5206\u7247\u62c6\u5206</li> <li>\u652f\u6301\u5782\u76f4\u548c\u6c34\u5e73\u5206\u7247\u62c6\u5206</li> <li>\u591a\u79cd\u5206\u7247\u65b9\u6848\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u5206\u7247\u65b9\u6848</li> </ul>"},{"location":"cloud-native/other/vitess/#13","title":"1.3 \u4e0e\u5176\u4ed6\u6570\u636e\u5e93\u5bf9\u6bd4","text":"<p>\u4ee5\u4e0b\u90e8\u5206\u5c06Vitess\u4e0e\u4e24\u79cd\u5e38\u89c1\u7684\u66ff\u4ee3\u65b9\u6848\u8fdb\u884c\u6bd4\u8f83\uff0c\u5373vanilla MySQL\u5b9e\u73b0\u548cNoSQL\u5b9e\u73b0\u3002</p>"},{"location":"cloud-native/other/vitess/#131-vitess-vs-vanilla-mysql","title":"1.3.1 Vitess vs. Vanilla MySQL","text":"Vanilla MySQL Vitess \u6bcf\u4e2aMySQL\u8fde\u63a5\u7684\u5185\u5b58\u5f00\u9500\u4ecb\u4e8e256KB\u548c3MB\u4e4b\u95f4\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u60a8\u4f7f\u7528\u7684MySQL\u7248\u672c\u3002\u968f\u7740\u7528\u6237\u7fa4\u7684\u589e\u957f\uff0c\u60a8\u9700\u8981\u6dfb\u52a0RAM\u4ee5\u652f\u6301\u5176\u4ed6\u8fde\u63a5\uff0c\u4f46RAM\u4e0d\u4f1a\u6709\u52a9\u4e8e\u66f4\u5feb\u7684\u67e5\u8be2\u3002\u6b64\u5916\uff0c\u83b7\u5f97\u8fde\u63a5\u65f6\u7684CPU\u6210\u672c\u4e5f\u5f88\u9ad8\u3002 Vitess\u521b\u5efa\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\u8fde\u63a5\u3002 Vitess\u7684\u8fde\u63a5\u6c60\u529f\u80fd\u4f7f\u7528Go\u8bed\u8a00\u7684\u5e76\u53d1\u7279\u6027\uff0c\u5c06\u8fd9\u4e9b\u8f7b\u91cf\u7ea7\u8fde\u63a5\u6620\u5c04\u5230\u4e00\u5c0f\u90e8\u5206MySQL\u8fde\u63a5\u4e2d\u3002\u56e0\u6b64\uff0cVitess\u53ef\u4ee5\u8f7b\u677e\u5904\u7406\u6570\u5343\u4e2a\u8fde\u63a5\u3002 \u5199\u7684\u5f88\u70c2\u7684\u67e5\u8be2\uff08\u4f8b\u5982\u672a\u8bbe\u7f6eLIMIT\u7684\u67e5\u8be2\uff09\u4f1a\u5bf9\u62d6\u6162\u6570\u636e\u5e93\u5f71\u54cd\u6240\u6709\u7528\u6237\u3002 Vitess\u5b9e\u73b0\u4e86SQL\u89e3\u6790\u5668\uff0c\u5e76\u4f7f\u7528\u4e00\u7ec4\u53ef\u914d\u7f6e\u7684\u89c4\u5219\u6765\u91cd\u5199\u53ef\u80fd\u4f1a\u635f\u5bb3\u6570\u636e\u5e93\u6027\u80fd\u7684\u67e5\u8be2\u3002 \u5206\u7247\u662f\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u533a\u4ee5\u63d0\u9ad8\u53ef\u4f38\u7f29\u6027\u548c\u6027\u80fd\u7684\u624b\u6bb5\u3002 MySQL\u672c\u8eab\u4e0d\u5177\u5907\u5206\u7247\u529f\u80fd\uff0c\u8981\u6c42\u60a8\u7f16\u5199\u5206\u7247\u4ee3\u7801\u5e76\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5d4c\u5165\u5206\u7247\u903b\u8f91\u3002 Vitess\u652f\u6301\u5404\u79cd\u5206\u7247\u65b9\u6848\u3002\u5b83\u8fd8\u53ef\u4ee5\u5c06\u8868\u8fc1\u79fb\u5230\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4e2d\uff0c\u5e76\u53ef\u4ee5\u6269\u5bb9\u6216\u7f29\u5bb9\u6269\u5c55\u5206\u7247\u6570\u3002\u8fd9\u4e9b\u529f\u80fd\u7686\u662f\u975e\u4fb5\u5165\u5f0f\u6267\u884c\u7684\uff0c\u53ea\u9700\u51e0\u79d2\u949f\u7684\u53ea\u8bfb\u505c\u673a\u65f6\u95f4\u5373\u53ef\u5b8c\u6210\u5927\u591a\u6570\u6570\u636e\u8f6c\u6362\u3002 \u4f7f\u7528\u590d\u5236\u5b9e\u73b0\u9ad8\u53ef\u7528\u7684MySQL\u96c6\u7fa4\u5177\u6709\u4e3b\u6570\u636e\u5e93\u548c\u4e00\u4e9b\u526f\u672c\u3002\u5982\u679c\u4e3b\u670d\u52a1\u5668\u51fa\u73b0\u6545\u969c\uff0c\u5219\u526f\u672c\u5e94\u6210\u4e3a\u65b0\u4e3b\u670d\u52a1\u5668\u3002\u8fd9\u8981\u6c42\u60a8\u81ea\u5df1\u7ba1\u7406\u6570\u636e\u5e93\u751f\u547d\u5468\u671f\u5e76\u5c06\u5f53\u524d\u7cfb\u7edf\u72b6\u6001\u4f20\u9012\u7ed9\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u3002 Vitess\u6709\u52a9\u4e8e\u7ba1\u7406\u6570\u636e\u5e93\u65b9\u6848\u7684\u751f\u547d\u5468\u671f\u3002\u5b83\u652f\u6301\u5e76\u81ea\u52a8\u5904\u7406\u5404\u79cd\u65b9\u6848\uff0c\u5305\u62ec\u4e3b\u6545\u969c\u8fc1\u79fb\u548c\u6570\u636e\u5907\u4efd\u3002 MySQL\u96c6\u7fa4\u53ef\u4ee5\u4e3a\u4e0d\u540c\u7684\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u81ea\u5b9a\u4e49\u6570\u636e\u5e93\u914d\u7f6e\uff0c\u4f8b\u5982\u7528\u4e8e\u5199\u5165\u7684\u4e3b\u6570\u636e\u5e93\u3001\u7528\u4e8eWeb\u5ba2\u6237\u7aef\u7684\u5feb\u901f\u53ea\u8bfb\u526f\u672c\u3001\u7528\u4e8e\u6279\u5904\u7406\u4f5c\u4e1a\u7684\u8f83\u6162\u53ea\u8bfb\u526f\u672c\u7b49\u7b49\u3002\u5982\u679c\u6570\u636e\u5e93\u5177\u6709\u6c34\u5e73\u5206\u7247\uff0c\u5219\u9700\u8981\u4e3a\u6bcf\u4e2a\u5206\u7247\u91cd\u590d\u8bbe\u7f6e\uff0c\u5e76\u4e14\u5e94\u7528\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u52a0\u5165\u903b\u8f91\u4ee5\u4fbf\u627e\u5230\u6b63\u786e\u7684\u6570\u636e\u5e93\u3002 Vitess\u4f7f\u7528\u5206\u5e03\u5f0f\u4e00\u81f4\u6027\u952e\u503c\u5b58\u50a8\u62d3\u6251\u670d\u52a1\uff0c\u5982etcd\u6216ZooKeeper\u3002\u8fd9\u610f\u5473\u7740\u7fa4\u96c6\u5143\u6570\u636e\u59cb\u7ec8\u662f\u6700\u65b0\u7684\uff0c\u5e76\u4e14\u5bf9\u4e8e\u4e0d\u540c\u7684\u5ba2\u6237\u7aef\u662f\u4e00\u81f4\u7684\u3002 Vitess\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4ee3\u7406\uff0c\u53ef\u4ee5\u6709\u6548\u5730\u5c06\u67e5\u8be2\u8def\u7531\u5230\u6700\u5408\u9002\u7684MySQL\u5b9e\u4f8b\u3002"},{"location":"cloud-native/other/vitess/#132-vitess-vs-nosql","title":"1.3.2 Vitess vs. NoSQL","text":"NoSQL Vitess NoSQL\u6570\u636e\u5e93\u6ca1\u6709\u4f20\u7edf\u6570\u636e\u5e93\u4e2d\u5e93\u548c\u8868\u7684\u6982\u5ff5\uff0c\u4ec5\u652f\u6301SQL\u8bed\u8a00\u7684\u5b50\u96c6\u3002 Vitess\u4e0d\u662f\u7b80\u5355\u7684\u952e\u503c\u5b58\u50a8\u3002\u5b83\u652f\u6301\u590d\u6742\u7684\u67e5\u8be2\u8bed\u4e49\uff0c\u4f8b\u5982where\u5b50\u53e5\uff0cJOINS\uff0c\u805a\u5408\u51fd\u6570\u7b49\u3002 NoSQL\u6570\u636e\u5e93\u4e0d\u652f\u6301\u4e8b\u52a1 NoSQL\u89e3\u51b3\u65b9\u6848\u5177\u6709\u81ea\u5b9a\u4e49API\uff0c\u53ef\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7ed3\u6784\uff0c\u5e94\u7528\u7a0b\u5e8f\u548c\u5de5\u5177\u3002 Vitess\u4e0eMySQL\u4e4b\u95f4\u4ec5\u6709\u5f88\u5c0f\u7684\u5dee\u5f02\uff0cMySQL\u662f\u4e00\u4e2a\u5927\u591a\u6570\u4eba\u5df2\u7ecf\u4e60\u60ef\u4f7f\u7528\u7684\u6570\u636e\u5e93\u3002 NoSQL\u89e3\u51b3\u65b9\u6848\u5177\u6709\u81ea\u5b9a\u4e49API\uff0c\u53ef\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7ed3\u6784\uff0c\u5e94\u7528\u7a0b\u5e8f\u548c\u5de5\u5177\u3002 Vitess\u5141\u8bb8\u60a8\u4f7f\u7528MySQL\u7684\u6240\u6709\u7d22\u5f15\u529f\u80fd\u6765\u4f18\u5316\u67e5\u8be2\u6027\u80fd\u3002"},{"location":"cloud-native/other/vitess/#14","title":"1.4 \u67b6\u6784","text":"<p>Vitess\u5e73\u53f0\u7531\u8bb8\u591a\u670d\u52a1\u5668\u8fdb\u7a0b\u3001\u547d\u4ee4\u884c\u5b9e\u7528\u7a0b\u5e8f\u548c\u57fa\u4e8eWeb\u7684\u5b9e\u7528\u7a0b\u5e8f\u7ec4\u6210\uff0c\u7531\u4e00\u81f4\u7684\u5143\u6570\u636e\u5b58\u50a8\u63d0\u4f9b\u652f\u6301\u3002</p> <p>\u6839\u636e\u60a8\u5f53\u524d\u7684\u4e1a\u52a1\u72b6\u6001\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u65b9\u5f0f\u6700\u7ec8\u5b9e\u73b0vitess\u7684\u5b8c\u6574\u90e8\u7f72\u3002\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5982\u679c\u662f\u4ece\u5934\u5f00\u59cb\u6784\u5efa\u670d\u52a1\uff0c\u90a3\u4e48\u4f7f\u7528Vitess\u7684\u7b2c\u4e00\u6b65\u5c31\u662f\u5b9a\u4e49\u6570\u636e\u5e93\u62d3\u6251\u3002\u5982\u679c\u662f\u6269\u5c55\u73b0\u6709\u7684\u6570\u636e\u5e93\uff0c \u90a3\u4e48\u53ef\u80fd\u9700\u8981\u5148\u90e8\u7f72\u8fde\u63a5\u4ee3\u7406\u3002</p> <p>\u65e0\u8bba\u60a8\u662f\u4ece\u4e00\u6574\u5957\u6570\u636e\u5e93\u5f00\u59cb\uff0c\u8fd8\u662f\u51b3\u5b9a\u4ece\u5c0f\u89c4\u6a21\u5f00\u59cb(\u4eca\u540e\u518d\u6162\u6162\u6269\u5c55)\u3002Vitess\u5de5\u5177\u548c\u670d\u52a1\u5668\u90fd\u80fd\u8d34\u5fc3\u7684\u5e2e\u52a9\u5230\u60a8\u3002\u5bf9\u4e8e\u8f83\u5c0f\u89c4\u6a21\u7684\u6570\u636e\u5e93\uff0cvttablet\u529f\u80fd\uff08\u5982\u8fde\u63a5\u6c60\u548c\u67e5\u8be2\u91cd\u5199\uff09\u53ef\u5e2e\u52a9\u60a8\u4ece\u73b0\u6709\u786c\u4ef6\u4e2d\u69a8\u53d6\u66f4\u591a\u6027\u80fd\u3002\u5bf9\u4e8e\u5927\u89c4\u6a21\u7684\u6570\u636e\u5e93\uff0cVitess\u63d0\u4f9b\u7684\u81ea\u52a8\u5316\u5de5\u5177\u5728\u4e3a\u66f4\u5927\u89c4\u6a21\u7684\u5b9e\u65bd\u65f6\u7ed9\u4e88\u66f4\u591a\u7684\u4fbf\u5229\u3002</p>"},{"location":"cloud-native/other/vitess/#141-vitess","title":"1.4.1 Vitess\u7684\u7ec4\u4ef6\u67b6\u6784\u56fe","text":""},{"location":"cloud-native/other/vitess/#142","title":"1.4.2 \u76f8\u5173\u7ec4\u4ef6","text":"<ul> <li>Topology</li> </ul> <p>\u62d3\u6251\u670d\u52a1 \u4e00\u4e2a\u5143\u6570\u636e\u5b58\u50a8\uff0c\u5305\u542b\u6709\u5173\u6b63\u5728\u8fd0\u884c\u7684\u670d\u52a1\u5668\u3001\u5206\u7247\u65b9\u6848\u548c\u590d\u5236\u56fe\u7684\u4fe1\u606f\u3002\u62d3\u6251\u7531\u4e00\u81f4\u7684\u6570\u636e\u5b58\u50a8\u652f\u6301\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528**vtctl** (\u547d\u4ee4\u884c) \u548c vtctld (web)\u67e5\u770b\u62d3\u6251.</p> <p>\u5728Kubernetes\u4e2d\uff0c\u6570\u636e\u5b58\u50a8\u662fetcd\u3002 Vitess\u6e90\u4ee3\u7801\u8fd8\u9644\u5e26Apache ZooKeeper\u652f\u6301\u3002</p> <ul> <li>vtgate</li> </ul> <p>vtgate \u662f\u4e00\u4e2a\u8f7b\u578b\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u5b83\u5c06\u6d41\u91cf\u8def\u7531\u5230\u6b63\u786e\u7684vttablet\uff0c\u5e76\u5c06\u5408\u5e76\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u5e94\u7528\u7a0b\u5e8f\u5411vtgate\u53d1\u8d77\u67e5\u8be2\u3002\u5ba2\u6237\u7aef\u4f7f\u7528\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u5b83\u53ea\u9700\u8981\u80fd\u591f\u627e\u5230vtgate\u5b9e\u4f8b\u5c31\u80fd\u4f7fvitess\u3002</p> <p>\u4e3a\u4e86\u8def\u7531\u67e5\u8be2\uff0cvtgate\u7efc\u5408\u8003\u8651\u4e86\u5206\u7247\u65b9\u6848\u3001\u6570\u636e\u5ef6\u8fdf\u4ee5\u53cavttablet\u53ca\u5176\u5bf9\u5e94\u5e95\u5c42MySQL\u5b9e\u4f8b\u7684\u53ef\u7528\u6027\u3002</p> <ul> <li>vttablet</li> </ul> <p>vttablet \u662f\u4e00\u4e2a\u4f4d\u4e8eMySQL\u6570\u636e\u5e93\u524d\u9762\u7684\u4ee3\u7406\u670d\u52a1\u5668\u3002vitess\u5b9e\u73b0\u4e2d\u6bcf\u4e2aMySQL\u5b9e\u4f8b\u90fd\u6709\u4e00\u4e2avttablet\u3002</p> <p>\u6267\u884c\u7684\u4efb\u52a1\u8bd5\u56fe\u6700\u5927\u5316\u541e\u5410\u91cf\uff0c\u540c\u65f6\u4fdd\u62a4mysql\u4e0d\u53d7\u6709\u5bb3\u67e5\u8be2\u7684\u5f71\u54cd\u3002\u5b83\u7684\u7279\u6027\u5305\u62ec\u8fde\u63a5\u6c60\u3001\u67e5\u8be2\u91cd\u5199\u548c\u91cd\u7528\u91cd\u590d\u6570\u636e\u3002\u6b64\u5916\uff0cvtTablet\u6267\u884cvtcl\u542f\u52a8\u7684\u7ba1\u7406\u4efb\u52a1\uff0c\u5e76\u63d0\u4f9b\u7528\u4e8e\u8fc7\u6ee4\u590d\u5236\u548c\u6570\u636e\u5bfc\u51fa\u7684\u6d41\u5f0f\u670d\u52a1\u3002</p> <p>\u901a\u8fc7\u5728MySQL\u6570\u636e\u5e93\u524d\u8fd0\u884cvttablet\u5e76\u66f4\u6539\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee5\u4f7f\u7528Vitess\u5ba2\u6237\u7aef\u800c\u4e0d\u662fMySQL\u9a71\u52a8\u7a0b\u5e8f\uff0c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u5c06\u53d7\u76ca\u4e8evttablet\u7684\u8fde\u63a5\u6c60\uff0c\u67e5\u8be2\u91cd\u5199\u548c\u91cd\u7528\u6570\u636e\u96c6\u7b49\u529f\u80fd\u3002</p> <ul> <li>vtctl</li> </ul> <p>vtctl\u662f\u4e00\u4e2a\u7528\u4e8e\u7ba1\u7406Vitess\u96c6\u7fa4\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002\u5b83\u5141\u8bb8\u7528\u6237\u6216\u5e94\u7528\u7a0b\u5e8f\u8f7b\u677e\u5730\u4e0eVitess\u5b9e\u73b0\u4ea4\u4e92\u3002\u4f7f\u7528vtctl\uff0c\u60a8\u53ef\u4ee5\u8bc6\u522b\u4e3b\u6570\u636e\u5e93\u548c\u526f\u672c\u6570\u636e\u5e93\uff0c\u521b\u5efa\u8868\uff0c\u542f\u52a8\u6545\u969c\u8f6c\u79fb\uff0c\u6267\u884c\u5206\u7247\uff08\u548c\u91cd\u65b0\u5206\u7247\uff09\u64cd\u4f5c\u7b49\u3002</p> <p>\u5f53vtctl\u6267\u884c\u64cd\u4f5c\u65f6\uff0c\u5b83\u4f1a\u6839\u636e\u9700\u8981\u66f4lockserver\u3002\u5176\u4ed6Vitess\u670d\u52a1\u5668\u4f1a\u89c2\u5bdf\u8fd9\u4e9b\u53d8\u5316\u5e76\u505a\u51fa\u76f8\u5e94\u7684\u53cd\u5e94\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f7f\u7528vtctl\u6545\u969c\u8f6c\u79fb\u5230\u65b0\u7684\u4e3b\u6570\u636e\u5e93\uff0c\u5219vtgate\u4f1a\u67e5\u770b\u66f4\u6539\u5e76\u5c06\u5c06\u5199\u5165\u6d41\u91cf\u5207\u5230\u65b0\u4e3b\u670d\u52a1\u5668\u3002</p> <ul> <li>vtctld</li> </ul> <p>vtctld\u662f\u4e00\u4e2aHTTP\u670d\u52a1\u5668\uff0c\u5141\u8bb8\u60a8\u6d4f\u89c8\u5b58\u50a8\u5728lockserver\u4e2d\u7684\u4fe1\u606f\u3002\u5b83\u5bf9\u4e8e\u6545\u969c\u6392\u9664\u6216\u83b7\u53d6\u670d\u52a1\u5668\u53ca\u5176\u5f53\u524d\u72b6\u6001\u7684\u9ad8\u5c42\u6982\u89c2\u975e\u5e38\u6709\u7528\u3002</p> <ul> <li>vtworker</li> </ul> <p>vtworker \u6258\u7ba1\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u8fdb\u7a0b\u3002\u5b83\u652f\u6301\u63d2\u4ef6\u67b6\u6784\u5e76\u63d0\u4f9b\u4ee3\u7801\u5e93\uff0c\u4ee5\u4fbf\u60a8\u53ef\u4ee5\u8f7b\u677e\u9009\u62e9\u8981\u4f7f\u7528\u7684vttablet\u3002\u63d2\u4ef6\u53ef\u7528\u4e8e\u4ee5\u4e0b\u7c7b\u578b\u7684\u4f5c\u4e1a\uff1a</p> <ul> <li>\u6c34\u5e73\u62c6\u5206\u6216\u5408\u5e76\u8fc7\u7a0b\u4e2d\u68c0\u67e5\u6570\u636e\u7684\u5b8c\u6574\u6027</li> <li>\u5782\u76f4\u62c6\u5206\u6216\u5408\u5e76\u8fc7\u7a0b\u4e2d\u68c0\u67e5\u6570\u636e\u7684\u5b8c\u6574\u6027</li> </ul> <p>vtworker\u8fd8\u53ef\u4ee5\u8ba9\u60a8\u8f7b\u677e\u6dfb\u52a0\u5176\u4ed6\u9a8c\u8bc1\u7a0b\u5e8f\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u4e2akeyspace\u4e2d\u7684\u7d22\u5f15\u8868\u5f15\u7528\u5230\u53e6\u4e00keyspace\u4e2d\u7684\u6570\u636e\uff0c\u5219\u53ef\u4ee5\u6267\u884c\u7247\u5185\u5b8c\u6574\u6027\u68c0\u67e5\u4ee5\u9a8c\u8bc1\u7c7b\u4f3c\u5916\u952e\u7684\u5173\u7cfb\u6216\u8de8\u5206\u7247\u5b8c\u6574\u6027\u68c0\u67e5\u3002</p>"},{"location":"cloud-native/other/vitess/#_2","title":"\u4e8c \u5feb\u901f\u5165\u95e8","text":""},{"location":"cloud-native/other/vitess/#21-kubenetesvitess","title":"2.1 Kubenetes\u4e0a\u8fd0\u884cVitess","text":""},{"location":"cloud-native/other/vitess/#211","title":"2.1.1 \u573a\u666f","text":"<p>\u4e0b\u9762\u7684\u793a\u4f8b\u5c06\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u7684commerce\u6570\u636e\u5e93\u6765\u8bf4\u660evitess\u5982\u4f55\u5c06\u60a8\u4ece\u4e00\u4e2a\u6570\u636e\u5e93\u6269\u5c55\u5230\u4e00\u4e2a\u5b8c\u5168\u5206\u5e03\u5f0f\u548c\u5206\u7247\u7684\u96c6\u7fa4\u3002\u8fd9\u662f\u4e00\u4e2a\u76f8\u5f53\u5e38\u89c1\u7684\u573a\u666f\uff0c\u5b83\u9002\u7528\u4e8e\u7535\u5b50\u5546\u52a1\u4e4b\u5916\u7684\u8bb8\u591a\u7528\u4f8b\u3002*</p> <p>\u968f\u7740\u516c\u53f8\u7684\u53d1\u5c55\u58ee\u5927\uff0c\u4ed6\u4eec\u7ecf\u5e38\u4f1a\u9762\u4e34\u8fd9\u6837\u4e00\u4e2a\u95ee\u9898\uff1a\u4ea4\u6613\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u91cf\u663e\u8457\u589e\u52a0\u3002\u6570\u636e\u5927\u5c0f\u6025\u5267\u589e\u52a0\u53ef\u80fd\u5bfc\u81f4\u67e5\u8be2\u5ef6\u8fdf\u3001\u53ef\u7ba1\u7406\u6027\u53d8\u5dee\u7b49\u5f71\u54cd\u6027\u80fd\u7684\u95ee\u9898\u3002\u672c\u6559\u7a0b\u6f14\u793a\u4e86Vitess\u5982\u4f55\u4e0eKubernetes\u4e00\u8d77\u4f7f\u7528\uff0c\u901a\u8fc7\u5229\u7528\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u6c34\u5e73\u5206\u7247\u6765\u7f13\u89e3\u7cfb\u7edf\u5728\u5927\u89c4\u6a21\u6570\u636e\u4e0b\u7684\u6570\u636e\u67e5\u8be2\u6027\u80fd\u95ee\u9898\u3002</p>"},{"location":"cloud-native/other/vitess/#212","title":"2.1.2 \u5148\u51b3\u6761\u4ef6","text":"<p>\u5148\u51b3\u6761\u4ef6</p> <ul> <li>\u4e0b\u8f7d Vitess</li> <li>\u5b89\u88c5 Minikube</li> <li>\u542f\u52a8Minikube\u5f15\u64ce\uff1a<code>minikube start --cpus = 4 --memory = 5000</code>\u3002\u8bf7\u6ce8\u610f\u5176\u4ed6\u8d44\u6e90\u8981\u6c42\u3002\u4e3a\u4e86\u5b8c\u6210\u6240\u6709\u7528\u4f8b\uff0c\u5c06\u542f\u52a8\u8bb8\u591avttablet\u548cMySQL\u5b9e\u4f8b\u3002\u8fd9\u4e9b\u9700\u8981\u6bd4Minikube\u4f7f\u7528\u7684\u9ed8\u8ba4\u503c\u66f4\u591a\u7684\u8d44\u6e90\u3002</li> <li>\u5b89\u88c5 etcd \u7ba1\u7406\u7aef</li> <li>\u5b89\u88c5 helm</li> <li>\u5b8c\u6210\u5b89\u88c5\u540e, \u8fd0\u884c <code>helm init</code></li> </ul> <p>\u53ef\u9009\u64cd\u4f5c</p> <ul> <li>\u5728Ubuntu\u4e0a\u5b89\u88c5Mysql\u5ba2\u6237\u7aef: <code>apt-get install mysql-client</code></li> <li>\u5b89\u88c5 vtctlclient</li> <li>\u5b89\u88c5 go 1.11+</li> <li><code>go get vitess.io/vitess/go/cmd/vtctlclient</code></li> <li>vtctlclient \u5c06\u5b89\u88c5\u5728\u76ee\u5f55 <code>$GOPATH/bin/</code></li> </ul>"},{"location":"cloud-native/other/vitess/#213-keyspace","title":"2.1.3 \u542f\u52a8\u5355\u7247keyspace\u96c6\u7fa4","text":"<ul> <li>\u542f\u52a8</li> </ul> <p>\u4f60google\u4e86\u4e00\u901akeyspace\uff0c\u5374\u53d1\u73b0\u4e86\u5f88\u591a\u5173\u4e8eNoSQL\u7684\u4e1c\u897f\u3002\u8fd9TM\u662f\u600e\u4e48\u56de\u4e8b\uff1f\u867d\u7136\u8fd9\u4f1a\u82b1\u8d39\u4f60\u51e0\u4e2a\u5c0f\u65f6\u7684\u65f6\u95f4\uff0c\u4f46\u662f\u5728\u4ed4\u7ec6\u7ffb\u770bvitess\u7684\u53e4\u8001\u5377\u8f74\u4e4b\u540e\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u539f\u6765\u5728\u672a\u5206\u7247(\u5355\u7247)\u7684\u60c5\u5f62\u4e0b\uff0c\u5728NewSQL\u7684\u4e16\u754c\u4e2d\uff0ckeyspaces\u548cdatabases\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u7c7b\u4e1c\u897f\u3002\u6700\u540e\uff0c\u662f\u65f6\u5019\u5f00\u59cb\u6211\u4eec\u7684\u65c5\u7a0b\u4e86\u3002</p> <p>\u5207\u6362\u5230helm\u793a\u4f8b\u76ee\u5f55:</p> <pre><code>cd examples/helm\n</code></pre> <p>\u5728\u6b64\u76ee\u5f55\u4e2d\uff0c\u60a8\u5c06\u770b\u5230\u4e00\u7ec4yaml\u6587\u4ef6\u3002\u6bcf\u4e2a\u6587\u4ef6\u540d\u7684\u7b2c\u4e00\u4e2a\u6570\u5b57\u8868\u793a\u793a\u4f8b\u7684\u9636\u6bb5\u3002\u63a5\u4e0b\u6765\u7684\u4e24\u4f4d\u6570\u5b57\u8868\u793a\u6267\u884c\u5b83\u4eec\u7684\u987a\u5e8f\u3002\u4f8b\u5982\u2019101_initial_cluster.yaml\u2019\u662f\u7b2c\u4e00\u9636\u6bb5\u7684\u7b2c\u4e00\u4e2a\u6587\u4ef6\u3002\u6211\u4eec\u73b0\u5728\u5c06\u6267\u884c:</p> <pre><code>helm install ../../helm/vitess -f 101_initial_cluster.yaml\n</code></pre> <p>\u8fd9\u5c06\u521b\u5efa\u4e00\u4e2a\u5e26\u6709\u5355\u4e2akeyspace\u7a7a\u95f4\u7684\u521d\u59cbVitess\u96c6\u7fa4\u3002</p> <ul> <li>\u9a8c\u8bc1\u96c6\u7fa4</li> </ul> <p>\u4e00\u65e6\u6210\u529f\uff0c\u60a8\u5e94\u8be5\u770b\u5230\u4ee5\u4e0b\u72b6\u6001\uff1a</p> <pre><code>~/...vitess/helm/vitess/templates&gt; kubectl get pods,jobs\nNAME                               READY     STATUS    RESTARTS   AGE\npo/etcd-global-2cwwqfkf8d          1/1       Running   0          14m\npo/etcd-operator-9db58db94-25crx   1/1       Running   0          15m\npo/etcd-zone1-btv8p7pxsg           1/1       Running   0          14m\npo/vtctld-55c47c8b6c-5v82t         1/1       Running   1          14m\npo/vtgate-zone1-569f7b64b4-zkxgp   1/1       Running   2          14m\npo/zone1-commerce-0-rdonly-0       6/6       Running   0          14m\npo/zone1-commerce-0-replica-0      6/6       Running   0          14m\npo/zone1-commerce-0-replica-1      6/6       Running   0          14m\n\nNAME                                      DESIRED   SUCCESSFUL   AGE\njobs/commerce-apply-schema-initial        1         1            14m\njobs/commerce-apply-vschema-initial       1         1            14m\njobs/zone1-commerce-0-init-shard-master   1         1            14m\n</code></pre> <p>\u5982\u679c\u5df2\u5b89\u88c5MySQL\u5ba2\u6237\u7aef\uff0c\u5219\u73b0\u5728\u5e94\u8be5\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fde\u63a5\u5230\u7fa4\u96c6\uff1a</p> <pre><code>~/...vitess/examples/helm&gt; ./kmysql.sh\nmysql&gt; show tables;\n+--------------------+\n| Tables_in_commerce |\n+--------------------+\n| corder             |\n| customer           |\n| product            |\n+--------------------+\n3 rows in set (0.01 sec)\n</code></pre> <p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6d4f\u89c8vtctld\u63a7\u5236\u53f0\uff1a\uff08Ubuntu\uff09</p> <pre><code>./kvtctld.sh\n</code></pre> <ul> <li></li> </ul>"},{"location":"cloud-native/other/vitess/#_3","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>http://vitess.io</li> <li>https://github.com/vitessio/vitess</li> <li>https://vitess.io/zh/docs/</li> <li>https://vitess.io/zh/docs/get-started/kubernetes/</li> </ul>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/","title":"\u534e\u4e3a\u4e91\u539f\u751fCCE\u5b9e\u6218","text":""},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u8fd1\u6765\u548c\u540c\u4e8b\u5171\u540c\u5f00\u53d1\u7684\u8fc1\u79fb\u5e73\u53f0\u9879\u76ee\u60f3\u8fdb\u884c\u5bb9\u5668\u5316\u6539\u9020\uff0c\u987a\u5e94\u5927\u8d8b\u52bf\u5f80\u5bb9\u5668\u5316\u8fd9\u8fb9\u9760\uff0c\u9879\u76ee\u524d\u7aef\u5e73\u53f0\u5229\u7528Django\u5f00\u53d1\uff0c\u540e\u7aefRestful API\u5229\u7528\u9ad8\u6027\u80fdWeb\u6846\u67b6Tornado\u5b8c\u6210\uff0cAgent\u7aef\u5229\u7528Flask\u5f00\u53d1\uff0c\u5404\u53d6\u4e86\u51e0\u4e2a\u5927Python\u6846\u67b6\u7684\u4f18\u52bf\u3002</p> <p>\u4e4b\u524d\u4e3a\u81ea\u5df1\u90e8\u7f72K8s\uff0c\u4e14\u9700\u8981\u4fdd\u8bc1\u96c6\u7fa4\u9ad8\u53ef\u7528\u6027\uff0c\u4e14\u8981\u8003\u8651\u4ece\u76d1\u63a7/\u65e5\u5fd7/\u544a\u8b66/CI/CD/\u8c03\u7528\u94fe\u8ffd\u9010/\u670d\u52a1\u6cbb\u7406\u7b49\uff0c\u4e14\u9700\u8981\u63d0\u4f9b\u5206\u5e03\u5f0f\u5b58\u50a8\uff0c\u4e3aK8s\u96c6\u7fa4\u63d0\u4f9b\u5b58\u50a8\u7c7b\u6765\u5de5\u6709\u72b6\u6001\u5f15\u7528\u6301\u4e45\u5316\u6570\u636e\u3002  </p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#11","title":"1.1 \u4e91\u539f\u751f\u4f18\u52bf","text":"<p>\u66f4\u7701\uff1a\u6781\u5927\u7684\u8d44\u6e90\u5229\u7528\u6548\u7387\uff0c \u6700\u5927\u9650\u5ea6\u69a8\u53d6\u548c\u5171\u4eab\u7269\u7406\u8d44\u6e90\uff0c\u591a\u9879\u76ee\u66f4\u80fd\u4f53\u73b0\u51fa\u5bb9\u5668\u5316\u591a\u4f18\u52bf\uff0c\u8282\u7ea6\u90e8\u7f72IT\u6210\u672c\u3002</p> <p>\u66f4\u5feb\uff1a\u79d2\u7ea7\u542f\u52a8\uff0c\u5b9e\u73b0\u4e1a\u52a1\u7cfb\u7edf\u66f4\u5feb\u7684\u5f00\u53d1\u8fed\u4ee3 \u548c \u4ea4\u4ed8\u90e8\u7f72\u3002</p> <p>\u5f39\u6027\uff1a\u53ef\u6839\u636e\u4e1a\u52a1\u8d1f\u8f7d\u8fdb\u884c\u5f39\u6027\u5bb9\u5668\u4f38\u7f29\uff0c\u5f39\u6027\u6269\u5c55\u3002</p> <p>\u65b9\u4fbf\uff1a\u5bb9\u5668\u5316\u4e1a\u52a1\u90e8\u7f72\u652f\u6301\u84dd\u7eff/\u7070\u5ea6/\u91d1\u4e1d\u96c0\u7b49\u53d1\u5e03\uff0c\u56de\u6eda\uff0c\u66f4\u52a0\u7075\u6d3b\u65b9\u4fbf\u3002</p> <p>\u7075\u6d3b\uff1a\u76d1\u63a7\u5e95\u5c42node\u8282\u70b9\u5065\u5eb7\u72b6\u6001\uff0c\u7075\u6d3b\u8c03\u5ea6\u81f3\u6700\u4f18\u8282\u70b9\u90e8\u7f72\u3002</p> <p>\u5f3a\u4e00\u81f4\u6027\uff1a\u5bb9\u5668\u5c06\u73af\u5883\u548c\u4ee3\u7801\u6253\u5305\u5728\u955c\u50cf\u5185\uff0c\u4fdd\u8bc1\u4e86\u6d4b\u8bd5\u4e0e\u751f\u4ea7\u73af\u5883\u7684\u5f3a\u4e00\u81f4\u6027\u3002</p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#12","title":"1.2 \u6311\u6218","text":"<p>\u5f00\u53d1\u4eba\u5458\u719f\u6089Docker\u865a\u62df\u5316\u6280\u672f\uff0c\u719f\u7ec3\u7f16\u5199Dockerfile\u3002</p> <p>\u719f\u6089kubernetes\u5bb9\u5668\u5316\u7f16\u6392\u7cfb\u7edf\uff0c  \u719f\u6089\u5404\u7ec4\u4ef6\u8d44\u6e90\u6e05\u5355\u7f16\u5199\u3002</p> <p>\u5f00\u53d1\u9700\u8981\u8003\u8651\u540e\u671f\u5bb9\u5668\u7f16\u6392\u90e8\u7f72\u7684\u9700\u6c42\u6765\u7ec4\u7ec7\u7ed3\u6784\u548c\u7f16\u5199\u4ee3\u7801\u3002</p> <p>\u90e8\u7f72\u4eba\u5458\u9700\u8981\u719f\u6089kubernetes\u8d44\u6e90\u6e05\u5355\u5404\u53c2\u6570\u542b\u4e49\uff0c\u9700\u8981\u603b\u4f53\u628a\u63a7\u67b6\u6784\u4e2d\u5230\u4ece\u4e0a\u5230\u4e0b\u67b6\u6784\u3002</p> <p>\u8003\u8651\u9ad8\u53ef\u7528\u67b6\u6784\u548crbac\u5b89\u5168\u7b56\u7565\uff0c\u5916\u90e8\u6d41\u91cf\u5f15\u5165\u53ca\u540e\u671f\u6269\u5bb9\u4f38\u7f29\u3002</p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#13","title":"1.3 \u5e0c\u5180","text":"<p>\u5e0c\u671b\u53ef\u4ee5\u6709\u4e00\u5957\u9ad8\u53ef\u7528\u5f00\u7bb1\u5373\u7528\u7684\u5bb9\u5668\u7ba1\u7406\u5e73\u53f0\uff0c\u6765\u4f7f\u5f97\u6211\u4eec\u66f4\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u7684\u5f00\u53d1\uff0c\u4e0d\u7528\u8fc7\u591a\u7684\u53bb\u5c06\u7cbe\u529b\u653e\u5728\u5e95\u5c42\u57fa\u5efa\u7684\u90e8\u7f72\u7ef4\u62a4\u4e0a\uff0c</p> <p>\u4e91\u5bb9\u5668\u5f15\u64ce\uff08Cloud Container Engine\uff0c\u7b80\u79f0CCE\uff09\u63d0\u4f9b\u9ad8\u5ea6\u53ef\u6269\u5c55\u7684\u3001\u9ad8\u6027\u80fd\u7684\u4f01\u4e1a\u7ea7Kubernetes\u96c6\u7fa4\uff0c\u652f\u6301\u8fd0\u884cDocker\u5bb9\u5668\u3002\u501f\u52a9\u4e91\u5bb9\u5668\u5f15\u64ce\uff0c\u53ef\u4ee5\u5728\u534e\u4e3a\u4e91\u4e0a\u8f7b\u677e\u90e8\u7f72\u3001\u7ba1\u7406\u548c\u6269\u5c55\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\uff0c\u6765\u4e3a\u4f01\u4e1a\u91ca\u653e\u66f4\u591a\u7cbe\u529b\uff0cCCE\u63d0\u4f9b\u4e00\u6574\u5957\u5b8c\u6574\u7684\u6700\u4f73\u5bb9\u5668\u89e3\u51b3\u65b9\u6848\uff0c\u8d4b\u80fd\u4f01\u4e1a\u4e13\u6ce8\u4e1a\u52a1\u5f00\u53d1\u3002</p> <p>\u5728\u6b64\u6d4b\u8bd5CCE\u529f\u80fd\uff0c\u4e3a\u66f4\u597d\u5c06\u81ea\u5df1\u4e1a\u52a1\u8fc1\u79fb\u5230CCE\uff0c\u7279\u6b64\u8bb0\u5f55\u4f7f\u7528\u8fc7\u7a0b\u3002</p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#_2","title":"\u4e8c \u57fa\u7840\u73af\u5883\u90e8\u7f72","text":"<p>\u7531\u4e8e\u662f\u6d4b\u8bd5\u7b80\u5355\u5e94\u7528\uff0c\u57fa\u7840\u73af\u5883\u4e3a\u6700\u5c0f\u914d\u7f6e\uff0c\u4e14\u5b89\u5168\u7ec4\u7b49\u89c4\u5219\u653e\u884c\u7b56\u7565\u8f83\u4e3a\u5bbd\u677e\uff0c\u6b63\u5f0f\u73af\u5883\u9700\u8981\u8fdb\u884c\u4e25\u683c\u5b89\u5168\u7ec4\u89c4\u5219\u914d\u7f6e\uff0c\u4ec5\u653e\u884c\u5fc5\u8981K8s\u7ec4\u5efa\u7aef\u53e3\u53ca\u4e1a\u52a1\u7aef\u53e3\u3002</p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#11_1","title":"1.1 \u5b89\u5168\u7ec4\u914d\u7f6e","text":"<ul> <li>\u521b\u5efa\u5b89\u5168\u7ec4</li> </ul> <ul> <li>\u9488\u5bf9\u5b89\u5168\u7ec4\u8fdb\u884c\u89c4\u5219\u914d\u7f6e</li> </ul>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#12_1","title":"1.2 \u7f51\u7edc\u914d\u7f6e","text":"<p>\u914d\u7f6eNode\u8282\u70b9\u7f51\u7edc</p> <ul> <li>\u521b\u5efaVPC</li> </ul> <p></p> <ul> <li>\u521b\u5efa\u5b50\u7f51</li> </ul> <p></p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#cce_1","title":"\u4e09 CCE\u96c6\u7fa4\u521b\u5efa","text":"<p>\u4e91\u5bb9\u5668\u5f15\u64ce(Cloud Container Engine)\u63d0\u4f9b\u9ad8\u6027\u80fd\u53ef\u6269\u5c55\u7684\u5bb9\u5668\u670d\u52a1\uff0c\u57fa\u4e8e\u4e91\u670d\u52a1\u5668\u5feb\u901f\u6784\u5efa\u9ad8\u53ef\u9760\u7684\u5bb9\u5668\u96c6\u7fa4\uff0c\u6df1\u5ea6\u6574\u5408\u7f51\u7edc\u548c\u5b58\u50a8\u80fd\u529b\uff0c\u517c\u5bb9Kubernetes\u53caDocker\u5bb9\u5668\u751f\u6001\u3002\u5e2e\u52a9\u7528\u6237\u8f7b\u677e\u521b\u5efa\u548c\u7ba1\u7406\u591a\u6837\u5316\u7684\u5bb9\u5668\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5e76\u63d0\u4f9b\u5bb9\u5668\u6545\u969c\u81ea\u6108\uff0c\u76d1\u63a7\u65e5\u5fd7\u91c7\u96c6\uff0c\u81ea\u52a8\u5f39\u6027\u6269\u5bb9\u7b49\u9ad8\u6548\u8fd0\u7ef4\u80fd\u529b\uff0c\u7528\u6237\u65e0\u9700\u8fc7\u591a\u5173\u6ce8\u57fa\u7840\u8bbe\u65bd\u9ad8\u53ef\u7528\uff0c\u5c06\u66f4\u591a\u7cbe\u529b\u653e\u5728\u81ea\u8eab\u4e1a\u52a1\u5f00\u53d1\u4e0a\u3002</p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#21-k8s","title":"2.1 \u9009\u62e9K8s\u7248\u672c","text":"<ul> <li>\u7248\u672c\u9009\u62e9</li> </ul> <p>\u4e3a\u4e86\u80fd\u591f\u66f4\u597d\u5730\u65b9\u4fbf\u60a8\u4f7f\u7528\u5bb9\u5668\u670d\u52a1\uff0c\u786e\u4fdd\u60a8\u4f7f\u7528\u7a33\u5b9a\u53c8\u53ef\u9760\u7684Kubernetes\u7248\u672c\uff0c\u4e91\u5bb9\u5668\u5f15\u64ceCCE\u63a8\u51faKubernetes\u7248\u672c\u652f\u6301\u673a\u5236\uff0c\u5c06\u5728\u6bcf\u534a\u5e74\u53d1\u5e03\u4e00\u4e2a\u7248\u672c\uff0c\u6bcf\u4e2a\u7248\u672c\u7684\u652f\u6301\u5468\u671f\u4e3a\u4e00\u5e74\uff0c\u8bf7\u60a8\u52a1\u5fc5\u5728\u7ef4\u62a4\u5468\u671f\u7ed3\u675f\u4e4b\u524d\u5347\u7ea7\u60a8\u7684Kubernetes\u96c6\u7fa4\u3002</p> <ul> <li>dev\u73af\u5883\uff0c\u96c6\u7fa4\u73af\u5883\u53ef\u4ee5\u5148\u8bbe\u7f6e\u4e3a50\u4e2a</li> </ul> <p>\u6b64\u4e3a\u6d4b\u8bd5\u73af\u5883\uff0c\u9009\u62e9\u96c6\u7fa4\u8f83\u5c0f\uff0c\u6b63\u5f0f\u73af\u5883\u53ef\u6839\u636e\u4e1a\u52a1\u6765\u8fdb\u884c\u8bbe\u7f6e</p> <ul> <li>\u9ad8\u53ef\u7528\uff1a</li> <li>\u9ad8\u53ef\u7528\u6a21\u5f0f\u5f00\u542f\u540e\u5c06\u521b\u5efa\u591a\u4e2a\u63a7\u5236\u8282\u70b9\uff0c\u5728\u5355\u4e2a\u63a7\u5236\u8282\u70b9\u53d1\u751f\u6545\u969c\u540e\u96c6\u7fa4\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\uff0c\u4e0d\u5f71\u54cd\u4e1a\u52a1\u529f\u80fd\u3002</li> <li>\u9ad8\u53ef\u7528\u6a21\u5f0f\u5f00\u5173\u5728\u96c6\u7fa4\u521b\u5efa\u5b8c\u6210\u540e\u4e0d\u53ef\u53d8\u66f4</li> <li>\u5546\u7528\u573a\u666f\u5efa\u8bae\u9009\u62e9\u9ad8\u53ef\u7528\u6a21\u5f0f\u96c6\u7fa4\u3002</li> <li>\u7f51\u7edc</li> </ul> <p>\u7f51\u7edc\u662f\u9009\u62e9\u521a\u57fa\u7840\u73af\u5883\u521b\u5efa\u7684VPC\uff0cK8s\u7684Node\u8282\u70b9\u7f51\u7edc\u5c31\u7528\u7684VPC\u5185\u7684\u5b50\u7f51\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u540c\u4e00\u4e2aVPC\u7684\u6240\u6709\u5b50\u7f51\u5185\u7684\u5f39\u6027\u4e91\u670d\u52a1\u5668\u5747\u53ef\u4ee5\u8fdb\u884c\u901a\u4fe1\uff0c\u4e0d\u540cVPC\u7684\u5f39\u6027\u4e91\u670d\u52a1\u5668\u4e0d\u80fd\u8fdb\u884c\u901a\u4fe1\u3002</p> <ul> <li>\u7f51\u7edc\u6a21\u578b</li> </ul> <p>\u5bb9\u5668\u96a7\u9053\u7f51\u7edc\u4e0b\u53ea\u80fd\u6dfb\u52a0\u540c\u4e00\u7c7b\u578b\u7684\u8282\u70b9\uff0c\u5373\u5168\u90e8\u4e3a\u865a\u62df\u673a\u8282\u70b9\u6216\u5168\u90e8\u4e3a\u88f8\u91d1\u5c5e\u8282\u70b9\u3002</p> <p>\u57fa\u4e8e\u5e95\u5c42VPC\u7f51\u7edc\uff0c\u53e6\u6784\u5efa\u4e86\u72ec\u7acb\u7684VXLAN\u96a7\u9053\u5316\u5bb9\u5668\u7f51\u7edc\uff0c\u9002\u7528\u4e8e\u4e00\u822c\u573a\u666f\u3002VXLAN\u662f\u5c06\u4ee5\u592a\u7f51\u62a5\u6587\u5c01\u88c5\u6210UDP\u62a5\u6587\u8fdb\u884c\u96a7\u9053\u4f20\u8f93\u3002\u5bb9\u5668\u7f51\u7edc\u662f\u627f\u8f7d\u4e8eVPC\u7f51\u7edc\u4e4b\u4e0a\u7684Overlay\u7f51\u7edc\u5e73\u9762\uff0c\u5177\u6709\u4ed8\u51fa\u5c11\u91cf\u96a7\u9053\u5c01\u88c5\u6027\u80fd\u635f\u8017\uff0c\u83b7\u5f97\u4e86\u901a\u7528\u6027\u5f3a\u3001\u4e92\u901a\u6027\u5f3a\u3001\u9ad8\u7ea7\u7279\u6027\u652f\u6301\u5168\u9762\uff08\u4f8b\u5982Network Policy\u7f51\u7edc\u9694\u79bb\uff09\u7684\u4f18\u52bf\uff0c\u53ef\u4ee5\u6ee1\u8db3\u5927\u591a\u6570\u5e94\u7528\u9700\u6c42\u3002</p> <ul> <li>RBAC</li> </ul> <p>\u5f00\u542fRBAC\u80fd\u529b\u540e\uff0c\u8bbe\u7f6e\u4e86\u7ec6\u7c92\u5ea6\u6743\u9650\u7684\u5b50\u7528\u6237\u4f7f\u7528\u96c6\u7fa4\u4e0b\u8d44\u6e90\u5c06\u53d7\u5230\u6743\u9650\u63a7\u5236\u3002</p> <p></p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#22-node","title":"2.2 Node\u4e91\u670d\u52a1\u5668\u9009\u62e9","text":"<ul> <li>\u5b89\u88c5\u63d2\u4ef6</li> </ul> <p>\u5728\u63d2\u4ef6\u7740\u680f\uff0c\u975e\u5e38\u5173\u6ce8volcano\u8fd9\u5757\u9ad8\u6027\u80fd\u8c03\u5ea6\u5668\uff0cVolcano\u662f\u57fa\u4e8eKubernetes\u7684\u6279\u5904\u7406\u7cfb\u7edf\uff0c\u6e90\u81ea\u4e8e\u534e\u4e3a\u4e91AI\u5bb9\u5668\uff0cVolcano\u65b9\u4fbfAI\u3001\u5927\u6570\u636e\u3001\u57fa\u56e0\u3001\u6e32\u67d3\u7b49\u8bf8\u591a\u884c\u4e1a\u901a\u7528\u8ba1\u7b97\u6846\u67b6\u63a5\u5165\uff0c\u63d0\u4f9b\u9ad8\u6027\u80fd\u4efb\u52a1\u8c03\u5ea6\u5f15\u64ce\uff0c\u9ad8\u6027\u80fd\u5f02\u6784\u82af\u7247\u7ba1\u7406\uff0c\u9ad8\u6027\u80fd\u4efb\u52a1\u8fd0\u884c\u7ba1\u7406\u7b49\u80fd\u529b\uff0c\u771f\u591a\u9ad8\u5e76\u53d1\u573a\u666f\u505a\u4e86\u6df1\u5165\u7684\u4f18\u5316\u548c\u6539\u8fdb\uff0c\u5185\u7f6e\u591a\u79cd\u7b97\u6cd5\uff0c\u63d0\u4f9b\u5927\u6570\u636e\uff0cAI\u7b49\u5e94\u7528\u573a\u666f\u89e3\u51b3\u65b9\u6848\u3002</p> <p></p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#23","title":"2.3 \u63d0\u4ea4\u8d2d\u4e70","text":"<p>\u63d0\u4ea4\u540e\u7b49\u5f85\u96c6\u7fa4\u90e8\u7f72\u5b8c\u6210\u3002</p> <p></p> <p></p> <p></p> <p>\u5982\u679c\u4e3a\u6211\u4eec\u81ea\u5df1\u90e8\u7f72\uff0c\u8003\u8651\u7684\u4e1c\u897f\u975e\u5e38\u591a\uff0c\u800c\u4e14\u53ef\u80fd\u90e8\u7f72\u5f02\u5e38\uff0c\u6392\u9519\u975e\u5e38\u9ebb\u70e6\uff0cCCE\u63d0\u4f9b\u7b80\u5355web\u754c\u9762\u914d\u7f6e\uff0c\u5c31\u53ef\u4ee5\u90e8\u7f72\u51fa\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684\u751f\u6210\u73af\u5883\uff0c\u975e\u5e38\u7684\u9ad8\u6548\u5feb\u6377\u3002</p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#_3","title":"\u56db \u8bbf\u95ee","text":"<p>\u7531\u4e8e\u76ee\u524d\u4e3a\u914d\u7f6e\u5f39\u6027\u516c\u52a1IP\uff0c\u4f7f\u7528web-terminal\u6765\u8bbf\u95ee\uff0c\u5176\u4e5f\u4e3a\u4e00\u4e2apod\uff0c\u5229\u7528\u8be5pod\u53ef\u4ee5\u901a\u8fc7\u6d4f\u89c8\u5668\u6253\u5f00web\u7ec8\u7aef\u8fde\u63a5\u5230\u96c6\u7fa4\u4e2d\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u8d2d\u4e70\u5f39\u6027IP</p> <p></p> <ul> <li>\u914d\u7f6e\u672c\u5730kubectl</li> </ul> <p>\u7531\u4e8e\u6211\u672c\u5730\u4e4b\u524d\u5df2\u7ecf\u5b89\u88c5\u8d35\u54e6kubectl\uff0c\u53ea\u9700\u8981\u4e0b\u8f7d\u521b\u5efa\u7684CCE\u6280\u5de7\u7684kubeconfig.json\u79fb\u52a8\u5230\u5bb6\u76ee\u5f55.kube\u4e0b\u9762\uff0c\u91cd\u547d\u540d\u4e3aconfig\u5373\u53ef\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u76ee\u524d\u5df2\u7ecf\u53ef\u4ee5\u6b63\u5e38\u83b7\u53d6\u5230\u4e24\u4e2anode\u8282\u70b9\u3002</p> <ul> <li>\u521b\u5efa\u5e94\u7528\u6d4b\u8bd5</li> </ul> <p></p> <p></p> <ul> <li>\u66b4\u9732\u670d\u52a1</li> </ul> <p>\u521b\u5efasvc</p> <p></p> <ul> <li>LB</li> </ul> <p></p> <p>a</p> <p>\u67e5\u770bservice</p> <p></p> <p>\u5728\u6b64\u5c31\u7b80\u5355\u6d4b\u8bd5\u4e86\u4ece\u96c6\u7fa4\u5f00\u901a\u5230\u5355\u4e2a\u5e94\u7528\u7684\u90e8\u7f72\u3002\u540e\u671f\u53ef\u4ee5\u5c06\u81ea\u5df1\u7684\u5e94\u7528\u8fc1\u79fb\u4e0a\u6765\uff0c\u7edf\u4e00\u7ba1\u7406\u3002</p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#_4","title":"\u4e94 \u53cd\u601d","text":"<p>\u540e\u671f\u6211\u4eec\u53ef\u4ee5\u5c06\u81ea\u5df1\u7684\u5bb9\u5668\u505a\u597d\u955c\u50cf\uff0c\u4e0a\u4f20\u5230SWR\u4e2d\uff0c\u901a\u8fc7Devcloud\u4e2d\u7684\u90e8\u7f72\uff0c\u7b80\u5355\u5feb\u6377\u7684\u4e00\u952e\u5f0f\u90e8\u7f72\u5e94\u7528\u81f3CCE\u4e2d\uff0c\u540c\u65f6\u53ef\u4ee5web\u754c\u9762\u914d\u7f6e\u8bbf\u95ee\uff0c\u975e\u5e38\u5feb\u6377\u65b9\u4fbf\uff0c\u534e\u4e3a\u4e91\u7ed3\u5408\u751f\u6210\u73af\u5883\u4e2d\u7ecf\u9a8c\uff0c\u5c06\u6700\u8fd1\u89e3\u51b3\u65b9\u6848\u4f5c\u4e3a\u670d\u52a1\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u5f00\u7bb1\u5373\u7528\u7684\u5e94\u7528\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u5176\u63d0\u4f9b\u591a\u79cd\u7f51\u7edc\u8bbf\u95ee\u6a21\u5f0f\uff0c\u652f\u6301\u56db\u5c42/\u4e03\u5c42\u8d1f\u8f7d\u5747\u8861\u4f7f\u7528\u4e0d\u540c\u573a\u666f\uff0c\u5b58\u50a8\u65b9\u4fbf\u9664\u4e86\u652f\u6301\u672c\u5730\u5b58\u50a8\uff0c\u63d0\u4f9b\u4e30\u5bcc\u7684\u5b58\u50a8\u7c7b\uff0c\u7075\u9b42\u7684\u4f38\u7f29\u7b56\u7565\uff0c\u53ef\u4ee5\u5e94\u5bf9\u4e1a\u52a1\u9ad8\u5cf0\u671f\u7684\u6d41\u91cf\u5e76\u53d1\uff0c\u6df1\u5ea6\u96c6\u6210K8s\u5de5\u5177\u751f\u6001\uff0c\u63d0\u4f9bHelm\u6807\u51c6\uff0c\u5c06\u81ea\u5df1\u7684\u5e94\u7528\u5236\u4f5c\u6210charts\uff0c\u8f7b\u677e\u53d1\u5e03\u8fdbK8s\u5185\uff0c\u540c\u65f6\u63d0\u4f9bIstio\u670d\u52a1\u6cbb\u7406\u80fd\u529b\uff0c\u57fa\u7840\u8bbe\u65bd\u4e0b\u6c89\u5230K8s\u5185\uff0c\u63d0\u4f9b\u6d41\u91cf\u63a7\u5236\uff0c\u9ed1\u767d\u540d\u5355\uff0c\u8ba4\u8bc1\u9274\u6743\u7b49\u529f\u80fd\uff0c\u8d1f\u8f7d\u5747\u8861/\u6d41\u91cf\u76d1\u63a7/\u94fe\u8def\u8ffd\u9010/\u7194\u65ad\u964d\u7ea7\u3002</p>"},{"location":"cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/#_5","title":"\u516d \u94fe\u63a5","text":"<ul> <li>https://www.huaweicloud.com/product/cce.html</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/","title":"\u5fae\u670d\u52a1API\u7f51\u5173-Kong","text":""},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#_1","title":"\u4e00 \u6982\u8ff0","text":"<p>Kong\u662f\u4e00\u4e2aclould-native\u3001\u5feb\u901f\u7684\u3001\u53ef\u6269\u5c55\u7684\u3001\u5206\u5e03\u5f0f\u7684\u5fae\u670d\u52a1\u62bd\u8c61\u5c42\uff08\u4e5f\u79f0\u4e3aAPI\u7f51\u5173\u3001API\u4e2d\u95f4\u4ef6\u6216\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u79f0\u4e3a\u670d\u52a1\u7f51\u683c\uff09\u6846\u67b6\u3002\u66f4\u786e\u5207\u5730\u8bf4\uff0cKong\u662f\u4e00\u4e2a\u5728Nginx\u4e2d\u8fd0\u884c\u7684Lua\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7lua-nginx\u6a21\u5757\u5b9e\u73b0\u3002Kong\u4e0d\u662f\u7528\u8fd9\u4e2a\u6a21\u5757\u7f16\u8bd1Nginx\uff0c\u800c\u662f\u4e0eOpenResty\u4e00\u8d77\u53d1\u5e03\uff0cOpenResty\u5df2\u7ecf\u5305\u542b\u4e86lua-nginx-module\u3002OpenResty \u4e0d\u662f Nginx\u7684\u5206\u652f\uff0c\u800c\u662f\u4e00\u7ec4\u6269\u5c55\u5176\u529f\u80fd\u7684\u6a21\u5757\u3002</p> <p>\u8fd9\u4e3a\u53ef\u63d2\u62d4\u67b6\u6784\u5960\u5b9a\u4e86\u57fa\u7840\uff0c\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u542f\u7528\u548c\u6267\u884cLua\u811a\u672c\uff08\u79f0\u4e3a*\u201c\u63d2\u4ef6\u201d\uff09\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u8ba4\u4e3aKong\u662f**\u5fae\u670d\u52a1\u67b6\u6784\u7684\u5178\u8303*\uff1a\u5b83\u7684\u6838\u5fc3\u662f\u5b9e\u73b0\u6570\u636e\u5e93\u62bd\u8c61\uff0c\u8def\u7531\u548c\u63d2\u4ef6\u7ba1\u7406\u3002\u63d2\u4ef6\u53ef\u4ee5\u5b58\u5728\u4e8e\u5355\u72ec\u7684\u4ee3\u7801\u5e93\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u51e0\u884c\u4ee3\u7801\u4e2d\u6ce8\u5165\u5230\u8bf7\u6c42\u751f\u547d\u5468\u671f\u7684\u4efb\u4f55\u4f4d\u7f6e\u3002Kong\u4f5c\u4e3a\u5f00\u6e90\u9879\u76ee\u57282015\u5e74\u63a8\u51fa\uff0c\u5b83\u7684\u6838\u5fc3\u4ef7\u503c\u662f\u9ad8\u6027\u80fd\u548c\u53ef\u6269\u5c55\u6027\u3002</p> <p>Kong\u88ab\u5e7f\u6cdb\u7528\u4e8e\u4ece\u521d\u521b\u4f01\u4e1a\u5230\u5168\u74035000\u5bb6\u516c\u53f8\u4ee5\u53ca\u653f\u5e9c\u7ec4\u7ec7\u7684\u751f\u4ea7\u73af\u5883\u4e2d\u3002</p> <p>\u5982\u679c\u6784\u5efaWeb\u3001\u79fb\u52a8\u6216IoT\uff08\u7269\u8054\u7f51\uff09\u5e94\u7528\uff0c\u53ef\u80fd\u6700\u7ec8\u9700\u8981\u4f7f\u7528\u901a\u7528\u7684\u529f\u80fd\u6765\u5b9e\u73b0\u8fd9\u4e9b\u5e94\u7528\u3002Kong\u5145\u5f53\u5fae\u670d\u52a1\u8bf7\u6c42\u7684\u7f51\u5173\uff08\u6216\u4fa7\u8f66\uff09\uff0c\u901a\u8fc7\u63d2\u4ef6\u80fd\u591f\u63d0\u4f9b**\u8d1f\u8f7d\u5e73\u8861**\u3001**\u65e5\u5fd7\u8bb0\u5f55\u3001\u8eab\u4efd\u9a8c\u8bc1\u3001\u901f\u7387\u9650\u5236\u3001\u8f6c\u6362**\u7b49\u80fd\u529b\u3002</p> <p>\u4e00\u4e2aservice\u53ef\u4ee5\u521b\u5efa\u591a\u4e2aroutes\uff0croutes\u5c31\u76f8\u5f53\u4e8e\u524d\u7aef\u914d\u7f6e\uff0c\u53ef\u4ee5\u9690\u85cf\u4e1a\u52a1\u771f\u6b63\u7684\u63a5\u53e3\u5730\u5740\uff0cservice\u6307\u5b9a\u540e\u7aef\u771f\u5b9e\u7684\u8f6c\u53d1\u63a5\u53e3\u5730\u5740\uff0c\u5728kong\u4e0a\u8fdb\u884c\u8ba4\u8bc1/\u9274\u6743/\u65e5\u5fd7/\u5206\u6790/\u76d1\u63a7\u7b49\u63a7\u5236\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#_2","title":"\u4e8c \u7279\u6027","text":"<ul> <li>\u4e91\u539f\u751f(Cloud-Native)\uff1aKong\u53ef\u4ee5\u5728Kubernetes\u6216\u7269\u7406\u73af\u5883\u4e0a\u8fd0\u884c\uff1b</li> <li>\u52a8\u6001**\u8d1f\u8f7d\u5e73\u8861**(Dynamic Load Balancing)\uff1a\u8de8\u591a\u4e2a\u4e0a\u6e38\u670d\u52a1\u7684\u8d1f\u8f7d\u5e73\u8861\u4e1a\u52a1\u3002</li> <li>\u57fa\u4e8e\u54c8\u5e0c\u7684\u8d1f\u8f7d\u5e73\u8861(Hash-based Load Balancing)\uff1a\u4e00\u81f4\u7684\u6563\u5217/\u7c98\u6027\u4f1a\u8bdd\u7684\u8d1f\u8f7d\u5e73\u8861\u3002</li> <li>\u65ad\u8def\u5668(Circuit-Breaker)\uff1a\u667a\u80fd\u8ddf\u8e2a\u4e0d\u5065\u5eb7\u7684\u4e0a\u6e38\u670d\u52a1\u3002</li> <li>\u5065\u5eb7\u68c0\u67e5(Health Checks)\uff1a\u4e3b\u52a8\u548c\u88ab\u52a8\u76d1\u63a7\u60a8\u7684\u4e0a\u6e38\u670d\u52a1\u3002</li> <li>\u670d\u52a1\u53d1\u73b0(Service Discovery)\uff1a\u89e3\u51b3\u5982Consul\u7b49\u7b2c\u4e09\u65b9DNS\u89e3\u6790\u5668\u7684SRV\u8bb0\u5f55\u3002</li> <li>\u65e0\u670d\u52a1\u5668(Serverless)\uff1a\u4eceKong\u4e2d\u76f4\u63a5\u8c03\u7528\u548c\u4fdd\u8bc1AWS\u6216OpenWhisk\u51fd\u6570\u5b89\u5168\u3002</li> <li>WebSockets\uff1a\u901a\u8fc7**WebSockets**\u4e0e\u4e0a\u6e38\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\u3002</li> <li>OAuth2.0\uff1a\u8f7b\u677e\u7684\u5411API\u4e2d\u6dfb\u52a0OAuth2.0\u8ba4\u8bc1\u3002</li> <li>\u65e5\u5fd7\u8bb0\u5f55(Logging)\uff1a\u901a\u8fc7HTTP\u3001TCP\u3001UDP\u8bb0\u5f55\u8bf7\u6c42\u6216\u8005\u76f8\u5e94\u7684\u65e5\u5fd7\uff0c\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u3002</li> <li>\u5b89\u5168(Security)\uff1aACL\uff0cBot\u68c0\u6d4b\uff0cIPs\u767d\u540d\u5355/\u9ed1\u540d\u5355\u7b49\u3002</li> <li>\u7cfb\u7edf\u65e5\u5fd7(Syslog)\uff1a\u8bb0\u5f55\u4fe1\u606f\u5230\u7cfb\u7edf\u65e5\u5fd7\u3002</li> <li>SSL\uff1a\u4e3a\u57fa\u7840\u670d\u52a1\u6216API\u8bbe\u7f6e\u7279\u5b9a\u7684SSL\u8bc1\u4e66\u3002</li> <li>\u76d1\u89c6(Monitoring)\uff1a\u80fd\u591f\u5b9e\u65f6\u5bf9\u5173\u952e\u8d1f\u8f7d\u548c\u6027\u80fd\u6307\u6807\u8fdb\u884c\u76d1\u63a7\u3002</li> <li>\u8f6c\u53d1\u4ee3\u7406(Forward Proxy)\uff1a\u4f7f\u7aef\u53e3\u8fde\u63a5\u5230\u4e2d\u95f4\u900f\u660e\u7684HTTP\u4ee3\u7406\u3002</li> <li>\u8ba4\u8bc1(Authentications)\uff1a\u652f\u6301HMAC\uff0cJWT\u548cBASIC\u65b9\u5f0f\u8fdb\u884c\u8ba4\u8bc1\u7b49\u7b49\u3002</li> <li>\u901f\u7387\u9650\u5236(Rate-limiting)\uff1a\u57fa\u4e8e\u591a\u4e2a\u53d8\u91cf\u7684\u963b\u585e\u548c\u8282\u6d41\u8bf7\u6c42\u3002</li> <li>\u8f6c\u6362(Transformations)\uff1a\u6dfb\u52a0\u3001\u5220\u9664\u6216\u64cd\u4f5cHTTP\u8bf7\u6c42\u548c\u54cd\u5e94\u3002</li> <li>\u7f13\u5b58(Caching)\uff1a\u5728\u4ee3\u7406\u5c42\u8fdb\u884c\u7f13\u5b58\u548c\u670d\u52a1\u54cd\u5e94\u3002</li> <li>\u547d\u4ee4\u884c\u5de5\u5177(CLI)\uff1a\u80fd\u591f\u901a\u8fc7\u547d\u4ee4\u884c\u63a7\u5236Kong\u7684\u96c6\u7fa4\u3002</li> <li>REST API\uff1a\u53ef\u4ee5\u901a\u8fc7REST API\u7075\u6d3b\u7684\u64cd\u4f5cKong\u3002</li> <li>GEO\u590d\u5236\uff1a\u5728\u4e0d\u540c\u7684\u533a\u57df\uff0c\u914d\u7f6e\u603b\u662f\u6700\u65b0\u7684\u3002</li> <li>\u6545\u969c\u68c0\u6d4b\u4e0e\u6062**\u590d(**Failure Detection &amp; Recovery)\uff1a\u5982\u679cCassandra\u8282\u70b9\u5931\u6548\uff0cKong\u5e76\u4e0d\u4f1a\u53d7\u5f71\u54cd\u3002</li> <li>\u7fa4\u96c6(Clustering)\uff1a\u6240\u6709\u7684Kong\u8282\u70b9\u4f1a\u81ea\u52a8\u52a0\u5165\u7fa4\u96c6\uff0c\u5e76\u66f4\u65b0\u5404\u4e2a\u8282\u70b9\u4e0a\u7684\u914d\u7f6e\u3002</li> <li>\u53ef\u6269\u5c55\u6027(Scalability)\uff1a\u901a\u8fc7\u6dfb\u52a0\u8282\u70b9\uff0c\u5b9e\u73b0\u6c34\u5e73\u7f29\u653e\u3002</li> <li>\u6027\u80fd(Performance)\uff1a\u901a\u8fc7\u7f29\u653e\u548c\u4f7f\u7528Nigix\uff0cKong\u80fd\u591f\u8f7b\u677e\u5904\u7406\u8d1f\u8f7d\u3002</li> <li>\u63d2\u4ef6(Plugins)\uff1a\u57fa\u4e8e\u63d2\u4ef6\u7684\u53ef\u6269\u5c55\u4f53\u7cfb\u7ed3\u6784\uff0c\u80fd\u591f\u65b9\u4fbf\u7684\u5411Kong\u548cAPI\u6dfb\u52a0\u529f\u80fd\u3002</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#_3","title":"\u4e09 \u4f9d\u8d56\u7ec4\u4ef6","text":"<p>Kong\u90e8\u7f72\u5728Nginx\u548cApache Cassandra\u6216PostgreSQL\u7b49\u53ef\u9760\u6280\u672f\u4e4b\u4e0a\uff0c\u5e76\u63d0\u4f9b\u4e86\u6613\u4e8e\u4f7f\u7528\u7684RESTful API\u6765\u64cd\u4f5c\u548c\u914d\u7f6e\u7cfb\u7edf\u3002\u4e0b\u9762\u662fKong\u7684\u6280\u672f\u903b\u8f91\u56fe\u3002\u57fa\u4e8e\u8fd9\u4e9b\u6280\u672f\uff0cKong\u63d0\u4f9b\u76f8\u5173\u7684\u7279\u6027\u652f\u6301\uff1a</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#31-nginx","title":"3.1 Nginx","text":"<ul> <li>\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u9ad8\u6027\u80fd\u57fa\u7840\uff1b</li> <li>HTTP\u548c\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff1b</li> <li>\u5904\u7406\u4f4e\u5c42\u7ea7\u7684\u64cd\u4f5c\u3002</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#32-openrestry","title":"3.2 OpenRestry","text":"<ul> <li>\u652f\u6301Lua\u811a\u672c\uff1b</li> <li>\u62e6\u622a\u8bf7\u6c42/\u54cd\u5e94\u751f\u547d\u5468\u671f\uff1b</li> <li>\u57fa\u4e8eNginx\u8fdb\u884c\u6269\u5c55\u3002</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#33-clusteringdatastore","title":"3.3 Clustering&amp;Datastore","text":"<ul> <li>\u652f\u6301Cassandra\u6216PostgreSQL\u6570\u636e\u5e93\uff1b</li> <li>\u5185\u5b58\u7ea7\u7684\u7f13\u5b58\uff1b</li> <li>\u652f\u6301\u6c34\u5e73\u6269\u5c55\u3002</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#34-plugins","title":"3.4 Plugins","text":"<ul> <li>\u4f7f\u7528Lua\u521b\u5efa\u63d2\u4ef6\uff1b</li> <li>\u529f\u80fd\u5f3a\u5927\u7684\u5b9a\u5236\u80fd\u529b\uff1b</li> <li>\u4e0e\u7b2c\u4e09\u65b9\u670d\u52a1\u5b9e\u73b0\u96c6\u6210\u3002</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#35-restful-administration-api","title":"3.5 Restful Administration API","text":"<ul> <li>\u901a\u8fc7Restful API\u7ba1\u7406Kong\uff1b</li> <li>\u652f\u6301CI/CD&amp;DevOps\uff1b</li> <li>\u57fa\u4e8e\u63d2\u4ef6\u7684\u53ef\u6269\u5c55\u3002</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#_4","title":"\u56db \u67b6\u6784\u56fe","text":""},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#_5","title":"\u4e94 \u90e8\u7f72","text":""},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#51","title":"5.1 \u7269\u7406\u670d\u52a1\u5668\u90e8\u7f72","text":""},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#511-yum","title":"5.1.1 \u914d\u7f6eyum\u6e90","text":"<pre><code>sudo yum update -y\nsudo yum install -y wget\nwget https://bintray.com/kong/kong-rpm/rpm -O bintray-kong-kong-rpm.repo\nexport major_version=`grep -oE '[0-9]+\\.[0-9]+' /etc/redhat-release | cut -d \".\" -f1`\nsed -i -e 's/baseurl.*/&amp;\\/centos\\/'$major_version''/ bintray-kong-kong-rpm.repo\nsudo mv bintray-kong-kong-rpm.repo /etc/yum.repos.d/\nsudo yum update -y\nsudo yum install -y kong\n</code></pre>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#512","title":"5.1.2 \u6570\u636e\u5e93\u5b89\u88c5","text":"<p>Kong\u652f\u6301PostgreSQL v9.5+\u548cCassandra 3.x.x\u4f5c\u4e3a\u6570\u636e\u5b58\u50a8\u3002</p> <p>\u6b64\u5904\u6211\u6309\u7167\u6587\u6863\u5b89\u88c5PostgreSQL v11: https://www.postgresql.org/download/linux/redhat/</p> <pre><code># \u5b89\u88c5PostgreSQL v11\nyum install -y https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-7-x86_64/pgdg-centos11-11-2.noarch.rpm\n\nyum install -y postgresql11 postgresql11-server\n\n# \u81ea\u542f\n/usr/pgsql-11/bin/postgresql-11-setup initdb\nsystemctl enable postgresql-11\nsystemctl start postgresql-11\n</code></pre> <pre><code># \u767b\u5f55psql\nsudo su postgres\npsql\n\n# \u521b\u5efa\u6570\u636e\u5e93\uff0c\u5b98\u65b9\u9ed8\u8ba4\u65e0\u5bc6\u7801\uff0c\u6b64\u5904\u6211\u4f7f\u7528\u5bc6\u7801\n# CREATE USER kong; CREATE DATABASE kong OWNER kong;\nCREATE USER kong with password 'kong';\nCREATE DATABASE kong OWNER kong; \ngrant all privileges on database kong to kong;\n\n\n# \u8fd9\u91cc\u53ef\u80fd\u4f1a\u62a5\u8fde\u63a5\u9519\u8bef\n# psql: \u81f4\u547d\u9519\u8bef:  \u5bf9\u7528\u6237\"kong\"\u7684\u5bf9\u7b49\u8ba4\u8bc1\u5931\u8d25\nsudo find / -name pg_hba.conf\n/var/lib/pgsql/11/data/pg_hba.conf\n\n# \u4fee\u6539\u5b89\u5168\u914d\u7f6e\nvim /var/lib/pgsql/11/data/pg_hba.conf\n\n# METHOD\u6307\u5b9a\u5982\u4f55\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8ba4\u8bc1\u3002\u5e38\u7528\u7684\u6709ident\uff0cmd5\uff0cpassword\uff0ctrust\uff0creject\n# ident\u662fLinux\u4e0bPostgreSQL\u9ed8\u8ba4\u7684local\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u51e1\u662f\u80fd\u6b63\u786e\u767b\u5f55\u670d\u52a1\u5668\u7684\u64cd\u4f5c\u7cfb\u7edf\u7528\u6237\uff08\u6ce8\uff1a\u4e0d\u662f\u6570\u636e\u5e93\u7528\u6237\uff09\u5c31\u80fd\u4f7f\u7528\u672c\u7528\u6237\u6620\u5c04\u7684\u6570\u636e\u5e93\u7528\u6237\u4e0d\u9700\u5bc6\u7801\u767b\u5f55\u6570\u636e\u5e93\u3002\n# md5\u662f\u5e38\u7528\u7684\u5bc6\u7801\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u5982\u679c\u4f60\u4e0d\u4f7f\u7528ident\uff0c\u6700\u597d\u4f7f\u7528md5\u3002\u5bc6\u7801\u662f\u4ee5md5\u5f62\u5f0f\u4f20\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u8f83\u5b89\u5168\uff0c\u4e14\u4e0d\u9700\u5efa\u7acb\u540c\u540d\u7684\u64cd\u4f5c\u7cfb\u7edf\u7528\u6237\u3002\n# password\u662f\u4ee5\u660e\u6587\u5bc6\u7801\u4f20\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u5efa\u8bae\u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u3002\n# trust\u662f\u53ea\u8981\u77e5\u9053\u6570\u636e\u5e93\u7528\u6237\u540d\u5c31\u4e0d\u9700\u8981\u5bc6\u7801\u6216ident\u5c31\u80fd\u767b\u5f55\uff0c\u5efa\u8bae\u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u3002\n# reject\u662f\u62d2\u7edd\u8ba4\u8bc1\u3002\n\n# \"local\" is for Unix domain socket connections only\nlocal   all             all                                     md5\n# IPv4 local connections:\nhost    all             all             127.0.0.1/32            md5\n# IPv6 local connections:\nhost    all             all             ::1/128                 md5\n\n# \u5c06peer\u6539\u4e3amd5\uff08\uff09\n# \"local\" is for Unix domain socket connections only\nlocal   all             all                                     md5\n# IPv4 local connections:\nhost    all             all             127.0.0.1/32            ident\n# IPv6 local connections:\nhost    all             all             ::1/128                 ident\n\n\n# \u91cd\u542fpsql\nsystemctl restart postgresql-11\n\n\n# \u767b\u5f55postgre\npsql -U kong\n# \u8f93\u5165\u5bc6\u7801\n\n\n# \u67e5\u770b\u5e2e\u52a9\n\\h\n\n# \u9000\u51fa\n\\q\n</code></pre> <pre><code># \u8fd9\u91cc\u9700\u8981\u63d0\u524d\u914d\u7f6ekong\u914d\u7f6e\u6587\u4ef6\uff0c\u9ed8\u8ba4/etc/kong/kong.conf.default\ncp /etc/kong/kong.conf.default /etc/kong/kong.conf\n\n# \u4fee\u6539\u91cc\u9762\u7684\u6570\u636e\u5e93\u914d\u7f6e\uff0c\u5199\u5165\u7528\u6237\u3001\u5bc6\u7801\u3001\u6570\u636e\u5e93\u3001\u7aef\u53e3\u7b49\u4fe1\u606f\nvim /etc/kong/kong.conf\n\n[root@kong-server software]# egrep -v \"^#|^$|^[[:space:]]+#\" /etc/kong/kong.conf\ndatabase = postgres             # Determines which of PostgreSQL or Cassandra\npg_host = 127.0.0.1             # Host of the Postgres server.\npg_port = 5432                  # Port of the Postgres server.\npg_timeout = 5000               # Defines the timeout (in ms), for connecting,\npg_user = kong                  # Postgres user.\npg_password = kong                # Postgres user's password.\npg_database = kong              # The database name to connect to.  \n\n# Kong migrations\nkong migrations bootstrap [-c /path/to/kong.conf]\n\n[root@kong-server software]# kong migrations bootstrap -c /etc/kong/kong.conf\nBootstrapping database...\nmigrating core on database 'kong'...\ncore migrated up to: 000_base (executed)\ncore migrated up to: 001_14_to_15 (executed)\ncore migrated up to: 002_15_to_1 (executed)\ncore migrated up to: 003_100_to_110 (executed)\ncore migrated up to: 004_110_to_120 (executed)\ncore migrated up to: 005_120_to_130 (executed)\nmigrating hmac-auth on database 'kong'...\nhmac-auth migrated up to: 000_base_hmac_auth (executed)\nhmac-auth migrated up to: 001_14_to_15 (executed)\nmigrating oauth2 on database 'kong'...\noauth2 migrated up to: 000_base_oauth2 (executed)\noauth2 migrated up to: 001_14_to_15 (executed)\noauth2 migrated up to: 002_15_to_10 (executed)\nmigrating jwt on database 'kong'...\njwt migrated up to: 000_base_jwt (executed)\njwt migrated up to: 001_14_to_15 (executed)\nmigrating basic-auth on database 'kong'...\nbasic-auth migrated up to: 000_base_basic_auth (executed)\nbasic-auth migrated up to: 001_14_to_15 (executed)\nmigrating key-auth on database 'kong'...\nkey-auth migrated up to: 000_base_key_auth (executed)\nkey-auth migrated up to: 001_14_to_15 (executed)\nmigrating rate-limiting on database 'kong'...\nrate-limiting migrated up to: 000_base_rate_limiting (executed)\nrate-limiting migrated up to: 001_14_to_15 (executed)\nrate-limiting migrated up to: 002_15_to_10 (executed)\nrate-limiting migrated up to: 003_10_to_112 (executed)\nmigrating acl on database 'kong'...\nacl migrated up to: 000_base_acl (executed)\nacl migrated up to: 001_14_to_15 (executed)\nmigrating response-ratelimiting on database 'kong'...\nresponse-ratelimiting migrated up to: 000_base_response_rate_limiting (executed)\nresponse-ratelimiting migrated up to: 001_14_to_15 (executed)\nresponse-ratelimiting migrated up to: 002_15_to_10 (executed)\nmigrating session on database 'kong'...\nsession migrated up to: 000_base_session (executed)\n27 migrations processed\n27 executed\nDatabase is up-to-date\n</code></pre>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#512-kong","title":"5.1.2 \u542f\u52a8kong","text":"<p>\u5728\u65e0\u6570\u636e\u5e93\u6a21\u5f0f\u914d\u7f6eKong,\u4e00\u65e6Kong\u542f\u52a8\uff0c\u8bbf\u95eeAdmin API\u7684<code>/</code>\u6839\u7aef\u70b9\u5df2\u9a8c\u8bc1\u5b83\u662f\u5426\u5728\u6ca1\u6709\u6570\u636e\u5e93\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c\u3002</p> <pre><code># Setting Up Kong in DB-less mode\n\n\u8981\u5728\u65e0\u6570\u636e\u5e93\u6a21\u5f0f\u4e0b\u4f7f\u7528Kong\uff0c\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a\n\n\u4fee\u6539\u914d\u7f6e\u6587\u4ef6kong.conf\n\nvim /etc/kong/kong.conf\n\n# database = postgres\ndatabase=off\n\n\n# \u6216\nexport KONG_DATABASE=off\n\n\n# \u68c0\u67e5\u914d\u7f6e\uff0c\u6b64\u547d\u4ee4\u5c06\u8003\u8651\u60a8\u5f53\u524d\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf\uff0c\u5e76\u5728\u8bbe\u7f6e\u65e0\u6548\u65f6\u62a5\u9519\u3002\u6b64\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u5728\u8c03\u8bd5\u6a21\u5f0f\u4e0b\u4f7f\u7528CLI\uff0c\u4ee5\u4fbf\u66f4\u6df1\u5165\u5730\u4e86\u89e3Kong\u7684\u542f\u52a8\u5c5e\u6027\nkong start -c &lt;kong.conf&gt; --vv\n\n\n# \u542f\u52a8kong\nkong start -c /etc/kong/kong.conf\n</code></pre> <pre><code>kong start [-c /path/to/kong.conf]\n\n[root@kong-server software]# kong start -c /etc/kong/kong.conf\nKong started\n[root@kong-server software]# kong  health\nnginx.......running\n\nKong is healthy at /usr/local/kong\n\n[root@kong-server software]# netstat -lntup\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 127.0.0.1:8444          0.0.0.0:*               LISTEN      31050/nginx: master\ntcp        0      0 0.0.0.0:8000            0.0.0.0:*               LISTEN      31050/nginx: master\ntcp        0      0 127.0.0.1:8001          0.0.0.0:*               LISTEN      31050/nginx: master\ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1453/sshd\ntcp        0      0 127.0.0.1:5432          0.0.0.0:*               LISTEN      30638/postmaster\ntcp        0      0 0.0.0.0:8443            0.0.0.0:*               LISTEN      31050/nginx: master\ntcp6       0      0 ::1:5432                :::*                    LISTEN      30638/postmaster\nudp        0      0 0.0.0.0:68              0.0.0.0:*                           780/dhclient\nudp        0      0 172.16.16.16:123        0.0.0.0:*                           3006/ntpd\nudp        0      0 127.0.0.1:123           0.0.0.0:*                           3006/ntpd\nudp6       0      0 fe80::5054:ff:fe94::123 :::*                                3006/ntpd\nudp6       0      0 ::1:123                 :::*                                3006/ntpd\n[root@kong-server software]# curl http://localhost:8001\n\n\n\u505c\u6b62:\nkong stop\n\u91cd\u65b0\u52a0\u8f7d\uff1a\nkong reload\n</code></pre>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#513-konga","title":"5.1.3 \u5b89\u88c5konga","text":"<p>konga\u4e3a\u76ee\u524d\u6700\u5148\u7248\u672c\u7684kong\u7684dashboard\uff0c\u7531\u4e8ekong-dashboard\u76ee\u524d\u4e3a\u66f4\u65b0\u9002\u5e94\u65b0\u7248\u672c\u7684kong\uff0c\u63a8\u8350\u4f7f\u7528konga</p> <p>konga\u5e26\u6765\u7684\u4e00\u4e2a\u6700\u5927\u7684\u4fbf\u5229\u5c31\u662f\u53ef\u4ee5\u5f88\u597d\u5730\u901a\u8fc7UI\u89c2\u5bdf\u5230\u73b0\u5728kong\u7684\u6240\u6709\u7684\u914d\u7f6e\uff0c\u5e76\u4e14\u53ef\u4ee5\u5bf9\u4e8e\u7ba1\u7406kong\u8282\u70b9\u60c5\u51b5\u8fdb\u884c\u67e5\u770b\u3001\u76d1\u63a7\u548c\u9884\u8b66\uff0ckonga\u4e3b\u8981\u7279\u6027\u5982\u4e0b\uff1a</p> <ul> <li>\u591a\u7528\u6237\u7ba1\u7406</li> <li>\u7ba1\u7406\u591a\u4e2aKong\u8282\u70b9</li> <li>\u7535\u5b50\u90ae\u4ef6\u5f02\u5e38\u4fe1\u606f\u901a\u77e5</li> <li>\u7ba1\u7406\u6240\u6709Kong Admin API</li> <li>\u4f7f\u7528\u5feb\u7167\u5907\u4efd\uff0c\u8fd8\u539f\u548c\u8fc1\u79fbKong\u8282\u70b9</li> <li>\u4f7f\u7528\u8fd0\u884c\u72b6\u51b5\u68c0\u67e5\u76d1\u63a7\u8282\u70b9\u548cAPI\u72b6\u6001</li> <li> <p>\u8f7b\u677e\u7684\u6570\u636e\u5e93\u96c6\u6210\uff08MySQL\uff0cpostgresSQL\uff0cMongoDB\uff09</p> </li> <li> <p>node\u5b89\u88c5</p> </li> </ul> <pre><code>yum -y install git\ncd /data/software &amp;&amp; wget https://npm.taobao.org/mirrors/node/v10.16.2/node-v10.16.2-linux-x64.tar.xz\ntar -xf node-v10.16.2-linux-x64.tar.xz \nmv node-v10.16.2-linux-x64 node\n# \u4fee\u6539\u4e3aroot\u7684\u6743\u9650\nchown root.root node -R\ncat &gt; /etc/profile.d/node.sh &lt;&lt; EOF\nexport PATH=\\$PATH:/data/software/node/bin\nEOF\nsource /etc/profile.d/node.sh\n\nnode -v\n\n\n# \u5b89\u88c5\u63d2\u4ef6\nnpm install -g glup\nnpm install -g bower\nnpm install -g sails\nnpm install -g node-gyp\nnpm install -g grunt-sass\nnpm install -g node-sass\nnpm run bower-deps\nnpm install sails-postgresql\n</code></pre> <ul> <li>\u5b89\u88c5konga</li> </ul> <pre><code>git clone https://github.com/pantsel/konga.git\ncd konga\nnpm install konga\n\n#\u4f7f\u7528postgresql\n\nCREATE USER konga with password 'konga';\nCREATE DATABASE konga OWNER konga; \ngrant all privileges on database konga to konga;\n</code></pre> <ul> <li>\u914d\u7f6e</li> </ul> <pre><code>cp config/local_example.js config/local.js\n\n# \u914d\u7f6e\u9ed8\u8ba4\u6570\u636e\u5e93\nvi ./local.js\nmodels: {\n    connection: process.env.DB_ADAPTER || 'localDiskDb',\n},\n# \u6539\u6210\nmodels: {\n    connection: process.env.DB_ADAPTER || 'postgres', // \u8fd9\u91cc\u53ef\u4ee5\u7528\u2018mysql\u2019\uff0c\u2018mongo\u2019\uff0c\u2018sqlserver\u2019\uff0c\u2018postgres\u2019\n},\n# \u4fdd\u5b58\n\n# \u4fee\u6539\u6570\u636e\u5e93\u9ed8\u8ba4\u914d\u7f6e\nvi connections.js\n  postgres: {\n    adapter: 'sails-postgresql',\n    url: process.env.DB_URI,\n    host: process.env.DB_HOST || 'localhost',\n    user:  process.env.DB_USER || 'konga',\n    password: process.env.DB_PASSWORD || 'konga',\n    port: process.env.DB_PORT || 5432,\n    database: process.env.DB_DATABASE ||'konga',\n    // schema: process.env.DB_PG_SCHEMA ||'public',\n    poolSize: process.env.DB_POOLSIZE || 10,\n    ssl: process.env.DB_SSL ? true : false // If set, assume it's true\n  },\n# \u4fdd\u5b58\n\n# \u542f\u52a8\ncd ../\nnpm start\n\n\n# pm2 \u7ba1\u7406\nnpm install -g pm2 \ncd konga\npm2 start app.js --name konga\n\n\npm2 logs\n\n0|konga    | info:    Sails              &lt;|    .-..-.\n0|konga    | info:    v0.12.14            |\\\n0|konga    | info:                       /|.\\\n0|konga    | info:                      / || \\\n0|konga    | info:                    ,'  |'  \\\n0|konga    | info:                 .-'.-==|/_--'\n0|konga    | info:                 `--'-------'\n0|konga    | info:    __---___--___---___--___---___--___\n0|konga    | info:  ____---___--___---___--___---___--___-__\n0|konga    | info:\n0|konga    | info: Server lifted in `/data/software/konga`\n0|konga    | info: To see your app, visit http://localhost:1338\n0|konga    | info: To shut down Sails, press &lt;CTRL&gt; + C at any time.\n0|konga    |\n0|konga    |\n</code></pre> <ul> <li>\u8bbf\u95ee</li> </ul> <p>IP:1338,\u9ed8\u8ba4\u7528\u6237\uff1aadmin\uff0c\u5bc6\u7801\uff1aadminadminadmin</p> <p>\u914d\u7f6e\u94fe\u63a5kong, http://localhost:8001</p> <p></p> <p></p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#52-docker","title":"5.2 docker\u4e2d\u8fd0\u884c","text":""},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#521-docker","title":"5.2.1 Docker\u4e2d\u90e8\u7f72","text":"<pre><code>1.\u60a8\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7f51\u7edc\uff0c\u4ee5\u5141\u8bb8\u5bb9\u5668\u76f8\u4e92\u53d1\u73b0\u548c\u901a\u4fe1\u3002\u5728\u6b64\u793a\u4f8b\u4e2dkong-net\u662f\u7f51\u7edc\u540d\u79f0\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u540d\u79f0\u3002\n\ndocker network create kong-net\n\n2.\u542f\u52a8\u6570\u636e\u5e93PostgreSQL\ndocker run -d --name kong-database --network=kong-net -p 5432:5432 -e \"POSTGRES_USER=kong\" -e \"POSTGRES_DB=kong\" -e \"POSTGRES_PASSWORD=kong\" postgres\n3.\u51c6\u5907\u6570\u636e\u5e93\ndocker run --rm --network=kong-net -e \"KONG_DATABASE=postgres\" -e \"KONG_PG_HOST=kong-database\" -e \"KONG_CASSANDRA_CONTACT_POINTS=kong-database\" -e \"KONG_PG_PASSWORD=kong\" kong kong migrations bootstrap\n4.\u542f\u52a8kong\ndocker run -d --name kong --network=kong-net -e \"KONG_DATABASE=postgres\" -e \"KONG_PG_HOST=kong-database\" -e \"KONG_PG_PASSWORD=kong\" -e \"KONG_CASSANDRA_CONTACT_POINTS=kong-database\" -e \"KONG_PROXY_ACCESS_LOG=/dev/stdout\" -e \"KONG_ADMIN_ACCESS_LOG=/dev/stdout\" -e \"KONG_PROXY_ERROR_LOG=/dev/stderr\" -e \"KONG_ADMIN_ERROR_LOG=/dev/stderr\" -e \"KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl\" -p 8000:8000 -p 8443:8443 -p 8001:8001 -p 8444:8444 kong\n5.\u8fd0\u884ckonga\n\u6ce8\u610fDB_HOST\u4e3a\u81ea\u5df1\u7684ip\u5730\u5740\ndocker run -d -p 1337:1337 --network kong-net -e \"TOKEN_SECRET=mark666\" -e \"DB_ADAPTER=postgres\" -e \"DB_HOST=10.234.2.204\" -e \"DB_PORT=5432:5432\" -e \"DB_USER=kong\" -e \"DB_PASSWORD=kong\" -e \"DB_DATABASE=kong_database\" --name konga pantsel/konga\n</code></pre>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#522-docker-compose","title":"5.2.2 docker-compose\u90e8\u7f72","text":"<ul> <li>\u521b\u5efa\u865a\u62df\u7f51\u7edc</li> </ul> <pre><code>docker network create kong-net\n</code></pre> <p>\u540e\u7eed\u7684\u5e94\u7528\u53ca\u6570\u636e\u5e93\u90fd\u4f7f\u7528\u8fd9\u4e2a\u865a\u62df\u7f51\u7edc\u3002</p> <ul> <li>\u7f16\u5199docker-compose.yaml</li> </ul> <pre><code>version: \"3.7\"\nservices: \n  kong:\n    # \u955c\u50cf\u7248\u672c\uff0c\u76ee\u524d\u6700\u65b0\n    image: kong:1.1.2\n    environment:\n    # \u6570\u636e\u6301\u4e45\u5316\u65b9\u5f0f\uff0c\u4f7f\u7528postgres\u6570\u636e\u5e93\n     - \"KONG_DATABASE=postgres\"\n    # \u6570\u636e\u5e93\u5bb9\u5668\u540d\u79f0,Kong\u8fde\u63a5\u6570\u636e\u65f6\u4f7f\u7528\u4e9b\u540d\u79f0\n     - \"KONG_PG_HOST=kong-database\"\n    # \u6570\u636e\u5e93\u540d\u79f0\n     - \"KONG_CASSANDRA_CONTACT_POINTS=kong-database\"\n    # \u65e5\u5fd7\u8bb0\u5f55\u76ee\u5f55\n     - \"KONG_PROXY_ACCESS_LOG=/dev/stdout\"\n     - \"KONG_ADMIN_ACCESS_LOG=/dev/stdout\"\n     - \"KONG_PROXY_ERROR_LOG=/dev/stderr\"\n     - \"KONG_ADMIN_ERROR_LOG=/dev/stderr\"\n    # \u66b4\u9732\u7684\u7aef\u53e3\n     - \"KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl\"\n    ports:\n     - 8000:8000\n     - 8443:8443\n     - 8001:8001\n     - 8444:8444\n    # \u4f7f\u7528docker\u7f51\u7edc\n    networks:\n     - kong-net\n\n    # \u4f9d\u8d56\u6570\u636e\u5e93\u670d\u52a1\n    depends_on:\n      - kong-database\n# kong \u7ba1\u7406\u754c\u9762\n  konga:\n    image: pantsel/konga\n    environment:\n     - \"TOKEN_SECRET=51liveup.cn\"\n     - \"NODE_ENV=production\"\n    ports:\n     - 8080:1337\n    networks:\n     - kong-net\n\n    depends_on:\n      - kong-database\n      - \n# \u6570\u636e\u5e93\u670d\u52a1\n  kong-database:\n    image: postgres:9.6\n    ports:\n      - \"5432:5432\"\n    environment:\n    # \u8bbf\u95ee\u6570\u636e\u5e93\u7684\u7528\u6237\n      - POSTGRES_USER=kong\n      - POSTGRES_DB=kong\n    networks:\n      - kong-net\n    volumes:\n    # \u540c\u6b65\u65f6\u95f4\n      - /etc/localtime:/etc/localtime:ro\n    # \u6570\u636e\u5e93\u6301\u4e45\u5316\u76ee\u5f55\n      - /data/data/postgresql:/var/lib/postgresql/data\n\nnetworks:\n  kong-net:\n    external: true\n</code></pre> <p>\u4f7f\u7528docker-compose up \u547d\u4ee4\u542f\u52a8\u670d\u52a1\u3002\u4f1a\u53d1\u73b0\u542f\u52a8\u65f6\u62a5\u6570\u636e\u5e93\u9519\u8bef\uff0c\u8fd9\u662f\u56e0\u4e3akong \u4f7f\u7528\u7684postgres \u6570\u636e\u8fd8\u9700\u8981\u8fdb\u884c\u521d\u59cb\u5316\u624d\u80fd\u4f7f\u7528\u3002</p> <ul> <li>\u521d\u59cb\u5316\u6570\u636e\u5e93</li> </ul> <pre><code>docker run --rm \\\n     --network=kong-net \\\n     -e \"KONG_DATABASE=postgres\" \\\n     -e \"KONG_PG_HOST=kong-database\" \\\n     -e \"KONG_CASSANDRA_CONTACT_POINTS=kong-database\" \\\n     kong:latest kong migrations bootstrap\n</code></pre> <p>\u4e00\u5b9a\u8981\u5728\u521b\u5efa\u6570\u636e\u5e93\u5bb9\u5668\u4e4b\u540e\uff0c\u5e76\u4e14\u4fdd\u6301\u6570\u636e\u5e93\u7684Docker\u5bb9\u5668\u5728\u8fd0\u884c\u72b6\u6001\uff0c\u518d\u6267\u884c\u521d\u59cb\u5316\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u521d\u59cb\u5316\u6210\u529f\u540e\uff0c\u518d\u6b21\u4f7f\u7528docker-compose up -d \u542f\u52a8\u670d\u52a1\u5c31\u53ef\u4ee5\u4e86\u3002</p> <ul> <li>\u9a8c\u8bc1</li> </ul> <pre><code>curl -i http://localhost:8001/\n</code></pre> <ul> <li>dashboard</li> </ul> <p>\u53e6\u5916\uff0c\u4e5f\u53ef\u4ee5\u5b89\u88c5\u4e00\u4e2aKong\u7684\u5ba2\u6237\u7aef\u6765\u9a8c\u8bc1\u3002\u5728\u5b89\u88c5\u6709Docker\u5f15\u64ce\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u6267\u884c\u5982\u4e0b\u7684\u547d\u4ee4\uff1a</p> <p>1.0\u4e4b\u540e\u7684kong-dashboard\u5c31\u5df2\u7ecf\u4e0d\u517c\u5bb9\u4e86,\u5efa\u8bae\u4f7f\u7528konga</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#523-kong-dashboard","title":"5.2.3 \u5b89\u88c5kong-dashboard","text":"<ul> <li>Kong Dashboard 3.3.0 is only partially compatible with Kong 0.13. It does not support the new Service and Route objects introduced in Kong 0.13.</li> </ul> <pre><code># \u4e0b\u8f7d\u955c\u50cfpgbi/kong-dashboard\n[root@master data]# docker run --rm -p 8080:8080 pgbi/kong-dashboard start --kong-url http://10.234.2.204:30493 --basic-auth admin=kong@anchnet.com    \nConnecting to Kong on http://10.234.2.204:30493 ...\nWhat's on http://10.234.2.204:30493 isn't Kong\n[root@master data]# kubectl get svc |grep kong\nkong-kong-admin                     NodePort    10.104.75.151    &lt;none&gt;        8444:30493/TCP                                          52m\nkong-kong-proxy                     NodePort    10.99.141.23     &lt;none&gt;        80:30877/TCP,443:31201/TCP                              52m\nkong-postgresql                     ClusterIP   10.109.249.105   &lt;none&gt;        5432/TCP                                                52m\nkong-postgresql-headless            ClusterIP   None             &lt;none&gt;        5432/TCP                                                52m\n</code></pre> <p>\u901a\u8fc7docker\u5b89\u88c5\u4e00\u4e2aKong-Dashboard\uff0c\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\uff1a</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#53-kubernetes","title":"5.3 kubernetes\u90e8\u7f72","text":""},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#531","title":"5.3.1 \u524d\u7f6e\u6761\u4ef6","text":"<ul> <li>\u5df2\u6709Kubernetes 1.6+\u73af\u5883\uff1b</li> <li>\u5df2\u90e8\u7f72helm\u5ba2\u6237\u7aef\u548ctiller\u670d\u52a1\u7aef\uff08\u8bf7\u53c2\u8003\uff1ahttps://docs.helm.sh/using_helm/#installing-helm\uff09</li> <li>\u5728Kubernetes\u4e2d\u521b\u5efa\u4e86\u5177\u5907\u8db3\u591f\u6743\u9650\u8bbf\u95ee\u6743\u9650\u7684service account\uff1b</li> <li>\u5e76\u901a\u8fc7\u6b64service account\u5728Kubernetes\u90e8\u7f72\u4e86tiller\u670d\u52a1\u7aef\uff08\u8bf7\u53c2\u8003\uff1ahttps://docs.helm.sh/using_helm/#role-based-access-control\uff09\u3002</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#532-helm-char","title":"5.3.2 helm char\u914d\u7f6e","text":"<p>\u4e0b\u8868\u5217\u793a\u4e86Kong chart\u7684\u914d\u7f6e\u53c2\u6570\u548c\u9ed8\u8ba4\u503c\uff1a</p> \u53c2\u6570 \u8bf4\u660e \u9ed8\u8ba4\u503c image.repository Kong image <code>kong</code> image.tag Kong image version <code>0.14.1</code> image.pullPolicy Image pull policy <code>IfNotPresent</code> image.pullSecrets Image pull secrets <code>null</code> replicaCount Kong instance count <code>1</code> admin.useTLS Secure Admin traffic <code>true</code> admin.servicePort TCP port on which the Kong admin service is exposed <code>8444</code> admin.containerPort TCP port on which Kong app listens for admin traffic <code>8444</code> admin.nodePort Node port when service type is <code>NodePort</code> admin.type k8s service type, Options: NodePort, ClusterIP, LoadBalancer <code>NodePort</code> admin.loadBalancerIP Will reuse an existing ingress static IP for the admin service <code>null</code> admin.loadBalancerSourceRanges Limit admin access to CIDRs if set and service type is <code>LoadBalancer</code> <code>[]</code> admin.ingress.enabled Enable ingress resource creation (works with proxy.type=ClusterIP) <code>false</code> admin.ingress.tls Name of secret resource, containing TLS secret admin.ingress.hosts List of ingress hosts. <code>[]</code> admin.ingress.path Ingress path. <code>/</code> admin.ingress.annotations Ingress annotations. See documentation for your ingress controller for details <code>{}</code> proxy.useTLS Secure Proxy traffic <code>true</code> proxy.servicePort TCP port on which the Kong Proxy Service is exposed <code>8443</code> proxy.containerPort TCP port on which the Kong app listens for Proxy traffic <code>8443</code> proxy.nodePort Node port when service type is <code>NodePort</code> proxy.type k8s service type. Options: NodePort, ClusterIP, LoadBalancer <code>NodePort</code> proxy.loadBalancerSourceRanges Limit proxy access to CIDRs if set and service type is <code>LoadBalancer</code> <code>[]</code> proxy.loadBalancerIP To reuse an existing ingress static IP for the admin service proxy.ingress.enabled Enable ingress resource creation (works with proxy.type=ClusterIP) <code>false</code> proxy.ingress.tls Name of secret resource, containing TLS secret proxy.ingress.hosts List of ingress hosts. <code>[]</code> proxy.ingress.path Ingress path. <code>/</code> proxy.ingress.annotations Ingress annotations. See documentation for your ingress controller for details <code>{}</code> env Additional Kong configurations runMigrations Run Kong migrations job <code>true</code> readinessProbe Kong readiness probe livenessProbe Kong liveness probe affinity Node/pod affinities nodeSelector Node labels for pod assignment <code>{}</code> podAnnotations Annotations to add to each pod <code>{}</code> resources Pod resource requests &amp; limits <code>{}</code> tolerations List of node taints to tolerate <code>[]</code>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#533-chart","title":"5.3.3 \u5b89\u88c5chart","text":"<p>\u542f\u7528\u6570\u636e\u5e93\u9700\u8981\u5148\u5b89\u88c5pvc</p> <pre><code>---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: data-kong-postgresql-0 \nspec:\n  storageClassName: ceph-rdb\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 4Gi\n\n\n# \u90e8\u7f72pvc\n[root@master data]# kubectl get pvc |grep api-gateway\ndata-api-gateway-postgresql-0           Bound    pvc-d280166c-c03d-11e9-a45a-facf8ddba000   8Gi        RWO            ceph-rdb       11s\n</code></pre> <pre><code>helm fetch stable/kong --version 0.13.0\n\n\n\n[root@master kong-deploy]# helm install -n api-gateway kong/\nNAME:   api-gateway\nLAST DEPLOYED: Fri Aug 16 23:53:37 2019\nNAMESPACE: default\nSTATUS: DEPLOYED\n\nRESOURCES:\n==&gt; v1/Job\nNAME                              COMPLETIONS  DURATION  AGE\napi-gateway-kong-init-migrations  0/1          0s        0s\n\n==&gt; v1/Pod(related)\nNAME                                    READY  STATUS    RESTARTS  AGE\napi-gateway-kong-79f697ff7c-bcr7m       0/1    Init:0/1  0         0s\napi-gateway-kong-init-migrations-hxgd6  0/1    Init:0/1  0         0s\napi-gateway-postgresql-0                0/1    Init:0/1  0         0s\n\n==&gt; v1/Secret\nNAME                    TYPE    DATA  AGE\napi-gateway-postgresql  Opaque  1     0s\n\n==&gt; v1/Service\nNAME                             TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)                     AGE\napi-gateway-kong-admin           NodePort   10.100.226.67   &lt;none&gt;       8444:31466/TCP              0s\napi-gateway-kong-proxy           NodePort   10.109.4.127    &lt;none&gt;       80:32287/TCP,443:32742/TCP  0s\napi-gateway-postgresql           ClusterIP  10.102.197.253  &lt;none&gt;       5432/TCP                    0s\napi-gateway-postgresql-headless  ClusterIP  None            &lt;none&gt;       5432/TCP                    0s\n\n==&gt; v1beta2/Deployment\nNAME              READY  UP-TO-DATE  AVAILABLE  AGE\napi-gateway-kong  0/1    1           0          0s\n\n==&gt; v1beta2/StatefulSet\nNAME                    READY  AGE\napi-gateway-postgresql  0/1    0s\n\n\nNOTES:\n1. Kong Admin can be accessed inside the cluster using:\n     DNS=api-gateway-kong-admin.default.svc.cluster.local\n     PORT=8444\n\nTo connect from outside the K8s cluster:\n     HOST=$(kubectl get nodes --namespace default -o jsonpath='{.items[0].status.addresses[0].address}')\n     PORT=$(kubectl get svc --namespace default api-gateway-kong-admin -o jsonpath='{.spec.ports[0].nodePort}')\n\n\n2. Kong Proxy can be accessed inside the cluster using:\n     DNS=api-gateway-kong-proxy.default.svc.cluster.localPORT=443To connect from outside the K8s cluster:\n     HOST=$(kubectl get nodes --namespace default -o jsonpath='{.items[0].status.addresses[0].address}')\n     PORT=$(kubectl get svc --namespace default api-gateway-kong-proxy -o jsonpath='{.spec.ports[0].nodePort}')\n</code></pre>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#534-kong","title":"5.3.4 \u9a8c\u8bc1Kong(\u547d\u4ee4\u884c)","text":"<p>\u901a\u8fc7\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8fdb\u5165Kong\u7684\u5bb9\u5668\uff1a</p> <pre><code>[root@master kong-deploy]# kubectl exec -it api-gateway-kong-79f697ff7c-bcr7m /bin/sh\n\n/ # netstat -lntup\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 0.0.0.0:8443            0.0.0.0:*               LISTEN      -\ntcp        0      0 0.0.0.0:8444            0.0.0.0:*               LISTEN      -\ntcp        0      0 0.0.0.0:8000            0.0.0.0:*               LISTEN      -\n/ # curl -k https://localhost:8444\n</code></pre> <p>\u5e76\u5728kong\u4e2d\u6267\u884c\u5982\u4e0b\u7684\u547d\u4ee4\uff1a</p> <pre><code>curl -k http://localhost:8444\n</code></pre> <p>\u5982\u679ckong\u6b63\u5e38\u8fd0\u884c\u7684\u8bdd\uff0c\u5e94\u8be5\u4f1a\u8fd4\u56de\u4e00\u4e9b\u5185\u5bb9\u3002</p> <pre><code>[root@master ~]# kubectl get all |grep api-gateway\n\npod/api-gateway-kong-8cf4ddcbf-qb87c                          1/1     Running     0          15h\npod/api-gateway-kong-init-migrations-fsfqb                    0/1     Completed   0          15h\npod/api-gateway-postgresql-0                                  1/1     Running     0          15h\nservice/api-gateway-kong-admin              NodePort    10.103.90.21     &lt;none&gt;        8444:30840/TCP                                          15h\nservice/api-gateway-kong-proxy              NodePort    10.96.32.21      &lt;none&gt;        80:32582/TCP,443:31941/TCP                              15h\nservice/api-gateway-postgresql              ClusterIP   10.109.28.2      &lt;none&gt;        5432/TCP                                                15h\nservice/api-gateway-postgresql-headless     ClusterIP   None             &lt;none&gt;        5432/TCP                                                15h\n\ndeployment.apps/api-gateway-kong                         1/1     1            1           15h\nreplicaset.apps/api-gateway-kong-8cf4ddcbf                          1         1         1       15h\nstatefulset.apps/api-gateway-postgresql           1/1     15h\n\njob.batch/api-gateway-kong-init-migrations     1/1           51s        15h\n</code></pre> <p>\u901a\u8fc7\u6d4f\u89c8\u5668\u67e5\u770b</p> <p></p> <pre><code>{\n    \"plugins\": {\n        \"enabled_in_cluster\": [],\n        \"available_on_server\": {\n            \"correlation-id\": true,\n            \"pre-function\": true,\n            \"cors\": true,\n            \"ldap-auth\": true,\n            \"loggly\": true,\n            \"hmac-auth\": true,\n            \"zipkin\": true,\n            \"request-size-limiting\": true,\n            \"azure-functions\": true,\n            \"request-transformer\": true,\n            \"oauth2\": true,\n            \"response-transformer\": true,\n            \"ip-restriction\": true,\n            \"statsd\": true,\n            \"jwt\": true,\n            \"proxy-cache\": true,\n            \"basic-auth\": true,\n            \"key-auth\": true,\n            \"http-log\": true,\n            \"datadog\": true,\n            \"tcp-log\": true,\n            \"post-function\": true,\n            \"prometheus\": true,\n            \"acl\": true,\n            \"kubernetes-sidecar-injector\": true,\n            \"syslog\": true,\n            \"file-log\": true,\n            \"udp-log\": true,\n            \"response-ratelimiting\": true,\n            \"aws-lambda\": true,\n            \"bot-detection\": true,\n            \"rate-limiting\": true,\n            \"request-termination\": true\n        }\n    },\n    \"tagline\": \"Welcome to kong\",\n    \"configuration\": {\n        \"error_default_type\": \"text/plain\",\n        \"admin_listen\": [\n            \"0.0.0.0:8444 ssl\"\n        ],\n        \"proxy_access_log\": \"/dev/stdout\",\n        \"trusted_ips\": {},\n        \"prefix\": \"/usr/local/kong\",\n        \"loaded_plugins\": {\n            \"correlation-id\": true,\n            \"pre-function\": true,\n            \"cors\": true,\n            \"rate-limiting\": true,\n            \"loggly\": true,\n            \"hmac-auth\": true,\n            \"zipkin\": true,\n            \"bot-detection\": true,\n            \"azure-functions\": true,\n            \"request-transformer\": true,\n            \"oauth2\": true,\n            \"response-transformer\": true,\n            \"syslog\": true,\n            \"statsd\": true,\n            \"jwt\": true,\n            \"proxy-cache\": true,\n            \"basic-auth\": true,\n            \"key-auth\": true,\n            \"http-log\": true,\n            \"datadog\": true,\n            \"tcp-log\": true,\n            \"post-function\": true,\n            \"ldap-auth\": true,\n            \"acl\": true,\n            \"kubernetes-sidecar-injector\": true,\n            \"ip-restriction\": true,\n            \"file-log\": true,\n            \"udp-log\": true,\n            \"response-ratelimiting\": true,\n            \"aws-lambda\": true,\n            \"prometheus\": true,\n            \"request-size-limiting\": true,\n            \"request-termination\": true\n        },\n        \"cassandra_username\": \"kong\",\n        \"ssl_cert_key\": \"/usr/local/kong/ssl/kong-default.key\",\n        \"admin_ssl_cert_key\": \"/usr/local/kong/ssl/admin-kong-default.key\",\n        \"dns_resolver\": {},\n        \"pg_user\": \"kong\",\n        \"pg_password\": \"******\",\n        \"cassandra_data_centers\": [\n            \"dc1:2\",\n            \"dc2:3\"\n        ],\n        \"nginx_admin_directives\": {},\n        \"nginx_http_directives\": [\n            {\n                \"value\": \"prometheus_metrics 5m\",\n                \"name\": \"lua_shared_dict\"\n            }\n        ],\n        \"pg_host\": \"api-gateway-postgresql\",\n        \"nginx_acc_logs\": \"/usr/local/kong/logs/access.log\",\n        \"pg_semaphore_timeout\": 60000,\n        \"proxy_listen\": [\n            \"0.0.0.0:8000\",\n            \"0.0.0.0:8443 ssl\"\n        ],\n        \"client_ssl_cert_default\": \"/usr/local/kong/ssl/kong-default.crt\",\n        \"cassandra_ssl\": false,\n        \"db_update_frequency\": 5,\n        \"db_update_propagation\": 0,\n        \"stream_listen\": [\n            \"off\"\n        ],\n        \"nginx_err_logs\": \"/usr/local/kong/logs/error.log\",\n        \"cassandra_port\": 9042,\n        \"dns_order\": [\n            \"LAST\",\n            \"SRV\",\n            \"A\",\n            \"CNAME\"\n        ],\n        \"dns_error_ttl\": 1,\n        \"headers\": [\n            \"server_tokens\",\n            \"latency_tokens\"\n        ],\n        \"cassandra_lb_policy\": \"RequestRoundRobin\",\n        \"nginx_optimizations\": true,\n        \"pg_timeout\": 5000,\n        \"database\": \"postgres\",\n        \"pg_database\": \"kong\",\n        \"nginx_worker_processes\": \"auto\",\n        \"lua_package_cpath\": \"\",\n        \"admin_ssl_cert\": \"/usr/local/kong/ssl/admin-kong-default.crt\",\n        \"admin_acc_logs\": \"/usr/local/kong/logs/admin_access.log\",\n        \"real_ip_header\": \"X-Real-IP\",\n        \"ssl_cert_key_default\": \"/usr/local/kong/ssl/kong-default.key\",\n        \"lua_package_path\": \"./?.lua;./?/init.lua;\",\n        \"nginx_pid\": \"/usr/local/kong/pids/nginx.pid\",\n        \"upstream_keepalive\": 60,\n        \"nginx_conf\": \"/usr/local/kong/nginx.conf\",\n        \"router_consistency\": \"strict\",\n        \"dns_no_sync\": false,\n        \"origins\": {},\n        \"admin_access_log\": \"/dev/stdout\",\n        \"admin_ssl_cert_default\": \"/usr/local/kong/ssl/admin-kong-default.crt\",\n        \"client_ssl\": false,\n        \"proxy_listeners\": [\n            {\n                \"transparent\": false,\n                \"ssl\": false,\n                \"ip\": \"0.0.0.0\",\n                \"proxy_protocol\": false,\n                \"port\": 8000,\n                \"http2\": false,\n                \"listener\": \"0.0.0.0:8000\"\n            },\n            {\n                \"transparent\": false,\n                \"ssl\": true,\n                \"ip\": \"0.0.0.0\",\n                \"proxy_protocol\": false,\n                \"port\": 8443,\n                \"http2\": false,\n                \"listener\": \"0.0.0.0:8443 ssl\"\n            }\n        ],\n        \"proxy_ssl_enabled\": true,\n        \"stream_listeners\": {},\n        \"db_cache_warmup_entities\": [\n            \"services\",\n            \"plugins\"\n        ],\n        \"enabled_headers\": {\n            \"latency_tokens\": true,\n            \"X-Kong-Proxy-Latency\": true,\n            \"Via\": true,\n            \"server_tokens\": true,\n            \"Server\": true,\n            \"X-Kong-Upstream-Latency\": true,\n            \"X-Kong-Upstream-Status\": false\n        },\n        \"plugins\": [\n            \"bundled\"\n        ],\n        \"ssl_ciphers\": \"ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256\",\n        \"db_resurrect_ttl\": 30,\n        \"nginx_proxy_directives\": {},\n        \"cassandra_consistency\": \"ONE\",\n        \"client_max_body_size\": \"0\",\n        \"admin_error_log\": \"/dev/stderr\",\n        \"pg_ssl_verify\": false,\n        \"dns_not_found_ttl\": 30,\n        \"pg_ssl\": false,\n        \"lua_ssl_verify_depth\": 1,\n        \"ssl_cipher_suite\": \"modern\",\n        \"cassandra_repl_strategy\": \"SimpleStrategy\",\n        \"proxy_error_log\": \"/dev/stderr\",\n        \"kong_env\": \"/usr/local/kong/.kong_env\",\n        \"db_cache_ttl\": 0,\n        \"pg_max_concurrent_queries\": 0,\n        \"nginx_kong_conf\": \"/usr/local/kong/nginx-kong.conf\",\n        \"cassandra_schema_consensus_timeout\": 10000,\n        \"dns_hostsfile\": \"/etc/hosts\",\n        \"admin_listeners\": [\n            {\n                \"transparent\": false,\n                \"ssl\": true,\n                \"ip\": \"0.0.0.0\",\n                \"proxy_protocol\": false,\n                \"port\": 8444,\n                \"http2\": false,\n                \"listener\": \"0.0.0.0:8444 ssl\"\n            }\n        ],\n        \"dns_stale_ttl\": 4,\n        \"ssl_cert\": \"/usr/local/kong/ssl/kong-default.crt\",\n        \"cassandra_timeout\": 5000,\n        \"admin_ssl_cert_key_default\": \"/usr/local/kong/ssl/admin-kong-default.key\",\n        \"cassandra_ssl_verify\": false,\n        \"mem_cache_size\": \"128m\",\n        \"log_level\": \"notice\",\n        \"real_ip_recursive\": \"off\",\n        \"cassandra_repl_factor\": 1,\n        \"client_ssl_cert_key_default\": \"/usr/local/kong/ssl/kong-default.key\",\n        \"nginx_daemon\": \"off\",\n        \"anonymous_reports\": true,\n        \"nginx_sproxy_directives\": {},\n        \"nginx_stream_directives\": {},\n        \"pg_port\": 5432,\n        \"nginx_kong_stream_conf\": \"/usr/local/kong/nginx-kong-stream.conf\",\n        \"client_body_buffer_size\": \"8k\",\n        \"ssl_preread_enabled\": true,\n        \"ssl_cert_csr_default\": \"/usr/local/kong/ssl/kong-default.csr\",\n        \"cassandra_contact_points\": [\n            \"127.0.0.1\"\n        ],\n        \"cassandra_keyspace\": \"kong\",\n        \"ssl_cert_default\": \"/usr/local/kong/ssl/kong-default.crt\",\n        \"lua_socket_pool_size\": 30,\n        \"admin_ssl_enabled\": true\n    },\n    \"version\": \"1.2.2\",\n    \"node_id\": \"cc0f6fa7-3c2c-44f8-a523-8f9e53d7e41e\",\n    \"lua_version\": \"LuaJIT 2.1.0-beta3\",\n    \"prng_seeds\": {\n        \"pid: 36\": 195221171165,\n        \"pid: 35\": 148625059221,\n        \"pid: 39\": 191125165965,\n        \"pid: 1\": 173981549072,\n        \"pid: 34\": 137193103112,\n        \"pid: 38\": 175366916141,\n        \"pid: 37\": 192138146579,\n        \"pid: 32\": 214162161921,\n        \"pid: 33\": 152108231211\n    },\n    \"timers\": {\n        \"pending\": 6,\n        \"running\": 0\n    },\n    \"hostname\": \"api-gateway-kong-79f697ff7c-bcr7m\"\n}\n</code></pre> <ul> <li>curl \u521b\u5efa\u4e00\u4e2aservice</li> </ul> <pre><code>curl -i -k -X POST \\\n--url https://10.234.2.204:30840/services/ \\\n--data 'name=baidu-service' \\\n--data 'url=https://www.baidu.com/'\n</code></pre> <ul> <li>\u521b\u5efa\u4e00\u4e2aroutes</li> </ul> <pre><code>curl -ik -X POST \\\n--url https://10.234.2.204:30840/services/baidu-service/routes \\\n--data 'hosts[]=baidu.com' \\\n--data 'paths[]=/api/baidu'\n</code></pre> <ul> <li>curl\u6d4b\u8bd5</li> </ul> <pre><code>#\u8bbf\u95eeproxy\ncurl -k http://10.234.2.204:32582/api/baidu --header 'Host: baidu.com'\n</code></pre> <p></p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#_6","title":"\u516d \u4f7f\u7528","text":""},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#61-cli","title":"6.1 CLI\u4f7f\u7528","text":"<p>\u63d0\u4f9b\u7684CLI\uff08\u547d\u4ee4\u884c\u754c\u9762Command Line Interface\uff09\u5141\u8bb8\u542f\u52a8\uff0c\u505c\u6b62\u548c\u7ba1\u7406Kong\u5b9e\u4f8b\u3002CLI\u53ef\u4ee5\u7ba1\u7406\u672c\u5730\u8282\u70b9\uff08\u5982\u5728\u5f53\u524d\u8ba1\u7b97\u673a\u4e0a\uff09\u3002</p> <ul> <li>\u901a\u7528\u53c2\u6570</li> </ul> <pre><code>--help\uff1a\u6253\u5370\u6b64\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f\n--v\uff1a\u542f\u7528\u8be6\u7ec6\u6a21\u5f0f\n--vv\uff1a\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f\uff08\u5f88\u591a\u8f93\u51fa\uff09\n</code></pre> <ul> <li>\u547d\u4ee4</li> </ul> <pre><code>kong check &lt;conf&gt;       #\u68c0\u67e5\u7ed9\u5b9aKong\u914d\u7f6e\u6587\u4ef6\u7684\u6709\u6548\u6027\u3002\nkong health [OPTIONS]   #\u9a8c\u8bc1Kong \u7684\u670d\u52a1\u7ec4\u4ef6\u662f\u5426\u6b63\u5e38\u8fd0\u884c\n</code></pre> <pre><code>kong migrations COMMAND [OPTIONS]\n\u53ef\u7528\u7684\u547d\u4ee4\u5982\u4e0b\uff1a\n  bootstrap                         \u5f15\u5bfc\u6570\u636e\u5e93\u5e76\u8fd0\u884c\u5168\u90e8\u8fc1\u79fb\uff08\u521d\u59cb\u5316\uff09\u3002\n  up                                \u8fd0\u884c\u65b0\u8fc1\u79fb\u3002\n  finish                            \u5b8c\u6210\u6b63\u5728\u7b49\u5f85\u4e2d\u7684\u8fc1\u79fb\u547d\u4ee4\uff0c\u5728\u6267\u884c`up`\u540e\u3002\n  list                              \u5217\u51fa\u5df2\u6267\u884c\u7684\u8fc1\u79fb\u3002\n  reset                             \u91cd\u7f6e\u6570\u636e\u5e93\u3002\nOptions\uff08\u53ef\u9009\uff09:\n -y,--yes                           \u5047\u8bbe\u63d0\u793a\u201cyes\u201d\uff0c\u5e76\u8fd0\u884c\u975e\u4ea4\u4e92\u6a21\u5f0f\n -q,--quiet                         \u5ffd\u7565\u6240\u6709\u8f93\u51fa\n -f,--force                         \u4f9d\u65e7\u6267\u884c\u8fc1\u79fb\uff0c\u5373\u4f7f\u6570\u636e\u5e93\u62a5\u544a\u5df2\u7ecf\u6267\u884c\u8fc7\u4e86\u3002\n --db-timeout     (default 60)      \u8d85\u65f6\u65f6\u95f4\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u6240\u6709\u6570\u636e\u5e93\u64cd\u4f5c\u901a\u7528\uff08\u5305\u62ecCassandra\u7684schema consensus\uff09\u3002\n --lock-timeout   (default 60)      \u8d85\u65f6\u65f6\u95f4\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d, \u8282\u70b9\u7b49\u5f85\u9886\u5bfc\u8282\u70b9\u8fc1\u79fb\u5b8c\u6210\u3002\n -c,--conf        (optional string) \u914d\u7f6e\u6587\u4ef6\u3002\n</code></pre> <pre><code>kong quit   [OPTIONS]   #\u4f18\u96c5\u5730\u9000\u51fa\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684Kong\u8282\u70b9\uff08Nginx\u548c\u5176\u4ed6\u8282\u70b9\uff09\u5728\u7ed9\u5b9a\u7684\u524d\u7f00\u76ee\u5f55\u4e2d\u914d\u7f6e\u7684\u670d\u52a1\u3002\nkong reload [OPTIONS]   #\u91cd\u65b0\u52a0\u8f7dKong\u8282\u70b9\uff08\u5e76\u542f\u52a8\u5176\u4ed6\u5df2\u914d\u7f6e\u7684\u670d\u52a1\uff09\u5728\u7ed9\u5b9a\u7684\u524d\u7f00\u76ee\u5f55\u4e2d\u3002\nkong restart [OPTIONS]  #\u91cd\u65b0\u542f\u52a8Kong\u8282\u70b9\uff08\u4ee5\u53ca\u5176\u4ed6\u914d\u7f6e\u7684\u670d\u52a1\uff0c\u5982Serf\uff09\u5728\u7ed9\u5b9a\u7684\u524d\u7f00\u76ee\u5f55\u4e2d\u3002\n</code></pre> <p>\u66f4\u8be6\u7ec6\u7684CLI\u53c2\u6570\u53ef\u53c2\u8003\uff1aCLI Reference</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#61","title":"6.1 \u914d\u7f6e\u4e00\u4e2a\u5b9e\u4f8b","text":"<p>\u914d\u7f6e\u4e00\u4e2a\u8bbf\u95ee www.baidu.com/ \u7684\u63a5\u53e3API\uff0c\u5b9e\u9645\u4f7f\u7528\u65f6\u4f1a\u5bf9\u63a5\u540e\u7aef\u7684\u4e1a\u52a1\u6570\u636e\u63a5\u53e3\u5730\u5740\u3002</p> <p>\u8def\u7531\u5b9a\u4e49\u4e86\u5339\u914d\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u89c4\u5219\uff0c\u6bcf\u4e00\u4e2a\u8def\u7531\u5173\u8054\u4e00\u4e2a Service\uff0c\u6bcf\u4e00\u4e2a Service \u6709\u53ef\u80fd\u88ab\u591a\u4e2a\u8def\u7531\u5173\u8054\uff0c\u6bcf\u4e00\u4e2a\u5339\u914d\u5230\u6307\u5b9a\u7684\u8def\u7531\u8bf7\u6c42\u5c06\u88ab\u4ee3\u7406\u5230\u5b83\u5173\u8054\u7684 Service \u4e0a,\u53c2\u89c1Kong Admin Api Route Object\u3002</p> <p>kong admin\u63a5\u53e3</p> <pre><code>GET /routers/                                #\u5217\u51fa\u6240\u6709\u8def\u7531\nGET /services/                               #\u5217\u51fa\u6240\u6709\u670d\u52a1\nGET /consumers/                              #\u5217\u51fa\u6240\u6709\u7528\u6237\nGET /services/{service name or id}/routes    #\u5217\u51fa\u670d\u52a1\u5173\u8054\u7684\u8def\u7531\nGET /plugins/                                #\u5217\u51fa\u6240\u6709\u7684\u63d2\u4ef6\u914d\u7f6e\nGET /plugins/enabled                         #\u5217\u51fa\u6240\u6709\u53ef\u4ee5\u4f7f\u7528\u7684\u63d2\u4ef6\nGET /plugins/schema/{plugin name}            #\u83b7\u5f97\u63d2\u4ef6\u7684\u914d\u7f6e\u6a21\u7248\nGET /certificates/                           #\u5217\u51fa\u6240\u6709\u7684\u8bc1\u4e66\nGET /snis/                                   #\u5217\u51fa\u6240\u6709\u57df\u540d\u4e0e\u8bc1\u4e66\u7684\u5bf9\u5e94\nGET /upstreams/                              #\u5217\u51fa\u6240\u6709\u7684upstream\nGET /upstreams/{name or id}/health/          #\u67e5\u770bupstream\u7684\u5065\u5eb7\u72b6\u6001\nGET /upstreams/{name or id}/targets/all      #\u5217\u51faupstream\u4e2d\u6240\u6709\u7684target\n</code></pre>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#611","title":"6.1.1 \u521b\u5efa\u670d\u52a1","text":"<p>\u670d\u52a1\u662f\u4e0a\u6e38\u670d\u52a1\u7684\u62bd\u8c61\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u5e94\u7528\uff0c\u6216\u8005\u5177\u4f53\u67d0\u4e2a\u63a5\u53e3\u3002</p> <ul> <li>\u547d\u4ee4\u884c\u65b9\u5f0f\u521b\u5efa\u670d\u52a1\uff1a</li> </ul> <pre><code>curl -i -X POST \\\n--url http://134.175.74.48:8001/services/ \\\n--data 'name=baidu-service' \\\n--data 'url=https://www.baidu.com/'\n</code></pre> <ul> <li>postman\u521b\u5efa</li> </ul> <p></p> <p></p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#612","title":"6.1.2 \u521b\u5efa\u8def\u7531","text":"<p>\u5728\u521a\u624d\u521b\u5efa\u7684baidu-service\u7684\u670d\u52a1\u4e0a\u521b\u5efa\u8def\u7531</p> <ul> <li>Curl \u521b\u5efa</li> </ul> <pre><code>curl -i -X POST \\\n--url http://134.175.74.48:8001/services/baidu-service/routes \\\n--data 'hosts[]=baidu.com' \\\n--data 'paths[]=/api/baidu'\n</code></pre> <ul> <li>postman\u521b\u5efa</li> </ul> <p></p> <p></p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#613","title":"6.1.3 \u6d4b\u8bd5","text":"<ul> <li>curl\u6d4b\u8bd5</li> </ul> <p>\u8fd9\u65f6\u5019\u8bbf\u95eekong\u7684<code>proxy\u5730\u5740</code>\u65f6\uff0c\u5982\u679chost\u4e3abaidu.com<code>\uff0c\u8bf7\u6c42\u88ab\u8f6c\u53d1\u5230</code>http://baidu.com</p> <pre><code>curl  http://134.175.74.48:8000/api/baidu --header 'Host: baidu.com'\n</code></pre> <ul> <li>postman\u6d4b\u8bd5</li> </ul> <p></p> <p>\u6d4b\u8bd5post</p> <p></p> <p>\u5229\u7528konga web\u754c\u9762\u64cd\u4f5c\u66f4\u4e3a\u65b9\u4fbf\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#62","title":"6.2 \u63d2\u4ef6\u4f7f\u7528","text":"<p>\u63d2\u4ef6\u662f\u7528\u6765\u6269\u5c55API\u7684\uff0c\u4f8b\u5982\u4e3aAPI\u6dfb\u52a0\u8ba4\u8bc1\u3001\u8bbe\u7f6eACL\u3001\u9650\u5236\u901f\u7387\u7b49\u3001\u96c6\u6210oauth\u3001ldap\u7b49\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#621-jwt","title":"6.2.1 \u8ba4\u8bc1-JWT","text":"<p>\u4e0a\u9762\u7684\u914d\u7f6e\uff0c\u53ea\u8981\u77e5\u9053Router\u7684\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u83b7\u53d6\u6570\u636e\uff0c\u6211\u4eec\u8981\u628aAPI\u52a0\u5165\u8eab\u4efd\u8ba4\u8bc1\u3002\u5982\u679cAPI\u9762\u5bf9\u4e0d\u662f\u5177\u4f53\u7528\u6237\uff0c\u800c\u662f\u5176\u4ed6\u7684\u7cfb\u7edf\uff0c\u53ef\u4ee5\u4f7f\u7528JWT\u6765\u8fdb\u884c\u7cfb\u7edf\u95f4\u8eab\u4efd\u8ba4\u8bc1\uff0c\u4f7f\u7528Kong JWT\u63d2\u4ef6\u5c31\u53ef\u80fd\u5b8c\u6210\u8fd9\u529f\u80fd\u3002JWT \u63d2\u4ef6\u8981\u5728\u5bf9\u5e94\u7684Router\u4e0a\u8fdb\u884c\u542f\u7528\u3002</p> <pre><code>curl -X POST http://134.175.74.48:8001/routes/8e6a1982-5dee-492c-8fe0-c046ebae573c/plugins \\\n    --data \"name=jwt\"\n</code></pre> <p>fee36521-e549-410f-8986-9fbba02219c1 \u662f\u521b\u5efa\u7684service\u7684ID\u3002</p> <p>\u8fd9\u65f6\u518d\u901a\u8fc7Postman \u8bbf\u95ee\u4e0a\u9762\u7684\u63a5\u53e3\u5c31\u4f1a\u63d0\u793a\uff1a</p> <p></p> <pre><code>{\n    \"message\": \"Unauthorized\"\n}\n</code></pre> <ul> <li>\u521b\u5efa\u7528\u6237</li> </ul> <pre><code>curl -i -X POST \\\n--url http://134.175.74.48:8001/consumers/  \\\n--data \"username=kongauser1\"\n</code></pre> <ul> <li>\u7528\u6237\u751f\u6210JWT\u51ed\u8bc1</li> </ul> <pre><code>curl -i -X POST \\\n--url http://134.175.74.48:8001/consumers/kongauser1/jwt \\\n--header \"Content-Type: application/x-www-form-urlencoded\"\n</code></pre> <p>\u8fd4\u56de\u51ed\u8bc1\u4fe1\u606f\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 get \u65b9\u6cd5\u67e5\u8be2\u51ed\u8bc1\u4fe1\u606f</p> <pre><code>{\n    \"rsa_public_key\": null,\n    \"created_at\": 1560723665,\n    \"consumer\": {\n        \"id\": \"8bb94f49-22a6-4d77-9a64-21f13adc0342\"\n    },\n    \"id\": \"a110d234-6dc1-4443-9da2-21acddc66e09\",\n    \"algorithm\": \"HS256\",\n    \"secret\": \"lCe8Lbb7F0KtLccaBcBnOvYg76V7wmQx\",\n    \"key\": \"7yQoUdF0aFUC9N593uLQLbqL7RSPj2qM\"\n}\n</code></pre> <p></p> <p>\u4f7f\u7528key\u548csecret\u5728 jwt.io/ \u53ef\u4ee5\u751f\u6210jwt \u51ed\u8bc1\u4fe1\u606f.</p> <p></p> <p></p> <p>\u518d\u901a\u8fc7postman \u8bbf\u95ee\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u6570\u636e\u4e86\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#622-acl","title":"6.2.2 \u5b89\u5168-ACL","text":"<p>JWT\u63d2\u4ef6\u53ef\u4ee5\u4fdd\u62a4API\u80fd\u591f\u88ab\u53d7\u4fe1\u7528\u6237\u8bbf\u95ee\uff0c\u4f46\u4e0d\u80fd\u533a\u522b\u54ea\u4e2a\u7528\u6237\u80fd\u591f\u8bbf\u95ee\u54ea\u4e2aAPI\uff0c\u5373\u63a5\u53e3\u6743\u9650\u95ee\u9898\uff0c\u6211\u4eec\u4f7f\u7528ACL \u63d2\u4ef6\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898.</p> <p>\u5728\u4e0a\u9762\u5b9a\u4e49\u597d\u7684\u8def\u7531\u4e0a\u542f\u7528acl \u63d2\u4ef6\uff0c\u6307\u5b9a\u767d\u540d\u5355\uff0c</p> <pre><code>curl -i -X POST \\\n--url http://134.175.74.48:8001/routes/afb8bfbd-977e-464f-8c94-05d6c5c98429/plugins \\\n--data \"name=acl\"  \\\n--data \"config.whitelist=go2cloud-api-group\"\n</code></pre> <p>\u6b64\u65f6\u518d\u8bbf\u95eeapi\uff0c\u4f1a\u63d0\u793a\u4e0d\u80fd\u8bbf\u95ee\u8fd9\u4e2a\u670d\u52a1\u3002</p> <pre><code>{\n    \"message\": \"You cannot consume this service\"\n}\n</code></pre> <p></p> <p>\u53ea\u9700\u5c06kongauser1\u8fd9\u4e2a\u7528\u6237\u5173\u8054\u5230\u767d\u540d\u5355\u5185\u7684go2cloud-api-group\u7ec4\u91cc\u5373\u53ef\u3002</p> <pre><code>curl -i -X POST \\\n--url http://134.175.74.48:8001/consumers/tianqiuser/acls \\\n--data \"group=tianqi\"\n</code></pre> <p></p> <p>\u518d\u6b21\u8bbf\u95ee\u63a5\u53e3\uff0c\u80fd\u6b63\u5e38\u8fd4\u56de\u6570\u636e\u3002</p> <p></p> <p>\u73b0\u5728\u5c31\u53ef\u4ee5\u5bf9\u7f51\u5173\u66b4\u9732\u7684\u63a5\u53e3\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u548c\u6743\u9650\u63a7\u5236\u4e86\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#623-key-auth","title":"6.2.3 \u8ba4\u8bc1-key-auth","text":"<ul> <li>\u4e3a\u670d\u52a1\u6216\u8005\u8def\u7531\u521b\u5efakey-auth\uff0c\u63d2\u4ef6\u5373\u53ef\u4ee5\u5e94\u7528\u5728service\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u5e94\u7528\u5728route\u4e0a</li> </ul> <pre><code> curl -i -X POST \\\n  --url http://134.175.74.48:8001/services/go2cloud-api/plugins/ \\\n  --data 'name=key-auth'\n</code></pre> <p>\u83b7\u53d6\u5230\u7684\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>{\n    \"created_at\": 1566027525,\n    \"config\": {\n        \"key_names\": [\n            \"apikey\"\n        ],\n        \"run_on_preflight\": true,\n        \"anonymous\": null,\n        \"hide_credentials\": false,\n        \"key_in_body\": false\n    },\n    \"id\": \"9be2def2-df65-41a4-97b7-52e44b207427\",\n    \"service\": {\n        \"id\": \"ceb337a3-a6e0-4520-ba7a-f61403e36dcf\"\n    },\n    \"name\": \"key-auth\",\n    \"protocols\": [\n        \"grpc\",\n        \"grpcs\",\n        \"http\",\n        \"https\"\n    ],\n    \"enabled\": true,\n    \"run_on\": \"first\",\n    \"consumer\": null,\n    \"route\": null,\n    \"tags\": null\n}\n</code></pre> <ul> <li>\u521b\u5efa\u7528\u6237\uff0c\u5728\u7528\u6237\u4e2d\u914d\u7f6eapk-key</li> </ul> <pre><code>curl -i -X POST \\\n  --url http://localhost:8001/consumers/ \\\n  --data \"username=Jason\"\n\n\ncurl -i -X POST \\\n  --url http://localhost:8001/consumers/Jason/key-auth/ \\\n  --data 'key=123456'\n</code></pre> <p></p> <ul> <li>postman\u6d4b\u8bd5\uff0c\u8ba4\u8bc1\u65b9\u5f0f\u4e3aapikey</li> </ul> <p></p> <p>https://docs.konghq.com/hub/)</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#624-basic-auth","title":"6.2.4 \u8ba4\u8bc1-basic auth","text":"<ul> <li>\u5728service\u6216route\u4e0a\u521b\u5efabasic auth</li> </ul> <ul> <li>\u5728consumers\u4e2d\u521b\u5efabasic credentials</li> </ul> <ul> <li>\u5229\u7528postman\u6d4b\u8bd5</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#625-ip-restriction","title":"6.2.5 \u5b89\u5168-ip-restriction","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u7528\u6765\u8bbe\u7f6e\u63a5\u53e3IP\u7684\u9ed1\u767d\u540d\u5355</p> <ul> <li>\u5728service\u6216routes\u4e0a\u521b\u5efabasic auth,\u914d\u7f6e\u9ed1\u767d\u540d\u5355</li> </ul> <p></p> <p></p> <ul> <li>postman\u6d4b\u8bd5</li> </ul> <p></p> <p>\u5c06\u8c03\u7528\u65b9\u7684IP\u5730\u5740\u52a0\u5165\u5230\u767d\u540d\u5355\u4e2d\uff0c\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#626-bot-detection","title":"6.2.6 \u5b89\u5168-bot-detection","text":"<ul> <li>\u4e3aroutes\u6216service \u521b\u5efabot-detection\uff0c'User-Agent: PostmanRuntime/7.15.2'\uff0c\u5c06postman\u5ba2\u6237\u7aef\u52a0\u5165\u5230\u9ed1\u540d\u5355\u8fdb\u884c\u6d4b\u8bd5\uff0c\u9ed8\u8ba4\u89c4\u5219\u8be6\u89c1\uff1ahttps://github.com/Kong/kong/blob/master/kong/plugins/bot-detection/rules.lua</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#627-rate-limiting","title":"6.2.7 \u6d41\u63a7-rate-limiting","text":"<ul> <li>\u5728service\u6216route\u914d\u7f6e\u6d41\u91cf\u63a7\u5236</li> </ul> <p>\u5b9a\u4e49\u6bcf\u79d2/\u5206\u949f/\u5c0f\u65f6/\u5929/\u6708/\u5e74\u53ef\u4ee5\u53d1\u9001\u7684\u8bf7\u6c42\u6570\u91cf</p> <p>\u9650\u5236\u53ef\u4ee5\u6839\u636e\u670d\u52a1\u6216\u8def\u7531/ip\u5730\u5740/\u8bc1\u4e66</p> <p>\u7b56\u7565\u53ef\u4ee5\u5229\u7528\u672c\u5730\uff0c\u96c6\u7fa4\u6216redis</p> <p>\u4f8b\u5982\u914d\u7f6e\u9650\u5236\u6bcf\u5929\u53ea\u80fd\u8c03\u752810\u6b21</p> <ul> <li>postman\u6d4b\u8bd5</li> </ul> <p></p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#628-requestsize-limitingtermination","title":"6.2.8 \u6d41\u63a7-request/size-limiting/termination","text":"<p>request-size-limiting \u8bf7\u6c42payload size\u9650\u5236</p> <p>request-termination \u8fd9\u5141\u8bb8\uff08\u6682\u65f6\uff09\u963b\u6b62API\u6216\u6d88\u8d39\u8005</p> <p></p> <p>\u6b64\u5904\u53ea\u7b80\u5355\u5217\u4e3e\u51e0\u4e2a\u63d2\u4ef6\uff0c\u66f4\u8be6\u7ec6\u7684\u63d2\u4ef6\u8bf7\u67e5\u770b\uff1a</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/#_7","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://docs.konghq.com/0.13.x/admin-api/#route-object</li> <li>https://www.kubernetes.org.cn/4952.html</li> <li>https://www.lijiaocn.com/tags/all.html#kong</li> <li>https://github.com/Kong/kong</li> <li>https://docs.konghq.com/install/kubernetes/</li> <li>https://hub.kubeapps.com/charts/stable/kong</li> <li>https://www.cnblogs.com/zhoujie/p/kong5.html</li> <li> <p>https://www.cnblogs.com/zhoujie/p/kong1.html</p> </li> <li> <p>https://github.com/PGBI/kong-dashboard</p> </li> <li> <p>konga\u5b98\u7f51</p> </li> <li> <p>konga github</p> </li> <li>kong\u4e2d\u6587\u5730\u5740</li> <li>http://www.102no.com/archives/tag/kong%E6%95%99%E7%A8%8B</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","title":"\u5fae\u670d\u52a1\u67b6\u6784\u4e2d10\u79cd\u5e38\u7528\u8bbe\u8ba1\u6a21\u5f0f","text":""},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u4ece\u8f6f\u4ef6\u5f00\u53d1\u65e9\u671f\uff081960 \u5e74\u4ee3\uff09\u5f00\u59cb\uff0c\u5e94\u5bf9\u5927\u578b\u8f6f\u4ef6\u7cfb\u7edf\u4e2d\u7684\u590d\u6742\u6027\u4e00\u76f4\u662f\u4e00\u9879\u4ee4\u4eba\u751f\u754f\u7684\u4efb\u52a1\u3002\u591a\u5e74\u6765\u4e3a\u4e86\u5e94\u5bf9\u8f6f\u4ef6\u7cfb\u7edf\u7684\u590d\u6742\u6027\uff0c\u8f6f\u4ef6\u5de5\u7a0b\u5e08\u548c\u67b6\u6784\u5e08\u4eec\u505a\u4e86\u8bb8\u591a\u5c1d\u8bd5\uff1aDavid Parnas \u7684\u6a21\u5757\u5316\u548c\u5c01\u88c5 \uff081972\uff09\uff0c Edsger W. Dijkstra \uff081974\uff09\u7684\u5173\u6ce8\u70b9\u5206\u79bb\u4ee5\u53ca SOA\uff081988\uff09\u3002</p> <p>\u4ed6\u4eec\u90fd\u662f\u4f7f\u7528\u5206\u800c\u6cbb\u4e4b\u8fd9\u9879\u6210\u719f\u7684\u4f20\u7edf\u6280\u672f\u6765\u5e94\u5bf9\u5927\u578b\u7cfb\u7edf\u7684\u590d\u6742\u6027\u3002\u81ea 2010 \u5e74\u5f00\u59cb\uff0c\u8fd9\u4e9b\u6280\u672f\u88ab\u8bc1\u5b9e\u65e0\u6cd5\u7ee7\u7eed\u5e94\u5bf9 Web \u7ea7\u5e94\u7528\u6216\u8005\u73b0\u4ee3\u5927\u578b\u4f01\u4e1a\u7ea7\u5e94\u7528\u7684\u590d\u6742\u6027\u3002\u56e0\u6b64\u67b6\u6784\u5e08\u548c\u5de5\u7a0b\u5e08\u4eec\u53d1\u5c55\u51fa\u4e86\u4e00\u79cd\u5168\u65b0\u7684\u73b0\u4ee3\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5fae\u670d\u52a1\u67b6\u6784\u3002\u5b83\u867d\u7136\u5ef6\u7eed\u4e86\u5206\u800c\u6cbb\u4e4b\u7684\u601d\u60f3\uff0c\u4f46\u5374\u662f\u4ee5\u5168\u65b0\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7684\u3002</p> <p>\u8f6f\u4ef6\u8bbe\u8ba1\u6a21\u5f0f\u662f\u89e3\u51b3\u8f6f\u4ef6\u8bbe\u8ba1\u4e2d\u5e38\u89c1\u95ee\u9898\u7684\u901a\u7528\u3001\u53ef\u590d\u7528\u7684\u89e3\u51b3\u65b9\u6848\u3002\u8bbe\u8ba1\u6a21\u5f0f\u8ba9\u6211\u4eec\u53ef\u4ee5\u5206\u4eab\u901a\u7528\u8bcd\u6c47\u5e76\u4f7f\u7528\u7ecf\u5b9e\u6218\u68c0\u9a8c\u7684\u65b9\u6848\uff0c\u4ee5\u514d\u91cd\u590d\u9020\u8f6e\u5b50\u3002\u6211\u5148\u7b80\u5355\u4ecb\u7ecd\u4e0b\u5fae\u670d\u52a1\u67b6\u6784\u3002</p> <p>\u672c\u6587\u8bbe\u8ba1\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ul> <li>\u5fae\u670d\u52a1\u67b6\u6784</li> <li>\u5fae\u670d\u52a1\u67b6\u6784\u7684\u4f18\u52bf</li> <li>\u5fae\u670d\u52a1\u67b6\u6784\u7684\u52a3\u52bf</li> <li>\u4f55\u65f6\u4f7f\u7528\u5fae\u670d\u52a1\u67b6\u6784</li> </ul> <p>\u6700\u91cd\u8981\u7684\u5fae\u670d\u52a1\u67b6\u6784\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5305\u62ec\u5176\u4f18\u7f3a\u70b9\u3001\u7528\u4f8b\u3001\u4e0a\u4e0b\u6587\u3001\u6280\u672f\u6808\u793a\u4f8b\u53ca\u53ef\u7528\u8d44\u6e90\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u672c\u6e05\u5355\u4e2d\u7684\u5927\u90e8\u5206\u8bbe\u8ba1\u6a21\u5f0f\u5e38\u51fa\u73b0\u5728\u591a\u79cd\u8bed\u5883\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u975e\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u4f7f\u7528\u3002\u800c\u6211\u5c06\u5728\u5fae\u670d\u52a1\u8fd9\u4e2a\u7279\u5b9a\u8bed\u5883\u4e2d\u4ecb\u7ecd\u5b83\u4eec\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u5fae\u670d\u52a1\u67b6\u6784","text":"<p>\u535a\u5ba2\u300a\u5fae\u670d\u52a1\u67b6\u6784\u6982\u8ff0\u53ca\u4e3a\u4ec0\u4e48\u8981\u5e94\u7528\u5728\u4e0b\u4e2a\u9879\u76ee\u300b\u548c\u300a\u5355\u4f53\u8f6f\u4ef6\u67b6\u6784\u771f\u7684\u7ec8\u7ed3\u4e86\u5417\uff1f\u300b\u4e2d\u5bf9\u5fae\u670d\u52a1\u67b6\u6784\u6709\u975e\u5e38\u8be6\u5c3d\u7684\u4ecb\u7ecd\u3002\u5982\u679c\u4f60\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u9605\u8bfb\u8fd9\u4e24\u7bc7\u535a\u5ba2\u6765\u6df1\u5165\u4e86\u89e3\u3002</p> <p>https://towardsdatascience.com/microservice-architecture-a-brief-overview-and-why-you-should-use-it-in-your-next-project-a17b6e19adfd</p> <p>https://towardsdatascience.com/looking-beyond-the-hype-is-modular-monolithic-software-architecture-really-dead-e386191610f8</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5fae\u670d\u52a1\u67b6\u6784\u6982\u5ff5","text":"<p>\u90a3\u5230\u5e95\u4ec0\u4e48\u662f\u5fae\u670d\u52a1\u67b6\u6784\uff1f\u6709\u5f88\u591a\u79cd\u5b9a\u4e49\u65b9\u6cd5\u3002\u6211\u7684\u5b9a\u4e49\u662f\u8fd9\u8fd9\u6837\u7684\uff1a</p> <p>\u5fae\u670d\u52a1\u67b6\u6784\u6307\u7684\u662f\u5c06\u5927\u578b\u590d\u6742\u7cfb\u7edf\u6309\u529f\u80fd\u6216\u8005\u4e1a\u52a1\u9700\u6c42\u5782\u76f4\u5207\u5206\u6210\u66f4\u5c0f\u7684\u5b50\u7cfb\u7edf\uff0c\u8fd9\u4e9b\u5b50\u7cfb\u7edf\u4ee5\u72ec\u7acb\u90e8\u7f72\u7684\u5b50\u8fdb\u7a0b\u5b58\u5728\uff0c\u5b83\u4eec\u4e4b\u95f4\u901a\u8fc7\u8f7b\u91cf\u7ea7\u7684\u3001\u8de8\u8bed\u8a00\u7684\u540c\u6b65\uff08\u6bd4\u5982 REST\uff0cgRPC\uff09\u6216\u8005\u5f02\u6b65\uff08\u6d88\u606f\uff09\u7f51\u7edc\u8c03\u7528\u8fdb\u884c\u901a\u4fe1\u3002</p> <p>\u4e0b\u9762\u662f\u57fa\u4e8e\u5fae\u670d\u52a1\u67b6\u6784\u7684\u5546\u4e1a Web \u5e94\u7528\u7684\u7ec4\u4ef6\u89c6\u56fe\uff1a</p> <p></p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u5fae\u670d\u52a1\u67b6\u6784\u91cd\u8981\u7279\u5f81","text":"<ul> <li>\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u88ab\u62c6\u5206\u6210\u4e92\u76f8\u72ec\u7acb\u4f46\u5305\u542b\u591a\u4e2a\u5185\u90e8\u6a21\u5757\u7684\u5b50\u8fdb\u7a0b</li> <li>\u4e0e\u6a21\u5757\u5316\u5355\u4f53\u5e94\u7528\uff08Modular Monoliths\uff09\u6216 SOA \u76f8\u53cd\uff0c\u5fae\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u6839\u636e\u4e1a\u52a1\u8303\u56f4\u6216\u9886\u57df\u5782\u76f4\u62c6\u5206\u3002</li> <li>\u5fae\u670d\u52a1\u8fb9\u754c\u662f\u5916\u90e8\u7684\uff0c\u5fae\u670d\u52a1\u4e4b\u95f4\u901a\u8fc7\u7f51\u7edc\u8c03\u7528\uff08RPC\u6216\u6d88\u606f\uff09\u76f8\u4e92\u901a\u4fe1\u3002</li> <li>\u5fae\u670d\u52a1\u662f\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0c\u5b83\u4eec\u53ef\u4ee5\u72ec\u7acb\u90e8\u7f72</li> <li>\u5b83\u4eec\u4ee5\u8f7b\u91cf\u7ea7\u7684\u65b9\u5f0f\u901a\u4fe1\uff0c\u4e0d\u9700\u8981\u4efb\u4f55\u667a\u80fd\u901a\u4fe1\u901a\u9053\u3002</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#23","title":"2.3 \u5fae\u670d\u52a1\u67b6\u6784\u4f18\u70b9","text":"<ul> <li>\u66f4\u597d\u7684\u5f00\u53d1\u89c4\u6a21</li> <li>\u66f4\u5feb\u7684\u5f00\u53d1\u901f\u5ea6</li> <li>\u652f\u6301\u8fed\u4ee3\u5f00\u53d1\u6216\u73b0\u4ee3\u5316\u589e\u91cf\u5f00\u53d1</li> <li>\u5145\u5206\u5229\u7528\u73b0\u4ee3\u8f6f\u4ef6\u5f00\u53d1\u751f\u6001\u7cfb\u7edf\u7684\u4f18\u52bf\uff08\u4e91\u3001\u5bb9\u5668\u3001 DevOps\u3001Serverless\uff09</li> <li>\u652f\u6301\u6c34\u5e73\u7f29\u653e\u548c\u7ec6\u7c92\u5ea6\u7f29\u653e</li> <li>\u5c0f\u4f53\u91cf\uff0c\u8f83\u4f4e\u4e86\u5f00\u53d1\u4eba\u5458\u7684\u8ba4\u77e5\u590d\u6742\u6027</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#24","title":"2.4 \u5fae\u670d\u52a1\u67b6\u6784\u7684\u7f3a\u70b9","text":"<ul> <li>\u66f4\u9ad8\u6570\u91cf\u7ea7\u7684\u6d3b\u52a8\u7ec4\u4ef6\uff08\u670d\u52a1\u3001\u6570\u636e\u5e93\u3001\u8fdb\u7a0b\u3001\u5bb9\u5668\u3001\u6846\u67b6\uff09</li> <li>\u590d\u6742\u6027\u4ece\u4ee3\u7801\u8f6c\u79fb\u5230\u57fa\u7840\u8bbe\u65bd</li> <li>RPC \u8c03\u7528\u548c\u7f51\u7edc\u901a\u4fe1\u7684\u5927\u91cf\u589e\u52a0</li> <li>\u6574\u4e2a\u7cfb\u7edf\u7684\u5b89\u5168\u6027\u7ba1\u7406\u66f4\u5177\u6709\u6311\u6218\u6027</li> <li>\u6574\u4e2a\u7cfb\u7edf\u7684\u8bbe\u8ba1\u53d8\u5f97\u66f4\u52a0\u56f0\u96be</li> <li>\u5f15\u5165\u4e86\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u590d\u6742\u6027</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#25","title":"2.5 \u4f55\u65f6\u4f7f\u7528\u5fae\u670d\u52a1\u67b6\u6784","text":"<ul> <li>\u5927\u89c4\u6a21 Web \u5e94\u7528\u5f00\u53d1</li> <li>\u8de8\u56e2\u961f\u4f01\u4e1a\u7ea7\u5e94\u7528\u534f\u4f5c\u5f00\u53d1</li> <li>\u957f\u671f\u6536\u76ca\u4f18\u5148\u4e8e\u77ed\u671f\u6536\u76ca</li> <li>\u56e2\u961f\u62e5\u6709\u80fd\u591f\u8bbe\u8ba1\u5fae\u670d\u52a1\u67b6\u6784\u7684\u8f6f\u4ef6\u67b6\u6784\u5e08\u6216\u9ad8\u7ea7\u5de5\u7a0b\u5e08</li> </ul>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5fae\u670d\u52a1\u67b6\u6784\u8bbe\u8ba1\u6a21\u5f0f","text":""},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#31-database-per-microservice","title":"3.1 \u72ec\u4eab\u6570\u636e\u5e93\uff08Database per Microservice\uff09","text":"<p>\u5f53\u4e00\u5bb6\u516c\u53f8\u5c06\u5927\u578b\u5355\u4f53\u7cfb\u7edf\u66ff\u6362\u6210\u4e00\u7ec4\u5fae\u670d\u52a1\uff0c\u9996\u5148\u8981\u9762\u4e34\u7684\u6700\u91cd\u8981\u51b3\u7b56\u662f\u5173\u4e8e\u6570\u636e\u5e93\u3002\u5355\u4f53\u67b6\u6784\u4f1a\u4f7f\u7528\u5927\u578b\u4e2d\u592e\u6570\u636e\u5e93\u3002\u5373\u4f7f\u8f6c\u79fb\u5230\u5fae\u670d\u52a1\u67b6\u6784\u8bb8\u591a\u67b6\u6784\u5e08\u4ecd\u503e\u5411\u4e8e\u4fdd\u6301\u6570\u636e\u5e93\u4e0d\u53d8\u3002\u867d\u7136\u6709\u4e00\u4e9b\u77ed\u671f\u6536\u76ca\uff0c\u4f46\u5b83\u5374\u662f\u53cd\u6a21\u5f0f\u7684\uff0c\u7279\u522b\u662f\u5728\u5927\u89c4\u6a21\u7cfb\u7edf\u4e2d\uff0c\u5fae\u670d\u52a1\u5c06\u5728\u6570\u636e\u5e93\u5c42\u4e25\u91cd\u8026\u5408\uff0c\u6574\u4e2a\u8fc1\u79fb\u5230\u5fae\u670d\u52a1\u7684\u76ee\u6807\u90fd\u5c06\u9762\u4e34\u5931\u8d25\uff08\u4f8b\u5982\uff0c\u56e2\u961f\u6388\u6743\u3001\u72ec\u7acb\u5f00\u53d1\u7b49\u95ee\u9898\uff09\u3002</p> <p>\u66f4\u597d\u7684\u65b9\u6cd5\u662f\u4e3a\u6bcf\u4e2a\u5fae\u670d\u52a1\u63d0\u4f9b\u81ea\u5df1\u7684\u6570\u636e\u5b58\u50a8\uff0c\u8fd9\u6837\u670d\u52a1\u4e4b\u95f4\u5728\u6570\u636e\u5e93\u5c42\u5c31\u4e0d\u5b58\u5728\u5f3a\u8026\u5408\u3002\u8fd9\u91cc\u6211\u4f7f\u7528\u6570\u636e\u5e93\u8fd9\u4e00\u672f\u8bed\u6765\u8868\u793a\u903b\u8f91\u4e0a\u7684\u6570\u636e\u9694\u79bb\uff0c\u4e5f\u5c31\u662f\u8bf4\u5fae\u670d\u52a1\u53ef\u4ee5\u5171\u4eab\u7269\u7406\u6570\u636e\u5e93\uff0c\u4f46\u5e94\u8be5\u4f7f\u7528\u5206\u5f00\u7684\u6570\u636e\u7ed3\u6784\u3001\u96c6\u5408\u6216\u8005\u8868\uff0c\u8fd9\u8fd8\u5c06\u6709\u52a9\u4e8e\u786e\u4fdd\u5fae\u670d\u52a1\u662f\u6309\u7167\u9886\u57df\u9a71\u52a8\u8bbe\u8ba1\u7684\u65b9\u6cd5\u6b63\u786e\u62c6\u5206\u7684\u3002</p> <p></p> <p>\u4f18\u70b9</p> <ul> <li>\u6570\u636e\u7531\u670d\u52a1\u5b8c\u5168\u6240\u6709</li> <li>\u670d\u52a1\u7684\u5f00\u53d1\u56e2\u961f\u4e4b\u95f4\u8026\u5408\u5ea6\u964d\u4f4e</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>\u670d\u52a1\u95f4\u7684\u6570\u636e\u5171\u4eab\u53d8\u5f97\u66f4\u6709\u6311\u6218\u6027</li> <li>\u5728\u5e94\u7528\u8303\u56f4\u7684\u4fdd\u8bc1 ACID \u4e8b\u52a1\u53d8\u5f97\u56f0\u96be\u8bb8\u591a</li> <li>\u7ec6\u5fc3\u8bbe\u8ba1\u5982\u4f55\u62c6\u5206\u5355\u4f53\u6570\u636e\u5e93\u662f\u4e00\u9879\u6781\u5177\u6311\u6218\u7684\u4efb\u52a1</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528\u72ec\u4eab\u6570\u636e\u5e93</p> <ul> <li>\u5728\u5927\u578b\u4f01\u4e1a\u5e94\u7528\u7a0b\u5e8f\u4e2d</li> <li>\u5f53\u56e2\u961f\u9700\u8981\u5b8c\u5168\u628a\u63a7\u5fae\u670d\u52a1\u4ee5\u5b9e\u73b0\u5f00\u53d1\u89c4\u6a21\u6269\u5c55\u548c\u901f\u5ea6\u63d0\u5347</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528\u72ec\u4eab\u6570\u636e\u5e93</p> <ul> <li>\u5728\u5c0f\u89c4\u6a21\u5e94\u7528\u4e2d</li> <li>\u5982\u679c\u662f\u5355\u4e2a\u56e2\u961f\u5f00\u53d1\u6240\u6709\u5fae\u670d\u52a1</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>\u6240\u6709 SQL\u3001 NoSQL \u6570\u636e\u5e93\u90fd\u63d0\u4f9b\u6570\u636e\u7684\u903b\u8f91\u5206\u79bb\uff08\u4f8b\u5982\uff0c\u5355\u72ec\u7684\u8868\u3001\u96c6\u5408\u3001\u7ed3\u6784\u3001\u6570\u636e\u5e93\uff09\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#32-event-sourcing","title":"3.2 \u4e8b\u4ef6\u6e90\uff08Event Sourcing\uff09","text":"<p>\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u7279\u522b\u4f7f\u7528\u72ec\u4eab\u6570\u636e\u5e93\u65f6\uff0c\u5fae\u670d\u52a1\u4e4b\u95f4\u9700\u8981\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u3002\u5bf9\u4e8e\u5f39\u6027\u9ad8\u53ef\u4f38\u7f29\u7684\u548c\u53ef\u5bb9\u9519\u7684\u7cfb\u7edf\uff0c\u5b83\u4eec\u5e94\u8be5\u901a\u8fc7\u4ea4\u6362\u4e8b\u4ef6\u8fdb\u884c\u5f02\u6b65\u901a\u4fe1\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u8fdb\u884c\u7c7b\u4f3c\u66f4\u65b0\u6570\u636e\u5e93\u5e76\u53d1\u9001\u6d88\u606f\u8fd9\u6837\u7684\u539f\u5b50\u64cd\u4f5c\uff0c\u5982\u679c\u5728\u5927\u6570\u636e\u91cf\u7684\u5206\u5e03\u5f0f\u573a\u666f\u4f7f\u7528\u5173\u7cfb\u6570\u636e\u5e93\uff0c\u60a8\u5c06\u65e0\u6cd5\u4f7f\u7528\u4e24\u9636\u6bb5\u9501\u534f\u8bae\uff082PL\uff09\uff0c\u56e0\u4e3a\u5b83\u65e0\u6cd5\u4f38\u7f29\u3002\u800c NoSQL \u6570\u636e\u5e93\u56e0\u4e3a\u5927\u591a\u4e0d\u652f\u6301\u4e24\u9636\u6bb5\u9501\u534f\u8bae\u751a\u81f3\u65e0\u6cd5\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002</p> <p>\u5728\u8fd9\u4e9b\u573a\u666f\uff0c\u53ef\u4ee5\u57fa\u4e8e\u4e8b\u4ef6\u7684\u67b6\u6784\u4f7f\u7528\u4e8b\u4ef6\u6e90\u6a21\u5f0f\u3002\u5728\u4f20\u7edf\u6570\u636e\u5e93\u4e2d\uff0c\u76f4\u63a5\u5b58\u50a8\u7684\u662f\u4e1a\u52a1\u5b9e\u4f53\u7684\u5f53\u524d\u201c\u72b6\u6001\u201d\uff0c\u800c\u5728\u4e8b\u4ef6\u6e90\u4e2d\u4efb\u4f55\u201c\u72b6\u6001\u201d\u66f4\u65b0\u4e8b\u4ef6\u6216\u5176\u4ed6\u91cd\u8981\u4e8b\u4ef6\u90fd\u4f1a\u88ab\u5b58\u50a8\u8d77\u6765\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5b58\u50a8\u5b9e\u4f53\u672c\u8eab\u3002\u8fd9\u610f\u5473\u7740\u4e1a\u52a1\u5b9e\u4f53\u7684\u6240\u6709\u66f4\u6539\u5c06\u88ab\u4fdd\u5b58\u4e3a\u4e00\u7cfb\u5217\u4e0d\u53ef\u53d8\u7684\u4e8b\u4ef6\u3002\u56e0\u4e3a\u6570\u636e\u662f\u4f5c\u4e3a\u4e00\u7cfb\u5217\u4e8b\u4ef6\u5b58\u50a8\u7684\uff0c\u800c\u975e\u76f4\u63a5\u66f4\u65b0\u5b58\u50a8\uff0c\u6240\u4ee5\u5404\u9879\u670d\u52a1\u53ef\u4ee5\u901a\u8fc7\u91cd\u653e\u4e8b\u4ef6\u5b58\u50a8\u4e2d\u7684\u4e8b\u4ef6\u6765\u8ba1\u7b97\u51fa\u6240\u9700\u7684\u6570\u636e\u72b6\u6001\u3002</p> <p></p> <p>\u4f18\u70b9</p> <ul> <li>\u4e3a\u9ad8\u53ef\u4f38\u7f29\u7cfb\u7edf\u63d0\u4f9b\u539f\u5b50\u6027\u64cd\u4f5c</li> <li>\u81ea\u52a8\u8bb0\u5f55\u5b9e\u4f53\u53d8\u66f4\u5386\u53f2\uff0c\u5305\u62ec\u65f6\u5e8f\u56de\u6eaf\u529f\u80fd</li> <li>\u677e\u8026\u5408\u548c\u4e8b\u4ef6\u9a71\u52a8\u7684\u5fae\u670d\u52a1</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>\u4ece\u4e8b\u4ef6\u5b58\u50a8\u4e2d\u8bfb\u53d6\u5b9e\u4f53\u6210\u4e3a\u65b0\u7684\u6311\u6218\uff0c\u901a\u5e38\u9700\u8981\u989d\u5916\u7684\u6570\u636e\u5b58\u50a8\uff08CQRS \u6a21\u5f0f\uff09\u3002</li> <li>\u7cfb\u7edf\u6574\u4f53\u590d\u6742\u6027\u589e\u52a0\u4e86\uff0c\u901a\u5e38\u9700\u8981\u9886\u57df\u9a71\u52a8\u8bbe\u8ba1\u3002</li> <li>\u7cfb\u7edf\u9700\u8981\u5904\u7406\u4e8b\u4ef6\u91cd\u590d\uff08\u5e42\u7b49\uff09\u6216\u4e22\u5931</li> <li>\u53d8\u66f4\u4e8b\u4ef6\u7ed3\u6784\u6210\u4e3a\u65b0\u7684\u6311\u6218\u3002</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528\u4e8b\u4ef6\u6e90</p> <ul> <li>\u4f7f\u7528\u5173\u7cfb\u6570\u636e\u5e93\u7684\u3001\u9ad8\u53ef\u4f38\u7f29\u7684\u4e8b\u52a1\u578b\u7cfb\u7edf</li> <li>\u4f7f\u7528 NoSQL \u6570\u636e\u5e93\u7684\u4e8b\u52a1\u578b\u7cfb\u7edf</li> <li>\u5f39\u6027\u9ad8\u53ef\u4f38\u7f29\u5fae\u670d\u52a1\u67b6\u6784</li> <li>\u5178\u578b\u7684\u6d88\u606f\u9a71\u52a8\u6216\u4e8b\u4ef6\u9a71\u52a8\u7cfb\u7edf\uff08\u7535\u5b50\u5546\u52a1\u3001\u9884\u8ba2\u548c\u9884\u7ea6\u7cfb\u7edf\uff09</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528\u4e8b\u4ef6\u6e90</p> <ul> <li>\u4f7f\u7528 SQL \u6570\u636e\u5e93\u7684\u4f4e\u53ef\u4f38\u7f29\u6027\u4e8b\u52a1\u578b\u7cfb\u7edf</li> <li>\u5728\u670d\u52a1\u53ef\u4ee5\u540c\u6b65\u4ea4\u6362\u6570\u636e\uff08\u4f8b\u5982\uff0c\u901a\u8fc7 API\uff09\u7684\u7b80\u5355\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u3002</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>\u4e8b\u4ef6\u5b58\u50a8\uff1aEventStoreDB\u3001Apache Kafka\u3001Confluent Cloud\u3001AWS Kinesis\u3001Azure Event Hub\u3001GCP Pub/Sub\u3001Azure Cosmos DB\u3001MongoDB\u3001Cassandra\u3001Amazon DynamoDB</p> <p>\u6846\u67b6\uff1aLagom\u3001Akka\u3001Spring\u3001akkatecture\u3001Axon\u3001Eventuate</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#33-cqrs","title":"3.3 \u547d\u4ee4\u548c\u67e5\u8be2\u804c\u8d23\u5206\u79bb\uff08CQRS\uff09","text":"<p>\u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e8b\u4ef6\u6e90\uff0c\u90a3\u4e48\u4ece\u4e8b\u4ef6\u5b58\u50a8\u4e2d\u8bfb\u53d6\u6570\u636e\u5c31\u53d8\u5f97\u56f0\u96be\u4e86\u3002\u8981\u4ece\u6570\u636e\u5b58\u50a8\u4e2d\u83b7\u53d6\u5b9e\u4f53\uff0c\u6211\u4eec\u9700\u8981\u5904\u7406\u6240\u6709\u7684\u5b9e\u4f53\u4e8b\u4ef6\u3002\u6709\u65f6\u6211\u4eec\u5bf9\u8bfb\u5199\u64cd\u4f5c\u8fd8\u4f1a\u6709\u4e0d\u540c\u7684\u4e00\u81f4\u6027\u548c\u541e\u5410\u91cf\u8981\u6c42\u3002</p> <p>\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 CQRS \u6a21\u5f0f\u3002\u5728\u8be5\u6a21\u5f0f\u4e2d\uff0c\u7cfb\u7edf\u7684\u6570\u636e\u4fee\u6539\u90e8\u5206\uff08\u547d\u4ee4\uff09\u4e0e\u6570\u636e\u8bfb\u53d6\u90e8\u5206\uff08\u67e5\u8be2\uff09\u662f\u5206\u79bb\u7684\u3002\u800c CQRS \u6a21\u5f0f\u6709\u4e24\u79cd\u5bb9\u6613\u4ee4\u4eba\u6df7\u6dc6\u7684\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u7b80\u5355\u7684\u548c\u9ad8\u7ea7\u7684\u3002</p> <p>\u5728\u5176\u7b80\u5355\u5f62\u5f0f\u4e2d\uff0c\u4e0d\u540c\u5b9e\u4f53\u6216 ORM \u6a21\u578b\u88ab\u7528\u4e8e\u8bfb\u5199\u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u5b83\u6709\u52a9\u4e8e\u5f3a\u5316\u5355\u4e00\u804c\u8d23\u539f\u5219\u548c\u5206\u79bb\u5173\u6ce8\u70b9\uff0c\u4ece\u800c\u5b9e\u73b0\u66f4\u7b80\u6d01\u7684\u8bbe\u8ba1\u3002</p> <p>\u5728\u5176\u9ad8\u7ea7\u5f62\u5f0f\u4e2d\uff0c\u4f1a\u6709\u4e0d\u540c\u7684\u6570\u636e\u5b58\u50a8\u7528\u4e8e\u8bfb\u5199\u64cd\u4f5c\u3002\u9ad8\u7ea7\u7684 CQRS \u901a\u5e38\u7ed3\u5408\u4e8b\u4ef6\u6e90\u6a21\u5f0f\u3002\u6839\u636e\u4e0d\u540c\u60c5\u51b5\uff0c\u4f1a\u4f7f\u7528\u4e0d\u540c\u7c7b\u578b\u7684\u5199\u6570\u636e\u5b58\u50a8\u548c\u8bfb\u6570\u636e\u5b58\u50a8\u3002\u5199\u6570\u636e\u5b58\u50a8\u662f\u201c\u8bb0\u5f55\u7684\u7cfb\u7edf\u201d\uff0c\u4e5f\u5c31\u662f\u6574\u4e2a\u7cfb\u7edf\u7684\u6838\u5fc3\u6e90\u5934\u3002</p> <p></p> <p>\u5bf9\u4e8e\u8bfb\u9891\u7e41\u7684\u5e94\u7528\u7a0b\u5e8f\u6216\u5fae\u670d\u52a1\u67b6\u6784\uff0cOLTP \u6570\u636e\u5e93\uff08\u4efb\u4f55\u63d0\u4f9b ACID \u4e8b\u52a1\u4fdd\u8bc1\u7684\u5173\u7cfb\u6216\u975e\u5173\u7cfb\u6570\u636e\u5e93\uff09\u6216\u5206\u5e03\u5f0f\u6d88\u606f\u7cfb\u7edf\u90fd\u53ef\u4ee5\u88ab\u7528\u4f5c\u5199\u5b58\u50a8\u3002\u5bf9\u4e8e\u5199\u9891\u7e41\u7684\u5e94\u7528\u7a0b\u5e8f\uff08\u5199\u64cd\u4f5c\u9ad8\u53ef\u4f38\u7f29\u6027\u548c\u5927\u541e\u5410\u91cf\uff09\uff0c\u9700\u8981\u4f7f\u7528\u5199\u53ef\u6c34\u5e73\u4f38\u7f29\u7684\u6570\u636e\u5e93\uff08\u5982\u5168\u7403\u6258\u7ba1\u7684\u516c\u5171\u4e91\u6570\u636e\u5e93\uff09\u3002\u6807\u51c6\u5316\u7684\u6570\u636e\u5219\u4fdd\u5b58\u5728\u5199\u6570\u636e\u5b58\u50a8\u4e2d\u3002</p> <p>\u5bf9\u641c\u7d22\uff08\u4f8b\u5982 Apache Solr\u3001Elasticsearch\uff09\u6216\u8bfb\u64cd\u4f5c\uff08KV \u6570\u636e\u5e93\u3001\u6587\u6863\u6570\u636e\u5e93\uff09\u8fdb\u884c\u4f18\u5316\u7684\u975e\u5173\u7cfb\u6570\u636e\u5e93\u5e38\u88ab\u7528\u4f5c\u8bfb\u5b58\u50a8\u3002\u8bb8\u591a\u60c5\u51b5\u4f1a\u5728\u9700\u8981 SQL \u67e5\u8be2\u7684\u5730\u65b9\u4f7f\u7528\u8bfb\u53ef\u4f38\u7f29\u7684\u5173\u7cfb\u6570\u636e\u5e93\u3002\u975e\u6807\u51c6\u5316\u548c\u7279\u6b8a\u4f18\u5316\u8fc7\u7684\u6570\u636e\u5219\u4fdd\u5b58\u5728\u8bfb\u5b58\u50a8\u4e2d\u3002</p> <p>\u6570\u636e\u662f\u4ece\u5199\u5b58\u50a8\u5f02\u6b65\u590d\u5236\u5230\u8bfb\u5b58\u50a8\u4e2d\u7684\uff0c\u6240\u4ee5\u8bfb\u5b58\u50a8\u548c\u5199\u5b58\u50a8\u4e4b\u95f4\u4f1a\u6709\u5ef6\u8fdf\uff0c\u4f46\u6700\u7ec8\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u4f18\u70b9</p> <ul> <li>\u5728\u4e8b\u4ef6\u9a71\u52a8\u7684\u5fae\u670d\u52a1\u4e2d\u6570\u636e\u8bfb\u53d6\u901f\u5ea6\u66f4\u5feb</li> <li>\u6570\u636e\u7684\u9ad8\u53ef\u7528\u6027</li> <li>\u8bfb\u5199\u7cfb\u7edf\u53ef\u72ec\u7acb\u6269\u5c55</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>\u8bfb\u6570\u636e\u5b58\u50a8\u662f\u5f31\u4e00\u81f4\u6027\u7684\uff08\u6700\u7ec8\u4e00\u81f4\u6027\uff09</li> <li>\u6574\u4e2a\u7cfb\u7edf\u7684\u590d\u6742\u6027\u589e\u52a0\u4e86\uff0c\u6df7\u4e71\u7684 CQRS \u4f1a\u663e\u7740\u5371\u5bb3\u6574\u4e2a\u9879\u76ee\u3002</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528 CQRS</p> <ul> <li>\u5728\u9ad8\u53ef\u6269\u5c55\u7684\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u4f7f\u7528\u4e8b\u4ef6\u6e90</li> <li>\u5728\u590d\u6742\u9886\u57df\u6a21\u578b\u4e2d\uff0c\u8bfb\u64cd\u4f5c\u9700\u8981\u540c\u65f6\u67e5\u8be2\u591a\u4e2a\u6570\u636e\u5b58\u50a8\u3002</li> <li>\u5728\u8bfb\u5199\u64cd\u4f5c\u8d1f\u8f7d\u5dee\u5f02\u660e\u663e\u7684\u7cfb\u7edf\u4e2d</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528 CQRS</p> <ul> <li>\u5728\u6ca1\u6709\u5fc5\u8981\u5b58\u50a8\u5927\u91cf\u4e8b\u4ef6\u7684\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u7528\u4e8b\u4ef6\u5b58\u50a8\u5feb\u7167\u6765\u8ba1\u7b97\u5b9e\u4f53\u72b6\u6001\u662f\u4e00\u4e2a\u66f4\u597d\u7684\u9009\u62e9\u3002</li> <li>\u5728\u8bfb\u5199\u64cd\u4f5c\u8d1f\u8f7d\u76f8\u8fd1\u7684\u7cfb\u7edf\u4e2d\u3002</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>\u5199\u5b58\u50a8\uff1aEventStoreDB\uff0c Apache Kafka\uff0c Confluent Cloud\uff0c AWS Kinesis\uff0c Azure Event Hub\uff0c GCP Pub/Sub\uff0c Azure Cosmos DB\uff0c MongoDB\uff0c Cassandra. Amazon DynamoDB</p> <p>\u8bfb\u5b58\u50a8\uff1aElastic Search\uff0c Solr\uff0c Cloud Spanner\uff0c Amazon Aurora\uff0c Azure Cosmos DB\uff0c Neo4j</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#34-saga","title":"3.4 Saga","text":"<p>\u5982\u679c\u5fae\u670d\u52a1\u4f7f\u7528\u72ec\u4eab\u6570\u636e\u5e93\uff0c\u90a3\u4e48\u901a\u8fc7\u5206\u5e03\u5f0f\u4e8b\u52a1\u7ba1\u7406\u4e00\u81f4\u6027\u662f\u4e00\u4e2a\u5de8\u5927\u7684\u6311\u6218\u3002\u4f60\u65e0\u6cd5\u4f7f\u7528\u4f20\u7edf\u7684\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\uff0c\u56e0\u4e3a\u5b83\u8981\u4e48\u4e0d\u53ef\u4f38\u7f29\uff08\u5173\u7cfb\u6570\u636e\u5e93\uff09\uff0c\u8981\u4e48\u4e0d\u88ab\u652f\u6301\uff08\u591a\u6570\u975e\u5173\u7cfb\u6570\u636e\u5e93\uff09\u3002</p> <p>\u4f46\u60a8\u8fd8\u662f\u53ef\u4ee5\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u4f7f\u7528 Saga \u6a21\u5f0f\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002Saga \u662f 1987 \u5e74\u5f00\u53d1\u7684\u4e00\u79cd\u53e4\u8001\u6a21\u5f0f\uff0c\u662f\u5173\u7cfb\u6570\u636e\u5e93\u4e2d\u5173\u4e8e\u5927\u4e8b\u52a1\u7684\u4e00\u4e2a\u66ff\u4ee3\u6982\u5ff5\u3002\u4f46\u8fd9\u79cd\u6a21\u5f0f\u7684\u4e00\u79cd\u73b0\u4ee3\u53d8\u79cd\u5bf9\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e5f\u975e\u5e38\u6709\u6548\u3002Saga \u6a21\u5f0f\u662f\u4e00\u4e2a\u672c\u5730\u4e8b\u52a1\u5e8f\u5217\uff0c\u5176\u6bcf\u4e2a\u4e8b\u52a1\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u5fae\u670d\u52a1\u5185\u66f4\u65b0\u6570\u636e\u5b58\u50a8\u5e76\u53d1\u5e03\u4e00\u4e2a\u4e8b\u4ef6\u6216\u6d88\u606f\u3002Saga \u4e2d\u7684\u9996\u4e2a\u4e8b\u52a1\u662f\u7531\u5916\u90e8\u8bf7\u6c42\uff08\u4e8b\u4ef6\u6216\u52a8\u4f5c\uff09\u521d\u59cb\u5316\u7684\uff0c\u4e00\u65e6\u672c\u5730\u4e8b\u52a1\u5b8c\u6210\uff08\u6570\u636e\u5df2\u4fdd\u5b58\u5728\u6570\u636e\u5b58\u50a8\u4e14\u6d88\u606f\u6216\u4e8b\u4ef6\u5df2\u53d1\u5e03\uff09\uff0c\u90a3\u4e48\u53d1\u5e03\u7684\u6d88\u606f\u6216\u4e8b\u4ef6\u5219\u4f1a\u89e6\u53d1 Saga \u4e2d\u7684\u4e0b\u4e00\u4e2a\u672c\u5730\u4e8b\u52a1\u3002</p> <p></p> <p>\u5982\u679c\u672c\u5730\u4e8b\u52a1\u5931\u8d25\uff0cSaga \u5c06\u6267\u884c\u4e00\u7cfb\u5217\u8865\u507f\u4e8b\u52a1\u6765\u56de\u6eda\u524d\u9762\u672c\u5730\u4e8b\u52a1\u7684\u66f4\u6539\u3002</p> <p>Saga \u4e8b\u52a1\u534f\u8c03\u7ba1\u7406\u4e3b\u8981\u6709\u4e24\u79cd\u5f62\u5f0f\uff1a</p> <ol> <li>\u4e8b\u4ef6\u7f16\u6392 Choreography\uff1a\u5206\u6563\u534f\u8c03\uff0c\u6bcf\u4e2a\u5fae\u670d\u52a1\u751f\u4ea7\u5e76\u76d1\u542c\u5176\u4ed6\u5fae\u670d\u52a1\u7684\u4e8b\u4ef6\u6216\u6d88\u606f\u7136\u540e\u51b3\u5b9a\u662f\u5426\u6267\u884c\u67d0\u4e2a\u52a8\u4f5c\u3002</li> <li>\u547d\u4ee4\u7f16\u6392 Orchestration\uff1a\u96c6\u4e2d\u534f\u8c03\uff0c\u7531\u4e00\u4e2a\u534f\u8c03\u5668\u544a\u8bc9\u53c2\u4e0e\u7684\u5fae\u670d\u52a1\u54ea\u4e2a\u672c\u5730\u4e8b\u52a1\u9700\u8981\u6267\u884c\u3002</li> </ol> <p>\u4f18\u70b9</p> <ul> <li>\u4e3a\u9ad8\u53ef\u4f38\u7f29\u6216\u677e\u8026\u5408\u7684\u3001\u4e8b\u4ef6\u9a71\u52a8\u7684\u5fae\u670d\u52a1\u67b6\u6784\u63d0\u4f9b\u4e00\u81f4\u6027\u4e8b\u52a1\u3002</li> <li>\u4e3a\u4f7f\u7528\u4e86\u4e0d\u652f\u6301 2PC \u7684\u975e\u5173\u7cfb\u6570\u636e\u5e93\u7684\u5fae\u670d\u52a1\u67b6\u6784\u63d0\u4f9b\u4e00\u81f4\u6027\u4e8b\u52a1\u3002</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>\u9700\u8981\u5904\u7406\u77ac\u65f6\u6545\u969c\uff0c\u5e76\u4e14\u63d0\u4f9b\u7b49\u5e42\u6027\u3002</li> <li>\u96be\u4ee5\u8c03\u8bd5\uff0c\u800c\u4e14\u590d\u6742\u6027\u968f\u7740\u5fae\u670d\u52a1\u6570\u91cf\u589e\u52a0\u800c\u589e\u52a0\u3002</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528 Saga</p> <ul> <li>\u5728\u4f7f\u7528\u4e86\u4e8b\u4ef6\u6e90\u7684\u9ad8\u53ef\u4f38\u7f29\u3001\u677e\u8026\u5408\u7684\u5fae\u670d\u52a1\u4e2d\u3002</li> <li>\u5728\u4f7f\u7528\u4e86\u5206\u5e03\u5f0f\u975e\u5173\u7cfb\u6570\u636e\u5e93\u7684\u7cfb\u7edf\u4e2d\u3002</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528 Saga</p> <ul> <li>\u4f7f\u7528\u5173\u7cfb\u6570\u636e\u5e93\u7684\u4f4e\u53ef\u4f38\u7f29\u6027\u4e8b\u52a1\u578b\u7cfb\u7edf\u3002</li> <li>\u5728\u670d\u52a1\u95f4\u5b58\u5728\u5faa\u73af\u4f9d\u8d56\u7684\u7cfb\u7edf\u4e2d\u3002</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>Axon\uff0c Eventuate\uff0c Narayana</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#35-bff","title":"3.5 \u9762\u5411\u524d\u7aef\u7684\u540e\u7aef \uff08BFF\uff09","text":"<p>\u5728\u73b0\u4ee3\u5546\u4e1a\u5e94\u7528\u5f00\u53d1\uff0c\u7279\u522b\u662f\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u524d\u540e\u7aef\u5e94\u7528\u662f\u5206\u79bb\u548c\u72ec\u7acb\u7684\u670d\u52a1\uff0c\u5b83\u4eec\u901a\u8fc7 API \u6216 GraphQL \u8fde\u63a5\u3002\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u8fd8\u6709\u79fb\u52a8 App \u5ba2\u6237\u7aef\uff0c\u90a3\u4e48 Web \u7aef\u548c\u79fb\u52a8\u5ba2\u6237\u7aef\u4f7f\u7528\u76f8\u540c\u7684\u540e\u7aef\u5fae\u670d\u52a1\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\u56e0\u4e3a\u79fb\u52a8\u5ba2\u6237\u7aef\u548c Web \u5ba2\u6237\u7aef\u6709\u4e0d\u540c\u7684\u5c4f\u5e55\u5c3a\u5bf8\u3001\u663e\u793a\u5c4f\u3001\u6027\u80fd\u3001\u80fd\u8017\u548c\u7f51\u7edc\u5e26\u5bbd\uff0c\u5b83\u4eec\u7684 API \u9700\u6c42\u4e0d\u540c\u3002</p> <p>\u9762\u5411\u524d\u7aef\u7684\u540e\u7aef\u6a21\u5f0f\u9002\u7528\u4e8e\u9700\u8981\u4e3a\u7279\u6b8a UI \u5b9a\u5236\u5355\u72ec\u540e\u7aef\u7684\u573a\u666f\u3002\u5b83\u8fd8\u63d0\u4f9b\u4e86\u5176\u4ed6\u4f18\u52bf\uff0c\u6bd4\u5982\u4f5c\u4e3a\u4e0b\u6e38\u5fae\u670d\u52a1\u7684\u5c01\u88c5\uff0c\u4ece\u800c\u51cf\u5c11 UI \u548c\u4e0b\u6e38\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u9891\u7e41\u901a\u4fe1\u3002\u6b64\u5916\uff0c\u5728\u9ad8\u5b89\u5168\u8981\u6c42\u7684\u573a\u666f\u4e2d\uff0cBFF \u4e3a\u90e8\u7f72\u5728 DMZ \u7f51\u7edc\u4e2d\u7684\u4e0b\u6e38\u5fae\u670d\u52a1\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7684\u5b89\u5168\u6027\u3002</p> <p></p> <p>\u4f18\u70b9</p> <ul> <li>\u5206\u79bb BFF \u4e4b\u95f4\u7684\u5173\u6ce8\u70b9\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u4e3a\u5177\u4f53\u7684 UI \u4f18\u5316\u4ed6\u4eec\u3002</li> <li>\u63d0\u4f9b\u66f4\u9ad8\u7684\u5b89\u5168\u6027</li> <li>\u51cf\u5c11 UI \u548c\u4e0b\u6e38\u5fae\u670d\u52a1\u4e4b\u95f4\u9891\u7e41\u7684\u901a\u4fe1</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>BFF \u4e4b\u95f4\u4ee3\u7801\u91cd\u590d</li> <li>\u5927\u91cf\u7684 BFF \u7528\u4e8e\u5176\u4ed6\u7528\u6237\u754c\u9762\uff08\u4f8b\u5982\uff0c\u667a\u80fd\u7535\u89c6\uff0cWeb\uff0c\u79fb\u52a8\u7aef\uff0cPC \u684c\u9762\u7248\uff09</li> <li>\u9700\u8981\u4ed4\u7ec6\u7684\u8bbe\u8ba1\u548c\u5b9e\u73b0\uff0cBFF \u4e0d\u5e94\u8be5\u5305\u542b\u4efb\u4f55\u4e1a\u52a1\u903b\u8f91\uff0c\u800c\u5e94\u53ea\u5305\u542b\u7279\u5b9a\u5ba2\u6237\u7aef\u903b\u8f91\u548c\u884c\u4e3a\u3002</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528 BFF</p> <ul> <li>\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u6709\u591a\u4e2a\u542b\u4e0d\u540c API \u9700\u6c42\u7684 UI</li> <li>\u51fa\u4e8e\u5b89\u5168\u9700\u8981\uff0cUI \u548c\u4e0b\u6e38\u5fae\u670d\u52a1\u4e4b\u95f4\u9700\u8981\u989d\u5916\u7684\u5c42\u3002</li> <li>\u5982\u679c\u5728 UI \u5f00\u53d1\u4e2d\u4f7f\u7528\u5fae\u524d\u7aef\u3002</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528 BFF</p> <ul> <li>\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u867d\u6709\u591a\u4e2a UI\uff0c\u4f46\u4f7f\u7528\u7684 API \u76f8\u540c\u3002</li> <li>\u5982\u679c\u6838\u5fc3\u5fae\u670d\u52a1\u4e0d\u662f\u90e8\u7f72\u5728 DMZ \u7f51\u7edc\u4e2d\u3002</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>\u4efb\u4f55\u540e\u7aef\u6846\u67b6\uff08Node.js\uff0cSpring\uff0cDjango\uff0cLaravel\uff0cFlask\uff0cPlay\uff0c\u2026\uff09\u90fd\u80fd\u652f\u6301\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#36-api","title":"3.6 API\u7f51\u5173","text":"<p>\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0cUI \u901a\u5e38\u8fde\u63a5\u591a\u4e2a\u5fae\u670d\u52a1\u3002\u5982\u679c\u5fae\u670d\u52a1\u662f\u7ec6\u7c92\u5ea6\u7684\uff08FaaS\uff09 \uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u53ef\u80fd\u9700\u8981\u8fde\u63a5\u975e\u5e38\u591a\u7684\u5fae\u670d\u52a1\uff0c\u8fd9\u5c06\u53d8\u5f97\u7e41\u6742\u548c\u5177\u6709\u6311\u6218\u6027\u3002\u6b64\u5916\uff0c\u8fd9\u4e9b\u670d\u52a1\u5305\u62ec\u5b83\u4eec\u7684 API \u8fd8\u5c06\u4e0d\u65ad\u8fdb\u5316\u3002\u5927\u578b\u4f01\u4e1a\u8fd8\u5e0c\u671b\u80fd\u6709\u5176\u4ed6\u6a2a\u5207\u5173\u6ce8\u70b9\uff08SSL \u7ec8\u6b62\u3001\u8eab\u4efd\u9a8c\u8bc1\u3001\u6388\u6743\u3001\u8282\u6d41\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\uff09\u3002</p> <p>\u4e00\u4e2a\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u7684\u53ef\u884c\u65b9\u6cd5\u662f\u4f7f\u7528 API \u7f51\u5173\u3002API \u7f51\u5173\u4f4d\u4e8e\u5ba2\u6237\u7aef APP \u548c\u540e\u7aef\u5fae\u670d\u52a1\u4e4b\u95f4\u5145\u5f53 facade\uff0c\u5b83\u53ef\u4ee5\u662f\u53cd\u5411\u4ee3\u7406\uff0c\u5c06\u5ba2\u6237\u7aef\u8bf7\u6c42\u8def\u7531\u5230\u9002\u5f53\u7684\u540e\u7aef\u5fae\u670d\u52a1\u3002\u5b83\u8fd8\u652f\u6301\u5c06\u5ba2\u6237\u7aef\u8bf7\u6c42\u6247\u51fa\u5230\u591a\u4e2a\u5fae\u670d\u52a1\uff0c\u7136\u540e\u5c06\u54cd\u5e94\u805a\u5408\u540e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u5b83\u8fd8\u652f\u6301\u5fc5\u8981\u7684\u6a2a\u5207\u5173\u6ce8\u70b9\u3002</p> <p></p> <p>\u4f18\u70b9</p> <ul> <li>\u5728\u524d\u7aef\u548c\u540e\u7aef\u670d\u52a1\u4e4b\u95f4\u63d0\u4f9b\u677e\u8026\u5408</li> <li>\u51cf\u5c11\u5ba2\u6237\u7aef\u548c\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u8c03\u7528\u6b21\u6570</li> <li>\u901a\u8fc7 SSL \u7ec8\u7aef\u3001\u8eab\u4efd\u9a8c\u8bc1\u548c\u6388\u6743\u5b9e\u73b0\u9ad8\u5b89\u5168\u6027</li> <li>\u96c6\u4e2d\u7ba1\u7406\u7684\u6a2a\u5207\u5173\u6ce8\u70b9\uff0c\u4f8b\u5982\uff0c\u65e5\u5fd7\u8bb0\u5f55\u548c\u76d1\u89c6\u3001\u8282\u6d41\u3001\u8d1f\u8f7d\u5e73\u8861\u3002</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>\u53ef\u80fd\u5bfc\u81f4\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u5355\u70b9\u6545\u969c</li> <li>\u989d\u5916\u7684\u7f51\u7edc\u8c03\u7528\u5e26\u6765\u7684\u5ef6\u8fdf\u589e\u52a0</li> <li>\u5982\u679c\u4e0d\u8fdb\u884c\u6269\u5c55\uff0c\u5b83\u4eec\u5f88\u5bb9\u6613\u6210\u4e3a\u6574\u4e2a\u4f01\u4e1a\u5e94\u7528\u7684\u74f6\u9888\u3002</li> <li>\u989d\u5916\u7684\u7ef4\u62a4\u548c\u5f00\u53d1\u8d39\u7528</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528 API \u7f51\u5173</p> <ul> <li>\u5728\u590d\u6742\u7684\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u5b83\u51e0\u4e4e\u662f\u5fc5\u987b\u7684\u3002</li> <li>\u5728\u5927\u578b\u4f01\u4e1a\u4e2d\uff0cAPI \u7f51\u5173\u662f\u4e2d\u5fc3\u5316\u5b89\u5168\u6027\u548c\u6a2a\u5207\u5173\u6ce8\u70b9\u7684\u5fc5\u8981\u5de5\u5177\u3002</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528 API \u7f51\u5173</p> <ul> <li>\u5728\u5b89\u5168\u548c\u96c6\u4e2d\u7ba1\u7406\u4e0d\u662f\u6700\u4f18\u5148\u8981\u7d20\u7684\u79c1\u4eba\u9879\u76ee\u6216\u5c0f\u516c\u53f8\u4e2d\u3002</li> <li>\u5982\u679c\u5fae\u670d\u52a1\u7684\u6570\u91cf\u76f8\u5f53\u5c11\u3002</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>Amazon API \u7f51\u5173\uff0c Azure API \u7ba1\u7406\uff0c Apigee\uff0c Kong\uff0c WSO2 API \u7ba1\u7406\u5668</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#37-strangler","title":"3.7 Strangler","text":"<p>\u5982\u679c\u60f3\u5728\u8fd0\u884c\u4e2d\u7684\u9879\u76ee\u4e2d\u4f7f\u7528\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u6211\u4eec\u9700\u8981\u5c06\u9057\u7559\u7684\u6216\u73b0\u6709\u7684\u5355\u4f53\u5e94\u7528\u8fc1\u79fb\u5230\u5fae\u670d\u52a1\u3002\u5c06\u73b0\u6709\u7684\u5927\u578b\u5728\u7ebf\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\u8fc1\u79fb\u5230\u5fae\u670d\u52a1\u662f\u76f8\u5f53\u6709\u6311\u6218\u6027\u7684\uff0c\u56e0\u4e3a\u8fd9\u53ef\u80fd\u7834\u574f\u5e94\u7528\u7a0b\u5e8f\u7684\u53ef\u7528\u6027\u3002</p> <p>\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\u662f\u4f7f\u7528 Strangler \u6a21\u5f0f\u3002Strangler \u6a21\u5f0f\u610f\u5473\u7740\u901a\u8fc7\u4f7f\u7528\u65b0\u7684\u5fae\u670d\u52a1\u9010\u6b65\u66ff\u6362\u7279\u5b9a\u529f\u80fd\uff0c\u5c06\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\u589e\u91cf\u5730\u8fc1\u79fb\u5230\u5fae\u670d\u52a1\u67b6\u6784\u3002\u6b64\u5916\uff0c\u65b0\u529f\u80fd\u53ea\u5728\u5fae\u670d\u52a1\u4e2d\u6dfb\u52a0\uff0c\u800c\u4e0d\u518d\u6dfb\u52a0\u5230\u9057\u7559\u7684\u5355\u4f53\u5e94\u7528\u4e2d\u3002\u7136\u540e\u914d\u7f6e\u4e00\u4e2a Facade \uff08API \u7f51\u5173\uff09\u6765\u8def\u7531\u9057\u7559\u5355\u4f53\u5e94\u7528\u548c\u5fae\u670d\u52a1\u95f4\u7684\u8bf7\u6c42\u3002\u5f53\u67d0\u4e2a\u529f\u80fd\u4ece\u5355\u4f53\u5e94\u7528\u8fc1\u79fb\u5230\u5fae\u670d\u52a1\uff0cFacade \u5c31\u4f1a\u62e6\u622a\u5ba2\u6237\u7aef\u8bf7\u6c42\u5e76\u8def\u7531\u5230\u65b0\u7684\u5fae\u670d\u52a1\u3002\u4e00\u65e6\u8fc1\u79fb\u4e86\u6240\u6709\u7684\u529f\u80fd\uff0c\u9057\u7559\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\u5c31\u4f1a\u88ab\u201c\u627c\u6740\uff08Strangler\uff09\u201d\uff0c\u5373\u9000\u5f79\u3002</p> <p></p> <p>\u4f18\u70b9</p> <ul> <li>\u5b89\u5168\u7684\u8fc1\u79fb\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\u5230\u5fae\u670d\u52a1</li> <li>\u53ef\u4ee5\u5e76\u884c\u5730\u8fc1\u79fb\u5df2\u6709\u529f\u80fd\u548c\u5f00\u53d1\u65b0\u529f\u80fd</li> <li>\u8fc1\u79fb\u8fc7\u7a0b\u53ef\u4ee5\u66f4\u597d\u628a\u63a7\u8282\u594f</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>\u5728\u73b0\u6709\u7684\u5355\u4f53\u5e94\u7528\u670d\u52a1\u548c\u65b0\u7684\u5fae\u670d\u52a1\u4e4b\u95f4\u5171\u4eab\u6570\u636e\u5b58\u50a8\u53d8\u5f97\u5177\u6709\u6311\u6218\u6027</li> <li>\u6dfb\u52a0 Facade \uff08API \u7f51\u5173\uff09\u5c06\u589e\u52a0\u7cfb\u7edf\u5ef6\u8fdf</li> <li>\u7aef\u5230\u7aef\u6d4b\u8bd5\u53d8\u5f97\u56f0\u96be</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528 Strangler</p> <ul> <li>\u5c06\u5927\u578b\u540e\u7aef\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\u7684\u589e\u91cf\u8fc1\u79fb\u5230\u5fae\u670d\u52a1</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528 Strangler</p> <ul> <li>\u5982\u679c\u540e\u7aef\u5355\u4f53\u5e94\u7528\u5f88\u5c0f\uff0c\u90a3\u4e48\u5168\u91cf\u66ff\u6362\u4f1a\u66f4\u597d\u3002</li> <li>\u5982\u679c\u65e0\u6cd5\u62e6\u622a\u5ba2\u6237\u7aef\u5bf9\u9057\u7559\u7684\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\u7684\u8bf7\u6c42\u3002</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>API \u7f51\u5173\u540e\u7aef\u5e94\u7528\u6846\u67b6\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#38","title":"3.8 \u65ad\u8def\u5668","text":"<p>\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u5fae\u670d\u52a1\u901a\u8fc7\u540c\u6b65\u8c03\u7528\u5176\u4ed6\u670d\u52a1\u6765\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\u3002\u670d\u52a1\u8c03\u7528\u4f1a\u7531\u4e8e\u77ac\u65f6\u6545\u969c\uff08\u7f51\u7edc\u8fde\u63a5\u7f13\u6162\u3001\u8d85\u65f6\u6216\u6682\u65f6\u4e0d\u53ef\u7528\uff09 \u5bfc\u81f4\u5931\u8d25\uff0c\u8fd9\u79cd\u60c5\u51b5\u91cd\u8bd5\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\u3002\u7136\u800c\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u4e25\u91cd\u95ee\u9898\uff08\u5fae\u670d\u52a1\u5b8c\u5168\u5931\u8d25\uff09\uff0c\u90a3\u4e48\u5fae\u670d\u52a1\u5c06\u957f\u65f6\u95f4\u4e0d\u53ef\u7528\uff0c\u8fd9\u65f6\u91cd\u8bd5\u6ca1\u6709\u610f\u4e49\u4e14\u6d6a\u8d39\u5b9d\u8d35\u7684\u8d44\u6e90\uff08\u7ebf\u7a0b\u88ab\u963b\u585e\uff0cCPU \u5468\u671f\u88ab\u6d6a\u8d39\uff09\u3002\u6b64\u5916\uff0c\u4e00\u4e2a\u670d\u52a1\u7684\u6545\u969c\u8fd8\u4f1a\u5f15\u53d1\u6574\u4e2a\u5e94\u7528\u7cfb\u7edf\u7684\u7ea7\u8054\u6545\u969c\u3002\u8fd9\u65f6\u5feb\u901f\u5931\u8d25\u662f\u4e00\u79cd\u66f4\u597d\u7684\u65b9\u6cd5\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u4f7f\u7528\u65ad\u8def\u5668\u6a21\u5f0f\u633d\u6551\u3002\u4e00\u4e2a\u5fae\u670d\u52a1\u901a\u8fc7\u4ee3\u7406\u8bf7\u6c42\u53e6\u4e00\u4e2a\u5fae\u670d\u52a1\uff0c\u5176\u5de5\u4f5c\u539f\u7406\u7c7b\u4f3c\u4e8e\u7535\u6c14\u65ad\u8def\u5668\uff0c\u4ee3\u7406\u901a\u8fc7\u7edf\u8ba1\u6700\u8fd1\u53d1\u751f\u7684\u6545\u969c\u6570\u91cf\uff0c\u5e76\u4f7f\u7528\u5b83\u6765\u51b3\u5b9a\u662f\u7ee7\u7eed\u8bf7\u6c42\u8fd8\u662f\u7b80\u5355\u7684\u76f4\u63a5\u8fd4\u56de\u5f02\u5e38\u3002</p> <p></p> <p>\u65ad\u8def\u5668\u53ef\u4ee5\u6709\u4ee5\u4e0b\u4e09\u79cd\u72b6\u6001\uff1a</p> <ol> <li>\u5173\u95ed\uff1a\u65ad\u8def\u5668\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u5fae\u670d\u52a1\uff0c\u5e76\u7edf\u8ba1\u7ed9\u5b9a\u65f6\u6bb5\u5185\u7684\u6545\u969c\u6570\u91cf\uff0c\u5982\u679c\u8d85\u8fc7\u9608\u503c\uff0c\u5b83\u5c31\u4f1a\u89e6\u53d1\u5e76\u8fdb\u5165\u6253\u5f00\u72b6\u6001\u3002</li> <li>\u6253\u5f00\uff1a\u6765\u81ea\u5fae\u670d\u52a1\u7684\u8bf7\u6c42\u4f1a\u5feb\u901f\u5931\u8d25\u5e76\u8fd4\u56de\u5f02\u5e38\u3002\u5728\u8d85\u65f6\u540e\uff0c\u65ad\u8def\u5668\u8fdb\u5165\u534a\u5f00\u542f\u72b6\u6001\u3002</li> <li>\u534a\u5f00\uff1a\u53ea\u6709\u6709\u9650\u6570\u91cf\u7684\u5fae\u670d\u52a1\u8bf7\u6c42\u88ab\u5141\u8bb8\u901a\u8fc7\u5e76\u8fdb\u884c\u8c03\u7528\u3002\u5982\u679c\u8fd9\u4e9b\u8bf7\u6c42\u6210\u529f\uff0c\u65ad\u8def\u5668\u5c06\u8fdb\u5165\u95ed\u5408\u72b6\u6001\u3002\u5982\u679c\u4efb\u4f55\u8bf7\u6c42\u5931\u8d25\uff0c\u65ad\u8def\u5668\u5219\u4f1a\u8fdb\u5165\u5f00\u542f\u72b6\u6001\u3002</li> </ol> <p>\u4f18\u70b9</p> <ul> <li>\u63d0\u9ad8\u5fae\u670d\u52a1\u67b6\u6784\u7684\u5bb9\u9519\u6027\u548c\u5f39\u6027</li> <li>\u963b\u6b62\u5f15\u53d1\u5176\u4ed6\u5fae\u670d\u52a1\u7684\u7ea7\u8054\u6545\u969c</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>\u9700\u8981\u590d\u6742\u7684\u5f02\u5e38\u5904\u7406</li> <li>\u65e5\u5fd7\u548c\u76d1\u63a7</li> <li>\u5e94\u8be5\u652f\u6301\u4eba\u5de5\u590d\u4f4d</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528\u65ad\u8def\u5668</p> <ul> <li>\u5728\u5fae\u670d\u52a1\u95f4\u4f7f\u7528\u540c\u6b65\u901a\u4fe1\u7684\u7d27\u8026\u5408\u7684\u5fae\u670d\u52a1\u67b6\u6784\u4e2d</li> <li>\u5982\u679c\u5fae\u670d\u52a1\u4f9d\u8d56\u591a\u4e2a\u5176\u4ed6\u5fae\u670d\u52a1</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528\u65ad\u8def\u5668</p> <ul> <li>\u677e\u8026\u5408\u3001\u4e8b\u4ef6\u9a71\u52a8\u7684\u5fae\u670d\u52a1\u67b6\u6784</li> <li>\u5982\u679c\u5fae\u670d\u52a1\u4e0d\u4f9d\u8d56\u4e8e\u5176\u4ed6\u5fae\u670d\u52a1</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>API \u7f51\u5173\uff0c\u670d\u52a1\u7f51\u683c\uff0c\u5404\u79cd\u65ad\u8def\u5668\u5e93\uff08Hystrix\uff0c Reselience4J\uff0c Polly\uff09\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#39","title":"3.9 \u5916\u90e8\u5316\u914d\u7f6e","text":"<p>\u6bcf\u4e2a\u4e1a\u52a1\u5e94\u7528\u90fd\u6709\u8bb8\u591a\u7528\u4e8e\u5404\u79cd\u57fa\u7840\u8bbe\u65bd\u7684\u914d\u7f6e\u53c2\u6570\uff08\u4f8b\u5982\uff0c\u6570\u636e\u5e93\u3001\u7f51\u7edc\u3001\u8fde\u63a5\u7684\u670d\u52a1\u5730\u5740\u3001\u51ed\u636e\u3001\u8bc1\u4e66\u8def\u5f84\uff09\u3002\u6b64\u5916\u5728\u4f01\u4e1a\u5e94\u7528\u7a0b\u5e8f\u901a\u5e38\u90e8\u7f72\u5728\u5404\u79cd\u8fd0\u884c\u73af\u5883\uff08Local\u3001 Dev\u3001 Prod\uff09\u4e2d\uff0c\u5b9e\u73b0\u8fd9\u4e9b\u7684\u4e00\u4e2a\u65b9\u6cd5\u662f\u901a\u8fc7\u5185\u90e8\u914d\u7f6e\u3002\u8fd9\u662f\u4e00\u4e2a\u81f4\u547d\u7cdf\u7cd5\u5b9e\u8df5\uff0c\u5b83\u4f1a\u5bfc\u81f4\u4e25\u91cd\u7684\u5b89\u5168\u98ce\u9669\uff0c\u56e0\u4e3a\u751f\u4ea7\u51ed\u8bc1\u5f88\u5bb9\u6613\u906d\u5230\u7834\u574f\u3002\u6b64\u5916\uff0c\u914d\u7f6e\u53c2\u6570\u7684\u4efb\u4f55\u66f4\u6539\u90fd\u9700\u8981\u91cd\u65b0\u6784\u5efa\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd9\u5728\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u4f1a\u66f4\u52a0\u4e25\u5cfb\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u80fd\u62e5\u6709\u6570\u767e\u4e2a\u670d\u52a1\u3002</p> <p>\u66f4\u597d\u7684\u65b9\u6cd5\u662f\u5c06\u6240\u6709\u914d\u7f6e\u5916\u90e8\u5316\uff0c\u4f7f\u5f97\u6784\u5efa\u8fc7\u7a0b\u4e0e\u8fd0\u884c\u73af\u5883\u5206\u79bb\uff0c\u751f\u4ea7\u7684\u914d\u7f6e\u6587\u4ef6\u53ea\u5728\u8fd0\u884c\u65f6\u6216\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u4f7f\u7528\uff0c\u4ece\u800c\u6700\u5c0f\u5316\u4e86\u5b89\u5168\u98ce\u9669\u3002</p> <p>\u4f18\u70b9</p> <ul> <li>\u751f\u4ea7\u914d\u7f6e\u4e0d\u5c5e\u4e8e\u4ee3\u7801\u5e93\uff0c\u56e0\u800c\u6700\u5c0f\u5316\u4e86\u5b89\u5168\u6f0f\u6d1e\u3002</li> <li>\u4fee\u6539\u914d\u7f6e\u53c2\u6570\u4e0d\u9700\u8981\u91cd\u65b0\u6784\u5efa\u5e94\u7528\u7a0b\u5e8f\u3002</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>\u6211\u4eec\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u652f\u6301\u5916\u90e8\u5316\u914d\u7f6e\u7684\u6846\u67b6\u3002</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528\u5916\u90e8\u5316\u914d\u7f6e</p> <ul> <li>\u4efb\u4f55\u91cd\u8981\u7684\u751f\u4ea7\u5e94\u7528\u7a0b\u5e8f\u90fd\u5fc5\u987b\u4f7f\u7528\u5916\u90e8\u5316\u914d\u7f6e\u3002</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528\u5916\u90e8\u5316\u914d\u7f6e</p> <ul> <li>\u5728\u9a8c\u8bc1\u6982\u5ff5\u7684\u5f00\u53d1\u4e2d\u3002</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>\u51e0\u4e4e\u6240\u6709\u4f01\u4e1a\u7ea7\u7684\u73b0\u4ee3\u6846\u67b6\u90fd\u652f\u6301\u5916\u90e8\u5316\u914d\u7f6e\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#310","title":"3.10 \u6d88\u8d39\u7aef\u542f\u52a8\u5951\u7ea6\u6d4b\u8bd5","text":"<p>\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u901a\u5e38\u6709\u8bb8\u591a\u6709\u4e0d\u540c\u56e2\u961f\u5f00\u53d1\u7684\u5fae\u670d\u52a1\u3002\u8fd9\u4e9b\u5fae\u578b\u670d\u52a1\u534f\u540c\u5de5\u4f5c\u6765\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\uff08\u4f8b\u5982\uff0c\u5ba2\u6237\u8bf7\u6c42\uff09\uff0c\u5e76\u76f8\u4e92\u8fdb\u884c\u540c\u6b65\u6216\u5f02\u6b65\u901a\u4fe1\u3002\u6d88\u8d39\u7aef\u5fae\u670d\u52a1\u7684\u96c6\u6210\u6d4b\u8bd5\u5177\u6709\u6311\u6218\u6027\uff0c\u901a\u5e38\u7528 TestDouble \u4ee5\u83b7\u5f97\u66f4\u5feb\u3001\u66f4\u4f4e\u6210\u672c\u7684\u6d4b\u8bd5\u8fd0\u884c\u3002\u4f46\u662f TestDouble \u901a\u5e38\u5e76\u4e0d\u80fd\u4ee3\u8868\u771f\u6b63\u7684\u5fae\u670d\u52a1\u63d0\u4f9b\u8005\uff0c\u800c\u4e14\u5982\u679c\u5fae\u670d\u52a1\u63d0\u4f9b\u8005\u66f4\u6539\u4e86\u5b83\u7684 API \u6216 \u6d88\u606f\uff0c\u90a3\u4e48 TestDouble \u5c06\u65e0\u6cd5\u786e\u8ba4\u8fd9\u4e9b\u3002\u53e6\u4e00\u79cd\u9009\u62e9\u662f\u8fdb\u884c\u7aef\u5230\u7aef\u6d4b\u8bd5\uff0c\u5c3d\u7ba1\u5b83\u5728\u751f\u4ea7\u4e4b\u524d\u662f\u5f3a\u5236\u6027\u7684\uff0c\u4f46\u5374\u662f\u8106\u5f31\u7684\u3001\u7f13\u6162\u7684\u3001\u6602\u8d35\u7684\u4e14\u4e0d\u80fd\u66ff\u4ee3\u96c6\u6210\u6d4b\u8bd5\uff08Test Pyramid\uff09\u3002</p> <p>\u5728\u8fd9\u65b9\u9762\u6d88\u8d39\u7aef\u9a71\u52a8\u7684\u5951\u7ea6\u6d4b\u8bd5\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u3002\u5728\u8fd9\u91cc\uff0c\u8d1f\u8d23\u6d88\u8d39\u7aef\u5fae\u670d\u52a1\u7684\u56e2\u961f\u9488\u5bf9\u7279\u5b9a\u7684\u670d\u52a1\u7aef\u5fae\u670d\u52a1\uff0c\u7f16\u5199\u4e00\u5957\u5305\u542b\u4e86\u5176\u8bf7\u6c42\u548c\u9884\u671f\u54cd\u5e94\uff08\u540c\u6b65\uff09\u6216\u6d88\u606f\uff08\u5f02\u6b65\uff09\u7684\u6d4b\u8bd5\u5957\u4ef6\uff0c\u8fd9\u4e9b\u6d4b\u8bd5\u5957\u4ef6\u79f0\u4e3a\u663e\u5f0f\u7684\u7ea6\u5b9a\u3002\u5bf9\u4e8e\u5fae\u670d\u52a1\u670d\u52a1\u7aef\uff0c\u5c06\u5176\u6d88\u8d39\u7aef\u6240\u6709\u7ea6\u5b9a\u7684\u6d4b\u8bd5\u5957\u4ef6\u90fd\u6dfb\u52a0\u5230\u5176\u81ea\u52a8\u5316\u6d4b\u8bd5\u4e2d\u3002\u5f53\u7279\u5b9a\u670d\u52a1\u7aef\u5fae\u670d\u52a1\u7684\u81ea\u52a8\u5316\u6d4b\u8bd5\u6267\u884c\u65f6\uff0c\u5b83\u5c06\u4e00\u8d77\u8fd0\u884c\u81ea\u5df1\u7684\u6d4b\u8bd5\u548c\u7ea6\u5b9a\u7684\u6d4b\u8bd5\u5e76\u8fdb\u884c\u9a8c\u8bc1\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5951\u7ea6\u6d4b\u8bd5\u53ef\u4ee5\u81ea\u52a8\u7684\u5e2e\u52a9\u7ef4\u62a4\u5fae\u670d\u52a1\u901a\u4fe1\u7684\u5b8c\u6574\u6027\u3002</p> <p>\u4f18\u70b9</p> <ul> <li>\u5982\u679c\u63d0\u4f9b\u7a0b\u5e8f\u610f\u5916\u66f4\u6539 API \u6216\u6d88\u606f\uff0c\u53ef\u4ee5\u88ab\u5feb\u901f\u7684\u81ea\u52a8\u53d1\u73b0\u3002</li> <li>\u66f4\u5c11\u610f\u5916\u3001\u66f4\u5065\u58ee\uff0c\u7279\u522b\u662f\u5305\u542b\u5927\u91cf\u5fae\u670d\u52a1\u7684\u4f01\u4e1a\u5e94\u7528\u7a0b\u5e8f\u3002</li> <li>\u6539\u5584\u56e2\u961f\u81ea\u4e3b\u6027\u3002</li> </ul> <p>\u7f3a\u70b9</p> <ul> <li>\u9700\u8981\u989d\u5916\u7684\u5de5\u4f5c\u6765\u5f00\u53d1\u548c\u96c6\u6210\u5fae\u670d\u52a1\u670d\u52a1\u7aef\u7684\u5951\u7ea6\u6d4b\u8bd5\uff0c\u56e0\u4e3a\u4ed6\u4eec\u53ef\u80fd\u4f7f\u7528\u5b8c\u5168\u4e0d\u540c\u7684\u6d4b\u8bd5\u5de5\u5177\u3002</li> <li>\u5982\u679c\u5951\u7ea6\u6d4b\u8bd5\u4e0e\u771f\u5b9e\u670d\u52a1\u60c5\u51b5\u4e0d\u5339\u914d\uff0c\u5c06\u53ef\u80fd\u5bfc\u81f4\u751f\u4ea7\u6545\u969c\u3002</li> </ul> <p>\u4f55\u65f6\u4f7f\u7528\u9700\u6c42\u9a71\u52a8\u7684\u5951\u7ea6\u6d4b\u8bd5</p> <ul> <li>\u5728\u5927\u578b\u4f01\u4e1a\u4e1a\u52a1\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u901a\u5e38\u7531\u4e0d\u540c\u7684\u56e2\u961f\u5f00\u53d1\u4e0d\u540c\u670d\u52a1\u3002</li> </ul> <p>\u4f55\u65f6\u4e0d\u5b9c\u4f7f\u7528\u6d88\u8d39\u7aef\u9a71\u52a8\u7684\u5951\u7ea6\u6d4b\u8bd5</p> <ul> <li>\u6240\u6709\u5fae\u670d\u52a1\u7531\u540c\u4e00\u56e2\u961f\u8d1f\u8d23\u5f00\u53d1\u7684\u5c0f\u578b\u7b80\u5355\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</li> <li>\u5982\u679c\u670d\u52a1\u7aef\u5fae\u670d\u52a1\u662f\u76f8\u5bf9\u7a33\u5b9a\u7684\uff0c\u5e76\u4e14\u4e0d\u5904\u5728\u6d3b\u8dc3\u7684\u5f00\u53d1\u72b6\u6001\u3002</li> </ul> <p>\u53ef\u7528\u6280\u672f\u793a\u4f8b</p> <p>Pact\uff0c Postman\uff0c Spring Cloud Contract</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#_4","title":"\u4e09 \u603b\u7ed3","text":"<p>\u5728\u73b0\u4ee3\u5927\u89c4\u6a21\u4f01\u4e1a\u8f6f\u4ef6\u5f00\u53d1\u4e2d\uff0c\u5fae\u670d\u52a1\u67b6\u6784\u80fd\u591f\u5e2e\u52a9\u5f00\u53d1\u6269\u5c55\u89c4\u6a21\u5e76\u5e26\u6765\u5f88\u591a\u957f\u671f\u6536\u76ca\u3002\u4f46\u662f\u5fae\u670d\u52a1\u67b6\u6784\u5e76\u4e0d\u662f\u968f\u5904\u53ef\u7528\u7684\u94f6\u5f39\uff0c\u5982\u679c\u5e94\u7528\u5728\u9519\u8bef\u7684\u5e94\u7528\u7a0b\u5e8f\u7c7b\u578b\uff0c\u5fae\u670d\u52a1\u67b6\u6784\u5c06\u5f0a\u5927\u4e8e\u5229\u3002\u5e0c\u671b\u91c7\u7528\u5fae\u670d\u52a1\u67b6\u6784\u7684\u5f00\u53d1\u56e2\u961f\u5e94\u8be5\u9075\u5faa\u6700\u4f73\u5b9e\u8df5\uff0c\u5e76\u4f7f\u7528\u4e00\u7cfb\u5217\u53ef\u91cd\u7528\u7684\u3001\u4e45\u7ecf\u9524\u70bc\u7684\u8bbe\u8ba1\u6a21\u5f0f\u3002</p> <p>\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u81f3\u5173\u91cd\u8981\u7684\u8bbe\u8ba1\u6a21\u5f0f\u662f\u72ec\u4eab\u6570\u636e\u5e93\u3002\u5b9e\u73b0\u8fd9\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u5177\u6709\u6311\u6218\u6027\uff0c\u9700\u8981\u5176\u4ed6\u51e0\u79cd\u5bc6\u5207\u76f8\u5173\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff08\u4e8b\u4ef6\u9a71\u52a8\u3001 CQRS\u3001 Saga\uff09\u6765\u652f\u6301\u3002\u5728\u5177\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\uff08Web\u3001 Mobile\u3001 Desktop\u3001 Smart Devices\uff09\u7684\u5178\u578b\u4e1a\u52a1\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u5ba2\u6237\u7aef\u548c\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\u91cf\u53ef\u80fd\u662f\u5f88\u5927\u7684\uff0c\u5e76\u4e14\u9700\u8981\u7edf\u4e00\u7684\u5b89\u5168\u63a7\u5236\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u9762\u5411\u524d\u7aef\u7684\u540e\u7aef\u548c API \u7f51\u5173\u7684\u8bbe\u8ba1\u975e\u5e38\u6709\u7528\u3002\u6b64\u5916\uff0c\u65ad\u8def\u5668\u6a21\u5f0f\u53ef\u4ee5\u5927\u5927\u5730\u5e2e\u52a9\u5e94\u5bf9\u8fd9\u7c7b\u5e94\u7528\u7a0b\u5e8f\u7684\u9519\u8bef\u5904\u7406\u573a\u666f\u3002\u8fc1\u79fb\u9057\u7559\u7684\u5355\u4f53\u5e94\u7528\u5230\u5fae\u670d\u52a1\u662f\u6781\u5177\u6311\u6218\u6027\u7684\uff0c\u800c Strangler \u6a21\u5f0f\u53ef\u4ee5\u5e2e\u52a9\u505a\u5230\u8fd9\u70b9\u3002\u6d88\u8d39\u7aef\u9a71\u52a8\u7684\u5951\u7ea6\u6d4b\u8bd5\u662f\u5fae\u670d\u52a1\u96c6\u6210\u6d4b\u8bd5\u7684\u57fa\u7840\u6a21\u5f0f\u3002\u53e6\u5916\u5916\u90e8\u5316\u914d\u7f6e\u662f\u4efb\u4f55\u73b0\u4ee3\u5316\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u4e2d\u7684\u4e00\u79cd\u5fc5\u5907\u6a21\u5f0f\u3002</p> <p>\u8fd9\u4e2a\u7cfb\u5217\u5e76\u4e0d\u5168\u9762\uff0c\u5728\u5b9e\u9645\u60c5\u51b5\u4e2d\u60a8\u53ef\u80fd\u9700\u8981\u5176\u4ed6\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u4f46\u8fd9\u4e2a\u7cfb\u5217\u80fd\u4e3a\u60a8\u63d0\u4f9b\u4e00\u4e2a\u5173\u4e8e\u5fae\u670d\u52a1\u67b6\u6784\u8bbe\u8ba1\u6a21\u5f0f\u7684\u6781\u597d\u4ecb\u7ecd\u3002</p>"},{"location":"cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://mp.weixin.qq.com/s/PzPfWHVanSQpZha7qDeKGw</li> <li>https://towardsdatascience.com/microservice-architecture-and-its-10-most-important-design-patterns-824952d7fa41</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Envoy%E7%AC%94%E8%AE%B0/","title":"Envoy\u7b14\u8bb0","text":""},{"location":"cloud-native/servicemesh/istio/Envoy%E7%AC%94%E8%AE%B0/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://juejin.im/post/5ad6fb06518825364001f619</li> <li>https://juejin.im/post/5c7c9a78e51d451d47634635</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/","title":"Istio Handbook\u4e4bIstio \u670d\u52a1\u7f51\u683c\u8fdb\u9636\u5b9e\u6218","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#_1","title":"\u4e00 \u5e8f","text":"<p>Istio](https://istio.io/zh) \u662f\u7531 Google\u3001IBM\u3001Lyft \u7b49\u5171\u540c\u5f00\u6e90\u7684 Service Mesh\uff08\u670d\u52a1\u7f51\u683c\uff09\u6846\u67b6\uff0c\u4e8e2017\u5e74\u521d\u5f00\u59cb\u8fdb\u5165\u5927\u4f17\u89c6\u91ce\uff0c\u4f5c\u4e3a\u4e91\u539f\u751f\u65f6\u4ee3\u4e0b\u627f Kubernetes\u3001\u4e0a\u63a5 Serverless \u67b6\u6784\u7684\u91cd\u8981\u57fa\u7840\u8bbe\u65bd\u5c42\uff0c\u5730\u4f4d\u81f3\u5173\u91cd\u8981\u3002ServiceMesher \u793e\u533a\u4f5c\u4e3a\u4e2d\u56fd\u6700\u65e9\u7684\u4e00\u6279\u5728\u7814\u7a76\u548c\u63a8\u5e7f Service Mesh \u6280\u672f\u7684\u5f00\u6e90\u793e\u533a\u51b3\u5b9a\u6574\u5408\u793e\u533a\u8d44\u6e90\uff0c\u5408\u4f5c\u64b0\u5199\u4e00\u672c\u5f00\u6e90\u7535\u5b50\u4e66\u4f5c\u4e3a\u670d\u52a1\u7f51\u683c\u667a\u5e93\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#kubernetes","title":"\u4e8c \u670d\u52a1\u7f51\u683c\u2014\u2014\u540e Kubernetes \u65f6\u4ee3\u7684\u5fae\u670d\u52a1","text":"<p>\u542c\u8bf4\u8fc7 Service Mesh \u5e76\u8bd5\u7528\u8fc7 Istio \u7684\u4eba\u53ef\u80fd\u90fd\u4f1a\u6709\u4ee5\u4e0b\u51e0\u4e2a\u7591\u95ee\uff1a</p> <ol> <li>\u4e3a\u4ec0\u4e48 Istio \u4e00\u5b9a\u8981\u7ed1\u5b9a Kubernetes \u5462\uff1f</li> <li>Kubernetes \u548c Service Mesh \u5206\u522b\u5728\u4e91\u539f\u751f\u4e2d\u626e\u6f14\u4ec0\u4e48\u89d2\u8272\uff1f</li> <li>Istio \u6269\u5c55\u4e86 Kubernetes \u7684\u54ea\u4e9b\u65b9\u9762\uff1f\u89e3\u51b3\u4e86\u54ea\u4e9b\u95ee\u9898\uff1f</li> <li>Kubernetes\u3001Envoy\uff08xDS \u534f\u8bae\uff09\u4e0e Istio \u4e4b\u95f4\u53c8\u662f\u4ec0\u4e48\u5173\u7cfb\uff1f</li> <li>\u5230\u5e95\u8be5\u4e0d\u8be5\u4e0a Service Mesh\uff1f</li> </ol> <p>\u672c\u6587\u8bd5\u56fe\u5e26\u60a8\u68b3\u7406\u6e05\u695a Kubernetes\u3001Envoy\uff08xDS \u534f\u8bae\uff09\u4ee5\u53ca Istio Service Mesh \u4e4b\u95f4\u7684\u5173\u7cfb\u53ca\u5185\u5728\u8054\u7cfb\u3002\u6b64\u5916\uff0c\u672c\u6587\u8fd8\u4ecb\u7ecd\u4e86 Kubernetes \u4e2d\u7684\u8d1f\u8f7d\u5747\u8861\u65b9\u5f0f\uff0cEnvoy \u7684 xDS \u534f\u8bae\u5bf9\u4e8e Service Mesh \u7684\u610f\u4e49\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u8bf4\u6709\u4e86 Kubernetes \u8fd8\u9700\u8981 Istio\u3002</p> <p>\u4f7f\u7528 Service Mesh \u5e76\u4e0d\u662f\u8bf4\u4e0e Kubernetes \u51b3\u88c2\uff0c\u800c\u662f\u6c34\u5230\u6e20\u6210\u7684\u4e8b\u60c5\u3002Kubernetes \u7684\u672c\u8d28\u662f\u901a\u8fc7\u58f0\u660e\u5f0f\u914d\u7f6e\u5bf9\u5e94\u7528\u8fdb\u884c\u751f\u547d\u5468\u671f\u7ba1\u7406\uff0c\u800c Service Mesh \u7684\u672c\u8d28\u662f\u63d0\u4f9b\u5e94\u7528\u95f4\u7684\u6d41\u91cf\u548c\u5b89\u5168\u6027\u7ba1\u7406\u4ee5\u53ca\u53ef\u89c2\u5bdf\u6027\u3002\u5047\u5982\u4f60\u5df2\u7ecf\u4f7f\u7528 Kubernetes \u6784\u5efa\u4e86\u7a33\u5b9a\u7684\u5fae\u670d\u52a1\u5e73\u53f0\uff0c\u90a3\u4e48\u5982\u4f55\u8bbe\u7f6e\u670d\u52a1\u95f4\u8c03\u7528\u7684\u8d1f\u8f7d\u5747\u8861\u548c\u6d41\u91cf\u63a7\u5236\uff1f</p> <p>Envoy \u5bf9\u4e8e Service Mesh \u6216\u8005\u8bf4 Cloud Native \u6700\u5927\u7684\u8d21\u732e\u5c31\u662f\u5b9a\u4e49\u4e86 xDS\uff0cEnvoy \u867d\u7136\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a proxy\uff0c\u4f46\u662f\u5b83\u7684\u914d\u7f6e\u534f\u8bae\u88ab\u4f17\u591a\u5f00\u6e90\u8f6f\u4ef6\u6240\u652f\u6301\uff0c\u5982 Istio\u3001Linkerd\u3001AWS App Mesh\u3001SOFAMesh \u7b49\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#21","title":"2.1 \u91cd\u8981\u89c2\u70b9","text":"<p>\u5982\u679c\u4f60\u60f3\u8981\u63d0\u524d\u4e86\u89e3\u4e0b\u6587\u7684\u6240\u6709\u5185\u5bb9\uff0c\u90a3\u4e48\u53ef\u4ee5\u5148\u9605\u8bfb\u4e0b\u9762\u5217\u51fa\u7684\u672c\u6587\u4e2d\u7684\u4e00\u4e9b\u4e3b\u8981\u89c2\u70b9\uff1a</p> <ul> <li>Kubernetes \u7684\u672c\u8d28\u662f\u5e94\u7528\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\uff0c\u5177\u4f53\u6765\u8bf4\u5c31\u662f\u90e8\u7f72\u548c\u7ba1\u7406\uff08\u6269\u7f29\u5bb9\u3001\u81ea\u52a8\u6062\u590d\u3001\u53d1\u5e03\uff09\u3002</li> <li>Kubernetes \u4e3a\u5fae\u670d\u52a1\u63d0\u4f9b\u4e86\u53ef\u6269\u5c55\u3001\u9ad8\u5f39\u6027\u7684\u90e8\u7f72\u548c\u7ba1\u7406\u5e73\u53f0\u3002</li> <li>Service Mesh \u7684\u57fa\u7840\u662f\u900f\u660e\u4ee3\u7406\uff0c\u901a\u8fc7 sidecar proxy \u62e6\u622a\u5230\u5fae\u670d\u52a1\u95f4\u6d41\u91cf\u540e\u518d\u901a\u8fc7\u63a7\u5236\u5e73\u9762\u914d\u7f6e\u7ba1\u7406\u5fae\u670d\u52a1\u7684\u884c\u4e3a\u3002</li> <li>Service Mesh \u5c06\u6d41\u91cf\u7ba1\u7406\u4ece Kubernetes \u4e2d\u89e3\u8026\uff0cService Mesh \u5185\u90e8\u7684\u6d41\u91cf\u65e0\u9700 <code>kube-proxy</code> \u7ec4\u4ef6\u7684\u652f\u6301\uff0c\u901a\u8fc7\u4e3a\u66f4\u63a5\u8fd1\u5fae\u670d\u52a1\u5e94\u7528\u5c42\u7684\u62bd\u8c61\uff0c\u7ba1\u7406\u670d\u52a1\u95f4\u7684\u6d41\u91cf\u3001\u5b89\u5168\u6027\u548c\u53ef\u89c2\u5bdf\u6027\u3002</li> <li>Envoy xDS \u5b9a\u4e49\u4e86 Service Mesh \u914d\u7f6e\u7684\u534f\u8bae\u6807\u51c6\u3002</li> <li>Service Mesh \u662f\u5bf9 Kubernetes \u4e2d\u7684 service \u66f4\u4e0a\u5c42\u7684\u62bd\u8c61\uff0c\u5b83\u7684\u4e0b\u4e00\u6b65\u662f serverless\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#22-kubernetes-vs-service-mesh","title":"2.2 Kubernetes vs Service Mesh","text":"<p>\u4e0b\u56fe\u5c55\u793a\u7684\u662f Kubernetes \u4e0e Service Mesh \u4e2d\u7684\u7684\u670d\u52a1\u8bbf\u95ee\u5173\u7cfb\uff0c\u672c\u6587\u4ec5\u9488\u5bf9 sidecar per-pod \u6a21\u5f0f\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003\u670d\u52a1\u7f51\u683c\u7684\u5b9e\u73b0\u6a21\u5f0f\u3002</p> <p></p> <p>Kubernetes \u96c6\u7fa4\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u90e8\u7f72\u4e86\u4e00\u4e2a <code>kube-proxy</code> \u7ec4\u4ef6\uff0c\u8be5\u7ec4\u4ef6\u4f1a\u4e0e Kubernetes API Server \u901a\u4fe1\uff0c\u83b7\u53d6\u96c6\u7fa4\u4e2d\u7684 service \u4fe1\u606f\uff0c\u7136\u540e\u8bbe\u7f6e iptables \u89c4\u5219\uff0c\u76f4\u63a5\u5c06\u5bf9\u67d0\u4e2a service \u7684\u8bf7\u6c42\u53d1\u9001\u5230\u5bf9\u5e94\u7684 Endpoint\uff08\u5c5e\u4e8e\u540c\u4e00\u7ec4 service \u7684 pod\uff09\u4e0a\u3002</p> <p>Istio Service Mesh \u4e2d\u6cbf\u7528\u4e86 Kubernetes \u4e2d\u7684 service \u505a\u670d\u52a1\u6ce8\u518c\uff0c\u901a\u8fc7 Control Plane \u6765\u751f\u6210\u6570\u636e\u5e73\u9762\u7684\u914d\u7f6e\uff08\u4f7f\u7528 CRD \u58f0\u660e\uff0c\u4fdd\u5b58\u5728 etcd \u4e2d\uff09\uff0c\u6570\u636e\u5e73\u9762\u7684**\u900f\u660e\u4ee3\u7406**\uff08transparent proxy\uff09\u4ee5 sidecar \u5bb9\u5668\u7684\u5f62\u5f0f\u90e8\u7f72\u5728\u6bcf\u4e2a\u5e94\u7528\u670d\u52a1\u7684 pod \u4e2d\uff0c\u8fd9\u4e9b proxy \u90fd\u9700\u8981\u8bf7\u6c42 Control Plane \u6765\u540c\u6b65\u4ee3\u7406\u914d\u7f6e\uff0c\u4e4b\u6240\u4ee5\u8bf4\u662f\u900f\u660e\u4ee3\u7406\uff0c\u662f\u56e0\u4e3a\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u5b8c\u5168\u65e0\u611f\u77e5\u4ee3\u7406\u7684\u5b58\u5728\uff0c\u8be5\u8fc7\u7a0b kube-proxy \u7ec4\u4ef6\u4e00\u6837\u9700\u8981\u62e6\u622a\u6d41\u91cf\uff0c\u53ea\u4e0d\u8fc7 <code>kube-proxy</code> \u62e6\u622a\u7684\u662f\u8fdb\u51fa Kubernetes \u8282\u70b9\u7684\u6d41\u91cf\uff0c\u800c sidecar proxy \u62e6\u622a\u7684\u662f\u8fdb\u51fa\u8be5 Pod \u7684\u6d41\u91cf\uff0c\u8be6\u89c1\u7406\u89e3 Istio Service Mesh \u4e2d Envoy Sidecar \u4ee3\u7406\u7684\u8def\u7531\u8f6c\u53d1\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#221-service-mesh","title":"2.2.1 Service Mesh \u7684\u52a3\u52bf","text":"<p>\u56e0\u4e3a Kubernetes \u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u4f1a\u8fd0\u884c\u4f17\u591a\u7684 Pod\uff0c\u5c06\u539f\u5148 <code>kube-proxy</code> \u65b9\u5f0f\u7684\u8def\u7531\u8f6c\u53d1\u529f\u80fd\u7f6e\u4e8e\u6bcf\u4e2a pod \u4e2d\uff0c\u5c06\u5bfc\u81f4\u5927\u91cf\u7684\u914d\u7f6e\u5206\u53d1\u3001\u540c\u6b65\u548c\u6700\u7ec8\u4e00\u81f4\u6027\u95ee\u9898\u3002\u4e3a\u4e86\u7ec6\u7c92\u5ea6\u5730\u8fdb\u884c\u6d41\u91cf\u7ba1\u7406\uff0c\u5fc5\u5c06\u6dfb\u52a0\u4e00\u7cfb\u5217\u65b0\u7684\u62bd\u8c61\uff0c\u4ece\u800c\u4f1a\u8fdb\u4e00\u6b65\u589e\u52a0\u7528\u6237\u7684\u5b66\u4e60\u6210\u672c\uff0c\u4f46\u968f\u7740\u6280\u672f\u7684\u666e\u53ca\uff0c\u8fd9\u6837\u7684\u60c5\u51b5\u4f1a\u6162\u6162\u5730\u5f97\u5230\u7f13\u89e3\u3002 </p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#222-service-mesh","title":"2.2.2 Service Mesh \u7684\u4f18\u52bf","text":"<p><code>kube-proxy</code> \u7684\u8bbe\u7f6e\u90fd\u662f\u5168\u5c40\u751f\u6548\u7684\uff0c\u65e0\u6cd5\u5bf9\u6bcf\u4e2a\u670d\u52a1\u505a\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\uff0c\u800c Service Mesh \u901a\u8fc7 sidecar proxy \u7684\u65b9\u5f0f\u5c06 Kubernetes \u4e2d\u5bf9\u6d41\u91cf\u7684\u63a7\u5236\u4ece service \u4e00\u5c42\u62bd\u79bb\u51fa\u6765\uff0c\u53ef\u4ee5\u505a\u66f4\u591a\u7684\u6269\u5c55</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#23-kube-proxy","title":"2.3 kube-proxy \u7ec4\u4ef6","text":"<p>\u5728 Kubernetes \u96c6\u7fa4\u4e2d\uff0c\u6bcf\u4e2a Node \u8fd0\u884c\u4e00\u4e2a <code>kube-proxy</code> \u8fdb\u7a0b\u3002<code>kube-proxy</code> \u8d1f\u8d23\u4e3a <code>Service</code> \u5b9e\u73b0\u4e86\u4e00\u79cd VIP\uff08\u865a\u62df IP\uff09\u7684\u5f62\u5f0f\u3002 \u5728 Kubernetes v1.0 \u7248\u672c\uff0c\u4ee3\u7406\u5b8c\u5168\u5728 userspace \u5b9e\u73b0\u3002Kubernetes v1.1 \u7248\u672c\u65b0\u589e\u4e86 iptables \u4ee3\u7406\u6a21\u5f0f\uff0c\u4f46\u5e76\u4e0d\u662f\u9ed8\u8ba4\u7684\u8fd0\u884c\u6a21\u5f0f\u3002\u4ece Kubernetes v1.2 \u8d77\uff0c\u9ed8\u8ba4\u4f7f\u7528 iptables \u4ee3\u7406\u3002\u5728 Kubernetes v1.8.0-beta.0 \u4e2d\uff0c\u6dfb\u52a0\u4e86 ipvs \u4ee3\u7406\u6a21\u5f0f\u3002\u5173\u4e8e kube-proxy \u7ec4\u4ef6\u7684\u66f4\u591a\u4ecb\u7ecd\u8bf7\u53c2\u8003 kubernetes \u7b80\u4ecb\uff1aservice \u548c kube-proxy \u539f\u7406 \u548c \u4f7f\u7528 IPVS \u5b9e\u73b0 Kubernetes \u5165\u53e3\u6d41\u91cf\u8d1f\u8f7d\u5747\u8861\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#231-kube-proxy","title":"2.3.1 kube-proxy \u7684\u7f3a\u9677","text":"<p>\u5728\u4e0a\u9762\u7684\u94fe\u63a5\u4e2d\u4f5c\u8005\u6307\u51fa\u4e86 kube-proxy \u7684\u4e0d\u8db3\u4e4b\u5904\uff1a</p> <p>\u9996\u5148\uff0c\u5982\u679c\u8f6c\u53d1\u7684 pod \u4e0d\u80fd\u6b63\u5e38\u63d0\u4f9b\u670d\u52a1\uff0c\u5b83\u4e0d\u4f1a\u81ea\u52a8\u5c1d\u8bd5\u53e6\u4e00\u4e2a pod\uff0c\u5f53\u7136\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7 <code>liveness probes</code> \u6765\u89e3\u51b3\u3002\u6bcf\u4e2a pod \u90fd\u6709\u4e00\u4e2a\u5065\u5eb7\u68c0\u67e5\u7684\u673a\u5236\uff0c\u5f53\u6709 pod \u5065\u5eb7\u72b6\u51b5\u6709\u95ee\u9898\u65f6\uff0ckube-proxy \u4f1a\u5220\u9664\u5bf9\u5e94\u7684\u8f6c\u53d1\u89c4\u5219\u3002\u53e6\u5916\uff0c<code>nodePort</code> \u7c7b\u578b\u7684\u670d\u52a1\u4e5f\u65e0\u6cd5\u6dfb\u52a0 TLS \u6216\u8005\u66f4\u590d\u6742\u7684\u62a5\u6587\u8def\u7531\u673a\u5236\u3002</p> <p>Kube-proxy \u5b9e\u73b0\u4e86\u6d41\u91cf\u5728 Kubernetes service \u591a\u4e2a pod \u5b9e\u4f8b\u95f4\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u4f46\u662f\u5982\u4f55\u5bf9\u8fd9\u4e9b service \u95f4\u7684\u6d41\u91cf\u505a\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\uff0c\u6bd4\u5982\u6309\u7167\u767e\u5206\u6bd4\u5212\u5206\u6d41\u91cf\u5230\u4e0d\u540c\u7684\u5e94\u7528\u7248\u672c\uff08\u8fd9\u4e9b\u5e94\u7528\u90fd\u5c5e\u4e8e\u540c\u4e00\u4e2a service\uff0c\u4f46\u4f4d\u4e8e\u4e0d\u540c\u7684 deployment \u4e0a\uff09\uff0c\u505a\u91d1\u4e1d\u96c0\u53d1\u5e03\uff08\u7070\u5ea6\u53d1\u5e03\uff09\u548c\u84dd\u7eff\u53d1\u5e03\uff1fKubernetes \u793e\u533a\u7ed9\u51fa\u4e86 \u4f7f\u7528 Deployment \u505a\u91d1\u4e1d\u96c0\u53d1\u5e03\u7684\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u672c\u8d28\u4e0a\u5c31\u662f\u901a\u8fc7\u4fee\u6539 pod \u7684 label \u6765\u5c06\u4e0d\u540c\u7684 pod \u5212\u5f52\u5230 Deployment \u7684 Service \u4e0a\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#24-kubernetes-ingress-vs-istio-gateway","title":"2.4 Kubernetes Ingress vs Istio Gateway","text":"<p>Kubernetes \u4e2d\u7684 Ingress \u8d44\u6e90\u5bf9\u8c61\u8ddf Istio Service Mesh \u4e2d\u7684 Gateway \u7684\u529f\u80fd\u7c7b\u4f3c\uff0c\u90fd\u662f\u8d1f\u8d23\u96c6\u7fa4\u5357\u5317\u6d41\u91cf\uff08\u4ece\u96c6\u7fa4\u5916\u90e8\u8fdb\u5165\u96c6\u7fa4\u5185\u90e8\u7684\u6d41\u91cf\uff09\u3002</p> <p><code>kube-proxy</code> \u53ea\u80fd\u8def\u7531 Kubernetes \u96c6\u7fa4\u5185\u90e8\u7684\u6d41\u91cf\uff0c\u800c\u6211\u4eec\u77e5\u9053 Kubernetes \u96c6\u7fa4\u7684 Pod \u4f4d\u4e8e CNI \u521b\u5efa\u7684\u5916\u7f51\u7edc\u4e2d\uff0c\u96c6\u7fa4\u5916\u90e8\u662f\u65e0\u6cd5\u76f4\u63a5\u4e0e\u5176\u901a\u4fe1\u7684\uff0c\u56e0\u6b64 Kubernetes \u4e2d\u521b\u5efa\u4e86 ingress \u8fd9\u4e2a\u8d44\u6e90\u5bf9\u8c61\uff0c\u5b83\u7531\u4f4d\u4e8e Kubernetes \u8fb9\u7f18\u8282\u70b9\uff08\u8fd9\u6837\u7684\u8282\u70b9\u53ef\u4ee5\u662f\u5f88\u591a\u4e2a\u4e5f\u53ef\u4ee5\u662f\u4e00\u7ec4\uff09\u7684 Ingress controller \u9a71\u52a8\uff0c\u8d1f\u8d23\u7ba1\u7406**\u5357\u5317\u5411\u6d41\u91cf**\uff08\u4ece\u96c6\u7fa4\u5916\u90e8\u8fdb\u5165 Kubernetes \u96c6\u7fa4\u7684\u6d41\u91cf\uff09\uff0cIngress \u5fc5\u987b\u5bf9\u63a5\u5404\u79cd Ingress Controller \u624d\u80fd\u4f7f\u7528\uff0c\u6bd4\u5982 nginx ingress controller\u3001traefik\u3002Ingress \u53ea\u9002\u7528\u4e8e HTTP \u6d41\u91cf\uff0c\u4f7f\u7528\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u53ea\u80fd\u5bf9 service\u3001port\u3001HTTP \u8def\u5f84\u7b49\u6709\u9650\u5b57\u6bb5\u5339\u914d\u6765\u8def\u7531\u6d41\u91cf\uff0c\u8fd9\u5bfc\u81f4\u5b83\u65e0\u6cd5\u8def\u7531\u5982 MySQL\u3001redis \u548c\u5404\u79cd\u79c1\u6709 RPC \u7b49 TCP \u6d41\u91cf\u3002\u8981\u60f3\u76f4\u63a5\u8def\u7531\u5357\u5317\u5411\u7684\u6d41\u91cf\uff0c\u53ea\u80fd\u4f7f\u7528 Service \u7684 LoadBalancer \u6216 NodePort\uff0c\u524d\u8005\u9700\u8981\u4e91\u5382\u5546\u652f\u6301\u800c\u4e14\u53ef\u80fd\u9700\u8981\u4ed8\u8d39\uff0c\u540e\u8005\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u7aef\u53e3\u7ba1\u7406\u3002\u6709\u4e9b Ingress controller \u652f\u6301\u66b4\u9732 TCP \u548c UDP \u670d\u52a1\uff0c\u4f46\u662f\u53ea\u80fd\u4f7f\u7528 Service \u6765\u66b4\u9732\uff0cIngress \u672c\u8eab\u662f\u4e0d\u652f\u6301\u7684\uff0c\u4f8b\u5982 nginx ingress controller\uff0c\u670d\u52a1\u7684\u66b4\u9732\u7684\u7aef\u53e3\u662f\u901a\u8fc7\u521b\u5efa ConfigMap \u7684\u65b9\u5f0f\u6765\u914d\u7f6e\u7684\u3002</p> <p>Istio <code>Gateway</code> \u63cf\u8ff0\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u7528\u4e8e\u627f\u8f7d\u8fdb\u51fa\u7f51\u683c\u8fb9\u7f18\u7684\u8fde\u63a5\u3002\u8be5\u89c4\u8303\u4e2d\u63cf\u8ff0\u4e86\u4e00\u7cfb\u5217\u5f00\u653e\u7aef\u53e3\u548c\u8fd9\u4e9b\u7aef\u53e3\u6240\u4f7f\u7528\u7684\u534f\u8bae\u3001\u8d1f\u8f7d\u5747\u8861\u7684 SNI \u914d\u7f6e\u7b49\u5185\u5bb9\u3002Gateway \u662f\u4e00\u79cd CRD \u6269\u5c55\uff0c\u5b83\u540c\u65f6\u590d\u7528\u4e86 Envoy proxy \u7684\u80fd\u529b\uff0c\u8be6\u7ec6\u914d\u7f6e\u8bf7\u53c2\u8003 Istio \u5b98\u7f51\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#25-xds","title":"2.5 xDS \u534f\u8bae","text":"<p>\u4e0b\u9762\u8fd9\u5f20\u56fe\u5927\u5bb6\u5728\u4e86\u89e3 Service Mesh \u7684\u65f6\u5019\u53ef\u80fd\u90fd\u770b\u5230\u8fc7\uff0c\u6bcf\u4e2a\u65b9\u5757\u4ee3\u8868\u4e00\u4e2a\u670d\u52a1\u7684\u793a\u4f8b\uff0c\u4f8b\u5982 Kubernetes \u4e2d\u7684\u4e00\u4e2a Pod\uff08\u5176\u4e2d\u5305\u542b\u4e86 sidecar proxy\uff09\uff0cxDS \u534f\u8bae\u63a7\u5236\u4e86 Istio Service Mesh \u4e2d\u6240\u6709\u6d41\u91cf\u7684\u5177\u4f53\u884c\u4e3a\uff0c\u5373\u5c06\u4e0b\u56fe\u4e2d\u7684\u65b9\u5757\u94fe\u63a5\u5230\u4e86\u4e00\u8d77\u3002</p> <p></p> <p>\u56fe\u7247 - Service Mesh \u793a\u610f\u56fe</p> <p>xDS \u534f\u8bae\u662f\u7531 Envoy \u63d0\u51fa\u7684\uff0c\u5728 Envoy v2 \u7248\u672c API \u4e2d\u6700\u539f\u59cb\u7684 xDS \u534f\u8bae\u53ea\u6307 CDS\u3001EDS\u3001LDS \u548c RDS\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u4ee5\u4e24\u4e2a service\uff0c\u6bcf\u4e2a service \u90fd\u6709\u4e24\u4e2a\u5b9e\u4f8b\u7684\u4f8b\u5b50\u6765\u770b\u4e0b Envoy \u7684 xDS \u534f\u8bae\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u7684\u7bad\u5934\u4e0d\u662f\u6d41\u91cf\u5728\u8fdb\u5165 Enovy Proxy \u540e\u7684\u8def\u5f84\u6216\u8def\u7531\uff0c\u800c\u662f\u60f3\u8c61\u7684\u4e00\u79cd Envoy \u4e2d xDS \u63a5\u53e3\u5904\u7406\u7684\u987a\u5e8f\u5e76\u975e\u5b9e\u9645\u987a\u5e8f\uff0c\u5176\u5b9e xDS \u4e4b\u95f4\u4e5f\u662f\u6709\u4ea4\u53c9\u5f15\u7528\u7684\u3002</p> <p>Envoy \u901a\u8fc7\u67e5\u8be2\u6587\u4ef6\u6216\u7ba1\u7406\u670d\u52a1\u5668\u6765\u52a8\u6001\u53d1\u73b0\u8d44\u6e90\u3002\u6982\u62ec\u5730\u8bb2\uff0c\u5bf9\u5e94\u7684\u53d1\u73b0\u670d\u52a1\u53ca\u5176\u76f8\u5e94\u7684 API \u88ab\u79f0\u4f5c xDS\u3002Envoy \u901a\u8fc7**\u8ba2\u9605\uff08subscription\uff09**\u65b9\u5f0f\u6765\u83b7\u53d6\u8d44\u6e90\uff0c\u8ba2\u9605\u65b9\u5f0f\u6709\u4ee5\u4e0b\u4e09\u79cd\uff1a</p> <ul> <li>\u6587\u4ef6\u8ba2\u9605\uff1a\u76d1\u63a7\u6307\u5b9a\u8def\u5f84\u4e0b\u7684\u6587\u4ef6\uff0c\u53d1\u73b0\u52a8\u6001\u8d44\u6e90\u7684\u6700\u7b80\u5355\u65b9\u5f0f\u5c31\u662f\u5c06\u5176\u4fdd\u5b58\u4e8e\u6587\u4ef6\uff0c\u5e76\u5c06\u8def\u5f84\u914d\u7f6e\u5728 ConfigSource \u4e2d\u7684 <code>path</code> \u53c2\u6570\u4e2d\u3002</li> <li>gRPC \u6d41\u5f0f\u8ba2\u9605\uff1a\u6bcf\u4e2a xDS API \u53ef\u4ee5\u5355\u72ec\u914d\u7f6e <code>ApiConfigSource</code>\uff0c\u6307\u5411\u5bf9\u5e94\u7684\u4e0a\u6e38\u7ba1\u7406\u670d\u52a1\u5668\u7684\u96c6\u7fa4\u5730\u5740\u3002</li> <li>\u8f6e\u8be2 REST-JSON \u8f6e\u8be2\u8ba2\u9605\uff1a\u5355\u4e2a xDS API \u53ef\u5bf9 REST \u7aef\u70b9\u8fdb\u884c\u7684\u540c\u6b65\uff08\u957f\uff09\u8f6e\u8be2\u3002</li> </ul> <p>\u4ee5\u4e0a\u7684 xDS \u8ba2\u9605\u65b9\u5f0f\u8be6\u60c5\u8bf7\u53c2\u8003 xDS \u534f\u8bae\u89e3\u6790\u3002Istio \u4f7f\u7528\u7684 gRPC \u6d41\u5f0f\u8ba2\u9605\u7684\u65b9\u5f0f\u914d\u7f6e\u6240\u6709\u7684\u6570\u636e\u5e73\u9762\u7684 sidecar proxy\u3002</p> <p>\u5173\u4e8e xDS \u534f\u8bae\u7684\u8be6\u7ec6\u5206\u89e3\u8bf7\u53c2\u8003\u4e01\u8f76\u7fa4\u535a\u58eb\u7684\u8fd9\u51e0\u7bc7\u6587\u7ae0\uff1a</p> <ul> <li>Service Mesh\u6df1\u5ea6\u5b66\u4e60\u7cfb\u5217part1\u2014istio\u6e90\u7801\u5206\u6790\u4e4bpilot-agent\u6a21\u5757\u5206\u6790</li> <li>Service Mesh\u6df1\u5ea6\u5b66\u4e60\u7cfb\u5217part2\u2014istio\u6e90\u7801\u5206\u6790\u4e4bpilot-discovery\u6a21\u5757\u5206\u6790</li> <li>Service Mesh\u6df1\u5ea6\u5b66\u4e60\u7cfb\u5217part3\u2014istio\u6e90\u7801\u5206\u6790\u4e4bpilot-discovery\u6a21\u5757\u5206\u6790\uff08\u7eed\uff09</li> </ul> <p>\u6587\u7ae0\u4e2d\u4ecb\u7ecd\u4e86 Istio pilot \u7684\u603b\u4f53\u67b6\u6784\u3001Envoy \u914d\u7f6e\u7684\u751f\u6210\u3001pilot-discovery \u6a21\u5757\u7684\u529f\u80fd\uff0c\u4ee5\u53ca xDS \u534f\u8bae\u4e2d\u7684 CDS\u3001EDS \u53ca ADS\uff0c\u5173\u4e8e ADS \u8be6\u60c5\u8bf7\u53c2\u8003 Enovy \u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#251-xds","title":"2.5.1 xDS \u534f\u8bae\u8981\u70b9","text":"<p>\u6700\u540e\u603b\u7ed3\u4e0b\u5173\u4e8e xDS \u534f\u8bae\u7684\u8981\u70b9\uff1a</p> <ul> <li>CDS\u3001EDS\u3001LDS\u3001RDS \u662f\u6700\u57fa\u7840\u7684 xDS \u534f\u8bae\uff0c\u5b83\u4eec\u53ef\u4ee5\u5206\u522b\u72ec\u7acb\u66f4\u65b0\u7684\u3002</li> <li>\u6240\u6709\u7684\u53d1\u73b0\u670d\u52a1\uff08Discovery Service\uff09\u53ef\u4ee5\u8fde\u63a5\u4e0d\u540c\u7684 Management Server\uff0c\u4e5f\u5c31\u662f\u8bf4\u7ba1\u7406 xDS \u7684\u670d\u52a1\u5668\u53ef\u4ee5\u662f\u591a\u4e2a\u3002</li> <li>Envoy \u5728\u539f\u59cb xDS \u534f\u8bae\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u4e86\u4e00\u4e9b\u5217\u6269\u5145\uff0c\u589e\u52a0\u4e86 SDS\uff08\u79d8\u94a5\u53d1\u73b0\u670d\u52a1\uff09\u3001ADS\uff08\u805a\u5408\u53d1\u73b0\u670d\u52a1\uff09\u3001HDS\uff08\u5065\u5eb7\u53d1\u73b0\u670d\u52a1\uff09\u3001MS\uff08Metric \u670d\u52a1\uff09\u3001RLS\uff08\u901f\u7387\u9650\u5236\u670d\u52a1\uff09\u7b49 API\u3002</li> <li>\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\uff0c\u82e5\u76f4\u63a5\u4f7f\u7528 xDS \u539f\u59cb API \u7684\u8bdd\uff0c\u9700\u8981\u4fdd\u8bc1\u8fd9\u6837\u7684\u987a\u5e8f\u66f4\u65b0\uff1aCDS \u2192 EDS \u2192 LDS \u2192 RDS\uff0c\u8fd9\u662f\u9075\u5faa\u7535\u5b50\u5de5\u7a0b\u4e2d\u7684**\u5148\u5408\u540e\u65ad**\uff08Make-Before-Break\uff09\u539f\u5219\uff0c\u5373\u5728\u65ad\u5f00\u539f\u6765\u7684\u8fde\u63a5\u4e4b\u524d\u5148\u5efa\u7acb\u597d\u65b0\u7684\u8fde\u63a5\uff0c\u5e94\u7528\u5728\u8def\u7531\u91cc\u5c31\u662f\u4e3a\u4e86\u9632\u6b62\u8bbe\u7f6e\u4e86\u65b0\u7684\u8def\u7531\u89c4\u5219\u7684\u65f6\u5019\u5374\u65e0\u6cd5\u53d1\u73b0\u4e0a\u6e38\u96c6\u7fa4\u800c\u5bfc\u81f4\u6d41\u91cf\u88ab\u4e22\u5f03\u7684\u60c5\u51b5\uff0c\u7c7b\u4f3c\u4e8e\u7535\u8def\u91cc\u7684\u65ad\u8def\u3002</li> <li>CDS \u8bbe\u7f6e Service Mesh \u4e2d\u6709\u54ea\u4e9b\u670d\u52a1\u3002</li> <li>EDS \u8bbe\u7f6e\u54ea\u4e9b\u5b9e\u4f8b\uff08Endpoint\uff09\u5c5e\u4e8e\u8fd9\u4e9b\u670d\u52a1\uff08Cluster\uff09\u3002</li> <li>LDS \u8bbe\u7f6e\u5b9e\u4f8b\u4e0a\u76d1\u542c\u7684\u7aef\u53e3\u4ee5\u914d\u7f6e\u8def\u7531\u3002</li> <li>RDS \u6700\u7ec8\u670d\u52a1\u95f4\u7684\u8def\u7531\u5173\u7cfb\uff0c\u5e94\u8be5\u4fdd\u8bc1\u6700\u540e\u66f4\u65b0 RDS\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#26-envoy","title":"2.6 Envoy","text":"<p>Envoy \u662f Istio Service Mesh \u4e2d\u9ed8\u8ba4\u7684 Sidecar\uff0cIstio \u5728 Enovy \u7684\u57fa\u7840\u4e0a\u6309\u7167 Envoy \u7684 xDS \u534f\u8bae\u6269\u5c55\u4e86\u5176\u63a7\u5236\u5e73\u9762\uff0c\u5728\u8bb2\u5230 Envoy xDS \u534f\u8bae\u4e4b\u524d\u8fd8\u9700\u8981\u6211\u4eec\u5148\u719f\u6089\u4e0b Envoy \u7684\u57fa\u672c\u672f\u8bed\u3002\u4e0b\u9762\u5217\u4e3e\u4e86 Envoy \u91cc\u7684\u57fa\u672c\u672f\u8bed\u53ca\u5176\u6570\u636e\u7ed3\u6784\u89e3\u6790\uff0c\u5173\u4e8e Envoy \u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 Envoy \u5b98\u65b9\u6587\u6863\uff0c\u81f3\u4e8e Envoy \u5728 Service Mesh\uff08\u4e0d\u4ec5\u9650\u4e8e Istio\uff09 \u4e2d\u662f\u5982\u4f55\u4f5c\u4e3a\u8f6c\u53d1\u4ee3\u7406\u5de5\u4f5c\u7684\u8bf7\u53c2\u8003\u7f51\u6613\u4e91\u5218\u8d85\u7684\u8fd9\u7bc7\u6df1\u5165\u89e3\u8bfb Service Mesh \u80cc\u540e\u7684\u6280\u672f\u7ec6\u8282 \u4ee5\u53ca\u7406\u89e3 Istio Service Mesh \u4e2d Envoy \u4ee3\u7406 Sidecar \u6ce8\u5165\u53ca\u6d41\u91cf\u52ab\u6301\uff0c\u672c\u6587\u5f15\u7528\u5176\u4e2d\u7684\u4e00\u4e9b\u89c2\u70b9\uff0c\u8be6\u7ec6\u5185\u5bb9\u4e0d\u518d\u8d58\u8ff0\u3002</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#261","title":"2.6.1 \u57fa\u672c\u672f\u8bed","text":"<p>\u4e0b\u9762\u662f\u60a8\u5e94\u8be5\u4e86\u89e3\u7684 Enovy \u91cc\u7684\u57fa\u672c\u672f\u8bed\uff1a</p> <ul> <li>Downstream\uff08\u4e0b\u6e38\uff09\uff1a\u4e0b\u6e38\u4e3b\u673a\u8fde\u63a5\u5230 Envoy\uff0c\u53d1\u9001\u8bf7\u6c42\u5e76\u63a5\u6536\u54cd\u5e94\uff0c\u5373\u53d1\u9001\u8bf7\u6c42\u7684\u4e3b\u673a\u3002</li> <li>Upstream\uff08\u4e0a\u6e38\uff09\uff1a\u4e0a\u6e38\u4e3b\u673a\u63a5\u6536\u6765\u81ea Envoy \u7684\u8fde\u63a5\u548c\u8bf7\u6c42\uff0c\u5e76\u8fd4\u56de\u54cd\u5e94\uff0c\u5373\u63a5\u53d7\u8bf7\u6c42\u7684\u4e3b\u673a\u3002</li> <li>Listener\uff08\u76d1\u542c\u5668\uff09\uff1a\u76d1\u542c\u5668\u662f\u547d\u540d\u7f51\u5730\u5740\uff08\u4f8b\u5982\uff0c\u7aef\u53e3\u3001unix domain socket \u7b49)\uff0c\u4e0b\u6e38\u5ba2\u6237\u7aef\u53ef\u4ee5\u8fde\u63a5\u8fd9\u4e9b\u76d1\u542c\u5668\u3002Envoy \u66b4\u9732\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u76d1\u542c\u5668\u7ed9\u4e0b\u6e38\u4e3b\u673a\u8fde\u63a5\u3002</li> <li>Cluster\uff08\u96c6\u7fa4\uff09\uff1a\u96c6\u7fa4\u662f\u6307 Envoy \u8fde\u63a5\u7684\u4e00\u7ec4\u903b\u8f91\u76f8\u540c\u7684\u4e0a\u6e38\u4e3b\u673a\u3002Envoy \u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u6765\u53d1\u73b0\u96c6\u7fa4\u7684\u6210\u5458\u3002\u53ef\u4ee5\u9009\u62e9\u901a\u8fc7\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u6765\u786e\u5b9a\u96c6\u7fa4\u6210\u5458\u7684\u5065\u5eb7\u72b6\u6001\u3002Envoy \u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u51b3\u5b9a\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u96c6\u7fa4\u7684\u54ea\u4e2a\u6210\u5458\u3002</li> </ul> <p>Envoy \u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a Listener\uff0c\u6bcf\u4e2a Listener \u4e2d\u53c8\u53ef\u4ee5\u8bbe\u7f6e filter chain\uff08\u8fc7\u6ee4\u5668\u94fe\u8868\uff09\uff0c\u800c\u4e14\u8fc7\u6ee4\u5668\u662f\u53ef\u6269\u5c55\u7684\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u66f4\u65b9\u4fbf\u6211\u4eec\u64cd\u4f5c\u6d41\u91cf\u7684\u884c\u4e3a\uff0c\u4f8b\u5982\u8bbe\u7f6e\u52a0\u5bc6\u3001\u79c1\u6709 RPC \u7b49\u3002</p> <p>xDS \u534f\u8bae\u662f\u7531 Envoy \u63d0\u51fa\u7684\uff0c\u73b0\u5728\u662f Istio \u4e2d\u9ed8\u8ba4\u7684 sidecar proxy\uff0c\u4f46\u53ea\u8981\u5b9e\u73b0 xDS \u534f\u8bae\u7406\u8bba\u4e0a\u90fd\u662f\u53ef\u4ee5\u4f5c\u4e3a Istio \u4e2d\u7684 sidecar proxy \u7684\uff0c\u4f8b\u5982\u8682\u8681\u91d1\u670d\u5f00\u6e90\u7684 SOFAMosn \u548c nginx \u5f00\u6e90\u7684 nginmesh\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#27-istio-service-mesh","title":"2.7 Istio Service Mesh","text":"<p>\u56fe\u7247 - Istio service mesh \u67b6\u6784\u56fe</p> <p>Istio \u662f\u4e00\u4e2a\u529f\u80fd\u5341\u5206\u4e30\u5bcc\u7684 Service Mesh\uff0c\u5b83\u5305\u62ec\u5982\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u6d41\u91cf\u7ba1\u7406\uff1a\u8fd9\u662f Istio \u7684\u6700\u57fa\u672c\u7684\u529f\u80fd\u3002</li> <li>\u7b56\u7565\u63a7\u5236\uff1a\u901a\u8fc7 Mixer \u7ec4\u4ef6\u548c\u5404\u79cd\u9002\u914d\u5668\u6765\u5b9e\u73b0\uff0c\u5b9e\u73b0\u8bbf\u95ee\u63a7\u5236\u7cfb\u7edf\u3001\u9065\u6d4b\u6355\u83b7\u3001\u914d\u989d\u7ba1\u7406\u548c\u8ba1\u8d39\u7b49\u3002</li> <li>\u53ef\u89c2\u6d4b\u6027\uff1a\u901a\u8fc7 Mixer \u6765\u5b9e\u73b0\u3002</li> <li>\u5b89\u5168\u8ba4\u8bc1\uff1aCitadel \u7ec4\u4ef6\u505a\u5bc6\u94a5\u548c\u8bc1\u4e66\u7ba1\u7406\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#271-istio","title":"2.7.1 Istio \u4e2d\u7684\u6d41\u91cf\u7ba1\u7406","text":"<p>Istio \u4e2d\u5b9a\u4e49\u4e86\u5982\u4e0b\u7684 CRD \u6765\u5e2e\u52a9\u7528\u6237\u8fdb\u884c\u6d41\u91cf\u7ba1\u7406\uff1a</p> <ul> <li>Gateway\uff1aGateway \u63cf\u8ff0\u4e86\u5728\u7f51\u7edc\u8fb9\u7f18\u8fd0\u884c\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u7528\u4e8e\u63a5\u6536\u4f20\u5165\u6216\u4f20\u51fa\u7684HTTP / TCP\u8fde\u63a5\u3002</li> <li>VirtualService\uff1aVirtualService \u5b9e\u9645\u4e0a\u5c06 Kubernetes \u670d\u52a1\u8fde\u63a5\u5230 Istio Gateway\u3002\u5b83\u8fd8\u53ef\u4ee5\u6267\u884c\u66f4\u591a\u64cd\u4f5c\uff0c\u4f8b\u5982\u5b9a\u4e49\u4e00\u7ec4\u6d41\u91cf\u8def\u7531\u89c4\u5219\uff0c\u4ee5\u4fbf\u5728\u4e3b\u673a\u88ab\u5bfb\u5740\u65f6\u5e94\u7528\u3002</li> <li>DestinationRule\uff1a<code>DestinationRule</code> \u6240\u5b9a\u4e49\u7684\u7b56\u7565\uff0c\u51b3\u5b9a\u4e86\u7ecf\u8fc7\u8def\u7531\u5904\u7406\u4e4b\u540e\u7684\u6d41\u91cf\u7684\u8bbf\u95ee\u7b56\u7565\u3002\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u5b9a\u4e49\u6d41\u91cf\u5982\u4f55\u8def\u7531\u3002\u8fd9\u4e9b\u7b56\u7565\u4e2d\u53ef\u4ee5\u5b9a\u4e49\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e\u3001\u8fde\u63a5\u6c60\u5c3a\u5bf8\u4ee5\u53ca\u5916\u90e8\u68c0\u6d4b\uff08\u7528\u4e8e\u5728\u8d1f\u8f7d\u5747\u8861\u6c60\u4e2d\u5bf9\u4e0d\u5065\u5eb7\u4e3b\u673a\u8fdb\u884c\u8bc6\u522b\u548c\u9a71\u9010\uff09\u914d\u7f6e\u3002</li> <li>EnvoyFilter\uff1a<code>EnvoyFilter</code> \u5bf9\u8c61\u63cf\u8ff0\u4e86\u9488\u5bf9\u4ee3\u7406\u670d\u52a1\u7684\u8fc7\u6ee4\u5668\uff0c\u8fd9\u4e9b\u8fc7\u6ee4\u5668\u53ef\u4ee5\u5b9a\u5236\u7531 Istio Pilot \u751f\u6210\u7684\u4ee3\u7406\u914d\u7f6e\u3002\u8fd9\u4e2a\u914d\u7f6e\u521d\u7ea7\u7528\u6237\u4e00\u822c\u5f88\u5c11\u7528\u5230\u3002</li> <li>ServiceEntry\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b Istio Service Mesh \u4e2d\u7684\u670d\u52a1\u662f\u65e0\u6cd5\u53d1\u73b0 Mesh \u5916\u7684\u670d\u52a1\u7684\uff0c<code>ServiceEntry</code> \u80fd\u591f\u5728 Istio \u5185\u90e8\u7684\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u52a0\u5165\u989d\u5916\u7684\u6761\u76ee\uff0c\u4ece\u800c\u8ba9\u7f51\u683c\u4e2d\u81ea\u52a8\u53d1\u73b0\u7684\u670d\u52a1\u80fd\u591f\u8bbf\u95ee\u548c\u8def\u7531\u5230\u8fd9\u4e9b\u624b\u5de5\u52a0\u5165\u7684\u670d\u52a1\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#28-kubernetes-vs-envoy-xds-vs-istio","title":"2.8 Kubernetes vs Envoy xDS vs Istio","text":"<p>\u5728\u9605\u8bfb\u5b8c\u4e0a\u6587\u5bf9 Kubernetes \u7684 <code>kube-proxy</code> \u7ec4\u4ef6\u3001Envoy xDS \u548c Istio \u4e2d\u6d41\u91cf\u7ba1\u7406\u7684\u62bd\u8c61\u6982\u5ff5\u4e4b\u540e\uff0c\u4e0b\u9762\u5c06\u5e26\u60a8\u4ec5\u5c31\u6d41\u91cf\u7ba1\u7406\u65b9\u9762\u6bd4\u8f83\u4e0b\u4e09\u8005\u5bf9\u5e94\u7684\u7ec4\u4ef6/\u534f\u8bae\uff08\u6ce8\u610f\uff0c\u4e09\u8005\u4e0d\u53ef\u4ee5\u5b8c\u5168\u7b49\u540c\uff09\u3002</p> Kubernetes Envoy xDS Istio Service Mesh Endpoint Endpoint - Service Route VirtualService kube-proxy Route DestinationRule kube-proxy Listener EnvoyFilter Ingress Listener Gateway Service Cluster ServiceEntry"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#29","title":"2.9 \u603b\u7ed3","text":"<p>\u5982\u679c\u8bf4 Kubernetes \u7ba1\u7406\u7684\u5bf9\u8c61\u662f Pod\uff0c\u90a3\u4e48 Service Mesh \u4e2d\u7ba1\u7406\u7684\u5bf9\u8c61\u5c31\u662f\u4e00\u4e2a\u4e2a Service\uff0c\u6240\u4ee5\u8bf4\u4f7f\u7528 Kubernetes \u7ba1\u7406\u5fae\u670d\u52a1\u540e\u518d\u5e94\u7528 Service Mesh \u5c31\u662f\u6c34\u5230\u6e20\u6210\u4e86\uff0c\u5982\u679c\u8fde Service \u4f60\u4e5f\u4e0d\u60f3\u7ba1\u4e86\uff0c\u90a3\u5c31\u7528\u5982 knative \u8fd9\u6837\u7684 serverless \u5e73\u53f0\uff0c\u4f46\u8fd9\u5c31\u662f\u540e\u8bdd\u4e86\u3002</p> <p>Envoy \u7684\u529f\u80fd\u4e5f\u4e0d\u53ea\u662f\u505a\u6d41\u91cf\u8f6c\u53d1\uff0c\u4ee5\u4e0a\u6982\u5ff5\u53ea\u4e0d\u8fc7\u662f Istio \u5728 Kubernetes \u4e4b\u4e0a\u65b0\u589e\u4e00\u5c42\u62bd\u8c61\u5c42\u4e2d\u7684\u51b0\u5c71\u4e00\u89d2\uff0c\u4f46\u56e0\u4e3a\u6d41\u91cf\u7ba1\u7406\u662f\u670d\u52a1\u7f51\u683c\u6700\u57fa\u7840\u4e5f\u662f\u6700\u91cd\u8981\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u8fd9\u5c06\u6210\u4e3a\u672c\u4e66\u7684\u5f00\u59cb\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#_2","title":"\u4e09 \u6982\u5ff5\u539f\u7406","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#31-istio","title":"3.1 Istio\u6982\u5ff5\u539f\u7406","text":"<p>\u672c\u7ae0\u4e3b\u8981\u4ecb\u7ecd Istio \u548c Service Mesh\uff08\u670d\u52a1\u7f51\u683c\uff09\u7684\u6982\u5ff5\u548c\u539f\u7406\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#32","title":"3.2 \u4ec0\u4e48\u662f\u670d\u52a1\u7f51\u683c\uff1f","text":"<p>Service mesh \u53c8\u8bd1\u4f5c \u201c\u670d\u52a1\u7f51\u683c\u201d\uff0c\u4f5c\u4e3a\u670d\u52a1\u95f4\u901a\u4fe1\u7684\u57fa\u7840\u8bbe\u65bd\u5c42\u3002Buoyant \u516c\u53f8\u7684 CEO Willian Morgan \u5728\u4ed6\u7684\u8fd9\u7bc7\u6587\u7ae0 WHAT\u2019S A SERVICE MESH? AND WHY DO I NEED ONE? \u4e2d\u89e3\u91ca\u4e86\u4ec0\u4e48\u662f Service Mesh\uff0c\u4e3a\u4ec0\u4e48\u4e91\u539f\u751f\u5e94\u7528\u9700\u8981 Service Mesh\u3002</p> <p>\u670d\u52a1\u7f51\u683c\u662f\u7528\u4e8e\u5904\u7406\u670d\u52a1\u95f4\u901a\u4fe1\u7684\u4e13\u7528\u57fa\u7840\u8bbe\u65bd\u5c42\u3002\u5b83\u8d1f\u8d23\u901a\u8fc7\u5305\u542b\u73b0\u4ee3\u4e91\u539f\u751f\u5e94\u7528\u7a0b\u5e8f\u7684\u590d\u6742\u670d\u52a1\u62d3\u6251\u6765\u53ef\u9760\u5730\u4f20\u9012\u8bf7\u6c42\u3002\u5b9e\u9645\u4e0a\uff0c\u670d\u52a1\u7f51\u683c\u901a\u5e38\u901a\u8fc7\u4e00\u7ec4\u8f7b\u91cf\u7ea7\u7f51\u7edc\u4ee3\u7406\u6765\u5b9e\u73b0\uff0c\u8fd9\u4e9b\u4ee3\u7406\u4e0e\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u4e00\u8d77\u90e8\u7f72\uff0c\u800c\u4e0d\u9700\u8981\u611f\u77e5\u5e94\u7528\u7a0b\u5e8f\u672c\u8eab\u3002\u2014\u2014 Willian Morgan Buoyant CEO</p> <p>\u670d\u52a1\u7f51\u683c\uff08Service Mesh\uff09\u8fd9\u4e2a\u672f\u8bed\u901a\u5e38\u7528\u4e8e\u63cf\u8ff0\u6784\u6210\u8fd9\u4e9b\u5e94\u7528\u7a0b\u5e8f\u7684\u5fae\u670d\u52a1\u7f51\u7edc\u4ee5\u53ca\u5e94\u7528\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002\u968f\u7740\u89c4\u6a21\u548c\u590d\u6742\u6027\u7684\u589e\u957f\uff0c\u670d\u52a1\u7f51\u683c\u8d8a\u6765\u8d8a\u96be\u4ee5\u7406\u89e3\u548c\u7ba1\u7406\u3002\u5b83\u7684\u9700\u6c42\u5305\u62ec\u670d\u52a1\u53d1\u73b0\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u6545\u969c\u6062\u590d\u3001\u6307\u6807\u6536\u96c6\u548c\u76d1\u63a7\u4ee5\u53ca\u901a\u5e38\u66f4\u52a0\u590d\u6742\u7684\u8fd0\u7ef4\u9700\u6c42\uff0c\u4f8b\u5982 A/B \u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u53d1\u5e03\u3001\u9650\u6d41\u3001\u8bbf\u95ee\u63a7\u5236\u548c\u7aef\u5230\u7aef\u8ba4\u8bc1\u7b49\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#321","title":"3.2.1 \u670d\u52a1\u7f51\u683c\u7684\u7279\u70b9","text":"<p>\u670d\u52a1\u7f51\u683c\u6709\u5982\u4e0b\u51e0\u4e2a\u7279\u70b9\uff1a</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f\u95f4\u901a\u8baf\u7684\u4e2d\u95f4\u5c42</li> <li>\u8f7b\u91cf\u7ea7\u7f51\u7edc\u4ee3\u7406</li> <li>\u5e94\u7528\u7a0b\u5e8f\u65e0\u611f\u77e5</li> <li>\u89e3\u8026\u5e94\u7528\u7a0b\u5e8f\u7684\u91cd\u8bd5/\u8d85\u65f6\u3001\u76d1\u63a7\u3001\u8ffd\u8e2a\u548c\u670d\u52a1\u53d1\u73b0</li> </ul> <p>\u76ee\u524d\u4e24\u6b3e\u6d41\u884c\u7684\u670d\u52a1\u7f51\u683c\u5f00\u6e90\u8f6f\u4ef6 Linkerd \u548c Istio \u90fd\u53ef\u4ee5\u76f4\u63a5\u5728 Kubernetes \u4e2d\u96c6\u6210\uff0c\u5176\u4e2d Linkerd \u5df2\u7ecf\u6210\u4e3a CNCF \u6210\u5458\uff0cIstio \u5728 2018\u5e747\u670831\u65e5\u5ba3\u5e03 1.0\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#322","title":"3.2.2 \u7406\u89e3\u670d\u52a1\u7f51\u683c","text":"<p>\u5982\u679c\u7528\u4e00\u53e5\u8bdd\u6765\u89e3\u91ca\u4ec0\u4e48\u662f\u670d\u52a1\u7f51\u683c\uff0c\u53ef\u4ee5\u5c06\u5b83\u6bd4\u4f5c\u662f\u5e94\u7528\u7a0b\u5e8f\u6216\u8005\u8bf4\u5fae\u670d\u52a1\u95f4\u7684 TCP/IP\uff0c\u8d1f\u8d23\u670d\u52a1\u4e4b\u95f4\u7684\u7f51\u7edc\u8c03\u7528\u3001\u9650\u6d41\u3001\u7194\u65ad\u548c\u76d1\u63a7\u3002\u5bf9\u4e8e\u7f16\u5199\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u4e00\u822c\u65e0\u987b\u5173\u5fc3 TCP/IP \u8fd9\u4e00\u5c42\uff08\u6bd4\u5982\u901a\u8fc7 HTTP \u534f\u8bae\u7684 RESTful \u5e94\u7528\uff09\uff0c\u540c\u6837\u4f7f\u7528\u670d\u52a1\u7f51\u683c\u4e5f\u5c31\u65e0\u987b\u5173\u5fc3\u670d\u52a1\u4e4b\u95f4\u7684\u90a3\u4e9b\u539f\u6765\u662f\u901a\u8fc7\u5e94\u7528\u7a0b\u5e8f\u6216\u8005\u5176\u4ed6\u6846\u67b6\u5b9e\u73b0\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982 Spring Cloud\u3001OSS\uff0c\u73b0\u5728\u53ea\u8981\u4ea4\u7ed9\u670d\u52a1\u7f51\u683c\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>Phil Cal\u00e7ado \u5728\u4ed6\u7684\u8fd9\u7bc7\u535a\u5ba2 Pattern: Service Mesh \u4e2d\u8be6\u7ec6\u89e3\u91ca\u4e86\u670d\u52a1\u7f51\u683c\u7684\u6765\u9f99\u53bb\u8109\uff1a</p> <ol> <li>\u4ece\u6700\u539f\u59cb\u7684\u4e3b\u673a\u4e4b\u95f4\u76f4\u63a5\u4f7f\u7528\u7f51\u7ebf\u76f8\u8fde</li> <li>\u7f51\u7edc\u5c42\u7684\u51fa\u73b0</li> <li>\u96c6\u6210\u5230\u5e94\u7528\u7a0b\u5e8f\u5185\u90e8\u7684\u63a7\u5236\u6d41</li> <li>\u5206\u89e3\u5230\u5e94\u7528\u7a0b\u5e8f\u5916\u90e8\u7684\u63a7\u5236\u6d41</li> <li>\u5e94\u7528\u7a0b\u5e8f\u4e2d\u96c6\u6210\u670d\u52a1\u53d1\u73b0\u548c\u65ad\u8def\u5668</li> <li>\u51fa\u73b0\u4e86\u4e13\u95e8\u7528\u4e8e\u670d\u52a1\u53d1\u73b0\u548c\u65ad\u8def\u5668\u7684\u8f6f\u4ef6\u5305/\u5e93\uff0c\u5982 Twitter \u7684 Finagle \u548c Facebook \u7684 Proxygen\uff0c\u8fd9\u65f6\u5019\u8fd8\u662f\u96c6\u6210\u5728\u5e94\u7528\u7a0b\u5e8f\u5185\u90e8</li> <li>\u51fa\u73b0\u4e86\u4e13\u95e8\u7528\u4e8e\u670d\u52a1\u53d1\u73b0\u548c\u65ad\u8def\u5668\u7684\u5f00\u6e90\u8f6f\u4ef6\uff0c\u5982 Netflix OSS\u3001Airbnb \u7684 synapse \u548c nerve</li> <li>\u6700\u540e\u4f5c\u4e3a\u5fae\u670d\u52a1\u7684\u4e2d\u95f4\u5c42\u670d\u52a1\u7f51\u683c\u51fa\u73b0</li> </ol> <p>\u670d\u52a1\u7f51\u683c\u7684\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u56fe\u7247\u6765\u81ea\uff1aPattern: Service Mesh</p> <p>\u670d\u52a1\u7f51\u683c\u4f5c\u4e3a sidecar \u8fd0\u884c\uff0c\u5bf9\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u662f\u900f\u660e\uff0c\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u95f4\u7684\u6d41\u91cf\u90fd\u4f1a\u901a\u8fc7\u5b83\uff0c\u6240\u4ee5\u5bf9\u5e94\u7528\u7a0b\u5e8f\u6d41\u91cf\u7684\u63a7\u5236\u90fd\u53ef\u4ee5\u5728 service mesh \u4e2d\u5b9e\u73b0\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#323","title":"3.2.3 \u670d\u52a1\u7f51\u683c\u5982\u4f55\u5de5\u4f5c\uff1f","text":"<p>\u4e0b\u9762\u4ee5 Istio \u4e3a\u4f8b\u8bb2\u89e3\u670d\u52a1\u7f51\u683c\u5982\u4f55\u5728 Kubernetes \u4e2d\u5de5\u4f5c\u3002</p> <ol> <li>Istio \u5c06\u670d\u52a1\u8bf7\u6c42\u8def\u7531\u5230\u76ee\u7684\u5730\u5740\uff0c\u6839\u636e\u5176\u4e2d\u7684\u53c2\u6570\u5224\u65ad\u662f\u5230\u751f\u4ea7\u73af\u5883\u3001\u6d4b\u8bd5\u73af\u5883\u8fd8\u662f staging \u73af\u5883\u4e2d\u7684\u670d\u52a1\uff08\u670d\u52a1\u53ef\u80fd\u540c\u65f6\u90e8\u7f72\u5728\u8fd9\u4e09\u4e2a\u73af\u5883\u4e2d\uff09\uff0c\u662f\u8def\u7531\u5230\u672c\u5730\u73af\u5883\u8fd8\u662f\u516c\u6709\u4e91\u73af\u5883\uff1f\u6240\u6709\u7684\u8fd9\u4e9b\u8def\u7531\u4fe1\u606f\u53ef\u4ee5\u52a8\u6001\u914d\u7f6e\uff0c\u53ef\u4ee5\u662f\u5168\u5c40\u914d\u7f6e\u4e5f\u53ef\u4ee5\u4e3a\u67d0\u4e9b\u670d\u52a1\u5355\u72ec\u914d\u7f6e\u3002</li> <li>\u5f53 Istio \u786e\u8ba4\u4e86\u76ee\u7684\u5730\u5740\u540e\uff0c\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u76f8\u5e94\u670d\u52a1\u53d1\u73b0\u7aef\u70b9\uff0c\u5728 Kubernetes \u4e2d\u662f service\uff0c\u7136\u540e service \u4f1a\u5c06\u670d\u52a1\u8f6c\u53d1\u7ed9\u540e\u7aef\u7684\u5b9e\u4f8b\u3002</li> <li>Istio \u6839\u636e\u5b83\u89c2\u6d4b\u5230\u6700\u8fd1\u8bf7\u6c42\u7684\u5ef6\u8fdf\u65f6\u95f4\uff0c\u9009\u62e9\u51fa\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u7684\u5b9e\u4f8b\u4e2d\u54cd\u5e94\u6700\u5feb\u7684\u5b9e\u4f8b\u3002</li> <li>Istio \u5c06\u8bf7\u6c42\u53d1\u9001\u7ed9\u8be5\u5b9e\u4f8b\uff0c\u540c\u65f6\u8bb0\u5f55\u54cd\u5e94\u7c7b\u578b\u548c\u5ef6\u8fdf\u6570\u636e\u3002</li> <li>\u5982\u679c\u8be5\u5b9e\u4f8b\u6302\u4e86\u3001\u4e0d\u54cd\u5e94\u4e86\u6216\u8005\u8fdb\u7a0b\u4e0d\u5de5\u4f5c\u4e86\uff0cIstio \u5c06\u628a\u8bf7\u6c42\u53d1\u9001\u5230\u5176\u4ed6\u5b9e\u4f8b\u4e0a\u91cd\u8bd5\u3002</li> <li>\u5982\u679c\u8be5\u5b9e\u4f8b\u6301\u7eed\u8fd4\u56de error\uff0cIstio \u4f1a\u5c06\u8be5\u5b9e\u4f8b\u4ece\u8d1f\u8f7d\u5747\u8861\u6c60\u4e2d\u79fb\u9664\uff0c\u7a0d\u540e\u518d\u5468\u671f\u6027\u7684\u91cd\u8bd5\u3002</li> <li>\u5982\u679c\u8bf7\u6c42\u7684\u622a\u6b62\u65f6\u95f4\u5df2\u8fc7\uff0cIstio \u4e3b\u52a8\u4ee5\u5931\u8d25\u7684\u65b9\u5f0f\u7ed3\u675f\u8be5\u8bf7\u6c42\uff0c\u800c\u4e0d\u662f\u518d\u6b21\u5c1d\u8bd5\u6dfb\u52a0\u8d1f\u8f7d\u3002</li> <li>Istio \u4ee5 metric \u548c\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7684\u5f62\u5f0f\u6355\u83b7\u4e0a\u8ff0\u884c\u4e3a\u7684\u5404\u4e2a\u65b9\u9762\uff0c\u8fd9\u4e9b\u8ffd\u8e2a\u4fe1\u606f\u5c06\u53d1\u9001\u5230\u96c6\u4e2d metric \u7cfb\u7edf\u3002</li> </ol>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#324","title":"3.2.4 \u4e3a\u4f55\u4f7f\u7528\u670d\u52a1\u7f51\u683c\uff1f","text":"<p>\u670d\u52a1\u7f51\u683c\u5e76\u6ca1\u6709\u7ed9\u6211\u4eec\u5e26\u6765\u65b0\u529f\u80fd\uff0c\u5b83\u662f\u7528\u4e8e\u89e3\u51b3\u5176\u4ed6\u5de5\u5177\u5df2\u7ecf\u89e3\u51b3\u8fc7\u7684\u95ee\u9898\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6b21\u662f\u5728\u4e91\u539f\u751f\u7684 Kubernetes \u73af\u5883\u4e0b\u7684\u5b9e\u73b0\u3002</p> <p>\u5728\u4f20\u7edf\u7684 MVC \u4e09\u5c42 Web \u5e94\u7528\u7a0b\u5e8f\u67b6\u6784\u4e0b\uff0c\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u8baf\u5e76\u4e0d\u590d\u6742\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u5185\u90e8\u81ea\u5df1\u7ba1\u7406\u5373\u53ef\uff0c\u4f46\u662f\u5728\u73b0\u4eca\u7684\u590d\u6742\u7684\u5927\u578b\u7f51\u7ad9\u60c5\u51b5\u4e0b\uff0c\u5355\u4f53\u5e94\u7528\u88ab\u5206\u89e3\u4e3a\u4f17\u591a\u7684\u5fae\u670d\u52a1\uff0c\u670d\u52a1\u4e4b\u95f4\u7684\u4f9d\u8d56\u548c\u901a\u8baf\u5341\u5206\u590d\u6742\uff0c\u51fa\u73b0\u4e86 twitter \u5f00\u53d1\u7684 Finagle\u3001Netflix \u5f00\u53d1\u7684 Hystrix \u548c Google \u7684 Stubby \u8fd9\u6837\u7684 \u201c\u80d6\u5ba2\u6237\u7aef\u201d \u5e93\uff0c\u8fd9\u4e9b\u5c31\u662f\u65e9\u671f\u7684\u670d\u52a1\u7f51\u683c\uff0c\u4f46\u662f\u5b83\u4eec\u90fd\u4ec5\u9002\u7528\u4e8e\u7279\u5b9a\u7684\u73af\u5883\u548c\u7279\u5b9a\u7684\u5f00\u53d1\u8bed\u8a00\uff0c\u5e76\u4e0d\u80fd\u4f5c\u4e3a\u5e73\u53f0\u7ea7\u7684\u670d\u52a1\u7f51\u683c\u652f\u6301\u3002</p> <p>\u5728\u4e91\u539f\u751f\u67b6\u6784\u4e0b\uff0c\u5bb9\u5668\u7684\u4f7f\u7528\u7ed9\u4e88\u4e86\u5f02\u6784\u5e94\u7528\u7a0b\u5e8f\u7684\u66f4\u591a\u53ef\u884c\u6027\uff0cKubernetes \u589e\u5f3a\u7684\u5e94\u7528\u7684\u6a2a\u5411\u6269\u5bb9\u80fd\u529b\uff0c\u7528\u6237\u53ef\u4ee5\u5feb\u901f\u7684\u7f16\u6392\u51fa\u590d\u6742\u73af\u5883\u3001\u590d\u6742\u4f9d\u8d56\u5173\u7cfb\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u540c\u65f6\u5f00\u53d1\u8005\u53c8\u65e0\u987b\u8fc7\u591a\u5173\u5fc3\u5e94\u7528\u7a0b\u5e8f\u7684\u76d1\u63a7\u3001\u6269\u5c55\u6027\u3001\u670d\u52a1\u53d1\u73b0\u548c\u5206\u5e03\u5f0f\u8ffd\u8e2a\u8fd9\u4e9b\u7e41\u7410\u7684\u4e8b\u60c5\u800c\u4e13\u6ce8\u4e8e\u7a0b\u5e8f\u5f00\u53d1\uff0c\u8d4b\u4e88\u5f00\u53d1\u8005\u66f4\u591a\u7684\u521b\u9020\u6027\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#33","title":"3.3 \u670d\u52a1\u7f51\u683c\u67b6\u6784","text":"<p>\u4e0b\u56fe\u662fConduit Service Mesh\uff08\u73b0\u5728\u5df2\u5408\u5e76\u5230Linkerd2\u4e2d\u4e86\uff09\u7684\u67b6\u6784\u56fe\uff0c\u8fd9\u662fService Mesh\u7684\u4e00\u79cd\u5178\u578b\u7684\u67b6\u6784\u3002</p> <p></p> <p>\u670d\u52a1\u7f51\u683c\u4e2d\u5206\u4e3a**\u63a7\u5236\u5e73\u9762**\u548c**\u6570\u636e\u5e73\u9762**\uff0c\u5f53\u524d\u6d41\u884c\u7684\u4e24\u6b3e\u5f00\u6e90\u7684\u670d\u52a1\u7f51\u683c Istio \u548c Linkerd \u5b9e\u9645\u4e0a\u90fd\u662f\u8fd9\u79cd\u67b6\u6784\uff0c\u53ea\u4e0d\u8fc7 Istio \u7684\u5212\u5206\u66f4\u6e05\u6670\uff0c\u800c\u4e14\u90e8\u7f72\u66f4\u96f6\u6563\uff0c\u5f88\u591a\u7ec4\u4ef6\u90fd\u88ab\u62c6\u5206\uff0c\u63a7\u5236\u5e73\u9762\u4e2d\u5305\u62ec Mixer\u3001Pilot\u3001Citadel\uff0c\u6570\u636e\u5e73\u9762\u9ed8\u8ba4\u662f\u7528 Envoy\uff1b\u800c Linkerd \u4e2d\u53ea\u5206\u4e3a Linkerd \u505a\u6570\u636e\u5e73\u9762\uff0cnamerd \u4f5c\u4e3a\u63a7\u5236\u5e73\u9762\u3002</p> <p>\u63a7\u5236\u5e73\u9762\u7684\u7279\u70b9\uff1a</p> <ul> <li>\u4e0d\u76f4\u63a5\u89e3\u6790\u6570\u636e\u5305</li> <li>\u4e0e\u6570\u636e\u5e73\u9762\u4e2d\u7684\u4ee3\u7406\u901a\u4fe1\uff0c\u4e0b\u53d1\u7b56\u7565\u548c\u914d\u7f6e</li> <li>\u8d1f\u8d23\u7f51\u7edc\u884c\u4e3a\u7684\u53ef\u89c6\u5316</li> <li>\u901a\u5e38\u63d0\u4f9b API \u6216\u8005\u547d\u4ee4\u884c\u5de5\u5177\u53ef\u7528\u4e8e\u914d\u7f6e\u7248\u672c\u5316\u7ba1\u7406\uff0c\u4fbf\u4e8e\u6301\u7eed\u96c6\u6210\u548c\u90e8\u7f72</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#_3","title":"Istio Handbook\u4e4bIstio \u670d\u52a1\u7f51\u683c\u8fdb\u9636\u5b9e\u6218","text":"<p>\u6570\u636e\u5e73\u9762\u7684\u7279\u70b9\uff1a</p> <ul> <li>\u901a\u5e38\u662f\u6309\u7167\u65e0\u72b6\u6001\u76ee\u6807\u8bbe\u8ba1\u7684\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e3a\u4e86\u63d0\u9ad8\u6d41\u91cf\u8f6c\u53d1\u6027\u80fd\uff0c\u9700\u8981\u7f13\u5b58\u4e00\u4e9b\u6570\u636e\uff0c\u56e0\u6b64\u65e0\u72b6\u6001\u4e5f\u662f\u6709\u4e89\u8bae\u7684</li> <li>\u76f4\u63a5\u5904\u7406\u5165\u7ad9\u548c\u51fa\u7ad9\u6570\u636e\u5305\uff0c\u8f6c\u53d1\u3001\u8def\u7531\u3001\u5065\u5eb7\u68c0\u67e5\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u8ba4\u8bc1\u3001\u9274\u6743\u3001\u4ea7\u751f\u76d1\u63a7\u6570\u636e\u7b49</li> <li>\u5bf9\u5e94\u7528\u6765\u8bf4\u900f\u660e\uff0c\u5373\u53ef\u4ee5\u505a\u5230\u65e0\u611f\u77e5\u90e8\u7f72</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#331","title":"3.3.1 \u670d\u52a1\u7f51\u683c\u7684\u5b9e\u73b0\u6a21\u5f0f","text":"<p>\u6211\u4eec\u5728\u524d\u9762\u770b\u5230\u4e86\u901a\u8fc7**\u5ba2\u6237\u7aef\u5e93**\u6765\u6cbb\u7406\u670d\u52a1\u7684\u67b6\u6784\u56fe\uff0c\u90a3\u662f\u6211\u4eec\u5728\u6539\u9020\u6210 Service Mesh \u67b6\u6784\u524d\u4f7f\u7528\u5fae\u670d\u52a1\u67b6\u6784\u901a\u5e38\u7684\u5f62\u5f0f\uff0c\u4e0b\u56fe\u662f\u4f7f\u7528 Service Mesh \u67b6\u6784\u7684\u6700\u7ec8\u5f62\u5f0f\u3002</p> <p>\u200b   </p> <p>\u5f53\u7136\u5728\u8fbe\u5230\u8fd9\u4e00\u6700\u7ec8\u5f62\u6001\u4e4b\u524d\u6211\u4eec\u9700\u8981\u5c06\u67b6\u6784\u4e00\u6b65\u6b65\u6f14\u8fdb\uff0c\u4e0b\u9762\u7ed9\u51fa\u7684\u662f\u53c2\u8003\u7684\u6f14\u8fdb\u8def\u7ebf\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3311-ingress","title":"3.3.1.1 Ingress \u6216\u8fb9\u7f18\u4ee3\u7406","text":"<p>\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f Kubernetes \u505a\u5bb9\u5668\u7f16\u6392\u8c03\u5ea6\uff0c\u90a3\u4e48\u5728\u8fdb\u5316\u5230 Service Mesh \u67b6\u6784\u4e4b\u524d\uff0c\u901a\u5e38\u4f1a\u4f7f\u7528 Ingress Controller\uff0c\u505a\u96c6\u7fa4\u5185\u5916\u6d41\u91cf\u7684\u53cd\u5411\u4ee3\u7406\uff0c\u5982\u4f7f\u7528 Traefik \u6216 Nginx Ingress Controller\u3002</p> <p></p> <p>\u8fd9\u6837\u53ea\u8981\u5229\u7528 Kubernetes \u7684\u539f\u6709\u80fd\u529b\uff0c\u5f53\u4f60\u7684\u5e94\u7528\u5fae\u670d\u52a1\u5316\u5e76\u5bb9\u5668\u5316\u9700\u8981\u5f00\u653e\u5916\u90e8\u8bbf\u95ee\u4e14\u53ea\u9700\u8981 L7 \u4ee3\u7406\u7684\u8bdd\u8fd9\u79cd\u6539\u9020\u5341\u5206\u7b80\u5355\uff0c\u4f46\u95ee\u9898\u662f\u65e0\u6cd5\u7ba1\u7406\u670d\u52a1\u95f4\u6d41\u91cf\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3312","title":"3.3.1.2 \u8def\u7531\u5668\u7f51\u683c","text":"<p>Ingress \u6216\u8005\u8fb9\u7f18\u4ee3\u7406\u53ef\u4ee5\u5904\u7406\u8fdb\u51fa\u96c6\u7fa4\u7684\u6d41\u91cf\uff0c\u4e3a\u4e86\u5e94\u5bf9\u96c6\u7fa4\u5185\u7684\u670d\u52a1\u95f4\u6d41\u91cf\u7ba1\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u96c6\u7fa4\u5185\u52a0\u4e00\u4e2a <code>Router</code> \u5c42\uff0c\u5373\u8def\u7531\u5668\u5c42\uff0c\u8ba9\u96c6\u7fa4\u5185\u6240\u6709\u670d\u52a1\u95f4\u7684\u6d41\u91cf\u90fd\u901a\u8fc7\u8be5\u8def\u7531\u5668\u3002</p> <p></p> <p>\u8fd9\u4e2a\u67b6\u6784\u65e0\u9700\u5bf9\u539f\u6709\u7684\u5355\u4f53\u5e94\u7528\u548c\u65b0\u7684\u5fae\u670d\u52a1\u5e94\u7528\u505a\u4ec0\u4e48\u6539\u9020\uff0c\u53ef\u4ee5\u5f88\u8f7b\u6613\u7684\u8fc1\u79fb\u8fdb\u6765\uff0c\u4f46\u662f\u5f53\u670d\u52a1\u591a\u4e86\u7ba1\u7406\u8d77\u6765\u5c31\u5f88\u9ebb\u70e6\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3313-proxy-per-node","title":"3.3.1.3 Proxy per Node","text":"<p>\u8fd9\u79cd\u67b6\u6784\u662f\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u90e8\u7f72\u4e00\u4e2a\u4ee3\u7406\uff0c\u5982\u679c\u4f7f\u7528 Kubernetes \u6765\u90e8\u7f72\u7684\u8bdd\u5c31\u662f\u4f7f\u7528 <code>DaemonSet</code> \u5bf9\u8c61\uff0cLinkerd \u7b2c\u4e00\u4ee3\u5c31\u662f\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u90e8\u7f72\u7684\uff0c\u4e00\u4ee3\u7684 Linkerd \u4f7f\u7528 Scala \u5f00\u53d1\uff0c\u57fa\u4e8e JVM \u6bd4\u8f83\u6d88\u8017\u8d44\u6e90\uff0c\u4e8c\u4ee3\u7684 Linkerd \u4f7f\u7528 Go \u5f00\u53d1\u3002</p> <p></p> <p>\u8fd9\u79cd\u67b6\u6784\u6709\u4e2a\u597d\u5904\u662f\u6bcf\u4e2a\u8282\u70b9\u53ea\u9700\u8981\u90e8\u7f72\u4e00\u4e2a\u4ee3\u7406\u5373\u53ef\uff0c\u6bd4\u8d77\u5728\u6bcf\u4e2a\u5e94\u7528\u4e2d\u90fd\u6ce8\u5165\u4e00\u4e2a sidecar \u7684\u65b9\u5f0f\u66f4\u8282\u7701\u8d44\u6e90\uff0c\u800c\u4e14\u66f4\u9002\u5408\u57fa\u4e8e\u7269\u7406\u673a/\u865a\u62df\u673a\u7684\u5927\u578b\u5355\u4f53\u5e94\u7528\uff0c\u4f46\u662f\u4e5f\u6709\u4e00\u4e9b\u526f\u4f5c\u7528\uff0c\u6bd4\u5982\u7c92\u5ea6\u8fd8\u662f\u4e0d\u591f\u7ec6\uff0c\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u51fa\u95ee\u9898\uff0c\u8be5\u8282\u70b9\u4e0a\u7684\u6240\u6709\u670d\u52a1\u5c31\u90fd\u4f1a\u65e0\u6cd5\u8bbf\u95ee\uff0c\u5bf9\u4e8e\u670d\u52a1\u6765\u8bf4\u4e0d\u662f\u5b8c\u5168\u900f\u660e\u7684\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3314-sidecar-fabric","title":"3.3.1.4 Sidecar \u4ee3\u7406/Fabric \u6a21\u578b","text":"<p>\u8fd9\u4e2a\u4e00\u822c\u4e0d\u4f1a\u6210\u4e3a\u5178\u578b\u90e8\u7f72\u7c7b\u578b\uff0c\u5f53\u4f01\u4e1a\u7684\u670d\u52a1\u7f51\u683c\u67b6\u6784\u6f14\u8fdb\u5230\u8fd9\u4e00\u6b65\u65f6\u901a\u5e38\u53ea\u4f1a\u6301\u7eed\u5f88\u77ed\u65f6\u95f4\uff0c\u7136\u540e\u5c31\u4f1a\u589e\u52a0\u63a7\u5236\u5e73\u9762\u3002\u8ddf\u524d\u51e0\u4e2a\u9636\u6bb5\u6700\u5927\u7684\u4e0d\u540c\u5c31\u662f\uff0c\u5e94\u7528\u7a0b\u5e8f\u548c\u4ee3\u7406\u88ab\u653e\u5728\u4e86\u540c\u4e00\u4e2a\u90e8\u7f72\u5355\u5143\u91cc\uff0c\u53ef\u4ee5\u5bf9\u5e94\u7528\u7a0b\u5e8f\u7684\u6d41\u91cf\u505a\u66f4\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u3002</p> <p></p> <p>\u8fd9\u5df2\u7ecf\u662f\u6700\u63a5\u8fd1 Service Mesh \u67b6\u6784\u7684\u4e00\u79cd\u5f62\u6001\u4e86\uff0c\u552f\u4e00\u7f3a\u7684\u5c31\u662f\u63a7\u5236\u5e73\u9762\u4e86\u3002\u6240\u6709\u7684 sidecar \u90fd\u652f\u6301\u70ed\u52a0\u8f7d\uff0c\u914d\u7f6e\u7684\u53d8\u66f4\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u5728\u6d41\u91cf\u63a7\u5236\u4e2d\u53cd\u6620\u51fa\u6765\uff0c\u4f46\u662f\u5982\u4f55\u64cd\u4f5c\u8fd9\u4e48\u591a sidecar \u5c31\u9700\u8981\u4e00\u4e2a\u7edf\u4e00\u7684\u63a7\u5236\u5e73\u9762\u4e86\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3315-sidecar","title":"3.3.1.5 Sidecar \u4ee3\u7406/\u63a7\u5236\u5e73\u9762","text":"<p>\u4e0b\u9762\u7684\u793a\u610f\u56fe\u662f\u76ee\u524d\u5927\u591a\u6570 Service Mesh \u7684\u67b6\u6784\u56fe\uff0c\u4e5f\u53ef\u4ee5\u8bf4\u662f\u6574\u4e2a Service Mesh \u67b6\u6784\u6f14\u8fdb\u7684\u6700\u7ec8\u5f62\u6001\u3002</p> <p></p> <p>\u8fd9\u79cd\u67b6\u6784\u5c06\u4ee3\u7406\u4f5c\u4e3a\u6574\u4e2a\u670d\u52a1\u7f51\u683c\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u4f7f\u7528 Kubernetes \u90e8\u7f72\u7684\u8bdd\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5 sidecar \u7684\u5f62\u5f0f\u6ce8\u5165\uff0c\u51cf\u8f7b\u4e86\u90e8\u7f72\u7684\u8d1f\u62c5\uff0c\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u670d\u52a1\u505a\u7ec6\u7c92\u5ea6\u6743\u9650\u4e0e\u6d41\u91cf\u63a7\u5236\u3002\u4f46\u6709\u4e00\u70b9\u4e0d\u597d\u5c31\u662f\u4e3a\u6bcf\u4e2a\u670d\u52a1\u90fd\u6ce8\u5165\u4e00\u4e2a\u4ee3\u7406\u4f1a\u5360\u7528\u5f88\u591a\u8d44\u6e90\uff0c\u56e0\u6b64\u8981\u60f3\u65b9\u8bbe\u6cd5\u964d\u4f4e\u6bcf\u4e2a\u4ee3\u7406\u7684\u8d44\u6e90\u6d88\u8017\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3316","title":"3.3.1.6 \u591a\u96c6\u7fa4\u90e8\u7f72\u548c\u6269\u5c55","text":"<p>\u4ee5\u4e0a\u90fd\u662f\u5355\u4e2a\u670d\u52a1\u7f51\u683c\u96c6\u7fa4\u7684\u67b6\u6784\uff0c\u6240\u6709\u7684\u670d\u52a1\u90fd\u4f4d\u4e8e\u540c\u4e00\u4e2a\u96c6\u7fa4\u4e2d\uff0c\u670d\u52a1\u7f51\u683c\u7ba1\u7406\u8fdb\u51fa\u96c6\u7fa4\u548c\u96c6\u7fa4\u5185\u90e8\u7684\u6d41\u91cf\uff0c\u5f53\u6211\u4eec\u9700\u8981\u7ba1\u7406\u591a\u4e2a\u96c6\u7fa4\u6216\u8005\u662f\u5f15\u5165\u5916\u90e8\u7684\u670d\u52a1\u65f6\u5c31\u9700\u8981\u7f51\u683c\u6269\u5c55\u548c\u591a\u96c6\u7fa4\u914d\u7f6e\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#332-istio","title":"3.3.2 Istio \u67b6\u6784\u89e3\u6790","text":"<p>\u4e0b\u9762\u662f\u4ee5\u6f2b\u753b\u7684\u5f62\u5f0f\u8bf4\u660e Istio \u662f\u4ec0\u4e48\u3002</p> <p></p> <p></p> <ul> <li>Istio \u662f\u72ec\u7acb\u4e8e\u5e73\u53f0\u7684\uff0c\u53ef\u4ee5\u5728 Kubernetes \u3001 Consul \u3001\u865a\u62df\u673a\u4e0a\u90e8\u7f72\u7684\u670d\u52a1</li> <li>Istio \u7684\u7ec4\u6210</li> <li>Envoy\uff1a\u667a\u80fd\u4ee3\u7406\u3001\u6d41\u91cf\u63a7\u5236</li> <li>Pilot\uff1a\u670d\u52a1\u53d1\u73b0\u3001\u6d41\u91cf\u7ba1\u7406</li> <li>Mixer\uff1a\u8bbf\u95ee\u63a7\u5236\u3001\u9065\u6d4b</li> <li>Citadel\uff1a\u7ec8\u7aef\u7528\u6237\u8ba4\u8bc1\u3001\u6d41\u91cf\u52a0\u5bc6</li> <li>Galley\uff081.1\u65b0\u589e\uff09\uff1a\u9a8c\u8bc1\u3001\u5904\u7406\u548c\u5206\u914d\u914d\u7f6e</li> <li>Service mesh \u5173\u6ce8\u7684\u65b9\u9762</li> <li>\u53ef\u89c2\u5bdf\u6027</li> <li>\u5b89\u5168\u6027</li> <li>\u53ef\u8fd0\u7ef4\u6027</li> <li>\u53ef\u62d3\u5c55\u6027</li> <li>Istio \u7684\u7b56\u7565\u6267\u884c\u7ec4\u4ef6\u53ef\u4ee5\u6269\u5c55\u548c\u5b9a\u5236\uff0c\u540c\u65f6\u4e5f\u662f\u53ef\u62d4\u63d2\u7684</li> <li>Istio \u5728\u6570\u636e\u5e73\u9762\u4e3a\u6bcf\u4e2a\u670d\u52a1\u4e2d\u6ce8\u5165\u4e00\u4e2a Envoy \u4ee3\u7406\u4ee5 Sidecar \u5f62\u5f0f\u8fd0\u884c\u6765\u52ab\u6301\u6240\u6709\u8fdb\u51fa\u670d\u52a1\u7684\u6d41\u91cf\uff0c\u540c\u65f6\u5bf9\u6d41\u91cf\u52a0\u4ee5\u63a7\u5236\uff0c\u901a\u4fd7\u7684\u8bb2\u5c31\u662f\u5e94\u7528\u7a0b\u5e8f\u4f60\u53ea\u7ba1\u5904\u7406\u4f60\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u5176\u4ed6\u7684\u4e8b\u60c5 Sidecar \u4f1a\u6c47\u62a5\u7ed9 Istio \u63a7\u5236\u5e73\u9762\u5904\u7406</li> <li>\u5e94\u7528\u7a0b\u5e8f\u53ea\u9700\u5173\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\uff08\u8fd9\u624d\u80fd\u751f\u94b1\uff09\u5373\u53ef\uff0c\u975e\u529f\u80fd\u6027\u9700\u6c42\u4ea4\u7ed9 Istio</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3321","title":"3.3.2.1 \u8bbe\u8ba1\u76ee\u6807","text":"<p>Istio \u7684\u67b6\u6784\u8bbe\u8ba1\u4e2d\u6709\u51e0\u4e2a\u5173\u952e\u76ee\u6807\uff0c\u8fd9\u4e9b\u76ee\u6807\u5bf9\u4e8e\u4f7f\u7cfb\u7edf\u80fd\u591f\u5e94\u5bf9\u5927\u89c4\u6a21\u6d41\u91cf\u548c\u9ad8\u6027\u80fd\u5730\u670d\u52a1\u5904\u7406\u81f3\u5173\u91cd\u8981\u3002</p> <ul> <li>\u6700\u5927\u5316\u900f\u660e\u5ea6\uff1a\u82e5\u60f3 Istio \u88ab\u91c7\u7eb3\uff0c\u5e94\u8be5\u8ba9\u8fd0\u7ef4\u548c\u5f00\u53d1\u4eba\u5458\u53ea\u9700\u4ed8\u51fa\u5f88\u5c11\u7684\u4ee3\u4ef7\u5c31\u53ef\u4ee5\u4ece\u4e2d\u53d7\u76ca\u3002\u4e3a\u6b64\uff0cIstio \u5c06\u81ea\u8eab\u81ea\u52a8\u6ce8\u5165\u5230\u670d\u52a1\u95f4\u6240\u6709\u7684\u7f51\u7edc\u8def\u5f84\u4e2d\u3002Istio \u4f7f\u7528 sidecar \u4ee3\u7406\u6765\u6355\u83b7\u6d41\u91cf\uff0c\u5e76\u4e14\u5728\u5c3d\u53ef\u80fd\u7684\u5730\u65b9\u81ea\u52a8\u7f16\u7a0b\u7f51\u7edc\u5c42\uff0c\u4ee5\u8def\u7531\u6d41\u91cf\u901a\u8fc7\u8fd9\u4e9b\u4ee3\u7406\uff0c\u800c\u65e0\u9700\u5bf9\u5df2\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u8fdb\u884c\u4efb\u4f55\u6539\u52a8\u3002\u5728 Kubernetes\u4e2d\uff0c\u4ee3\u7406\u88ab\u6ce8\u5165\u5230 pod \u4e2d\uff0c\u901a\u8fc7\u7f16\u5199 iptables \u89c4\u5219\u6765\u6355\u83b7\u6d41\u91cf\u3002\u6ce8\u5165 sidecar \u4ee3\u7406\u5230 pod \u4e2d\u5e76\u4e14\u4fee\u6539\u8def\u7531\u89c4\u5219\u540e\uff0cIstio \u5c31\u80fd\u591f\u8c03\u89e3\u6240\u6709\u6d41\u91cf\u3002\u8fd9\u4e2a\u539f\u5219\u4e5f\u9002\u7528\u4e8e\u6027\u80fd\u3002\u5f53\u5c06 Istio \u5e94\u7528\u4e8e\u90e8\u7f72\u65f6\uff0c\u8fd0\u7ef4\u4eba\u5458\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e3a\u63d0\u4f9b\u8fd9\u4e9b\u529f\u80fd\u800c\u589e\u52a0\u7684\u8d44\u6e90\u5f00\u9500\u662f\u5f88\u5c0f\u7684\u3002\u6240\u6709\u7ec4\u4ef6\u548c API \u5728\u8bbe\u8ba1\u65f6\u90fd\u5fc5\u987b\u8003\u8651\u6027\u80fd\u548c\u89c4\u6a21\u3002</li> <li>\u53ef\u6269\u5c55\u6027\uff1a\u968f\u7740\u8fd0\u7ef4\u4eba\u5458\u548c\u5f00\u53d1\u4eba\u5458\u8d8a\u6765\u8d8a\u4f9d\u8d56 Istio \u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u7cfb\u7edf\u5fc5\u7136\u548c\u4ed6\u4eec\u7684\u9700\u6c42\u4e00\u8d77\u6210\u957f\u3002\u867d\u7136\u6211\u4eec\u671f\u671b\u7ee7\u7eed\u81ea\u5df1\u6dfb\u52a0\u65b0\u529f\u80fd\uff0c\u4f46\u662f\u6211\u4eec\u9884\u8ba1\u6700\u5927\u7684\u9700\u6c42\u662f\u6269\u5c55\u7b56\u7565\u7cfb\u7edf\uff0c\u96c6\u6210\u5176\u4ed6\u7b56\u7565\u548c\u63a7\u5236\u6765\u6e90\uff0c\u5e76\u5c06\u7f51\u683c\u884c\u4e3a\u4fe1\u53f7\u4f20\u64ad\u5230\u5176\u4ed6\u7cfb\u7edf\u8fdb\u884c\u5206\u6790\u3002\u7b56\u7565\u8fd0\u884c\u65f6\u652f\u6301\u6807\u51c6\u6269\u5c55\u673a\u5236\u4ee5\u4fbf\u63d2\u5165\u5230\u5176\u4ed6\u670d\u52a1\u4e2d\u3002\u6b64\u5916\uff0c\u5b83\u5141\u8bb8\u6269\u5c55\u8bcd\u6c47\u8868\uff0c\u4ee5\u5141\u8bb8\u57fa\u4e8e\u7f51\u683c\u751f\u6210\u7684\u65b0\u4fe1\u53f7\u6765\u6267\u884c\u7b56\u7565\u3002</li> <li>\u53ef\u79fb\u690d\u6027\uff1a\u4f7f\u7528 Istio \u7684\u751f\u6001\u7cfb\u7edf\u5c06\u5728\u5f88\u591a\u7ef4\u5ea6\u4e0a\u6709\u5dee\u5f02\u3002Istio \u5fc5\u987b\u80fd\u591f\u4ee5\u6700\u5c11\u7684\u4ee3\u4ef7\u8fd0\u884c\u5728\u4efb\u4f55\u4e91\u6216\u9884\u7f6e\u73af\u5883\u4e2d\u3002\u5c06\u57fa\u4e8e Istio \u7684\u670d\u52a1\u79fb\u690d\u5230\u65b0\u73af\u5883\u5e94\u8be5\u662f\u8f7b\u800c\u6613\u4e3e\u7684\uff0c\u800c\u4f7f\u7528 Istio \u5c06\u4e00\u4e2a\u670d\u52a1\u540c\u65f6\u90e8\u7f72\u5230\u591a\u4e2a\u73af\u5883\u4e2d\u4e5f\u662f\u53ef\u884c\u7684\uff08\u4f8b\u5982\uff0c\u5728\u591a\u4e2a\u4e91\u4e0a\u8fdb\u884c\u5197\u4f59\u90e8\u7f72\uff09\u3002</li> <li>\u7b56\u7565\u4e00\u81f4\u6027\uff1a\u5728\u670d\u52a1\u95f4\u7684 API \u8c03\u7528\u4e2d\uff0c\u7b56\u7565\u7684\u5e94\u7528\u4f7f\u5f97\u53ef\u4ee5\u5bf9\u7f51\u683c\u95f4\u884c\u4e3a\u8fdb\u884c\u5168\u9762\u7684\u63a7\u5236\uff0c\u4f46\u5bf9\u4e8e\u65e0\u9700\u5728 API \u7ea7\u522b\u8868\u8fbe\u7684\u8d44\u6e90\u6765\u8bf4\uff0c\u5bf9\u8d44\u6e90\u5e94\u7528\u7b56\u7565\u4e5f\u540c\u6837\u91cd\u8981\u3002\u4f8b\u5982\uff0c\u5c06\u914d\u989d\u5e94\u7528\u5230 ML \u8bad\u7ec3\u4efb\u52a1\u6d88\u8017\u7684 CPU \u6570\u91cf\u4e0a\uff0c\u6bd4\u5c06\u914d\u989d\u5e94\u7528\u5230\u542f\u52a8\u8fd9\u4e2a\u5de5\u4f5c\u7684\u8c03\u7528\u4e0a\u66f4\u4e3a\u6709\u7528\u3002\u56e0\u6b64\uff0c\u7b56\u7565\u7cfb\u7edf\u4f5c\u4e3a\u72ec\u7279\u7684\u670d\u52a1\u6765\u7ef4\u62a4\uff0c\u5177\u6709\u81ea\u5df1\u7684 API\uff0c\u800c\u4e0d\u662f\u5c06\u5176\u653e\u5230\u4ee3\u7406/sidecar \u4e2d\uff0c\u8fd9\u5bb9\u8bb8\u670d\u52a1\u6839\u636e\u9700\u8981\u76f4\u63a5\u4e0e\u5176\u96c6\u6210\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#333-service-mesh","title":"3.3.3 \u4ece\u8fb9\u8f66\u6a21\u5f0f\u5230 Service Mesh","text":"<p>\u6240\u8c13\u8fb9\u8f66\u6a21\u5f0f\uff08 Sidecar pattern \uff09\uff0c\u4e5f\u8bd1\u4f5c\u630e\u6597\u6a21\u5f0f\uff0c\u662f\u5206\u5e03\u5f0f\u67b6\u6784\u4e2d\u4e91\u8bbe\u8ba1\u6a21\u5f0f\u7684\u4e00\u79cd\u3002\u56e0\u4e3a\u5176\u975e\u5e38\u7c7b\u4f3c\u4e8e\u751f\u6d3b\u4e2d\u7684\u8fb9\u4e09\u8f6e\u6469\u6258\u8f66\u800c\u5f97\u540d\u3002\u8be5\u8bbe\u8ba1\u6a21\u5f0f\u901a\u8fc7\u7ed9\u5e94\u7528\u7a0b\u5e8f\u52a0\u4e0a\u4e00\u4e2a\u201c\u8fb9\u8f66\u201d\u7684\u65b9\u5f0f\u6765\u62d3\u5c55\u5e94\u7528\u7a0b\u5e8f\u73b0\u6709\u7684\u529f\u80fd\u3002\u8fd9\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u51fa\u73b0\u7684\u5f88\u65e9\uff0c\u5b9e\u73b0\u7684\u65b9\u5f0f\u4e5f\u591a\u79cd\u591a\u6837\u3002\u73b0\u5728\u8fd9\u4e2a\u6a21\u5f0f\u66f4\u662f\u968f\u7740\u5fae\u670d\u52a1\u7684\u706b\u70ed\u4e0e Service Mesh \u7684\u9010\u6e10\u6210\u719f\u800c\u8fdb\u5165\u4eba\u4eec\u7684\u89c6\u91ce\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3331","title":"3.3.3.1 \u4ec0\u4e48\u662f\u8fb9\u8f66\u6a21\u5f0f","text":"<p>\u5728 Azure Architecture Center \u7684\u4e91\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\u662f\u8fd9\u4e48\u4ecb\u7ecd\u8fb9\u8f66\u6a21\u5f0f\u7684\uff1a</p> <p>Deploy components of an application into a separate process or container to provide isolation and encapsulation.</p> <p>--- Sidecar pattern</p> <p>\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\uff1a \u8fd9\u91cc\u7684 Sidecar \u662f\u5206\u5e03\u5f0f\u67b6\u6784\u4e2d\u4e91\u8bbe\u8ba1\u6a21\u5f0f\u7684\u4e00\u79cd\uff0c\u4e0e\u6211\u4eec\u76ee\u524d\u5728\u4f7f\u7528\u7684 Istio \u6216 Linkerd \u4e2d\u7684 Sidecar \u662f\u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u7684\u533a\u522b\uff0c\u540e\u6587\u4e2d\u63d0\u5230\u7684\u8fb9\u8f66\u6a21\u5f0f\u5747\u662f\u6307\u8fd9\u79cd\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u8bf7\u52ff\u4e0e Istio \u6216 \u5176\u4ed6 Service Mesh \u8f6f\u4ef6 \u4e2d\u7684 Sidecar \u6df7\u6dc6\u3002</p> <p>**\u8fb9\u8f66\u6a21\u5f0f**\u662f\u4e00\u79cd\u5206\u5e03\u5f0f\u67b6\u6784\u7684\u8bbe\u8ba1\u6a21\u5f0f\u3002\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u8fb9\u8f66\u5c31\u662f\u52a0\u88c5\u5728\u6469\u6258\u8f66\u65c1\u6765\u8fbe\u5230\u62d3\u5c55\u529f\u80fd\u7684\u76ee\u7684\uff0c\u6bd4\u5982\u884c\u9a76\u66f4\u52a0\u7a33\u5b9a\uff0c\u53ef\u4ee5\u62c9\u66f4\u591a\u7684\u4eba\u548c\u8d27\u7269\uff0c\u5750\u5728\u8fb9\u8f66\u4e0a\u7684\u4eba\u53ef\u4ee5\u7ed9\u9a7e\u9a76\u5458\u6307\u8def\u7b49\u3002\u8fb9\u8f66\u6a21\u5f0f\u901a\u8fc7\u7ed9\u5e94\u7528\u670d\u52a1\u52a0\u88c5\u4e00\u4e2a\u201c\u8fb9\u8f66\u201d\u6765\u8fbe\u5230**\u63a7\u5236**\u548c**\u903b\u8f91**\u7684\u5206\u79bb\u7684\u76ee\u7684\u3002</p> <p>\u6bd4\u5982\u65e5\u5fd7\u8bb0\u5f55\u3001\u76d1\u63a7\u3001\u6d41\u91cf\u63a7\u5236\u3001\u670d\u52a1\u6ce8\u518c\u3001\u670d\u52a1\u53d1\u73b0\u3001\u670d\u52a1\u9650\u6d41\u3001\u670d\u52a1\u7194\u65ad\u7b49\u5728\u4e1a\u52a1\u670d\u52a1\u4e2d\u4e0d\u9700\u8981\u5b9e\u73b0\u7684\u63a7\u5236\u9762\u529f\u80fd\uff0c\u53ef\u4ee5\u4ea4\u7ed9\u201c\u8fb9\u8f66\u201d\uff0c\u4e1a\u52a1\u670d\u52a1\u53ea\u9700\u8981\u4e13\u6ce8\u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\u5373\u53ef\u3002\u5982\u4e0a\u56fe\u90a3\u6837\uff0c\u5e94\u7528\u670d\u52a1\u4f60\u53ea\u7ba1\u5f00\u597d\u4f60\u7684\u8f66\uff0c\u6253\u4ed7\u7684\u4e8b\u60c5\u5c31\u4ea4\u7ed9\u8fb9\u8f66\u4e0a\u7684\u4ee3\u7406\u5c31\u597d\u3002\u8fd9\u4e0e\u5206\u5e03\u5f0f\u548c\u5fae\u670d\u52a1\u67b6\u6784\u5b8c\u7f8e\u5951\u5408\uff0c\u771f\u6b63\u7684\u5b9e\u73b0\u4e86\u63a7\u5236\u548c\u903b\u8f91\u7684\u5206\u79bb\u4e0e\u89e3\u8026\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3332","title":"3.3.3.2 \u8fb9\u8f66\u6a21\u5f0f\u8bbe\u8ba1","text":"<p>\u5728\u8bbe\u8ba1\u4e0a\u8fb9\u8f66\u6a21\u5f0f\u4e0e\u7f51\u5173\u6a21\u5f0f\u6709\u7c7b\u4f3c\u4e4b\u5904\uff0c\u4f46\u662f\u5176\u7c92\u5ea6\u66f4\u7ec6\u3002\u5176\u4e3a\u6bcf\u4e2a\u670d\u52a1\u90fd\u914d\u5907\u4e00\u4e2a\u201c\u8fb9\u8f66\u201d\uff0c\u8fd9\u4e2a\u201c\u8fb9\u8f66\u201c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a agent \uff0c\u8fd9\u4e2a\u670d\u52a1\u6240\u6709\u7684\u901a\u4fe1\u90fd\u662f\u901a\u8fc7\u8fd9\u4e2a agent \u6765\u5b8c\u6210\u7684\uff0c\u8fd9\u4e2a agent \u540c\u670d\u52a1\u4e00\u8d77\u521b\u5efa\uff0c\u4e00\u8d77\u9500\u6bc1\u3002\u50cf\u670d\u52a1\u6ce8\u518c\u3001\u670d\u52a1\u53d1\u73b0\u3001\u76d1\u63a7\u3001\u6d41\u91cf\u63a7\u5236\u3001\u65e5\u5fd7\u8bb0\u5f55\u3001\u670d\u52a1\u9650\u6d41\u548c\u670d\u52a1\u7194\u65ad\u7b49\u529f\u80fd\u5b8c\u5168\u53ef\u4ee5\u505a\u6210\u6807\u51c6\u5316\u7684\u7ec4\u4ef6\u548c\u6a21\u5757\uff0c\u4e0d\u9700\u8981\u5728\u5355\u72ec\u5b9e\u73b0\u5176\u529f\u80fd\u6765\u6d88\u8017\u4e1a\u52a1\u5f00\u53d1\u7684\u7cbe\u529b\u548c\u65f6\u95f4\u6765\u5f00\u53d1\u548c\u8c03\u8bd5\u8fd9\u4e9b\u529f\u80fd\uff0c\u8fd9\u6837\u53ef\u4ee5\u5f00\u53d1\u51fa\u771f\u6b63\u9ad8\u5185\u805a\u4f4e\u8026\u5408\u7684\u8f6f\u4ef6\u3002</p> <p>\u8fd9\u91cc\u6709\u4e24\u79cd\u65b9\u6cd5\u6765\u5b9e\u73b0\u8fb9\u8f66\u6a21\u5f0f\uff1a</p> <p>\u901a\u8fc7 SDK \u3001 Lib \u7b49\u8f6f\u4ef6\u5305\u7684\u5f62\u5f0f\uff0c\u5728\u5f00\u53d1\u65f6\u5f15\u5165\u8be5\u8f6f\u4ef6\u5305\u4f9d\u8d56\uff0c\u4f7f\u5176\u4e0e\u4e1a\u52a1\u670d\u52a1\u96c6\u6210\u8d77\u6765\u3002</p> <p>\u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u4e0e\u5e94\u7528\u5bc6\u5207\u96c6\u6210\uff0c\u63d0\u9ad8\u8d44\u6e90\u5229\u7528\u7387\u5e76\u4e14\u63d0\u9ad8\u5e94\u7528\u6027\u80fd\u3002\u4f46\u662f\u8fd9\u79cd\u65b9\u6cd5\u662f\u5bf9\u4ee3\u7801\u6709\u4fb5\u5165\u7684\uff0c\u53d7\u5230\u7f16\u7a0b\u8bed\u8a00\u548c\u8f6f\u4ef6\u5f00\u53d1\u4eba\u5458\u6c34\u5e73\u7684\u9650\u5236\uff0c\u4f46\u5f53\u8be5\u4f9d\u8d56\u6709 bug \u6216\u8005\u9700\u8981\u5347\u7ea7\u65f6\uff0c\u4e1a\u52a1\u4ee3\u7801\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u548c\u53d1\u5e03\u3002\u540c\u65f6\uff0c\u5982\u679c\u8be5\u4f9d\u8d56\u5ba3\u5e03\u505c\u6b62\u7ef4\u62a4\u6216\u8005\u95ed\u6e90\uff0c\u90a3\u4e48\u4f1a\u7ed9\u8be5\u670d\u52a1\u5e26\u6765\u4e0d\u5c0f\u7684\u5f71\u54cd\u3002</p> <p>\u4ee5 Sidecar \u7684\u5f62\u5f0f\uff0c\u5728\u8fd0\u7ef4\u7684\u65f6\u5019\u4e0e\u5e94\u7528\u670d\u52a1\u96c6\u6210\u5728\u4e00\u8d77\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u5bf9\u5e94\u7528\u670d\u52a1\u6ca1\u6709\u4fb5\u5165\u6027\uff0c\u4e0d\u53d7\u7f16\u7a0b\u8bed\u8a00\u548c\u5f00\u53d1\u4eba\u5458\u6c34\u5e73\u7684\u9650\u5236\uff0c\u505a\u5230\u4e86\u63a7\u5236\u4e0e\u903b\u8f91\u5206\u5f00\u90e8\u7f72\u3002\u4f46\u662f\u4f1a\u589e\u52a0\u5e94\u7528\u5ef6\u8fdf\uff0c\u5e76\u4e14\u7ba1\u7406\u548c\u90e8\u7f72\u7684\u590d\u6742\u5ea6\u4f1a\u589e\u52a0\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3333","title":"3.3.3.3 \u8fb9\u8f66\u6a21\u5f0f\u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898","text":"<p>\u8fb9\u8f66\u6a21\u5f0f\u5728\u6982\u5ff5\u4e0a\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u4f46\u662f\u5728\u5b9e\u8df5\u4e2d\u8fd8\u662f\u8981\u4e86\u89e3\u8fb9\u8f66\u6a21\u5f0f\u5230\u5e95\u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898\uff0c\u6211\u4eec\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u8fb9\u8f66\u6a21\u5f0f\uff1f</p> <p>\u63a7\u5236\u4e0e\u903b\u8f91\u5206\u79bb\u7684\u95ee\u9898</p> <p>\u8fb9\u8f66\u6a21\u5f0f\u662f\u57fa\u4e8e\u5c06\u63a7\u5236\u4e0e\u903b\u8f91\u5206\u79bb\u548c\u89e3\u8026\u7684\u601d\u60f3\uff0c\u901a\u4fd7\u7684\u8bb2\u5c31\u662f\u8ba9\u4e13\u4e1a\u7684\u4eba\u505a\u4e13\u4e1a\u7684\u4e8b\uff0c\u4e1a\u52a1\u4ee3\u7801\u53ea\u9700\u8981\u5173\u5fc3\u5176\u590d\u6742\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u5176\u4ed6\u7684\u4e8b\u60c5\u201d\u8fb9\u8f66\u201c\u4f1a\u5e2e\u5176\u5904\u7406\uff0c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u770b\uff0c\u53ef\u80fd\u53eb\u8ddf\u73ed\u6216\u8005\u79d8\u4e66\u6a21\u5f0f\u4e5f\u4e0d\u9519 :)</p> <p>\u65e5\u5fd7\u8bb0\u5f55\u3001\u76d1\u63a7\u3001\u6d41\u91cf\u63a7\u5236\u3001\u670d\u52a1\u6ce8\u518c\u3001\u670d\u52a1\u53d1\u73b0\u3001\u670d\u52a1\u9650\u6d41\u3001\u670d\u52a1\u7194\u65ad\u3001\u9274\u6743\u3001\u8bbf\u95ee\u63a7\u5236\u548c\u670d\u52a1\u8c03\u7528\u53ef\u89c6\u5316\u7b49\uff0c\u8fd9\u4e9b\u529f\u80fd\u4ece\u672c\u8d28\u4e0a\u548c\u4e1a\u52a1\u670d\u52a1\u7684\u5173\u7cfb\u5e76\u4e0d\u5927\uff0c\u800c\u4f20\u7edf\u7684\u8f6f\u4ef6\u5de5\u7a0b\u5728\u5f00\u53d1\u5c42\u9762\u5b8c\u6210\u8fd9\u4e9b\u529f\u80fd\uff0c\u8fd9\u5bfc\u81f4\u4e86\u5404\u79cd\u5404\u6837\u7ef4\u62a4\u4e0a\u7684\u95ee\u9898\u3002</p> <p>\u5c31\u597d\u50cf\u4e00\u4e2a\u53a8\u5e08\u4e0d\u662f\u5fc5\u987b\u53bb\u5173\u5fc3\u98df\u6750\u7684\u4ea7\u5730\u3001\u996d\u5e97\u7684\u9009\u5740\u3001\u662f\u7ed9\u5927\u5385\u7684\u5ba2\u4eba\u4e0a\u83dc\u8fd8\u662f\u7ed9\u5305\u623f\u7684\u5ba2\u4eba\u4e0a\u83dc...\u4ed6\u53ea\u9700\u8981\u505a\u597d\u83dc\u5c31\u597d\uff0c\u867d\u7136\u4e0a\u9762\u7684\u8fd9\u4e9b\u4e8b\u4ed6\u90fd\u53ef\u4ee5\u505a\u3002\u800c\u4f20\u7edf\u7684\u8f6f\u4ef6\u5de5\u7a0b\u5c31\u50cf\u662f\u4e00\u4e2a\u5c0f\u996d\u5e97\u7684\u53a8\u5e08\uff0c\u4ed6\u5373\u662f\u8001\u677f\u53c8\u662f\u53a8\u5e08\uff0c\u65e2\u9700\u8981\u4e70\u83dc\u53c8\u9700\u8981\u7092\u83dc\uff0c\u6240\u6709\u7684\u4e8b\u60c5\u90fd\u8981\u4ed6\u4e00\u4e2a\u4eba\u505a\uff0c\u5982\u679c\u5ba2\u4eba\u4e00\u591a\uff0c\u5c31\u4f1a\u53d8\u7684\u624b\u5fd9\u811a\u4e71\uff1b\u800c\u63a7\u5236\u4e0e\u903b\u8f91\u5206\u79bb\u7684\u8f6f\u4ef6\uff0c\u5176\u903b\u8f91\u90e8\u5206\u5c31\u50cf\u662f\u9ad8\u6863\u9152\u5e97\u7684\u53a8\u5e08\uff0c\u4ed6\u53ea\u9700\u8981\u5c06\u83dc\u505a\u597d\u5373\u53ef\uff0c\u5176\u4ed6\u7684\u4e8b\u60c5\u7531\u50cf\u201d\u8fb9\u8f66\u201c\u8fd9\u6837\u7684\u6210\u5458\u5e2e\u5176\u5904\u7406\u3002</p> <p>\u89e3\u51b3\u670d\u52a1\u4e4b\u95f4\u8c03\u7528\u8d8a\u6765\u8d8a\u590d\u6742\u7684\u95ee\u9898</p> <p>\u968f\u7740\u5206\u5e03\u5f0f\u67b6\u6784\u8d8a\u6765\u8d8a\u590d\u6742\u548c\u5fae\u670d\u52a1\u8d8a\u62c6\u8d8a\u7ec6\uff0c\u6211\u4eec\u8d8a\u6765\u8d8a\u8feb\u5207\u7684\u5e0c\u671b\u6709\u4e00\u4e2a\u7edf\u4e00\u7684\u63a7\u5236\u9762\u6765\u7ba1\u7406\u6211\u4eec\u7684\u5fae\u670d\u52a1\uff0c\u6765\u5e2e\u52a9\u6211\u4eec\u7ef4\u62a4\u548c\u7ba1\u7406\u6240\u6709\u5fae\u670d\u52a1\uff0c\u8fd9\u65f6\u4f20\u7edf\u5f00\u53d1\u5c42\u9762\u4e0a\u7684\u63a7\u5236\u5c31\u8fdc\u8fdc\u4e0d\u591f\u4e86\u3002\u800c\u8fb9\u8f66\u6a21\u5f0f\u53ef\u4ee5\u5f88\u597d\u7684\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3334-service-mesh","title":"3.3.3.4 \u4ece\u8fb9\u8f66\u6a21\u5f0f\u5230 Service Mesh","text":"<p>\u8fb9\u8f66\u6a21\u5f0f\u6709\u6548\u7684\u5206\u79bb\u4e86\u7cfb\u7edf\u63a7\u5236\u548c\u4e1a\u52a1\u903b\u8f91\uff0c\u53ef\u4ee5\u5c06\u6240\u6709\u7684\u670d\u52a1\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\uff0c\u8ba9\u5f00\u53d1\u4eba\u5458\u66f4\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u5f00\u53d1\uff0c\u663e\u8457\u7684\u63d0\u5347\u5f00\u53d1\u6548\u7387\u3002\u800c\u9075\u5faa\u8fd9\u79cd\u6a21\u5f0f\u8fdb\u884c\u5b9e\u8df5\u4ece\u5f88\u65e9\u4ee5\u524d\u5c31\u5f00\u59cb\u4e86\uff0c\u5f00\u53d1\u4eba\u5458\u4e00\u76f4\u8bd5\u56fe\u5c06\u4e0a\u6587\u4e2d\u6211\u4eec\u63d0\u5230\u7684\u529f\u80fd\uff08\u5982\uff1a\u6d41\u91cf\u63a7\u5236\u3001\u670d\u52a1\u6ce8\u518c\u3001\u670d\u52a1\u53d1\u73b0\u3001\u670d\u52a1\u9650\u6d41\u3001\u670d\u52a1\u7194\u65ad\u7b49\uff09\u63d0\u53d6\u6210\u4e00\u4e2a\u6807\u51c6\u5316\u7684 Sidecar \uff0c\u901a\u8fc7 Sidecar \u4ee3\u7406\u6765\u4e0e\u5176\u4ed6\u7cfb\u7edf\u8fdb\u884c\u4ea4\u4e92\uff0c\u8fd9\u6837\u53ef\u4ee5\u5927\u5927\u7b80\u5316\u4e1a\u52a1\u5f00\u53d1\u548c\u8fd0\u7ef4\u3002\u800c\u968f\u7740\u5206\u5e03\u5f0f\u67b6\u6784\u548c\u5fae\u670d\u52a1\u88ab\u8d8a\u6765\u8d8a\u591a\u7684\u516c\u53f8\u548c\u5f00\u53d1\u8005\u63a5\u53d7\u5e76\u4f7f\u7528\uff0c\u8fd9\u4e00\u9700\u6c42\u65e5\u76ca\u51f8\u663e\u3002</p> <p>\u8fd9\u5c31\u662f Service Mesh \u670d\u52a1\u7f51\u683c\u8bde\u751f\u7684\u5951\u673a\uff0c\u5b83\u662f CNCF\uff08Cloud Native Computing Foundation\uff0c\u4e91\u539f\u751f\u57fa\u91d1\u4f1a\uff09\u76ee\u524d\u4e3b\u63a8\u7684\u65b0\u4e00\u4ee3\u5fae\u670d\u52a1\u67b6\u6784\u3002 William Morgan \u5728 What's a service mesh? And why do I need one? \u3010\u8bd1\u6587\u3011\u4e2d\u89e3\u91ca\u4e86\u4ec0\u4e48\u662f Service Mesh \u3002</p> <p>Service Mesh \u6709\u5982\u4e0b\u51e0\u4e2a\u7279\u70b9\uff1a</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f\u95f4\u901a\u8baf\u7684\u4e2d\u95f4\u5c42</li> <li>\u8f7b\u91cf\u7ea7\u7f51\u7edc\u4ee3\u7406</li> <li>\u5e94\u7528\u7a0b\u5e8f\u65e0\u611f\u77e5</li> <li>\u89e3\u8026\u5e94\u7528\u7a0b\u5e8f\u7684\u91cd\u8bd5/\u8d85\u65f6\u3001\u76d1\u63a7\u3001\u8ffd\u8e2a\u548c\u670d\u52a1\u53d1\u73b0</li> </ul> <p>Service Mesh \u5c06\u5e95\u5c42\u90a3\u4e9b\u96be\u4ee5\u63a7\u5236\u7684\u7f51\u7edc\u901a\u8baf\u7edf\u4e00\u7ba1\u7406\uff0c\u8bf8\u5982\uff1a\u6d41\u91cf\u7ba1\u63a7\uff0c\u4e22\u5305\u91cd\u8bd5\uff0c\u8bbf\u95ee\u63a7\u5236\u7b49\u3002\u800c\u4e0a\u5c42\u7684\u5e94\u7528\u5c42\u534f\u8bae\u53ea\u9700\u5173\u5fc3\u4e1a\u52a1\u903b\u8f91\u5373\u53ef\u3002Service Mesh \u662f\u4e00\u4e2a\u7528\u4e8e\u5904\u7406\u670d\u52a1\u95f4\u901a\u4fe1\u7684\u57fa\u7840\u8bbe\u65bd\u5c42\uff0c\u5b83\u8d1f\u8d23\u4e3a\u6784\u5efa\u590d\u6742\u7684\u4e91\u539f\u751f\u5e94\u7528\u4f20\u9012\u53ef\u9760\u7684\u7f51\u7edc\u8bf7\u6c42\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3335-service-mesh","title":"3.3.3.5 \u4f60\u771f\u7684\u9700\u8981 Service Mesh \u5417\uff1f","text":"<p>\u6b63\u5982 NGINX \u5728\u5176\u535a\u5ba2\u4e0a\u53d1\u8868\u7684\u4e00\u7bc7\u6587\u7ae0\u540d\u53eb Do I Need a Service Mesh? \u3010\u8bd1\u6587\u3011 \u7684\u6587\u7ae0\u4e2d\u63d0\u5230\uff1a</p> <p>As the complexity of the application increases, service mesh becomes a realistic alternative to implementing capabilities service-by-service.</p> <p>\u968f\u7740\u5e94\u7528\u7a0b\u5e8f\u590d\u6742\u6027\u7684\u589e\u52a0\uff0c\u670d\u52a1\u7f51\u683c\u5c06\u6210\u4e3a\u5b9e\u73b0\u670d\u52a1\u5230\u670d\u52a1\u7684\u80fd\u529b\u7684\u73b0\u5b9e\u9009\u62e9\u3002</p> <p></p> <p>\u56fe\u7247\u6765\u81ea\uff1aDo I Need a Service Mesh?</p> <p>\u968f\u7740\u6211\u4eec\u7684\u5fae\u670d\u52a1\u8d8a\u6765\u8d8a\u7ec6\u5206\uff0c\u6211\u4eec\u6240\u8981\u7ba1\u7406\u7684\u670d\u52a1\u6b63\u5728\u6210\u500d\u7684\u589e\u957f\u7740\uff0cKubernetes \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u529f\u80fd\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u7684\u90e8\u7f72\u548c\u8c03\u5ea6\u8fd9\u4e9b\u670d\u52a1\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86\u6211\u4eec\u719f\u6089\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u90a3\u4e9b\u590d\u6742\u7684\u529f\u80fd\uff0c\u4f46\u662f\u5f53\u4e34\u754c\u70b9\u5230\u6765\u65f6\uff0c\u53ef\u80fd\u5c31\u662f\u6211\u4eec\u771f\u6b63\u8981\u53bb\u8003\u8651\u4f7f\u7528 Service Mesh \u7684\u65f6\u5019\u4e86\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#34-sidecar","title":"3.4 Sidecar \u6a21\u5f0f","text":"<p>Sidecar \u6a21\u5f0f\u662f Istio \u670d\u52a1\u7f51\u683c\u91c7\u7528\u7684\u6a21\u5f0f\uff0c\u5728\u670d\u52a1\u7f51\u683c\u51fa\u73b0\u4e4b\u524d\u8be5\u6a21\u5f0f\u5c31\u4e00\u76f4\u5b58\u5728\uff0c\u5c24\u5176\u662f\u5f53\u5fae\u670d\u52a1\u51fa\u73b0\u540e\u5f00\u59cb\u76db\u884c\uff0c\u672c\u6587\u8bb2\u89e3 Sidecar \u6a21\u5f0f\u3002</p> <p>**\u4ec0\u4e48\u662fSidecar\u6a21\u5f0f ** </p> <p>\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684\u529f\u80fd\u5212\u5206\u4e3a\u5355\u72ec\u7684\u8fdb\u7a0b\u53ef\u4ee5\u88ab\u89c6\u4e3a Sidecar \u6a21\u5f0f\u3002Sidecar \u8bbe\u8ba1\u6a21\u5f0f\u5141\u8bb8\u4f60\u4e3a\u5e94\u7528\u7a0b\u5e8f\u6dfb\u52a0\u8bb8\u591a\u529f\u80fd\uff0c\u800c\u65e0\u9700\u989d\u5916\u7b2c\u4e09\u65b9\u7ec4\u4ef6\u7684\u914d\u7f6e\u548c\u4ee3\u7801\u7684\u4fee\u6539\u3002</p> <p>\u5c31\u5982 Sidecar \u8fde\u63a5\u7740\u6469\u6258\u8f66\u4e00\u6837\uff0c\u7c7b\u4f3c\u5730\u5728\u8f6f\u4ef6\u67b6\u6784\u4e2d\uff0c Sidecar \u5e94\u7528\u662f\u8fde\u63a5\u5230\u7236\u5e94\u7528\u5e76\u4e14\u4e3a\u5176\u6269\u5c55\u6216\u8005\u589e\u5f3a\u529f\u80fd\u3002Sidecar \u5e94\u7528\u4e0e\u4e3b\u5e94\u7528\u7a0b\u5e8f\u677e\u6563\u8026\u5408\u3002</p> <p>\u8ba9\u6211\u7528\u4e00\u4e2a\u4f8b\u5b50\u89e3\u91ca\u4e00\u4e0b\u3002\u60f3\u8c61\u4e00\u4e0b\u5047\u5982\u4f60\u67096\u4e2a\u5fae\u670d\u52a1\u76f8\u4e92\u901a\u4fe1\u4ee5\u786e\u5b9a\u4e00\u4e2a\u5305\u88f9\u7684\u6210\u672c\u3002</p> <p>\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u9700\u8981\u5177\u6709\u53ef\u89c2\u5bdf\u6027\u3001\u76d1\u63a7\u3001\u65e5\u5fd7\u8bb0\u5f55\u3001\u914d\u7f6e\u3001\u65ad\u8def\u5668\u7b49\u529f\u80fd\u3002\u6240\u6709\u8fd9\u4e9b\u529f\u80fd\u90fd\u662f\u6839\u636e\u4e00\u4e9b\u884c\u4e1a\u6807\u51c6\u7684\u7b2c\u4e09\u65b9\u5e93\u5728\u6bcf\u4e2a\u5fae\u670d\u52a1\u4e2d\u5b9e\u73b0\u7684\u3002</p> <p>\u4f46\u518d\u60f3\u4e00\u60f3\uff0c\u8fd9\u4e0d\u662f\u591a\u4f59\u5417\uff1f\u5b83\u4e0d\u4f1a\u589e\u52a0\u5e94\u7528\u7a0b\u5e8f\u7684\u6574\u4f53\u590d\u6742\u6027\u5417\uff1f\u5982\u679c\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u7528\u4e0d\u540c\u7684\u8bed\u8a00\u7f16\u5199\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\u2014\u2014\u5982\u4f55\u5408\u5e76\u90a3\u4e9b\u7279\u5b9a\u7528\u4e8e .Net\u3001Java\u3001Python \u7b49\u8bed\u8a00\u7684\u7b2c\u4e09\u65b9\u5e93\u3002</p> <p>\u4f7f\u7528 Sidecar \u6a21\u5f0f\u7684\u4f18\u52bf</p> <ul> <li>\u901a\u8fc7\u62bd\u8c61\u51fa\u4e0e\u529f\u80fd\u76f8\u5173\u7684\u5171\u540c\u57fa\u7840\u8bbe\u65bd\u5230\u4e00\u4e2a\u4e0d\u540c\u5c42\u964d\u4f4e\u4e86\u5fae\u670d\u52a1\u4ee3\u7801\u7684\u590d\u6742\u5ea6\u3002</li> <li>\u56e0\u4e3a\u4f60\u4e0d\u518d\u9700\u8981\u7f16\u5199\u76f8\u540c\u7684\u7b2c\u4e09\u65b9\u7ec4\u4ef6\u914d\u7f6e\u6587\u4ef6\u548c\u4ee3\u7801\uff0c\u6240\u4ee5\u80fd\u591f\u964d\u4f4e\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u4ee3\u7801\u91cd\u590d\u5ea6\u3002</li> <li>\u964d\u4f4e\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u548c\u5e95\u5c42\u5e73\u53f0\u7684\u8026\u5408\u5ea6\u3002</li> </ul> <p>Sidecar \u6a21\u5f0f\u5982\u4f55\u5de5\u4f5c</p> <p>Sidecar \u662f\u5bb9\u5668\u5e94\u7528\u6a21\u5f0f\u7684\u4e00\u79cd\uff0c\u4e5f\u662f\u5728 Service Mesh \u4e2d\u53d1\u626c\u5149\u5927\u7684\u4e00\u79cd\u6a21\u5f0f\uff0c\u8be6\u89c1 Service Mesh \u67b6\u6784\u89e3\u6790\uff0c\u5176\u4e2d\u8be6\u7ec6\u63cf\u8ff0\u4e86**\u8282\u70b9\u4ee3\u7406**\u548c Sidecar \u6a21\u5f0f\u7684 Service Mesh \u67b6\u6784\u3002</p> <p>\u4f7f\u7528 Sidecar \u6a21\u5f0f\u90e8\u7f72\u670d\u52a1\u7f51\u683c\u65f6\uff0c\u65e0\u9700\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u4ee3\u7406\uff08\u56e0\u6b64\u60a8\u4e0d\u9700\u8981\u57fa\u7840\u7ed3\u6784\u7684\u534f\u4f5c\uff09\uff0c\u4f46\u662f\u96c6\u7fa4\u4e2d\u5c06\u8fd0\u884c\u591a\u4e2a\u76f8\u540c\u7684 Sidecar \u526f\u672c\u3002\u4ece\u53e6\u4e00\u4e2a\u89d2\u5ea6\u770b\uff1a\u6211\u53ef\u4ee5\u4e3a\u4e00\u7ec4\u5fae\u670d\u52a1\u90e8\u7f72\u5230\u4e00\u4e2a\u670d\u52a1\u7f51\u683c\u4e2d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u90e8\u7f72\u4e00\u4e2a\u6709\u7279\u5b9a\u5b9e\u73b0\u7684\u670d\u52a1\u7f51\u683c\u3002\u5728 Sidecar \u90e8\u7f72\u65b9\u5f0f\u4e2d\uff0c\u4f60\u4f1a\u4e3a\u6bcf\u4e2a\u5e94\u7528\u7684\u5bb9\u5668\u90e8\u7f72\u4e00\u4e2a\u4f34\u751f\u5bb9\u5668\u3002Sidecar \u63a5\u7ba1\u8fdb\u51fa\u5e94\u7528\u5bb9\u5668\u7684\u6240\u6709\u6d41\u91cf\u3002\u5728 Kubernetes \u7684 Pod \u4e2d\uff0c\u5728\u539f\u6709\u7684\u5e94\u7528\u5bb9\u5668\u65c1\u8fb9\u8fd0\u884c\u4e00\u4e2a Sidecar \u5bb9\u5668\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e24\u4e2a\u5bb9\u5668\u5171\u4eab\u5b58\u50a8\u3001\u7f51\u7edc\u7b49\u8d44\u6e90\uff0c\u53ef\u4ee5\u5e7f\u4e49\u7684\u5c06\u8fd9\u4e2a\u6ce8\u5165\u4e86 Sidecar \u5bb9\u5668\u7684 Pod \u7406\u89e3\u4e3a\u4e00\u53f0\u4e3b\u673a\uff0c\u4e24\u4e2a\u5bb9\u5668\u5171\u4eab\u4e3b\u673a\u8d44\u6e90\u3002</p> <p>\u4f8b\u5982\u4e0b\u56fe SOFAMesh &amp; SOFA MOSN\u2014\u57fa\u4e8e Istio \u6784\u5efa\u7684\u7528\u4e8e\u5e94\u5bf9\u5927\u89c4\u6a21\u6d41\u91cf\u7684 Service Mesh \u89e3\u51b3\u65b9\u6848\u7684\u67b6\u6784\u56fe\u4e2d\u63cf\u8ff0\u7684\uff0cMOSN \u4f5c\u4e3a Sidecar \u7684\u65b9\u5f0f\u548c\u5e94\u7528\u8fd0\u884c\u5728\u540c\u4e00\u4e2a Pod \u4e2d\uff0c\u62e6\u622a\u6240\u6709\u8fdb\u51fa\u5e94\u7528\u5bb9\u5668\u7684\u6d41\u91cf\uff0cSOFAMesh \u517c\u5bb9 Istio\uff0c\u5176\u4e2d\u4f7f\u7528 Go \u8bed\u8a00\u5f00\u53d1\u7684 SOFAMosn \u66ff\u6362\u4e86 Envoy\u3002</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#341-istio-sidecar","title":"3.4.1 Istio \u4e2d\u7684 Sidecar \u6ce8\u5165\u4e0e\u6d41\u91cf\u52ab\u6301\u8be6\u89e3","text":"<p>\u5728\u8bb2\u89e3 Istio \u5982\u4f55\u5c06 Envoy \u4ee3\u7406\u6ce8\u5165\u5230\u5e94\u7528\u7a0b\u5e8f Pod \u4e2d\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u4e86\u89e3\u4ee5\u4e0b\u51e0\u4e2a\u6982\u5ff5\uff1a</p> <ul> <li>Sidecar \u6a21\u5f0f\uff1a\u5bb9\u5668\u5e94\u7528\u6a21\u5f0f\u4e4b\u4e00\uff0cService Mesh \u67b6\u6784\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u3002</li> <li>Init \u5bb9\u5668\uff1aPod \u4e2d\u7684\u4e00\u79cd\u4e13\u7528\u7684\u5bb9\u5668\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u8fd0\u884c\uff0c\u7528\u6765\u5305\u542b\u4e00\u4e9b\u5e94\u7528\u955c\u50cf\u4e2d\u4e0d\u5b58\u5728\u7684\u5b9e\u7528\u5de5\u5177\u6216\u5b89\u88c5\u811a\u672c\u3002</li> <li>iptables\uff1a\u6d41\u91cf\u52ab\u6301\u662f\u901a\u8fc7 iptables \u8f6c\u53d1\u5b9e\u73b0\u7684\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3411-init","title":"3.4.1.1 Init \u5bb9\u5668","text":"<p>Init \u5bb9\u5668\u662f\u4e00\u79cd\u4e13\u7528\u5bb9\u5668\uff0c\u5b83\u5728\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u8fd0\u884c\uff0c\u7528\u6765\u5305\u542b\u4e00\u4e9b\u5e94\u7528\u955c\u50cf\u4e2d\u4e0d\u5b58\u5728\u7684\u5b9e\u7528\u5de5\u5177\u6216\u5b89\u88c5\u811a\u672c\u3002</p> <p>\u4e00\u4e2a Pod \u4e2d\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a Init \u5bb9\u5668\uff0c\u5982\u679c\u6307\u5b9a\u4e86\u591a\u4e2a\uff0c\u90a3\u4e48 Init \u5bb9\u5668\u5c06\u4f1a\u6309\u987a\u5e8f\u4f9d\u6b21\u8fd0\u884c\u3002\u53ea\u6709\u5f53\u524d\u9762\u7684 Init \u5bb9\u5668\u5fc5\u987b\u8fd0\u884c\u6210\u529f\u540e\uff0c\u624d\u53ef\u4ee5\u8fd0\u884c\u4e0b\u4e00\u4e2a Init \u5bb9\u5668\u3002\u5f53\u6240\u6709\u7684 Init \u5bb9\u5668\u8fd0\u884c\u5b8c\u6210\u540e\uff0cKubernetes \u624d\u521d\u59cb\u5316 Pod \u548c\u8fd0\u884c\u5e94\u7528\u5bb9\u5668\u3002</p> <p>Init \u5bb9\u5668\u4f7f\u7528 Linux Namespace\uff0c\u6240\u4ee5\u76f8\u5bf9\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u6765\u8bf4\u5177\u6709\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u89c6\u56fe\u3002\u56e0\u6b64\uff0c\u5b83\u4eec\u80fd\u591f\u5177\u6709\u8bbf\u95ee Secret \u7684\u6743\u9650\uff0c\u800c\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u5219\u4e0d\u80fd\u3002</p> <p>\u5728 Pod \u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0cInit \u5bb9\u5668\u4f1a\u6309\u987a\u5e8f\u5728\u7f51\u7edc\u548c\u6570\u636e\u5377\u521d\u59cb\u5316\u4e4b\u540e\u542f\u52a8\u3002\u6bcf\u4e2a\u5bb9\u5668\u5fc5\u987b\u5728\u4e0b\u4e00\u4e2a\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\u6210\u529f\u9000\u51fa\u3002\u5982\u679c\u7531\u4e8e\u8fd0\u884c\u65f6\u6216\u5931\u8d25\u9000\u51fa\uff0c\u5c06\u5bfc\u81f4\u5bb9\u5668\u542f\u52a8\u5931\u8d25\uff0c\u5b83\u4f1a\u6839\u636e Pod \u7684 <code>restartPolicy</code> \u6307\u5b9a\u7684\u7b56\u7565\u8fdb\u884c\u91cd\u8bd5\u3002\u7136\u800c\uff0c\u5982\u679c Pod \u7684 <code>restartPolicy</code> \u8bbe\u7f6e\u4e3a Always\uff0cInit \u5bb9\u5668\u5931\u8d25\u65f6\u4f1a\u4f7f\u7528 <code>RestartPolicy</code> \u7b56\u7565\u3002</p> <p>\u5728\u6240\u6709\u7684 Init \u5bb9\u5668\u6ca1\u6709\u6210\u529f\u4e4b\u524d\uff0cPod \u5c06\u4e0d\u4f1a\u53d8\u6210 <code>Ready</code> \u72b6\u6001\u3002Init \u5bb9\u5668\u7684\u7aef\u53e3\u5c06\u4e0d\u4f1a\u5728 Service \u4e2d\u8fdb\u884c\u805a\u96c6\u3002 \u6b63\u5728\u521d\u59cb\u5316\u4e2d\u7684 Pod \u5904\u4e8e <code>Pending</code> \u72b6\u6001\uff0c\u4f46\u5e94\u8be5\u4f1a\u5c06 <code>Initializing</code> \u72b6\u6001\u8bbe\u7f6e\u4e3a true\u3002Init \u5bb9\u5668\u8fd0\u884c\u5b8c\u6210\u4ee5\u540e\u5c31\u4f1a\u81ea\u52a8\u7ec8\u6b62\u3002</p> <p>\u5173\u4e8e Init \u5bb9\u5668\u7684\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u8003 Init \u5bb9\u5668 - Kubernetes \u4e2d\u6587\u6307\u5357/\u4e91\u539f\u751f\u5e94\u7528\u67b6\u6784\u5b9e\u8df5\u624b\u518c\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3412-sidecar","title":"3.4.1.2 Sidecar \u6ce8\u5165\u793a\u4f8b\u5206\u6790","text":"<p>\u6211\u4eec\u770b\u4e0b Istio \u5b98\u65b9\u793a\u4f8b <code>bookinfo</code> \u4e2d <code>productpage</code> \u7684 YAML \u914d\u7f6e\uff0c\u5173\u4e8e <code>bookinfo</code> \u5e94\u7528\u7684\u8be6\u7ec6 YAML \u914d\u7f6e\u8bf7\u53c2\u8003 bookinfo.yaml\u3002</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: productpage\n  labels:\n    app: productpage\nspec:\n  ports:\n  - port: 9080\n    name: http\n  selector:\n    app: productpage\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: productpage-v1\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: productpage\n        version: v1\n    spec:\n      containers:\n      - name: productpage\n        image: istio/examples-bookinfo-productpage-v1:1.8.0\n        imagePullPolicy: IfNotPresent\n        ports:\n        - containerPort: 9080\n</code></pre> <p>\u518d\u67e5\u770b\u4e0b <code>productpage</code> \u5bb9\u5668\u7684 Dockerfile\u3002</p> <pre><code>FROM python:2.7-slim\n\nCOPY requirements.txt ./\nRUN pip install --no-cache-dir -r requirements.txt\n\nCOPY productpage.py /opt/microservices/\nCOPY templates /opt/microservices/templates\nCOPY requirements.txt /opt/microservices/\nEXPOSE 9080\nWORKDIR /opt/microservices\nCMD python productpage.py 9080\n</code></pre> <p>\u6211\u4eec\u770b\u5230 <code>Dockerfile</code> \u4e2d\u6ca1\u6709\u914d\u7f6e <code>ENTRYPOINT</code>\uff0c\u6240\u4ee5 <code>CMD</code> \u7684\u914d\u7f6e <code>python productpage.py 9080</code> \u5c06\u4f5c\u4e3a\u9ed8\u8ba4\u7684 <code>ENTRYPOINT</code>\uff0c\u8bb0\u4f4f\u8fd9\u4e00\u70b9\uff0c\u518d\u770b\u4e0b\u6ce8\u5165 sidecar \u4e4b\u540e\u7684\u914d\u7f6e\u3002</p> <pre><code>$ istioctl kube-inject -f yaml/istio-bookinfo/bookinfo.yaml\n</code></pre> <p>\u6211\u4eec\u53ea\u622a\u53d6\u5176\u4e2d\u4e0e <code>productpage</code> \u76f8\u5173\u7684 <code>Service</code> \u548c <code>Deployment</code> \u914d\u7f6e\u90e8\u5206\u3002</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: productpage\n  labels:\n    app: productpage\nspec:\n  ports:\n  - port: 9080\n    name: http\n  selector:\n    app: productpage\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  name: productpage-v1\nspec:\n  replicas: 1\n  strategy: {}\n  template:\n    metadata:\n      annotations:\n        sidecar.istio.io/status: '{\"version\":\"fde14299e2ae804b95be08e0f2d171d466f47983391c00519bbf01392d9ad6bb\",\"initContainers\":[\"istio-init\"],\"containers\":[\"istio-proxy\"],\"volumes\":[\"istio-envoy\",\"istio-certs\"],\"imagePullSecrets\":null}'\n      creationTimestamp: null\n      labels:\n        app: productpage\n        version: v1\n    spec:\n      containers:\n      - image: istio/examples-bookinfo-productpage-v1:1.8.0\n        imagePullPolicy: IfNotPresent\n        name: productpage\n        ports:\n        - containerPort: 9080\n        resources: {}\n      - args:\n        - proxy\n        - sidecar\n        - --configPath\n        - /etc/istio/proxy\n        - --binaryPath\n        - /usr/local/bin/envoy\n        - --serviceCluster\n        - productpage\n        - --drainDuration\n        - 45s\n        - --parentShutdownDuration\n        - 1m0s\n        - --discoveryAddress\n        - istio-pilot.istio-system:15007\n        - --discoveryRefreshDelay\n        - 1s\n        - --zipkinAddress\n        - zipkin.istio-system:9411\n        - --connectTimeout\n        - 10s\n        - --statsdUdpAddress\n        - istio-statsd-prom-bridge.istio-system:9125\n        - --proxyAdminPort\n        - \"15000\"\n        - --controlPlaneAuthPolicy\n        - NONE\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        - name: INSTANCE_IP\n          valueFrom:\n            fieldRef:\n              fieldPath: status.podIP\n        - name: ISTIO_META_POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: ISTIO_META_INTERCEPTION_MODE\n          value: REDIRECT\n        image: jimmysong/istio-release-proxyv2:1.0.0\n        imagePullPolicy: IfNotPresent\n        name: istio-proxy\n        resources:\n          requests:\n            cpu: 10m\n        securityContext:\n          privileged: false\n          readOnlyRootFilesystem: true\n          runAsUser: 1337\n        volumeMounts:\n        - mountPath: /etc/istio/proxy\n          name: istio-envoy\n        - mountPath: /etc/certs/\n          name: istio-certs\n          readOnly: true\n      initContainers:\n      - args:\n        - -p\n        - \"15001\"\n        - -u\n        - \"1337\"\n        - -m\n        - REDIRECT\n        - -i\n        - '*'\n        - -x\n        - \"\"\n        - -b\n        - 9080,\n        - -d\n        - \"\"\n        image: jimmysong/istio-release-proxy_init:1.0.0\n        imagePullPolicy: IfNotPresent\n        name: istio-init\n        resources: {}\n        securityContext:\n          capabilities:\n            add:\n            - NET_ADMIN\n          privileged: true\n      volumes:\n      - emptyDir:\n          medium: Memory\n        name: istio-envoy\n      - name: istio-certs\n        secret:\n          optional: true\n          secretName: istio.default\nstatus: {}\n</code></pre> <p>\u6211\u4eec\u770b\u5230 Service \u7684\u914d\u7f6e\u6ca1\u6709\u53d8\u5316\uff0c\u6240\u6709\u7684\u53d8\u5316\u90fd\u5728 <code>Deployment</code> \u91cc\uff0cIstio \u7ed9\u5e94\u7528 Pod \u6ce8\u5165\u7684\u914d\u7f6e\u4e3b\u8981\u5305\u62ec\uff1a</p> <ul> <li>Init \u5bb9\u5668 <code>istio-init</code>\uff1a\u7528\u4e8e\u7ed9 Sidecar \u5bb9\u5668\u5373 Envoy \u4ee3\u7406\u505a\u521d\u59cb\u5316\uff0c\u8bbe\u7f6e iptables \u7aef\u53e3\u8f6c\u53d1</li> <li>Envoy sidecar \u5bb9\u5668 <code>istio-proxy</code>\uff1a\u8fd0\u884c Envoy \u4ee3\u7406</li> </ul> <p>\u63a5\u4e0b\u6765\u5c06\u5206\u522b\u89e3\u6790\u4e0b\u8fd9\u4e24\u4e2a\u5bb9\u5668\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#34121-init","title":"3.4.1.2.1 Init \u5bb9\u5668\u89e3\u6790","text":"<p>Istio \u5728 Pod \u4e2d\u6ce8\u5165\u7684 Init \u5bb9\u5668\u540d\u4e3a <code>istio-init</code>\uff0c\u6211\u4eec\u5728\u4e0a\u9762 Istio \u6ce8\u5165\u5b8c\u6210\u540e\u7684 YAML \u6587\u4ef6\u4e2d\u770b\u5230\u4e86\u8be5\u5bb9\u5668\u7684\u542f\u52a8\u53c2\u6570\uff1a</p> <pre><code>-p 15001 -u 1337 -m REDIRECT -i '*' -x \"\" -b 9080 -d \"\"\n</code></pre> <p>\u6211\u4eec\u518d\u68c0\u67e5\u4e0b\u8be5\u5bb9\u5668\u7684 Dockerfile \u770b\u770b <code>ENTRYPOINT</code> \u662f\u4ec0\u4e48\u4ee5\u786e\u5b9a\u542f\u52a8\u65f6\u6267\u884c\u7684\u547d\u4ee4\u3002</p> <pre><code>FROM ubuntu:xenial\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    iproute2 \\\n    iptables \\\n &amp;&amp; rm -rf /var/lib/apt/lists/*\n\nADD istio-iptables.sh /usr/local/bin/\nENTRYPOINT [\"/usr/local/bin/istio-iptables.sh\"]\n</code></pre> <p>\u6211\u4eec\u770b\u5230 <code>istio-init</code> \u5bb9\u5668\u7684\u5165\u53e3\u662f <code>/usr/local/bin/istio-iptables.sh</code> \u811a\u672c\uff0c\u518d\u6309\u56fe\u7d22\u9aa5\u770b\u770b\u8fd9\u4e2a\u811a\u672c\u91cc\u5230\u5e95\u5199\u7684\u4ec0\u4e48\uff0c\u8be5\u811a\u672c\u7684\u4f4d\u7f6e\u5728 Istio \u6e90\u7801\u4ed3\u5e93\u7684 tools/deb/istio-iptables.sh\uff0c\u4e00\u5171 300 \u591a\u884c\uff0c\u5c31\u4e0d\u8d34\u5728\u8fd9\u91cc\u4e86\u3002\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u89e3\u6790\u4e0b\u8fd9\u4e2a\u542f\u52a8\u811a\u672c\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#43122-init","title":"4.3.1.2.2 Init \u5bb9\u5668\u542f\u52a8\u5165\u53e3","text":"<p>Init \u5bb9\u5668\u7684\u542f\u52a8\u5165\u53e3\u662f <code>/usr/local/bin/istio-iptables.sh</code> \u811a\u672c\uff0c\u8be5\u811a\u672c\u7684\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>$ istio-iptables.sh -p PORT -u UID -g GID [-m mode] [-b ports] [-d ports] [-i CIDR] [-x CIDR] [-h]\n  -p: \u6307\u5b9a\u91cd\u5b9a\u5411\u6240\u6709 TCP \u6d41\u91cf\u7684 Envoy \u7aef\u53e3\uff08\u9ed8\u8ba4\u4e3a $ENVOY_PORT = 15001\uff09\n  -u: \u6307\u5b9a\u672a\u5e94\u7528\u91cd\u5b9a\u5411\u7684\u7528\u6237\u7684 UID\u3002\u901a\u5e38\uff0c\u8fd9\u662f\u4ee3\u7406\u5bb9\u5668\u7684 UID\uff08\u9ed8\u8ba4\u4e3a $ENVOY_USER \u7684 uid\uff0cistio_proxy \u7684 uid \u6216 1337\uff09\n  -g: \u6307\u5b9a\u672a\u5e94\u7528\u91cd\u5b9a\u5411\u7684\u7528\u6237\u7684 GID\u3002\uff08\u4e0e -u param \u76f8\u540c\u7684\u9ed8\u8ba4\u503c\uff09\n  -m: \u6307\u5b9a\u5165\u7ad9\u8fde\u63a5\u91cd\u5b9a\u5411\u5230 Envoy \u7684\u6a21\u5f0f\uff0c\u201cREDIRECT\u201d \u6216 \u201cTPROXY\u201d\uff08\u9ed8\u8ba4\u4e3a $ISTIO_INBOUND_INTERCEPTION_MODE)\n  -b: \u9017\u53f7\u5206\u9694\u7684\u5165\u7ad9\u7aef\u53e3\u5217\u8868\uff0c\u5176\u6d41\u91cf\u5c06\u91cd\u5b9a\u5411\u5230 Envoy\uff08\u53ef\u9009\uff09\u3002\u4f7f\u7528\u901a\u914d\u7b26 \u201c*\u201d \u8868\u793a\u91cd\u5b9a\u5411\u6240\u6709\u7aef\u53e3\u3002\u4e3a\u7a7a\u65f6\u8868\u793a\u7981\u7528\u6240\u6709\u5165\u7ad9\u91cd\u5b9a\u5411\uff08\u9ed8\u8ba4\u4e3a $ISTIO_INBOUND_PORTS\uff09\n  -d: \u6307\u5b9a\u8981\u4ece\u91cd\u5b9a\u5411\u5230 Envoy \u4e2d\u6392\u9664\uff08\u53ef\u9009\uff09\u7684\u5165\u7ad9\u7aef\u53e3\u5217\u8868\uff0c\u4ee5\u9017\u53f7\u683c\u5f0f\u5206\u9694\u3002\u4f7f\u7528\u901a\u914d\u7b26\u201c*\u201d \u8868\u793a\u91cd\u5b9a\u5411\u6240\u6709\u5165\u7ad9\u6d41\u91cf\uff08\u9ed8\u8ba4\u4e3a $ISTIO_LOCAL_EXCLUDE_PORTS\uff09\n  -i: \u6307\u5b9a\u91cd\u5b9a\u5411\u5230 Envoy\uff08\u53ef\u9009\uff09\u7684 IP \u5730\u5740\u8303\u56f4\uff0c\u4ee5\u9017\u53f7\u5206\u9694\u7684 CIDR \u683c\u5f0f\u5217\u8868\u3002\u4f7f\u7528\u901a\u914d\u7b26 \u201c*\u201d \u8868\u793a\u91cd\u5b9a\u5411\u6240\u6709\u51fa\u7ad9\u6d41\u91cf\u3002\u7a7a\u5217\u8868\u5c06\u7981\u7528\u6240\u6709\u51fa\u7ad9\u91cd\u5b9a\u5411\uff08\u9ed8\u8ba4\u4e3a $ISTIO_SERVICE_CIDR\uff09\n  -x: \u6307\u5b9a\u5c06\u4ece\u91cd\u5b9a\u5411\u4e2d\u6392\u9664\u7684 IP \u5730\u5740\u8303\u56f4\uff0c\u4ee5\u9017\u53f7\u5206\u9694\u7684 CIDR \u683c\u5f0f\u5217\u8868\u3002\u4f7f\u7528\u901a\u914d\u7b26 \u201c*\u201d \u8868\u793a\u91cd\u5b9a\u5411\u6240\u6709\u51fa\u7ad9\u6d41\u91cf\uff08\u9ed8\u8ba4\u4e3a $ISTIO_SERVICE_EXCLUDE_CIDR\uff09\u3002\n\n\u73af\u5883\u53d8\u91cf\u4f4d\u4e8e $ISTIO_SIDECAR_CONFIG\uff08\u9ed8\u8ba4\u5728\uff1a/var/lib/istio/envoy/sidecar.env\uff09\n</code></pre> <p>\u901a\u8fc7\u67e5\u770b\u8be5\u811a\u672c\u4f60\u5c06\u770b\u5230\uff0c\u4ee5\u4e0a\u4f20\u5165\u7684\u53c2\u6570\u90fd\u4f1a\u91cd\u65b0\u7ec4\u88c5\u6210 <code>iptables</code> \u547d\u4ee4\u7684\u53c2\u6570\u3002</p> <p>\u518d\u53c2\u8003 <code>istio-init</code> \u5bb9\u5668\u7684\u542f\u52a8\u53c2\u6570\uff0c\u5b8c\u6574\u7684\u542f\u52a8\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>$ /usr/local/bin/istio-iptables.sh -p 15001 -u 1337 -m REDIRECT -i '*' -x \"\" -b 9080 -d \"\"\n</code></pre> <p>\u8be5\u5bb9\u5668\u5b58\u5728\u7684\u610f\u4e49\u5c31\u662f\u8ba9 Envoy \u4ee3\u7406\u53ef\u4ee5\u62e6\u622a\u6240\u6709\u7684\u8fdb\u51fa Pod \u7684\u6d41\u91cf\uff0c\u5373\u5c06\u5165\u7ad9\u6d41\u91cf\u91cd\u5b9a\u5411\u5230 Sidecar\uff0c\u518d\u62e6\u622a\u5e94\u7528\u5bb9\u5668\u7684\u51fa\u7ad9\u6d41\u91cf\u7ecf\u8fc7 Sidecar \u5904\u7406\u540e\u518d\u51fa\u7ad9\u3002</p> <p>\u547d\u4ee4\u89e3\u6790</p> <p>\u8fd9\u6761\u542f\u52a8\u547d\u4ee4\u7684\u4f5c\u7528\u662f\uff1a</p> <ul> <li>\u5c06\u5e94\u7528\u5bb9\u5668\u7684\u6240\u6709\u6d41\u91cf\u90fd\u8f6c\u53d1\u5230 Envoy \u7684 15001 \u7aef\u53e3\u3002</li> <li>\u4f7f\u7528 <code>istio-proxy</code> \u7528\u6237\u8eab\u4efd\u8fd0\u884c\uff0c UID \u4e3a 1337\uff0c\u5373 Envoy \u6240\u5904\u7684\u7528\u6237\u7a7a\u95f4\uff0c\u8fd9\u4e5f\u662f <code>istio-proxy</code>\u5bb9\u5668\u9ed8\u8ba4\u4f7f\u7528\u7684\u7528\u6237\uff0c\u89c1 YAML \u914d\u7f6e\u4e2d\u7684 <code>runAsUser</code> \u5b57\u6bb5\u3002</li> <li>\u4f7f\u7528\u9ed8\u8ba4\u7684 <code>REDIRECT</code> \u6a21\u5f0f\u6765\u91cd\u5b9a\u5411\u6d41\u91cf\u3002</li> <li>\u5c06\u6240\u6709\u51fa\u7ad9\u6d41\u91cf\u90fd\u91cd\u5b9a\u5411\u5230 Envoy \u4ee3\u7406\u3002</li> <li>\u5c06\u6240\u6709\u8bbf\u95ee 9080 \u7aef\u53e3\uff08\u5373\u5e94\u7528\u5bb9\u5668 <code>productpage</code> \u7684\u7aef\u53e3\uff09\u7684\u6d41\u91cf\u91cd\u5b9a\u5411\u5230 Envoy \u4ee3\u7406\u3002</li> </ul> <p>\u56e0\u4e3a Init \u5bb9\u5668\u521d\u59cb\u5316\u5b8c\u6bd5\u540e\u5c31\u4f1a\u81ea\u52a8\u7ec8\u6b62\uff0c\u56e0\u4e3a\u6211\u4eec\u65e0\u6cd5\u767b\u9646\u5230\u5bb9\u5668\u4e2d\u67e5\u770b iptables \u4fe1\u606f\uff0c\u4f46\u662f Init \u5bb9\u5668\u521d\u59cb\u5316\u7ed3\u679c\u4f1a\u4fdd\u7559\u5230\u5e94\u7528\u5bb9\u5668\u548c Sidecar \u5bb9\u5668\u4e2d\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#34123-istio-proxy","title":"3.4.1.2.3 istio-proxy \u5bb9\u5668\u89e3\u6790","text":"<p>\u4e3a\u4e86\u67e5\u770b iptables \u914d\u7f6e\uff0c\u6211\u4eec\u9700\u8981\u767b\u9646\u5230 Sidecar \u5bb9\u5668\u4e2d\u4f7f\u7528 root \u7528\u6237\u6765\u67e5\u770b\uff0c\u56e0\u4e3a <code>kubectl</code> \u65e0\u6cd5\u4f7f\u7528\u7279\u6743\u6a21\u5f0f\u6765\u8fdc\u7a0b\u64cd\u4f5c docker \u5bb9\u5668\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u767b\u9646\u5230 <code>productpage</code> Pod \u6240\u5728\u7684\u4e3b\u673a\u4e0a\u4f7f\u7528 <code>docker</code>\u547d\u4ee4\u767b\u9646\u5bb9\u5668\u4e2d\u67e5\u770b\u3002</p> <p>\u67e5\u770b <code>productpage</code> Pod \u6240\u5728\u7684\u4e3b\u673a\u3002</p> <pre><code>$ kubectl -n default get pod -l app=productpage -o wide\nNAME                              READY     STATUS    RESTARTS   AGE       IP             NODE\nproductpage-v1-745ffc55b7-2l2lw   2/2       Running   0          1d        172.33.78.10   node3\n</code></pre> <p>\u4ece\u8f93\u51fa\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\u8be5 Pod \u8fd0\u884c\u5728 <code>node3</code> \u4e0a\uff0c\u4f7f\u7528 <code>vagrant</code> \u547d\u4ee4\u767b\u9646\u5230 <code>node3</code> \u4e3b\u673a\u4e2d\u5e76\u5207\u6362\u4e3a root \u7528\u6237\u3002</p> <pre><code>$ vagrant ssh node3\n$ sudo -i\n</code></pre> <p>\u67e5\u770b iptables \u914d\u7f6e\uff0c\u5217\u51fa NAT\uff08\u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff09\u8868\u7684\u6240\u6709\u89c4\u5219\uff0c\u56e0\u4e3a\u5728 Init \u5bb9\u5668\u542f\u52a8\u7684\u65f6\u5019\u9009\u62e9\u7ed9 <code>istio-iptables.sh</code> \u4f20\u9012\u7684\u53c2\u6570\u4e2d\u6307\u5b9a\u5c06\u5165\u7ad9\u6d41\u91cf\u91cd\u5b9a\u5411\u5230 Envoy \u7684\u6a21\u5f0f\u4e3a \u201cREDIRECT\u201d\uff0c\u56e0\u6b64\u5728 iptables \u4e2d\u5c06\u53ea\u6709 NAT \u8868\u7684\u89c4\u683c\u914d\u7f6e\uff0c\u5982\u679c\u9009\u62e9 <code>TPROXY</code> \u8fd8\u4f1a\u6709 <code>mangle</code> \u8868\u914d\u7f6e\u3002<code>iptables</code> \u547d\u4ee4\u7684\u8be6\u7ec6\u7528\u6cd5\u8bf7\u53c2\u8003 iptables\uff0c\u89c4\u5219\u914d\u7f6e\u8bf7\u53c2\u8003 iptables \u89c4\u5219\u914d\u7f6e\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3413-iptables","title":"3.4.1.3 \u7406\u89e3 iptables","text":"<p><code>iptables</code> \u662f Linux \u5185\u6838\u4e2d\u7684\u9632\u706b\u5899\u8f6f\u4ef6 netfilter \u7684\u7ba1\u7406\u5de5\u5177\uff0c\u4f4d\u4e8e\u7528\u6237\u7a7a\u95f4\uff0c\u540c\u65f6\u4e5f\u662f netfilter \u7684\u4e00\u90e8\u5206\u3002Netfilter \u4f4d\u4e8e\u5185\u6838\u7a7a\u95f4\uff0c\u4e0d\u4ec5\u6709\u7f51\u7edc\u5730\u5740\u8f6c\u6362\u7684\u529f\u80fd\uff0c\u4e5f\u5177\u5907\u6570\u636e\u5305\u5185\u5bb9\u4fee\u6539\u3001\u4ee5\u53ca\u6570\u636e\u5305\u8fc7\u6ee4\u7b49\u9632\u706b\u5899\u529f\u80fd\u3002</p> <p>\u5728\u4e86\u89e3 Init \u5bb9\u5668\u521d\u59cb\u5316\u7684 iptables \u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u4e86\u89e3\u4e0b iptables \u548c\u89c4\u5219\u914d\u7f6e\u3002</p> <p>\u4e0b\u56fe\u5c55\u793a\u4e86 iptables \u8c03\u7528\u94fe\u3002</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#34131-iptables","title":"3.4.1.3.1 iptables \u4e2d\u7684\u8868","text":"<p>Init \u5bb9\u5668\u4e2d\u4f7f\u7528\u7684\u7684 iptables \u7248\u672c\u662f <code>v1.6.0</code>\uff0c\u5171\u5305\u542b 5 \u5f20\u8868\uff1a</p> <ol> <li><code>raw</code> \u7528\u4e8e\u914d\u7f6e\u6570\u636e\u5305\uff0c<code>raw</code> \u4e2d\u7684\u6570\u636e\u5305\u4e0d\u4f1a\u88ab\u7cfb\u7edf\u8ddf\u8e2a\u3002</li> <li><code>filter</code> \u662f\u7528\u4e8e\u5b58\u653e\u6240\u6709\u4e0e\u9632\u706b\u5899\u76f8\u5173\u64cd\u4f5c\u7684\u9ed8\u8ba4\u8868\u3002</li> <li><code>nat</code> \u7528\u4e8e \u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff08\u4f8b\u5982\uff1a\u7aef\u53e3\u8f6c\u53d1\uff09\u3002</li> <li><code>mangle</code> \u7528\u4e8e\u5bf9\u7279\u5b9a\u6570\u636e\u5305\u7684\u4fee\u6539\uff08\u53c2\u8003\u635f\u574f\u6570\u636e\u5305\uff09\u3002</li> <li><code>security</code> \u7528\u4e8e\u5f3a\u5236\u8bbf\u95ee\u63a7\u5236 \u7f51\u7edc\u89c4\u5219\u3002</li> </ol> <p>\u6ce8\uff1a\u5728\u672c\u793a\u4f8b\u4e2d\u53ea\u7528\u5230\u4e86 <code>nat</code> \u8868\u3002</p> <p>\u4e0d\u540c\u7684\u8868\u4e2d\u7684\u5177\u6709\u7684\u94fe\u7c7b\u578b\u5982\u4e0b\u8868\u6240\u793a\uff1a</p> \u89c4\u5219\u540d\u79f0 raw filter nat mangle security PREROUTING \u2713 \u2713 \u2713 INPUT \u2713 \u2713 \u2713 \u2713 OUTPUT \u2713 \u2713 \u2713 \u2713 POSTROUTING \u2713 \u2713 FORWARD \u2713 \u2713 \u2713 \u2713 <p>\u4e0b\u56fe\u662f iptables \u7684\u8c03\u7528\u94fe\u987a\u5e8f\u3002</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#34132-iptables","title":"3.4.1.3.2 iptables \u547d\u4ee4","text":"<p><code>iptables</code> \u547d\u4ee4\u7684\u4e3b\u8981\u7528\u9014\u662f\u4fee\u6539\u8fd9\u4e9b\u8868\u4e2d\u7684\u89c4\u5219\u3002<code>iptables</code> \u547d\u4ee4\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>$ iptables [-t \u8868\u540d] \u547d\u4ee4\u9009\u9879\uff3b\u94fe\u540d]\uff3b\u6761\u4ef6\u5339\u914d\uff3d[-j \u76ee\u6807\u52a8\u4f5c\u6216\u8df3\u8f6c\uff3d\n</code></pre> <p>Init \u5bb9\u5668\u4e2d\u7684 <code>/istio-iptables.sh</code> \u542f\u52a8\u5165\u53e3\u811a\u672c\u5c31\u662f\u6267\u884c iptables \u521d\u59cb\u5316\u7684\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#34133-iptables","title":"3.4.1.3.3 \u7406\u89e3 iptables \u89c4\u5219","text":"<p>\u67e5\u770b <code>istio-proxy</code> \u5bb9\u5668\u4e2d\u7684\u9ed8\u8ba4\u7684 iptables \u89c4\u5219\uff0c\u9ed8\u8ba4\u67e5\u770b\u7684\u662f filter \u8868\u4e2d\u7684\u89c4\u5219\u3002</p> <pre><code>$ iptables -L -v\nChain INPUT (policy ACCEPT 350K packets, 63M bytes)\n pkts bytes target     prot opt in     out     source               destination\n\nChain FORWARD (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination\n\nChain OUTPUT (policy ACCEPT 18M packets, 1916M bytes)\n pkts bytes target     prot opt in     out     source               destination\n</code></pre> <p>\u6211\u4eec\u770b\u5230\u4e09\u4e2a\u9ed8\u8ba4\u7684\u94fe\uff0c\u5206\u522b\u662f INPUT\u3001FORWARD \u548c OUTPUT\uff0c\u6bcf\u4e2a\u94fe\u4e2d\u7684\u7b2c\u4e00\u884c\u8f93\u51fa\u8868\u793a\u94fe\u540d\u79f0\uff08\u5728\u672c\u4f8b\u4e2d\u4e3aINPUT/FORWARD/OUTPUT\uff09\uff0c\u540e\u8ddf\u9ed8\u8ba4\u7b56\u7565\uff08ACCEPT\uff09\u3002</p> <p>\u4e0b\u56fe\u662f iptables \u7684\u5efa\u8bae\u7ed3\u6784\u56fe\uff0c\u6d41\u91cf\u5728\u7ecf\u8fc7 INPUT \u94fe\u4e4b\u540e\u5c31\u8fdb\u5165\u4e86\u4e0a\u5c42\u534f\u8bae\u6808\uff0c\u6bd4\u5982</p> <p></p> <p>\u56fe\u7247\u6765\u81ea\u5e38\u89c1iptables\u4f7f\u7528\u89c4\u5219\u573a\u666f\u6574\u7406</p> <p>\u6bcf\u6761\u94fe\u4e2d\u90fd\u53ef\u4ee5\u6dfb\u52a0\u591a\u6761\u89c4\u5219\uff0c\u89c4\u5219\u662f\u6309\u7167\u987a\u5e8f\u4ece\u524d\u5230\u540e\u6267\u884c\u7684\u3002\u6211\u4eec\u6765\u770b\u4e0b\u89c4\u5219\u7684\u8868\u5934\u5b9a\u4e49\u3002</p> <ul> <li>pkts\uff1a\u5904\u7406\u8fc7\u7684\u5339\u914d\u7684\u62a5\u6587\u6570\u91cf</li> <li>bytes\uff1a\u7d2f\u8ba1\u5904\u7406\u7684\u62a5\u6587\u5927\u5c0f\uff08\u5b57\u8282\u6570\uff09</li> <li>target\uff1a\u5982\u679c\u62a5\u6587\u4e0e\u89c4\u5219\u5339\u914d\uff0c\u6307\u5b9a\u76ee\u6807\u5c31\u4f1a\u88ab\u6267\u884c\u3002</li> <li>prot\uff1a\u534f\u8bae\uff0c\u4f8b\u5982 <code>tdp</code>\u3001<code>udp</code>\u3001<code>icmp</code> \u548c <code>all</code>\u3002</li> <li>opt\uff1a\u5f88\u5c11\u4f7f\u7528\uff0c\u8fd9\u4e00\u5217\u7528\u4e8e\u663e\u793a IP \u9009\u9879\u3002</li> <li>in\uff1a\u5165\u7ad9\u7f51\u5361\u3002</li> <li>out\uff1a\u51fa\u7ad9\u7f51\u5361\u3002</li> <li>source\uff1a\u6d41\u91cf\u7684\u6e90 IP \u5730\u5740\u6216\u5b50\u7f51\uff0c\u540e\u8005\u662f <code>anywhere</code>\u3002</li> <li>destination\uff1a\u6d41\u91cf\u7684\u76ee\u7684\u5730 IP \u5730\u5740\u6216\u5b50\u7f51\uff0c\u6216\u8005\u662f <code>anywhere</code>\u3002</li> </ul> <p>\u8fd8\u6709\u4e00\u5217\u6ca1\u6709\u8868\u5934\uff0c\u663e\u793a\u5728\u6700\u540e\uff0c\u8868\u793a\u89c4\u5219\u7684\u9009\u9879\uff0c\u4f5c\u4e3a\u89c4\u5219\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u7528\u6765\u8865\u5145\u524d\u9762\u7684\u51e0\u5217\u4e2d\u7684\u914d\u7f6e\u3002<code>prot</code>\u3001<code>opt</code>\u3001<code>in</code>\u3001<code>out</code>\u3001<code>source</code> \u548c <code>destination</code> \u548c\u663e\u793a\u5728 <code>destination</code> \u540e\u9762\u7684\u6ca1\u6709\u8868\u5934\u7684\u4e00\u5217\u6269\u5c55\u6761\u4ef6\u5171\u540c\u7ec4\u6210\u5339\u914d\u89c4\u5219\u3002\u5f53\u6d41\u91cf\u5339\u914d\u8fd9\u4e9b\u89c4\u5219\u540e\u5c31\u4f1a\u6267\u884c <code>target</code>\u3002</p> <p>\u5173\u4e8e iptables \u89c4\u5219\u8bf7\u53c2\u8003\u5e38\u89c1iptables\u4f7f\u7528\u89c4\u5219\u573a\u666f\u6574\u7406\u3002</p> <p>target \u652f\u6301\u7684\u7c7b\u578b</p> <p><code>target</code> \u7c7b\u578b\u5305\u62ec <code>ACCEPT</code>\u3001<code>REJECT</code>\u3001<code>DROP</code>\u3001<code>LOG</code>\u3001<code>SNAT</code>\u3001<code>MASQUERADE</code>\u3001<code>DNAT</code>\u3001<code>REDIRECT</code>\u3001<code>RETURN</code> \u6216\u8005\u8df3\u8f6c\u5230\u5176\u4ed6\u89c4\u5219\u7b49\u3002\u53ea\u8981\u6267\u884c\u5230\u67d0\u4e00\u6761\u94fe\u4e2d\u53ea\u6709\u6309\u7167\u987a\u5e8f\u6709\u4e00\u6761\u89c4\u5219\u5339\u914d\u540e\u5c31\u53ef\u4ee5\u786e\u5b9a\u62a5\u6587\u7684\u53bb\u5411\u4e86\uff0c\u9664\u4e86 <code>RETURN</code> \u7c7b\u578b\uff0c\u7c7b\u4f3c\u7f16\u7a0b\u8bed\u8a00\u4e2d\u7684 <code>return</code> \u8bed\u53e5\uff0c\u8fd4\u56de\u5230\u5b83\u7684\u8c03\u7528\u70b9\uff0c\u7ee7\u7eed\u6267\u884c\u4e0b\u4e00\u6761\u89c4\u5219\u3002<code>target</code> \u652f\u6301\u7684\u914d\u7f6e\u8be6\u89e3\u8bf7\u53c2\u8003 iptables \u8be6\u89e3\uff081\uff09\uff1aiptables \u6982\u5ff5\u3002</p> <p>\u4ece\u8f93\u51fa\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230 Init \u5bb9\u5668\u6ca1\u6709\u5728 iptables \u7684\u9ed8\u8ba4\u94fe\u8def\u4e2d\u521b\u5efa\u4efb\u4f55\u89c4\u5219\uff0c\u800c\u662f\u521b\u5efa\u4e86\u65b0\u7684\u94fe\u8def\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3414-iptables-nat","title":"3.4.1.4 \u67e5\u770b iptables nat \u8868\u4e2d\u6ce8\u5165\u7684\u89c4\u5219","text":"<p>Init \u5bb9\u5668\u901a\u8fc7\u5411 iptables nat \u8868\u4e2d\u6ce8\u5165\u8f6c\u53d1\u89c4\u5219\u6765\u52ab\u6301\u6d41\u91cf\u7684\uff0c\u4e0b\u56fe\u663e\u793a\u7684\u662f productpage \u670d\u52a1\u4e2d\u7684 iptables \u6d41\u91cf\u52ab\u6301\u7684\u8be6\u7ec6\u8fc7\u7a0b\u3002</p> <p></p> <p>Init \u5bb9\u5668\u542f\u52a8\u65f6\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u6307\u5b9a\u4e86 <code>REDIRECT</code> \u6a21\u5f0f\uff0c\u56e0\u6b64\u53ea\u521b\u5efa\u4e86 NAT \u8868\u89c4\u5219\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u67e5\u770b\u4e0b NAT \u8868\u4e2d\u521b\u5efa\u7684\u89c4\u5219\uff0c\u8fd9\u662f\u5168\u6587\u4e2d\u7684**\u91cd\u70b9\u90e8\u5206**\uff0c\u524d\u9762\u8bb2\u4e86\u90a3\u4e48\u591a\u90fd\u662f\u4e3a\u5b83\u505a\u94fa\u57ab\u7684\u3002\u4e0b\u9762\u662f\u67e5\u770b nat \u8868\u4e2d\u7684\u89c4\u5219\uff0c\u5176\u4e2d\u94fe\u7684\u540d\u5b57\u4e2d\u5305\u542b <code>ISTIO</code> \u524d\u7f00\u7684\u662f\u7531 Init \u5bb9\u5668\u6ce8\u5165\u7684\uff0c\u89c4\u5219\u5339\u914d\u662f\u6839\u636e\u4e0b\u9762\u663e\u793a\u7684\u987a\u5e8f\u6765\u6267\u884c\u7684\uff0c\u5176\u4e2d\u4f1a\u6709\u591a\u6b21\u8df3\u8f6c\u3002</p> <pre><code># \u67e5\u770b NAT \u8868\u4e2d\u89c4\u5219\u914d\u7f6e\u7684\u8be6\u7ec6\u4fe1\u606f\n$ iptables -t nat -L -v\n# PREROUTING \u94fe\uff1a\u7528\u4e8e\u76ee\u6807\u5730\u5740\u8f6c\u6362\uff08DNAT\uff09\uff0c\u5c06\u6240\u6709\u5165\u7ad9 TCP \u6d41\u91cf\u8df3\u8f6c\u5230 ISTIO_INBOUND \u94fe\u4e0a\nChain PREROUTING (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination\n    2   120 ISTIO_INBOUND  tcp  --  any    any     anywhere             anywhere\n\n# INPUT \u94fe\uff1a\u5904\u7406\u8f93\u5165\u6570\u636e\u5305\uff0c\u975e TCP \u6d41\u91cf\u5c06\u7ee7\u7eed OUTPUT \u94fe\nChain INPUT (policy ACCEPT 2 packets, 120 bytes)\n pkts bytes target     prot opt in     out     source               destination\n\n# OUTPUT \u94fe\uff1a\u5c06\u6240\u6709\u51fa\u7ad9\u6570\u636e\u5305\u8df3\u8f6c\u5230 ISTIO_OUTPUT \u94fe\u4e0a\nChain OUTPUT (policy ACCEPT 41146 packets, 3845K bytes)\n pkts bytes target     prot opt in     out     source               destination\n   93  5580 ISTIO_OUTPUT  tcp  --  any    any     anywhere             anywhere\n\n# POSTROUTING \u94fe\uff1a\u6240\u6709\u6570\u636e\u5305\u6d41\u51fa\u7f51\u5361\u65f6\u90fd\u8981\u5148\u8fdb\u5165POSTROUTING \u94fe\uff0c\u5185\u6838\u6839\u636e\u6570\u636e\u5305\u76ee\u7684\u5730\u5224\u65ad\u662f\u5426\u9700\u8981\u8f6c\u53d1\u51fa\u53bb\uff0c\u6211\u4eec\u770b\u5230\u6b64\u5904\u672a\u505a\u4efb\u4f55\u5904\u7406\nChain POSTROUTING (policy ACCEPT 41199 packets, 3848K bytes)\n pkts bytes target     prot opt in     out     source               destination\n\n# ISTIO_INBOUND \u94fe\uff1a\u5c06\u6240\u6709\u76ee\u7684\u5730\u4e3a 9080 \u7aef\u53e3\u7684\u5165\u7ad9\u6d41\u91cf\u91cd\u5b9a\u5411\u5230 ISTIO_IN_REDIRECT \u94fe\u4e0a\nChain ISTIO_INBOUND (1 references)\n pkts bytes target     prot opt in     out     source               destination\n    2   120 ISTIO_IN_REDIRECT  tcp  --  any    any     anywhere             anywhere             tcp dpt:9080\n\n# ISTIO_IN_REDIRECT \u94fe\uff1a\u5c06\u6240\u6709\u7684\u5165\u7ad9\u6d41\u91cf\u8df3\u8f6c\u5230\u672c\u5730\u7684 15001 \u7aef\u53e3\uff0c\u81f3\u6b64\u6210\u529f\u7684\u62e6\u622a\u4e86\u6d41\u91cf\u5230 Envoy \nChain ISTIO_IN_REDIRECT (1 references)\n pkts bytes target     prot opt in     out     source               destination\n    2   120 REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports 15001\n\n# ISTIO_OUTPUT \u94fe\uff1a\u9009\u62e9\u9700\u8981\u91cd\u5b9a\u5411\u5230 Envoy\uff08\u5373\u672c\u5730\uff09 \u7684\u51fa\u7ad9\u6d41\u91cf\uff0c\u6240\u6709\u975e localhost \u7684\u6d41\u91cf\u5168\u90e8\u8f6c\u53d1\u5230 ISTIO_REDIRECT\u3002\u4e3a\u4e86\u907f\u514d\u6d41\u91cf\u5728\u8be5 Pod \u4e2d\u65e0\u9650\u5faa\u73af\uff0c\u6240\u6709\u5230 istio-proxy \u7528\u6237\u7a7a\u95f4\u7684\u6d41\u91cf\u90fd\u8fd4\u56de\u5230\u5b83\u7684\u8c03\u7528\u70b9\u4e2d\u7684\u4e0b\u4e00\u6761\u89c4\u5219\uff0c\u672c\u4f8b\u4e2d\u5373 OUTPUT \u94fe\uff0c\u56e0\u4e3a\u8df3\u51fa ISTIO_OUTPUT \u89c4\u5219\u4e4b\u540e\u5c31\u8fdb\u5165\u4e0b\u4e00\u6761\u94fe POSTROUTING\u3002\u5982\u679c\u76ee\u7684\u5730\u975e localhost \u5c31\u8df3\u8f6c\u5230 ISTIO_REDIRECT\uff1b\u5982\u679c\u6d41\u91cf\u662f\u6765\u81ea istio-proxy \u7528\u6237\u7a7a\u95f4\u7684\uff0c\u90a3\u4e48\u5c31\u8df3\u51fa\u8be5\u94fe\uff0c\u8fd4\u56de\u5b83\u7684\u8c03\u7528\u94fe\u7ee7\u7eed\u6267\u884c\u4e0b\u4e00\u6761\u89c4\u5219\uff08OUPT \u7684\u4e0b\u4e00\u6761\u89c4\u5219\uff0c\u65e0\u9700\u5bf9\u6d41\u91cf\u8fdb\u884c\u5904\u7406\uff09\uff1b\u6240\u6709\u7684\u975e istio-proxy \u7528\u6237\u7a7a\u95f4\u7684\u76ee\u7684\u5730\u662f localhost \u7684\u6d41\u91cf\u5c31\u8df3\u8f6c\u5230 ISTIO_REDIRECT\nChain ISTIO_OUTPUT (1 references)\n pkts bytes target     prot opt in     out     source               destination\n    0     0 ISTIO_REDIRECT  all  --  any    lo      anywhere            !localhost\n   40  2400 RETURN     all  --  any    any     anywhere             anywhere             owner UID match istio-proxy\n    0     0 RETURN     all  --  any    any     anywhere             anywhere             owner GID match istio-proxy    \n    0     0 RETURN     all  --  any    any     anywhere             localhost\n   53  3180 ISTIO_REDIRECT  all  --  any    any     anywhere             anywhere\n\n# ISTIO_REDIRECT \u94fe\uff1a\u5c06\u6240\u6709\u6d41\u91cf\u91cd\u5b9a\u5411\u5230 Envoy\uff08\u5373\u672c\u5730\uff09 \u7684 15001 \u7aef\u53e3\nChain ISTIO_REDIRECT (2 references)\n pkts bytes target     prot opt in     out     source               destination\n   53  3180 REDIRECT   tcp  --  any    any     anywhere             anywhere             redir ports 15001\n</code></pre> <p><code>iptables</code> \u663e\u793a\u7684\u94fe\u7684\u987a\u5e8f\uff0c\u5373\u6d41\u91cf\u89c4\u5219\u5339\u914d\u7684\u987a\u5e8f\u3002\u5176\u4e2d\u8981\u7279\u522b\u6ce8\u610f <code>ISTIO_OUTPUT</code> \u94fe\u4e2d\u7684\u89c4\u5219\u914d\u7f6e\u3002\u4e3a\u4e86\u907f\u514d\u6d41\u91cf\u4e00\u76f4\u5728 Pod \u4e2d\u65e0\u9650\u5faa\u73af\uff0c\u6240\u6709\u5230 istio-proxy \u7528\u6237\u7a7a\u95f4\u7684\u6d41\u91cf\u90fd\u8fd4\u56de\u5230\u5b83\u7684\u8c03\u7528\u70b9\u4e2d\u7684\u4e0b\u4e00\u6761\u89c4\u5219\uff0c\u672c\u4f8b\u4e2d\u5373 OUTPUT \u94fe\uff0c\u56e0\u4e3a\u8df3\u51fa <code>ISTIO_OUTPUT</code> \u89c4\u5219\u4e4b\u540e\u5c31\u8fdb\u5165\u4e0b\u4e00\u6761\u94fe <code>POSTROUTING</code>\u3002</p> <p><code>ISTIO_OUTPUT</code> \u94fe\u89c4\u5219\u5339\u914d\u7684\u8be6\u7ec6\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5982\u679c\u76ee\u7684\u5730\u975e localhost \u5c31\u8df3\u8f6c\u5230 ISTIO_REDIRECT \u94fe</li> <li>\u6240\u6709\u6765\u81ea istio-proxy \u7528\u6237\u7a7a\u95f4\u7684\u975e localhost \u6d41\u91cf\u8df3\u8f6c\u5230\u5b83\u7684\u8c03\u7528\u70b9 <code>OUTPUT</code> \u7ee7\u7eed\u6267\u884c <code>OUTPUT</code> \u94fe\u7684\u4e0b\u4e00\u6761\u89c4\u5219\uff0c\u56e0\u4e3a <code>OUTPUT</code> \u94fe\u4e2d\u6ca1\u6709\u4e0b\u4e00\u6761\u89c4\u5219\u4e86\uff0c\u6240\u4ee5\u4f1a\u7ee7\u7eed\u6267\u884c <code>POSTROUTING</code> \u94fe\u7136\u540e\u8df3\u51fa iptables\uff0c\u76f4\u63a5\u8bbf\u95ee\u76ee\u7684\u5730</li> <li>\u5982\u679c\u6d41\u91cf\u4e0d\u662f\u6765\u81ea istio-proxy \u7528\u6237\u7a7a\u95f4\uff0c\u53c8\u662f\u5bf9 localhost \u7684\u8bbf\u95ee\uff0c\u90a3\u4e48\u5c31\u8df3\u51fa iptables\uff0c\u76f4\u63a5\u8bbf\u95ee\u76ee\u7684\u5730</li> <li>\u5176\u5b83\u6240\u6709\u60c5\u51b5\u90fd\u8df3\u8f6c\u5230 <code>ISTIO_REDIRECT</code> \u94fe</li> </ul> <p>\u5176\u5b9e\u5728\u6700\u540e\u8fd9\u6761\u89c4\u5219\u524d\u8fd8\u53ef\u4ee5\u589e\u52a0 IP \u5730\u5740\u8fc7\u6ee4\uff0c\u8ba9\u67d0\u4e9b IP \u5730\u5740\u6bb5\u4e0d\u901a\u8fc7 Envoy \u4ee3\u7406\u3002</p> <p>\u56fe\u7247 - istio sidecar iptables \u6ce8\u5165</p> <p>\u4ee5\u4e0a iptables \u89c4\u5219\u90fd\u662f Init \u5bb9\u5668\u542f\u52a8\u7684\u65f6\u4f7f\u7528 istio-iptables.sh \u811a\u672c\u751f\u6210\u7684\uff0c\u8be6\u7ec6\u8fc7\u7a0b\u53ef\u4ee5\u67e5\u770b\u8be5\u811a\u672c\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3415-envoy","title":"3.4.1.5 \u67e5\u770b Envoy \u8fd0\u884c\u72b6\u6001","text":"<p>\u9996\u5148\u67e5\u770b <code>proxyv2</code> \u955c\u50cf\u7684 Dockerfile\u3002</p> <pre><code>FROM istionightly/base_debug\nARG proxy_version\nARG istio_version\n\n# \u5b89\u88c5 Envoy\nADD envoy /usr/local/bin/envoy\n\n# \u4f7f\u7528\u73af\u5883\u53d8\u91cf\u7684\u65b9\u5f0f\u660e\u6587\u6307\u5b9a proxy \u7684\u7248\u672c/\u529f\u80fd\nENV ISTIO_META_ISTIO_PROXY_VERSION \"1.1.0\"\n# \u4f7f\u7528\u73af\u5883\u53d8\u91cf\u7684\u65b9\u5f0f\u660e\u6587\u6307\u5b9a proxy \u660e\u786e\u7684 sha\uff0c\u7528\u4e8e\u6307\u5b9a\u7248\u672c\u7684\u914d\u7f6e\u548c\u8c03\u8bd5\nENV ISTIO_META_ISTIO_PROXY_SHA $proxy_version\n# \u73af\u5883\u53d8\u91cf\uff0c\u6307\u5b9a\u660e\u786e\u7684\u6784\u5efa\u53f7\uff0c\u7528\u4e8e\u8c03\u8bd5\nENV ISTIO_META_ISTIO_VERSION $istio_version\n\nADD pilot-agent /usr/local/bin/pilot-agent\n\nADD envoy_pilot.yaml.tmpl /etc/istio/proxy/envoy_pilot.yaml.tmpl\nADD envoy_policy.yaml.tmpl /etc/istio/proxy/envoy_policy.yaml.tmpl\nADD envoy_telemetry.yaml.tmpl /etc/istio/proxy/envoy_telemetry.yaml.tmpl\nADD istio-iptables.sh /usr/local/bin/istio-iptables.sh\n\nCOPY envoy_bootstrap_v2.json /var/lib/istio/envoy/envoy_bootstrap_tmpl.json\n\nRUN chmod 755 /usr/local/bin/envoy /usr/local/bin/pilot-agent\n\n# \u5c06 istio-proxy \u7528\u6237\u52a0\u5165 sudo \u6743\u9650\u4ee5\u5141\u8bb8\u6267\u884c tcpdump \u548c\u5176\u4ed6\u8c03\u8bd5\u547d\u4ee4\nRUN useradd -m --uid 1337 istio-proxy &amp;&amp; \\\n    echo \"istio-proxy ALL=NOPASSWD: ALL\" &gt;&gt; /etc/sudoers &amp;&amp; \\\n    chown -R istio-proxy /var/lib/istio\n\n# \u4f7f\u7528 pilot-agent \u6765\u542f\u52a8 Envoy\nENTRYPOINT [\"/usr/local/bin/pilot-agent\"]\n</code></pre> <p>\u8be5\u5bb9\u5668\u7684\u542f\u52a8\u5165\u53e3\u662f <code>pilot-agent</code> \u547d\u4ee4\uff0c\u6839\u636e YAML \u914d\u7f6e\u4e2d\u4f20\u9012\u7684\u53c2\u6570\uff0c\u8be6\u7ec6\u7684\u542f\u52a8\u547d\u4ee4\u5165\u4e0b\uff1a</p> <pre><code>/usr/local/bin/pilot-agent proxy sidecar --configPath /etc/istio/proxy --binaryPath /usr/local/bin/envoy --serviceCluster productpage --drainDuration 45s --parentShutdownDuration 1m0s --discoveryAddress istio-pilot.istio-system:15007 --discoveryRefreshDelay 1s --zipkinAddress zipkin.istio-system:9411 --connectTimeout 10s --statsdUdpAddress istio-statsd-prom-bridge.istio-system:9125 --proxyAdminPort 15000 --controlPlaneAuthPolicy NONE\n</code></pre> <p>\u4e3b\u8981\u914d\u7f6e\u4e86 Envoy \u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u4f4d\u7f6e\u3001\u670d\u52a1\u53d1\u73b0\u5730\u5740\u3001\u670d\u52a1\u96c6\u7fa4\u540d\u3001\u76d1\u63a7\u6307\u6807\u4e0a\u62a5\u5730\u5740\u3001Envoy \u7684\u7ba1\u7406\u7aef\u53e3\u3001\u70ed\u91cd\u542f\u65f6\u95f4\u7b49\uff0c\u8be6\u7ec6\u7528\u6cd5\u8bf7\u53c2\u8003 Istio\u5b98\u65b9\u6587\u6863 pilot-agent \u7684\u7528\u6cd5\u3002</p> <p><code>pilot-agent</code> \u662f\u5bb9\u5668\u4e2d PID \u4e3a 1 \u7684\u542f\u52a8\u8fdb\u7a0b\uff0c\u5b83\u542f\u52a8\u65f6\u53c8\u521b\u5efa\u4e86\u4e00\u4e2a Envoy \u8fdb\u7a0b\uff0c\u5982\u4e0b\uff1a</p> <pre><code>/usr/local/bin/envoy -c /etc/istio/proxy/envoy-rev0.json --restart-epoch 0 --drain-time-s 45 --parent-shutdown-time-s 60 --service-cluster productpage --service-node sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local --max-obj-name-len 189 -l warn --v2-config-only\n</code></pre> <p>\u6211\u4eec\u5206\u522b\u89e3\u91ca\u4e0b\u4ee5\u4e0a\u914d\u7f6e\u7684\u610f\u4e49\u3002</p> <ul> <li><code>-c /etc/istio/proxy/envoy-rev0.json</code>\uff1a\u914d\u7f6e\u6587\u4ef6\uff0c\u652f\u6301 <code>.json</code>\u3001<code>.yaml</code>\u3001<code>.pb</code> \u548c <code>.pb_text</code> \u683c\u5f0f\uff0c<code>pilot-agent</code> \u542f\u52a8\u7684\u65f6\u5019\u8bfb\u53d6\u4e86\u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf\u540e\u521b\u5efa\u7684\u3002</li> <li><code>--restart-epoch 0</code>\uff1aEnvoy \u70ed\u91cd\u542f\u5468\u671f\uff0c\u7b2c\u4e00\u6b21\u542f\u52a8\u9ed8\u8ba4\u4e3a 0\uff0c\u6bcf\u70ed\u91cd\u542f\u4e00\u6b21\u8be5\u503c\u52a0 1\u3002</li> <li><code>--drain-time-s 45</code>\uff1a\u70ed\u91cd\u542f\u671f\u95f4 Envoy \u5c06\u8017\u5c3d\u8fde\u63a5\u7684\u65f6\u95f4\u3002</li> <li><code>--parent-shutdown-time-s 60</code>\uff1a Envoy \u5728\u70ed\u91cd\u542f\u65f6\u5173\u95ed\u7236\u8fdb\u7a0b\u4e4b\u524d\u7b49\u5f85\u7684\u65f6\u95f4\u3002</li> <li><code>--service-cluster productpage</code>\uff1aEnvoy \u8fd0\u884c\u7684\u672c\u5730\u670d\u52a1\u96c6\u7fa4\u7684\u540d\u5b57\u3002</li> <li><code>--service-node sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local</code>\uff1a\u5b9a\u4e49 Envoy \u8fd0\u884c\u7684\u672c\u5730\u670d\u52a1\u8282\u70b9\u540d\u79f0\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u8be5 Pod \u7684\u540d\u79f0\u3001IP\u3001DNS \u57df\u7b49\u4fe1\u606f\uff0c\u6839\u636e\u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf\u62fc\u51fa\u6765\u7684\u3002</li> <li><code>-max-obj-name-len 189</code>\uff1acluster/route_config/listener \u4e2d\u540d\u79f0\u5b57\u6bb5\u7684\u6700\u5927\u957f\u5ea6\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09</li> <li><code>-l warn</code>\uff1a\u65e5\u5fd7\u7ea7\u522b</li> <li><code>--v2-config-only</code>\uff1a\u53ea\u89e3\u6790 v2 \u5f15\u5bfc\u914d\u7f6e\u6587\u4ef6</li> </ul> <p>\u8be6\u7ec6\u914d\u7f6e\u8bf7\u53c2\u8003 Envoy \u7684\u547d\u4ee4\u884c\u9009\u9879\u3002</p> <p>\u67e5\u770b Envoy \u7684\u914d\u7f6e\u6587\u4ef6 <code>/etc/istio/proxy/envoy-rev0.json</code>\u3002</p> <pre><code>{\n  \"node\": {\n    \"id\": \"sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local\",\n    \"cluster\": \"productpage\",\n\n    \"metadata\": {\n          \"INTERCEPTION_MODE\": \"REDIRECT\",\n          \"ISTIO_PROXY_SHA\": \"istio-proxy:6166ae7ebac7f630206b2fe4e6767516bf198313\",\n          \"ISTIO_PROXY_VERSION\": \"1.0.0\",\n          \"ISTIO_VERSION\": \"1.0.0\",\n          \"POD_NAME\": \"productpage-v1-745ffc55b7-2l2lw\",\n      \"istio\": \"sidecar\"\n    }\n  },\n  \"stats_config\": {\n    \"use_all_default_tags\": false\n  },\n  \"admin\": {\n    \"access_log_path\": \"/dev/stdout\",\n    \"address\": {\n      \"socket_address\": {\n        \"address\": \"127.0.0.1\",\n        \"port_value\": 15000\n      }\n    }\n  },\n  \"dynamic_resources\": {\n    \"lds_config\": {\n        \"ads\": {}\n    },\n    \"cds_config\": {\n        \"ads\": {}\n    },\n    \"ads_config\": {\n      \"api_type\": \"GRPC\",\n      \"refresh_delay\": {\"seconds\": 1, \"nanos\": 0},\n      \"grpc_services\": [\n        {\n          \"envoy_grpc\": {\n            \"cluster_name\": \"xds-grpc\"\n          }\n        }\n      ]\n    }\n  },\n  \"static_resources\": {\n    \"clusters\": [\n    {\n    \"name\": \"xds-grpc\",\n    \"type\": \"STRICT_DNS\",\n    \"connect_timeout\": {\"seconds\": 10, \"nanos\": 0},\n    \"lb_policy\": \"ROUND_ROBIN\",\n\n    \"hosts\": [\n    {\n    \"socket_address\": {\"address\": \"istio-pilot.istio-system\", \"port_value\": 15010}\n    }\n    ],\n    \"circuit_breakers\": {\n        \"thresholds\": [\n      {\n        \"priority\": \"default\",\n        \"max_connections\": \"100000\",\n        \"max_pending_requests\": \"100000\",\n        \"max_requests\": \"100000\"\n      },\n      {\n        \"priority\": \"high\",\n        \"max_connections\": \"100000\",\n        \"max_pending_requests\": \"100000\",\n        \"max_requests\": \"100000\"\n      }]\n    },\n    \"upstream_connection_options\": {\n      \"tcp_keepalive\": {\n        \"keepalive_time\": 300\n      }\n    },\n    \"http2_protocol_options\": { }\n    }\n\n\n    ,\n      {\n        \"name\": \"zipkin\",\n        \"type\": \"STRICT_DNS\",\n        \"connect_timeout\": {\n          \"seconds\": 1\n        },\n        \"lb_policy\": \"ROUND_ROBIN\",\n        \"hosts\": [\n          {\n            \"socket_address\": {\"address\": \"zipkin.istio-system\", \"port_value\": 9411}\n          }\n        ]\n      }\n\n    ]\n  },\n\n  \"tracing\": {\n    \"http\": {\n      \"name\": \"envoy.zipkin\",\n      \"config\": {\n        \"collector_cluster\": \"zipkin\"\n      }\n    }\n  },\n\n\n  \"stats_sinks\": [\n    {\n      \"name\": \"envoy.statsd\",\n      \"config\": {\n        \"address\": {\n          \"socket_address\": {\"address\": \"10.254.109.175\", \"port_value\": 9125}\n        }\n      }\n    }\n  ]\n\n}\n</code></pre> <p>\u4e0b\u56fe\u662f\u4f7f\u7528 Istio \u7ba1\u7406\u7684 bookinfo \u793a\u4f8b\u7684\u8bbf\u95ee\u8bf7\u6c42\u8def\u5f84\u56fe\u3002</p> <p>\u56fe\u7247 - Istio bookinfo</p> <p>\u56fe\u7247\u6765\u81ea Istio \u5b98\u65b9\u7f51\u7ad9</p> <p>\u5bf9\u7167 bookinfo \u793a\u4f8b\u7684 productpage \u67e5\u770b\u5efa\u7acb\u7684\u8fde\u63a5\u3002\u5728 <code>productpage-v1-745ffc55b7-2l2lw</code> Pod \u7684 <code>istio-proxy</code> \u5bb9\u5668\u4e2d\u4f7f\u7528 root \u7528\u6237\u67e5\u770b\u6253\u5f00\u7684\u7aef\u53e3\u3002</p> <pre><code>$ lsof -i\nCOMMAND PID        USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nenvoy    11 istio-proxy    9u  IPv4  73951      0t0  TCP localhost:15000 (LISTEN) # Envoy admin \u7aef\u53e3\nenvoy    11 istio-proxy   17u  IPv4  74320      0t0  TCP productpage-v1-745ffc55b7-2l2lw:46862-&gt;istio-pilot.istio-system.svc.cluster.local:15010 (ESTABLISHED) # 15010\uff1aistio-pilot \u7684 grcp-xds \u7aef\u53e3\nenvoy    11 istio-proxy   18u  IPv4  73986      0t0  UDP productpage-v1-745ffc55b7-2l2lw:44332-&gt;istio-statsd-prom-bridge.istio-system.svc.cluster.local:9125 # \u7ed9 Promethues \u53d1\u9001 metric \u7684\u7aef\u53e3\nenvoy    11 istio-proxy   52u  IPv4  74599      0t0  TCP *:15001 (LISTEN) # Envoy \u7684\u76d1\u542c\u7aef\u53e3\nenvoy    11 istio-proxy   53u  IPv4  74600      0t0  UDP productpage-v1-745ffc55b7-2l2lw:48011-&gt;istio-statsd-prom-bridge.istio-system.svc.cluster.local:9125 # \u7ed9 Promethues \u53d1\u9001 metric \u7aef\u53e3\nenvoy    11 istio-proxy   54u  IPv4 338551      0t0  TCP productpage-v1-745ffc55b7-2l2lw:15001-&gt;172.17.8.102:52670 (ESTABLISHED) # 52670\uff1aIngress gateway \u7aef\u53e3\nenvoy    11 istio-proxy   55u  IPv4 338364      0t0  TCP productpage-v1-745ffc55b7-2l2lw:44046-&gt;172.33.78.9:9091 (ESTABLISHED) # 9091\uff1aistio-telemetry \u670d\u52a1\u7684 grpc-mixer \u7aef\u53e3\nenvoy    11 istio-proxy   56u  IPv4 338473      0t0  TCP productpage-v1-745ffc55b7-2l2lw:47210-&gt;zipkin.istio-system.svc.cluster.local:9411 (ESTABLISHED) # 9411: zipkin \u7aef\u53e3\nenvoy    11 istio-proxy   58u  IPv4 338383      0t0  TCP productpage-v1-745ffc55b7-2l2lw:41564-&gt;172.33.84.8:9080 (ESTABLISHED) # 9080\uff1adetails-v1 \u7684 http \u7aef\u53e3\nenvoy    11 istio-proxy   59u  IPv4 338390      0t0  TCP productpage-v1-745ffc55b7-2l2lw:54410-&gt;172.33.78.5:9080 (ESTABLISHED) # 9080\uff1areviews-v2 \u7684 http \u7aef\u53e3\nenvoy    11 istio-proxy   60u  IPv4 338411      0t0  TCP productpage-v1-745ffc55b7-2l2lw:35200-&gt;172.33.84.5:9091 (ESTABLISHED) # 9091:istio-telemetry \u670d\u52a1\u7684 grpc-mixer \u7aef\u53e3\nenvoy    11 istio-proxy   62u  IPv4 338497      0t0  TCP productpage-v1-745ffc55b7-2l2lw:34402-&gt;172.33.84.9:9080 (ESTABLISHED) # reviews-v1 \u7684 http \u7aef\u53e3\nenvoy    11 istio-proxy   63u  IPv4 338525      0t0  TCP productpage-v1-745ffc55b7-2l2lw:50592-&gt;172.33.71.5:9080 (ESTABLISHED) # reviews-v3 \u7684 http \u7aef\u53e3\n</code></pre> <p>\u4ece\u8f93\u51fa\u7ecf\u8fc7\u4e0a\u53ef\u4ee5\u9a8c\u8bc1 Sidecar \u662f\u5982\u4f55\u63a5\u7ba1\u6d41\u91cf\u548c\u4e0e istio-pilot \u901a\u4fe1\uff0c\u53ca\u5411 Mixer \u505a\u9065\u6d4b\u6570\u636e\u6c47\u805a\u7684\u3002\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u518d\u53bb\u770b\u770b\u5176\u4ed6\u51e0\u4e2a\u670d\u52a1\u7684 istio-proxy \u5bb9\u5668\u4e2d\u7684 iptables \u548c\u7aef\u53e3\u4fe1\u606f\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#342-sidecar","title":"3.4.2 Sidecar \u7684\u81ea\u52a8\u6ce8\u5165\u8fc7\u7a0b\u8be6\u89e3","text":"<p>\u5728 Sidecar \u6ce8\u5165\u4e0e\u6d41\u91cf\u52ab\u6301\u8be6\u89e3\u4e2d\u6211\u53ea\u662f\u7b80\u5355\u4ecb\u7ecd\u4e86 Sidecar \u6ce8\u5165\u7684\u6b65\u9aa4\uff0c\u4f46\u662f\u6ca1\u6709\u6d89\u53ca\u5230\u5177\u4f53\u7684 Sidecar \u6ce8\u5165\u6d41\u7a0b\u4e0e\u7ec6\u8282\uff0c\u8fd9\u4e00\u7bc7\u5c06\u5e26\u5927\u5bb6\u4e86\u89e3 Istio \u4e3a\u6570\u636e\u5e73\u9762\u81ea\u52a8\u6ce8\u5165 Sidecar \u7684\u8be6\u7ec6\u8fc7\u7a0b\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#3421-sidecar","title":"3.4.2.1 Sidecar \u6ce8\u5165\u8fc7\u7a0b","text":"<p>\u5982 Istio \u5b98\u65b9\u6587\u6863\u4e2d\u5bf9 Istio sidecar \u6ce8\u5165\u7684\u63cf\u8ff0\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 istioctl \u547d\u4ee4\u624b\u52a8\u6ce8\u5165 Sidecar\uff0c\u4e5f\u53ef\u4ee5\u4e3a Kubernetes \u96c6\u7fa4\u81ea\u52a8\u5f00\u542f sidecar \u6ce8\u5165\uff0c\u8fd9\u4e3b\u8981\u7528\u5230\u4e86 Kubernetes \u7684\u51c6\u5165\u63a7\u5236\u5668\u4e2d\u7684 webhook\uff0c\u53c2\u8003 Istio \u5b98\u7f51\u4e2d\u5bf9 Istio sidecar \u6ce8\u5165\u7684\u63cf\u8ff0\u3002</p> <p>\u56fe\u7247 - Sidecar \u6ce8\u5165\u6d41\u7a0b\u56fe</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#sidecar-sidecar","title":"\u624b\u52a8\u6ce8\u5165 sidecar \u4e0e\u81ea\u52a8\u6ce8\u5165 sidecar \u7684\u533a\u522b","text":"<p>\u4e0d\u8bba\u662f\u624b\u52a8\u6ce8\u5165\u8fd8\u662f\u81ea\u52a8\u6ce8\u5165\uff0csidecar \u7684\u6ce8\u5165\u8fc7\u7a0b\u90fd\u9700\u8981\u9075\u5faa\u5982\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>Kubernetes \u9700\u8981\u4e86\u89e3\u5f85\u6ce8\u5165\u7684 sidecar \u6240\u8fde\u63a5\u7684 Istio \u96c6\u7fa4\u53ca\u5176\u914d\u7f6e\uff1b</li> <li>Kubernetes \u9700\u8981\u4e86\u89e3\u5f85\u6ce8\u5165\u7684 sidecar \u5bb9\u5668\u672c\u8eab\u7684\u914d\u7f6e\uff0c\u5982\u955c\u50cf\u5730\u5740\u3001\u542f\u52a8\u53c2\u6570\u7b49\uff1b</li> <li>Kubernetes \u6839\u636e sidecar \u6ce8\u5165\u6a21\u677f\u548c\u4ee5\u4e0a\u914d\u7f6e\u586b\u5145 sidecar \u7684\u914d\u7f6e\u53c2\u6570\uff0c\u5c06\u4ee5\u4e0a\u914d\u7f6e\u6ce8\u5165\u5230\u5e94\u7528\u5bb9\u5668\u7684\u4e00\u4fa7\uff1b</li> </ol> <p>Istio \u548c sidecar \u914d\u7f6e\u4fdd\u5b58\u5728 <code>istio</code> \u548c <code>istio-sidecar-injector</code> \u8fd9\u4e24\u4e2a ConfigMap \u4e2d\uff0c\u5176\u4e2d\u5305\u542b\u4e86 Go template\uff0c\u6240\u8c13\u81ea\u52a8 sidecar \u6ce8\u5165\u5c31\u662f\u5c06\u751f\u6210 Pod \u914d\u7f6e\u4ece\u5e94\u7528 YAML \u6587\u4ef6\u671f\u95f4\u8f6c\u79fb\u5230 mutable webhook\u4e2d\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#35-istio-cni-plugin","title":"3.5 Istio CNI Plugin","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#351","title":"3.5.1 \u8bbe\u8ba1\u76ee\u6807","text":"<p>\u5f53\u524d\u5b9e\u73b0\u5c06\u7528\u6237 pod \u6d41\u91cf\u8f6c\u53d1\u5230 proxy \u7684\u9ed8\u8ba4\u65b9\u5f0f\u662f\u4f7f\u7528 privileged \u6743\u9650\u7684 istio-init \u8fd9\u4e2a init container \u6765\u505a\u7684\uff08\u8fd0\u884c\u811a\u672c\u5199\u5165 iptables\uff09\uff0cIstio CNI \u63d2\u4ef6\u7684\u4e3b\u8981\u8bbe\u8ba1\u76ee\u6807\u662f\u6d88\u9664\u8fd9\u4e2a privileged \u6743\u9650\u7684 init container\uff0c\u6362\u6210\u5229\u7528 Kubernetes CNI \u673a\u5236\u6765\u5b9e\u73b0\u76f8\u540c\u529f\u80fd\u7684\u66ff\u4ee3\u65b9\u6848\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#352","title":"3.5.2 \u539f\u7406","text":"<ul> <li>Istio CNI Plugin \u4e0d\u662f istio \u63d0\u51fa\u7c7b\u4f3c Kubernetes CNI \u7684\u63d2\u4ef6\u6269\u5c55\u673a\u5236\uff0c\u800c\u662f Kubernetes CNI \u7684\u4e00\u4e2a\u5177\u4f53\u5b9e\u73b0</li> <li>Kubernetes CNI \u63d2\u4ef6\u662f\u4e00\u6761\u94fe\uff0c\u5728\u521b\u5efa\u548c\u9500\u6bc1pod\u7684\u65f6\u5019\u4f1a\u8c03\u7528\u94fe\u4e0a\u6240\u6709\u63d2\u4ef6\u6765\u5b89\u88c5\u548c\u5378\u8f7d\u5bb9\u5668\u7684\u7f51\u7edc\uff0cistio CNI Plugin \u5373\u4e3a CNI \u63d2\u4ef6\u7684\u4e00\u4e2a\u5b9e\u73b0\uff0c\u76f8\u5f53\u4e8e\u5728\u521b\u5efa\u9500\u6bc1pod\u8fd9\u4e9bhook\u70b9\u6765\u9488\u5bf9istio\u7684pod\u505a\u7f51\u7edc\u914d\u7f6e\uff1a\u5199\u5165iptables\uff0c\u8ba9\u8be5 pod \u6240\u5728\u7684 network namespace \u7684\u7f51\u7edc\u6d41\u91cf\u8f6c\u53d1\u5230 proxy \u8fdb\u7a0b</li> <li>\u5f53\u7136\u4e5f\u5c31\u8981\u6c42\u96c6\u7fa4\u542f\u7528 CNI\uff0ckubelet \u542f\u52a8\u53c2\u6570: <code>--network-plugin=cni</code> \uff08\u8be5\u53c2\u6570\u53ea\u6709\u4e24\u4e2a\u53ef\u9009\u9879\uff1a<code>kubenet</code>, <code>cni</code>\uff09</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#353","title":"3.5.3 \u5b9e\u73b0\u65b9\u5f0f","text":"<ul> <li>\u8fd0\u884c\u4e00\u4e2a\u540d\u4e3a istio-cni-node \u7684 daemonset \u8fd0\u884c\u5728\u6bcf\u4e2a\u8282\u70b9\uff0c\u7528\u4e8e\u5b89\u88c5 istio CNI \u63d2\u4ef6</li> <li>\u8be5 CNI \u63d2\u4ef6\u8d1f\u8d23\u5199\u5165 iptables \u89c4\u5219\uff0c\u8ba9\u7528\u6237 pod \u6240\u5728 netns \u7684\u6d41\u91cf\u90fd\u8f6c\u53d1\u5230\u8fd9\u4e2a pod \u4e2d proxy \u7684\u8fdb\u7a0b</li> <li>\u5f53\u542f\u7528 istio cni \u540e\uff0csidecar \u7684\u81ea\u52a8\u6ce8\u5165\u6216<code>istioctl kube-inject</code>\u5c06\u4e0d\u518d\u6ce8\u5165 initContainers (istio-init)</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#354-istio-cni-node","title":"3.5.4 istio-cni-node \u5de5\u4f5c\u6d41\u7a0b","text":"<ul> <li>\u590d\u5236 Istio CNI \u63d2\u4ef6\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u5230CNI\u7684bin\u76ee\u5f55\uff08\u5373kubelet\u542f\u52a8\u53c2\u6570<code>--cni-bin-dir</code>\u6307\u5b9a\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u662f<code>/opt/cni/bin</code>\uff09</li> <li>\u4f7f\u7528istio-cni-node\u81ea\u5df1\u7684ServiceAccount\u4fe1\u606f\u4e3aCNI\u63d2\u4ef6\u751f\u6210kubeconfig\uff0c\u8ba9\u63d2\u4ef6\u80fd\u4e0eapiserver\u901a\u4fe1(ServiceAccount\u4fe1\u606f\u4f1a\u88ab\u81ea\u52a8\u6302\u8f7d\u5230<code>/var/run/secrets/kubernetes.io/serviceaccount</code>)</li> <li>\u751f\u6210CNI\u63d2\u4ef6\u7684\u914d\u7f6e\u5e76\u5c06\u5176\u63d2\u5165CNI\u914d\u7f6e\u63d2\u4ef6\u94fe\u672b\u5c3e\uff08CNI\u7684\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u662fkubelet\u542f\u52a8\u53c2\u6570<code>--cni-conf-dir</code>\u6240\u6307\u5b9a\u7684\u76ee\u5f55\uff0c\u9ed8\u8ba4\u662f<code>/etc/cni/net.d</code>\uff09</li> <li>watch CNI \u914d\u7f6e(<code>cni-conf-dir</code>)\uff0c\u5982\u679c\u68c0\u6d4b\u5230\u88ab\u4fee\u6539\u5c31\u91cd\u65b0\u6539\u56de\u6765</li> <li>watch istio-cni-node \u81ea\u8eab\u7684\u914d\u7f6e(configmap)\uff0c\u68c0\u6d4b\u5230\u6709\u4fee\u6539\u5c31\u91cd\u65b0\u6267\u884cCNI\u914d\u7f6e\u751f\u6210\u4e0e\u4e0b\u53d1\u6d41\u7a0b\uff08\u5f53\u524d\u5199\u8fd9\u7bc7\u6587\u7ae0\u7684\u65f6\u5019\u662fistio 1.1.1\uff0c\u8fd8\u6ca1\u5b9e\u73b0\u6b64\u529f\u80fd\uff09</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#355","title":"3.5.5 \u8bbe\u8ba1\u63d0\u6848","text":"<ul> <li>Istio CNI Plugin \u63d0\u6848\u521b\u5efa\u65f6\u95f4\uff1a2018-09-28</li> <li>Istio CNI Plugin \u63d0\u6848\u6587\u6863\u5b58\u653e\u5728\uff1aIstio \u7684 Google Team Drive</li> <li>Istio TeamDrive \u5730\u5740\uff1ahttps://drive.google.com/corp/drive/u/0/folders/0AIS5p3eW9BCtUk9PVA</li> <li>Istio CNI Plugin \u63d0\u6848\u6587\u6863\u8def\u5f84\uff1a<code>Working Groups/Networking/Istio CNI Plugin</code></li> <li>\u67e5\u770b\u6587\u4ef6\u9700\u8981\u7533\u8bf7\u6743\u9650\uff0c\u7533\u8bf7\u65b9\u6cd5\uff1a\u52a0\u5165istio-team-drive-access\u8fd9\u4e2agoogle\u7f51\u4e0a\u8bba\u575bgroup</li> <li>istio-team-drive-access group \u5730\u5740: https://groups.google.com/forum/#!forum/istio-team-drive-access</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#_4","title":"\u56db \u6570\u636e\u5e73\u53f0","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#41","title":"4.1 \u6570\u636e\u5e73\u9762\u4ecb\u7ecd","text":"<p>\u6570\u636e\u5e73\u9762\u7531\u4e00\u7ec4\u4ee5 sidecar \u65b9\u5f0f\u90e8\u7f72\u7684\u667a\u80fd\u4ee3\u7406\u7ec4\u6210\u3002 \u8fd9\u4e9b\u4ee3\u7406\u53ef\u4ee5\u8c03\u8282\u548c\u63a7\u5236\u5fae\u670d\u52a1\u4e4b\u95f4\u6240\u6709\u7684\u7f51\u7edc\u901a\u4fe1\u3002 \u6570\u636e\u5e73\u9762\u771f\u6b63\u89e6\u53ca\u5230\u5bf9\u7f51\u7edc\u6570\u636e\u5305\u7684\u76f8\u5173\u64cd\u4f5c\uff0c\u662f\u4e0a\u5c42\u63a7\u5236\u5e73\u9762\u7b56\u7565\u7684\u5177\u4f53\u6267\u884c\u8005\u3002</p> <p>\u5728\u670d\u52a1\u7f51\u683c\u4e2d\uff0c\u6570\u636e\u5e73\u9762 sidecar \u4ee3\u7406\u4e3b\u8981\u8d1f\u8d23\u6267\u884c\u5982\u4e0b\u4efb\u52a1\uff1a</p> <ul> <li>\u670d\u52a1\u53d1\u73b0\uff1a\u63a2\u6d4b\u6240\u6709\u53ef\u7528\u7684\u4e0a\u6e38\u6216\u540e\u7aef\u670d\u52a1\u5b9e\u4f8b</li> <li>\u5065\u5eb7\u68c0\u6d4b\uff1a\u63a2\u6d4b\u4e0a\u6e38\u6216\u540e\u7aef\u670d\u52a1\u5b9e\u4f8b\u662f\u5426\u5065\u5eb7\uff0c\u662f\u5426\u51c6\u5907\u597d\u63a5\u6536\u7f51\u7edc\u6d41\u91cf</li> <li>\u6d41\u91cf\u8def\u7531\uff1a\u5c06\u7f51\u7edc\u8bf7\u6c42\u8def\u7531\u5230\u6b63\u786e\u7684\u4e0a\u6e38\u6216\u540e\u7aef\u670d\u52a1</li> <li>\u8d1f\u8f7d\u5747\u8861\uff1a\u5728\u5bf9\u4e0a\u6e38\u6216\u540e\u7aef\u670d\u52a1\u8fdb\u884c\u8bf7\u6c42\u65f6\uff0c\u9009\u62e9\u5408\u9002\u7684\u670d\u52a1\u5b9e\u4f8b\u63a5\u6536\u8bf7\u6c42\uff0c\u540c\u65f6\u8d1f\u8d23\u5904\u7406\u8d85\u65f6\u3001\u65ad\u8def\u3001\u91cd\u8bd5\u7b49\u60c5\u51b5</li> <li>\u8eab\u4efd\u9a8c\u8bc1\u548c\u6388\u6743\uff1a\u5bf9\u7f51\u7edc\u8bf7\u6c42\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3001\u6743\u9650\u9a8c\u8bc1\uff0c\u4ee5\u51b3\u5b9a\u662f\u5426\u54cd\u5e94\u4ee5\u53ca\u5982\u4f55\u54cd\u5e94\uff0c\u4f7f\u7528 mTLS \u6216\u5176\u4ed6\u673a\u5236\u5bf9\u94fe\u8def\u8fdb\u884c\u52a0\u5bc6\u7b49</li> <li>\u94fe\u8def\u8ffd\u8e2a\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u8bf7\u6c42\uff0c\u751f\u6210\u8be6\u7ec6\u7684\u7edf\u8ba1\u4fe1\u606f\u3001\u65e5\u5fd7\u8bb0\u5f55\u548c\u5206\u5e03\u5f0f\u8ffd\u8e2a\u6570\u636e\uff0c\u4ee5\u4fbf\u64cd\u4f5c\u4eba\u5458\u80fd\u591f\u7406\u89e3\u8c03\u7528\u8def\u5f84\u5e76\u5728\u51fa\u73b0\u95ee\u9898\u65f6\u8fdb\u884c\u8c03\u8bd5</li> </ul> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u6570\u636e\u5e73\u9762\u5c31\u662f\u8d1f\u8d23\u6709\u6761\u4ef6\u5730\u8f6c\u6362\u3001\u8f6c\u53d1\u4ee5\u53ca\u89c2\u5bdf\u8fdb\u51fa\u670d\u52a1\u5b9e\u4f8b\u7684\u6bcf\u4e2a\u7f51\u7edc\u5305\u3002</p> <p>\u5178\u578b\u7684\u6570\u636e\u5e73\u9762\u5b9e\u73b0\u6709\uff1aLinkerd\u3001NGINX\u3001HAProxy\u3001Envoy\u3001Traefik</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#42-envoy","title":"4.2 Envoy \u4e2d\u7684\u57fa\u672c\u672f\u8bed","text":"<p>Host\uff1a\u80fd\u591f\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\u7684\u5b9e\u4f53\uff08\u5728\u624b\u673a\u6216\u670d\u52a1\u5668\u7b49\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\uff09\u3002\u5728 Envoy \u4e2d\u4e3b\u673a\u662f\u6307\u903b\u8f91\u7f51\u7edc\u5e94\u7528\u7a0b\u5e8f\u3002\u53ea\u8981\u6bcf\u53f0\u4e3b\u673a\u90fd\u53ef\u4ee5\u72ec\u7acb\u5bfb\u5740\uff0c\u4e00\u5757\u7269\u7406\u786c\u4ef6\u4e0a\u5c31\u8fd0\u884c\u591a\u4e2a\u4e3b\u673a\u3002</p> <p>Downstream\uff1a\u4e0b\u6e38\uff08downstream\uff09\u4e3b\u673a\u8fde\u63a5\u5230 Envoy\uff0c\u53d1\u9001\u8bf7\u6c42\u5e76\u83b7\u5f97\u54cd\u5e94\u3002</p> <p>Upstream\uff1a\u4e0a\u6e38\uff08upstream\uff09\u4e3b\u673a\u83b7\u53d6\u6765\u81ea Envoy \u7684\u8fde\u63a5\u63a5\u8bf7\u6c42\u548c\u54cd\u5e94\u3002</p> <p>Cluster: \u96c6\u7fa4\uff08cluster\uff09\u662f Envoy \u8fde\u63a5\u5230\u7684\u4e00\u7ec4\u903b\u8f91\u4e0a\u76f8\u4f3c\u7684\u4e0a\u6e38\u4e3b\u673a\u3002Envoy \u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u53d1\u73b0\u96c6\u7fa4\u4e2d\u7684\u6210\u5458\u3002Envoy \u53ef\u4ee5\u901a\u8fc7\u4e3b\u52a8\u8fd0\u884c\u72b6\u51b5\u68c0\u67e5\u6765\u786e\u5b9a\u96c6\u7fa4\u6210\u5458\u7684\u5065\u5eb7\u72b6\u51b5\u3002Envoy \u5982\u4f55\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u96c6\u7fa4\u6210\u5458\u7531\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u786e\u5b9a\u3002</p> <p>Mesh\uff1a\u4e00\u7ec4\u4e92\u76f8\u534f\u8c03\u4ee5\u63d0\u4f9b\u4e00\u81f4\u7f51\u7edc\u62d3\u6251\u7684\u4e3b\u673a\u3002Envoy mesh \u662f\u6307\u4e00\u7ec4 Envoy \u4ee3\u7406\uff0c\u5b83\u4eec\u6784\u6210\u4e86\u7531\u591a\u79cd\u4e0d\u540c\u670d\u52a1\u548c\u5e94\u7528\u7a0b\u5e8f\u5e73\u53f0\u7ec4\u6210\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u6d88\u606f\u4f20\u9012\u57fa\u7840\u3002</p> <p>\u8fd0\u884c\u65f6\u914d\u7f6e\uff1a\u4e0e Envoy \u4e00\u8d77\u90e8\u7f72\u7684\u5e26\u5916\u5b9e\u65f6\u914d\u7f6e\u7cfb\u7edf\u3002\u53ef\u4ee5\u5728\u65e0\u9700\u91cd\u542f Envoy \u6216\u66f4\u6539 Envoy \u4e3b\u914d\u7f6e\u7684\u60c5\u51b5\u4e0b\uff0c\u901a\u8fc7\u66f4\u6539\u8bbe\u7f6e\u6765\u5f71\u54cd\u64cd\u4f5c\u3002</p> <p>Listener: \u76d1\u542c\u5668\uff08listener\uff09\u662f\u53ef\u4ee5\u7531\u4e0b\u6e38\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u547d\u540d\u7f51\u7edc\u4f4d\u7f6e\uff08\u4f8b\u5982\uff0c\u7aef\u53e3\u3001unix\u57df\u5957\u63a5\u5b57\u7b49\uff09\u3002Envoy \u516c\u5f00\u4e00\u4e2a\u6216\u591a\u4e2a\u4e0b\u6e38\u4e3b\u673a\u8fde\u63a5\u7684\u76d1\u542c\u5668\u3002\u4e00\u822c\u662f\u6bcf\u53f0\u4e3b\u673a\u8fd0\u884c\u4e00\u4e2a Envoy\uff0c\u4f7f\u7528\u5355\u8fdb\u7a0b\u8fd0\u884c\uff0c\u4f46\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u4e2d\u53ef\u4ee5\u542f\u52a8\u4efb\u610f\u6570\u91cf\u7684 Listener\uff08\u76d1\u542c\u5668\uff09\uff0c\u76ee\u524d\u53ea\u76d1\u542c TCP\uff0c\u6bcf\u4e2a\u76d1\u542c\u5668\u90fd\u72ec\u7acb\u914d\u7f6e\u4e00\u5b9a\u6570\u91cf\u7684\uff08L3/L4\uff09\u7f51\u7edc\u8fc7\u6ee4\u5668\u3002Listenter \u4e5f\u53ef\u4ee5\u901a\u8fc7 Listener Discovery Service\uff08LDS\uff09\u52a8\u6001\u83b7\u53d6\u3002</p> <p>Listener filter\uff1aListener \u4f7f\u7528 listener filter\uff08\u76d1\u542c\u5668\u8fc7\u6ee4\u5668\uff09\u6765\u64cd\u4f5c\u8fde\u63a5\u7684\u5143\u6570\u636e\u3002\u5b83\u7684\u4f5c\u7528\u662f\u5728\u4e0d\u66f4\u6539 Envoy \u7684\u6838\u5fc3\u529f\u80fd\u7684\u60c5\u51b5\u4e0b\u6dfb\u52a0\u66f4\u591a\u7684\u96c6\u6210\u529f\u80fd\u3002Listener filter \u7684 API \u76f8\u5bf9\u7b80\u5355\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u8fc7\u6ee4\u5668\u6700\u7ec8\u662f\u5728\u65b0\u63a5\u53d7\u7684\u5957\u63a5\u5b57\u4e0a\u8fd0\u884c\u3002\u5728\u94fe\u4e2d\u53ef\u4ee5\u4e92\u76f8\u8854\u63a5\u4ee5\u652f\u6301\u66f4\u590d\u6742\u7684\u573a\u666f\uff0c\u4f8b\u5982\u8c03\u7528\u901f\u7387\u9650\u5236\u3002Envoy \u5df2\u7ecf\u5305\u542b\u4e86\u591a\u4e2a\u76d1\u542c\u5668\u8fc7\u6ee4\u5668\u3002</p> <p>Http Route Table\uff1aHTTP \u7684\u8def\u7531\u89c4\u5219\uff0c\u4f8b\u5982\u8bf7\u6c42\u7684\u57df\u540d\uff0cPath \u7b26\u5408\u4ec0\u4e48\u89c4\u5219\uff0c\u8f6c\u53d1\u7ed9\u54ea\u4e2a Cluster\u3002</p> <p>Health checking\uff1a\u5065\u5eb7\u68c0\u67e5\u4f1a\u4e0eSDS\u670d\u52a1\u53d1\u73b0\u914d\u5408\u4f7f\u7528\u3002\u4f46\u662f\uff0c\u5373\u4f7f\u4f7f\u7528\u5176\u4ed6\u670d\u52a1\u53d1\u73b0\u65b9\u5f0f\uff0c\u4e5f\u6709\u76f8\u5e94\u9700\u8981\u8fdb\u884c\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u7684\u60c5\u51b5\u3002\u8be6\u89c1 health checking\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#43-istio-sidecar-proxy","title":"4.3 Istio sidecar proxy \u914d\u7f6e","text":"<p>\u5047\u5982\u60a8\u4f7f\u7528 kubernetes-vagrant-centos-cluster \u90e8\u7f72\u4e86 Kubernetes \u96c6\u7fa4\u5e76\u5f00\u542f\u4e86 Istio Service Mesh\uff0c\u518d\u90e8\u7f72 bookinfo \u793a\u4f8b\uff0c\u90a3\u4e48\u5728 <code>default</code> \u547d\u540d\u7a7a\u95f4\u4e0b\u6709\u4e00\u4e2a\u540d\u5b57\u7c7b\u4f3c\u4e8e <code>ratings-v1-7c9949d479-dwkr4</code> \u7684 Pod\uff0c\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u8be5 Pod \u7684 Envoy sidecar \u7684\u5168\u91cf\u914d\u7f6e\uff1a</p> <pre><code>kubectl -n default exec ratings-v1-7c9949d479-dwkr4 -c istio-proxy curl http://localhost:15000/config_dump &gt; dump-rating.json\n</code></pre> <p>\u5c06 Envoy \u7684\u8fd0\u884c\u65f6\u914d\u7f6e dump \u51fa\u6765\u4e4b\u540e\u4f60\u5c06\u770b\u5230\u4e00\u4e2a\u957f 6000 \u4f59\u884c\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u5173\u4e8e\u8be5\u914d\u7f6e\u6587\u4ef6\u7684\u4ecb\u7ecd\u8bf7\u53c2\u8003 Envoy v2 API \u6982\u89c8\u3002</p> <p>\u4e0b\u56fe\u5c55\u793a\u7684\u662f Enovy \u7684\u914d\u7f6e\u3002</p> <p>\u56fe\u7247 - Envoy \u914d\u7f6e</p> <p>Istio \u4f1a\u5728\u4e3a Service Mesh \u4e2d\u7684\u6bcf\u4e2a Pod \u6ce8\u5165 Sidecar \u7684\u65f6\u5019\u540c\u65f6\u4e3a Envoy \u6ce8\u5165 Bootstrap \u914d\u7f6e\uff0c\u5176\u4f59\u7684\u914d\u7f6e\u662f\u901a\u8fc7 Pilot \u4e0b\u53d1\u7684\uff0c\u6ce8\u610f\u6574\u4e2a\u6570\u636e\u5e73\u9762\u5373 Service Mesh \u4e2d\u7684 Envoy \u7684\u52a8\u6001\u914d\u7f6e\u5e94\u8be5\u662f\u76f8\u540c\u7684\u3002\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u547d\u4ee4\u68c0\u67e5\u5176\u4ed6 sidecar \u7684 Envoy \u914d\u7f6e\u662f\u5426\u8ddf\u6700\u4e0a\u9762\u7684\u90a3\u4e2a\u76f8\u540c\u3002</p> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u68c0\u67e5 Service Mesh \u4e2d\u7684\u6240\u6709\u6709 Sidecar \u6ce8\u5165\u7684 Pod \u4e2d\u7684 proxy \u914d\u7f6e\u662f\u5426\u540c\u6b65\u3002</p> <pre><code>$ istioctl proxy-status\nPROXY                                                 CDS        LDS        EDS               RDS          PILOT                            VERSION\ndetails-v1-876bf485f-sx7df.default                    SYNCED     SYNCED     SYNCED (100%)     SYNCED       istio-pilot-5bf6d97f79-6lz4x     1.0.0\n...\n</code></pre> <p>istioctl \u8fd9\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\u5c31\u50cf kubectl \u4e00\u6837\u6709\u5f88\u591a\u795e\u5947\u7684\u9b54\u6cd5\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u9ad8\u6548\u7684\u7ba1\u7406 Istio \u548c debug\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#44-envoy-proxy","title":"4.4 Envoy proxy \u914d\u7f6e\u8be6\u89e3","text":"<p>Istio envoy sidecar proxy \u914d\u7f6e\u4e2d\u5305\u542b\u4ee5\u4e0b\u56db\u4e2a\u90e8\u5206\u3002</p> <ul> <li>bootstrap\uff1aEnvoy proxy \u542f\u52a8\u65f6\u5019\u52a0\u8f7d\u7684\u9759\u6001\u914d\u7f6e\u3002</li> <li>listeners\uff1a\u76d1\u542c\u5668\u914d\u7f6e\uff0c\u4f7f\u7528 LDS \u4e0b\u53d1\u3002</li> <li>clusters\uff1a\u96c6\u7fa4\u914d\u7f6e\uff0c\u9759\u6001\u914d\u7f6e\u4e2d\u5305\u62ec xds-grpc \u548c zipkin \u5730\u5740\uff0c\u52a8\u6001\u914d\u7f6e\u4f7f\u7528 CDS \u4e0b\u53d1\u3002</li> <li>routes\uff1a\u8def\u7531\u914d\u7f6e\uff0c\u9759\u6001\u914d\u7f6e\u4e2d\u5305\u62ec\u4e86\u672c\u5730\u76d1\u542c\u7684\u670d\u52a1\u7684\u96c6\u7fa4\u4fe1\u606f\uff0c\u5176\u4e2d\u5f15\u7528\u4e86 cluster\uff0c\u52a8\u6001\u914d\u7f6e\u4f7f\u7528 RDS \u4e0b\u53d1\u3002</li> </ul> <p>\u6bcf\u4e2a\u90e8\u5206\u4e2d\u90fd\u5305\u542b\u9759\u6001\u914d\u7f6e\u4e0e\u52a8\u6001\u914d\u7f6e\uff0c\u5176\u4e2d bootstrap \u914d\u7f6e\u53c8\u662f\u5728\u96c6\u7fa4\u542f\u52a8\u7684\u65f6\u5019\u901a\u8fc7 sidecar \u542f\u52a8\u53c2\u6570\u6ce8\u5165\u7684\uff0c\u914d\u7f6e\u6587\u4ef6\u5728 <code>/etc/istio/proxy/envoy-rev0.json</code>\u3002</p> <p>Enovy \u7684\u914d\u7f6e dump \u51fa\u6765\u540e\u7684\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p>\u56fe\u7247 - Envoy \u914d\u7f6e</p> <p>\u7531\u4e8e bootstrap \u4e2d\u7684\u914d\u7f6e\u662f\u6765\u81ea Envoy \u542f\u52a8\u65f6\u52a0\u8f7d\u7684\u9759\u6001\u6587\u4ef6\uff0c\u4e3b\u8981\u914d\u7f6e\u4e86\u8282\u70b9\u4fe1\u606f\u3001tracing\u3001admin \u548c\u7edf\u8ba1\u4fe1\u606f\u6536\u96c6\u7b49\u4fe1\u606f\uff0c\u8fd9\u4e0d\u662f\u672c\u6587\u7684\u91cd\u70b9\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u884c\u7814\u7a76\u3002</p> <p>\u56fe\u7247 - bootstrap \u914d\u7f6e</p> <p>\u4e0a\u56fe\u662f bootstrap \u7684\u914d\u7f6e\u4fe1\u606f\u3002</p> <p>Bootstrap \u662f Envoy \u4e2d\u914d\u7f6e\u7684\u6839\u672c\u6765\u6e90\uff0cBootstrap \u6d88\u606f\u4e2d\u6709\u4e00\u4e2a\u5173\u952e\u7684\u6982\u5ff5\uff0c\u5c31\u662f\u9759\u6001\u548c\u52a8\u6001\u8d44\u6e90\u7684\u4e4b\u95f4\u7684\u533a\u522b\u3002\u4f8b\u5982 Listener \u6216 Cluster \u8fd9\u4e9b\u8d44\u6e90\u65e2\u53ef\u4ee5\u4ece static_resources \u9759\u6001\u7684\u83b7\u5f97\u4e5f\u53ef\u4ee5\u4ece dynamic_resources \u4e2d\u914d\u7f6e\u7684 LDS \u6216 CDS \u4e4b\u7c7b\u7684 xDS \u670d\u52a1\u83b7\u53d6\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#listener","title":"Listener","text":"<p>Listener \u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u76d1\u542c\u5668\uff0c\u76d1\u542c IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u7136\u540e\u6839\u636e\u7b56\u7565\u8f6c\u53d1\u3002</p> <p>Listener \u7684\u7279\u70b9</p> <ul> <li>\u6bcf\u4e2a Envoy \u8fdb\u7a0b\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a Listener\uff0cEnvoy \u4e0e Listener \u4e4b\u95f4\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\u3002</li> <li>\u6bcf\u4e2a Listener \u4e2d\u53ef\u4ee5\u914d\u7f6e\u4e00\u6761 filter \u94fe\u8868\uff08filter_chains\uff09\uff0cEnvoy \u4f1a\u6839\u636e filter \u987a\u5e8f\u6267\u884c\u8fc7\u6ee4\u3002</li> <li>Listener \u53ef\u4ee5\u76d1\u542c\u4e0b\u6e38\u7684\u7aef\u53e3\uff0c\u4e5f\u53ef\u4ee5\u63a5\u6536\u6765\u81ea\u5176\u4ed6 listener \u7684\u6570\u636e\uff0c\u5f62\u6210\u94fe\u5f0f\u5904\u7406\u3002</li> <li>filter \u662f\u53ef\u6269\u5c55\u7684\u3002</li> <li>\u53ef\u4ee5\u9759\u6001\u914d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 LDS \u52a8\u6001\u914d\u7f6e\u3002</li> <li>\u76ee\u524d\u53ea\u80fd\u76d1\u542c TCP\uff0cUDP \u8fd8\u672a\u652f\u6301\u3002</li> </ul> <p>Listener \u7684\u6570\u636e\u7ed3\u6784</p> <p>Listener \u7684\u6570\u636e\u7ed3\u6784\u5982\u4e0b\uff0c\u9664\u4e86 <code>name</code>\u3001<code>address</code> \u548c <code>filter_chains</code> \u4e3a\u5fc5\u987b\u914d\u7f6e\u4e4b\u5916\uff0c\u5176\u4ed6\u90fd\u4e3a\u53ef\u9009\u7684\u3002</p> <pre><code>{\n  \"name\": \"...\",\n  \"address\": \"{...}\",\n  \"filter_chains\": [],\n  \"use_original_dst\": \"{...}\",\n  \"per_connection_buffer_limit_bytes\": \"{...}\",\n  \"metadata\": \"{...}\",\n  \"drain_type\": \"...\",\n  \"listener_filters\": [],\n  \"transparent\": \"{...}\",\n  \"freebind\": \"{...}\",\n  \"socket_options\": [],\n  \"tcp_fast_open_queue_length\": \"{...}\",\n  \"bugfix_reverse_write_filter_order\": \"{...}\"\n}\n</code></pre> <p>\u4e0b\u9762\u662f\u5173\u4e8e\u4e0a\u8ff0\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5e38\u7528\u914d\u7f6e\u89e3\u6790\u3002</p> <ul> <li> <p>name\uff1a\u8be5 listener \u7684 UUID\uff0c\u552f\u4e00\u9650\u5b9a\u540d\uff0c\u9ed8\u8ba460\u4e2a\u5b57\u7b26\uff0c\u4f8b\u5982 <code>10.254.74.159_15011</code>\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u53c2\u6570\u6307\u5b9a\u957f\u5ea6\u9650\u5236\u3002</p> </li> <li> <p>address\uff1a\u76d1\u542c\u7684\u903b\u8f91/\u7269\u7406\u5730\u5740\u548c\u7aef\u53e3\u53f7\uff0c\u4f8b\u5982</p> </li> </ul> <pre><code>\"address\": {\n       \"socket_address\": {\n        \"address\": \"10.254.74.159\",\n        \"port_value\": 15011\n       }\n}\n</code></pre> <ul> <li> <p>filter_chains\uff1a\u8fd9\u662f\u4e00\u4e2a\u5217\u8868\uff0cEnvoy \u4e2d\u5185\u7f6e\u4e86\u4e00\u4e9b\u901a\u7528\u7684 filter\uff0c\u6bcf\u79cd filter \u90fd\u6709\u7279\u5b9a\u7684\u6570\u636e\u7ed3\u6784\uff0cEnovy \u4f1a\u6839\u636e\u8be5\u914d\u7f6e\u987a\u5e8f\u6267\u884c filter\u3002Envoy \u4e2d\u5185\u7f6e\u7684 filter \u6709\uff1aenvoy.client_ssl_auth\u3001envoy.echo\u3001enovy.http_connection_manager\u3001envoy.mongo_proxy\u3001envoy.rate_limit\u3001enovy.redis_proxy\u3001envoy.tcp_proxy\u3001http_filters\u3001thrift_filters\u7b49\u3002\u8fd9\u4e9b filter \u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\u4e5f\u53ef\u4ee5\u7ec4\u5408\u4f7f\u7528\uff0c\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6269\u5c55\uff0c\u4f8b\u5982\u4f7f\u7528 Istio \u4e2d\u7684 EnvoyFilter \u914d\u7f6e\u3002</p> </li> <li> <p>use_original_dst\uff1a\u8fd9\u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u5982\u679c\u4f7f\u7528 iptables \u91cd\u5b9a\u5411\u8fde\u63a5\uff0c\u5219\u4ee3\u7406\u63a5\u6536\u7684\u7aef\u53e3\u53ef\u80fd\u4e0e\u539f\u59cb\u76ee\u7684\u5730\u5740\u7684\u7aef\u53e3\u4e0d\u4e00\u6837\u3002\u5f53\u6b64\u6807\u5fd7\u8bbe\u7f6e\u4e3a true \u65f6\uff0cListener \u5c06\u91cd\u5b9a\u5411\u7684\u8fde\u63a5\u5207\u6362\u5230\u4e0e\u539f\u59cb\u76ee\u7684\u5730\u5740\u5173\u8054\u7684 Listener\u3002\u5982\u679c\u6ca1\u6709\u4e0e\u539f\u59cb\u76ee\u7684\u5730\u5740\u5173\u8054\u7684 Listener\uff0c\u5219\u8fde\u63a5\u7531\u63a5\u6536\u5b83\u7684 Listener \u5904\u7406\u3002\u9ed8\u8ba4\u4e3a false\u3002\u6ce8\u610f\uff1a\u8be5\u53c2\u6570\u5c06\u88ab\u5e9f\u5f03\uff0c\u8bf7\u4f7f\u7528\u539f\u59cb\u76ee\u7684\u5730\u5740\u7684 Listener filter \u66ff\u4ee3\u3002\u8be5\u53c2\u6570\u7684\u4e3b\u8981\u7528\u9014\u662f\uff0cEnvoy \u901a\u8fc7\u76d1\u542c 15001 \u7aef\u53e3\u5c06\u5e94\u7528\u7684\u6d41\u91cf\u622a\u53d6\u540e\u518d\u7531\u5176\u4ed6 Listener \u5904\u7406\u800c\u4e0d\u662f\u76f4\u63a5\u8f6c\u53d1\u51fa\u53bb\uff0c\u8be6\u60c5\u89c1 Virtual Listener\u3002</p> </li> </ul> <p>\u5173\u4e8e Listener \u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 Envoy v2 API reference - listener\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#cluster","title":"Cluster","text":"<p>Cluster \u662f\u6307 Envoy \u8fde\u63a5\u7684\u4e00\u7ec4\u903b\u8f91\u76f8\u540c\u7684\u4e0a\u6e38\u4e3b\u673a\u3002Envoy \u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u6765\u53d1\u73b0 cluster \u7684\u6210\u5458\u3002\u53ef\u4ee5\u9009\u62e9\u901a\u8fc7\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u6765\u786e\u5b9a\u96c6\u7fa4\u6210\u5458\u7684\u5065\u5eb7\u72b6\u6001\u3002Envoy \u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u51b3\u5b9a\u5c06\u8bf7\u6c42\u8def\u7531\u5230 cluster \u7684\u54ea\u4e2a\u6210\u5458\u3002</p> <p>Cluster \u7684\u7279\u70b9</p> <ul> <li>\u4e00\u7ec4\u903b\u8f91\u4e0a\u76f8\u540c\u7684\u4e3b\u673a\u6784\u6210\u4e00\u4e2a cluster\u3002</li> <li>\u53ef\u4ee5\u5728 cluster \u4e2d\u5b9a\u4e49\u5404\u79cd\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u3002</li> <li>\u65b0\u52a0\u5165\u7684 cluster \u9700\u8981\u4e00\u4e2a\u70ed\u8eab\u7684\u8fc7\u7a0b\u624d\u53ef\u4ee5\u7ed9\u8def\u7531\u5f15\u7528\uff0c\u8be5\u8fc7\u7a0b\u662f\u539f\u5b50\u7684\uff0c\u5373\u5728 cluster \u70ed\u8eab\u4e4b\u524d\u5bf9\u4e8e Envoy \u53ca Service Mesh \u7684\u5176\u4f59\u90e8\u5206\u6765\u8bf4\u662f\u4e0d\u53ef\u89c1\u7684\u3002</li> <li>\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u65b9\u5f0f\u6765\u914d\u7f6e cluster\uff0c\u4f8b\u5982\u9759\u6001\u7c7b\u578b\u3001\u4e25\u683c\u9650\u5b9a DNS\u3001\u903b\u8f91 DNS\u3001EDS \u7b49\u3002</li> </ul> <p>Cluster \u7684\u6570\u636e\u7ed3\u6784</p> <p>Cluster \u7684\u6570\u636e\u7ed3\u6784\u5982\u4e0b\uff0c\u9664\u4e86 <code>name</code> \u5b57\u6bb5\uff0c\u5176\u4ed6\u90fd\u662f\u53ef\u9009\u7684\u3002</p> <pre><code>{\n  \"name\": \"...\",\n  \"alt_stat_name\": \"...\",\n  \"type\": \"...\",\n  \"eds_cluster_config\": \"{...}\",\n  \"connect_timeout\": \"{...}\",\n  \"per_connection_buffer_limit_bytes\": \"{...}\",\n  \"lb_policy\": \"...\",\n  \"hosts\": [],\n  \"load_assignment\": \"{...}\",\n  \"health_checks\": [],\n  \"max_requests_per_connection\": \"{...}\",\n  \"circuit_breakers\": \"{...}\",\n  \"tls_context\": \"{...}\",\n  \"common_http_protocol_options\": \"{...}\",\n  \"http_protocol_options\": \"{...}\",\n  \"http2_protocol_options\": \"{...}\",\n  \"extension_protocol_options\": \"{...}\",\n  \"dns_refresh_rate\": \"{...}\",\n  \"dns_lookup_family\": \"...\",\n  \"dns_resolvers\": [],\n  \"outlier_detection\": \"{...}\",\n  \"cleanup_interval\": \"{...}\",\n  \"upstream_bind_config\": \"{...}\",\n  \"lb_subset_config\": \"{...}\",\n  \"ring_hash_lb_config\": \"{...}\",\n  \"original_dst_lb_config\": \"{...}\",\n  \"least_request_lb_config\": \"{...}\",\n  \"common_lb_config\": \"{...}\",\n  \"transport_socket\": \"{...}\",\n  \"metadata\": \"{...}\",\n  \"protocol_selection\": \"...\",\n  \"upstream_connection_options\": \"{...}\",\n  \"close_connections_on_host_health_failure\": \"...\",\n  \"drain_connections_on_host_removal\": \"...\"\n}\n</code></pre> <p>\u4e0b\u9762\u662f\u5173\u4e8e\u4e0a\u8ff0\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5e38\u7528\u914d\u7f6e\u89e3\u6790\u3002</p> <ul> <li>name\uff1a\u5982\u679c\u4f60\u7559\u610f\u5230\u4f5c\u4e3a Sidecar \u542f\u52a8\u7684 Envoy \u7684\u53c2\u6570\u7684\u4f1a\u6ce8\u610f\u5230 <code>--max-obj-name-len 189</code>\uff0c\u8be5\u9009\u9879\u7528\u6765\u7528\u6765\u6307\u5b9a cluster \u7684\u540d\u5b57\uff0c\u4f8b\u5982 <code>inbound|9080||ratings.default.svc.cluster.local</code>\u3002\u8be5\u540d\u5b57\u5b57\u7b26\u4e32\u7531 <code>|</code> \u5206\u9694\u6210\u56db\u4e2a\u90e8\u5206\uff0c\u5206\u522b\u662f <code>inbound</code> \u6216 <code>outbound</code> \u4ee3\u8868\u5165\u5411\u6d41\u91cf\u6216\u51fa\u5411\u6d41\u91cf\u3001\u7aef\u53e3\u53f7\u3001subcluster \u540d\u79f0\u3001FQDN\uff0c\u5176\u4e2d subcluster \u540d\u79f0\u5c06\u5bf9\u5e94\u4e8e Istio <code>DestinationRule</code> \u4e2d\u914d\u7f6e\u7684 <code>subnet</code>\uff0c\u5982\u679c\u662f\u6309\u7167\u591a\u7248\u672c\u6309\u6bd4\u4f8b\u8def\u7531\u7684\u8bdd\uff0c\u8be5\u503c\u53ef\u4ee5\u662f\u7248\u672c\u53f7\u3002</li> <li>type\uff1a\u5373\u670d\u52a1\u53d1\u73b0\u7c7b\u578b\uff0c\u652f\u6301\u7684\u53c2\u6570\u6709 <code>STATIC</code>\uff08\u7f3a\u7701\u503c\uff09\u3001<code>STRICT_DNS</code>\u3001<code>LOGICAL_DNS</code>\u3001<code>EDS</code>\u3001<code>ORIGINAL_DST</code>\u3002</li> <li>hosts\uff1a\u8fd9\u662f\u4e2a\u5217\u8868\uff0c\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u53ea\u6709\u4f7f\u7528\u4e86<code>STATIC</code>\u3001<code>STRICT_DNS</code>\u3001<code>LOGICAL_DNS</code> \u670d\u52a1\u53d1\u73b0\u7c7b\u578b\u65f6\u624d\u9700\u8981\u914d\u7f6e\u3002</li> <li>eds_cluster_config\uff1a\u5982\u679c\u4f7f\u7528 <code>EDS</code> \u505a\u670d\u52a1\u53d1\u73b0\uff0c\u5219\u9700\u8981\u914d\u7f6e\u8be5\u9879\u76ee\uff0c\u5176\u4e2d\u5305\u62ec\u7684\u914d\u7f6e\u6709 <code>service_name</code> \u548c <code>ads</code>\u3002</li> </ul> <p>\u5173\u4e8e Cluster \u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 Envoy v2 API reference - cluster\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#route","title":"Route","text":"<p>\u6211\u4eec\u5728\u8fd9\u91cc\u6240\u8bf4\u7684\u8def\u7531\u6307\u7684\u662f HTTP \u8def\u7531\uff0c\u8fd9\u4e5f\u4f7f\u5f97 Envoy \u53ef\u4ee5\u7528\u6765\u5904\u7406\u7f51\u683c\u8fb9\u7f18\u7684\u6d41\u91cf\u3002HTTP \u8def\u7531\u8f6c\u53d1\u662f\u901a\u8fc7\u8def\u7531\u8fc7\u6ee4\u5668\u5b9e\u73b0\u7684\u3002\u8be5\u8fc7\u6ee4\u5668\u7684\u4e3b\u8981\u804c\u80fd\u5c31\u662f\u6267\u884c\u8def\u7531\u8868\u4e2d\u7684\u6307\u4ee4\u3002\u9664\u4e86\u53ef\u4ee5\u505a\u91cd\u5b9a\u5411\u548c\u8f6c\u53d1\uff0c\u8def\u7531\u8fc7\u6ee4\u5668\u8fd8\u9700\u8981\u5904\u7406\u91cd\u8bd5\u3001\u7edf\u8ba1\u4e4b\u7c7b\u7684\u4efb\u52a1\u3002</p> <p>HTTP \u8def\u7531\u7684\u7279\u70b9</p> <ul> <li>\u524d\u7f00\u548c\u7cbe\u786e\u8def\u5f84\u5339\u914d\u89c4\u5219\u3002</li> <li>\u53ef\u8de8\u8d8a\u591a\u4e2a\u4e0a\u6e38\u96c6\u7fa4\u8fdb\u884c\u57fa\u4e8e\u6743\u91cd/\u767e\u5206\u6bd4\u7684\u8def\u7531\u3002</li> <li>\u57fa\u4e8e\u4f18\u5148\u7ea7\u7684\u8def\u7531\u3002</li> <li>\u57fa\u4e8e\u54c8\u5e0c\u7b56\u7565\u7684\u8def\u7531\u3002</li> </ul> <p>Route \u7684\u6570\u636e\u7ed3\u6784</p> <pre><code>{\n  \"name\": \"...\",\n  \"virtual_hosts\": [],\n  \"internal_only_headers\": [],\n  \"response_headers_to_add\": [],\n  \"response_headers_to_remove\": [],\n  \"request_headers_to_add\": [],\n  \"request_headers_to_remove\": [],\n  \"validate_clusters\": \"{...}\"\n}\n</code></pre> <p>\u4e0b\u9762\u662f\u5173\u4e8e\u4e0a\u8ff0\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5e38\u7528\u914d\u7f6e\u89e3\u6790\u3002</p> <ul> <li>name\uff1a\u8be5\u540d\u5b57\u8ddf <code>envoy.http_connection_manager</code> filter \u4e2d\u7684 <code>http_filters.rds.route_config_name</code> \u4e00\u81f4\uff0c\u5728 Istio Service Mesh \u4e2d\u4e3a Envoy \u4e0b\u53d1\u7684\u914d\u7f6e\u4e2d\u7684 Route \u662f\u4ee5\u76d1\u542c\u7684\u7aef\u53e3\u53f7\u4f5c\u4e3a\u540d\u5b57\uff0c\u800c\u540c\u4e00\u4e2a\u540d\u5b57\u4e0b\u9762\u7684 <code>virtual_hosts</code> \u53ef\u4ee5\u6709\u591a\u4e2a\u503c\uff08\u6570\u7ec4\u5f62\u5f0f\uff09\u3002</li> <li>virtual_hosts\uff1a\u56e0\u4e3a VirtualHosts \u662f Envoy \u4e2d\u5f15\u5165\u7684\u4e00\u4e2a\u91cd\u8981\u6982\u5ff5\uff0c\u6211\u4eec\u5728\u4e0b\u6587\u5c06\u8be6\u7ec6\u8bf4\u660e <code>virtual_hosts</code> \u7684\u6570\u636e\u7ed3\u6784\u3002</li> <li>validate_clusters\uff1a\u8fd9\u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u7528\u6765\u8bbe\u7f6e\u5f00\u542f\u4f7f\u7528 cluster manager \u6765\u68c0\u6d4b\u8def\u7531\u8868\u5f15\u7528\u7684 cluster \u662f\u5426\u6709\u6548\u3002\u5982\u679c\u662f\u8def\u7531\u8868\u662f\u901a\u8fc7 route_config \u9759\u6001\u914d\u7f6e\u7684\u5219\u8be5\u503c\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a true\uff0c\u5982\u679c\u662f\u4f7f\u7528 rds \u52a8\u6001\u914d\u7f6e\u7684\u8bdd\uff0c\u5219\u8be5\u503c\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a false\u3002</li> </ul> <p>\u5173\u4e8e Route \u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 Envoy v2 API reference - HTTP route configuration\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#routevirtualhost","title":"route.VirtualHost","text":"<p>VirtualHost \u5373\u4e0a\u6587\u4e2d Route \u914d\u7f6e\u4e2d\u7684 <code>virtual_hosts</code>\uff0cVirtualHost \u662f\u8def\u7531\u914d\u7f6e\u4e2d\u7684\u9876\u7ea7\u5143\u7d20\u3002\u6bcf\u4e2a\u865a\u62df\u4e3b\u673a\u90fd\u6709\u4e00\u4e2a\u903b\u8f91\u540d\u79f0\u4ee5\u53ca\u4e00\u7ec4\u6839\u636e\u4f20\u5165\u8bf7\u6c42\u7684 host header \u8def\u7531\u5230\u5b83\u7684\u57df\u3002\u8fd9\u5141\u8bb8\u5355\u4e2a Listener \u4e3a\u591a\u4e2a\u9876\u7ea7\u57df\u8def\u5f84\u6811\u63d0\u4f9b\u670d\u52a1\u3002\u57fa\u4e8e\u57df\u9009\u62e9\u4e86\u865a\u62df\u4e3b\u673a\u540e Envoy \u5c31\u4f1a\u5904\u7406\u8def\u7531\u4ee5\u67e5\u770b\u8981\u8def\u7531\u5230\u54ea\u4e2a\u4e0a\u6e38\u96c6\u7fa4\u6216\u662f\u5426\u6267\u884c\u91cd\u5b9a\u5411\u3002</p> <p>VirtualHost \u7684\u6570\u636e\u7ed3\u6784</p> <p>\u4e0b\u9762\u662f VirtualHost \u7684\u6570\u636e\u7ed3\u6784\uff0c\u9664\u4e86 <code>name</code> \u548c <code>domains</code> \u662f\u5fc5\u987b\u914d\u7f6e\u9879\u5916\uff0c\u5176\u4ed6\u7686\u4e3a\u53ef\u9009\u9879\u3002</p> <pre><code>{\n  \"name\": \"...\",\n  \"domains\": [],\n  \"routes\": [],\n  \"require_tls\": \"...\",\n  \"virtual_clusters\": [],\n  \"rate_limits\": [],\n  \"request_headers_to_add\": [],\n  \"request_headers_to_remove\": [],\n  \"response_headers_to_add\": [],\n  \"response_headers_to_remove\": [],\n  \"cors\": \"{...}\",\n  \"per_filter_config\": \"{...}\",\n  \"include_request_attempt_count\": \"...\"\n}\n</code></pre> <p>\u4e0b\u9762\u662f\u5173\u4e8e\u4e0a\u8ff0\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5e38\u7528\u914d\u7f6e\u89e3\u6790\u3002</p> <ul> <li>name\uff1a\u8be5 VirtualHost \u7684\u540d\u5b57\uff0c\u4e00\u822c\u662f FQDN \u52a0\u7aef\u53e3\uff0c\u5982 <code>details.default.svc.cluster.local:9080</code>\u3002</li> <li>domains\uff1a\u8fd9\u662f\u4e2a\u7528\u6765\u5339\u914d VirtualHost \u7684\u57df\u540d\uff08host/authority header\uff09\u5217\u8868\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26\uff0c\u4f46\u662f\u901a\u914d\u7b26\u4e0d\u80fd\u5339\u914d\u7a7a\u5b57\u7b26\uff0c\u9664\u4e86\u4ec5\u4f7f\u7528 <code>*</code> \u4f5c\u4e3a domains\uff0c\u6ce8\u610f\u5217\u8868\u4e2d\u7684\u503c\u4e0d\u80fd\u91cd\u590d\u548c\u5b58\u5728\u4ea4\u96c6\uff0c\u53ea\u8981\u6709\u4e00\u6761 domain \u88ab\u5339\u914d\u4e0a\u4e86\uff0c\u5c31\u4f1a\u6267\u884c\u8def\u7531\u3002Istio \u4f1a\u4e3a\u8be5\u503c\u914d\u7f6e\u6240\u6709\u5730\u5740\u89e3\u6790\u5f62\u5f0f\uff0c\u5305\u62ec IP \u5730\u5740\u3001FQDN \u548c\u77ed\u57df\u540d\u7b49\u3002</li> <li>routes\uff1a\u9488\u5bf9\u5165\u53e3\u6d41\u91cf\u7684\u6709\u5e8f\u8def\u7531\u5217\u8868\uff0c\u7b2c\u4e00\u4e2a\u5339\u914d\u4e0a\u7684\u8def\u7531\u5c06\u88ab\u6267\u884c\u3002\u6211\u4eec\u5728\u4e0b\u6587\u5c06\u8be6\u7ec6\u8bf4\u660e route \u7684\u6570\u636e\u7ed3\u6784\u3002</li> </ul> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u5b9e\u9645\u7684 VirtualHost \u7684\u4f8b\u5b50\uff0c\u8be5\u914d\u7f6e\u6765\u81ea Bookinfo \u5e94\u7528\u7684 details \u5e94\u7528\u7684 Sidecar \u670d\u52a1\u3002</p> <pre><code>{\n            \"name\": \"details.default.svc.cluster.local:9080\",\n            \"domains\": [\n                \"details.default.svc.cluster.local\",\n                \"details.default.svc.cluster.local:9080\",\n                \"details\",\n                \"details:9080\",\n                \"details.default.svc.cluster\",\n                \"details.default.svc.cluster:9080\",\n                \"details.default.svc\",\n                \"details.default.svc:9080\",\n                \"details.default\",\n                \"details.default:9080\",\n                \"10.254.4.113\",\n                \"10.254.4.113:9080\"\n            ],\n            \"routes\": [\n                {\n                    \"match\": {\n                        \"prefix\": \"/\"\n                    },\n                    \"route\": {\n                        \"cluster\": \"outbound|9080||details.default.svc.cluster.local\",\n                        \"timeout\": \"0s\",\n                        \"max_grpc_timeout\": \"0s\"\n                    },\n                    \"decorator\": {\n                        \"operation\": \"details.default.svc.cluster.local:9080/*\"\n                    },\n                    \"per_filter_config\": {\n                        \"mixer\": {\n                            \"forward_attributes\": {\n                                \"attributes\": {\n                                    \"destination.service.uid\": {\n                                        \"string_value\": \"istio://default/services/details\"\n                                    },\n                                    \"destination.service.host\": {\n                                        \"string_value\": \"details.default.svc.cluster.local\"\n                                    },\n                                    \"destination.service.namespace\": {\n                                        \"string_value\": \"default\"\n                                    },\n                                    \"destination.service.name\": {\n                                        \"string_value\": \"details\"\n                                    },\n                                    \"destination.service\": {\n                                        \"string_value\": \"details.default.svc.cluster.local\"\n                                    }\n                                }\n                            },\n                            \"mixer_attributes\": {\n                                \"attributes\": {\n                                    \"destination.service.host\": {\n                                        \"string_value\": \"details.default.svc.cluster.local\"\n                                    },\n                                    \"destination.service.uid\": {\n                                        \"string_value\": \"istio://default/services/details\"\n                                    },\n                                    \"destination.service.name\": {\n                                        \"string_value\": \"details\"\n                                    },\n                                    \"destination.service.namespace\": {\n                                        \"string_value\": \"default\"\n                                    },\n                                    \"destination.service\": {\n                                        \"string_value\": \"details.default.svc.cluster.local\"\n                                    }\n                                }\n                            },\n                            \"disable_check_calls\": true\n                        }\n                    }\n                }\n            ]\n        }\n</code></pre> <p>\u5173\u4e8e route.VirtualHost \u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 Envoy v2 API reference - route.VirtualHost\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#routeroute","title":"route.Route","text":"<p>\u8def\u7531\u65e2\u662f\u5982\u4f55\u5339\u914d\u8bf7\u6c42\u7684\u89c4\u8303\uff0c\u4e5f\u662f\u5bf9\u4e0b\u4e00\u6b65\u505a\u4ec0\u4e48\u7684\u6307\u793a\uff08\u4f8b\u5982\uff0credirect\u3001forward\u3001rewrite\u7b49\uff09\u3002</p> <p>route.Route \u7684\u6570\u636e\u7ed3\u6784</p> <p>\u4e0b\u9762\u662f\u662f route.Route \u7684\u6570\u636e\u7ed3\u6784\uff0c\u9664\u4e86 <code>match</code> \u4e4b\u5916\u5176\u4f59\u90fd\u662f\u53ef\u9009\u7684\u3002</p> <pre><code>{\n  \"match\": \"{...}\",\n  \"route\": \"{...}\",\n  \"redirect\": \"{...}\",\n  \"direct_response\": \"{...}\",\n  \"metadata\": \"{...}\",\n  \"decorator\": \"{...}\",\n  \"per_filter_config\": \"{...}\",\n  \"request_headers_to_add\": [],\n  \"request_headers_to_remove\": [],\n  \"response_headers_to_add\": [],\n  \"response_headers_to_remove\": []\n}\n</code></pre> <p>\u4e0b\u9762\u662f\u5173\u4e8e\u4e0a\u8ff0\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5e38\u7528\u914d\u7f6e\u89e3\u6790\u3002</p> <ul> <li>match\uff1a\u8def\u7531\u5339\u914d\u53c2\u6570\u3002\u4f8b\u5982 URL prefix\uff08\u524d\u7f00\uff09\u3001path\uff08URL \u7684\u5b8c\u6574\u8def\u5f84\uff09\u3001regex\uff08\u89c4\u5219\u8868\u8fbe\u5f0f\uff09\u7b49\u3002</li> <li>route\uff1a\u8fd9\u91cc\u9762\u914d\u7f6e\u8def\u7531\u7684\u884c\u4e3a\uff0c\u53ef\u4ee5\u662f route\u3001redirect \u548c direct_response\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u9762\u6ca1\u6709\u4e13\u95e8\u7684\u4e00\u4e2a\u914d\u7f6e\u9879\u7528\u6765\u914d\u7f6e\u4ee5\u4e0a\u4e09\u79cd\u884c\u4e3a\uff0c\u800c\u662f\u6839\u636e\u5b9e\u9645\u586b\u5145\u7684\u914d\u7f6e\u9879\u6765\u786e\u5b9a\u7684\u3002\u4f8b\u5982\u5728\u6b64\u5904\u6dfb\u52a0 <code>cluster</code> \u914d\u7f6e\u5219\u6697\u793a\u8def\u7531\u52a8\u4f5c\u4e3a\u201droute\u201c\uff0c\u8868\u793a\u5c06\u6d41\u91cf\u8def\u7531\u5230\u8be5 cluster\u3002\u8be6\u60c5\u8bf7\u53c2\u8003 route.RouteAction\u3002</li> <li>decorator\uff1a\u88ab\u5339\u914d\u7684\u8def\u7531\u7684\u4fee\u9970\u7b26\uff0c\u8868\u793a\u88ab\u5339\u914d\u7684\u865a\u62df\u4e3b\u673a\u548c URL\u3002\u8be5\u914d\u7f6e\u91cc\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u5fc5\u987b\u914d\u7f6e\u7684\u9879 <code>operation</code>\uff0c\u4f8b\u5982 <code>details.default.svc.cluster.local:9080/*</code>\u3002</li> <li>per_filter_config\uff1a\u8fd9\u662f\u4e00\u4e2a map \u7c7b\u578b\uff0c<code>per_filter_config</code> \u5b57\u6bb5\u53ef\u7528\u4e8e\u4e3a filter \u63d0\u4f9b\u7279\u5b9a\u8def\u7531\u7684\u914d\u7f6e\u3002Map \u7684 key \u5e94\u4e0e filleter \u540d\u79f0\u5339\u914d\uff0c\u4f8b\u5982\u7528\u4e8e HTTP buffer filter \u7684 <code>envoy.buffer</code>\u3002\u8be5\u5b57\u6bb5\u662f\u7279\u5b9a\u4e8e filter \u7684\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003 HTTP filter\u3002</li> </ul> <p>\u5173\u4e8e route.Route \u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 Envoy v2 API reference - route.Route\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#45-envoy-api","title":"4.5 Envoy API","text":"<p>Envoy \u63d0\u4f9b\u4e86\u5982\u4e0b\u7684 API\uff1a</p> <ul> <li>CDS\uff08Cluster Discovery Service\uff09\uff1a\u96c6\u7fa4\u53d1\u73b0\u670d\u52a1</li> <li>EDS\uff08Endpoint Discovery Service\uff09\uff1a\u7aef\u70b9\u53d1\u73b0\u670d\u52a1</li> <li>HDS\uff08Health Discovery Service\uff09\uff1a\u5065\u5eb7\u53d1\u73b0\u670d\u52a1</li> <li>LDS\uff08Listener Discovery Service\uff09\uff1a\u76d1\u542c\u5668\u53d1\u73b0\u670d\u52a1</li> <li>MS\uff08Metric Service\uff09\uff1a\u5c06 metric \u63a8\u9001\u5230\u8fdc\u7aef\u670d\u52a1\u5668</li> <li>RLS\uff08Rate Limit Service\uff09\uff1a\u901f\u7387\u9650\u5236\u670d\u52a1</li> <li>RDS\uff08Route Discovery Service\uff09\uff1a\u8def\u7531\u53d1\u73b0\u670d\u52a1</li> <li>SDS\uff08Secret Discovery Service\uff09\uff1a\u79d8\u94a5\u53d1\u73b0\u670d\u52a1</li> </ul> <p>\u6240\u6709\u540d\u79f0\u4ee5 DS \u7ed3\u5c3e\u7684\u670d\u52a1\u7edf\u79f0\u4e3a xDS\u3002</p> <p>\u672c\u4e66\u4e2d\u4ec5\u8ba8\u8bba v2 \u7248\u672c\u7684 API\uff0c\u56e0\u4e3a Envoy \u4ecd\u5728\u4e0d\u65ad\u5f00\u53d1\u548c\u5b8c\u5584\u4e2d\uff0c\u968f\u7740\u7248\u672c\u8fed\u4ee3\u4e5f\u6709\u53ef\u80fd\u65b0\u589e\u4e00\u4e9b API\uff0c\u672c\u7ae0\u7684\u91cd\u70b9\u5728\u4e8e xDS \u534f\u8bae\uff0c\u5173\u4e8e Envoy \u7684 API \u7684\u66f4\u591a\u4fe1\u606f\u8bf7\u53c2\u8003 Envoy v2 APIs for developers\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#451-envoy-xds","title":"4.5.1 Envoy xDS \u534f\u8bae","text":"<p>Envoy xDS \u4e3a Istio \u63a7\u5236\u5e73\u9762\u4e0e\u6570\u636e\u5e73\u9762\u901a\u4fe1\u7684\u57fa\u672c\u534f\u8bae\uff0c\u53ea\u8981\u4ee3\u7406\u652f\u6301\u8be5\u534f\u8bae\u8868\u8fbe\u5f62\u5f0f\u5c31\u53ef\u4ee5\u521b\u5efa\u81ea\u5df1\u7684 Sidecar \u6765\u66ff\u6362 Envoy\u3002\u8fd9\u4e00\u7ae0\u4e2d\u5c06\u5e26\u5927\u5bb6\u4e86\u89e3 Envoy xDS\u3002</p> <p>Envoy \u662f Istio Service Mesh \u4e2d\u9ed8\u8ba4\u7684 Sidecar\uff0cIstio \u5728 Enovy \u7684\u57fa\u7840\u4e0a\u6309\u7167 Envoy \u7684 xDS \u534f\u8bae\u6269\u5c55\u4e86\u5176\u63a7\u5236\u5e73\u9762\uff0c\u5728\u8bb2\u5230 Envoy xDS \u534f\u8bae\u4e4b\u524d\u8fd8\u9700\u8981\u6211\u4eec\u5148\u719f\u6089\u4e0b Envoy \u7684\u57fa\u672c\u672f\u8bed\u3002\u4e0b\u9762\u5217\u4e3e\u4e86 Envoy \u91cc\u7684\u57fa\u672c\u672f\u8bed\u53ca\u5176\u6570\u636e\u7ed3\u6784\u89e3\u6790\uff0c\u5173\u4e8e Envoy \u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 Envoy \u5b98\u65b9\u6587\u6863\uff0c\u81f3\u4e8e Envoy \u5728 Service Mesh\uff08\u4e0d\u4ec5\u9650\u4e8e Istio\uff09 \u4e2d\u662f\u5982\u4f55\u4f5c\u4e3a\u8f6c\u53d1\u4ee3\u7406\u5de5\u4f5c\u7684\u8bf7\u53c2\u8003\u7f51\u6613\u4e91\u5218\u8d85\u7684\u8fd9\u7bc7\u6df1\u5165\u89e3\u8bfb Service Mesh \u80cc\u540e\u7684\u6280\u672f\u7ec6\u8282 \u4ee5\u53ca\u7406\u89e3 Istio Service Mesh \u4e2d Envoy \u4ee3\u7406 Sidecar \u6ce8\u5165\u53ca\u6d41\u91cf\u52ab\u6301\uff0c\u672c\u6587\u5f15\u7528\u5176\u4e2d\u7684\u4e00\u4e9b\u89c2\u70b9\uff0c\u8be6\u7ec6\u5185\u5bb9\u4e0d\u518d\u8d58\u8ff0\u3002</p> <p>\u56fe\u7247 - Envoy proxy \u67b6\u6784\u56fe</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#452-xds","title":"4.5.2 \u5173\u4e8e xDS \u7684\u7248\u672c","text":"<p>\u6709\u4e00\u70b9\u9700\u8981\u5927\u5bb6\u6ce8\u610f\uff0c\u5c31\u662f Envoy \u7684 API \u6709 v1 \u548c v2 \u4e24\u4e2a\u7248\u672c\uff0c\u4ece Envoy 1.5.0 \u8d77 v2 API \u5c31\u5df2\u7ecf\u751f\u4ea7\u5c31\u7eea\u4e86\uff0c\u4e3a\u4e86\u80fd\u591f\u8ba9\u7528\u6237\u987a\u5229\u7684\u5411 v2 \u7248\u672c\u7684 API \u8fc7\u5ea6\uff0cEnvoy \u542f\u52a8\u7684\u65f6\u5019\u8bbe\u7f6e\u4e86\u4e00\u4e2a <code>--v2-config-only</code> \u7684\u6807\u5fd7\uff0cEnovy \u4e0d\u540c\u7248\u672c\u5bf9 v1/v2 API \u7684\u652f\u6301\u8be6\u60c5\u8bf7\u53c2\u8003 Envoy v1 \u914d\u7f6e\u5e9f\u5f03\u65f6\u95f4\u8868\u3002</p> <p>Envoy \u7684\u4f5c\u8005 Matt Klein \u5728 Service Mesh \u4e2d\u7684\u901a\u7528\u6570\u636e\u5e73\u9762 API \u8bbe\u8ba1\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u8bf4\u660e\u4e86 Envoy API v1 \u7684\u5386\u53f2\u53ca\u5176\u7f3a\u70b9\uff0c\u8fd8\u6709 v2 \u7684\u5f15\u5165\u3002v2 API \u662f v1 \u7684\u6f14\u8fdb\uff0c\u800c\u4e0d\u662f\u9769\u547d\uff0c\u5b83\u662f v1 \u529f\u80fd\u7684\u8d85\u96c6\u3002</p> <p>\u5728 Istio 1.0 \u53ca\u4ee5\u4e0a\u7248\u672c\u4e2d\u4f7f\u7528\u7684\u662f Envoy 1.8.0-dev \u7248\u672c\uff0c\u5176\u652f\u6301 v2 \u7684 API\uff0c\u540c\u65f6\u5728 Envoy \u4f5c\u4e3a Sidecar proxy \u542f\u52a8\u7684\u4f7f\u7528\u4f7f\u7528\u4e86\u4f8b\u5982\u4e0b\u9762\u7684\u547d\u4ee4\uff1a</p> <pre><code>$ /usr/local/bin/envoy -c /etc/istio/proxy/envoy-rev0.json --restart-epoch 0 --drain-time-s 45 --parent-shutdown-time-s 60 --service-cluster ratings --service-node sidecar~172.33.14.2~ratings-v1-8558d4458d-ld8x9.default~default.svc.cluster.local --max-obj-name-len 189 --allow-unknown-fields -l warn --v2-config-only\n</code></pre> <p>\u4e0a\u9762\u662f\u90fd Bookinfo \u793a\u4f8b\u4e2d\u7684 rating pod \u4e2d\u7684 sidecar \u542f\u52a8\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u5230\u5176\u4e2d\u6307\u5b9a\u4e86 <code>--v2-config-only</code>\uff0c\u8868\u660e Istio 1.0+ \u53ea\u652f\u6301 xDS v2 \u7684 API\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#453-rest-json-gprc-api","title":"4.5.3 REST-JSON &amp; gPRC API","text":"<p>\u5355\u4e2a\u7684\u57fa\u672c xDS \u8ba2\u9605\u670d\u52a1\uff0c\u5982 CDS\u3001EDS\u3001LDS\u3001RDS\u3001SDS \u540c\u65f6\u652f\u6301 REST-JSON \u548c gRPC API \u914d\u7f6e\u3002\u9ad8\u7ea7 API\uff0c\u5982 HDS\u3001ADS \u548c EDS \u591a\u7ef4 LB \u4ec5\u652f\u6301 gRPC\u3002\u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u5c06\u590d\u6742\u7684\u53cc\u5411\u6d41\u8bed\u4e49\u6620\u5c04\u5230 REST\u3002\u8be6\u89c1 Envoy v2 APIs for developers\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#46-xds","title":"4.6 xDS \u534f\u8bae\u89e3\u6790","text":"<p>\u672c\u6587\u8bd1\u81ea xDS REST and gRPC protocol\uff0c\u8bd1\u8005\uff1a\u72c4\u536b\u534e\uff0c\u5ba1\u6821\uff1a\u5b8b\u51c0\u8d85</p> <p>Envoy \u901a\u8fc7\u67e5\u8be2\u6587\u4ef6\u6216\u7ba1\u7406\u670d\u52a1\u5668\u6765\u52a8\u6001\u53d1\u73b0\u8d44\u6e90\u3002\u6982\u62ec\u5730\u8bb2\uff0c\u5bf9\u5e94\u7684\u53d1\u73b0\u670d\u52a1\u53ca\u5176\u76f8\u5e94\u7684 API \u88ab\u79f0\u4f5c xDS\u3002Envoy \u901a\u8fc7\u8ba2\u9605\uff08subscription\uff09\u65b9\u5f0f\u6765\u83b7\u53d6\u8d44\u6e90\uff0c\u5982\u76d1\u63a7\u6307\u5b9a\u8def\u5f84\u4e0b\u7684\u6587\u4ef6\u3001\u542f\u52a8 gRPC \u6d41\u6216\u8f6e\u8be2 REST-JSON URL\u3002\u540e\u4e24\u79cd\u65b9\u5f0f\u4f1a\u53d1\u9001 <code>DiscoveryRequest</code> \u8bf7\u6c42\u6d88\u606f\uff0c\u53d1\u73b0\u7684\u5bf9\u5e94\u8d44\u6e90\u5219\u5305\u542b\u5728\u54cd\u5e94\u6d88\u606f <code>DiscoveryResponse</code> \u4e2d\u3002\u4e0b\u9762\uff0c\u6211\u4eec\u5c06\u5177\u4f53\u8ba8\u8bba\u6bcf\u79cd\u8ba2\u9605\u7c7b\u578b\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#461","title":"4.6.1 \u6587\u4ef6\u8ba2\u9605","text":"<p>\u53d1\u73b0\u52a8\u6001\u8d44\u6e90\u7684\u6700\u7b80\u5355\u65b9\u5f0f\u5c31\u662f\u5c06\u5176\u4fdd\u5b58\u4e8e\u6587\u4ef6\uff0c\u5e76\u5c06\u8def\u5f84\u914d\u7f6e\u5728 ConfigSource \u4e2d\u7684 <code>path</code> \u53c2\u6570\u4e2d\u3002Envoy \u4f7f\u7528 <code>inotify</code>\uff08Mac OS X \u4e0a\u4e3a <code>kqueue</code>\uff09\u6765\u76d1\u63a7\u6587\u4ef6\u7684\u53d8\u5316\uff0c\u5728\u6587\u4ef6\u88ab\u66f4\u65b0\u65f6\uff0cEnvoy \u8bfb\u53d6\u4fdd\u5b58\u7684 <code>DiscoveryResponse</code> \u6570\u636e\u8fdb\u884c\u89e3\u6790\uff0c\u6570\u636e\u683c\u5f0f\u53ef\u4ee5\u4e3a\u4e8c\u8fdb\u5236 protobuf\u3001JSON\u3001YAML \u548c\u534f\u8bae\u6587\u672c\u7b49\u3002</p> <p>\u8bd1\u8005\u6ce8\uff1acore.ConfigSource \u914d\u7f6e\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>{\n  \"path\": \"...\",\n  \"api_config_source\": \"{...}\",\n  \"ads\": \"{...}\"\n}\n</code></pre> <p>\u6587\u4ef6\u8ba2\u9605\u65b9\u5f0f\u53ef\u63d0\u4f9b\u7edf\u8ba1\u6570\u636e\u548c\u65e5\u5fd7\u4fe1\u606f\uff0c\u4f46\u662f\u7f3a\u5c11 ACK/NACK \u66f4\u65b0\u7684\u673a\u5236\u3002\u5982\u679c\u66f4\u65b0\u7684\u914d\u7f6e\u88ab\u62d2\u7edd\uff0cxDS API \u5219\u7ee7\u7eed\u4f7f\u7528\u6700\u540e\u4e00\u4e2a\u7684\u6709\u6548\u914d\u7f6e\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#462-grpc","title":"4.6.2 gRPC \u6d41\u5f0f\u8ba2\u9605","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4621","title":"4.6.2.1 \u5355\u8d44\u6e90\u7c7b\u578b\u53d1\u73b0","text":"<p>\u6bcf\u4e2a xDS API \u53ef\u4ee5\u5355\u72ec\u914d\u7f6e <code>ApiConfigSource</code>\uff0c\u6307\u5411\u5bf9\u5e94\u7684\u4e0a\u6e38\u7ba1\u7406\u670d\u52a1\u5668\u7684\u96c6\u7fa4\u5730\u5740\u3002\u6bcf\u4e2a xDS \u8d44\u6e90\u7c7b\u578b\u4f1a\u542f\u52a8\u4e00\u4e2a\u72ec\u7acb\u7684\u53cc\u5411 gRPC \u6d41\uff0c\u53ef\u80fd\u5bf9\u5e94\u4e0d\u540c\u7684\u7ba1\u7406\u670d\u52a1\u5668\u3002API \u4ea4\u4ed8\u65b9\u5f0f\u91c7\u7528\u6700\u7ec8\u4e00\u81f4\u6027\u3002\u53ef\u4ee5\u53c2\u8003\u540e\u7eed\u805a\u5408\u670d\u52a1\u53d1\u73b0\uff08ADS\uff09 \u7ae0\u8282\u6765\u4e86\u89e3\u5fc5\u8981\u7684\u663e\u5f0f\u63a7\u5236\u5e8f\u5217\u3002</p> <p>\u8bd1\u8005\u6ce8\uff1acore.ApiConfigSource \u914d\u7f6e\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>{\n  \"api_type\": \"...\",\n  \"cluster_names\": [],\n  \"grpc_services\": [],\n  \"refresh_delay\": \"{...}\",\n  \"request_timeout\": \"{...}\"\n}\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#46211-url","title":"4.6.2.1.1 \u7c7b\u578b URL","text":"<p>\u6bcf\u4e2a xDS API \u90fd\u4e0e\u7ed9\u5b9a\u7684\u8d44\u6e90\u7684\u7c7b\u578b\u5b58\u5728 1:1 \u5bf9\u5e94\u3002\u5173\u7cfb\u5982\u4e0b\uff1a</p> <ul> <li>LDS\uff1a <code>envoy.api.v2.Listener</code></li> <li>RDS\uff1a <code>envoy.api.v2.RouteConfiguration</code></li> <li>CDS\uff1a <code>envoy.api.v2.Cluster</code></li> <li>EDS\uff1a <code>envoy.api.v2.ClusterLoadAssignment</code></li> <li>SDS\uff1a<code>envoy.api.v2.Auth.Secret</code></li> </ul> <p>\u7c7b\u578b URL \u7684\u6982\u5ff5\u5982\u4e0b\u6240\u793a\uff0c\u5176\u91c7\u7528 <code>type.googleapis.com/&lt;resource type&gt;</code> \u7684\u5f62\u5f0f\uff0c\u4f8b\u5982 CDS \u5bf9\u5e94\u4e8e<code>type.googleapis.com/envoy.api.v2.Cluster</code>\u3002\u5728 Envoy \u7684\u8bf7\u6c42\u548c\u7ba1\u7406\u670d\u52a1\u5668\u7684\u54cd\u5e94\u4e2d\uff0c\u90fd\u5305\u62ec\u4e86\u8d44\u6e90\u7c7b\u578b URL\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#46212-acknack","title":"4.6.2.1.2 ACK/NACK \u548c\u7248\u672c","text":"<p>\u6bcf\u4e2a Envoy \u6d41\u4ee5 <code>DiscoveryRequest</code> \u5f00\u59cb\uff0c\u5305\u62ec\u4e86\u5217\u8868\u8ba2\u9605\u7684\u8d44\u6e90\u3001\u8ba2\u9605\u8d44\u6e90\u5bf9\u5e94\u7684\u7c7b\u578b URL\u3001\u8282\u70b9\u6807\u8bc6\u7b26\u548c\u7a7a\u7684 <code>version_info</code>\u3002EDS \u8bf7\u6c42\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>version_info:\nnode: { id: envoy }\nresource_names:\n- foo\n- bar\ntype_url: type.googleapis.com/envoy.api.v2.ClusterLoadAssignment\nresponse_nonce:\n</code></pre> <p>\u7ba1\u7406\u670d\u52a1\u5668\u53ef\u7acb\u523b\u6216\u7b49\u5f85\u8d44\u6e90\u5c31\u7eea\u65f6\u53d1\u9001 <code>DiscoveryResponse</code>\u4f5c\u4e3a\u54cd\u5e94\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>version_info: X\nresources:\n- foo ClusterLoadAssignment proto encoding\n- bar ClusterLoadAssignment proto encoding\ntype_url: type.googleapis.com/envoy.api.v2.ClusterLoadAssignment\nnonce: A\n</code></pre> <p>Envoy \u5728\u5904\u7406 <code>DiscoveryResponse</code> \u54cd\u5e94\u540e\uff0c\u5c06\u901a\u8fc7\u6d41\u53d1\u9001\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\uff0c\u8bf7\u6c42\u5305\u542b\u5e94\u7528\u6210\u529f\u7684\u6700\u540e\u4e00\u4e2a\u7248\u672c\u53f7\u548c\u7ba1\u7406\u670d\u52a1\u5668\u63d0\u4f9b\u7684 <code>nonce</code>\u3002\u5982\u679c\u672c\u6b21\u66f4\u65b0\u5df2\u6210\u529f\u5e94\u7528\uff0c\u5219 <code>version_info</code> \u7684\u503c\u8bbe\u7f6e\u4e3a X\uff0c\u5982\u4e0b\u5e8f\u5217\u56fe\u6240\u793a\uff1a</p> <p>\u56fe\u7247 - ACK \u540e\u7684\u7248\u672c\u66f4\u65b0</p> <p>\u5728\u6b64\u5e8f\u5217\u56fe\u53ca\u540e\u7eed\u4e2d\uff0c\u5c06\u7edf\u4e00\u4f7f\u7528\u4ee5\u4e0b\u7f29\u5199\u683c\u5f0f\uff1a</p> <ul> <li><code>DiscoveryRequest</code>\uff1a (V=<code>version_info</code>\uff0cR=<code>resource_names</code>\uff0cN=<code>response_nonce</code>\uff0cT=<code>type_url</code>)</li> <li><code>DiscoveryResponse</code>\uff1a (V=<code>version_info</code>\uff0cR=<code>resources</code>\uff0cN=<code>nonce</code>\uff0cT=<code>type_url</code>)</li> </ul> <p>\u8bd1\u8005\u6ce8\uff1a\u5728\u4fe1\u606f\u5b89\u5168\u4e2d\uff0c**Nonce**\u662f\u4e00\u4e2a\u5728\u52a0\u5bc6\u901a\u4fe1\u53ea\u80fd\u4f7f\u7528\u4e00\u6b21\u7684\u6570\u5b57\u3002\u5728\u8ba4\u8bc1\u534f\u8bae\u4e2d\uff0c\u5b83\u5f80\u5f80\u662f\u4e00\u4e2a\u968f\u673a\u6216\u4f2a\u968f\u673a\u6570\uff0c\u4ee5\u907f\u514d\u91cd\u653e\u653b\u51fb\u3002Nonce\u4e5f\u7528\u4e8e\u6d41\u5bc6\u7801\u4ee5\u786e\u4fdd\u5b89\u5168\u3002\u5982\u679c\u9700\u8981\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u94a5\u52a0\u5bc6\u4e00\u4e2a\u4ee5\u4e0a\u7684\u6d88\u606f\uff0c\u5c31\u9700\u8981Nonce\u6765\u786e\u4fdd\u4e0d\u540c\u7684\u6d88\u606f\u4e0e\u8be5\u5bc6\u94a5\u52a0\u5bc6\u7684\u5bc6\u94a5\u6d41\u4e0d\u540c\u3002\uff08\u5f15\u7528\u81ea\u7ef4\u57fa\u767e\u79d1\uff09\u5728\u672c\u6587\u4e2d<code>nonce</code>\u662f\u6bcf\u6b21\u66f4\u65b0\u7684\u6570\u636e\u5305\u7684\u552f\u4e00\u6807\u8bc6\u3002</p> <p>\u7248\u672c\u4e3a Envoy \u548c\u7ba1\u7406\u670d\u52a1\u5668\u63d0\u4f9b\u4e86\u5171\u4eab\u5f53\u524d\u5e94\u7528\u914d\u7f6e\u7684\u6982\u5ff5\u548c\u901a\u8fc7 ACK/NACK \u6765\u8fdb\u884c\u914d\u7f6e\u66f4\u65b0\u7684\u673a\u5236\u3002\u5982\u679c Envoy \u62d2\u7edd\u914d\u7f6e\u66f4\u65b0 X\uff0c\u5219\u56de\u590d <code>error_detail</code> \u53ca\u524d\u4e00\u4e2a\u7684\u7248\u672c\u53f7\uff0c\u5728\u5f53\u524d\u60c5\u51b5\u4e0b\u4e3a\u7a7a\u7684\u521d\u59cb\u7248\u672c\u53f7\uff0c<code>error_detail</code> \u5305\u542b\u4e86\u6709\u5173\u9519\u8bef\u7684\u66f4\u52a0\u8be6\u7ec6\u7684\u4fe1\u606f\uff1a</p> <p>\u56fe\u7247 - NACK \u65e0\u7248\u672c\u66f4\u65b0</p> <p>\u540e\u7eed\uff0cAPI \u66f4\u65b0\u53ef\u80fd\u4f1a\u5728\u65b0\u7248\u672c Y \u4e0a\u6210\u529f\uff1a</p> <p>\u56fe\u7247 - ACK \u7d27\u63a5\u7740 NACK</p> <p>\u6bcf\u4e2a\u6d41\u90fd\u6709\u81ea\u5df1\u7684\u7248\u672c\u6982\u5ff5\uff0c\u4f46\u4e0d\u5b58\u5728\u8de8\u8d44\u6e90\u7c7b\u578b\u7684\u5171\u4eab\u7248\u672c\u3002\u5728\u4e0d\u4f7f\u7528 ADS \u7684\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u8d44\u6e90\u7c7b\u578b\u53ef\u80fd\u5177\u6709\u4e0d\u540c\u7684\u7248\u672c\uff0c\u56e0\u4e3a Envoy API \u5141\u8bb8\u6307\u5411\u4e0d\u540c\u7684 EDS/RDS \u8d44\u6e90\u914d\u7f6e\u5e76\u5bf9\u5e94\u4e0d\u540c\u7684 <code>ConfigSources</code>\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#46213","title":"4.6.2.1.3 \u4f55\u65f6\u53d1\u9001\u66f4\u65b0","text":"<p>\u7ba1\u7406\u670d\u52a1\u5668\u5e94\u8be5\u53ea\u5411 Envoy \u5ba2\u6237\u7aef\u53d1\u9001\u4e0a\u6b21 <code>DiscoveryResponse</code> \u540e\u66f4\u65b0\u8fc7\u7684\u8d44\u6e90\u3002Envoy \u5219\u4f1a\u6839\u636e\u63a5\u53d7\u6216\u62d2\u7edd <code>DiscoveryResponse</code> \u7684\u60c5\u51b5\uff0c\u7acb\u5373\u56de\u590d\u5305\u542b ACK/NACK \u7684 <code>DiscoveryRequest</code> \u8bf7\u6c42\u3002\u5982\u679c\u7ba1\u7406\u670d\u52a1\u5668\u6bcf\u6b21\u53d1\u9001\u76f8\u540c\u7684\u8d44\u6e90\u96c6\u7ed3\u679c\uff0c\u800c\u4e0d\u662f\u6839\u636e\u5176\u66f4\u65b0\u60c5\u51b5\uff0c\u5219\u4f1a\u5bfc\u81f4 Envoy \u548c\u7ba1\u7406\u670d\u52a1\u5668\u901a\u8baf\u6548\u7387\u5927\u6253\u6298\u6263\u3002</p> <p>\u5728\u540c\u4e00\u4e2a\u6d41\u4e2d\uff0c\u65b0\u7684 <code>DiscoveryRequests</code> \u5c06\u53d6\u4ee3\u6b64\u524d\u5177\u6709\u76f8\u540c\u7684\u8d44\u6e90\u7c7b\u578b <code>DiscoveryRequest</code> \u8bf7\u6c42\u3002\u8fd9\u610f\u5473\u7740\u7ba1\u7406\u670d\u52a1\u5668\u53ea\u9700\u8981\u54cd\u5e94\u7ed9\u5b9a\u8d44\u6e90\u7c7b\u578b\u6700\u65b0\u7684 DiscoveryRequest \u8bf7\u6c42\u5373\u53ef\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#46214","title":"4.6.2.1.4 \u8d44\u6e90\u63d0\u793a","text":"<p><code>DiscoveryRequest</code> \u4e2d\u7684 <code>resource_names</code> \u4fe1\u606f\u4f5c\u4e3a\u8d44\u6e90\u63d0\u793a\u51fa\u73b0\u3002\u4e00\u4e9b\u8d44\u6e90\u7c7b\u578b\uff0c\u4f8b\u5982 <code>Cluster</code> \u548c <code>Listener</code> \u5c06\u4f7f\u7528\u4e00\u4e2a\u7a7a\u7684 <code>resource_names</code>\uff0c\u56e0\u4e3a Envoy \u9700\u8981\u83b7\u53d6\u7ba1\u7406\u670d\u52a1\u5668\u5bf9\u5e94\u4e8e\u8282\u70b9\u6807\u8bc6\u7684\u6240\u6709 <code>Cluster</code>\uff08CDS\uff09\u548c <code>Listener</code>\uff08LDS\uff09\u3002\u5bf9\u4e8e\u5176\u4ed6\u8d44\u6e90\u7c7b\u578b\uff0c\u5982 <code>RouteConfigurations</code>\uff08RDS\uff09\u548c <code>ClusterLoadAssignments</code>\uff08EDS\uff09\uff0c\u5219\u9075\u5faa\u6b64\u524d\u7684 CDS/LDS \u66f4\u65b0\uff0cEnvoy \u80fd\u591f\u660e\u786e\u5730\u679a\u4e3e\u8fd9\u4e9b\u8d44\u6e90\u3002</p> <p>LDS/CDS \u8d44\u6e90\u63d0\u793a\u4fe1\u606f\u5c06\u59cb\u7ec8\u4e3a\u7a7a\uff0c\u5e76\u4e14\u671f\u671b\u7ba1\u7406\u670d\u52a1\u5668\u7684\u6bcf\u4e2a\u54cd\u5e94\u90fd\u63d0\u4f9b <code>LDS/CDS</code> \u8d44\u6e90\u7684\u5b8c\u6574\u72b6\u6001\u3002\u7f3a\u5e2d\u7684 <code>Listener</code> \u6216 <code>Cluster</code> \u5c06\u88ab\u5220\u9664\u3002</p> <p>\u5bf9\u4e8e EDS/RDS\uff0c\u7ba1\u7406\u670d\u52a1\u5668\u5e76\u4e0d\u9700\u8981\u4e3a\u6bcf\u4e2a\u8bf7\u6c42\u7684\u8d44\u6e90\u8fdb\u884c\u54cd\u5e94\uff0c\u800c\u4e14\u8fd8\u53ef\u80fd\u63d0\u4f9b\u989d\u5916\u672a\u8bf7\u6c42\u7684\u8d44\u6e90\u3002<code>resource_names</code> \u53ea\u662f\u4e00\u4e2a\u63d0\u793a\u3002Envoy \u5c06\u9ed8\u9ed8\u5730\u5ffd\u7565\u8fd4\u56de\u7684\u591a\u4f59\u8d44\u6e90\u3002\u5982\u679c\u8bf7\u6c42\u7684\u8d44\u6e90\u4e2d\u7f3a\u5c11\u76f8\u5e94\u7684 RDS \u6216 EDS \u66f4\u65b0\uff0cEnvoy \u5c06\u4fdd\u7559\u5bf9\u5e94\u8d44\u6e90\u7684\u6700\u540e\u7684\u503c\u3002\u7ba1\u7406\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u4f9d\u636e <code>DiscoveryRequest</code> \u4e2d <code>node</code> \u6807\u8bc6\u63a8\u65ad\u5176\u6240\u9700\u7684 EDS/RDS \u8d44\u6e90\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u63d0\u793a\u4fe1\u606f\u53ef\u80fd\u4f1a\u88ab\u4e22\u5f03\u3002\u4ece\u76f8\u5e94\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7a7a\u7684 EDS/RDS <code>DiscoveryResponse</code> \u54cd\u5e94\u5b9e\u9645\u4e0a\u662f\u8868\u660e\u5728 Envoy \u4e2d\u4e3a\u4e00\u4e2a\u7a7a\u7684\u8d44\u6e90\u3002</p> <p>\u5f53 <code>Listener</code> \u6216 <code>Cluster</code> \u88ab\u5220\u9664\u65f6\uff0c\u5176\u5bf9\u5e94\u7684 EDS \u548c RDS \u8d44\u6e90\u4e5f\u9700\u8981\u5728 Envoy \u5b9e\u4f8b\u4e2d\u5220\u9664\u3002\u4e3a\u4f7f EDS \u8d44\u6e90\u88ab Envoy \u5df2\u77e5\u6216\u8ddf\u8e2a\uff0c\u5c31\u5fc5\u987b\u5b58\u5728\u5e94\u7528\u8fc7\u7684 <code>Cluster</code> \u5b9a\u4e49\uff08\u5982\u901a\u8fc7 CDS \u83b7\u53d6\uff09\u3002RDS \u548c <code>Listeners</code> \u4e4b\u95f4\u5b58\u5728\u7c7b\u4f3c\u7684\u5173\u7cfb\uff08\u5982\u901a\u8fc7 LDS \u83b7\u53d6\uff09\u3002</p> <p>\u5bf9\u4e8e EDS/RDS \uff0cEnvoy \u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u7ed9\u5b9a\u7c7b\u578b\u7684\u8d44\u6e90\u751f\u6210\u4e0d\u540c\u7684\u6d41\uff08\u5982\u6bcf\u4e2a <code>ConfigSource</code> \u90fd\u6709\u81ea\u5df1\u7684\u4e0a\u6e38\u7ba1\u7406\u670d\u52a1\u5668\u7684\u96c6\u7fa4\uff09\u6216\u5f53\u6307\u5b9a\u8d44\u6e90\u7c7b\u578b\u7684\u8bf7\u6c42\u53d1\u9001\u5230\u540c\u4e00\u4e2a\u7ba1\u7406\u670d\u52a1\u5668\u7684\u65f6\u5019\uff0c\u5141\u8bb8\u5c06\u591a\u4e2a\u8d44\u6e90\u8bf7\u6c42\u7ec4\u5408\u5728\u4e00\u8d77\u53d1\u9001\u3002\u867d\u7136\u53ef\u4ee5\u5355\u4e2a\u5b9e\u73b0\uff0c\u4f46\u7ba1\u7406\u670d\u52a1\u5668\u5e94\u5177\u5907\u5904\u7406\u6bcf\u4e2a\u7ed9\u5b9a\u8d44\u6e90\u7c7b\u578b\u4e2d\u5bf9\u5355\u4e2a\u6216\u591a\u4e2a <code>resource_names</code> \u8bf7\u6c42\u7684\u80fd\u529b\u3002\u4e0b\u9762\u7684\u4e24\u4e2a\u5e8f\u5217\u56fe\u5bf9\u4e8e\u83b7\u53d6\u4e24\u4e2a EDS \u8d44\u6e90\u90fd\u662f\u6709\u6548\u7684 <code>{foo\uff0cbar}</code>\uff1a</p> <p> </p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#46215","title":"4.6.2.1.5 \u8d44\u6e90\u66f4\u65b0","text":"<p>\u5982\u4e0a\u6240\u8ff0\uff0cEnvoy \u53ef\u80fd\u4f1a\u66f4\u65b0 <code>DiscoveryRequest</code> \u4e2d\u51fa\u73b0\u7684 <code>resource_names</code> \u5217\u8868\uff0c\u5176\u4e2d <code>DiscoveryRequest</code> \u662f\u7528\u6765 ACK/NACK \u7ba1\u7406\u670d\u52a1\u5668\u7684\u7279\u5b9a\u7684 <code>DiscoveryResponse</code> \u3002\u6b64\u5916\uff0cEnvoy \u540e\u7eed\u53ef\u80fd\u4f1a\u53d1\u9001\u989d\u5916\u7684 <code>DiscoveryRequests</code> \uff0c\u7528\u4e8e\u5728\u7279\u5b9a <code>version_info</code> \u4e0a\u4f7f\u7528\u65b0\u7684\u8d44\u6e90\u63d0\u793a\u6765\u66f4\u65b0\u7ba1\u7406\u670d\u52a1\u5668\u3002\u4f8b\u5982\uff0c\u5982\u679c Envoy \u5728 EDS \u7248\u672c X \u65f6\u4ec5\u77e5\u9053\u96c6\u7fa4 <code>foo</code>\uff0c\u4f46\u5728\u968f\u540e\u6536\u5230\u7684 CDS \u66f4\u65b0\u65f6\u989d\u5916\u83b7\u53d6\u4e86\u96c6\u7fa4 <code>bar</code> \uff0c\u5b83\u53ef\u80fd\u4f1a\u4e3a\u7248\u672c X \u53d1\u51fa\u989d\u5916\u7684 <code>DiscoveryRequest</code> \u8bf7\u6c42\uff0c\u5e76\u5c06 <code>{foo\uff0cbar}</code> \u4f5c\u4e3a\u8bf7\u6c42\u7684 <code>resource_names</code> \u3002</p> <p>\u56fe\u7247 - CDS \u54cd\u5e94\u5bfc\u81f4 EDS \u8d44\u6e90\u66f4\u65b0</p> <p>\u8fd9\u91cc\u53ef\u80fd\u4f1a\u51fa\u73b0\u7ade\u4e89\u72b6\u51b5\uff1b\u5982\u679c Envoy \u5728\u7248\u672c X \u4e0a\u53d1\u5e03\u4e86\u8d44\u6e90\u63d0\u793a\u66f4\u65b0\u8bf7\u6c42\uff0c\u4f46\u5728\u7ba1\u7406\u670d\u52a1\u5668\u5904\u7406\u8be5\u8bf7\u6c42\u4e4b\u524d\u53d1\u9001\u4e86\u65b0\u7684\u7248\u672c\u53f7\u4e3a Y \u7684\u54cd\u5e94\uff0c\u9488\u5bf9 <code>version_info</code> \u4e3a X \u7684\u7248\u672c\uff0c\u8d44\u6e90\u63d0\u793a\u66f4\u65b0\u53ef\u80fd\u4f1a\u88ab\u89e3\u91ca\u4e3a\u62d2\u7edd**Y** \u3002\u4e3a\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u901a\u8fc7\u4f7f\u7528\u7ba1\u7406\u670d\u52a1\u5668\u63d0\u4f9b\u7684 <code>nonce</code>\uff0cEnvoy \u53ef\u7528\u6765\u4fdd\u8bc1\u6bcf\u4e2a <code>DiscoveryRequest</code>\u5bf9\u5e94\u5230\u76f8\u5e94\u7684 <code>DiscoveryResponse</code> \uff1a</p> <p>\u56fe\u7247 - EDS \u66f4\u65b0\u901f\u7387\u6fc0\u53d1 nonces</p> <p>\u7ba1\u7406\u670d\u52a1\u5668\u4e0d\u5e94\u8be5\u4e3a\u542b\u6709\u8fc7\u671f <code>nonce</code> \u7684 <code>DiscoveryRequest</code> \u53d1\u9001 <code>DiscoveryResponse</code> \u54cd\u5e94\u3002\u5728\u5411 Envoy \u53d1\u9001\u7684 <code>DiscoveryResponse</code> \u4e2d\u5305\u542b\u4e86\u7684\u65b0 <code>nonce</code> \uff0c\u5219\u6b64\u524d\u7684 <code>nonce</code> \u5c06\u8fc7\u671f\u3002\u5728\u8d44\u6e90\u65b0\u7248\u672c\u5c31\u7eea\u4e4b\u524d\uff0c\u7ba1\u7406\u670d\u52a1\u5668\u4e0d\u9700\u8981\u5411 Envoy \u53d1\u9001\u66f4\u65b0\u3002\u540c\u7248\u672c\u7684\u65e9\u671f\u8bf7\u6c42\u5c06\u4f1a\u8fc7\u671f\u3002\u5728\u65b0\u7248\u672c\u5c31\u7eea\u65f6\uff0c\u7ba1\u7406\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u5904\u7406\u540c\u4e00\u4e2a\u7248\u672c\u53f7\u7684\u591a\u4e2a <code>DiscoveryRequests</code>\u8bf7\u6c42\u3002</p> <p>\u56fe\u7247 - \u8bf7\u6c42\u53d8\u7684\u9648\u65e7</p> <p>\u4e0a\u8ff0\u8d44\u6e90\u66f4\u65b0\u5e8f\u5217\u8868\u660e Envoy \u5e76\u4e0d\u80fd\u671f\u5f85\u5176\u53d1\u51fa\u7684\u6bcf\u4e2a <code>DiscoveryRequest</code> \u90fd\u5f97\u5230 <code>DiscoveryResponse</code>\u54cd\u5e94\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#46216","title":"4.6.2.1.6 \u6700\u7ec8\u4e00\u81f4\u6027\u8003\u8651","text":"<p>\u7531\u4e8e Envoy \u7684 xDS API \u91c7\u7528\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u56e0\u6b64\u5728\u66f4\u65b0\u671f\u95f4\u53ef\u80fd\u5bfc\u81f4\u6d41\u91cf\u88ab\u4e22\u5f03\u3002\u4f8b\u5982\uff0c\u5982\u679c\u901a\u8fc7 CDS/EDS \u4ec5\u83b7\u53d6\u5230\u4e86\u96c6\u7fa4 X\uff0c\u800c\u4e14 <code>RouteConfiguration</code> \u5f15\u7528\u4e86\u96c6\u7fa4 X\uff1b\u5728 CDS/EDS \u66f4\u65b0\u96c6\u7fa4 Y \u914d\u7f6e\u4e4b\u524d\uff0c\u5982\u679c\u5c06 <code>RouteConfiguration</code> \u5c06\u5f15\u7528\u7684\u96c6\u7fa4\u8c03\u6574\u4e3a Y \uff0c\u90a3\u4e48\u6d41\u91cf\u5c06\u88ab\u5438\u5165\u9ed1\u6d1e\u800c\u4e22\u5f03\uff0c\u76f4\u81f3\u96c6\u7fa4 Y \u88ab Envoy \u5b9e\u4f8b\u83b7\u53d6\u3002</p> <p>\u5bf9\u67d0\u4e9b\u5e94\u7528\u7a0b\u5e8f\uff0c\u53ef\u63a5\u53d7\u4e34\u65f6\u7684\u6d41\u91cf\u4e22\u5f03\uff0c\u5ba2\u6237\u7aef\u91cd\u8bd5\u6216\u5176\u4ed6 Envoy sidecar \u4f1a\u63a9\u76d6\u6d41\u91cf\u4e22\u5f03\u3002\u90a3\u4e9b\u5bf9\u6d41\u91cf\u4e22\u5f03\u4e0d\u80fd\u5bb9\u5fcd\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u907f\u514d\u6d41\u91cf\u4e22\u5931\uff0cCDS/EDS \u66f4\u65b0\u540c\u65f6\u643a\u5e26 X \u548c Y \uff0c\u7136\u540e\u53d1\u9001 RDS \u66f4\u65b0\u4ece X \u5207\u6362\u5230 Y \uff0c\u6b64\u540e\u53d1\u9001\u4e22\u5f03 X \u7684 CDS/EDS \u66f4\u65b0\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u4e3a\u907f\u514d\u6d41\u91cf\u4e22\u5f03\uff0c\u66f4\u65b0\u7684\u987a\u5e8f\u5e94\u8be5\u9075\u5faa <code>make before break</code> \u6a21\u578b\uff0c\u5176\u4e2d</p> <ul> <li>\u5fc5\u987b\u59cb\u7ec8\u5148\u63a8\u9001 CDS \u66f4\u65b0\uff08\u5982\u679c\u6709\uff09\u3002</li> <li>EDS \u66f4\u65b0\uff08\u5982\u679c\u6709\uff09\u5fc5\u987b\u5728\u76f8\u5e94\u96c6\u7fa4\u7684 CDS \u66f4\u65b0\u540e\u5230\u8fbe\u3002</li> <li>LDS \u66f4\u65b0\u5fc5\u987b\u5728\u76f8\u5e94\u7684 CDS/EDS \u66f4\u65b0\u540e\u5230\u8fbe\u3002</li> <li>\u4e0e\u65b0\u6dfb\u52a0\u7684\u76d1\u542c\u5668\u76f8\u5173\u7684 RDS \u66f4\u65b0\u5fc5\u987b\u5728\u6700\u540e\u5230\u8fbe\u3002</li> <li>\u6700\u540e\uff0c\u5220\u9664\u8fc7\u671f\u7684 CDS \u96c6\u7fa4\u548c\u76f8\u5173\u7684 EDS \u7aef\u70b9\uff08\u4e0d\u518d\u88ab\u5f15\u7528\u7684\u7aef\u70b9\uff09\u3002</li> </ul> <p>\u5982\u679c\u6ca1\u6709\u65b0\u7684\u96c6\u7fa4/\u8def\u7531/\u76d1\u542c\u5668\u6216\u8005\u5141\u8bb8\u66f4\u65b0\u65f6\u4e34\u65f6\u6d41\u91cf\u4e22\u5931\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u72ec\u7acb\u63a8\u9001 xDS \u66f4\u65b0\u3002\u8bf7\u6ce8\u610f\uff0c\u5728 LDS \u66f4\u65b0\u7684\u60c5\u51b5\u4e0b\uff0c\u76d1\u542c\u5668\u987b\u5728\u63a5\u6536\u6d41\u91cf\u4e4b\u524d\u88ab\u9884\u70ed\uff0c\u4f8b\u5982\u5982\u5176\u914d\u7f6e\u4e86\u4f9d\u8d56\u7684\u8def\u7531\uff0c\u5219\u5148\u9700\u5148\u4ece RDS \u8fdb\u884c\u83b7\u53d6\u3002\u6dfb\u52a0/\u5220\u9664/\u66f4\u65b0\u96c6\u7fa4\u4fe1\u606f\u65f6\uff0c\u96c6\u7fa4\u4e5f\u9700\u8981\u8fdb\u884c\u9884\u70ed\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u7ba1\u7406\u5e73\u9762\u786e\u4fdd\u8def\u7531\u66f4\u65b0\u65f6\u6240\u5f15\u7528\u7684\u96c6\u7fa4\u5df2\u7ecf\u51c6\u5907\u5c31\u7eea\uff0c\u8def\u7531\u53ef\u4ee5\u4e0d\u7528\u9884\u70ed\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4622-ads","title":"4.6.2.2 \u805a\u5408\u670d\u52a1\u53d1\u73b0\uff08ADS\uff09","text":"<p>\u5f53\u7ba1\u7406\u670d\u52a1\u5668\u8fdb\u884c\u8d44\u6e90\u5206\u53d1\u65f6\uff0c\u901a\u8fc7\u4e0a\u8ff0\u4fdd\u8bc1\u4ea4\u4e92\u987a\u5e8f\u7684\u65b9\u5f0f\u6765\u907f\u514d\u6d41\u91cf\u4e22\u5f03\u662f\u4e00\u9879\u5f88\u6709\u6311\u6218\u7684\u5de5\u4f5c\u3002ADS \u5141\u8bb8\u5355\u4e00\u7ba1\u7406\u670d\u52a1\u5668\u901a\u8fc7\u5355\u4e2a gRPC \u6d41\uff0c\u63d0\u4f9b\u6240\u6709\u7684 API \u66f4\u65b0\u3002\u914d\u5408\u4ed4\u7ec6\u89c4\u5212\u7684\u66f4\u65b0\u987a\u5e8f\uff0cADS \u53ef\u89c4\u907f\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u6d41\u91cf\u4e22\u5931\u3002\u4f7f\u7528 ADS\uff0c\u5728\u5355\u4e2a\u6d41\u4e0a\u53ef\u901a\u8fc7\u7c7b\u578b URL \u6765\u8fdb\u884c\u590d\u7528\u591a\u4e2a\u72ec\u7acb\u7684 <code>DiscoveryRequest</code>/<code>DiscoveryResponse</code> \u5e8f\u5217\u3002\u5bf9\u4e8e\u4efb\u4f55\u7ed9\u5b9a\u7c7b\u578b\u7684 URL\uff0c\u4ee5\u4e0a <code>DiscoveryRequest</code>\u548c <code>DiscoveryResponse</code> \u6d88\u606f\u5e8f\u5217\u90fd\u9002\u7528\u3002 \u66f4\u65b0\u5e8f\u5217\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a</p> <p>\u56fe\u7247 - EDS/CDS \u5728\u4e00\u4e2a ADS \u6d41\u4e0a\u591a\u8def\u590d\u7528</p> <p>\u6bcf\u4e2a Envoy \u5b9e\u4f8b\u53ef\u4f7f\u7528\u5355\u72ec\u7684 ADS \u6d41\u3002</p> <p>\u6700\u5c0f\u5316 ADS \u914d\u7f6e\u7684 <code>bootstrap.yaml</code> \u7247\u6bb5\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>node:\n  id: &lt;node identifier&gt;\ndynamic_resources:\n  cds_config: {ads: {}}\n  lds_config: {ads: {}}\n  ads_config:\n    api_type: GRPC\n    grpc_services:\n      envoy_grpc:\n        cluster_name: ads_cluster\nstatic_resources:\n  clusters:\n  - name: ads_cluster\n    connect_timeout: { seconds: 5 }\n    type: STATIC\n    hosts:\n    - socket_address:\n        address: &lt;ADS management server IP address&gt;\n        port_value: &lt;ADS management server port&gt;\n    lb_policy: ROUND_ROBIN\n    http2_protocol_options: {}\nadmin:\n  ...\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4623-xds","title":"4.6.2.3 \u589e\u91cf xDS","text":"<p>\u589e\u91cf xDS \u662f\u53ef\u7528\u4e8e\u5141\u8bb8\u7684 ADS\u3001CDS \u548c RDS \u5355\u72ec xDS \u7aef\u70b9\uff1a</p> <ul> <li>xDS \u5ba2\u6237\u7aef\u5bf9\u8ddf\u8e2a\u8d44\u6e90\u5217\u8868\u8fdb\u884c\u589e\u91cf\u66f4\u65b0\u3002\u8fd9\u652f\u6301 Envoy \u6309\u9700/\u60f0\u6027\u5730\u8bf7\u6c42\u989d\u5916\u8d44\u6e90\u3002\u4f8b\u5982\uff0c\u5f53\u4e0e\u672a\u77e5\u96c6\u7fa4\u76f8\u5bf9\u5e94\u7684\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002</li> <li>xDS \u670d\u52a1\u5668\u53ef\u4ee5\u589e\u91cf\u66f4\u65b0\u5ba2\u6237\u7aef\u4e0a\u7684\u8d44\u6e90\u3002\u8fd9\u652f\u6301 xDS \u8d44\u6e90\u53ef\u4f38\u7f29\u6027\u7684\u76ee\u6807\u3002\u7ba1\u7406\u670d\u52a1\u5668\u53ea\u9700\u4ea4\u4ed8\u66f4\u6539\u7684\u5355\u4e2a\u96c6\u7fa4\uff0c\u800c\u4e0d\u662f\u5728\u4fee\u6539\u5355\u4e2a\u96c6\u7fa4\u65f6\u4ea4\u4ed8\u6240\u6709\u4e0a\u4e07\u4e2a\u96c6\u7fa4\u3002</li> </ul> <p>xDS \u589e\u91cf\u4f1a\u8bdd\u59cb\u7ec8\u4f4d\u4e8e gRPC \u53cc\u5411\u6d41\u7684\u4e0a\u4e0b\u6587\u4e2d\u3002\u8fd9\u5141\u8bb8 xDS \u670d\u52a1\u5668\u80fd\u591f\u8ddf\u8e2a\u5230\u8fde\u63a5\u7684 xDS \u5ba2\u6237\u7aef\u7684\u72b6\u6001\u3002xDS REST \u7248\u672c\u4e0d\u652f\u6301\u589e\u91cf\u3002</p> <p>\u5728\u589e\u91cf xDS \u4e2d\uff0cnonce \u5b57\u6bb5\u662f\u5fc5\u9700\u7684\uff0c\u7528\u4e8e\u5339\u914d <code>IncrementalDiscoveryResponse</code> \u5173\u8054\u7684 ACK \u6216 NACK <code>IncrementalDiscoveryRequest</code>\u3002\u53ef\u9009\u5730\uff0c\u5b58\u5728\u54cd\u5e94\u6d88\u606f\u7ea7\u522b\u7684 system_version_info\uff0c\u4f46\u4ec5\u7528\u4e8e\u8c03\u8bd5\u76ee\u7684\u3002</p> <p><code>IncrementalDiscoveryRequest</code> \u53ef\u5728\u4ee5\u4e0b 3 \u79cd\u60c5\u51b5\u4e0b\u53d1\u9001\uff1a</p> <ol> <li>xDS \u53cc\u5411 gRPC \u6d41\u7684\u521d\u59cb\u6d88\u606f\u3002</li> <li>\u4f5c\u4e3a\u5bf9\u5148\u524d\u7684 <code>IncrementalDiscoveryResponse</code> \u7684 ACK \u6216 NACK \u54cd\u5e94\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c<code>response_nonce</code> \u88ab\u8bbe\u7f6e\u4e3a\u54cd\u5e94\u4e2d\u7684 nonce \u503c\u3002ACK \u6216 NACK \u7531\u53ef\u7531 <code>error_detail</code> \u5b57\u6bb5\u662f\u5426\u51fa\u73b0\u6765\u533a\u5206\u3002</li> <li>\u5ba2\u6237\u7aef\u81ea\u53d1\u7684 <code>IncrementalDiscoveryRequest</code>\u3002\u6b64\u573a\u666f\u4e0b\u53ef\u4ee5\u91c7\u7528\u52a8\u6001\u6dfb\u52a0\u6216\u5220\u9664\u88ab\u8ddf\u8e2a\u7684 <code>resource_names</code> \u96c6\u3002\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u5fc5\u987b\u5ffd\u7565 <code>response_nonce</code>\u3002</li> </ol> <p>\u5728\u7b2c\u4e00\u4e2a\u793a\u4f8b\u4e2d\uff0c\u5ba2\u6237\u7aef\u8fde\u63a5\u5e76\u63a5\u6536\u5b83\u7684\u7b2c\u4e00\u4e2a\u66f4\u65b0\u5e76 ACK\u3002\u7b2c\u4e8c\u6b21\u66f4\u65b0\u5931\u8d25\uff0c\u5ba2\u6237\u7aef\u53d1\u9001 NACK \u62d2\u7edd\u66f4\u65b0\u3002xDS\u5ba2\u6237\u7aef\u540e\u7eed\u4f1a\u81ea\u53d1\u5730\u8bf7\u6c42 \u201cwc\u201d \u76f8\u5173\u8d44\u6e90\u3002</p> <p>\u56fe\u7247 - \u589e\u91cf session \u793a\u4f8b</p> <p>\u5728\u91cd\u65b0\u8fde\u63a5\u65f6\uff0c\u652f\u6301\u589e\u91cf\u7684 xDS \u5ba2\u6237\u7aef\u53ef\u80fd\u4f1a\u544a\u8bc9\u670d\u52a1\u5668\u5176\u5df2\u77e5\u8d44\u6e90\u4ece\u800c\u907f\u514d\u901a\u8fc7\u7f51\u7edc\u91cd\u65b0\u53d1\u9001\u5b83\u4eec\u3002</p> <p>\u56fe\u7247 - \u589e\u91cf\u91cd\u8fde\u793a\u4f8b</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#463-rest-json","title":"4.6.3 REST-JSON \u8f6e\u8be2\u8ba2\u9605","text":"<p>\u5355\u4e2a xDS API \u53ef\u5bf9 REST \u7aef\u70b9\u8fdb\u884c\u540c\u6b65\uff08\u957f\uff09\u8f6e\u8be2\u3002\u9664\u4e86\u65e0\u6301\u4e45\u6d41\u4e0e\u7ba1\u7406\u670d\u52a1\u5668\u4ea4\u4e92\u5916\uff0c\u6d88\u606f\u987a\u5e8f\u4e0e\u4e0a\u8ff0\u76f8\u4f3c\u3002\u5728\u4efb\u4f55\u65f6\u95f4\u70b9\uff0c\u53ea\u5b58\u5728\u4e00\u4e2a\u672a\u5b8c\u6210\u7684\u8bf7\u6c42\uff0c\u56e0\u6b64\u54cd\u5e94\u6d88\u606f\u4e2d\u7684 <code>nonce</code> \u5728 REST-JSON \u4e2d\u662f\u53ef\u9009\u7684\u3002<code>DiscoveryRequest</code> \u548c <code>DiscoveryResponse</code> \u7684\u6d88\u606f\u7f16\u7801\u9075\u5faa JSON \u53d8\u6362 proto3 \u89c4\u8303\u3002ADS \u4e0d\u652f\u6301 REST-JSON \u8f6e\u8be2\u3002</p> <p>\u5f53\u8f6e\u8be2\u671f\u95f4\u8bbe\u7f6e\u4e3a\u8f83\u5c0f\u7684\u503c\u65f6\uff0c\u5219\u53ef\u4ee5\u7b49\u540c\u4e8e\u957f\u8f6e\u8be2\uff0c\u8fd9\u65f6\u8981\u6c42\u907f\u514d\u53d1\u9001 <code>DiscoveryResponse</code>\uff0c\u9664\u975e\u5bf9\u8bf7\u6c42\u7684\u8d44\u6e90\u53d1\u751f\u4e86\u66f4\u6539\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#464-lds","title":"4.6.4 LDS\uff08\u76d1\u542c\u5668\u53d1\u73b0\u670d\u52a1\uff09","text":"<p>Listener \u53d1\u73b0\u670d\u52a1\uff08LDS\uff09\u662f\u4e00\u4e2a\u53ef\u9009\u7684 API\uff0cEnvoy \u5c06\u8c03\u7528\u5b83\u6765\u52a8\u6001\u83b7\u53d6 Listener\u3002Envoy \u5c06\u534f\u8c03 API \u54cd\u5e94\uff0c\u5e76\u6839\u636e\u9700\u8981\u6dfb\u52a0\u3001\u4fee\u6539\u6216\u5220\u9664\u5df2\u77e5\u7684 Listener\u3002</p> <p>Listener \u66f4\u65b0\u7684\u8bed\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>\u6bcf\u4e2a Listener \u5fc5\u987b\u6709\u4e00\u4e2a\u72ec\u7279\u7684\u540d\u5b57\u3002\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u540d\u79f0\uff0cEnvoy \u5c06\u521b\u5efa\u4e00\u4e2a UUID\u3002\u8981\u52a8\u6001\u66f4\u65b0\u7684 Listener \uff0c\u7ba1\u7406\u670d\u52a1\u5fc5\u987b\u63d0\u4f9b Listener \u7684\u552f\u4e00\u540d\u79f0\u3002</li> <li>\u5f53\u4e00\u4e2a Listener \u88ab\u6dfb\u52a0\uff0c\u5728\u53c2\u4e0e\u8fde\u63a5\u5904\u7406\u4e4b\u524d\uff0c\u4f1a\u5148\u8fdb\u5165\u201c\u9884\u70ed\u201d\u9636\u6bb5\u3002\u4f8b\u5982\uff0c\u5982\u679c Listener \u5f15\u7528 RDS\u914d\u7f6e\uff0c\u90a3\u4e48\u5728 Listener \u8fc1\u79fb\u5230 \u201cactive\u201d \u4e4b\u524d\uff0c\u5c06\u4f1a\u89e3\u6790\u5e76\u63d0\u53d6\u8be5\u914d\u7f6e\u3002</li> <li>Listener \u4e00\u65e6\u521b\u5efa\uff0c\u5b9e\u9645\u4e0a\u5c31\u4f1a\u4fdd\u6301\u4e0d\u53d8\u3002\u56e0\u6b64\uff0c\u66f4\u65b0 Listener \u65f6\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u5168\u65b0\u7684 Listener \uff08\u4f7f\u7528\u76f8\u540c\u7684\u4fa6\u542c\u5957\u63a5\u5b57\uff09\u3002\u65b0\u589e\u52a0\u7684\u76d1\u542c\u8005\u90fd\u4f1a\u901a\u8fc7\u4e0a\u9762\u6240\u63cf\u8ff0\u7684\u76f8\u540c\u201c\u9884\u70ed\u201d\u8fc7\u7a0b\u3002</li> <li>\u5f53\u66f4\u65b0\u6216\u5220\u9664 Listener \u65f6\uff0c\u65e7\u7684 Listener \u5c06\u88ab\u7f6e\u4e8e \u201cdraining\uff08\u9010\u51fa\uff09\u201d \u72b6\u6001\uff0c\u5c31\u50cf\u6574\u4e2a\u670d\u52a1\u91cd\u65b0\u542f\u52a8\u65f6\u4e00\u6837\u3002Listener \u79fb\u9664\u4e4b\u540e\uff0c\u8be5 Listener \u6240\u62e5\u6709\u7684\u8fde\u63a5\uff0c\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u4f18\u96c5\u5730\u5173\u95ed\uff08\u5982\u679c\u53ef\u80fd\u7684\u8bdd\uff09\u5269\u4f59\u7684\u8fde\u63a5\u3002\u9010\u51fa\u65f6\u95f4\u901a\u8fc7 <code>--drain-time-s</code> \u9009\u9879\u8bbe\u7f6e\u3002</li> </ul> <p>\u6ce8\u610f</p> <ul> <li>Envoy \u4ece 1.9 \u7248\u672c\u5f00\u59cb\u5df2\u4e0d\u518d\u652f\u6301 v1 API\u3002</li> <li>v2 LDS API</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#465-rds","title":"4.6.5 RDS\uff08\u8def\u7531\u53d1\u73b0\u670d\u52a1\uff09","text":"<p>\u8def\u7531\u53d1\u73b0\u670d\u52a1\uff08RDS\uff09\u662f Envoy \u91cc\u9762\u7684\u4e00\u4e2a\u53ef\u9009 API\uff0c\u7528\u4e8e\u52a8\u6001\u83b7\u53d6\u8def\u7531\u914d\u7f6e\u3002\u8def\u7531\u914d\u7f6e\u5305\u62ec HTTP header \u4fee\u6539\u3001\u865a\u62df\u4e3b\u673a\u4ee5\u53ca\u6bcf\u4e2a\u865a\u62df\u4e3b\u673a\u4e2d\u5305\u542b\u7684\u5355\u4e2a\u8def\u7531\u89c4\u5219\u914d\u7f6e\u3002\u6bcf\u4e2a HTTP \u8fde\u63a5\u7ba1\u7406\u5668\u90fd\u53ef\u4ee5\u901a\u8fc7 API \u72ec\u7acb\u5730\u83b7\u53d6\u81ea\u8eab\u7684\u8def\u7531\u914d\u7f6e\u3002</p> <ul> <li>v2 API \u53c2\u8003</li> </ul> <p>\u6ce8\u610f\uff1aEnvoy \u4ece 1.9 \u7248\u672c\u5f00\u59cb\u5df2\u4e0d\u518d\u652f\u6301 v1 API\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#_5","title":"\u7edf\u8ba1","text":"<p>RDS \u7684\u7edf\u8ba1\u6811\u4ee5 <code>http.&lt;stat_prefix&gt;.rds.&lt;route_config_name&gt;.*.</code>\u4e3a\u6839\uff0c<code>route_config_name</code>\u540d\u79f0\u4e2d\u7684\u4efb\u4f55<code>:</code>\u5b57\u7b26\u5728\u7edf\u8ba1\u6811\u4e2d\u88ab\u66ff\u6362\u4e3a<code>_</code>\u3002\u7edf\u8ba1\u6811\u5305\u542b\u4ee5\u4e0b\u7edf\u8ba1\u4fe1\u606f\uff1a</p> \u540d\u5b57 \u7c7b\u578b \u63cf\u8ff0 config_reload Counter \u56e0\u914d\u7f6e\u4e0d\u540c\u800c\u5bfc\u81f4\u914d\u7f6e\u91cd\u65b0\u52a0\u8f7d\u7684\u603b\u6b21\u6570 update_attempt Counter \u5c1d\u8bd5\u8c03\u7528\u914d\u7f6e\u52a0\u8f7d API \u7684\u603b\u6b21\u6570 update_success Counter \u8c03\u7528\u914d\u7f6e\u52a0\u8f7d API \u6210\u529f\u7684\u603b\u6b21\u6570 update_failure Counter \u8c03\u7528\u914d\u7f6e\u52a0\u8f7d API \u56e0\u7f51\u7edc\u9519\u8bef\u7684\u5931\u8d25\u603b\u6570 update_rejected Counter \u8c03\u7528\u914d\u7f6e\u52a0\u8f7d API \u56e0 schema/\u9a8c\u8bc1\u9519\u8bef\u7684\u5931\u8d25\u603b\u6b21\u6570 version Gauge \u6765\u81ea\u4e0a\u6b21\u6210\u529f\u8c03\u7528\u914d\u7f6e\u52a0\u8f7dAPI\u7684\u5185\u5bb9\u54c8\u5e0c"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#466-cds","title":"4.6.6 CDS\uff08\u96c6\u7fa4\u53d1\u73b0\u670d\u52a1\uff09","text":"<p>\u96c6\u7fa4\u53d1\u73b0\u670d\u52a1\uff08CDS\uff09\u662f\u4e00\u4e2a\u53ef\u9009\u7684 API\uff0cEnvoy \u5c06\u8c03\u7528\u8be5 API \u6765\u52a8\u6001\u83b7\u53d6 cluster manager \u7684\u6210\u5458\u3002Envoy \u8fd8\u5c06\u6839\u636e API \u54cd\u5e94\u534f\u8c03\u96c6\u7fa4\u7ba1\u7406\uff0c\u6839\u636e\u9700\u8981\u5b8c\u6210\u6dfb\u52a0\u3001\u4fee\u6539\u6216\u5220\u9664\u5df2\u77e5\u7684\u96c6\u7fa4\u3002</p> <p>\u5173\u4e8e Envoy \u662f\u5982\u4f55\u901a\u8fc7 CDS \u4ece <code>pilot-discovery</code> \u670d\u52a1\u4e2d\u83b7\u53d6\u7684 cluster \u914d\u7f6e\uff0c\u8bf7\u53c2\u8003 Service Mesh\u6df1\u5ea6\u5b66\u4e60\u7cfb\u5217part3\u2014istio\u6e90\u7801\u5206\u6790\u4e4bpilot-discovery\u6a21\u5757\u5206\u6790\uff08\u7eed\uff09\u4e00\u6587\u4e2d\u7684 CDS \u670d\u52a1\u90e8\u5206\u3002</p> <p>\u6ce8\u610f</p> <ul> <li>\u5728 Envoy \u914d\u7f6e\u4e2d\u9759\u6001\u5b9a\u4e49\u7684 cluster \u4e0d\u80fd\u901a\u8fc7 CDS API \u8fdb\u884c\u4fee\u6539\u6216\u5220\u9664\u3002</li> <li>Envoy \u4ece 1.9 \u7248\u672c\u5f00\u59cb\u5df2\u4e0d\u518d\u652f\u6301 v1 API\u3002</li> <li>v2 CDS API</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4661","title":"4.6.6.1 \u7edf\u8ba1","text":"<p>CDS \u7684\u7edf\u8ba1\u6811\u4ee5 <code>cluster_manager.cds.</code> \u4e3a\u6839\uff0c\u7edf\u8ba1\u5982\u4e0b\uff1a</p> \u540d\u5b57 \u7c7b\u578b \u63cf\u8ff0 config_reload Counter \u56e0\u914d\u7f6e\u4e0d\u540c\u800c\u5bfc\u81f4\u914d\u7f6e\u91cd\u65b0\u52a0\u8f7d\u7684\u603b\u6b21\u6570 update_attempt Counter \u5c1d\u8bd5\u8c03\u7528\u914d\u7f6e\u52a0\u8f7d API \u7684\u603b\u6b21\u6570 update_success Counter \u8c03\u7528\u914d\u7f6e\u52a0\u8f7d API \u6210\u529f\u7684\u603b\u6b21\u6570 update_failure Counter \u8c03\u7528\u914d\u7f6e\u52a0\u8f7d API \u56e0\u7f51\u7edc\u9519\u8bef\u7684\u5931\u8d25\u603b\u6570 update_rejected Counter \u8c03\u7528\u914d\u7f6e\u52a0\u8f7d API \u56e0 schema/\u9a8c\u8bc1\u9519\u8bef\u7684\u5931\u8d25\u603b\u6b21\u6570 version Gauge \u6765\u81ea\u4e0a\u6b21\u6210\u529f\u8c03\u7528\u914d\u7f6e\u52a0\u8f7dAPI\u7684\u5185\u5bb9\u54c8\u5e0c control_plane.connected_state Gauge \u5e03\u5c14\u503c\uff0c\u7528\u6765\u8868\u793a\u4e0e\u7ba1\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\u72b6\u6001\uff0c1\u8868\u793a\u5df2\u8fde\u63a5\uff0c0\u8868\u793a\u65ad\u5f00\u8fde\u63a5"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#467-eds","title":"4.6.7 EDS\uff08\u7aef\u70b9\u53d1\u73b0\u670d\u52a1\uff09","text":"<p>EDS \u53ea\u662f Envoy \u4e2d\u4f17\u591a\u7684\u670d\u52a1\u53d1\u73b0\u65b9\u5f0f\u7684\u4e00\u79cd\u3002\u8981\u60f3\u4e86\u89e3 EDS \u9996\u5148\u6211\u4eec\u9700\u8981\u5148\u77e5\u9053\u4ec0\u4e48\u662f Endpoint\u3002</p> <p>Endpoint</p> <p>Endpoint \u5373\u4e0a\u6e38\u4e3b\u673a\u6807\u8bc6\u3002\u5b83\u7684\u6570\u636e\u7ed3\u6784\u5982\u4e0b\uff1a</p> <pre><code>{\n  \"address\": \"{...}\",\n  \"health_check_config\": \"{...}\"\n}\n</code></pre> <p>\u5176\u4e2d\u5305\u62ec\u7aef\u70b9\u7684\u5730\u5740\u548c\u5065\u5eb7\u68c0\u67e5\u914d\u7f6e\u3002\u8be6\u60c5\u8bf7\u53c2\u8003 endpoint.Endpoint\u3002</p> <p>\u7ec8\u7aef\u53d1\u73b0\u670d\u52a1\uff08EDS\uff09\u662f\u4e00\u4e2a\u57fa\u4e8e gRPC \u6216 REST-JSON API \u670d\u52a1\u5668\u7684 xDS \u7ba1\u7406\u670d\u52a1\uff0c\u5728 Envoy \u4e2d\u7528\u6765\u83b7\u53d6\u96c6\u7fa4\u6210\u5458\u3002\u96c6\u7fa4\u6210\u5458\u5728 Envoy \u7684\u672f\u8bed\u4e2d\u88ab\u79f0\u4e3a\u201c\u7ec8\u7aef\u201d\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u96c6\u7fa4\uff0cEnvoy \u90fd\u4f1a\u901a\u8fc7\u53d1\u73b0\u670d\u52a1\u6765\u83b7\u53d6\u6210\u5458\u7684\u7ec8\u7aef\u3002\u7531\u4e8e\u4ee5\u4e0b\u51e0\u4e2a\u539f\u56e0\uff0cEDS \u662f\u9996\u9009\u7684\u670d\u52a1\u53d1\u73b0\u673a\u5236\uff1a</p> <ul> <li>Envoy \u5bf9\u6bcf\u4e2a\u4e0a\u6e38\u4e3b\u673a\u90fd\u6709\u660e\u786e\u7684\u4e86\u89e3\uff08\u4e0e\u901a\u8fc7 DNS \u89e3\u6790\u7684\u8d1f\u8f7d\u5747\u8861\u8fdb\u884c\u8def\u7531\u76f8\u6bd4\u800c\u8a00\uff09\uff0c\u5e76\u53ef\u4ee5\u505a\u51fa\u66f4\u667a\u80fd\u7684\u8d1f\u8f7d\u5747\u8861\u51b3\u7b56\u3002</li> <li>\u5728\u6bcf\u4e2a\u4e3b\u673a\u7684\u53d1\u73b0 API \u54cd\u5e94\u4e2d\u643a\u5e26\u7684\u989d\u5916\u5c5e\u6027\u901a\u77e5 Envoy \u8d1f\u8f7d\u5747\u8861\u6743\u91cd\u3001\u91d1\u4e1d\u96c0\u72b6\u6001\u3001\u533a\u57df\u7b49\u3002\u8fd9\u4e9b\u9644\u52a0\u5c5e\u6027\u5728\u8d1f\u8f7d\u5747\u8861\u3001\u7edf\u8ba1\u4fe1\u606f\u6536\u96c6\u7b49\u8fc7\u7a0b\u4e2d\u4f1a\u88ab Envoy \u7f51\u683c\u5168\u5c40\u4f7f\u7528\u3002</li> </ul> <p>Envoy \u63d0\u4f9b\u4e86 Java \u548c Go \u8bed\u8a00\u7248\u672c\u7684 EDS \u548c\u5176\u4ed6\u53d1\u73b0\u670d\u52a1\u7684\u53c2\u8003 gRPC \u5b9e\u73b0\u3002</p> <p>\u901a\u5e38\uff0c\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u4e0e\u6700\u7ec8\u4e00\u81f4\u7684\u670d\u52a1\u53d1\u73b0\u670d\u52a1\u6570\u636e\u7ed3\u5408\u4f7f\u7528\uff0c\u4ee5\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u548c\u8def\u7531\u51b3\u7b56\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#468-sds","title":"4.6.8 SDS\uff08\u79d8\u94a5\u53d1\u73b0\u670d\u52a1\uff09","text":"<p>SDS\uff08\u79d8\u94a5\u53d1\u73b0\u670d\u52a1\uff09\u662f Envoy 1.8.0 \u7248\u672c\u8d77\u5f00\u59cb\u5f15\u5165\u7684\u670d\u52a1\u3002\u53ef\u4ee5\u5728 <code>bootstrap.static_resource</code> \u7684 secrets \u914d\u7f6e\u4e2d\u4e3a Envoy \u6307\u5b9a TLS \u8bc1\u4e66\uff08secret\uff09\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7\u79d8\u94a5\u53d1\u73b0\u670d\u52a1\uff08SDS\uff09\u8fdc\u7a0b\u83b7\u53d6\u3002Istio \u9884\u8ba1\u5c06\u5728 1.1 \u7248\u672c\u4e2d\u652f\u6301 SDS\u3002</p> <p>SDS \u5e26\u6765\u7684\u6700\u5927\u7684\u597d\u5904\u5c31\u662f\u7b80\u5316\u8bc1\u4e66\u7ba1\u7406\u3002\u8981\u662f\u6ca1\u6709\u8be5\u529f\u80fd\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u5fc5\u987b\u4f7f\u7528 Kubernetes \u4e2d\u7684 secret \u8d44\u6e90\u521b\u5efa\u8bc1\u4e66\uff0c\u7136\u540e\u628a\u8bc1\u4e66\u6302\u8f7d\u5230\u4ee3\u7406\u5bb9\u5668\u4e2d\u3002\u5982\u679c\u8bc1\u4e66\u8fc7\u671f\uff0c\u8fd8\u9700\u8981\u66f4\u65b0 secret \u548c\u9700\u8981\u91cd\u65b0\u90e8\u7f72\u4ee3\u7406\u5bb9\u5668\u3002\u4f7f\u7528 SDS\uff0c\u4e2d\u592e SDS \u670d\u52a1\u5668\u5c06\u8bc1\u4e66\u63a8\u9001\u5230\u6240\u6709 Envoy \u5b9e\u4f8b\u4e0a\u3002\u5982\u679c\u8bc1\u4e66\u8fc7\u671f\uff0c\u670d\u52a1\u5668\u53ea\u9700\u5c06\u65b0\u8bc1\u4e66\u63a8\u9001\u5230 Envoy \u5b9e\u4f8b\uff0cEnvoy \u53ef\u4ee5\u7acb\u5373\u4f7f\u7528\u65b0\u8bc1\u4e66\u800c\u65e0\u9700\u91cd\u65b0\u90e8\u7f72\u3002</p> <p>\u5982\u679c listener server \u9700\u8981\u4ece\u8fdc\u7a0b\u83b7\u53d6\u8bc1\u4e66\uff0c\u5219 listener server \u4e0d\u4f1a\u88ab\u6807\u8bb0\u4e3a active \u72b6\u6001\uff0c\u5728\u83b7\u53d6\u8bc1\u4e66\u4e4b\u524d\u4e0d\u4f1a\u6253\u5f00\u5176\u7aef\u53e3\u3002\u5982\u679c Envoy \u7531\u4e8e\u8fde\u63a5\u5931\u8d25\u6216\u9519\u8bef\u7684\u54cd\u5e94\u6570\u636e\u800c\u65e0\u6cd5\u83b7\u53d6\u8bc1\u4e66\uff0c\u5219 listener server \u5c06\u88ab\u6807\u8bb0\u4e3a active\uff0c\u5e76\u4e14\u6253\u5f00\u7aef\u53e3\uff0c\u4f46\u662f\u5c06\u91cd\u7f6e\u4e0e\u7aef\u53e3\u7684\u8fde\u63a5\u3002</p> <p>\u4e0a\u6e38\u96c6\u7fa4\u7684\u5904\u7406\u65b9\u5f0f\u7c7b\u4f3c\uff0c\u5982\u679c\u9700\u8981\u901a\u8fc7 SDS \u4ece\u8fdc\u7a0b\u83b7\u53d6\u96c6\u7fa4\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u5219\u4e0d\u4f1a\u5c06\u5176\u6807\u8bb0\u4e3a active \u72b6\u6001\uff0c\u5728\u83b7\u5f97\u8bc1\u4e66\u4e4b\u524d\u4e5f\u5b83\u4e0d\u4f1a\u88ab\u4f7f\u7528\u3002\u5982\u679c Envoy \u7531\u4e8e\u8fde\u63a5\u5931\u8d25\u6216\u9519\u8bef\u7684\u54cd\u5e94\u6570\u636e\u800c\u65e0\u6cd5\u83b7\u53d6\u8bc1\u4e66\uff0c\u5219\u96c6\u7fa4\u5c06\u88ab\u6807\u8bb0\u4e3a active\uff0c\u53ef\u4ee5\u5904\u7406\u8bf7\u6c42\uff0c\u4f46\u8def\u7531\u5230\u8be5\u96c6\u7fa4\u7684\u8bf7\u6c42\u90fd\u5c06\u88ab\u62d2\u7edd\u3002</p> <p>\u4f7f\u7528 SDS \u7684\u9759\u6001\u96c6\u7fa4\u9700\u5b9a\u4e49 SDS \u96c6\u7fa4\uff08\u9664\u975e\u4f7f\u7528\u4e0d\u9700\u8981\u96c6\u7fa4\u7684 Google gRPC\uff09\uff0c\u5219\u5fc5\u987b\u5728\u4f7f\u7528\u9759\u6001\u96c6\u7fa4\u4e4b\u524d\u5b9a\u4e49 SDS \u96c6\u7fa4\u3002</p> <p>Envoy \u4ee3\u7406\u548c SDS \u670d\u52a1\u5668\u4e4b\u95f4\u7684\u8fde\u63a5\u5fc5\u987b\u662f\u5b89\u5168\u7684\u3002\u53ef\u4ee5\u5728\u540c\u4e00\u4e3b\u673a\u4e0a\u8fd0\u884c SDS \u670d\u52a1\u5668\uff0c\u4f7f\u7528 Unix Domain Socket \u8fdb\u884c\u8fde\u63a5\u3002\u5426\u5219\uff0c\u9700\u8981\u4ee3\u7406\u548c SDS \u670d\u52a1\u5668\u4e4b\u95f4\u7684 mTLS\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5fc5\u987b\u9759\u6001\u914d\u7f6e SDS \u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4681-sds-server","title":"4.6.8.1 SDS Server","text":"<p>SDS server \u9700\u8981\u5b9e\u73b0 SecretDiscoveryService \u8fd9\u4e2a gRPC \u670d\u52a1\u3002\u9075\u5faa\u4e0e\u5176\u4ed6 xDS \u76f8\u540c\u7684\u534f\u8bae\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4682-sds","title":"4.6.8.2 SDS \u914d\u7f6e","text":"<p>SDS \u652f\u6301\u9759\u6001\u914d\u7f6e\u4e5f\u652f\u6301\u52a8\u6001\u914d\u7f6e\u3002</p> <p>\u9759\u6001\u914d\u7f6e</p> <p>\u53ef\u4ee5\u5728<code>static_resources</code> \u7684 <code>secrets</code> \u4e2d\u914d\u7f6e TLS \u8bc1\u4e66\u3002</p> <p>\u52a8\u6001\u914d\u7f6e</p> <p>\u4ece\u8fdc\u7a0b SDS server \u83b7\u53d6 secret\u3002</p> <ul> <li>\u901a\u8fc7 Unix Domain Socket \u8bbf\u95ee gRPC SDS server\u3002</li> <li>\u901a\u8fc7 UDS \u8bbf\u95ee gRPC SDS server\u3002</li> <li>\u901a\u8fc7 Envoy gRPC \u8bbf\u95ee SDS server\u3002</li> </ul> <p>\u914d\u7f6e\u8be6\u60c5\u8bf7\u53c2\u8003 Envoy \u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#469-ads","title":"4.6.9 ADS\uff08\u805a\u5408\u53d1\u73b0\u670d\u52a1\uff09","text":"<p>\u867d\u7136 Envoy \u672c\u8d28\u4e0a\u91c7\u7528\u4e86\u6700\u7ec8\u4e00\u81f4\u6027\u6a21\u578b\uff0c\u4f46 ADS \u63d0\u4f9b\u4e86**\u5bf9 API \u66f4\u65b0\u63a8\u9001\u8fdb\u884c\u6392\u5e8f**\u7684\u673a\u4f1a\uff0c\u5e76\u786e\u4fdd\u5355\u4e2a\u7ba1\u7406\u670d\u52a1\u5668\u5bf9 Envoy \u8282\u70b9\u7684 API \u66f4\u65b0\u5177\u6709\u4eb2\u548c\u529b\u3002ADS \u5141\u8bb8\u7ba1\u7406\u670d\u52a1\u5668\u5728\u5355\u4e2a\u53cc\u5411 gRPC \u6d41\u4e0a\u4f20\u9012\u4e00\u4e2a\u6216\u591a\u4e2a API \u53ca\u5176\u8d44\u6e90\u3002\u5426\u5219\uff0c\u4e00\u4e9b API\uff08\u5982 RDS \u548c EDS\uff09\u53ef\u80fd\u9700\u8981\u7ba1\u7406\u591a\u4e2a\u6d41\u5e76\u8fde\u63a5\u5230\u4e0d\u540c\u7684\u7ba1\u7406\u670d\u52a1\u5668\u3002</p> <p>ADS \u901a\u8fc7\u9002\u5f53\u5f97\u6392\u5e8f xDS \u53ef\u4ee5\u65e0\u4e2d\u65ad\u7684\u66f4\u65b0 Enovy \u7684\u914d\u7f6e\u3002\u4f8b\u5982\uff0c\u5047\u8bbe foo.com \u5df2\u6620\u5c04\u5230\u96c6\u7fa4 X\u3002\u6211\u4eec\u5e0c\u671b\u5c06\u8def\u7531\u8868\u4e2d\u5c06\u8be5\u6620\u5c04\u66f4\u6539\u4e3a\u5728\u96c6\u7fa4 Y\u3002\u4e3a\u6b64\uff0c\u5fc5\u987b\u9996\u5148\u63d0\u4f9b X\u3001Y \u8fd9\u4e24\u4e2a\u96c6\u7fa4\u7684 CDS/EDS \u66f4\u65b0\u3002</p> <p>\u5982\u679c\u6ca1\u6709 ADS\uff0cCDS/EDS/RDS \u6d41\u53ef\u80fd\u6307\u5411\u4e0d\u540c\u7684\u7ba1\u7406\u670d\u52a1\u5668\uff0c\u6216\u8005\u4f4d\u4e8e\u9700\u8981\u534f\u8c03\u7684\u4e0d\u540c gRPC\u6d41\u8fde\u63a5\u7684\u540c\u4e00\u7ba1\u7406\u670d\u52a1\u5668\u4e0a\u3002EDS \u8d44\u6e90\u8bf7\u6c42\u53ef\u4ee5\u8de8\u4e24\u4e2a\u4e0d\u540c\u7684\u6d41\u5206\u5f00\uff0c\u4e00\u4e2a\u7528\u4e8e X\uff0c\u4e00\u4e2a\u7528\u4e8e Y\u3002ADS \u5c06\u8fd9\u4e9b\u6d41\u5408\u5e76\u5230\u5355\u4e2a\u6d41\u548c\u5355\u4e2a\u7ba1\u7406\u670d\u52a1\u5668\uff0c\u4ece\u800c\u65e0\u9700\u5206\u5e03\u5f0f\u540c\u6b65\u5c31\u53ef\u4ee5\u6b63\u786e\u5730\u5bf9\u66f4\u65b0\u8fdb\u884c\u6392\u5e8f\u3002\u4f7f\u7528 ADS\uff0c\u7ba1\u7406\u670d\u52a1\u5668\u5c06\u5728\u5355\u4e2a\u6d41\u4e0a\u63d0\u4f9b CDS\u3001EDS \u548c RDS \u66f4\u65b0\u3002</p> <p>ADS \u4ec5\u9002\u7528\u4e8e gRPC \u6d41\uff08\u975eREST\uff09\uff0c\u672c\u6587\u6863\u5bf9\u6b64\u8fdb\u884c\u4e86\u66f4\u5168\u9762\u7684\u63cf\u8ff0\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4610-hds","title":"4.6.10 HDS\uff08\u5065\u5eb7\u53d1\u73b0\u670d\u52a1\uff09","text":"<p>HDS\uff08\u5065\u5eb7\u53d1\u73b0\u670d\u52a1\uff09\u652f\u6301\u7ba1\u7406\u670d\u52a1\u5668\u5bf9\u5176\u7ba1\u7406\u7684 Envoy \u5b9e\u4f8b\u8fdb\u884c\u9ad8\u6548\u7684\u7aef\u70b9\u5065\u5eb7\u53d1\u73b0\u3002\u5355\u4e2a Envoy \u5b9e\u4f8b\u901a\u5e38\u4f1a\u6536\u5230 HDS \u6307\u4ee4\uff0c\u4ee5\u68c0\u67e5\u6240\u6709\u7aef\u70b9\u7684\u5b50\u96c6\uff08subset\uff09\u3002\u8fd0\u884c\u72b6\u51b5\u68c0\u67e5\u5b50\u96c6\u53ef\u80fd\u5e76\u4e0d\u662f Envoy \u5b9e\u4f8b EDS \u7aef\u70b9\u7684\u5b50\u96c6\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#47-envoy-api","title":"4.7 Envoy \u9ad8\u7ea7 API","text":"<p>\u9664\u4e86 xDS API\uff0cEnvoy \u8fd8\u63d0\u4f9b\u5982\u4e0b\u9ad8\u7ea7 API\uff1a</p> <ul> <li>MS\uff08Metric Service\uff09\uff1a\u5c06 metric \u63a8\u9001\u5230\u8fdc\u7aef\u670d\u52a1\u5668</li> <li>RLS\uff08Rate Limit Service\uff09\uff1a\u901f\u7387\u9650\u5236\u670d\u52a1</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#471-msmetric","title":"4.7.1 MS\uff08Metric \u670d\u52a1\uff09","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#472-rls","title":"4.7.2 RLS\uff08\u901f\u7387\u9650\u5236\u670d\u52a1\uff09","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#_6","title":"\u4e94 \u63a7\u5236\u5c42\u9762","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#51","title":"5.1 \u7ec4\u4ef6\u6982\u89c8","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#511-istio","title":"5.1.1 istio \u7ec4\u4ef6\u6784\u6210","text":"<p>\u4ee5\u4e0b\u662fistio 1.1 \u5b98\u65b9\u67b6\u6784\u56fe:</p> <p></p> <p>\u867d\u7136 Istio \u652f\u6301\u591a\u4e2a\u5e73\u53f0\uff0c\u4f46\u5c06\u5176\u4e0e Kubernetes \u7ed3\u5408\u4f7f\u7528\uff0c\u5176\u4f18\u52bf\u4f1a\u66f4\u5927\uff0cIstio \u5bf9 Kubernetes \u5e73\u53f0\u652f\u6301\u4e5f\u662f\u6700\u5b8c\u5584\u7684\uff0c\u672c\u6587\u5c06\u57fa\u4e8e Istio + Kubernetes \u8fdb\u884c\u5c55\u5f00\u3002</p> <p>\u5728\u5b89\u88c5\u4e86grafana, prometheus, kiali, jaeger\u7b49\u540e\u7aef\u7ec4\u4ef6\u7684\u60c5\u51b5\u4e0b, \u4e00\u4e2a\u5b8c\u6574\u7684\u63a7\u5236\u9762\u7ec4\u4ef6\u5e94\u8be5\u5305\u62ec\u4ee5\u4e0bpod\uff1a</p> <pre><code>% kubectl -n istio-system get pod\nNAME                                          READY     STATUS\ngrafana-5f54556df5-s4xr4                      1/1       Running\nistio-citadel-775c6cfd6b-8h5gt                1/1       Running\nistio-galley-675d75c954-kjcsg                 1/1       Running\nistio-ingressgateway-6f7b477cdd-d8zpv         1/1       Running\nistio-pilot-7dfdb48fd8-92xgt                  2/2       Running\nistio-policy-544967d75b-p6qkk                 2/2       Running\nistio-sidecar-injector-5f7894f54f-w7f9v       1/1       Running\nistio-telemetry-777876dc5d-msclx              2/2       Running\nistio-tracing-5fbc94c494-558fp                1/1       Running\nkiali-7c6f4c9874-vzb4t                        1/1       Running\nprometheus-66b7689b97-w9glt                   1/1       Running\n</code></pre> <p>\u5c06istio\u7cfb\u7edf\u7ec4\u4ef6\u7ec6\u5316\u5230\u8fdb\u7a0b\u7ea7\u522b, \u5927\u6982\u662f\u8fd9\u4e2a\u6837\u5b50\uff1a</p> <p></p> <p>Service Mesh \u7684 Sidecar \u6a21\u5f0f\u8981\u6c42\u5bf9\u6570\u636e\u9762\u7684\u7528\u6237 Pod \u8fdb\u884c\u4ee3\u7406\u7684\u6ce8\u5165, \u6ce8\u5165\u7684\u4ee3\u7406\u5bb9\u5668\u4f1a\u53bb\u5904\u7406\u670d\u52a1\u6cbb\u7406\u9886\u57df\u7684\u5404\u79cd\u300c\u810f\u6d3b\u7d2f\u6d3b\u300d, \u4f7f\u5f97\u7528\u6237\u5bb9\u5668\u53ef\u4ee5\u4e13\u5fc3\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u3002</p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa, Istio \u63a7\u5236\u9762\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u590d\u6742\u7684\u5fae\u670d\u52a1\u7cfb\u7edf, \u8be5\u7cfb\u7edf\u5305\u542b\u591a\u4e2a\u7ec4\u4ef6 Pod, \u6bcf\u4e2a\u7ec4\u4ef6\u5404\u53f8\u5176\u804c, \u65e2\u6709\u5355\u5bb9\u5668 Pod, \u4e5f\u6709\u591a\u5bb9\u5668 Pod, \u65e2\u6709\u5355\u8fdb\u7a0b\u5bb9\u5668, \u4e5f\u6709\u591a\u8fdb\u7a0b\u5bb9\u5668, \u6bcf\u4e2a\u7ec4\u4ef6\u4f1a\u8c03\u7528\u4e0d\u540c\u7684\u547d\u4ee4, \u5404\u7ec4\u4ef6\u4e4b\u95f4\u4f1a\u901a\u8fc7 RPC \u8fdb\u884c\u534f\u4f5c, \u5171\u540c\u5b8c\u6210\u5bf9\u6570\u636e\u9762\u7528\u6237\u670d\u52a1\u7684\u7ba1\u63a7\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#512-istio","title":"5.1.2  istio \u6e90\u7801, \u955c\u50cf\u548c\u547d\u4ee4","text":"<p>Istio \u9879\u76ee\u4ee3\u7801\u4e3b\u8981\u7531\u4ee5\u4e0b\u4e24\u4e2a git \u4ed3\u5e93\u7ec4\u6210:</p> \u4ed3\u5e93\u5730\u5740 \u8bed\u8a00 \u6a21\u5757 https://github.com/istio/istio Go \u5305\u542b istio \u63a7\u5236\u9762\u7684\u5927\u90e8\u5206\u7ec4\u4ef6: pilot, mixer, citadel, galley, sidecar-injector \u7b49 https://github.com/istio/proxy C++ \u5305\u542b istio \u4f7f\u7528\u7684\u8fb9\u8f66\u4ee3\u7406, \u8fd9\u4e2a\u8fb9\u8f66\u4ee3\u7406\u5305\u542b envoy \u548c mixer client \u4e24\u5757\u529f\u80fd https://github.com/istio/api Go \u5305\u542b istio \u7ec4\u4ef6\u4e4b\u95f4\u7684 API \u4ee5\u53ca\u8d44\u6e90\u914d\u7f6e\u5b9a\u4e49, \u4f7f\u7528 protobuf \u8fdb\u884c\u5b9a\u4e49"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#5121-istioistio","title":"5.1.2.1 istio/istio","text":"<p>https://github.com/istio/istio \u5305\u542b\u7684\u4e3b\u8981\u7684\u955c\u50cf\u548c\u547d\u4ee4:</p> \u5bb9\u5668\u540d \u955c\u50cf\u540d \u542f\u52a8\u547d\u4ee4 \u6e90\u7801\u5165\u53e3 Istio_init istio/proxy_init istio-iptables.sh istio/tools/deb/istio-iptables.sh istio-proxy istio/proxyv2 pilot-agent istio/pilot/cmd/pilot-agent sidecar-injector-webhook istio/sidecar_injector sidecar-injector istio/pilot/cmd/sidecar-injector discovery istio/pilot pilot-discovery istio/pilot/cmd/pilot-discovery galley istio/galley galley istio/galley/cmd/galley mixer istio/mixer mixs istio/mixer/cmd/mixs citadel istio/citadel istio_ca istio/security/cmd/istio_ca <p>\u53e6\u5916\u8fd8\u67092\u4e2a\u547d\u4ee4\u4e0d\u5728\u4e0a\u56fe\u4e2d\u4f7f\u7528:</p> \u547d\u4ee4 \u6e90\u7801\u5165\u53e3 \u4f5c\u7528 mixc istio/mixer/cmd/mixc \u7528\u4e8e\u548c Mixer server \u4ea4\u4e92\u7684\u5ba2\u6237\u7aef node_agent istio/security/cmd/node_agent \u7528\u4e8e node \u4e0a\u5b89\u88c5\u5b89\u5168\u4ee3\u7406, \u8fd9\u5728 Mesh Expansion \u7279\u6027\u4e2d\u4f1a\u7528\u5230, \u5373 k8s \u548c vm \u6253\u901a"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#5122-istioproxy","title":"5.1.2.2 istio/proxy","text":"<p>https://github.com/istio/proxy \u8be5\u9879\u76ee\u672c\u8eab\u4e0d\u4f1a\u4ea7\u51fa\u955c\u50cf, \u5b83\u53ef\u4ee5\u7f16\u8bd1\u51fa\u4e00\u4e2a <code>name = \"Envoy\"</code> \u7684\u4e8c\u8fdb\u5236\u7a0b\u5e8f, \u8be5\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u4f1a\u88ab\u52a0\u5165\u5230 istio \u7684\u8fb9\u8f66\u5bb9\u5668\u955c\u50cf <code>istio/proxyv2</code> \u4e2d\u3002</p> <p>istio proxy \u9879\u76ee\u4f7f\u7528\u7684\u7f16\u8bd1\u65b9\u5f0f\u662f Google \u51fa\u54c1\u7684 bazel , bazel \u53ef\u4ee5\u76f4\u63a5\u5728\u7f16\u8bd1\u4e2d\u5f15\u5165\u7b2c\u4e09\u65b9\u5e93\uff0c\u52a0\u8f7d\u7b2c\u4e09\u65b9\u6e90\u7801\u3002</p> <p>\u8fd9\u4e2a\u9879\u76ee\u5305\u542b\u4e86\u5bf9 Envoy \u6e90\u7801\u7684\u5f15\u7528\uff0c\u8fd8\u5728\u6b64\u57fa\u7840\u4e0a\u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u8fd9\u4e9b\u6269\u5c55\u662f\u901a\u8fc7 Envoy filter\uff08\u8fc7\u6ee4\u5668\uff09\u7684\u5f62\u5f0f\u6765\u63d0\u4f9b\uff0c\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u8ba9\u8fb9\u8f66\u4ee3\u7406\u5c06\u7b56\u7565\u6267\u884c\u51b3\u7b56\u59d4\u6258\u7ed9 Mixer\uff0c\u56e0\u6b64\u53ef\u4ee5\u7406\u89e3\u4e3a istio proxy \u8fd9\u4e2a\u9879\u76ee\u6709\u4e24\u5927\u529f\u80fd\u6a21\u5757:</p> <ol> <li>Envoy: \u4f7f\u7528\u5230 Envoy \u7684\u5168\u90e8\u529f\u80fd\u3002</li> <li>mixer client: \u7b56\u7565\u548c\u9065\u6d4b\u76f8\u5173\u7684\u5ba2\u6237\u7aef\u5b9e\u73b0, \u57fa\u4e8e Envoy \u505a\u6269\u5c55\uff0c\u901a\u8fc7 RPC \u4e0e Mixer server \u8fdb\u884c\u4ea4\u4e92, \u5b9e\u73b0\u7b56\u7565\u7ba1\u63a7\u548c\u9065\u6d4b\u3002</li> </ol>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#5123-istioapi","title":"5.1.2.3 istio/api","text":"<p>https://github.com/istio/api \u4f7f\u7528 protobuf \u5bf9 Istio API \u548c\u8d44\u6e90\u8fdb\u884c\u5b9a\u4e49, \u5305\u62ec:</p> <ul> <li>\u7ec4\u4ef6\u4e4b\u95f4\u7684 API, \u5982 Mesh Configuration Protocol (MCP) \u7b49\u3002</li> <li>\u6240\u6709\u7684 Istio CRD, \u5982 VirtualService\u3001DestinationRule \u7b49\u3002</li> </ul> <p>\u8be5\u9879\u76ee\u4f1a\u4f5c\u4e3a\u4f9d\u8d56\u5305\u88ab istio \u4e3b\u9879\u76ee\u5f15\u7528\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#52-sidecar-injector","title":"5.2 Sidecar Injector","text":"<p>\u7528\u6237\u7a7a\u95f4\u7684 Pod \u8981\u60f3\u52a0\u5165 mesh, \u9996\u5148\u9700\u8981\u6ce8\u5165 sidecar \u5bb9\u5668, istio \u63d0\u4f9b\u4e86 2 \u79cd\u65b9\u5f0f\u5b9e\u73b0\u6ce8\u5165:</p> <ul> <li>\u81ea\u52a8\u6ce8\u5165: \u5229\u7528 Kubernetes Dynamic Admission Webhooks \u5bf9 \u65b0\u5efa\u7684 pod \u8fdb\u884c\u6ce8\u5165: initContainer + sidecar</li> <li>\u624b\u52a8\u6ce8\u5165: \u4f7f\u7528\u547d\u4ee4<code>istioctl kube-inject</code></li> </ul> <p>\u300c\u6ce8\u5165\u300d\u672c\u8d28\u4e0a\u5c31\u662f\u4fee\u6539 Pod \u7684\u8d44\u6e90\u5b9a\u4e49, \u6dfb\u52a0\u76f8\u5e94\u7684 sidecar \u5bb9\u5668\u5b9a\u4e49, \u5185\u5bb9\u5305\u62ec 2 \u4e2a\u65b0\u5bb9\u5668:</p> <ul> <li>\u540d\u4e3a<code>istio-init</code>\u7684 initContainer: \u901a\u8fc7\u914d\u7f6e iptables \u6765\u52ab\u6301 Pod \u4e2d\u7684\u6d41\u91cf</li> <li>\u540d\u4e3a<code>istio-proxy</code>\u7684 sidecar \u5bb9\u5668: \u4e24\u4e2a\u8fdb\u7a0b pilot-agent \u548c envoy, pilot-agent \u8fdb\u884c\u521d\u59cb\u5316\u5e76\u542f\u52a8 envoy</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#521-dynamic-admission-control","title":"5.2.1 Dynamic Admission Control","text":"<p>kubernetes \u7684\u51c6\u5165\u63a7\u5236(Admission Control)\u6709 2 \u79cd:</p> <ul> <li>Built in Admission Control: \u8fd9\u4e9b Admission \u6a21\u5757\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u7f16\u8bd1\u8fdb api server, \u56e0\u6b64\u9700\u8981\u4fee\u6539\u548c\u91cd\u542f kube-apiserver</li> <li>Dynamic Admission Control: \u53ef\u4ee5\u90e8\u7f72\u5728 kube-apiserver \u4e4b\u5916, \u540c\u65f6\u65e0\u9700\u4fee\u6539\u6216\u91cd\u542f kube-apiserver\u3002</li> </ul> <p>\u5176\u4e2d, Dynamic Admission Control \u5305\u542b 2 \u79cd\u5f62\u5f0f:</p> <ul> <li> <p>Admission Webhooks: \u8be5 controller \u63d0\u4f9b http server, \u88ab\u52a8\u63a5\u53d7 kube-apiserver \u5206\u53d1\u7684\u51c6\u5165\u8bf7\u6c42\u3002</p> </li> <li> <p>Initializers: \u8be5 controller \u4e3b\u52a8 list and watch \u5173\u6ce8\u7684\u8d44\u6e90\u5bf9\u8c61, \u5bf9 watch \u5230\u7684\u672a\u521d\u59cb\u5316\u5bf9\u8c61\u8fdb\u884c\u76f8\u5e94\u7684\u6539\u9020\u3002</p> </li> </ul> <p>\u5176\u4e2d, Admission Webhooks \u53c8\u5305\u542b 2 \u79cd\u51c6\u5165\u63a7\u5236:</p> <ul> <li> <p>ValidatingAdmissionWebhook</p> </li> <li> <p>MutatingAdmissionWebhook</p> </li> </ul> <p>istio \u4f7f\u7528\u4e86 MutatingAdmissionWebhook \u6765\u5b9e\u73b0\u5bf9\u7528\u6237 Pod \u7684\u6ce8\u5165, \u9996\u5148\u9700\u8981\u4fdd\u8bc1\u4ee5\u4e0b\u6761\u4ef6\u6ee1\u8db3:</p> <ul> <li>\u786e\u4fdd kube-apiserver \u542f\u52a8\u53c2\u6570 \u5f00\u542f\u4e86 MutatingAdmissionWebhook</li> <li>\u7ed9 namespace \u589e\u52a0 label: <code>kubectl label namespace default istio-injection=enabled</code></li> <li>\u540c\u65f6\u8fd8\u8981\u4fdd\u8bc1 kube-apiserver \u7684 aggregator layer \u5f00\u542f: <code>--enable-aggregator-routing=true</code> \u4e14\u8bc1\u4e66\u548c api server \u8fde\u901a\u6027\u6b63\u786e\u8bbe\u7f6e\u3002</li> </ul> <p>\u53e6\u5916\u8fd8\u9700\u8981\u4e00\u4e2a\u914d\u7f6e\u5bf9\u8c61, \u6765\u544a\u8bc9 kube-apiserver istio \u5173\u5fc3\u7684\u8d44\u6e90\u5bf9\u8c61\u7c7b\u578b, \u4ee5\u53ca webhook \u7684\u670d\u52a1\u5730\u5740\u3002 \u5982\u679c\u4f7f\u7528 helm \u5b89\u88c5 istio, \u914d\u7f6e\u5bf9\u8c61\u5df2\u7ecf\u6dfb\u52a0\u597d\u4e86, \u67e5\u9605 MutatingWebhookConfiguration:</p> <pre><code>% kubectl get mutatingWebhookConfiguration -oyaml\n- apiVersion: admissionregistration.k8s.io/v1beta1\n  kind: MutatingWebhookConfiguration\n  metadata:\n    name: istio-sidecar-injector\n  webhooks:\n    - clientConfig:\n      service:\n        name: istio-sidecar-injector\n        namespace: istio-system\n        path: /inject\n    name: sidecar-injector.istio.io\n    namespaceSelector:\n      matchLabels:\n        istio-injection: enabled\n    rules:\n    - apiGroups:\n      - \"\"\n      apiVersions:\n      - v1\n      operations:\n      - CREATE\n      resources:\n      - pods\n</code></pre> <p>\u8be5\u914d\u7f6e\u544a\u8bc9 kube-apiserver: \u547d\u540d\u7a7a\u95f4 istio-system \u4e2d\u7684\u670d\u52a1 <code>istio-sidecar-injector</code>(\u9ed8\u8ba4 443 \u7aef\u53e3), \u901a\u8fc7\u8def\u7531<code>/inject</code>, \u5904\u7406<code>v1/pods</code>\u7684 CREATE, \u540c\u65f6 pod \u9700\u8981\u6ee1\u8db3\u547d\u540d\u7a7a\u95f4<code>istio-injection: enabled</code>, \u5f53\u6709\u7b26\u5408\u6761\u4ef6\u7684 pod \u88ab\u521b\u5efa\u65f6, kube-apiserver \u5c31\u4f1a\u5bf9\u8be5\u670d\u52a1\u53d1\u8d77\u8c03\u7528, \u670d\u52a1\u8fd4\u56de\u7684\u5185\u5bb9\u6b63\u662f\u6dfb\u52a0\u4e86 sidecar \u6ce8\u5165\u7684 pod \u5b9a\u4e49\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#522-sidecar","title":"5.2.2 Sidecar \u6ce8\u5165\u5185\u5bb9\u5206\u6790","text":"<p>\u67e5\u770b Pod <code>istio-sidecar-injector</code>\u7684 yaml \u5b9a\u4e49:</p> <pre><code>% kubectl -n istio-system get pod istio-sidecar-injector-5f7894f54f-w7f9v -oyaml\n......\n    volumeMounts:\n    - mountPath: /etc/istio/inject\n      name: inject-config\n      readOnly: true\n\n  volumes:\n  - configMap:\n      items:\n      - key: config\n        path: config\n      name: istio-sidecar-injector\n    name: inject-config\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8be5 Pod \u5229\u7528projected volume\u5c06<code>istio-sidecar-injector</code>\u8fd9\u4e2a config map \u7684 config \u6302\u5230\u4e86\u81ea\u5df1\u5bb9\u5668\u8def\u5f84<code>/etc/istio/inject/config</code>, \u8be5 config map \u5185\u5bb9\u6b63\u662f\u6ce8\u5165\u7528\u6237\u7a7a\u95f4 pod \u6240\u9700\u7684\u6a21\u677f\u3002</p> <p>\u5982\u679c\u4f7f\u7528 helm \u5b89\u88c5 istio, \u8be5 configMap \u6a21\u677f\u6e90\u7801\u4f4d\u4e8e: https://github.com/istio/istio/blob/master/install/kubernetes/helm/istio/templates/sidecar-injector-configmap.yaml\u3002</p> <p>\u8be5 config map \u662f\u5728\u5b89\u88c5 istio \u65f6\u6dfb\u52a0\u7684, kubernetes \u4f1a\u81ea\u52a8\u7ef4\u62a4 projected volume \u7684\u66f4\u65b0, \u56e0\u6b64 \u5bb9\u5668 <code>sidecar-injector</code>\u53ea\u9700\u8981\u4ece\u672c\u5730\u6587\u4ef6\u76f4\u63a5\u8bfb\u53d6\u6240\u9700\u914d\u7f6e\u3002</p> <p>\u9ad8\u7ea7\u7528\u6237\u53ef\u4ee5\u6309\u9700\u4fee\u6539\u8fd9\u4e2a\u6a21\u677f\u5185\u5bb9\u3002</p> <pre><code>kubectl -n istio-system get configmap istio-sidecar-injector -o=jsonpath='{.data.config}'\n</code></pre> <p>\u67e5\u770b\u8be5 configMap, <code>data.config</code>\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9(\u7b80\u5316):</p> <pre><code>policy: enabled # \u662f\u5426\u5f00\u542f\u81ea\u52a8\u6ce8\u5165\ntemplate: |-    # \u4f7f\u7528go template \u5b9a\u4e49\u7684pod patch\n  initContainers:\n  [[ if ne (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) \"NONE\" ]]\n  - name: istio-init\n    image: \"docker.io/istio/proxy_init:1.1.0\"\n    ......\n    securityContext:\n      capabilities:\n        add:\n        - NET_ADMIN\n    ......\n  containers:\n  - name: istio-proxy\n    args:\n    - proxy\n    - sidecar\n    ......\n    image: [[ annotation .ObjectMeta `sidecar.istio.io/proxyImage`  \"docker.io/istio/proxyv2:1.1.0\"  ]]\n    ......\n    readinessProbe:\n      httpGet:\n        path: /healthz/ready\n        port: [[ annotation .ObjectMeta `status.sidecar.istio.io/port`  0  ]]\n    ......\n    securityContext:\n      capabilities:\n        add:\n        - NET_ADMIN\n      runAsGroup: 1337\n  ......\n    volumeMounts:\n    ......\n    - mountPath: /etc/istio/proxy\n      name: istio-envoy\n    - mountPath: /etc/certs/\n      name: istio-certs\n      readOnly: true\n      ......\n  volumes:\n  ......\n  - emptyDir:\n      medium: Memory\n    name: istio-envoy\n  - name: istio-certs\n    secret:\n      optional: true\n      [[ if eq .Spec.ServiceAccountName \"\" -]]\n      secretName: istio.default\n      [[ else -]]\n      secretName: [[ printf \"istio.%s\" .Spec.ServiceAccountName ]]\n      ......\n</code></pre> <p>\u5bf9 istio-init \u751f\u6210\u7684\u90e8\u5206\u53c2\u6570\u5206\u6790:</p> <ul> <li><code>-u 1337</code> \u6392\u9664\u7528\u6237 ID \u4e3a 1337\uff0c\u5373 Envoy \u81ea\u8eab\u7684\u6d41\u91cf</li> <li>\u89e3\u6790\u7528\u6237\u5bb9\u5668<code>.Spec.Containers</code>, \u83b7\u5f97\u5bb9\u5668\u7684\u7aef\u53e3\u5217\u8868, \u4f20\u5165<code>-b</code>\u53c2\u6570(\u5165\u7ad9\u7aef\u53e3\u63a7\u5236)</li> <li>\u6307\u5b9a\u8981\u4ece\u91cd\u5b9a\u5411\u5230 Envoy \u4e2d\u6392\u9664\uff08\u53ef\u9009\uff09\u7684\u5165\u7ad9\u7aef\u53e3\u5217\u8868, \u9ed8\u8ba4\u5199\u5165<code>-d 15020</code>, \u6b64\u7aef\u53e3\u662f sidecar \u7684 status server</li> <li>\u8d4b\u4e88\u8be5\u5bb9\u5668<code>NET_ADMIN</code> \u80fd\u529b, \u5141\u8bb8\u5bb9\u5668 istio-init \u8fdb\u884c\u7f51\u7edc\u7ba1\u7406\u64cd\u4f5c</li> </ul> <p>\u5bf9 istio-proxy \u751f\u6210\u7684\u90e8\u5206\u53c2\u6570\u5206\u6790:</p> <ul> <li>\u542f\u52a8\u53c2\u6570<code>proxy sidecar xxx</code> \u7528\u4ee5\u5b9a\u4e49\u8be5\u8282\u70b9\u7684\u4ee3\u7406\u7c7b\u578b(NodeType)</li> <li>\u9ed8\u8ba4\u7684 status server \u7aef\u53e3<code>--statusPort=15020</code></li> <li>\u89e3\u6790\u7528\u6237\u5bb9\u5668<code>.Spec.Containers</code>, \u83b7\u53d6\u7528\u6237\u5bb9\u5668\u7684 application Ports, \u7136\u540e\u8bbe\u7f6e\u5230 sidecar \u7684\u542f\u52a8\u53c2\u6570<code>--applicationPorts</code>\u4e2d, \u8be5\u53c2\u6570\u4f1a\u6700\u7ec8\u4f20\u9012\u7ed9 envoy, \u7528\u4ee5\u786e\u5b9a\u54ea\u4e9b\u7aef\u53e3\u6d41\u91cf\u5c5e\u4e8e\u8be5\u4e1a\u52a1\u5bb9\u5668\u3002</li> <li>\u8bbe\u7f6e<code>/healthz/ready</code> \u4f5c\u4e3a\u8be5\u4ee3\u7406\u7684 readinessProbe</li> <li>\u540c\u6837\u8d4b\u4e88\u8be5\u5bb9\u5668<code>NET_ADMIN</code>\u80fd\u529b</li> </ul> <p>\u53e6\u5916<code>istio-sidecar-injector</code>\u8fd8\u7ed9\u5bb9\u5668<code>istio-proxy</code>\u6302\u4e86 2 \u4e2a volumes:</p> <ul> <li> <p>\u540d\u4e3a<code>istio-envoy</code>\u7684 emptydir volume, \u6302\u8f7d\u5230\u5bb9\u5668\u76ee\u5f55<code>/etc/istio/proxy</code>, \u4f5c\u4e3a envoy \u7684\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55</p> </li> <li> <p>\u540d\u4e3a<code>istio-certs</code>\u7684 secret volume, \u9ed8\u8ba4 secret \u540d\u4e3a<code>istio.default</code>, \u6302\u8f7d\u5230\u5bb9\u5668\u76ee\u5f55<code>/etc/certs/</code>, \u5b58\u653e\u76f8\u5173\u7684\u8bc1\u4e66, \u5305\u62ec\u670d\u52a1\u7aef\u8bc1\u4e66, \u548c\u53ef\u80fd\u7684 mtls \u5ba2\u6237\u7aef\u8bc1\u4e66</p> </li> </ul> <pre><code>% kubectl exec productpage-v1-6597cb5df9-xlndw -c istio-proxy -- ls /etc/certs/\ncert-chain.pem\nkey.pem\nroot-cert.pem\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#_7","title":"\u516d \u6d41\u91cf\u7ba1\u7406","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#61","title":"6.1 \u6d41\u91cf\u7ba1\u7406","text":"<p>\u8fd9\u4e00\u7ae0\u8282\u5c06\u5e26\u5927\u5bb6\u4e86\u89e3 Istio \u6d41\u91cf\u7ba1\u7406\u4e2d\u7684\u5404\u79cd\u6982\u5ff5\u7684\u542b\u4e49\u53ca\u8868\u793a\u65b9\u6cd5\u3002</p> <p>\u6d41\u91cf\u7ba1\u7406\u662f Istio \u4e2d\u7684\u6700\u57fa\u7840\u529f\u80fd\uff0c\u4f7f\u7528 Istio \u7684\u6d41\u91cf\u7ba1\u7406\u6a21\u578b\uff0c\u672c\u8d28\u4e0a\u662f\u5c06\u6d41\u91cf\u4e0e\u57fa\u7840\u8bbe\u65bd\u6269\u5bb9\u89e3\u8026\uff0c\u8ba9\u8fd0\u7ef4\u4eba\u5458\u53ef\u4ee5\u901a\u8fc7 Pilot \u6307\u5b9a\u6d41\u91cf\u9075\u5faa\u4ec0\u4e48\u89c4\u5219\uff0c\u800c\u4e0d\u662f\u6307\u5b9a\u54ea\u4e9b pod/VM \u5e94\u8be5\u63a5\u6536\u6d41\u91cf\u2014\u2014Pilot \u548c\u667a\u80fd Envoy \u4ee3\u7406\u4f1a\u5e2e\u6211\u4eec\u641e\u5b9a\u3002</p> <p>\u6240\u8c13\u6d41\u91cf\u7ba1\u7406\u662f\u6307\uff1a</p> <ul> <li>\u63a7\u5236\u670d\u52a1\u4e4b\u95f4\u7684\u8def\u7531\uff1a\u901a\u8fc7\u5728 <code>VirtualService</code> \u4e2d\u7684\u89c4\u5219\u6761\u4ef6\u5339\u914d\u6765\u8bbe\u7f6e\u8def\u7531\uff0c\u53ef\u4ee5\u5728\u670d\u52a1\u95f4\u62c6\u5206\u6d41\u91cf\u3002</li> <li>\u63a7\u5236\u8def\u7531\u4e0a\u6d41\u91cf\u7684\u884c\u4e3a\uff1a\u8bbe\u5b9a\u597d\u8def\u7531\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5728\u8def\u7531\u4e0a\u6307\u5b9a\u8d85\u65f6\u548c\u91cd\u8bd5\u673a\u5236\uff0c\u4f8b\u5982\u8d85\u65f6\u65f6\u95f4\u3001\u91cd\u8bd5\u6b21\u6570\u7b49\uff1b\u505a\u9519\u8bef\u6ce8\u5165\u3001\u8bbe\u7f6e\u65ad\u8def\u5668\u7b49\u3002\u53ef\u4ee5\u7531 <code>VirtualService</code> \u548c <code>DestinationRule</code> \u5171\u540c\u5b8c\u6210\u3002</li> <li>\u663e\u5f0f\u5730\u5411\u7f51\u683c\u4e2d\u6ce8\u518c\u670d\u52a1\uff1a\u663e\u793a\u5730\u5f15\u5165 Service Mesh \u5185\u90e8\u6216\u5916\u90e8\u7684\u670d\u52a1\uff0c\u7eb3\u5165\u670d\u52a1\u7f51\u683c\u7ba1\u7406\u3002\u7531 <code>ServiceEntry</code> \u5b9e\u73b0\u3002</li> <li>\u63a7\u5236\u7f51\u683c\u8fb9\u7f18\u7684\u5357\u5317\u5411\u6d41\u91cf\uff1a\u4e3a\u4e86\u7ba1\u7406\u8fdb\u5165 Istio service mesh \u7684\u5357\u5317\u5411\u5165\u53e3\u6d41\u91cf\uff0c\u9700\u8981\u521b\u5efa <code>Gateway</code> \u5bf9\u8c61\u5e76\u4e0e <code>VirtualService</code> \u7ed1\u5b9a\u3002</li> </ul> <p>\u5173\u4e8e\u6d41\u91cf\u7ba1\u7406\u7684\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u8003 Istio \u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#62","title":"6.2 \u6d41\u91cf\u7ba1\u7406\u57fa\u7840\u6982\u5ff5","text":"<p>\u4e0b\u9762\u5c06\u5e26\u60a8\u4e86\u89e3 Istio \u6d41\u91cf\u7ba1\u7406\u76f8\u5173\u7684\u57fa\u7840\u6982\u5ff5\u4e0e\u914d\u7f6e\u793a\u4f8b\u3002</p> <ul> <li><code>VirtualService</code> \u5728 Istio \u670d\u52a1\u7f51\u683c\u4e2d\u5b9a\u4e49\u8def\u7531\u89c4\u5219\uff0c\u63a7\u5236\u6d41\u91cf\u8def\u7531\u5230\u670d\u52a1\u4e0a\u7684\u5404\u79cd\u884c\u4e3a\u3002</li> <li><code>DestinationRule</code> \u662f <code>VirtualService</code> \u8def\u7531\u751f\u6548\u540e\uff0c\u914d\u7f6e\u5e94\u7528\u4e0e\u8bf7\u6c42\u7684\u7b56\u7565\u96c6\u3002</li> <li><code>ServiceEntry</code> \u901a\u5e38\u7528\u4e8e\u5728 Istio \u670d\u52a1\u7f51\u683c\u4e4b\u5916\u542f\u7528\u7684\u670d\u52a1\u8bf7\u6c42\u3002</li> <li><code>Gateway</code> \u4e3a HTTP/TCP \u6d41\u91cf\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u6700\u5e38\u89c1\u7684\u662f\u5728\u7f51\u683c\u8fb9\u7f18\u7684\u64cd\u4f5c\uff0c\u4ee5\u542f\u7528\u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\u6d41\u91cf\u3002</li> <li><code>EnvoyFilter</code> \u63cf\u8ff0\u4e86\u9488\u5bf9\u4ee3\u7406\u670d\u52a1\u7684\u8fc7\u6ee4\u5668\uff0c\u7528\u6765\u5b9a\u5236\u7531 Istio Pilot \u751f\u6210\u7684\u4ee3\u7406\u914d\u7f6e\u3002\u4e00\u5b9a\u8981\u8c28\u614e\u4f7f\u7528\u6b64\u529f\u80fd\u3002\u9519\u8bef\u7684\u914d\u7f6e\u5185\u5bb9\u4e00\u65e6\u5b8c\u6210\u4f20\u64ad\uff0c\u53ef\u80fd\u4f1a\u4ee4\u6574\u4e2a\u670d\u52a1\u7f51\u683c\u9677\u5165\u762b\u75ea\u72b6\u6001\u3002\u8fd9\u4e00\u914d\u7f6e\u662f\u7528\u4e8e\u5bf9 Istio \u7f51\u7edc\u7cfb\u7edf\u5185\u90e8\u5b9e\u73b0\u8fdb\u884c\u53d8\u66f4\u7684\u3002</li> </ul> <p>\u6ce8\uff1a\u672c\u6587\u4e2d\u7684\u793a\u4f8b\u5f15\u7528\u81ea Istio \u5b98\u65b9 Bookinfo \u793a\u4f8b\uff0c\u89c1\uff1aIstio \u4ee3\u7801\u5e93\uff0c\u4e14\u5bf9\u4e8e\u914d\u7f6e\u7684\u8bb2\u89e3\u90fd\u4ee5\u5728 Kubernetes \u4e2d\u90e8\u7f72\u7684\u670d\u52a1\u4e3a\u51c6\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#621-virtualservice","title":"6.2.1 VirtualService","text":"<p><code>VirtualService</code> \u6545\u540d\u601d\u4e49\uff0c\u5c31\u662f\u865a\u62df\u670d\u52a1\uff0c\u5728 Istio 1.0 \u4ee5\u524d\u53eb\u505a RouteRule\u3002<code>VirtualService</code> \u4e2d\u5b9a\u4e49\u4e86\u4e00\u7cfb\u5217\u9488\u5bf9\u6307\u5b9a\u670d\u52a1\u7684\u6d41\u91cf\u8def\u7531\u89c4\u5219\u3002\u6bcf\u4e2a\u8def\u7531\u89c4\u5219\u90fd\u662f\u9488\u5bf9\u7279\u5b9a\u534f\u8bae\u7684\u5339\u914d\u89c4\u5219\u3002\u5982\u679c\u6d41\u91cf\u7b26\u5408\u8fd9\u4e9b\u7279\u5f81\uff0c\u5c31\u4f1a\u6839\u636e\u89c4\u5219\u53d1\u9001\u5230\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u7684\u76ee\u6807\u670d\u52a1\uff08\u6216\u8005\u76ee\u6807\u670d\u52a1\u7684\u5b50\u96c6\u6216\u7248\u672c\uff09\u3002VirtualService \u7684\u8be6\u7ec6\u5b9a\u4e49\u548c\u914d\u7f6e\u8bf7\u53c2\u8003\u901a\u4fe1\u8def\u7531\u3002</p> <p>\u6ce8\u610f\uff1a<code>VirtualService</code> \u4e2d\u7684\u89c4\u5219\u662f\u6309\u7167\u5728 YAML \u6587\u4ef6\u4e2d\u7684\u987a\u5e8f\u6267\u884c\u7684\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u5728\u5b58\u5728\u591a\u6761\u89c4\u5219\u65f6\uff0c\u9700\u8981\u614e\u91cd\u8003\u8651\u4f18\u5148\u7ea7\u7684\u539f\u56e0\u3002</p> <p>\u914d\u7f6e\u8bf4\u660e</p> <p>\u4e0b\u9762\u662f <code>VirtualService</code> \u7684\u914d\u7f6e\u8bf4\u660e\u3002</p> \u5b57\u6bb5 \u7c7b\u578b \u63cf\u8ff0 <code>hosts</code> <code>string[]</code> \u5fc5\u8981\u5b57\u6bb5\uff1a\u6d41\u91cf\u7684\u76ee\u6807\u4e3b\u673a\u3002\u53ef\u4ee5\u662f\u5e26\u6709\u901a\u914d\u7b26\u524d\u7f00\u7684 DNS \u540d\u79f0\uff0c\u4e5f\u53ef\u4ee5\u662f IP \u5730\u5740\u3002\u6839\u636e\u6240\u5728\u5e73\u53f0\u60c5\u51b5\uff0c\u8fd8\u53ef\u80fd\u4f7f\u7528\u77ed\u540d\u79f0\u6765\u4ee3\u66ff FQDN\u3002\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u77ed\u540d\u79f0\u5230 FQDN \u7684\u5177\u4f53\u8f6c\u6362\u8fc7\u7a0b\u662f\u8981\u9760\u4e0b\u5c42\u5e73\u53f0\u5b8c\u6210\u7684\u3002\u4e00\u4e2a\u4e3b\u673a\u540d\u53ea\u80fd\u5728\u4e00\u4e2a VirtualService \u4e2d\u5b9a\u4e49\u3002**\u540c\u4e00\u4e2a <code>VirtualService</code> \u4e2d\u53ef\u4ee5\u7528\u4e8e\u63a7\u5236\u591a\u4e2a HTTP \u548c TCP \u7aef\u53e3\u7684\u6d41\u91cf\u5c5e\u6027\u3002Kubernetes \u7528\u6237\u6ce8\u610f\uff1a\u5f53\u4f7f\u7528\u670d\u52a1\u7684\u77ed\u540d\u79f0\u65f6\uff08\u4f8b\u5982\u4f7f\u7528 <code>reviews</code>\uff0c\u800c\u4e0d\u662f <code>reviews.default.svc.cluster.local</code>\uff09\uff0cIstio \u4f1a\u6839\u636e\u89c4\u5219\u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\u6765\u5904\u7406\u8fd9\u4e00\u540d\u79f0\uff0c\u800c\u975e\u670d\u52a1\u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\u3002\u5047\u8bbe \u201cdefault\u201d \u547d\u540d\u7a7a\u95f4\u7684\u4e00\u6761\u89c4\u5219\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a <code>reviews</code>\u7684 <code>host</code> \u5f15\u7528\uff0c\u5c31\u4f1a\u88ab\u89c6\u4e3a <code>reviews.default.svc.cluster.local</code>\uff0c\u800c\u4e0d\u4f1a\u8003\u8651 <code>reviews</code> \u670d\u52a1\u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\u3002**\u4e3a\u4e86\u907f\u514d\u53ef\u80fd\u7684\u9519\u8bef\u914d\u7f6e\uff0c\u5efa\u8bae\u4f7f\u7528 FQDN \u6765\u8fdb\u884c\u670d\u52a1\u5f15\u7528\u3002 <code>hosts</code> \u5b57\u6bb5\u5bf9 HTTP \u548c TCP \u670d\u52a1\u90fd\u662f\u6709\u6548\u7684\u3002\u7f51\u683c\u4e2d\u7684\u670d\u52a1\u4e5f\u5c31\u662f\u5728\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u6ce8\u518c\u7684\u670d\u52a1\uff0c\u5fc5\u987b\u4f7f\u7528\u4ed6\u4eec\u7684\u6ce8\u518c\u540d\u8fdb\u884c\u5f15\u7528\uff1b\u53ea\u6709 <code>Gateway</code> \u5b9a\u4e49\u7684\u670d\u52a1\u624d\u53ef\u4ee5\u4f7f\u7528 IP \u5730\u5740\u3002 <code>gateways</code> <code>string[]</code> <code>Gateway</code> \u540d\u79f0\u5217\u8868\uff0cSidecar \u4f1a\u636e\u6b64\u4f7f\u7528\u8def\u7531\u3002<code>VirtualService</code>\u5bf9\u8c61\u53ef\u4ee5\u7528\u4e8e\u7f51\u683c\u4e2d\u7684 Sidecar\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u4e00\u4e2a\u6216\u591a\u4e2a <code>Gateway</code>\u3002\u8fd9\u91cc\u516c\u5f00\u7684\u9009\u62e9\u6761\u4ef6\u53ef\u4ee5\u5728\u534f\u8bae\u76f8\u5173\u7684\u8def\u7531\u8fc7\u6ee4\u6761\u4ef6\u4e2d\u8fdb\u884c\u8986\u76d6\u3002\u4fdd\u7559\u5b57 <code>mesh</code> \u7528\u6765\u6307\u4ee3\u7f51\u683c\u4e2d\u7684\u6240\u6709 Sidecar\u3002\u5f53\u8fd9\u4e00\u5b57\u6bb5\u88ab\u7701\u7565\u65f6\uff0c\u5c31\u4f1a\u4f7f\u7528\u7f3a\u7701\u503c\uff08<code>mesh</code>\uff09\uff0c\u4e5f\u5c31\u662f\u9488\u5bf9\u7f51\u683c\u4e2d\u7684\u6240\u6709 Sidecar \u751f\u6548\u3002\u5982\u679c\u63d0\u4f9b\u4e86 <code>gateways</code> \u5b57\u6bb5\uff0c\u8fd9\u4e00\u89c4\u5219\u5c31\u53ea\u4f1a\u5e94\u7528\u5230\u58f0\u660e\u7684 <code>Gateway</code> \u4e4b\u4e2d\u3002\u8981\u8ba9\u89c4\u5219\u540c\u65f6\u5bf9 <code>Gateway</code> \u548c\u7f51\u683c\u5185\u670d\u52a1\u751f\u6548\uff0c\u9700\u8981\u663e\u5f0f\u7684\u5c06 <code>mesh</code> \u52a0\u5165 <code>gateways</code> \u5217\u8868\u3002 <code>http</code> <code>HTTPRoute[]</code> HTTP \u6d41\u91cf\u89c4\u5219\u7684\u6709\u5e8f\u5217\u8868\u3002\u8fd9\u4e2a\u5217\u8868\u5bf9\u540d\u79f0\u524d\u7f00\u4e3a <code>http-</code>\u3001<code>http2-</code>\u3001<code>grpc-</code> \u7684\u670d\u52a1\u7aef\u53e3\uff0c\u6216\u8005\u534f\u8bae\u4e3a <code>HTTP</code>\u3001<code>HTTP2</code>\u3001<code>GRPC</code> \u4ee5\u53ca\u7ec8\u7ed3\u7684 TLS\uff0c\u53e6\u5916\u8fd8\u6709\u4f7f\u7528 <code>HTTP</code>\u3001<code>HTTP2</code> \u4ee5\u53ca <code>GRPC</code> \u534f\u8bae\u7684 <code>ServiceEntry</code> \u90fd\u662f\u6709\u6548\u7684\u3002\u8fdb\u5165\u6d41\u91cf\u4f1a\u4f7f\u7528\u5339\u914d\u5230\u7684\u7b2c\u4e00\u6761\u89c4\u5219\u3002 <code>tls</code> <code>TLSRoute[]</code> \u4e00\u4e2a\u6709\u5e8f\u5217\u8868\uff0c\u5bf9\u5e94\u7684\u662f\u900f\u4f20 TLS \u548c HTTPS \u6d41\u91cf\u3002\u8def\u7531\u8fc7\u7a0b\u901a\u5e38\u5229\u7528 <code>ClientHello</code> \u6d88\u606f\u4e2d\u7684 SNI \u6765\u5b8c\u6210\u3002TLS \u8def\u7531\u901a\u5e38\u5e94\u7528\u5728 <code>https-</code>\u3001<code>tls-</code> \u524d\u7f00\u7684\u5e73\u53f0\u670d\u52a1\u7aef\u53e3\uff0c\u6216\u8005\u7ecf <code>Gateway</code> \u900f\u4f20\u7684 HTTPS\u3001TLS \u534f\u8bae\u7aef\u53e3\uff0c\u4ee5\u53ca\u4f7f\u7528 HTTPS \u6216\u8005 TLS \u534f\u8bae\u7684 <code>ServiceEntry</code> \u7aef\u53e3\u4e0a\u3002\u6ce8\u610f\uff1a\u6ca1\u6709\u5173\u8054 VirtualService \u7684 https- \u6216\u8005 tls- \u7aef\u53e3\u6d41\u91cf\u4f1a\u88ab\u89c6\u4e3a\u900f\u4f20 TCP \u6d41\u91cf\u3002 <code>tcp</code> <code>TCPRoute[]</code> \u4e00\u4e2a\u9488\u5bf9\u900f\u4f20 TCP \u6d41\u91cf\u7684\u6709\u5e8f\u8def\u7531\u5217\u8868\u3002TCP \u8def\u7531\u5bf9\u6240\u6709 HTTP \u548c TLS \u4e4b\u5916\u7684\u7aef\u53e3\u751f\u6548\u3002\u8fdb\u5165\u6d41\u91cf\u4f1a\u4f7f\u7528\u5339\u914d\u5230\u7684\u7b2c\u4e00\u6761\u89c4\u5219\u3002 <p>\u793a\u4f8b</p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\u914d\u7f6e\u4e86\u4e00\u4e2a\u540d\u4e3a <code>reviews</code> \u7684 <code>VirtualService</code>\uff0c\u8be5\u914d\u7f6e\u7684\u4f5c\u7528\u662f\u5c06\u6240\u6709\u53d1\u9001\u7ed9 <code>reviews</code>\u670d\u52a1\u7684\u6d41\u91cf\u53d1\u9001\u5230 <code>v1</code> \u7248\u672c\u7684\u5b50\u96c6\u3002</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v1\n</code></pre> <ul> <li>\u8be5\u914d\u7f6e\u4e2d\u6d41\u91cf\u7684\u76ee\u6807\u4e3b\u673a\u662f <code>reviews</code>\uff0c\u5982\u679c\u8be5\u670d\u52a1\u548c\u89c4\u5219\u90e8\u7f72\u5728 Kubernetes \u7684 <code>default</code>namespace \u4e0b\u7684\u8bdd\uff0c\u5bf9\u5e94\u4e8e Kubernetes \u4e2d\u7684\u670d\u52a1\u7684 DNS \u540d\u79f0\u5c31\u662f <code>reviews.default.svc.cluster.local</code>\u3002</li> <li>\u6211\u4eec\u5728 <code>hosts</code> \u914d\u7f6e\u4e86\u670d\u52a1\u7684\u540d\u5b57\u53ea\u662f\u8868\u793a\u8be5\u914d\u7f6e\u662f\u9488\u5bf9 <code>reviews.default.svc.cluster.local</code> \u7684\u670d\u52a1\u7684\u8def\u7531\u89c4\u5219\uff0c\u4f46\u662f\u5177\u4f53\u5c06\u5bf9\u8be5\u670d\u52a1\u7684\u8bbf\u95ee\u7684\u6d41\u91cf\u8def\u7531\u5230\u54ea\u4e9b\u670d\u52a1\u7684\u54ea\u4e9b\u5b9e\u4f8b\u4e0a\uff0c\u5c31\u662f\u8981\u901a\u8fc7 <code>destination</code> \u7684\u914d\u7f6e\u4e86\u3002</li> <li>\u6211\u4eec\u770b\u5230\u4e0a\u9762\u7684 <code>VirtualService</code> \u7684 HTTP \u8def\u7531\u4e2d\u8fd8\u5b9a\u4e49\u4e86\u4e00\u4e2a <code>destination</code>\u3002<code>destination</code> \u7528\u4e8e\u5b9a\u4e49\u5728\u7f51\u7edc\u4e2d\u53ef\u5bfb\u5740\u7684\u670d\u52a1\uff0c\u8bf7\u6c42\u6216\u8fde\u63a5\u5728\u7ecf\u8fc7\u8def\u7531\u89c4\u5219\u7684\u5904\u7406\u4e4b\u540e\uff0c\u5c31\u4f1a\u88ab\u53d1\u9001\u7ed9 <code>destination</code>\u3002<code>destination.host</code> \u5e94\u8be5\u660e\u786e\u6307\u5411\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u7684\u4e00\u4e2a\u670d\u52a1\u3002Istio \u7684\u670d\u52a1\u6ce8\u518c\u8868\u9664\u5305\u542b\u5e73\u53f0\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u7684\u6240\u6709\u670d\u52a1\uff08\u4f8b\u5982 Kubernetes \u670d\u52a1\u3001Consul \u670d\u52a1\uff09\u4e4b\u5916\uff0c\u8fd8\u5305\u542b\u4e86 <code>ServiceEntry</code> \u8d44\u6e90\u6240\u5b9a\u4e49\u7684\u670d\u52a1\u3002<code>VirtualService</code> \u4e2d\u53ea\u5b9a\u4e49\u6d41\u91cf\u53d1\u9001\u7ed9\u54ea\u4e2a\u670d\u52a1\u7684\u8def\u7531\u89c4\u5219\uff0c\u4f46\u662f\u5e76\u4e0d\u77e5\u9053\u8981\u53d1\u9001\u7684\u670d\u52a1\u7684\u5730\u5740\u662f\u4ec0\u4e48\uff0c\u8fd9\u5c31\u9700\u8981 <code>DestinationRule</code> \u6765\u5b9a\u4e49\u4e86\u3002</li> <li><code>subset</code> \u914d\u7f6e\u6d41\u91cf\u76ee\u7684\u5730\u7684\u5b50\u96c6\uff0c\u4e0b\u6587\u4f1a\u8bb2\u5230\u3002<code>VirtualService</code> \u4e2d\u5176\u5b9e\u53ef\u4ee5\u9664\u4e86 <code>hosts</code> \u5b57\u6bb5\u5916\u5176\u4ed6\u4ec0\u4e48\u90fd\u4e0d\u914d\u7f6e\uff0c\u8def\u7531\u89c4\u5219\u53ef\u4ee5\u5728 <code>DestinationRule</code> \u4e2d\u5355\u72ec\u914d\u7f6e\u6765\u8986\u76d6\u6b64\u5904\u7684\u9ed8\u8ba4\u89c4\u5219\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#623-subset","title":"6.2.3 Subset","text":"<p><code>subset</code> \u4e0d\u5c5e\u4e8e Istio \u521b\u5efa\u7684 CRD\uff0c\u4f46\u662f\u5b83\u662f\u4e00\u6761\u91cd\u8981\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u6709\u5fc5\u8981\u5355\u72ec\u8bf4\u660e\u4e0b\u3002<code>subset</code> \u662f\u670d\u52a1\u7aef\u70b9\u7684\u96c6\u5408\uff0c\u53ef\u4ee5\u7528\u4e8e A/B \u6d4b\u8bd5\u6216\u8005\u5206\u7248\u672c\u8def\u7531\u7b49\u573a\u666f\u3002\u53c2\u8003 <code>VirtualService</code> \u6587\u6863\uff0c\u5176\u4e2d\u4f1a\u6709\u66f4\u591a\u8fd9\u65b9\u9762\u5e94\u7528\u7684\u4f8b\u5b50\u3002\u53e6\u5916\u5728 <code>subset</code> \u4e2d\u53ef\u4ee5\u8986\u76d6\u670d\u52a1\u7ea7\u522b\u7684\u5373 <code>VirtualService</code> \u4e2d\u7684\u5b9a\u4e49\u7684\u6d41\u91cf\u7b56\u7565\u3002</p> <p>\u4ee5\u4e0b\u662f<code>subset</code> \u7684\u914d\u7f6e\u4fe1\u606f\u3002\u5bf9\u4e8e Kubernetes \u4e2d\u7684\u670d\u52a1\uff0c\u4e00\u4e2a <code>subset</code> \u76f8\u5f53\u4e8e\u4f7f\u7528 label \u7684\u5339\u914d\u6761\u4ef6\u9009\u51fa\u6765\u7684 <code>service</code>\u3002</p> \u5b57\u6bb5 \u7c7b\u578b \u63cf\u8ff0 <code>name</code> <code>string</code> \u5fc5\u8981\u5b57\u6bb5\u3002\u670d\u52a1\u540d\u548c <code>subset</code> \u540d\u79f0\u53ef\u4ee5\u7528\u4e8e\u8def\u7531\u89c4\u5219\u4e2d\u7684\u6d41\u91cf\u62c6\u5206\u3002 <code>labels</code> <code>map&lt;string,string&gt;</code> \u5fc5\u8981\u5b57\u6bb5\u3002\u4f7f\u7528\u6807\u7b7e\u5bf9\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u7684\u670d\u52a1\u7aef\u70b9\u8fdb\u884c\u7b5b\u9009\u3002 <code>trafficPolicy</code> <code>TrafficPolicy</code> \u5e94\u7528\u5230\u8fd9\u4e00 <code>subset</code> \u7684\u6d41\u91cf\u7b56\u7565\u3002\u7f3a\u7701\u60c5\u51b5\u4e0b <code>subset</code> \u4f1a\u7ee7\u627f <code>DestinationRule</code> \u7ea7\u522b\u7684\u7b56\u7565\uff0c\u8fd9\u4e00\u5b57\u6bb5\u7684\u5b9a\u4e49\u5219\u4f1a\u8986\u76d6\u7f3a\u7701\u7684\u7ee7\u627f\u7b56\u7565\u3002"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#624-destinationrule","title":"6.2.4 DestinationRule","text":"<p><code>DestinationRule</code> \u6240\u5b9a\u4e49\u7684\u7b56\u7565\uff0c\u51b3\u5b9a\u4e86\u7ecf\u8fc7\u8def\u7531\u5904\u7406\u4e4b\u540e\u7684\u6d41\u91cf\u7684\u8bbf\u95ee\u7b56\u7565\u3002\u8fd9\u4e9b\u7b56\u7565\u4e2d\u53ef\u4ee5\u5b9a\u4e49\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e\u3001\u8fde\u63a5\u6c60\u5927\u5c0f\u4ee5\u53ca\u5916\u90e8\u68c0\u6d4b\uff08\u7528\u4e8e\u5728\u8d1f\u8f7d\u5747\u8861\u6c60\u4e2d\u5bf9\u4e0d\u5065\u5eb7\u4e3b\u673a\u8fdb\u884c\u8bc6\u522b\u548c\u9a71\u9010\uff09\u914d\u7f6e\u3002</p> <p>\u914d\u7f6e\u8bf4\u660e</p> <p>\u4e0b\u9762\u662f <code>DestinationRule</code> \u7684\u914d\u7f6e\u8bf4\u660e\u3002</p> \u5b57\u6bb5 \u7c7b\u578b \u63cf\u8ff0 <code>name</code> <code>string</code> \u5fc5\u8981\u5b57\u6bb5\u3002\u670d\u52a1\u540d\u548c <code>subset</code> \u540d\u79f0\u53ef\u4ee5\u7528\u4e8e\u8def\u7531\u89c4\u5219\u4e2d\u7684\u6d41\u91cf\u62c6\u5206\u3002 <code>labels</code> <code>map&lt;string,string&gt;</code> \u5fc5\u8981\u5b57\u6bb5\u3002\u4f7f\u7528\u6807\u7b7e\u5bf9\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u7684\u670d\u52a1\u7aef\u70b9\u8fdb\u884c\u7b5b\u9009\u3002 <code>trafficPolicy</code> <code>TrafficPolicy</code> \u5e94\u7528\u5230\u8fd9\u4e00\u5b50\u96c6\u7684\u6d41\u91cf\u7b56\u7565\u3002\u7f3a\u7701\u60c5\u51b5\u4e0b\u5b50\u96c6\u4f1a\u7ee7\u627f <code>DestinationRule</code> \u7ea7\u522b\u7684\u7b56\u7565\uff0c\u8fd9\u4e00\u5b57\u6bb5\u7684\u5b9a\u4e49\u5219\u4f1a\u8986\u76d6\u7f3a\u7701\u7684\u7ee7\u627f\u7b56\u7565\u3002 <p>\u793a\u4f8b</p> <p>\u4e0b\u9762\u662f\u4e00\u6761\u5bf9 <code>productpage</code> \u670d\u52a1\u7684\u6d41\u91cf\u76ee\u7684\u5730\u7b56\u7565\u7684\u914d\u7f6e\u3002</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: reviews\nspec:\n  host: reviews\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n</code></pre> <p>\u8be5\u8def\u7531\u7b56\u7565\u5c06\u6240\u6709\u5bf9 <code>reviews</code> \u670d\u52a1\u7684\u6d41\u91cf\u8def\u7531\u5230 <code>v1</code> \u7684 subset\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#625-serviceentry","title":"6.2.5 ServiceEntry","text":"<p>Istio \u670d\u52a1\u7f51\u683c\u5185\u90e8\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u4e0e\u5e73\u53f0\u65e0\u5173\u7684\u4f7f\u7528\u901a\u7528\u6a21\u578b\u8868\u793a\u7684\u670d\u52a1\u6ce8\u518c\u8868\uff0c\u5f53\u4f60\u7684\u670d\u52a1\u7f51\u683c\u9700\u8981\u8bbf\u95ee\u5916\u90e8\u670d\u52a1\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u4f7f\u7528 <code>ServiceEntry</code> \u6765\u6dfb\u52a0\u670d\u52a1\u6ce8\u518c\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#626-envoyfilter","title":"6.2.6 EnvoyFilter","text":"<p><code>EnvoyFilter</code> \u63cf\u8ff0\u4e86\u9488\u5bf9\u4ee3\u7406\u670d\u52a1\u7684\u8fc7\u6ee4\u5668\uff0c\u7528\u6765\u5b9a\u5236\u7531 Istio Pilot \u751f\u6210\u7684\u4ee3\u7406\u914d\u7f6e\u3002\u4e00\u5b9a\u8981\u8c28\u614e\u4f7f\u7528\u6b64\u529f\u80fd\u3002\u9519\u8bef\u7684\u914d\u7f6e\u5185\u5bb9\u4e00\u65e6\u5b8c\u6210\u4f20\u64ad\uff0c\u53ef\u80fd\u4f1a\u4ee4\u6574\u4e2a\u670d\u52a1\u7f51\u683c\u9677\u5165\u762b\u75ea\u72b6\u6001\u3002\u8fd9\u4e00\u914d\u7f6e\u662f\u7528\u4e8e\u5bf9 Istio \u7f51\u7edc\u7cfb\u7edf\u5185\u90e8\u5b9e\u73b0\u8fdb\u884c\u53d8\u66f4\u7684\uff0c\u5c5e\u4e8e\u9ad8\u7ea7\u914d\u7f6e\uff0c\u7528\u4e8e\u6269\u5c55 Envoy \u4e2d\u7684\u8fc7\u6ee4\u5668\u7684\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#627-gateway","title":"6.2.7 Gateway","text":"<p>Gateway \u4e3a HTTP/TCP \u6d41\u91cf\u914d\u7f6e\u4e86\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\uff0c\u591a\u6570\u60c5\u51b5\u4e0b\u5728\u7f51\u683c\u8fb9\u7f18\u8fdb\u884c\u64cd\u4f5c\uff0c\u7528\u4e8e\u542f\u7528\u4e00\u4e2a\u670d\u52a1\u7684\u5165\u53e3\uff08ingress\uff09\u6d41\u91cf\uff0c\u76f8\u5f53\u4e8e\u524d\u7aef\u4ee3\u7406\u3002\u4e0e Kubernetes \u7684 Ingress \u4e0d\u540c\uff0cIstio <code>Gateway</code> \u53ea\u914d\u7f6e\u56db\u5c42\u5230\u516d\u5c42\u7684\u529f\u80fd\uff08\u4f8b\u5982\u5f00\u653e\u7aef\u53e3\u6216\u8005 TLS \u914d\u7f6e\uff09\uff0c\u800c Kubernetes \u7684 Ingress \u662f\u4e03\u5c42\u7684\u3002\u5c06 <code>VirtualService</code> \u7ed1\u5b9a\u5230 <code>Gateway</code> \u4e0a\uff0c\u7528\u6237\u5c31\u53ef\u4ee5\u4f7f\u7528\u6807\u51c6\u7684 Istio \u89c4\u5219\u6765\u63a7\u5236\u8fdb\u5165\u7684 HTTP \u548c TCP \u6d41\u91cf\u3002</p> <p>Gateway \u8bbe\u7f6e\u4e86\u4e00\u4e2a\u96c6\u7fa4\u5916\u90e8\u6d41\u91cf\u8bbf\u95ee\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e9b\u670d\u52a1\u7684\u5165\u53e3\uff0c\u800c\u8fd9\u4e9b\u6d41\u91cf\u7a76\u7adf\u5982\u4f55\u8def\u7531\u5230\u90a3\u4e9b\u670d\u52a1\u4e0a\u5219\u9700\u8981\u901a\u8fc7\u914d\u7f6e <code>VirtualServcie</code> \u6765\u7ed1\u5b9a\u3002\u4e0b\u9762\u4ecd\u7136\u4ee5 <code>productpage</code> \u8fd9\u4e2a\u670d\u52a1\u6765\u8bf4\u660e\u3002</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: bookinfo-gateway\nspec:\n  selector:\n    istio: ingressgateway # \u4f7f\u7528\u9ed8\u8ba4\u7684\u63a7\u5236\u5668\n  servers:\n  - port:\n      number: 80\n      name: http\n      protocol: HTTP\n    hosts:\n    - \"*\"\n---\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: bookinfo\nspec:\n  hosts:\n  - \"*\"\n  gateways:\n  - bookinfo-gateway\n  http:\n  - match:\n    - uri:\n        exact: /productpage\n    - uri:\n        exact: /login\n    - uri:\n        exact: /logout\n    - uri:\n        prefix: /api/v1/products\n    route:\n    - destination:\n        host: productpage\n        port:\n          number: 9080\n</code></pre> <p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d <code>bookinfo</code> \u8fd9\u4e2a <code>VirtualService</code> \u4e2d\u7ed1\u5b9a\u5230\u4e86 <code>bookinfo-gateway</code>\u3002<code>bookinfo-gateway</code>\u4f7f\u7528\u4e86\u6807\u7b7e\u9009\u62e9\u5668\u9009\u62e9\u5bf9\u5e94\u7684 Kubernetes pod\uff0c\u5373\u4e0b\u56fe\u4e2d\u7684 pod\u3002</p> <p>\u56fe\u7247 - istio ingress gateway pod</p> <p>\u6211\u4eec\u518d\u770b\u4e0b <code>istio-ingressgateway</code> \u7684 YAML \u5b89\u88c5\u914d\u7f6e\u3002</p> <pre><code># Deployment \u914d\u7f6e\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: istio-ingressgateway\n  namespace: istio-system\n  labels:\n    app: ingressgateway\n    chart: gateways-1.0.0\n    release: RELEASE-NAME\n    heritage: Tiller\n    app: istio-ingressgateway\n    istio: ingressgateway\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: istio-ingressgateway\n        istio: ingressgateway\n      annotations:\n        sidecar.istio.io/inject: \"false\"\n        scheduler.alpha.kubernetes.io/critical-pod: \"\"\n    spec:\n      serviceAccountName: istio-ingressgateway-service-account\n      containers:\n        - name: ingressgateway\n          image: \"gcr.io/istio-release/proxyv2:1.0.0\" # \u5bb9\u5668\u542f\u52a8\u547d\u4ee4\u5165\u53e3\u662f /usr/local/bin/pilot-agent\uff0c\u540e\u9762\u8ddf\u53c2\u6570 proxy \u5c31\u4f1a\u542f\u52a8\u4e00\u4e2a Envoy \u8fdb\u7a0b\n          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 80\n            - containerPort: 443\n            - containerPort: 31400\n            - containerPort: 15011\n            - containerPort: 8060\n            - containerPort: 15030\n            - containerPort: 15031\n          args:\n          - proxy\n          - router\n          - -v\n          - \"2\"\n          - --discoveryRefreshDelay\n          - '1s' #discoveryRefreshDelay\n          - --drainDuration\n          - '45s' #drainDuration\n          - --parentShutdownDuration\n          - '1m0s' #parentShutdownDuration\n          - --connectTimeout\n          - '10s' #connectTimeout\n          - --serviceCluster\n          - istio-ingressgateway\n          - --zipkinAddress\n          - zipkin:9411\n          - --statsdUdpAddress\n          - istio-statsd-prom-bridge:9125\n          - --proxyAdminPort\n          - \"15000\"\n          - --controlPlaneAuthPolicy\n          - NONE\n          - --discoveryAddress\n          - istio-pilot.istio-system:8080\n          resources:\n            requests:\n              cpu: 10m           \n          env:\n          - name: POD_NAME\n            valueFrom:\n              fieldRef:\n                apiVersion: v1\n                fieldPath: metadata.name\n          - name: POD_NAMESPACE\n            valueFrom:\n              fieldRef:\n                apiVersion: v1\n                fieldPath: metadata.namespace\n          - name: INSTANCE_IP\n            valueFrom:\n              fieldRef:\n                apiVersion: v1\n                fieldPath: status.podIP\n          - name: ISTIO_META_POD_NAME\n            valueFrom:\n              fieldRef:\n                fieldPath: metadata.name\n          volumeMounts:\n            ...\n# \u670d\u52a1\u914d\u7f6e\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: istio-ingressgateway\n  namespace: istio-system\n  annotations:\n  labels:\n    chart: gateways-1.0.0\n    release: RELEASE-NAME\n    heritage: Tiller\n    app: istio-ingressgateway\n    istio: ingressgateway\nspec:\n  type: NodePort\n  selector:\n    app: istio-ingressgateway\n    istio: ingressgateway\n  ports:\n    - name: http2 # \u5c06 ingressgateway \u7684 80 \u7aef\u53e3\u6620\u5c04\u5230\u8282\u70b9\u7684 31380 \u7aef\u53e3\u4ee5\u4ee3\u7406 HTTP \u8bf7\u6c42\n      nodePort: 31380\n      port: 80\n      targetPort: 80\n    - name: https\n      nodePort: 31390\n      port: 443\n    - name: tcp\n      nodePort: 31400\n      port: 31400\n    - name: tcp-pilot-grpc-tls\n      port: 15011\n      targetPort: 15011\n    - name: tcp-citadel-grpc-tls\n      port: 8060\n      targetPort: 8060\n    - name: http2-prometheus\n      port: 15030\n      targetPort: 15030\n    - name: http2-grafana\n      port: 15031\n      targetPort: 15031\n</code></pre> <p>\u6211\u4eec\u770b\u5230 <code>ingressgateway</code> \u4f7f\u7528\u7684\u662f <code>proxyv2</code> \u955c\u50cf\uff0c\u8be5\u955c\u50cf\u5bb9\u5668\u7684\u542f\u52a8\u547d\u4ee4\u5165\u53e3\u662f <code>/usr/local/bin/pilot-agent</code>\uff0c\u540e\u9762\u8ddf\u53c2\u6570 proxy \u5c31\u4f1a\u542f\u52a8\u4e00\u4e2a Envoy \u8fdb\u7a0b\uff0c\u56e0\u6b64 Envoy \u65e2\u4f5c\u4e3a sidecar \u4e5f\u4f5c\u4e3a\u8fb9\u7f18\u4ee3\u7406\uff0c<code>egressgateway</code> \u7684\u60c5\u51b5\u4e5f\u662f\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u5b83\u63a7\u5236\u7684\u662f\u96c6\u7fa4\u5185\u90e8\u5bf9\u5916\u96c6\u7fa4\u5916\u90e8\u7684\u8bf7\u6c42\u3002\u8fd9\u6b63\u597d\u9a8c\u8bc1\u4e86\u672c\u6587\u5f00\u5934\u4e2d\u6240\u753b\u7684 Istio Pilot \u67b6\u6784\u56fe\u3002\u8bf7\u6c42 <code>/productpage</code>\u3001<code>/login</code>\u3001<code>/logout</code>\u3001<code>/api/v1/products</code> \u8fd9\u4e9b URL \u7684\u6d41\u91cf\u8f6c\u53d1\u7ed9 <code>productpage</code> \u670d\u52a1\u7684 9080 \u7aef\u53e3\uff0c\u800c\u8fd9\u4e9b\u6d41\u91cf\u8fdb\u5165\u96c6\u7fa4\u5185\u53c8\u662f\u7ecf\u8fc7 <code>ingressgateway</code> pod \u4ee3\u7406\u7684\uff0c\u901a\u8fc7\u8bbf\u95ee <code>ingressgateway</code> pod \u6240\u5728\u7684\u5bbf\u4e3b\u673a\u7684 31380 \u7aef\u53e3\u8fdb\u5165\u96c6\u7fa4\u5185\u90e8\u7684\u3002</p> <p>\u793a\u4f8b</p> <p>\u6211\u4eec\u4ee5\u5b98\u65b9\u7684 <code>bookinfo</code> \u793a\u4f8b\u6765\u89e3\u6790\u6d41\u91cf\u7ba1\u7406\u914d\u7f6e\u3002\u4e0b\u56fe\u662f VirtualService \u548c DestinationRule \u7684\u793a\u610f\u56fe\uff0c\u5176\u4e2d\u53ea\u663e\u793a\u4e86 <code>productpage</code> \u548c <code>reviews</code> \u670d\u52a1\u3002</p> <p>\u56fe\u7247 - VirtualSerivce \u548c DestimationRule \u793a\u610f\u56fe</p> <p>\u5728\u524d\u63d0\u6761\u4ef6\u4e2d\u6211\u90e8\u7f72\u4e86\u8be5\u793a\u4f8b\uff0c\u5e76\u5217\u51fa\u4e86\u8be5\u793a\u4f8b\u4e2d\u7684\u6240\u6709 pod\uff0c\u73b0\u5728\u6211\u4eec\u4f7f\u7528 istioctl \u547d\u4ee4\u6765\u542f\u52a8\u67e5\u770b <code>productpage-v1-745ffc55b7-2l2lw</code> pod \u4e2d\u7684\u6d41\u91cf\u914d\u7f6e\u3002</p> <p>\u67e5\u770b pod \u4e2d Envoy sidecar \u7684\u542f\u52a8\u914d\u7f6e\u4fe1\u606f</p> <p>Bootstrap \u6d88\u606f\u662f Envoy \u914d\u7f6e\u7684\u6839\u672c\u6765\u6e90\uff0cBootstrap \u6d88\u606f\u7684\u4e00\u4e2a\u5173\u952e\u7684\u6982\u5ff5\u662f\u9759\u6001\u548c\u52a8\u6001\u8d44\u6e90\u7684\u4e4b\u95f4\u7684\u533a\u522b\u3002\u4f8b\u5982 Listener \u6216 Cluster \u8fd9\u4e9b\u8d44\u6e90\u65e2\u53ef\u4ee5\u4ece static_resources \u9759\u6001\u7684\u83b7\u5f97\u4e5f\u53ef\u4ee5\u4ece dynamic_resources\u4e2d\u914d\u7f6e\u7684 LDS \u6216 CDS \u4e4b\u7c7b\u7684 xDS \u670d\u52a1\u83b7\u53d6\u3002\u5173\u4e8e xDS \u670d\u52a1\u7684\u8be6\u89e3\u8bf7\u53c2\u8003 Envoy \u4e2d\u7684 xDS REST \u548c gRPC \u534f\u8bae\u8be6\u89e3\u3002</p> <pre><code>$ istioctl proxy-config bootstrap productpage-v1-745ffc55b7-2l2lw -o json\n{\n    \"bootstrap\": {\n        \"node\": {\n            \"id\": \"sidecar~172.33.78.10~productpage-v1-745ffc55b7-2l2lw.default~default.svc.cluster.local\",\n            \"cluster\": \"productpage\",\n            \"metadata\": {\n                    \"INTERCEPTION_MODE\": \"REDIRECT\",\n                    \"ISTIO_PROXY_SHA\": \"istio-proxy:6166ae7ebac7f630206b2fe4e6767516bf198313\",\n                    \"ISTIO_PROXY_VERSION\": \"1.0.0\",\n                    \"ISTIO_VERSION\": \"1.0.0\",\n                    \"POD_NAME\": \"productpage-v1-745ffc55b7-2l2lw\",\n                    \"istio\": \"sidecar\"\n                },\n            \"buildVersion\": \"0/1.8.0-dev//RELEASE\"\n        },\n        \"staticResources\": { # Envoy \u7684\u9759\u6001\u914d\u7f6e\uff0c\u9664\u975e\u9500\u6bc1\u540e\u91cd\u8bbe\uff0c\u5426\u5219\u4e0d\u4f1a\u6539\u53d8\uff0c\u914d\u7f6e\u4e2d\u4f1a\u660e\u786e\u6307\u5b9a\u6bcf\u4e2a\u4e0a\u6e38\u4e3b\u673a\u7684\u5df2\u89e3\u6790\u7f51\u7edc\u540d\u79f0\uff08 IP \u5730\u5740\u3001\u7aef\u53e3\u3001unix \u57df\u5957\u63a5\u5b57\u7b49\uff09\u3002\n            \"clusters\": [\n                {\n                    \"name\": \"xds-grpc\",\n                    \"type\": \"STRICT_DNS\",\n                    \"connectTimeout\": \"10.000s\",\n                    \"hosts\": [\n                        {    # istio-pilot \u7684\u5730\u5740\uff0c\u6307\u5b9a\u63a7\u5236\u5e73\u9762\u5730\u5740\uff0c\u8fd9\u4e2a\u5fc5\u987b\u662f\u901a\u8fc7\u9759\u6001\u7684\u65b9\u5f0f\u914d\u7f6e\u7684\n                            \"socketAddress\": {\n                                \"address\": \"istio-pilot.istio-system\",\n                                \"portValue\": 15010\n                            }\n                        }\n                    ],\n                    \"circuitBreakers\": { # \u65ad\u8def\u5668\u914d\u7f6e\n                        \"thresholds\": [\n                            {\n                                \"maxConnections\": 100000,\n                                \"maxPendingRequests\": 100000,\n                                \"maxRequests\": 100000\n                            },\n                            {\n                                \"priority\": \"HIGH\",\n                                \"maxConnections\": 100000,\n                                \"maxPendingRequests\": 100000,\n                                \"maxRequests\": 100000\n                            }\n                        ]\n                    },\n                    \"http2ProtocolOptions\": {\n\n                    },\n                    \"upstreamConnectionOptions\": { # \u4e0a\u6e38\u8fde\u63a5\u9009\u9879\n                        \"tcpKeepalive\": {\n                            \"keepaliveTime\": 300\n                        }\n                    }\n                },\n                { # zipkin \u5206\u5e03\u5f0f\u8ffd\u8e2a\u5730\u5740\u914d\u7f6e\n                    \"name\": \"zipkin\",\n                    \"type\": \"STRICT_DNS\",\n                    \"connectTimeout\": \"1.000s\",\n                    \"hosts\": [\n                        {\n                            \"socketAddress\": {\n                                \"address\": \"zipkin.istio-system\",\n                                \"portValue\": 9411\n                            }\n                        }\n                    ]\n                }\n            ]\n        }, # \u4ee5\u4e0b\u662f\u52a8\u6001\u914d\u7f6e\n        \"dynamicResources\": {\n            \"ldsConfig\": { # Listener Discovery Service \u914d\u7f6e\uff0c\u76f4\u63a5\u4f7f\u7528 ADS \u914d\u7f6e\uff0c\u6b64\u5904\u4e0d\u7528\u914d\u7f6e\n                \"ads\": {\n\n                }\n            },\n            \"cdsConfig\": { # Cluster Discovery Service \u914d\u7f6e\uff0c\u76f4\u63a5\u4f7f\u7528 ADS \u914d\u7f6e\uff0c\u6b64\u5904\u4e0d\u7528\u914d\u7f6e\n                \"ads\": {\n\n                }\n            },\n            \"adsConfig\": { # Aggregated Discovery Service \u914d\u7f6e\uff0cADS \u4e2d\u96c6\u6210\u4e86 LDS\u3001RDS\u3001CDS\n                \"apiType\": \"GRPC\",\n                \"grpcServices\": [\n                    {\n                        \"envoyGrpc\": {\n                            \"clusterName\": \"xds-grpc\"\n                        }\n                    }\n                ],\n                \"refreshDelay\": \"1.000s\"\n            }\n        },\n        \"statsSinks\": [ # metric \u6c47\u805a\u7684\u5730\u5740\n            {\n                \"name\": \"envoy.statsd\",\n                \"config\": {\n                        \"address\": {\n                                    \"socket_address\": {\n                                                \"address\": \"10.254.109.175\",\n                                                \"port_value\": 9125\n                                            }\n                                }\n                    }\n            }\n        ],\n        \"statsConfig\": {\n            \"useAllDefaultTags\": false\n        },\n        \"tracing\": { # zipkin \u5730\u5740\n            \"http\": {\n                \"name\": \"envoy.zipkin\",\n                \"config\": {\n                        \"collector_cluster\": \"zipkin\"\n                    }\n            }\n        },\n        \"admin\": {\n            \"accessLogPath\": \"/dev/stdout\",\n            \"address\": {\n                \"socketAddress\": {\n                    \"address\": \"127.0.0.1\",\n                    \"portValue\": 15000\n                }\n            }\n        }\n    },\n    \"lastUpdated\": \"2018-09-04T03:38:45.645Z\"\n}\n</code></pre> <p>\u4ee5\u4e0a\u4e3a\u521d\u59cb\u4fe1\u606f\u3002</p> <p>\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a <code>reviews</code> \u7684 <code>VirtualService</code>\u3002</p> <pre><code>$ cat&lt;&lt;EOF | istioctl create -f -\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v1\nEOF\n</code></pre> <p>\u4e0a\u9762\u7684 <code>VirtualService</code> \u5b9a\u4e49\u53ea\u662f\u5b9a\u4e49\u4e86\u8bbf\u95ee <code>reviews</code> \u670d\u52a1\u7684\u6d41\u91cf\u8981\u5168\u90e8\u6d41\u5411 <code>reviews</code>\u670d\u52a1\u7684 <code>v1</code>\u5b50\u96c6\uff0c\u81f3\u4e8e\u54ea\u4e9b\u5b9e\u4f8b\u662f <code>v1</code> \u5b50\u96c6\uff0c<code>VirtualService</code> \u4e2d\u5e76\u6ca1\u6709\u5b9a\u4e49\uff0c\u8fd9\u5c31\u9700\u8981\u518d\u521b\u5efa\u4e2a <code>DestinationRule</code>\u3002</p> <pre><code>$ cat &lt;&lt;EOF | istioctl create -f -\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: reviews\nspec:\n  host: reviews\n  subsets:\n  - name: v1\n    labels:\n      version: v1\nEOF\n</code></pre> <p>\u540c\u65f6\u8fd8\u53ef\u4ee5\u4e3a\u6bcf\u4e2a <code>subset</code> \u8bbe\u7f6e\u8d1f\u8f7d\u5747\u8861\u89c4\u5219\u3002\u8fd9\u91cc\u9762\u4e5f\u53ef\u4ee5\u540c\u65f6\u521b\u5efa\u591a\u4e2a\u5b50\u96c6\uff0c\u4f8b\u5982\u540c\u65f6\u521b\u5efa3\u4e2a <code>subset</code> \u5206\u522b\u5bf9\u5e943\u4e2a\u7248\u672c\u7684\u5b9e\u4f8b\u3002</p> <pre><code>$ cat &lt;&lt;EOF | istioctl create -f -\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: reviews\nspec:\n  host: reviews\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n  - name: v2\n    labels:\n      version: v2\n  - name: v3\n    labels:\n      version: v3\nEOF\n</code></pre> <p>\u540c\u65f6\u914d\u7f6e\u4e86\u4e09\u4e2a <code>subset</code> \u5f53\u4f60\u9700\u8981\u5207\u5206\u6d41\u91cf\u65f6\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539 <code>VirtualService</code> \u4e2d <code>destination</code> \u91cc\u7684 <code>subset</code> \u5373\u53ef\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u767e\u5206\u6bd4\u62c6\u5206\u6d41\u91cf\uff0c\u914d\u7f6e\u8d85\u65f6\u548c\u91cd\u8bd5\uff0c\u8fdb\u884c\u9519\u8bef\u6ce8\u5165\u7b49\uff0c\u8be6\u89c1\u6d41\u91cf\u7ba1\u7406</p> <p>\u5f53\u7136\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u53ea\u662f\u7b80\u5355\u7684\u5c06\u6d41\u91cf\u5168\u90e8\u5bfc\u5230\u67d0\u4e2a <code>VirtualService</code> \u7684 <code>subset</code> \u4e2d\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u5176\u4ed6\u9650\u5b9a\u6761\u4ef6\u5982 HTTP headers\u3001pod \u7684 label\u3001URL \u7b49\u3002</p> <p>\u6b64\u65f6\u518d\u67e5\u8be2 <code>productpage-v1-745ffc55b7-2l2lw</code> pod \u7684\u914d\u7f6e\u4fe1\u606f\u3002</p> <pre><code>$ istioctl proxy-config clusters productpage-v1-8d69b45c-bcjqv|grep reviews\nreviews.default.svc.cluster.local                           9080      -          outbound      EDS\nreviews.default.svc.cluster.local                           9080      v1         outbound      EDS\nreviews.default.svc.cluster.local                           9080      v2         outbound      EDS\nreviews.default.svc.cluster.local                           9080      v3         outbound      EDS\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 <code>reviews</code> \u670d\u52a1\u7684 EDS \u8bbe\u7f6e\u4e2d\u5305\u542b\u4e863\u4e2a <code>subset</code>\uff0c\u53e6\u5916\u8bfb\u8005\u8fd8\u53ef\u4ee5\u81ea\u5df1\u8fd0\u884c <code>istioctl proxy-config listeners</code> \u548c <code>istioctl proxy-config route</code> \u6765\u67e5\u8be2 pod \u7684\u76d1\u542c\u5668\u548c\u8def\u7531\u914d\u7f6e\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#63-istio-sidecar","title":"6.3 Istio \u4e2d\u7684 Sidecar \u7684\u6d41\u91cf\u8def\u7531\u8be6\u89e3","text":"<p>\u672c\u6587\u4ee5 Istio \u5b98\u65b9\u7684 bookinfo \u793a\u4f8b\u6765\u8bb2\u89e3\u5728\u8fdb\u5165 Pod \u7684\u6d41\u91cf\u88ab iptables \u8f6c\u4ea4\u7ed9 Envoy sidecar \u540e\uff0cEnvoy \u662f\u5982\u4f55\u505a\u8def\u7531\u8f6c\u53d1\u7684\uff0c\u8be6\u8ff0\u4e86 Inbound \u548c Outbound \u5904\u7406\u8fc7\u7a0b\u3002\u5173\u4e8e\u6d41\u91cf\u62e6\u622a\u7684\u8be6\u7ec6\u5206\u6790\u8bf7\u53c2\u8003\u7406\u89e3 Istio Service Mesh \u4e2d Envoy \u4ee3\u7406 Sidecar \u6ce8\u5165\u53ca\u6d41\u91cf\u52ab\u6301\u3002</p> <p>\u4e0b\u9762\u662f Istio \u5b98\u65b9\u63d0\u4f9b\u7684 bookinfo \u7684\u8bf7\u6c42\u6d41\u7a0b\u56fe\uff0c\u5047\u8bbe bookinfo \u5e94\u7528\u7684\u6240\u6709\u670d\u52a1\u4e2d\u6ca1\u6709\u914d\u7f6e DestinationRule\u3002</p> <p>\u56fe\u7247 - Bookinfo \u793a\u4f8b</p> <p>\u4e0b\u9762\u662f Istio \u81ea\u8eab\u7ec4\u4ef6\u4e0e Bookinfo \u793a\u4f8b\u7684\u8fde\u63a5\u5173\u7cfb\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6240\u6709\u7684 HTTP \u8fde\u63a5\u90fd\u5728 9080 \u7aef\u53e3\u76d1\u542c\u3002</p> <p>\u56fe\u7247 - Bookinfo \u793a\u4f8b\u4e0e Istio \u7ec4\u4ef6\u8fde\u63a5\u5173\u7cfb\u56fe</p> <p>\u53ef\u4ee5\u5728 Google Drive \u4e0a\u4e0b\u8f7d\u539f\u56fe\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#631-sidecar","title":"6.3.1 Sidecar \u6ce8\u5165\u53ca\u6d41\u91cf\u52ab\u6301\u6b65\u9aa4\u6982\u8ff0","text":"<p>\u4e0b\u9762\u662f\u4ece Sidecar \u6ce8\u5165\u3001Pod \u542f\u52a8\u5230 Sidecar proxy \u62e6\u622a\u6d41\u91cf\u53ca Envoy \u5904\u7406\u8def\u7531\u7684\u6b65\u9aa4\u6982\u89c8\u3002</p> <p>1. Kubernetes \u901a\u8fc7 Admission Controller \u81ea\u52a8\u6ce8\u5165\uff0c\u6216\u8005\u7528\u6237\u4f7f\u7528 <code>istioctl</code> \u547d\u4ee4\u624b\u52a8\u6ce8\u5165 sidecar \u5bb9\u5668\u3002</p> <p>2. \u5e94\u7528 YAML \u914d\u7f6e\u90e8\u7f72\u5e94\u7528\uff0c\u6b64\u65f6 Kubernetes API server \u63a5\u6536\u5230\u7684\u670d\u52a1\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\u4e2d\u5df2\u7ecf\u5305\u542b\u4e86 Init \u5bb9\u5668\u53ca sidecar proxy\u3002</p> <p>3. \u5728 sidecar proxy \u5bb9\u5668\u548c\u5e94\u7528\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\uff0c\u9996\u5148\u8fd0\u884c Init \u5bb9\u5668\uff0cInit \u5bb9\u5668\u7528\u4e8e\u8bbe\u7f6e iptables\uff08Istio \u4e2d\u9ed8\u8ba4\u7684\u6d41\u91cf\u62e6\u622a\u65b9\u5f0f\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528 BPF\u3001IPVS \u7b49\u65b9\u5f0f\uff09 \u5c06\u8fdb\u5165 pod \u7684\u6d41\u91cf\u52ab\u6301\u5230 Envoy sidecar proxy\u3002\u6240\u6709 TCP \u6d41\u91cf\uff08Envoy \u76ee\u524d\u53ea\u652f\u6301 TCP \u6d41\u91cf\uff09\u5c06\u88ab sidecar \u52ab\u6301\uff0c\u5176\u4ed6\u534f\u8bae\u7684\u6d41\u91cf\u5c06\u6309\u539f\u6765\u7684\u76ee\u7684\u5730\u8bf7\u6c42\u3002</p> <p>4. \u542f\u52a8 Pod \u4e2d\u7684 Envoy sidecar proxy \u548c\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u3002\u8fd9\u4e00\u6b65\u7684\u8fc7\u7a0b\u8bf7\u53c2\u8003\u901a\u8fc7\u7ba1\u7406\u63a5\u53e3\u83b7\u53d6\u5b8c\u6574\u914d\u7f6e\u3002</p> <p>Sidecar proxy \u4e0e\u5e94\u7528\u5bb9\u5668\u7684\u542f\u52a8\u987a\u5e8f\u95ee\u9898</p> <p>\u542f\u52a8 sidecar proxy \u548c\u5e94\u7528\u5bb9\u5668\uff0c\u7a76\u7adf\u54ea\u4e2a\u5bb9\u5668\u5148\u542f\u52a8\u5462\uff1f\u6b63\u5e38\u60c5\u51b5\u662f Envoy Sidecar \u548c\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u5168\u90e8\u542f\u52a8\u5b8c\u6210\u540e\u518d\u5f00\u59cb\u63a5\u6536\u6d41\u91cf\u8bf7\u6c42\u3002\u4f46\u662f\u6211\u4eec\u65e0\u6cd5\u9884\u6599\u54ea\u4e2a\u5bb9\u5668\u4f1a\u5148\u542f\u52a8\uff0c\u90a3\u4e48\u5bb9\u5668\u542f\u52a8\u987a\u5e8f\u662f\u5426\u4f1a\u5bf9 Envoy \u52ab\u6301\u6d41\u91cf\u6709\u5f71\u54cd\u5462\uff1f\u7b54\u6848\u662f\u80af\u5b9a\u7684\uff0c\u4e0d\u8fc7\u5206\u4e3a\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u3002</p> <p>\u60c5\u51b51\uff1a\u5e94\u7528\u5bb9\u5668\u5148\u542f\u52a8\uff0c\u800c sidecar proxy \u4ecd\u672a\u5c31\u7eea</p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6d41\u91cf\u88ab iptables \u8f6c\u79fb\u5230 15001 \u7aef\u53e3\uff0c\u800c Pod \u4e2d\u6ca1\u6709\u76d1\u542c\u8be5\u7aef\u53e3\uff0cTCP \u94fe\u63a5\u5c31\u65e0\u6cd5\u5efa\u7acb\uff0c\u8bf7\u6c42\u5931\u8d25\u3002</p> <p>\u60c5\u51b52\uff1aSidecar \u5148\u542f\u52a8\uff0c\u8bf7\u6c42\u5230\u8fbe\u800c\u5e94\u7528\u7a0b\u5e8f\u4ecd\u672a\u5c31\u7eea</p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8bf7\u6c42\u4e5f\u80af\u5b9a\u4f1a\u5931\u8d25\uff0c\u81f3\u4e8e\u662f\u5728\u54ea\u4e00\u6b65\u5f00\u59cb\u5931\u8d25\u7684\uff0c\u7559\u7ed9\u8bfb\u8005\u6765\u601d\u8003\u3002</p> <p>\u95ee\u9898\uff1a\u5982\u679c\u4e3a sidecar proxy \u548c\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u6dfb\u52a0\u5c31\u7eea\u548c\u5b58\u6d3b\u63a2\u9488\u662f\u5426\u53ef\u4ee5\u89e3\u51b3\u8be5\u95ee\u9898\u5462\uff1f</p> <p>5. \u4e0d\u8bba\u662f\u8fdb\u5165\u8fd8\u662f\u4ece Pod \u53d1\u51fa\u7684 TCP \u8bf7\u6c42\u90fd\u4f1a\u88ab iptables \u52ab\u6301\uff0cinbound \u6d41\u91cf\u88ab\u52ab\u6301\u540e\u7ecf Inbound Handler \u5904\u7406\u540e\u8f6c\u4ea4\u7ed9\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u5904\u7406\uff0coutbound \u6d41\u91cf\u88ab iptables \u52ab\u6301\u540e\u8f6c\u4ea4\u7ed9 Outbound Handler \u5904\u7406\uff0c\u5e76\u786e\u5b9a\u8f6c\u53d1\u7684 upstream \u548c Endpoint\u3002</p> <p>6. Sidecar proxy \u8bf7\u6c42 Pilot \u4f7f\u7528 xDS \u534f\u8bae\u540c\u6b65 Envoy \u914d\u7f6e\uff0c\u5176\u4e2d\u5305\u62ec LDS\u3001EDS\u3001CDS \u7b49\uff0c\u4e0d\u8fc7\u4e3a\u4e86\u4fdd\u8bc1\u66f4\u65b0\u7684\u987a\u5e8f\uff0cEnvoy \u4f1a\u76f4\u63a5\u4f7f\u7528 ADS \u5411 Pilot \u8bf7\u6c42\u914d\u7f6e\u66f4\u65b0\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#632-envoy","title":"6.3.2 Envoy \u5982\u4f55\u5904\u7406\u8def\u7531\u8f6c\u53d1","text":"<p>\u4e0b\u56fe\u5c55\u793a\u7684\u662f <code>productpage</code> \u670d\u52a1\u8bf7\u6c42\u8bbf\u95ee <code>http://reviews.default.svc.cluster.local:9080/</code>\uff0c\u5f53\u6d41\u91cf\u8fdb\u5165 <code>reviews</code> \u670d\u52a1\u5185\u90e8\u65f6\uff0c<code>reviews</code> \u670d\u52a1\u5185\u90e8\u7684 Envoy Sidecar \u662f\u5982\u4f55\u505a\u6d41\u91cf\u62e6\u622a\u548c\u8def\u7531\u8f6c\u53d1\u7684\u3002\u53ef\u4ee5\u5728 Google Drive \u4e0a\u4e0b\u8f7d\u539f\u56fe\u3002</p> <p>\u56fe\u7247 - Envoy sidecar \u6d41\u91cf\u52ab\u6301\u4e0e\u8def\u7531\u8f6c\u53d1\u793a\u610f\u56fe</p> <p>\u7b2c\u4e00\u6b65\u5f00\u59cb\u65f6\uff0c<code>productpage</code> Pod \u4e2d\u7684 Envoy sidecar \u5df2\u7ecf\u901a\u8fc7 EDS \u9009\u62e9\u51fa\u4e86\u8981\u8bf7\u6c42\u7684 <code>reviews</code> \u670d\u52a1\u7684\u4e00\u4e2a Pod\uff0c\u77e5\u6653\u4e86\u5176 IP \u5730\u5740\uff0c\u53d1\u9001 TCP \u8fde\u63a5\u8bf7\u6c42\u3002</p> <p>Istio \u5b98\u7f51\u4e2d\u7684 Envoy \u914d\u7f6e\u6df1\u5ea6\u89e3\u6790\u4e2d\u662f\u4ee5\u53d1\u8d77 HTTP \u8bf7\u6c42\u7684\u4e00\u65b9\u6765\u8be6\u8ff0 Envoy \u505a\u6d41\u91cf\u8f6c\u53d1\u7684\u8fc7\u7a0b\uff0c\u800c\u672c\u6587\u4e2d\u8003\u8651\u7684\u662f\u63a5\u53d7 downstream \u7684\u6d41\u91cf\u7684\u4e00\u65b9\uff0c\u5b83\u65e2\u8981\u63a5\u6536 downstream \u53d1\u6765\u7684\u8bf7\u6c42\uff0c\u81ea\u5df1\u8fd8\u9700\u8981\u8bf7\u6c42\u5176\u4ed6\u670d\u52a1\uff0c\u4f8b\u5982 <code>reviews</code> \u670d\u52a1\u4e2d\u7684 Pod \u8fd8\u9700\u8981\u8bf7\u6c42 <code>ratings</code> \u670d\u52a1\u3002</p> <p><code>reviews</code> \u670d\u52a1\u6709\u4e09\u4e2a\u7248\u672c\uff0c\u6bcf\u4e2a\u7248\u672c\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u4e09\u4e2a\u7248\u672c\u4e2d\u7684 sidecar \u5de5\u4f5c\u6b65\u9aa4\u7c7b\u4f3c\uff0c\u4e0b\u6587\u53ea\u4ee5 <code>reviews-v1-cb8655c75-b97zc</code> \u8fd9\u4e00\u4e2a Pod \u4e2d\u7684 Sidecar \u6d41\u91cf\u8f6c\u53d1\u6b65\u9aa4\u6765\u8bf4\u660e\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#633-inbound-handler","title":"6.3.3 \u7406\u89e3 Inbound Handler","text":"<p>Inbound handler \u7684\u4f5c\u7528\u662f\u5c06 iptables \u62e6\u622a\u5230\u7684 downstream \u7684\u6d41\u91cf\u8f6c\u4ea4\u7ed9 localhost\uff0c\u4e0e Pod \u5185\u7684\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u67e5\u770b\u4e0b <code>reviews-v1-cb8655c75-b97zc</code> pod \u4e2d\u7684 Listener\u3002</p> <p>\u8fd0\u884c <code>istioctl pc listener reviews-v1-cb8655c75-b97zc</code> \u67e5\u770b\u8be5 Pod \u4e2d\u7684\u5177\u6709\u54ea\u4e9b Listener\u3002</p> <pre><code>ADDRESS            PORT      TYPE \n172.33.3.3         9080      HTTP &lt;--- \u63a5\u6536\u6240\u6709 Inbound HTTP \u6d41\u91cf\uff0c\u8be5\u5730\u5740\u5373\u4e3a\u5f53\u524d Pod \u7684 IP \u5730\u5740\n10.254.0.1         443       TCP  &lt;--+\n10.254.4.253       80        TCP     |\n10.254.4.253       8080      TCP     |\n10.254.109.182     443       TCP     |\n10.254.22.50       15011     TCP     |\n10.254.22.50       853       TCP     |\n10.254.79.114      443       TCP     | \n10.254.143.179     15011     TCP     |\n10.254.0.2         53        TCP     | \u63a5\u6536\u4e0e 0.0.0.0_15001 \u76d1\u542c\u5668\u914d\u5bf9\u7684 Outbound \u975e HTTP \u6d41\u91cf\n10.254.22.50       443       TCP     |\n10.254.16.64       42422     TCP     |\n10.254.127.202     16686     TCP     |\n10.254.22.50       31400     TCP     |\n10.254.22.50       8060      TCP     |\n10.254.169.13      14267     TCP     |\n10.254.169.13      14268     TCP     |\n10.254.32.134      8443      TCP     |\n10.254.118.196     443       TCP  &lt;--+\n0.0.0.0            15004     HTTP &lt;--+\n0.0.0.0            8080      HTTP    |\n0.0.0.0            15010     HTTP    | \n0.0.0.0            8088      HTTP    |\n0.0.0.0            15031     HTTP    |\n0.0.0.0            9090      HTTP    | \n0.0.0.0            9411      HTTP    | \u63a5\u6536\u4e0e 0.0.0.0_15001 \u914d\u5bf9\u7684 Outbound HTTP \u6d41\u91cf\n0.0.0.0            80        HTTP    |\n0.0.0.0            15030     HTTP    |\n0.0.0.0            9080      HTTP    |\n0.0.0.0            9093      HTTP    |\n0.0.0.0            3000      HTTP    |\n0.0.0.0            8060      HTTP    |\n0.0.0.0            9091      HTTP &lt;--+    \n0.0.0.0            15001     TCP  &lt;--- \u63a5\u6536\u6240\u6709\u7ecf iptables \u62e6\u622a\u7684 Inbound \u548c Outbound \u6d41\u91cf\u5e76\u8f6c\u4ea4\u7ed9\u865a\u62df\u76d1\u542c\u5668\u5904\u7406\n</code></pre> <p>\u5f53\u6765\u81ea <code>productpage</code> \u7684\u6d41\u91cf\u62b5\u8fbe <code>reviews</code> Pod \u7684\u65f6\u5019\u5df2\u7ecf\uff0cdownstream \u5fc5\u987b\u660e\u786e\u77e5\u9053 Pod \u7684 IP \u5730\u5740\u4e3a <code>172.33.3.3</code> \u6240\u4ee5\u624d\u4f1a\u8bbf\u95ee\u8be5 Pod\uff0c\u6240\u4ee5\u8be5\u8bf7\u6c42\u662f <code>172.33.3.3:9080</code>\u3002</p> <p>virtual Listener</p> <p>\u4ece\u8be5 Pod \u7684 Listener \u5217\u8868\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c0.0.0.0:15001/TCP \u7684 Listener\uff08\u5176\u5b9e\u9645\u540d\u5b57\u662f <code>virtual</code>\uff09\u76d1\u542c\u6240\u6709\u7684 Inbound \u6d41\u91cf\uff0c\u4e0b\u9762\u662f\u8be5 Listener \u7684\u8be6\u7ec6\u914d\u7f6e\u3002</p> <pre><code>{\n    \"name\": \"virtual\",\n    \"address\": {\n        \"socketAddress\": {\n            \"address\": \"0.0.0.0\",\n            \"portValue\": 15001\n        }\n    },\n    \"filterChains\": [\n        {\n            \"filters\": [\n                {\n                    \"name\": \"envoy.tcp_proxy\",\n                    \"config\": {\n                        \"cluster\": \"BlackHoleCluster\",\n                        \"stat_prefix\": \"BlackHoleCluster\"\n                    }\n                }\n            ]\n        }\n    ],\n    \"useOriginalDst\": true\n}\n</code></pre> <p>UseOriginalDst\uff1a\u4ece\u914d\u7f6e\u4e2d\u53ef\u4ee5\u770b\u51fa <code>useOriginalDst</code> \u914d\u7f6e\u6307\u5b9a\u4e3a <code>true</code>\uff0c\u8fd9\u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u7f3a\u7701\u4e3a false\uff0c\u4f7f\u7528 iptables \u91cd\u5b9a\u5411\u8fde\u63a5\u65f6\uff0cproxy \u63a5\u6536\u7684\u7aef\u53e3\u53ef\u80fd\u4e0e\u539f\u59cb\u76ee\u7684\u5730\u5740\u7684\u7aef\u53e3\u4e0d\u4e00\u6837\uff0c\u5982\u6b64\u5904 proxy \u63a5\u6536\u7684\u7aef\u53e3\u4e3a 15001\uff0c\u800c\u539f\u59cb\u76ee\u7684\u5730\u7aef\u53e3\u4e3a 9080\u3002\u5f53\u6b64\u6807\u5fd7\u8bbe\u7f6e\u4e3a true \u65f6\uff0cListener \u5c06\u8fde\u63a5\u91cd\u5b9a\u5411\u5230\u4e0e\u539f\u59cb\u76ee\u7684\u5730\u5740\u5173\u8054\u7684 Listener\uff0c\u6b64\u5904\u4e3a <code>172.33.3.3:9080</code>\u3002\u5982\u679c\u6ca1\u6709\u4e0e\u539f\u59cb\u76ee\u7684\u5730\u5740\u5173\u8054\u7684 Listener\uff0c\u5219\u8fde\u63a5\u7531\u63a5\u6536\u5b83\u7684 Listener \u5904\u7406\uff0c\u5373\u8be5 <code>virtual</code> Listener\uff0c\u7ecf\u8fc7 <code>envoy.tcp_proxy</code> \u8fc7\u6ee4\u5668\u5904\u7406\u8f6c\u53d1\u7ed9 <code>BlackHoleCluster</code>\uff0c\u8fd9\u4e2a Cluster \u7684\u4f5c\u7528\u6b63\u5982\u5b83\u7684\u540d\u5b57\uff0c\u5f53 Envoy \u627e\u4e0d\u5230\u5339\u914d\u7684\u865a\u62df\u76d1\u542c\u5668\u65f6\uff0c\u5c31\u4f1a\u5c06\u8bf7\u6c42\u53d1\u9001\u7ed9\u5b83\uff0c\u5e76\u8fd4\u56de 404\u3002\u8fd9\u4e2a\u5c06\u4e8e\u4e0b\u6587\u63d0\u5230\u7684 Listener \u4e2d\u8bbe\u7f6e <code>bindToPort</code> \u76f8\u547c\u5e94\u3002</p> <p>\u6ce8\u610f\uff1a\u8be5\u53c2\u6570\u5c06\u88ab\u5e9f\u5f03\uff0c\u8bf7\u4f7f\u7528\u539f\u59cb\u76ee\u7684\u5730\u5740\u7684 Listener filter \u66ff\u4ee3\u3002\u8be5\u53c2\u6570\u7684\u4e3b\u8981\u7528\u9014\u662f\uff1aEnvoy \u901a\u8fc7\u76d1\u542c 15001 \u7aef\u53e3\u5c06 iptables \u62e6\u622a\u7684\u6d41\u91cf\u7ecf\u7531\u5176\u4ed6 Listener \u5904\u7406\u800c\u4e0d\u662f\u76f4\u63a5\u8f6c\u53d1\u51fa\u53bb\uff0c\u8be6\u60c5\u89c1 Virtual Listener\u3002</p> <p>Listener 172.33.3.3_9080</p> <p>\u4e0a\u6587\u8bf4\u5230\u8fdb\u5165 Inbound handler \u7684\u6d41\u91cf\u88ab <code>virtual</code> Listener \u8f6c\u79fb\u5230 <code>172.33.3.3_9080</code> Listener\uff0c\u6211\u4eec\u5728\u67e5\u770b\u4e0b\u8be5 Listener \u914d\u7f6e\u3002</p> <p>\u8fd0\u884c <code>istioctl pc listener reviews-v1-cb8655c75-b97zc --address 172.33.3.3 --port 9080 -o json</code> \u67e5\u770b\u3002</p> <pre><code>[{\n    \"name\": \"172.33.3.3_9080\",\n    \"address\": {\n        \"socketAddress\": {\n            \"address\": \"172.33.3.3\",\n            \"portValue\": 9080\n        }\n    },\n    \"filterChains\": [\n        {\n            \"filterChainMatch\": {\n                \"transportProtocol\": \"raw_buffer\"\n            },\n            \"filters\": [\n                {\n                    \"name\": \"envoy.http_connection_manager\",\n                    \"config\": {\n                        ... \n                        \"route_config\": {\n                            \"name\": \"inbound|9080||reviews.default.svc.cluster.local\",\n                            \"validate_clusters\": false,\n                            \"virtual_hosts\": [\n                                {\n                                    \"domains\": [\n                                        \"*\"\n                                    ],\n                                    \"name\": \"inbound|http|9080\",\n                                    \"routes\": [\n                                        {\n                                            ...\n                                            \"route\": {\n                                                \"cluster\": \"inbound|9080||reviews.default.svc.cluster.local\",\n                                                \"max_grpc_timeout\": \"0.000s\",\n                                                \"timeout\": \"0.000s\"\n                                            }\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        \"use_remote_address\": false,\n                        ...\n                    }\n                }\n            ]\uff0c\n            \"deprecatedV1\": {\n                \"bindToPort\": false\n            }\n        ...\n        },\n        {\n            \"filterChainMatch\": {\n                \"transportProtocol\": \"tls\"\n            },\n            \"tlsContext\": {...\n            },\n            \"filters\": [...\n            ]\n        }\n    ],\n...\n}]\n</code></pre> <p>bindToPort\uff1a\u6ce8\u610f\u5176\u4e2d\u6709\u4e00\u4e2a <code>bindToPort</code> \u7684\u914d\u7f6e\uff0c\u5176\u503c\u4e3a <code>false</code>\uff0c\u8be5\u914d\u7f6e\u7684\u7f3a\u7701\u503c\u4e3a <code>true</code>\uff0c\u8868\u793a\u5c06 Listener \u7ed1\u5b9a\u5230\u7aef\u53e3\u4e0a\uff0c\u6b64\u5904\u8bbe\u7f6e\u4e3a <code>false</code> \u5219\u8be5 Listener \u53ea\u80fd\u5904\u7406\u5176\u4ed6 Listener \u8f6c\u79fb\u8fc7\u6765\u7684\u6d41\u91cf\uff0c\u5373\u4e0a\u6587\u6240\u8bf4\u7684 <code>virtual</code> Listener\uff0c\u6211\u4eec\u770b\u5176\u4e2d\u7684 filterChains.filters \u4e2d\u7684 <code>envoy.http_connection_manager</code> \u914d\u7f6e\u90e8\u5206\uff1a</p> <pre><code>\"route_config\": {\n                            \"name\": \"inbound|9080||reviews.default.svc.cluster.local\",\n                            \"validate_clusters\": false,\n                            \"virtual_hosts\": [\n                                {\n                                    \"domains\": [\n                                        \"*\"\n                                    ],\n                                    \"name\": \"inbound|http|9080\",\n                                    \"routes\": [\n                                        {\n                                            ...\n                                            \"route\": {\n                                                \"cluster\": \"inbound|9080||reviews.default.svc.cluster.local\",\n                                                \"max_grpc_timeout\": \"0.000s\",\n                                                \"timeout\": \"0.000s\"\n                                            }\n                                        }\n                                    ]\n                                }\n                            ]\n                        }\n</code></pre> <p>\u8be5\u914d\u7f6e\u8868\u793a\u6d41\u91cf\u5c06\u8f6c\u4ea4\u7ed9 Cluster <code>inbound|9080||reviews.default.svc.cluster.local</code> \u5904\u7406\u3002</p> <p>Cluster inbound|9080||reviews.default.svc.cluster.local</p> <p>\u8fd0\u884c <code>istioctl pc cluster reviews-v1-cb8655c75-b97zc --fqdn reviews.default.svc.cluster.local --direction inbound -o json</code> \u67e5\u770b\u8be5 Cluster \u7684\u914d\u7f6e\u5982\u4e0b\u3002</p> <pre><code>[\n    {\n        \"name\": \"inbound|9080||reviews.default.svc.cluster.local\",\n        \"connectTimeout\": \"1.000s\",\n        \"hosts\": [\n            {\n                \"socketAddress\": {\n                    \"address\": \"127.0.0.1\",\n                    \"portValue\": 9080\n                }\n            }\n        ],\n        \"circuitBreakers\": {\n            \"thresholds\": [\n                {}\n            ]\n        }\n    }\n]\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8be5 Cluster \u7684 Endpoint \u76f4\u63a5\u5bf9\u5e94\u7684\u5c31\u662f localhost\uff0c\u518d\u7ecf\u8fc7 iptables \u8f6c\u53d1\u6d41\u91cf\u5c31\u88ab\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u6d88\u8d39\u4e86\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#634-outbound-handler","title":"6.3.4 \u7406\u89e3 Outbound Handler","text":"<p>\u56e0\u4e3a <code>reviews</code> \u4f1a\u5411 <code>ratings</code> \u670d\u52a1\u53d1\u9001 HTTP \u8bf7\u6c42\uff0c\u8bf7\u6c42\u7684\u5730\u5740\u662f\uff1a<code>http://ratings.default.svc.cluster.local:9080/</code>\uff0cOutbound handler \u7684\u4f5c\u7528\u662f\u5c06 iptables \u62e6\u622a\u5230\u7684\u672c\u5730\u5e94\u7528\u7a0b\u5e8f\u53d1\u51fa\u7684\u6d41\u91cf\uff0c\u7ecf\u7531 Envoy \u5224\u65ad\u5982\u4f55\u8def\u7531\u5230 upstream\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u53d1\u51fa\u7684\u8bf7\u6c42\u4e3a Outbound \u6d41\u91cf\uff0c\u88ab iptables \u52ab\u6301\u540e\u8f6c\u79fb\u7ed9 Envoy Outbound handler \u5904\u7406\uff0c\u7136\u540e\u7ecf\u8fc7 <code>virtual</code> Listener\u3001<code>0.0.0.0_9080</code> Listener\uff0c\u7136\u540e\u901a\u8fc7 Route 9080 \u627e\u5230 upstream \u7684 cluster\uff0c\u8fdb\u800c\u901a\u8fc7 EDS \u627e\u5230 Endpoint \u6267\u884c\u8def\u7531\u52a8\u4f5c\u3002\u8fd9\u4e00\u90e8\u5206\u53ef\u4ee5\u53c2\u8003 Istio \u5b98\u7f51\u4e2d\u7684 Envoy \u6df1\u5ea6\u914d\u7f6e\u89e3\u6790\u3002</p> <p>Route 9080</p> <p><code>reviews</code> \u4f1a\u8bf7\u6c42 <code>ratings</code> \u670d\u52a1\uff0c\u8fd0\u884c <code>istioctl proxy-config routes reviews-v1-cb8655c75-b97zc --name 9080 -o json</code> \u67e5\u770b route \u914d\u7f6e\uff0c\u56e0\u4e3a Envoy \u4f1a\u6839\u636e HTTP header \u4e2d\u7684 domains \u6765\u5339\u914d VirtualHost\uff0c\u6240\u4ee5\u4e0b\u9762\u53ea\u5217\u4e3e\u4e86 <code>ratings.default.svc.cluster.local:9080</code> \u8fd9\u4e00\u4e2a VirtualHost\u3002</p> <pre><code>[{\n    \"name\": \"ratings.default.svc.cluster.local:9080\",\n    \"domains\": [\n        \"ratings.default.svc.cluster.local\",\n        \"ratings.default.svc.cluster.local:9080\",\n        \"ratings\",\n        \"ratings:9080\",\n        \"ratings.default.svc.cluster\",\n        \"ratings.default.svc.cluster:9080\",\n        \"ratings.default.svc\",\n        \"ratings.default.svc:9080\",\n        \"ratings.default\",\n        \"ratings.default:9080\",\n        \"10.254.234.130\",\n        \"10.254.234.130:9080\"\n    ],\n    \"routes\": [\n        {\n            \"match\": {\n                \"prefix\": \"/\"\n            },\n            \"route\": {\n                \"cluster\": \"outbound|9080||ratings.default.svc.cluster.local\",\n                \"timeout\": \"0.000s\",\n                \"maxGrpcTimeout\": \"0.000s\"\n            },\n            \"decorator\": {\n                \"operation\": \"ratings.default.svc.cluster.local:9080/*\"\n            },\n            \"perFilterConfig\": {...\n            }\n        }\n    ]\n},\n..]\n</code></pre> <p>\u4ece\u8be5 Virtual Host \u914d\u7f6e\u4e2d\u53ef\u4ee5\u770b\u5230\u5c06\u6d41\u91cf\u8def\u7531\u5230 Cluster <code>outbound|9080||ratings.default.svc.cluster.local</code>\u3002</p> <p>Endpoint outbound|9080||ratings.default.svc.cluster.local</p> <p>Istio 1.1 \u4ee5\u524d\u7248\u672c\u4e0d\u652f\u6301\u4f7f\u7528 <code>istioctl</code> \u547d\u4ee4\u76f4\u63a5\u67e5\u8be2 Cluster \u7684 Endpoint\uff0c\u53ef\u4ee5\u4f7f\u7528\u67e5\u8be2 Pilot \u7684 debug \u7aef\u70b9\u7684\u65b9\u5f0f\u6298\u4e2d\u3002</p> <pre><code>kubectl exec reviews-v1-cb8655c75-b97zc -c istio-proxy curl http://istio-pilot.istio-system.svc.cluster.local:9093/debug/edsz &gt; endpoints.json\n</code></pre> <p><code>endpoints.json</code> \u6587\u4ef6\u4e2d\u5305\u542b\u4e86\u6240\u6709 Cluster \u7684 Endpoint \u4fe1\u606f\uff0c\u6211\u4eec\u53ea\u9009\u53d6\u5176\u4e2d\u7684 <code>outbound|9080||ratings.default.svc.cluster.local</code> Cluster \u7684\u7ed3\u679c\u5982\u4e0b\u3002</p> <pre><code>{\n  \"clusterName\": \"outbound|9080||ratings.default.svc.cluster.local\",\n  \"endpoints\": [\n    {\n      \"locality\": {\n\n      },\n      \"lbEndpoints\": [\n        {\n          \"endpoint\": {\n            \"address\": {\n              \"socketAddress\": {\n                \"address\": \"172.33.100.2\",\n                \"portValue\": 9080\n              }\n            }\n          },\n          \"metadata\": {\n            \"filterMetadata\": {\n              \"istio\": {\n                  \"uid\": \"kubernetes://ratings-v1-8558d4458d-ns6lk.default\"\n                }\n            }\n          }\n        }\n      ]\n    }\n  ]\n}\n</code></pre> <p>Endpoint \u53ef\u4ee5\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\uff0cEnvoy \u5c06\u6839\u636e\u4e00\u5b9a\u89c4\u5219\u9009\u62e9\u9002\u5f53\u7684 Endpoint \u6765\u8def\u7531\u3002</p> <p>\u6ce8\uff1aIstio 1.1 \u5c06\u652f\u6301 <code>istioctl pc endpoint</code> \u547d\u4ee4\u6765\u67e5\u8be2 Endpoint\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#64-istio","title":"6.4 \u7194\u65ad\u4e0e\u5f02\u5e38\u68c0\u6d4b\u5728 Istio \u4e2d\u7684\u5e94\u7528","text":"<p>\u5728\u5fae\u670d\u52a1\u9886\u57df\uff0c\u5404\u4e2a\u670d\u52a1\u9700\u8981\u5728\u7f51\u7edc\u4e0a\u6267\u884c\u5927\u91cf\u7684\u8c03\u7528\u3002\u800c\u7f51\u7edc\u662f\u5f88\u8106\u5f31\u7684\uff0c\u5982\u679c\u67d0\u4e2a\u670d\u52a1\u7e41\u5fd9\u6216\u8005\u65e0\u6cd5\u54cd\u5e94\u8bf7\u6c42\uff0c\u5c06\u6709\u53ef\u80fd\u5f15\u53d1\u96c6\u7fa4\u7684\u5927\u89c4\u6a21\u7ea7\u8054\u6545\u969c\uff0c\u4ece\u800c\u9020\u6210\u6574\u4e2a\u7cfb\u7edf\u4e0d\u53ef\u7528\uff0c\u901a\u5e38\u628a\u8fd9\u79cd\u73b0\u8c61\u79f0\u4e3a\u670d\u52a1\u96ea\u5d29\u6548\u5e94\u3002\u4e3a\u4e86\u4f7f\u670d\u52a1\u6709\u4e00\u5b9a\u7684\u5197\u4f59\uff0c\u4ee5\u4fbf\u5728\u7cfb\u7edf\u6545\u969c\u671f\u95f4\u80fd\u591f\u4fdd\u6301\u670d\u52a1\u80fd\u529b\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7194\u65ad\u673a\u5236\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#641","title":"6.4.1 \u4ec0\u4e48\u662f\u7194\u65ad\uff1f","text":"<p>\u7194\u65ad\uff08Circuit Breaking\uff09\u8fd9\u4e00\u6982\u5ff5\u6765\u6e90\u4e8e\u7535\u5b50\u5de5\u7a0b\u4e2d\u7684**\u65ad\u8def\u5668**\uff08Circuit Breaker\uff09\u3002\u5728\u4e92\u8054\u7f51\u7cfb\u7edf\u4e2d\uff0c\u5f53\u4e0b\u6e38\u670d\u52a1\u56e0\u8bbf\u95ee\u538b\u529b\u8fc7\u5927\u800c\u54cd\u5e94\u53d8\u6162\u6216\u5931\u8d25\uff0c\u4e0a\u6e38\u670d\u52a1\u4e3a\u4e86\u4fdd\u62a4\u7cfb\u7edf\u6574\u4f53\u7684\u53ef\u7528\u6027\uff0c\u53ef\u4ee5\u6682\u65f6\u5207\u65ad\u5bf9\u4e0b\u6e38\u670d\u52a1\u7684\u8c03\u7528\u3002\u8fd9\u79cd\u727a\u7272\u5c40\u90e8\uff0c\u4fdd\u5168\u6574\u4f53\u7684\u63aa\u65bd\u5c31\u53eb\u505a**\u7194\u65ad**\u3002</p> <p>\u5982\u679c\u4e0d\u91c7\u53d6\u7194\u65ad\u63aa\u65bd\uff0c\u6211\u4eec\u7684\u7cfb\u7edf\u4f1a\u600e\u6837\u5462\uff1f\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u6817\u5b50\u3002</p> <p>\u5f53\u524d\u7cfb\u7edf\u4e2d\u6709 A\u3001B\u3001C \u4e09\u4e2a\u670d\u52a1\uff0c\u670d\u52a1 A \u662f\u4e0a\u6e38\uff0c\u670d\u52a1 B \u662f\u4e2d\u6e38\uff0c\u670d\u52a1 C \u662f\u4e0b\u6e38\u3002\u5b83\u4eec\u7684\u8c03\u7528\u94fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e00\u65e6\u4e0b\u6e38\u670d\u52a1 C \u56e0\u67d0\u4e9b\u539f\u56e0\u53d8\u5f97\u4e0d\u53ef\u7528\uff0c\u79ef\u538b\u4e86\u5927\u91cf\u8bf7\u6c42\uff0c\u670d\u52a1 B \u7684\u8bf7\u6c42\u7ebf\u7a0b\u4e5f\u968f\u4e4b\u963b\u585e\u3002\u7ebf\u7a0b\u8d44\u6e90\u9010\u6e10\u8017\u5c3d\uff0c\u4f7f\u5f97\u670d\u52a1 B \u4e5f\u53d8\u5f97\u4e0d\u53ef\u7528\u3002\u7d27\u63a5\u7740\uff0c\u670d\u52a1 A \u4e5f\u53d8\u4e3a\u4e0d\u53ef\u7528\uff0c\u6574\u4e2a\u8c03\u7528\u94fe\u8def\u88ab\u62d6\u57ae\u3002</p> <p></p> <p>\u50cf\u8fd9\u79cd\u8c03\u7528\u94fe\u8def\u7684\u8fde\u9501\u6545\u969c\uff0c\u5c31\u662f\u4e0a\u6587\u6240\u8bf4\u7684\u670d\u52a1\u96ea\u5d29\u6548\u5e94\u3002</p> <p>\u6b63\u6240\u8c13\u522e\u9aa8\u7597\u6bd2\uff0c\u58ee\u58eb\u65ad\u8155\u3002\u5728\u8fd9\u79cd\u65f6\u5019\uff0c\u5c31\u9700\u8981\u6211\u4eec\u7684\u7194\u65ad\u673a\u5236\u6765\u633d\u6551\u6574\u4e2a\u7cfb\u7edf\u3002\u7194\u65ad\u673a\u5236\u7684\u5927\u4f53\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u8fd9\u91cc\u9700\u8981\u89e3\u91ca\u4e24\u70b9\uff1a</p> <ul> <li>\u5f00\u542f\u7194\u65ad\uff1a\u5728\u56fa\u5b9a\u65f6\u95f4\u7a97\u53e3\u5185\uff0c\u63a5\u53e3\u8c03\u7528\u8d85\u65f6\u6bd4\u7387\u8fbe\u5230\u4e00\u4e2a\u9608\u503c\uff0c\u4f1a\u5f00\u542f\u7194\u65ad\u3002\u8fdb\u5165\u7194\u65ad\u72b6\u6001\u540e\uff0c\u540e\u7eed\u5bf9\u8be5\u670d\u52a1\u63a5\u53e3\u7684\u8c03\u7528\u4e0d\u518d\u7ecf\u8fc7\u7f51\u7edc\uff0c\u76f4\u63a5\u6267\u884c\u672c\u5730\u7684\u9ed8\u8ba4\u65b9\u6cd5\uff0c\u8fbe\u5230\u670d\u52a1\u964d\u7ea7\u7684\u6548\u679c\u3002</li> <li>\u7194\u65ad\u6062\u590d\uff1a\u7194\u65ad\u4e0d\u53ef\u80fd\u662f\u6c38\u4e45\u7684\uff0c\u5f53\u7ecf\u8fc7\u4e86\u89c4\u5b9a\u65f6\u95f4\u4e4b\u540e\uff0c\u670d\u52a1\u5c06\u4ece\u7194\u65ad\u72b6\u6001\u6062\u590d\u8fc7\u6765\uff0c\u518d\u6b21\u63a5\u53d7\u8c03\u7528\u65b9\u7684\u8fdc\u7a0b\u8c03\u7528\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#442-istio","title":"4.4.2 Istio \u4e2d\u7684\u7194\u65ad","text":"<p>Istio \u662f\u901a\u8fc7 Envoy Proxy \u6765\u5b9e\u73b0\u7194\u65ad\u673a\u5236\u7684\uff0cEnvoy \u5f3a\u5236\u5728\u7f51\u7edc\u5c42\u9762\u914d\u7f6e\u7194\u65ad\u7b56\u7565\uff0c\u8fd9\u6837\u5c31\u4e0d\u5fc5\u4e3a\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5355\u72ec\u914d\u7f6e\u6216\u91cd\u65b0\u7f16\u7a0b\u3002\u4e0b\u9762\u5c31\u901a\u8fc7\u4e00\u4e2a\u793a\u4f8b\u6765\u6f14\u793a\u5982\u4f55\u4e3a Istio \u7f51\u683c\u4e2d\u7684\u670d\u52a1\u914d\u7f6e\u7194\u65ad\u7684\u8fde\u63a5\u6570\u3001\u8bf7\u6c42\u6570\u548c\u5f02\u5e38\u68c0\u6d4b\u3002</p> <p>\u8be5\u793a\u4f8b\u7684\u67b6\u6784\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u8be5\u793a\u4f8b\u7531\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7ec4\u6210\uff0c\u5176\u4e2d\u5ba2\u6237\u7aef\u662f\u4e00\u4e2a Java HTTP \u5e94\u7528\u7a0b\u5e8f\uff0c\u88ab\u6253\u5305\u5728\u955c\u50cf <code>docker.io/ceposta/http-envoy-client-standalone:latest</code> \u4e2d\uff0c\u5b83\u7528\u6765\u6a21\u62df\u5bf9\u540e\u7aef\u670d\u52a1 <code>httpbin</code> \u53d1\u8d77 http \u8c03\u7528\uff0c\u6240\u6709\u7684\u8c03\u7528\u9996\u5148\u90fd\u4f1a\u88ab Envoy Proxy \u62e6\u622a\u3002</p> <p>\u5047\u8bbe\u4f60\u7684\u96c6\u7fa4\u4e2d\u5df2\u7ecf\u90e8\u7f72\u4e86 Istio\uff0c\u6ca1\u6709\u542f\u7528 Sidecar \u7684\u81ea\u52a8\u6ce8\u5165\uff0c\u5e76\u4e14\u6ca1\u6709\u542f\u7528\u53cc\u5411 TLS \u8eab\u4efd\u9a8c\u8bc1\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4421","title":"4.4.2.1 \u90e8\u7f72\u793a\u4f8b","text":"<p>\u90e8\u7f72 httpbin \u5e94\u7528\uff0c\u8be5\u5e94\u7528\u5c06\u4f1a\u4f5c\u4e3a\u672c\u793a\u4f8b\u7684\u540e\u7aef\u670d\u52a1\uff1a</p> <pre><code># \u8fdb\u5165 istio \u6839\u76ee\u5f55\n$ kubectl apply -f &lt;(istioctl kube-inject -f samples/httpbin/httpbin.yaml)\n</code></pre> <p>\u521b\u5efa\u4e00\u4e2a <code>DestinationRule</code>\uff0c\u9488\u5bf9 <code>httpbin</code> \u670d\u52a1\u8bbe\u7f6e\u7194\u65ad\u7b56\u7565\uff1a</p> <pre><code>$ kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: httpbin\nspec:\n  host: httpbin\n  trafficPolicy:\n    connectionPool:\n      tcp:\n        maxConnections: 1\n      http:\n        http1MaxPendingRequests: 1\n        maxRequestsPerConnection: 1\n    outlierDetection:\n      consecutiveErrors: 2\n      interval: 1s\n      baseEjectionTime: 3m\n      maxEjectionPercent: 100\nEOF\n</code></pre> <p>\u67e5\u770b\u8be5\u7b56\u7565\u5728 Envoy \u4e2d\u5bf9\u5e94\u7684 <code>Cluster</code> \u914d\u7f6e\uff1a</p> <pre><code>$ kubectl get pod -l app=httpbin\n\nNAME                      READY     STATUS    RESTARTS   AGE\nhttpbin-d6d68fb97-cswzc   2/2       Running   0          2m\n$ istioctl pc cluster httpbin-d6d68fb97-cswzc --fqdn httpbin.default.svc.cluster.local --direction outbound -o json\n\n[\n    {\n        \"name\": \"outbound|8000||httpbin.default.svc.cluster.local\",\n        \"type\": \"EDS\",\n        \"edsClusterConfig\": {\n            \"edsConfig\": {\n                \"ads\": {}\n            },\n            \"serviceName\": \"outbound|8000||httpbin.default.svc.cluster.local\"\n        },\n        \"connectTimeout\": \"1.000s\",\n        \"maxRequestsPerConnection\": 1,\n        \"circuitBreakers\": {\n            \"thresholds\": [\n                {\n                    \"maxConnections\": 1,\n                    \"maxPendingRequests\": 1\n                }\n            ]\n        },\n        \"outlierDetection\": {\n            \"interval\": \"1.000s\",\n            \"baseEjectionTime\": \"180.000s\",\n            \"maxEjectionPercent\": 100,\n            \"enforcingConsecutive5xx\": 0,\n            \"consecutiveGatewayFailure\": 2,\n            \"enforcingConsecutiveGatewayFailure\": 100\n        }\n    }\n]\n</code></pre> <p>\u4e0a\u9762\u7684\u914d\u7f6e\u544a\u8bc9\u6211\u4eec\uff1a</p> <ul> <li>maxConnections : \u9650\u5236\u5bf9\u540e\u7aef\u670d\u52a1\u53d1\u8d77\u7684 <code>HTTP/1.1</code> \u8fde\u63a5\u6570\uff0c\u5982\u679c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u9650\u5236\uff0c\u5c31\u4f1a\u5f00\u542f\u7194\u65ad\u3002</li> <li>maxPendingRequests : \u9650\u5236\u5f85\u5904\u7406\u8bf7\u6c42\u5217\u8868\u7684\u957f\u5ea6\uff0c \u5982\u679c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u9650\u5236\uff0c\u5c31\u4f1a\u5f00\u542f\u7194\u65ad\u3002</li> <li>maxRequestsPerConnection : \u5728\u4efb\u4f55\u7ed9\u5b9a\u65f6\u95f4\u5185\u9650\u5236\u5bf9\u540e\u7aef\u670d\u52a1\u53d1\u8d77\u7684 <code>HTTP/2</code> \u8bf7\u6c42\u6570\uff0c\u5982\u679c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u9650\u5236\uff0c\u5c31\u4f1a\u5f00\u542f\u7194\u65ad\u3002</li> </ul> <p>\u4e0b\u9762\u5206\u522b\u5bf9\u8fd9\u51e0\u4e2a\u53c2\u6570\u505a\u8be6\u7ec6\u89e3\u91ca\u3002</p> <ul> <li>maxConnections : \u8868\u793a\u5728\u4efb\u4f55\u7ed9\u5b9a\u65f6\u95f4\u5185\uff0c Envoy \u4e0e\u4e0a\u6e38\u96c6\u7fa4\uff08\u8fd9\u91cc\u6307\u7684\u662f httpbin \u670d\u52a1\uff09\u5efa\u7acb\u7684\u6700\u5927\u8fde\u63a5\u6570\u3002\u8be5\u914d\u7f6e\u4ec5\u9002\u7528\u4e8e <code>HTTP/1.1</code> \u534f\u8bae\uff0c\u56e0\u4e3a <code>HTTP/2</code> \u534f\u8bae\u53ef\u4ee5\u5728\u540c\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\uff0c\u800c <code>HTTP/1.1</code> \u534f\u8bae\u5728\u540c\u4e00\u4e2a\u8fde\u63a5\u4e2d\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u3002\u5982\u679c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u9650\u5236\uff08\u5373\u65ad\u8def\u5668\u6ea2\u51fa\uff09\uff0c\u96c6\u7fa4\u7684upstream_cx_overflow \u8ba1\u6570\u5668\u5c31\u4f1a\u9012\u589e\u3002</li> <li>maxPendingRequests : \u8868\u793a\u5f85\u5904\u7406\u8bf7\u6c42\u961f\u5217\u7684\u957f\u5ea6\u3002\u56e0\u4e3a <code>HTTP/2</code> \u662f\u901a\u8fc7\u5355\u4e2a\u8fde\u63a5\u5e76\u53d1\u5904\u7406\u591a\u4e2a\u8bf7\u6c42\u7684\uff0c\u56e0\u6b64\u8be5\u7194\u65ad\u7b56\u7565\u4ec5\u5728\u521b\u5efa\u521d\u59cb <code>HTTP/2</code> \u8fde\u63a5\u65f6\u6709\u7528\uff0c\u4e4b\u540e\u7684\u8bf7\u6c42\u5c06\u4f1a\u5728\u540c\u4e00\u4e2a TCP \u8fde\u63a5\u4e0a\u591a\u8def\u590d\u7528\u3002\u5bf9\u4e8e <code>HTTP/1.1</code> \u534f\u8bae\uff0c\u53ea\u8981\u6ca1\u6709\u8db3\u591f\u7684\u4e0a\u6e38\u8fde\u63a5\u53ef\u7528\u4e8e\u7acb\u5373\u5206\u6d3e\u8bf7\u6c42\uff0c\u5c31\u4f1a\u5c06\u8bf7\u6c42\u6dfb\u52a0\u5230\u5f85\u5904\u7406\u8bf7\u6c42\u961f\u5217\u4e2d\uff0c\u56e0\u6b64\u8be5\u65ad\u8def\u5668\u5c06\u5728\u8be5\u8fdb\u7a0b\u7684\u751f\u547d\u5468\u671f\u5185\u4fdd\u6301\u6709\u6548\u3002\u5982\u679c\u8be5\u65ad\u8def\u5668\u6ea2\u51fa\uff0c\u96c6\u7fa4\u7684 upstream_rq_pending_overflow \u8ba1\u6570\u5668\u5c31\u4f1a\u9012\u589e\u3002</li> <li>maxRequestsPerConnection : \u8868\u793a\u5728\u4efb\u4f55\u7ed9\u5b9a\u65f6\u95f4\u5185\uff0c\u4e0a\u6e38\u96c6\u7fa4\u4e2d\u6240\u6709\u4e3b\u673a\uff08\u8fd9\u91cc\u6307\u7684\u662f httpbin \u670d\u52a1\uff09\u53ef\u4ee5\u5904\u7406\u7684\u6700\u5927\u8bf7\u6c42\u6570\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u9002\u7528\u4e8e\u4ec5 <code>HTTP/2</code> \u96c6\u7fa4\uff0c\u56e0\u4e3a <code>HTTP/1.1</code> \u96c6\u7fa4\u7531\u6700\u5927\u8fde\u63a5\u6570\u65ad\u8def\u5668\u63a7\u5236\u3002\u5982\u679c\u8be5\u65ad\u8def\u5668\u6ea2\u51fa\uff0c\u96c6\u7fa4\u7684 upstream_rq_pending_overflow \u8ba1\u6570\u5668\u5c31\u4f1a\u9012\u589e\u3002</li> </ul> <p>Istio DestinationRule \u4e0e Envoy \u7684\u7194\u65ad\u53c2\u6570\u5bf9\u7167\u8868\u5982\u4e0b\u6240\u793a\uff1a</p> Envoy paramether Envoy upon object Istio parameter Istio upon ojbect max_connections cluster.circuit_breakers maxConnections TCPSettings max_pending_requests cluster.circuit_breakers http1MaxPendingRequests HTTPSettings max_requests cluster.circuit_breakers http2MaxRequests HTTPSettings max_retries cluster.circuit_breakers maxRetries HTTPSettings connect_timeout_ms cluster connectTimeout TCPSettings max_requests_per_connection cluster maxRequestsPerConnection HTTPSettings"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4422","title":"4.4.2.2 \u6700\u5927\u8fde\u63a5\u6570","text":"<p>\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u4e3a <code>httpbin</code> \u670d\u52a1\u8bbe\u7f6e\u4e86\u7194\u65ad\u7b56\u7565\uff0c\u63a5\u4e0b\u6765\u521b\u5efa\u4e00\u4e2a Java \u5ba2\u6237\u7aef\uff0c\u7528\u6765\u5411\u540e\u7aef\u670d\u52a1\u53d1\u9001\u8bf7\u6c42\uff0c\u89c2\u5bdf\u662f\u5426\u4f1a\u89e6\u53d1\u7194\u65ad\u7b56\u7565\u3002\u8fd9\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u63a7\u5236\u8fde\u63a5\u6570\u91cf\u3001\u5e76\u53d1\u6570\u3001\u5f85\u5904\u7406\u8bf7\u6c42\u961f\u5217\uff0c\u4f7f\u7528\u8fd9\u4e00\u5ba2\u6237\u7aef\uff0c\u80fd\u591f\u6709\u6548\u7684\u89e6\u53d1\u524d\u9762\u5728\u76ee\u6807\u89c4\u5219\u4e2d\u8bbe\u7f6e\u7684\u7194\u65ad\u7b56\u7565\u3002\u8be5\u5ba2\u6237\u7aef\u7684 deployment yaml \u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code># httpbin-client-deploy.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: httpbin-client-v1\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: httpbin-client\n        version: v1\n    spec:\n      containers:\n      - image: ceposta/http-envoy-client-standalone:latest\n        imagePullPolicy: IfNotPresent\n        name: httpbin-client\n        command: [\"/bin/sleep\",\"infinity\"]\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u4f1a\u628a\u7ed9\u5ba2\u6237\u7aef\u4e5f\u8fdb\u884c Sidecar \u7684\u6ce8\u5165\uff0c\u4ee5\u6b64\u4fdd\u8bc1 Istio \u5bf9\u7f51\u7edc\u4ea4\u4e92\u7684\u63a7\u5236\uff1a</p> <pre><code>$ kubectl apply -f &lt;(istioctl kube-inject -f httpbin-client-deploy.yaml)\n</code></pre> <p>\u4e0b\u9762\u6765\u89c2\u5bdf\u4e00\u4e0b\u5f53\u5ba2\u6237\u7aef\u8bd5\u56fe\u4f7f\u7528\u592a\u591a\u7ebf\u7a0b\u4e0e\u4e0a\u6e38\u96c6\u7fa4\u5efa\u7acb\u5e76\u53d1\u8fde\u63a5\u65f6\uff0cEnvoy \u4f1a\u5982\u4f55\u5e94\u5bf9\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u7194\u65ad\u8bbe\u7f6e\u4e2d\u6307\u5b9a\u4e86 <code>maxConnections: 1</code> \u4ee5\u53ca <code>http1MaxPendingRequests: 1</code>\u3002\u8fd9\u610f\u5473\u7740\u5982\u679c\u8d85\u8fc7\u4e86\u4e00\u4e2a\u8fde\u63a5\u540c\u65f6\u53d1\u8d77\u8bf7\u6c42\uff0cIstio \u5c31\u4f1a\u7194\u65ad\uff0c\u963b\u6b62\u540e\u7eed\u7684\u8bf7\u6c42\u6216\u8fde\u63a5\u3002</p> <p>\u5148\u5c1d\u8bd5\u901a\u8fc7\u5355\u7ebf\u7a0b\uff08<code>NUM_THREADS=1</code>\uff09\u521b\u5efa\u4e00\u4e2a\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c 5 \u6b21\u8c03\u7528\uff08\u9ed8\u8ba4\u503c\uff1a<code>NUM_CALLS_PER_CLIENT=5</code>\uff09\uff1a</p> <pre><code>$ CLIENT_POD=$(kubectl get pod | grep httpbin-client | awk '{ print $1 }')\n$ kubectl exec -it $CLIENT_POD -c httpbin-client -- sh -c 'export URL_UNDER_TEST=http://httpbin:8000/get export NUM_THREADS=1 &amp;&amp; java -jar http-client.jar'\n\nusing num threads: 1\nStarting pool-1-thread-1 with numCalls=5 delayBetweenCalls=0 url=http://localhost:15001/get mixedRespTimes=false\npool-1-thread-1: successes=[5], failures=[0], duration=[545ms]\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6240\u6709\u8bf7\u6c42\u90fd\u901a\u8fc7\u4e86\uff1a</p> <pre><code>successes=[5]\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u67e5\u8be2 istio-proxy \u7684\u72b6\u6001\uff0c\u83b7\u53d6\u66f4\u591a\u76f8\u5173\u4fe1\u606f\uff1a</p> <pre><code>$ kubectl exec -it $CLIENT_POD  -c istio-proxy  -- sh -c 'curl localhost:15000/stats' | grep httpbin\n\n...\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_cx_http1_total: 5\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_cx_overflow: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_total: 5\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_200: 5\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_2xx: 5\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_overflow: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_retry: 0\n...\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa\u603b\u5171\u53d1\u9001\u4e86 5 \u4e2a <code>HTTP/1.1</code> \u8fde\u63a5\uff0c\u4e5f\u5c31\u662f 5 \u4e2a\u8bf7\u6c42\uff0c\u54cd\u5e94\u7801\u5747\u4e3a <code>200</code>\u3002</p> <p>\u4e0b\u9762\u5c1d\u8bd5\u628a\u7ebf\u7a0b\u6570\u63d0\u9ad8\u5230 2\uff1a</p> <pre><code>$ kubectl exec -it $CLIENT_POD -c httpbin-client -- sh -c 'export URL_UNDER_TEST=http://httpbin:8000/get export NUM_THREADS=2 &amp;&amp; java -jar http-client.jar'\n\nusing num threads: 2\nStarting pool-1-thread-1 with numCalls=5 parallelSends=false delayBetweenCalls=0 url=http://httpbin:8000/get mixedRespTimes=false\nStarting pool-1-thread-2 with numCalls=5 parallelSends=false delayBetweenCalls=0 url=http://httpbin:8000/get mixedRespTimes=false\npool-1-thread-1: successes=[3], failures=[2], duration=[96ms]\npool-1-thread-2: successes=[4], failures=[1], duration=[87ms]\n</code></pre> <p>\u518d\u6b21\u67e5\u770b istio-proxy \u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl exec -it $CLIENT_POD  -c istio-proxy  -- sh -c 'curl localhost:15000/stats' | grep httpbin\n\n...\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_cx_http1_total: 7\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_cx_overflow: 3\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_total: 10\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_200: 7\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_2xx: 7\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_503: 3\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_5xx: 3\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_overflow: 3\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_retry: 0\n...\n</code></pre> <p>\u603b\u5171\u53d1\u9001\u4e86 10 \u4e2a <code>HTTP/1</code> \u8fde\u63a5\uff0c\u53ea\u6709 7 \u4e2a \u88ab\u5141\u8bb8\u901a\u8fc7\uff0c\u5269\u4f59\u8bf7\u6c42\u88ab\u65ad\u8def\u5668\u62e6\u622a\u4e86\u3002\u5176\u4e2d <code>upstream_cx_overflow</code> \u7684\u503c\u4e3a 3\uff0c\u8868\u660e <code>maxConnections</code> \u65ad\u8def\u5668\u8d77\u4f5c\u7528\u4e86\u3002<code>Istio-proxy</code> \u5141\u8bb8\u4e00\u5b9a\u7684\u5197\u4f59\uff0c\u4f60\u53ef\u4ee5\u5c06\u7ebf\u7a0b\u6570\u63d0\u9ad8\u5230 3\uff0c\u7194\u65ad\u7684\u6548\u679c\u4f1a\u66f4\u660e\u663e\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4423","title":"4.4.2.3 \u5f85\u5904\u7406\u8bf7\u6c42\u961f\u5217","text":"<p>\u6d4b\u8bd5\u5b8c <code>maxConnections</code> \u65ad\u8def\u5668\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u6765\u6d4b\u8bd5\u4e00\u4e0b <code>maxPendingRequests</code> \u65ad\u8def\u5668\u3002\u524d\u9762\u5df2\u7ecf\u5c06 <code>maxPendingRequests</code> \u7684\u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u73b0\u5728\u6309\u7167\u9884\u60f3\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6a21\u62df\u5728\u5355\u4e2a <code>HTTP/1.1</code> \u8fde\u63a5\u4e2d\u540c\u65f6\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\uff0c\u5c31\u53ef\u4ee5\u89e6\u53d1\u8be5\u65ad\u8def\u5668\u5f00\u542f\u7194\u65ad\u3002\u7531\u4e8e <code>HTTP/1.1</code> \u540c\u4e00\u4e2a\u8fde\u63a5\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u5269\u4e0b\u7684\u8bf7\u6c42\u53ea\u80fd\u653e\u5230\u5f85\u5904\u7406\u8bf7\u6c42\u961f\u5217\u4e2d\u3002\u901a\u8fc7\u9650\u5236\u5f85\u5904\u7406\u8bf7\u6c42\u961f\u5217\u7684\u957f\u5ea6\uff0c\u53ef\u4ee5\u5bf9\u6076\u610f\u8bf7\u6c42\u3001DoS \u548c\u7cfb\u7edf\u4e2d\u7684\u7ea7\u8054\u9519\u8bef\u8d77\u5230\u4e00\u5b9a\u7684\u7f13\u89e3\u4f5c\u7528\u3002</p> <p>\u73b0\u5728\u5c1d\u8bd5\u901a\u8fc7\u5355\u7ebf\u7a0b\uff08<code>NUM_THREADS=1</code>\uff09\u521b\u5efa\u4e00\u4e2a\u8fde\u63a5\uff0c\u5e76\u540c\u65f6\u53d1\u9001 20 \u4e2a\u8bf7\u6c42\uff08<code>PARALLEL_SENDS=true</code>\uff0c<code>NUM_CALLS_PER_CLIENT=20</code>\uff09\uff1a</p> <pre><code>$ kubectl exec -it $CLIENT_POD -c httpbin-client -- sh -c 'export URL_UNDER_TEST=http://httpbin:8000/get export NUM_THREADS=1 export PARALLEL_SENDS=true export NUM_CALLS_PER_CLIENT=20 &amp;&amp; java -jar http-client.jar'\n\nusing num threads: 1\nStarting pool-1-thread-1 with numCalls=20 parallelSends=true delayBetweenCalls=0 url=http://httpbin:8000/get mixedRespTimes=false\nfinished batch 0\nfinished batch 5\nfinished batch 10\nfinished batch 15\npool-1-thread-1: successes=[16], failures=[4], duration=[116ms]\n</code></pre> <p>\u67e5\u8be2 istio-proxy \u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl exec -it $CLIENT_POD  -c istio-proxy  -- sh -c 'curl localhost:15000/stats' | grep httpbin | grep pending\n\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_active: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_failure_eject: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_overflow: 4\ncluster.outbound|8000||httpbin.default.svc.cluster.local.upstream_rq_pending_total: 16\n</code></pre> <p><code>upstream_rq_pending_overflow</code> \u7684\u503c\u662f <code>4</code>\uff0c\u8bf4\u660e\u6709 <code>4</code> \u6b21\u8c03\u7528\u89e6\u53d1\u4e86 <code>maxPendingRequests</code> \u65ad\u8def\u5668\u7684\u7194\u65ad\u7b56\u7565\uff0c\u88ab\u6807\u8bb0\u4e3a\u7194\u65ad\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4424","title":"4.4.2.4 \u5982\u679c\u670d\u52a1\u5b8c\u5168\u5d29\u6e83\u600e\u4e48\u529e\uff1f","text":"<p>\u73b0\u5728\u6211\u4eec\u77e5\u9053 Envoy \u7684\u7194\u65ad\u7b56\u7565\u5bf9\u96c6\u7fa4\u4e2d\u538b\u529b\u8fc7\u5927\u7684\u4e0a\u6e38\u670d\u52a1\u8d77\u5230\u4e00\u5b9a\u7684\u4fdd\u62a4\u4f5c\u7528\uff0c\u4f46\u8fd8\u6709\u4e00\u79cd\u6781\u7aef\u7684\u60c5\u51b5\u9700\u8981\u6211\u4eec\u8003\u8651\uff0c\u5982\u679c\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e9b\u8282\u70b9\u5b8c\u5168\u5d29\u6e83\uff08\u6216\u8005\u5373\u5c06\u5b8c\u5168\u5d29\u6e83\uff09\u8be5\u600e\u4e48\u529e\uff1f</p> <p>\u4e3a\u4e86\u4e13\u95e8\u5e94\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0cEnvoy \u4e2d\u5f15\u5165\u4e86**\u5f02\u5e38\u68c0\u6d4b**\u7684\u529f\u80fd\uff0c\u901a\u8fc7\u5468\u671f\u6027\u7684\u5f02\u5e38\u68c0\u6d4b\u6765\u52a8\u6001\u786e\u5b9a\u4e0a\u6e38\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e9b\u4e3b\u673a\u662f\u5426\u5f02\u5e38\uff0c\u5982\u679c\u53d1\u73b0\u5f02\u5e38\uff0c\u5c31\u5c06\u8be5\u4e3b\u673a\u4ece\u8fde\u63a5\u6c60\u4e2d\u9694\u79bb\u51fa\u53bb\u3002\u5f02\u5e38\u68c0\u6d4b\u662f**\u88ab\u52a8**\u5065\u5eb7\u68c0\u67e5\u7684\u4e00\u79cd\u5f62\u5f0f\uff0cEnvoy \u540c\u65f6\u652f\u6301\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u548c\u88ab\u52a8\u5065\u5eb7\u68c0\u67e5\uff0c\u5b83\u4eec\u53ef\u4ee5\u540c\u65f6\u542f\u7528\uff0c\u8054\u5408\u51b3\u5b9a\u4e0a\u6e38\u4e3b\u673a\u7684\u5065\u5eb7\u72b6\u51b5\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4425","title":"4.4.2.5 \u5f02\u5e38\u68c0\u6d4b\u7684\u9694\u79bb\u7b97\u6cd5","text":"<p>\u6839\u636e\u5f02\u5e38\u68c0\u6d4b\u7684\u7c7b\u578b\uff0c\u5bf9\u4e3b\u673a\u7684\u9694\u79bb\u53ef\u4ee5\u8fde\u7eed\u6267\u884c\uff08\u4f8b\u5982\u8fde\u7eed\u8fd4\u56de <code>5xx</code> \u72b6\u6001\u7801\uff09\uff0c\u4e5f\u53ef\u4ee5\u5468\u671f\u6027\u6267\u884c\uff08\u4f8b\u5982\u914d\u7f6e\u4e86\u5468\u671f\u6027\u6210\u529f\u7387\u68c0\u6d4b\uff09\u3002\u9694\u79bb\u7b97\u6cd5\u7684\u5de5\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u68c0\u6d4b\u5230\u4e86\u67d0\u4e2a\u4e3b\u673a\u5f02\u5e38\u3002</li> <li>\u5982\u679c\u5230\u76ee\u524d\u4e3a\u6b62\u8d1f\u8f7d\u5747\u8861\u6c60\u4e2d\u8fd8\u6ca1\u6709\u4e3b\u673a\u88ab\u9694\u79bb\u51fa\u53bb\uff0cEnvoy \u5c06\u4f1a\u7acb\u5373\u9694\u79bb\u8be5\u5f02\u5e38\u4e3b\u673a\uff1b\u5982\u679c\u5df2\u7ecf\u6709\u4e3b\u673a\u88ab\u9694\u79bb\u51fa\u53bb\uff0c\u5c31\u4f1a\u68c0\u67e5\u5f53\u524d\u9694\u79bb\u7684\u4e3b\u673a\u6570\u662f\u5426\u4f4e\u4e8e\u8bbe\u5b9a\u7684\u9608\u503c\uff08\u901a\u8fc7 outlier_detection.max_ejection_percent \u6307\u5b9a\uff09\uff0c\u5982\u679c\u5f53\u524d\u88ab\u9694\u79bb\u7684\u4e3b\u673a\u6570\u91cf\u4e0d\u8d85\u8fc7\u8be5\u9608\u503c\uff0c\u5c31\u5c06\u8be5\u4e3b\u673a\u9694\u79bb\u51fa\u53bb\uff0c\u5426\u5219\u4e0d\u9694\u79bb\u3002</li> <li>\u9694\u79bb\u4e0d\u662f\u6c38\u4e45\u7684\uff0c\u4f1a\u6709\u4e00\u4e2a\u65f6\u95f4\u9650\u5236\u3002\u5f53\u4e3b\u673a\u88ab\u9694\u79bb\u540e\uff0c\u8be5\u4e3b\u673a\u5c31\u4f1a\u88ab\u6807\u8bb0\u4e3a\u4e0d\u5065\u5eb7\uff0c\u5e76\u4e14\u4e0d\u4f1a\u88ab\u52a0\u5165\u5230\u8d1f\u8f7d\u5747\u8861\u6c60\u4e2d\uff0c\u9664\u975e\u8d1f\u8f7d\u5747\u8861\u5904\u4e8e\u6050\u614c\u6a21\u5f0f\u3002\u9694\u79bb\u65f6\u95f4\u7b49\u4e8e outlier_detection.base_ejection_time_ms \u7684\u503c\u4e58\u4ee5\u4e3b\u673a\u88ab\u9694\u79bb\u7684\u6b21\u6570\u3002\u6240\u4ee5\u5982\u679c\u67d0\u4e2a\u4e3b\u673a\u8fde\u7eed\u51fa\u73b0\u6545\u969c\uff0c\u4f1a\u5bfc\u81f4\u5b83\u88ab\u9694\u79bb\u7684\u65f6\u95f4\u8d8a\u6765\u8d8a\u957f\u3002</li> <li>\u7ecf\u8fc7\u4e86\u89c4\u5b9a\u7684\u9694\u79bb\u65f6\u95f4\u4e4b\u540e\uff0c\u88ab\u9694\u79bb\u7684\u4e3b\u673a\u5c06\u4f1a\u81ea\u52a8\u6062\u590d\u8fc7\u6765\uff0c\u91cd\u65b0\u63a5\u53d7\u8c03\u7528\u65b9\u7684\u8fdc\u7a0b\u8c03\u7528\u3002\u901a\u5e38\u5f02\u5e38\u68c0\u6d4b\u4f1a\u4e0e\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u4e00\u8d77\u7528\u4e8e\u5168\u9762\u7684\u5065\u5eb7\u68c0\u67e5\u89e3\u51b3\u65b9\u6848\u3002</li> </ol> <p>\u6050\u614c\u6a21\u5f0f\u6307\u7684\u662f\uff1a\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4ee3\u7406\u670d\u52a1\u5668\u4f1a\u65e0\u89c6\u8d1f\u8f7d\u5747\u8861\u6c60\u7684\u5065\u5eb7\u6807\u8bb0\uff0c\u91cd\u65b0\u5411\u6240\u6709\u4e3b\u673a\u53d1\u9001\u6570\u636e\u3002\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u68d2\u7684\u673a\u5236\u3002\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5fc5\u987b\u4e86\u89e3\u5230\u7684\u4e00\u70b9\u662f\uff0c\u6709\u65f6\u5019\u201c\u7406\u8bba\u4e0a\u201d\u7684\u4e1c\u897f\u53ef\u80fd\u4e0d\u662f\u6b63\u5e38\u60c5\u51b5\uff0c\u6700\u597d\u80fd\u964d\u4f4e\u4e00\u70b9\u8981\u6c42\u6765\u9632\u6b62\u6269\u5927\u6545\u969c\u5f71\u54cd\u3002\u53e6\u5916\u4e00\u65b9\u9762\uff0c\u53ef\u4ee5\u5bf9\u8fd9\u4e00\u6bd4\u4f8b\u8fdb\u884c\u63a7\u5236\uff08\u7f3a\u7701\u60c5\u51b5\u4e0b\u8d85\u8fc7 50% \u7684\u9a71\u9010\u5c31\u4f1a\u8fdb\u5165\u6050\u614c\u72b6\u6001\uff09\uff0c\u53ef\u4ee5\u63d0\u9ad8\uff0c\u4e5f\u53ef\u4ee5\u7981\u6b62\u8fd9\u4e00\u9608\u503c\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4426","title":"4.4.2.6 \u5f02\u5e38\u68c0\u6d4b\u7c7b\u578b","text":"<p>Envoy \u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u5f02\u5e38\u68c0\u6d4b\u7c7b\u578b\uff1a</p> <ul> <li>\u8fde\u7eed 5xx \u54cd\u5e94\uff1a\u5982\u679c\u4e0a\u6e38\u4e3b\u673a\u8fde\u7eed\u8fd4\u56de\u4e00\u5b9a\u6570\u91cf\u7684 <code>5xx</code> \u54cd\u5e94\uff0c\u8be5\u4e3b\u673a\u5c31\u4f1a\u88ab\u9a71\u9010\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684 <code>5xx</code> \u54cd\u5e94\u4e0d\u4ec5\u5305\u62ec\u8fd4\u56de\u7684 <code>5xx</code> \u72b6\u6001\u7801\uff08\u5305\u62ec <code>500</code>\uff09\uff0c\u4e5f\u5305\u62ec HTTP \u8def\u7531\u8fd4\u56de\u7684\u4e00\u4e2a\u4e8b\u4ef6\uff08\u5982\u8fde\u63a5\u8d85\u65f6\u548c\u8fde\u63a5\u9519\u8bef\uff09\u3002\u9694\u79bb\u4e3b\u673a\u6240\u9700\u7684 <code>5xx</code> \u54cd\u5e94\u6570\u91cf\u7531 outlier_detection.consecutive_5xx \u7684\u503c\u63a7\u5236\u3002</li> <li>\u8fde\u7eed\u7f51\u5173\u6545\u969c\uff1a\u5982\u679c\u4e0a\u6e38\u4e3b\u673a\u8fde\u7eed\u8fd4\u56de\u4e00\u5b9a\u6570\u91cf\u7684 <code>\"gateway errors\"</code>\uff08<code>502</code>\uff0c<code>503</code> \u6216 <code>504</code> \u72b6\u6001\u7801\uff0c\u4f46\u4e0d\u5305\u62ec <code>500</code>\uff09\uff0c\u8be5\u4e3b\u673a\u5c31\u4f1a\u88ab\u9a71\u9010\u3002\u8fd9\u91cc\u540c\u6837\u4e5f\u5305\u62ec HTTP \u8def\u7531\u8fd4\u56de\u7684\u4e00\u4e2a\u4e8b\u4ef6\uff08\u5982\u8fde\u63a5\u8d85\u65f6\u548c\u8fde\u63a5\u9519\u8bef\uff09\u3002\u9694\u79bb\u4e3b\u673a\u6240\u9700\u7684\u8fde\u7eed\u7f51\u5173\u6545\u969c\u6570\u91cf\u7531 outlier_detection.consecutive_gateway_failure \u7684\u503c\u63a7\u5236\u3002</li> <li>\u8c03\u7528\u6210\u529f\u7387\uff1a\u57fa\u4e8e\u8c03\u7528\u6210\u529f\u7387\u7684\u5f02\u5e38\u68c0\u6d4b\u7c7b\u578b\u4f1a\u805a\u5408\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u4e3b\u673a\u7684\u8c03\u7528\u6210\u529f\u7387\uff0c\u7136\u540e\u6839\u636e\u7edf\u8ba1\u7684\u6570\u636e\u4ee5\u7ed9\u5b9a\u7684\u5468\u671f\u6765\u9694\u79bb\u4e3b\u673a\u3002\u5982\u679c\u8be5\u4e3b\u673a\u7684\u8bf7\u6c42\u6570\u91cf\u5c0f\u4e8e outlier_detection.success_rate_request_volume \u6307\u5b9a\u7684\u503c\uff0c\u5219\u4e0d\u4f1a\u4e3a\u8be5\u4e3b\u673a\u8ba1\u7b97\u8c03\u7528\u6210\u529f\u7387\uff0c\u56e0\u6b64\u805a\u5408\u7684\u7edf\u8ba1\u6570\u636e\u4e2d\u4e0d\u4f1a\u5305\u62ec\u8be5\u4e3b\u673a\u7684\u8c03\u7528\u6210\u529f\u7387\u3002\u5982\u679c\u5728\u7ed9\u5b9a\u7684\u5468\u671f\u5185\u5177\u6709\u6700\u5c0f\u6240\u9700\u8bf7\u6c42\u91cf\u7684\u4e3b\u673a\u6570\u5c0f\u4e8e outlier_detection.success_rate_minimum_hosts \u6307\u5b9a\u7684\u503c\uff0c\u5219\u4e0d\u4f1a\u5bf9\u8be5\u96c6\u7fa4\u6267\u884c\u8c03\u7528\u6210\u529f\u7387\u68c0\u6d4b\u3002</li> </ul> <p>Istio DestinationRule \u4e0e Envoy \u7684\u5f02\u5e38\u68c0\u6d4b\u53c2\u6570\u5bf9\u7167\u8868\u5982\u4e0b\u6240\u793a\uff1a</p> Envoy paramether Envoy upon object Istio parameter Istio upon ojbect consecutive_gateway_failure cluster.outlier_detection consecutiveErrors outlierDetection interval cluster.outlier_detection interval outlierDetection baseEjectionTime cluster.outlier_detection baseEjectionTime outlierDetection maxEjectionPercent cluster.outlier_detection maxEjectionPercent outlierDetection <p>Envoy \u4e2d\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u53c2\u6570\u5728 Istio \u4e2d\u6682\u65f6\u662f\u4e0d\u652f\u6301\u7684\uff0c\u5177\u4f53\u53c2\u8003 Envoy \u5b98\u65b9\u6587\u6863 Outlier detection\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u56de\u5934\u518d\u6765\u770b\u4e00\u4e0b\u672c\u6587\u6700\u521d\u521b\u5efa\u7684 DestinationRule \u4e2d\u5173\u4e8e\u5f02\u5e38\u68c0\u6d4b\u7684\u914d\u7f6e\uff1a</p> <pre><code>    outlierDetection:\n      consecutiveErrors: 2\n      interval: 1s\n      baseEjectionTime: 3m\n      maxEjectionPercent: 100\n</code></pre> <p>\u8be5\u914d\u7f6e\u8868\u793a\u6bcf\u79d2\u949f\u626b\u63cf\u4e00\u6b21\u4e0a\u6e38\u4e3b\u673a\uff0c\u8fde\u7eed\u5931\u8d25 <code>1</code> \u6b21\u8fd4\u56de 5xx \u9519\u8bef\u7801\u7684\u6240\u6709\u4e3b\u673a\u4f1a\u88ab\u79fb\u51fa\u8fde\u63a5\u6c60 3 \u5206\u949f\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#4427","title":"4.4.2.7 \u5f02\u5e38\u68c0\u6d4b\u793a\u4f8b","text":"<p>\u4e0b\u9762\u6211\u4eec\u901a\u8fc7\u8c03\u7528\u4e00\u4e2a URL \u6765\u6307\u5b9a httpbin \u670d\u52a1\u8fd4\u56de <code>502</code> \u72b6\u6001\u7801\uff0c\u4ee5\u6b64\u6765\u89e6\u53d1\u8fde\u7eed\u7f51\u5173\u6545\u969c\u5f02\u5e38\u68c0\u6d4b\u3002\u603b\u5171\u53d1\u8d77 3 \u6b21\u8c03\u7528\uff0c\u56e0\u4e3a DestinationRule \u4e2d\u7684\u914d\u7f6e\u8981\u6c42 Envoy \u7684\u5f02\u5e38\u68c0\u6d4b\u673a\u5236\u5fc5\u987b\u68c0\u6d4b\u5230\u4e24\u4e2a\u8fde\u7eed\u7684\u7f51\u5173\u6545\u969c\u624d\u4f1a\u5c06 httpbin \u670d\u52a1\u79fb\u9664\u8d1f\u8f7d\u5747\u8861\u6c60\u3002</p> <pre><code>$ kubectl exec -it $CLIENT_POD -c httpbin-client -- sh -c 'export URL_UNDER_TEST=http://httpbin:8000/status/502 export NUM_CALLS_PER_CLIENT=3 &amp;&amp; java -jar http-client.jar'\n\nusing num threads: 1\nStarting pool-1-thread-1 with numCalls=3 parallelSends=false delayBetweenCalls=0 url=http://httpbin:8000/status/502 mixedRespTimes=false\npool-1-thread-1: successes=[0], failures=[3], duration=[99ms]\n</code></pre> <p>\u67e5\u770b istio-proxy \u7684\u72b6\u6001\uff1a</p> <pre><code>$ kubectl exec -it $CLIENT_POD  -c istio-proxy  -- sh -c 'curl localhost:15000/stats' | grep httpbin | grep outlier\n\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_active: 1\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_consecutive_5xx: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_detected_consecutive_5xx: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_detected_consecutive_gateway_failure: 1\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_detected_success_rate: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_enforced_consecutive_5xx: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_enforced_consecutive_gateway_failure: 1\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_enforced_success_rate: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_enforced_total: 1\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_overflow: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_success_rate: 0\ncluster.outbound|8000||httpbin.default.svc.cluster.local.outlier_detection.ejections_total: 0\n</code></pre> <p>\u786e\u5b9e\u68c0\u6d4b\u5230\u4e86\u8fde\u7eed\u7f51\u5173\u6545\u969c\uff0c<code>consecutive_gateway_failure</code> \u7684\u503c\u4e3a 1\u3002\u4f46\u662f\u6211\u901a\u8fc7\u67e5\u770b EDS\uff0c\u53d1\u73b0 Envoy \u5e76\u6ca1\u6709\u5c06 httpbin \u670d\u52a1\u79fb\u51fa\u8d1f\u8f7d\u5747\u8861\u6c60\uff1a</p> <pre><code>$ export PILOT_SVC_IP=$(kubectl -n istio-system get svc istio-pilot -o go-template='{{.spec.clusterIP}}')\n$ curl -s http://$PILOT_SVC_IP:8080/debug/edsz|grep \"outbound|8000||httpbin.default.svc.cluster.local\" -B 1 -A 15\n{\n  \"clusterName\": \"outbound|8000||httpbin.default.svc.cluster.local\",\n  \"endpoints\": [\n    {\n      \"locality\": {\n\n      },\n      \"lbEndpoints\": [\n        {\n          \"endpoint\": {\n            \"address\": {\n              \"socketAddress\": {\n                \"address\": \"172.30.104.27\",\n                \"portValue\": 8000\n              }\n            }\n          },\n</code></pre> <p>\u56de\u53bb\u91cd\u65b0\u770b\u4e86\u4e00\u4e0b Envoy \u7684\u914d\u7f6e\uff0c<code>enforcingConsecutiveGatewayFailure</code> \u7684\u503c\u4e3a 100\uff0c\u7406\u8bba\u4e0a outlierDetection \u5e94\u8be5\u662f\u751f\u6548\u7684\u3002\u4f46\u8fd9\u91cc\u6211\u758f\u5ffd\u4e86 Envoy \u7684\u6050\u614c\u6a21\u5f0f\uff0cEnvoy \u9ed8\u8ba4\u7684\u6050\u614c\u9608\u503c\u662f <code>50%</code>\uff0c\u800c httpbin \u5e94\u7528\u53ea\u6709\u4e00\u4e2a upstream\uff0c\u6240\u4ee5\u6ca1\u6709\u88ab\u79fb\u9664\u3002\u5f53\u7136\u8fd9\u53ea\u662f\u4e2a\u4eba\u731c\u6d4b\uff0c\u6682\u65f6\u4e5f\u6ca1\u65f6\u95f4\u9a8c\u8bc1\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u5df1\u9a8c\u8bc1\u4e00\u4e0b\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#_8","title":"\u5341\u4e8c \u4e3a\u670d\u52a1\u7f51\u683c\u9009\u62e9\u5165\u53e3\u7f51\u5173","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#121","title":"12.1 \u4e3a\u670d\u52a1\u7f51\u683c\u9009\u62e9\u5165\u53e3\u7f51\u5173","text":"<p>\u5728\u542f\u7528\u4e86Istio\u670d\u52a1\u7f51\u683c\u7684Kubernetes\u96c6\u7fa4\u4e2d\uff0c\u7f3a\u7701\u60c5\u51b5\u4e0b\u53ea\u80fd\u5728\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee\u7f51\u683c\u4e2d\u7684\u670d\u52a1\uff0c\u8981\u5982\u4f55\u624d\u80fd\u4ece\u5916\u90e8\u7f51\u7edc\u8bbf\u95ee\u8fd9\u4e9b\u670d\u52a1\u5462\uff1f Kubernetes\u548cIstio\u63d0\u4f9b\u4e86NodePort\uff0cLoadBalancer\uff0cKubernetes Ingress\uff0cIstio Gateway\u7b49\u591a\u79cd\u5916\u90e8\u6d41\u91cf\u5165\u53e3\u7684\u65b9\u5f0f\uff0c\u9762\u5bf9\u8fd9\u4e48\u591a\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u5728\u4ea7\u54c1\u90e8\u7f72\u4e2d\u5e94\u8be5\u5982\u4f55\u9009\u62e9\uff1f</p> <p>\u672c\u6587\u5c06\u5bf9Kubernetes\u548cIstio\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\u5404\u79cd\u65b9\u5f0f\u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u548c\u5bf9\u6bd4\u5206\u6790\uff0c\u5e76\u6839\u636e\u5206\u6790\u7ed3\u679c\u63d0\u51fa\u4e00\u4e2a\u53ef\u7528\u4e8e\u4ea7\u54c1\u90e8\u7f72\u7684\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u8bf4\u660e\uff1a\u9605\u8bfb\u672c\u6587\u8981\u6c42\u8bfb\u8005\u4e86\u89e3Kubernetes\u548cIstio\u7684\u57fa\u672c\u6982\u5ff5\uff0c\u5305\u62ecPod\u3001Service\u3001NodePort\u3001LoadBalancer\u3001Ingress\u3001Gateway\u3001VirtualService\u7b49\u3002\u5982\u5bf9\u8fd9\u4e9b\u6982\u5ff5\u4e0d\u719f\u6089\uff0c\u53ef\u4ee5\u5728\u9605\u8bfb\u8fc7\u7a0b\u4e2d\u53c2\u8003\u6587\u540e\u7684\u76f8\u5173\u94fe\u63a5\u3002</p> <p>\u200b   </p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#122","title":"12.2 \u5185\u90e8\u670d\u52a1\u95f4\u7684\u901a\u4fe1","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u6765\u56de\u987e\u4e00\u4e0bKubernetes\u96c6\u7fa4\u5185\u90e8\u5404\u4e2a\u670d\u52a1\u4e4b\u95f4\u76f8\u4e92\u8bbf\u95ee\u7684\u65b9\u6cd5\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#1221-cluster-ip","title":"12.2.1 Cluster IP","text":"<p>Kubernetes\u4ee5Pod\u4f5c\u4e3a\u5e94\u7528\u90e8\u7f72\u7684\u6700\u5c0f\u5355\u4f4d\u3002kubernetes\u4f1a\u6839\u636ePod\u7684\u58f0\u660e\u5bf9\u5176\u8fdb\u884c\u8c03\u5ea6\uff0c\u5305\u62ec\u521b\u5efa\u3001\u9500\u6bc1\u3001\u8fc1\u79fb\u3001\u6c34\u5e73\u4f38\u7f29\u7b49\uff0c\u56e0\u6b64Pod \u7684IP\u5730\u5740\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u4e0d\u65b9\u4fbf\u76f4\u63a5\u91c7\u7528Pod IP\u5bf9\u670d\u52a1\u8fdb\u884c\u8bbf\u95ee\u3002</p> <p>\u4e3a\u89e3\u51b3\u8be5\u95ee\u9898\uff0cKubernetes\u63d0\u4f9b\u4e86Service\u8d44\u6e90\uff0cService\u5bf9\u63d0\u4f9b\u540c\u4e00\u4e2a\u670d\u52a1\u7684\u591a\u4e2aPod\u8fdb\u884c\u805a\u5408\u3002\u4e00\u4e2aService\u63d0\u4f9b\u4e00\u4e2a\u865a\u62df\u7684Cluster IP\uff0c\u540e\u7aef\u5bf9\u5e94\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u63d0\u4f9b\u670d\u52a1\u7684Pod\u3002\u5728\u96c6\u7fa4\u4e2d\u8bbf\u95ee\u8be5Service\u65f6\uff0c\u91c7\u7528Cluster IP\u5373\u53ef\uff0cKube-proxy\u8d1f\u8d23\u5c06\u53d1\u9001\u5230Cluster IP\u7684\u8bf7\u6c42\u8f6c\u53d1\u5230\u540e\u7aef\u7684Pod\u4e0a\u3002</p> <p>Kube-proxy\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7684go\u5e94\u7528\u7a0b\u5e8f\uff0c\u652f\u6301\u4e09\u79cd\u5de5\u4f5c\u6a21\u5f0f\uff1a</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#12211-userspace","title":"12.2.1.1 userspace \u6a21\u5f0f","text":"<p>\u8be5\u6a21\u5f0f\u4e0bkube-proxy\u4f1a\u4e3a\u6bcf\u4e00\u4e2aService\u521b\u5efa\u4e00\u4e2a\u76d1\u542c\u7aef\u53e3\u3002\u53d1\u5411Cluster IP\u7684\u8bf7\u6c42\u88abIptables\u89c4\u5219\u91cd\u5b9a\u5411\u5230Kube-proxy\u76d1\u542c\u7684\u7aef\u53e3\u4e0a\uff0cKube-proxy\u6839\u636eLB\u7b97\u6cd5\u9009\u62e9\u4e00\u4e2a\u63d0\u4f9b\u670d\u52a1\u7684Pod\u5e76\u548c\u5176\u5efa\u7acb\u94fe\u63a5\uff0c\u4ee5\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230Pod\u4e0a\u3002 \u8be5\u6a21\u5f0f\u4e0b\uff0cKube-proxy\u5145\u5f53\u4e86\u4e00\u4e2a\u56db\u5c42Load balancer\u7684\u89d2\u8272\u3002\u7531\u4e8ekube-proxy\u8fd0\u884c\u5728userspace\u4e2d\uff0c\u5728\u8fdb\u884c\u8f6c\u53d1\u5904\u7406\u65f6\u4f1a\u589e\u52a0\u4e24\u6b21\u5185\u6838\u548c\u7528\u6237\u7a7a\u95f4\u4e4b\u95f4\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u6548\u7387\u8f83\u53e6\u5916\u4e24\u79cd\u6a21\u5f0f\u4f4e\u4e00\u4e9b\uff1b\u597d\u5904\u662f\u5f53\u540e\u7aef\u7684Pod\u4e0d\u53ef\u7528\u65f6\uff0ckube-proxy\u53ef\u4ee5\u91cd\u8bd5\u5176\u4ed6Pod\u3002</p> <p>\u56fe\u7247 - Kube-proxy userspace\u6a21\u5f0f</p> <p>\u56fe\u7247\u6765\u81ea\uff1aKubernetes\u5b98\u7f51\u6587\u6863</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#12212-iptables","title":"12.2.1.2 iptables \u6a21\u5f0f","text":"<p>\u4e3a\u4e86\u907f\u514d\u589e\u52a0\u5185\u6838\u548c\u7528\u6237\u7a7a\u95f4\u7684\u6570\u636e\u62f7\u8d1d\u64cd\u4f5c\uff0c\u63d0\u9ad8\u8f6c\u53d1\u6548\u7387\uff0cKube-proxy\u63d0\u4f9b\u4e86iptables\u6a21\u5f0f\u3002\u5728\u8be5\u6a21\u5f0f\u4e0b\uff0cKube-proxy\u4e3aservice\u540e\u7aef\u7684\u6bcf\u4e2aPod\u521b\u5efa\u5bf9\u5e94\u7684iptables\u89c4\u5219\uff0c\u76f4\u63a5\u5c06\u53d1\u5411Cluster IP\u7684\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230\u4e00\u4e2aPod IP\u3002 \u8be5\u6a21\u5f0f\u4e0bKube-proxy\u4e0d\u627f\u62c5\u56db\u5c42\u4ee3\u7406\u7684\u89d2\u8272\uff0c\u53ea\u8d1f\u8d23\u521b\u5efaiptables\u89c4\u5219\u3002\u8be5\u6a21\u5f0f\u7684\u4f18\u70b9\u662f\u8f83userspace\u6a21\u5f0f\u6548\u7387\u66f4\u9ad8\uff0c\u4f46\u4e0d\u80fd\u63d0\u4f9b\u7075\u6d3b\u7684LB\u7b56\u7565\uff0c\u5f53\u540e\u7aefPod\u4e0d\u53ef\u7528\u65f6\u4e5f\u65e0\u6cd5\u8fdb\u884c\u91cd\u8bd5\u3002</p> <p>\u56fe\u7247 - Kube-proxy iptables\u6a21\u5f0f</p> <p>\u56fe\u7247\u6765\u81ea\uff1aKubernetes\u5b98\u7f51\u6587\u6863</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#12213-ipvs","title":"12.2.1.3 ipvs \u6a21\u5f0f","text":"<p>\u8be5\u6a21\u5f0f\u548ciptables\u7c7b\u4f3c\uff0ckube-proxy\u76d1\u63a7Pod\u7684\u53d8\u5316\u5e76\u521b\u5efa\u76f8\u5e94\u7684ipvs rules\u3002ipvs\u4e5f\u662f\u5728kernel\u6a21\u5f0f\u4e0b\u901a\u8fc7netfilter\u5b9e\u73b0\u7684\uff0c\u4f46\u91c7\u7528\u4e86hash table\u6765\u5b58\u50a8\u89c4\u5219\uff0c\u56e0\u6b64\u5728\u89c4\u5219\u8f83\u591a\u7684\u60c5\u51b5\u4e0b\uff0cIpvs\u76f8\u5bf9iptables\u8f6c\u53d1\u6548\u7387\u66f4\u9ad8\u3002\u9664\u6b64\u4ee5\u5916\uff0cipvs\u652f\u6301\u66f4\u591a\u7684LB\u7b97\u6cd5\u3002\u5982\u679c\u8981\u8bbe\u7f6ekube-proxy\u4e3aipvs\u6a21\u5f0f\uff0c\u5fc5\u987b\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5b89\u88c5IPVS\u5185\u6838\u6a21\u5757\u3002</p> <p>\u56fe\u7247 - Kube-proxy ipvs\u6a21\u5f0f</p> <p>\u56fe\u7247\u6765\u81ea\uff1aKubernetes\u5b98\u7f51\u6587\u6863</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#1222-istio-sidecar-proxy","title":"12.2.2 Istio Sidecar Proxy","text":"<p>Cluster IP\u89e3\u51b3\u4e86\u670d\u52a1\u4e4b\u95f4\u76f8\u4e92\u8bbf\u95ee\u7684\u95ee\u9898\uff0c\u4f46\u4ece\u4e0a\u9762Kube-proxy\u7684\u4e09\u79cd\u6a21\u5f0f\u53ef\u4ee5\u770b\u5230\uff0cCluster IP\u7684\u65b9\u5f0f\u53ea\u63d0\u4f9b\u4e86\u670d\u52a1\u53d1\u73b0\u548c\u57fa\u672c\u7684LB\u529f\u80fd\u3002\u5982\u679c\u8981\u4e3a\u670d\u52a1\u95f4\u7684\u901a\u4fe1\u5e94\u7528\u7075\u6d3b\u7684\u8def\u7531\u89c4\u5219\u4ee5\u53ca\u63d0\u4f9bMetrics collection\uff0cdistributed tracing\u7b49\u670d\u52a1\u7ba1\u63a7\u529f\u80fd,\u5c31\u5fc5\u987b\u5f97\u4f9d\u9760Istio\u63d0\u4f9b\u7684\u670d\u52a1\u7f51\u683c\u80fd\u529b\u4e86\u3002</p> <p>\u5728Kubernetes\u4e2d\u90e8\u7f72Istio\u540e\uff0cIstio\u901a\u8fc7iptables\u548cSidecar Proxy\u63a5\u7ba1\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u670d\u52a1\u95f4\u7684\u76f8\u4e92\u901a\u4fe1\u4e0d\u518d\u901a\u8fc7Kube-proxy\uff0c\u800c\u662f\u901a\u8fc7Istio\u7684Sidecar Proxy\u8fdb\u884c\u3002\u8bf7\u6c42\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1aClient\u53d1\u8d77\u7684\u8bf7\u6c42\u88abiptables\u91cd\u5b9a\u5411\u5230Sidecar Proxy\uff0cSidecar Proxy\u6839\u636e\u4ece\u63a7\u5236\u9762\u83b7\u53d6\u7684\u670d\u52a1\u53d1\u73b0\u4fe1\u606f\u548c\u8def\u7531\u89c4\u5219\uff0c\u9009\u62e9\u4e00\u4e2a\u540e\u7aef\u7684Server Pod\u521b\u5efa\u94fe\u63a5\uff0c\u4ee3\u7406\u5e76\u8f6c\u53d1Client\u7684\u8bf7\u6c42\u3002</p> <p>Istio Sidecar Proxy\u548cKube-proxy\u7684userspace\u6a21\u5f0f\u7684\u5de5\u4f5c\u673a\u5236\u7c7b\u4f3c\uff0c\u90fd\u662f\u901a\u8fc7\u5728\u7528\u6237\u7a7a\u95f4\u7684\u4e00\u4e2a\u4ee3\u7406\u6765\u5b9e\u73b0\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u8f6c\u53d1\u548c\u540e\u7aef\u591a\u4e2aPod\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5747\u8861\u3002\u4e24\u8005\u7684\u4e0d\u540c\u70b9\u662f\uff1aKube-Proxy\u5de5\u4f5c\u5728\u56db\u5c42\uff0c\u800cSidecar Proxy\u5219\u662f\u4e00\u4e2a\u4e03\u5c42\u4ee3\u7406\uff0c\u53ef\u4ee5\u9488\u5bf9HTTP\uff0cGRPS\u7b49\u5e94\u7528\u5c42\u7684\u8bed\u4e49\u8fdb\u884c\u5904\u7406\u548c\u8f6c\u53d1\uff0c\u56e0\u6b64\u529f\u80fd\u66f4\u4e3a\u5f3a\u5927\uff0c\u53ef\u4ee5\u914d\u5408\u63a7\u5236\u9762\u5b9e\u73b0\u66f4\u4e3a\u7075\u6d3b\u7684\u8def\u7531\u89c4\u5219\u548c\u670d\u52a1\u7ba1\u63a7\u529f\u80fd\u3002</p> <p>\u56fe\u7247 - Istio Sidecar Proxy</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#123","title":"12.3 \u5982\u4f55\u4ece\u5916\u90e8\u7f51\u7edc\u8bbf\u95ee","text":"<p>Kubernetes\u7684Pod IP\u548cCluster IP\u90fd\u53ea\u80fd\u5728\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee\uff0c\u800c\u6211\u4eec\u901a\u5e38\u9700\u8981\u4ece\u5916\u90e8\u7f51\u7edc\u4e0a\u8bbf\u95ee\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e9b\u670d\u52a1\uff0cKubernetes\u63d0\u4f9b\u4e86\u4e0b\u8ff0\u51e0\u79cd\u65b9\u5f0f\u6765\u4e3a\u96c6\u7fa4\u63d0\u4f9b\u5916\u90e8\u6d41\u91cf\u5165\u53e3\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#1231-nodeport","title":"12.3.1 NodePort","text":"<p>NodePort\u5728\u96c6\u7fa4\u4e2d\u7684\u4e3b\u673a\u8282\u70b9\u4e0a\u4e3aService\u63d0\u4f9b\u4e00\u4e2a\u4ee3\u7406\u7aef\u53e3\uff0c\u4ee5\u5141\u8bb8\u4ece\u4e3b\u673a\u7f51\u7edc\u4e0a\u5bf9Service\u8fdb\u884c\u8bbf\u95ee\u3002Kubernetes\u5b98\u7f51\u6587\u6863\u53ea\u4ecb\u7ecd\u4e86NodePort\u7684\u529f\u80fd\uff0c\u5e76\u672a\u5bf9\u5176\u5b9e\u73b0\u539f\u7406\u8fdb\u884c\u89e3\u91ca\u3002\u4e0b\u9762\u6211\u4eec\u901a\u8fc7\u5b9e\u9a8c\u6765\u5206\u6790NodePort\u7684\u5b9e\u73b0\u673a\u5236\u3002</p> <p>www.katacoda.com \u8fd9\u4e2a\u7f51\u7ad9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4ea4\u4e92\u5f0f\u7684Kubernetes playground\uff0c\u6ce8\u518c\u5373\u53ef\u514d\u8d39\u5b9e\u9a8ckubernetes\u7684\u76f8\u5173\u529f\u80fd\uff0c\u4e0b\u9762\u6211\u4eec\u5c31\u4f7f\u7528Katacoda\u6765\u5206\u6790Nodeport\u7684\u5b9e\u73b0\u539f\u7406\u3002</p> <p>\u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165\u8fd9\u4e2a\u7f51\u5740\uff1ahttps://www.katacoda.com/courses/kubernetes/networking-introduction\uff0c \u6253\u5f00\u540e\u4f1a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b9e\u9a8c\u7528\u7684Kubernetes\u96c6\u7fa4\uff0c\u5e76\u53ef\u4ee5\u901a\u8fc7\u7f51\u5143\u6a21\u62dfTerminal\u8fde\u63a5\u5230\u96c6\u7fa4\u7684Master\u8282\u70b9\u3002</p> <p>\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa\u4e00\u4e2anodeport\u7c7b\u578b\u7684service\u3002</p> <pre><code>kubectl apply -f nodeport.yaml\n</code></pre> <p>\u67e5\u770b\u521b\u5efa\u7684service\uff0c\u53ef\u4ee5\u770b\u5230kubernetes\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3awebapp-nodeport-svc\u7684service\uff0c\u5e76\u4e3a\u8be5service\u5728\u4e3b\u673a\u8282\u70b9\u4e0a\u521b\u5efa\u4e8630080\u8fd9\u4e2aNodeport\u3002</p> <pre><code>master $ kubectl get svc\nNAME                   TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\nkubernetes             ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        36m\nwebapp1-nodeport-svc   NodePort    10.103.188.73   &lt;none&gt;        80:30080/TCP   3m\n</code></pre> <p>webapp-nodeport-svc\u540e\u7aef\u5bf9\u5e94\u4e24\u4e2aPod\uff0c\u5176Pod\u7684IP\u5206\u522b\u4e3a10.32.0.3\u548c10.32.0.5\u3002</p> <pre><code>master $ kubectl get pod -o wide\nNAME                                           READY     STATUS    RESTARTS   AGE       IPNODE      NOMINATED NODE\nwebapp1-nodeport-deployment-785989576b-cjc5b   1/1       Running   0          2m        10.32.0.3\nwebapp1-nodeport-deployment-785989576b-tpfqr   1/1       Running   0          2m        10.32.0.5\n</code></pre> <p>\u901a\u8fc7netstat\u547d\u4ee4\u53ef\u4ee5\u770b\u5230Kube-proxy\u5728\u4e3b\u673a\u7f51\u7edc\u4e0a\u521b\u5efa\u4e8630080\u76d1\u542c\u7aef\u53e3\uff0c\u7528\u4e8e\u63a5\u6536\u4ece\u4e3b\u673a\u7f51\u7edc\u8fdb\u5165\u7684\u5916\u90e8\u6d41\u91cf\u3002</p> <pre><code>master $ netstat -lnp|grep 30080\ntcp6       0      0 :::30080                :::*                    LISTEN      7427/kube-proxy\n</code></pre> <p>\u4e0b\u9762\u662fKube-proxy\u521b\u5efa\u7684\u76f8\u5173iptables\u89c4\u5219\u4ee5\u53ca\u5bf9\u5e94\u7684\u8bf4\u660e\u3002\u53ef\u4ee5\u770b\u5230Kube-proxy\u4e3aNodeport\u521b\u5efa\u4e86\u76f8\u5e94\u7684IPtable\u89c4\u5219\uff0c\u5c06\u53d1\u541130080\u8fd9\u4e2a\u4e3b\u673a\u7aef\u53e3\u4e0a\u7684\u6d41\u91cf\u91cd\u5b9a\u5411\u5230\u4e86\u540e\u7aef\u7684\u4e24\u4e2aPod IP\u4e0a\u3002</p> <pre><code>iptables-save &gt; iptables-dump\n# Generated by iptables-save v1.6.0 on Thu Mar 28 07:33:57 2019\n*nat\n# Nodeport\u89c4\u5219\u94fe\n:KUBE-NODEPORTS - [0:0]\n# Service\u89c4\u5219\u94fe\n:KUBE-SERVICES - [0:0]\n# Nodeport\u548cService\u5171\u7528\u7684\u89c4\u5219\u94fe\n:KUBE-SVC-J2DWGRZTH4C2LPA4 - [0:0]\n:KUBE-SEP-4CGFRVESQ3AECDE7 - [0:0]\n:KUBE-SEP-YLXG4RMKAICGY2B3 - [0:0]\n\n# \u5c06host\u4e0a30080\u7aef\u53e3\u7684\u5916\u90e8tcp\u6d41\u91cf\u8f6c\u5230KUBE-SVC-J2DWGRZTH4C2LPA4\u94fe\n-A KUBE-NODEPORTS -p tcp -m comment --comment \"default/webapp1-nodeport-svc:\" -m tcp --dport 30080 -j KUBE-SVC-J2DWGRZTH4C2LPA4\n\n#\u5c06\u53d1\u9001\u5230Cluster IP 10.103.188.73\u7684\u5185\u90e8\u6d41\u91cf\u8f6c\u5230KUBE-SVC-J2DWGRZTH4C2LPA4\u94fe\nKUBE-SERVICES -d 10.103.188.73/32 -p tcp -m comment --comment \"default/webapp1-nodeport-svc: cluster IP\" -m tcp --dport 80 -j KUBE-SVC-J2DWGRZTH4C2LPA4\n\n#\u5c06\u53d1\u9001\u5230webapp1-nodeport-svc\u7684\u6d41\u91cf\u8f6c\u4ea4\u5230\u7b2c\u4e00\u4e2aPod\uff0810.32.0.3\uff09\u76f8\u5173\u7684\u89c4\u5219\u94fe\u4e0a\uff0c\u6bd4\u4f8b\u4e3a50%\n-A KUBE-SVC-J2DWGRZTH4C2LPA4 -m comment --comment \"default/webapp1-nodeport-svc:\" -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-YLXG4RMKAICGY2B3\n#\u5c06\u53d1\u9001\u5230webapp1-nodeport-svc\u7684\u6d41\u91cf\u8f6c\u4ea4\u5230\u7b2c\u4e8c\u4e2aPod\uff0810.32.0.5\uff09\u76f8\u5173\u7684\u89c4\u5219\u94fe\u4e0a\n-A KUBE-SVC-J2DWGRZTH4C2LPA4 -m comment --comment \"default/webapp1-nodeport-svc:\" -j KUBE-SEP-4CGFRVESQ3AECDE7\n\n#\u5c06\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230Pod 10.32.0.3\n-A KUBE-SEP-YLXG4RMKAICGY2B3 -p tcp -m comment --comment \"default/webapp1-nodeport-svc:\" -m tcp -j DNAT --to-destination 10.32.0.3:80\n#\u5c06\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230Pod 10.32.0.5\n-A KUBE-SEP-4CGFRVESQ3AECDE7 -p tcp -m comment --comment \"default/webapp1-nodeport-svc:\" -m tcp -j DNAT --to-destination 10.32.0.5:80\n</code></pre> <p>\u4ece\u4e0a\u9762\u7684\u5b9e\u9a8c\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7\u5c06\u4e00\u4e2aService\u5b9a\u4e49\u4e3aNodePort\u7c7b\u578b\uff0cKubernetes\u4f1a\u901a\u8fc7\u96c6\u7fa4\u4e2dnode\u4e0a\u7684Kube-proxy\u4e3a\u8be5Service\u5728\u4e3b\u673a\u7f51\u7edc\u4e0a\u521b\u5efa\u4e00\u4e2a\u76d1\u542c\u7aef\u53e3\u3002Kube-proxy\u5e76\u4e0d\u4f1a\u76f4\u63a5\u63a5\u6536\u8be5\u4e3b\u673a\u7aef\u53e3\u8fdb\u5165\u7684\u6d41\u91cf\uff0c\u800c\u662f\u4f1a\u521b\u5efa\u76f8\u5e94\u7684Iptables\u89c4\u5219\uff0c\u5e76\u901a\u8fc7Iptables\u5c06\u4ece\u8be5\u7aef\u53e3\u6536\u5230\u7684\u6d41\u91cf\u76f4\u63a5\u8f6c\u53d1\u5230\u540e\u7aef\u7684Pod\u4e2d\u3002</p> <p>NodePort\u7684\u6d41\u91cf\u8f6c\u53d1\u673a\u5236\u548cCluster IP\u7684iptables\u6a21\u5f0f\u7c7b\u4f3c\uff0c\u552f\u4e00\u4e0d\u540c\u4e4b\u5904\u662f\u5728\u4e3b\u673a\u7f51\u7edc\u4e0a\u5f00\u4e86\u4e00\u4e2a\u201cNodePort\u201d\u6765\u63a5\u53d7\u5916\u90e8\u6d41\u91cf\u3002\u4ece\u4e0a\u9762\u7684\u89c4\u5219\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u5728\u521b\u5efaNodeport\u65f6\uff0cKube-proxy\u4e5f\u4f1a\u540c\u65f6\u4e3aService\u521b\u5efaCluster IP\u76f8\u5173\u7684iptables\u89c4\u5219\u3002</p> <p>\u5907\u6ce8\uff1a\u9664\u91c7\u7528iptables\u8fdb\u884c\u6d41\u91cf\u8f6c\u53d1\uff0cNodePort\u5e94\u8be5\u4e5f\u53ef\u4ee5\u63d0\u4f9buserspace\u6a21\u5f0f\u4ee5\u53caipvs\u6a21\u5f0f\uff0c\u8fd9\u91cc\u672a\u5c31\u8fd9\u4e24\u79cd\u6a21\u5f0f\u8fdb\u884c\u5b9e\u9a8c\u9a8c\u8bc1\u3002</p> <p>\u4ece\u5206\u6790\u5f97\u77e5\uff0c\u5728NodePort\u6a21\u5f0f\u4e0b\uff0c\u96c6\u7fa4\u5185\u5916\u90e8\u7684\u901a\u8baf\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p>\u56fe\u7247 - NodePort</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#1232-loadbalancer","title":"12.3.2 LoadBalancer","text":"<p>NodePort\u63d0\u4f9b\u4e86\u4e00\u79cd\u4ece\u5916\u90e8\u7f51\u7edc\u8bbf\u95eeKubernetes\u96c6\u7fa4\u5185\u90e8Service\u7684\u65b9\u6cd5\uff0c\u4f46\u8be5\u65b9\u6cd5\u5b58\u5728\u4e0b\u9762\u4e00\u4e9b\u9650\u5236\uff0c\u5bfc\u81f4\u8fd9\u79cd\u65b9\u5f0f\u4e3b\u8981\u9002\u7528\u4e8e\u7a0b\u5e8f\u5f00\u53d1\uff0c\u4e0d\u9002\u5408\u7528\u4e8e\u4ea7\u54c1\u90e8\u7f72\u3002</p> <ul> <li>Kubernetes cluster host\u7684IP\u5fc5\u987b\u662f\u4e00\u4e2awell-known IP\uff0c\u5373\u5ba2\u6237\u7aef\u5fc5\u987b\u77e5\u9053\u8be5IP\u3002\u4f46Cluster\u4e2d\u7684host\u662f\u88ab\u4f5c\u4e3a\u8d44\u6e90\u6c60\u770b\u5f85\u7684\uff0c\u53ef\u4ee5\u589e\u52a0\u5220\u9664\uff0c\u6bcf\u4e2ahost\u7684IP\u4e00\u822c\u4e5f\u662f\u52a8\u6001\u5206\u914d\u7684\uff0c\u56e0\u6b64\u5e76\u4e0d\u80fd\u8ba4\u4e3ahost IP\u5bf9\u5ba2\u6237\u7aef\u800c\u8a00\u662fwell-known IP\u3002</li> <li>\u5ba2\u6237\u7aef\u8bbf\u95ee\u67d0\u4e00\u4e2a\u56fa\u5b9a\u7684host IP\u7684\u65b9\u5f0f\u5b58\u5728\u5355\u70b9\u6545\u969c\u3002\u5047\u5982\u4e00\u53f0host\u5b95\u673a\u4e86\uff0ckubernetes cluster\u4f1a\u628a\u5e94\u7528 reload\u5230\u53e6\u4e00\u8282\u70b9\u4e0a\uff0c\u4f46\u5ba2\u6237\u7aef\u5c31\u65e0\u6cd5\u901a\u8fc7\u8be5host\u7684nodeport\u8bbf\u95ee\u5e94\u7528\u4e86\u3002</li> <li>\u901a\u8fc7\u4e00\u4e2a\u4e3b\u673a\u8282\u70b9\u4f5c\u4e3a\u7f51\u7edc\u5165\u53e3\uff0c\u5728\u7f51\u7edc\u6d41\u91cf\u8f83\u5927\u65f6\u5b58\u5728\u6027\u80fd\u74f6\u9888\u3002</li> </ul> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0cKubernetes\u63d0\u4f9b\u4e86LoadBalancer\u3002\u901a\u8fc7\u5c06Service\u5b9a\u4e49\u4e3aLoadBalancer\u7c7b\u578b\uff0cKubernetes\u5728\u4e3b\u673a\u8282\u70b9\u7684NodePort\u524d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u56db\u5c42\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u8be5\u56db\u5c42\u8d1f\u8f7d\u5747\u8861\u5668\u8d1f\u8d23\u5c06\u5916\u90e8\u7f51\u7edc\u6d41\u91cf\u5206\u53d1\u5230\u540e\u9762\u7684\u591a\u4e2a\u8282\u70b9\u7684NodePort\u7aef\u53e3\u4e0a\u3002</p> <p>\u4e0b\u56fe\u5c55\u793a\u4e86Kubernetes\u5982\u4f55\u901a\u8fc7LoadBalancer\u65b9\u5f0f\u5bf9\u5916\u63d0\u4f9b\u6d41\u91cf\u5165\u53e3\uff0c\u56fe\u4e2dLoadBalancer\u540e\u9762\u63a5\u5165\u4e86\u4e24\u4e2a\u4e3b\u673a\u8282\u70b9\u4e0a\u7684NodePort\uff0c\u540e\u7aef\u90e8\u7f72\u4e86\u4e09\u4e2aPod\u63d0\u4f9b\u670d\u52a1\u3002\u6839\u636e\u96c6\u7fa4\u7684\u89c4\u6a21\uff0c\u53ef\u4ee5\u5728LoadBalancer\u540e\u9762\u53ef\u4ee5\u63a5\u5165\u66f4\u591a\u7684\u4e3b\u673a\u8282\u70b9\uff0c\u4ee5\u8fdb\u884c\u8d1f\u8377\u5206\u62c5\u3002</p> <p>\u56fe\u7247 - NodeBalancer</p> <p>\u5907\u6ce8\uff1aLoadBalancer\u7c7b\u578b\u9700\u8981\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u7684\u652f\u6301\uff0cService\u4e2d\u7684\u5b9a\u4e49\u53ea\u662f\u5728Kubernetes\u914d\u7f6e\u6587\u4ef6\u4e2d\u63d0\u51fa\u4e86\u4e00\u4e2a\u8981\u6c42\uff0c\u5373\u4e3a\u8be5Service\u521b\u5efaLoad Balancer\uff0c\u81f3\u4e8e\u5982\u4f55\u521b\u5efa\u5219\u662f\u7531Google Cloud\u6216Amazon Cloud\u7b49\u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u7684\uff0c\u521b\u5efa\u7684Load Balancer\u7684\u8fc7\u7a0b\u4e0d\u5728Kubernetes Cluster\u7684\u7ba1\u7406\u8303\u56f4\u4e2d\u3002</p> <p>\u76ee\u524dWS, Azure, CloudStack, GCE \u548c OpenStack \u7b49\u4e3b\u6d41\u7684\u516c\u6709\u4e91\u548c\u79c1\u6709\u4e91\u63d0\u4f9b\u5546\u90fd\u53ef\u4ee5\u4e3aKubernetes\u63d0\u4f9bLoad Balancer\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u516c\u6709\u4e91\u63d0\u4f9b\u5546\u8fd8\u4f1a\u4e3aLoad Balancer\u63d0\u4f9b\u4e00\u4e2aExternal IP\uff0c\u4ee5\u63d0\u4f9bInternet\u63a5\u5165\u3002\u5982\u679c\u4f60\u7684\u4ea7\u54c1\u6ca1\u6709\u4f7f\u7528\u4e91\u63d0\u4f9b\u5546\uff0c\u800c\u662f\u81ea\u5efaKubernetes Cluster\uff0c\u5219\u9700\u8981\u81ea\u5df1\u63d0\u4f9bLoadBalancer\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#1233ingress","title":"12.3.3Ingress","text":"<p>LoadBalancer\u7c7b\u578b\u7684Service\u63d0\u4f9b\u7684\u662f\u56db\u5c42\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5f53\u53ea\u9700\u8981\u5411\u5916\u66b4\u9732\u4e00\u4e2a\u670d\u52a1\u7684\u65f6\u5019\uff0c\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u662f\u6ca1\u6709\u95ee\u9898\u7684\u3002\u4f46\u5f53\u4e00\u4e2a\u5e94\u7528\u9700\u8981\u5bf9\u5916\u63d0\u4f9b\u591a\u4e2a\u670d\u52a1\u65f6\uff0c\u91c7\u7528\u8be5\u65b9\u5f0f\u5219\u8981\u6c42\u4e3a\u6bcf\u4e00\u4e2a\u56db\u5c42\u670d\u52a1\uff08IP+Port\uff09\u90fd\u521b\u5efa\u4e00\u4e2a\u5916\u90e8load balancer\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u540c\u4e00\u4e2a\u5e94\u7528\u7684\u591a\u4e2a\u670d\u52a1/\u8d44\u6e90\u4f1a\u653e\u5728\u540c\u4e00\u4e2a\u57df\u540d\u4e0b\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u521b\u5efa\u591a\u4e2aLoad balancer\u662f\u5b8c\u5168\u6ca1\u6709\u5fc5\u8981\u7684\uff0c\u53cd\u800c\u5e26\u6765\u4e86\u989d\u5916\u7684\u5f00\u9500\u548c\u7ba1\u7406\u6210\u672c\u3002\u53e6\u5916\u76f4\u63a5\u5c06\u670d\u52a1\u66b4\u9732\u7ed9\u5916\u90e8\u7528\u6237\u4e5f\u4f1a\u5bfc\u81f4\u4e86\u524d\u7aef\u548c\u540e\u7aef\u7684\u8026\u5408\uff0c\u5f71\u54cd\u4e86\u540e\u7aef\u67b6\u6784\u7684\u7075\u6d3b\u6027\uff0c\u5982\u679c\u4ee5\u540e\u7531\u4e8e\u4e1a\u52a1\u9700\u6c42\u5bf9\u670d\u52a1\u8fdb\u884c\u8c03\u6574\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230\u5ba2\u6237\u7aef\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528Kubernetes Ingress\u6765\u7edf\u4e00\u7f51\u7edc\u5165\u53e3\u3002Kubernetes Ingress\u58f0\u660e\u4e86\u4e00\u4e2a\u5e94\u7528\u5c42\uff08OSI\u4e03\u5c42\uff09\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u53ef\u4ee5\u6839\u636eHTTP\u8bf7\u6c42\u7684\u5185\u5bb9\u5c06\u6765\u81ea\u540c\u4e00\u4e2aTCP\u7aef\u53e3\u7684\u8bf7\u6c42\u5206\u53d1\u5230\u4e0d\u540c\u7684Kubernetes Service\uff0c\u5176\u529f\u80fd\u5305\u62ec\uff1a</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#12331-httpurl","title":"12.3.3.1 \u6309HTTP\u8bf7\u6c42\u7684URL\u8fdb\u884c\u8def\u7531","text":"<p>\u540c\u4e00\u4e2aTCP\u7aef\u53e3\u8fdb\u6765\u7684\u6d41\u91cf\u53ef\u4ee5\u6839\u636eURL\u8def\u7531\u5230Cluster\u4e2d\u7684\u4e0d\u540c\u670d\u52a1\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p>\u56fe\u7247 - \u6309HTTP\u8bf7\u6c42\u7684ULR\u8fdb\u884c\u8def\u7531</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#12332-httphost","title":"12.3.3.2 \u6309HTTP\u8bf7\u6c42\u7684Host\u8fdb\u884c\u8def\u7531","text":"<p>\u540c\u4e00\u4e2aIP\u8fdb\u6765\u7684\u6d41\u91cf\u53ef\u4ee5\u6839\u636eHTTP\u8bf7\u6c42\u7684Host\u8def\u7531\u5230Cluster\u4e2d\u7684\u4e0d\u540c\u670d\u52a1\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p>\u56fe\u7247 - \u6309HTTP\u8bf7\u6c42\u7684Host\u8fdb\u884c\u8def\u7531</p> <p>Ingress \u89c4\u5219\u5b9a\u4e49\u4e86\u5bf9\u4e03\u5c42\u7f51\u5173\u7684\u8981\u6c42\uff0c\u5305\u62ecURL\u5206\u53d1\u89c4\u5219\uff0c\u57fa\u4e8e\u4e0d\u540c\u57df\u540d\u7684\u865a\u62df\u4e3b\u673a\uff0cSSL\u8bc1\u4e66\u7b49\u3002Kubernetes\u4f7f\u7528Ingress Controller \u6765\u76d1\u63a7Ingress\u89c4\u5219\uff0c\u5e76\u901a\u8fc7\u4e00\u4e2a\u4e03\u5c42\u7f51\u5173\u6765\u5b9e\u73b0\u8fd9\u4e9b\u8981\u6c42\uff0c\u4e00\u822c\u53ef\u4ee5\u4f7f\u7528Nginx\uff0cHAProxy\uff0cEnvoy\u7b49\u3002</p> <p>\u867d\u7136Ingress Controller\u901a\u8fc7\u4e03\u5c42\u7f51\u5173\u4e3a\u540e\u7aef\u7684\u591a\u4e2aService\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u5165\u53e3\uff0c\u4f46\u7531\u4e8e\u5176\u90e8\u7f72\u5728\u96c6\u7fa4\u4e2d\uff0c\u56e0\u6b64\u5e76\u4e0d\u80fd\u76f4\u63a5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\u5b9e\u9645\u4e0aIngress\u9700\u8981\u914d\u5408NodePort\u548cLoadBalancer\u624d\u80fd\u63d0\u4f9b\u5bf9\u5916\u7684\u6d41\u91cf\u5165\u53e3\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p>\u56fe\u7247 - \u91c7\u7528Ingress, NodePortal\u548cLoadBalancer\u63d0\u4f9b\u5916\u90e8\u6d41\u91cf\u5165\u53e3\u7684\u62d3\u6251\u7ed3\u6784</p> <p>\u4e0a\u56fe\u63cf\u8ff0\u4e86\u5982\u4f55\u91c7\u7528Ingress\u914d\u5408NodePort\u548cLoad Balancer\u4e3a\u96c6\u7fa4\u63d0\u4f9b\u5916\u90e8\u6d41\u91cf\u5165\u53e3\uff0c\u4ece\u8be5\u62d3\u6251\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\u8be5\u67b6\u6784\u7684\u4f38\u7f29\u6027\u975e\u5e38\u597d\uff0c\u5728NodePort\uff0cIngress\uff0cPod\u7b49\u4e0d\u540c\u7684\u63a5\u5165\u5c42\u9762\u90fd\u53ef\u4ee5\u5bf9\u7cfb\u7edf\u8fdb\u884c\u6c34\u5e73\u6269\u5c55\uff0c\u4ee5\u5e94\u5bf9\u4e0d\u540c\u7684\u5916\u90e8\u6d41\u91cf\u8981\u6c42\u3002</p> <p>\u4e0a\u56fe\u53ea\u5c55\u793a\u4e86\u903b\u8f91\u67b6\u6784\uff0c\u4e0b\u9762\u7684\u56fe\u5c55\u793a\u4e86\u5177\u4f53\u7684\u5b9e\u73b0\u539f\u7406\uff1a</p> <p>\u56fe\u7247 - \u91c7\u7528Ingress, NodePortal\u548cLoadBalancer\u63d0\u4f9b\u5916\u90e8\u6d41\u91cf\u5165\u53e3\u7684\u5b9e\u73b0\u539f\u7406</p> <p>\u6d41\u91cf\u4ece\u5916\u90e8\u7f51\u7edc\u5230\u8fbePod\u7684\u5b8c\u6574\u8def\u5f84\u5982\u4e0b\uff1a</p> <ol> <li>\u5916\u90e8\u8bf7\u6c42\u5148\u901a\u8fc7\u56db\u5c42Load Balancer\u8fdb\u5165\u5185\u90e8\u7f51\u7edc</li> <li>Load Balancer\u5c06\u6d41\u91cf\u5206\u53d1\u5230\u540e\u7aef\u591a\u4e2a\u4e3b\u673a\u8282\u70b9\u4e0a\u7684NodePort (userspace\u8f6c\u53d1)</li> <li>\u8bf7\u6c42\u4eceNodePort\u8fdb\u5165\u5230Ingress Controller (iptabes\u89c4\u5219\uff0cIngress Controller\u672c\u8eab\u662f\u4e00\u4e2aNodePort\u7c7b\u578b\u7684Service)</li> <li>Ingress Controller\u6839\u636eIngress rule\u8fdb\u884c\u4e03\u5c42\u5206\u53d1\uff0c\u6839\u636eHTTP\u7684URL\u548cHost\u5c06\u8bf7\u6c42\u5206\u53d1\u7ed9\u4e0d\u540c\u7684Service (userspace\u8f6c\u53d1)</li> <li>Service\u5c06\u8bf7\u6c42\u6700\u7ec8\u5bfc\u5165\u5230\u540e\u7aef\u63d0\u4f9b\u670d\u52a1\u7684Pod\u4e2d (iptabes\u89c4\u5219)</li> </ol> <p>\u4ece\u524d\u9762\u7684\u4ecb\u7ecd\u53ef\u4ee5\u770b\u5230\uff0cK8S Ingress\u63d0\u4f9b\u4e86\u4e00\u4e2a\u57fa\u7840\u7684\u4e03\u5c42\u7f51\u5173\u529f\u80fd\u7684\u62bd\u8c61\u5b9a\u4e49\uff0c\u5176\u4f5c\u7528\u662f\u5bf9\u5916\u63d0\u4f9b\u4e00\u4e2a\u4e03\u5c42\u670d\u52a1\u7684\u7edf\u4e00\u5165\u53e3\uff0c\u5e76\u6839\u636eURL/HOST\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u96c6\u7fa4\u5185\u90e8\u4e0d\u540c\u7684\u670d\u52a1\u4e0a\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#124","title":"12.4 \u5982\u4f55\u4e3a\u670d\u52a1\u7f51\u683c\u9009\u62e9\u5165\u53e3\u7f51\u5173\uff1f","text":"<p>\u5728Istio\u670d\u52a1\u7f51\u683c\u4e2d\uff0c\u901a\u8fc7\u4e3a\u6bcf\u4e2aService\u90e8\u7f72\u4e00\u4e2asidecar\u4ee3\u7406\uff0cIstio\u63a5\u7ba1\u4e86Service\u4e4b\u95f4\u7684\u8bf7\u6c42\u6d41\u91cf\u3002\u63a7\u5236\u9762\u53ef\u4ee5\u5bf9\u7f51\u683c\u4e2d\u7684\u6240\u6709sidecar\u4ee3\u7406\u8fdb\u884c\u7edf\u4e00\u914d\u7f6e\uff0c\u5b9e\u73b0\u4e86\u5bf9\u7f51\u683c\u5185\u90e8\u6d41\u91cf\u7684\u8def\u7531\u63a7\u5236\uff0c\u4ece\u800c\u53ef\u4ee5\u5b9e\u73b0\u7070\u5ea6\u53d1\u5e03\uff0c\u6d41\u91cf\u955c\u50cf\uff0c\u6545\u969c\u6ce8\u5165\u7b49\u670d\u52a1\u7ba1\u63a7\u529f\u80fd\u3002\u4f46\u662f\uff0cIstio\u5e76\u6ca1\u6709\u4e3a\u5165\u53e3\u7f51\u5173\u63d0\u4f9b\u4e00\u4e2a\u8f83\u4e3a\u5b8c\u5584\u7684\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#1241-k8s-ingress","title":"12.4.1 K8s Ingress","text":"<p>\u57280.8\u7248\u672c\u4ee5\u524d\uff0cIstio\u7f3a\u7701\u91c7\u7528K8s Ingress\u6765\u4f5c\u4e3aService Mesh\u7684\u6d41\u91cf\u5165\u53e3\u3002K8s Ingress\u7edf\u4e00\u4e86\u5e94\u7528\u7684\u6d41\u91cf\u5165\u53e3\uff0c\u4f46\u5b58\u5728\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>K8s Ingress\u662f\u72ec\u7acb\u5728Istio\u4f53\u7cfb\u4e4b\u5916\u7684\uff0c\u9700\u8981\u5355\u72ec\u91c7\u7528Ingress rule\u8fdb\u884c\u914d\u7f6e\uff0c\u5bfc\u81f4\u7cfb\u7edf\u5165\u53e3\u548c\u5185\u90e8\u5b58\u5728\u4e24\u5957\u4e92\u76f8\u72ec\u7acb\u7684\u8def\u7531\u89c4\u5219\u914d\u7f6e\uff0c\u8fd0\u7ef4\u548c\u7ba1\u7406\u8f83\u4e3a\u590d\u6742\u3002</li> <li>K8s Ingress rule\u7684\u529f\u80fd\u8f83\u5f31\uff0c\u4e0d\u80fd\u5728\u5165\u53e3\u5904\u5b9e\u73b0\u548c\u7f51\u683c\u5185\u90e8\u7c7b\u4f3c\u7684\u8def\u7531\u89c4\u5219\uff0c\u4e5f\u4e0d\u5177\u5907\u7f51\u683csidecar\u7684\u5176\u5b83\u80fd\u529b\uff0c\u5bfc\u81f4\u96be\u4ee5\u4ece\u6574\u4f53\u4e0a\u4e3a\u5e94\u7528\u7cfb\u7edf\u5b9e\u73b0\u7070\u5ea6\u53d1\u5e03\u3001\u5206\u5e03\u5f0f\u8ddf\u8e2a\u7b49\u670d\u52a1\u7ba1\u63a7\u529f\u80fd\u3002</li> </ul> <p>\u56fe\u7247 - \u91c7\u7528Kubernetes Ingress\u4f5c\u4e3a\u670d\u52a1\u7f51\u683c\u7684\u6d41\u91cf\u5165\u53e3</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#1242-istio-gateway","title":"12.4.2 Istio Gateway","text":"<p>Istio\u793e\u533a\u610f\u8bc6\u5230\u4e86Ingress\u548cMesh\u5185\u90e8\u914d\u7f6e\u5272\u88c2\u7684\u95ee\u9898\uff0c\u56e0\u6b64\u4ece0.8\u7248\u672c\u5f00\u59cb\uff0c\u793e\u533a\u91c7\u7528\u4e86 Gateway \u8d44\u6e90\u4ee3\u66ffK8s Ingress\u6765\u8868\u793a\u6d41\u91cf\u5165\u53e3\u3002</p> <p>Istio Gateway\u8d44\u6e90\u672c\u8eab\u53ea\u80fd\u914d\u7f6eL4-L6\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u66b4\u9732\u7684\u7aef\u53e3\uff0cTLS\u8bbe\u7f6e\u7b49\uff1b\u4f46Gateway\u53ef\u4ee5\u548c\u7ed1\u5b9a\u4e00\u4e2aVirtualService\uff0c\u5728VirtualService \u4e2d\u53ef\u4ee5\u914d\u7f6e\u4e03\u5c42\u8def\u7531\u89c4\u5219\uff0c\u8fd9\u4e9b\u4e03\u5c42\u8def\u7531\u89c4\u5219\u5305\u62ec\u6839\u636e\u6309\u7167\u670d\u52a1\u7248\u672c\u5bf9\u8bf7\u6c42\u8fdb\u884c\u5bfc\u6d41\uff0c\u6545\u969c\u6ce8\u5165\uff0cHTTP\u91cd\u5b9a\u5411\uff0cHTTP\u91cd\u5199\u7b49\u6240\u6709Mesh\u5185\u90e8\u652f\u6301\u7684\u8def\u7531\u89c4\u5219\u3002</p> <p>Gateway\u548cVirtualService\u7528\u4e8e\u8868\u793aIstio Ingress\u7684\u914d\u7f6e\u6a21\u578b\uff0cIstio Ingress\u7684\u7f3a\u7701\u5b9e\u73b0\u5219\u91c7\u7528\u4e86\u548cSidecar\u76f8\u540c\u7684Envoy proxy\u3002</p> <p>\u901a\u8fc7\u8be5\u65b9\u5f0f\uff0cIstio\u63a7\u5236\u9762\u7528\u4e00\u81f4\u7684\u914d\u7f6e\u6a21\u578b\u540c\u65f6\u63a7\u5236\u4e86\u5165\u53e3\u7f51\u5173\u548c\u5185\u90e8\u7684sidecar\u4ee3\u7406\u3002\u8fd9\u4e9b\u914d\u7f6e\u5305\u62ec\u8def\u7531\u89c4\u5219\uff0c\u7b56\u7565\u68c0\u67e5\u3001Telemetry\u6536\u96c6\u4ee5\u53ca\u5176\u4ed6\u670d\u52a1\u7ba1\u63a7\u529f\u80fd\u3002</p> <p>\u56fe\u7247 - \u91c7\u7528 Istio Ingress Gateway\u4f5c\u4e3a\u670d\u52a1\u7f51\u683c\u7684\u6d41\u91cf\u5165\u53e3</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#1243-api-gateway","title":"12.4.3 \u5e94\u7528\u5bf9API Gateway\u7684\u9700\u6c42","text":"<p>\u91c7\u7528Gateway\u548cVirtualService\u5b9e\u73b0\u7684Istio Ingress Gateway\u63d0\u4f9b\u4e86\u7f51\u7edc\u5165\u53e3\u5904\u7684\u57fa\u7840\u901a\u4fe1\u529f\u80fd\uff0c\u5305\u62ec\u53ef\u9760\u7684\u901a\u4fe1\u548c\u7075\u6d3b\u7684\u8def\u7531\u89c4\u5219\u3002\u4f46\u5bf9\u4e8e\u4e00\u4e2a\u670d\u52a1\u5316\u5e94\u7528\u6765\u8bf4\uff0c\u7f51\u7edc\u5165\u53e3\u9664\u4e86\u57fa\u7840\u7684\u901a\u8baf\u529f\u80fd\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7684\u5e94\u7528\u5c42\u529f\u80fd\u9700\u6c42\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u7b2c\u4e09\u65b9\u7cfb\u7edf\u5bf9API\u7684\u8bbf\u95ee\u63a7\u5236</li> <li>\u7528\u6237\u5bf9\u7cfb\u7edf\u7684\u8bbf\u95ee\u63a7\u5236</li> <li>\u4fee\u6539\u8bf7\u6c42/\u8fd4\u56de\u6570\u636e</li> <li>\u670d\u52a1API\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406</li> <li>\u670d\u52a1\u8bbf\u95ee\u7684SLA\u3001\u9650\u6d41\u53ca\u8ba1\u8d39</li> <li>\u2026.</li> </ul> <p>\u56fe\u7247 - Kubernetes ingress, Istio gateway and API gateway\u7684\u529f\u80fd\u5bf9\u6bd4</p> <p>API Gateway\u9700\u6c42\u4e2d\u5f88\u5927\u4e00\u90e8\u5206\u9700\u8981\u6839\u636e\u4e0d\u540c\u7684\u5e94\u7528\u7cfb\u7edf\u8fdb\u884c\u5b9a\u5236\uff0c\u76ee\u524d\u770b\u6765\u6682\u65f6\u4e0d\u5927\u53ef\u80fd\u88ab\u7eb3\u5165K8s Ingress\u6216\u8005Istio Gateway\u7684\u89c4\u8303\u4e4b\u4e2d\u3002\u4e3a\u4e86\u6ee1\u8db3\u8fd9\u4e9b\u9700\u6c42\uff0c\u6d8c\u73b0\u51fa\u4e86\u5404\u7c7b\u4e0d\u540c\u7684k8s Ingress Controller\u4ee5\u53caIstio Ingress Gateway\u5b9e\u73b0\uff0c\u5305\u62ecAmbassador \uff0cKong, Traefik,Solo\u7b49\u3002</p> <p>\u8fd9\u4e9b\u7f51\u5173\u4ea7\u54c1\u5728\u5b9e\u73b0\u5728\u63d0\u4f9b\u57fa\u7840\u7684K8s Ingress\u80fd\u529b\u7684\u540c\u65f6\uff0c\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684API Gateway\u529f\u80fd\uff0c\u4f46\u7531\u4e8e\u7f3a\u5c11\u7edf\u4e00\u7684\u6807\u51c6\uff0c\u8fd9\u4e9b\u6269\u5c55\u5b9e\u73b0\u4e4b\u95f4\u76f8\u4e92\u4e4b\u95f4\u5e76\u4e0d\u517c\u5bb9\u3002\u800c\u4e14\u9057\u61be\u7684\u662f\uff0c\u76ee\u524d\u8fd9\u4e9bIngress controller\u90fd\u8fd8\u6ca1\u6709\u6b63\u5f0f\u63d0\u4f9b\u548cIstio \u63a7\u5236\u9762\u96c6\u6210\u7684\u80fd\u529b\u3002</p> <p>\u5907\u6ce8\uff1a</p> <ul> <li>Ambassador\u5c06\u5bf9Istio\u8def\u7531\u89c4\u5219\u7684\u652f\u6301\u7eb3\u5165\u4e86Roadmap https://www.getambassador.io/user-guide/with-istio/</li> <li>Istio\u58f0\u79f0\u652f\u6301Istio-Based Route Rule Discovery (\u5c1a\u5904\u4e8e\u5b9e\u9a8c\u9636\u6bb5) https://gloo.solo.io/introduction/architecture/</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20Handbook%E4%B9%8BIstio%20%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98/#1244-api-gateway-sidecar-proxy","title":"12.4.4 \u91c7\u7528API Gateway + Sidecar Proxy\u4f5c\u4e3a\u670d\u52a1\u7f51\u683c\u7684\u6d41\u91cf\u5165\u53e3","text":"<p>\u5728\u76ee\u524d\u96be\u4ee5\u627e\u5230\u4e00\u4e2a\u540c\u65f6\u5177\u5907API Gateway\u548cIstio Ingress\u80fd\u529b\u7684\u7f51\u5173\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u53ef\u884c\u7684\u65b9\u6848\u662f\u4f7f\u7528API Gateway\u548cSidecar Proxy\u4e00\u8d77\u4e3a\u670d\u52a1\u7f51\u683c\u63d0\u4f9b\u5916\u90e8\u6d41\u91cf\u5165\u53e3\u3002</p> <p>\u7531\u4e8eAPI Gateway\u5df2\u7ecf\u5177\u5907\u4e03\u5c42\u7f51\u5173\u7684\u529f\u80fd\uff0cMesh Ingress\u4e2d\u7684Sidecar\u53ea\u9700\u8981\u63d0\u4f9bVirtualService\u8d44\u6e90\u7684\u8def\u7531\u80fd\u529b\uff0c\u5e76\u4e0d\u9700\u8981\u63d0\u4f9bGateway\u8d44\u6e90\u7684\u7f51\u5173\u80fd\u529b\uff0c\u56e0\u6b64\u91c7\u7528Sidecar Proxy\u5373\u53ef\u3002\u7f51\u7edc\u5165\u53e3\u5904\u7684Sidecar Proxy\u548c\u7f51\u683c\u5185\u90e8\u5e94\u7528Pod\u4e2dSidecar Proxy\u7684\u552f\u4e00\u4e00\u70b9\u533a\u522b\u662f\uff1a\u8be5Sidecar\u53ea\u63a5\u7ba1API Gateway\u5411Mesh\u5185\u90e8\u7684\u6d41\u91cf\uff0c\u5e76\u4e0d\u63a5\u7ba1\u5916\u90e8\u6d41\u5411API Gateway\u7684\u6d41\u91cf\uff1b\u800c\u5e94\u7528Pod\u4e2d\u7684Sidecar\u9700\u8981\u63a5\u7ba1\u8fdb\u5165\u5e94\u7528\u7684\u6240\u6709\u6d41\u91cf\u3002</p> <p>\u56fe\u7247 - \u91c7\u7528API Gateway + Sidecar Proxy\u4e3a\u670d\u52a1\u7f51\u683c\u63d0\u4f9b\u6d41\u91cf\u5165\u53e3</p> <p>\u5907\u6ce8\uff1a\u5728\u5b9e\u9645\u90e8\u7f72\u65f6\uff0cAPI Gateway\u524d\u7aef\u9700\u8981\u91c7\u7528NodePort\u548cLoadBalancer\u63d0\u4f9b\u5916\u90e8\u6d41\u91cf\u5165\u53e3\u3002\u4e3a\u4e86\u7a81\u51fa\u4e3b\u9898\uff0c\u5bf9\u4e0a\u56fe\u8fdb\u884c\u4e86\u7b80\u5316\uff0c\u6ca1\u6709\u753b\u51faNodePort\u548cLoadBalancer\u3002</p> <p>\u91c7\u7528API Gateway\u548cSidecar Proxy\u4e00\u8d77\u4f5c\u4e3a\u670d\u52a1\u7f51\u683c\u7684\u6d41\u91cf\u5165\u53e3\uff0c\u65e2\u80fd\u591f\u901a\u8fc7\u5bf9\u7f51\u5173\u8fdb\u884c\u5b9a\u5236\u5f00\u53d1\u6ee1\u8db3\u4ea7\u54c1\u5bf9API\u7f51\u5173\u7684\u5404\u79cd\u9700\u6c42\uff0c\u53c8\u53ef\u4ee5\u5728\u7f51\u7edc\u5165\u53e3\u5904\u5229\u7528\u670d\u52a1\u7f51\u683c\u63d0\u4f9b\u7684\u7075\u6d3b\u7684\u8def\u7531\u80fd\u529b\u548c\u5206\u5e03\u5f0f\u8ddf\u8e2a\uff0c\u7b56\u7565\u7b49\u7ba1\u63a7\u529f\u80fd\uff0c\u662f\u670d\u52a1\u7f51\u683c\u4ea7\u54c1\u5165\u53e3\u7f51\u5173\u7684\u4e00\u4e2a\u7406\u60f3\u65b9\u6848\u3002</p> <p>\u6027\u80fd\u65b9\u9762\u7684\u8003\u8651\uff1a\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u91c7\u7528\u8be5\u65b9\u6848\u540e\uff0c\u5916\u90e8\u8bf7\u6c42\u7684\u5904\u7406\u6d41\u7a0b\u5728\u5165\u53e3\u5904\u589e\u52a0\u4e86Sidecar Proxy\u8fd9\u4e00\u8df3\uff0c\u56e0\u6b64\u8be5\u65b9\u5f0f\u4f1a\u5e26\u6765\u5c11\u91cf\u7684\u6027\u80fd\u635f\u5931\uff0c\u4f46\u8be5\u635f\u5931\u662f\u5b8c\u5168\u53ef\u4ee5\u63a5\u53d7\u7684\u3002</p> <p>\u5bf9\u4e8e\u8bf7\u6c42\u65f6\u5ef6\u800c\u8a00\uff0c\u5728\u670d\u52a1\u7f51\u683c\u4e2d\uff0c\u4e00\u4e2a\u5916\u90e8\u8bf7\u6c42\u672c\u6765\u5c31\u8981\u7ecf\u8fc7\u8f83\u591a\u7684\u4ee3\u7406\u548c\u5e94\u7528\u8fdb\u7a0b\u7684\u5904\u7406\uff0c\u5728Ingress\u5904\u589e\u52a0\u4e00\u4e2a\u4ee3\u7406\u5bf9\u6574\u4f53\u7684\u65f6\u5ef6\u5f71\u54cd\u57fa\u672c\u5ffd\u7565\u4e0d\u8ba1\uff0c\u800c\u4e14\u5bf9\u4e8e\u7edd\u5927\u591a\u6570\u5e94\u7528\u6765\u8bf4\uff0c\u7f51\u7edc\u8f6c\u53d1\u6240\u5360\u7684\u65f6\u95f4\u6bd4\u4f8b\u672c\u6765\u5c31\u5f88\u5c0f\uff0c99%\u7684\u8017\u65f6\u90fd\u5728\u4e1a\u52a1\u903b\u8f91\u3002\u5982\u679c\u7cfb\u7edf\u5bf9\u4e8e\u589e\u52a0\u7684\u8be5\u65f6\u5ef6\u975e\u5e38\u654f\u611f\uff0c\u5219\u5efa\u8bae\u91cd\u65b0\u8003\u8651\u8be5\u7cfb\u7edf\u662f\u5426\u9700\u8981\u91c7\u7528\u5fae\u670d\u52a1\u67b6\u6784\u548c\u670d\u52a1\u7f51\u683c\u3002</p> <p>\u5bf9\u4e8e\u541e\u5410\u91cf\u800c\u8a00\uff0c\u5982\u679c\u5165\u53e3\u5904\u7684\u7f51\u7edc\u541e\u5410\u91cf\u5b58\u5728\u74f6\u9888\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u5bf9API Gateway + Sidecar Proxy\u7ec4\u6210\u7684Ingress\u6574\u4f53\u8fdb\u884c\u6c34\u5e73\u6269\u5c55\uff0c\u6765\u5bf9\u5165\u53e3\u6d41\u91cf\u8fdb\u884c\u8d1f\u8377\u5206\u62c5\uff0c\u4ee5\u63d0\u9ad8\u7f51\u683c\u5165\u53e3\u7684\u7f51\u7edc\u541e\u5410\u91cf\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/","title":"Istio \u8be6\u89e3","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#gateway","title":"\u4e00 Gateway","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#11","title":"1.1 \u7b80\u4ecb","text":"<p>\u4f7f\u7528\u7f51\u5173\u4e3a\u7f51\u683c\u6765\u7ba1\u7406\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\uff0c\u53ef\u4ee5\u8ba9\u60a8\u6307\u5b9a\u8981\u8fdb\u5165\u6216\u79bb\u5f00\u7f51\u683c\u7684\u6d41\u91cf\u3002\u7f51\u5173\u914d\u7f6e\u88ab\u7528\u4e8e\u8fd0\u884c\u5728\u7f51\u683c\u8fb9\u754c\u7684\u72ec\u7acb Envoy \u4ee3\u7406\uff0c\u800c\u4e0d\u662f\u670d\u52a1\u5de5\u4f5c\u8d1f\u8f7d\u7684 sidecar \u4ee3\u7406\u3002</p> <p>Istio \u7684\u7f51\u5173\u8d44\u6e90\u53ef\u4ee5\u914d\u7f6e 4-6 \u5c42\u7684\u8d1f\u8f7d\u5747\u8861\u5c5e\u6027\uff0c\u5982\u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\u3001TLS \u8bbe\u7f6e\u7b49\u3002\u4f5c\u4e3a\u66ff\u4ee3\u5e94\u7528\u5c42\u6d41\u91cf\u8def\u7531\uff08L7\uff09\u5230\u76f8\u540c\u7684 API \u8d44\u6e90\uff0c\u60a8\u7ed1\u5b9a\u4e86\u4e00\u4e2a\u5e38\u89c4\u7684 Istio \u865a\u62df\u670d\u52a1\u5230\u7f51\u5173\u3002\u8fd9\u8ba9\u60a8\u53ef\u4ee5\u50cf\u7ba1\u7406\u7f51\u683c\u4e2d\u5176\u4ed6\u6570\u636e\u5e73\u9762\u7684\u6d41\u91cf\u4e00\u6837\u53bb\u7ba1\u7406\u7f51\u5173\u6d41\u91cf\u3002</p> <p>\u7f51\u5173\u4e3b\u8981\u7528\u4e8e\u7ba1\u7406\u8fdb\u5165\u7684\u6d41\u91cf\uff0c\u4f46\u60a8\u4e5f\u53ef\u4ee5\u914d\u7f6e\u51fa\u53e3\u7f51\u5173\u3002\u51fa\u53e3\u7f51\u5173\u8ba9\u60a8\u4e3a\u79bb\u5f00\u7f51\u683c\u7684\u6d41\u91cf\u914d\u7f6e\u4e00\u4e2a\u4e13\u7528\u7684\u51fa\u53e3\u8282\u70b9\uff0c\u8fd9\u53ef\u4ee5\u9650\u5236\u54ea\u4e9b\u670d\u52a1\u53ef\u4ee5\u6216\u5e94\u8be5\u8bbf\u95ee\u5916\u90e8\u7f51\u7edc\uff0c\u6216\u8005\u542f\u7528\u51fa\u53e3\u6d41\u91cf\u5b89\u5168\u63a7\u5236\u4e3a\u60a8\u7684\u7f51\u683c\u6dfb\u52a0\u5b89\u5168\u6027\u3002\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7f51\u5173\u914d\u7f6e\u4e00\u4e2a\u7eaf\u7cb9\u7684\u5185\u90e8\u4ee3\u7406\u3002</p> <p>Istio \u63d0\u4f9b\u4e86\u4e00\u4e9b\u9884\u5148\u914d\u7f6e\u597d\u7684\u7f51\u5173\u4ee3\u7406\u90e8\u7f72\uff08<code>istio-ingressgateway</code> \u548c <code>istio-egressgateway</code>\uff09</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#12","title":"1.2 \u914d\u7f6e\u8be6\u89e3","text":"<ul> <li>Gateway</li> </ul> Field Type Description Required <code>servers</code> <code>Server[]</code> A list of server specifications. Yes <code>selector</code> <code>map&lt;string, string&gt;</code> One or more labels that indicate a specific set of pods/VMs on which this gateway configuration should be applied. The scope of label search is restricted to the configuration namespace in which the the resource is present. In other words, the Gateway resource must reside in the same namespace as the gateway workload instance. Yes <ul> <li>Port</li> </ul> Field Type Description Required <code>number</code> <code>uint32</code> A valid non-negative integer port number. Yes <code>protocol</code> <code>string</code> The protocol exposed on the port. MUST BE one of HTTP|HTTPS|GRPC|HTTP2|MONGO|TCP|TLS. TLS implies the connection will be routed based on the SNI header to the destination without terminating the TLS connection. Yes <code>name</code> <code>string</code> Label assigned to the port. No <ul> <li>Server</li> </ul> Field Type Description Required <code>port</code> <code>Port</code> The Port on which the proxy should listen for incoming connections. Yes <code>hosts</code> <code>string[]</code> One or more hosts exposed by this gateway. While typically applicable to HTTP services, it can also be used for TCP services using TLS with SNI. A host is specified as a <code>dnsName</code> with an optional <code>namespace/</code> prefix. The <code>dnsName</code> should be specified using FQDN format, optionally including a wildcard character in the left-most component (e.g., <code>prod/*.example.com</code>). Set the <code>dnsName</code> to <code>*</code> to select all <code>VirtualService</code> hosts from the specified namespace (e.g.,<code>prod/*</code>).The <code>namespace</code> can be set to <code>*</code> or <code>.</code>, representing any or the current namespace, respectively. For example, <code>*/foo.example.com</code> selects the service from any available namespace while <code>./foo.example.com</code> only selects the service from the namespace of the sidecar. The default, if no <code>namespace/</code> is specified, is <code>*/</code>, that is, select services from any namespace. Any associated <code>DestinationRule</code> in the selected namespace will also be used.A <code>VirtualService</code> must be bound to the gateway and must have one or more hosts that match the hosts specified in a server. The match could be an exact match or a suffix match with the server\u2019s hosts. For example, if the server\u2019s hosts specifies <code>*.example.com</code>, a <code>VirtualService</code> with hosts <code>dev.example.com</code> or <code>prod.example.com</code> will match. However, a <code>VirtualService</code> with host <code>example.com</code> or <code>newexample.com</code> will not match.NOTE: Only virtual services exported to the gateway\u2019s namespace (e.g., <code>exportTo</code> value of <code>*</code>) can be referenced. Private configurations (e.g., <code>exportTo</code> set to <code>.</code>) will not be available. Refer to the <code>exportTo</code> setting in <code>VirtualService</code>, <code>DestinationRule</code>, and <code>ServiceEntry</code> configurations for details. Yes <code>tls</code> <code>TLSOptions</code> Set of TLS related options that govern the server\u2019s behavior. Use these options to control if all http requests should be redirected to https, and the TLS modes to use. No <code>defaultEndpoint</code> <code>string</code> The loopback IP endpoint or Unix domain socket to which traffic should be forwarded to by default. Format should be <code>127.0.0.1:PORT</code> or <code>unix:///path/to/socket</code> or <code>unix://@foobar</code> (Linux abstract namespace). No <ul> <li>Server.TLSOptions</li> </ul> Field Type Description Required <code>httpsRedirect</code> <code>bool</code> If set to true, the load balancer will send a 301 redirect for all http connections, asking the clients to use HTTPS. No <code>mode</code> <code>TLSmode</code> Optional: Indicates whether connections to this port should be secured using TLS. The value of this field determines how TLS is enforced. No <code>serverCertificate</code> <code>string</code> REQUIRED if mode is <code>SIMPLE</code> or <code>MUTUAL</code>. The path to the file holding the server-side TLS certificate to use. No <code>privateKey</code> <code>string</code> REQUIRED if mode is <code>SIMPLE</code> or <code>MUTUAL</code>. The path to the file holding the server\u2019s private key. No <code>caCertificates</code> <code>string</code> REQUIRED if mode is <code>MUTUAL</code>. The path to a file containing certificate authority certificates to use in verifying a presented client side certificate. No <code>credentialName</code> <code>string</code> The credentialName stands for a unique identifier that can be used to identify the serverCertificate and the privateKey. The credentialName appended with suffix \u201c-cacert\u201d is used to identify the CaCertificates associated with this server. Gateway workloads capable of fetching credentials from a remote credential store such as Kubernetes secrets, will be configured to retrieve the serverCertificate and the privateKey using credentialName, instead of using the file system paths specified above. If using mutual TLS, gateway workload instances will retrieve the CaCertificates using credentialName-cacert. The semantics of the name are platform dependent. In Kubernetes, the default Istio supplied credential server expects the credentialName to match the name of the Kubernetes secret that holds the server certificate, the private key, and the CA certificate (if using mutual TLS). Set the <code>ISTIO_META_USER_SDS</code> metadata variable in the gateway\u2019s proxy to enable the dynamic credential fetching feature. No <code>subjectAltNames</code> <code>string[]</code> A list of alternate names to verify the subject identity in the certificate presented by the client. No <code>verifyCertificateSpki</code> <code>string[]</code> An optional list of base64-encoded SHA-256 hashes of the SKPIs of authorized client certificates. Note: When both verify*certificate*hash and verify*certificate*spki are specified, a hash matching either value will result in the certificate being accepted. No <code>verifyCertificateHash</code> <code>string[]</code> An optional list of hex-encoded SHA-256 hashes of the authorized client certificates. Both simple and colon separated formats are acceptable. Note: When both verify*certificate*hash and verify*certificate*spki are specified, a hash matching either value will result in the certificate being accepted. No <code>minProtocolVersion</code> <code>TLSProtocol</code> Optional: Minimum TLS protocol version. No <code>maxProtocolVersion</code> <code>TLSProtocol</code> Optional: Maximum TLS protocol version. No <code>cipherSuites</code> <code>string[]</code> Optional: If specified, only support the specified cipher list. Otherwise default to the default cipher list supported by Envoy. No <ul> <li>Server.TLSOptions.TLSProtocol</li> </ul> Name Description <code>TLS_AUTO</code> Automatically choose the optimal TLS version. <code>TLSV1_0</code> TLS version 1.0 <code>TLSV1_1</code> TLS version 1.1 <code>TLSV1_2</code> TLS version 1.2 <code>TLSV1_3</code> TLS version 1.3 <ul> <li>Server.TLSOptions.TLSmode</li> </ul> Name Description <code>PASSTHROUGH</code> The SNI string presented by the client will be used as the match criterion in a VirtualService TLS route to determine the destination service from the service registry. <code>SIMPLE</code> Secure connections with standard TLS semantics. <code>MUTUAL</code> Secure connections to the downstream using mutual TLS by presenting server certificates for authentication. <code>AUTO_PASSTHROUGH</code> Similar to the passthrough mode, except servers with this TLS mode do not require an associated VirtualService to map from the SNI value to service in the registry. The destination details such as the service/subset/port are encoded in the SNI value. The proxy will forward to the upstream (Envoy) cluster (a group of endpoints) specified by the SNI value. This server is typically used to provide connectivity between services in disparate L3 networks that otherwise do not have direct connectivity between their respective endpoints. Use of this mode assumes that both the source and the destination are using Istio mTLS to secure traffic. <code>ISTIO_MUTUAL</code> Secure connections from the downstream using mutual TLS by presenting server certificates for authentication. Compared to Mutual mode, this mode uses certificates, representing gateway workload identity, generated automatically by Istio for mTLS authentication. When this mode is used, all other fields in <code>TLSOptions</code> should be empty."},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#13","title":"1.3 \u793a\u4f8b","text":"<p>gateway\u4e2d\u7684selector \u6307\u5b9a\u7c7b\u578b\u4e3aingressgateway\u6216\u662fegressgateway\uff0c\u5f53\u7136\u53ef\u4ee5\u5236\u5b9a\u5c06gateway\u90e8\u7f72\u5728k8s\u7684\u4e00\u4e2ans\u4e2d\u3002</p> <ul> <li>\u7b80\u5355\u5b9e\u4f8b</li> </ul> <p>\u4f7f\u7528hosts\u5b57\u6bb5\u6765\u5217\u4e3e\u865a\u62df\u670d\u52a1\u7684\u4e3b\u673a\uff0c\u7c7b\u4f3c\u4e8eweb\u670d\u52a1\u5668\u7684\u865a\u62df\u4e3b\u673a--\u5373\u7528\u6237\u6307\u5b9a\u7684\u76ee\u6807\u6d3b\u662f\u8def\u7531\u89c4\u5219\u8bbe\u5b9a\u7684\u76ee\u6807\uff0c\u8fd9\u662f\u5ba2\u6237\u7aef\u60f3\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u65f6\u4f7f\u7528\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u5730\u5740\u3002</p> <p>\u865a\u62df\u670d\u52a1\u4e3b\u673a\u540d\u79f0\u53ef\u4ee5\u662fIP\u5730\u5740\u3001DNS\u540d\u79f0\uff0c\u6216\u8005\u4f9d\u8d56\u4e8e\u5e73\u53f0\u7684\u4e00\u4e2a\u7b80\u79f0\uff08\u4f8b\u5982k8s\u4e2d\u7684svc\u7684\u77ed\u540d\u79f0\uff09\uff0c\u9690\u5f0f\u6216\u663e\u5f0f\u5730\u6267\u884c\u4e00\u4e2a\u5b8c\u5168\u9650\u5b9a\u57df\u540d\uff08FQDN\uff09\uff0chosts\u5b57\u6bb5\u9700\u8981\u4e3a\u6d4f\u89c8\u5668\u8bf7\u6c42\u8bbf\u95ee\u7684hosts\uff0c\u5982\u679c\u4e3aIP\u8bbf\u95ee\u53ef\u4ee5\u4e34\u65f6\u6307\u5b9a\u4e3a<code>*</code></p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: bookinfo-gateway\nspec:\n  selector:\n    istio: ingressgateway # use istio default controller\n  servers:\n  - port:\n      number: 80\n      name: http\n      protocol: HTTP\n    hosts:\n    - \"*\"\n</code></pre> <ul> <li>TLS\u8bc1\u4e66</li> </ul> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: ext-host-gwy\nspec:\n  selector:\n    app: my-gateway-controller\n  servers:\n  - port:\n      number: 443\n      name: https\n      protocol: HTTPS\n    hosts:\n    - ext-host.example.com\n    tls:\n      mode: SIMPLE\n      serverCertificate: /tmp/tls.crt\n      privateKey: /tmp/tls.key    \n</code></pre>"},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#virtualservice","title":"\u4e8c VirtualService","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#21","title":"2.1 \u7b80\u4ecb","text":"<p>\u865a\u62df\u670d\u52a1\u5728\u589e\u5f3a Istio \u6d41\u91cf\u7ba1\u7406\u7684\u7075\u6d3b\u6027\u548c\u6709\u6548\u6027\u65b9\u9762\u53d1\u6325\u7740\u91cd\u8981\u4f5c\u7528\uff0c\u53ef\u4ee5\u914d\u7f6e\u8d85\u65f6\uff0c\u91cd\u8bd5\uff0c\u9ed1\u767d\u540d\u5355\uff0c\u6545\u969c\u6ce8\u5165\uff0c\u57fa\u4e8e\u767e\u5206\u6bd4\u7684\u6d41\u91cf\u5206\u53d1\uff0c\u91d1\u4e1d\u96c0\u53d1\u5e03\u7b49\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#22","title":"2.2 \u914d\u7f6e\u8be6\u89e3","text":"<p>https://istio.io/zh/docs/reference/config/networking/virtual-service/</p>"},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#23","title":"2.3 \u793a\u4f8b","text":"<p>virtualservice \u5bf9\u5e94\u4e00\u4e2asvc\uff0cvs\u662f\u5728svc\u4e0a\u8fdb\u884c\u6765app/version\u7684\u533a\u522b\uff0c\u533a\u5206\u5f00\u6765subnet\uff0c                                                                     </p> <p>\u4e00\u4e2asvc\u5bf9\u5e94\u4e00\u4e2aendpoints\uff0c\u4f46\u662f\u4e00\u4e2aendpoints\u5229\u7528app/version\u5206\u5f00\u4e86\u591a\u4e2asubnet\uff0c\u4e5f\u5c31\u662fdeploy\uff0c\u4e5f\u5c31\u662f\u4e0d\u540c\u7248\u672c\u7684pod</p> <p>\u670d\u52a1\u95f4\u901a\u4fe1\u8fd8\u662f\u4f7f\u7528\u7684\u9ed8\u8ba4K8s\u7684svc</p> <ul> <li>url\u5206\u53d1</li> </ul> <p>\u53ef\u4ee5\u6839\u636e\u6d41\u91cf\u7aef\u53e3\u3001header\u5b57\u6bb5\u3001URI\u7b49\u5185\u5bb9\u4e0a\u8bbe\u7f6e\u5339\u914d\u6761\u4ef6\u3002</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: bookinfo\nspec:\n  hosts:\n  - \"*\"\n  gateways:\n  - bookinfo-gateway\n  http:\n  - match:\n    - uri:\n        exact: /productpage\n    - uri:\n        prefix: /static\n    - uri:\n        exact: /login\n    - uri:\n        exact: /logout\n    - uri:\n        prefix: /api/v1/products\n    route:\n    - destination:\n        host: productpage\n        port:\n          number: 9080\n</code></pre> <ul> <li>\u8bf7\u6c42\u8d85\u65f6</li> </ul> <p>\u8d85\u65f6\u8bbe\u7f6e\u5f0f\u5fae\u4e86\u786e\u4fdd\u670d\u52a1\u4e0d\u4f1a\u56e0\u7b49\u5f85\u7b54\u590d\u800c\u65e0\u9650\u671f\u522e\u8d77\uff0c\u5728\u53ef\u9884\u6d4b\u7684\u65f6\u95f4\u8303\u56f4\u5185\u8c03\u7528\u6210\u529f\u6216\u5931\u8d25\uff0chttp\u8bf7\u6c42\u9ed8\u8ba4\u8d85\u65f615\u79d2\u3002</p> <pre><code># \u8bf7\u6c42\u8d85\u65f6\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - route:\n    - destination:\n        host: ratings\n        subset: v1\n    timeout: 10s\n</code></pre> <ul> <li>\u91cd\u8bd5</li> </ul> <p>\u91cd\u8bd5\u6307\u5982\u679c\u521d\u59cb\u8c03\u7528\u5931\u8d25\uff0cenvoy\u4ee3\u7406\u5c1d\u8bd5\u8fde\u63a5\u670d\u52a1\u7684\u6700\u5927\u6b21\u6570\uff0c\u907f\u514d\u8c03\u7528\u4e0d\u4f1a\u56e0\u4e34\u65f6\u8fc7\u8f7d\u7684\u670d\u52a1\u6216\u7f51\u7edc\u95ee\u9898\u95ee\u6c38\u4e45\u5931\u8d25\uff0c\u91cd\u8bd5\u53ef\u4ee5\u63d0\u4f9b\u670d\u52a1\u53ef\u7528\u6027\u548c\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\uff0c\u91cd\u8bd5\u4e4b\u95f4\u7684\u95f4\u9694(25ms+)\u662f\u53ef\u53d8\u7684\uff0c\u5e76\u7531istio\u81ea\u52a8\u786e\u8ba4\uff0c\u4ece\u800c\u9632\u6b62\u88ab\u8c03\u7528\u670d\u52a1\u88ab\u8bf7\u6c42\u6df9\u6ca1\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5982\u679c\u4e0d\u914d\u7f6e\u91cd\u8bd5\u7b56\u7565\uff0c\u4e0d\u4f1a\u8fdb\u884c\u91cd\u8bd5\u3002</p> <p>\u7ec6\u5316\u91cd\u8bd5\uff0c\u91cd\u8bd53\u6b21\u6765\u8fde\u63a5\u5230\u670d\u52a1\u5b50\u96c6\uff0c\u6bcf\u4e2a\u91cd\u8bd5\u90fd\u67092\u79d2\u7684\u8d85\u65f6\u3002</p> <pre><code># \u91cd\u8bd5\n\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - route:\n    - destination:\n        host: ratings\n        subset: v1\n    retries:\n      attempts: 3\n      perTryTimeout: 2s\n</code></pre> <ul> <li>\u6545\u969c\u6ce8\u5165</li> </ul> <p>\u5728\u914d\u7f6e\u7684\u7f51\u7edc\u5305\u62ec\u6545\u969c\u6062\u590d\u7b56\u7565\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528istio\u7684\u6545\u969c\u6ce8\u5165\u673a\u5236\u6765\u961f\u6574\u4e2a\u5e94\u7528\u7cfb\u7edf\u6d4b\u8bd5\u6545\u969c\u6062\u590d\u80fd\u529b\u3002\u6545\u969c\u6ce8\u5165\u662f\u5c06\u4e00\u79cd\u9519\u8bef\u5f15\u5165\u7cfb\u7edf\u4ee5\u786e\u4fdd\u7cfb\u7edf\u80fd\u591f\u627f\u8f7d\u5e76\u4ece\u9519\u8bef\u6761\u4ef6\u4e2d\u6062\u590d\u7684\u6d4b\u8bd5\u65b9\u6cd5\uff0c\u4f7f\u7528\u6545\u969c\u6ce8\u5165\u7279\u522b\u6709\u7528\uff0c\u80fd\u786e\u4fdd\u6545\u969c\u6062\u590d\u7b56\u7565\u4e0d\u81f3\u4e8e\u4e0d\u517c\u5bb9\u6216\u592a\u4e25\u683c\u5bfc\u81f4\u670d\u52a1\u4e0d\u53ef\u7528\u3002</p> <p>\u6545\u969c\u6ce8\u5165\u5206\u4e3a\u4e24\u7c7b\uff1a</p> <p>\u5ef6\u8fdf\uff1a\u5ef6\u8fdf\u662f\u65f6\u95f4\u6545\u969c\uff0c\u5b83\u4eec\u6a21\u62df\u589e\u52a0\u7684\u7f51\u7edc\u5ef6\u8fdf\u6216\u4e00\u4e2a\u8d85\u8f7d\u7684\u4e0a\u6e38\u670d\u52a1\u3002</p> <p>\u7ec8\u6b62\uff1a\u7ec8\u6b62\u662f\u5954\u6e83\u5931\u8d25\uff0c\u5b83\u4eec\u6a21\u62df\u4e0a\u6e38\u670d\u52a1\u5931\u8d25\uff0c\u7ec8\u6b62\u901a\u5e38\u4ee5HTTP\u9519\u8bef\u7801\u6216TCP\u8fde\u63a5\u5931\u8d25\u5f62\u5f0f\u51fa\u73b0\u3002</p> <pre><code># \u6545\u969c\u6ce8\u5165\u4e4b\u5ef6\u8fdf\nspec:\n  hosts:\n  - ratings\n  http:\n  - match:\n    - headers:\n        end-user:\n          exact: jason\n    fault:\n      delay:\n        percentage:\n          value: 100.0\n        fixedDelay: 7s\n    route:\n    - destination:\n        host: ratings\n        subset: v1    \n\n# \u6545\u969c\u6ce8\u5165\u4e4b\u4e22\u5f03\nspec:\n  hosts:\n  - ratings\n  http:\n  - match:\n    - headers:\n        end-user:\n          exact: jason\n    fault:\n      abort:\n        percentage:\n          value: 100.0\n        httpStatus: 500\n    route:\n    - destination:\n        host: ratings\n        subset: v1 \n\n\n# \u57fa\u4e8e\u767e\u5206\u6bd4\u7684\u6d41\u91cf\u5206\u53d1\uff0c\u5e38\u7528\u4e8e\u91d1\u4e1d\u96c0\u53d1\u5e03\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v1\n      weight: 75\n    - destination:\n        host: reviews\n        subset: v2\n      weight: 25\n</code></pre> <ul> <li>\u6d41\u91cf\u955c\u50cf</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8be5\u914d\u7f6e\u6307\u5b9a\u4e86\u955c\u50cf\u6d41\u91cf\u9700\u8981\u53d1\u9001\u7684\u76ee\u6807\u670d\u52a1\u5730\u5740\u4e3a<code>serviceB</code>\u3002<code>mirror.subset</code>\u914d\u7f6e\u9879\u914d\u7f6e\u4e00\u4e2a<code>Service B</code>\u670d\u52a1\u7684\u670d\u52a1\u5b50\u96c6\u540d\u79f0 \uff0c\u6307\u5b9a\u4e86\u8981\u5c06\u955c\u50cf\u6d41\u91cf\u955c\u50cf\u5230<code>v2</code>\u7248\u672c\u7684<code>Service B</code>\u670d\u52a1\u5b50\u96c6\u4e2d\u53bb\u3002<code>mirror_percent</code>\u914d\u7f6e\u5c06<code>100%</code>\u7684\u771f\u5b9e\u6d41\u91cf\u8fdb\u884c\u955c\u50cf\u53d1\u9001\u3002\u6240\u4ee5\u4e0b\u9762\u7684\u914d\u7f6e\u6574\u4f53\u8868\u793a\u5f53\u6d41\u91cf\u5230\u6765\u65f6\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230<code>v1</code>\u7248\u672c\u7684<code>service B</code>\u670d\u52a1\u5b50\u96c6\u4e2d\uff0c\u518d\u4ee5\u955c\u50cf\u7684\u65b9\u5f0f\u53d1\u9001\u5230<code>v2</code>\u7248\u672c\u7684<code>service B</code>\u670d\u52a1\u4e0a\u4e00\u4efd\uff0c\u5e76\u5c06\u771f\u5b9e\u6d41\u91cf\u5168\u90e8\u955c\u50cf\u3002</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: serviceB\nspec:\n  hosts:\n  - istio.gateway.xxxx.tech\n  gateways:\n  - ingressgateway.istio-system.svc.cluster.local\n  http:\n  - match:\n    - uri:\n        prefix: /serviceB\n    rewrite:\n      uri: /\n    route:\n    - destination:\n        host: serviceB\n        subset: v1\n    mirror:\n      host: serviceB\n      subset: v2\n    mirror_percent: 100\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#destinationrule","title":"\u4e09 DestinationRule","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#31","title":"3.1 \u7b80\u4ecb","text":""},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#32","title":"3.2 \u914d\u7f6e\u8be6\u89e3","text":"<p>\u865a\u62df\u670d\u52a1\u4e3a\u5c06\u6d41\u91cf\u5982\u4f55\u8def\u7531\u5230\u7ed9\u5b9a\u76ee\u6807\u5730\u5740\uff0c\u7136\u540e\u6839\u636e\u76ee\u6807\u89c4\u5219\u6765\u5bf9\u6d41\u91cf\u8fdb\u884c\u914d\u7f6e\uff0c\u53ef\u4ee5\u4f7f\u7528\u76ee\u6807\u89c4\u5219\u6765\u6307\u5b9a\u547d\u540d\u7684\u670d\u52a1\u5b50\u96c6\uff0c\u4f8b\u5982\u6309\u7167\u7248\u672c\u4e3a\u6240\u7ed9\u5b9a\u7684\u670d\u52a1\u5b9e\u4f8b\u8fdb\u884c\u5206\u7ec4\uff0c\u7136\u540e\u53ef\u4ee5\u5728\u865a\u62df\u670d\u52a1\u7684\u8def\u7531\u89c4\u5219\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u670d\u52a1\u5b50\u96c6\u6765\u63a7\u5236\u670d\u52a1\u4e0d\u540c\u5b9e\u4f8b\u7684\u6d41\u91cf\uff0c\u4f8b\u5982\u9009\u62e9\u8d1f\u8f7d\u5747\u8861\u6a21\u578b\uff0cTLS\u5b89\u5168\u6a21\u5f0f\u6d3b\u7194\u65ad\u8bbe\u7f6e\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5istio\u4f7f\u7528\u8f6e\u8bad\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff0c</p> <ul> <li>\u968f\u673a\uff1a\u8bf7\u6c42\u4ee5\u968f\u673a\u65b9\u5f0f\u8f6c\u53d1\u5230\u540e\u7aef\u4e00\u7ec4\u5b9e\u4f8b\u3002</li> <li>\u6743\u91cd\uff1a\u8bf7\u6c42\u6839\u636e\u6307\u5b9a\u767e\u5206\u6bd4\u8f6c\u5230\u5b9e\u4f8b\u3002</li> <li>\u6700\u5c11\u8bf7\u6c42\uff1b\u8bf7\u6c42\u88ab\u8f6c\u5230\u6700\u5c11\u88ab\u8bbf\u95ee\u7684\u5b9e\u4f8b\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#33","title":"3.3 \u793a\u4f8b","text":"<p>dr\u662f\u4f5c\u7528\u5728\u4e00\u4e2asvc\uff0c\u4e00\u4e2aendpoints\u540e\uff0c\u6839\u636elabel\u7684app/version\u6807\u7b7e\u5c06\u4e00\u4e2asvc\u540e\u7684\u591a\u4e2adeploy\u4e5f\u5c31\u662fpod\u8fdb\u884c\u5206\u7ec4\u4e3asubset\uff0c\u7136\u540e\u53ef\u4ee5\u8bbe\u7f6e\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff0cTLS\u5b89\u5168\u548c\u65ad\u8def\u5668\u7b49\u3002\u5176\u4e2dhost\u5b57\u6bb5\u4e3a k8s\u7684svc\u3002</p> <p></p> <p>https://istio.io/zh/docs/reference/config/networking/destination-rule/</p> <ul> <li>\u8d1f\u8f7d\u5747\u8861</li> </ul> <p>\u5176\u4e2d\u5bf9\u4e8esubsets\u4e0a\u7684v1\u548cv3\u5b50\u96c6\u4e3a\u968f\u673a\uff0cv2\u4f4d\u8f6e\u8be2</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: my-destination-rule\nspec:\n  host: my-svc\n  trafficPolicy:\n    loadBalancer:\n      simple: RANDOM\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n  - name: v2\n    labels:\n      version: v2\n    trafficPolicy:\n      loadBalancer:\n        simple: ROUND_ROBIN\n  - name: v3\n    labels:\n      version: v3\n</code></pre> <ul> <li>\u65ad\u8def\u5668</li> </ul> <p>\u9650\u5236\u5e76\u53d1\u6570\u4f4d100</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: reviews\nspec:\n  host: reviews\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n    trafficPolicy:\n      connectionPool:\n        tcp:\n          maxConnections: 100\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#serviceentry","title":"\u56db ServiceEntry","text":"<p>\u5c06\u8c03\u7528\u5916\u90e8\u5f97\u4e00\u4e2a\u670d\u52a1\uff0c\u6ce8\u518c\u518d\u6539istio\u670d\u52a1\u7f51\u683c\u5185\uff0c\u53ef\u4ee5\u7528istio\u5f97\u670d\u52a1\u6cbb\u7406\uff0c\u4f8b\u5982\u91cd\u8bd5\uff0c\u8d85\u65f6\uff0c\u6545\u969c\u6ce8\u5165\uff0c</p> <p>apiVersion: networking.istio.io/v1alpha3 kind: ServiceEntry metadata:   name: svc-entry spec:   hosts:   - ext-svc.example.com   ports:   - number: 443     name: https     protocol: HTTPS   location: MESH_EXTERNAL   resolution: DNS </p>"},{"location":"cloud-native/servicemesh/istio/Istio%20%E8%AF%A6%E8%A7%A3/#_1","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>deployment\u9700\u8981\u7528app/version\u4e24\u4e2a\u6807\u7b7e\u6765\u8868\u8bc6</li> <li>\u670d\u52a1\u95f4\u8c03\u7528\u4f7f\u7528k8s\u539f\u751fsvc</li> <li>istio\u63a7\u5236\u7ba1\u7406\u7684\u5bf9\u8c61\u4e3asvc\uff0c\u6ca1\u6709svc\u7684deployment\u662f\u65e0\u6cd5\u88abistio\u53d1\u73b0\u5e76\u64cd\u4f5c\u7684</li> <li>\u4e00\u4e2agateway\u5173\u8054\u591a\u4e2asvc\uff0c\u4e00\u4e2asvc\u5173\u8054\u4e00\u4e2aendpoints\uff0c\u4e00\u4e2aendpoints\u6709\u591a\u4e2adeploy\uff0c\u4e5f\u5c31\u662f\u591a\u4e2apods</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E4%B9%8BXDS%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90/","title":"Istio\u4e4bXDS\u534f\u8bae\u89e3\u6790","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E4%B9%8BXDS%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90/#xds","title":"\u4e00 xDS\u662f\u4ec0\u4e48","text":"<p>xds\u662f\u4e00\u7c7b\u53d1\u73b0\u670d\u52a1\u7684\u603b\u79f0\uff0c\u5305\u542bLDS\uff0cRDS\uff0cCDS\uff0cEDS\u4ee5\u53caSDS\uff0cEnvoy\u901a\u8fc7xDS API\u53ef\u4ee5\u52a8\u6001\u83b7\u53d6Listen\uff08\u76d1\u542c\u5668\uff09\uff0cRoute\uff08\u8def\u7531\uff09\uff0cCluster\uff08\u96c6\u7fa4\uff09\uff0cEndpoint\uff08\u96c6\u7fa4\u6210\u5458\uff09\u4ee5\u53caSecret\uff08\u5bc6\u94a5\uff09\u914d\u7f6e\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E4%B9%8BXDS%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90/#lds","title":"\u4e8c LDS","text":"<p>Listener\u53d1\u73b0\u670d\u52a1\uff0cListener\u76d1\u542c\u5668\u63a7\u5236Envoy\u542f\u52a8\u7aef\u53e3\u76d1\u542c\uff08\u76ee\u524d\u53ea\u652f\u6301TCP\u534f\u8bae\uff09\uff0c\u5e76\u914d\u7f6eL3/L4\u5c42\u8fc7\u6ee4\u5668\uff0c\u5f53\u7f51\u7edc\u94fe\u63a5\u5230\u8fbe\u540e\uff0c\u914d\u7f6e\u597d\u7684\u7f51\u7edc\u8fc7\u6ee4\u5668\u5806\u6808\u5f00\u59cb\u5904\u7406\u540e\u7eed\u4e8b\u4ef6\uff0c    \u901a\u8fc7\u901a\u8fc7\u7684\u76d1\u542c\u5668\u4f53\u7cfb\u7ed3\u6784\u7528\u4e8e\u6267\u884c\u5927\u591a\u6570\u4e0d\u540c\u7684\u4ee3\u7406\u4efb\u52a1\uff08\u9650\u6d41\uff0c\u5ba2\u6237\u7aef\u8ba4\u8bc1\uff0chttp\u94fe\u63a5\u7ba1\u7406\uff0ctcp\u4ee3\u7406\u7b49\uff09    </p>"},{"location":"cloud-native/servicemesh/istio/Istio%E4%B9%8BXDS%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90/#rds","title":"\u4e09 RDS","text":"<p>route discovery service\uff0c\u7528\u4e8ehttp\u94fe\u63a5\u7ba1\u7406\u8fc7\u6ee4\u5668\u52a8\u6001\u83b7\u53d6\u8def\u7531\u914d\u7f6e\uff0c\u8def\u7531\u914d\u7f6e\u4fdd\u62a4http\u5934\u90e8\u4fee\u6539\uff08\u589e\u52a0\uff0c\u5220\u9664http\u5934\u90e8\u728d\u503c\uff09\uff0cvirtual host\uff08\u865a\u62df\u4e3b\u673a\uff09\uff0c\u4ee5\u53cavirtual host\u5b9a\u4e49\u7684\u8def\u7531\u6761\u76ee\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E4%B9%8BXDS%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90/#cds","title":"\u56db CDS","text":"<p>Cluster\u53d1\u73b0\u670d\u52a1,\u7528\u4e8e\u52a8\u6001\u83b7\u53d6Cluster\u4fe1\u606f\u3002Envoy cluster\u7ba1\u7406\u5668\u7ba1\u7406\u7740\u6240\u6709\u7684\u4e0a\u6e38cluster\u3002\u9274\u4e8e\u4e0a\u6e38cluster\u6216\u8005\u4e3b\u673a\u53ef\u7528\u4e8e\u4efb\u4f55\u4ee3\u7406\u8f6c\u53d1\u4efb\u52a1, \u6240\u4ee5\u4e0a\u6e38cluster-\u822c\u4eceListener\u6216Route\u4e2d\u62bd\u8c61\u51fa\u6765\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E4%B9%8BXDS%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90/#eds","title":"\u4e94 EDS","text":"<p>Endpoint\u53d1\u73b0\u670d\u52a1\u3002\u5728Envoy\u672f\u8bed\u4e2d, Cluster\u6210\u5458\u5c31\u53ebEndpoint ,\u5bf9\u4e8e\u6bcf\u4e2aCluster , Envoy\u901a\u8fc7EDS API\u52a8\u6001\u83b7\u53d6Endpoint\u3002EDS\u4f5c\u4e3a\u9996\u9009\u7684\u670d\u52a1\u53d1\u73b0\u7684\u539f\u56e0\u6709\u4e24\u70b9:</p> <ul> <li> <p>\u4e0e\u901a\u8fc7DNS\u89e3\u6790\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u8fdb\u884c\u8def\u7531\u76f8\u6bd4, Envoy\u80fd\u660e\u786e\u7684\u77e5\u9053\u6bcf\u4e2a\u4e0a\u6e38\u4e3b\u673a\u7684\u4fe1\u606f,\u56e0\u800c\u53ef\u4ee5\u505a\u51fa\u66f4\u52a0\u667a\u80fd\u7684\u8d1f\u8f7d\u5747\u8861\u51b3\u7b56\u3002</p> </li> <li> <p>Endpoint\u914d\u7f6e\u5305\u542b\u8d1f\u8f7d\u5747\u8861\u6743\u91cd\u3001\u53ef\u7528\u57df\u7b49\u9644\u52a0\u4e3b\u673a\u5c5e\u6027,\u8fd9\u4e9b\u5c5e\u6027\u53ef\u7528\u4e8e\u670d\u52a1\u7f51\u683c\u8d1f\u8f7d\u5747\u8861,\u7edf\u8ba1\u6536\u96c6\u7b49\u8fc7\u7a0b\u4e2d\u3002</p> </li> </ul> <p>\u4e94 EDS</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/","title":"Istio\u57fa\u7840\u4e4b\u670d\u52a1\u7f51\u7edc","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#istio","title":"Istio\u57fa\u7840\u4e4b\u670d\u52a1\u7f51\u683c\u5386\u53f2","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#_1","title":"\u4e00 \u670d\u52a1\u7f51\u683c\u5386\u53f2","text":"<p>\u8981\u8ba8\u8bba\u670d\u52a1\u7f51\u683c\uff08 Service Mesh \uff09\uff0c\u5c31\u5fc5\u987b\u63d0\u5230\u5fae\u670d\u52a1\u3002\u5fae\u670d\u52a1\uff08 Microservices )\u81ea2012\u5e74\u88ab\u63d0\u51fa\u4ee5\u6765\uff0c\u5c31\u7ee7\u627f\u4e86\u4f20\u7edfSOA \u67b6\u6784\u7684\u57fa\u7840\uff0c \u5e76\u5728\u7406\u8bba\u548c\u5de5\u7a0b\u5b9e\u8df5\u4e2d\u5f62 \u6210\u65b0\u7684\u6807\u51c6\uff0c\u70ed\u5ea6\u4e0d\u65ad\u6500\u5347\uff0c \u751a\u81f3\u6709\u6210\u4e3a\u9ed8\u8ba4\u8f6f\u4ef6\u67b6\u6784\u7684\u8d8b\u52bf\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#1","title":"1. \u5fae\u670d\u52a1\u5e94\u8be5\u5177\u5907\u7684\u7279\u70b9\uff1a","text":"<ul> <li>\u5728\u7ed3\u6784\u4e0a\uff0c\u5c06\u539f\u6709\u7684\u4ece\u6280\u672f\u89d2\u5ea6\u62c6\u5206\u7684\u7ec4\u4ef6\uff0c\u5347\u7ea7\u4e3a\u4ece\u4e1a\u52a1\u89d2\u5ea6\u62c6\u5206\u7684\u72ec\u7acb\u8fd0\u884c\u7684\u670d\u52a1\uff0c\u8fd9\u4e9b\u670d\u52a1\u5177\u5907\u5404\u81ea\u7684\u5b9e\u73b0\u5e73\u53f0\uff0c\u5e76\u4e14\u72ec\u5360\u81ea\u6709\u6570\u636e\uff0c\u5728\u670d\u52a1\u4e4b\u95f4\u4ee5\u667a\u80fd\u7aef\u70b9\u548c\u54d1\u7ba1\u9053\u7684\u65b9\u5f0f\u901a\u4fe1\u3002</li> <li>\u5728\u5de5\u7a0b\u4e0a\uff0c\u4ece\u4ea7\u54c1\u800c\u975e\u9879\u76ee\u7684\u89d2\u5ea6\u8fdb\u884c\u8bbe\u8ba1\uff0c\u5f3a\u8c03\u8fed\u4ee3\u3001\u81ea\u52a8\u5316\u548c\u9762\u5411\u6545\u969c\u7684\u8bbe\u8ba1\u65b9\u6cd5\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#2","title":"2. \u5fae\u670d\u52a1\u7684\u597d\u5904\u4e0e\u574f\u5904","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#21","title":"2.1 \u597d\u5904","text":"<ul> <li>\u63d0\u9ad8\u5e94\u7528\u7684\u4f38\u7f29\u6027</li> <li>\u65b9\u4fbf\u90e8\u95e8\u6216\u4e1a\u52a1\u4e4b\u95f4\u7684\u534f\u4f5c</li> <li>\u63d0\u9ad8\u81ea\u52a8\u5316\u7a0b\u5ea6\uff0c\u51cf\u5c11\u589e\u8017</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#22","title":"2.2 \u574f\u5904","text":"<ul> <li>\u5b9e\u4f8b\u6570\u91cf\u6025\u5267\u589e\u957f\uff0c\u5bf9\u90e8\u7f72\u548c\u8fd0\u7ef4\u81ea\u52a8\u5316\u8981\u6c42\u66f4\u9ad8</li> <li>\u4f7f\u7528\u7f51\u7edc\u8c03\u7528API\uff0c\u56e0\u6b64\u5bf9\u7f51\u7edc\u4f9d\u8d56\u66f4\u5f3a</li> <li>\u8c03\u7528\u94fe\u8def\u53d8\u957f\uff0c\u5206\u5e03\u5f0f\u8ddf\u8e2a\u6210\u4e3a\u5fc5\u9009\uff08\u5f53\u7136\u4f60\u4e0d\u9009\uff0c\u8c01\u4e5f\u6ca1\u6709\u529e\u6cd5\uff09</li> <li>\u65e5\u5fd7\u5206\u6563\uff0c\u8ddf\u8e2a\u548c\u5206\u6790\u96be\u5ea6\u52a0\u5927</li> <li>\u670d\u52a1\u5206\u6563\uff0c\u6613\u53d7\u653b\u51fb</li> <li>\u81ea\u52a8\u4f38\u7f29\u3001\u8def\u7531\u7ba1\u7406\u3001\u6545\u969c\u63a7\u5236\u3001\u5b58\u50a8\u5171\u4eab\u7b49\u3002</li> </ul> <p>[info]\u56e0\u6b64\u51fa\u73b0\u4e86kubernetes\u89e3\u51b3\u5fae\u670d\u52a1\u67b6\u6784\u4ea7\u751f\u7684\u4e00\u4e9b\u95ee\u9898\u3002\u5728\u8fdb\u7a0b\u7ea7\u522b\u4e3a\u5fae\u670d\u52a1\u63d0\u4f9b\u4e86\u90e8\u7f72\u3001\u8c03\u5ea6\u3001\u4f38\u7f29\u3001\u76d1\u63a7\u3001\u65e5\u5fd7\u7b49\u529f\u80fd \u3002\u4f46\u662f\u901a\u4fe1\u548c\u8054\u7cfb\u66f4\u52a0\u590d\u6742\u4e86\uff0c\u5176\u4e2d\u7684\u89c2\u6d4b\u548c\u670d\u52a1\u8d28\u91cf\u4fdd\u969c\u6210\u4e3a\u5fae\u670d\u52a1\u65b9\u6848\u7684\u77ed\u677f\uff0c\u56e0\u6b64service mesh\u767b\u573a\u4e86\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#3-serivcemesh","title":"3. SerivceMesh\u76f8\u5173\u53d1\u5c55\u5386\u7a0b","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#31-spring-cloud","title":"3.1 Spring Cloud","text":"<p>2015\u5e74\uff0cSpring Cloud\u8bde\u751f\u3002\u5b83\u5b9a\u4e49\u4e86\u4e00\u7cfb\u5217\u7684\u6807\u51c6\u7279\u6027\uff0c\u5982\u667a\u80fd\u8def\u7531\u3001\u7194\u65ad\u673a\u5236\u3001\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\u7b49\u3002\u5e76\u63d0\u4f9b\u4e86\u5bf9\u5e94\u7684\u5e93\u548c\u7ec4\u4ef6\u6765\u5b9e\u73b0\u8fd9\u4e9b\u6807\u51c6\u7279\u6027\u3002</p> <p>\u4f46Spring Cloud\u7f3a\u70b9\u4e5f\u6709\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <ul> <li>\u7528\u6237\u9700\u8981\u5b66\u4e60\u548c\u719f\u6089\u5404\u7ec4\u4ef6\u7684\u201c\u8bed\u8a00\u201d\u5e76\u5206\u522b\u8fd0\u7ef4\uff0c\u589e\u52a0\u4e86\u5e94\u7528\u95e8\u69db\u3002</li> <li>\u9700\u8981\u5728\u4ee3\u7801\u7ed9\u522b\u5bf9\u7ec4\u4ef6\u8fdb\u884c\u63a7\u5236\uff0c\u4e0d\u80fd\u591f\u591a\u8bed\u8a00\u534f\u4f5c\u3002</li> <li>\u81ea\u8eab\u6ca1\u6709\u5bf9\u8c03\u5ea6\u3001\u8d44\u6e90\u3001Devops\u7684\u76f8\u5173\u652f\u6301\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#32-linkerd","title":"3.2 Linkerd","text":"<p>2016\u5e74\u5e74\u521d\uff0c\u7531\u4e24\u4f4dTwitter\u5de5\u7a0b\u5e08\u5f00\u53d1\u4e86Linkerd\u9879\u76ee\uff0c\u5e76\u6253\u51fa\u4e86\u201cThe services must mesh\u201d\u7684\u53e3\u53f7\uff0c\u6210\u4e3a\u4e86Service Mesh\u7684\u7b2c\u4e00\u6279\u5e03\u9053\u8005\u3002</p> <p>Linkerd \u5f88\u597d\u5730\u7ed3\u5408\u4e86Kubernetes \u6240\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u4ee5\u6b64\u4e3a\u57fa\u7840\uff0c\u5728\u6bcf\u4e2aKubernetes Node \u4e0a\u90fd\u90e8\u7f72\u8fd0\u884c\u4e00\u4e2aL ink erd \u5b9e\u4f8b\uff0c\u7528\u4ee3\u7406\u7684\u65b9\u5f0f\u5c06\u52a0\u5165Mes h \u7684Pod \u901a\u4fe1\u8f6c\u63a5 \u7ed9Linkerd \uff0c\u8fd9\u6837Linkerd \u5c31\u80fd\u5728\u901a\u4fe1\u94fe\u8def\u4e2d\u5b8c\u6210\u5bf9\u901a\u4fe1\u7684\u63a7\u5236\u548c\u76d1\u63a7\u3002</p> <p></p> <p>Linkerd\u76f8\u6bd4\u5148\u524d\u8bf4\u7684Spring Cloud\u5b8c\u6210\u4e86\u4ee5\u4e0b\uff1a</p> <ul> <li>\u65e0\u987b\u4fb5\u5165\u5de5\u4f5c\u8d1f\u8f7d\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u8fdb\u884c\u901a\u4fe1\u76d1\u89c6\u548c\u7ba1\u7406\u3002</li> <li>\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u7528\u4e8e\u7ba1\u7406\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\u548c\u8fb9\u7f18\u901a\u4fe1\u3002</li> <li>\u5bf9kubernetes\u7684\u652f\u6301\uff0c\u5f53\u7136\u8fd8\u652f\u6301\u5176\u5b83\u5e95\u5c42\u5e73\u53f0\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#33-istio","title":"3.3 Istio","text":"<p>2017\u5e745\u6708\uff0cGoolge\u3001IBM\u3001Lyft\u5ba3\u5e03\u4e86Istio\u7684\u8bde\u751f\u3002Istio \u4ee5Envoy \u4e3a\u6570\u636e\u5e73\u9762\uff0c\u901a\u8fc7S idecar \u7684\u65b9\u5f0f\u8ba9Envoy \u540c\u4e1a\u52a1\u5bb9\u5668\u4e00\u8d77\u8fd0\u884c\uff0c\u5e76\u52ab\u6301\u5176\u901a\u4fe1\uff0c \u63a5\u53d7\u63a7\u5236\u5e73\u9762\u7684\u7edf\u4e00\u7ba1\u7406\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\u4e3a\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\u63d0\u4f9b\u4e30\u5bcc\u7684\u8fde\u63a5\u3001\u63a7\u5236\u3001\u89c2\u5bdf\u3001\u5b89\u5168\u7b49\u7279\u6027\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#_2","title":"\u4e8c \u670d\u52a1\u7f51\u683c\u5386\u53f2","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/#1_1","title":"1. \u670d\u52a1\u7f51\u683c\u5b9a\u4e49","text":"<p>\u670d\u52a1\u7f51\u683c\u662f\u4e00\u4e2a\u4e13\u6ce8\u4e8e\u5904\u7406\u670d\u52a1\u95f4\u901a\u4fe1\u7684\u57fa\u7840\u8bbe\u65bd\u5c42\uff0c\u5b83\u8d1f\u8d23\u5728\u73b0\u4ee3\u4e91\u539f\u751f\u5e94\u7528\u7ec4\u6210\u7684\u590d\u6742\u670d\u52a1\u62d3\u6251\u4e2d\u53ef\u9760\u5730\u4f20\u9012\u8bf7\u6c42\u3002</p> <p></p> <ol> <li> <p>\u670d\u52a1\u7f51\u683c\u7279\u70b9\u5982\u4e0b\uff1a</p> </li> <li> <p>\u8f7b\u91cf\u7ea7\u7684\u7f51\u7edc\u4ee3\u7406</p> </li> <li>\u5e94\u7528\u65e0\u611f\u77e5</li> <li>\u5e94\u7528\u4e4b\u95f4\u7684\u6d41\u91cf\u7531\u670d\u52a1\u7f51\u683c\u63a5\u7ba1</li> <li>\u670d\u52a1\u95f4\u7684\u8c03\u7528\u53ef\u80fd\u51fa\u73b0\u7684\u8d85\u65f6\u3001\u91cd\u8bd5\u3001\u76d1\u63a7\u3001\u8ffd\u8e2a\u7b49\u5de5\u4f5c\u4e0b\u6c89\u5230\u670d\u52a1\u7f51\u683c\u5c42\u5904\u7406\u3002</li> </ol> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u6df1\u8272\u4ee3\u8868\u5e94\u7528\uff0c\u6e05\u7070\u8272\u4ee3\u8868\u7f51\u683c\u4e2d\u8f7b\u91cf\u7ea7\u7684\u7f51\u7edc\u4ee3\u7406\u3002\u4ee3\u7406\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\uff0c\u800c\u5e94\u7528\u4e4b\u95f4\u7684\u901a\u4fe1\u5b8c\u5168\u7531\u4ee3\u7406\u6765\u8fdb\u884c\u3002\u5982\u679c\u53ea\u770b\u4ee3\u7406\u90e8\u5206\uff0c\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u7f51\u72b6\u7ed3\u6784\uff0c\u670d\u52a1\u7f51\u683c\u7531\u6b64\u5f97\u540d\u3002 \u7f51\u683c\u4e00\u822c\u7531\u6570\u636e\u5e73\u9762\u548c\u63a7\u5236\u5e73\u9762\u7ec4\u6210\uff0c\u6570\u636e\u5e73\u9762\u8d1f\u8d23\u5728\u670d\u52a1\u4e2d\u90e8\u7f72\u4e00\u4e2a\u79f0\u4e3a\u201c\u8fb9\u8f66\u201d\uff08sidecar\uff09\u7684\u8bf7\u6c42\u4ee3\u7406\uff0c\u63a7\u5236\u5e73\u9762\u8d1f\u8d23\u8bf7\u6c42\u4ee3\u7406\u4e4b\u95f4\u7684\u4ea4\u4e92\uff0c\u4ee5\u53ca\u7528\u6237\u4e0e\u8bf7\u6c42\u4ee3\u7406\u7684\u4ea4\u4e92\u3002</p> <p>2. \u670d\u52a1\u7f51\u683c\u4f18\u52bf</p> <p>\u968f\u7740\u670d\u52a1\u6570\u91cf\u589e\u957f\uff0c\u6bcf\u4e2a\u670d\u52a1\u90fd\u9700\u8981\u81ea\u5df1\u7ba1\u7406\u590d\u6742\u7684\u670d\u52a1\u95f4\u7684\u7f51\u7edc\u901a\u4fe1\uff0c\u4e5f\u8ba9\u5f00\u53d1\u4eba\u5458\u5934\u75bc\u3002\u4e5f\u53d8\u5f97\u8d8a\u6765\u96be\u4ee5\u7ba1\u7406\uff0c\u8fd9\u8981\u6c42\u670d\u52a1\u6cbb\u7406\u5305\u542b\u5f88\u591a\u529f\u80fd\u3002\u4f8b\u5982\uff1a\u670d\u52a1\u53d1\u73b0\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u6545\u969c\u8f6c\u79fb\u3001\u670d\u52a1\u5ea6\u91cf\u6307\u6807\u6536\u96c6\u548c\u76d1\u63a7\u7b49\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/","title":"Istio\u5fae\u670d\u52a1\u6cbb\u7406\u7b14\u8bb0(\u4e00)","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#_1","title":"\u4e00 \u80cc\u666f","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#11","title":"1.1 \u5fae\u670d\u52a1\u662f\u4ec0\u4e48","text":"<ul> <li>\u670d\u52a1\u4e4b\u95f4\u6709\u8f7b\u91cf\u7ea7\u7684\u901a\u8baf\u673a\u5236\uff0c\u901a\u5e38\u4e3aREST API</li> <li>\u53bb\u4e2d\u5fc3\u5316\u7684\u7ba1\u7406\u673a\u5236</li> <li>\u6bcf\u4e2a\u670d\u52a1\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u7f16\u7a0b\u8bed\u8a00\u5b9e\u73b0\uff0c\u4f7f\u7528\u4e0d\u540c\u7684\u6570\u636e\u5b58\u50a8\u6280\u672f</li> <li>\u5e94\u7528\u6309\u4e1a\u52a1\u62c6\u5206\u6210\u670d\u52a1\uff0c\u4e00\u4e2a\u5927\u578b\u5e94\u7528\u7cfb\u7edf\u53ef\u4ee5\u7531\u591a\u4e2a\u72ec\u7acb\u7684\u670d\u52a1\u7ec4\u6210</li> <li>\u5404\u4e2a\u670d\u52a1\u5747\u53ef\u72ec\u7acb\u90e8\u7f72\uff0c\u90fd\u6709\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91</li> <li>\u670d\u52a1\u53ef\u88ab\u591a\u4e2a\u5e94\u7528\u5171\u4eab\uff0c\u5176\u4ed6\u670d\u52a1\u53ef\u590d\u7528\u4e00\u4e9b\u516c\u5171\u7684\u8d44\u6e90\u670d\u52a1</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#12","title":"1.2 \u5fae\u670d\u52a1\u7684\u4f18\u52bf","text":"<ul> <li>\u6a21\u5757\u5316\u5f00\u53d1\uff0c\u4ee5\u5355\u54e5\u670d\u52a1\u4e3a\u7ec4\u4ef6\u8fdb\u884c\u66f4\u65b0\u5347\u7ea7\uff0c\u63d0\u5347\u7cfb\u7edf\u6574\u4f53\u5f02\u5e38\u7a33\u5b9a\u6027</li> <li>\u6a21\u5757\u5316\u5f00\u53d1\u7ba1\u7406\u65b9\u4fbf\uff0c\u5355\u72ec\u56e2\u961f\u5f00\u53d1\u7ef4\u62a4\uff0c\u804c\u8d23\u5206\u660e</li> <li>\u6a21\u5757\u670d\u7528\uff0c\u516c\u5171\u670d\u52a1\u6a21\u5757\u53ef\u88ab\u5176\u4ed6\u4e1a\u52a1\u6a21\u5757\u4f7f\u7528</li> <li>\u7cfb\u7edf\u67b6\u6784\u66f4\u52a0\u5206\u660e</li> <li>\u7ed3\u5408CI/CD\uff0c\u5b9e\u73b0DevOPS</li> <li> <p>\u5f39\u6027\u4f38\u7f29\uff0c\u7ed3\u5408\u670d\u52a1\u7f16\u6392K8S\u52a8\u6001HPA</p> </li> <li> <p>\u670d\u52a1\u7194\u65ad/\u964d\u7ea7\uff0c\u907f\u514d\u4f46\u8282\u70b9\u5f02\u5e38\u96ea\u5d29\u6548\u5e94\uff0c\u5206\u6563\u6545\u969c\u8282\u70b9</p> </li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#13","title":"1.3 \u5fae\u670d\u52a1\u5e26\u6765\u7684\u6311\u6218","text":"<ul> <li>\u670d\u52a1\u8d8a\u6765\u8d8a\u591a\uff0c\u914d\u7f6e\u7ba1\u7406\u7ef4\u62a4\u590d\u6742</li> <li>\u670d\u52a1\u95f4\u4f9d\u8d56\u5173\u7cfb\u590d\u6742</li> <li>\u670d\u52a1\u8c03\u7528\u94fe\u8ffd\u8e2a\u96be</li> <li>\u670d\u52a1\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5747\u8861</li> <li>\u670d\u52a1\u7684\u62d3\u5c55</li> <li>\u670d\u52a1\u76d1\u63a7/\u65e5\u5fd7</li> <li>\u670d\u52a1\u7194\u65ad/\u964d\u7ea7</li> <li>\u670d\u52a1\u9274\u6743</li> <li>\u670d\u52a1\u4e0a\u7ebf\u4e0e\u4e0b\u7ebf</li> <li>\u670d\u52a1\u6587\u6863</li> <li>...</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#14","title":"1.4 \u4ec0\u4e48\u662f\u5fae\u670d\u52a1\u6cbb\u7406","text":"<p>\u9488\u5bf9\u4ee5\u5fae\u670d\u52a1\u4e3a\u6211\u4eec\u5e26\u6765\u7684\u65b9\u4fbf\u4ee5\u53ca\u6311\u6218\uff0c\u4ece\u88f8\u91d1\u5c5e\u5230\u865a\u62df\u5316\u518d\u5230\u516c\u6709\u4e91\uff0c\u518d\u5230\u5bb9\u5668\uff0c\u5230serverless\uff0c\u6280\u672f\u4e0d\u65ad\u9769\u65b0\uff0c\u5e94\u5bf9\u5fae\u670d\u52a1\u5e26\u6765\u7684\u6311\u6218\uff0c\u5982\u4f55\u5bf9\u670d\u52a1\u8fdb\u884c\u6ce8\u518c\u53d1\u73b0\uff0c\u8bf7\u6c42\u94fe\u8def\u8ffd\u8e2a\uff0c\u8d1f\u8f7d\u5747\u8861\uff0c\u670d\u52a1\u7194\u65ad/\u964d\u7ea7\uff0c\u670d\u52a1\u9650\u6d41\uff0c\u8bbf\u95ee\u63a7\u5236\uff0c\u76d1\u63a7\u65e5\u5fd7\uff0c\u914d\u7f6e\u7ba1\u7406\uff0c\u91d1\u4e1d\u96c0\u53d1\u5e03\u5462\uff0c\u672c\u6587\u4e3a\u81ea\u5df1\u5b66\u4e60Istio\u7684\u7b14\u8bb0\uff0cistio\u89e3\u51b3\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u8fd8\u6709\u4e00\u4e9b\u6311\u6218\u9700\u8981\u5176\u4ed6\u5de5\u5177\u5e73\u53f0\u89e3\u51b3\uff0c\u672c\u6587\u540e\u7eed\u66f4\u65b0\u4e0d\u65ad\uff0c\u4e00\u5757\u6765\u5b66\u4e60Kubernetes\u4e2d\u670d\u52a1\u6cbb\u7406\u795e\u5668Istio\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#istio_1","title":"\u4e8c Istio\u4ecb\u7ecd","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#21-istio","title":"2.1 istio\u662f\u4ec0\u4e48","text":"<p>Istio \u5141\u8bb8\u60a8\u8fde\u63a5\u3001\u4fdd\u62a4\u3001\u63a7\u5236\u548c\u89c2\u6d4b\u5fae\u670d\u52a1\uff0c\u5728\u8f83\u9ad8\u7684\u5c42\u6b21\u4e0a\uff0cIstio \u6709\u52a9\u4e8e\u964d\u4f4e\u8fd9\u4e9b\u90e8\u7f72\u7684\u590d\u6742\u6027\uff0c\u5e76\u51cf\u8f7b\u5f00\u53d1\u56e2\u961f\u7684\u538b\u529b\u3002\u5b83\u662f\u4e00\u4e2a\u5b8c\u5168\u5f00\u6e90\u7684\u670d\u52a1\u7f51\u683c\uff0c\u53ef\u4ee5\u900f\u660e\u5730\u5206\u5c42\u5230\u73b0\u6709\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u4e0a\u3002\u5b83\u4e5f\u662f\u4e00\u4e2a\u5e73\u53f0\uff0c\u5305\u62ec\u5141\u8bb8\u5b83\u96c6\u6210\u5230\u4efb\u4f55\u65e5\u5fd7\u8bb0\u5f55\u5e73\u53f0\u3001\u9065\u6d4b\u6216\u7b56\u7565\u7cfb\u7edf\u7684 API\u3002Istio \u7684\u591a\u6837\u5316\u529f\u80fd\u96c6\u4f7f\u60a8\u80fd\u591f\u6210\u529f\u9ad8\u6548\u5730\u8fd0\u884c\u5206\u5e03\u5f0f\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u5e76\u63d0\u4f9b\u4fdd\u62a4\u3001\u8fde\u63a5\u548c\u76d1\u63a7\u5fae\u670d\u52a1\u7684\u7edf\u4e00\u65b9\u6cd5\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#12-service-mesh","title":"1.2 \u4ec0\u4e48\u662fservice mesh","text":"<p>\u5728\u4ece\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\u5411\u5206\u5e03\u5f0f\u5fae\u670d\u52a1\u67b6\u6784\u7684\u8f6c\u578b\u8fc7\u7a0b\u4e2d\uff0c\u5f00\u53d1\u4eba\u5458\u548c\u8fd0\u7ef4\u4eba\u5458\u9762\u4e34\u8bf8\u591a\u6311\u6218\uff0c\u4f7f\u7528 Istio \u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002</p> <p>\u670d\u52a1\u7f51\u683c\uff08Service Mesh\uff09\u8fd9\u4e2a\u672f\u8bed\u901a\u5e38\u7528\u4e8e\u63cf\u8ff0\u6784\u6210\u8fd9\u4e9b\u5e94\u7528\u7a0b\u5e8f\u7684\u5fae\u670d\u52a1\u7f51\u7edc\u4ee5\u53ca\u5e94\u7528\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002\u968f\u7740\u89c4\u6a21\u548c\u590d\u6742\u6027\u7684\u589e\u957f\uff0c\u670d\u52a1\u7f51\u683c\u8d8a\u6765\u8d8a\u96be\u4ee5\u7406\u89e3\u548c\u7ba1\u7406\u3002\u5b83\u7684\u9700\u6c42\u5305\u62ec\u670d\u52a1\u53d1\u73b0\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u6545\u969c\u6062\u590d\u3001\u6307\u6807\u6536\u96c6\u548c\u76d1\u63a7\u4ee5\u53ca\u901a\u5e38\u66f4\u52a0\u590d\u6742\u7684\u8fd0\u7ef4\u9700\u6c42\uff0c\u4f8b\u5982 A/B \u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u53d1\u5e03\u3001\u9650\u6d41\u3001\u8bbf\u95ee\u63a7\u5236\u548c\u7aef\u5230\u7aef\u8ba4\u8bc1\u7b49\u3002</p> <p>Istio \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u901a\u8fc7\u4e3a\u6574\u4e2a\u670d\u52a1\u7f51\u683c\u63d0\u4f9b\u884c\u4e3a\u6d1e\u5bdf\u548c\u64cd\u4f5c\u63a7\u5236\u6765\u6ee1\u8db3\u5fae\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u7684\u591a\u6837\u5316\u9700\u6c42\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#13-istio","title":"1.3 \u4e3a\u4ec0\u4e48\u4f7f\u7528istio","text":"<p>Istio \u63d0\u4f9b\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u6765\u4e3a\u5df2\u90e8\u7f72\u7684\u670d\u52a1\u5efa\u7acb\u7f51\u7edc\uff0c\u8be5\u7f51\u7edc\u5177\u6709\u8d1f\u8f7d\u5747\u8861\u3001\u670d\u52a1\u95f4\u8ba4\u8bc1\u3001\u76d1\u63a7\u7b49\u529f\u80fd\uff0c\u53ea\u9700\u8981\u5bf9\u670d\u52a1\u7684\u4ee3\u7801\u8fdb\u884c\u4e00\u70b9\u6216\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u6539\u52a8\u3002\u60f3\u8981\u8ba9\u670d\u52a1\u652f\u6301 Istio\uff0c\u53ea\u9700\u8981\u5728\u60a8\u7684\u73af\u5883\u4e2d\u90e8\u7f72\u4e00\u4e2a\u7279\u6b8a\u7684 sidecar \u4ee3\u7406\uff0c\u4f7f\u7528 Istio \u63a7\u5236\u5e73\u9762\u529f\u80fd\u914d\u7f6e\u548c\u7ba1\u7406\u4ee3\u7406\uff0c\u62e6\u622a\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u6240\u6709\u7f51\u7edc\u901a\u4fe1\uff1a</p> <ul> <li>HTTP\u3001gRPC\u3001WebSocket \u548c TCP \u6d41\u91cf\u7684\u81ea\u52a8\u8d1f\u8f7d\u5747\u8861\u3002</li> <li>\u901a\u8fc7\u4e30\u5bcc\u7684\u8def\u7531\u89c4\u5219\u3001\u91cd\u8bd5\u3001\u6545\u969c\u8f6c\u79fb\u548c\u6545\u969c\u6ce8\u5165\uff0c\u53ef\u4ee5\u5bf9\u6d41\u91cf\u884c\u4e3a\u8fdb\u884c\u7ec6\u7c92\u5ea6\u63a7\u5236\u3002</li> <li>\u53ef\u63d2\u5165\u7684\u7b56\u7565\u5c42\u548c\u914d\u7f6e API\uff0c\u652f\u6301\u8bbf\u95ee\u63a7\u5236\u3001\u901f\u7387\u9650\u5236\u548c\u914d\u989d\u3002</li> <li>\u5bf9\u51fa\u5165\u96c6\u7fa4\u5165\u53e3\u548c\u51fa\u53e3\u4e2d\u6240\u6709\u6d41\u91cf\u7684\u81ea\u52a8\u5ea6\u91cf\u6307\u6807\u3001\u65e5\u5fd7\u8bb0\u5f55\u548c\u8ffd\u8e2a\u3002</li> <li>\u901a\u8fc7\u5f3a\u5927\u7684\u57fa\u4e8e\u8eab\u4efd\u7684\u9a8c\u8bc1\u548c\u6388\u6743\uff0c\u5728\u96c6\u7fa4\u4e2d\u5b9e\u73b0\u5b89\u5168\u7684\u670d\u52a1\u95f4\u901a\u4fe1\u3002</li> </ul> <p>Istio \u65e8\u5728\u5b9e\u73b0\u53ef\u6269\u5c55\u6027\uff0c\u6ee1\u8db3\u5404\u79cd\u90e8\u7f72\u9700\u6c42\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#_2","title":"\u4e09 \u6838\u5fc3\u529f\u80fd","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#31","title":"3.1 \u6d41\u91cf\u7ba1\u7406","text":"<p>\u901a\u8fc7\u7b80\u5355\u7684\u89c4\u5219\u914d\u7f6e\u548c\u6d41\u91cf\u8def\u7531\uff0c\u60a8\u53ef\u4ee5\u63a7\u5236\u670d\u52a1\u4e4b\u95f4\u7684\u6d41\u91cf\u548c API \u8c03\u7528\u3002Istio \u7b80\u5316\u4e86\u65ad\u8def\u5668\u3001\u8d85\u65f6\u548c\u91cd\u8bd5\u7b49\u670d\u52a1\u7ea7\u522b\u5c5e\u6027\u7684\u914d\u7f6e\uff0c\u5e76\u4e14\u53ef\u4ee5\u8f7b\u677e\u8bbe\u7f6e A/B\u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u90e8\u7f72\u548c\u57fa\u4e8e\u767e\u5206\u6bd4\u7684\u6d41\u91cf\u5206\u5272\u7684\u5206\u9636\u6bb5\u90e8\u7f72\u7b49\u91cd\u8981\u4efb\u52a1\u3002</p> <p>\u901a\u8fc7\u66f4\u597d\u5730\u4e86\u89e3\u60a8\u7684\u6d41\u91cf\u548c\u5f00\u7bb1\u5373\u7528\u7684\u6545\u969c\u6062\u590d\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u5728\u95ee\u9898\u51fa\u73b0\u4e4b\u524d\u5148\u53d1\u73b0\u95ee\u9898\uff0c\u4f7f\u8c03\u7528\u66f4\u53ef\u9760\uff0c\u5e76\u4e14\u4f7f\u60a8\u7684\u7f51\u7edc\u66f4\u52a0\u5f3a\u5927\u2014\u2014\u65e0\u8bba\u60a8\u9762\u4e34\u4ec0\u4e48\u6761\u4ef6\u3002</p> <ul> <li>\u8d1f\u8f7d\u5747\u8861</li> <li>\u52a8\u6001\u8def\u7531</li> <li>\u7070\u5ea6\u53d1\u5e03</li> <li>\u6545\u969c\u6ce8\u5165</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#32","title":"3.2 \u5b89\u5168","text":"<p>Istio \u7684\u5b89\u5168\u529f\u80fd\u4f7f\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7ea7\u522b\u7684\u5b89\u5168\u6027\u3002Istio \u63d0\u4f9b\u5e95\u5c42\u5b89\u5168\u901a\u4fe1\u4fe1\u9053\uff0c\u5e76\u5927\u89c4\u6a21\u7ba1\u7406\u670d\u52a1\u901a\u4fe1\u7684\u8ba4\u8bc1\u3001\u6388\u6743\u548c\u52a0\u5bc6\u3002\u4f7f\u7528Istio\uff0c\u670d\u52a1\u901a\u4fe1\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u5b89\u5168\u7684\uff0c\u5b83\u5141\u8bb8\u60a8\u8de8\u591a\u79cd\u534f\u8bae\u548c\u8fd0\u884c\u65f6\u4e00\u81f4\u5730\u5b9e\u65bd\u7b56\u7565\u2014\u2014\u6240\u6709\u8fd9\u4e9b\u90fd\u5f88\u5c11\u6216\u6839\u672c\u4e0d\u9700\u8981\u5e94\u7528\u7a0b\u5e8f\u66f4\u6539\u3002</p> <p>\u867d\u7136 Istio \u4e0e\u5e73\u53f0\u65e0\u5173\uff0c\u4f46\u5c06\u5176\u4e0e Kubernetes\uff08\u6216\u57fa\u7840\u67b6\u6784\uff09\u7f51\u7edc\u7b56\u7565\u7ed3\u5408\u4f7f\u7528\uff0c\u5176\u4f18\u52bf\u4f1a\u66f4\u5927\uff0c\u5305\u62ec\u5728\u7f51\u7edc\u548c\u5e94\u7528\u5c42\u4fdd\u62a4 pod \u95f4\u6216\u670d\u52a1\u95f4\u901a\u4fe1\u7684\u80fd\u529b\u3002</p> <ul> <li>\u8ba4\u8bc1</li> <li>\u9274\u6743</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#33","title":"3.3 \u53ef\u89c2\u5bdf\u884c","text":"<p>Istio \u5f3a\u5927\u7684\u8ffd\u8e2a\u3001\u76d1\u63a7\u548c\u65e5\u5fd7\u8bb0\u5f55\u53ef\u8ba9\u60a8\u6df1\u5165\u4e86\u89e3\u670d\u52a1\u7f51\u683c\u90e8\u7f72\u3002\u901a\u8fc7 Istio \u7684\u76d1\u63a7\u529f\u80fd\uff0c\u53ef\u4ee5\u771f\u6b63\u4e86\u89e3\u670d\u52a1\u6027\u80fd\u5982\u4f55\u5f71\u54cd\u4e0a\u6e38\u548c\u4e0b\u6e38\u7684\u529f\u80fd\uff0c\u800c\u5176\u81ea\u5b9a\u4e49\u4eea\u8868\u677f\u53ef\u4ee5\u63d0\u4f9b\u5bf9\u6240\u6709\u670d\u52a1\u6027\u80fd\u7684\u53ef\u89c6\u6027\uff0c\u5e76\u8ba9\u60a8\u4e86\u89e3\u8be5\u6027\u80fd\u5982\u4f55\u5f71\u54cd\u60a8\u7684\u5176\u4ed6\u8fdb\u7a0b\u3002</p> <p>Istio \u7684 Mixer \u7ec4\u4ef6\u8d1f\u8d23\u7b56\u7565\u63a7\u5236\u548c\u9065\u6d4b\u6536\u96c6\u3002\u5b83\u63d0\u4f9b\u540e\u7aef\u62bd\u8c61\u548c\u4e2d\u4ecb\uff0c\u5c06 Istio \u7684\u5176\u4f59\u90e8\u5206\u4e0e\u5404\u4e2a\u57fa\u7840\u67b6\u6784\u540e\u7aef\u7684\u5b9e\u73b0\u7ec6\u8282\u9694\u79bb\u5f00\u6765\uff0c\u5e76\u4e3a\u8fd0\u7ef4\u63d0\u4f9b\u5bf9\u7f51\u683c\u548c\u57fa\u7840\u67b6\u6784\u540e\u7aef\u4e4b\u95f4\u6240\u6709\u4ea4\u4e92\u7684\u7ec6\u7c92\u5ea6\u63a7\u5236\u3002</p> <p>\u6240\u6709\u8fd9\u4e9b\u529f\u80fd\u53ef\u4ee5\u8ba9\u60a8\u53ef\u4ee5\u66f4\u6709\u6548\u5730\u8bbe\u7f6e\u3001\u76d1\u63a7\u548c\u5b9e\u65bd\u670d\u52a1\u4e0a\u7684 SLO\u3002\u5f53\u7136\uff0c\u6700\u91cd\u8981\u7684\u662f\uff0c\u60a8\u53ef\u4ee5\u5feb\u901f\u6709\u6548\u5730\u68c0\u6d4b\u548c\u4fee\u590d\u95ee\u9898\u3002</p> <ul> <li>\u8c03\u7528\u94fe</li> <li>\u8bbf\u95ee\u65e5\u5fd7</li> <li>\u76d1\u63a7</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#34","title":"3.4 \u5e73\u53f0\u652f\u6301","text":"<p>stio \u662f\u72ec\u7acb\u4e8e\u5e73\u53f0\u7684\uff0c\u65e8\u5728\u8fd0\u884c\u5728\u5404\u79cd\u73af\u5883\u4e2d\uff0c\u5305\u62ec\u8de8\u4e91\u3001\u5185\u90e8\u90e8\u7f72\u3001Kubernetes\u3001Mesos \u7b49\u3002\u60a8\u53ef\u4ee5\u5728 Kubernetes \u4e0a\u90e8\u7f72 Istio \u6216\u5177\u6709 Consul \u7684 Nomad \u4e0a\u90e8\u7f72\u3002Istio \u76ee\u524d\u652f\u6301\uff1a</p> <ul> <li>\u5728 Kubernetes \u4e0a\u90e8\u7f72\u7684\u670d\u52a1</li> <li>\u4f7f\u7528 Consul \u6ce8\u518c\u7684\u670d\u52a1</li> <li>\u5728\u865a\u62df\u673a\u4e0a\u90e8\u7f72\u7684\u670d\u52a1</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#35","title":"3.5 \u96c6\u6210\u548c\u5b9a\u5236","text":"<p>\u7b56\u7565\u6267\u884c\u7ec4\u4ef6\u53ef\u4ee5\u6269\u5c55\u548c\u5b9a\u5236\uff0c\u4ee5\u4fbf\u4e0e\u73b0\u6709\u7684 ACL\u3001\u65e5\u5fd7\u3001\u76d1\u63a7\u3001\u914d\u989d\u3001\u5ba1\u8ba1\u7b49\u65b9\u6848\u96c6\u6210\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#_3","title":"\u56db \u67b6\u6784","text":"<p>Istio \u670d\u52a1\u7f51\u683c\u903b\u8f91\u4e0a\u5206\u4e3a**\u6570\u636e\u5e73\u9762**\u548c**\u63a7\u5236\u5e73\u9762**\u3002</p> <ul> <li>**\u6570\u636e\u5e73\u9762**\u7531\u4e00\u7ec4\u4ee5 sidecar \u65b9\u5f0f\u90e8\u7f72\u7684\u667a\u80fd\u4ee3\u7406\uff08Envoy\uff09\u7ec4\u6210\u3002\u8fd9\u4e9b\u4ee3\u7406\u53ef\u4ee5\u8c03\u8282\u548c\u63a7\u5236\u5fae\u670d\u52a1\u53ca Mixer \u4e4b\u95f4\u6240\u6709\u7684\u7f51\u7edc\u901a\u4fe1\u3002</li> <li>**\u63a7\u5236\u5e73\u9762**\u8d1f\u8d23\u7ba1\u7406\u548c\u914d\u7f6e\u4ee3\u7406\u6765\u8def\u7531\u6d41\u91cf\u3002\u6b64\u5916\u63a7\u5236\u5e73\u9762\u914d\u7f6e Mixer \u4ee5\u5b9e\u65bd\u7b56\u7565\u548c\u6536\u96c6\u9065\u6d4b\u6570\u636e\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#41","title":"4.1 \u67b6\u6784\u56fe","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#42","title":"4.2 \u7ec4\u4ef6","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#421-envoy","title":"4.2.1 Envoy","text":"<p>Istio \u4f7f\u7528 Envoy \u4ee3\u7406\u7684\u6269\u5c55\u7248\u672c\uff0cEnvoy \u662f\u4ee5 C++ \u5f00\u53d1\u7684\u9ad8\u6027\u80fd\u4ee3\u7406\uff0c\u7528\u4e8e\u8c03\u89e3\u670d\u52a1\u7f51\u683c\u4e2d\u6240\u6709\u670d\u52a1\u7684\u6240\u6709\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u3002Envoy \u7684\u8bb8\u591a\u5185\u7f6e\u529f\u80fd\u88ab Istio \u53d1\u626c\u5149\u5927\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u52a8\u6001\u670d\u52a1\u53d1\u73b0</li> <li>\u8d1f\u8f7d\u5747\u8861</li> <li>TLS \u7ec8\u6b62</li> <li>HTTP/2 &amp; gRPC \u4ee3\u7406</li> <li>\u7194\u65ad\u5668</li> <li>\u5065\u5eb7\u68c0\u67e5\u3001\u57fa\u4e8e\u767e\u5206\u6bd4\u6d41\u91cf\u62c6\u5206\u7684\u7070\u5ea6\u53d1\u5e03</li> <li>\u6545\u969c\u6ce8\u5165</li> <li>\u4e30\u5bcc\u7684\u5ea6\u91cf\u6307\u6807</li> </ul> <p>Envoy \u88ab\u90e8\u7f72\u4e3a sidecar\uff0c\u548c\u5bf9\u5e94\u670d\u52a1\u5728\u540c\u4e00\u4e2a Kubernetes pod \u4e2d\u3002\u8fd9\u5141\u8bb8 Istio \u5c06\u5927\u91cf\u5173\u4e8e\u6d41\u91cf\u884c\u4e3a\u7684\u4fe1\u53f7\u4f5c\u4e3a\u5c5e\u6027\u63d0\u53d6\u51fa\u6765\uff0c\u800c\u8fd9\u4e9b\u5c5e\u6027\u53c8\u53ef\u4ee5\u5728 Mixer \u4e2d\u7528\u4e8e\u6267\u884c\u7b56\u7565\u51b3\u7b56\uff0c\u5e76\u53d1\u9001\u7ed9\u76d1\u63a7\u7cfb\u7edf\uff0c\u4ee5\u63d0\u4f9b\u6574\u4e2a\u7f51\u683c\u884c\u4e3a\u7684\u4fe1\u606f\u3002</p> <p>Sidecar \u4ee3\u7406\u6a21\u578b\u8fd8\u53ef\u4ee5\u5c06 Istio \u7684\u529f\u80fd\u6dfb\u52a0\u5230\u73b0\u6709\u90e8\u7f72\u4e2d\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u6784\u5efa\u6216\u91cd\u5199\u4ee3\u7801\u3002\u53ef\u4ee5\u9605\u8bfb\u66f4\u591a\u6765\u4e86\u89e3\u4e3a\u4ec0\u4e48\u6211\u4eec\u5728\u8bbe\u8ba1\u76ee\u6807\u4e2d\u9009\u62e9\u8fd9\u79cd\u65b9\u5f0f\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#422-mixer","title":"4.2.2 Mixer","text":"<ul> <li>\u6982\u5ff5</li> </ul> <p>Mixer \u662f\u4e00\u4e2a\u72ec\u7acb\u4e8e\u5e73\u53f0\u7684\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u5728\u670d\u52a1\u7f51\u683c\u4e0a\u6267\u884c\u8bbf\u95ee\u63a7\u5236\u548c\u4f7f\u7528\u7b56\u7565\uff0c\u5e76\u4ece Envoy \u4ee3\u7406\u548c\u5176\u4ed6\u670d\u52a1\u6536\u96c6\u9065\u6d4b\u6570\u636e\u3002\u4ee3\u7406\u63d0\u53d6\u8bf7\u6c42\u7ea7\u5c5e\u6027\uff0c\u53d1\u9001\u5230 Mixer \u8fdb\u884c\u8bc4\u4f30\u3002\u6709\u5173\u5c5e\u6027\u63d0\u53d6\u548c\u7b56\u7565\u8bc4\u4f30\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Mixer \u914d\u7f6e\u3002</p> <p>Mixer \u4e2d\u5305\u62ec\u4e00\u4e2a\u7075\u6d3b\u7684\u63d2\u4ef6\u6a21\u578b\uff0c\u4f7f\u5176\u80fd\u591f\u63a5\u5165\u5230\u5404\u79cd\u4e3b\u673a\u73af\u5883\u548c\u57fa\u7840\u8bbe\u65bd\u540e\u7aef\uff0c\u4ece\u8fd9\u4e9b\u7ec6\u8282\u4e2d\u62bd\u8c61\u51fa Envoy \u4ee3\u7406\u548c Istio \u7ba1\u7406\u7684\u670d\u52a1\u3002</p> <ul> <li>\u67b6\u6784\u56fe</li> </ul> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#423-pilot","title":"4.2.3 Pilot","text":"<ul> <li>\u6982\u5ff5</li> </ul> <p>Pilot \u4e3a Envoy sidecar \u63d0\u4f9b\u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff0c\u4e3a\u667a\u80fd\u8def\u7531\uff08\u4f8b\u5982 A/B \u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u90e8\u7f72\u7b49\uff09\u548c\u5f39\u6027\uff08\u8d85\u65f6\u3001\u91cd\u8bd5\u3001\u7194\u65ad\u5668\u7b49\uff09\u63d0\u4f9b\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u5b83\u5c06\u63a7\u5236\u6d41\u91cf\u884c\u4e3a\u7684\u9ad8\u7ea7\u8def\u7531\u89c4\u5219\u8f6c\u6362\u4e3a\u7279\u5b9a\u4e8e Envoy \u7684\u914d\u7f6e\uff0c\u5e76\u5728\u8fd0\u884c\u65f6\u5c06\u5b83\u4eec\u4f20\u64ad\u5230 sidecar\u3002</p> <p>Pilot \u5c06\u5e73\u53f0\u7279\u5b9a\u7684\u670d\u52a1\u53d1\u73b0\u673a\u5236\u62bd\u8c61\u5316\u5e76\u5c06\u5176\u5408\u6210\u4e3a\u7b26\u5408 Envoy \u6570\u636e\u5e73\u9762 API \u7684\u4efb\u4f55 sidecar \u90fd\u53ef\u4ee5\u4f7f\u7528\u7684\u6807\u51c6\u683c\u5f0f\u3002\u8fd9\u79cd\u677e\u6563\u8026\u5408\u4f7f\u5f97 Istio \u80fd\u591f\u5728\u591a\u79cd\u73af\u5883\u4e0b\u8fd0\u884c\uff08\u4f8b\u5982\uff0cKubernetes\u3001Consul\u3001Nomad\uff09\uff0c\u540c\u65f6\u4fdd\u6301\u7528\u4e8e\u6d41\u91cf\u7ba1\u7406\u7684\u76f8\u540c\u64cd\u4f5c\u754c\u9762\u3002</p> <ul> <li>\u67b6\u6784\u56fe</li> </ul> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#424-citadel","title":"4.2.4 Citadel","text":"<ul> <li>\u6982\u5ff5</li> </ul> <p>Citadel \u901a\u8fc7\u5185\u7f6e\u8eab\u4efd\u548c\u51ed\u8bc1\u7ba1\u7406\u8d4b\u80fd\u5f3a\u5927\u7684\u670d\u52a1\u95f4\u548c\u6700\u7ec8\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\u3002\u53ef\u7528\u4e8e\u5347\u7ea7\u670d\u52a1\u7f51\u683c\u4e2d\u672a\u52a0\u5bc6\u7684\u6d41\u91cf\uff0c\u5e76\u4e3a\u8fd0\u7ef4\u4eba\u5458\u63d0\u4f9b\u57fa\u4e8e\u670d\u52a1\u6807\u8bc6\u800c\u4e0d\u662f\u7f51\u7edc\u63a7\u5236\u7684\u5f3a\u5236\u6267\u884c\u7b56\u7565\u7684\u80fd\u529b\u3002\u4ece 0.5 \u7248\u672c\u5f00\u59cb\uff0cIstio \u652f\u6301\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u4ee5\u63a7\u5236\u8c01\u53ef\u4ee5\u8bbf\u95ee\u60a8\u7684\u670d\u52a1\uff0c\u800c\u4e0d\u662f\u57fa\u4e8e\u4e0d\u7a33\u5b9a\u7684\u4e09\u5c42\u6216\u56db\u5c42\u7f51\u7edc\u6807\u8bc6\u3002</p> <ul> <li>\u67b6\u6784\u56fe</li> </ul> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#425-galley","title":"4.2.5 Galley","text":"<p>Galley \u4ee3\u8868\u5176\u4ed6\u7684 Istio \u63a7\u5236\u5e73\u9762\u7ec4\u4ef6\uff0c\u7528\u6765\u9a8c\u8bc1\u7528\u6237\u7f16\u5199\u7684 Istio API \u914d\u7f6e\u3002\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0cGalley \u5c06\u63a5\u7ba1 Istio \u83b7\u53d6\u914d\u7f6e\u3001 \u5904\u7406\u548c\u5206\u914d\u7ec4\u4ef6\u7684\u9876\u7ea7\u8d23\u4efb\u3002\u5b83\u5c06\u8d1f\u8d23\u5c06\u5176\u4ed6\u7684 Istio \u7ec4\u4ef6\u4e0e\u4ece\u5e95\u5c42\u5e73\u53f0\uff08\u4f8b\u5982 Kubernetes\uff09\u83b7\u53d6\u7528\u6237\u914d\u7f6e\u7684\u7ec6\u8282\u4e2d\u9694\u79bb\u5f00\u6765\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#43","title":"4.3 \u8bbe\u8ba1\u76ee\u6807","text":"<ul> <li>\u6700\u5927\u5316\u900f\u660e\u5ea6\uff1a\u82e5\u60f3 Istio \u88ab\u91c7\u7eb3\uff0c\u5e94\u8be5\u8ba9\u8fd0\u7ef4\u548c\u5f00\u53d1\u4eba\u5458\u53ea\u9700\u4ed8\u51fa\u5f88\u5c11\u7684\u4ee3\u4ef7\u5c31\u53ef\u4ee5\u4ece\u4e2d\u53d7\u76ca\u3002\u4e3a\u6b64\uff0cIstio \u5c06\u81ea\u8eab\u81ea\u52a8\u6ce8\u5165\u5230\u670d\u52a1\u95f4\u6240\u6709\u7684\u7f51\u7edc\u8def\u5f84\u4e2d\u3002Istio \u4f7f\u7528 sidecar \u4ee3\u7406\u6765\u6355\u83b7\u6d41\u91cf\uff0c\u5e76\u4e14\u5728\u5c3d\u53ef\u80fd\u7684\u5730\u65b9\u81ea\u52a8\u7f16\u7a0b\u7f51\u7edc\u5c42\uff0c\u4ee5\u8def\u7531\u6d41\u91cf\u901a\u8fc7\u8fd9\u4e9b\u4ee3\u7406\uff0c\u800c\u65e0\u9700\u5bf9\u5df2\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u8fdb\u884c\u4efb\u4f55\u6539\u52a8\u3002\u5728 Kubernetes\u4e2d\uff0c\u4ee3\u7406\u88ab\u6ce8\u5165\u5230 pod \u4e2d\uff0c\u901a\u8fc7\u7f16\u5199 iptables \u89c4\u5219\u6765\u6355\u83b7\u6d41\u91cf\u3002\u6ce8\u5165 sidecar \u4ee3\u7406\u5230 pod \u4e2d\u5e76\u4e14\u4fee\u6539\u8def\u7531\u89c4\u5219\u540e\uff0cIstio \u5c31\u80fd\u591f\u8c03\u89e3\u6240\u6709\u6d41\u91cf\u3002\u8fd9\u4e2a\u539f\u5219\u4e5f\u9002\u7528\u4e8e\u6027\u80fd\u3002\u5f53\u5c06 Istio \u5e94\u7528\u4e8e\u90e8\u7f72\u65f6\uff0c\u8fd0\u7ef4\u4eba\u5458\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e3a\u63d0\u4f9b\u8fd9\u4e9b\u529f\u80fd\u800c\u589e\u52a0\u7684\u8d44\u6e90\u5f00\u9500\u662f\u5f88\u5c0f\u7684\u3002\u6240\u6709\u7ec4\u4ef6\u548c API \u5728\u8bbe\u8ba1\u65f6\u90fd\u5fc5\u987b\u8003\u8651\u6027\u80fd\u548c\u89c4\u6a21\u3002</li> <li>\u53ef\u6269\u5c55\u6027\uff1a\u968f\u7740\u8fd0\u7ef4\u4eba\u5458\u548c\u5f00\u53d1\u4eba\u5458\u8d8a\u6765\u8d8a\u4f9d\u8d56 Istio \u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u7cfb\u7edf\u5fc5\u7136\u548c\u4ed6\u4eec\u7684\u9700\u6c42\u4e00\u8d77\u6210\u957f\u3002\u867d\u7136\u6211\u4eec\u671f\u671b\u7ee7\u7eed\u81ea\u5df1\u6dfb\u52a0\u65b0\u529f\u80fd\uff0c\u4f46\u662f\u6211\u4eec\u9884\u8ba1\u6700\u5927\u7684\u9700\u6c42\u662f\u6269\u5c55\u7b56\u7565\u7cfb\u7edf\uff0c\u96c6\u6210\u5176\u4ed6\u7b56\u7565\u548c\u63a7\u5236\u6765\u6e90\uff0c\u5e76\u5c06\u7f51\u683c\u884c\u4e3a\u4fe1\u53f7\u4f20\u64ad\u5230\u5176\u4ed6\u7cfb\u7edf\u8fdb\u884c\u5206\u6790\u3002\u7b56\u7565\u8fd0\u884c\u65f6\u652f\u6301\u6807\u51c6\u6269\u5c55\u673a\u5236\u4ee5\u4fbf\u63d2\u5165\u5230\u5176\u4ed6\u670d\u52a1\u4e2d\u3002\u6b64\u5916\uff0c\u5b83\u5141\u8bb8\u6269\u5c55\u8bcd\u6c47\u8868\uff0c\u4ee5\u5141\u8bb8\u57fa\u4e8e\u7f51\u683c\u751f\u6210\u7684\u65b0\u4fe1\u53f7\u6765\u6267\u884c\u7b56\u7565\u3002</li> <li>\u53ef\u79fb\u690d\u6027\uff1a\u4f7f\u7528 Istio \u7684\u751f\u6001\u7cfb\u7edf\u5c06\u5728\u5f88\u591a\u7ef4\u5ea6\u4e0a\u6709\u5dee\u5f02\u3002Istio \u5fc5\u987b\u80fd\u591f\u4ee5\u6700\u5c11\u7684\u4ee3\u4ef7\u8fd0\u884c\u5728\u4efb\u4f55\u4e91\u6216\u9884\u7f6e\u73af\u5883\u4e2d\u3002\u5c06\u57fa\u4e8e Istio \u7684\u670d\u52a1\u79fb\u690d\u5230\u65b0\u73af\u5883\u5e94\u8be5\u662f\u8f7b\u800c\u6613\u4e3e\u7684\uff0c\u800c\u4f7f\u7528 Istio \u5c06\u4e00\u4e2a\u670d\u52a1\u540c\u65f6\u90e8\u7f72\u5230\u591a\u4e2a\u73af\u5883\u4e2d\u4e5f\u662f\u53ef\u884c\u7684\uff08\u4f8b\u5982\uff0c\u5728\u591a\u4e2a\u4e91\u4e0a\u8fdb\u884c\u5197\u4f59\u90e8\u7f72\uff09\u3002</li> <li>\u7b56\u7565\u4e00\u81f4\u6027\uff1a\u5728\u670d\u52a1\u95f4\u7684 API \u8c03\u7528\u4e2d\uff0c\u7b56\u7565\u7684\u5e94\u7528\u4f7f\u5f97\u53ef\u4ee5\u5bf9\u7f51\u683c\u95f4\u884c\u4e3a\u8fdb\u884c\u5168\u9762\u7684\u63a7\u5236\uff0c\u4f46\u5bf9\u4e8e\u65e0\u9700\u5728 API \u7ea7\u522b\u8868\u8fbe\u7684\u8d44\u6e90\u6765\u8bf4\uff0c\u5bf9\u8d44\u6e90\u5e94\u7528\u7b56\u7565\u4e5f\u540c\u6837\u91cd\u8981\u3002\u4f8b\u5982\uff0c\u5c06\u914d\u989d\u5e94\u7528\u5230 ML \u8bad\u7ec3\u4efb\u52a1\u6d88\u8017\u7684 CPU \u6570\u91cf\u4e0a\uff0c\u6bd4\u5c06\u914d\u989d\u5e94\u7528\u5230\u542f\u52a8\u8fd9\u4e2a\u5de5\u4f5c\u7684\u8c03\u7528\u4e0a\u66f4\u4e3a\u6709\u7528\u3002\u56e0\u6b64\uff0c\u7b56\u7565\u7cfb\u7edf\u4f5c\u4e3a\u72ec\u7279\u7684\u670d\u52a1\u6765\u7ef4\u62a4\uff0c\u5177\u6709\u81ea\u5df1\u7684 API\uff0c\u800c\u4e0d\u662f\u5c06\u5176\u653e\u5230\u4ee3\u7406/sidecar \u4e2d\uff0c\u8fd9\u5bb9\u8bb8\u670d\u52a1\u6839\u636e\u9700\u8981\u76f4\u63a5\u4e0e\u5176\u96c6\u6210\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://juejin.im/post/5a3f207c51882525ab7bfdbd</li> <li>https://juejin.im/post/5acb0d7df265da237719b4c1</li> <li>https://juejin.im/post/5a727e1df265da3e3641961c</li> <li>https://segmentfault.com/a/1190000010224335</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/","title":"Istio\u7070\u5ea6\u53d1\u5e03","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/#_1","title":"\u4e00 \u5178\u578b\u53d1\u5e03\u7c7b\u578b\u5bf9\u6bd4","text":"<ul> <li>\u84dd\u7eff\u53d1\u5e03</li> </ul> <ul> <li>\u7070\u5ea6\u53d1\u5e03\uff08\u91d1\u4e1d\u96c0\u53d1\u5e03\uff09</li> </ul> <ul> <li>A/B Test</li> </ul> <p>A/B Test\u4e3b\u8981\u5bf9\u7279\u5b9a\u7528\u6237\u91c7\u6837\u540e\uff0c\u5bf9\u6536\u96c6\u7684\u53cd\u9988\u6570\u636e\u505a\u76f8\u5173\u5bf9\u6bd4\uff0c\u7136\u540e\u6839\u636e\u5bf9\u6bd4\u7ed3\u679c\u4f5c\u51fa\u51b3\u7b56\uff0c\u7528\u6765\u6d4b\u8bd5\u5e94\u7528\u529f\u80fd\u8868\u73b0\u7684\u65b9\u6cd5\uff0c\u4fa7\u91cd\u5e94\u7528\u7684\u53ef\u7528\u6027\uff0c\u53d7\u6b22\u8fce\u7a0b\u5ea6\u7b49\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/#istio_1","title":"\u4e8c Istio","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/#21-virtualservice","title":"2.1 Virtualservice","text":"<p>\u5b9a\u4e49\u4e00\u7cfb\u5217\u9488\u5bf9\u6307\u5b9a\u670d\u52a1\u7684\u6d41\u91cf\u8def\u7531\u89c4\u5219</p> <ul> <li>hosts\uff1a\u6d41\u91cf\u7684\u76ee\u6807\u4e3b\u673a</li> <li>gateways\uff1agateway\u540d\u79f0\u5217\u8868</li> <li>http\uff1ahttp\u6d41\u91cf\u89c4\u5219\u5217\u8868</li> <li>tcp\uff1atcp\u6d41\u91cf\u89c4\u5219</li> <li>tls\uff1atls\u548chttps\u6d41\u91cf\u89c4\u5219</li> </ul> <p></p> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/#_2","title":"\u4e09 \u53d1\u5e03\u6d41\u7a0b","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/#_3","title":"\u56db \u667a\u80fd\u7070\u5ea6\u53d1\u5e03","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/#41","title":"4.1 \u76ee\u6807\uff1a\u7ec6\u7c92\u5ea6\u63a7\u5236\u7684\u81ea\u52a8\u5316\u7684\u6301\u7eed\u4ea4\u4ed8","text":"<p>\u7279\u70b9\uff1a</p> <ul> <li>\u7528\u6237\u7ec6\u5206</li> <li>\u6d41\u91cf\u7ba1\u7406</li> <li>\u5173\u673a\u6307\u6807\u53ef\u4ee5\u89c2\u6d4b</li> <li>\u53d1\u5e03\u6d41\u7a0b\u81ea\u52a8\u5316</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/#42","title":"4.2 \u667a\u80fd\u7070\u5ea6\u53d1\u5e03\u6d41\u7a0b\u56fe","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8BGateway/","title":"Istio\u7b14\u8bb0\u4e4bGateway","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8BGateway/#gateway","title":"\u4e00 Gateway\u7b80\u4ecb","text":"<p>\u5728Istio\u4e2d\uff0cgateway\u63a7\u5236\u7740\u7f51\u7edc\u8fb9\u7f18\u7684\u670d\u52a1\u66b4\u9732\uff0c\u53ef\u4ee5\u5c06\u5176\u770b\u4f5c\u7f51\u683c\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u63d0\u4f9b\u4e00\u4e0b\u529f\u80fd</p> <ol> <li>L4-L6\u7684\u8d1f\u8f7d\u5747\u8861</li> <li>\u5bf9\u5916\u7684\u53cc\u5411TLS</li> </ol> <p>Istio\u670d\u52a1\u7f51\u683c\u4e2d\uff0cgateway \u53ef\u4ee5\u90e8\u7f72\u591a\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u516c\u7528\u4e00\u4e2a\uff0c\u53ef\u4ee5\u6bcf\u4e2a\u79df\u6237\uff0cnamespace\u9694\u79bb</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8BGateway/#istiogatewaykubernetes-ingress","title":"\u4e8c Istio\u7684gateway\u4e0ekubernetes Ingress\u7684\u533a\u522b","text":"<p>kubernetes ingress\u96c6\u7fa4\u8fb9\u7f18\u8d1f\u8f7d\u5747\u8861\uff0c\u63d0\u4f9b\u96c6\u7fa4\u5185\u90e8\u670d\u52a1\u7684\u8bbf\u95ee\u5165\u53e3\uff0c\u63d0\u4f9bL7\u8d1f\u8f7d\u5747\u8861\uff0c\u529f\u80fd\u5355\u4e00</p> <p>Istio 1.0\u4e4b\u524d\uff0c\u5229\u7528kubernetes ingress\u5b9e\u73b0\u7f51\u683c\u5185\u670d\u52a1\u66b4\u9732\uff0c\u4f46\u662f\u529f\u80fd\u8f83\u5355\u4e00</p> <ol> <li>L4-L6\u8d1f\u8f7d\u5747\u8861</li> <li>\u5bf9\u5916\u53cc\u5411TLS</li> <li>SNI\u652f\u6301</li> <li>\u5176\u4ed6Istio\u4e2d\u4ee5\u53ca\u5b9e\u73b0\u5185\u90e8\u7f51\u7edc\u529f\u80fd\uff0cFalut Injection\uff08\u6545\u969c\u6ce8\u5165\uff09\uff0cTraffic Shifting\uff08\u6d41\u91cf\u8f6c\u79fb\uff09\uff0cCircuit Breaking\uff08\u65ad\u8def\u5668\uff09\uff0cMirroring\uff08\u955c\u50cf\uff09</li> </ol> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0cistio\u5728\u65b0\u7248\u672c\u8bbe\u8ba1\u4e86api\u6765\u89e3\u51b3\u3002</p> <ol> <li>gateway\u5141\u8bb8\u7ba1\u7406\u5458\u6307\u5b9aL4-L6\u7684\u8bbe\u7f6e\uff1a\u7aef\u53e3\u53caTLS\u8bbe\u7f6e</li> <li>\u5bf9\u4e8eingress\u7684\u8bbe\u7f6e\uff0cistio\u5141\u8bb8virtualservice \u4e0egateway\u7ed1\u5b9a\u8d77\u6765</li> <li>\u5206\u79bb\u7684\u597d\u5904\uff1a\u7528\u6237\u53ef\u4ee5\u50cf\u4f7f\u7528\u4f20\u7edf\u8d1f\u8f7d\u5747\u8861\u5668\u8bbe\u5907\u4e00\u6837\u7ba1\u7406\u8fdb\u5165\u7f51\u683c\u7684\u6d41\u91cf\uff0c\u7ed1\u5b9a\u865a\u62dfIP\u5230\u865a\u62df\u670d\u52a1\u5668\u4e0a\u9762\uff0c\u4fbf\u4e8e\u4f20\u7edf\u6280\u672f\u65e0\u7f1d\u8fc1\u79fb\u5230\u5fae\u670d\u52a1\u3002</li> </ol>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8BGateway/#gateway_1","title":"\u4e09 gateway\u539f\u7406\u4e0e\u5b9e\u73b0","text":"<p>gateway\u4e0e\u666e\u901asidecar\u5747\u4f7f\u7528envoy\u4f5c\u4e3aproxy\u5b9e\u884c\u6d41\u91cf\u63a7\u5236\uff0cpilot\u4e3a\u4e0d\u540c\u7c7b\u578bproxy\u751f\u6210\u76f8\u5e94\u914d\u7f6e\uff0cgateway\u7684\u7c7b\u578b\u4e3aroute\uff0csidecar\u7c7b\u578b\u4e3asidecar\u3002</p> <ul> <li>Pilit\u5982\u4f55\u5f97\u77e5proxy\u7c7b\u578b</li> </ul> <p>envoy\u53d1\u73b0\u670d\u52a1\u4f7f\u7528xDS\u534f\u8bae\uff0cenvoy\u5411server\u7aef\u7684pilot\u53d1\u8d77\u8bf7\u6c42discoverrequest\u65f6\u4f1a\u643a\u5e26\u81ea\u8eab\u7684node\u4fe1\u606f\uff0cnode\u4fe1\u606f\u6709\u4e00\u4e2aID\u6807\u8bc6\uff0cpilot\u4f1a\u89e3\u6790node\u6807\u793a\u83b7\u53d6proxy\u7c7b\u578b\u3002</p> <p></p> <p>enovy\u7684\u8282\u70b9\u6807\u793a\u53ef\u4ee5\u901a\u8fc7\u9759\u6001\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u542f\u52a8\u53c2\u6570\u2014service-node\u6307\u5b9a</p> <ul> <li>gateway\u5bf9\u8c61\u5728istio\u4e2d\u662f\u4f7f\u7528CRD\u58f0\u660e\uff0c\u53ef\u4ee5\u901a</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8BGateway/#gateway_2","title":"\u56db gateway\u914d\u7f6e\u4e0b\u53d1","text":"<p>\u9075\u5faamake-before-break\u539f\u5219\uff0c\u675c\u7edd\u89c4\u5219\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u51fa\u73b0503</p> <p></p> <p>route\u7c7b\u578b\u4e0esidecar\u7c7b\u578b\u7684proxy\u672c\u8d28\u6ca1\u6709\u533a\u522b\uff0cinbound cluster\uff0cendpoint\uff0clistener</p> <p>\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u8bf4\u660e\uff0cgateway\u4e0d\u662f\u6d41\u91cf\u7684\u7ec8\u70b9\uff0c\u800c\u53ea\u662f\u5145\u5f53\u4e00\u4e2a\u4ee3\u7406\u8f6c\u53d1</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8BGateway/#_1","title":"\u4e94 \u5916\u90e8\u8bf7\u6c42\u5230\u8fbe\u5e94\u7528","text":"<ul> <li>client\u53d1\u8d77\u8bf7\u6c42\u5230\u7279\u5b9a\u7aef\u53e3</li> <li>load banlancer\u76d1\u542c\u5728\u6b64\u7aef\u53e3\uff0c\u5e76\u8f6c\u53d1\u5230\u540e\u7aef</li> <li>\u5728istio\u4e2d\uff0clb\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230ingress gateway\u670d\u52a1</li> <li>service\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230ingress gateway pod</li> <li>pod\u83b7\u53d6gateway\u548cvirtual service\u914d\u7f6e\uff0c\u83b7\u53d6\u7aef\u53e3\uff0c\u534f\u8bae\uff0c\u8bc1\u4e66\uff0c\u521b\u5efa\u76d1\u542c\u5668</li> <li>gateway pod\u6839\u636e\u8def\u7531\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u5e94\u7528pod\uff08\u4e0d\u662fservice\uff09</li> </ul> <p>\u63a7\u5236ingress http\u6d41\u91cf</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/","title":"Istio\u7b14\u8bb0\u4e4bpilot","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#_1","title":"\u4e00 \u57fa\u672c\u6982\u5ff5","text":"<p>Pilot \u4e3a Envoy sidecar \u63d0\u4f9b\u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff0c\u4e3a\u667a\u80fd\u8def\u7531\uff08\u4f8b\u5982 A/B \u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u90e8\u7f72\u7b49\uff09\u548c\u5f39\u6027\uff08\u8d85\u65f6\u3001\u91cd\u8bd5\u3001\u7194\u65ad\u5668\u7b49\uff09\u63d0\u4f9b\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u5b83\u5c06\u63a7\u5236\u6d41\u91cf\u884c\u4e3a\u7684\u9ad8\u7ea7\u8def\u7531\u89c4\u5219\u8f6c\u6362\u4e3a\u7279\u5b9a\u4e8e Envoy \u7684\u914d\u7f6e\uff0c\u5e76\u5728\u8fd0\u884c\u65f6\u5c06\u5b83\u4eec\u4f20\u64ad\u5230 sidecar\u3002</p> <p>Pilot \u5c06\u5e73\u53f0\u7279\u5b9a\u7684\u670d\u52a1\u53d1\u73b0\u673a\u5236\u62bd\u8c61\u5316\u5e76\u5c06\u5176\u5408\u6210\u4e3a\u7b26\u5408 Envoy \u6570\u636e\u5e73\u9762 API \u7684\u4efb\u4f55 sidecar \u90fd\u53ef\u4ee5\u4f7f\u7528\u7684\u6807\u51c6\u683c\u5f0f\u3002\u8fd9\u79cd\u677e\u6563\u8026\u5408\u4f7f\u5f97 Istio \u80fd\u591f\u5728\u591a\u79cd\u73af\u5883\u4e0b\u8fd0\u884c\uff08\u4f8b\u5982\uff0cKubernetes\u3001Consul\u3001Nomad\uff09\uff0c\u540c\u65f6\u4fdd\u6301\u7528\u4e8e\u6d41\u91cf\u7ba1\u7406\u7684\u76f8\u540c\u64cd\u4f5c\u754c\u9762\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#_2","title":"\u4e8c \u6838\u5fc3\u529f\u80fd","text":"<ul> <li>\u670d\u52a1\u53d1\u73b0</li> <li>\u914d\u7f6e\u7ba1\u7406</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#_3","title":"\u4e09 \u670d\u52a1\u53d1\u73b0\u6d41\u7a0b","text":"<p>\u670d\u52a1\u6ce8\u518c\u8868\uff1aPilot\u4ece\u5e73\u53f0\u83b7\u53d6\u670d\u52a1\u53d1\u73b0\u6570\u636e\uff0c\u5e76\u63d0\u4f9b\u7edf\u4e00\u7684\u53d1\u73b0\u63a5\u53e3</p> <p>\u670d\u52a1\u53d1\u73b0\uff1aEnvoy\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\uff0c\u52a8\u6001\u66f4\u65b0\u8d1f\u8f7d\u5747\u8861\u6c60\u3002\u670d\u52a1\u8bf7\u6c42\u65f6\u4f7f\u7528\u5bf9\u5e94\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u5bf9\u5e94\u7684\u540e\u7aef\u3002</p> <p>\u670d\u52a1\u53d1\u73b0\u6d41\u7a0b\uff1aservice A\u8bbf\u95eeservice B\u51fa\u65b9\u5411\u6d41\u91cf\u7ecf\u8fc7Proxy\uff0cproxy\u53bb\u8bf7\u6c42Pilot servies\u62ff\u5230service b\u7684\u670d\u52a1\u5730\u5740\u4ee5\u53ca\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff0c\u7136\u540e\u53d1\u8d77\u8bf7\u6c42\uff0cservice b\u7684\u5165\u6d41\u91cf\u88abservice b\u4f24\u7684proxy\u62e6\u622a\u53ef\u4ee5\u6267\u884c\u4e00\u7cfb\u5217\u7684\u670d\u52a1\u6cbb\u7406\u64cd\u4f5c\u3002proxy\u91c7\u7528envoy\u548c\u670d\u52a1\u5728\u4e00\u8d77\uff0c\u8bf7\u6c42\u6d41\u91cf\u901a\u8fc7proxy\uff0c \u4f46\u662fservice a\u8bbf\u95ee\u5176\u4ed6service \u662f\u611f\u77e5\u4e0d\u5230proxy</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#pilot","title":"\u56db Pilot\u670d\u52a1\u53d1\u73b0\u673a\u5236","text":"<ul> <li>k8s\u7684\u670d\u52a1\u53d1\u73b0</li> </ul> <p>\u6211\u4eec\u90fd\u77e5\u9053k8s\u5176\u5b9e\u662f\u5177\u5907\u670d\u52a1\u53d1\u73b0\u673a\u5236\uff0csvca\u8bbf\u95eesvcb\u901a\u8fc7serviceip\uff0c\u7136\u540e\u8bf7\u6c42\u5230\u8fbenode\u7684kube-proxy\u4e0a\uff0ckube-proxy\u53c8\u4ecekube-APIServer\u4e0a\u83b7\u53d6\u96c6\u7fa4\u5176\u4ed6service\u7684\u540e\u7aefbackend\u793a\u4f8b\uff0c\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0</p> <p>\u5171\u4e00\u4e2ans\u4e0b\u53ef\u4ee5\u76f4\u63a5\u77ed\u57df\u540d\u8bbf\u95ee\uff0c\u8de8ns\uff0c\u9700\u8981\u5e26\u4e0ans\uff0cservice.namespace.svc.cluster.local</p> <p></p> <ul> <li>Adapter\u673a\u5236\uff0cPilot\u5176\u4e2d\u53ea\u6709\u670d\u52a1\u53d1\u73b0\u7684\u5b9a\u4e49\uff0c\u6ca1\u6709\u670d\u52a1\u53d1\u73b0\u7684\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86\u9002\u5e94\u4e0e\u5404\u79cd\u5e73\u53f0\u53ca\u5176\u4ed6\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u7684\u9002\u914d\u5668 \uff0c\u670d\u52a1\u53d1\u73b0\u7684\u5b9e\u73b0\u4f4dadapter\u5bf9\u63a5\u7684\u5e73\u53f0\u6216\u8fd9\u5176\u4ed6\u670d\u52a1\u53d1\u73b0\u7684\u540e\u7aef\u3002</li> </ul> <p></p> <ul> <li>pilot\u57fa\u4e8ekubernetes\u7684\u670d\u52a1\u53d1\u73b0\uff0cistio\u867d\u7136\u5177\u5907\u53ef\u6269\u5c55\u6027\uff0c\u80fd\u591f\u7ed3\u5408\u5176\u4ed6\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\uff0c\u4f46\u662f\u7ed3\u5408\u7528\u6237\u573a\u666f\uff0c\u5176\u652f\u6301\u6700\u597d\u7684\u8fd8\u662fkuberenets\uff0c\u5728\u65b0\u7248\u672cistio\u4f1a\u79fb\u9664eureka\u7684\u652f\u6301\uff0c\u5728\u6b64\u4e3a\u4eec\u7740\u91cd\u7814\u7a76pilot\u5728kubernetes\u670d\u52a1\u53d1\u73b0\u673a\u5236</li> </ul> <p></p> <ol> <li>pilot\u5b9e\u73b0\u82e5\u5e72\u670d\u52a1\u53d1\u73b0\u7684\u63a5\u53e3\u5b9a\u4e49</li> <li>pilot\u7684controller list/watch kubernetesAPIserver\u4e0aservice/endpoint\u7b49\u8d44\u6e90\u5bf9\u8c61\u5e76\u8f6c\u6362pilot\u7684\u6807\u51c6\u683c\u5f0f</li> <li>envoy\u4ecepilot\u83b7\u53d6xDS\uff0c\u52a8\u6001\u66f4\u65b0</li> <li>\u5f53\u8981\u670d\u52a1\u8bbf\u95ee\u65f6\uff0cenvoy\u5728\u5904\u7406outbound\u8bf7\u6c42\u65f6\uff0c\u6839\u636e\u914d\u7f6e\u7684LB\u7b56\u7565\uff0c\u9009\u62e9\u4e00\u4e2a\u670d\u52a1\u5b9e\u4f8b\u53d1\u8d77\u8bbf\u95ee\u3002</li> </ol>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#kubernetesistio","title":"\u4e94 kubernetes\u4e0eistio\u670d\u52a1\u6a21\u578b\u5bf9\u6bd4","text":"<p>istio\u7684service\u5c31\u662fk8s\u7684service\uff0cistio\u5bf9\u5e94\u7684\u670d\u52a1\u6a21\u578binstance\u5bf9\u5e94\u4e8ek8s\u4e2d\u7684endpoint</p> <p></p> <p>istio\u7684version\u5bf9\u5e94\u4e8ek8s\u4e2d\u7684deployment</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#istiok8s","title":"\u516d istio\u5e94\u7528\u67b6\u6784\u5728k8s\u4e0a\u7684\u5b9e\u73b0","text":"<p>\u63a7\u5236\u5c42\u9762\uff1apilot\u53bblist/watch k8s\u7684apiservice\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7crd\u6765\u901a\u8fc7istioctl\u6216kubectl\u6267\u884c\u547d\u4ee4\uff0c\u83b7\u53d6etcd\u4e2d\u7684\u8d44\u6e90</p> <p>\u6570\u636e\u5c42\u9762\uff1aenvoy\u62e6\u622apod\u4e2d\u7684\u8bf7\u6c42\u4ecepilot\u83b7\u53d6\u914d\u7f6e\u8fdb\u884c\u670d\u52a1\u6cbb\u7406\u64cd\u4f5c</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#istio","title":"\u4e03 Istio\u914d\u7f6e\u7ba1\u7406","text":"<ol> <li>\u914d\u7f6e\uff1a\u7ba1\u7406\u5458\u901a\u8fc7Pilot\u914d\u7f6e\u670d\u52a1\u6cbb\u7406\u89c4\u5219</li> <li>\u4e0b\u53d1\uff1aEnvoy\u4ecePilot\u83b7\u53d6\u89c4\u5219</li> <li>\u6267\u884c\uff1a\u5728\u6d41\u91cf\u8bbf\u95ee\u7684\u65f6\u5019\u6267\u884c\u6cbb\u7406\u89c4\u5219\uff0c\u5728SvcA\u670d\u52a1\u53d1\u8d77\u65b9\u7684envoy\u4e2d\u6267\u884c</li> </ol>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#istio_1","title":"\u516b Istio\u670d\u52a1\u6cbb\u7406\u89c4\u5219","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#81-virtualservice","title":"8.1 VirtualService","text":"<p>\u670d\u52a1\u8bbf\u95ee\u8def\u7531\u63a7\u5236\uff0c\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u7684\u8bf7\u6c42\u8def\u7531\u5230\u54ea\u91cc\uff0c\u8fc7\u7a0b\u4e2d\u6cbb\u7406\uff0c\u5305\u62ec\u91cd\u5199\uff0c\u91cd\u8bd5\uff0c\u6545\u969c\u6ce8\u5165\u7b49</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#82-destinationrule","title":"8.2 DestinationRule","text":"<p>\u76ee\u6807\u670d\u52a1\u7684\u7b56\u7565\uff0c\u5305\u62ec\u76ee\u6807\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u94fe\u63a5\u6c60\u7ba1\u7406</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#83-serviceentry-gateway","title":"8.3 ServiceEntry \u548cgateway","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#istio_2","title":"\u4e5d Istio\u914d\u7f6e\u89c4\u5219\u7ef4\u62a4\u548c\u4e0b\u53d1\u6d41\u7a0b","text":"<p>\u7528\u6237\u901a\u8fc7istioctl kubectl\u6216\u8005\u8c03\u7528api\u64cd\u4f5ccrd\u6765\u5c06\u6cbb\u7406\u89c4\u5219\u4e0b\u65b9\u5230k8s\u4e2d\uff0c\u5b58\u50a8\u5728etcd\u4e2d\uff0cpilot\u7684configcontrolle\u4e00\u76f4\u53bblist/watch k8s\u7684apiserver\uff0cPilot\u7684discoveryserver\u6765\u4ece\u914d\u7f6e\u4e2d\u62ff\u5230\u914d\u7f6e\u8f6c\u6362\u6210envoy\u8bc6\u522b\u7684\u89c4\u5219\uff0c\u7136\u540e\u5728envoy\u8fdb\u884c\u670d\u52a1\u6cbb\u7406</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/#istio_3","title":"\u5341 Istio\u670d\u52a1\u6cbb\u7406\u80fd\u529b\u6267\u884c\u4f4d\u7f6e","text":"<p>w</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/","title":"Istio\u7b80\u4ecb\u53ca\u67b6\u6784","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#istio_1","title":"\u4e09 Istio\u662f\u4ec0\u4e48","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#1-istio","title":"1. \u4e3a\u4ec0\u4e48\u4f7f\u7528Istio","text":"<p>\u901a\u8fc7\u8d1f\u8f7d\u5e73\u8861\u3001service-to-service\u8eab\u4efd\u9a8c\u8bc1\u3001\u76d1\u89c6\u7b49\u65b9\u6cd5\uff0cIstio\u53ef\u4ee5\u8f7b\u677e\u5730\u521b\u5efa\u90e8\u7f72\u7684\u670d\u52a1\u7f51\u7edc\uff0c\u800c\u670d\u52a1\u4ee3\u7801\u4e2d\u7684\u4ee3\u7801\u66f4\u6539\u5f88\u5c11\u6216\u6ca1\u6709\u66f4\u6539\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u6574\u4e2a\u73af\u5883\u4e2d\u90e8\u7f72\u4e00\u4e2a\u7279\u6b8a\u7684sidecar\u4ee3\u7406\u6765\u4e3a\u670d\u52a1\u6dfb\u52a0Istio\u652f\u6301\uff0c\u8be5\u4ee3\u7406\u53ef\u4ee5\u62e6\u622a\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u6240\u6709\u7f51\u7edc\u901a\u4fe1\uff0c\u7136\u540e\u4f7f\u7528\u5176\u63a7\u5236\u5e73\u9762\u529f\u80fd\u6765\u914d\u7f6e\u548c\u7ba1\u7406Istio\uff0c\u5176\u4e2d\u5305\u62ec:</p> <ul> <li>HTTP\u3001gRPC\u3001WebSocket\u548cTCP\u6d41\u91cf\u7684\u81ea\u52a8\u8d1f\u8f7d\u5e73\u8861\u3002</li> <li>\u4f7f\u7528\u4e30\u5bcc\u7684\u8def\u7531\u89c4\u5219\u3001\u91cd\u8bd5\u3001\u6545\u969c\u8f6c\u79fb\u548c\u6545\u969c\u6ce8\u5165\u5bf9\u6d41\u91cf\u884c\u4e3a\u8fdb\u884c\u7ec6\u7c92\u5ea6\u63a7\u5236\u3002</li> <li>\u652f\u6301\u8bbf\u95ee\u63a7\u5236\u3001\u901f\u7387\u9650\u5236\u548c\u914d\u989d\u7684\u53ef\u63d2\u62d4\u7b56\u7565\u5c42\u548c\u914d\u7f6eAPI\u3002</li> <li>\u96c6\u7fa4\u5185\u6240\u6709\u6d41\u91cf\u7684\u81ea\u52a8\u5ea6\u91cf\u3001\u65e5\u5fd7\u548c\u8ddf\u8e2a\uff0c\u5305\u62ec\u96c6\u7fa4\u5165\u53e3\u548c\u51fa\u53e3\u3002</li> <li>\u5728\u5177\u6709\u5f3a\u5927\u7684\u57fa\u4e8e\u8eab\u4efd\u7684\u8eab\u4efd\u9a8c\u8bc1\u548c\u6388\u6743\u7684\u96c6\u7fa4\u4e2d\u5b9e\u73b0\u5b89\u5168\u7684\u670d\u52a1\u5230\u670d\u52a1\u901a\u4fe1\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#2-istio","title":"2. Istio\u7684\u6838\u5fc3\u529f\u80fd","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#21","title":"2.1 \u6d41\u91cf\u7ba1\u7406","text":"<p>Istio\u7684\u7b80\u5355\u89c4\u5219\u914d\u7f6e\u548c\u6d41\u91cf\u8def\u7531\u5141\u8bb8\u60a8\u63a7\u5236\u670d\u52a1\u4e4b\u95f4\u7684\u6d41\u91cf\u548cAPI\u8c03\u7528\u6d41\u3002Istio\u7b80\u5316\u4e86\u670d\u52a1\u7ea7\u5c5e\u6027(\u5982\u65ad\u8def\u5668\u3001\u8d85\u65f6\u548c\u91cd\u8bd5)\u7684\u914d\u7f6e\uff0c\u5e76\u4e14\u7b80\u5316\u4e86\u8bbe\u7f6e\u91cd\u8981\u4efb\u52a1(\u5982a /B\u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u6d4b\u8bd5\u548c\u6309\u767e\u5206\u6bd4\u5212\u5206\u7684\u5206\u9636\u6bb5\u6d4b\u8bd5)\u7684\u5de5\u4f5c\u3002</p> <p>\u6709\u4e86\u66f4\u597d\u7684\u6d41\u91cf\u53ef\u89c6\u6027\u548c\u5f00\u7bb1\u5373\u7528\u6545\u969c\u6062\u590d\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u5728\u95ee\u9898\u4ea7\u751f\u4e4b\u524d\u6355\u83b7\u95ee\u9898\uff0c\u4f7f\u8c03\u7528\u66f4\u53ef\u9760\uff0c\u7f51\u7edc\u66f4\u5065\u58ee\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#22","title":"2.2 \u5b89\u5168","text":"<p>Istio\u7684\u5b89\u5168\u529f\u80fd\u4f7f\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7ea7\u522b\u7684\u5b89\u5168\u3002Istio\u63d0\u4f9b\u4e86\u5e95\u5c42\u7684\u5b89\u5168\u901a\u4fe1\u901a\u9053\uff0c\u5e76\u6309\u6bd4\u4f8b\u7ba1\u7406\u670d\u52a1\u901a\u4fe1\u7684\u8eab\u4efd\u9a8c\u8bc1\u3001\u6388\u6743\u548c\u52a0\u5bc6\u3002\u901a\u8fc7Istio\uff0c\u670d\u52a1\u901a\u4fe1\u5728\u7f3a\u7701\u60c5\u51b5\u4e0b\u662f\u5b89\u5168\u7684\uff0c\u5141\u8bb8\u60a8\u5728\u4e0d\u540c\u7684\u534f\u8bae\u548c\u8fd0\u884c\u65f6\u4e4b\u95f4\u4e00\u81f4\u5730\u5b9e\u65bd\u7b56\u7565\u2014\u2014\u6240\u6709\u8fd9\u4e9b\u90fd\u53ea\u9700\u8981\u5f88\u5c11\u6216\u6ca1\u6709\u5e94\u7528\u7a0b\u5e8f\u66f4\u6539\u3002</p> <p>\u867d\u7136Istio\u662f\u5e73\u53f0\u72ec\u7acb\u7684\uff0c\u4e0eKubernetes(\u6216\u57fa\u7840\u8bbe\u65bd)\u7f51\u7edc\u7b56\u7565\u4e00\u8d77\u4f7f\u7528\uff0c\u4f46\u662f\u5b83\u7684\u597d\u5904\u66f4\u5927\uff0c\u5305\u62ec\u80fd\u591f\u5728\u7f51\u7edc\u548c\u5e94\u7528\u5c42\u4e0a\u4fdd\u62a4\u70b9\u5230\u70b9\u6216\u670d\u52a1\u5230\u670d\u52a1\u7684\u901a\u4fe1\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#23","title":"2.3 \u89c2\u5bdf","text":"<p>Istio\u7684\u5065\u58ee\u8ddf\u8e2a\u3001\u76d1\u89c6\u548c\u65e5\u5fd7\u529f\u80fd\u4f7f\u60a8\u80fd\u591f\u6df1\u5165\u4e86\u89e3\u670d\u52a1\u7f51\u683c\u90e8\u7f72\u3002\u901a\u8fc7Istio\u7684\u76d1\u89c6\u529f\u80fd\uff0c\u53ef\u4ee5\u771f\u6b63\u7406\u89e3\u670d\u52a1\u6027\u80fd\u5982\u4f55\u5f71\u54cd\u4e0a\u6e38\u548c\u4e0b\u6e38\u7684\u4e8b\u60c5\uff0c\u800c\u5b83\u7684\u81ea\u5b9a\u4e49\u4eea\u8868\u677f\u63d0\u4f9b\u4e86\u5bf9\u6240\u6709\u670d\u52a1\u7684\u6027\u80fd\u7684\u53ef\u89c1\u6027\uff0c\u5e76\u8ba9\u60a8\u770b\u5230\u8be5\u6027\u80fd\u5982\u4f55\u5f71\u54cd\u5176\u4ed6\u6d41\u7a0b\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#24","title":"2.4 \u5e73\u53f0\u7684\u652f\u6301","text":"<p>Istio\u662f\u72ec\u7acb\u4e8e\u5e73\u53f0\u7684\uff0c\u8bbe\u8ba1\u7528\u4e8e\u5728\u5404\u79cd\u73af\u5883\u4e2d\u8fd0\u884c\uff0c\u5305\u62ec\u8de8\u4e91\u3001\u5185\u90e8\u73af\u5883\u3001Kubernetes\u3001Mesos\u7b49\u7b49\u3002\u60a8\u53ef\u4ee5\u5728Kubernetes\u6216Nomad\u4e0a\u90e8\u7f72Istio\u3002Istio\u76ee\u524d\u652f\u6301:</p> <ul> <li>Service deployment on Kubernetes</li> <li>Services registered with Consul</li> <li>Services running on individual virtual machines</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#istio_2","title":"\u56db Istio\u7684\u67b6\u6784","text":"<p>istio\u670d\u52a1\u7f51\u683c\u5728\u903b\u8f91\u4e0a\u5206\u4e3a\u6570\u636e\u5e73\u9762\u548c\u63a7\u5236\u5e73\u9762\u3002</p> <ul> <li>\u6570\u636e\u5e73\u9762\u7531\u4e00\u7ec4\u90e8\u7f72\u4e3a\u8fb9\u8f66\u7684\u667a\u80fd\u4ee3\u7406(Envoy)\u7ec4\u6210\u3002\u8fd9\u4e9b\u4ee3\u7406\u8d1f\u8d23\u534f\u8c03\u548c\u63a7\u5236\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u6240\u6709\u7f51\u7edc\u901a\u4fe1\u3002\u4ed6\u4eec\u8fd8\u6536\u96c6\u548c\u62a5\u544a\u6240\u6709\u7f51\u683c\u6d41\u91cf\u7684\u9065\u6d4b\u6570\u636e\u3002</li> <li>\u63a7\u5236\u5e73\u9762\u7ba1\u7406\u5e76\u5c06\u4ee3\u7406\u914d\u7f6e\u4e3a\u8def\u7531\u6d41\u91cf\u3002</li> </ul> <p>\u4e0b\u56fe\u663e\u793a\u4e86\u6784\u6210\u6bcf\u4e2a\u5e73\u9762\u7684\u4e0d\u540c\u7ec4\u4ef6\uff1a\uff08\u4e0b\u56fe\u6765\u81ea\u5b98\u7f51\uff09</p> <p></p> <p>Istio\u4e2d\u7684\u4ea4\u901a\u5206\u4e3a\u6570\u636e\u5e73\u9762\u4ea4\u901a\u548c\u63a7\u5236\u5e73\u9762\u4ea4\u901a\u3002\u6570\u636e\u5e73\u9762\u6d41\u91cf\u662f\u6307\u5de5\u4f5c\u8d1f\u8f7d\u7684\u4e1a\u52a1\u903b\u8f91\u53d1\u9001\u548c\u63a5\u6536\u7684\u6d88\u606f\u3002\u63a7\u5236\u5e73\u9762\u4ea4\u901a\u662f\u6307\u5728Istio\u7ec4\u4ef6\u4e4b\u95f4\u53d1\u9001\u7684\u914d\u7f6e\u548c\u63a7\u5236\u6d88\u606f\u6765\u5bf9\u7f51\u683c\u7684\u884c\u4e3a\u8fdb\u884c\u7f16\u7a0b\u3002Istio\u4e2d\u7684\u6d41\u91cf\u7ba1\u7406\u4e13\u95e8\u6307\u6570\u636e\u5e73\u9762\u6d41\u91cf\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#1","title":"1. \u7ec4\u4ef6","text":""},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#11-envoy","title":"1.1 Envoy","text":"<p>Istio\u4f7f\u7528Envoy\u4ee3\u7406\u7684\u6269\u5c55\u7248\u672c\u3002Envoy\u662f\u7528c++\u5f00\u53d1\u7684\u9ad8\u6027\u80fd\u4ee3\u7406\uff0c\u7528\u4e8e\u534f\u8c03\u670d\u52a1\u7f51\u683c\u4e2d\u6240\u6709\u670d\u52a1\u7684\u6240\u6709\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u3002Envoy\u4ee3\u7406\u662f\u552f\u4e00\u4e0e\u6570\u636e\u901a\u4fe1\u4ea4\u4e92\u7684Istio\u7ec4\u4ef6\u3002</p> <p>Envoy\u4ee3\u7406\u88ab\u90e8\u7f72\u4e3a\u670d\u52a1\u7684\u8fb9\u8f66\uff0c\u4ece\u903b\u8f91\u4e0a\u8bb2\uff0c\u5b83\u589e\u52a0\u4e86Envoy\u7684\u8bb8\u591a\u5185\u7f6e\u7279\u6027\uff1a</p> <ul> <li>Dynamic service discovery</li> <li>Load balancing</li> <li>TLS termination</li> <li>HTTP/2 and gRPC proxies</li> <li>Circuit breakers</li> <li>Health checks</li> <li>Staged rollouts with %-based traffic split</li> <li>Fault injection</li> <li>Rich metrics</li> </ul> <p>\u8fd9\u79cdsidecar\u90e8\u7f72\u5141\u8bb8Istio\u63d0\u53d6\u5927\u91cf\u5173\u4e8e\u6d41\u91cf\u884c\u4e3a\u7684\u4fe1\u53f7\u4f5c\u4e3a\u5c5e\u6027\u3002Istio\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u5c5e\u6027\u6765\u6267\u884c\u7b56\u7565\u51b3\u7b56\uff0c\u5e76\u5c06\u5b83\u4eec\u53d1\u9001\u5230\u76d1\u63a7\u7cfb\u7edf\uff0c\u4ee5\u63d0\u4f9b\u5173\u4e8e\u6574\u4e2a\u7f51\u683c\u7684\u884c\u4e3a\u7684\u4fe1\u606f\u3002</p> <p>sidecar\u4ee3\u7406\u6a21\u578b\u8fd8\u5141\u8bb8\u60a8\u5411\u73b0\u6709\u90e8\u7f72\u6dfb\u52a0Istio\u529f\u80fd\uff0c\u800c\u4e0d\u9700\u8981\u91cd\u65b0\u67b6\u6784\u6216\u91cd\u5199\u4ee3\u7801\u3002</p> <p>\u7531envoy\u4ee3\u7406\u542f\u7528\u7684\u4e00\u4e9bIstio\u529f\u80fd\u548c\u4efb\u52a1\u5305\u62ec:</p> <ul> <li>Traffic control features: enforce fine-grained traffic control with rich routing rules for HTTP, gRPC, WebSocket, and TCP traffic.</li> <li>Network resiliency features: setup retries, failovers, circuit breakers, and fault injection.</li> <li>Security and authentication features: enforce security policies and enforce access control and rate limiting defined through the configuration API.</li> <li>Pluggable extensions model based on WebAssembly that allows for custom policy enforcement and telemetry generation for mesh traffic.</li> </ul>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#12-pilot","title":"1.2 Pilot","text":"<p>Pilot\u9488\u5bf9\u63d0\u4f9b\u667a\u80fd\u8def\u7531\uff08\u6bd4\u5982\uff0cA/B\u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u90e8\u7f72\uff09\u7684Envoy Sidecar\uff0c\u6d41\u91cf\u7ba1\u7406\u7684\u80fd\u529b\u63d0\u4f9b\u4e86\u670d\u52a1\u53d1\u73b0\u3002\u9488\u5bf9\u5f39\u6027\u63d0\u4f9b\u4e86\u8d85\u65f6\uff0c\u91cd\u8bd5\uff0c\u65ad\u8def\u4fdd\u62a4\u7b49\u529f\u80fd\u3002</p> <p>Pilot\u5c06\u63a7\u5236\u6d41\u91cf\u884c\u4e3a\u7684\u9ad8\u7ea7\u8def\u7531\u89c4\u5219\u8f6c\u6362\u4e3a\u7279\u5b9a\u4e8e\u73af\u5883\u7684\u914d\u7f6e\uff0c\u5e76\u5728\u8fd0\u884c\u65f6\u5c06\u5b83\u4eec\u4f20\u64ad\u5230\u8fb9\u8f66\u3002Pilot\u5c06\u7279\u5b9a\u4e8e\u5e73\u53f0\u7684\u670d\u52a1\u53d1\u73b0\u673a\u5236\u62bd\u8c61\u51fa\u6765\uff0c\u5e76\u5c06\u5b83\u4eec\u5408\u6210\u4e3a\u4efb\u4f55\u7b26\u5408Envoy API\u7684sidecar\u90fd\u53ef\u4ee5\u4f7f\u7528\u7684\u6807\u51c6\u683c\u5f0f\u3002</p> <p>\u4e0b\u56fe\u663e\u793a\u4e86\u5e73\u53f0\u9002\u914d\u5668\u548cEnvoy\u4ee3\u7406\u5982\u4f55\u4ea4\u4e92:</p> <p></p> <ol> <li>\u5e73\u53f0\u542f\u52a8\u4e00\u4e2a\u670d\u52a1\u7684\u65b0\u5b9e\u4f8b\uff0c\u8be5\u5b9e\u4f8b\u901a\u77e5\u5176\u5e73\u53f0\u9002\u914d\u5668\u3002</li> <li>\u5e73\u53f0\u9002\u914d\u5668\u4f7f\u7528Pilot\u62bd\u8c61\u6a21\u578b\u6ce8\u518c\u5b9e\u4f8b\u3002</li> <li>Pilot\u5c06\u5206\u53d1\u6d41\u91cf\u89c4\u5219\u548c\u914d\u7f6e\u7ed9Envoy\u4ee3\u7406\uff0c\u4ee5\u8bf4\u660e\u66f4\u6539\u7684\u539f\u56e0\u3002</li> </ol> <p>\u8fd9\u79cd\u8026\u5408\u5141\u8bb8istio\u8fd0\u884c\u5728\u6bd4\u5982kubernetes\u3001Consul\u6216\u8005Nomad\u7b49\u5e73\u53f0\u4e0a\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#13-citadel","title":"1.3 Citadel","text":"<p>Citadel\u652f\u6301\u5f3a\u5927\u7684\u670d\u52a1\u5bf9\u670d\u52a1\u548c\u7ec8\u7aef\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5185\u7f6e\u8eab\u4efd\u548c\u51ed\u8bc1\u7ba1\u7406\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528Citadel\u6765\u5347\u7ea7\u670d\u52a1\u7f51\u683c\u4e2d\u7684\u672a\u52a0\u5bc6\u6d41\u91cf\u3002\u4f7f\u7528Citadel\uff0c\u8fd0\u8425\u5546\u53ef\u4ee5\u6267\u884c\u57fa\u4e8e\u670d\u52a1\u8eab\u4efd\u7684\u7b56\u7565\uff0c\u800c\u4e0d\u662f\u57fa\u4e8e\u76f8\u5bf9\u4e0d\u7a33\u5b9a\u7684\u7b2c3\u5c42\u6216\u7b2c4\u5c42\u7f51\u7edc\u6807\u8bc6\u7b26\u3002\u4ece0.5\u7248\u5f00\u59cb\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528Istio\u7684\u6388\u6743\u7279\u6027\u6765\u63a7\u5236\u8c01\u53ef\u4ee5\u8bbf\u95ee\u60a8\u7684\u670d\u52a1\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#14-gallery","title":"1.4 Gallery","text":"<p>Galley\u662fIstio\u7684\u914d\u7f6e\u9a8c\u8bc1\u3001\u6ce8\u5165\u3001\u5904\u7406\u548c\u5206\u53d1\u7ec4\u4ef6\u3002\u5b83\u8d1f\u8d23\u5c06\u5176\u4f59\u7684Istio\u7ec4\u4ef6\u4e0e\u4ece\u5e95\u5c42\u5e73\u53f0(\u4f8b\u5982Kubernetes)\u83b7\u53d6\u7528\u6237\u914d\u7f6e\u7684\u7ec6\u8282\u9694\u79bb\u5f00\u6765\u3002</p>"},{"location":"cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/#2","title":"2. \u8bbe\u8ba1\u76ee\u6807","text":"<ul> <li>\u6700\u5927\u5316\u7684\u900f\u660e\u5ea6\uff1a\u4e3a\u4e86\u91c7\u7528Istio\uff0c\u64cd\u4f5c\u4eba\u5458\u6216\u5f00\u53d1\u4eba\u5458\u9700\u8981\u505a\u5c3d\u53ef\u80fd\u5c11\u7684\u5de5\u4f5c\uff0c\u624d\u80fd\u4ece\u7cfb\u7edf\u4e2d\u83b7\u5f97\u771f\u6b63\u7684\u4ef7\u503c\u3002\u4e3a\u6b64\uff0cIstio\u53ef\u4ee5\u81ea\u52a8\u5c06\u81ea\u5df1\u6ce8\u5165\u5230\u670d\u52a1\u4e4b\u95f4\u7684\u6240\u6709\u7f51\u7edc\u8def\u5f84\u4e2d\u3002Istio\u4f7f\u7528sidecar\u4ee3\u7406\u6765\u6355\u83b7\u6d41\u91cf\uff0c\u5e76\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u4e0d\u66f4\u6539\u5df2\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u81ea\u52a8\u5bf9\u7f51\u7edc\u5c42\u8fdb\u884c\u7f16\u7a0b\uff0c\u4ee5\u901a\u8fc7\u8fd9\u4e9b\u4ee3\u7406\u8def\u7531\u6d41\u91cf\u3002\u5728Kubernetes\u4e2d\uff0c\u4ee3\u7406\u88ab\u6ce8\u5165\u5230pods\u4e2d\uff0c\u901a\u8fc7\u7f16\u5199iptables\u89c4\u5219\u6355\u83b7\u6d41\u91cf\u3002\u4e00\u65e6sidecar\u4ee3\u7406\u88ab\u6ce8\u5165\u5e76\u4e14\u6d41\u91cf\u8def\u7531\u88ab\u5904\u7406\uff0cIstio\u53ef\u4ee5\u534f\u8c03\u6240\u6709\u7684\u6d41\u91cf\u3002\u8fd9\u4e2a\u539f\u5219\u4e5f\u9002\u7528\u4e8e\u6027\u80fd\u3002\u5f53\u5c06Istio\u5e94\u7528\u4e8e\u90e8\u7f72\u65f6\uff0c\u64cd\u4f5c\u4eba\u5458\u4f1a\u770b\u5230\u6240\u63d0\u4f9b\u529f\u80fd\u7684\u8d44\u6e90\u6210\u672c\u7684\u6700\u5c0f\u589e\u52a0\u3002\u7ec4\u4ef6\u548capi\u7684\u8bbe\u8ba1\u5fc5\u987b\u8003\u8651\u5230\u6027\u80fd\u548c\u53ef\u4f38\u7f29\u6027\u3002</li> <li>\u6269\u5c55\u6027\uff1a\u968f\u7740\u64cd\u4f5c\u4eba\u5458\u548c\u5f00\u53d1\u4eba\u5458\u8d8a\u6765\u8d8a\u4f9d\u8d56\u4e8eIstio\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u7cfb\u7edf\u5fc5\u987b\u968f\u7740\u4ed6\u4eec\u7684\u9700\u6c42\u800c\u589e\u957f\u3002\u5f53\u6211\u4eec\u7ee7\u7eed\u6dfb\u52a0\u65b0\u7279\u6027\u65f6\uff0c\u6700\u5927\u7684\u9700\u6c42\u662f\u6269\u5c55\u7b56\u7565\u7cfb\u7edf\u7684\u80fd\u529b\uff0c\u4e0e\u5176\u4ed6\u7b56\u7565\u548c\u63a7\u5236\u6e90\u7684\u96c6\u6210\uff0c\u4ee5\u53ca\u5c06\u5173\u4e8e\u7f51\u683c\u884c\u4e3a\u7684\u4fe1\u53f7\u4f20\u64ad\u5230\u5176\u4ed6\u7cfb\u7edf\u8fdb\u884c\u5206\u6790\u7684\u80fd\u529b\u3002\u7b56\u7565\u8fd0\u884c\u65f6\u652f\u6301\u7528\u4e8e\u63d2\u5165\u5176\u4ed6\u670d\u52a1\u7684\u6807\u51c6\u6269\u5c55\u673a\u5236\u3002</li> <li>\u53ef\u79fb\u690d\u6027\uff1a\u4f7f\u7528Istio\u7684\u751f\u6001\u7cfb\u7edf\u5728\u8bb8\u591a\u65b9\u9762\u90fd\u6709\u6240\u4e0d\u540c\u3002Istio\u5fc5\u987b\u5728\u4efb\u4f55\u4e91\u73af\u5883\u6216\u672c\u5730\u73af\u5883\u4e2d\u4ee5\u6700\u5c0f\u7684\u52aa\u529b\u8fd0\u884c\u3002\u5c06\u57fa\u4e8eisti\u7684\u670d\u52a1\u79fb\u690d\u5230\u65b0\u73af\u5883\u7684\u4efb\u52a1\u5fc5\u987b\u662f\u7410\u788e\u7684\u3002\u4f7f\u7528Istio\uff0c\u60a8\u53ef\u4ee5\u64cd\u4f5c\u90e8\u7f72\u5230\u591a\u4e2a\u73af\u5883\u4e2d\u7684\u5355\u4e2a\u670d\u52a1\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u5728\u591a\u4e2a\u4e91\u4e0a\u90e8\u7f72\u5197\u4f59\u3002</li> <li>\u7b56\u7565\u7684\u4e00\u81f4\u6027\uff1a\u7b56\u7565\u5728\u670d\u52a1\u4e4b\u95f4\u7684API\u8c03\u7528\u4e0a\u7684\u5e94\u7528\u63d0\u4f9b\u4e86\u5bf9\u7f51\u683c\u884c\u4e3a\u7684\u5927\u91cf\u63a7\u5236\u3002\u7136\u800c\uff0c\u5c06\u7b56\u7565\u5e94\u7528\u4e8eAPI\u7ea7\u522b\u4e0a\u4e0d\u4e00\u5b9a\u8868\u793a\u7684\u8d44\u6e90\u4e5f\u540c\u6837\u91cd\u8981\u3002\u4f8b\u5982\uff0c\u5bf9ML\u8bad\u7ec3\u4efb\u52a1\u6d88\u8017\u7684CPU\u6570\u91cf\u5e94\u7528\u914d\u989d\u6bd4\u5bf9\u53d1\u8d77\u5de5\u4f5c\u7684\u8c03\u7528\u5e94\u7528\u914d\u989d\u66f4\u6709\u7528\u3002\u4e3a\u6b64\uff0cIstio\u4f7f\u7528\u81ea\u5df1\u7684API\u5c06\u7b56\u7565\u7cfb\u7edf\u7ef4\u62a4\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u670d\u52a1\uff0c\u800c\u4e0d\u662f\u5c06\u7b56\u7565\u7cfb\u7edf\u96c6\u6210\u5230\u4ee3\u7406sidecar\u4e2d\uff0c\u4ece\u800c\u5141\u8bb8\u670d\u52a1\u6839\u636e\u9700\u8981\u76f4\u63a5\u4e0e\u4e4b\u96c6\u6210\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/istio%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83/","title":"Istio\u5fae\u670d\u52a1\u91d1\u4e1d\u96c0\u53d1\u5e03","text":""},{"location":"cloud-native/servicemesh/istio/istio%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83/#_1","title":"\u5fae\u670d\u52a1\u662f\u4ec0\u4e48","text":""},{"location":"cloud-native/servicemesh/istio/istio%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83/#_2","title":"\u5982\u4f55\u786e\u5b9a\u81ea\u5df1\u7684\u670d\u52a1\u4e3a\u5fae\u670d\u52a1","text":""},{"location":"cloud-native/servicemesh/istio/istio%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83/#_3","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.bilibili.com/video/av77289927?from=search&amp;seid=2454850379442845668</li> <li>https://shimo.im/docs/RY8RtJqkDWr9rxKH/read</li> </ul>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/","title":"Istio\u4e4b\u6d41\u91cf\u7ba1\u7406","text":""},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#istio","title":"Istio\u4e4b\u6d41\u91cf\u7ba1\u7406","text":""},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#_1","title":"\u4e00 \u6982\u8ff0","text":"<p>Istio\u7684\u6d41\u91cf\u8def\u7531\u89c4\u5219\u4f7f\u60a8\u53ef\u4ee5\u8f7b\u677e\u63a7\u5236\u670d\u52a1\u4e4b\u95f4\u7684\u6d41\u91cf\u548cAPI\u8c03\u7528\u3002Istio\u7b80\u5316\u4e86\u8bf8\u5982\u65ad\u8def\u5668\uff0c\u8d85\u65f6\u548c\u91cd\u8bd5\u4e4b\u7c7b\u7684\u670d\u52a1\u7ea7\u522b\u5c5e\u6027\u7684\u914d\u7f6e\uff0c\u5e76\u4f7f\u5176\u6613\u4e8e\u8bbe\u7f6e\u91cd\u8981\u4efb\u52a1\uff08\u5982A / B\u6d4b\u8bd5\uff0ccanary\u90e8\u7f72\u548c\u57fa\u4e8e\u767e\u5206\u6bd4\u7684\u6d41\u91cf\u62c6\u5206\u7684\u5206\u6bb5\u90e8\u7f72\uff09\u3002\u5b83\u8fd8\u63d0\u4f9b\u4e86\u5f00\u7bb1\u5373\u7528\u7684\u6545\u969c\u6062\u590d\u529f\u80fd\uff0c\u6709\u52a9\u4e8e\u4f7f\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u66f4\u5f3a\u5927\uff0c\u4ee5\u9632\u6b62\u76f8\u5173\u670d\u52a1\u6216\u7f51\u7edc\u7684\u6545\u969c\u3002</p> <p>Istio\u7684\u6d41\u91cf\u7ba1\u7406\u6a21\u578b\u4f9d\u8d56\u4e8e \u968f\u670d\u52a1\u4e00\u8d77\u90e8\u7f72\u7684Envoy\u4ee3\u7406\u3002\u7f51\u72b6\u670d\u52a1\u53d1\u9001\u548c\u63a5\u6536\u7684\u6240\u6709\u6d41\u91cf\uff08\u6570\u636e\u5e73\u9762\u6d41\u91cf\uff09\u90fd\u901a\u8fc7Envoy\u8fdb\u884c\u4ee3\u7406\uff0c\u4ece\u800c\u53ef\u4ee5\u8f7b\u677e\u5730\u5f15\u5bfc\u548c\u63a7\u5236\u7f51\u72b6\u7f51\u7edc\u5468\u56f4\u7684\u6d41\u91cf\uff0c\u800c\u65e0\u9700\u5bf9\u670d\u52a1\u8fdb\u884c\u4efb\u4f55\u66f4\u6539\u3002</p> <p>\u5982\u679c\u60a8\u5bf9\u672c\u6307\u5357\u4e2d\u63cf\u8ff0\u7684\u529f\u80fd\u7684\u5de5\u4f5c\u65b9\u5f0f\u7684\u7ec6\u8282\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u5728\u672c\u6587\u6863\u7ed3\u5c3e\u7684\u201c \u67b6\u6784\u201d\u90e8\u5206\u4e2d\u627e\u5230\u6709\u5173Istio\u6d41\u91cf\u7ba1\u7406\u67b6\u6784\u7684\u66f4\u591a\u4fe1\u606f\u3002\u672c\u6307\u5357\u7684\u5176\u4f59\u90e8\u5206\u4ecb\u7ecd\u4e86Istio\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002</p> <p>\u4e3a\u4e86\u5728\u7f51\u72b6\u7f51\u7edc\u5185\u5f15\u5bfc\u6d41\u91cf\uff0cIstio\u9700\u8981\u77e5\u9053\u6240\u6709\u7aef\u70b9\u5728\u54ea\u91cc\u4ee5\u53ca\u5b83\u4eec\u5c5e\u4e8e\u54ea\u4e9b\u670d\u52a1\u3002\u4e3a\u4e86\u586b\u5145\u81ea\u5df1\u7684 \u670d\u52a1\u6ce8\u518c\u8868\uff0cIstio\u8fde\u63a5\u5230\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5728Kubernetes\u7fa4\u96c6\u4e0a\u5b89\u88c5\u4e86Istio\uff0c\u5219Istio\u4f1a\u81ea\u52a8\u68c0\u6d4b\u8be5\u7fa4\u96c6\u4e2d\u7684\u670d\u52a1\u548c\u7aef\u70b9\u3002</p> <p>\u4f7f\u7528\u6b64\u670d\u52a1\u6ce8\u518c\u8868\uff0cEnvoy\u4ee3\u7406\u53ef\u4ee5\u5c06\u6d41\u91cf\u5b9a\u5411\u5230\u76f8\u5173\u670d\u52a1\u3002\u5927\u591a\u6570\u57fa\u4e8e\u5fae\u670d\u52a1\u7684\u5e94\u7528\u7a0b\u5e8f\u6bcf\u4e2a\u670d\u52a1\u5de5\u4f5c\u8d1f\u8f7d\u90fd\u6709\u591a\u4e2a\u5b9e\u4f8b\u6765\u5904\u7406\u670d\u52a1\u6d41\u91cf\uff0c\u6709\u65f6\u4e5f\u79f0\u4e3a\u8d1f\u8f7d\u5e73\u8861\u6c60\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cEnvoy\u4ee3\u7406\u4f7f\u7528\u5faa\u73af\u6a21\u578b\u5728\u6bcf\u4e2a\u670d\u52a1\u7684\u8d1f\u8f7d\u5e73\u8861\u6c60\u4e2d\u5206\u914d\u6d41\u91cf\uff0c\u8be5\u8bf7\u6c42\u5c06\u8bf7\u6c42\u4f9d\u6b21\u53d1\u9001\u5230\u6bcf\u4e2a\u6c60\u6210\u5458\uff0c\u5e76\u5728\u6bcf\u4e2a\u670d\u52a1\u5b9e\u4f8b\u6536\u5230\u8bf7\u6c42\u540e\u8fd4\u56de\u6c60\u7684\u9876\u90e8\u3002</p> <p>\u867d\u7136Istio\u7684\u57fa\u672c\u670d\u52a1\u53d1\u73b0\u548c\u8d1f\u8f7d\u5e73\u8861\u4e3a\u60a8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6709\u6548\u7684\u670d\u52a1\u7f51\u683c\uff0c\u4f46\u5b83\u8fdc\u975eIstio\u53ef\u4ee5\u505a\u7684\u3002\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5bf9\u7f51\u72b6\u6d41\u91cf\u53d1\u751f\u7684\u60c5\u51b5\u8fdb\u884c\u66f4\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u3002\u60a8\u53ef\u80fd\u5e0c\u671b\u5c06\u7279\u5b9a\u767e\u5206\u6bd4\u7684\u6d41\u91cf\u5b9a\u5411\u5230\u670d\u52a1\u7684\u65b0\u7248\u672c\uff0c\u4f5c\u4e3aA / B\u6d4b\u8bd5\u7684\u4e00\u90e8\u5206\uff0c\u6216\u8005\u5c06\u4e0d\u540c\u7684\u8d1f\u8f7d\u5e73\u8861\u7b56\u7565\u5e94\u7528\u4e8e\u7279\u5b9a\u670d\u52a1\u5b9e\u4f8b\u5b50\u96c6\u7684\u6d41\u91cf\u3002\u60a8\u53ef\u80fd\u8fd8\u60f3\u5c06\u7279\u6b8a\u89c4\u5219\u5e94\u7528\u4e8e\u8fdb\u51fa\u7f51\u683c\u7684\u6d41\u91cf\uff0c\u6216\u5c06\u7f51\u683c\u7684\u5916\u90e8\u4f9d\u8d56\u9879\u6dfb\u52a0\u5230\u670d\u52a1\u6ce8\u518c\u8868\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528Istio\u7684\u6d41\u91cf\u7ba1\u7406API\u5411Istio\u6dfb\u52a0\u81ea\u5df1\u7684\u6d41\u91cf\u914d\u7f6e\uff0c\u4ee5\u5b8c\u6210\u6240\u6709\u8fd9\u4e9b\u5de5\u4f5c\u3002</p> <p>\u4e0e\u5176\u4ed6Istio\u914d\u7f6e\u4e00\u6837\uff0c\u4f7f\u7528Kubernetes\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49\uff08CRD\uff09\u6307\u5b9aAPI \uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528YAML\u5bf9\u5176\u8fdb\u884c\u914d\u7f6e\uff0c\u5982\u793a\u4f8b\u6240\u793a\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#virtual-services","title":"\u4e8c Virtual services","text":"<p>\u865a\u62df\u670d\u52a1\u4ee5\u53ca\u76ee\u6807\u89c4\u5219\u662fIstio\u6d41\u91cf\u8def\u7531\u529f\u80fd\u7684\u5173\u952e\u6784\u5efa\u5757\u3002\u865a\u62df\u670d\u52a1\u4f7f\u60a8\u53ef\u4ee5\u5728Istio\u548c\u60a8\u7684\u5e73\u53f0\u63d0\u4f9b\u7684\u57fa\u672c\u8fde\u63a5\u548c\u53d1\u73b0\u7684\u57fa\u7840\u4e0a\uff0c\u914d\u7f6e\u5982\u4f55\u5c06\u8bf7\u6c42\u8def\u7531\u5230Istio\u670d\u52a1\u7f51\u683c\u4e2d\u7684\u670d\u52a1\u3002\u6bcf\u4e2a\u865a\u62df\u670d\u52a1\u7531\u4e00\u7ec4\u8def\u7531\u89c4\u5219\u7ec4\u6210\uff0c\u8fd9\u4e9b\u8def\u7531\u89c4\u5219\u6309\u987a\u5e8f\u8fdb\u884c\u8bc4\u4f30\uff0c\u4ece\u800c\u4f7fIstio\u5c06\u5bf9\u865a\u62df\u670d\u52a1\u7684\u6bcf\u4e2a\u7ed9\u5b9a\u8bf7\u6c42\u5339\u914d\u5230\u7f51\u683c\u5185\u7279\u5b9a\u7684\u5b9e\u9645\u76ee\u7684\u5730\u3002\u60a8\u7684\u7f51\u683c\u53ef\u80fd\u9700\u8981\u591a\u4e2a\u865a\u62df\u670d\u52a1\uff0c\u4e5f\u53ef\u80fd\u4e0d\u9700\u8981\u591a\u4e2a\u865a\u62df\u670d\u52a1\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u60a8\u7684\u7528\u4f8b\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#21-virtual-services","title":"2.1 \u4e3a\u4ec0\u4e48\u4f7f\u7528Virtual services","text":"<p>\u865a\u62df\u670d\u52a1\u5728\u4f7fIstio\u7684\u6d41\u91cf\u7ba1\u7406\u53d8\u5f97\u7075\u6d3b\u548c\u5f3a\u5927\u65b9\u9762\u8d77\u7740\u5173\u952e\u4f5c\u7528\u3002\u4ed6\u4eec\u901a\u8fc7\u5c06\u5ba2\u6237\u7aef\u4ece\u771f\u6b63\u5b9e\u73b0\u5b83\u4eec\u7684\u76ee\u6807\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\u53d1\u9001\u8bf7\u6c42\u7684\u4f4d\u7f6e\u4e4b\u95f4\u53bb\u8026\u5408\uff0c\u6765\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002\u865a\u62df\u670d\u52a1\u8fd8\u63d0\u4f9b\u4e86\u4e00\u79cd\u4e30\u5bcc\u7684\u65b9\u6cd5\u6765\u6307\u5b9a\u7528\u4e8e\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u90a3\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u7684\u4e0d\u540c\u6d41\u91cf\u8def\u7531\u89c4\u5219\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u6709\u7528\uff1f\u6ca1\u6709\u865a\u62df\u670d\u52a1\uff0cEnvoy\u4f7f\u7528\u5faa\u73af\u8d1f\u8f7d\u5e73\u8861\u5728\u6240\u6709\u670d\u52a1\u5b9e\u4f8b\u4e4b\u95f4\u5206\u914d\u6d41\u91cf\uff0c\u5982\u7b80\u4ecb\u4e2d\u6240\u8ff0\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e86\u89e3\u5de5\u4f5c\u8d1f\u8f7d\u6765\u6539\u5584\u6b64\u884c\u4e3a\u3002\u4f8b\u5982\uff0c\u67d0\u4e9b\u4ee3\u8868\u4e0d\u540c\u7684\u7248\u672c\u3002\u8fd9\u5728A / B\u6d4b\u8bd5\u4e2d\u5f88\u6709\u7528\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u57fa\u4e8e\u4e0d\u540c\u670d\u52a1\u7248\u672c\u4e4b\u95f4\u7684\u767e\u5206\u6bd4\u6765\u914d\u7f6e\u6d41\u91cf\u8def\u7531\uff0c\u6216\u5c06\u6d41\u91cf\u4ece\u5185\u90e8\u7528\u6237\u5f15\u5bfc\u5230\u4e00\u7ec4\u7279\u5b9a\u7684\u5b9e\u4f8b\u3002</p> <p>\u4f7f\u7528\u865a\u62df\u670d\u52a1\uff0c\u53ef\u4ee5\u4e3a\u4e00\u4e2a\u6216\u591a\u4e2a\u4e3b\u673a\u540d\u6307\u5b9a\u6d41\u884c\u4e3a\u3002\u60a8\u53ef\u4ee5\u5728\u865a\u62df\u670d\u52a1\u4e2d\u4f7f\u7528\u8def\u7531\u89c4\u5219\uff0c\u8be5\u89c4\u5219\u544a\u8bc9Envoy\u5982\u4f55\u5c06\u865a\u62df\u670d\u52a1\u7684\u6d41\u91cf\u53d1\u9001\u5230\u9002\u5f53\u7684\u76ee\u7684\u5730\u3002\u8def\u7531\u76ee\u7684\u5730\u53ef\u4ee5\u662f\u76f8\u540c\u670d\u52a1\u7684\u7248\u672c\uff0c\u4e5f\u53ef\u4ee5\u662f\u5b8c\u5168\u4e0d\u540c\u7684\u670d\u52a1\u7684\u7248\u672c\u3002</p> <p>\u5178\u578b\u7684\u7528\u4f8b\u662f\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u6307\u5b9a\u4e3a\u670d\u52a1\u5b50\u96c6\u7684\u670d\u52a1\u7684\u4e0d\u540c\u7248\u672c\u3002\u5ba2\u6237\u7aef\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u865a\u62df\u670d\u52a1\u4e3b\u673a\uff0c\u5c31\u597d\u50cf\u5b83\u662f\u5355\u4e2a\u5b9e\u4f53\u4e00\u6837\uff0c\u7136\u540eEnvoy\u6839\u636e\u865a\u62df\u670d\u52a1\u89c4\u5219\u5c06\u6d41\u91cf\u8def\u7531\u5230\u4e0d\u540c\u7248\u672c\uff1a\u4f8b\u5982\uff0c\u201c 20\uff05\u7684\u547c\u53eb\u8f6c\u5230\u65b0\u7248\u672c\u201d\u6216\u201c\u547c\u53eb\u8fd9\u4e9b\u7528\u6237\u8f6c\u5230\u7248\u672c2\u201d\u3002\u4f8b\u5982\uff0c\u8fd9\u4f7f\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u201c\u91d1\u4e1d\u96c0\u201d\u90e8\u7f72\uff0c\u5728\u5176\u4e2d\u9010\u6b65\u589e\u52a0\u53d1\u9001\u5230\u65b0\u670d\u52a1\u7248\u672c\u7684\u6d41\u91cf\u767e\u5206\u6bd4\u3002\u6d41\u91cf\u8def\u7531\u4e0e\u5b9e\u4f8b\u90e8\u7f72\u5b8c\u5168\u5206\u5f00\uff0c\u8fd9\u610f\u5473\u7740\u53ef\u4ee5\u5b8c\u5168\u6839\u636e\u6d41\u91cf\u8d1f\u8f7d\u6765\u6269\u5c55\u548c\u7f29\u5c0f\u5b9e\u73b0\u65b0\u670d\u52a1\u7248\u672c\u7684\u5b9e\u4f8b\u7684\u6570\u91cf\uff0c\u800c\u65e0\u9700\u5b8c\u5168\u5f15\u7528\u6d41\u91cf\u8def\u7531\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u50cfKubernetes\u8fd9\u6837\u7684\u5bb9\u5668\u7f16\u6392\u5e73\u53f0\u4ec5\u652f\u6301\u57fa\u4e8e\u5b9e\u4f8b\u6269\u5c55\u7684\u6d41\u91cf\u5206\u914d\uff0c\u5b9e\u4f8b\u6269\u5c55\u5f88\u5feb\u53d8\u5f97\u590d\u6742\u3002\u60a8\u53ef\u4ee5\u5728\u4e0b\u9762\u9605\u8bfb\u6709\u5173\u865a\u62df\u670d\u52a1\u5982\u4f55\u5e2e\u52a9\u91d1\u4e1d\u96c0\u90e8\u7f72\u7684\u66f4\u591a\u4fe1\u606f\u3002\u4f7f\u7528Istio\u7684Canary\u90e8\u7f72\u3002</p> <p>\u865a\u62df\u670d\u52a1\u8fd8\u4f7f\u60a8\uff1a</p> <ul> <li>\u901a\u8fc7\u5355\u4e2a\u865a\u62df\u670d\u52a1\u5904\u7406\u591a\u4e2a\u5e94\u7528\u7a0b\u5e8f\u670d\u52a1\u3002\u4f8b\u5982\uff0c\u5982\u679c\u7f51\u683c\u4f7f\u7528Kubernetes\uff0c\u5219\u53ef\u4ee5\u914d\u7f6e\u865a\u62df\u670d\u52a1\u4ee5\u5904\u7406\u7279\u5b9a\u540d\u79f0\u7a7a\u95f4\u4e2d\u7684\u6240\u6709\u670d\u52a1\u3002\u5c06\u5355\u4e2a\u865a\u62df\u670d\u52a1\u6620\u5c04\u5230\u591a\u4e2a\u201c\u771f\u5b9e\u201d\u670d\u52a1\u5728\u5e2e\u52a9\u5c06\u5355\u7247\u5e94\u7528\u7a0b\u5e8f\u8f6c\u6362\u4e3a\u7531\u4e0d\u540c\u7684\u5fae\u670d\u52a1\u6784\u5efa\u7684\u590d\u5408\u670d\u52a1\u65f6\u7279\u522b\u6709\u7528\uff0c\u800c\u65e0\u9700\u8be5\u670d\u52a1\u7684\u4f7f\u7528\u8005\u9002\u5e94\u8fc7\u6e21\u3002\u60a8\u7684\u8def\u7531\u89c4\u5219\u53ef\u4ee5\u6307\u5b9a\u201c\u5bf9<code>monolith.com</code>go\u7684\u8fd9\u4e9bURI\u7684\u8c03\u7528 <code>microservice A</code>\u201d\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002\u60a8\u53ef\u4ee5\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e4b\u4e00\u4e2d\u67e5\u770b\u5176\u5de5\u4f5c\u539f\u7406\u3002</li> <li>\u7ed3\u5408\u7f51\u5173\u914d\u7f6e\u6d41\u91cf\u89c4\u5219\uff0c \u4ee5\u63a7\u5236\u5165\u53e3\u548c\u51fa\u53e3\u6d41\u91cf\u3002</li> </ul> <p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u8fd8\u9700\u8981\u914d\u7f6e\u76ee\u6807\u89c4\u5219\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u529f\u80fd\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u662f\u60a8\u6307\u5b9a\u670d\u52a1\u5b50\u96c6\u7684\u4f4d\u7f6e\u3002\u5728\u5355\u72ec\u7684\u5bf9\u8c61\u4e2d\u6307\u5b9a\u670d\u52a1\u5b50\u96c6\u548c\u5176\u4ed6\u7279\u5b9a\u4e8e\u76ee\u6807\u7684\u7b56\u7565\uff0c\u4f7f\u60a8\u53ef\u4ee5\u5728\u865a\u62df\u670d\u52a1\u4e4b\u95f4\u6e05\u6670\u5730\u91cd\u7528\u5b83\u4eec\u3002\u60a8\u53ef\u4ee5\u5728\u4e0b\u4e00\u90e8\u5206\u4e2d\u627e\u5230\u6709\u5173\u76ee\u6807\u89c4\u5219\u7684\u66f4\u591a\u4fe1\u606f\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#22","title":"2.2 \u865a\u62df\u670d\u52a1\u793a\u4f8b","text":"<p>\u4ee5\u4e0b\u865a\u62df\u670d\u52a1\u6839\u636e\u8bf7\u6c42\u662f\u5426\u6765\u81ea\u7279\u5b9a\u7528\u6237\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u670d\u52a1\u7684\u4e0d\u540c\u7248\u672c\u3002</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n  - reviews\n  http:\n  - match:\n    - headers:\n        end-user:\n          exact: jason\n    route:\n    - destination:\n        host: reviews\n        subset: v2\n  - route:\n    - destination:\n        host: reviews\n        subset: v3\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#221","title":"2.2.1 \u4e3b\u673a\u5b57\u6bb5","text":"<p>\u8be5<code>hosts</code>\u5b57\u6bb5\u5217\u51fa\u4e86\u865a\u62df\u670d\u52a1\u7684\u4e3b\u673a-\u6362\u53e5\u8bdd\u8bf4\uff0c\u8fd9\u4e9b\u8def\u7531\u89c4\u5219\u9002\u7528\u4e8e\u7528\u6237\u53ef\u5bfb\u5740\u7684\u76ee\u7684\u5730\u3002\u8fd9\u662f\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u53d1\u9001\u8bf7\u6c42\u65f6\u4f7f\u7528\u7684\u5730\u5740\u3002</p> <pre><code>hosts:\n- reviews\n</code></pre> <p>\u865a\u62df\u670d\u52a1\u4e3b\u673a\u540d\u53ef\u4ee5\u662fIP\u5730\u5740\uff0cDNS\u540d\u79f0\uff0c\u4e5f\u53ef\u4ee5\u662f\u77ed\u540d\u79f0\uff08\u4f8b\u5982Kubernetes\u670d\u52a1\u77ed\u540d\u79f0\uff09\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u5e73\u53f0\uff0c\u540e\u8005\u53ef\u4ee5\u9690\u5f0f\u6216\u663e\u5f0f\u5730\u89e3\u6790\u4e3a\u5b8c\u5168\u9650\u5b9a\u7684\u57df\u540d\uff08FQDN\uff09\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26\uff08\u201c *\u201d\uff09\u524d\u7f00\uff0c\u4ece\u800c\u4e3a\u6240\u6709\u5339\u914d\u7684\u670d\u52a1\u521b\u5efa\u4e00\u5957\u8def\u7531\u89c4\u5219\u3002\u865a\u62df\u670d\u52a1\u4e3b\u673a\u5b9e\u9645\u4e0a\u4e0d\u4e00\u5b9a\u662fIstio\u670d\u52a1\u6ce8\u518c\u8868\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u4eec\u53ea\u662f\u865a\u62df\u76ee\u7684\u5730\u3002\u8fd9\u6837\uff0c\u60a8\u5c31\u53ef\u4ee5\u4e3a\u7f51\u683c\u5185\u6ca1\u6709\u53ef\u8def\u7531\u6761\u76ee\u7684\u865a\u62df\u4e3b\u673a\u7684\u6d41\u91cf\u5efa\u6a21\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#222","title":"2.2.2 \u8def\u7531\u89c4\u5219","text":"<p>\u672c<code>http</code>\u8282\u5305\u542b\u865a\u62df\u670d\u52a1\u7684\u8def\u7531\u89c4\u5219\uff0c\u63cf\u8ff0\u4e86\u8def\u7531\u53d1\u9001\u5230\u4e3b\u673a\u5b57\u6bb5\u4e2d\u6307\u5b9a\u7684\u76ee\u6807\u7684HTTP / 1.1\uff0cHTTP2\u548cgRPC\u6d41\u91cf\u7684\u5339\u914d\u6761\u4ef6\u548c\u64cd\u4f5c\uff08\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528<code>tcp</code>\u548c <code>tls</code>\u90e8\u5206\u6765\u914d\u7f6eTCP\u7684\u8def\u7531\u89c4\u5219 \u548c\u672a\u7ec8\u6b62\u7684 TLS \u6d41\u91cf\uff09\u3002\u8def\u7531\u89c4\u5219\u7531\u60a8\u5e0c\u671b\u6d41\u91cf\u6d41\u5411\u7684\u76ee\u7684\u5730\u4ee5\u53ca\u96f6\u4e2a\u6216\u591a\u4e2a\u5339\u914d\u6761\u4ef6\u7ec4\u6210\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u60a8\u7684\u7528\u4f8b\u3002</p> <ul> <li>\u5339\u914d\u6761\u4ef6</li> </ul> <p>\u793a\u4f8b\u4e2d\u7684\u7b2c\u4e00\u4e2a\u8def\u7531\u89c4\u5219\u5177\u6709\u6761\u4ef6\uff0c\u56e0\u6b64\u4ece\u8be5<code>match</code>\u5b57\u6bb5\u5f00\u59cb \u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u60f3\u8981\u8fd9\u4e2a\u8def\u7531\u9002\u7528\u4e8e\u4ece\u7528\u6237\u7684\u201c\u6770\u68ee\u201d\u7684\u6240\u6709\u8981\u6c42\uff0c\u8ba9\u4f60\u7528\u7684<code>headers</code>\uff0c<code>end-user</code>\u548c<code>exact</code>\u5b57\u6bb5\u9009\u62e9\u9002\u5f53\u7684\u8bf7\u6c42\u3002</p> <pre><code>- match:\n   - headers:\n       end-user:\n         exact: jason\n</code></pre> <ul> <li>\u76ee\u7684\u5730</li> </ul> <p>\u8def\u7ebf\u90e8\u5206\u7684<code>destination</code>\u5b57\u6bb5\u6307\u5b9a\u7b26\u5408\u6b64\u6761\u4ef6\u7684\u6d41\u91cf\u7684\u5b9e\u9645\u76ee\u7684\u5730\u3002\u4e0e\u865a\u62df\u670d\u52a1\u7684\u4e3b\u673a\u4e0d\u540c\uff0c\u76ee\u7684\u5730\u7684\u4e3b\u673a\u5fc5\u987b\u662fIstio\u7684\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u5b58\u5728\u7684\u771f\u5b9e\u76ee\u7684\u5730\uff0c\u5426\u5219Envoy\u5c06\u4e0d\u77e5\u9053\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u54ea\u91cc\u3002\u8fd9\u53ef\u4ee5\u662f\u5e26\u6709\u4ee3\u7406\u7684\u7f51\u683c\u670d\u52a1\uff0c\u4e5f\u53ef\u4ee5\u662f\u4f7f\u7528\u670d\u52a1\u6761\u76ee\u6dfb\u52a0\u7684\u975e\u7f51\u683c\u670d\u52a1\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5728Kubernetes\u4e0a\u8fd0\u884c\uff0c\u4e3b\u673a\u540d\u662fKubernetes\u670d\u52a1\u540d\uff1a</p> <pre><code>route:\n- destination:\n    host: reviews\n    subset: v2\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u5728\u672c\u9875\u9762\u7684\u8be5\u793a\u4f8b\u548c\u5176\u4ed6\u793a\u4f8b\u4e2d\uff0c\u4e3a\u7b80\u5355\u8d77\u89c1\uff0c\u6211\u4eec\u4f7f\u7528Kubernetes\u77ed\u540d\u79f0\u4f5c\u4e3a\u76ee\u6807\u4e3b\u673a\u3002\u8bc4\u4f30\u6b64\u89c4\u5219\u540e\uff0cIstio\u5c06\u57fa\u4e8e\u865a\u62df\u670d\u52a1\u7684\u540d\u79f0\u7a7a\u95f4\u6dfb\u52a0\u4e00\u4e2a\u57df\u540e\u7f00\uff0c\u8be5\u540d\u79f0\u540e\u7f00\u5305\u542b\u8def\u7531\u89c4\u5219\u4ee5\u83b7\u53d6\u4e3b\u673a\u7684\u6807\u51c6\u540d\u79f0\u3002\u5728\u6211\u4eec\u7684\u793a\u4f8b\u4e2d\u4f7f\u7528\u77ed\u540d\u79f0\u8fd8\u610f\u5473\u7740\u60a8\u53ef\u4ee5\u5728\u4efb\u610f\u559c\u6b22\u7684\u540d\u79f0\u7a7a\u95f4\u4e2d\u590d\u5236\u5e76\u5c1d\u8bd5\u4f7f\u7528\u5b83\u4eec\u3002</p> <p>\u26a0\ufe0f\uff1a\u4ec5\u5f53\u76ee\u6807\u4e3b\u673a\u548c\u865a\u62df\u670d\u52a1\u5b9e\u9645\u4e0a\u5728\u540c\u4e00Kubernetes\u547d\u540d\u7a7a\u95f4\u4e2d\u65f6\uff0c\u624d\u4f7f\u7528\u8fd9\u6837\u7684\u77ed\u540d\u79f0\u3002\u56e0\u4e3a\u4f7f\u7528Kubernetes\u77ed\u540d\u79f0\u53ef\u80fd\u4f1a\u5bfc\u81f4\u914d\u7f6e\u9519\u8bef\uff0c\u6240\u4ee5\u6211\u4eec\u5efa\u8bae\u60a8\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6307\u5b9a\u6807\u51c6\u4e3b\u673a\u540d\u3002</p> <p>Destination\u90e8\u5206\u8fd8\u6307\u5b9a\u8981\u8ba9\u7b26\u5408\u6b64\u89c4\u5219\u6761\u4ef6\u7684\u8bf7\u6c42\u8f6c\u5230\u6b64Kubernetes\u670d\u52a1\u7684\u54ea\u4e2a\u5b50\u96c6\uff0c\u5728\u672c\u4f8b\u4e2d\u4e3a\u540d\u4e3av2\u7684\u5b50\u96c6\u3002\u60a8\u5c06\u5728\u4e0b\u9762\u6709\u5173\u76ee\u6807\u89c4\u5219\u7684\u90e8\u5206\u4e2d\u770b\u5230\u5982\u4f55\u5b9a\u4e49\u670d\u52a1\u5b50\u96c6 \u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#223","title":"2.2.3 \u8def\u7531\u89c4\u5219\u4f18\u5148\u7ea7","text":"<p>\u8def\u7531\u89c4\u5219**\u4ece\u4e0a\u5230\u4e0b\u6309\u987a\u5e8f\u8bc4\u4f30**\uff0c\u5176\u4e2d\u865a\u62df\u670d\u52a1\u5b9a\u4e49\u4e2d\u7684\u7b2c\u4e00\u4e2a\u89c4\u5219\u5177\u6709\u6700\u9ad8\u4f18\u5148\u7ea7\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u5e0c\u671b\u4e0d\u7b26\u5408\u7b2c\u4e00\u4e2a\u8def\u7531\u89c4\u5219\u7684\u6240\u6709\u5185\u5bb9\u90fd\u8f6c\u5230\u7b2c\u4e8c\u4e2a\u89c4\u5219\u4e2d\u6307\u5b9a\u7684\u9ed8\u8ba4\u76ee\u6807\u3002\u56e0\u6b64\uff0c\u7b2c\u4e8c\u6761\u89c4\u5219\u6ca1\u6709\u5339\u914d\u6761\u4ef6\uff0c\u4ec5\u5c06\u6d41\u91cf\u5b9a\u5411\u5230v3\u5b50\u96c6\u3002</p> <pre><code>- route:\n  - destination:\n      host: reviews\n      subset: v3\n</code></pre> <p>\u6211\u4eec\u5efa\u8bae\u5728\u6bcf\u4e2a\u865a\u62df\u670d\u52a1\u4e2d\u63d0\u4f9b\u9ed8\u8ba4\u7684\u201c\u65e0\u6761\u4ef6\u201d\u6216\u57fa\u4e8e\u6743\u91cd\u7684\u89c4\u5219\uff08\u5982\u4e0b\u6240\u8ff0\uff09\u4f5c\u4e3a\u6bcf\u4e2a\u865a\u62df\u670d\u52a1\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u89c4\u5219\uff0c\u4ee5\u786e\u4fdd\u5230\u865a\u62df\u670d\u52a1\u7684\u6d41\u91cf\u59cb\u7ec8\u5177\u6709\u81f3\u5c11\u4e00\u6761\u5339\u914d\u7684\u8def\u7531\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#23","title":"2.3 \u8def\u7531\u89c4\u5219\u66f4\u591a\u4fe1\u606f","text":"<p>\u5982\u4e0a\u6240\u8ff0\uff0c\u8def\u7531\u89c4\u5219\u662f\u5c06\u6d41\u91cf\u7684\u7279\u5b9a\u5b50\u96c6\u8def\u7531\u5230\u7279\u5b9a\u76ee\u7684\u5730\u7684\u5f3a\u5927\u5de5\u5177\u3002\u60a8\u53ef\u4ee5\u5728\u6d41\u91cf\u7aef\u53e3\uff0c\u6807\u5934\u5b57\u6bb5\uff0cURI\u7b49\u4e0a\u8bbe\u7f6e\u5339\u914d\u6761\u4ef6\u3002\u4f8b\u5982\uff0c\u6b64\u865a\u62df\u670d\u52a1\u4f7f\u7528\u6237\u53ef\u4ee5\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u4e24\u4e2a\u5355\u72ec\u7684\u670d\u52a1\uff08\u8bc4\u7ea7\u548c\u8bc4\u8bba\uff09\uff0c\u5c31\u50cf\u4ed6\u4eec\u662f\u8f83\u5927\u865a\u62df\u670d\u52a1\u7684\u4e00\u90e8\u5206\u4e00\u6837\u3002<code>http://bookinfo.com/.</code>\u865a\u62df\u670d\u52a1\u89c4\u5219\u6839\u636e\u8bf7\u6c42URI\u5339\u914d\u6d41\u91cf\uff0c\u5e76\u5c06\u8bf7\u6c42\u5b9a\u5411\u5230\u9002\u5f53\u7684\u670d\u52a1\u3002</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: bookinfo\nspec:\n  hosts:\n    - bookinfo.com\n  http:\n  - match:\n    - uri:\n        prefix: /reviews\n    route:\n    - destination:\n        host: reviews\n  - match:\n    - uri:\n        prefix: /ratings\n    route:\n    - destination:\n        host: ratings\n...\n\n  http:\n  - match:\n      sourceLabels:\n        app: reviews\n    route:\n...\n</code></pre> <p>\u5bf9\u4e8e\u67d0\u4e9b\u5339\u914d\u6761\u4ef6\uff0c\u60a8\u8fd8\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528\u7cbe\u786e\u503c\uff0c\u524d\u7f00\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u9009\u62e9\u5b83\u4eec\u3002</p> <p>\u60a8\u53ef\u4ee5\u5c06\u591a\u4e2a\u5339\u914d\u6761\u4ef6\u6dfb\u52a0<code>match</code>\u5230\u4e0e\u60a8\u7684\u6761\u4ef6\u76f8\u540c\u7684\u5757\uff0c\u6216\u8005\u5c06\u591a\u4e2a\u5339\u914d\u6761\u4ef6\u6dfb\u52a0\u5230\u4e0e\u60a8\u7684\u6761\u4ef6\u76f8\u540c\u7684\u89c4\u5219\u3002\u5bf9\u4e8e\u4efb\u4f55\u7ed9\u5b9a\u7684\u865a\u62df\u670d\u52a1\uff0c\u60a8\u8fd8\u53ef\u4ee5\u5177\u6709\u591a\u4e2a\u8def\u7531\u89c4\u5219\u3002\u8fd9\u6837\uff0c\u60a8\u5c31\u53ef\u4ee5\u5728\u5355\u4e2a\u865a\u62df\u670d\u52a1\u4e2d\u6839\u636e\u81ea\u5df1\u7684\u559c\u597d\u4f7f\u8def\u7531\u6761\u4ef6\u53d8\u5f97\u590d\u6742\u6216\u7b80\u5355\u3002\u5339\u914d\u6761\u4ef6\u5b57\u6bb5\u53ca\u5176\u53ef\u80fd\u503c\u7684\u5b8c\u6574\u5217\u8868\u53ef\u4ee5\u5728<code>HTTPMatchRequest</code>\u53c2\u8003\u8d44\u6599\u4e2d\u627e\u5230 \u3002</p> <p>\u9664\u4e86\u4f7f\u7528\u5339\u914d\u6761\u4ef6\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u6309\u767e\u5206\u6bd4\u201c\u6743\u91cd\u201d\u5206\u914d\u6d41\u91cf\u3002\u8fd9\u5bf9\u4e8eA / B\u6d4b\u8bd5\u548cCanary\u63a8\u51fa\u5f88\u6709\u7528\uff1a</p> <p>\u26a0\ufe0f\uff1a\u5339\u914durl\u89c4\u5219\u53ef\u4ee5\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u7684\u670d\u52a1\uff0c\u6309\u767e\u5206\u6bd4\u201c\u6743\u91cd\u201d\u53ef\u4ee5\u533a\u5206\u5f62\u540c\u670d\u52a1\u7684\u591a\u4e2a\u7248\u672c</p> <pre><code>spec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v1\n      weight: 75\n    - destination:\n        host: reviews\n        subset: v2\n      weight: 25\n</code></pre> <p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u8def\u7531\u89c4\u5219\u5bf9\u6d41\u91cf\u6267\u884c\u4e00\u4e9b\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u9644\u52a0\u6216\u5220\u9664\u6807\u9898\u3002</li> <li>\u91cd\u5199URL\u3002</li> <li>\u4e3a\u8be5\u76ee\u7684\u5730\u7684\u547c\u53eb\u8bbe\u7f6e\u91cd\u8bd5\u7b56\u7565\u3002</li> </ul> <p>\u8981\u4e86\u89e3\u6709\u5173\u53ef\u7528\u64cd\u4f5c\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 <code>HTTPRoute</code>\u53c2\u8003\u8d44\u6599\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#destination-rules","title":"\u4e09 Destination rules","text":"<p>\u4e0e\u865a\u62df\u670d\u52a1\u4e00\u8d77\uff0c \u76ee\u7684\u5730\u89c4\u5219 \u662fIstio\u6d41\u91cf\u8def\u7531\u529f\u80fd\u7684\u5173\u952e\u90e8\u5206\u3002\u4f60\u80fd\u60f3\u5230\u7684\u865a\u62df\u670d\u52a1\uff0c\u5982\u4f55\u60a8\u5c06\u81ea\u5df1\u7684\u6d41\u91cf**\u5230**\u4f60\u6307\u5b9a\u7684\u76ee\u7684\u5730\uff0c\u7136\u540e\u7528\u76ee\u7684\u5730\u89c4\u5219\u6765\u914d\u7f6e\u53d1\u751f\u4e86\u4ec0\u4e48\u6d41\u91cf**\u4e3a**\u90a3\u4e2a\u76ee\u7684\u5730\u3002\u5728\u8bc4\u4f30\u4e86\u865a\u62df\u670d\u52a1\u8def\u7531\u89c4\u5219\u4e4b\u540e\uff0c\u5c06\u5e94\u7528\u76ee\u6807\u89c4\u5219\uff0c\u56e0\u6b64\u5b83\u4eec\u5c06\u5e94\u7528\u4e8e\u6d41\u91cf\u7684\u201c\u771f\u5b9e\u201d\u76ee\u6807\u3002</p> <p>\u7279\u522b\u662f\uff0c\u60a8\u4f7f\u7528\u76ee\u6807\u89c4\u5219\u6765\u6307\u5b9a\u547d\u540d\u7684\u670d\u52a1\u5b50\u96c6\uff0c\u4f8b\u5982\u6309\u7248\u672c\u5bf9\u6240\u6709\u7ed9\u5b9a\u670d\u52a1\u7684\u5b9e\u4f8b\u8fdb\u884c\u5206\u7ec4\u3002\u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u5728\u865a\u62df\u670d\u52a1\u7684\u8def\u7531\u89c4\u5219\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u670d\u52a1\u5b50\u96c6\uff0c\u4ee5\u63a7\u5236\u6d41\u5411\u670d\u52a1\u7684\u4e0d\u540c\u5b9e\u4f8b\u7684\u6d41\u91cf\u3002</p> <p>\u76ee\u6807\u89c4\u5219\u8fd8\u5141\u8bb8\u60a8\u5728\u8c03\u7528\u6574\u4e2a\u76ee\u6807\u670d\u52a1\u6216\u7279\u5b9a\u670d\u52a1\u5b50\u96c6\u65f6\u81ea\u5b9a\u4e49Envoy\u7684\u6d41\u91cf\u7b56\u7565\uff0c\u4f8b\u5982\u9996\u9009\u7684\u8d1f\u8f7d\u5e73\u8861\u6a21\u578b\uff0cTLS\u5b89\u5168\u6a21\u5f0f\u6216\u65ad\u8def\u5668\u8bbe\u7f6e\u3002\u60a8\u53ef\u4ee5\u5728\u201c \u76ee\u6807\u89c4\u5219\u201d\u53c2\u8003\u4e2d\u770b\u5230\u76ee\u6807\u89c4\u5219\u9009\u9879\u7684\u5b8c\u6574\u5217\u8868 \u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#31","title":"3.1 \u8d1f\u8f7d\u5747\u8861\u5668\u9009\u9879","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cIstio\u4f7f\u7528\u5faa\u73af\u8d1f\u8f7d\u5e73\u8861\u7b56\u7565\uff0c\u5176\u4e2d\u5b9e\u4f8b\u6c60\u4e2d\u7684\u6bcf\u4e2a\u670d\u52a1\u5b9e\u4f8b\u4f9d\u6b21\u83b7\u5f97\u4e00\u4e2a\u8bf7\u6c42\u3002Istio\u8fd8\u652f\u6301\u4ee5\u4e0b\u6a21\u578b\uff0c\u60a8\u53ef\u4ee5\u5728\u76ee\u6807\u89c4\u5219\u4e2d\u4e3a\u5bf9\u7279\u5b9a\u670d\u52a1\u6216\u670d\u52a1\u5b50\u96c6\u7684\u8bf7\u6c42\u6307\u5b9a\u8fd9\u4e9b\u6a21\u578b\u3002</p> <ul> <li>\u968f\u673a\uff1a\u5c06\u8bf7\u6c42\u968f\u673a\u8f6c\u53d1\u5230\u6c60\u4e2d\u7684\u5b9e\u4f8b\u3002</li> <li>\u52a0\u6743\uff1a\u6839\u636e\u7279\u5b9a\u767e\u5206\u6bd4\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u6c60\u4e2d\u7684\u5b9e\u4f8b\u3002</li> <li>\u6700\u5c11\u8bf7\u6c42\uff1a\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u8bf7\u6c42\u6570\u91cf\u6700\u5c11\u7684\u5b9e\u4f8b\u3002</li> </ul> <p>\u6709\u5173\u6bcf\u4e2a\u9009\u9879\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Envoy\u8d1f\u8f7d\u5e73\u8861\u6587\u6863\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#32","title":"3.2 \u76ee\u6807\u89c4\u5219\u793a\u4f8b","text":"<p>\u4ee5\u4e0b\u793a\u4f8b\u76ee\u6807\u89c4\u5219<code>my-svc</code>\u4f7f\u7528\u4e0d\u540c\u7684\u8d1f\u8f7d\u5e73\u8861\u7b56\u7565\u4e3a\u76ee\u6807\u670d\u52a1\u914d\u7f6e\u4e86\u4e09\u4e2a\u4e0d\u540c\u7684\u5b50\u96c6\uff1a</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: my-destination-rule\nspec:\n  host: my-svc\n  trafficPolicy:\n    loadBalancer:\n      simple: RANDOM\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n  - name: v2\n    labels:\n      version: v2\n    trafficPolicy:\n      loadBalancer:\n        simple: ROUND_ROBIN\n  - name: v3\n    labels:\n      version: v3\n</code></pre> <p>\u6bcf\u4e2a\u5b50\u96c6\u90fd\u662f\u57fa\u4e8e\u4e00\u4e2a\u6216\u591a\u4e2a\u5b9a\u4e49\u7684<code>labels</code>\uff0c\u5728Kubernetes\u4e2d\uff0c\u8fd9\u4e9b\u5b50\u96c6\u662f\u9644\u52a0\u5230\u5bf9\u8c61\uff08\u4f8b\u5982Pod\uff09\u7684\u952e/\u503c\u5bf9\u3002\u8fd9\u4e9b\u6807\u7b7e\u5c06\u5e94\u7528\u4e8eKubernetes\u670d\u52a1\u7684\u90e8\u7f72\u4e2d<code>metadata</code>\u4ee5\u6807\u8bc6\u4e0d\u540c\u7684\u7248\u672c\u3002</p> <p>\u9664\u4e86\u5b9a\u4e49\u5b50\u96c6\u5916\uff0c\u6b64\u76ee\u6807\u89c4\u5219\u8fd8\u5177\u6709\u9488\u5bf9\u6b64\u76ee\u6807\u4e2d\u6240\u6709\u5b50\u96c6\u7684\u9ed8\u8ba4\u6d41\u91cf\u7b56\u7565\uff0c\u4ee5\u53ca\u9488\u5bf9\u8be5\u5b50\u96c6\u8986\u76d6\u8be5\u5b50\u96c6\u7684\u7279\u5b9a\u4e8e\u5b50\u96c6\u7684\u7b56\u7565\u3002\u5728\u8be5<code>subsets</code> \u5b57\u6bb5\u4e0a\u65b9\u5b9a\u4e49\u7684\u9ed8\u8ba4\u7b56\u7565\u4e3a<code>v1</code>\u548c<code>v3</code>\u5b50\u96c6\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u968f\u673a\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u5728\u8be5 <code>v2</code>\u7b56\u7565\u4e2d\uff0c\u5728\u76f8\u5e94\u5b50\u96c6\u7684\u5b57\u6bb5\u4e2d\u6307\u5b9a\u4e86\u5faa\u73af\u8d1f\u8f7d\u5747\u8861\u5668\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#gateways","title":"\u56db Gateways","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u7f51\u5173\u6765\u7ba1\u7406\u7f51\u683c\u7684\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\uff0c\u8ba9\u60a8\u6307\u5b9a\u8981\u8f93\u5165\u6216\u79bb\u5f00\u7f51\u683c\u7684\u6d41\u91cf\u3002\u7f51\u5173\u914d\u7f6e\u9002\u7528\u4e8e\u5728\u7f51\u683c\u8fb9\u7f18\u8fd0\u884c\u7684\u72ec\u7acbEnvoy\u4ee3\u7406\uff0c\u800c\u4e0d\u662f\u4e0e\u670d\u52a1\u5de5\u4f5c\u8d1f\u8f7d\u4e00\u8d77\u8fd0\u884c\u7684sidecar Envoy\u4ee3\u7406\u3002</p> <p>\u4e0e\u5176\u4ed6\u63a7\u5236\u8fdb\u5165\u7cfb\u7edf\u7684\u6d41\u91cf\u7684\u673a\u5236\uff08\u4f8b\u5982Kubernetes Ingress API\uff09\u4e0d\u540c\uff0cIstio\u7f51\u5173\u4f7f\u60a8\u53ef\u4ee5\u5145\u5206\u5229\u7528Istio\u6d41\u91cf\u8def\u7531\u7684\u529f\u80fd\u548c\u7075\u6d3b\u6027\u3002\u60a8\u53ef\u4ee5\u6267\u884c\u6b64\u64cd\u4f5c\uff0c\u56e0\u4e3aIstio\u7684\u7f51\u5173\u8d44\u6e90\u4ec5\u5141\u8bb8\u60a8\u914d\u7f6e4-6\u5c42\u8d1f\u8f7d\u5e73\u8861\u5c5e\u6027\uff0c\u4f8b\u5982\u8981\u516c\u5f00\u7684\u7aef\u53e3\uff0cTLS\u8bbe\u7f6e\u7b49\u3002\u7136\u540e\uff0c\u60a8\u6ca1\u6709\u5c06\u5e94\u7528\u7a0b\u5e8f\u5c42\u6d41\u91cf\u8def\u7531\uff08L7\uff09\u6dfb\u52a0\u5230\u76f8\u540c\u7684API\u8d44\u6e90\uff0c\u800c\u662f\u5c06\u5e38\u89c4Istio \u865a\u62df\u670d\u52a1\u7ed1\u5b9a\u5230\u7f51\u5173\u3002\u8fd9\u6837\uff0c\u60a8\u5c31\u53ef\u4ee5\u50cf\u7ba1\u7406Istio\u7f51\u683c\u4e2d\u7684\u4efb\u4f55\u5176\u4ed6\u6570\u636e\u5e73\u9762\u6d41\u91cf\u4e00\u6837\uff0c\u57fa\u672c\u4e0a\u7ba1\u7406\u7f51\u5173\u6d41\u91cf\u3002</p> <p>\u7f51\u5173\u4e3b\u8981\u7528\u4e8e\u7ba1\u7406\u5165\u53e3\u6d41\u91cf\uff0c\u4f46\u662f\u60a8\u4e5f\u53ef\u4ee5\u914d\u7f6e\u51fa\u53e3\u7f51\u5173\u3002\u51fa\u53e3\u7f51\u5173\u4f7f\u60a8\u53ef\u4ee5\u4e3a\u79bb\u5f00\u7f51\u72b6\u7f51\u7edc\u7684\u6d41\u91cf\u914d\u7f6e\u4e13\u7528\u7684\u51fa\u53e3\u8282\u70b9\uff0c\u4ece\u800c\u9650\u5236\u53ef\u4ee5\u6216\u5e94\u8be5\u8bbf\u95ee\u5916\u90e8\u7f51\u7edc\u7684\u670d\u52a1\uff0c\u6216\u8005\u542f\u7528 \u5bf9\u51fa\u53e3\u6d41\u91cf\u7684\u5b89\u5168\u63a7\u5236 \u4ee5\u589e\u52a0\u7f51\u72b6\u7f51\u7edc\u7684\u5b89\u5168\u6027\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u7f51\u5173\u6765\u914d\u7f6e\u7eaf\u5185\u90e8\u4ee3\u7406\u3002</p> <p>Istio\u63d0\u4f9b\u4e86\u4e00\u4e9b\u53ef\u4ee5\u9884\u914d\u7f6e\u7684\u7f51\u5173\u4ee3\u7406\u90e8\u7f72\uff08<code>istio-ingressgateway</code>\u548c<code>istio-egressgateway</code>\uff09\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528-\u5982\u679c\u60a8\u4f7f\u7528\u6211\u4eec\u7684\u6f14\u793a\u5b89\u88c5\uff0c\u5219\u4e24\u8005\u90fd\u5c06\u90e8\u7f72\uff0c\u800c\u53ea\u6709\u5165\u53e3\u7f51\u5173\u5c06\u4f7f\u7528\u6211\u4eec\u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u6216sds\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u90e8\u7f72 \u3002\u60a8\u53ef\u4ee5\u5c06\u81ea\u5df1\u7684\u7f51\u5173\u914d\u7f6e\u5e94\u7528\u4e8e\u8fd9\u4e9b\u90e8\u7f72\uff0c\u4e5f\u53ef\u4ee5\u90e8\u7f72\u548c\u914d\u7f6e\u81ea\u5df1\u7684\u7f51\u5173\u4ee3\u7406\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#41","title":"4.1 \u7f51\u5173\u793a\u4f8b","text":"<p>\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\u4e86\u7528\u4e8e\u5916\u90e8HTTPS\u5165\u53e3\u6d41\u91cf\u7684\u53ef\u80fd\u7f51\u5173\u914d\u7f6e\uff1a</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: ext-host-gwy\nspec:\n  selector:\n    app: my-gateway-controller\n  servers:\n  - port:\n      number: 443\n      name: https\n      protocol: HTTPS\n    hosts:\n    - ext-host.example.com\n    tls:\n      mode: SIMPLE\n      serverCertificate: /tmp/tls.crt\n      privateKey: /tmp/tls.key\n</code></pre> <p>\u6b64\u7f51\u5173\u914d\u7f6e\u5141\u8bb8HTTPS\u6d41\u91cf<code>ext-host.example.com</code>\u8fdb\u5165\u7aef\u53e3443\u4e0a\u7684\u7f51\u683c\uff0c\u4f46\u4e0d\u4e3a\u8be5\u6d41\u91cf\u6307\u5b9a\u4efb\u4f55\u8def\u7531\u3002</p> <p>\u8981\u6307\u5b9a\u8def\u7531\u5e76\u4f7f\u7f51\u5173\u6309\u9884\u671f\u5de5\u4f5c\uff0c\u60a8\u8fd8\u5fc5\u987b\u5c06\u7f51\u5173\u7ed1\u5b9a\u5230\u865a\u62df\u670d\u52a1\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u865a\u62df\u670d\u52a1\u7684<code>gateways</code>\u5b57\u6bb5\u6765\u6267\u884c\u6b64\u64cd\u4f5c \uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: virtual-svc\nspec:\n  hosts:\n  - ext-host.example.com\n  gateways:\n    - ext-host-gwy\n</code></pre> <p>\u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5916\u90e8\u6d41\u91cf\u7684\u8def\u7531\u89c4\u5219\u914d\u7f6e\u865a\u62df\u670d\u52a1\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#service-entries","title":"\u4e94 Service entries","text":"<p>\u60a8\u4f7f\u7528 \u670d\u52a1\u6761\u76ee\u5c06\u6761\u76ee\u6dfb\u52a0\u5230Istio\u5185\u90e8\u7ef4\u62a4\u7684\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\u3002\u6dfb\u52a0\u670d\u52a1\u6761\u76ee\u540e\uff0cEnvoy\u4ee3\u7406\u53ef\u4ee5\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u670d\u52a1\uff0c\u5c31\u597d\u50cf\u5b83\u662f\u7f51\u683c\u4e2d\u7684\u670d\u52a1\u4e00\u6837\u3002\u901a\u8fc7\u914d\u7f6e\u670d\u52a1\u6761\u76ee\uff0c\u60a8\u53ef\u4ee5\u7ba1\u7406\u5728\u7f51\u683c\u5916\u90e8\u8fd0\u884c\u7684\u670d\u52a1\u7684\u6d41\u91cf\uff0c\u5305\u62ec\u4ee5\u4e0b\u4efb\u52a1\uff1a</p> <ul> <li>\u91cd\u5b9a\u5411\u548c\u8f6c\u53d1\u5916\u90e8\u76ee\u6807\u7684\u6d41\u91cf\uff0c\u4f8b\u5982\u4ece\u7f51\u7edc\u4f7f\u7528\u7684API\u6216\u65e7\u57fa\u7840\u7ed3\u6784\u4e2d\u670d\u52a1\u7684\u6d41\u91cf\u3002</li> <li>\u4e3a\u5916\u90e8\u76ee\u6807\u5b9a\u4e49\u91cd\u8bd5\uff0c\u8d85\u65f6\u548c \u6545\u969c\u6ce8\u5165\u7b56\u7565\u3002</li> <li>\u5c06\u5728\u865a\u62df\u673a\uff08VM\uff09\u4e2d\u8fd0\u884c\u7684\u670d\u52a1\u6dfb\u52a0\u5230\u7f51\u683c\u4ee5 \u6269\u5c55\u7f51\u683c\u3002</li> <li>\u5728\u903b\u8f91\u4e0a\u5c06\u6765\u81ea\u5176\u4ed6\u7fa4\u96c6\u7684\u670d\u52a1\u6dfb\u52a0\u5230\u7f51\u683c\uff0c\u4ee5 \u5728Kubernetes\u4e0a\u914d\u7f6e \u591a\u7fa4\u96c6Istio\u7f51\u683c\u3002</li> </ul> <p>\u60a8\u4e0d\u9700\u8981\u4e3a\u8981\u4f7f\u7528\u7f51\u683c\u670d\u52a1\u7684\u6bcf\u4e2a\u5916\u90e8\u670d\u52a1\u6dfb\u52a0\u670d\u52a1\u6761\u76ee\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cIstio\u5c06Envoy\u4ee3\u7406\u914d\u7f6e\u4e3a\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u672a\u77e5\u670d\u52a1\u3002\u4f46\u662f\uff0c\u60a8\u4e0d\u80fd\u4f7f\u7528Istio\u529f\u80fd\u6765\u63a7\u5236\u6d41\u5411\u672a\u5728\u7f51\u683c\u4e2d\u6ce8\u518c\u7684\u76ee\u6807\u7684\u6d41\u91cf\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#51","title":"5.1 \u670d\u52a1\u8f93\u5165\u793a\u4f8b","text":"<p>\u4ee5\u4e0b\u793a\u4f8bmesh-external\u670d\u52a1\u6761\u76ee\u5c06<code>ext-resource</code> \u5916\u90e8\u4f9d\u8d56\u9879\u6dfb\u52a0\u5230Istio\u7684\u670d\u52a1\u6ce8\u518c\u8868\u4e2d\uff1a</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: ServiceEntry\nmetadata:\n  name: svc-entry\nspec:\n  hosts:\n  - ext-svc.example.com\n  ports:\n  - number: 443\n    name: https\n    protocol: HTTPS\n  location: MESH_EXTERNAL\n  resolution: DNS\n</code></pre> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u8be5<code>hosts</code>\u5b57\u6bb5\u6307\u5b9a\u5916\u90e8\u8d44\u6e90\u3002\u60a8\u53ef\u4ee5\u5b8c\u5168\u9650\u5b9a\u5b83\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5e26\u901a\u914d\u7b26\u524d\u7f00\u7684\u57df\u540d\u3002</p> <p>\u60a8\u53ef\u4ee5\u914d\u7f6e\u865a\u62df\u670d\u52a1\u548c\u76ee\u6807\u89c4\u5219\uff0c\u4ee5\u66f4\u7cbe\u7ec6\u7684\u65b9\u5f0f\u63a7\u5236\u5230\u670d\u52a1\u6761\u76ee\u7684\u6d41\u91cf\uff0c\u5c31\u50cf\u4e3a\u7f51\u683c\u4e2d\u7684\u5176\u4ed6\u4efb\u4f55\u670d\u52a1\u914d\u7f6e\u6d41\u91cf\u4e00\u6837\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u76ee\u6807\u89c4\u5219\u5c06\u6d41\u91cf\u8def\u7531\u914d\u7f6e\u4e3a\u4f7f\u7528\u53cc\u5411TLS\u6765\u4fdd\u62a4\u4e0e<code>ext-svc.example.com</code>\u6211\u4eec\u4f7f\u7528\u670d\u52a1\u6761\u76ee\u914d\u7f6e\u7684\u5916\u90e8\u670d\u52a1\u7684\u8fde\u63a5 \uff1a</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: ext-res-dr\nspec:\n  host: ext-svc.example.com\n  trafficPolicy:\n    tls:\n      mode: MUTUAL\n      clientCertificate: /etc/certs/myclientcert.pem\n      privateKey: /etc/certs/client_private_key.pem\n      caCertificates: /etc/certs/rootcacerts.pem\n</code></pre> <p>\u6709\u5173 \u66f4\u591a\u53ef\u80fd\u7684\u914d\u7f6e\u9009\u9879\uff0c\u8bf7\u53c2\u9605 \u670d\u52a1\u6761\u76ee\u53c2\u8003\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#sidecars","title":"\u516d Sidecars","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cIstio\u5c06\u6bcf\u4e2aEnvoy\u4ee3\u7406\u914d\u7f6e\u4e3a\u5728\u5176\u76f8\u5173\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6240\u6709\u7aef\u53e3\u4e0a\u63a5\u53d7\u6d41\u91cf\uff0c\u5e76\u5728\u8f6c\u53d1\u6d41\u91cf\u65f6\u5230\u8fbe\u7f51\u683c\u4e2d\u7684\u6bcf\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528sidecar\u914d\u7f6e\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ul> <li>\u5fae\u8c03Envoy\u4ee3\u7406\u63a5\u53d7\u7684\u7aef\u53e3\u548c\u534f\u8bae\u96c6\u3002</li> <li>\u9650\u5236Envoy\u4ee3\u7406\u53ef\u4ee5\u8bbf\u95ee\u7684\u670d\u52a1\u96c6\u3002</li> </ul> <p>\u5728\u5927\u578b\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u50cf\u8fd9\u6837\u9650\u5236Sidecar\u7684\u53ef\u8fbe\u6027\uff0c\u5728\u8be5\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u5c06\u6bcf\u4e2a\u4ee3\u7406\u914d\u7f6e\u4e3a\u53ef\u8bbf\u95ee\u7f51\u683c\u4e2d\u7684\u6240\u6709\u5176\u4ed6\u670d\u52a1\u53ef\u80fd\u4f1a\u7531\u4e8e\u5185\u5b58\u4f7f\u7528\u7387\u8f83\u9ad8\u800c\u6f5c\u5728\u5730\u5f71\u54cd\u7f51\u683c\u6027\u80fd\u3002</p> <p>\u60a8\u53ef\u4ee5\u6307\u5b9a\u5e0c\u671b\u5c06sidecar\u914d\u7f6e\u5e94\u7528\u4e8e\u7279\u5b9a\u540d\u79f0\u7a7a\u95f4\u4e2d\u7684\u6240\u6709\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u6216\u4f7f\u7528\u6765\u9009\u62e9\u7279\u5b9a\u5de5\u4f5c\u8d1f\u8f7d <code>workloadSelector</code>\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0bsidecar\u914d\u7f6e\u5c06<code>bookinfo</code>\u540d\u79f0\u7a7a\u95f4\u4e2d\u7684\u6240\u6709\u670d\u52a1\u914d\u7f6e\u4e3a\u4ec5\u8bbf\u95ee\u5728\u76f8\u540c\u540d\u79f0\u7a7a\u95f4\u548cIstio\u63a7\u5236\u5e73\u9762\uff08\u5f53\u524d\u9700\u8981\u4f7f\u7528Istio\u7684\u7b56\u7565\u548c\u9065\u6d4b\u529f\u80fd\uff09\u4e2d\u8fd0\u884c\u7684\u670d\u52a1\uff1a</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: Sidecar\nmetadata:\n  name: default\n  namespace: bookinfo\nspec:\n  egress:\n  - hosts:\n    - \"./*\"\n    - \"istio-system/*\"\n</code></pre> <p>\u6709\u5173 \u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1Sidecar\u53c2\u8003\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#network-resilience-and-testing","title":"\u4e03 Network resilience and testing","text":"<p>\u9664\u4e86\u5e2e\u52a9\u60a8\u5f15\u5bfc\u7f51\u7edc\u4e2d\u7684\u6d41\u91cf\u5916\uff0cIstio\u8fd8\u63d0\u4f9b\u4e86\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u914d\u7f6e\u7684\u53ef\u9009\u6545\u969c\u6062\u590d\u548c\u6545\u969c\u6ce8\u5165\u529f\u80fd\u3002\u4f7f\u7528\u8fd9\u4e9b\u529f\u80fd\u53ef\u4ee5\u5e2e\u52a9\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u9760\u5730\u8fd0\u884c\uff0c\u786e\u4fdd\u670d\u52a1\u7f51\u683c\u53ef\u4ee5\u5bb9\u5fcd\u51fa\u73b0\u6545\u969c\u7684\u8282\u70b9\uff0c\u5e76\u9632\u6b62\u5c40\u90e8\u6545\u969c\u7ea7\u8054\u5230\u5176\u4ed6\u8282\u70b9\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#71-timeouts","title":"7.1 Timeouts","text":"<p>\u8d85\u65f6\u662fEnvoy\u4ee3\u7406\u5e94\u7b49\u5f85\u6765\u81ea\u7ed9\u5b9a\u670d\u52a1\u7684\u7b54\u590d\u7684\u65f6\u95f4\uff0c\u4ee5\u786e\u4fdd\u670d\u52a1\u4e0d\u4f1a\u65e0\u9650\u671f\u5730\u7b49\u5f85\u7b54\u590d\uff0c\u5e76\u786e\u4fdd\u547c\u53eb\u5728\u53ef\u9884\u6d4b\u7684\u65f6\u95f4\u5185\u6210\u529f\u6216\u5931\u8d25\u3002HTTP\u8bf7\u6c42\u7684\u9ed8\u8ba4\u8d85\u65f6\u4e3a15\u79d2\uff0c\u8fd9\u610f\u5473\u7740\u5982\u679c\u670d\u52a1\u572815\u79d2\u5185\u672a\u54cd\u5e94\uff0c\u5219\u8c03\u7528\u5c06\u5931\u8d25\u3002</p> <p>\u5bf9\u4e8e\u67d0\u4e9b\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\uff0cIstio\u7684\u9ed8\u8ba4\u8d85\u65f6\u53ef\u80fd\u4e0d\u5408\u9002\u3002\u4f8b\u5982\uff0c\u8d85\u65f6\u65f6\u95f4\u8fc7\u957f\u53ef\u80fd\u5bfc\u81f4\u7b49\u5f85\u5931\u8d25\u670d\u52a1\u7684\u56de\u590d\u5bfc\u81f4\u8fc7\u591a\u7684\u5ef6\u8fdf\uff0c\u800c\u8d85\u65f6\u65f6\u95f4\u8fc7\u77ed\u53ef\u80fd\u5bfc\u81f4\u5728\u7b49\u5f85\u6d89\u53ca\u591a\u4e2a\u670d\u52a1\u7684\u64cd\u4f5c\u8fd4\u56de\u65f6\u547c\u53eb\u4e0d\u5fc5\u8981\u5730\u5931\u8d25\u3002\u4e3a\u4e86\u67e5\u627e\u548c\u4f7f\u7528\u6700\u4f73\u8d85\u65f6\u8bbe\u7f6e\uff0cIstio\u4f7f\u60a8\u53ef\u4ee5\u4f7f\u7528\u865a\u62df\u670d\u52a1\u8f7b\u677e\u5730\u57fa\u4e8e\u865a\u62df\u670d\u52a1\u6309\u670d\u52a1\u52a8\u6001\u8c03\u6574\u8d85\u65f6\uff0c\u800c\u65e0\u9700\u7f16\u8f91\u670d\u52a1\u4ee3\u7801\u3002\u8fd9\u662f\u4e00\u4e2a\u865a\u62df\u670d\u52a1\uff0c\u5b83\u4e3a\u8bc4\u7ea7\u670d\u52a1\u7684v1\u5b50\u96c6\u7684\u8c03\u7528\u6307\u5b9a\u4e8610\u79d2\u7684\u8d85\u65f6\u65f6\u95f4\uff1a</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - route:\n    - destination:\n        host: ratings\n        subset: v1\n    timeout: 10s\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#72-retries","title":"7.2 Retries","text":"<p>\u91cd\u8bd5\u8bbe\u7f6e\u6307\u5b9a\u5982\u679c\u521d\u59cb\u8c03\u7528\u5931\u8d25\uff0cEnvoy\u4ee3\u7406\u5c1d\u8bd5\u8fde\u63a5\u5230\u670d\u52a1\u7684\u6700\u5927\u6b21\u6570\u3002\u91cd\u8bd5\u53ef\u4ee5\u786e\u4fdd\u4e0d\u4f1a\u56e0\u6682\u65f6\u6027\u95ee\u9898\uff08\u4f8b\u5982\u670d\u52a1\u6216\u7f51\u7edc\u6682\u65f6\u8fc7\u8f7d\uff09\u800c\u5bfc\u81f4\u547c\u53eb\u6c38\u4e45\u5931\u8d25\uff0c\u4ece\u800c\u63d0\u9ad8\u670d\u52a1\u53ef\u7528\u6027\u548c\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u3002\u91cd\u8bd5\u4e4b\u95f4\u7684\u95f4\u9694\uff0825ms +\uff09\u662f\u53ef\u53d8\u7684\uff0c\u5e76\u7531Istio\u81ea\u52a8\u786e\u5b9a\uff0c\u4ee5\u9632\u6b62\u88ab\u8c03\u7528\u7684\u670d\u52a1\u88ab\u8bf7\u6c42\u6240\u6df9\u6ca1\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cEnvoy\u4ee3\u7406\u5728\u7b2c\u4e00\u6b21\u5931\u8d25\u540e\u4e0d\u5c1d\u8bd5\u91cd\u65b0\u8fde\u63a5\u5230\u670d\u52a1\u3002</p> <p>\u50cf\u8d85\u65f6\u4e00\u6837\uff0cIstio\u7684\u9ed8\u8ba4\u91cd\u8bd5\u884c\u4e3a\u5728\u5ef6\u8fdf\uff08\u5bf9\u5931\u8d25\u7684\u670d\u52a1\u8fdb\u884c\u8fc7\u591a\u7684\u91cd\u8bd5\u4f1a\u964d\u4f4e\u901f\u5ea6\uff09\u6216\u53ef\u7528\u6027\u65b9\u9762\u53ef\u80fd\u4e0d\u9002\u5408\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u6c42\u3002\u4e0e\u8d85\u65f6\u4e00\u6837\uff0c\u60a8\u4e5f\u53ef\u4ee5\u5728\u865a\u62df\u670d\u52a1\u4e2d\u57fa\u4e8e\u6bcf\u4e2a\u670d\u52a1\u8c03\u6574\u91cd\u8bd5\u8bbe\u7f6e\uff0c\u800c\u65e0\u9700\u89e6\u6478\u670d\u52a1\u4ee3\u7801\u3002\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u6bcf\u6b21\u91cd\u8bd5\u8d85\u65f6\uff0c\u6307\u5b9a\u60a8\u8981\u7b49\u5f85\u6bcf\u6b21\u91cd\u8bd5\u5c1d\u8bd5\u6210\u529f\u8fde\u63a5\u5230\u670d\u52a1\u7684\u65f6\u95f4\uff0c\u6765\u8fdb\u4e00\u6b65\u4f18\u5316\u91cd\u8bd5\u884c\u4e3a\u3002\u4e0b\u9762\u7684\u793a\u4f8b\u5728\u4e00\u6b21\u521d\u59cb\u547c\u53eb\u5931\u8d25\u540e\u6700\u591a\u914d\u7f6e3\u6b21\u91cd\u8bd5\u4ee5\u8fde\u63a5\u5230\u8be5\u670d\u52a1\u5b50\u96c6\uff0c\u6bcf\u4e2a\u91cd\u8bd5\u90fd\u67092\u79d2\u7684\u8d85\u65f6\u65f6\u95f4\u3002</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - route:\n    - destination:\n        host: ratings\n        subset: v1\n    retries:\n      attempts: 3\n      perTryTimeout: 2s\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#73-circuit-breakers","title":"7.3 Circuit breakers","text":"<p>\u65ad\u8def\u5668\u662fIstio\u63d0\u4f9b\u7684\u53e6\u4e00\u4e2a\u6709\u7528\u7684\u673a\u5236\uff0c\u53ef\u7528\u4e8e\u521b\u5efa\u57fa\u4e8e\u5f39\u6027\u5fae\u670d\u52a1\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u5728\u65ad\u8def\u5668\u4e2d\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u5bf9\u670d\u52a1\u5185\u5355\u4e2a\u4e3b\u673a\u7684\u547c\u53eb\u9650\u5236\uff0c\u4f8b\u5982\u5e76\u53d1\u8fde\u63a5\u6570\u6216\u5bf9\u8be5\u4e3b\u673a\u7684\u547c\u53eb\u5931\u8d25\u6b21\u6570\u3002\u4e00\u65e6\u8fbe\u5230\u8be5\u9650\u5236\uff0c\u65ad\u8def\u5668\u5c06\u201c\u8df3\u95f8\u201d\u5e76\u505c\u6b62\u4e0e\u8be5\u4e3b\u673a\u7684\u8fdb\u4e00\u6b65\u8fde\u63a5\u3002\u4f7f\u7528\u65ad\u8def\u5668\u6a21\u5f0f\u53ef\u5b9e\u73b0\u5feb\u901f\u6545\u969c\uff0c\u800c\u4e0d\u662f\u4f7f\u5ba2\u6237\u7aef\u5c1d\u8bd5\u8fde\u63a5\u5230\u8fc7\u8f7d\u6216\u6545\u969c\u4e3b\u673a\u3002</p> <p>\u7531\u4e8e\u7535\u8def\u4e2d\u65ad\u9002\u7528\u4e8e\u8d1f\u8f7d\u5e73\u8861\u6c60\u4e2d\u7684\u201c\u771f\u5b9e\u201d\u7f51\u683c\u76ee\u6807\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728\u76ee\u6807\u89c4\u5219\u4e2d\u914d\u7f6e\u7535\u8def\u65ad\u8def\u5668\u9608\u503c \uff0c\u5e76\u5c06\u8bbe\u7f6e\u5e94\u7528\u4e8e\u670d\u52a1\u4e2d\u7684\u6bcf\u4e2a\u4e3b\u673a\u3002\u4ee5\u4e0b\u793a\u4f8b<code>reviews</code>\u5c06v1\u5b50\u96c6\u7684\u670d\u52a1\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5e76\u53d1\u8fde\u63a5\u6570\u9650\u5236\u4e3a100\uff1a</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: reviews\nspec:\n  host: reviews\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n    trafficPolicy:\n      connectionPool:\n        tcp:\n          maxConnections: 100\n</code></pre> <p>\u60a8\u53ef\u4ee5\u5728Circuit Breaking\u4e2d\u627e\u5230\u6709\u5173\u521b\u5efa\u65ad\u8def\u5668\u7684\u66f4\u591a\u4fe1\u606f \u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#74-fault-injection","title":"7.4 Fault injection","text":"<p>\u914d\u7f6e\u5b8c\u7f51\u7edc\uff08\u5305\u62ec\u6545\u969c\u6062\u590d\u7b56\u7565\uff09\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528Istio\u7684\u6545\u969c\u6ce8\u5165\u673a\u5236\u6765\u6d4b\u8bd5\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u6545\u969c\u6062\u590d\u80fd\u529b\u3002\u6545\u969c\u6ce8\u5165\u662f\u4e00\u79cd\u5c06\u9519\u8bef\u5f15\u5165\u7cfb\u7edf\u7684\u6d4b\u8bd5\u65b9\u6cd5\uff0c\u4ee5\u786e\u4fdd\u5b83\u53ef\u4ee5\u627f\u53d7\u5e76\u4ece\u9519\u8bef\u60c5\u51b5\u4e2d\u6062\u590d\u3002\u4f7f\u7528\u6545\u969c\u6ce8\u5165\u5bf9\u786e\u4fdd\u60a8\u7684\u6545\u969c\u6062\u590d\u7b56\u7565\u4e0d\u662f\u4e0d\u517c\u5bb9\u6216\u9650\u5236\u8fc7\u4e8e\u4e25\u683c\u53ef\u80fd\u7279\u522b\u6709\u7528\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5173\u952e\u670d\u52a1\u4e0d\u53ef\u7528\u3002</p> <p>\u4e0e\u5176\u4ed6\u5728\u7f51\u7edc\u5c42\u5f15\u5165\u9519\u8bef\uff08\u4f8b\u5982\u5ef6\u8fdf\u6570\u636e\u5305\u6216\u6740\u6b7bPod\uff09\u7684\u673a\u5236\u4e0d\u540c\uff0cIstio'\u5141\u8bb8\u60a8\u5728\u5e94\u7528\u7a0b\u5e8f\u5c42\u6ce8\u5165\u6545\u969c\u3002\u8fd9\u4f7f\u60a8\u53ef\u4ee5\u6ce8\u5165\u66f4\u591a\u76f8\u5173\u7684\u6545\u969c\uff0c\u4f8b\u5982HTTP\u9519\u8bef\u4ee3\u7801\uff0c\u4ee5\u83b7\u5f97\u66f4\u591a\u76f8\u5173\u7684\u7ed3\u679c\u3002</p> <p>\u60a8\u53ef\u4ee5\u6ce8\u5165\u4e24\u79cd\u7c7b\u578b\u7684\u6545\u969c\uff0c\u8fd9\u4e24\u79cd\u6545\u969c\u90fd\u662f\u4f7f\u7528\u865a\u62df\u670d\u52a1\u914d\u7f6e\u7684 \uff1a</p> <ul> <li>\u5ef6\u8fdf\uff1a\u5ef6\u8fdf\u662f\u8ba1\u65f6\u5931\u8d25\u3002\u5b83\u4eec\u6a21\u4eff\u589e\u52a0\u7684\u7f51\u7edc\u5ef6\u8fdf\u6216\u4e0a\u6e38\u670d\u52a1\u8fc7\u8f7d\u3002</li> <li>\u4e2d\u6b62\uff1a\u4e2d\u6b62\u662f\u5d29\u6e83\u5931\u8d25\u3002\u5b83\u4eec\u6a21\u4eff\u4e0a\u6e38\u670d\u52a1\u4e2d\u7684\u6545\u969c\u3002\u4e2d\u6b62\u901a\u5e38\u4ee5HTTP\u9519\u8bef\u4ee3\u7801\u6216TCP\u8fde\u63a5\u5931\u8d25\u7684\u5f62\u5f0f\u8868\u73b0\u51fa\u6765\u3002</li> </ul> <p>\u4f8b\u5982\uff0c\u6b64\u865a\u62df\u670d\u52a1\u4e3a\u670d\u52a1\u7684\u6bcf1000\u4e2a\u8bf7\u6c42\u4e2d\u76841\u4e2a\u5f15\u51655\u79d2\u7684\u5ef6\u8fdf<code>ratings</code>\u3002</p> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - fault:\n      delay:\n        percentage:\n          value: 0.1\n        fixedDelay: 5s\n    route:\n    - destination:\n        host: ratings\n        subset: v1\n</code></pre> <p>\u6709\u5173\u5982\u4f55\u914d\u7f6e\u5ef6\u8fdf\u548c\u4e2d\u6b62\u7684\u8be6\u7ec6\u8bf4\u660e\uff0c\u8bf7\u53c2\u9605 \u6545\u969c\u6ce8\u5165\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#75","title":"7.5 \u5904\u7406\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f","text":"<p>Istio\u6545\u969c\u6062\u590d\u529f\u80fd\u5bf9\u5e94\u7528\u7a0b\u5e8f\u662f\u5b8c\u5168\u900f\u660e\u7684\u3002\u5e94\u7528\u7a0b\u5e8f\u4e0d\u77e5\u9053Envoy Sidecar\u4ee3\u7406\u5728\u8fd4\u56de\u54cd\u5e94\u4e4b\u524d\u662f\u5426\u6b63\u5728\u5904\u7406\u88ab\u8c03\u7528\u670d\u52a1\u7684\u6545\u969c\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u60a8\u8fd8\u5728\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u8bbe\u7f6e\u6545\u969c\u6062\u590d\u7b56\u7565\uff0c\u5219\u9700\u8981\u8bb0\u4f4f\u4e24\u8005\u90fd\u72ec\u7acb\u5de5\u4f5c\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u53d1\u751f\u51b2\u7a81\u3002\u4f8b\u5982\uff0c\u5047\u8bbe\u60a8\u6709\u4e24\u4e2a\u8d85\u65f6\uff0c\u4e00\u4e2a\u5728\u865a\u62df\u670d\u52a1\u4e2d\u914d\u7f6e\uff0c\u53e6\u4e00\u4e2a\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u914d\u7f6e\u3002\u5e94\u7528\u7a0b\u5e8f\u4e3a\u670d\u52a1\u7684API\u8c03\u7528\u8bbe\u7f6e\u4e862\u79d2\u8d85\u65f6\u3002\u4f46\u662f\uff0c\u60a8\u5728\u865a\u62df\u670d\u52a1\u4e2d\u914d\u7f6e\u4e863\u79d2\u8d85\u65f6\u548c1\u6b21\u91cd\u8bd5\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e94\u7528\u7a0b\u5e8f\u7684\u8d85\u65f6\u9996\u5148\u5f00\u59cb\uff0c\u56e0\u6b64\u60a8\u7684Envoy\u8d85\u65f6\u548c\u91cd\u8bd5\u5c1d\u8bd5\u65e0\u6548\u3002</p> <p>\u5c3d\u7ba1Istio\u6545\u969c\u6062\u590d\u529f\u80fd\u63d0\u9ad8\u4e86\u7f51\u683c\u4e2d\u670d\u52a1\u7684\u53ef\u9760\u6027\u548c\u53ef\u7528\u6027\uff0c\u4f46\u5e94\u7528\u7a0b\u5e8f\u5fc5\u987b\u5904\u7406\u6545\u969c\u6216\u9519\u8bef\u5e76\u91c7\u53d6\u9002\u5f53\u7684\u540e\u5907\u64cd\u4f5c\u3002\u4f8b\u5982\uff0c\u5f53\u8d1f\u8f7d\u5e73\u8861\u6c60\u4e2d\u7684\u6240\u6709\u5b9e\u4f8b\u90fd\u5931\u8d25\u65f6\uff0cEnvoy\u5c06\u8fd4\u56de\u4e00\u4e2a<code>HTTP 503</code> \u4ee3\u7801\u3002\u5e94\u7528\u7a0b\u5e8f\u5fc5\u987b\u5b9e\u73b0\u5904\u7406<code>HTTP 503</code>\u9519\u8bef\u4ee3\u7801\u6240\u9700\u7684\u6240\u6709\u540e\u5907\u903b\u8f91\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#bookinfo","title":"\u516b bookinfo\u793a\u4f8b","text":"<ul> <li>Service</li> </ul> <pre><code>[root@vm_0_2_centos ~]# kubectl get svc -n istio-system istio-ingressgateway -o yaml\napiVersion: v1\nkind: Service\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{},\"labels\":{\"app\":\"istio-ingressgateway\",\"chart\":\"gateways\",\"heritage\":\"Tiller\",\"istio\":\"ingressgateway\",\"release\":\"istio\"},\"name\":\"istio-ingressgateway\",\"namespace\":\"istio-system\"},\"spec\":{\"ports\":[{\"name\":\"status-port\",\"port\":15020,\"targetPort\":15020},{\"name\":\"http2\",\"nodePort\":31380,\"port\":80,\"targetPort\":80},{\"name\":\"https\",\"nodePort\":31390,\"port\":443},{\"name\":\"tcp\",\"nodePort\":31400,\"port\":31400},{\"name\":\"https-kiali\",\"port\":15029,\"targetPort\":15029},{\"name\":\"https-prometheus\",\"port\":15030,\"targetPort\":15030},{\"name\":\"https-grafana\",\"port\":15031,\"targetPort\":15031},{\"name\":\"https-tracing\",\"port\":15032,\"targetPort\":15032},{\"name\":\"tls\",\"port\":15443,\"targetPort\":15443}],\"selector\":{\"app\":\"istio-ingressgateway\",\"istio\":\"ingressgateway\",\"release\":\"istio\"},\"type\":\"LoadBalancer\"}}\n  creationTimestamp: \"2019-08-05T08:29:28Z\"\n  labels:\n    app: istio-ingressgateway\n    chart: gateways\n    heritage: Tiller\n    istio: ingressgateway\n    release: istio\n  name: istio-ingressgateway\n  namespace: istio-system\n  resourceVersion: \"6812\"\n  selfLink: /api/v1/namespaces/istio-system/services/istio-ingressgateway\n  uid: 6f6b6e05-6345-477f-ac16-5aedfef4e95e\nspec:\n  clusterIP: 10.108.162.3\n  externalTrafficPolicy: Cluster\n  ports:\n  - name: status-port\n    nodePort: 31931\n    port: 15020\n    protocol: TCP\n    targetPort: 15020\n  - name: http2\n    nodePort: 31380\n    port: 80\n    protocol: TCP\n    targetPort: 80\n  - name: https\n    nodePort: 31390\n    port: 443\n    protocol: TCP\n    targetPort: 443\n  - name: tcp\n    nodePort: 31400\n    port: 31400\n    protocol: TCP\n    targetPort: 31400\n  - name: https-kiali\n    nodePort: 32205\n    port: 15029\n    protocol: TCP\n    targetPort: 15029\n  - name: https-prometheus\n    nodePort: 31540\n    port: 15030\n    protocol: TCP\n    targetPort: 15030\n  - name: https-grafana\n    nodePort: 30722\n    port: 15031\n    protocol: TCP\n    targetPort: 15031\n  - name: https-tracing\n    nodePort: 32366\n    port: 15032\n    protocol: TCP\n    targetPort: 15032\n  - name: tls\n    nodePort: 31319\n    port: 15443\n    protocol: TCP\n    targetPort: 15443\n  selector:\n    app: istio-ingressgateway\n    istio: ingressgateway\n    release: istio\n  sessionAffinity: None\n  type: NodePort\n</code></pre> <ul> <li>bookinfo-gateway</li> </ul> <pre><code>apiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"Gateway\",\"metadata\":{\"annotations\":{},\"name\":\"bookinfo-gateway\",\"namespace\":\"default\"},\"spec\":{\"selector\":{\"istio\":\"ingressgateway\"},\"servers\":[{\"hosts\":[\"*\"],\"port\":{\"name\":\"http\",\"number\":80,\"protocol\":\"HTTP\"}}]}}\n  creationTimestamp: null\n  name: bookinfo-gateway\n  namespace: default\n  resourceVersion: \"6469\"\nspec:\n  selector:\n    istio: ingressgateway\n  servers:\n  - hosts:\n    - '*'\n    port:\n      name: http\n      number: 80\n      protocol: HTTP\n</code></pre> <ul> <li>gateway</li> </ul> <pre><code>[root@vm_0_2_centos ~]# istioctl get gateway\nCommand \"get\" is deprecated, Use `kubectl get` instead (see https://kubernetes.io/docs/tasks/tools/install-kubectl)\nGATEWAY NAME       HOSTS                 NAMESPACE   AGE\nbookinfo-gateway   *                     default     73d\nhttpbin-gateway    *                     default     72d\nmygateway          httpbin.example.com   default     70d\ntcp-echo-gateway   *                     default     72d\n[root@vm_0_2_centos ~]# istioctl  get gateway mygateway -o yaml\nCommand \"get\" is deprecated, Use `kubectl get` instead (see https://kubernetes.io/docs/tasks/tools/install-kubectl)\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"Gateway\",\"metadata\":{\"annotations\":{},\"name\":\"mygateway\",\"namespace\":\"default\"},\"spec\":{\"selector\":{\"istio\":\"ingressgateway\"},\"servers\":[{\"hosts\":[\"httpbin.example.com\"],\"port\":{\"name\":\"https\",\"number\":443,\"protocol\":\"HTTPS\"},\"tls\":{\"credentialName\":\"httpbin-credential\",\"mode\":\"SIMPLE\"}}]}}\n  creationTimestamp: null\n  name: mygateway\n  namespace: default\n  resourceVersion: \"223848\"\nspec:\n  selector:\n    istio: ingressgateway\n  servers:\n  - hosts:\n    - httpbin.example.com\n    port:\n      name: https\n      number: 443\n      protocol: HTTPS\n    tls:\n      credentialName: httpbin-credential\n      mode: SIMPLE\n</code></pre> <ul> <li>virtualservice</li> </ul> <pre><code>[root@vm_0_2_centos ~]# istioctl get virtualservice\nCommand \"get\" is deprecated, Use `kubectl get` instead (see https://kubernetes.io/docs/tasks/tools/install-kubectl)\nVIRTUAL-SERVICE NAME   GATEWAYS           HOSTS                 #HTTP     #TCP      NAMESPACE   AGE\nbookinfo               bookinfo-gateway   *                         1        0      default     73d\ndetails                                   details                   1        0      default     72d\nhttpbin                mygateway          httpbin.example.com       1        0      default     72d\nproductpage                               productpage               1        0      default     72d\nratings                                   ratings                   1        0      default     72d\nreviews                                   reviews                   1        0      default     72d\ntcp-echo               tcp-echo-gateway   *                         0        1      default     72d\n[root@vm_0_2_centos ~]# istioctl get virtualservice bookinfo -o yaml\nCommand \"get\" is deprecated, Use `kubectl get` instead (see https://kubernetes.io/docs/tasks/tools/install-kubectl)\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"VirtualService\",\"metadata\":{\"annotations\":{},\"name\":\"bookinfo\",\"namespace\":\"default\"},\"spec\":{\"gateways\":[\"bookinfo-gateway\"],\"hosts\":[\"*\"],\"http\":[{\"match\":[{\"uri\":{\"exact\":\"/productpage\"}},{\"uri\":{\"prefix\":\"/static\"}},{\"uri\":{\"exact\":\"/login\"}},{\"uri\":{\"exact\":\"/logout\"}},{\"uri\":{\"prefix\":\"/api/v1/products\"}}],\"route\":[{\"destination\":{\"host\":\"productpage\",\"port\":{\"number\":9080}}}]}]}}\n  creationTimestamp: null\n  name: bookinfo\n  namespace: default\n  resourceVersion: \"6470\"\nspec:\n  gateways:\n  - bookinfo-gateway\n  hosts:\n  - '*'\n  http:\n  - match:\n    - uri:\n        exact: /productpage\n    - uri:\n        prefix: /static\n    - uri:\n        exact: /login\n    - uri:\n        exact: /logout\n    - uri:\n        prefix: /api/v1/products\n    route:\n    - destination:\n        host: productpage\n        port:\n          number: 9080\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#http-bin","title":"\u4e5d http-bin\u670d\u52a1","text":"<pre><code>[root@vm_0_2_centos ~]# kubectl get gateway\nNAME               AGE\nbookinfo-gateway   73d\nhttpbin-gateway    72d\nmygateway          71d\ntcp-echo-gateway   72d\n\n\n[root@vm_0_2_centos ~]# kubectl get gateway httpbin-gateway -oyaml\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"Gateway\",\"metadata\":{\"annotations\":{},\"name\":\"httpbin-gateway\",\"namespace\":\"default\"},\"spec\":{\"selector\":{\"istio\":\"ingressgateway\"},\"servers\":[{\"hosts\":[\"*\"],\"port\":{\"name\":\"http\",\"number\":80,\"protocol\":\"HTTP\"}}]}}\n  creationTimestamp: \"2019-08-06T09:22:19Z\"\n  generation: 2\n  name: httpbin-gateway\n  namespace: default\n  resourceVersion: \"115949\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/gateways/httpbin-gateway\n  uid: 64be1356-6eba-430b-bfb1-defc46bfa04c\nspec:\n  selector:\n    istio: ingressgateway\n  servers:\n  - hosts:\n    - '*'\n    port:\n      name: http\n      number: 80\n      protocol: HTTP\n\n[root@vm_0_2_centos ~]# kubectl get virtualservice\nNAME          GATEWAYS             HOSTS                   AGE\nbookinfo      [bookinfo-gateway]   [*]                     73d\ndetails                            [details]               73d\nhttpbin       [mygateway]          [httpbin.example.com]   72d\nproductpage                        [productpage]           73d\nratings                            [ratings]               73d\nreviews                            [reviews]               73d\ntcp-echo      [tcp-echo-gateway]   [*]                     72d\n\n\n[root@vm_0_2_centos ~]# kubectl get virtualservice httpbin -oyaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"VirtualService\",\"metadata\":{\"annotations\":{},\"name\":\"httpbin\",\"namespace\":\"default\"},\"spec\":{\"gateways\":[\"mygateway\"],\"hosts\":[\"httpbin.example.com\"],\"http\":[{\"match\":[{\"uri\":{\"prefix\":\"/status\"}},{\"uri\":{\"prefix\":\"/delay\"}}],\"route\":[{\"destination\":{\"host\":\"httpbin\",\"port\":{\"number\":8000}}}]}]}}\n  creationTimestamp: \"2019-08-06T09:24:50Z\"\n  generation: 3\n  name: httpbin\n  namespace: default\n  resourceVersion: \"224298\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/httpbin\n  uid: 23a2bde9-8536-4aae-8d82-876f52555f89\nspec:\n  gateways:\n  - mygateway     # \u5728\u6b64\u5173\u8054gateway\n  hosts:\n  - httpbin.example.com\n  http:\n  - match:\n    - uri:\n        prefix: /status\n    - uri:\n        prefix: /delay\n    route:\n    - destination:\n        host: httpbin\n        port:\n          number: 8000\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#tcp-echo","title":"\u5341 tcp-echo\u670d\u52a1","text":"<pre><code>[root@vm_0_2_centos ~]# kubectl get gw\nNAME               AGE\nbookinfo-gateway   73d\nhttpbin-gateway    72d\nmygateway          71d\ntcp-echo-gateway   72d\n\n\n[root@vm_0_2_centos ~]# kubectl get gw tcp-echo-gateway -oyaml\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"Gateway\",\"metadata\":{\"annotations\":{},\"name\":\"tcp-echo-gateway\",\"namespace\":\"default\"},\"spec\":{\"selector\":{\"istio\":\"ingressgateway\"},\"servers\":[{\"hosts\":[\"*\"],\"port\":{\"name\":\"tcp\",\"number\":31400,\"protocol\":\"TCP\"}}]}}\n  creationTimestamp: \"2019-08-06T06:01:54Z\"\n  generation: 1\n  name: tcp-echo-gateway\n  namespace: default\n  resourceVersion: \"100417\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/gateways/tcp-echo-gateway\n  uid: e04b084c-e65a-4abe-826b-c30a124f8213\nspec:\n  selector:\n    istio: ingressgateway\n  servers:\n  - hosts:\n    - '*'\n    port:\n      name: tcp\n      number: 31400\n      protocol: TCP\n\n[root@vm_0_2_centos ~]# kubectl get vs\nNAME          GATEWAYS             HOSTS                   AGE\nbookinfo      [bookinfo-gateway]   [*]                     73d\ndetails                            [details]               73d\nhttpbin       [mygateway]          [httpbin.example.com]   72d\nproductpage                        [productpage]           73d\nratings                            [ratings]               73d\nreviews                            [reviews]               73d\ntcp-echo      [tcp-echo-gateway]   [*]                     72d\n\n[root@vm_0_2_centos ~]# kubectl get vs tcp-echo -oyaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"VirtualService\",\"metadata\":{\"annotations\":{},\"name\":\"tcp-echo\",\"namespace\":\"default\"},\"spec\":{\"gateways\":[\"tcp-echo-gateway\"],\"hosts\":[\"*\"],\"tcp\":[{\"match\":[{\"port\":31400}],\"route\":[{\"destination\":{\"host\":\"tcp-echo\",\"port\":{\"number\":9000},\"subset\":\"v1\"},\"weight\":80},{\"destination\":{\"host\":\"tcp-echo\",\"port\":{\"number\":9000},\"subset\":\"v2\"},\"weight\":20}]}]}}\n  creationTimestamp: \"2019-08-06T06:01:54Z\"\n  generation: 2\n  name: tcp-echo\n  namespace: default\n  resourceVersion: \"112275\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/tcp-echo\n  uid: c03f8d6b-0967-45cf-8cf5-465d08634318\nspec:\n  gateways:\n  - tcp-echo-gateway\n  hosts:\n  - '*'\n  tcp:\n  - match:\n    - port: 31400\n    route:\n    - destination:\n        host: tcp-echo\n        port:\n          number: 9000\n        subset: v1\n      weight: 80\n    - destination:\n        host: tcp-echo\n        port:\n          number: 9000\n        subset: v2\n      weight: 20\n\n[root@vm_0_2_centos ~]# kubectl get dr\nNAME                   HOST          AGE\ndetails                details       73d\nproductpage            productpage   73d\nratings                ratings       73d\nreviews                reviews       73d\ntcp-echo-destination   tcp-echo      72d\n\n\n[root@vm_0_2_centos ~]# kubectl get dr tcp-echo-destination -oyaml\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"DestinationRule\",\"metadata\":{\"annotations\":{},\"name\":\"tcp-echo-destination\",\"namespace\":\"default\"},\"spec\":{\"host\":\"tcp-echo\",\"subsets\":[{\"labels\":{\"version\":\"v1\"},\"name\":\"v1\"},{\"labels\":{\"version\":\"v2\"},\"name\":\"v2\"}]}}\n  creationTimestamp: \"2019-08-06T06:01:54Z\"\n  generation: 1\n  name: tcp-echo-destination\n  namespace: default\n  resourceVersion: \"100418\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/destinationrules/tcp-echo-destination\n  uid: 930406ec-acf6-4130-85e1-ebe1a0a1e179\nspec:\n  host: tcp-echo\n  subsets:\n  - labels:\n      version: v1\n    name: v1\n  - labels:\n      version: v2\n    name: v2\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E4%B9%8B%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://zhaohuabing.com/istio-practice/</li> <li>https://skyao.io/learning-istio/introduction/information.html</li> <li>https://github.com/servicemesher/istio-knowledge-map</li> </ul>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/","title":"istio\u7b14\u8bb0","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_1","title":"\u4e00 \u57fa\u7840\u6982\u5ff5","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#11-istio","title":"1.1 istio\u662f\u4ec0\u4e48","text":"<p>Istio \u5141\u8bb8\u60a8\u8fde\u63a5\u3001\u4fdd\u62a4\u3001\u63a7\u5236\u548c\u89c2\u6d4b\u5fae\u670d\u52a1\uff0c\u5728\u8f83\u9ad8\u7684\u5c42\u6b21\u4e0a\uff0cIstio \u6709\u52a9\u4e8e\u964d\u4f4e\u8fd9\u4e9b\u90e8\u7f72\u7684\u590d\u6742\u6027\uff0c\u5e76\u51cf\u8f7b\u5f00\u53d1\u56e2\u961f\u7684\u538b\u529b\u3002\u5b83\u662f\u4e00\u4e2a\u5b8c\u5168\u5f00\u6e90\u7684\u670d\u52a1\u7f51\u683c\uff0c\u53ef\u4ee5\u900f\u660e\u5730\u5206\u5c42\u5230\u73b0\u6709\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u4e0a\u3002\u5b83\u4e5f\u662f\u4e00\u4e2a\u5e73\u53f0\uff0c\u5305\u62ec\u5141\u8bb8\u5b83\u96c6\u6210\u5230\u4efb\u4f55\u65e5\u5fd7\u8bb0\u5f55\u5e73\u53f0\u3001\u9065\u6d4b\u6216\u7b56\u7565\u7cfb\u7edf\u7684 API\u3002Istio \u7684\u591a\u6837\u5316\u529f\u80fd\u96c6\u4f7f\u60a8\u80fd\u591f\u6210\u529f\u9ad8\u6548\u5730\u8fd0\u884c\u5206\u5e03\u5f0f\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u5e76\u63d0\u4f9b\u4fdd\u62a4\u3001\u8fde\u63a5\u548c\u76d1\u63a7\u5fae\u670d\u52a1\u7684\u7edf\u4e00\u65b9\u6cd5\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#12-service-mesh","title":"1.2 \u4ec0\u4e48\u662fservice mesh","text":"<p>\u5728\u4ece\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\u5411\u5206\u5e03\u5f0f\u5fae\u670d\u52a1\u67b6\u6784\u7684\u8f6c\u578b\u8fc7\u7a0b\u4e2d\uff0c\u5f00\u53d1\u4eba\u5458\u548c\u8fd0\u7ef4\u4eba\u5458\u9762\u4e34\u8bf8\u591a\u6311\u6218\uff0c\u4f7f\u7528 Istio \u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002</p> <p>\u670d\u52a1\u7f51\u683c\uff08Service Mesh\uff09\u8fd9\u4e2a\u672f\u8bed\u901a\u5e38\u7528\u4e8e\u63cf\u8ff0\u6784\u6210\u8fd9\u4e9b\u5e94\u7528\u7a0b\u5e8f\u7684\u5fae\u670d\u52a1\u7f51\u7edc\u4ee5\u53ca\u5e94\u7528\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002\u968f\u7740\u89c4\u6a21\u548c\u590d\u6742\u6027\u7684\u589e\u957f\uff0c\u670d\u52a1\u7f51\u683c\u8d8a\u6765\u8d8a\u96be\u4ee5\u7406\u89e3\u548c\u7ba1\u7406\u3002\u5b83\u7684\u9700\u6c42\u5305\u62ec\u670d\u52a1\u53d1\u73b0\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u6545\u969c\u6062\u590d\u3001\u6307\u6807\u6536\u96c6\u548c\u76d1\u63a7\u4ee5\u53ca\u901a\u5e38\u66f4\u52a0\u590d\u6742\u7684\u8fd0\u7ef4\u9700\u6c42\uff0c\u4f8b\u5982 A/B \u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u53d1\u5e03\u3001\u9650\u6d41\u3001\u8bbf\u95ee\u63a7\u5236\u548c\u7aef\u5230\u7aef\u8ba4\u8bc1\u7b49\u3002</p> <p>Istio \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u901a\u8fc7\u4e3a\u6574\u4e2a\u670d\u52a1\u7f51\u683c\u63d0\u4f9b\u884c\u4e3a\u6d1e\u5bdf\u548c\u64cd\u4f5c\u63a7\u5236\u6765\u6ee1\u8db3\u5fae\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u7684\u591a\u6837\u5316\u9700\u6c42\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#13-istio","title":"1.3 \u4e3a\u4ec0\u4e48\u4f7f\u7528istio","text":"<p>Istio \u63d0\u4f9b\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u6765\u4e3a\u5df2\u90e8\u7f72\u7684\u670d\u52a1\u5efa\u7acb\u7f51\u7edc\uff0c\u8be5\u7f51\u7edc\u5177\u6709\u8d1f\u8f7d\u5747\u8861\u3001\u670d\u52a1\u95f4\u8ba4\u8bc1\u3001\u76d1\u63a7\u7b49\u529f\u80fd\uff0c\u53ea\u9700\u8981\u5bf9\u670d\u52a1\u7684\u4ee3\u7801\u8fdb\u884c\u4e00\u70b9\u6216\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u6539\u52a8\u3002\u60f3\u8981\u8ba9\u670d\u52a1\u652f\u6301 Istio\uff0c\u53ea\u9700\u8981\u5728\u60a8\u7684\u73af\u5883\u4e2d\u90e8\u7f72\u4e00\u4e2a\u7279\u6b8a\u7684 sidecar \u4ee3\u7406\uff0c\u4f7f\u7528 Istio \u63a7\u5236\u5e73\u9762\u529f\u80fd\u914d\u7f6e\u548c\u7ba1\u7406\u4ee3\u7406\uff0c\u62e6\u622a\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u6240\u6709\u7f51\u7edc\u901a\u4fe1\uff1a</p> <ul> <li>HTTP\u3001gRPC\u3001WebSocket \u548c TCP \u6d41\u91cf\u7684\u81ea\u52a8\u8d1f\u8f7d\u5747\u8861\u3002</li> <li>\u901a\u8fc7\u4e30\u5bcc\u7684\u8def\u7531\u89c4\u5219\u3001\u91cd\u8bd5\u3001\u6545\u969c\u8f6c\u79fb\u548c\u6545\u969c\u6ce8\u5165\uff0c\u53ef\u4ee5\u5bf9\u6d41\u91cf\u884c\u4e3a\u8fdb\u884c\u7ec6\u7c92\u5ea6\u63a7\u5236\u3002</li> <li>\u53ef\u63d2\u5165\u7684\u7b56\u7565\u5c42\u548c\u914d\u7f6e API\uff0c\u652f\u6301\u8bbf\u95ee\u63a7\u5236\u3001\u901f\u7387\u9650\u5236\u548c\u914d\u989d\u3002</li> <li>\u5bf9\u51fa\u5165\u96c6\u7fa4\u5165\u53e3\u548c\u51fa\u53e3\u4e2d\u6240\u6709\u6d41\u91cf\u7684\u81ea\u52a8\u5ea6\u91cf\u6307\u6807\u3001\u65e5\u5fd7\u8bb0\u5f55\u548c\u8ffd\u8e2a\u3002</li> <li>\u901a\u8fc7\u5f3a\u5927\u7684\u57fa\u4e8e\u8eab\u4efd\u7684\u9a8c\u8bc1\u548c\u6388\u6743\uff0c\u5728\u96c6\u7fa4\u4e2d\u5b9e\u73b0\u5b89\u5168\u7684\u670d\u52a1\u95f4\u901a\u4fe1\u3002</li> </ul> <p>Istio \u65e8\u5728\u5b9e\u73b0\u53ef\u6269\u5c55\u6027\uff0c\u6ee1\u8db3\u5404\u79cd\u90e8\u7f72\u9700\u6c42\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_2","title":"\u4e8c \u6838\u5fc3\u529f\u80fd","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#21","title":"2.1 \u6d41\u91cf\u7ba1\u7406","text":"<p>\u901a\u8fc7\u7b80\u5355\u7684\u89c4\u5219\u914d\u7f6e\u548c\u6d41\u91cf\u8def\u7531\uff0c\u60a8\u53ef\u4ee5\u63a7\u5236\u670d\u52a1\u4e4b\u95f4\u7684\u6d41\u91cf\u548c API \u8c03\u7528\u3002Istio \u7b80\u5316\u4e86\u65ad\u8def\u5668\u3001\u8d85\u65f6\u548c\u91cd\u8bd5\u7b49\u670d\u52a1\u7ea7\u522b\u5c5e\u6027\u7684\u914d\u7f6e\uff0c\u5e76\u4e14\u53ef\u4ee5\u8f7b\u677e\u8bbe\u7f6e A/B\u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u90e8\u7f72\u548c\u57fa\u4e8e\u767e\u5206\u6bd4\u7684\u6d41\u91cf\u5206\u5272\u7684\u5206\u9636\u6bb5\u90e8\u7f72\u7b49\u91cd\u8981\u4efb\u52a1\u3002</p> <p>\u901a\u8fc7\u66f4\u597d\u5730\u4e86\u89e3\u60a8\u7684\u6d41\u91cf\u548c\u5f00\u7bb1\u5373\u7528\u7684\u6545\u969c\u6062\u590d\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u5728\u95ee\u9898\u51fa\u73b0\u4e4b\u524d\u5148\u53d1\u73b0\u95ee\u9898\uff0c\u4f7f\u8c03\u7528\u66f4\u53ef\u9760\uff0c\u5e76\u4e14\u4f7f\u60a8\u7684\u7f51\u7edc\u66f4\u52a0\u5f3a\u5927\u2014\u2014\u65e0\u8bba\u60a8\u9762\u4e34\u4ec0\u4e48\u6761\u4ef6\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#22","title":"2.2 \u5b89\u5168","text":"<p>Istio \u7684\u5b89\u5168\u529f\u80fd\u4f7f\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7ea7\u522b\u7684\u5b89\u5168\u6027\u3002Istio \u63d0\u4f9b\u5e95\u5c42\u5b89\u5168\u901a\u4fe1\u4fe1\u9053\uff0c\u5e76\u5927\u89c4\u6a21\u7ba1\u7406\u670d\u52a1\u901a\u4fe1\u7684\u8ba4\u8bc1\u3001\u6388\u6743\u548c\u52a0\u5bc6\u3002\u4f7f\u7528Istio\uff0c\u670d\u52a1\u901a\u4fe1\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u5b89\u5168\u7684\uff0c\u5b83\u5141\u8bb8\u60a8\u8de8\u591a\u79cd\u534f\u8bae\u548c\u8fd0\u884c\u65f6\u4e00\u81f4\u5730\u5b9e\u65bd\u7b56\u7565\u2014\u2014\u6240\u6709\u8fd9\u4e9b\u90fd\u5f88\u5c11\u6216\u6839\u672c\u4e0d\u9700\u8981\u5e94\u7528\u7a0b\u5e8f\u66f4\u6539\u3002</p> <p>\u867d\u7136 Istio \u4e0e\u5e73\u53f0\u65e0\u5173\uff0c\u4f46\u5c06\u5176\u4e0e Kubernetes\uff08\u6216\u57fa\u7840\u67b6\u6784\uff09\u7f51\u7edc\u7b56\u7565\u7ed3\u5408\u4f7f\u7528\uff0c\u5176\u4f18\u52bf\u4f1a\u66f4\u5927\uff0c\u5305\u62ec\u5728\u7f51\u7edc\u548c\u5e94\u7528\u5c42\u4fdd\u62a4 pod \u95f4\u6216\u670d\u52a1\u95f4\u901a\u4fe1\u7684\u80fd\u529b\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#23","title":"2.3 \u53ef\u89c2\u5bdf\u884c","text":"<p>Istio \u5f3a\u5927\u7684\u8ffd\u8e2a\u3001\u76d1\u63a7\u548c\u65e5\u5fd7\u8bb0\u5f55\u53ef\u8ba9\u60a8\u6df1\u5165\u4e86\u89e3\u670d\u52a1\u7f51\u683c\u90e8\u7f72\u3002\u901a\u8fc7 Istio \u7684\u76d1\u63a7\u529f\u80fd\uff0c\u53ef\u4ee5\u771f\u6b63\u4e86\u89e3\u670d\u52a1\u6027\u80fd\u5982\u4f55\u5f71\u54cd\u4e0a\u6e38\u548c\u4e0b\u6e38\u7684\u529f\u80fd\uff0c\u800c\u5176\u81ea\u5b9a\u4e49\u4eea\u8868\u677f\u53ef\u4ee5\u63d0\u4f9b\u5bf9\u6240\u6709\u670d\u52a1\u6027\u80fd\u7684\u53ef\u89c6\u6027\uff0c\u5e76\u8ba9\u60a8\u4e86\u89e3\u8be5\u6027\u80fd\u5982\u4f55\u5f71\u54cd\u60a8\u7684\u5176\u4ed6\u8fdb\u7a0b\u3002</p> <p>Istio \u7684 Mixer \u7ec4\u4ef6\u8d1f\u8d23\u7b56\u7565\u63a7\u5236\u548c\u9065\u6d4b\u6536\u96c6\u3002\u5b83\u63d0\u4f9b\u540e\u7aef\u62bd\u8c61\u548c\u4e2d\u4ecb\uff0c\u5c06 Istio \u7684\u5176\u4f59\u90e8\u5206\u4e0e\u5404\u4e2a\u57fa\u7840\u67b6\u6784\u540e\u7aef\u7684\u5b9e\u73b0\u7ec6\u8282\u9694\u79bb\u5f00\u6765\uff0c\u5e76\u4e3a\u8fd0\u7ef4\u63d0\u4f9b\u5bf9\u7f51\u683c\u548c\u57fa\u7840\u67b6\u6784\u540e\u7aef\u4e4b\u95f4\u6240\u6709\u4ea4\u4e92\u7684\u7ec6\u7c92\u5ea6\u63a7\u5236\u3002</p> <p>\u6240\u6709\u8fd9\u4e9b\u529f\u80fd\u53ef\u4ee5\u8ba9\u60a8\u53ef\u4ee5\u66f4\u6709\u6548\u5730\u8bbe\u7f6e\u3001\u76d1\u63a7\u548c\u5b9e\u65bd\u670d\u52a1\u4e0a\u7684 SLO\u3002\u5f53\u7136\uff0c\u6700\u91cd\u8981\u7684\u662f\uff0c\u60a8\u53ef\u4ee5\u5feb\u901f\u6709\u6548\u5730\u68c0\u6d4b\u548c\u4fee\u590d\u95ee\u9898\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#24","title":"2.4 \u5e73\u53f0\u652f\u6301","text":"<p>stio \u662f\u72ec\u7acb\u4e8e\u5e73\u53f0\u7684\uff0c\u65e8\u5728\u8fd0\u884c\u5728\u5404\u79cd\u73af\u5883\u4e2d\uff0c\u5305\u62ec\u8de8\u4e91\u3001\u5185\u90e8\u90e8\u7f72\u3001Kubernetes\u3001Mesos \u7b49\u3002\u60a8\u53ef\u4ee5\u5728 Kubernetes \u4e0a\u90e8\u7f72 Istio \u6216\u5177\u6709 Consul \u7684 Nomad \u4e0a\u90e8\u7f72\u3002Istio \u76ee\u524d\u652f\u6301\uff1a</p> <ul> <li>\u5728 Kubernetes \u4e0a\u90e8\u7f72\u7684\u670d\u52a1</li> <li>\u4f7f\u7528 Consul \u6ce8\u518c\u7684\u670d\u52a1</li> <li>\u5728\u865a\u62df\u673a\u4e0a\u90e8\u7f72\u7684\u670d\u52a1</li> </ul>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#25","title":"2.5 \u96c6\u6210\u548c\u5b9a\u5236","text":"<p>\u7b56\u7565\u6267\u884c\u7ec4\u4ef6\u53ef\u4ee5\u6269\u5c55\u548c\u5b9a\u5236\uff0c\u4ee5\u4fbf\u4e0e\u73b0\u6709\u7684 ACL\u3001\u65e5\u5fd7\u3001\u76d1\u63a7\u3001\u914d\u989d\u3001\u5ba1\u8ba1\u7b49\u65b9\u6848\u96c6\u6210\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_3","title":"\u4e09 \u67b6\u6784","text":"<p>Istio \u670d\u52a1\u7f51\u683c\u903b\u8f91\u4e0a\u5206\u4e3a**\u6570\u636e\u5e73\u9762**\u548c**\u63a7\u5236\u5e73\u9762**\u3002</p> <ul> <li>**\u6570\u636e\u5e73\u9762**\u7531\u4e00\u7ec4\u4ee5 sidecar \u65b9\u5f0f\u90e8\u7f72\u7684\u667a\u80fd\u4ee3\u7406\uff08Envoy\uff09\u7ec4\u6210\u3002\u8fd9\u4e9b\u4ee3\u7406\u53ef\u4ee5\u8c03\u8282\u548c\u63a7\u5236\u5fae\u670d\u52a1\u53ca Mixer \u4e4b\u95f4\u6240\u6709\u7684\u7f51\u7edc\u901a\u4fe1\u3002</li> <li>**\u63a7\u5236\u5e73\u9762**\u8d1f\u8d23\u7ba1\u7406\u548c\u914d\u7f6e\u4ee3\u7406\u6765\u8def\u7531\u6d41\u91cf\u3002\u6b64\u5916\u63a7\u5236\u5e73\u9762\u914d\u7f6e Mixer \u4ee5\u5b9e\u65bd\u7b56\u7565\u548c\u6536\u96c6\u9065\u6d4b\u6570\u636e\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#31","title":"3.1 \u67b6\u6784\u56fe","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#32","title":"3.2 \u7ec4\u4ef6","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#321-envoy","title":"3.2.1 Envoy","text":"<p>Istio \u4f7f\u7528 Envoy \u4ee3\u7406\u7684\u6269\u5c55\u7248\u672c\uff0cEnvoy \u662f\u4ee5 C++ \u5f00\u53d1\u7684\u9ad8\u6027\u80fd\u4ee3\u7406\uff0c\u7528\u4e8e\u8c03\u89e3\u670d\u52a1\u7f51\u683c\u4e2d\u6240\u6709\u670d\u52a1\u7684\u6240\u6709\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u3002Envoy \u7684\u8bb8\u591a\u5185\u7f6e\u529f\u80fd\u88ab Istio \u53d1\u626c\u5149\u5927\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u52a8\u6001\u670d\u52a1\u53d1\u73b0</li> <li>\u8d1f\u8f7d\u5747\u8861</li> <li>TLS \u7ec8\u6b62</li> <li>HTTP/2 &amp; gRPC \u4ee3\u7406</li> <li>\u7194\u65ad\u5668</li> <li>\u5065\u5eb7\u68c0\u67e5\u3001\u57fa\u4e8e\u767e\u5206\u6bd4\u6d41\u91cf\u62c6\u5206\u7684\u7070\u5ea6\u53d1\u5e03</li> <li>\u6545\u969c\u6ce8\u5165</li> <li>\u4e30\u5bcc\u7684\u5ea6\u91cf\u6307\u6807</li> </ul> <p>Envoy \u88ab\u90e8\u7f72\u4e3a sidecar\uff0c\u548c\u5bf9\u5e94\u670d\u52a1\u5728\u540c\u4e00\u4e2a Kubernetes pod \u4e2d\u3002\u8fd9\u5141\u8bb8 Istio \u5c06\u5927\u91cf\u5173\u4e8e\u6d41\u91cf\u884c\u4e3a\u7684\u4fe1\u53f7\u4f5c\u4e3a\u5c5e\u6027\u63d0\u53d6\u51fa\u6765\uff0c\u800c\u8fd9\u4e9b\u5c5e\u6027\u53c8\u53ef\u4ee5\u5728 Mixer \u4e2d\u7528\u4e8e\u6267\u884c\u7b56\u7565\u51b3\u7b56\uff0c\u5e76\u53d1\u9001\u7ed9\u76d1\u63a7\u7cfb\u7edf\uff0c\u4ee5\u63d0\u4f9b\u6574\u4e2a\u7f51\u683c\u884c\u4e3a\u7684\u4fe1\u606f\u3002</p> <p>Sidecar \u4ee3\u7406\u6a21\u578b\u8fd8\u53ef\u4ee5\u5c06 Istio \u7684\u529f\u80fd\u6dfb\u52a0\u5230\u73b0\u6709\u90e8\u7f72\u4e2d\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u6784\u5efa\u6216\u91cd\u5199\u4ee3\u7801\u3002\u53ef\u4ee5\u9605\u8bfb\u66f4\u591a\u6765\u4e86\u89e3\u4e3a\u4ec0\u4e48\u6211\u4eec\u5728\u8bbe\u8ba1\u76ee\u6807\u4e2d\u9009\u62e9\u8fd9\u79cd\u65b9\u5f0f\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#322-mixer","title":"3.2.2 Mixer","text":"<p>Mixer \u662f\u4e00\u4e2a\u72ec\u7acb\u4e8e\u5e73\u53f0\u7684\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u5728\u670d\u52a1\u7f51\u683c\u4e0a\u6267\u884c\u8bbf\u95ee\u63a7\u5236\u548c\u4f7f\u7528\u7b56\u7565\uff0c\u5e76\u4ece Envoy \u4ee3\u7406\u548c\u5176\u4ed6\u670d\u52a1\u6536\u96c6\u9065\u6d4b\u6570\u636e\u3002\u4ee3\u7406\u63d0\u53d6\u8bf7\u6c42\u7ea7\u5c5e\u6027\uff0c\u53d1\u9001\u5230 Mixer \u8fdb\u884c\u8bc4\u4f30\u3002\u6709\u5173\u5c5e\u6027\u63d0\u53d6\u548c\u7b56\u7565\u8bc4\u4f30\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Mixer \u914d\u7f6e\u3002</p> <p>Mixer \u4e2d\u5305\u62ec\u4e00\u4e2a\u7075\u6d3b\u7684\u63d2\u4ef6\u6a21\u578b\uff0c\u4f7f\u5176\u80fd\u591f\u63a5\u5165\u5230\u5404\u79cd\u4e3b\u673a\u73af\u5883\u548c\u57fa\u7840\u8bbe\u65bd\u540e\u7aef\uff0c\u4ece\u8fd9\u4e9b\u7ec6\u8282\u4e2d\u62bd\u8c61\u51fa Envoy \u4ee3\u7406\u548c Istio \u7ba1\u7406\u7684\u670d\u52a1\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#323-pilot","title":"3.2.3 Pilot","text":"<p>Pilot \u4e3a Envoy sidecar \u63d0\u4f9b\u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff0c\u4e3a\u667a\u80fd\u8def\u7531\uff08\u4f8b\u5982 A/B \u6d4b\u8bd5\u3001\u91d1\u4e1d\u96c0\u90e8\u7f72\u7b49\uff09\u548c\u5f39\u6027\uff08\u8d85\u65f6\u3001\u91cd\u8bd5\u3001\u7194\u65ad\u5668\u7b49\uff09\u63d0\u4f9b\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u5b83\u5c06\u63a7\u5236\u6d41\u91cf\u884c\u4e3a\u7684\u9ad8\u7ea7\u8def\u7531\u89c4\u5219\u8f6c\u6362\u4e3a\u7279\u5b9a\u4e8e Envoy \u7684\u914d\u7f6e\uff0c\u5e76\u5728\u8fd0\u884c\u65f6\u5c06\u5b83\u4eec\u4f20\u64ad\u5230 sidecar\u3002</p> <p>Pilot \u5c06\u5e73\u53f0\u7279\u5b9a\u7684\u670d\u52a1\u53d1\u73b0\u673a\u5236\u62bd\u8c61\u5316\u5e76\u5c06\u5176\u5408\u6210\u4e3a\u7b26\u5408 Envoy \u6570\u636e\u5e73\u9762 API \u7684\u4efb\u4f55 sidecar \u90fd\u53ef\u4ee5\u4f7f\u7528\u7684\u6807\u51c6\u683c\u5f0f\u3002\u8fd9\u79cd\u677e\u6563\u8026\u5408\u4f7f\u5f97 Istio \u80fd\u591f\u5728\u591a\u79cd\u73af\u5883\u4e0b\u8fd0\u884c\uff08\u4f8b\u5982\uff0cKubernetes\u3001Consul\u3001Nomad\uff09\uff0c\u540c\u65f6\u4fdd\u6301\u7528\u4e8e\u6d41\u91cf\u7ba1\u7406\u7684\u76f8\u540c\u64cd\u4f5c\u754c\u9762\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#324-citadel","title":"3.2.4 Citadel","text":"<p>Citadel \u901a\u8fc7\u5185\u7f6e\u8eab\u4efd\u548c\u51ed\u8bc1\u7ba1\u7406\u8d4b\u80fd\u5f3a\u5927\u7684\u670d\u52a1\u95f4\u548c\u6700\u7ec8\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\u3002\u53ef\u7528\u4e8e\u5347\u7ea7\u670d\u52a1\u7f51\u683c\u4e2d\u672a\u52a0\u5bc6\u7684\u6d41\u91cf\uff0c\u5e76\u4e3a\u8fd0\u7ef4\u4eba\u5458\u63d0\u4f9b\u57fa\u4e8e\u670d\u52a1\u6807\u8bc6\u800c\u4e0d\u662f\u7f51\u7edc\u63a7\u5236\u7684\u5f3a\u5236\u6267\u884c\u7b56\u7565\u7684\u80fd\u529b\u3002\u4ece 0.5 \u7248\u672c\u5f00\u59cb\uff0cIstio \u652f\u6301\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u4ee5\u63a7\u5236\u8c01\u53ef\u4ee5\u8bbf\u95ee\u60a8\u7684\u670d\u52a1\uff0c\u800c\u4e0d\u662f\u57fa\u4e8e\u4e0d\u7a33\u5b9a\u7684\u4e09\u5c42\u6216\u56db\u5c42\u7f51\u7edc\u6807\u8bc6\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#325-galley","title":"3.2.5 Galley","text":"<p>Galley \u4ee3\u8868\u5176\u4ed6\u7684 Istio \u63a7\u5236\u5e73\u9762\u7ec4\u4ef6\uff0c\u7528\u6765\u9a8c\u8bc1\u7528\u6237\u7f16\u5199\u7684 Istio API \u914d\u7f6e\u3002\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0cGalley \u5c06\u63a5\u7ba1 Istio \u83b7\u53d6\u914d\u7f6e\u3001 \u5904\u7406\u548c\u5206\u914d\u7ec4\u4ef6\u7684\u9876\u7ea7\u8d23\u4efb\u3002\u5b83\u5c06\u8d1f\u8d23\u5c06\u5176\u4ed6\u7684 Istio \u7ec4\u4ef6\u4e0e\u4ece\u5e95\u5c42\u5e73\u53f0\uff08\u4f8b\u5982 Kubernetes\uff09\u83b7\u53d6\u7528\u6237\u914d\u7f6e\u7684\u7ec6\u8282\u4e2d\u9694\u79bb\u5f00\u6765\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#33","title":"3.3 \u8bbe\u8ba1\u76ee\u6807","text":"<ul> <li>\u6700\u5927\u5316\u900f\u660e\u5ea6\uff1a\u82e5\u60f3 Istio \u88ab\u91c7\u7eb3\uff0c\u5e94\u8be5\u8ba9\u8fd0\u7ef4\u548c\u5f00\u53d1\u4eba\u5458\u53ea\u9700\u4ed8\u51fa\u5f88\u5c11\u7684\u4ee3\u4ef7\u5c31\u53ef\u4ee5\u4ece\u4e2d\u53d7\u76ca\u3002\u4e3a\u6b64\uff0cIstio \u5c06\u81ea\u8eab\u81ea\u52a8\u6ce8\u5165\u5230\u670d\u52a1\u95f4\u6240\u6709\u7684\u7f51\u7edc\u8def\u5f84\u4e2d\u3002Istio \u4f7f\u7528 sidecar \u4ee3\u7406\u6765\u6355\u83b7\u6d41\u91cf\uff0c\u5e76\u4e14\u5728\u5c3d\u53ef\u80fd\u7684\u5730\u65b9\u81ea\u52a8\u7f16\u7a0b\u7f51\u7edc\u5c42\uff0c\u4ee5\u8def\u7531\u6d41\u91cf\u901a\u8fc7\u8fd9\u4e9b\u4ee3\u7406\uff0c\u800c\u65e0\u9700\u5bf9\u5df2\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u8fdb\u884c\u4efb\u4f55\u6539\u52a8\u3002\u5728 Kubernetes\u4e2d\uff0c\u4ee3\u7406\u88ab\u6ce8\u5165\u5230 pod \u4e2d\uff0c\u901a\u8fc7\u7f16\u5199 iptables \u89c4\u5219\u6765\u6355\u83b7\u6d41\u91cf\u3002\u6ce8\u5165 sidecar \u4ee3\u7406\u5230 pod \u4e2d\u5e76\u4e14\u4fee\u6539\u8def\u7531\u89c4\u5219\u540e\uff0cIstio \u5c31\u80fd\u591f\u8c03\u89e3\u6240\u6709\u6d41\u91cf\u3002\u8fd9\u4e2a\u539f\u5219\u4e5f\u9002\u7528\u4e8e\u6027\u80fd\u3002\u5f53\u5c06 Istio \u5e94\u7528\u4e8e\u90e8\u7f72\u65f6\uff0c\u8fd0\u7ef4\u4eba\u5458\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e3a\u63d0\u4f9b\u8fd9\u4e9b\u529f\u80fd\u800c\u589e\u52a0\u7684\u8d44\u6e90\u5f00\u9500\u662f\u5f88\u5c0f\u7684\u3002\u6240\u6709\u7ec4\u4ef6\u548c API \u5728\u8bbe\u8ba1\u65f6\u90fd\u5fc5\u987b\u8003\u8651\u6027\u80fd\u548c\u89c4\u6a21\u3002</li> <li>\u53ef\u6269\u5c55\u6027\uff1a\u968f\u7740\u8fd0\u7ef4\u4eba\u5458\u548c\u5f00\u53d1\u4eba\u5458\u8d8a\u6765\u8d8a\u4f9d\u8d56 Istio \u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u7cfb\u7edf\u5fc5\u7136\u548c\u4ed6\u4eec\u7684\u9700\u6c42\u4e00\u8d77\u6210\u957f\u3002\u867d\u7136\u6211\u4eec\u671f\u671b\u7ee7\u7eed\u81ea\u5df1\u6dfb\u52a0\u65b0\u529f\u80fd\uff0c\u4f46\u662f\u6211\u4eec\u9884\u8ba1\u6700\u5927\u7684\u9700\u6c42\u662f\u6269\u5c55\u7b56\u7565\u7cfb\u7edf\uff0c\u96c6\u6210\u5176\u4ed6\u7b56\u7565\u548c\u63a7\u5236\u6765\u6e90\uff0c\u5e76\u5c06\u7f51\u683c\u884c\u4e3a\u4fe1\u53f7\u4f20\u64ad\u5230\u5176\u4ed6\u7cfb\u7edf\u8fdb\u884c\u5206\u6790\u3002\u7b56\u7565\u8fd0\u884c\u65f6\u652f\u6301\u6807\u51c6\u6269\u5c55\u673a\u5236\u4ee5\u4fbf\u63d2\u5165\u5230\u5176\u4ed6\u670d\u52a1\u4e2d\u3002\u6b64\u5916\uff0c\u5b83\u5141\u8bb8\u6269\u5c55\u8bcd\u6c47\u8868\uff0c\u4ee5\u5141\u8bb8\u57fa\u4e8e\u7f51\u683c\u751f\u6210\u7684\u65b0\u4fe1\u53f7\u6765\u6267\u884c\u7b56\u7565\u3002</li> <li>\u53ef\u79fb\u690d\u6027\uff1a\u4f7f\u7528 Istio \u7684\u751f\u6001\u7cfb\u7edf\u5c06\u5728\u5f88\u591a\u7ef4\u5ea6\u4e0a\u6709\u5dee\u5f02\u3002Istio \u5fc5\u987b\u80fd\u591f\u4ee5\u6700\u5c11\u7684\u4ee3\u4ef7\u8fd0\u884c\u5728\u4efb\u4f55\u4e91\u6216\u9884\u7f6e\u73af\u5883\u4e2d\u3002\u5c06\u57fa\u4e8e Istio \u7684\u670d\u52a1\u79fb\u690d\u5230\u65b0\u73af\u5883\u5e94\u8be5\u662f\u8f7b\u800c\u6613\u4e3e\u7684\uff0c\u800c\u4f7f\u7528 Istio \u5c06\u4e00\u4e2a\u670d\u52a1\u540c\u65f6\u90e8\u7f72\u5230\u591a\u4e2a\u73af\u5883\u4e2d\u4e5f\u662f\u53ef\u884c\u7684\uff08\u4f8b\u5982\uff0c\u5728\u591a\u4e2a\u4e91\u4e0a\u8fdb\u884c\u5197\u4f59\u90e8\u7f72\uff09\u3002</li> <li>\u7b56\u7565\u4e00\u81f4\u6027\uff1a\u5728\u670d\u52a1\u95f4\u7684 API \u8c03\u7528\u4e2d\uff0c\u7b56\u7565\u7684\u5e94\u7528\u4f7f\u5f97\u53ef\u4ee5\u5bf9\u7f51\u683c\u95f4\u884c\u4e3a\u8fdb\u884c\u5168\u9762\u7684\u63a7\u5236\uff0c\u4f46\u5bf9\u4e8e\u65e0\u9700\u5728 API \u7ea7\u522b\u8868\u8fbe\u7684\u8d44\u6e90\u6765\u8bf4\uff0c\u5bf9\u8d44\u6e90\u5e94\u7528\u7b56\u7565\u4e5f\u540c\u6837\u91cd\u8981\u3002\u4f8b\u5982\uff0c\u5c06\u914d\u989d\u5e94\u7528\u5230 ML \u8bad\u7ec3\u4efb\u52a1\u6d88\u8017\u7684 CPU \u6570\u91cf\u4e0a\uff0c\u6bd4\u5c06\u914d\u989d\u5e94\u7528\u5230\u542f\u52a8\u8fd9\u4e2a\u5de5\u4f5c\u7684\u8c03\u7528\u4e0a\u66f4\u4e3a\u6709\u7528\u3002\u56e0\u6b64\uff0c\u7b56\u7565\u7cfb\u7edf\u4f5c\u4e3a\u72ec\u7279\u7684\u670d\u52a1\u6765\u7ef4\u62a4\uff0c\u5177\u6709\u81ea\u5df1\u7684 API\uff0c\u800c\u4e0d\u662f\u5c06\u5176\u653e\u5230\u4ee3\u7406/sidecar \u4e2d\uff0c\u8fd9\u5bb9\u8bb8\u670d\u52a1\u6839\u636e\u9700\u8981\u76f4\u63a5\u4e0e\u5176\u96c6\u6210\u3002</li> </ul>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_4","title":"\u56db \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#41-katacoda-istio","title":"4.1 katacoda \u90e8\u7f72istio","text":"<pre><code># \u5b89\u88c5cli\u5de5\u5177\ncurl -L https://git.io/getLatestIstio | ISTIO_VERSION=1.0.0 sh -\nexport PATH=\"$PATH:/root/istio-1.0.0/bin\"\ncd /root/istio-1.0.0\n\n# \u914d\u7f6eistio crd\nkubectl apply -f install/kubernetes/helm/istio/templates/crds.yaml -n istio-system\n\n# \u914d\u7f6eTLS\nkubectl apply -f install/kubernetes/istio-demo-auth.yaml\n\n# \u68c0\u6d4b\u914d\u7f6e\nkubectl get pods -n istio-system\n\n# \u914d\u7f6eKatacoda Service\nkubectl apply -f /root/katacoda.yaml\n\n# \u5b89\u88c5\u914d\u7f6e\u5b9e\u4f8b\nkubectl apply -f &lt;(istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml)\n\n# \u90e8\u7f72\u7f51\u5173\nkubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml\n\n# \u5e94\u7528\u9ed8\u8ba4\u89c4\u5219\nkubectl apply -f samples/bookinfo/networking/destination-rule-all-mtls.yaml\n\n\n\n# \u67e5\u770b\u865a\u62df\u670d\u52a1\nistioctl get virtualservices\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#42-minikube-istio","title":"4.2 minikube \u4e2d\u4f53\u9a8cistio","text":"<p>\u5b89\u88c5\u811a\u672c</p> <pre><code>curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\ncat &gt;&gt;/etc/yum.repos.d/kuberetes.repo&lt;&lt;EOF\n[kuberneres]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\ngpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\nenabled=1\nEOF\nyum install docker-ce kubelet kubectl kubeadm -y\nsystemctl start docker\nsystemctl enable docker\nsystemctl enable kubelet\n# \u4e0b\u8f7dminikube\ncurl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v1.2.0/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/\n\n# \u542f\u52a8--vm-driver=none \u9009\u9879\u6765\u5728\u672c\u673a\u8fd0\u884c Kubernetes \u7ec4\u4ef6\nminikube start --vm-driver=none --registry-mirror=https://registry.docker-cn.com\nminikube dashboard\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#421-minikube","title":"4.2.1 minikube\u5b89\u88c5","text":"<p>\u6ce8\u610f\uff1a\u670d\u52a1\u5668\u81f3\u5c112\u9897CPU,\u7531\u4e8e\u5f3a\u7684\u539f\u56e0\uff0c\u56fd\u5185\u5efa\u8bae\u4f7f\u7528\u963f\u91cc\u7684\u6e90\uff0c\u5728linux\u670d\u52a1\u5668\u4e0d\u542f\u52a8virtualbox\uff0c\u5219\u9700\u8981\u5728\u5bbf\u4e3b\u673a\u5b89\u88c5docker\u548ckubelet</p> <ul> <li>\u8bbe\u7f6e docker \u6e90</li> </ul> <pre><code>curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n</code></pre> <ul> <li>\u8bbe\u7f6e k8s \u6e90</li> </ul> <pre><code>cat &gt;&gt;/etc/yum.repos.d/kuberetes.repo&lt;&lt;EOF\n[kuberneres]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\ngpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\nenabled=1\nEOF\n</code></pre> <ul> <li>\u5b89\u88c5 docker-ce \u548c kubelet kubectl</li> </ul> <pre><code>yum install docker-ce kubelet kubectl kubeadm -y\nsystemctl start docker\nsystemctl enable docker\nsystemctl enable kubelet\n# \u4e0b\u8f7dminikube\ncurl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v1.2.0/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/\n\n# \u542f\u52a8--vm-driver=none \u9009\u9879\u6765\u5728\u672c\u673a\u8fd0\u884c Kubernetes \u7ec4\u4ef6\nminikube start --vm-driver=none --registry-mirror=https://registry.docker-cn.com\n\nsudo mv /root/.kube /root/.minikube $HOME\nsudo chown -R $USER $HOME/.kube $HOME/.minikube\n# \u542f\u52a8dashboard\nminikube dashboard\n</code></pre> <p></p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#422-istio","title":"4.2.2 istio \u5b89\u88c5","text":"<ul> <li>\u4e0b\u8f7distio\u5305</li> </ul> <p>\u4e0b\u8f7d Istio \u53d1\u5e03\u5305,</p> <pre><code>curl -L https://git.io/getLatestIstio | ISTIO_VERSION=1.2.2 sh -\ncd istio-1.2.2\n# \u5c06istioctl \u6dfb\u52a0\u5165PATH\ncp bin/istioctl /usr/bin/\nexport PATH=$PWD/bin:$PATH\n\n# \u52a0\u8f7distioctl mainfest   \n</code></pre> <ul> <li>\u5b89\u88c5</li> </ul> <pre><code># \u5b89\u88c5CRD\nfor i in install/kubernetes/helm/istio-init/files/crd*yaml; do kubectl apply -f $i; done\n\n# \u5bbd\u677e\u6a21\u5f0fmutual TLS\nkubectl apply -f install/kubernetes/istio-demo.yaml\n\n\n\n# \u786e\u8ba4\u7ed3\u679c\nkubectl get svc -n istio-system\n# \u67e5\u770bistio-ingressgateway \u5982\u679c\u6ca1\u6709lb\uff0c\u5219\u4e3a\u4e00\u79cdpending\u72b6\u6001\uff0c\u53ef\u4ee5\u5c06\u5176\u4fee\u6539\u4e3aNodePort\u6a21\u5f0f\n\n[root@VM_0_2_centos istio-1.2.2]# kubectl get service -n istio-system\nNAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                                                                                                                                      AGE\ngrafana                  ClusterIP   10.98.106.233    &lt;none&gt;        3000/TCP                                                                                                                                     29m\nistio-citadel            ClusterIP   10.105.117.162   &lt;none&gt;        8060/TCP,15014/TCP                                                                                                                           29m\nistio-egressgateway      ClusterIP   10.96.101.47     &lt;none&gt;        80/TCP,443/TCP,15443/TCP                                                                                                                     29m\nistio-galley             ClusterIP   10.97.227.4      &lt;none&gt;        443/TCP,15014/TCP,9901/TCP                                                                                                                   29m\nistio-ingressgateway     NodePort    10.108.162.3     &lt;none&gt;        15020:31931/TCP,80:31380/TCP,443:31390/TCP,31400:31400/TCP,15029:32205/TCP,15030:31540/TCP,15031:30722/TCP,15032:32366/TCP,15443:31319/TCP   29m\nistio-pilot              ClusterIP   10.111.150.44    &lt;none&gt;        15010/TCP,15011/TCP,8080/TCP,15014/TCP                                                                                                       29m\nistio-policy             ClusterIP   10.101.26.145    &lt;none&gt;        9091/TCP,15004/TCP,15014/TCP                                                                                                                 29m\nistio-sidecar-injector   ClusterIP   10.110.244.53    &lt;none&gt;        443/TCP                                                                                                                                      29m\nistio-telemetry          ClusterIP   10.100.238.134   &lt;none&gt;        9091/TCP,15004/TCP,15014/TCP,42422/TCP                                                                                                       29m\njaeger-agent             ClusterIP   None             &lt;none&gt;        5775/UDP,6831/UDP,6832/UDP                                                                                                                   29m\njaeger-collector         ClusterIP   10.99.246.30     &lt;none&gt;        14267/TCP,14268/TCP                                                                                                                          29m\njaeger-query             ClusterIP   10.109.225.169   &lt;none&gt;        16686/TCP                                                                                                                                    29m\nkiali                    ClusterIP   10.106.46.153    &lt;none&gt;        20001/TCP                                                                                                                                    29m\nprometheus               ClusterIP   10.101.148.126   &lt;none&gt;        9090/TCP                                                                                                                                     29m\ntracing                  ClusterIP   10.109.118.137   &lt;none&gt;        80/TCP                                                                                                                                       29m\nzipkin                   ClusterIP   10.109.133.46    &lt;none&gt;        9411/TCP                                                                                                                                     29m\n\n\n# \u786e\u8ba4\u5fc5\u8981\u7684 Kubernetes Pod \u90fd\u5df2\u7ecf\u521b\u5efa\u5e76\u4e14\u5176 STATUS \u7684\u503c\u662f Running\uff1a\n\n[root@VM_0_2_centos istio-1.2.2]# kubectl get pods -n istio-system\nNAME                                      READY   STATUS      RESTARTS   AGE\ngrafana-6575997f54-zlq9d                  1/1     Running     0          10m\nistio-citadel-894d98c85-hqd8m             1/1     Running     0          10m\nistio-cleanup-secrets-1.2.2-6qdt8         0/1     Completed   0          10m\nistio-egressgateway-9b7866bf5-26q2n       1/1     Running     0          10m\nistio-galley-5b984f89b-95c4c              1/1     Running     0          10m\nistio-grafana-post-install-1.2.2-lv7xg    0/1     Completed   0          10m\nistio-ingressgateway-75ddf64567-jlhf8     1/1     Running     0          10m\nistio-pilot-5d77c559d4-4c5tg              2/2     Running     0          10m\nistio-policy-86478df5d4-qd79g             2/2     Running     5          10m\nistio-security-post-install-1.2.2-lpvmc   0/1     Completed   0          10m\nistio-sidecar-injector-7b98dd6bcc-kc622   1/1     Running     0          10m\nistio-telemetry-786747687f-h9vs6          2/2     Running     5          10m\nistio-tracing-555cf644d-z8pt2             1/1     Running     0          10m\nkiali-6cd6f9dfb5-5ncxr                    1/1     Running     0          10m\nprometheus-7d7b9f7844-wfdcl               1/1     Running     0          10m\n</code></pre> <p>\u5982\u679c\u4f60\u7684\u96c6\u7fa4\u5728\u4e00\u4e2a\u6ca1\u6709\u5916\u90e8\u8d1f\u8f7d\u5747\u8861\u5668\u652f\u6301\u7684\u73af\u5883\u4e2d\u8fd0\u884c\uff08\u4f8b\u5982 Minikube\uff09\uff0c<code>istio-ingressgateway</code> \u7684 <code>EXTERNAL-IP</code> \u4f1a\u662f <code>&lt;pending&gt;</code>\u3002\u8981\u8bbf\u95ee\u8fd9\u4e2a\u7f51\u5173\uff0c\u53ea\u80fd\u901a\u8fc7\u670d\u52a1\u7684 <code>NodePort</code> \u6216\u8005\u4f7f\u7528\u7aef\u53e3\u8f6c\u53d1\u6765\u8fdb\u884c\u8bbf\u95ee\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#423-bookinfo-demo","title":"4.2.3 Bookinfo demo\u4f53\u9a8c","text":"<p>\u90e8\u7f72\u4e00\u4e2a\u6837\u4f8b\u5e94\u7528\uff0c\u5b83\u7531\u56db\u4e2a\u5355\u72ec\u7684\u5fae\u670d\u52a1\u6784\u6210\uff0c\u7528\u6765\u6f14\u793a\u591a\u79cd Istio \u7279\u6027\u3002\u8fd9\u4e2a\u5e94\u7528\u6a21\u4eff\u5728\u7ebf\u4e66\u5e97\u7684\u4e00\u4e2a\u5206\u7c7b\uff0c\u663e\u793a\u4e00\u672c\u4e66\u7684\u4fe1\u606f\u3002\u9875\u9762\u4e0a\u4f1a\u663e\u793a\u4e00\u672c\u4e66\u7684\u63cf\u8ff0\uff0c\u4e66\u7c4d\u7684\u7ec6\u8282\uff08ISBN\u3001\u9875\u6570\u7b49\uff09\uff0c\u4ee5\u53ca\u5173\u4e8e\u8fd9\u672c\u4e66\u7684\u4e00\u4e9b\u8bc4\u8bba\u3002</p> <p>Bookinfo \u5e94\u7528\u5206\u4e3a\u56db\u4e2a\u5355\u72ec\u7684\u5fae\u670d\u52a1\uff1a</p> <ul> <li><code>productpage</code> \uff1a<code>productpage</code> \u5fae\u670d\u52a1\u4f1a\u8c03\u7528 <code>details</code> \u548c <code>reviews</code> \u4e24\u4e2a\u5fae\u670d\u52a1\uff0c\u7528\u6765\u751f\u6210\u9875\u9762\u3002</li> <li><code>details</code> \uff1a\u8fd9\u4e2a\u5fae\u670d\u52a1\u5305\u542b\u4e86\u4e66\u7c4d\u7684\u4fe1\u606f\u3002</li> <li><code>reviews</code> \uff1a\u8fd9\u4e2a\u5fae\u670d\u52a1\u5305\u542b\u4e86\u4e66\u7c4d\u76f8\u5173\u7684\u8bc4\u8bba\u3002\u5b83\u8fd8\u4f1a\u8c03\u7528 <code>ratings</code> \u5fae\u670d\u52a1\u3002</li> <li><code>ratings</code> \uff1a<code>ratings</code> \u5fae\u670d\u52a1\u4e2d\u5305\u542b\u4e86\u7531\u4e66\u7c4d\u8bc4\u4ef7\u7ec4\u6210\u7684\u8bc4\u7ea7\u4fe1\u606f\u3002</li> </ul> <p><code>reviews</code> \u5fae\u670d\u52a1\u6709 3 \u4e2a\u7248\u672c\uff1a</p> <ul> <li>v1 \u7248\u672c\u4e0d\u4f1a\u8c03\u7528 <code>ratings</code> \u670d\u52a1\u3002</li> <li>v2 \u7248\u672c\u4f1a\u8c03\u7528 <code>ratings</code> \u670d\u52a1\uff0c\u5e76\u4f7f\u7528 1 \u5230 5 \u4e2a\u9ed1\u8272\u661f\u5f62\u56fe\u6807\u6765\u663e\u793a\u8bc4\u5206\u4fe1\u606f\u3002</li> <li> <p>v3 \u7248\u672c\u4f1a\u8c03\u7528 <code>ratings</code> \u670d\u52a1\uff0c\u5e76\u4f7f\u7528 1 \u5230 5 \u4e2a\u7ea2\u8272\u661f\u5f62\u56fe\u6807\u6765\u663e\u793a\u8bc4\u5206\u4fe1\u606f\u3002</p> </li> <li> </li> </ul> <p></p> <p>Bookinfo \u662f\u4e00\u4e2a\u5f02\u6784\u5e94\u7528\uff0c\u51e0\u4e2a\u5fae\u670d\u52a1\u662f\u7531\u4e0d\u540c\u7684\u8bed\u8a00\u7f16\u5199\u7684\u3002\u8fd9\u4e9b\u670d\u52a1\u5bf9 Istio \u5e76\u65e0\u4f9d\u8d56\uff0c\u4f46\u662f\u6784\u6210\u4e86\u4e00\u4e2a\u6709\u4ee3\u8868\u6027\u7684\u670d\u52a1\u7f51\u683c\u7684\u4f8b\u5b50\uff1a\u5b83\u7531\u591a\u4e2a\u670d\u52a1\u3001\u591a\u4e2a\u8bed\u8a00\u6784\u6210\uff0c\u5e76\u4e14 <code>reviews</code> \u670d\u52a1\u5177\u6709\u591a\u4e2a\u7248\u672c\u3002</p> <ul> <li> </li> </ul> <p>\u8981\u5728 Istio \u4e2d\u8fd0\u884c\u8fd9\u4e00\u5e94\u7528\uff0c\u65e0\u9700\u5bf9\u5e94\u7528\u81ea\u8eab\u505a\u51fa\u4efb\u4f55\u6539\u53d8\u3002\u6211\u4eec\u53ea\u8981\u7b80\u5355\u7684\u5728 Istio \u73af\u5883\u4e2d\u5bf9\u670d\u52a1\u8fdb\u884c\u914d\u7f6e\u548c\u8fd0\u884c\uff0c\u5177\u4f53\u4e00\u70b9\u8bf4\u5c31\u662f\u628a Envoy sidecar \u6ce8\u5165\u5230\u6bcf\u4e2a\u670d\u52a1\u4e4b\u4e2d\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u6240\u9700\u7684\u5177\u4f53\u547d\u4ee4\u548c\u914d\u7f6e\u65b9\u6cd5\u7531\u8fd0\u884c\u65f6\u73af\u5883\u51b3\u5b9a\uff0c\u800c\u90e8\u7f72\u7ed3\u679c\u8f83\u4e3a\u4e00\u81f4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6240\u6709\u7684\u5fae\u670d\u52a1\u90fd\u548c Envoy sidecar \u96c6\u6210\u5728\u4e00\u8d77\uff0c\u88ab\u96c6\u6210\u670d\u52a1\u6240\u6709\u7684\u51fa\u5165\u6d41\u91cf\u90fd\u88ab sidecar \u6240\u52ab\u6301\uff0c\u8fd9\u6837\u5c31\u4e3a\u5916\u90e8\u63a7\u5236\u51c6\u5907\u4e86\u6240\u9700\u7684 Hook\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5229\u7528 Istio \u63a7\u5236\u5e73\u9762\u4e3a\u5e94\u7528\u63d0\u4f9b\u670d\u52a1\u8def\u7531\u3001\u9065\u6d4b\u6570\u636e\u6536\u96c6\u4ee5\u53ca\u7b56\u7565\u5b9e\u65bd\u7b49\u529f\u80fd\u3002</p> <ul> <li> </li> </ul> <pre><code># \u5728\u4f7f\u7528 kubectl apply \u8fdb\u884c\u5e94\u7528\u90e8\u7f72\u7684\u65f6\u5019\uff0c\u5982\u679c\u76ee\u6807\u547d\u540d\u7a7a\u95f4\u5df2\u7ecf\u6253\u4e0a\u4e86\u6807\u7b7e istio-injection=enabled\uff0cIstio sidecar injector \u4f1a\u81ea\u52a8\u628a Envoy \u5bb9\u5668\u6ce8\u5165\u5230\u4f60\u7684\u5e94\u7528 Pod \u4e4b\u4e2d\u3002\nkubectl label namespace default istio-injection=enabled\n</code></pre> <p>\u5982\u679c\u76ee\u6807\u547d\u540d\u7a7a\u95f4\u4e2d\u6ca1\u6709\u6253\u4e0a <code>istio-injection</code> \u6807\u7b7e\uff0c \u53ef\u4ee5\u4f7f\u7528 <code>istioctl kube-inject</code> \u547d\u4ee4\uff0c\u5728\u90e8\u7f72\u4e4b\u524d\u624b\u5de5\u628a Envoy \u5bb9\u5668\u6ce8\u5165\u5230\u5e94\u7528 Pod \u4e4b\u4e2d\uff1a<code>istioctl kube-inject -f &lt;your-app-spec&gt;.yaml | kubectl apply -f -</code></p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_5","title":"\u5b9e\u9a8c\u6982\u8ff0","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_6","title":"\u67b6\u6784\u62d3\u6251","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_7","title":"\u90e8\u7f72\u5e94\u7528","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#bookinfo","title":"\u90e8\u7f72bookinfo","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#bookinfo_1","title":"\u90e8\u7f72bookinfo\uff1a","text":"<pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f &lt;(istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml)\nservice/details created\nserviceaccount/bookinfo-details created\ndeployment.apps/details-v1 created\nservice/ratings created\nserviceaccount/bookinfo-ratings created\ndeployment.apps/ratings-v1 created\nservice/reviews created\nserviceaccount/bookinfo-reviews created\ndeployment.apps/reviews-v1 created\ndeployment.apps/reviews-v2 created\ndeployment.apps/reviews-v3 created\nservice/productpage created\nserviceaccount/bookinfo-productpage created\ndeployment.apps/productpage-v1 created\n</code></pre> <p>\u4e0a\u9762\u7684\u547d\u4ee4\u4f1a\u542f\u52a8\u5168\u90e8\u7684\u56db\u4e2a\u670d\u52a1\uff0c\u5176\u4e2d\u4e5f\u5305\u62ec\u4e86 <code>reviews</code> \u670d\u52a1\u7684\u4e09\u4e2a\u7248\u672c\uff08<code>v1</code>\u3001<code>v2</code> \u4ee5\u53ca <code>v3</code>\uff09</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#bookinfo_2","title":"\u9a8c\u8bc1bookinfo\u670d\u52a1\u662f\u5426\u542f\u52a8\u5b8c\u6210","text":"<pre><code># \u67e5\u770bpods\u548csvc\n[root@VM_0_2_centos istio-1.2.2]# kubectl get pods\nNAME                             READY   STATUS    RESTARTS   AGE\ndetails-v1-677976f7dc-m7mgw      2/2     Running   0          4m32s\nproductpage-v1-f76db69c5-vqkjv   2/2     Running   0          4m32s\nratings-v1-7f66cd4c87-8b4q6      2/2     Running   0          4m33s\nreviews-v1-77bcd5d4f5-nggcv      2/2     Running   0          4m33s\nreviews-v2-7cdb7475fb-hz8km      2/2     Running   0          4m33s\nreviews-v3-8496dbbbbf-rzwb6      2/2     Running   0          4m33s\n[root@VM_0_2_centos istio-1.2.2]# kubectl get svc\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\ndetails       ClusterIP   10.102.51.14     &lt;none&gt;        9080/TCP   4m46s\nkubernetes    ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP    57m\nproductpage   ClusterIP   10.102.140.244   &lt;none&gt;        9080/TCP   4m46s\nratings       ClusterIP   10.96.187.95     &lt;none&gt;        9080/TCP   4m46s\nreviews       ClusterIP   10.98.206.234    &lt;none&gt;        9080/TCP   4m46s\n\n\n# \u68c0\u67e5\u4e00\u4e0bpod\uff0c\u770bistio\u7684sidecar\u81ea\u52a8\u6ce8\u5165\u662f\u5426\u6210\u529f\nkubectl describe pods details-v1-677976f7dc-m7mgw\n\n# \u8981\u786e\u8ba4 Bookinfo \u5e94\u7528\u7a0b\u5e8f\u6b63\u5728\u8fd0\u884c\uff0c\u8bf7\u901a\u8fc7\u67d0\u4e2a pod \u4e2d\u7684 curl \u547d\u4ee4\u5411\u5176\u53d1\u9001\u8bf7\u6c42\uff0c\u4f8b\u5982\u6765\u81ea ratings\uff1a\n[root@VM_0_2_centos istio-1.2.2]# kubectl exec -it $(kubectl get pod -l app=ratings -o jsonpath='{.items[0].metadata.name}') -c ratings -- curl productpage:9080/productpage | grep -o \"&lt;title&gt;.*&lt;/title&gt;\"\n&lt;title&gt;Simple Bookstore App&lt;/title&gt;\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#ingress-ip","title":"\u786e\u5b9a Ingress \u7684 IP \u548c\u7aef\u53e3","text":"<p>\u73b0\u5728 Bookinfo \u670d\u52a1\u542f\u52a8\u5e76\u8fd0\u884c\u4e2d\uff0c\u4f60\u9700\u8981\u4f7f\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u4ece\u5916\u90e8\u8bbf\u95ee Kubernetes \u96c6\u7fa4\uff0c\u4f8b\u5982\u4f7f\u7528\u6d4f\u89c8\u5668\u3002\u4e00\u4e2a Istio Gateway\u5e94\u7528\u5230\u4e86\u76ee\u6807\u4e2d\u3002</p> <ul> <li>\u4e3a\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49\u5165\u53e3\u7f51\u5173\uff1a</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml\ngateway.networking.istio.io/bookinfo-gateway created\nvirtualservice.networking.istio.io/bookinfo created\n</code></pre> <ul> <li>\u786e\u8ba4\u7f51\u5173\u521b\u5efa\u5b8c\u6210\uff1a</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl get gateway\nNAME               AGE\nbookinfo-gateway   28s\n[root@VM_0_2_centos istio-1.2.2]# kubectl get virtualservice\nNAME       GATEWAYS             HOSTS   AGE\nbookinfo   [bookinfo-gateway]   [*]     37s\n</code></pre> <ul> <li>\u6839\u636e\u6587\u6863\u8bbe\u7f6e\u8bbf\u95ee\u7f51\u5173\u7684 <code>INGRESS_HOST</code> \u548c <code>INGRESS_PORT</code> \u53d8\u91cf\u3002\u786e\u8ba4\u5e76\u8bbe\u7f6e\u3002</li> </ul> <p>\u542f\u52a8 httpbin \u6837\u672c\uff0c\u8be5\u6837\u672c\u5c06\u7528\u4f5c\u8981\u5728\u5916\u90e8\u516c\u5f00\u7684\u76ee\u6807\u670d\u52a1\u3002</p> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f &lt;(istioctl kube-inject -f samples/httpbin/httpbin.yaml)\nservice/httpbin created\ndeployment.extensions/httpbin created\n</code></pre> <p>\u786e\u5b9a\u5165\u53e3 IP \u548c\u7aef\u53e3</p> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl get svc istio-ingressgateway -n istio-system\nNAME                   TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                                                                                                                                      AGE\nistio-ingressgateway   NodePort   10.108.162.3   &lt;none&gt;        15020:31931/TCP,80:31380/TCP,443:31390/TCP,31400:31400/TCP,15029:32205/TCP,15030:31540/TCP,15031:30722/TCP,15032:32366/TCP,15443:31319/TCP   36m\n</code></pre> <p>\u5982\u679c <code>EXTERNAL-IP</code> \u6709\u503c\uff08IP \u5730\u5740\u6216\u4e3b\u673a\u540d\uff09\uff0c\u5219\u8bf4\u660e\u60a8\u7684\u73af\u5883\u5177\u6709\u53ef\u7528\u4e8e Ingress \u7f51\u5173\u7684\u5916\u90e8\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u5982\u679c <code>EXTERNAL-IP</code> \u503c\u662f <code>&lt;none&gt;</code>\uff08\u6216\u4e00\u76f4\u662f <code>&lt;pending&gt;</code> \uff09\uff0c\u5219\u8bf4\u660e\u53ef\u80fd\u60a8\u7684\u73af\u5883\u5e76\u6ca1\u6709\u4e3a Ingress \u7f51\u5173\u63d0\u4f9b\u5916\u90e8\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u529f\u80fd\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Service \u7684 node port \u65b9\u5f0f\u8bbf\u95ee\u7f51\u5173\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#node-port-ingress-ip","title":"\u786e\u5b9a\u4f7f\u7528 Node Port \u65f6\u7684 ingress IP \u548c\u7aef\u53e3","text":"<pre><code>export INGRESS_PORT=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.spec.ports[?(@.name==\"http2\")].nodePort}')\nexport SECURE_INGRESS_PORT=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.spec.ports[?(@.name==\"https\")].nodePort}')\nexport INGRESS_HOST=$(minikube ip)\n</code></pre> <ul> <li>\u8bbe\u7f6e <code>GATEWAY_URL</code>\uff1a</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# export GATEWAY_URL=$INGRESS_HOST:$INGRESS_PORT\n[root@VM_0_2_centos istio-1.2.2]# echo $GATEWAY_URL\n172.16.0.2:31380\n\n# \u786e\u8ba4\u5e94\u7528\n[root@VM_0_2_centos istio-1.2.2]# curl -s http://${GATEWAY_URL}/productpage | grep -o \"&lt;title&gt;.*&lt;/title&gt;\"\n&lt;title&gt;Simple Bookstore App&lt;/title&gt;\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#istio_1","title":"istio \u529f\u80fd\u6d4b\u8bd5(\u6d41\u91cf\u7ba1\u7406)","text":"<p>\u7531\u4e8edemo\u73af\u5883\u4e3a\u817e\u8baf\u4e91CVM\uff0c\u4f7f\u7528\u516c\u7f51IP\u8fdb\u884c\u8bbf\u95ee</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_8","title":"\u8bf7\u6c42\u8def\u7531","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_9","title":"\u5e94\u7528\u7f3a\u7701\u76ee\u6807\u89c4\u5219","text":"<p>\u5728\u4f7f\u7528 Istio \u63a7\u5236 Bookinfo \u7248\u672c\u8def\u7531\u4e4b\u524d\uff0c\u4f60\u9700\u8981\u5728\u76ee\u6807\u89c4\u5219\u4e2d\u5b9a\u4e49\u597d\u53ef\u7528\u7684\u7248\u672c\uff0c\u547d\u540d\u4e3a subsets \u3002</p> <p>\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e3a Bookinfo \u670d\u52a1\u521b\u5efa\u7684\u9ed8\u8ba4\u7684\u76ee\u6807\u89c4\u5219\uff1a</p> <p>\u5982\u679c\u4e0d\u9700\u8981\u542f\u7528\u53cc\u5411TLS\uff0c\u8bf7\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/bookinfo/networking/destination-rule-all.yaml\ndestinationrule.networking.istio.io/productpage created\ndestinationrule.networking.istio.io/reviews created\ndestinationrule.networking.istio.io/ratings created\ndestinationrule.networking.istio.io/details created\n\n# \u67e5\u770b\u76ee\u6807\u89c4\u5219\n[root@VM_0_2_centos istio-1.2.2]# kubectl get destinationrules -o yaml\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_10","title":"istio\u7b14\u8bb0","text":"<p>Istio Bookinfo \u793a\u4f8b\u5305\u542b\u56db\u4e2a\u72ec\u7acb\u7684\u5fae\u670d\u52a1\uff0c\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u6709\u591a\u4e2a\u7248\u672c\u3002 \u5176\u4e2d\u4e00\u4e2a\u5fae\u670d\u52a1 <code>reviews</code> \u7684\u4e09\u4e2a\u4e0d\u540c\u7248\u672c\u5df2\u7ecf\u90e8\u7f72\u5e76\u540c\u65f6\u8fd0\u884c\u3002 \u4e3a\u4e86\u8bf4\u660e\u8fd9\u5bfc\u81f4\u7684\u95ee\u9898\uff0c\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95ee Bookinfo \u5e94\u7528\u7a0b\u5e8f\u7684 <code>/productpage</code> \u5e76\u5237\u65b0\u51e0\u6b21\u3002 \u60a8\u4f1a\u6ce8\u610f\u5230\uff0c\u6709\u65f6\u4e66\u8bc4\u7684\u8f93\u51fa\u5305\u542b\u661f\u7ea7\u8bc4\u5206\uff0c\u6709\u65f6\u5219\u4e0d\u5305\u542b\u3002 \u8fd9\u662f\u56e0\u4e3a\u6ca1\u6709\u660e\u786e\u7684\u9ed8\u8ba4\u670d\u52a1\u7248\u672c\u8def\u7531\uff0cIstio \u5c06\u4ee5\u5faa\u73af\u65b9\u5f0f\u8bf7\u6c42\u8def\u7531\u5230\u6240\u6709\u53ef\u7528\u7248\u672c\u3002</p> <p>\u6b64\u4efb\u52a1\u7684\u6700\u521d\u76ee\u6807\u662f\u5e94\u7528\u5c06\u6240\u6709\u6d41\u91cf\u8def\u7531\u5230\u5fae\u670d\u52a1\u7684 <code>v1</code> \u7248\u672c\u7684\u89c4\u5219\u3002\u7a0d\u540e\uff0c \u60a8\u5c06\u5e94\u7528\u89c4\u5219\u6839\u636e HTTP \u8bf7\u6c42 header \u7684\u503c\u8def\u7531\u6d41\u91cf\u3002</p> <p>\u5e94\u7528 virtual service</p> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\nvirtualservice.networking.istio.io/productpage created\nvirtualservice.networking.istio.io/reviews created\nvirtualservice.networking.istio.io/ratings created\nvirtualservice.networking.istio.io/details created\n\n[root@VM_0_2_centos istio-1.2.2]# kubectl get virtualservices\nNAME          GATEWAYS             HOSTS           AGE\nbookinfo      [bookinfo-gateway]   [*]             54m\ndetails                            [details]       44s\nproductpage                        [productpage]   44s\nratings                            [ratings]       44s\nreviews                            [reviews]       44s\n\n[root@VM_0_2_centos istio-1.2.2]# kubectl get destinationrules\nNAME          HOST          AGE\ndetails       details       21m\nproductpage   productpage   21m\nratings       ratings       21m\nreviews       reviews       21m\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u65e0\u8bba\u60a8\u5237\u65b0\u591a\u5c11\u6b21\uff0c\u9875\u9762\u7684\u8bc4\u8bba\u90e8\u5206\u90fd\u4e0d\u4f1a\u663e\u793a\u8bc4\u7ea7\u661f\u6807\u3002\u8fd9\u662f\u56e0\u4e3a\u60a8\u5c06 Istio \u914d\u7f6e\u4e3a\u5c06\u8bc4\u8bba\u670d\u52a1\u7684\u6240\u6709\u6d41\u91cf\u8def\u7531\u5230\u7248\u672c <code>reviews:v1</code>\uff0c\u5e76\u4e14\u6b64\u7248\u672c\u7684\u670d\u52a1\u4e0d\u8bbf\u95ee\u661f\u7ea7\u8bc4\u5206\u670d\u52a1\u3002</p> <p></p> <p>\u6d4b\u8bd5\u5c06\u6d41\u91cf\u8def\u7531\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_11","title":"\u57fa\u4e8e\u7528\u6237\u8eab\u4efd\u7684\u8def\u7531","text":"<p>\u63a5\u4e0b\u6765\uff0c\u60a8\u5c06\u66f4\u6539\u8def\u7531\u914d\u7f6e\uff0c\u4ee5\u4fbf\u5c06\u6765\u81ea\u7279\u5b9a\u7528\u6237\u7684\u6240\u6709\u6d41\u91cf\u8def\u7531\u5230\u7279\u5b9a\u670d\u52a1\u7248\u672c\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6765\u81ea\u540d\u4e3a Jason \u7684\u7528\u6237\u7684\u6240\u6709\u6d41\u91cf\u5c06\u88ab\u8def\u7531\u5230\u670d\u52a1 <code>reviews:v2</code>\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0cIstio \u5bf9\u7528\u6237\u8eab\u4efd\u6ca1\u6709\u4efb\u4f55\u7279\u6b8a\u7684\u5185\u7f6e\u673a\u5236\u3002\u8fd9\u4e2a\u4f8b\u5b50\u7684\u57fa\u7840\u5728\u4e8e\uff0c <code>productpage</code> \u670d\u52a1\u5728\u6240\u6709\u9488\u5bf9 <code>reviews</code> \u670d\u52a1\u7684\u8c03\u7528\u8bf7\u6c42\u4e2d \u90fd\u52a0\u81ea\u5b9a\u4e49\u7684 HTTP header\uff0c\u4ece\u800c\u8fbe\u5230\u5728\u6d41\u91cf\u4e2d\u5bf9\u6700\u7ec8\u7528\u6237\u8eab\u4efd\u8bc6\u522b\u7684\u8fd9\u4e00\u6548\u679c\u3002</p> <pre><code>#\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u542f\u7528\u57fa\u4e8e\u7528\u6237\u7684\u8def\u7531\n[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-test-v2.yaml\nvirtualservice.networking.istio.io/reviews configured\n[root@VM_0_2_centos istio-1.2.2]# kubectl get virtualservice reviews -o yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"VirtualService\",\"metadata\":{\"annotations\":{},\"name\":\"reviews\",\"namespace\":\"default\"},\"spec\":{\"hosts\":[\"reviews\"],\"http\":[{\"match\":[{\"headers\":{\"end-user\":{\"exact\":\"jason\"}}}],\"route\":[{\"destination\":{\"host\":\"reviews\",\"subset\":\"v2\"}}]},{\"route\":[{\"destination\":{\"host\":\"reviews\",\"subset\":\"v1\"}}]}]}}\n  creationTimestamp: \"2019-08-05T09:48:04Z\"\n  generation: 2\n  name: reviews\n  namespace: default\n  resourceVersion: \"10861\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/reviews\n  uid: f7c51bdf-0023-4520-ba1b-4d38ad65212e\nspec:\n  hosts:\n  - reviews\n  http:\n  - match:\n    - headers:\n        end-user:\n          exact: jason\n    route:\n    - destination:\n        host: reviews\n        subset: v2\n  - route:\n    - destination:\n        host: reviews\n        subset: v1\n</code></pre> <p>\u5728 Bookinfo \u5e94\u7528\u7a0b\u5e8f\u7684 <code>/productpage</code> \u4e0a\uff0c\u4ee5\u7528\u6237 <code>jason</code> \u8eab\u4efd\u767b\u5f55\u3002</p> <p></p> <p>\u4ee5\u5176\u4ed6\u7528\u6237\u8eab\u4efd\u767b\u5f55\uff08\u9009\u62e9\u60a8\u60f3\u8981\u7684\u4efb\u4f55\u540d\u79f0\uff09\uff0c\u5237\u65b0\u6d4f\u89c8\u5668\u3002\u73b0\u5728\u661f\u661f\u6d88\u5931\u4e86\u3002\u8fd9\u662f\u56e0\u4e3a\u9664\u4e86 Jason \u4e4b\u5916\uff0c\u6240\u6709\u7528\u6237\u7684\u6d41\u91cf\u90fd\u88ab\u8def\u7531\u5230 <code>reviews:v1</code>\u3002</p> <ul> <li><code>productpage</code> \u2192 <code>reviews:v2</code> \u2192 <code>ratings</code> (<code>jason</code> \u7528\u6237)</li> <li><code>productpage</code> \u2192 <code>reviews:v1</code> (\u5176\u4ed6\u7528\u6237)</li> </ul>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_12","title":"\u539f\u7406","text":"<p>\u5728\u6b64\u4efb\u52a1\u4e2d\uff0c\u60a8\u9996\u5148\u4f7f\u7528 Istio \u5c06 100% \u7684\u8bf7\u6c42\u6d41\u91cf\u90fd\u8def\u7531\u5230\u4e86 Bookinfo \u670d\u52a1\u7684 v1 \u7248\u672c\u3002 \u7136\u540e\u518d\u8bbe\u7f6e\u4e86\u4e00\u6761\u8def\u7531\u89c4\u5219\uff0c\u5728 <code>productpage</code> \u670d\u52a1\u4e2d\u6dfb\u52a0\u4e86\u8def\u7531\u89c4\u5219\uff0c\u8fd9\u4e00\u89c4\u5219\u6839\u636e\u8bf7\u6c42\u7684 <code>end-user</code> \u81ea\u5b9a\u4e49 header \u5185\u5bb9\uff0c\u9009\u62e9\u6027\u5730\u5c06\u7279\u5b9a\u7684\u6d41\u91cf\u8def\u7531\u5230\u4e86 <code>reviews</code> \u670d\u52a1\u7684 <code>v2</code> \u7248\u672c\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u4e3a\u4e86\u5229\u7528 Istio \u7684 L7 \u8def\u7531\u529f\u80fd\uff0cKubernetes \u4e2d\u7684\u670d\u52a1\uff08\u5982\u672c\u4efb\u52a1\u4e2d\u4f7f\u7528\u7684 Bookinfo \u670d\u52a1\uff09\u5fc5\u987b\u9075\u5b88\u67d0\u4e9b\u7279\u5b9a\u9650\u5236\u3002 \u53c2\u8003 sidecar \u6ce8\u5165\u6587\u6863\u4e86\u89e3\u8be6\u60c5\u3002</p> <p>\u5728\u6d41\u91cf\u8f6c\u79fb\u4efb\u52a1\u4e2d\uff0c\u60a8\u5c06\u6309\u7167\u5728\u6b64\u5904\u5b66\u4e60\u7684\u76f8\u540c\u57fa\u672c\u6a21\u5f0f\u6765\u914d\u7f6e\u8def\u7531\u89c4\u5219\uff0c\u4ee5\u9010\u6b65\u5c06\u6d41\u91cf\u4ece\u670d\u52a1\u7684\u4e00\u4e2a\u7248\u672c\u53d1\u9001\u5230\u53e6\u4e00\u4e2a\u7248\u672c\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_13","title":"\u6e05\u7406","text":"<p>\u5982\u679c\u4e0d\u64cd\u4f5c\u540e\u7eed\u5b9e\u9a8c\uff0c\u53ef\u4ee5\u8fdb\u884c\u6e05\u7406</p> <pre><code>kubectl delete -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_14","title":"\u6545\u969c\u6ce8\u5165","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#http","title":"\u4f7f\u7528 HTTP \u5ef6\u8fdf\u8fdb\u884c\u6545\u969c\u6ce8\u5165","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5\u5fae\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f Bookinfo \u7684\u5f39\u6027\uff0c\u6211\u4eec\u5c06\u4e3a\u7528\u6237 <code>jason</code> \u5728 <code>reviews:v2</code> \u548c <code>ratings</code> \u670d\u52a1\u4e4b\u95f4\u6ce8\u5165\u4e00\u4e2a 7 \u79d2\u7684\u5ef6\u8fdf\u3002 \u8fd9\u4e2a\u6d4b\u8bd5\u5c06\u4f1a\u53d1\u73b0\u6545\u610f\u5f15\u5165 Bookinfo \u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u9519\u8bef\u3002</p> <p>\u7531\u4e8e <code>reviews:v2</code> \u670d\u52a1\u5bf9\u5176 ratings \u670d\u52a1\u7684\u8c03\u7528\u5177\u6709 10 \u79d2\u7684\u786c\u7f16\u7801\u8fde\u63a5\u8d85\u65f6\uff0c\u6bd4\u6211\u4eec\u8bbe\u7f6e\u7684 7s \u5ef6\u8fdf\u8981\u5927\uff0c\u56e0\u6b64\u6211\u4eec\u671f\u671b\u7aef\u5230\u7aef\u6d41\u7a0b\u662f\u6b63\u5e38\u7684\uff08\u6ca1\u6709\u4efb\u4f55\u9519\u8bef\uff09\u3002</p> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/bookinfo/networking/virtual-service-ratings-test-delay.yaml\nvirtualservice.networking.istio.io/ratings configured\n[root@VM_0_2_centos istio-1.2.2]# kubectl get virtualservices\nNAME          GATEWAYS             HOSTS           AGE\nbookinfo      [bookinfo-gateway]   [*]             70m\ndetails                            [details]       17m\nproductpage                        [productpage]   17m\nratings                            [ratings]       17m\nreviews                            [reviews]       17m\n[root@VM_0_2_centos istio-1.2.2]# kubectl get virtualservices ratings -o yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"VirtualService\",\"metadata\":{\"annotations\":{},\"name\":\"ratings\",\"namespace\":\"default\"},\"spec\":{\"hosts\":[\"ratings\"],\"http\":[{\"fault\":{\"delay\":{\"fixedDelay\":\"7s\",\"percentage\":{\"value\":100}}},\"match\":[{\"headers\":{\"end-user\":{\"exact\":\"jason\"}}}],\"route\":[{\"destination\":{\"host\":\"ratings\",\"subset\":\"v1\"}}]},{\"route\":[{\"destination\":{\"host\":\"ratings\",\"subset\":\"v1\"}}]}]}}\n  creationTimestamp: \"2019-08-05T09:48:04Z\"\n  generation: 2\n  name: ratings\n  namespace: default\n  resourceVersion: \"11757\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/ratings\n  uid: 212f39f7-9797-4ec0-99d9-f4ed7df7beb6\nspec:\n  hosts:\n  - ratings\n  http:\n  - fault:\n      delay:\n        fixedDelay: 7s\n        percentage:\n          value: 100\n    match:\n    - headers:\n        end-user:\n          exact: jason\n    route:\n    - destination:\n        host: ratings\n        subset: v1\n  - route:\n    - destination:\n        host: ratings\n        subset: v1\n</code></pre> <p>\u4f7f\u7528\u7528\u6237 <code>jason</code> \u767b\u9646\u5230 <code>/productpage</code> \u754c\u9762\u3002\u4f60\u671f\u671b Bookinfo \u4e3b\u9875\u5728\u5927\u7ea6 7 \u79d2\u949f\u52a0\u8f7d\u5b8c\u6210\u5e76\u4e14\u6ca1\u6709\u9519\u8bef\u3002\u4f46\u662f\uff0c\u51fa\u73b0\u4e86\u4e00\u4e2a\u95ee\u9898\uff0cReviews \u90e8\u5206\u663e\u793a\u4e86\u9519\u8bef\u6d88\u606f\uff1a</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_15","title":"\u539f\u7406","text":"<p>\u4f60\u53d1\u73b0\u4e86\u4e00\u4e2a bug\u3002\u5728\u5fae\u670d\u52a1\u4e2d\u6709\u786c\u7f16\u7801\u8d85\u65f6\uff0c\u5bfc\u81f4 <code>reviews</code> \u670d\u52a1\u5931\u8d25\u3002</p> <p>\u5728 <code>productpage</code> \u548c <code>reviews</code> \u670d\u52a1\u4e4b\u95f4\u8d85\u65f6\u65f6\u95f4\u662f 6s - \u7f16\u7801 3s + 1 \u6b21\u91cd\u8bd5\u603b\u5171 6s \uff0c<code>reviews</code> \u548c <code>ratings</code> \u670d\u52a1\u4e4b\u95f4\u7684\u786c\u7f16\u7801\u8fde\u63a5\u8d85\u65f6\u4e3a 10s \u3002\u7531\u4e8e\u6211\u4eec\u5f15\u5165\u7684\u5ef6\u65f6\uff0c<code>/productpage</code> \u63d0\u524d\u8d85\u65f6\u5e76\u5f15\u53d1\u9519\u8bef\u3002</p> <p>\u8fd9\u4e9b\u7c7b\u578b\u7684\u9519\u8bef\u53ef\u80fd\u53d1\u751f\u5728\u5178\u578b\u7684\u4f01\u4e1a\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u5176\u4e2d\u4e0d\u540c\u7684\u56e2\u961f\u72ec\u7acb\u5730\u5f00\u53d1\u4e0d\u540c\u7684\u5fae\u670d\u52a1\u3002Istio \u7684\u6545\u969c\u6ce8\u5165\u89c4\u5219\u53ef\u5e2e\u52a9\u60a8\u8bc6\u522b\u6b64\u7c7b\u5f02\u5e38\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u6700\u7ec8\u7528\u6237\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_16","title":"\u9519\u8bef\u4fee\u590d","text":"<p>\u4f60\u901a\u5e38\u4f1a\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898\uff1a</p> <ol> <li>\u8981\u4e48\u589e\u52a0 <code>/productpage</code> \u7684\u8d85\u65f6\u6216\u8005\u51cf\u5c11 <code>reviews</code> \u5230 <code>ratings</code> \u670d\u52a1\u7684\u8d85\u65f6</li> <li>\u7ec8\u6b62\u5e76\u91cd\u542f\u5fae\u670d\u52a1</li> <li>\u786e\u8ba4 <code>productpage</code> \u6b63\u5e38\u54cd\u5e94\u5e76\u4e14\u6ca1\u6709\u4efb\u4f55\u9519\u8bef\u3002</li> </ol> <p>\u4f46\u662f\uff0c\u6211\u4eec\u5df2\u7ecf\u5728 <code>reviews</code> \u670d\u52a1\u7684 v3 \u7248\u4e2d\u8fd0\u884c\u6b64\u4fee\u590d\u7a0b\u5e8f\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c06\u6240\u6709\u6d41\u91cf\u8fc1\u79fb\u5230 <code>reviews:v3</code> \u6765\u89e3\u51b3\u95ee\u9898\uff0c \u5982\u6d41\u91cf\u8f6c\u79fb\u4e2d\u6240\u8ff0\u4efb\u52a1\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#http-abort","title":"\u4f7f\u7528 HTTP abort \u8fdb\u884c\u6545\u969c\u6ce8\u5165","text":"<p>\u6d4b\u8bd5\u5fae\u670d\u52a1\u5f39\u6027\u7684\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u5f15\u5165 HTTP abort \u6545\u969c\u3002\u5728\u8fd9\u4e2a\u4efb\u52a1\u4e2d\uff0c\u5728 <code>ratings</code> \u5fae\u670d\u52a1\u4e2d\u5f15\u5165 HTTP abort \uff0c\u6d4b\u8bd5\u7528\u6237\u4e3a <code>jason</code> \u3002</p> <p>\u5728\u8fd9\u4e2a\u6848\u4f8b\u4e2d\uff0c\u6211\u4eec\u5e0c\u671b\u9875\u9762\u80fd\u591f\u7acb\u5373\u52a0\u8f7d\uff0c\u540c\u65f6\u663e\u793a <code>Ratings service is currently unavailable</code> \u8fd9\u6837\u7684\u6d88\u606f\u3002</p> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/bookinfo/networking/virtual-service-ratings-test-abort.yaml\nvirtualservice.networking.istio.io/ratings configured\n[root@VM_0_2_centos istio-1.2.2]# kubectl get virtualservice ratings -o yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"VirtualService\",\"metadata\":{\"annotations\":{},\"name\":\"ratings\",\"namespace\":\"default\"},\"spec\":{\"hosts\":[\"ratings\"],\"http\":[{\"fault\":{\"abort\":{\"httpStatus\":500,\"percentage\":{\"value\":100}}},\"match\":[{\"headers\":{\"end-user\":{\"exact\":\"jason\"}}}],\"route\":[{\"destination\":{\"host\":\"ratings\",\"subset\":\"v1\"}}]},{\"route\":[{\"destination\":{\"host\":\"ratings\",\"subset\":\"v1\"}}]}]}}\n  creationTimestamp: \"2019-08-05T09:48:04Z\"\n  generation: 3\n  name: ratings\n  namespace: default\n  resourceVersion: \"12538\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/ratings\n  uid: 212f39f7-9797-4ec0-99d9-f4ed7df7beb6\nspec:\n  hosts:\n  - ratings\n  http:\n  - fault:\n      abort:\n        httpStatus: 500\n        percentage:\n          value: 100\n    match:\n    - headers:\n        end-user:\n          exact: jason\n    route:\n    - destination:\n        host: ratings\n        subset: v1\n  - route:\n    - destination:\n        host: ratings\n        subset: v1\n</code></pre> <p>\u4f7f\u7528\u7528\u6237 <code>jason</code> \u767b\u9646\u5230 <code>/productpage</code> \u754c\u9762\u3002</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_17","title":"\u6e05\u7406","text":"<pre><code>kubectl delete -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_18","title":"\u6d41\u91cf\u8fc1\u79fb","text":"<p>\u4e00\u4e2a\u5e38\u89c1\u7684\u7528\u4f8b\u662f\u5c06\u6d41\u91cf\u4ece\u4e00\u4e2a\u7248\u672c\u7684\u5fae\u670d\u52a1\u9010\u6e10\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u7248\u672c\u3002\u5728 Istio \u4e2d\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u4e00\u7cfb\u5217\u89c4\u5219\u6765\u5b9e\u73b0\u6b64\u76ee\u6807\uff0c\u8fd9\u4e9b\u89c4\u5219\u5c06\u4e00\u5b9a\u767e\u5206\u6bd4\u7684\u6d41\u91cf\u8def\u7531\u5230\u4e00\u4e2a\u6216\u53e6\u4e00\u4e2a\u670d\u52a1\u3002\u5728\u6b64\u4efb\u52a1\u4e2d\uff0c\u60a8\u5c06 50\uff05 \u7684\u6d41\u91cf\u53d1\u9001\u5230 <code>reviews:v1</code>\uff0c\u53e6\u5916 50\uff05 \u7684\u6d41\u91cf\u53d1\u9001\u5230 <code>reviews:v3</code>\u3002\u7136\u540e\u5c06 100\uff05 \u7684\u6d41\u91cf\u53d1\u9001\u5230 <code>reviews:v3</code> \u6765\u5b8c\u6210\u8fc1\u79fb\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_19","title":"\u5e94\u7528\u57fa\u4e8e\u6743\u91cd\u7684\u8def\u7531","text":"<ol> <li>\u5c06\u6240\u6709\u6d41\u91cf\u8def\u7531\u5230 <code>v1</code> \u7248\u672c\u7684\u5404\u4e2a\u5fae\u670d\u52a1\u3002</li> </ol> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\nvirtualservice.networking.istio.io/productpage unchanged\nvirtualservice.networking.istio.io/reviews configured\nvirtualservice.networking.istio.io/ratings configured\nvirtualservice.networking.istio.io/details unchanged\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u4e0d\u7ba1\u5237\u65b0\u591a\u5c11\u6b21\uff0c\u9875\u9762\u7684\u8bc4\u8bba\u90e8\u5206\u90fd\u4e0d\u4f1a\u663e\u793a\u8bc4\u7ea7\u661f\u53f7\u3002\u8fd9\u662f\u56e0\u4e3a Istio \u88ab\u914d\u7f6e\u4e3a\u5c06 reviews \u670d\u52a1\u7684\u7684\u6240\u6709\u6d41\u91cf\u90fd\u8def\u7531\u5230\u4e86 <code>reviews:v1</code> \u7248\u672c\uff0c \u800c\u8be5\u7248\u672c\u7684\u670d\u52a1\u4e0d\u4f1a\u8bbf\u95ee\u5e26\u661f\u7ea7\u7684 ratings \u670d\u52a1\u3002</p> <ol> <li>\u628a 50% \u7684\u6d41\u91cf\u4ece <code>reviews:v1</code> \u8f6c\u79fb\u5230 <code>reviews:v3</code>\uff1a</li> </ol> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-50-v3.yaml\nvirtualservice.networking.istio.io/reviews configured\n[root@VM_0_2_centos istio-1.2.2]# kubectl get virtualservice reviews -o yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"VirtualService\",\"metadata\":{\"annotations\":{},\"name\":\"reviews\",\"namespace\":\"default\"},\"spec\":{\"hosts\":[\"reviews\"],\"http\":[{\"route\":[{\"destination\":{\"host\":\"reviews\",\"subset\":\"v1\"},\"weight\":50},{\"destination\":{\"host\":\"reviews\",\"subset\":\"v3\"},\"weight\":50}]}]}}\n  creationTimestamp: \"2019-08-05T09:48:04Z\"\n  generation: 4\n  name: reviews\n  namespace: default\n  resourceVersion: \"13220\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/reviews\n  uid: f7c51bdf-0023-4520-ba1b-4d38ad65212e\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v1\n      weight: 50\n    - destination:\n        host: reviews\n        subset: v3\n      weight: 50\n</code></pre> <p>\u5237\u65b0\u6d4f\u89c8\u5668\u4e2d\u7684 <code>/productpage</code> \u9875\u9762\uff0c\u5927\u7ea6\u6709 50% \u7684\u51e0\u7387\u4f1a\u770b\u5230\u9875\u9762\u4e2d\u51fa\u5e26\u7ea2\u8272\u661f\u7ea7\u7684\u8bc4\u4ef7\u5185\u5bb9\u3002\u8fd9\u662f\u56e0\u4e3a <code>v3</code> \u7248\u672c\u7684 <code>reviews</code>\u8bbf\u95ee\u4e86\u5e26\u661f\u7ea7\u8bc4\u7ea7\u7684 <code>ratings</code> \u670d\u52a1\uff0c\u4f46 <code>v1</code> \u7248\u672c\u5374\u6ca1\u6709\u3002</p> <ol> <li>\u5982\u679c\u60a8\u8ba4\u4e3a <code>reviews:v3</code> \u5fae\u670d\u52a1\u5df2\u7ecf\u7a33\u5b9a\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5e94\u7528\u6b64 virtual service \u5c06 100% \u7684\u6d41\u91cf\u8def\u7531\u5230 <code>reviews:v3</code></li> </ol> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-v3.yaml\nvirtualservice.networking.istio.io/reviews configured\n[root@VM_0_2_centos istio-1.2.2]# kubectl get virtualservice reviews -o yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"VirtualService\",\"metadata\":{\"annotations\":{},\"name\":\"reviews\",\"namespace\":\"default\"},\"spec\":{\"hosts\":[\"reviews\"],\"http\":[{\"route\":[{\"destination\":{\"host\":\"reviews\",\"subset\":\"v3\"}}]}]}}\n  creationTimestamp: \"2019-08-05T09:48:04Z\"\n  generation: 5\n  name: reviews\n  namespace: default\n  resourceVersion: \"13348\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/reviews\n  uid: f7c51bdf-0023-4520-ba1b-4d38ad65212e\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v3\n</code></pre> <p>\u5237\u65b0 <code>/productpage</code> \u65f6\uff0c\u60a8\u5c06\u59cb\u7ec8\u770b\u5230\u5e26\u6709\u7ea2\u8272\u661f\u7ea7\u8bc4\u5206\u7684\u4e66\u8bc4\u3002</p> <p>\u5728\u8fd9\u9879\u4efb\u52a1\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 Istio \u7684\u52a0\u6743\u8def\u7531\u529f\u80fd\u5c06\u6d41\u91cf\u4ece\u65e7\u7248\u672c\u7684 <code>reviews</code> \u670d\u52a1\u8fc1\u79fb\u5230\u65b0\u7248\u672c\u3002\u8bf7\u6ce8\u610f\uff0c\u8fd9\u548c\u4f7f\u7528\u5bb9\u5668\u7f16\u6392\u5e73\u53f0\u7684\u90e8\u7f72\u529f\u80fd\u6765\u8fdb\u884c\u7248\u672c\u8fc1\u79fb\u5b8c\u5168\u4e0d\u540c\uff0c\u540e\u8005\u4f7f\u7528\u4e86\u5b9e\u4f8b\u6269\u5bb9\u6765\u5bf9\u6d41\u91cf\u8fdb\u884c\u7ba1\u7406\u3002</p> <p>\u4f7f\u7528 Istio\uff0c\u4e24\u4e2a\u7248\u672c\u7684 <code>reviews</code> \u670d\u52a1\u53ef\u4ee5\u72ec\u7acb\u5730\u8fdb\u884c\u6269\u5bb9\u548c\u7f29\u5bb9\uff0c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u8fd9\u4e24\u4e2a\u7248\u672c\u670d\u52a1\u4e4b\u95f4\u7684\u6d41\u91cf\u5206\u53d1\u3002</p> <p>\u5982\u679c\u60f3\u4e86\u89e3\u652f\u6301\u81ea\u52a8\u4f38\u7f29\u7684\u7248\u672c\u8def\u7531\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b\u4f7f\u7528 Istio \u7684 Canary Deployments \u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_20","title":"\u6e05\u7406","text":"<pre><code>kubectl delete -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#tcp","title":"TCP\u6d41\u91cf\u8f6c\u79fb","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#tcp_1","title":"\u5e94\u7528\u57fa\u4e8e\u6743\u91cd\u7684 TCP \u8def\u7531","text":"<ul> <li>\u7b2c\u4e00\u4e2a\u6b65\u9aa4\u662f\u90e8\u7f72 <code>tcp-echo</code> \u5fae\u670d\u52a1\u7684 <code>v1</code> \u7248\u672c\u3002</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f &lt;(istioctl kube-inject -f samples/tcp-echo/tcp-echo-services.yaml)\nservice/tcp-echo created\n\n[root@VM_0_2_centos istio-1.2.2]# kubectl get all |grep tcp-echo\npod/tcp-echo-v1-55d4546c49-tnvb2     2/2     Running   0          32s\npod/tcp-echo-v2-c8566b665-4jp47      2/2     Running   0          32s\nservice/tcp-echo      ClusterIP   10.111.220.32    &lt;none&gt;        9000/TCP   34s\ndeployment.apps/tcp-echo-v1      1/1     1            1           34s\ndeployment.apps/tcp-echo-v2      1/1     1            1           33s\nreplicaset.apps/tcp-echo-v1-55d4546c49     1         1         1       33s\nreplicaset.apps/tcp-echo-v2-c8566b665      1         1         1       33s\n</code></pre> <ul> <li>\u4e0b\u4e00\u6b65\uff0c\u628a\u6240\u6709\u76ee\u6807\u662f <code>tcp-echo</code> \u5fae\u670d\u52a1\u7684 TCP \u6d41\u91cf\u8def\u7531\u5230 <code>v1</code> \u7248\u672c</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/tcp-echo/tcp-echo-all-v1.yaml\ngateway.networking.istio.io/tcp-echo-gateway created\ndestinationrule.networking.istio.io/tcp-echo-destination created\nvirtualservice.networking.istio.io/tcp-echo created\n</code></pre> <ul> <li>\u786e\u8ba4 <code>tcp-echo</code> \u670d\u52a1\u5df2\u7ecf\u542f\u52a8\u5e76\u5f00\u59cb\u8fd0\u884c</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# export INGRESS_PORT=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.spec.ports[?(@.name==\"tcp\")].port}')\n[root@VM_0_2_centos istio-1.2.2]# echo $INGRESS_PORT\n31400\n[root@VM_0_2_centos istio-1.2.2]# export INGRESS_HOST=$(minikube ip)\n[root@VM_0_2_centos istio-1.2.2]# echo $INGRESS_HOST\n172.16.0.2\n\n# \u5411 tcp-echo \u5fae\u670d\u52a1\u53d1\u9001\u4e00\u4e9b TCP \u6d41\u91cf\uff1a\n[root@VM_0_2_centos istio-1.2.2]# for i in {1..10}; do \\\n&gt; docker run -e INGRESS_HOST=$INGRESS_HOST -e INGRESS_PORT=$INGRESS_PORT -it --rm busybox sh -c \"(date; sleep 1) | nc $INGRESS_HOST $INGRESS_PORT\"; \\\n&gt; done\nUnable to find image 'busybox:latest' locally\nlatest: Pulling from library/busybox\nee153a04d683: Pull complete\nDigest: sha256:9f1003c480699be56815db0f8146ad2e22efea85129b5b5983d0e0fb52d9ab70\nStatus: Downloaded newer image for busybox:latest\none Tue Aug  6 08:40:31 UTC 2019\none Tue Aug  6 08:40:35 UTC 2019\none Tue Aug  6 08:40:38 UTC 2019\none Tue Aug  6 08:40:42 UTC 2019\n</code></pre> <p>\u4e0d\u96be\u53d1\u73b0\uff0c\u6240\u6709\u7684\u65f6\u95f4\u6233\u90fd\u6709\u4e00\u4e2a <code>one</code> \u524d\u7f00\uff0c\u8fd9\u4ee3\u8868\u6240\u6709\u8bbf\u95ee <code>tcp-echo</code> \u670d\u52a1\u7684\u6d41\u91cf\u90fd\u88ab\u8def\u7531\u5230\u4e86 <code>v1</code> \u7248\u672c\u3002</p> <ul> <li>\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u628a 20% \u7684\u6d41\u91cf\u4ece <code>tcp-echo:v1</code> \u8f6c\u79fb\u5230 <code>tcp-echo:v2</code>\uff1a</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f samples/tcp-echo/tcp-echo-20-v2.yaml\nvirtualservice.networking.istio.io/tcp-echo configured\n\n[root@VM_0_2_centos istio-1.2.2]# kubectl get virtualservice tcp-echo -o yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"VirtualService\",\"metadata\":{\"annotations\":{},\"name\":\"tcp-echo\",\"namespace\":\"default\"},\"spec\":{\"gateways\":[\"tcp-echo-gateway\"],\"hosts\":[\"*\"],\"tcp\":[{\"match\":[{\"port\":31400}],\"route\":[{\"destination\":{\"host\":\"tcp-echo\",\"port\":{\"number\":9000},\"subset\":\"v1\"},\"weight\":80},{\"destination\":{\"host\":\"tcp-echo\",\"port\":{\"number\":9000},\"subset\":\"v2\"},\"weight\":20}]}]}}\n  creationTimestamp: \"2019-08-06T06:01:54Z\"\n  generation: 2\n  name: tcp-echo\n  namespace: default\n  resourceVersion: \"112275\"\n  selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/tcp-echo\n  uid: c03f8d6b-0967-45cf-8cf5-465d08634318\nspec:\n  gateways:\n  - tcp-echo-gateway\n  hosts:\n  - '*'\n  tcp:\n  - match:\n    - port: 31400\n    route:\n    - destination:\n        host: tcp-echo\n        port:\n          number: 9000\n        subset: v1\n      weight: 80\n    - destination:\n        host: tcp-echo\n        port:\n          number: 9000\n        subset: v2\n      weight: 20\n</code></pre> <ul> <li>\u6d4b\u8bd5\u5411 <code>tcp-echo</code> \u5fae\u670d\u52a1\u53d1\u9001\u66f4\u591a TCP \u6d41\u91cf\uff1a</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# for i in {1..10}; do docker run -e INGRESS_HOST=$INGRESS_HOST -e INGRESS_PORT=$INGRESS_PORT -it --rm busybox sh -c \"(date; sleep 1) | nc $INGRESS_HOST $INGRESS_PORT\"; done\none Tue Aug  6 08:43:23 UTC 2019\ntwo Tue Aug  6 08:43:27 UTC 2019\none Tue Aug  6 08:43:29 UTC 2019\none Tue Aug  6 08:43:31 UTC 2019\none Tue Aug  6 08:43:33 UTC 2019\none Tue Aug  6 08:43:35 UTC 2019\none Tue Aug  6 08:43:37 UTC 2019\none Tue Aug  6 08:43:39 UTC 2019\ntwo Tue Aug  6 08:43:41 UTC 2019\ntwo Tue Aug  6 08:43:43 UTC 2019\n</code></pre> <p>\u73b0\u5728\u5e94\u8be5\u4f1a\u770b\u5230\uff0c\u8f93\u51fa\u5185\u5bb9\u4e2d\u6709 20% \u7684\u65f6\u95f4\u6233\u524d\u7f00\u4e3a <code>two</code>\uff0c\u8fd9\u610f\u5473\u7740 80% \u7684\u6d41\u91cf\u88ab\u8def\u7531\u5230 <code>tcp-echo:v1</code>\uff0c\u5176\u4f59 20% \u6d41\u91cf\u88ab\u8def\u7531\u5230\u4e86 <code>v2</code>\u3002</p> <p>\u8fd9\u4e2a\u4efb\u52a1\u91cc\uff0c\u7528 Istio \u7684\u6743\u91cd\u8def\u7531\u529f\u80fd\uff0c\u628a\u4e00\u90e8\u5206\u8bbf\u95ee <code>tcp-echo</code> \u670d\u52a1\u7684 TCP \u6d41\u91cf\u88ab\u4ece\u65e7\u7248\u672c\u8fc1\u79fb\u5230\u4e86\u65b0\u7248\u672c\u3002\u5bb9\u5668\u7f16\u6392\u5e73\u53f0\u4e2d\u7684\u7248\u672c\u8fc1\u79fb\u4f7f\u7528\u7684\u662f\u5bf9\u7279\u5b9a\u7ec4\u522b\u7684\u5b9e\u4f8b\u8fdb\u884c\u4f38\u7f29\u6765\u5b8c\u6210\u5bf9\u6d41\u91cf\u7684\u63a7\u5236\u7684\uff0c\u4e24\u79cd\u8fc1\u79fb\u65b9\u5f0f\u663e\u7136\u5927\u76f8\u5f84\u5ead\u3002</p> <p>\u5728 Istio \u4e2d\u53ef\u4ee5\u5bf9\u4e24\u4e2a\u7248\u672c\u7684 <code>tcp-echo</code> \u670d\u52a1\u8fdb\u884c\u72ec\u7acb\u7684\u6269\u7f29\u5bb9\uff0c\u4f38\u7f29\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u5bf9\u6d41\u91cf\u7684\u5206\u914d\u7ed3\u679c\u9020\u6210\u5f71\u54cd\uff0c\u53ef\u4ee5\u9605\u8bfb\u535a\u5ba2\uff1a\u4f7f\u7528 Istio \u8fdb\u884c\u91d1\u4e1d\u96c0\u90e8\u7f72\uff0c\u8fdb\u4e00\u6b65\u4e86\u89e3\u76f8\u5173\u5185\u5bb9\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_21","title":"\u6e05\u7406","text":"<pre><code>kubectl delete -f samples/tcp-echo/tcp-echo-all-v1.yaml\nkubectl delete -f samples/tcp-echo/tcp-echo-services.yaml\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_22","title":"\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4","text":"<p>\u521d\u59cb\u5316bookinfo</p> <pre><code>kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_23","title":"\u8bf7\u6c42\u8d85\u65f6","text":"<p>\u53ef\u4ee5\u5728\u8def\u7531\u89c4\u5219\u7684 <code>timeout</code> \u5b57\u6bb5\u4e2d\u6765\u7ed9 http \u8bf7\u6c42\u8bbe\u7f6e\u8bf7\u6c42\u8d85\u65f6\u3002\u7f3a\u7701\u60c5\u51b5\u4e0b\uff0c\u8d85\u65f6\u88ab\u8bbe\u7f6e\u4e3a 15 \u79d2\u949f\uff0c\u672c\u6587\u4efb\u52a1\u4e2d\uff0c\u4f1a\u628a <code>reviews</code>\u670d\u52a1\u7684\u8d85\u65f6\u8bbe\u7f6e\u4e3a\u4e00\u79d2\u949f\u3002\u4e3a\u4e86\u80fd\u89c2\u5bdf\u8bbe\u7f6e\u7684\u6548\u679c\uff0c\u8fd8\u9700\u8981\u5728\u5bf9 <code>ratings</code> \u670d\u52a1\u7684\u8c03\u7528\u4e2d\u52a0\u5165\u4e24\u79d2\u949f\u7684\u5ef6\u8fdf\u3002</p> <ul> <li>\u5230 <code>reviews:v2</code> \u670d\u52a1\u7684\u8def\u7531\u5b9a\u4e49\uff1a</li> </ul> <pre><code>$ kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n    - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v2\nEOF\n</code></pre> <ul> <li>\u5728\u5bf9 <code>ratings</code> \u670d\u52a1\u7684\u8c03\u7528\u4e2d\u52a0\u5165\u4e24\u79d2\u949f\u7684\u5ef6\u8fdf\uff1a</li> </ul> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n  - ratings\n  http:\n  - fault:\n      delay:\n        percent: 100\n        fixedDelay: 2s\n    route:\n    - destination:\n        host: ratings\n        subset: v1\nEOF\n</code></pre> <ul> <li> <p>http://106.52.172.132:31380/productpage,\u8fd9\u65f6\u5e94\u8be5\u80fd\u770b\u5230 Bookinfo \u5e94\u7528\u5728\u6b63\u5e38\u8fd0\u884c\uff08\u663e\u793a\u4e86\u8bc4\u7ea7\u7684\u661f\u5f62\u7b26\u53f7\uff09\uff0c\u4f46\u662f\u6bcf\u6b21\u5237\u65b0\u9875\u9762\uff0c\u90fd\u4f1a\u51fa\u73b0\u4e24\u79d2\u949f\u7684\u5ef6\u8fdf\u3002</p> </li> <li> <p>\u63a5\u4e0b\u6765\u5728\u76ee\u7684\u4e3a <code>reviews:v2</code> \u670d\u52a1\u7684\u8bf7\u6c42\u52a0\u5165\u4e00\u79d2\u949f\u7684\u8bf7\u6c42\u8d85\u65f6\uff1a</p> </li> </ul> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v2\n    timeout: 0.5s\nEOF\n</code></pre> <ul> <li>\u5237\u65b0 Bookinfo \u7684 Web \u9875\u9762\u3002</li> </ul> <p>\u8fd9\u65f6\u5019\u5e94\u8be5\u770b\u5230\u4e00\u79d2\u949f\u5c31\u4f1a\u8fd4\u56de\uff0c\u800c\u4e0d\u662f\u4e4b\u524d\u7684\u4e24\u79d2\u949f\uff0c\u4f46 <code>reviews</code> \u7684\u663e\u793a\u5df2\u7ecf\u4e0d\u89c1\u4e86\u3002</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_24","title":"\u539f\u7406","text":"<p>\u4e0a\u9762\u7684\u4efb\u52a1\u4e2d\uff0c\u4f7f\u7528 Istio \u4e3a\u8c03\u7528 <code>reviews</code> \u5fae\u670d\u52a1\u7684\u8bf7\u6c42\u4e2d\u52a0\u5165\u4e86\u4e00\u79d2\u949f\u7684\u8d85\u65f6\u63a7\u5236\uff0c\u8986\u76d6\u4e86\u7f3a\u7701\u7684 15 \u79d2\u949f\u8bbe\u7f6e\u3002\u9875\u9762\u5237\u65b0\u65f6\uff0c<code>reviews</code> \u670d\u52a1\u540e\u9762\u4f1a\u8c03\u7528 <code>ratings</code> \u670d\u52a1\uff0c\u4f7f\u7528 Istio \u5728\u5bf9 <code>ratings</code> \u7684\u8c03\u7528\u4e2d\u6ce8\u5165\u4e86\u4e24\u79d2\u949f\u7684\u5ef6\u8fdf\uff0c\u8fd9\u6837\u5c31\u8ba9 <code>reviews</code> \u670d\u52a1\u8981\u82b1\u8d39\u8d85\u8fc7\u4e00\u79d2\u949f\u7684\u65f6\u95f4\u6765\u8c03\u7528 <code>ratings</code> \u670d\u52a1\uff0c\u4ece\u800c\u89e6\u53d1\u4e86\u6211\u4eec\u52a0\u5165\u7684\u8d85\u65f6\u63a7\u5236\u3002</p> <p>\u8fd9\u6837\u5c31\u4f1a\u770b\u5230 Bookinfo \u7684\u9875\u9762\uff08 \u9875\u9762\u7531 <code>reviews</code> \u670d\u52a1\u751f\u6210\uff09\u4e0a\u6ca1\u6709\u51fa\u73b0 <code>reviews</code> \u670d\u52a1\u7684\u663e\u793a\u5185\u5bb9\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u9519\u8bef\u4fe1\u606f\uff1aSorry, product reviews are currently unavailable for this book \uff0c\u51fa\u73b0\u8fd9\u4e00\u4fe1\u606f\u7684\u539f\u56e0\u5c31\u662f\u56e0\u4e3a\u6765\u81ea <code>reviews</code> \u670d\u52a1\u7684\u8d85\u65f6\u9519\u8bef\u3002</p> <p>\u5982\u679c\u6d4b\u8bd5\u4e86\u6545\u969c\u6ce8\u5165\u4efb\u52a1\uff0c\u4f1a\u53d1\u73b0 <code>productpage</code> \u5fae\u670d\u52a1\u5728\u8c03\u7528 <code>reviews</code> \u5fae\u670d\u52a1\u65f6\uff0c\u8fd8\u6709\u81ea\u5df1\u7684\u5e94\u7528\u7ea7\u8d85\u65f6\u8bbe\u7f6e\uff08\u4e09\u79d2\u949f\uff09\u3002\u6ce8\u610f\u8fd9\u91cc\u6211\u4eec\u7528\u8def\u7531\u89c4\u5219\u8bbe\u7f6e\u4e86\u4e00\u79d2\u949f\u7684\u8d85\u65f6\u3002\u5982\u679c\u628a\u8d85\u65f6\u8bbe\u7f6e\u4e3a\u8d85\u8fc7\u4e09\u79d2\u949f\uff08\u4f8b\u5982\u56db\u79d2\u949f\uff09\u4f1a\u6beb\u65e0\u6548\u679c\uff0c\u8fd9\u662f\u56e0\u4e3a\u5185\u90e8\u7684\u670d\u52a1\u4e2d\u8bbe\u7f6e\u4e86\u66f4\u4e3a\u4e25\u683c\u7684\u8d85\u65f6\u8981\u6c42\u3002\u66f4\u591a\u7ec6\u8282\u53ef\u4ee5\u53c2\u89c1\u6545\u969c\u5904\u7406 FAQ \u7684\u76f8\u5173\u5185\u5bb9\u3002</p> <p>\u8fd8\u6709\u4e00\u70b9\u5173\u4e8e Istio \u4e2d\u8d85\u65f6\u63a7\u5236\u65b9\u9762\u7684\u8865\u5145\u8bf4\u660e\uff0c\u9664\u4e86\u50cf\u672c\u6587\u4e00\u6837\u5728\u8def\u7531\u89c4\u5219\u4e2d\u8fdb\u884c\u8d85\u65f6\u8bbe\u7f6e\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u8fdb\u884c\u8bf7\u6c42\u4e00\u7ea7\u7684\u8bbe\u7f6e\uff0c\u53ea\u9700\u5728\u5e94\u7528\u7684\u5916\u53d1\u6d41\u91cf\u4e2d\u52a0\u5165 <code>x-envoy-upstream-rq-timeout-ms</code> Header \u5373\u53ef\u3002\u5728\u8fd9\u4e2a Header \u4e2d\u7684\u8d85\u65f6\u8bbe\u7f6e\u5355\u4f4d\u662f\u6beb\u79d2\u800c\u4e0d\u662f\u79d2\u3002</p> <p>\u6e05\u7406</p> <pre><code>kubectl delete -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#ingress","title":"\u63a7\u5236 Ingress \u6d41\u91cf","text":"<p>\u5728 Kubernetes \u73af\u5883\u4e2d\uff0cKubernetes Ingress \u8d44\u6e90 \u7528\u4e8e\u6307\u5b9a\u5e94\u5728\u96c6\u7fa4\u5916\u90e8\u516c\u5f00\u7684\u670d\u52a1\u3002\u5728 Istio \u670d\u52a1\u7f51\u683c\u4e2d\uff0c\u66f4\u597d\u7684\u65b9\u6cd5\uff08\u4e5f\u9002\u7528\u4e8e Kubernetes \u548c\u5176\u4ed6\u73af\u5883\uff09\u662f\u4f7f\u7528\u4e0d\u540c\u7684\u914d\u7f6e\u6a21\u578b\uff0c\u5373 Istio <code>Gateway</code> \u3002 <code>Gateway</code> \u5141\u8bb8\u5c06 Istio \u529f\u80fd\uff08\u4f8b\u5982\uff0c\u76d1\u63a7\u548c\u8def\u7531\u89c4\u5219\uff09\u5e94\u7528\u4e8e\u8fdb\u5165\u96c6\u7fa4\u7684\u6d41\u91cf\u3002</p> <p>\u6b64\u4efb\u52a1\u63cf\u8ff0\u5982\u4f55\u914d\u7f6e Istio \u4ee5\u4f7f\u7528 Istio \u5728\u670d\u52a1\u7f51\u683c\u5916\u90e8\u516c\u5f00\u670d\u52a1 <code>Gateway</code>\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#httpbin","title":"\u66b4\u9732httpbin\u670d\u52a1","text":"<ul> <li>\u90e8\u7f72httpbin\u670d\u52a1</li> </ul> <pre><code>kubectl apply -f &lt;(istioctl kube-inject -f samples/httpbin/httpbin.yaml)\n</code></pre> <ul> <li>\u786e\u5b9aIP\u548c\u7aef\u53e3</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# export INGRESS_PORT=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.spec.ports[?(@.name==\"http2\")].nodePort}')\n[root@VM_0_2_centos istio-1.2.2]# echo $INGRESS_PORT\n31380\n[root@VM_0_2_centos istio-1.2.2]# export INGRESS_HOST=$(minikube ip)\n[root@VM_0_2_centos istio-1.2.2]# echo $INGRESS_HOST\n172.16.0.2\n</code></pre> <ul> <li>\u4f7f\u7528 Istio \u7f51\u5173\u914d\u7f6e Ingress</li> </ul> <p>Ingress <code>Gateway</code> \u63cf\u8ff0\u4e86\u5728\u7f51\u683c\u8fb9\u7f18\u64cd\u4f5c\u7684\u8d1f\u8f7d\u5e73\u8861\u5668\uff0c\u7528\u4e8e\u63a5\u6536\u4f20\u5165\u7684 HTTP/TCP \u8fde\u63a5\u3002\u5b83\u914d\u7f6e\u66b4\u9732\u7684\u7aef\u53e3\u3001\u534f\u8bae\u7b49\uff0c\u4f46\u4e0e Kubernetes Ingress Resources \u4e0d\u540c\uff0c\u5b83\u4e0d\u5305\u62ec\u4efb\u4f55\u6d41\u91cf\u8def\u7531\u914d\u7f6e\u3002\u6d41\u5165\u6d41\u91cf\u7684\u6d41\u91cf\u8def\u7531\u4f7f\u7528 Istio \u8def\u7531\u89c4\u5219\u8fdb\u884c\u914d\u7f6e\uff0c\u4e0e\u5185\u90e8\u670d\u52a1\u8bf7\u6c42\u5b8c\u5168\u76f8\u540c\u3002</p> <p>\u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u4e3a <code>Gateway</code> \u5728 HTTP 80 \u7aef\u53e3\u4e0a\u914d\u7f6e\u6d41\u91cf\u3002</p> <pre><code># \u521b\u5efa\u4e00\u4e2a Istio Gateway\uff1a\n[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f - &lt;&lt;EOF\n&gt; apiVersion: networking.istio.io/v1alpha3\n&gt; kind: Gateway\n&gt; metadata:\n&gt;   name: httpbin-gateway\n&gt; spec:\n&gt;   selector:\n&gt;     istio: ingressgateway # use Istio default gateway implementation\n&gt;   servers:\n&gt;   - port:\n&gt;       number: 80\n&gt;       name: http\n&gt;       protocol: HTTP\n&gt;     hosts:\n&gt;     - \"httpbin.example.com\"\n&gt; EOF\ngateway.networking.istio.io/httpbin-gateway created\n[root@VM_0_2_centos istio-1.2.2]# kubectl get gw httpbin-gateway\nNAME              AGE\nhttpbin-gateway   12s\n\n\n# \u4e3a\u901a\u8fc7 Gateway \u8fdb\u5165\u7684\u6d41\u91cf\u914d\u7f6e\u8def\u7531\uff1a\nkubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: httpbin\nspec:\n  hosts:\n  - \"httpbin.example.com\"\n  gateways:\n  - httpbin-gateway\n  http:\n  - match:\n    - uri:\n        prefix: /status\n    - uri:\n        prefix: /delay\n    route:\n    - destination:\n        port:\n          number: 8000\n        host: httpbin\nEOF\n\n[root@VM_0_2_centos istio-1.2.2]# kubectl get vs httpbin\nNAME      GATEWAYS            HOSTS                   AGE\nhttpbin   [httpbin-gateway]   [httpbin.example.com]   7s\n</code></pre> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u4e3a\u670d\u52a1\u521b\u5efa\u4e86\u4e00\u4e2a\u865a\u62df\u670d\u52a1\u914d\u7f6e <code>httpbin</code> \uff0c\u5176\u4e2d\u5305\u542b\u4e24\u6761\u8def\u7531\u89c4\u5219\uff0c\u5141\u8bb8\u8def\u5f84 <code>/status</code> \u548c \u8def\u5f84\u7684\u6d41\u91cf <code>/delay</code>\u3002</p> <p>\u8be5\u7f51\u5173\u5217\u8868\u6307\u5b9a\uff0c\u53ea\u6709\u901a\u8fc7\u6211\u4eec\u7684\u8981\u6c42 <code>httpbin-gateway</code> \u662f\u5141\u8bb8\u7684\u3002\u6240\u6709\u5176\u4ed6\u5916\u90e8\u8bf7\u6c42\u5c06\u88ab\u62d2\u7edd\uff0c\u5e76\u8fd4\u56de 404 \u54cd\u5e94\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u5728\u6b64\u914d\u7f6e\u4e2d\uff0c\u6765\u81ea\u7f51\u683c\u4e2d\u5176\u4ed6\u670d\u52a1\u7684\u5185\u90e8\u8bf7\u6c42\u4e0d\u53d7\u8fd9\u4e9b\u89c4\u5219\u7ea6\u675f\uff0c\u800c\u662f\u7b80\u5355\u5730\u9ed8\u8ba4\u4e3a\u5faa\u73af\u8def\u7531\u3002\u8981\u5c06\u8fd9\u4e9b\uff08\u6216\u5176\u4ed6\u89c4\u5219\uff09\u5e94\u7528\u4e8e\u5185\u90e8\u8c03\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u7279\u6b8a\u503c <code>mesh</code> \u6dfb\u52a0\u5230 <code>gateways</code> \u7684\u5217\u8868\u4e2d\u3002</p> <ul> <li>\u4f7f\u7528 curl \u8bbf\u95ee httpbin \u670d\u52a1\uff1a</li> </ul> <pre><code>[root@VM_0_2_centos istio-1.2.2]# curl -I -HHost:httpbin.example.com http://$INGRESS_HOST:$INGRESS_PORT/status/200\nHTTP/1.1 200 OK\nserver: istio-envoy\ndate: Tue, 06 Aug 2019 09:26:53 GMT\ncontent-type: text/html; charset=utf-8\naccess-control-allow-origin: *\naccess-control-allow-credentials: true\ncontent-length: 0\nx-envoy-upstream-service-time: 268\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u8fd9\u91cc\u4f7f\u7528\u8be5 <code>-H</code> \u6807\u5fd7\u5c06 <code>Host</code> HTTP Header \u8bbe\u7f6e\u4e3a \u201chttpbin.example.com\u201d\u3002\u8fd9\u4e00\u64cd\u4f5c\u662f\u5fc5\u9700\u7684\uff0c\u56e0\u4e3a\u4e0a\u9762\u7684 Ingress <code>Gateway</code> \u88ab\u914d\u7f6e\u4e3a\u5904\u7406 \u201chttpbin.example.com\u201d\uff0c\u4f46\u5728\u6d4b\u8bd5\u73af\u5883\u4e2d\u6ca1\u6709\u8be5\u4e3b\u673a\u7684 DNS \u7ed1\u5b9a\uff0c\u53ea\u662f\u5c06\u8bf7\u6c42\u53d1\u9001\u5230 Ingress IP\u3002</p> <pre><code>#\u8bbf\u95ee\u4efb\u4f55\u672a\u660e\u786e\u516c\u5f00\u7684\u5176\u4ed6 URL\uff0c\u5e94\u8be5\u4f1a\u770b\u5230\u4e00\u4e2a HTTP 404 \u9519\u8bef\uff1a\n[root@VM_0_2_centos istio-1.2.2]# curl -I -HHost:httpbin.example.com http://$INGRESS_HOST:$INGRESS_PORT/headers\nHTTP/1.1 404 Not Found\ndate: Tue, 06 Aug 2019 09:27:46 GMT\nserver: istio-envoy\ntransfer-encoding: chunked\n</code></pre> <ul> <li>\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee Ingress \u670d\u52a1</li> </ul> <p>\u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165 <code>httpbin</code> \u670d\u52a1\u7684\u5730\u5740\u662f\u4e0d\u4f1a\u751f\u6548\u7684\uff0c\u8fd9\u662f\u56e0\u4e3a\u56e0\u4e3a\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u8ba9\u6d4f\u89c8\u5668\u50cf <code>curl</code> \u4e00\u6837\u88c5\u4f5c\u8bbf\u95ee <code>httpbin.example.com</code>\u3002\u800c\u5728\u73b0\u5b9e\u4e16\u754c\u4e2d\uff0c\u56e0\u4e3a\u6709\u6b63\u5e38\u914d\u7f6e\u7684\u4e3b\u673a\u548c DNS \u8bb0\u5f55\uff0c\u8fd9\u79cd\u505a\u6cd5\u5c31\u80fd\u591f\u6210\u529f\u4e86\u2014\u2014\u53ea\u8981\u7b80\u5355\u7684\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95ee\u7531\u57df\u540d\u6784\u6210\u7684 URL \u5373\u53ef\uff0c\u4f8b\u5982 <code>https://httpbin.example.com/status/200</code>\u3002</p> <p>\u8981\u89e3\u51b3\u6b64\u95ee\u9898\u4ee5\u8fdb\u884c\u7b80\u5355\u7684\u6d4b\u8bd5\u548c\u6f14\u793a\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 <code>Gateway</code> \u548c <code>VirtualService</code> \u914d\u7f6e\u4e2d\u4e3a\u4e3b\u673a\u4f7f\u7528\u901a\u914d\u7b26\u503c <code>*</code>\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6211\u4eec\u5c06 Ingress \u914d\u7f6e\u66f4\u6539\u4e3a\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: httpbin-gateway\nspec:\n  selector:\n    istio: ingressgateway # use Istio default gateway implementation\n  servers:\n  - port:\n      number: 80\n      name: http\n      protocol: HTTP\n    hosts:\n    - \"*\"\n---\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: httpbin\nspec:\n  hosts:\n  - \"*\"\n  gateways:\n  - httpbin-gateway\n  http:\n  - match:\n    - uri:\n        prefix: /headers\n    route:\n    - destination:\n        port:\n          number: 8000\n        host: httpbin\nEOF\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5728\u6d4f\u89c8\u5668\u7684 URL \u4e2d\u4f7f\u7528,http://106.52.172.132:31380/headers</p> <p></p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_25","title":"\u539f\u7406","text":"<p><code>Gateway</code> \u914d\u7f6e\u8d44\u6e90\u5141\u8bb8\u5916\u90e8\u6d41\u91cf\u8fdb\u5165 Istio \u670d\u52a1\u7f51\uff0c\u5e76\u4f7f Istio \u7684\u6d41\u91cf\u7ba1\u7406\u548c\u7b56\u7565\u529f\u80fd\u53ef\u7528\u4e8e\u8fb9\u7f18\u670d\u52a1\u3002</p> <p>\u5728\u524d\u9762\u7684\u6b65\u9aa4\u4e2d\uff0c\u6211\u4eec\u5728 Istio \u670d\u52a1\u7f51\u683c\u4e2d\u521b\u5efa\u4e86\u4e00\u4e2a\u670d\u52a1\uff0c\u5e76\u5c55\u793a\u4e86\u5982\u4f55\u5c06\u670d\u52a1\u7684 HTTP \u7aef\u70b9\u66b4\u9732\u7ed9\u5916\u90e8\u6d41\u91cf\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_26","title":"\u6e05\u7406","text":"<pre><code>kubectl delete gateway httpbin-gateway\nkubectl delete virtualservice httpbin\nkubectl delete --ignore-not-found=true -f samples/httpbin/httpbin.yaml\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#ingress-gateway","title":"\u52a0\u5bc6ingress gateway","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#sds-gateway-https","title":"\u4f7f\u7528 SDS \u4e3a Gateway \u63d0\u4f9b HTTPS \u52a0\u5bc6\u652f\u6301","text":"<p>\u63a7\u5236 Ingress \u6d41\u91cf\u4efb\u52a1\u4e2d\u63cf\u8ff0\u4e86\u5982\u4f55\u8fdb\u884c\u914d\u7f6e\uff0c\u901a\u8fc7 Ingress Gateway \u628a\u670d\u52a1\u7684 HTTP \u7aef\u70b9\u66b4\u9732\u7ed9\u5916\u90e8\u3002\u8fd9\u91cc\u66f4\u8fdb\u4e00\u6b65\uff0c\u4f7f\u7528\u5355\u5411\u6216\u8005\u53cc\u5411 TLS \u6765\u5b8c\u6210\u5f00\u653e\u670d\u52a1\u7684\u4efb\u52a1\u3002\u53cc\u5411 TLS \u6240\u9700\u7684\u79c1\u94a5\u3001\u670d\u52a1\u5668\u8bc1\u4e66\u4ee5\u53ca\u6839\u8bc1\u4e66\u90fd\u7531 Secret \u53d1\u73b0\u670d\u52a1\uff08SDS\uff09\u5b8c\u6210\u914d\u7f6e\u3002</p> <ul> <li> <p>\u9a8c\u8bc1curl\u5de5\u5177\u662f\u5426\u652f\u6301</p> </li> <li> <p>\u751f\u6210\u8bc1\u4e66</p> </li> </ul> <pre><code>yum -y install git\ngit clone https://github.com/nicholasjackson/mtls-go-example\n# \u8fdb\u5165\u4ee3\u7801\u5e93\npushd mtls-go-example\n# \u4e3a httpbin.example.com \u751f\u6210\u8bc1\u4e66\u3002\u6ce8\u610f\u8981\u628a\u4e0b\u9762\u547d\u4ee4\u4e2d\u7684 password \u66ff\u6362\u4e3a\u5176\u5b83\u503c\u3002\n./generate.sh httpbin.example.com password\n\n# \u770b\u5230\u63d0\u793a\u540e\uff0c\u6240\u6709\u95ee\u9898\u90fd\u8f93\u5165 Y \u5373\u53ef\u3002\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u751f\u6210\u56db\u4e2a\u76ee\u5f55\uff1a1_root\u30012_intermediate\u30013_application \u4ee5\u53ca 4_client\u3002\u8fd9\u4e9b\u76ee\u5f55\u4e2d\u5305\u542b\u4e86\u540e\u7eed\u8fc7\u7a0b\u6240\u9700\u7684\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u8bc1\u4e66\u3002\nmkdir ../httpbin.example.com &amp;&amp; mv 1_root 2_intermediate 3_application 4_client ../httpbin.example.com\n</code></pre> <ul> <li>\u4f7f\u7528 SDS \u914d\u7f6e TLS Ingress \u7f51\u5173</li> </ul> <p>\u53ef\u4ee5\u914d\u7f6e TLS Ingress \u7f51\u5173\uff0c\u8ba9\u5b83\u4ece Ingress \u7f51\u5173\u4ee3\u7406\u901a\u8fc7 SDS \u83b7\u53d6\u51ed\u636e\u3002Ingress \u7f51\u5173\u4ee3\u7406\u548c Ingress \u7f51\u5173\u5728\u540c\u4e00\u4e2a Pod \u4e2d\u8fd0\u884c\uff0c\u76d1\u89c6 Ingress \u7f51\u5173\u6240\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\u65b0\u5efa\u7684 <code>Secret</code>\u3002\u5728 Ingress \u7f51\u5173\u4e2d\u542f\u7528 SDS \u5177\u6709\u5982\u4e0b\u597d\u5904\uff1a</p> <p>Ingress \u7f51\u5173\u65e0\u9700\u91cd\u542f\uff0c\u5c31\u53ef\u4ee5\u52a8\u6001\u7684\u65b0\u589e\u3001\u5220\u9664\u6216\u8005\u66f4\u65b0\u5bc6\u94a5/\u8bc1\u4e66\u5bf9\u4ee5\u53ca\u6839\u8bc1\u4e66\u3002</p> <p>\u65e0\u9700\u52a0\u8f7d <code>Secret</code> \u5377\u3002\u521b\u5efa\u4e86 <code>kubernetes</code> <code>Secret</code> \u4e4b\u540e\uff0c\u8fd9\u4e2a <code>Secret</code> \u5c31\u4f1a\u88ab\u7f51\u5173\u4ee3\u7406\u6355\u83b7\uff0c\u5e76\u4ee5\u5bc6\u94a5/\u8bc1\u4e66\u5bf9\u548c\u6839\u8bc1\u4e66\u7684\u5f62\u5f0f\u53d1\u9001\u7ed9 Ingress \u7f51\u5173\u3002</p> <p>\u7f51\u5173\u4ee3\u7406\u80fd\u591f\u76d1\u89c6\u591a\u4e2a\u5bc6\u94a5/\u8bc1\u4e66\u5bf9\u3002\u53ea\u9700\u8981\u4e3a\u6bcf\u4e2a\u4e3b\u673a\u540d\u521b\u5efa <code>Secret</code> \u5e76\u66f4\u65b0\u7f51\u5173\u5b9a\u4e49\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>1.\u5728 Ingress \u7f51\u5173\u4e0a\u542f\u7528 SDS\uff0c\u5e76\u90e8\u7f72 Ingress \u7f51\u5173\u4ee3\u7406\u3002</p> <p>\u8fd9\u4e2a\u529f\u80fd\u7f3a\u7701\u662f\u7981\u7528\u7684\uff0c\u56e0\u6b64\u9700\u8981\u5728 Helm \u4e2d\u6253\u5f00 <code>istio-ingressgateway.sds.enabled</code> \u5f00\u5173\uff0c\u7136\u540e\u751f\u6210 <code>istio-ingressgateway.yaml</code> \u6587\u4ef6\uff1a</p> <pre><code>wget https://get.helm.sh/helm-v2.14.2-linux-amd64.tar.gz\ntar -xf helm-v2.14.2-linux-amd64.tar.gz\nmv linux-amd64/helm /usr/bin/\nhelm version\n\n[root@VM_0_2_centos istio-1.2.2]# helm template install/kubernetes/helm/istio/ --name istio \\\n&gt; --namespace istio-system -x charts/gateways/templates/deployment.yaml \\\n&gt; --set gateways.istio-egressgateway.enabled=false \\\n&gt; --set gateways.istio-ingressgateway.sds.enabled=true &gt; \\\n&gt; $HOME/istio-ingressgateway.yaml\n[root@VM_0_2_centos istio-1.2.2]# kubectl apply -f $HOME/istio-ingressgateway.yaml\ndeployment.apps/istio-ingressgateway configured\n</code></pre> <p>2.\u8bbe\u7f6e\u4e24\u4e2a\u73af\u5883\u53d8\u91cf\uff1a<code>INGRESS_HOST</code> \u548c <code>SECURE_INGRESS_PORT</code>\uff1a</p> <pre><code>export SECURE_INGRESS_PORT=$(kubectl -n istio-system \\\nget service istio-ingressgateway -o jsonpath='{.spec.ports[?(@.name==\"https\")].port}')\n\nexport INGRESS_HOST=$(minikube ip)\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#1-tls-ingress","title":"1.\u4e3a\u5355\u4e00\u4e3b\u673a\u914d\u7f6e TLS Ingress \u7f51\u5173","text":"<p>1.\u542f\u52a8 <code>httpbin</code> \u6837\u4f8b\uff1a</p> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: v1\nkind: Service\nmetadata:\n  name: httpbin\n  labels:\n    app: httpbin\nspec:\n  ports:\n  - name: http\n    port: 8000\n  selector:\n    app: httpbin\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: httpbin\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: httpbin\n        version: v1\n    spec:\n      containers:\n      - image: docker.io/citizenstig/httpbin\n        imagePullPolicy: IfNotPresent\n        name: httpbin\n        ports:\n        - containerPort: 8000\nEOF\n</code></pre> <p>2.\u4e3a Ingress \u7f51\u5173\u521b\u5efa <code>Secret\uff1a</code></p> <pre><code>[root@VM_0_2_centos istio-1.2.2]# kubectl create -n istio-system secret generic httpbin-credential \\\n&gt; --from-file=key=httpbin.example.com/3_application/private/httpbin.example.com.key.pem \\\n&gt; --from-file=cert=httpbin.example.com/3_application/certs/httpbin.example.com.cert.pem\nsecret/httpbin-credential created\n</code></pre> <p>3.\u521b\u5efa\u4e00\u4e2a\u7f51\u5173\uff0c\u5176 <code>servers:</code> \u5b57\u6bb5\u7684\u7aef\u53e3\u4e3a 443\uff0c\u8bbe\u7f6e <code>credentialName</code> \u7684\u503c\u4e3a <code>httpbin-credential</code>\u3002\u8fd9\u4e2a\u503c\u5c31\u662f <code>Secret</code> \u7684\u540d\u5b57\u3002TLS \u6a21\u5f0f\u8bbe\u7f6e\u4e3a <code>SIMPLE</code>\u3002</p> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: mygateway\nspec:\n  selector:\n    istio: ingressgateway # \u4f7f\u7528\u7f3a\u7701\u7684 Ingress \u7f51\u5173\u3002\n  servers:\n  - port:\n      number: 443\n      name: https\n      protocol: HTTPS\n    tls:\n      mode: SIMPLE\n      credentialName: \"httpbin-credential\" # \u548c Secret \u540d\u79f0\u4e00\u81f4\n    hosts:\n    - \"httpbin.example.com\"\nEOF\n</code></pre> <p>4.\u914d\u7f6e\u7f51\u5173\u7684 Ingress \u6d41\u91cf\u8def\u7531\uff0c\u5e76\u914d\u7f6e\u5bf9\u5e94\u7684 <code>VirtualService</code>\uff1a</p> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: httpbin\nspec:\n  hosts:\n  - \"httpbin.example.com\"\n  gateways:\n  - mygateway\n  http:\n  - match:\n    - uri:\n        prefix: /status\n    - uri:\n        prefix: /delay\n    route:\n    - destination:\n        port:\n          number: 8000\n        host: httpbin\nEOF\n</code></pre> <p>5.\u7528 HTTPS \u534f\u8bae\u8bbf\u95ee <code>httpbin</code> \u670d\u52a1\uff1a</p> <pre><code>curl -v -HHost:httpbin.example.com \\\n--resolve httpbin.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \\\n--cacert httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem \\\nhttps://httpbin.example.com:$SECURE_INGRESS_PORT/status/418\n</code></pre> <p><code>httpbin</code> \u670d\u52a1\u4f1a\u8fd4\u56de 418 I\u2019m a Teapot\u3002</p> <p>6.\u5220\u9664\u7f51\u5173\u7684 <code>Secret</code>\uff0c\u5e76\u65b0\u5efa\u53e6\u5916\u4e00\u4e2a\uff0c\u7136\u540e\u4fee\u6539 Ingress \u7f51\u5173\u7684\u51ed\u636e\uff1a</p> <pre><code>kubectl -n istio-system delete secret httpbin-credential\n</code></pre> <p>7.\u4f7f\u7528curl\u8bbf\u95ee</p> <pre><code>[root@VM_0_2_centos istio-1.2.2]# curl -v -HHost:httpbin.example.com --resolve httpbin.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST --cacert httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem https://httpbin.example.com:$SECURE_INGRESS_PORT/status/418\n* Added httpbin.example.com:443:10.108.162.3 to DNS cache\n* About to connect() to httpbin.example.com port 443 (#0)\n*   Trying 10.108.162.3...\n* Connected to httpbin.example.com (10.108.162.3) port 443 (#0)\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem\n  CApath: none\n* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n* Server certificate:\n*   subject: CN=httpbin.example.com,O=Dis,L=Springfield,ST=Denial,C=US\n*   start date: 8\u6708 06 09:48:13 2019 GMT\n*   expire date: 8\u6708 15 09:48:13 2020 GMT\n*   common name: httpbin.example.com\n*   issuer: CN=httpbin.example.com,O=Dis,ST=Denial,C=US\n&gt; GET /status/418 HTTP/1.1\n&gt; User-Agent: curl/7.29.0\n&gt; Accept: */*\n&gt; Host:httpbin.example.com\n&gt;\n&lt; HTTP/1.1 418 Unknown\n&lt; server: istio-envoy\n&lt; date: Wed, 07 Aug 2019 10:04:24 GMT\n&lt; access-control-allow-origin: *\n&lt; x-more-info: http://tools.ietf.org/html/rfc2324\n&lt; access-control-allow-credentials: true\n&lt; content-length: 135\n&lt; x-envoy-upstream-service-time: 94\n&lt;\n\n    -=[ teapot ]=-\n\n       _...._\n     .'  _ _ `.\n    | .\"` ^ `\". _,\n    \\_;`\"---\"`|//\n      |       ;/\n      \\_     _/\n        `\"\"\"`\n* Connection #0 to host httpbin.example.com left intact\n</code></pre> <p>\u4e3a TLS Ingress \u7f51\u5173\u914d\u7f6e\u591a\u4e2a\u4e3b\u673a\u540d</p> <p>\u53ef\u4ee5\u628a\u591a\u4e2a\u4e3b\u673a\u540d\u914d\u7f6e\u5230\u540c\u4e00\u4e2a Ingress \u7f51\u5173\u4e0a\uff0c\u4f8b\u5982 <code>httpbin.example.com</code> \u548c <code>helloworld-v1.example.com</code>\u3002Ingress \u7f51\u5173\u4f1a\u4e3a\u6bcf\u4e2a <code>credentialName</code> \u83b7\u53d6\u4e00\u4e2a\u552f\u4e00\u7684\u51ed\u636e\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#2-tls-ingress","title":"2.\u4e3a TLS Ingress \u7f51\u5173\u914d\u7f6e\u591a\u4e2a\u4e3b\u673a\u540d","text":"<p>\u53ef\u4ee5\u628a\u591a\u4e2a\u4e3b\u673a\u540d\u914d\u7f6e\u5230\u540c\u4e00\u4e2a Ingress \u7f51\u5173\u4e0a\uff0c\u4f8b\u5982 <code>httpbin.example.com</code> \u548c <code>helloworld-v1.example.com</code>\u3002Ingress \u7f51\u5173\u4f1a\u4e3a\u6bcf\u4e2a <code>credentialName</code> \u83b7\u53d6\u4e00\u4e2a\u552f\u4e00\u7684\u51ed\u636e\u3002</p> <ul> <li>\u542f\u52a8 <code>hellowworld-v1</code> \u793a\u4f8b\uff1a</li> </ul> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: v1\nkind: Service\nmetadata:\n  name: helloworld-v1\n  labels:\n    app: helloworld-v1\nspec:\n  ports:\n  - name: http\n    port: 5000\n  selector:\n    app: helloworld-v1\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: helloworld-v1\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: helloworld-v1\n    spec:\n      containers:\n      - name: helloworld\n        image: istio/examples-helloworld-v1\n        resources:\n          requests:\n            cpu: \"100m\"\n        imagePullPolicy: IfNotPresent #Always\n        ports:\n        - containerPort: 5000\nEOF\n</code></pre> <ul> <li>\u4e3a Ingress \u7f51\u5173\u521b\u5efa\u4e00\u4e2a Ingress\u3002\u5982\u679c\u5df2\u7ecf\u521b\u5efa\u4e86 <code>httpbin-credential</code>\uff0c\u5c31\u53ef\u4ee5\u521b\u5efa <code>helloworld-credential</code> Secret \u4e86\u3002</li> </ul> <pre><code>pushd mtls-go-example\n./generate.sh helloworld-v1.example.com password\nmkdir ../helloworld-v1.example.com &amp;&amp; mv 1_root 2_intermediate 3_application 4_client ../helloworld-v1.example.com\npopd\nkubectl create -n istio-system secret generic helloworld-credential \\\n--from-file=key=helloworld-v1.example.com/3_application/private/helloworld-v1.example.com.key.pem \\\n--from-file=cert=helloworld-v1.example.com/3_application/certs/helloworld-v1.example.com.cert.pem\n\n[root@VM_0_3_centos ~]# kubectl get secret -n istio-system\nNAME                                                 TYPE                                  DATA   AGE\ndefault-token-q69rn                                  kubernetes.io/service-account-token   3      9d\nhelloworld-credential                                Opaque                                2      49s\n</code></pre> <ul> <li>\u5b9a\u4e49\u4e00\u4e2a\u7f51\u5173\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u4e24\u4e2a <code>server</code>\uff0c\u90fd\u5f00\u653e\u4e86 443 \u7aef\u53e3\u3002\u4e24\u4e2a <code>credentialName</code> \u5b57\u6bb5\u5206\u522b\u8d4b\u503c\u4e3a <code>httpbin-credential</code> \u548c <code>helloworld-credential</code>\u3002<code>serverCertificate</code> \u4ee5\u53ca <code>privateKey</code> \u5e94\u8be5\u4e3a\u7a7a\u3002</li> </ul> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: mygateway\nspec:\n  selector:\n    istio: ingressgateway # \u4f7f\u7528\u7f3a\u7701\u7684 Ingress \u7f51\u5173\n  servers:\n  - port:\n      number: 443\n      name: https-httpbin\n      protocol: HTTPS\n    tls:\n      mode: SIMPLE\n      credentialName: \"httpbin-credential\"\n    hosts:\n    - \"httpbin.example.com\"\n  - port:\n      number: 443\n      name: https-helloworld\n      protocol: HTTPS\n    tls:\n      mode: SIMPLE\n      credentialName: \"helloworld-credential\"\n    hosts:\n    - \"helloworld-v1.example.com\"\nEOF\n\n# \u67e5\u770b\n[root@VM_0_3_centos ~]# kubectl describe gw mygateway\nName:         mygateway\nNamespace:    default\nLabels:       &lt;none&gt;\nAnnotations:  kubectl.kubernetes.io/last-applied-configuration:\n                {\"apiVersion\":\"networking.istio.io/v1alpha3\",\"kind\":\"Gateway\",\"metadata\":{\"annotations\":{},\"name\":\"mygateway\",\"namespace\":\"default\"},\"spec...\nAPI Version:  networking.istio.io/v1alpha3\nKind:         Gateway\nMetadata:\n  Creation Timestamp:  2019-08-07T09:48:12Z\n  Generation:          2\n  Resource Version:    676604\n  Self Link:           /apis/networking.istio.io/v1alpha3/namespaces/default/gateways/mygateway\n  UID:                 0e8f2445-2112-46c8-b450-00073f3da98e\nSpec:\n  Selector:\n    Istio:  ingressgateway\n  Servers:\n    Hosts:\n      httpbin.example.com\n    Port:\n      Name:      https-httpbin\n      Number:    443\n      Protocol:  HTTPS\n    Tls:\n      Credential Name:  httpbin-credential\n      Mode:             SIMPLE\n    Hosts:\n      helloworld-v1.example.com\n    Port:\n      Name:      https-helloworld\n      Number:    443\n      Protocol:  HTTPS\n    Tls:\n      Credential Name:  helloworld-credential\n      Mode:             SIMPLE\nEvents:                 &lt;none&gt;\n</code></pre> <ul> <li>\u914d\u7f6e\u7f51\u5173\u7684\u6d41\u91cf\u8def\u7531\uff0c\u914d\u7f6e <code>VirtualService</code></li> </ul> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: helloworld-v1\nspec:\n  hosts:\n  - \"helloworld-v1.example.com\"\n  gateways:\n  - mygateway\n  http:\n  - match:\n    - uri:\n        exact: /hello\n    route:\n    - destination:\n        host: helloworld-v1\n        port:\n          number: 5000\nEOF\n</code></pre> <ul> <li>\u5411 <code>helloworld-v1.example.com</code> \u53d1\u9001 HTTPS \u8bf7\u6c42</li> </ul> <pre><code>curl -v -HHost:helloworld-v1.example.com \\\n--resolve helloworld-v1.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \\\n--cacert helloworld-v1.example.com/2_intermediate/certs/ca-chain.cert.pem \\\nhttps://helloworld-v1.example.com:$SECURE_INGRESS_PORT/hello\n\n\n[root@VM_0_3_centos ~]# curl -v -HHost:helloworld-v1.example.com \\\n&gt; --resolve helloworld-v1.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \\\n&gt; --cacert helloworld-v1.example.com/2_intermediate/certs/ca-chain.cert.pem \\\n&gt; https://helloworld-v1.example.com:$SECURE_INGRESS_PORT/hello\n* Added helloworld-v1.example.com:31390:172.16.0.3 to DNS cache\n* About to connect() to helloworld-v1.example.com port 31390 (#0)\n*   Trying 172.16.0.3...\n* Connected to helloworld-v1.example.com (172.16.0.3) port 31390 (#0)\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: helloworld-v1.example.com/2_intermediate/certs/ca-chain.cert.pem\n  CApath: none\n* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n* Server certificate:\n*   subject: CN=helloworld-v1.example.com,O=Dis,L=Springfield,ST=Denial,C=US\n*   start date: 8\u6708 14 08:50:44 2019 GMT\n*   expire date: 8\u6708 23 08:50:44 2020 GMT\n*   common name: helloworld-v1.example.com\n*   issuer: CN=helloworld-v1.example.com,O=Dis,ST=Denial,C=US\n&gt; GET /hello HTTP/1.1\n&gt; User-Agent: curl/7.29.0\n&gt; Accept: */*\n&gt; Host:helloworld-v1.example.com\n&gt;\n&lt; HTTP/1.1 200 OK\n&lt; content-type: text/html; charset=utf-8\n&lt; content-length: 59\n&lt; server: istio-envoy\n&lt; date: Wed, 14 Aug 2019 09:14:02 GMT\n&lt; x-envoy-upstream-service-time: 132\n&lt;\nHello version: v1, instance: helloworld-v1-b99c6449c-xchbg\n* Connection #0 to host helloworld-v1.example.com left intact\n</code></pre> <ul> <li>\u53d1\u9001 HTTPS \u8bf7\u6c42\u5230 <code>httpbin.example.com</code>\uff0c\u8fd8\u662f\u4f1a\u770b\u5230\u8336\u58f6\uff1a</li> </ul> <pre><code>curl -v -HHost:httpbin.example.com \\\n--resolve httpbin.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \\\n--cacert httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem \\\nhttps://httpbin.example.com:$SECURE_INGRESS_PORT/status/418\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#3-tls-ingress","title":"3.\u914d\u7f6e\u53cc\u5411 TLS Ingress \u7f51\u5173","text":"<p>\u53ef\u4ee5\u5bf9\u7f51\u5173\u7684\u5b9a\u4e49\u8fdb\u884c\u6269\u5c55\uff0c\u52a0\u5165\u53cc\u5411 TLS \u7684\u652f\u6301\u3002\u8981\u4fee\u6539 Ingress \u7f51\u5173\u7684\u51ed\u636e\uff0c\u5c31\u8981\u5220\u9664\u5e76\u91cd\u5efa\u5bf9\u5e94\u7684 <code>Secret</code>\u3002\u670d\u52a1\u5668\u4f1a\u4f7f\u7528 CA \u8bc1\u4e66\u5bf9\u5ba2\u6237\u7aef\u8fdb\u884c\u6821\u9a8c\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528 <code>cacert</code> \u5b57\u6bb5\u6765\u4fdd\u5b58 CA \u8bc1\u4e66\uff1a</p> <pre><code>kubectl -n istio-system delete secret httpbin-credential\nkubectl create -n istio-system secret generic httpbin-credential  \\\n--from-file=key=httpbin.example.com/3_application/private/httpbin.example.com.key.pem \\\n--from-file=cert=httpbin.example.com/3_application/certs/httpbin.example.com.cert.pem \\\n--from-file=cacert=httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem\n</code></pre> <ul> <li>\u4fee\u6539\u7f51\u5173\u5b9a\u4e49\uff0c\u8bbe\u7f6e TLS \u7684\u6a21\u5f0f\u4e3a <code>MUTUAL</code>\uff1a</li> </ul> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n name: mygateway\nspec:\n selector:\n   istio: ingressgateway # Istio \u7684\u7f3a\u7701 Ingress \u7f51\u5173\n servers:\n - port:\n     number: 443\n     name: https\n     protocol: HTTPS\n   tls:\n     mode: MUTUAL\n     credentialName: \"httpbin-credential\" # \u548c Secret \u540d\u79f0\u4e00\u81f4\n   hosts:\n   - \"httpbin.example.com\"\nEOF\n</code></pre> <ul> <li>\u4f7f\u7528\u524d\u9762\u7684\u65b9\u5f0f\u5c1d\u8bd5\u53d1\u51fa HTTPS \u8bf7\u6c42\uff0c\u4f1a\u770b\u5230\u5931\u8d25\u7684\u8fc7\u7a0b\uff1a</li> </ul> <pre><code>curl -v -HHost:httpbin.example.com \\\n--resolve httpbin.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \\\n--cacert httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem \\\nhttps://httpbin.example.com:$SECURE_INGRESS_PORT/status/418\n\n[root@VM_0_3_centos istio-1.2.2]# curl -v -HHost:httpbin.example.com \\\n&gt; --resolve httpbin.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \\\n&gt; --cacert httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem \\\n&gt; https://httpbin.example.com:$SECURE_INGRESS_PORT/status/418\n* Added httpbin.example.com:31390:172.16.0.3 to DNS cache\n* About to connect() to httpbin.example.com port 31390 (#0)\n*   Trying 172.16.0.3...\n* Connected to httpbin.example.com (172.16.0.3) port 31390 (#0)\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem\n  CApath: none\n* NSS: client certificate not found (nickname not specified)\n* NSS error -12227 (SSL_ERROR_HANDSHAKE_FAILURE_ALERT)\n* SSL peer was unable to negotiate an acceptable set of security parameters.\n* Closing connection 0\ncurl: (35) NSS: client certificate not found (nickname not specified)\n</code></pre> <ul> <li>\u5728 <code>curl</code> \u547d\u4ee4\u4e2d\u52a0\u5165\u5ba2\u6237\u7aef\u8bc1\u4e66\u548c\u79c1\u94a5\u7684\u53c2\u6570\uff0c\u91cd\u65b0\u53d1\u9001\u8bf7\u6c42\u3002\uff08\u5ba2\u6237\u7aef\u8bc1\u4e66\u53c2\u6570\u4e3a <code>--cert</code>\uff0c\u79c1\u94a5\u53c2\u6570\u4e3a <code>--key</code>\uff09</li> </ul> <pre><code>curl -v -HHost:httpbin.example.com \\\n--resolve httpbin.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \\\n--cacert httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem \\\n--cert httpbin.example.com/4_client/certs/httpbin.example.com.cert.pem \\\n--key httpbin.example.com/4_client/private/httpbin.example.com.key.pem \\\nhttps://httpbin.example.com:$SECURE_INGRESS_PORT/status/418\n\n[root@VM_0_3_centos istio-1.2.2]# curl -v -HHost:httpbin.example.com \\\n&gt; --resolve httpbin.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST \\\n&gt; --cacert httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem \\\n&gt; --cert httpbin.example.com/4_client/certs/httpbin.example.com.cert.pem \\\n&gt; --key httpbin.example.com/4_client/private/httpbin.example.com.key.pem \\\n&gt; https://httpbin.example.com:$SECURE_INGRESS_PORT/status/418\n* Added httpbin.example.com:31390:172.16.0.3 to DNS cache\n* About to connect() to httpbin.example.com port 31390 (#0)\n*   Trying 172.16.0.3...\n* Connected to httpbin.example.com (172.16.0.3) port 31390 (#0)\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: httpbin.example.com/2_intermediate/certs/ca-chain.cert.pem\n  CApath: none\n* NSS: client certificate from file\n*   subject: CN=httpbin.example.com,O=Dis,L=Springfield,ST=Denial,C=US\n*   start date: 8\u6708 06 09:48:15 2019 GMT\n*   expire date: 8\u6708 15 09:48:15 2020 GMT\n*   common name: httpbin.example.com\n*   issuer: CN=httpbin.example.com,O=Dis,ST=Denial,C=US\n* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n* Server certificate:\n*   subject: CN=httpbin.example.com,O=Dis,L=Springfield,ST=Denial,C=US\n*   start date: 8\u6708 06 09:48:13 2019 GMT\n*   expire date: 8\u6708 15 09:48:13 2020 GMT\n*   common name: httpbin.example.com\n*   issuer: CN=httpbin.example.com,O=Dis,ST=Denial,C=US\n&gt; GET /status/418 HTTP/1.1\n&gt; User-Agent: curl/7.29.0\n&gt; Accept: */*\n&gt; Host:httpbin.example.com\n&gt;\n&lt; HTTP/1.1 418 Unknown\n&lt; server: istio-envoy\n&lt; date: Wed, 14 Aug 2019 09:24:53 GMT\n&lt; access-control-allow-origin: *\n&lt; x-more-info: http://tools.ietf.org/html/rfc2324\n&lt; access-control-allow-credentials: true\n&lt; content-length: 135\n&lt; x-envoy-upstream-service-time: 5\n&lt;\n\n    -=[ teapot ]=-\n\n       _...._\n     .'  _ _ `.\n    | .\"` ^ `\". _,\n    \\_;`\"---\"`|//\n      |       ;/\n      \\_     _/\n        `\"\"\"`\n* Connection #0 to host httpbin.example.com left intact\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_27","title":"\u6e05\u7406","text":"<ul> <li>\u5220\u9664\u7f51\u5173\u914d\u7f6e\u3001<code>VirtualService</code> \u4ee5\u53ca <code>Secret</code>\uff1a</li> </ul> <pre><code>$ kubectl delete gateway mygateway\n$ kubectl delete virtualservice httpbin\n$ kubectl delete --ignore-not-found=true -n istio-system secret httpbin-credential \\\nhelloworld-credential\n$ kubectl delete --ignore-not-found=true virtualservice helloworld-v1\n</code></pre> <ul> <li>\u5220\u9664\u8bc1\u4e66\u76ee\u5f55\u4ee5\u53ca\u7528\u4e8e\u751f\u6210\u8bc1\u4e66\u7684\u4ee3\u7801\u5e93\uff1a</li> </ul> <pre><code>$ rm -rf httpbin.example.com helloworld-v1.example.com mtls-go-example\n</code></pre> <ul> <li>\u5220\u9664\u7528\u4e8e\u91cd\u65b0\u90e8\u7f72 Ingress \u7f51\u5173\u7684\u6587\u4ef6\uff1a</li> </ul> <pre><code>$ rm -f $HOME/istio-ingressgateway.yaml\n</code></pre> <ul> <li>\u5173\u95ed <code>httpbin</code> \u548c <code>helloworld-v1</code> \u670d\u52a1\uff1a</li> </ul> <pre><code>$ kubectl delete service --ignore-not-found=true helloworld-v1\n$ kubectl delete service --ignore-not-found=true httpbin\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#egress","title":"\u63a7\u5236 Egress \u6d41\u91cf","text":"<p>\u7f3a\u7701\u60c5\u51b5\u4e0b\uff0cIstio \u670d\u52a1\u7f51\u683c\u5185\u7684 Pod\uff0c\u7531\u4e8e\u5176 iptables \u5c06\u6240\u6709\u5916\u53d1\u6d41\u91cf\u90fd\u900f\u660e\u7684\u8f6c\u53d1\u7ed9\u4e86 Sidecar\uff0c\u6240\u4ee5\u8fd9\u4e9b\u96c6\u7fa4\u5185\u7684\u670d\u52a1\u65e0\u6cd5\u8bbf\u95ee\u96c6\u7fa4\u4e4b\u5916\u7684 URL\uff0c\u800c\u53ea\u80fd\u5904\u7406\u96c6\u7fa4\u5185\u90e8\u7684\u76ee\u6807\u3002</p> <p>\u672c\u6587\u7684\u4efb\u52a1\u63cf\u8ff0\u4e86\u5982\u4f55\u5c06\u5916\u90e8\u670d\u52a1\u66b4\u9732\u7ed9 Istio \u96c6\u7fa4\u4e2d\u7684\u5ba2\u6237\u7aef\u3002\u4f60\u5c06\u4f1a\u5b66\u5230\u5982\u4f55\u901a\u8fc7\u5b9a\u4e49 <code>ServiceEntry</code> \u6765\u8c03\u7528\u5916\u90e8\u670d\u52a1\uff1b\u6216\u8005\u7b80\u5355\u7684\u5bf9 Istio \u8fdb\u884c\u914d\u7f6e\uff0c\u8981\u6c42\u5176\u76f4\u63a5\u653e\u884c\u5bf9\u7279\u5b9a IP \u8303\u56f4\u7684\u8bbf\u95ee\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_28","title":"\u542f\u52a8\u793a\u4f8b\u5e94\u7528","text":"<pre><code>kubectl apply -f &lt;(istioctl kube-inject -f samples/sleep/sleep.yaml)\n</code></pre> <p>\u5c06 <code>SOURCE_POD</code> \u73af\u5883\u53d8\u91cf\u8bbe\u7f6e\u4e3a\u5df2\u90e8\u7f72\u7684 <code>sleep</code> pod\uff1a</p> <pre><code>export SOURCE_POD=$(kubectl get pod -l app=sleep -o jsonpath={.items..metadata.name})\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_29","title":"\u914d\u7f6e\u5916\u90e8\u670d\u52a1","text":"<p>\u901a\u8fc7\u914d\u7f6e Istio <code>ServiceEntry</code>\uff0c\u53ef\u4ee5\u4ece Istio \u96c6\u7fa4\u4e2d\u8bbf\u95ee\u4efb\u4f55\u53ef\u516c\u5f00\u8bbf\u95ee\u7684\u670d\u52a1\u3002 \u8fd9\u91cc\u6211\u4eec\u4f1a\u4f7f\u7528 httpbin.org \u4ee5\u53ca www.google.com \u8fdb\u884c\u8bd5\u9a8c\u3002</p> <ul> <li>\u521b\u5efa\u4e00\u4e2a <code>ServiceEntry</code> \u5bf9\u8c61\uff0c\u653e\u884c\u5bf9\u4e00\u4e2a\u5916\u90e8 HTTP \u670d\u52a1\u7684\u8bbf\u95ee\uff1a</li> </ul> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: ServiceEntry\nmetadata:\n  name: httpbin-ext\nspec:\n  hosts:\n  - httpbin.org\n  ports:\n  - number: 80\n    name: http\n    protocol: HTTP\n  resolution: DNS\n  location: MESH_EXTERNAL\nEOF\n\n[root@VM_0_3_centos istio-1.2.2]# kubectl get se\nNAME          HOSTS           LOCATION        RESOLUTION   AGE\nhttpbin-ext   [httpbin.org]   MESH_EXTERNAL   DNS          3s\n</code></pre> <ul> <li>\u521b\u5efa\u4e00\u4e2a <code>ServiceEntry</code> \u4ee5\u53ca <code>VirtualService</code>\uff0c\u5141\u8bb8\u8bbf\u95ee\u5916\u90e8 HTTPS \u670d\u52a1\u3002\u6ce8\u610f\uff1a\u5305\u62ec HTTPS \u5728\u5185\u7684 TLS \u534f\u8bae\uff0c\u5728 <code>ServiceEntry</code> \u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u521b\u5efa TLS <code>VirtualService</code>\u3002</li> </ul> <pre><code>kubectl exec -it $SOURCE_POD -c sleep sh\n</code></pre> <ul> <li>\u5411\u5916\u90e8 HTTP \u670d\u52a1\u53d1\u51fa\u8bf7\u6c42\uff1a</li> </ul> <pre><code>curl http://httpbin.org/headers\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#https","title":"\u914d\u7f6e\u5916\u90e8HTTPS\u670d\u52a1","text":"<ul> <li>\u521b\u5efa\u4e00\u4e2a <code>ServiceEntry</code> \u4ee5\u5141\u8bb8\u8bbf\u95ee\u5916\u90e8 HTTPS \u670d\u52a1\u3002 \u5bf9\u4e8e TLS \u534f\u8bae\uff08\u5305\u62ec HTTPS\uff09\uff0c\u9664\u4e86 <code>ServiceEntry</code> \u4e4b\u5916\uff0c\u8fd8\u9700\u8981 <code>VirtualService</code>\u3002 \u6ca1\u6709 <code>VirtualService</code>, <code>ServiceEntry</code> \u6240\u66b4\u9732\u7684\u670d\u52a1\u5c06\u4e0d\u88ab\u5b9a\u4e49\u3002<code>VirtualService</code> \u5fc5\u987b\u5728 <code>match</code> \u5b50\u53e5\u4e2d\u5305\u542b <code>tls</code> \u89c4\u5219\u548c <code>sni_hosts</code> \u4ee5\u542f\u7528 SNI \u8def\u7531\u3002</li> </ul> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: ServiceEntry\nmetadata:\n  name: google\nspec:\n  hosts:\n  - www.google.com\n  ports:\n  - number: 443\n    name: https\n    protocol: HTTPS\n  resolution: DNS\n  location: MESH_EXTERNAL\n---\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: google\nspec:\n  hosts:\n  - www.google.com\n  tls:\n  - match:\n    - port: 443\n      sni_hosts:\n      - www.google.com\n    route:\n    - destination:\n        host: www.google.com\n        port:\n          number: 443\n      weight: 100\nEOF\n\n\n# \u6d4b\u8bd5\u7531\u4e8e\u7f51\u7edc\u56e0\u7d20\uff0c\u8bbf\u95eehttps\u7684\u767e\u5ea6\n\nkubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: ServiceEntry\nmetadata:\n  name: baidu\nspec:\n  hosts:\n  - www.baidu.com\n  ports:\n  - number: 443\n    name: https\n    protocol: HTTPS\n  resolution: DNS\n  location: MESH_EXTERNAL\n---\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: baidu\nspec:\n  hosts:\n  - www.baidu.com\n  tls:\n  - match:\n    - port: 443\n      sni_hosts:\n      - www.baidu.com\n    route:\n    - destination:\n        host: www.baidu.com\n        port:\n          number: 443\n      weight: 100\nEOF\n</code></pre> <ul> <li>\u6267\u884c <code>sleep service</code> \u6e90 pod\uff1a</li> </ul> <pre><code>kubectl exec -it $SOURCE_POD -c sleep sh\n</code></pre> <ul> <li>\u5411\u5916\u90e8 HTTPS \u670d\u52a1\u53d1\u51fa\u8bf7\u6c42\uff1a</li> </ul> <pre><code>curl https://www.baidu.com\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_30","title":"\u4e3a\u5916\u90e8\u670d\u52a1\u8bbe\u7f6e\u8def\u7531\u89c4\u5219","text":"<p>\u901a\u8fc7 <code>ServiceEntry</code> \u8bbf\u95ee\u5916\u90e8\u670d\u52a1\u7684\u6d41\u91cf\uff0c\u548c\u7f51\u683c\u5185\u6d41\u91cf\u7c7b\u4f3c\uff0c\u90fd\u53ef\u4ee5\u8fdb\u884c Istio \u8def\u7531\u89c4\u5219 \u7684\u914d\u7f6e\u3002\u4e0b\u9762\u6211\u4eec\u4f7f\u7528 <code>istioctl</code> \u4e3a httpbin.org \u670d\u52a1\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\u89c4\u5219\u3002</p> <ul> <li>\u5728\u6d4b\u8bd5 Pod \u5185\u90e8\uff0c\u4f7f\u7528 <code>curl</code> \u8c03\u7528 httpbin.org \u8fd9\u4e00\u5916\u90e8\u670d\u52a1\u7684 <code>/delay</code> \u7aef\u70b9\uff1a</li> </ul> <pre><code>kubectl exec -it $SOURCE_POD -c sleep sh\ntime curl -o /dev/null -s -w \"%{http_code}\\n\" http://httpbin.org/delay/5\n</code></pre> <p>\u8fd9\u4e2a\u8bf7\u6c42\u4f1a\u5728\u5927\u6982\u4e94\u79d2\u949f\u5de6\u53f3\u8fd4\u56de\u4e00\u4e2a\u5185\u5bb9\u4e3a <code>200 (OK)</code> \u7684\u54cd\u5e94\u3002</p> <ul> <li>\u9000\u51fa\u6d4b\u8bd5 Pod\uff0c\u4f7f\u7528 <code>kubectl</code> \u4e3a httpbin.org \u5916\u90e8\u670d\u52a1\u7684\u8bbf\u95ee\u8bbe\u7f6e\u4e00\u4e2a 3 \u79d2\u949f\u7684\u8d85\u65f6\uff1a</li> </ul> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: httpbin-ext\nspec:\n  hosts:\n    - httpbin.org\n  http:\n  - timeout: 3s\n    route:\n      - destination:\n          host: httpbin.org\n        weight: 100\nEOF\n</code></pre> <ul> <li>\u7b49\u5f85\u51e0\u79d2\u949f\u4e4b\u540e\uff0c\u518d\u6b21\u53d1\u8d77 curl \u8bf7\u6c42\uff1a</li> </ul> <pre><code>$ kubectl exec -it $SOURCE_POD -c sleep sh\n$ time curl -o /dev/null -s -w \"%{http_code}\\n\" http://httpbin.org/delay/5\n</code></pre> <p>\u8fd9\u4e00\u6b21\u4f1a\u5728 3 \u79d2\u949f\u4e4b\u540e\u6536\u5230\u4e00\u4e2a\u5185\u5bb9\u4e3a <code>504 (Gateway Timeout)</code> \u7684\u54cd\u5e94\u3002\u867d\u7136 httpbin.org \u8fd8\u5728\u7b49\u5f85\u4ed6\u7684 5 \u79d2\u949f\uff0cIstio \u5374\u5728 3 \u79d2\u949f\u7684\u65f6\u5019\u5207\u65ad\u4e86\u8bf7\u6c42\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_31","title":"\u76f4\u63a5\u8c03\u7528\u5916\u90e8\u670d\u52a1","text":"<p>\u5982\u679c\u60f3\u8981\u8df3\u8fc7 Istio\uff0c\u76f4\u63a5\u8bbf\u95ee\u67d0\u4e2a IP \u8303\u56f4\u5185\u7684\u5916\u90e8\u670d\u52a1\uff0c\u5c31\u9700\u8981\u5bf9 Envoy sidecar \u8fdb\u884c\u914d\u7f6e\uff0c\u963b\u6b62 Envoy \u5bf9\u5916\u90e8\u8bf7\u6c42\u7684\u52ab\u6301\u3002\u53ef\u4ee5\u5728 Helm \u4e2d\u8bbe\u7f6e <code>global.proxy.includeIPRanges</code> \u53d8\u91cf\uff0c\u7136\u540e\u4f7f\u7528 <code>kubectl apply</code> \u547d\u4ee4\u6765\u66f4\u65b0\u540d\u4e3a <code>istio-sidecar-injector</code> \u7684 <code>Configmap</code>\u3002\u5728 <code>istio-sidecar-injector</code> \u66f4\u65b0\u4e4b\u540e\uff0c<code>global.proxy.includeIPRanges</code> \u4f1a\u5728\u6240\u6709\u672a\u6765\u90e8\u7f72\u7684 Pod \u4e2d\u751f\u6548\u3002</p> <p>\u4f7f\u7528 <code>global.proxy.includeIPRanges</code> \u53d8\u91cf\u7684\u6700\u7b80\u5355\u65b9\u5f0f\u5c31\u662f\u628a\u5185\u90e8\u670d\u52a1\u7684 IP \u5730\u5740\u8303\u56f4\u4f20\u9012\u7ed9\u5b83\uff0c\u8fd9\u6837\u5c31\u5728 Sidecar proxy \u7684\u91cd\u5b9a\u5411\u5217\u8868\u4e2d\u6392\u9664\u6389\u4e86\u5916\u90e8\u670d\u52a1\u7684\u5730\u5740\u4e86\u3002</p> <p>\u5185\u90e8\u670d\u52a1\u7684 IP \u8303\u56f4\u53d6\u51b3\u4e8e\u96c6\u7fa4\u7684\u90e8\u7f72\u60c5\u51b5\u3002\u4f8b\u5982 Minikube \u4e2d\u8fd9\u4e00\u8303\u56f4\u662f <code>10.0.0.1/24</code>\uff0c\u8fd9\u4e2a\u914d\u7f6e\u4e2d\uff0c\u5c31\u5e94\u8be5\u8fd9\u6837\u66f4\u65b0 <code>istio-sidecar-injector</code>\uff1a</p> <pre><code>helm template install/kubernetes/helm/istio &lt;\u5b89\u88c5 Istio \u65f6\u6240\u4f7f\u7528\u7684\u53c2\u6570&gt; --set global.proxy.includeIPRanges=\"10.0.0.1/24\" -x templates/sidecar-injector-configmap.yaml | kubectl apply -f -\n</code></pre> <p>\u6ce8\u610f\u8fd9\u91cc\u5e94\u8be5\u4f7f\u7528\u548c\u4e4b\u524d\u90e8\u7f72 Istio \u7684\u65f6\u5019\u540c\u6837\u7684 Helm \u547d\u4ee4\uff0c\u5c24\u5176\u662f <code>--namespace</code> \u53c2\u6570\u3002\u5728\u5b89\u88c5 Istio \u539f\u6709\u547d\u4ee4\u7684\u57fa\u7840\u4e4b\u4e0a\uff0c\u52a0\u5165 <code>--set global.proxy.includeIPRanges=\"10.0.0.1/24\" -x templates/sidecar-injector-configmap.yaml</code> \u5373\u53ef\u3002</p> <p>\u548c\u524d\u9762\u4e00\u6837\uff0c\u91cd\u65b0\u90e8\u7f72 <code>sleep</code> \u5e94\u7528\u3002</p> <p>\u786e\u4fdd\u5df2\u5220\u9664\u4e4b\u524d\u90e8\u7f72\u7684 <code>ServiceEntry</code> \u548c <code>VirtualService</code>\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_32","title":"\u7406\u89e3\u539f\u7406","text":"<p>\u8fd9\u4e2a\u4efb\u52a1\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e24\u79cd\u65b9\u5f0f\u4ece Istio \u670d\u52a1\u7f51\u683c\u5185\u90e8\u6765\u5b8c\u6210\u5bf9\u5916\u90e8\u670d\u52a1\u7684\u8c03\u7528\uff1a</p> <ol> <li>\u4f7f\u7528 <code>ServiceEntry</code> (\u63a8\u8350\u65b9\u5f0f)</li> <li>\u914d\u7f6e Istio sidecar\uff0c\u4ece\u5b83\u7684\u91cd\u5b9a\u5411 IP \u8868\u4e2d\u6392\u9664\u5916\u90e8\u670d\u52a1\u7684 IP \u8303\u56f4</li> </ol> <p>\u7b2c\u4e00\u79cd\u65b9\u5f0f\uff08<code>ServiceEntry</code>\uff09\u4e2d\uff0c\u7f51\u683c\u5185\u90e8\u7684\u670d\u52a1\u4e0d\u8bba\u662f\u8bbf\u95ee\u5185\u90e8\u8fd8\u662f\u5916\u90e8\u7684\u670d\u52a1\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528\u540c\u6837\u7684 Istio \u670d\u52a1\u7f51\u683c\u7684\u7279\u6027\u3002\u6211\u4eec\u901a\u8fc7\u4e3a\u5916\u90e8\u670d\u52a1\u8bbf\u95ee\u8bbe\u7f6e\u8d85\u65f6\u89c4\u5219\u7684\u4f8b\u5b50\uff0c\u6765\u8bc1\u5b9e\u4e86\u8fd9\u4e00\u4f18\u52bf\u3002</p> <p>\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u8d8a\u8fc7\u4e86 Istio sidecar proxy\uff0c\u8ba9\u670d\u52a1\u76f4\u63a5\u8bbf\u95ee\u5230\u5bf9\u5e94\u7684\u5916\u90e8\u5730\u5740\u3002\u7136\u800c\u8981\u8fdb\u884c\u8fd9\u79cd\u914d\u7f6e\uff0c\u9700\u8981\u4e86\u89e3\u4e91\u4f9b\u5e94\u5546\u7279\u5b9a\u7684\u77e5\u8bc6\u548c\u914d\u7f6e\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_33","title":"\u6e05\u7406","text":"<ul> <li>\u5220\u9664\u89c4\u5219\uff1a</li> </ul> <pre><code>$ kubectl delete serviceentry httpbin-ext google\n$ kubectl delete virtualservice httpbin-ext google\n</code></pre> <ul> <li>\u505c\u6b62 sleep \u670d\u52a1\uff1a</li> </ul> <pre><code>$ kubectl delete -f samples/sleep/sleep.yaml\n</code></pre> <ul> <li>\u66f4\u65b0 <code>ConfigMap</code> <code>istio-sidecar-injector</code>\uff0c\u8981\u6c42 Sidecar \u8f6c\u53d1\u6240\u6709\u5916\u53d1\u6d41\u91cf\uff1a</li> </ul> <pre><code>$ helm template install/kubernetes/helm/istio &lt;\u5b89\u88c5 Istio \u65f6\u6240\u4f7f\u7528\u7684\u53c2\u6570&gt; -x templates/sidecar-injector-configmap.yaml | kubectl apply -f -\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_34","title":"\u7194\u65ad","text":"<p>\u672c\u4efb\u52a1\u5c55\u793a\u4e86\u7528\u8fde\u63a5\u3001\u8bf7\u6c42\u4ee5\u53ca\u5916\u90e8\u68c0\u6d4b\u6765\u8fdb\u884c\u7194\u65ad\u914d\u7f6e\u7684\u8fc7\u7a0b\u3002</p> <p>\u65ad\u8def\u5668\u662f\u521b\u5efa\u5f39\u6027\u5fae\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u7684\u91cd\u8981\u6a21\u5f0f\u3002\u65ad\u8def\u5668\u5141\u8bb8\u60a8\u7f16\u5199\u9650\u5236\u6545\u969c\u3001\u5ef6\u8fdf\u5cf0\u503c\u4ee5\u53ca\u5176\u4ed6\u4e0d\u826f\u7f51\u7edc\u7279\u6027\u5f71\u54cd\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u5728\u6b64\u4efb\u52a1\u4e2d\uff0c\u60a8\u5c06\u914d\u7f6e\u65ad\u8def\u5668\u89c4\u5219\uff0c\u7136\u540e\u901a\u8fc7\u6545\u610f\u201c\u8df3\u95f8\u201d\u65ad\u8def\u5668\u6765\u6d4b\u8bd5\u914d\u7f6e\u3002</p> <p>\u542f\u52a8\u5e94\u7528</p> <pre><code>kubectl apply -f &lt;(istioctl kube-inject -f samples/httpbin/httpbin.yaml)\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_35","title":"\u65ad\u8def\u5668","text":"<ul> <li>\u521b\u5efa\u4e00\u4e2a \u76ee\u6807\u89c4\u5219\uff0c\u9488\u5bf9 <code>httpbin</code> \u670d\u52a1\u8bbe\u7f6e\u65ad\u8def\u5668\uff1a</li> </ul> <p>\u5982\u679c\u60a8\u7684 Istio \u542f\u7528\u4e86\u53cc\u5411 TLS \u8eab\u4efd\u9a8c\u8bc1\uff0c\u5219\u5fc5\u987b\u5728\u5e94\u7528\u4e4b\u524d\u5c06 TLS \u6d41\u91cf\u7b56\u7565 <code>mode\uff1aISTIO_MUTUAL</code> \u6dfb\u52a0\u5230 <code>DestinationRule</code>\u3002\u5426\u5219\u8bf7\u6c42\u5c06\u4ea7\u751f 503 \u9519\u8bef\uff0c\u5982\u8bbe\u7f6e\u76ee\u6807\u89c4\u5219\u540e\u51fa\u73b0 503 \u9519\u8bef\u6240\u8ff0\u3002</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: httpbin\nspec:\n  host: httpbin\n  trafficPolicy:\n    connectionPool:\n      tcp:\n        maxConnections: 1\n      http:\n        http1MaxPendingRequests: 1\n        maxRequestsPerConnection: 1\n    outlierDetection:\n      consecutiveErrors: 1\n      interval: 1s\n      baseEjectionTime: 3m\n      maxEjectionPercent: 100\nEOF\n</code></pre> <ul> <li>\u68c0\u67e5\u6211\u4eec\u7684\u76ee\u6807\u89c4\u5219\uff0c\u786e\u5b9a\u5df2\u7ecf\u6b63\u786e\u5efa\u7acb\uff1a</li> </ul> <pre><code>kubectl get destinationrule httpbin -o yaml\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: httpbin\n  ...\nspec:\n  host: httpbin\n  trafficPolicy:\n    connectionPool:\n      http:\n        http1MaxPendingRequests: 1\n        maxRequestsPerConnection: 1\n      tcp:\n        maxConnections: 1\n    outlierDetection:\n      baseEjectionTime: 180.000s\n      consecutiveErrors: 1\n      interval: 1.000s\n      maxEjectionPercent: 100\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_36","title":"\u8bbe\u7f6e\u5ba2\u6237\u7aef","text":"<p>\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u8bbe\u7f6e\u4e86\u8c03\u7528 <code>httpbin</code> \u670d\u52a1\u7684\u89c4\u5219\uff0c\u63a5\u4e0b\u6765\u521b\u5efa\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u7528\u6765\u5411\u540e\u7aef\u670d\u52a1\u53d1\u9001\u8bf7\u6c42\uff0c\u89c2\u5bdf\u662f\u5426\u4f1a\u89e6\u53d1\u7194\u65ad\u7b56\u7565\u3002\u8fd9\u91cc\u8981\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u8d1f\u8f7d\u6d4b\u8bd5\u5ba2\u6237\u7aef\uff0c\u540d\u5b57\u53eb fortio\u3002\u8fd9\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u63a7\u5236\u8fde\u63a5\u6570\u91cf\u3001\u5e76\u53d1\u6570\u4ee5\u53ca\u53d1\u9001 HTTP \u8bf7\u6c42\u7684\u5ef6\u8fdf\u3002\u4f7f\u7528\u8fd9\u4e00\u5ba2\u6237\u7aef\uff0c\u80fd\u591f\u6709\u6548\u7684\u89e6\u53d1\u524d\u9762\u5728\u76ee\u6807\u89c4\u5219\u4e2d\u8bbe\u7f6e\u7684\u7194\u65ad\u7b56\u7565\u3002</p> <ul> <li>\u8fd9\u91cc\u6211\u4eec\u4f1a\u628a\u7ed9\u5ba2\u6237\u7aef\u4e5f\u8fdb\u884c Sidecar \u7684\u6ce8\u5165\uff0c\u4ee5\u6b64\u4fdd\u8bc1 Istio \u5bf9\u7f51\u7edc\u4ea4\u4e92\u7684\u63a7\u5236\uff1a</li> </ul> <pre><code>kubectl apply -f &lt;(istioctl kube-inject -f samples/httpbin/sample-client/fortio-deploy.yaml)\n</code></pre> <ul> <li>\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u767b\u5165\u5ba2\u6237\u7aef Pod \u5e76\u4f7f\u7528 Fortio \u5de5\u5177\u6765\u8c03\u7528 <code>httpbin</code>\u3002<code>-curl</code> \u53c2\u6570\u8868\u660e\u53ea\u8c03\u7528\u4e00\u6b21\uff1a</li> </ul> <pre><code>$ FORTIO_POD=$(kubectl get pod | grep fortio | awk '{ print $1 }')\n$ kubectl exec -it $FORTIO_POD  -c fortio /usr/bin/fortio -- load -curl  http://httpbin:8000/get\n\nHTTP/1.1 200 OK\nserver: envoy\ndate: Tue, 16 Jan 2018 23:47:00 GMT\ncontent-type: application/json\naccess-control-allow-origin: *\naccess-control-allow-credentials: true\ncontent-length: 445\nx-envoy-upstream-service-time: 36\n\n{\n  \"args\": {},\n  \"headers\": {\n    \"Content-Length\": \"0\",\n    \"Host\": \"httpbin:8000\",\n    \"User-Agent\": \"istio/fortio-0.6.2\",\n    \"X-B3-Sampled\": \"1\",\n    \"X-B3-Spanid\": \"824fbd828d809bf4\",\n    \"X-B3-Traceid\": \"824fbd828d809bf4\",\n    \"X-Ot-Span-Context\": \"824fbd828d809bf4;824fbd828d809bf4;0000000000000000\",\n    \"X-Request-Id\": \"1ad2de20-806e-9622-949a-bd1d9735a3f4\"\n  },\n  \"origin\": \"127.0.0.1\",\n  \"url\": \"http://httpbin:8000/get\"\n}\n</code></pre> <p>\u4e0d\u96be\u770b\u51fa\uff0c\u8c03\u7528\u5df2\u7ecf\u6210\u529f\u3002\u63a5\u4e0b\u6765\u505a\u4e9b\u53d8\u5316\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_37","title":"\u89e6\u53d1\u7194\u65ad\u673a\u5236","text":"<p>\u5728\u4e0a\u9762\u7684\u7194\u65ad\u8bbe\u7f6e\u4e2d\u6307\u5b9a\u4e86 <code>maxConnections: 1</code> \u4ee5\u53ca <code>http1MaxPendingRequests: 1</code>\u3002\u8fd9\u610f\u5473\u7740\u5982\u679c\u8d85\u8fc7\u4e86\u4e00\u4e2a\u8fde\u63a5\u540c\u65f6\u53d1\u8d77\u8bf7\u6c42\uff0cIstio \u5c31\u4f1a\u7194\u65ad\uff0c\u963b\u6b62\u540e\u7eed\u7684\u8bf7\u6c42\u6216\u8fde\u63a5\u3002</p> <ul> <li>\u63a5\u4e0b\u6765\u5c1d\u8bd5\u4e00\u4e0b\u4e24\u4e2a\u5e76\u53d1\u8fde\u63a5\uff08<code>-c 2</code>\uff09\uff0c\u53d1\u9001 20 \u8bf7\u6c42\uff08<code>-n 20</code>\uff09\uff1a</li> </ul> <pre><code>kubectl exec -it $FORTIO_POD  -c fortio /usr/bin/fortio -- load -c 2 -qps 0 -n 20 -loglevel Warning http://httpbin:8000/get\n\n[root@VM_0_3_centos istio-1.2.2]# kubectl exec -it $FORTIO_POD  -c fortio /usr/bin/fortio -- load -c 2 -qps 0 -n 20 -loglevel Warning http://httpbin:8000/get\n10:31:28 I logger.go:97&gt; Log level is now 3 Warning (was 2 Info)\nFortio 1.3.1 running at 0 queries per second, 2-&gt;2 procs, for 20 calls: http://httpbin:8000/get\nStarting at max qps with 2 thread(s) [gomax 2] for exactly 20 calls (10 per thread + 0)\n10:31:28 W http_client.go:679&gt; Parsed non ok code 503 (HTTP/1.1 503)\nEnded after 37.04095ms : 20 calls. qps=539.94\nAggregated Function Time : count 20 avg 0.0035982768 +/- 0.001634 min 0.001340763 max 0.006110438 sum 0.071965536\n# range, mid point, percentile, count\n&gt;= 0.00134076 &lt;= 0.002 , 0.00167038 , 25.00, 5\n&gt; 0.002 &lt;= 0.003 , 0.0025 , 45.00, 4\n&gt; 0.003 &lt;= 0.004 , 0.0035 , 55.00, 2\n&gt; 0.004 &lt;= 0.005 , 0.0045 , 65.00, 2\n&gt; 0.005 &lt;= 0.006 , 0.0055 , 90.00, 5\n&gt; 0.006 &lt;= 0.00611044 , 0.00605522 , 100.00, 2\n# target 50% 0.0035\n# target 75% 0.0054\n# target 90% 0.006\n# target 99% 0.00609939\n# target 99.9% 0.00610933\nSockets used: 3 (for perfect keepalive, would be 2)\nCode 200 : 19 (95.0 %)\nCode 503 : 1 (5.0 %)\nResponse Header Sizes : count 20 avg 291.65 +/- 66.91 min 0 max 307 sum 5833\nResponse Body/Total Sizes : count 20 avg 616.3 +/- 68.43 min 318 max 632 sum 12326\nAll done 20 calls (plus 0 warmup) 3.598 ms avg, 539.9 qps\n</code></pre> <ul> <li>\u63a5\u4e0b\u6765\u628a\u5e76\u53d1\u8fde\u63a5\u6570\u91cf\u63d0\u9ad8\u5230 3\uff1a</li> </ul> <pre><code>kubectl exec -it $FORTIO_POD  -c fortio /usr/bin/fortio -- load -c 3 -qps 0 -n 30 -loglevel Warning http://httpbin:8000/get\n\n#\u8fd9\u65f6\u5019\u4f1a\u89c2\u5bdf\u5230\uff0c\u7194\u65ad\u884c\u4e3a\u6309\u7167\u4e4b\u524d\u7684\u8bbe\u8ba1\u751f\u6548\u4e86\uff0c\u53ea\u6709 63.3% \u7684\u8bf7\u6c42\u83b7\u5f97\u901a\u8fc7\uff0c\u5269\u4f59\u8bf7\u6c42\u88ab\u65ad\u8def\u5668\u62e6\u622a\u4e86\uff1a\nCode 200 : 19 (63.3 %)\nCode 503 : 11 (36.7 %)\n</code></pre> <ul> <li>\u6211\u4eec\u53ef\u4ee5\u67e5\u8be2 <code>istio-proxy</code> \u7684\u72b6\u6001\uff0c\u83b7\u53d6\u66f4\u591a\u76f8\u5173\u4fe1\u606f\uff1a</li> </ul> <pre><code>$ kubectl exec -it $FORTIO_POD  -c istio-proxy  -- sh -c 'curl localhost:15000/stats' | grep httpbin | grep pending\ncluster.outbound|80||httpbin.springistio.svc.cluster.local.upstream_rq_pending_active: 0\ncluster.outbound|80||httpbin.springistio.svc.cluster.local.upstream_rq_pending_failure_eject: 0\ncluster.outbound|80||httpbin.springistio.svc.cluster.local.upstream_rq_pending_overflow: 12\ncluster.outbound|80||httpbin.springistio.svc.cluster.local.upstream_rq_pending_total: 39\n</code></pre> <p><code>upstream_rq_pending_overflow</code> \u7684\u503c\u662f <code>12</code>\uff0c\u8bf4\u660e\u6709 <code>12</code> \u6b21\u8c03\u7528\u88ab\u6807\u5fd7\u4e3a\u7194\u65ad\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_38","title":"\u6e05\u7406","text":"<ul> <li>\u6e05\u7406\u89c4\u5219\uff1a</li> </ul> <pre><code>$ kubectl delete destinationrule httpbin\n</code></pre> <ul> <li>\u5173\u95ed httpbin \u670d\u52a1\u548c\u5ba2\u6237\u7aef\uff1a</li> </ul> <pre><code>$ kubectl delete deploy httpbin fortio-deploy\n$ kubectl delete svc httpbin\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_39","title":"\u955c\u50cf","text":"<p>\u6b64\u4efb\u52a1\u6f14\u793a\u4e86 Istio \u7684\u6d41\u91cf\u955c\u50cf\u529f\u80fd\u3002</p> <p>\u6d41\u91cf\u955c\u50cf\uff0c\u4e5f\u79f0\u4e3a\u5f71\u5b50\u6d41\u91cf\uff0c\u662f\u4e00\u4e2a\u4ee5\u5c3d\u53ef\u80fd\u4f4e\u7684\u98ce\u9669\u4e3a\u751f\u4ea7\u5e26\u6765\u53d8\u5316\u7684\u5f3a\u5927\u7684\u529f\u80fd\u3002\u955c\u50cf\u4f1a\u5c06\u5b9e\u65f6\u6d41\u91cf\u7684\u526f\u672c\u53d1\u9001\u5230\u955c\u50cf\u670d\u52a1\u3002\u955c\u50cf\u6d41\u91cf\u53d1\u751f\u5728\u4e3b\u670d\u52a1\u7684\u5173\u952e\u8bf7\u6c42\u8def\u5f84\u4e4b\u5916\u3002</p> <p>\u5728\u6b64\u4efb\u52a1\u4e2d\uff0c\u9996\u5148\u628a\u6240\u6709\u6d41\u91cf\u8def\u7531\u5230 <code>v1</code> \u6d4b\u8bd5\u670d\u52a1\u3002\u7136\u540e\u4f7f\u7528\u89c4\u5219\u5c06\u4e00\u90e8\u5206\u6d41\u91cf\u955c\u50cf\u5230 <code>v2</code>\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_40","title":"\u542f\u52a8\u793a\u4f8b\u5e94\u7528","text":"<p>\u6309\u7167\u5b89\u88c5\u6307\u5357\u4e2d\u7684\u8bf4\u660e\u8bbe\u7f6e Istio\u3002</p> <p>\u9996\u5148\u90e8\u7f72\u542f\u7528\u4e86\u8bbf\u95ee\u65e5\u5fd7\u7684\u4e24\u4e2a\u7248\u672c\u7684 httpbin \u670d\u52a1\uff1a</p> <p>httpbin-v1:</p> <pre><code>cat &lt;&lt;EOF | istioctl kube-inject -f - | kubectl create -f -\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: httpbin-v1\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: httpbin\n        version: v1\n    spec:\n      containers:\n      - image: docker.io/kennethreitz/httpbin\n        imagePullPolicy: IfNotPresent\n        name: httpbin\n        command: [\"gunicorn\", \"--access-logfile\", \"-\", \"-b\", \"0.0.0.0:80\", \"httpbin:app\"]\n        ports:\n        - containerPort: 80\nEOF\n</code></pre> <p>httpbin-v2:</p> <pre><code>cat &lt;&lt;EOF | istioctl kube-inject -f - | kubectl create -f -\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: httpbin-v2\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: httpbin\n        version: v2\n    spec:\n      containers:\n      - image: docker.io/kennethreitz/httpbin\n        imagePullPolicy: IfNotPresent\n        name: httpbin\n        command: [\"gunicorn\", \"--access-logfile\", \"-\", \"-b\", \"0.0.0.0:80\", \"httpbin:app\"]\n        ports:\n        - containerPort: 80\nEOF\n</code></pre> <p>httpbin Kubernetes service:</p> <pre><code>kubectl create -f - &lt;&lt;EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: httpbin\n  labels:\n    app: httpbin\nspec:\n  ports:\n  - name: http\n    port: 8000\n    targetPort: 80\n  selector:\n    app: httpbin\nEOF\n</code></pre> <p>\u542f\u52a8 <code>sleep</code> \u670d\u52a1\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>curl</code> \u6765\u63d0\u4f9b\u8d1f\u8f7d\u4e86\uff1a</p> <p>sleep service:</p> <pre><code>cat &lt;&lt;EOF | istioctl kube-inject -f - | kubectl create -f -\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: sleep\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: sleep\n    spec:\n      containers:\n      - name: sleep\n        image: tutum/curl\n        command: [\"/bin/sleep\",\"infinity\"]\n        imagePullPolicy: IfNotPresent\nEOF\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_41","title":"\u521b\u5efa\u9ed8\u8ba4\u8def\u7531\u7b56\u7565","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cKubernetes \u5728 <code>httpbin</code> \u670d\u52a1\u7684\u4e24\u4e2a\u7248\u672c\u4e4b\u95f4\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u3002\u5728\u6b64\u6b65\u9aa4\u4e2d\u4f1a\u66f4\u6539\u8be5\u884c\u4e3a\uff0c\u628a\u6240\u6709\u6d41\u91cf\u90fd\u8def\u7531\u5230 <code>v1</code>\u3002</p> <ul> <li>\u521b\u5efa\u4e00\u4e2a\u9ed8\u8ba4\u8def\u7531\u89c4\u5219\uff0c\u5c06\u6240\u6709\u6d41\u91cf\u8def\u7531\u5230\u670d\u52a1\u7684 <code>v1</code> \uff1a</li> </ul> <p>\u5982\u679c\u4e3a Istio \u542f\u7528\u4e86\u53cc\u5411 TLS \u8ba4\u8bc1\uff0c\u5728\u5e94\u7528\u524d\u5fc5\u987b\u5c06 TLS \u6d41\u91cf\u7b56\u7565 <code>mode: ISTIO_MUTUAL</code> \u6dfb\u52a0\u5230 <code>DestinationRule</code>\u3002\u5426\u5219\uff0c\u8bf7\u6c42\u5c06\u53d1\u751f 503 \u9519\u8bef\uff0c\u5982\u8bbe\u7f6e\u76ee\u6807\u89c4\u5219\u540e\u51fa\u73b0 503 \u9519\u8bef\u6240\u8ff0\u3002</p> <pre><code>$ kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: httpbin\nspec:\n  hosts:\n    - httpbin\n  http:\n  - route:\n    - destination:\n        host: httpbin\n        subset: v1\n      weight: 100\n---\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: httpbin\nspec:\n  host: httpbin\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n  - name: v2\n    labels:\n      version: v2\nEOF\n</code></pre> <p>\u73b0\u5728\u6240\u6709\u6d41\u91cf\u5df2\u7ecf\u90fd\u8f6c\u5230 <code>httpbin:v1</code> \u670d\u52a1\u3002</p> <ul> <li>\u5411\u670d\u52a1\u53d1\u9001\u4e00\u4e9b\u6d41\u91cf\uff1a</li> </ul> <pre><code>$ export SLEEP_POD=$(kubectl get pod -l app=sleep -o jsonpath={.items..metadata.name})\n$ kubectl exec -it $SLEEP_POD -c sleep -- sh -c 'curl  http://httpbin:8000/headers' | python -m json.tool\n\n{\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Content-Length\": \"0\",\n    \"Host\": \"httpbin:8000\",\n    \"User-Agent\": \"curl/7.35.0\",\n    \"X-B3-Sampled\": \"1\",\n    \"X-B3-Spanid\": \"eca3d7ed8f2e6a0a\",\n    \"X-B3-Traceid\": \"eca3d7ed8f2e6a0a\",\n    \"X-Ot-Span-Context\": \"eca3d7ed8f2e6a0a;eca3d7ed8f2e6a0a;0000000000000000\"\n  }\n}\n</code></pre> <ul> <li>\u67e5\u770b <code>httpbin</code> pods \u7684 <code>v1</code> \u548c <code>v2</code> \u65e5\u5fd7\u3002\u60a8\u53ef\u4ee5\u770b\u5230 <code>v1</code> \u7684\u8bbf\u95ee\u65e5\u5fd7\u548c <code>v2</code> \u4e3a <code>&lt;none&gt;</code> \u7684\u65e5\u5fd7\uff1a</li> </ul> <pre><code>$ export V1_POD=$(kubectl get pod -l app=httpbin,version=v1 -o jsonpath={.items..metadata.name})\n$ kubectl logs -f $V1_POD -c httpbin\n\n127.0.0.1 - - [07/Mar/2018:19:02:43 +0000] \"GET /headers HTTP/1.1\" 200 321 \"-\" \"curl/7.35.0\"\n</code></pre> <pre><code>$ export V2_POD=$(kubectl get pod -l app=httpbin,version=v2 -o jsonpath={.items..metadata.name})\n$ kubectl logs -f $V2_POD -c httpbin\n\n&lt;none&gt;\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#v2","title":"\u955c\u50cf\u6d41\u91cf\u5230 v2","text":"<ul> <li>\u6539\u53d8\u8def\u7531\u89c4\u5219\u5c06\u6d41\u91cf\u955c\u50cf\u5230 v2:</li> </ul> <pre><code>$ kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: httpbin\nspec:\n  hosts:\n    - httpbin\n  http:\n  - route:\n    - destination:\n        host: httpbin\n        subset: v1\n      weight: 100\n    mirror:\n      host: httpbin\n      subset: v2\nEOF\n</code></pre> <p>\u6b64\u8def\u7531\u89c4\u5219\u5c06 100\uff05 \u7684\u6d41\u91cf\u53d1\u9001\u5230 <code>v1</code> \u3002\u6700\u540e\u4e00\u8282\u6307\u5b9a\u955c\u50cf\u5230 <code>httpbin:v2</code> \u670d\u52a1\u3002\u5f53\u6d41\u91cf\u88ab\u955c\u50cf\u65f6\uff0c\u8bf7\u6c42\u5c06\u901a\u8fc7\u5176\u4e3b\u673a/\u6388\u6743\u62a5\u5934\u53d1\u9001\u5230\u955c\u50cf\u670d\u52a1\u9644\u4e0a <code>-shadow</code>\u3002\u4f8b\u5982\uff0c\u5c06 <code>cluster-1</code> \u53d8\u4e3a <code>cluster-1-shadow</code>\u3002</p> <p>\u6b64\u5916\uff0c\u91cd\u70b9\u6ce8\u610f\u8fd9\u4e9b\u88ab\u955c\u50cf\u7684\u8bf7\u6c42\u662f\u201c\u5373\u53d1\u5373\u5f03\u201d\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e9b\u8bf7\u6c42\u5f15\u53d1\u7684\u54cd\u5e94\u662f\u4f1a\u88ab\u4e22\u5f03\u7684\u3002</p> <ul> <li>\u53d1\u9001\u6d41\u91cf\uff1a</li> </ul> <pre><code>$ kubectl exec -it $SLEEP_POD -c sleep -- sh -c 'curl  http://httpbin:8000/headers' | python -m json.tool\n</code></pre> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u770b\u5230 <code>v1</code> \u548c <code>v2</code> \u4e2d\u90fd\u6709\u4e86\u8bbf\u95ee\u65e5\u5fd7\u3002<code>v2</code> \u4e2d\u7684\u8bbf\u95ee\u65e5\u5fd7\u5c31\u662f\u7531\u955c\u50cf\u6d41\u91cf\u4ea7\u751f\u7684\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u7684\u5b9e\u9645\u76ee\u6807\u662f <code>v1</code>\uff1a</p> <pre><code>$ kubectl logs -f $V1_POD -c httpbin\n\n127.0.0.1 - - [07/Mar/2018:19:02:43 +0000] \"GET /headers HTTP/1.1\" 200 321 \"-\" \"curl/7.35.0\"\n127.0.0.1 - - [07/Mar/2018:19:26:44 +0000] \"GET /headers HTTP/1.1\" 200 321 \"-\" \"curl/7.35.0\"\n</code></pre> <pre><code>$ kubectl logs -f $V2_POD -c httpbin\n\n127.0.0.1 - - [07/Mar/2018:19:26:44 +0000] \"GET /headers HTTP/1.1\" 200 361 \"-\" \"curl/7.35.0\"\n</code></pre> <ul> <li>\u5982\u679c\u8981\u68c0\u67e5\u6d41\u91cf\u5185\u90e8\uff0c\u8bf7\u5728\u53e6\u4e00\u4e2a\u63a7\u5236\u53f0\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</li> </ul> <pre><code>$ export SLEEP_POD=$(kubectl get pod -l app=sleep -o jsonpath={.items..metadata.name})\n$ export V1_POD_IP=$(kubectl get pod -l app=httpbin -l version=v1 -o jsonpath={.items..status.podIP})\n$ export V2_POD_IP=$(kubectl get pod -l app=httpbin -l version=v2 -o jsonpath={.items..status.podIP})\n$ kubectl exec -it $SLEEP_POD -c istio-proxy -- sudo tcpdump -A -s 0 host $V1_POD_IP or host $V2_POD_IP\n\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes\n05:47:50.159513 IP sleep-7b9f8bfcd-2djx5.38836 &gt; 10-233-75-11.httpbin.default.svc.cluster.local.80: Flags [P.], seq 4039989036:4039989832, ack 3139734980, win 254, options [nop,nop,TS val 77427918 ecr 76730809], length 796: HTTP: GET /headers HTTP/1.1\nE..P2.X.X.X.\n.K.\n.K....P..W,.$.......+.....\n..t.....GET /headers HTTP/1.1\nhost: httpbin:8000\nuser-agent: curl/7.35.0\naccept: */*\nx-forwarded-proto: http\nx-request-id: 571c0fd6-98d4-4c93-af79-6a2fe2945847\nx-envoy-decorator-operation: httpbin.default.svc.cluster.local:8000/*\nx-b3-traceid: 82f3e0a76dcebca2\nx-b3-spanid: 82f3e0a76dcebca2\nx-b3-sampled: 0\nx-istio-attributes: Cj8KGGRlc3RpbmF0aW9uLnNlcnZpY2UuaG9zdBIjEiFodHRwYmluLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwKPQoXZGVzdGluYXRpb24uc2VydmljZS51aWQSIhIgaXN0aW86Ly9kZWZhdWx0L3NlcnZpY2VzL2h0dHBiaW4KKgodZGVzdGluYXRpb24uc2VydmljZS5uYW1lc3BhY2USCRIHZGVmYXVsdAolChhkZXN0aW5hdGlvbi5zZXJ2aWNlLm5hbWUSCRIHaHR0cGJpbgo6Cgpzb3VyY2UudWlkEiwSKmt1YmVybmV0ZXM6Ly9zbGVlcC03YjlmOGJmY2QtMmRqeDUuZGVmYXVsdAo6ChNkZXN0aW5hdGlvbi5zZXJ2aWNlEiMSIWh0dHBiaW4uZGVmYXVsdC5zdmMuY2x1c3Rlci5sb2NhbA==\ncontent-length: 0\n\n\n05:47:50.159609 IP sleep-7b9f8bfcd-2djx5.49560 &gt; 10-233-71-7.httpbin.default.svc.cluster.local.80: Flags [P.], seq 296287713:296288571, ack 4029574162, win 254, options [nop,nop,TS val 77427918 ecr 76732809], length 858: HTTP: GET /headers HTTP/1.1\nE.....X.X...\n.K.\n.G....P......l......e.....\n..t.....GET /headers HTTP/1.1\nhost: httpbin-shadow:8000\nuser-agent: curl/7.35.0\naccept: */*\nx-forwarded-proto: http\nx-request-id: 571c0fd6-98d4-4c93-af79-6a2fe2945847\nx-envoy-decorator-operation: httpbin.default.svc.cluster.local:8000/*\nx-b3-traceid: 82f3e0a76dcebca2\nx-b3-spanid: 82f3e0a76dcebca2\nx-b3-sampled: 0\nx-istio-attributes: Cj8KGGRlc3RpbmF0aW9uLnNlcnZpY2UuaG9zdBIjEiFodHRwYmluLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwKPQoXZGVzdGluYXRpb24uc2VydmljZS51aWQSIhIgaXN0aW86Ly9kZWZhdWx0L3NlcnZpY2VzL2h0dHBiaW4KKgodZGVzdGluYXRpb24uc2VydmljZS5uYW1lc3BhY2USCRIHZGVmYXVsdAolChhkZXN0aW5hdGlvbi5zZXJ2aWNlLm5hbWUSCRIHaHR0cGJpbgo6Cgpzb3VyY2UudWlkEiwSKmt1YmVybmV0ZXM6Ly9zbGVlcC03YjlmOGJmY2QtMmRqeDUuZGVmYXVsdAo6ChNkZXN0aW5hdGlvbi5zZXJ2aWNlEiMSIWh0dHBiaW4uZGVmYXVsdC5zdmMuY2x1c3Rlci5sb2NhbA==\nx-envoy-internal: true\nx-forwarded-for: 10.233.75.12\ncontent-length: 0\n\n\n05:47:50.166734 IP 10-233-75-11.httpbin.default.svc.cluster.local.80 &gt; sleep-7b9f8bfcd-2djx5.38836: Flags [P.], seq 1:472, ack 796, win 276, options [nop,nop,TS val 77427925 ecr 77427918], length 471: HTTP: HTTP/1.1 200 OK\nE....3X.?...\n.K.\n.K..P...$....ZH...........\n..t...t.HTTP/1.1 200 OK\nserver: envoy\ndate: Fri, 15 Feb 2019 05:47:50 GMT\ncontent-type: application/json\ncontent-length: 241\naccess-control-allow-origin: *\naccess-control-allow-credentials: true\nx-envoy-upstream-service-time: 3\n\n{\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Content-Length\": \"0\",\n    \"Host\": \"httpbin:8000\",\n    \"User-Agent\": \"curl/7.35.0\",\n    \"X-B3-Sampled\": \"0\",\n    \"X-B3-Spanid\": \"82f3e0a76dcebca2\",\n    \"X-B3-Traceid\": \"82f3e0a76dcebca2\"\n  }\n}\n\n05:47:50.166789 IP sleep-7b9f8bfcd-2djx5.38836 &gt; 10-233-75-11.httpbin.default.svc.cluster.local.80: Flags [.], ack 472, win 262, options [nop,nop,TS val 77427925 ecr 77427925], length 0\nE..42.X.X.\\.\n.K.\n.K....P..ZH.$.............\n..t...t.\n05:47:50.167234 IP 10-233-71-7.httpbin.default.svc.cluster.local.80 &gt; sleep-7b9f8bfcd-2djx5.49560: Flags [P.], seq 1:512, ack 858, win 280, options [nop,nop,TS val 77429926 ecr 77427918], length 511: HTTP: HTTP/1.1 200 OK\nE..3..X.&gt;...\n.G.\n.K..P....l....;...........\n..|...t.HTTP/1.1 200 OK\nserver: envoy\ndate: Fri, 15 Feb 2019 05:47:49 GMT\ncontent-type: application/json\ncontent-length: 281\naccess-control-allow-origin: *\naccess-control-allow-credentials: true\nx-envoy-upstream-service-time: 3\n\n{\n  \"headers\": {\n    \"Accept\": \"*/*\",\n    \"Content-Length\": \"0\",\n    \"Host\": \"httpbin-shadow:8000\",\n    \"User-Agent\": \"curl/7.35.0\",\n    \"X-B3-Sampled\": \"0\",\n    \"X-B3-Spanid\": \"82f3e0a76dcebca2\",\n    \"X-B3-Traceid\": \"82f3e0a76dcebca2\",\n    \"X-Envoy-Internal\": \"true\"\n  }\n}\n\n05:47:50.167253 IP sleep-7b9f8bfcd-2djx5.49560 &gt; 10-233-71-7.httpbin.default.svc.cluster.local.80: Flags [.], ack 512, win 262, options [nop,nop,TS val 77427926 ecr 77429926], length 0\nE..4..X.X...\n.K.\n.G....P...;..n............\n..t...|.\n</code></pre> <p>\u60a8\u53ef\u4ee5\u67e5\u770b\u6d41\u91cf\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u5185\u5bb9\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_42","title":"\u6e05\u7406","text":"<ul> <li>\u5220\u9664\u89c4\u5219\uff1a</li> </ul> <pre><code>$ kubectl delete virtualservice httpbin\n$ kubectl delete destinationrule httpbin\n</code></pre> <ul> <li>\u5173\u95ed httpbin \u670d\u52a1\u548c\u5ba2\u6237\u7aef\uff1a</li> </ul> <pre><code>$ kubectl delete deploy httpbin-v1 httpbin-v2 sleep\n$ kubectl delete svc httpbin\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_43","title":"\u8fb9\u7f18\u6d41\u91cf\u63a7\u5236","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#1-tls-ingress-gateway","title":"1.\u6ca1\u6709 TLS \u7684 Ingress gateway","text":"<p>\u4f7f\u7528 HTTPS \u4fdd\u62a4\u7f51\u5173\u4efb\u52a1\u63cf\u8ff0\u4e86\u5982\u4f55\u914d\u7f6e HTTPS \u5165\u53e3\u8bbf\u95ee HTTP \u670d\u52a1\u3002\u6b64\u793a\u4f8b\u4ecb\u7ecd\u5982\u4f55\u914d\u7f6e\u5bf9 HTTPS \u670d\u52a1\u7684\u5165\u53e3\u8bbf\u95ee\uff0c\u5373\u914d\u7f6e Ingress Gateway \u4ee5\u6267\u884c SNI \u76f4\u901a\uff0c\u800c\u4e0d\u662f\u7ec8\u6b62 TLS \u8bf7\u6c42\u7684\u4f20\u5165\u3002</p> <p>\u7528\u4e8e\u6b64\u4efb\u52a1\u7684\u793a\u4f8b HTTPS \u670d\u52a1\u662f\u4e00\u4e2a\u7b80\u5355\u7684 NGINX \u670d\u52a1\u5668\u3002 \u5728\u4ee5\u4e0b\u6b65\u9aa4\u4e2d\uff0c\u9996\u5148\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u90e8\u7f72 NGINX \u670d\u52a1\u3002 \u7136\u540e\u914d\u7f6e\u7f51\u5173\u4ee5\u901a\u8fc7\u4e3b\u673a <code>nginx.example.com</code> \u63d0\u4f9b\u5bf9\u6b64\u670d\u52a1\u7684\u5165\u53e3\u8bbf\u95ee\u3002</p> <pre><code>pushd mtls-go-example\n./generate.sh nginx.example.com password\nmkdir ../nginx.example.com &amp;&amp; mv 1_root 2_intermediate 3_application 4_client ../nginx.example.com\npopd\n</code></pre> <ul> <li>\u90e8\u7f72NGINX\u670d\u52a1\u5668</li> </ul> <p>\u521b\u5efa\u4e00\u4e2akubernetes secret\u4fdd\u5b58\u670d\u52a1\u5668\u7684\u8bc1\u4e66</p> <pre><code>kubectl create secret tls nginx-server-certs --key nginx.example.com/3_application/private/nginx.example.com.key.pem --cert nginx.example.com/3_application/certs/nginx.example.com.cert.pem\n</code></pre> <p>\u521b\u5efaNGINX\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6</p> <pre><code>cat &lt;&lt;EOF &gt; ./nginx.conf\nevents {\n}\n\nhttp {\n  log_format main '$remote_addr - $remote_user [$time_local]  $status '\n  '\"$request\" $body_bytes_sent \"$http_referer\" '\n  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n  access_log /var/log/nginx/access.log main;\n  error_log  /var/log/nginx/error.log;\n\n  server {\n    listen 443 ssl;\n\n    root /usr/share/nginx/html;\n    index index.html;\n\n    server_name nginx.example.com;\n    ssl_certificate /etc/nginx-server-certs/tls.crt;\n    ssl_certificate_key /etc/nginx-server-certs/tls.key;\n  }\n}\nEOF\n</code></pre> <p>\u521b\u5efa Kubernetes ConfigMap \u4fdd\u6301 NGINX \u670d\u52a1\u5668\u7684\u914d\u7f6e\uff1a</p> <pre><code>kubectl create configmap nginx-configmap --from-file=nginx.conf=./nginx.conf\n</code></pre> <p>\u90e8\u7f72NGINX\u670d\u52a1\u5668\uff1a</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: my-nginx\n  labels:\n    run: my-nginx\nspec:\n  ports:\n  - port: 443\n    protocol: TCP\n  selector:\n    run: my-nginx\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-nginx\nspec:\n  selector:\n    matchLabels:\n      run: my-nginx\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        run: my-nginx\n    spec:\n      containers:\n      - name: my-nginx\n        image: nginx\n        ports:\n        - containerPort: 443\n        volumeMounts:\n        - name: nginx-config\n          mountPath: /etc/nginx\n          readOnly: true\n        - name: nginx-server-certs\n          mountPath: /etc/nginx-server-certs\n          readOnly: true\n      volumes:\n      - name: nginx-config\n        configMap:\n          name: nginx-configmap\n      - name: nginx-server-certs\n        secret:\n          secretName: nginx-server-certs\nEOF\n</code></pre> <p>\u8981\u6d4b\u8bd5 NGINX \u670d\u52a1\u5668\u662f\u5426\u5df2\u6210\u529f\u90e8\u7f72\uff0c\u8bf7\u4ece\u5176 sidecar \u4ee3\u7406\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\uff0c \u800c\u4e0d\u68c0\u67e5\u670d\u52a1\u5668\u7684\u8bc1\u4e66\uff08\u4f7f\u7528 <code>curl</code> \u7684 <code>-k</code> \u9009\u9879\uff09\u3002\u786e\u4fdd\u6b63\u786e\u6253\u5370\u670d\u52a1\u5668\u7684\u8bc1\u4e66\uff0c \u5373 <code>common name</code> \u7b49\u4e8e <code>nginx.example.com</code></p> <pre><code>kubectl exec -it $(kubectl get pod  -l run=my-nginx -o jsonpath={.items..metadata.name}) -c istio-proxy -- curl -v -k --resolve nginx.example.com:443:127.0.0.1 https://nginx.example.com\n</code></pre> <ul> <li>\u914d\u7f6e Ingress Gateway</li> </ul> <p>\u4e3a\u7aef\u53e3 443 \u5b9a\u4e49\u4e00\u4e2a\u5e26\u6709 <code>server</code> \u90e8\u5206\u7684 <code>Gateway</code> \u3002\u6ce8\u610f <code>PASSTHROUGH</code> <code>tls</code> <code>mode</code> \u6307\u793a\u7f51\u5173\u6309\u539f\u6837\u4f20\u9012\u5165\u53e3\u6d41\u91cf\uff0c \u800c\u4e0d\u7ec8\u6b62 TLS\u3002</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: mygateway\nspec:\n  selector:\n    istio: ingressgateway # \u4f7f\u7528 istio \u9ed8\u8ba4\u7684 ingress gateway\n  servers:\n  - port:\n      number: 443\n      name: https\n      protocol: HTTPS\n    tls:\n      mode: PASSTHROUGH\n    hosts:\n    - nginx.example.com\nEOF\n</code></pre> <p>\u914d\u7f6e\u901a\u8fc7 <code>Gateway</code> \u8fdb\u5165\u7684\u6d41\u91cf\u8def\u7531\uff1a</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: nginx\nspec:\n  hosts:\n  - nginx.example.com\n  gateways:\n  - mygateway\n  tls:\n  - match:\n    - port: 443\n      sni_hosts:\n      - nginx.example.com\n    route:\n    - destination:\n        host: my-nginx\n        port:\n          number: 443\nEOF\n</code></pre> <p>\u6309\u7167\u786e\u5b9a\u5165\u53e3IP\u548c\u7aef\u53e3\u4e2d\u7684\u8bf4\u660e\u5b9a\u4e49 <code>SECURE_INGRESS_PORT</code> \u548c <code>INGRESS_HOST</code> \u73af\u5883\u53d8\u91cf\u3002</p> <p>\u4ece\u7fa4\u96c6\u5916\u90e8\u8bbf\u95ee NGINX \u670d\u52a1\u3002\u8bf7\u6ce8\u610f\uff0c\u670d\u52a1\u5668\u8fd4\u56de\u6b63\u786e\u7684\u8bc1\u4e66\u5e76\u6210\u529f\u9a8c\u8bc1\uff08\u6253\u5370 SSL certificate verify ok \uff09</p> <pre><code>curl -v --resolve nginx.example.com:$SECURE_INGRESS_PORT:$INGRESS_HOST --cacert nginx.example.com/2_intermediate/certs/ca-chain.cert.pem https://nginx.example.com:$SECURE_INGRESS_PORT\n</code></pre> <ul> <li> <p>\u6e05\u7406</p> </li> <li> <p>\u5220\u9664\u521b\u5efa\u7684 Kubernetes \u8d44\u6e90\uff1a</p> </li> </ul> <pre><code>$ kubectl delete secret nginx-server-certs\n$ kubectl delete configmap nginx-configmap\n$ kubectl delete service my-nginx\n$ kubectl delete deployment my-nginx\n$ kubectl delete gateway mygateway\n$ kubectl delete virtualservice nginx\n</code></pre> <ol> <li>\u5220\u9664\u5305\u542b\u8bc1\u4e66\u7684\u76ee\u5f55\u548c\u7528\u4e8e\u751f\u6210\u8bc1\u4e66\u7684\u5b58\u50a8\u5e93\uff1a</li> </ol> <pre><code>$ rm -rf nginx.example.com mtls-go-example\n</code></pre> <ol> <li>\u5220\u9664\u6b64\u793a\u4f8b\u4e2d\u4f7f\u7528\u7684\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6\uff1a</li> </ol> <pre><code>$ rm -f ./nginx.conf\n</code></pre> <ul> <li></li> </ul>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_44","title":"\u751f\u6210\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u8bc1\u4e66\u548c\u5bc6\u94a5","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#2egress-tls","title":"2.Egress \u7f51\u5173\u7684 TLS \u53d1\u8d77\u8fc7\u7a0b","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#3-tls","title":"3.\u51fa\u53e3\u6d41\u91cf\u7684 TLS","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#4-egress-gateway","title":"4.\u914d\u7f6e Egress gateway","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#5-egress","title":"5.\u4f7f\u7528\u901a\u914d\u7b26\u4e3b\u673a\u914d\u7f6e Egress \u6d41\u91cf","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#6egress-tls-sni","title":"6.Egress TLS \u6d41\u91cf\u4e2d\u7684 SNI \u76d1\u63a7\u53ca\u7b56\u7565","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#7-https","title":"7.\u8fde\u63a5\u5230\u5916\u90e8 HTTPS \u4ee3\u7406","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#8-cert-manager-kubernetes-ingress","title":"8.\u4f7f\u7528 cert-manager \u52a0\u5bc6 Kubernetes Ingress","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_45","title":"\u5b89\u5168","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#http_1","title":"HTTP \u670d\u52a1\u7684\u8bbf\u95ee\u63a7\u5236","text":"<p>Istio \u91c7\u7528\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\u65b9\u5f0f\uff0c\u672c\u6587\u5185\u5bb9\u6db5\u76d6\u4e86\u4e3a HTTP \u8bbe\u7f6e\u8bbf\u95ee\u63a7\u5236\u7684\u5404\u4e2a\u73af\u8282\u3002\u5728\u8ba4\u8bc1\u6982\u5ff5\u4e00\u6587\u4e2d\u63d0\u4f9b\u4e86 Istio \u5b89\u5168\u65b9\u9762\u7684\u5165\u95e8\u6559\u7a0b\u3002</p>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_46","title":"\u9065\u6d4b","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_47","title":"\u6307\u6807\u5ea6\u91cf","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_48","title":"\u6536\u96c6\u6307\u6807\u548c\u65e5\u5fd7","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#tcp_2","title":"\u83b7\u53d6 TCP \u670d\u52a1\u6307\u6807","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#prometheus","title":"\u67e5\u8be2 Prometheus \u7684\u6307\u6807","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#grafana","title":"\u4f7f\u7528 Grafana \u53ef\u89c6\u5316\u6307\u6807\u5ea6\u91cf","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_49","title":"\u5206\u5e03\u5f0f\u8ffd\u8e2a","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_50","title":"\u6982\u8ff0","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#jaeger","title":"Jaeger","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#zipkin","title":"Zipkin","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#lightstep-xpm","title":"\u4f7f\u7528 LightStep [\ud835\udc65]PM \u8fdb\u884c\u5206\u5e03\u5f0f\u8ffd\u8e2a","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_51","title":"\u65e5\u5fd7","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#envoy","title":"\u83b7\u53d6 Envoy \u8bbf\u95ee\u65e5\u5fd7","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_52","title":"\u6536\u96c6\u65e5\u5fd7","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#fluentd","title":"\u4f7f\u7528 Fluentd \u8bb0\u5f55\u65e5\u5fd7","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_53","title":"\u7f51\u683c\u53ef\u89c6\u5316","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_54","title":"\u9065\u6d4b\u63d2\u4ef6\u7684\u8fdc\u7a0b\u8bbf\u95ee","text":""},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#43-k8s-istio","title":"4.3 k8s \u96c6\u7fa4\u4e0a\u5b89\u88c5istio","text":"<pre><code># \u4e0b\u8f7distio\ncurl -L https://git.io/getLatestIstio | ISTIO_VERSION=1.2.2 sh -\n\nexport PATH=$PWD/bin:$PATH\n\n# \u521b\u5efans\nkubectl create namespace istio-system\n\n# \u4f7f\u7528 kubectl apply \u5b89\u88c5\u6240\u6709\u7684 Istio CRD\uff0c\u547d\u4ee4\u6267\u884c\u4e4b\u540e\uff0c\u4f1a\u9694\u4e00\u6bb5\u65f6\u95f4\u624d\u80fd\u88ab Kubernetes API Server \u6536\u5230\uff1a\nhelm template install/kubernetes/helm/istio-init --name istio-init --namespace istio-system | kubectl apply -f -\n</code></pre>"},{"location":"cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/#_55","title":"\u76f8\u5173\u94fe\u63a5","text":"<ul> <li>codelab</li> <li>\u5728kubernetes\u96c6\u7fa4\u4e0a\u5b89\u88c5istio\u5e76\u6d4b\u8bd5bookinfo\u793a\u4f8b\u5fae\u670d\u52a1</li> <li>istio\u4e2d\u6587\u6587\u6863</li> <li>istio \u5b66\u4e60\u7b14\u8bb0</li> <li>https://www.katacoda.com/courses/istio/deploy-istio-on-kubernetes</li> <li>https://skyao.io/talk/201811-knative-redefine-serverless/</li> <li>https://yq.aliyun.com/articles/221687</li> <li>https://jimmysong.io/kubernetes-handbook/develop/minikube.html</li> <li>\u6df1\u5165\u89e3\u8bfb Service Mesh \u80cc\u540e\u7684\u6280\u672f\u7ec6\u8282 by \u5218\u8d85</li> <li>Istio\u6d41\u91cf\u7ba1\u7406\u5b9e\u73b0\u673a\u5236\u6df1\u5ea6\u89e3\u6790 by \u8d75\u5316\u51b0</li> <li>Service Mesh\u67b6\u6784\u53cd\u601d\uff1a\u6570\u636e\u5e73\u9762\u548c\u63a7\u5236\u5e73\u9762\u7684\u754c\u7ebf\u8be5\u5982\u4f55\u5212\u5b9a\uff1fby \u6556\u5c0f\u5251</li> <li>\u7406\u89e3 Istio Service Mesh \u4e2d Envoy \u4ee3\u7406 Sidecar \u6ce8\u5165\u53ca\u6d41\u91cf\u52ab\u6301 by \u5b8b\u51c0\u8d85</li> <li>Service Mesh \u6df1\u5ea6\u5b66\u4e60\u7cfb\u5217\u2014\u2014Istio\u6e90\u7801\u5206\u6790\u4e4bpilot-agent\u6a21\u5757\u5206\u6790 by \u4e01\u8f76\u7fa4</li> <li>https://qii404.me/2018/01/06/minukube.html</li> <li>https://mp.weixin.qq.com/s?__biz=MzI3MTI2NzkxMA==&amp;mid=2247486226&amp;idx=1&amp;sn=9573a9ce3d1665da2440ac80a971d2ae&amp;chksm=eac52a3bddb2a32d90a610b247800826152d47889a8ce29635857c19eb84e4f1cbe124a8291f&amp;token=1276805921&amp;lang=zh_CN#rd</li> <li>https://zhaohuabing.com/istio-practice/</li> <li>https://skyao.io/learning-istio/introduction/information.html</li> <li>https://github.com/servicemesher/istio-knowledge-map</li> </ul>"},{"location":"cloud-native/servicemesh/other/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%A0%87%E5%87%86OpenSergo/","title":"\u670d\u52a1\u6cbb\u7406\u6807\u51c6OpenSergo","text":""},{"location":"cloud-native/servicemesh/other/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%A0%87%E5%87%86OpenSergo/#opensergo","title":"\u670d\u52a1\u6cbb\u7406\u6807\u51c6OpenSergo","text":""},{"location":"cloud-native/servicemesh/other/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%A0%87%E5%87%86OpenSergo/#_1","title":"\u4e00 \u524d\u8a00","text":""},{"location":"cloud-native/servicemesh/other/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%A0%87%E5%87%86OpenSergo/#opensergo_1","title":"\u4e8c OpenSergo","text":"<p>OpenSergo\u662f\u4e00\u5957\u5f00\u653e\u7684\u3001\u8bed\u8a00\u65e0\u5173\u7684\u3001\u8d34\u8fd1\u4e1a\u52a1\u8bed\u4e49\u7684\u4e91\u539f\u751f\u670d\u52a1\u6cbb\u7406\u89c4\u8303\u3002 \u9762\u5411\u5f02\u6784\u5fae\u670d\u52a1\u4f53\u7cfb\u7684\u573a\u666f\uff0c\u8ba9\u4f01\u4e1a\u80fd\u591f\u4ee5\u4e00\u79cd\u7edf\u4e00\u7684\u89c4\u8303\u6765\u7ba1\u7406\u4e0d\u540c\u8bed\u8a00\u3001\u4e0d\u540c\u534f\u8bae\u7684\u670d\u52a1\u3002</p>"},{"location":"cloud-native/servicemesh/other/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E6%A0%87%E5%87%86OpenSergo/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li> <p>github.com/opensergo/opensergo-specification</p> </li> <li> <p>https://mp.weixin.qq.com/s/_WQcfyH3H2p7vuT3Keik3Q</p> </li> </ul>"},{"location":"cloud-native/%E5%88%86%E5%B8%83%E5%BC%8F/CAP%E5%8E%9F%E7%90%86/","title":"CAP\u539f\u7406","text":""},{"location":"cloud-native/%E5%88%86%E5%B8%83%E5%BC%8F/CAP%E5%8E%9F%E7%90%86/#_1","title":"CAP\u539f\u7406","text":""},{"location":"cloud-native/%E5%88%86%E5%B8%83%E5%BC%8F/CAP%E5%8E%9F%E7%90%86/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://juejin.cn/post/6844903621490901006</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubeeye%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","title":"KubeEye\u6e90\u7801\u5206\u6790","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubeeye%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>\u200b https://github.com/kubesphere/kubeeye/ </li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/","title":"K8s \u5b89\u5168\u4e4bKube-bench","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#_1","title":"\u4e00 \u7b80\u4ecb","text":"<p>Kube-Bench \u662f\u4e00\u6b3e\u9488\u5bf9 Kubernete \u7684\u5b89\u5168\u68c0\u6d4b\u5de5\u5177\uff0c\u4ece\u672c\u8d28\u4e0a\u6765\u8bf4\uff0cKube-Bench \u662f\u4e00\u4e2a\u57fa\u4e8e Go \u5f00\u53d1\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u7814\u7a76\u4eba\u5458\u5bf9\u90e8\u7f72\u7684 Kubernete \u8fdb\u884c\u5b89\u5168\u68c0\u6d4b\uff0c\u5b89\u5168\u68c0\u6d4b\u539f\u5219\u9075\u5faaCIS Kubernetes Benchmark\u3002</p> <p>\u6d4b\u8bd5\u89c4\u5219\u9700\u8981\u901a\u8fc7 YAML \u6587\u4ef6\u8fdb\u884c\u914d\u7f6e\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u66f4\u65b0\u8be5\u5de5\u5177\u7684\u6d4b\u8bd5\u89c4\u5219\u3002</p> <p>https://github.com/aquasecurity/kube-bench#download-and-install-binaries</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#_2","title":"\u4e8c \u4f7f\u7528","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#21","title":"2.1 \u5b89\u88c5\u90e8\u7f72","text":"<ul> <li>\u76f4\u63a5\u4e8c\u8fdb\u5236\u5b89\u88c5</li> </ul> <pre><code>[root@master software]# wget https://github.com/aquasecurity/kube-bench/releases/download/v0.4.0/kube-bench_0.4.0_linux_amd64.tar.gz\n[root@master software]# tar -zxvf kube-bench_0.4.0_linux_amd64.tar.gz\n[root@master software]# mv kube-bench /usr/bin/\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#22","title":"2.2 \u5b89\u5168\u68c0\u6d4b","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#211-master","title":"2.1.1 \u68c0\u6d4bmaster\u7ec4\u4ef6","text":"<pre><code>[root@master software]# ./kube-bench --config-dir `pwd`/cfg --config `pwd`/cfg/config.yaml master\n[INFO] 1 Master Node Security Configuration\n[INFO] 1.1 Master Node Configuration Files\n[PASS] 1.1.1 Ensure that the API server pod specification file permissions are set to 644 or more restrictive (Automated)\n[PASS] 1.1.2 Ensure that the API server pod specification file ownership is set to root:root (Automated)\n[PASS] 1.1.3 Ensure that the controller manager pod specification file permissions are set to 644 or more restrictive (Automated)\n[PASS] 1.1.4 Ensure that the controller manager pod specification file ownership is set to root:root (Automated)\n[PASS] 1.1.5 Ensure that the scheduler pod specification file permissions are set to 644 or more restrictive (Automated)\n[PASS] 1.1.6 Ensure that the scheduler pod specification file ownership is set to root:root (Automated)\n[FAIL] 1.1.7 Ensure that the etcd pod specification file permissions are set to 644 or more restrictive (Automated)\n[FAIL] 1.1.8 Ensure that the etcd pod specification file ownership is set to root:root (Automated)\n[WARN] 1.1.9 Ensure that the Container Network Interface file permissions are set to 644 or more restrictive (Manual)\n[WARN] 1.1.10 Ensure that the Container Network Interface file ownership is set to root:root (Manual)\n[FAIL] 1.1.11 Ensure that the etcd data directory permissions are set to 700 or more restrictive (Automated)\n[FAIL] 1.1.12 Ensure that the etcd data directory ownership is set to etcd:etcd (Automated)\n[PASS] 1.1.13 Ensure that the admin.conf file permissions are set to 644 or more restrictive (Automated)\n[PASS] 1.1.14 Ensure that the admin.conf file ownership is set to root:root (Automated)\n[PASS] 1.1.15 Ensure that the scheduler.conf file permissions are set to 644 or more restrictive (Automated)\n[PASS] 1.1.16 Ensure that the scheduler.conf file ownership is set to root:root (Automated)\n[PASS] 1.1.17 Ensure that the controller-manager.conf file permissions are set to 644 or more restrictive (Automated)\n[PASS] 1.1.18 Ensure that the controller-manager.conf file ownership is set to root:root (Automated)\n[FAIL] 1.1.19 Ensure that the Kubernetes PKI directory and file ownership is set to root:root (Automated)\n[WARN] 1.1.20 Ensure that the Kubernetes PKI certificate file permissions are set to 644 or more restrictive (Manual)\n[WARN] 1.1.21 Ensure that the Kubernetes PKI key file permissions are set to 600 (Manual)\n[INFO] 1.2 API Server\n[WARN] 1.2.1 Ensure that the --anonymous-auth argument is set to false (Manual)\n[PASS] 1.2.2 Ensure that the --basic-auth-file argument is not set (Automated)\n[PASS] 1.2.3 Ensure that the --token-auth-file parameter is not set (Automated)\n[PASS] 1.2.4 Ensure that the --kubelet-https argument is set to true (Automated)\n[PASS] 1.2.5 Ensure that the --kubelet-client-certificate and --kubelet-client-key arguments are set as appropriate (Automated)\n[FAIL] 1.2.6 Ensure that the --kubelet-certificate-authority argument is set as appropriate (Automated)\n[PASS] 1.2.7 Ensure that the --authorization-mode argument is not set to AlwaysAllow (Automated)\n[PASS] 1.2.8 Ensure that the --authorization-mode argument includes Node (Automated)\n[PASS] 1.2.9 Ensure that the --authorization-mode argument includes RBAC (Automated)\n[WARN] 1.2.10 Ensure that the admission control plugin EventRateLimit is set (Manual)\n[PASS] 1.2.11 Ensure that the admission control plugin AlwaysAdmit is not set (Automated)\n[WARN] 1.2.12 Ensure that the admission control plugin AlwaysPullImages is set (Manual)\n[WARN] 1.2.13 Ensure that the admission control plugin SecurityContextDeny is set if PodSecurityPolicy is not used (Manual)\n[PASS] 1.2.14 Ensure that the admission control plugin ServiceAccount is set (Automated)\n[PASS] 1.2.15 Ensure that the admission control plugin NamespaceLifecycle is set (Automated)\n[FAIL] 1.2.16 Ensure that the admission control plugin PodSecurityPolicy is set (Automated)\n[PASS] 1.2.17 Ensure that the admission control plugin NodeRestriction is set (Automated)\n[PASS] 1.2.18 Ensure that the --insecure-bind-address argument is not set (Automated)\n[PASS] 1.2.19 Ensure that the --insecure-port argument is set to 0 (Automated)\n[PASS] 1.2.20 Ensure that the --secure-port argument is not set to 0 (Automated)\n[PASS] 1.2.21 Ensure that the --profiling argument is set to false (Automated)\n[FAIL] 1.2.22 Ensure that the --audit-log-path argument is set (Automated)\n[FAIL] 1.2.23 Ensure that the --audit-log-maxage argument is set to 30 or as appropriate (Automated)\n[FAIL] 1.2.24 Ensure that the --audit-log-maxbackup argument is set to 10 or as appropriate (Automated)\n[FAIL] 1.2.25 Ensure that the --audit-log-maxsize argument is set to 100 or as appropriate (Automated)\n[PASS] 1.2.26 Ensure that the --request-timeout argument is set as appropriate (Automated)\n[PASS] 1.2.27 Ensure that the --service-account-lookup argument is set to true (Automated)\n[PASS] 1.2.28 Ensure that the --service-account-key-file argument is set as appropriate (Automated)\n[PASS] 1.2.29 Ensure that the --etcd-certfile and --etcd-keyfile arguments are set as appropriate (Automated)\n[PASS] 1.2.30 Ensure that the --tls-cert-file and --tls-private-key-file arguments are set as appropriate (Automated)\n[PASS] 1.2.31 Ensure that the --client-ca-file argument is set as appropriate (Automated)\n[PASS] 1.2.32 Ensure that the --etcd-cafile argument is set as appropriate (Automated)\n[WARN] 1.2.33 Ensure that the --encryption-provider-config argument is set as appropriate (Manual)\n[WARN] 1.2.34 Ensure that encryption providers are appropriately configured (Manual)\n[WARN] 1.2.35 Ensure that the API Server only makes use of Strong Cryptographic Ciphers (Manual)\n[INFO] 1.3 Controller Manager\n[PASS] 1.3.1 Ensure that the --terminated-pod-gc-threshold argument is set as appropriate (Manual)\n[PASS] 1.3.2 Ensure that the --profiling argument is set to false (Automated)\n[PASS] 1.3.3 Ensure that the --use-service-account-credentials argument is set to true (Automated)\n[PASS] 1.3.4 Ensure that the --service-account-private-key-file argument is set as appropriate (Automated)\n[PASS] 1.3.5 Ensure that the --root-ca-file argument is set as appropriate (Automated)\n[FAIL] 1.3.6 Ensure that the RotateKubeletServerCertificate argument is set to true (Automated)\n[FAIL] 1.3.7 Ensure that the --bind-address argument is set to 127.0.0.1 (Automated)\n[INFO] 1.4 Scheduler\n[FAIL] 1.4.1 Ensure that the --profiling argument is set to false (Automated)\n[FAIL] 1.4.2 Ensure that the --bind-address argument is set to 127.0.0.1 (Automated)\n\n== Remediations ==\n1.1.7 Run the below command (based on the file location on your system) on the master node.\nFor example,\nchmod 644 /etc/kubernetes/manifests/etcd.yaml\n\n1.1.8 Run the below command (based on the file location on your system) on the master node.\nFor example,\nchown root:root /etc/kubernetes/manifests/etcd.yaml\n\n1.1.9 Run the below command (based on the file location on your system) on the master node.\nFor example,\nchmod 644 &lt;path/to/cni/files&gt;\n\n1.1.10 Run the below command (based on the file location on your system) on the master node.\nFor example,\nchown root:root &lt;path/to/cni/files&gt;\n\n1.1.11 On the etcd server node, get the etcd data directory, passed as an argument --data-dir,\nfrom the below command:\nps -ef | grep etcd\nRun the below command (based on the etcd data directory found above). For example,\nchmod 700 /var/lib/etcd\n\n1.1.12 On the etcd server node, get the etcd data directory, passed as an argument --data-dir,\nfrom the below command:\nps -ef | grep etcd\nRun the below command (based on the etcd data directory found above).\nFor example, chown etcd:etcd /var/lib/etcd\n\n1.1.19 Run the below command (based on the file location on your system) on the master node.\nFor example,\nchown -R root:root /etc/kubernetes/pki/\n\n1.1.20 audit test did not run: failed to run: \"find /etc/kubernetes/pki -name '*.crt' | xargs stat -c permissions=%a\", output: \"stat: missing operand\\nTry 'stat --help' for more information.\\n\", error: exit status 123\n1.1.21 audit test did not run: failed to run: \"find /etc/kubernetes/pki -name '*.key' | xargs stat -c permissions=%a\", output: \"stat: missing operand\\nTry 'stat --help' for more information.\\n\", error: exit status 123\n1.2.1 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the below parameter.\n--anonymous-auth=false\n\n1.2.6 Follow the Kubernetes documentation and setup the TLS connection between\nthe apiserver and kubelets. Then, edit the API server pod specification file\n/etc/kubernetes/manifests/kube-apiserver.yaml on the master node and set the\n--kubelet-certificate-authority parameter to the path to the cert file for the certificate authority.\n--kubelet-certificate-authority=&lt;ca-string&gt;\n\n1.2.10 Follow the Kubernetes documentation and set the desired limits in a configuration file.\nThen, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\nand set the below parameters.\n--enable-admission-plugins=...,EventRateLimit,...\n--admission-control-config-file=&lt;path/to/configuration/file&gt;\n\n1.2.12 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the --enable-admission-plugins parameter to include\nAlwaysPullImages.\n--enable-admission-plugins=...,AlwaysPullImages,...\n\n1.2.13 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the --enable-admission-plugins parameter to include\nSecurityContextDeny, unless PodSecurityPolicy is already in place.\n--enable-admission-plugins=...,SecurityContextDeny,...\n\n1.2.16 Follow the documentation and create Pod Security Policy objects as per your environment.\nThen, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the --enable-admission-plugins parameter to a\nvalue that includes PodSecurityPolicy:\n--enable-admission-plugins=...,PodSecurityPolicy,...\nThen restart the API Server.\n\n1.2.22 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the --audit-log-path parameter to a suitable path and\nfile where you would like audit logs to be written, for example:\n--audit-log-path=/var/log/apiserver/audit.log\n\n1.2.23 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the --audit-log-maxage parameter to 30 or as an appropriate number of days:\n--audit-log-maxage=30\n\n1.2.24 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the --audit-log-maxbackup parameter to 10 or to an appropriate\nvalue.\n--audit-log-maxbackup=10\n\n1.2.25 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the --audit-log-maxsize parameter to an appropriate size in MB.\nFor example, to set it as 100 MB:\n--audit-log-maxsize=100\n\n1.2.33 Follow the Kubernetes documentation and configure a EncryptionConfig file.\nThen, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the --encryption-provider-config parameter to the path of that file: --encryption-provider-config=&lt;/path/to/EncryptionConfig/File&gt;\n\n1.2.34 Follow the Kubernetes documentation and configure a EncryptionConfig file.\nIn this file, choose aescbc, kms or secretbox as the encryption provider.\n\n1.2.35 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml\non the master node and set the below parameter.\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM\n_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM\n_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM\n_SHA384\n\n1.3.6 Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml\non the master node and set the --feature-gates parameter to include RotateKubeletServerCertificate=true.\n--feature-gates=RotateKubeletServerCertificate=true\n\n1.3.7 Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml\non the master node and ensure the correct value for the --bind-address parameter\n\n1.4.1 Edit the Scheduler pod specification file /etc/kubernetes/manifests/kube-scheduler.yaml file\non the master node and set the below parameter.\n--profiling=false\n\n1.4.2 Edit the Scheduler pod specification file /etc/kubernetes/manifests/kube-scheduler.yaml\non the master node and ensure the correct value for the --bind-address parameter\n\n\n== Summary ==\n39 checks PASS\n15 checks FAIL\n11 checks WARN\n0 checks INFO\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#212-node","title":"2.1.2 \u68c0\u6d4bnode\u7ec4\u4ef6","text":"<pre><code>[root@master software]# kube-bench --config-dir /data/software/kube-bench/cfg --config /data/software/kube-bench/cfg/config.yaml node\n[INFO] 4 Worker Node Security Configuration\n[INFO] 4.1 Worker Node Configuration Files\n[PASS] 4.1.1 Ensure that the kubelet service file permissions are set to 644 or more restrictive (Automated)\n[PASS] 4.1.2 Ensure that the kubelet service file ownership is set to root:root (Automated)\n[WARN] 4.1.3 If proxy kubeconfig file exists ensure permissions are set to 644 or more restrictive (Manual)\n[WARN] 4.1.4 Ensure that the proxy kubeconfig file ownership is set to root:root (Manual)\n[PASS] 4.1.5 Ensure that the --kubeconfig kubelet.conf file permissions are set to 644 or more restrictive (Automated)\n[PASS] 4.1.6 Ensure that the --kubeconfig kubelet.conf file ownership is set to root:root (Manual)\n[PASS] 4.1.7 Ensure that the certificate authorities file permissions are set to 644 or more restrictive (Manual)\n[PASS] 4.1.8 Ensure that the client certificate authorities file ownership is set to root:root (Manual)\n[PASS] 4.1.9 Ensure that the kubelet --config configuration file has permissions set to 644 or more restrictive (Automated)\n[PASS] 4.1.10 Ensure that the kubelet --config configuration file ownership is set to root:root (Automated)\n[INFO] 4.2 Kubelet\n[PASS] 4.2.1 Ensure that the anonymous-auth argument is set to false (Automated)\n[PASS] 4.2.2 Ensure that the --authorization-mode argument is not set to AlwaysAllow (Automated)\n[PASS] 4.2.3 Ensure that the --client-ca-file argument is set as appropriate (Automated)\n[PASS] 4.2.4 Ensure that the --read-only-port argument is set to 0 (Manual)\n[PASS] 4.2.5 Ensure that the --streaming-connection-idle-timeout argument is not set to 0 (Manual)\n[FAIL] 4.2.6 Ensure that the --protect-kernel-defaults argument is set to true (Automated)\n[PASS] 4.2.7 Ensure that the --make-iptables-util-chains argument is set to true (Automated)\n[WARN] 4.2.8 Ensure that the --hostname-override argument is not set (Manual)\n[WARN] 4.2.9 Ensure that the --event-qps argument is set to 0 or a level which ensures appropriate event capture (Manual)\n[WARN] 4.2.10 Ensure that the --tls-cert-file and --tls-private-key-file arguments are set as appropriate (Manual)\n[PASS] 4.2.11 Ensure that the --rotate-certificates argument is not set to false (Manual)\n[WARN] 4.2.12 Verify that the RotateKubeletServerCertificate argument is set to true (Manual)\n[WARN] 4.2.13 Ensure that the Kubelet only makes use of Strong Cryptographic Ciphers (Manual)\n\n== Remediations ==\n4.1.3 Run the below command (based on the file location on your system) on the each worker node.\nFor example,\nchmod 644 /etc/kubernetes/proxy.conf\n\n4.1.4 Run the below command (based on the file location on your system) on the each worker node.\nFor example, chown root:root /etc/kubernetes/proxy.conf\n\n4.2.6 If using a Kubelet config file, edit the file to set protectKernelDefaults: true.\nIf using command line arguments, edit the kubelet service file\n/etc/systemd/system/kubelet.service on each worker node and\nset the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.\n--protect-kernel-defaults=true\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n\n4.2.8 Edit the kubelet service file /etc/systemd/system/kubelet.service\non each worker node and remove the --hostname-override argument from the\nKUBELET_SYSTEM_PODS_ARGS variable.\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n\n4.2.9 If using a Kubelet config file, edit the file to set eventRecordQPS: to an appropriate level.\nIf using command line arguments, edit the kubelet service file\n/etc/systemd/system/kubelet.service on each worker node and\nset the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n\n4.2.10 If using a Kubelet config file, edit the file to set tlsCertFile to the location\nof the certificate file to use to identify this Kubelet, and tlsPrivateKeyFile\nto the location of the corresponding private key file.\nIf using command line arguments, edit the kubelet service file\n/etc/systemd/system/kubelet.service on each worker node and\nset the below parameters in KUBELET_CERTIFICATE_ARGS variable.\n--tls-cert-file=&lt;path/to/tls-certificate-file&gt;\n--tls-private-key-file=&lt;path/to/tls-key-file&gt;\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n\n4.2.12 Edit the kubelet service file /etc/systemd/system/kubelet.service\non each worker node and set the below parameter in KUBELET_CERTIFICATE_ARGS variable.\n--feature-gates=RotateKubeletServerCertificate=true\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n\n4.2.13 If using a Kubelet config file, edit the file to set TLSCipherSuites: to\nTLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\nor to a subset of these values.\nIf using executable arguments, edit the kubelet service file\n/etc/systemd/system/kubelet.service on each worker node and\nset the --tls-cipher-suites parameter as follows, or to a subset of these values.\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n\n\n== Summary ==\n15 checks PASS\n1 checks FAIL\n7 checks WARN\n0 checks INFO\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#_3","title":"\u4e09 \u652f\u6301\u7248\u672c","text":"<p>Kube-Bench \u652f\u6301\u7684 Kubernete \u6d4b\u8bd5\u89c4\u5219\u5b9a\u4e49\u5728 CIS Kubernetes Benchmark \u4e4b\u4e2d\uff1a</p> CIS Kubernetes Benchmark kube-bench****\u914d\u7f6e Kubernetes****\u7248\u672c 1.3.0 cis-1.3 1.11-1.12 1.4.1 cis-1.4 1.13-1.14 1.5.0 cis-1.5 1.15- GKE 1.0.0 gke-1.0 GKE EKS 1.0.0 eks-1.0 EKS Red Hat OpenShift hardening guide rh-0.7 OCP 3.10-3.11"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#_4","title":"\u56db \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>Kube-Bench \u5c3d\u53ef\u80fd\u5730\u5b9e\u73b0\u4e86CIS Kubernetes Benchmark\uff0c\u5982\u679c kube bench \u6ca1\u6709\u6b63\u786e\u6267\u884c\u5b89\u5168\u57fa\u51c6\u6d4b\u8bd5\u3002</li> <li>Kubernete \u7248\u672c\u548c CIS \u57fa\u51c6\u6d4b\u8bd5\u7248\u672c\u4e4b\u95f4\u6ca1\u6709\u4e00\u5bf9\u4e00\u7684\u6620\u5c04\u3002\uff0c\u4ee5\u67e5\u770b\u57fa\u51c6\u6d4b\u8bd5\u7684\u4e0d\u540c\u7248\u672c\u5305\u542b\u54ea\u4e9b Kubernetes \u7248\u672c\u3002</li> <li>Kube-Bench \u65e0\u6cd5\u68c0\u67e5\u53d7\u7ba1\u96c6\u7fa4\u7684\u4e3b\u8282\u70b9\uff0c\u4f8b\u5982 GKE\u3001EKS \u548c AKS\uff0c\u56e0\u4e3a Kube-Bench \u4e0d\u80fd\u8bbf\u95ee\u8fd9\u4e9b\u8282\u70b9\u3002\u4e0d\u8fc7\uff0cKube-Bench \u5728\u8fd9\u4e9b\u73af\u5883\u4e2d\u4ecd\u7136\u53ef\u4ee5\u68c0\u67e5 worker \u8282\u70b9\u914d\u7f6e\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#_5","title":"\u4e94 \u53cd\u601d","text":"<p>\u4f7f\u7528 kube-bench \u53ef\u4ee5\u5feb\u901f\u7684\u68c0\u6d4b k8s \u4e2d\u5b58\u5728\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u9488\u5bf9\u4fee\u590d\u610f\u89c1\u8fdb\u884c\u4fee\u590d\uff0c\u914d\u5408\u81ea\u5b9a\u4e49\u5b9a\u65f6\u4efb\u52a1\uff0c\u53ef\u4ee5\u81ea\u5df1\u6839\u636e\u6570\u636e\u751f\u6210\u62a5\u8868\uff0c\u90ae\u4ef6\u6216\u5176\u4ed6\u901a\u4fe1\u8f6f\u4ef6\u901a\u77e5\uff0c\u53ca\u65f6\u83b7\u53d6\u96c6\u7fa4\u5b89\u5168\u72b6\u6001\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li> <p>https://www.cisecurity.org/benchmark/kubernetes/</p> </li> <li> <p>https://www.cisecurity.org/cybersecurity-tools/</p> </li> <li>https://github.com/aquasecurity/kube-bench</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/","title":"Kubernetes\u5b89\u5168\u4e4bKubeEye","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>KubeEye \u662f\u4e00\u6b3e Kubernetes \u5b89\u5168\u53ca\u914d\u7f6e\u95ee\u9898\u68c0\u6d4b\u5de5\u5177\uff0c\u9488\u5bf9\u90e8\u7f72\u5728 K8s \u96c6\u7fa4\u4e2d\u7684\u4e1a\u52a1\u5e94\u7528\u8fdb\u884c\u914d\u7f6e\u68c0\u6d4b\u4f7f\u7528 OPA,\u9488\u5bf9\u96c6\u7fa4\u90e8\u7f72\u7684 Node \u4f7f\u7528Node-Problem-Detector\u8fdb\u884c\u68c0\u6d4b\uff0c\u540c\u65f6\u9664\u4e86\u7cfb\u7edf\u5185\u7f6e\u6709\u6839\u636e\u5927\u591a\u6570\u4e1a\u754c\u5e38\u89c1\u573a\u666f\u7684\u9884\u5b9a\u4e49\u89c4\u5219\uff0c\u8fd8\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49\u89c4\u5219\u6765\u8fdb\u884c\u96c6\u7fa4\u68c0\u6d4b\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#_2","title":"\u4e8c \u67b6\u6784","text":"<p>KubeEye \u901a\u8fc7\u8c03\u7528 Kubernetes API\uff0c\u901a\u8fc7\u5339\u914d\u8d44\u6e90\u4e2d\u7684\u5173\u952e\u5b57\u548c\u5bb9\u5668\u8bed\u6cd5\u7684\u89c4\u5219\u5339\u914d\u6765\u83b7\u53d6\u96c6\u7fa4\u8bca\u65ad\u6570\u636e\uff0c\u8be6\u89c1\u67b6\u6784\u56fe\u3002</p> <p>\u5176\u4e2d\u9488\u5bf9 Node \u8282\u70b9\u68c0\u6d4b\uff0c\u9700\u8981\u5728\u88ab\u68c0\u6d4b Node \u4e3b\u673a\u4e0a\u5b89\u88c5</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#_3","title":"\u4e09 \u7279\u70b9","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#31","title":"3.1 \u7279\u6027","text":"<ul> <li>KubeEye \u6839\u636e\u884c\u4e1a\u6700\u4f73\u5b9e\u8df5\u5ba1\u67e5\u4f60\u7684\u5de5\u4f5c\u8d1f\u8f7d yaml \u89c4\u8303\uff0c\u5e2e\u52a9\u4f60\u4f7f\u4f60\u7684\u96c6\u7fa4\u7a33\u5b9a\u3002</li> <li>KubeEye \u53ef\u4ee5\u53d1\u73b0\u4f60\u7684\u96c6\u7fa4\u63a7\u5236\u5e73\u9762\u7684\u95ee\u9898\uff0c\u5305\u62ec kube-apiserver/kube-controller-manager/etcd \u7b49\u3002</li> <li>KubeEye \u53ef\u4ee5\u5e2e\u52a9\u4f60\u68c0\u6d4b\u5404\u79cd\u8282\u70b9\u95ee\u9898\uff0c\u5305\u62ec\u5185\u5b58/CPU/\u78c1\u76d8\u538b\u529b\uff0c\u610f\u5916\u7684\u5185\u6838\u9519\u8bef\u65e5\u5fd7\u7b49\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#32","title":"3.2 \u68c0\u67e5\u9879","text":"\u662f/\u5426 \u68c0\u67e5\u9879 \u63cf\u8ff0 \u7ea7\u522b \u2705 PrivilegeEscalationAllowed \u5141\u8bb8\u7279\u6743\u5347\u7ea7 \u7d27\u6025 \u2705 CanImpersonateUser role/clusterrole \u6709\u4f2a\u88c5\u6210\u5176\u4ed6\u7528\u6237\u6743\u9650 \u8b66\u544a \u2705 CanDeleteResources role/clusterrole \u6709\u5220\u9664 kubernetes \u8d44\u6e90\u6743\u9650 \u8b66\u544a \u2705 CanModifyWorkloads role/clusterrole \u6709\u4fee\u6539 kubernetes \u8d44\u6e90\u6743\u9650 \u8b66\u544a \u2705 NoCPULimits \u8d44\u6e90\u6ca1\u6709\u8bbe\u7f6e CPU \u4f7f\u7528\u9650\u5236 \u7d27\u6025 \u2705 NoCPURequests \u8d44\u6e90\u6ca1\u6709\u8bbe\u7f6e\u9884\u7559 CPU \u7d27\u6025 \u2705 HighRiskCapabilities \u5f00\u542f\u4e86\u9ad8\u5371\u529f\u80fd\uff0c\u4f8b\u5982 ALL/SYS_ADMIN/NET_ADMIN \u7d27\u6025 \u2705 HostIPCAllowed \u5f00\u542f\u4e86\u4e3b\u673a IPC \u7d27\u6025 \u2705 HostNetworkAllowed \u5f00\u542f\u4e86\u4e3b\u673a\u7f51\u7edc \u7d27\u6025 \u2705 HostPIDAllowed \u5f00\u542f\u4e86\u4e3b\u673aPID \u7d27\u6025 \u2705 HostPortAllowed \u5f00\u542f\u4e86\u4e3b\u673a\u7aef\u53e3 \u7d27\u6025 \u2705 ImagePullPolicyNotAlways \u955c\u50cf\u62c9\u53d6\u7b56\u7565\u4e0d\u662f always \u8b66\u544a \u2705 ImageTagIsLatest \u955c\u50cf\u6807\u7b7e\u662f latest \u8b66\u544a \u2705 ImageTagMiss \u955c\u50cf\u6ca1\u6709\u6807\u7b7e \u7d27\u6025 \u2705 InsecureCapabilities \u5f00\u542f\u4e86\u4e0d\u5b89\u5168\u7684\u529f\u80fd\uff0c\u4f8b\u5982 KILL/SYS_CHROOT/CHOWN \u8b66\u544a \u2705 NoLivenessProbe \u6ca1\u6709\u8bbe\u7f6e\u5b58\u6d3b\u72b6\u6001\u68c0\u67e5 \u8b66\u544a \u2705 NoMemoryLimits \u8d44\u6e90\u6ca1\u6709\u8bbe\u7f6e\u5185\u5b58\u4f7f\u7528\u9650\u5236 \u7d27\u6025 \u2705 NoMemoryRequests \u8d44\u6e90\u6ca1\u6709\u8bbe\u7f6e\u9884\u7559\u5185\u5b58 \u7d27\u6025 \u2705 NoPriorityClassName \u6ca1\u6709\u8bbe\u7f6e\u8d44\u6e90\u8c03\u5ea6\u4f18\u5148\u7ea7 \u901a\u77e5 \u2705 PrivilegedAllowed \u4ee5\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\u8d44\u6e90 \u7d27\u6025 \u2705 NoReadinessProbe \u6ca1\u6709\u8bbe\u7f6e\u5c31\u7eea\u72b6\u6001\u68c0\u67e5 \u8b66\u544a \u2705 NotReadOnlyRootFilesystem \u6ca1\u6709\u8bbe\u7f6e\u6839\u6587\u4ef6\u7cfb\u7edf\u4e3a\u53ea\u8bfb \u8b66\u544a \u2705 NotRunAsNonRoot \u6ca1\u6709\u8bbe\u7f6e\u7981\u6b62\u4ee5 root \u7528\u6237\u542f\u52a8\u8fdb\u7a0b \u8b66\u544a \u2705 CertificateExpiredPeriod \u5c06\u68c0\u67e5 ApiServer \u8bc1\u4e66\u7684\u5230\u671f\u65e5\u671f\u5c11\u4e8e30\u5929 \u7d27\u6025 \u2705 EventAudit \u4e8b\u4ef6\u68c0\u67e5 \u8b66\u544a \u2705 NodeStatus \u8282\u70b9\u72b6\u6001\u68c0\u67e5 \u8b66\u544a \u2705 DockerStatus docker \u72b6\u6001\u68c0\u67e5 \u8b66\u544a \u2705 KubeletStatus kubelet \u72b6\u6001\u68c0\u67e5 \u8b66\u544a"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#_4","title":"\u56db \u90e8\u7f72","text":"<p>kubeEye \u672c\u8eab\u4f7f\u7528 Golang \u7f16\u5199\uff0c\u53ef\u4f7f\u7528\u7f16\u8bd1\u597d\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u8fdb\u884c\u76f8\u5173\u7ec4\u4ef6\u5b89\u88c5\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#41","title":"4.1 \u5b89\u88c5","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#411","title":"4.1.1 \u4e8c\u8fdb\u5236\u5b89\u88c5","text":"<pre><code>wget https://github.com/kubesphere/kubeeye/releases/download/v0.3.0/kubeeye-0.3.0-linux-amd64.tar.gz\ntar -zxvf kubeeye-0.3.0-linux-amd64.tar.gz\nmv kubeeye /usr/bin/\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#412","title":"4.1.2 \u6e90\u7801\u7f16\u8bd1\u5b89\u88c5","text":"<pre><code>git clone https://github.com/kubesphere/kubeeye.git\ncd kubeeye \nmake installke\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#42-npd","title":"4.2 \u5b89\u88c5NPD","text":"<p>\u9488\u5bf9\u96c6\u7fa4 Node \u4e3b\u673a\u7684\u68c0\u6d4b\uff0ckubeEye \u91c7\u7528Node-problem-Detector \uff0c\u9700\u8981\u5728 Node \u4e3b\u673a\u8282\u70b9\u8fdb\u884c\u5b89\u88c5\uff0ckubeeye \u5c01\u88c5\u5b89\u88c5\u547d\u4ee4\uff0c\u53ef\u4ee5\u8fdb\u884c\u4e00\u952e\u5b89\u88c5\u3002</p> <p>\u26a0\ufe0f\u6ce8\u610f\uff1a\u8fd9\u5c06\u5728\u4f60\u7684\u96c6\u7fa4\u4e0a\u5b89\u88c5 npd\uff0c\u53ea\u6709\u5f53\u4f60\u60f3\u8981\u8be6\u7ec6\u7684\u8282\u70b9\u62a5\u544a\u65f6\u624d\u9700\u8981\u3002</p> <pre><code>[root@VM-48-7-centos ~]# kubeeye install -e npd\nkube-system      ConfigMap   node-problem-detector-config    created\nkube-system      DaemonSet   node-problem-detector   created\n</code></pre> <p>\u5176\u4e3b\u8981\u5728 kube-system \u540d\u79f0\u7a7a\u95f4\u521b\u5efa node-problem-detector-config \u7684 ConfigMap \u548c node-problem-detector DaemonSet\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#43-kubeeye","title":"4.3 \u96c6\u7fa4\u4e2d\u8fd0\u884ckubeEye","text":"<p>kubeEye \u9664\u4e86\u53ef\u4ee5\u4e00\u6b21\u6027\u4f7f\u7528\u5de5\u5177\u8fd0\u884c\uff0c\u540c\u65f6 kubeEye \u4e5f\u662f\u4e00\u4e2a Operator\uff0c\u53ef\u4ee5\u8fd0\u884c\u5728\u96c6\u7fa4\u5185\u90e8\uff0c\u8fdb\u884c\u957f\u4e45\u7684\u6301\u7eed\u5bf9\u96c6\u7fa4\u8fdb\u884c\u68c0\u6d4b\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#431-kubernetes-kubeeye","title":"4.3.1 Kubernetes \u4e2d\u90e8\u7f72 Kubeeye","text":"<pre><code>kubectl apply -f https://raw.githubusercontent.com/kubesphere/kubeeye/main/deploy/kubeeye.yaml\nkubectl apply -f https://raw.githubusercontent.com/kubesphere/kubeeye/main/deploy/kubeeye_insights.yaml\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#432-kubeeye","title":"4.3.2 \u67e5\u770b Kubeeye \u5de1\u68c0\u7ed3\u679c","text":"<pre><code>$ kubectl get clusterinsight -o yaml\n\napiVersion: v1\nitems:\n- apiVersion: kubeeye.kubesphere.io/v1alpha1\n  kind: ClusterInsight\n  metadata:\n    name: clusterinsight-sample\n    namespace: default\n  spec:\n    auditPeriod: 24h\n  status:\n    auditResults:\n      auditResults:\n      - resourcesType: Node\n        resultInfos:\n        - namespace: \"\"\n          resourceInfos:\n          - items:\n            - level: waring\n              message: KubeletHasNoSufficientMemory\n              reason: kubelet has no sufficient memory available\n            - level: waring\n              message: KubeletHasNoSufficientPID\n              reason: kubelet has no sufficient PID available\n            - level: waring\n              message: KubeletHasDiskPressure\n              reason: kubelet has disk pressure\n            name: kubeeyeNode\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#_5","title":"\u4e94 \u6d4b\u8bd5","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#51","title":"5.1 \u547d\u4ee4\u9009\u9879","text":"<pre><code>[root@VM-48-7-centos ~]# kubeeye -h\nKubeEye finds various problems on Kubernetes cluster.\n\nUsage:\n  ke [command]\n\nAvailable Commands:\n  audit       audit resources from the cluster\n  completion  generate the autocompletion script for the specified shell\n  help        Help about any command\n  install     A brief description of your command\n  uninstall   A brief description of your command\n\nFlags:\n  -f, --config string         Specify the path of kubeconfig.\n  -h, --help                  help for ke\n      --kubeconfig string     Paths to a kubeconfig. Only required if out-of-cluster.\n      --master --kubeconfig   (Deprecated: switch to --kubeconfig) The address of the Kubernetes API server. Overrides any value in kubeconfig. Only required if out-of-cluster.\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 kubeeye \u76ee\u524d\u4e3b\u8981\u652f\u6301\u4e24\u4e2a\u547d\u4ee4\uff0c\u4e00\u4e2a\u4e3a install package \u4f8b\u5982 NPD\uff0c\u53e6\u5916\u4e00\u4e2a\u6267\u884c audit\uff0c\u5bf9\u96c6\u7fa4\u5e94\u7528\u8fdb\u884c\u914d\u7f6e\u626b\u63cf\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#52-audit","title":"5.2 audit","text":"<pre><code>[root@VM-48-7-centos ~]# kubeeye audit\nKIND         NAMESPACE         NAME                                           MESSAGE\nDeployment   dddd              jenkins-1644220286                             [NoCPULimits ImagePullPolicyNotAlways NoMemoryLimits NoPriorityClassName NotReadOnlyRootFilesystem NotRunAsNonRoot]\nDeployment   jenkins           jenkins-1644220286                             [NoCPULimits ImagePullPolicyNotAlways NoMemoryLimits NoPriorityClassName NotReadOnlyRootFilesystem NotRunAsNonRoot]\nDeployment   smartkm-api-k8s   velero                                         [ImageTagIsLatest NoLivenessProbe NoPriorityClassName NotReadOnlyRootFilesystem NoReadinessProbe NotRunAsNonRoot]\nDaemonSet    smartkm-api-k8s   restic                                         [ImageTagIsLatest NoLivenessProbe NoPriorityClassName NotReadOnlyRootFilesystem NoReadinessProbe NotRunAsNonRoot]\nNode                           minikube                                       [KernelHasNoDeadlock FilesystemIsNotReadOnly KubeletHasSufficientMemory KubeletHasNoDiskPressure KubeletHasSufficientPID]\nEvent        kube-system       node-problem-detector-dmsws.16d844532f662318   [Failed to pull image \"k8s.gcr.io/node-problem-detector/node-problem-detector:v0.8.7\": rpc error: code = Unknown desc = Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)]\nEvent        kube-system       node-problem-detector-dmsws.16d844532f66703e   [Error: ErrImagePull]\nEvent        kube-system       node-problem-detector-dmsws.16d84453351b8b19   [Error: ImagePullBackOff] \n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#53","title":"5.3 \u6dfb\u52a0\u81ea\u5b9a\u4e49\u68c0\u67e5\u89c4\u5219","text":"<p>\u6211\u4eec\u5229\u7528\u547d\u4ee4\u67e5\u770b\u9884\u5b9a\u4e49 OPA \u68c0\u67e5\u89c4\u5219\u3002</p> <pre><code>kubectl get cm -n kube-system node-problem-detector-config -oyaml\n</code></pre> <p>\u540c\u65f6\u4e5f\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u4e1a\u52a1\u521b\u5efa\u81ea\u5b9a\u4e49\u68c0\u67e5\u89c4\u5219\u3002</p> <ul> <li>\u521b\u5efa OPA \u89c4\u5219\u5b58\u653e\u76ee\u5f55</li> </ul> <pre><code>mkdir opa\n</code></pre> <ul> <li>\u6dfb\u52a0\u81ea\u5b9a\u4e49 OPA \u89c4\u5219\u6587\u4ef6</li> </ul> <p>\u6ce8\u610f\uff1a\u4e3a\u68c0\u67e5\u5de5\u4f5c\u8d1f\u8f7d\u8bbe\u7f6e\u7684 OPA \u89c4\u5219\uff0c package \u540d\u79f0\u5fc5\u987b\u662f kubeeye_workloads_rego \u4e3a\u68c0\u67e5 RBAC \u8bbe\u7f6e\u7684 OPA \u89c4\u5219\uff0c package \u540d\u79f0\u5fc5\u987b\u662f kubeeye_RBAC_rego \u4e3a\u68c0\u67e5\u8282\u70b9\u8bbe\u7f6e\u7684 OPA \u89c4\u5219\uff0c package \u540d\u79f0\u5fc5\u987b\u662f kubeeye_nodes_rego</p> <ul> <li>\u4ee5\u4e0b\u4e3a\u68c0\u67e5\u955c\u50cf\u4ed3\u5e93\u5730\u5740\u89c4\u5219\uff0c\u4fdd\u5b58\u4ee5\u4e0b\u89c4\u5219\u5230\u89c4\u5219\u6587\u4ef6 imageRegistryRule.rego</li> </ul> <pre><code>package kubeeye_workloads_rego\n\ndeny[msg] {\n    resource := input\n    type := resource.Object.kind\n    resourcename := resource.Object.metadata.name\n    resourcenamespace := resource.Object.metadata.namespace\n    workloadsType := {\"Deployment\",\"ReplicaSet\",\"DaemonSet\",\"StatefulSet\",\"Job\"}\n    workloadsType[type]\n\n    not workloadsImageRegistryRule(resource)\n\n    msg := {\n        \"Name\": sprintf(\"%v\", [resourcename]),\n        \"Namespace\": sprintf(\"%v\", [resourcenamespace]),\n        \"Type\": sprintf(\"%v\", [type]),\n        \"Message\": \"ImageRegistryNotmyregistry\"\n    }\n}\n\nworkloadsImageRegistryRule(resource) {\n    regex.match(\"^myregistry.public.kubesphere/basic/.+\", resource.Object.spec.template.spec.containers[_].image)\n}\n</code></pre> <ul> <li>\u4f7f\u7528\u989d\u5916\u7684\u89c4\u5219\u8fd0\u884c kubeeye</li> </ul> <p>\u63d0\u793a\uff1akubeeye \u5c06\u8bfb\u53d6\u6307\u5b9a\u76ee\u5f55\u4e0b\u6240\u6709 .rego \u7ed3\u5c3e\u7684\u6587\u4ef6   </p> <pre><code>kubeeye audit -p ./opa\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#_6","title":"\u516d \u95ee\u9898\u6392\u67e5","text":"<ul> <li>NPD \u5b89\u88c5\u5f02\u5e38\uff0c\u9ed8\u8ba4\u4f7f\u7528 k8s.gcr.io\uff0c\u5982\u679c\u5b89\u88c5\u670d\u52a1\u5668\u65e0\u6cd5\u8fde\u901a\u516c\u7f51\u53ef\u4f7f\u7528\u6211\u7684\u955c\u50cf\u4ed3\u5e93\uff1a1832990/node-problem-detector:v0.8.7\u3002</li> <li>kubEye \u5b89\u88c5\u4f7f\u7528\u9ed8\u8ba4\u4f7f\u7528\u4e3b\u673a$HOME/.kube/config \u6587\u4ef6\uff0c\u5982\u679c\u4e0d\u5b58\u5728 K8s config \u6587\u4ef6\uff0c\u5219\u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/#_7","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/kubesphere/kubeeye/</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKyverno/","title":"K8s \u5b89\u5168\u4e4bKyverno","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKyverno/#_1","title":"\u4e00 \u7b80\u4ecb","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKyverno/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://mp.weixin.qq.com/s/x6kXFugt9nZasdHQSy74nQ</li> <li>https://github.com/kyverno/kyverno</li> <li>https://kyverno.io/</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/","title":"Kubernetes\u5b89\u5168\u4e4bNPD","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u5728\u4e91\u539f\u751f\u65f6\u4ee3\uff0c\u6709\u5927\u91cf\u7684\u8282\u70b9\u95ee\u9898\u53ef\u80fd\u4f1a\u5f71\u54cd\u8282\u70b9\u4e0a\u8fd0\u884c\u7684 pod\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u57fa\u7840\u8bbe\u65bd\u5b88\u62a4\u8fdb\u7a0b\u95ee\u9898\uff1antp \u670d\u52a1\u5173\u95ed\uff1b</li> <li>\u786c\u4ef6\u95ee\u9898\uff1aCPU\u3001\u5185\u5b58\u6216\u78c1\u76d8\u635f\u574f\uff1b</li> <li>\u5185\u6838\u95ee\u9898\uff1a\u5185\u6838\u6b7b\u9501\u3001\u6587\u4ef6\u7cfb\u7edf\u635f\u574f\uff1b</li> <li>\u5bb9\u5668\u8fd0\u884c\u65f6\u95ee\u9898\uff1a\u65e0\u54cd\u5e94\u7684\u8fd0\u884c\u65f6\u5b88\u62a4\u8fdb\u7a0b\uff1b</li> </ul> <p>\u76ee\u524d\uff0c\u8fd9\u4e9b\u95ee\u9898\u5bf9\u4e8e\u96c6\u7fa4\u7ba1\u7406\u5806\u6808\u4e2d\u7684\u4e0a\u6e38\u5c42\u6765\u8bf4\u662f\u4e0d\u53ef\u89c1\u7684\uff0c\u56e0\u6b64 Kubernetes \u5c06\u7ee7\u7eed\u5c06 Pod \u8c03\u5ea6\u5230\u574f\u8282\u70b9\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u65b0\u7684\u5b88\u62a4\u8fdb\u7a0b\u8282\u70b9\u95ee\u9898\u68c0\u6d4b\u5668\uff0c\u4ece\u5404\u4e2a\u5b88\u62a4\u8fdb\u7a0b\u4e2d\u6536\u96c6\u8282\u70b9\u95ee\u9898\uff0c\u5e76\u4f7f\u5b83\u4eec\u5bf9\u4e0a\u884c\u5c42\u53ef\u89c1\u3002\u4e00\u65e6\u4e0a\u6e38\u5c42\u5bf9\u8fd9\u4e9b\u95ee\u9898\u6709\u4e86\u53ef\u89c1\u6027\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba8\u8bba\u8865\u6551\u7cfb\u7edf\u3002</p> <p>Kubernetes \u9488\u5bf9\u4e0e\u90e8\u7f72\u7684Node\u8282\u70b9\uff0c\u9700\u8981\u6709\u4e00\u6b3e\u5de5\u5177\u80fd\u591f\u5bf9\u9f50\u8fdb\u884c\u6301\u7eed\u6027\u7684\u68c0\u6d4b\uff0c\u5305\u62ec\u5185\u6838\u3001\u5185\u5b58\u3001\u7cfb\u7edf\u7ebf\u7a0b\u3001\u6587\u4ef6\u7cfb\u7edf\u63cf\u8ff0\u7b26\u7b49\uff0c\u9488\u5bf9Node\u8282\u70b9\u8fdb\u884c\u68c0\u6d4b\u7b2c\u4e00\u65f6\u95f4\u53d1\u73b0\u5f02\u5e38\uff0c\u4ee5\u4fdd\u969c\u96c6\u7fa4\u5b89\u5168\u7a33\u5b9a\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#node-problem-detector","title":"\u4e8c node-problem-detector\u7b80\u4ecb","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#21-npd","title":"2.1 NPD\u7b80\u4ecb","text":"<p>\u8282\u70b9\u95ee\u9898\u68c0\u6d4b\u5668\u65e8\u5728\u4f7f\u5404\u79cd\u8282\u70b9\u95ee\u9898\u5bf9\u96c6\u7fa4\u7ba1\u7406\u5806\u6808\u7684\u4e0a\u884c\u5c42\u53ef\u89c1\u3002\u5b83\u662f\u4e00\u4e2a\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\u7684\u5b88\u62a4\u8fdb\u7a0b\uff0c\u68c0\u6d4b\u8282\u70b9\u95ee\u9898\u5e76\u5c06\u5176\u62a5\u544a\u7ed9\u670d\u52a1\u5668\u3002Node-problem-detector \u65e2\u53ef\u4ee5\u4f5c\u4e3a DaemonSet \u8fd0\u884c\uff0c\u4e5f\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\u3002\u73b0\u5728\u5b83\u4f5c\u4e3a\u9ed8\u8ba4\u542f\u7528\u7684 Kubernetes Addon \u5728 GCE \u96c6\u7fa4\u4e2d\u8fd0\u884c\u3002\u7528\u4e8e\u76d1\u89c6\u548c\u62a5\u544a\u8282\u70b9\u7684\u5065\u5eb7\u72b6\u51b5\uff08\u5305\u62ec\u5185\u6838\u6b7b\u9501\u3001OOM\u3001\u7cfb\u7edf\u7ebf\u7a0b\u6570\u538b\u529b\u3001\u7cfb\u7edf\u6587\u4ef6\u63cf\u8ff0\u7b26\u538b\u529b\u7b49\u6307\u6807\uff09\u3002  \u8282\u70b9\u95ee\u9898\u68c0\u6d4b\u5668\u4ece\u5404\u79cd\u5b88\u62a4\u8fdb\u7a0b\u6536\u96c6\u8282\u70b9\u95ee\u9898\uff0c\u5e76\u4ee5NodeCondition\u548cEvent\u7684\u5f62\u5f0f\u62a5\u544a\u7ed9 API Server\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#22-problem-api","title":"2.2 Problem API","text":"<p>node-problem-detector \u4f7f\u7528 Event \u548c NodeCondition \u5411 apiserver \u62a5\u544a\u95ee\u9898\u3002</p> <ul> <li>NodeCondition\uff1a\u4f7f\u8282\u70b9\u5bf9 pod \u4e0d\u53ef\u7528\u7684\u6c38\u4e45\u6027\u95ee\u9898\u5e94\u62a5\u544a\u4e3a NodeCondition\u3002</li> <li>Event\uff1a\u5bf9 pod \u5f71\u54cd\u6709\u9650\u4f46\u63d0\u4f9b\u4fe1\u606f\u7684\u4e34\u65f6\u95ee\u9898\u5e94\u62a5\u544a\u4e3a\u4e8b\u4ef6\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#23-problem-monitor","title":"2.3 Problem \u5b88\u62a4\u8fdb\u7a0b\uff08Monitor\uff09","text":"<p>Problem Daemon\uff08\u5728\u4ee3\u7801\u5185\u90e8\u4e5f\u53ebMonitor\uff09\u662fNPD\u7684\u5b50\u5b88\u62a4\u8fdb\u7a0b\uff0c\u6bcf\u4e2aPD\u76d1\u63a7\u4e00\u4e2a\u7279\u5b9a\u7c7b\u578b\u7684\u8282\u70b9\u6545\u969c\uff0c\u5e76\u62a5\u544a\u7ed9NPD\u3002\u76ee\u524dPD\u4ee5Goroutine\u7684\u5f62\u5f0f\u8fd0\u884c\u5728NPD\u4e2d\uff0c\u672a\u6765\u4f1a\u652f\u6301\u5728\u72ec\u7acb\u8fdb\u7a0b\uff08\u5bb9\u5668\uff09\u4e2d\u8fd0\u884c\u5e76\u7f16\u6392\u4e3a\u4e00\u4e2aPod\u3002\u5728\u7f16\u8bd1\u671f\u95f4\uff0c\u53ef\u4ee5\u901a\u8fc7\u76f8\u5e94\u7684\u6807\u8bb0\u7981\u7528\u6bcf\u4e00\u7c7bPD\u3002</p> <p>\u95ee\u9898\u5b88\u62a4\u8fdb\u7a0b\u662f node-problem-detector \u7684\u5b50\u5b88\u62a4\u8fdb\u7a0b\u3002\u5b83\u76d1\u89c6\u7279\u5b9a\u7c7b\u578b\u7684\u8282\u70b9\u95ee\u9898\u5e76\u5c06\u5b83\u4eec\u62a5\u544a\u7ed9\u8282\u70b9\u95ee\u9898\u68c0\u6d4b\u5668\u3002</p> <p>\u95ee\u9898\u5b88\u62a4\u8fdb\u7a0b\u53ef\u80fd\u662f\uff1a</p> <ul> <li>\u4e3a\u4e13\u7528 Kubernetes \u7528\u4f8b\u8bbe\u8ba1\u7684\u5c0f\u578b\u5b88\u62a4\u7a0b\u5e8f\u3002</li> <li>\u4e0e node-problem-detector \u96c6\u6210\u7684\u73b0\u6709\u8282\u70b9\u5065\u5eb7\u76d1\u63a7\u5b88\u62a4\u7a0b\u5e8f\u3002</li> </ul> <p>\u76ee\u524d\uff0c\u4e00\u4e2a\u95ee\u9898\u5b88\u62a4\u8fdb\u7a0b\u5728 node-problem-detector \u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u4f5c\u4e3a goroutine \u8fd0\u884c\u3002\u672a\u6765\uff0c\u6211\u4eec\u4f1a\u5c06 node-problem-detector \u548c\u95ee\u9898\u5b88\u62a4\u8fdb\u7a0b\u5206\u79bb\u5230\u4e0d\u540c\u7684\u5bb9\u5668\u4e2d\uff0c\u5e76\u6309\u7167 pod \u89c4\u8303\u7ec4\u5408\u5b83\u4eec\u3002</p> <p>\u901a\u8fc7\u8bbe\u7f6e\u76f8\u5e94\u7684\u6784\u5efa\u6807\u8bb0\uff0c\u53ef\u4ee5\u5728\u7f16\u8bd1\u65f6\u7981\u7528\u6bcf\u4e00\u7c7b\u95ee\u9898\u5b88\u62a4\u8fdb\u7a0b\u3002\u5982\u679c\u5728\u7f16\u8bd1\u65f6\u7981\u7528\u5b83\u4eec\uff0c\u90a3\u4e48\u5b83\u4eec\u7684\u6240\u6709\u6784\u5efa\u4f9d\u8d56\u9879\u3001\u5168\u5c40\u53d8\u91cf\u548c\u540e\u53f0 goroutine \u90fd\u5c06\u4ece\u5df2\u7f16\u8bd1\u7684\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u5220\u9664\u3002</p> <p>\u652f\u6301\u7684\u95ee\u9898\u5b88\u62a4\u8fdb\u7a0b\u7c7b\u578b\u5217\u8868\uff1a</p> Problem Daemon Types NodeCondition Description Configs Disabling Build Tag SystemLogMonitor KernelDeadlock ReadonlyFilesystem FrequentKubeletRestart FrequentDockerRestart FrequentContainerdRestart A system log monitor monitors system log and reports problems and metrics according to predefined rules. filelog, kmsg, kernel abrt systemd disable_system_log_monitor SystemStatsMonitor None(Could be added in the future) A system stats monitor for node-problem-detector to collect various health-related system stats as metrics. See the proposal here. disable_system_stats_monitor CustomPluginMonitor On-demand(According to users configuration), existing example: NTPProblem A custom plugin monitor for node-problem-detector to invoke and check various node problems with user-defined check scripts. See the proposal here. example disable_custom_plugin_monitor HealthChecker KubeletUnhealthy ContainerRuntimeUnhealthy A health checker for node-problem-detector to check kubelet and container runtime health. kubelet docker"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#24-exporter","title":"2.4 Exporter","text":"<p>\u5bfc\u51fa\u5668\u662f\u8282\u70b9\u95ee\u9898\u68c0\u6d4b\u5668\u7684\u4e00\u4e2a\u7ec4\u4ef6\u3002\u5b83\u5411\u67d0\u4e9b\u540e\u7aef\u62a5\u544a\u8282\u70b9\u95ee\u9898\u548c/\u6216\u6307\u6807\u3002\u5176\u4e2d\u4e00\u4e9b\u53ef\u4ee5\u5728\u7f16\u8bd1\u65f6\u4f7f\u7528\u6784\u5efa\u6807\u7b7e\u7981\u7528\u3002\u652f\u6301\u7684\u51fa\u53e3\u5546\u5217\u8868\uff1a</p> Exporter Description Disabling Build Tag Kubernetes exporter Kubernetes exporter reports node problems to Kubernetes API server: temporary problems get reported as Events, and permanent problems get reported as Node Conditions. Prometheus exporter Prometheus exporter reports node problems and metrics locally as Prometheus metrics Stackdriver exporter Stackdriver exporter reports node problems and metrics to Stackdriver Monitoring API. disable_stackdriver_exporter"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#_2","title":"\u4e09 \u90e8\u7f72\u6d4b\u8bd5","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#31","title":"3.1 \u96c6\u7fa4\u5185\u90e8\u7f72","text":"<p>\u5229\u7528helm\u8fdb\u884c\u90e8\u7f72\uff0c\u90e8\u7f72\u5b8c\u6210\u540e\u53ef\u4ee5\u770b\u5230npd\u662f\u4ee5daemonset\u65b9\u5f0f\u5b58\u5728\uff0c\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u6709\u8fd0\u884c\u7684\u5177\u4f53pod\u3002</p> <pre><code>$ helm repo add deliveryhero https://charts.deliveryhero.io/\n$ helm install deliveryhero/node-problem-detector --generate-name\nNAME: node-problem-detector-1646190796\nLAST DEPLOYED: Wed Mar  2 11:13:20 2022\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nTo verify that the node-problem-detector pods have started, run:\n\n  kubectl --namespace=default get pods -l \"app.kubernetes.io/name=node-problem-detector,app.kubernetes.io/instance=node-problem-detector-1646190796\"\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#32","title":"3.2 \u5355\u673a\u72ec\u7acb\u90e8\u7f72","text":"<p>Node-problem-detector\u4e5f\u53ef\u4ee5\u76f4\u63a5\u72ec\u7acb\u542f\u52a8\uff0c\u9700\u8981\u6307\u5b9ak8s-apiserver\u7684\u5730\u5740\u4ee5\u53ca\u914d\u7f6einClusterConfig \u4e3afalse\uff0c\u8be6\u7ec6\u53ef\u4ee5\u53c2\u8003\u72ec\u7acb\u90e8\u7f72</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#_3","title":"\u56db \u914d\u7f6e\u53c2\u6570","text":"<ul> <li> <p>system-log-monitor\u76f8\u5173\u53c2\u6570   --config.system-log-monitor: system log monitor\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u591a\u4e2a\u6587\u4ef6\u7528\u9017\u53f7\u5206\u9694\uff0c\u5982config/kernel-monitor.json\uff0cNPD\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u751f\u6210\u5355\u72ec\u7684log monitor\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684log monitors\u6765\u76d1\u63a7\u4e0d\u540c\u7684\u7cfb\u7edf\u65e5\u5fd7\u3002</p> </li> <li> <p>system-stats-monitor\u76f8\u5173\u53c2\u6570   --config.system-stats-monitor: system status monitor\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u591a\u4e2a\u6587\u4ef6\u7528\u9017\u53f7\u5206\u9694\uff0c\u5982config/system-stats-monitor.json\uff0cNPD\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u751f\u6210\u5355\u72ec\u7684status monitor\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684status monitors\u6765\u76d1\u63a7\u7cfb\u7edf\u7684\u4e0d\u540c\u72b6\u6001\u3002</p> </li> <li> <p>custom-plugin-monitor\u76f8\u5173\u53c2\u6570   --config.custom-plugin-monitor\uff1a\u7528\u6237\u81ea\u5b9a\u4e49\u63d2\u4ef6\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u591a\u4e2a\u6587\u4ef6\u7528\u9017\u53f7\u5206\u9694\uff0c\u5982config/custom-plugin-monitor.json\uff0cNPD\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u751f\u6210\u5355\u72ec\u7684\u81ea\u5b9a\u4e49\u63d2\u4ef6\u76d1\u89c6\u5668\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u81ea\u5b9a\u4e49\u63d2\u4ef6\u76d1\u89c6\u5668\u6765\u76d1\u63a7\u4e0d\u540c\u7684\u7cfb\u7edf\u95ee\u9898\u3002</p> </li> <li> <p>Kubernetes exporter\u76f8\u5173\u53c2\u6570   --enable-k8s-exporter\uff1a\u662f\u5426\u5f00\u542f\u4e0a\u62a5\u4fe1\u606f\u5230API Server\uff0c\u9ed8\u8ba4\u4e3atrue--apiserver-override\uff1a\u4e00\u4e2aURI\u53c2\u6570\uff0c\u7528\u4e8e\u81ea\u5b9a\u4e49node-problem-detector\u8fde\u63a5apiserver\u7684\u5730\u5740\u3002\u5982\u679c--enable-k8s-exporter\u4e3afalse\uff0c\u5219\u5ffd\u7565\u6b64\u5185\u5bb9\u3002\u683c\u5f0f\u4e0eHeapster\u7684\u6e90\u6807\u5fd7\u76f8\u540c\u3002\u4f8b\u5982\uff0c\u8981\u5728\u6ca1\u6709\u8eab\u4efd\u9a8c\u8bc1\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u914d\u7f6e\uff1ahttp://APISERVER_IP:APISERVER_ ... false   \u8bf7\u53c2\u9605heapster\u6587\u6863\u4ee5\u83b7\u53d6\u53ef\u7528\u9009\u9879\u7684\u5b8c\u6574\u5217\u8868\u3002--address\uff1a\u7ed1\u5b9aNPD\u670d\u52a1\u5668\u7684\u5730\u5740\u3002--port\uff1aNPD\u670d\u52a1\u7aef\u53e3\uff0c\u5982\u679c\u4e3a0\uff0c\u8868\u793a\u7981\u7528NPD\u670d\u52a1\u3002</p> </li> <li> <p>Prometheus exporter\u76f8\u5173\u53c2\u6570   --prometheus-address\uff1a\u7ed1\u5b9aPrometheus\u6293\u53d6\u7aef\u70b9\u7684\u5730\u5740\uff0c\u9ed8\u8ba4\u4e3a127.0.0.1--prometheus-port\uff1a\u7ed1\u5b9aPrometheus\u6293\u53d6\u7aef\u70b9\u7684\u7aef\u53e3\uff0c\u9ed8\u8ba4\u4e3a20257\uff0c\u4f7f\u75280\u7981\u7528</p> </li> <li> <p>Stackdriver exporter\u76f8\u5173\u53c2\u6570   --exporter.stackdriver\uff1aStackdriver exporter\u7a0b\u5e8f\u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u4f8b\u5982\uff1aconfig/exporter/stackdriver-exporter.json\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002 \u8bbe\u7f6e\u4e3a\u7a7a\u5b57\u7b26\u4e32\u4ee5\u7981\u7528\u3002</p> </li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#_4","title":"\u4e94 \u6a21\u62df\u6d4b\u8bd5","text":"<pre><code>sudo sh -c \"echo 'kernel: BUG: unable to handle kernel NULL pointer dereference at TESTING' &gt;&gt; /dev/kmsg\"\n</code></pre> <pre><code>sudo sh -c \"echo 'kernel: INFO: task docker:20744 blocked for more than 120 seconds.' &gt;&gt; /dev/kmsg\"\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#_5","title":"\u516d \u5176\u4ed6","text":"<ul> <li>\u5982\u679c\u955c\u50cf\u62c9\u53d6\u5f02\u5e38\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u6211\u7684\u955c\u50cf\uff1a</li> <li>\u901a\u8fc7\u81ea\u5b9a\u4e49\u914d\u7f6e\u5065\u5eb7Node\u8282\u70b9\u7684\u89c4\u5219\uff0c\u53ef\u4ee5\u5728K8s Api-server\u7684\u4e8b\u4ef6\u4e2d\u83b7\u53d6\u5230\u5177\u4f53\u7684\u544a\u8b66\u4fe1\u606f\u3002</li> </ul> <p>**node-problem-detector**\u662f\u4e00\u4e2aK8S\u52a0\u8f7d\u9879\uff08Addon\uff09\uff0c\u76ee\u7684\u662f\u5c06\u8282\u70b9\u6545\u969c\u66b4\u9732\u7ed9\u96c6\u7fa4\u7ba1\u7406\u7684\u4e0a\u5c42\u7ec4\u4ef6\u3002NPD\u901a\u5e38\u8fd0\u884c\u4e3aDaemonSet\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u72ec\u7acb\u8fdb\u7a0b\u8fd0\u884c\u3002NPD\u4f1a\u68c0\u6d4b\u5404\u79cd\u5404\u6837\u7684\u8282\u70b9\u95ee\u9898\uff0cNodeCondition\uff1a\u5f53\u9047\u5230\u6c38\u4e45\u6027\u7684\u8282\u70b9\u6545\u969c\uff0c\u5bfc\u81f4\u5176\u4e0d\u53ef\u7528\u65f6\uff0c\u8bbe\u7f6e\u8282\u70b9\u7684NodeCondition\uff0cEvent\uff1a\u53ef\u80fd\u5bf9Pod\u4ea7\u751f\u5f71\u54cd\u7684\u4e34\u65f6\u4fe1\u606f\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>http://dockone.io/article/2434546</li> <li> <p>https://github.com/kubernetes/node-problem-detector</p> </li> <li> <p>https://blog.gmem.cc/problem-detection-and-auto-repairing-in-k8s</p> </li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/","title":"Kubernetes\u5b89\u5168\u4e4bOpen Policy Agent","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u65e0\u8bba\u662f\u5728\u4e1a\u52a1\u5f00\u53d1\u8fd8\u662f\u5728\u4e1a\u52a1\u76f4\u63a5\u7684\u8bbf\u95ee\uff0c\u5f88\u591a\u65f6\u5019\uff0cPolicy \u7684\u5b9e\u73b0\u90fd\u4e0e\u5177\u4f53\u7684\u670d\u52a1\u8026\u5408\u5728\u4e00\u8d77\uff0c\u8fd9\u5bfc\u81f4 Policy \u5f88\u96be\u88ab\u5355\u72ec\u62bd\u8c61\u63cf\u8ff0\u548c\u7075\u6d3b\u53d8\u66f4\uff08\u6bd4\u5982\u52a8\u6001\u52a0\u8f7d\u65b0\u7684\u89c4\u5219\uff09\u3002\u800c\u4e14\uff0c\u4e0d\u540c\u7684\u670d\u52a1\u5bf9 Policy \u6709\u7740\u4e0d\u540c\u7684\u63cf\u8ff0\uff0c\u6bd4\u5982\u91c7\u7528 JSON\u3001YAML \u6216\u5176\u4ed6 DSL\uff0c\u8fd9\u6837\u5f88\u96be\u8fdb\u4e00\u6b65\u5c06 Policy \u4ee5\u4ee3\u7801\u7684\u5f62\u5f0f\u8fdb\u884c\u7ba1\u7406\uff08Policy As Code\uff09\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u66f4**\u7075\u6d3b\u548c\u4e00\u81f4**\u7684\u67b6\u6784\uff0c\u6211\u4eec\u5fc5\u987b\u5c06 Policy \u7684\u51b3\u7b56\u8fc7\u7a0b\u4ece\u5177\u4f53\u7684\u670d\u52a1\u63a5\u8026\u51fa\u53bb\uff0c\u8fd9\u4e5f\u662f OPA \u6574\u4f53\u67b6\u6784\u7684\u6838\u5fc3\u7406\u5ff5\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#open-policy-agent","title":"\u4e8c Open Policy Agent","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#21","title":"2.1 \u7b80\u4ecb","text":"<p>OPA \u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u901a\u7528\u7b56\u7565\u5f15\u64ce\uff0c\u53ef\u4ee5\u4e0e\u60a8\u7684\u670d\u52a1\u5171\u5b58\u3002\u60a8\u53ef\u4ee5\u5c06 OPA \u96c6\u6210\u4e3a sidecar\u3001\u4e3b\u673a\u7ea7\u5b88\u62a4\u8fdb\u7a0b\u6216\u5e93\u3002\u670d\u52a1\u901a\u8fc7\u6267\u884c\u67e5\u8be2\u5c06\u7b56\u7565\u51b3\u7b56\u5378\u8f7d\u7ed9 OPA\u3002OPA \u8bc4\u4f30\u7b56\u7565\u548c\u6570\u636e\u4ee5\u751f\u6210\u67e5\u8be2\u7ed3\u679c(\u8fd9\u4e9b\u7ed3\u679c\u88ab\u53d1\u9001\u56de\u5ba2\u6237\u7aef)\u3002\u7b56\u7565\u662f\u7528\u9ad8\u7ea7\u58f0\u660e\u6027\u8bed\u8a00\u7f16\u5199\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 api \u6216\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u8fdc\u7a0b\u5c06\u7b56\u7565\u52a0\u8f7d\u5230 OPA \u4e2d\u3002</p> <p>OPA \u5c06\u7b56\u7565\u51b3\u7b56\u4e0e\u7b56\u7565\u6267\u884c\u5206\u79bb\u3002\u5f53\u60a8\u7684\u8f6f\u4ef6\u9700\u8981\u505a\u51fa\u7b56\u7565\u51b3\u7b56\u65f6\uff0c\u5b83\u4f1a\u67e5\u8be2 OPA \u5e76\u63d0\u4f9b\u7ed3\u6784\u5316\u6570\u636e\uff08\u4f8b\u5982 JSON\uff09\u4f5c\u4e3a\u8f93\u5165\u3002 OPA \u63a5\u53d7\u4efb\u610f\u7ed3\u6784\u5316\u6570\u636e\u4f5c\u4e3a\u8f93\u5165\u3002</p> <p>\u5f00\u653e\u7b56\u7565\u4ee3\u7406(Open Policy Agent\uff0c\u53d1\u97f3\u4e3a\u201c oh-pa\u201d)\u662f\u4e00\u4e2a\u5f00\u653e\u6e90\u7801\u7684\u901a\u7528\u7b56\u7565\u5f15\u64ce\uff0c\u5b83\u7edf\u4e00\u4e86\u8de8\u5806\u6808\u7684\u7b56\u7565\u5b9e\u65bd\u3002OPA \u63d0\u4f9b\u4e86\u4e00\u79cd\u9ad8\u7ea7\u58f0\u660e\u6027\u8bed\u8a00\uff0c\u5141\u8bb8\u60a8\u5c06\u7b56\u7565\u6307\u5b9a\u4e3a\u4ee3\u7801\u548c\u7b80\u5355\u7684 api\uff0c\u4ee5\u5378\u8f7d\u8f6f\u4ef6\u4e2d\u7684\u7b56\u7565\u51b3\u7b56\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 OPA \u5728 microservices\u3001 Kubernetes\u3001 CI/CD \u7ba1\u9053\u3001 API \u7f51\u5173\u7b49\u4e2d\u5f3a\u5236\u6267\u884c\u7b56\u7565\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#22-rego","title":"2.2 Rego\u7b56\u7565\u4ee3\u7801","text":"<p>\u5728OPA\u4e2d\u7b56\u7565\u7ba1\u7406\u4f7f\u7528Rego\u8bed\u8a00\uff0cRego \u662f\u4e13\u95e8\u4e3a OPA \u6784\u5efa\u7684\u9ad8\u7ea7\u58f0\u660e\u8bed\u8a00\u3002\u5b83\u4f7f\u5f97\u5b9a\u4e49\u7b56\u7565\u548c\u89e3\u51b3\u4ee5\u4e0b\u95ee\u9898\u53d8\u5f97\u975e\u5e38\u5bb9\u6613: \u662f\u5426\u5141\u8bb8 Bob \u5728/api/v1/products \u4e0a\u6267\u884c GET \u8bf7\u6c42\uff1f\u4ed6\u5b9e\u9645\u4e0a\u5141\u8bb8\u67e5\u770b\u54ea\u4e9b\u8bb0\u5f55\uff1f</p> <p>Rego \u8bed\u8a00\u4e2d\u6700\u6838\u5fc3\u7684\u4e00\u4e2a\u529f\u80fd\u7684\u662f\u5bf9 Policy \u7684\u63cf\u8ff0\uff0c\u5373 Rules\u3002Rules \u662f\u4e00\u4e2a if-then \u7684 logic statement\u3002Rego \u7684 Rules \u5206\u4e3a\u4e24\u7c7b\uff1acomplete rules \u548c incremental rules\u3002</p> <p>\u4f8b\u5982\u4e0b\u9762input_containers[c]\u5c31\u662f\u4e00\u4e2ahead\uff0c\u5269\u4e0b\u7684 <code>{...}</code> \u5219\u4e3a body\u3002</p> <pre><code>// \u4f60\u5fc5\u987b\u4f7f\u7528kubernetes.admission\npackage kubernetes.admission\n\n// input_containers[c]\u51fd\u6570\u4ece\u8bf7\u6c42\u5bf9\u8c61\u4e2d\u63d0\u53d6\u5bb9\u5668\u3002\u6ce8\u610f\uff0c\u4f7f\u7528\u4e86_\u5b57\u7b26\u6765\u904d\u5386\u6570\u7ec4\u4e2d\u7684\u6240\u6709\u5bb9\u5668\u3002\u5728Rego\u4e2d\uff0c\u4f60\u4e0d\u9700\u8981\u5b9a\u4e49\u5faa\u73af\u2014\u4e0b\u5212\u7ebf\u5b57\u7b26\u5c06\u81ea\u52a8\u4e3a\u4f60\u5b8c\u6210\u6b64\u64cd\u4f5c\u3002\ninput_containers[c] {\n  c := input.request.object.spec.containers[_]\n}\n// \u6211\u4eec\u518d\u6b21\u4e3ainit\u5bb9\u5668\u5b9a\u4e49\u51fd\u6570\u3002\u8bf7\u6ce8\u610f\uff0c\u5728Rego\u4e2d\uff0c\u53ef\u4ee5\u591a\u6b21\u5b9a\u4e49\u540c\u4e00\u4e2a\u51fd\u6570\u3002\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u514b\u670dRego\u51fd\u6570\u4e2d\u4e0d\u80fd\u8fd4\u56de\u591a\u4e2a\u8f93\u51fa\u7684\u9650\u5236\u3002\u5f53\u8c03\u7528\u51fd\u6570\u540d\u65f6\uff0c\u5c06\u6267\u884c\u4e24\u4e2a\u51fd\u6570\uff0c\u5e76\u4f7f\u7528AND\u64cd\u4f5c\u7b26\u7ec4\u5408\u8f93\u51fa\u3002\u56e0\u6b64\uff0c\u5728\u6211\u4eec\u7684\u4f8b\u5b50\u4e2d\uff0c\u5728\u4e00\u4e2a\u6216\u591a\u4e2a\u4f4d\u7f6e\u4e2d\u5b58\u5728\u4e00\u4e2a\u6709\u7279\u6743\u7684\u5bb9\u5668\u5c06\u8fdd\u53cd\u7b56\u7565\u3002\ninput_containers[c] {\n  c := input.request.object.spec.initContainers[_]\n}\n\n// Deny\u662f\u9ed8\u8ba4\u5bf9\u8c61\uff0c\u5b83\u5c06\u5305\u542b\u6211\u4eec\u9700\u8981\u6267\u884c\u7684\u7b56\u7565\u3002\u5982\u679c\u6240\u5305\u542b\u7684\u4ee3\u7801\u8ba1\u7b97\u7ed3\u679c\u4e3atrue\uff0c\u5219\u5c06\u8fdd\u53cd\u7b56\u7565\u3002\ndeny[msg] {\n  // \u5b9a\u4e49\u4e86\u4e00\u4e2a\u53d8\u91cf\uff0c\u5b83\u5c06\u5bb9\u7eb3pod\u4e2d\u7684\u6240\u6709\u5bb9\u5668\uff0c\u5e76\u5b9a\u4e49\u7684input_containers[c]\u63a5\u6536\u503c\u3002\n  c := input_containers[_]\n  // pod\u5305\u542b\u201cprivileged\u201d\u5c5e\u6027\uff0c\u5219\u8be5\u8bed\u53e5\u4e3atrue\u3002\n  c.securityContext.privileged\n  // \u7528\u6237\u5c1d\u8bd5\u8fd0\u884c\u7279\u6743\u5bb9\u5668\u65f6\u663e\u793a\u7ed9\u4ed6\u4eec\u7684\u6d88\u606f\u3002\u5b83\u5305\u62ec\u5bb9\u5668\u540d\u79f0\u548c\u8fdd\u89c4\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u3002\n  msg := sprintf(\"Privileged container is not allowed: %v, securityContext: %v\", [c.name, c.securityContext])\n}\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#_2","title":"\u4e09 \u67b6\u6784\u8be6\u89e3","text":"<p>OPA \u901a\u8fc7\u6839\u636e\u7b56\u7565\u548c\u6570\u636e\u8bc4\u4f30\u67e5\u8be2\u8f93\u5165\u6765\u751f\u6210\u7b56\u7565\u51b3\u7b56\u3002 OPA \u548c Rego \u4e0e\u57df\u65e0\u5173\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728\u7b56\u7565\u4e2d\u63cf\u8ff0\u51e0\u4e4e\u4efb\u4f55\u7c7b\u578b\u7684\u4e0d\u53d8\u91cf\u3002\u4f8b\u5982\uff1a</p> <ul> <li>\u54ea\u4e9b\u7528\u6237\u53ef\u4ee5\u8bbf\u95ee\u54ea\u4e9b\u8d44\u6e90\u3002</li> <li>\u5141\u8bb8\u54ea\u4e9b\u5b50\u7f51\u51fa\u53e3\u901a\u4fe1\u3002</li> <li>\u5fc5\u987b\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u90e8\u7f72\u5230\u54ea\u4e9b\u96c6\u7fa4\u3002</li> <li>\u53ef\u4ee5\u4ece\u54ea\u4e9b\u6ce8\u518c\u8868\u4e2d\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002</li> <li>\u5bb9\u5668\u53ef\u4ee5\u4f7f\u7528\u54ea\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u529f\u80fd\u6267\u884c\u3002</li> <li>\u7cfb\u7edf\u5728\u4e00\u5929\u4e2d\u7684\u54ea\u4e9b\u65f6\u95f4\u53ef\u4ee5\u8bbf\u95ee\u3002</li> </ul> <p>\u653f\u7b56\u51b3\u5b9a\u4e0d\u9650\u4e8e\u7b80\u5355\u7684\u662f/\u5426\u6216\u5141\u8bb8/\u62d2\u7edd\u7b54\u6848\u3002\u4e0e\u67e5\u8be2\u8f93\u5165\u4e00\u6837\uff0c\u60a8\u7684\u7b56\u7565\u53ef\u4ee5\u751f\u6210\u4efb\u610f\u7ed3\u6784\u5316\u6570\u636e\u4f5c\u4e3a\u8f93\u51fa\u3002</p> <p></p> <p>\u6211\u4eec\u518d\u6b21\u4e3ainit\u5bb9\u5668\u5b9a\u4e49\u51fd\u6570\u3002\u8bf7\u6ce8\u610f\uff0c\u5728Rego\u4e2d\uff0c\u53ef\u4ee5\u591a\u6b21\u5b9a\u4e49\u540c\u4e00\u4e2a\u51fd\u6570\u3002\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u514b\u670dRego\u51fd\u6570\u4e2d\u4e0d\u80fd\u8fd4\u56de\u591a\u4e2a\u8f93\u51fa\u7684\u9650\u5236\u3002\u5f53\u8c03\u7528\u51fd\u6570\u540d\u65f6\uff0c\u5c06\u6267\u884c\u4e24\u4e2a\u51fd\u6570\uff0c\u5e76\u4f7f\u7528AND\u64cd\u4f5c\u7b26\u7ec4\u5408\u8f93\u51fa\u3002\u56e0\u6b64\uff0c\u5728\u6211\u4eec\u7684\u4f8b\u5b50\u4e2d\uff0c\u5728\u4e00\u4e2a\u6216\u591a\u4e2a\u4f4d\u7f6e\u4e2d\u5b58\u5728\u4e00\u4e2a\u6709\u7279\u6743\u7684\u5bb9\u5668\u5c06\u8fdd\u53cd\u7b56\u7565\u3002</p> <p>OPA\u96c6\u6210</p> <p>OPA \u7684\u8fd0\u884c**\u4f9d\u8d56\u4e8e Rego \u8fd0\u884c\u73af\u5883**\uff0c\u56e0\u6b64 OPA \u63d0\u4f9b\u4e86\u4e24\u79cd\u4e3b\u8981\u7684\u4f7f\u7528\u65b9\u5f0f\uff1a</p> <ul> <li>Go Library</li> </ul> <p>\u76f4\u63a5\u5c06 Rego \u7684\u8fd0\u884c\u73af\u5883\u4ee5\u5e93\u7684\u5f62\u5f0f\u6574\u5408\u5230\u7528\u6237\u670d\u52a1\u4e2d\u3002\u5f53\u670d\u52a1\u9700\u8981\u6267\u884c Rego \u4ee3\u7801\u65f6\uff0c\u53ea\u9700\u8981\u8c03\u7528\u76f8\u5173\u7684 API \u5373\u53ef\uff1b</p> <ul> <li>REST API</li> </ul> <p>\u5982\u679c\u670d\u52a1\u4e0d\u662f\u4ee5\u7528 Go \u7f16\u5199\uff0c\u4e3a\u4e86\u62e5\u6709 Rego \u8fd0\u884c\u73af\u5883\uff0c\u6b64\u65f6\u5219\u5fc5\u987b\u4f7f\u7528 REST API\u3002OPA \u63d0\u4f9b\u4e86\u4e00\u4e2a HTTP \u670d\u52a1\uff0c\u5f53\u5176\u4ed6\u7ec4\u4ef6\u9700\u8981\u6267\u884c Rego \u4ee3\u7801\u65f6\uff0c\u5219\u5c06**\u4ee3\u7801\u548c\u6570\u636e\u4e00\u8d77\u4ee5 REST API \u7684\u5f62\u5f0f\u4f20\u7ed9 OPA HTTP \u670d\u52a1**\uff0c\u5f85 Rego \u6267\u884c\u5b8c\u540e\u5c06\u76f8\u5e94\u7684\u7ed3\u679c\u8fd4\u56de\uff1b</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#kubernetespoa","title":"\u56db \u5728Kubernetes\u4e2d\u4f7f\u7528POA","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#41-opa-as-an-admission-controller","title":"4.1 OPA As An Admission Controller","text":"<p>OPA \u4f5c\u4e3a\u51c6\u5165\u63a7\u5236\u5668\uff0c\u5728\u90e8\u7f72\u7684\u65f6\u5019\u9700\u8981\u63d0\u524d\u9884\u7f6e\u6761\u4ef6\uff1a</p> <ul> <li>\u5f3a\u5236\u8981\u6c42 pod \u5fc5\u987b\u6709\u4e00\u4e2a sidecar \u5bb9\u5668\u3002\u6b64 sidecar \u5bb9\u5668\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u5b89\u5168\u7b56\u7565\u7684\u8981\u6c42\u6267\u884c\u5ba1\u8ba1\u6216\u65e5\u5fd7\u8bb0\u5f55\u4efb\u52a1\u3002</li> <li> <p>\u96c6\u7fa4\u542f\u7528\u4e86 <code>MutatingAdmissionWebhook</code> \u548c<code>ValidatingAdmissionWebhook</code>\uff1b</p> </li> <li> <p>\u4fee\u6539\u6240\u6709\u8d44\u6e90\u4ee5\u5177\u6709\u7279\u5b9a\u7684\u6ce8\u91ca\u3002</p> </li> <li>\u6539\u53d8\u5bb9\u5668\u955c\u50cf\u4ee5\u59cb\u7ec8\u6307\u5411\u4f01\u4e1a\u955c\u50cf\u6ce8\u518c\u8868\u3002</li> <li>\u5c06\u8282\u70b9\u548c pod \u5173\u8054\u6027\u548c\u53cd\u5173\u8054\u6027\u9009\u62e9\u5668\u8bbe\u7f6e\u4e3a Deployment\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#42-the-opa-gatekeeper","title":"4.2 The OPA Gatekeeper","text":"<p>Gatekeeper \u662f\u4e00\u4e2a\u76f8\u5bf9\u8f83\u65b0\u7684\u9879\u76ee\uff0c\u65e8\u5728\u6781\u5927\u5730\u589e\u5f3a\u548c\u4fc3\u8fdb OPA \u548c Kubernetes \u4e4b\u95f4\u7684\u96c6\u6210\u3002\u90a3\u4e48\uff0cGatekeeper \u4e3a\u666e\u901a OPA \u5e26\u6765\u4e86\u54ea\u4e9b\u989d\u5916\u7684\u529f\u80fd\uff1f</p> <ul> <li>\u53ef\u6269\u5c55\u7684\u53c2\u6570\u5316\u7b56\u7565\u5e93\u3002</li> <li>\u7528\u4e8e\u521b\u5efa\u7ea6\u675f\u7684 Kubernetes \u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49 (CRD)\u3002</li> <li>\u53e6\u4e00\u4e2a\u7528\u4e8e\u6269\u5c55\u7ea6\u675f\u7684 CRD\uff08\u7ea6\u675f\u6a21\u677f\uff09\u3002</li> <li>\u5ba1\u8ba1\u80fd\u529b\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#43-gatekeeper","title":"4.3 \u5b89\u88c5Gatekeeper","text":"<p>Kubernetes 1.14 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u5e76\u4e14\u9700\u8981\u96c6\u7fa4\u7684\u7ba1\u7406\u6743\u9650\u3002</p> <p>\u68c0\u67e5\u5b8c\u4e0a\u8ff0\u8981\u6c42\u540e\uff0c\u5b89\u88c5 OPA Gatekeeper \u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>  kubectl apply -f https://raw.githubusercontent.com/open-policy-agent/gatekeeper/master/deploy/gatekeeper.yaml\n</code></pre> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#44","title":"4.4 \u793a\u4f8b","text":"<p>\u4ece\u521b\u5efa\u7ea6\u675f\u6a21\u677f\u5f00\u59cb\u2014\u2014\u540c\u6837\uff0c\u8be5\u6a21\u677f\u5b9a\u4e49\u4e86\u60a8\u9700\u8981\u5b9a\u4e49\u7684\u53c2\u6570\u4ee5\u53ca\u5c06\u6267\u884c\u9a8c\u8bc1\u7684\u5b9e\u9645 Rego \u4ee3\u7801\u3002 k8srequiredregistry_template.yaml \u5e94\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>apiVersion: templates.gatekeeper.sh/v1beta1\nkind: ConstraintTemplate\nmetadata:\n  name: k8srequiredregistry\nspec:\n  crd:\n    spec:\n      names:\n        kind: K8sRequiredRegistry\n      validation:\n        # Schema for the `parameters` field\n        openAPIV3Schema:\n          properties:\n            image:\n              type: string\n  targets:\n    - target: admission.k8s.gatekeeper.sh\n      rego: |\n        package k8srequiredregistry\n        violation[{\"msg\": msg, \"details\": {\"Registry should be\": required}}] {\n          input.review.object.kind == \"Pod\"\n          some i\n          image := input.review.object.spec.containers[i].image\n          required := input.parameters.registry\n          not startswith(image,required)\n          msg := sprintf(\"Forbidden registry: %v\", [image])\n        }\n</code></pre> <p></p> <pre><code>[root@VM-48-7-centos opaexample]# k get ConstraintTemplate k8srequiredregistry\nNAME                  AGE\nk8srequiredregistry   68s\n</code></pre> <ul> <li>\u5e94\u7528\u6a21\u7248\u5b9a\u4e49</li> </ul> <pre><code>kubectl apply -f k8srequiredregistry_template.yaml.\n\napiVersion: constraints.gatekeeper.sh/v1beta1\nkind: K8sRequiredRegistry\nmetadata:\n\u00a0 name: images-must-come-from-gcr\nspec:\n\u00a0 match:\n\u00a0 \u00a0 kinds:\n\u00a0 \u00a0 \u00a0 - apiGroups: [\"\"]\n\u00a0 \u00a0 \u00a0 \u00a0 kinds: [\"Pod\"]\n\u00a0 parameters:\n\u00a0 \u00a0 registry: \"gcr.io/\"\n</code></pre> <pre><code>kubectl apply -f all_images_must_come_from_gcr.yaml\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n\u00a0 name: busybox\nspec:\n\u00a0 selector:\n\u00a0 \u00a0 matchLabels:\n\u00a0 \u00a0 \u00a0 app: busybox\n\u00a0 replicas: 1\n\u00a0 template:\n\u00a0 \u00a0 metadata:\n\u00a0 \u00a0 \u00a0 labels:\n\u00a0 \u00a0 \u00a0 \u00a0 app: busybox\n\u00a0 \u00a0 spec:\n\u00a0 \u00a0 \u00a0 containers:\n\u00a0 \u00a0 \u00a0 - name: busybox\n\u00a0 \u00a0 \u00a0 \u00a0 image: gcr.io/google-containers/busybox\n\u00a0 \u00a0 \u00a0 \u00a0 command:\n\u00a0 \u00a0 \u00a0 \u00a0 - sh\n\u00a0 \u00a0 \u00a0 \u00a0 - -c\n\u00a0 \u00a0 \u00a0 \u00a0 - sleep 1000000\n</code></pre> <p>\u7b56\u7565\u4f1a\u62e6\u622a\u6389\u955c\u50cf\u4e3agrc.io\u7684\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#_3","title":"\u4e94 \u7b56\u7565","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#41","title":"4.1 \u53d7\u4fe1\u4efb\u955c\u50cf\u4ed3\u5e93","text":"<p>\u6b64\u7b56\u7565\u5f88\u7b80\u5355\uff0c\u4f46\u529f\u80fd\u5f3a\u5927\uff1a\u4ec5\u5141\u8bb8\u4ece\u53d7\u4fe1\u4efb\u7684\u955c\u50cf\u4ed3\u5e93\u4e2d\u62c9\u53d6\u5bb9\u5668\u955c\u50cf\u3002\u4ece\u7f51\u4e0a\u968f\u610f\u62c9\u53d6\u672a\u77e5\u955c\u50cf\u4f1a\u5e26\u6765\u98ce\u9669\uff0c\u4f8b\u5982\u6076\u610f\u8f6f\u4ef6\u3002\u901a\u8fc7\u786e\u4fdd\u955c\u50cf\u4ec5\u6765\u81ea\u53d7\u4fe1\u4efb\u7684\u955c\u50cf\u4ed3\u5e93\uff0c\u4f60\u53ef\u4ee5\u7d27\u5bc6\u63a7\u5236\u955c\u50cf\u5b89\u5168\uff0c\u51cf\u8f7b\u8f6f\u4ef6\u88ab\u653b\u51fb\u7684\u98ce\u9669\uff0c\u968f\u4e4b\u63d0\u9ad8\u96c6\u7fa4\u7684\u6574\u4f53\u5b89\u5168\u6027\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#411","title":"4.1.1 \u76f8\u5173\u7b56\u7565\uff1a","text":"<ul> <li>\u7981\u6b62\u4f7f\u7528\u5e26\u6709\u201d latest \u201c\u6807\u7b7e\u7684\u955c\u50cf</li> <li>\u4ec5\u4f7f\u7528\u7b7e\u540d\u7684\u955c\u50cf\uff0c\u6216\u4e0e\u7279\u5b9a\u54c8\u5e0c/SHA\u5339\u914d\u7684\u955c\u50cf</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#412","title":"4.1.2 \u793a\u4f8b","text":"<pre><code>package kubernetes.validating.images\n\ndeny[msg] {\n    some i\n    input.request.kind.kind == \"Pod\"\n    image := input.request.object.spec.containers[i].image\n    not startswith(image, \"anchnet./\")\n    msg := sprintf(\"Image '%v' comes from untrusted registry\", [image])\n}\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#42","title":"4.2 \u7981\u6b62\u4f7f\u7528\u7279\u6743\u6a21\u5f0f","text":"<p>\u6b64\u7b56\u7565\uff0c\u786e\u4fdd\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5bb9\u5668\u4e0d\u80fd\u5728\u7279\u6743\u6a21\u5f0f\u4e0b\u8fd0\u884c\u3002</p> <p>\u901a\u5e38\uff0c\u4f60\u8981\u907f\u514d\u5728\u7279\u6743\u6a21\u5f0f\u4e0b\u8fd0\u884c\u5bb9\u5668\uff0c\u56e0\u4e3a\u5b83\u63d0\u4f9b\u5bf9\u4e3b\u673a\u8d44\u6e90\u548c\u5185\u6838\u529f\u80fd\uff08\u5305\u62ec\u7981\u7528\u4e3b\u673a\u7ea7\u4fdd\u62a4\u7684\u529f\u80fd\uff09\u7684\u8bbf\u95ee\u3002</p> <p>\u5c3d\u7ba1\u5bb9\u5668\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u662f\u9694\u79bb\u7684\uff0c\u4f46\u5b83\u4eec\u6700\u7ec8\u5171\u4eab\u540c\u4e00\u5185\u6838\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u7279\u6743\u5bb9\u5668\u906d\u5230\u7834\u574f\uff0c\u5219\u5b83\u53ef\u80fd\u6210\u4e3a\u7834\u574f\u6574\u4e2a\u7cfb\u7edf\u7684\u8d77\u70b9\u3002\u5982\u679c\u60f3\u8981\u5728\u7279\u6743\u6a21\u5f0f\u4e0b\u8fd0\u884c\u955c\u50cf-\u4ec5\u786e\u4fdd\u8fd9\u4e9b\u65f6\u95f4\u662f\u4f8b\u5916\uff0c\u800c\u4e0d\u662f\u5e38\u89c4\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#421","title":"4.2.1 \u76f8\u5173\u7b56\u7565\uff1a","text":"<ul> <li>\u7981\u6b62\u4e0d\u5b89\u5168\u7684\u80fd\u529b</li> <li>\u7981\u6b62\u5bb9\u5668\u4ee5root\u8eab\u4efd\u8fd0\u884c\uff08\u8981\u4ee5\u975eroot\u8eab\u4efd\u8fd0\u884c\uff09</li> <li>\u8bbe\u7f6e\u7528\u6237ID</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#422","title":"4.2.2 \u793a\u4f8b\uff1a","text":"<pre><code>package kubernetes.validating.privileged\n\ndeny[msg] {\n    some c\n    input_container[c]\n    c.securityContext.privileged\n    msg := sprintf(\"Container '%v' should not run in privileged mode.\", [c.name])\n}\n\ninput_container[container] {\n    container := input.request.object.spec.containers[_]\n}\n\ninput_container[container] {\n    container := input.request.object.spec.initContainers[_]\n}\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#_4","title":"\u516d \u4ef7\u503c","text":"<p>OPA \u63d0\u51fa\u7684 Policy Engine \u7684\u56fe\u666f\u662f\u5f88\u7f8e\u597d\u7684\uff0c\u5373 Policy As Code\u3002\u5982\u679c\u80fd\u591f\u5c06 Policy \u4ee5\u4e00\u79cd\u6e05\u6670\u7edf\u4e00\u7684\u4ee3\u7801\u5f62\u5f0f\u7ba1\u7406\uff0c\u90a3\u4e48\u53ef\u4ee5\u6211\u4eec\u81f3\u5c11\u53ef\u4ee5\u83b7\u5f97\u4ee5\u4e0b\u51e0\u4e2a\u597d\u5904\uff1a</p> <ul> <li>\u5168\u5c40\u7edf\u4e00\u7684 Policy \u63cf\u8ff0\u65b9\u5f0f</li> </ul> <p>\u6240\u6709\u5f00\u53d1\u8005\u5bf9 Policy \u7684\u63cf\u8ff0\u4e0d\u518d\u4ec5\u4ec5\u5185\u5d4c\u4e8e\u4e1a\u52a1\u4ee3\u7801\u4e2d\uff0c\u4e5f\u4e0d\u518d\u4ee5\u591a\u79cd\u4e0d\u540c\u7684\u5f62\u5f0f\u63cf\u8ff0\uff0c\u800c\u662f\u4ee5\u4e00\u79cd\u7edf\u4e00\u7684\u8bed\u8a00\u8fdb\u884c\u8868\u8fbe\uff1b</p> <ul> <li>\u63d0\u5347\u8fd0\u7ef4\u6548\u7387</li> </ul> <p>\u867d\u7136\u5e94\u7528 Policy As Code \u521d\u671f\u53ef\u80fd\u4f1a\u5e26\u6765\u4e00\u5b9a\u7684\u5b66\u4e60\u6210\u672c\uff0c\u4f46\u662f\u540e\u671f\u7684\u4ef7\u503c\u662f\u53ef\u4ee5\u8ba9 Policy \u62e5\u6709\u7c7b\u4f3c\u4ee3\u7801\u7684\u7279\u6027\uff1a</p> <ul> <li>\u4e0d\u540c\u7684 Policy \u4ee3\u7801\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u8fdb\u884c\u6574\u5408\uff0c\u6bd4\u5982\u6bcf\u4e2a\u4e1a\u52a1\u5fc5\u987b\u5148\u96c6\u6210\u516c\u53f8\u5c42\u9762\u7684 Policy \u4ee3\u7801\u624d\u53ef\u4ee5\u5f00\u53d1\u81ea\u8eab\u4e1a\u52a1\u76f8\u5173\u7684 Policy\uff1b</li> <li>\u5c06\u5b89\u5168\u51c6\u5165\u7684\u89c4\u5219\u62bd\u8c61\u6210 Policy \u4ee3\u7801\u4f9b\u4e1a\u52a1\u76f4\u63a5\u4f7f\u7528\uff0c\u4ece\u800c\u8ba9\u4e1a\u52a1\u65e0\u9700\u8fc7\u591a\u5173\u6ce8\u5b89\u5168\uff1b</li> <li>\u4e0d\u540c\u7684 Policy \u53ef\u4ee5\u50cf\u4ee3\u7801\u4e00\u6837\u8fdb\u884c\u81ea\u52a8\u5316\u68c0\u67e5\u548c\u6d4b\u8bd5\uff08\u6bd4\u5982\u516c\u53f8\u6216\u7ec4\u7ec7\u5c42\u9762\u7684\u5408\u89c4\u68c0\u67e5\u7b49\uff09\uff1b</li> <li> <p>\u66f4\u65b9\u4fbf Review\uff1b</p> </li> <li> <p>\u63d0\u5347\u4e1a\u52a1\u67b6\u6784\u7075\u6d3b\u5ea6</p> </li> </ul> <p>\u7c7b\u4f3c\u4e8e OPA \u7684\u63a5\u8026\u67b6\u6784\u53ef\u8ba9\u539f\u6765\u4e1a\u52a1\u5b9e\u73b0\u66f4\u4e3a\u7075\u6d3b\u7684\u529f\u80fd\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u52a8\u6001\u66f4\u65b0\u548c\u52a0\u8f7d\u65b0\u7684 Policy\uff1b</li> <li>\u591a\u4e2a\u7ec4\u4ef6\u5171\u4eab\u540c\u4e00\u4efd Policy \u6267\u884c\u76f8\u5173\u903b\u8f91\uff08\u6bd4\u5982\u591a\u4e2a\u7ec4\u4ef6\u5171\u4eab\u540c\u4e00\u4e2a Authorization \u7ec4\u4ef6\uff09\uff1b</li> <li> <p>\u53ef\u7f16\u7a0b\u80fd\u529b\uff1a\u5b9e\u73b0\u65b0\u7684 Policy \u53ea\u9700\u8981\u5199\u65b0\u7684 Policy DSL \u5373\u53ef\uff0c\u65e0\u987b\u6539\u53d8\u4e1a\u52a1\u548c\u6846\u67b6\u5c42\u903b\u8f91\uff0c\u7406\u8bba\u4e0a\u7f16\u5199 DSL \u4ee3\u7801\u7684\u590d\u6742\u5ea6\u8981\u8fdc\u8fdc\u5c0f\u4e8e\u7528\u539f\u751f\u8bed\u8a00\u5f00\u53d1\uff1b</p> </li> <li> <p>\u66f4\u7ec6\u7c92\u5ea6\u548c\u9ad8\u6548\u7684\u5b89\u5168\u4fdd\u969c</p> </li> </ul> <p>\u4ee3\u7801\u5316\u540e\u7684 Policy \u53ef\u4ee5\u8fdb\u884c\u7ec6\u7c92\u5ea6\u548c\u7075\u6d3b\u7684\u63cf\u8ff0\uff0c\u6bd4\u5982\u53ef\u4ee5\u9488\u5bf9\u7279\u5b9a\u5b57\u6bb5\u8fdb\u884c\u7279\u6b8a\u5224\u65ad\u7b49\u3002\u9488\u5bf9 Authorization\uff0c\u53ef\u5f88\u5bb9\u6613\u6839\u636e\u8fd9\u4e00\u7279\u70b9\u5b9e\u73b0\u9ed1\u767d\u540d\u5355\u529f\u80fd\uff0c\u8fd9\u6bd4\u4ee5\u5f80\u4f7f\u7528 RBAC \u5f62\u5f0f\u7684\u6388\u6743\u8981\u66f4\u4e3a\u7075\u6d3b\u3002</p> <p>\u5bf9\u5b89\u5168\u7684\u7406\u89e3\u53ef\u62bd\u8c61\u6210 Policy \u4ee3\u7801\u5f3a\u5236\u81ea\u52a8\u6267\u884c\uff0c\u8fd9\u6837\u5bf9\u5b89\u5168\u7684\u4fdd\u969c\u4e0d\u518d\u4ec5\u4ec5\u4f9d\u9760\u5f00\u53d1\u8005\u81ea\u8eab\u610f\u8bc6\u6216\u8fd0\u7ef4\u4eba\u5458\u7684\u914d\u7f6e Review\uff0c\u800c\u662f\u76f4\u63a5\u4ee5\u7edf\u4e00\u7684\u4ee3\u7801\u5f62\u5f0f\u4f53\u73b0\uff1b</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BOpen%20Policy%20Agent/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/open-policy-agent/opa</li> <li>https://www.openpolicyagent.org/</li> <li>https://docs.google.com/presentation/d/16QV6gvLDOV3I0_guPC3_19g6jHkEg3X9xqMYgtoCKrs/edit#slide=id.g107b5c4c845_0_0</li> <li>https://thenewstack.io/open-policy-agent-the-top-5-kubernetes-admission-control-policies/</li> <li>https://cloud.tencent.com/developer/article/1741460</li> <li>https://zhengyinyong.com/post/opa-research/</li> <li>https://www.magalix.com/blog/integrating-open-policy-agent-opa-with-kubernetes-a-deep-dive-tutorial</li> <li>https://play.openpolicyagent.org/</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/","title":"Kubernetes\u5b89\u5168\u626b\u63cf\u4e4bkubescape","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>Kubescape \u662f\u7b2c\u4e00\u4e2a\u7528\u4e8e\u6d4b\u8bd5 Kubernetes \u662f\u5426\u6309\u7167 NSA \u548c CISA \u7684 Kubernetes \u5f3a\u5316\u6307\u5357\u4e2d\u5b9a\u4e49\u7684\u5b89\u5168\u90e8\u7f72\u7684\u5de5\u5177 \u4f7f\u7528 Kubescape \u6d4b\u8bd5\u96c6\u7fa4\u6216\u626b\u63cf\u5355\u4e2a YAML \u6587\u4ef6\u5e76\u5c06\u5176\u96c6\u6210\u5230\u60a8\u7684\u6d41\u7a0b\u4e2d\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#_2","title":"\u4e8c \u7279\u6027","text":"<ul> <li> <p>\u529f\u80fd\uff1a\u63d0\u4f9b\u591a\u4e91 K8s \u96c6\u7fa4\u68c0\u6d4b\uff0c\u5305\u62ec\u98ce\u9669\u5206\u6790\u3001\u5b89\u5168\u6027\u517c\u5bb9\u3001 RBAC \u53ef\u89c6\u5316\u5de5\u5177\u548c\u56fe\u50cf\u6f0f\u6d1e\u626b\u63cf\u3002</p> </li> <li> <p>\u96c6\u7fa4\u626b\u63cf\uff1aKubescape \u626b\u63cf K8s \u96c6\u7fa4\u3001 YAML \u6587\u4ef6\u548c HELM \u56fe\u8868\uff0c\u6839\u636e\u591a\u4e2a\u6846\u67b6(\u5982 NSA-CISA\u3001 MITRE att &amp; ck)\u3001\u8f6f\u4ef6\u6f0f\u6d1e\u548c\u5728 CI/CD \u7ba1\u9053\u65e9\u671f\u9636\u6bb5\u7684 RBAC (\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236)\u8fdd\u89c4\u68c0\u6d4b\u9519\u8bef\u914d\u7f6e\uff0c\u5373\u65f6\u8ba1\u7b97\u98ce\u9669\u8bc4\u5206\u5e76\u663e\u793a\u968f\u65f6\u95f4\u63a8\u79fb\u7684\u98ce\u9669\u8d8b\u52bf\u3002</p> </li> <li> <p>\u5de5\u5177\u96c6\u6210\uff1a\u4e0e\u5176\u4ed6 DevOps \u5de5\u5177\u96c6\u6210\uff0c\u5305\u62ec Jenkins\u3001 CircleCI\u3001 Github \u5de5\u4f5c\u6d41\u3001 Prometheus \u548c Slack\uff0c\u5e76\u652f\u6301\u591a\u4e91 k8\u90e8\u7f72\uff0c\u5982 EKS\u3001 GKE \u548c AKS\u3002</p> </li> </ul> <p>\u7531\u4e8e\u5176\u7b80\u5355\u6613\u7528\u7684 CLI \u754c\u9762\u3001\u7075\u6d3b\u7684\u8f93\u51fa\u683c\u5f0f\u548c\u81ea\u52a8\u626b\u63cf\u80fd\u529b\uff0c\u5b83\u6210\u4e3a\u5f00\u53d1\u4eba\u5458\u4e2d\u589e\u957f\u6700\u5feb\u7684 Kubernetes \u5de5\u5177\u4e4b\u4e00\uff0c\u8282\u7701\u4e86\u7528\u6237\u548c\u7ba1\u7406\u5458\u5b9d\u8d35\u7684\u65f6\u95f4\u3001\u7cbe\u529b\u548c\u8d44\u6e90</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#_3","title":"\u4e09 \u5b89\u88c5","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#31-mac","title":"3.1 Mac \u5b89\u88c5","text":"<pre><code>  brew tap armosec/kubescape\n  brew install kubescape\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#32-linux","title":"3.2 Linux\u5b89\u88c5","text":"<pre><code>curl -s https://raw.githubusercontent.com/armosec/kubescape/master/install.sh | /bin/bash\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#_4","title":"\u56db \u96c6\u7fa4\u68c0\u6d4b","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#41","title":"4.1 \u6267\u884c\u626b\u63cf","text":"<p>\u626b\u63cf\u53ef\u5206\u4e3a\u672c\u5730\u96c6\u7fa4\u626b\u63cf\u548c\u63d0\u4ea4\u7ed3\u679c\u5230saas\u5e73\u53f0\u3002</p> <pre><code>chmod +x /root/.kubescape/kubescape \n/root/.kubescape/kubescape scan framework nsa --exclude-namespaces kube-system,kube-public\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#42","title":"4.2 \u8f93\u51fa\u7ed3\u679c","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#saas","title":"\u4e94 SaaS\u5e73\u53f0","text":"<p>saas\u5e73\u53f0\u5730\u5740\uff1ahttps://portal.armo.cloud/\uff0c\u4e3b\u8981\u6709\u4e09\u5927\u529f\u80fd\uff0c</p> <ul> <li>\u96c6\u7fa4\u68c0\u6d4b</li> <li>\u955c\u50cf\u626b\u63cf</li> <li>RBAC\u53ef\u89c6\u5316</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#51","title":"5.1 \u96c6\u7fa4\u68c0\u6d4b","text":"<p>\u4e0e\u5355\u72ec\u5728\u96c6\u7fa4\u68c0\u6d4b\u8f93\u51fa\u4e0d\u540c\uff0csaas\u5e73\u53f0\u4f1a\u5c06\u96c6\u7fa4\u68c0\u6d4b\u53ca\u4e0a\u4f20\u5230\u5e73\u53f0\u8fdb\u884c\u53ef\u89c6\u5316\u5c55\u793a</p> <pre><code>curl -s https://raw.githubusercontent.com/armosec/kubescape/master/install.sh | /bin/bash\n</code></pre> <ul> <li>\u63d0\u4ea4\u68c0\u6d4b\u7ed3\u679c\u5230\u5e73\u53f0</li> </ul> <pre><code>export ID=6xxxxxxxxxxx\nkubescape scan --submit --account=${ID}\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c</li> </ul> <p></p> <p>\u540c\u65f6\u53ef\u6839\u636e\u63d0\u793a\u8df3\u8f6c\u5230\u8be6\u7ec6\u5b89\u5168\u4fe1\u606f\u5185\u5bb9</p> <p></p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#52","title":"5.2 \u955c\u50cf\u626b\u63cf","text":"<pre><code>helm repo add armo https://armosec.github.io/armo-helm/\n\nhelm upgrade --install armo  armo/armo-cluster-components -n armo-system --create-namespace --set accountGuid=${ID} --set clusterName=`kubectl config current-context`\n</code></pre> <ul> <li>\u67e5\u770b\u7ed3\u679c</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\u96c6\u7fa4\u6574\u4e2a\u955c\u50cf\u626b\u63cf\u7684\u4fe1\u606f\u3002</p> <p></p> <p>\u540c\u65f6\u9488\u5bf9\u5355\u4e2a\u955c\u50cf\u4e5f\u53ef\u4ee5\u770b\u5230\u8be6\u7ec6\u626b\u63cf\u4fe1\u606f\u3002</p> <p></p> <p>\u53ef\u4ee5\u9488\u5bf9\u5355\u4e2a\u955c\u50cf\u53ef\u4ee5\u770b\u662f\u5426\u6709FIX AVAILABLE\uff0c\u4ee5\u53caFIX IN VERSION</p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#53-rbac","title":"5.3 RBAC\u53ef\u89c6\u5316","text":"<p>\u76ee\u524dRBAC\u529f\u80fd\u8fd8\u5904\u4e8ebeat\u9636\u6bb5\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#_5","title":"\u516d \u5176\u4ed6","text":"<p>kubescape\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5728Node\u8282\u70b9\u5bf9\u96c6\u7fa4\u8fdb\u884c\u5305\u98ce\u9669\u5206\u6790\u3001\u5b89\u5168\u6027\u517c\u5bb9\u3001 RBAC \u53ef\u89c6\u5316\u5de5\u5177\u548c\u56fe\u50cf\u6f0f\u6d1e\u626b\u63cf\uff0c\u540c\u65f6\u53ef\u4ee5\u5229\u7528SaaS\u975e\u5e38\u65b9\u4fbf\u7684\u8fdb\u884c\u53ef\u89c6\u5316\uff0c\u540c\u65f6\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u4e0e\u5176\u4ed6\u7cfb\u7edf\u8fdb\u884c\u96c6\u6210\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/armosec/kubescape</li> <li>https://portal.armo.cloud/</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bopenebs/","title":"Kubernetes\u5b89\u5168\u4e4bopenebs","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bopenebs/#_1","title":"Kubernetes\u5b89\u5168\u4e4bopenebs","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bopenebs/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/openebs/openebs</li> <li>https://openebs.io/</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/","title":"Kubernetes\u5b89\u5168\u5206\u6790","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubernetes_1","title":"Kubernetes \u5927\u4f53\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b","text":"<ul> <li>Node \u5b89\u5168</li> <li>\u5e94\u7528\u5b89\u5168</li> </ul> <p>Kubernetes \u7684\u5b89\u5168\u5de5\u5177\u591a\u5f97\u5f88\uff0c\u6709\u4e0d\u540c\u7684\u529f\u80fd\u3001\u8303\u56f4\u4ee5\u53ca\u6388\u6743\u65b9\u5f0f\u3002\u56e0\u6b64\u6211\u4eec\u5efa\u7acb\u4e86\u8fd9\u4e2a Kubernetes \u5b89\u5168\u5de5\u5177\u5217\u8868\uff0c\u5176\u4e2d\u6709\u6765\u81ea\u4e0d\u540c\u5382\u5546\u7684\u5f00\u6e90\u9879\u76ee\u548c\u5546\u4e1a\u5e73\u53f0\uff0c\u8bfb\u8005\u53ef\u4ee5\u6839\u636e\u5174\u8da3\u548c\u9700\u8981\u8fdb\u884c\u4e86\u89e3\u548c\u9009\u62e9\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubernetes_2","title":"Kubernetes \u5b89\u5168\u5de5\u5177\u2014\u2014\u5206\u7c7b","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u8bfb\u8005\u6d4f\u89c8\u76ee\u5f55\uff0c\u6211\u4eec\u628a\u8fd9\u4e9b\u5de5\u5177\u6309\u7167\u4e3b\u8981\u529f\u80fd\u548c\u8303\u56f4\u8fdb\u884c\u4e86\u5206\u7c7b\uff1a</p> <ul> <li>Kubernetes \u955c\u50cf\u626b\u63cf\u548c\u9759\u6001\u5206\u6790</li> <li>Kubernetes \u8fd0\u884c\u65f6\u5b89\u5168</li> <li>Kubernetes \u7f51\u7edc\u5b89\u5168</li> <li>\u955c\u50cf\u5206\u53d1\u548c\u673a\u5bc6\u7ba1\u7406</li> <li>Kubernetes \u5b89\u5168\u5ba1\u8ba1</li> <li>\u7aef\u5230\u7aef\u7684 Kubernetes \u5b89\u5168\u5546\u4e1a\u4ea7\u54c1</li> </ul> <p>\u6211\u4eec\u6700\u7231\u7684\u5bb9\u5668\u7f16\u6392\u5e73\u53f0\u5df2\u7ecf\u6210\u719f\uff0c\u4f1a\u6709\u8d8a\u6765\u8d8a\u591a\u7684 Kubernetes \u5b89\u5168\u5de5\u5177\u6d8c\u73b0\u51fa\u6765\uff0c\u5982\u679c\u8bfb\u8005\u53d1\u73b0\u6211\u4eec\u5217\u8868\u7684\u9519\u6f0f\uff0c\u8bf7\u5728 Twitter \u4e0a\u8054\u7cfb @sysdig\u3002</p> <p>\u8a00\u5f52\u6b63\u4f20\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubernetes_3","title":"Kubernetes \u955c\u50cf\u626b\u63cf","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#anchore","title":"Anchore","text":"<p>\u4e3b\u9875\uff1ahttps://anchore.com</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09\u4ee5\u53ca\u5546\u4e1a\u4ea7\u54c1</p> <p>Anchore \u5f15\u64ce\u4e0d\u4f46\u80fd\u591f\u5bf9\u5bb9\u5668\u955c\u50cf\u8fdb\u884c\u5206\u6790\uff0c\u66f4\u53ef\u4ee5\u4f7f\u7528\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u7b56\u7565\u6765\u5b8c\u6210\u81ea\u5b9a\u4e49\u7684\u5b89\u5168\u68c0\u67e5\u3002</p> <p>\u9664\u4e86\u5229\u7528 CVE \u6570\u636e\u5e93\u6765\u5bf9\u5df2\u77e5\u5a01\u80c1\u8fdb\u884c\u626b\u63cf\u4e4b\u5916\uff0cAnchore \u8fd8\u63d0\u4f9b\u4e86\u5f88\u591a\u9644\u52a0\u6807\u51c6\u53ef\u4ee5\u8fdb\u884c\u914d\u7f6e\uff0c\u6765\u4f5c\u4e3a\u626b\u63cf\u7b56\u7565\u7684\u4e00\u90e8\u5206\uff1aDockerfile \u68c0\u67e5\u3001\u51ed\u636e\u6cc4\u9732\u3001\u8bed\u8a00\u76f8\u5173\u5185\u5bb9\uff08mpm\u3001maven \u7b49\uff09\u3001\u8f6f\u4ef6\u8bb8\u53ef\u7b49\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#clair","title":"Clair","text":"<p>\u4e3b\u9875\uff1ahttps://coreos.com/clair</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Clair \u662f\u6700\u65e9\u5f00\u6e90\u7684\u955c\u50cf\u626b\u63cf\u9879\u76ee\u4e4b\u4e00\uff0c\u4e5f\u662f Quay \u955c\u50cf\u5e93\u7684\u5b89\u5168\u626b\u63cf\u5f15\u64ce\u3002Clair \u80fd\u4ece\u5f88\u591a\u6570\u636e\u6e90\u4e2d\u62c9\u53d6 CVE \u4fe1\u606f\uff0c\u5176\u4e2d\u5305\u62ec\u6765\u81ea Debian\u3001RedHat \u6216\u8005 Ubuntu \u5b89\u5168\u56e2\u961f\u7684\u7279\u5b9a\u53d1\u884c\u7248\u7684\u5a01\u80c1\u5217\u8868\u3002</p> <p>\u548c Anchore \u4e0d\u540c\u7684\u662f\uff0cClair \u4e13\u6ce8\u4e8e\u5a01\u80c1\u68c0\u6d4b\u548c CVE \u5339\u914d\u7684\u529f\u80fd\uff0c\u4e5f\u63d0\u4f9b\u4e86\u4e00\u5b9a\u7684\u6269\u5c55\u6027\uff0c\u8ba9\u7528\u6237\u901a\u8fc7\u5b9e\u73b0\u53ef\u63d2\u63a5\u9a71\u52a8\u6765\u5b9e\u73b0\u6269\u5c55\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#dagda","title":"Dagda","text":"<p>\u4e3b\u9875\uff1ahttps://github.com/eliasgranderubio/dagda</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Dagda \u4f1a\u9488\u5bf9\u5bb9\u5668\u955c\u50cf\u4e2d\u5df2\u77e5\u7684\u6f0f\u6d1e\u3001\u7279\u6d1b\u4f0a\u3001\u75c5\u6bd2\u3001\u6076\u610f\u8f6f\u4ef6\u548c\u5176\u5b83\u6076\u610f\u5a01\u80c1\u8fdb\u884c\u9759\u6001\u5206\u6790\u3002</p> <p>\u548c\u5176\u5b83\u7684 Kubernetes \u5b89\u5168\u5de5\u5177\u76f8\u6bd4\uff0cDagda \u6709\u4e24\u4e2a\u4e0e\u4f17\u4e0d\u540c\u4e4b\u5904\uff1a</p> <ul> <li>\u539f\u751f\u96c6\u6210\u4e86 ClamAV\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u626b\u63cf\u955c\u50cf\uff0c\u8fd8\u80fd\u7528\u4f5c\u9632\u6bd2\u8f6f\u4ef6\u3002</li> <li>Dagda \u8fd8\u63d0\u4f9b\u4e86\u8fd0\u884c\u65f6\u4fdd\u62a4\u529f\u80fd\u3002\u4ece Docker \u5b88\u62a4\u8fdb\u7a0b\u5b9e\u65f6\u6536\u96c6\u4e8b\u4ef6\uff0c\u5e76\u548c Falco \u96c6\u6210\u8bc6\u522b\u5b89\u5168\u4e8b\u4ef6\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubexray","title":"KubeXray","text":"<p>\u4e3b\u9875\uff1ahttps://github.com/jfrog/kubexray</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09\uff0c\u4f46\u662f\u9700\u8981\u4ece JFrog Xray\uff08\u5546\u4e1a\u4ea7\u54c1\uff09\u83b7\u53d6\u6570\u636e\u3002</p> <p>KubeXray \u76d1\u542c Kubernetes API Server \u7684\u4e8b\u4ef6\uff0c\u5e76\u5229\u7528 JFrog Xray\uff08\u5546\u4e1a\u4ea7\u54c1\uff09\u7684\u5143\u6570\u636e\u6765\u786e\u8ba4\u53ea\u6709\u7b26\u5408\u7b56\u7565\u8981\u6c42\u7684 Pod \u624d\u80fd\u8fd0\u884c\u3002</p> <p>KubeXray \u4e0d\u53ea\u4f1a\u5bf9\u65b0\u5efa\u6216\u8005\u66f4\u65b0\u7684\u5bb9\u5668\u90e8\u7f72\u8fdb\u884c\u5ba1\u8ba1\uff08Kuberentes \u51c6\u5165\u63a7\u5236\u5c31\u662f\u8fd9\u6837\uff09\uff0c\u8fd8\u80fd\u52a8\u6001\u7684\u6839\u636e\u65b0\u7684\u5b89\u5168\u7b56\u7565\u5bf9\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\u8fdb\u884c\u68c0\u67e5\uff0c\u5e76\u5220\u9664\u6709\u6f0f\u6d1e\u7684\u955c\u50cf\u6240\u5bf9\u5e94\u7684\u8d44\u6e90\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#snyk","title":"Snyk","text":"<p>\u4e3b\u9875\uff1ahttps://snyk.io/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09\u4ee5\u53ca\u5546\u4e1a\u4ea7\u54c1</p> <p>Snyk \u662f\u4e00\u4e2a\u7279\u522b\u7684\u6f0f\u6d1e\u68c0\u6d4b\u5de5\u5177\uff0c\u5176\u7279\u70b9\u662f\u7740\u773c\u4e8e\u5f00\u53d1\u5de5\u4f5c\u6d41\uff0c\u81ea\u79f0\u662f\u5f00\u53d1\u7b2c\u4e00\u7684\u89e3\u51b3\u65b9\u6848\u3002</p> <p>Snyk \u4f1a\u76f4\u63a5\u94fe\u63a5\u5230\u4ee3\u7801\u4ed3\u5e93\uff0c\u89e3\u6790\u9879\u76ee\u7ed3\u6784\uff0c\u5e76\u5206\u6790\u5f15\u5165\u7684\u4ee3\u7801\u53ca\u5176\u76f4\u63a5\u548c\u95f4\u63a5\u4f9d\u8d56\u3002Snyk \u652f\u6301\u5f88\u591a\u6d41\u884c\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u8fd8\u80fd\u53d1\u73b0\u6f5c\u5728\u7684\u8bb8\u53ef\u98ce\u9669\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#trivy","title":"Trivy","text":"<p>\u4e3b\u9875\uff1ahttps://github.com/knqyf263/trivy</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08AGPL\uff09</p> <p>Trivy \u662f\u4e2a\u7b80\u5355\u5168\u9762\u7684\u5bb9\u5668\u6f0f\u6d1e\u68c0\u6d4b\u5de5\u5177\uff0c\u80fd\u591f\u65b9\u4fbf\u7684\u548c CI/CD \u8fdb\u884c\u96c6\u6210\u3002\u5b83\u7684\u5b89\u88c5\u548c\u64cd\u4f5c\u90fd\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u65e0\u9700\u5b89\u88c5\u6570\u636e\u5e93\u548c\u5176\u5b83\u7684\u9644\u52a0\u5185\u5bb9\u3002</p> <p>Trivy \u7684\u7b80\u4fbf\u6027\u7684\u4e00\u4e2a\u7f3a\u70b9\u662f\u9700\u8981\u5b66\u4e60\u5982\u4f55\u89e3\u6790\u548c\u8f6c\u53d1\u5b83\u7684 JSON \u8f93\u51fa\uff0c\u8fd9\u624d\u80fd\u65b9\u4fbf\u5176\u5b83\u5de5\u5177\u8fdb\u884c\u8c03\u7528\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubernetes_4","title":"Kubernetes \u8fd0\u884c\u65f6\u5b89\u5168","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#falco","title":"Falco","text":"<p>\u4e3b\u9875\uff1ahttps://falco.org/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Falco \u662f\u4e00\u4e2a\u4e91\u539f\u751f\u7684\u8fd0\u884c\u65f6\u5b89\u5168\u5de5\u5177\uff0cCNCF \u6210\u5458\u9879\u76ee\u3002</p> <p>\u5229\u7528 Sysdig \u7684 Linux \u5185\u6838\u6307\u4ee4\u548c\u7cfb\u7edf\u8c03\u7528\u5206\u6790\uff0cFalco \u80fd\u591f\u6df1\u5165\u7406\u89e3\u7cfb\u7edf\u884c\u4e3a\u3002\u5b83\u7684\u8fd0\u884c\u65f6\u89c4\u5219\u5f15\u64ce\u80fd\u591f\u68c0\u6d4b\u5e94\u7528\u3001\u5bb9\u5668\u3001\u4e3b\u673a\u4ee5\u53ca Kubernetes \u7684\u53cd\u5e38\u884c\u4e3a\u3002</p> <p>\u51ed\u501f Falco\uff0c\u5728\u6bcf\u4e2a Kubernetes \u8282\u70b9\u90e8\u7f72\u4e00\u4e2a\u4ee3\u7406\uff0c\u65e0\u9700\u4fee\u6539\u6216\u8005\u6ce8\u5165\u7b2c\u4e09\u65b9\u4ee3\u7801\u6216\u8005\u52a0\u5165 Sidecar \u5bb9\u5668\uff0c\u5c31\u80fd\u591f\u5f97\u5230\u5b8c\u6574\u7684\u8fd0\u884c\u65f6\u53ef\u89c1\u6027\u4ee5\u53ca\u5a01\u80c1\u68c0\u6d4b\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#linux","title":"Linux \u8fd0\u884c\u65f6\u5b89\u5168\u6846\u67b6","text":"<p>\u539f\u751f\u7684 Linux \u6846\u67b6\u5176\u5b9e\u4e0d\u80fd\u7b97\u4f5c\u662f\u201cKubernetes \u5b89\u5168\u5de5\u5177\u201d\uff0c\u4f46\u5b83\u4eec\u7684\u8fd0\u884c\u65f6\u5b89\u5168\u4e0a\u4e0b\u6587\u662f\u53ef\u4ee5\u5305\u62ec\u5728 Kubernetes \u7684 Pod \u5b89\u5168\u7b56\u7565\u4e4b\u4e2d\u7684\uff08PSP\uff09\uff0c\u6240\u4ee5\u8fd8\u662f\u503c\u5f97\u4e00\u63d0\u3002</p> <p>AppArmor \u4e3a\u5bb9\u5668\u5185\u7684\u8fdb\u7a0b\u9644\u52a0\u4e00\u4e2a\u5b89\u5168\u6863\u6848\uff0c\u5176\u4e2d\u5b9a\u4e49\u4e86\u6587\u4ef6\u7cfb\u7edf\u3001\u6743\u9650\u3001\u7f51\u7edc\u8bbf\u95ee\u89c4\u5219\u3001\u5e93\u94fe\u63a5\u7b49\u3002\u8fd9\u662f\u4e00\u4e2a\u8bbf\u95ee\u63a7\u5236\u7cfb\u7edf\uff0c\u4f1a\u963b\u6b62\u672a\u7ecf\u6388\u6743\u7684\u52a8\u4f5c\u53d1\u751f\u3002</p> <p>SELinux \u662f\u4e00\u4e2a Linux \u5185\u6838\u5b89\u5168\u6a21\u5757\uff0c\u548c AppArmor \u6709\u70b9\u76f8\u4f3c\uff0c\u5e38\u5e38\u88ab\u62c9\u6765\u505a\u6bd4\u8f83\u3002SELinux \u66f4\u52a0\u5f3a\u5927\uff0c\u7c92\u5ea6\u66f4\u7ec6\uff0c\u4e5f\u6bd4 AppArmor \u66f4\u6709\u5f39\u6027\uff0c\u5b66\u4e60\u66f2\u7ebf\u66f4\u52a0\u9661\u5ced\u3001\u4e5f\u66f4\u52a0\u590d\u6742\u3002</p> <p>Seccomp \u548c seccomp-bpf \u5141\u8bb8\u5bf9\u7cfb\u7edf\u8c03\u7528\u8fdb\u884c\u8fc7\u6ee4\uff0c\u53ef\u4ee5\u9632\u6b62\u7528\u6237\u7684\u4e8c\u8fdb\u5236\u6587\u5bf9\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u4ef6\u6267\u884c\u901a\u5e38\u60c5\u51b5\u4e0b\u5e76\u4e0d\u9700\u8981\u7684\u5371\u9669\u64cd\u4f5c\u3002\u5b83\u548c Falco \u6709\u4e9b\u7c7b\u4f3c\uff0c\u4e0d\u8fc7 Seccomp \u6ca1\u6709\u4e3a\u5bb9\u5668\u63d0\u4f9b\u7279\u522b\u7684\u652f\u6301\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#sysdig","title":"\u5f00\u6e90\u7248 Sysdig","text":"<p>\u4e3b\u9875\uff1ahttps://www.sysdig.com/opensource</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Sysdig \u662f\u4e00\u4e2a\u5168\u9762\u7684 Linux \u7cfb\u7edf\uff08\u5728 Windows \u548c Mac OSX \u4e0b\u4e5f\u63d0\u4f9b\u4e86\u6709\u9650\u652f\u6301\uff09\u4e0b\u7684\u89c2\u5bdf\u3001\u6392\u9519\u548c\u8c03\u8bd5\u5de5\u5177\u3002\u53ef\u4ee5\u7528\u6765\u5bf9\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u4ee5\u53ca\u8fd0\u884c\u5176\u4e0a\u7684\u5bb9\u5668\u8fdb\u884c\u8be6\u7ec6\u7684\u76d1\u63a7\u548c\u89c2\u5bdf\u3002</p> <p>Sysdig \u8fd8\u5bf9\u5bb9\u5668\u8fd0\u884c\u65f6\u4ee5\u53ca Kubernetes \u5143\u6570\u636e\u63d0\u4f9b\u4e86\u539f\u751f\u652f\u6301\uff0c\u80fd\u5728\u6536\u96c6\u5230\u7684\u7cfb\u7edf\u6d3b\u52a8\u6570\u636e\u4e2d\u52a0\u5165\u989d\u5916\u7684\u7ef4\u5ea6\u548c\u6807\u7b7e\u3002Sysdig \u63d0\u4f9b\u4e86\u5f88\u591a\u65b9\u5f0f\u6765\u63a2\u7d22 Kubernetes \u96c6\u7fa4\uff1a\u53ef\u4ee5\u4f7f\u7528 kubectl capture \u521b\u5efa\u4e00\u4e2a\u662f\u68c0\u70b9\u7684\u5feb\u7167\uff0c\u6216\u8005\u4f7f\u7528 kubectl dig \u6765\u8fdb\u884c\u4ea4\u4e92\u8bbf\u95ee\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubernetes_5","title":"Kubernetes \u7f51\u7edc\u5b89\u5168","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#aporeto","title":"Aporeto","text":"<p>\u4e3b\u9875\uff1ahttps://www.aporeto.com/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>Aporeto \u63d0\u4f9b\u4e86\u201c\u4ece\u7f51\u7edc\u548c\u57fa\u7840\u8bbe\u65bd\u4e2d\u89e3\u8026\u7684\u5b89\u5168\u6027\u201d\u3002\u8fd9\u610f\u5473\u7740\u4f60\u7684 Kubernetes \u670d\u52a1\u4e0d\u53ea\u662f\u83b7\u5f97\u4e86\u4e00\u4e2a\u672c\u5730 ID\uff08\u4e5f\u5c31\u662f Kubernetes ServiceAccount\uff09\uff0c\u8fd8\u6709\u4e00\u4e2a\u5168\u5c40 ID/\u6307\u7eb9\uff0c\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u57fa\u7840\u548c\u4efb\u4f55\u5176\u5b83\u670d\u52a1\u8fdb\u884c\u5b89\u5168\u548c\u53cc\u5411\u6821\u9a8c\u7684\u901a\u4fe1\u3002</p> <p>Aporeto \u751f\u6210\u7684\u552f\u4e00\u8eab\u4efd\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u63d0\u4f9b\u7ed9 Kubernetes \u6216\u8005\u5bb9\u5668\uff0c\u8fd8\u80fd\u63d0\u4f9b\u7ed9\u4e3b\u673a\u3001\u4e91\u51fd\u6570\u548c\u7528\u6237\u4f7f\u7528\uff0c\u6839\u636e\u8fd9\u4e9b\u8eab\u4efd\u548c\u7f51\u7edc\u5b89\u5168\u7b56\u7565\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u9009\u62e9\u6027\u7684\u5bf9\u901a\u4fe1\u8fdb\u884c\u653e\u884c\u6216\u8005\u963b\u65ad\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#calico","title":"Calico","text":"<p>\u4e3b\u9875\uff1ahttps://www.projectcalico.org/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Calico \u7ecf\u5e38\u968f\u5bb9\u5668\u7f16\u6392\u7cfb\u7edf\u4e00\u540c\u90e8\u7f72\uff0c\u7528\u4e8e\u5b9e\u73b0\u5bb9\u5668\u4e4b\u95f4\u7684\u865a\u62df\u7f51\u7edc\u3002\u5728\u57fa\u7840\u7684\u7f51\u7edc\u529f\u80fd\u4e4b\u5916\uff0cCalico \u9879\u76ee\u8fd8\u5b9e\u73b0\u4e86 Kubernetes \u7f51\u7edc\u7b56\u7565\u89c4\u8303\uff0c\u4ee5\u53ca\u81ea\u5df1\u7684\u4e00\u5957\u5b89\u5168\u7b56\u7565\uff0c\u5176\u4e2d\u5305\u62ec\u4e86\u7aef\u70b9\u7684 ACL \u548c\u57fa\u4e8e\u6ce8\u89e3\u7684\u5165\u6808/\u51fa\u6808\u7f51\u7edc\u5b89\u5168\u89c4\u5219\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#cilium","title":"Cilium","text":"<p>\u4e3b\u9875\uff1ahttps://www.cilium.io/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Cilium \u63d0\u4f9b\u4e86\u5bb9\u5668\u9632\u706b\u5899\u4ee5\u53ca\u7f51\u7edc\u5b89\u5168\u529f\u80fd\uff0c\u9002\u7528\u4e8e Kubernetes \u548c\u5fae\u670d\u52a1\u8d1f\u8f7d\u3002Cilium \u4f9d\u8d56\u4e8e\u4e00\u79cd\u65b0\u7684 Linux \u5185\u6838\u6280\u672f\u2014\u2014BPF\uff0c\u7528\u5b83\u6765\u6267\u884c\u6838\u5fc3\u6570\u636e\u8def\u5f84\u7684\u8fc7\u6ee4\u3001\u76d1\u63a7\u3001\u91cd\u6574\u3001\u91cd\u5b9a\u5411\u7b49\u529f\u80fd\u3002</p> <p>Cilium \u80fd\u591f\u6839\u636e\u5bb9\u5668\u8eab\u4efd\uff08Docker \u6216\u8005 Kubernetes \u6807\u7b7e\u548c\u5143\u6570\u636e\uff09\u8fdb\u884c\u7f51\u7edc\u8bbf\u95ee\u7b56\u7565\u7684\u5b9a\u4e49\u3002Cilium \u8fd8\u80fd\u7406\u89e3\u5e76\u8fc7\u6ee4\u591a\u79cd HTTP\u3001gRPC \u8fd9\u6837\u7684 L7 \u534f\u8bae\uff08\u4f8b\u5982\u53ef\u4ee5\u8bbe\u7f6e\u4e24\u4e2a Kubernetes \u90e8\u7f72\u4e4b\u95f4 REST API \u7684\u8bbf\u95ee\u6027\uff09\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#istio","title":"Istio","text":"<p>\u4e3b\u9875\uff1ahttps://istio.io/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Istio \u662f\u5e7f\u4e3a\u4eba\u77e5\u7684\u670d\u52a1\u7f51\u683c\u4ea7\u54c1\uff0c\u5b83\u901a\u8fc7\u90e8\u7f72\u5e73\u53f0\u65e0\u5173\u7684\u63a7\u5236\u5e73\u9762\uff0c\u5e76\u628a\u6240\u6709\u6258\u7ba1\u670d\u52a1\u6d41\u91cf\u91cd\u65b0\u8def\u7531\u5230\u52a8\u6001\u914d\u7f6e\u7684 Envoy Proxy \u4e0a\u5b8c\u6210\u7f51\u683c\u529f\u80fd\u3002Istio \u5360\u636e\u4e86\u901a\u4fe1\u7684\u4e3b\u52a8\u6743\uff0c\u80fd\u591f\u4e3a\u5fae\u670d\u52a1\u548c\u5bb9\u5668\u5b9e\u73b0\u591a\u79cd\u7f51\u7edc\u5b89\u5168\u7b56\u7565\u3002</p> <p>Istio \u7f51\u7edc\u5b89\u5168\u80fd\u529b\u5305\u62ec\uff1a\u900f\u660e\u7684 TLS \u52a0\u5bc6\uff0c\u80fd\u591f\u81ea\u52a8\u628a\u5fae\u670d\u52a1\u901a\u4fe1\u5347\u7ea7\u4e3a HTTPS\uff0c\u5e76\u4e14\u5b83\u5177\u5907 RBAC \u4ee5\u53ca\u9274\u6743\u80fd\u529b\uff0c\u53ef\u4ee5\u5728\u96c6\u7fa4\u4e2d\u4e0d\u540c\u5de5\u4f5c\u8d1f\u8f7d\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u65f6\u8fdb\u884c\u63a5\u53d7\u6216\u8005\u62d2\u7edd\u7684\u51b3\u7b56\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#tigera","title":"Tigera","text":"<p>\u4e3b\u9875\uff1ahttps://www.tigera.io/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>Tigera \u7684\u201cKubernetes \u9632\u706b\u5899\u201d\u6280\u672f\uff0c\u4ee5\u96f6\u4fe1\u4efb\u7f51\u7edc\u7684\u7406\u5ff5\u6765\u52a0\u56fa Kubernetes \u7684\u7f51\u7edc\u5b89\u5168\u3002</p> <p>\u4e0e\u5176\u5b83 Kubernetes \u539f\u751f\u7f51\u7edc\u89e3\u51b3\u65b9\u6848\u7c7b\u4f3c\uff0cTigera \u5229\u7528 Kubernetes \u5143\u6570\u636e\u6765\u8bc6\u522b\u96c6\u7fa4\u4e2d\u7684\u4e0d\u540c\u670d\u52a1\u548c\u5b9e\u4f53\uff0c\u63d0\u4f9b\u8de8\u591a\u4e91\u6216\u6df7\u5408\u5355\u4f53-\u5bb9\u5668\u57fa\u7840\u8bbe\u65bd\u8fd0\u884c\u65f6\u68c0\u6d4b\u3001\u6301\u7eed\u5408\u89c4\u6027\u68c0\u67e5\u548c\u7f51\u7edc\u76d1\u63a7\u80fd\u529b\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#trireme","title":"Trireme","text":"<p>\u4e3b\u9875\uff1ahttps://www.aporeto.com/opensource/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Trireme \u662f\u4e00\u4e2a\u7b80\u5355\u76f4\u63a5\u7684 Kubernetes \u7f51\u7edc\u7b56\u7565\u89c4\u8303\u7684\u5b9e\u73b0\u3002\u5b83\u6709\u4e00\u4e2a\u4e0e\u4f17\u4e0d\u540c\u7684\u7279\u70b9\uff1a\u65e0\u9700\u4e00\u4e2a\u4e2d\u5fc3\u63a7\u5236\u5e73\u9762\u6765\u5bf9\u7f51\u683c\u8fdb\u884c\u534f\u8c03\uff0c\u56e0\u6b64\u8fd9\u4e2a\u65b9\u6848\u5177\u5907\u5f88\u597d\u7684\u4f38\u7f29\u80fd\u529b\u3002Trireme \u901a\u8fc7\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u5b89\u88c5\u4ee3\u7406\u7684\u65b9\u5f0f\u6765\u5f71\u54cd\u4e3b\u673a\u7684 TCP/IP \u7f51\u7edc\u6808\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#_1","title":"\u955c\u50cf\u5206\u53d1\u548c\u673a\u5bc6\u7ba1\u7406","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#grafeas","title":"Grafeas","text":"<p>\u4e3b\u9875\uff1ahttps://grafeas.io/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Grafeas \u662f\u4e00\u4e2a\u5f00\u6e90\u7684 API\uff0c\u7528\u4e8e\u5bf9\u8f6f\u4ef6\u4f9b\u5e94\u94fe\u8fdb\u884c\u5ba1\u8ba1\u548c\u76d1\u7ba1\u3002\u6cdb\u6cdb\u800c\u8bba\uff0cGrafeas \u662f\u4e00\u4e2a\u5143\u6570\u636e\u548c\u5ba1\u8ba1\u65e5\u5fd7\u6536\u96c6\u5de5\u5177\uff0c\u53ef\u4ee5\u7528\u6765\u8ddf\u8e2a\u7ec4\u7ec7\u4e2d\u7684\u5b89\u5168\u5408\u89c4\u5b9e\u8df5\u3002</p> <p>\u8fd9\u79cd\u96c6\u4e2d\u8d77\u6765\u7684\u4fe1\u606f\u53ef\u4ee5\u5e2e\u52a9\u7528\u6237\u56de\u7b54\u7c7b\u4f3c\u8fd9\u6837\u7684\u5b89\u5168\u95ee\u9898\uff1a</p> <ul> <li>\u67d0\u4e2a\u5bb9\u5668\u662f\u8c01\u6784\u5efa\u5e76\u7b7e\u540d\u7684\uff1f</li> <li>\u6240\u6709\u7684\u5b89\u5168\u626b\u63cf\u548c\u7b56\u7565\u68c0\u67e5\u90fd\u901a\u8fc7\u4e86\u4e48\uff1f\u4ec0\u4e48\u65f6\u5019\u7684\u4e8b\uff1f\u8fd9\u4e9b\u5de5\u5177\u90fd\u8f93\u51fa\u4e86\u4ec0\u4e48\u4fe1\u606f\uff1f</li> <li>\u8c01\u628a\u5b83\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u7684\uff1f\u7528\u4ec0\u4e48\u53c2\u6570\u90e8\u7f72\u7684\uff1f</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#portieris","title":"Portieris","text":"<p>\u4e3b\u9875\uff1ahttps://github.com/IBM/portieris</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Portieris \u662f\u4e00\u4e2a Kubernetes \u51c6\u5165\u63a7\u5236\u5668\uff0c\u53ef\u4ee5\u7528\u4e8e\u5185\u5bb9\u4fe1\u4efb\u3002\u5b83\u4f9d\u8d56 Notary \u670d\u52a1\u5668\u4ee5\u6b64\u4f5c\u4e3a\u4fe1\u4efb\u6e90\u5934\u5e76\u7b7e\u7f72\u5de5\u4ef6\u3002</p> <p>\u4e00\u65e6\u4fee\u6539\u4e86 Kubernetes \u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0cPortieris \u5c31\u4f1a\u4e3a\u8bf7\u6c42\u7684\u5bb9\u5668\u955c\u50cf\u62c9\u53d6\u7b7e\u540d\u4fe1\u606f\u548c\u5185\u5bb9\u4fe1\u4efb\u7b56\u7565\uff0c\u5982\u679c\u9700\u8981\u7684\u8bdd\uff0c\u8fd8\u53ef\u4ee5\u4fee\u6539 API \u5bf9\u8c61\u7684\u5185\u5bb9\uff0c\u5e76\u4ee5\u7b7e\u7f72\u7248\u672c\u7684\u955c\u50cf\u6765\u8fdb\u884c\u66ff\u6362\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#vault","title":"Vault","text":"<p>\u4e3b\u9875\uff1ahttps://www.vaultproject.io/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08MPL\uff09</p> <p>Vault \u662f\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u673a\u5bc6\uff08\u4f8b\u5982\u5bc6\u7801\u3001Token\u3001Secret \u7b49\uff09\u7684\u9ad8\u5ea6\u5b89\u5168\u7684\u5b58\u50a8\u65b9\u6848\uff0c\u5b83\u652f\u6301\u5f88\u591a\u9ad8\u7ea7\u529f\u80fd\uff0c\u4f8b\u5982\u4e34\u65f6\u5b89\u5168\u4ee4\u724c\u6216\u8005\u53d7\u7f16\u6392\u7684\u5bc6\u94a5\u7ffb\u8f6c\u3002</p> <p>\u53ef\u4ee5\u7528 Helm \u5728 Kubernetes \u96c6\u7fa4\u4e2d\u90e8\u7f72 Vault \u7684 Chart\uff0c\u4f7f\u7528 Consul \u4f5c\u4e3a\u5b58\u50a8\u540e\u7aef\u3002\u5b83\u652f\u6301 Kubernetes \u7684\u672c\u5730\u8d44\u6e90\uff0c\u6bd4\u5982\u8bf4 ServiceAccount Token\uff0c\u751a\u81f3\u8fd8\u80fd\u4f5c\u4e3a\u7f3a\u7701\u7684 Kubernetes Secret \u4ed3\u5e93\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubernetes_6","title":"Kubernetes \u5b89\u5168\u5ba1\u8ba1","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kube-bench","title":"Kube-bench","text":"<p>\u4e3b\u9875\uff1ahttps://github.com/aquasecurity/kube-bench</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Kube-Bench \u662f\u4e00\u4e2a Go \u5e94\u7528\uff0c\u5b83\u4f1a\u8fd0\u884c CIS Kubernetes \u57fa\u51c6\u6d4b\u8bd5\u4e2d\u7684\u6d4b\u8bd5\uff0c\u6765\u68c0\u67e5 Kubernetes \u90e8\u7f72\u7684\u5b89\u5168\u7a0b\u5ea6\u3002</p> <p>Kube-Bench \u4f1a\u626b\u63cf\u4f60\u7684 Kubernetes \u96c6\u7fa4\u7ec4\u4ef6\uff08ETCD\u3001API\u3001Controller Manager \u7b49\uff09\u3001\u654f\u611f\u6587\u4ef6\u6388\u6743\u3001\u4e0d\u5b89\u5168\u7684\u5e10\u53f7\u6216\u8005\u5f00\u653e\u7aef\u53e3\u3001\u8d44\u6e90\u914d\u989d\u3001API \u901f\u7387\u9650\u5236\u7b49\u65b9\u9762\u67e5\u627e\u4e0d\u5b89\u5168\u7684\u914d\u7f6e\u53c2\u6570\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kube-hunter","title":"Kube-Hunter","text":"<p>\u4e3b\u9875\uff1ahttps://github.com/aquasecurity/kube-hunter</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Kube-Hunter \u5728 Kubernetes \u96c6\u7fa4\u4e2d\u67e5\u627e\u5b89\u5168\u5f31\u70b9\uff08\u4f8b\u5982\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6216\u8005\u4fe1\u606f\u6cc4\u9732\uff09\u3002\u53ef\u4ee5\u628a Kube-Hunter \u4f5c\u4e3a\u4e00\u4e2a\u8fdc\u7a0b\u626b\u63cf\u5668\uff0c\u6765\u4ece\u5916\u90e8\u653b\u51fb\u8005\u7684\u89c6\u89d2\u6765\u89c2\u5bdf\u4f60\u7684\u96c6\u7fa4\uff1b\u4e5f\u53ef\u4ee5\u7528 Pod \u7684\u65b9\u5f0f\u6765\u8fd0\u884c\u3002</p> <p>Kube-Hunter \u6709\u4e2a\u7279\u522b\u4e4b\u5904\u5c31\u662f\u201cactive hunting\u201d\uff0c\u5b83\u4e0d\u4ec5\u4f1a\u62a5\u544a\u95ee\u9898\uff0c\u800c\u4e14\u8fd8\u4f1a\u5c1d\u8bd5\u5229\u7528\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u53d1\u73b0\u7684\u95ee\u9898\uff0c\u8fd9\u79cd\u64cd\u4f5c\u53ef\u80fd\u5bf9\u96c6\u7fa4\u6709\u5bb3\uff0c\u5e94\u5c0f\u5fc3\u4f7f\u7528\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubeaudit","title":"Kubeaudit","text":"<p>\u4e3b\u9875\uff1ahttps://github.com/Shopify/kubeaudit</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08MIT\uff09</p> <p>Kubeaudit \u662f\u4e00\u4e2a\u514d\u8d39\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7531 Shopify \u63d0\u4f9b\uff0c\u7528\u4e8e\u5bf9 Kubernetes \u7684\u914d\u7f6e\u8fdb\u884c\u591a\u65b9\u9762\u7684\u5ba1\u8ba1\u3002\u5176\u4e2d\u5305\u542b\u65e0\u9650\u5236\u7684\u955c\u50cf\u4f7f\u7528\u3001\u4ee5 Root \u8eab\u4efd\u8fd0\u884c\u3001\u7279\u6743\u8fd0\u884c\u4ee5\u53ca\u7f3a\u7701\u7684 ServiceAccount \u7b49\u3002</p> <p>Kubeaudit \u7531\u5f88\u591a\u5176\u5b83\u6709\u8da3\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u626b\u63cf\u5904\u7406\u672c\u5730\u7684 YAML \u6765\u67e5\u627e\u914d\u7f6e\u7f3a\u9677\u548c\u5b89\u5168\u95ee\u9898\uff0c\u5e76\u4e14\u81ea\u52a8\u4fee\u590d\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubesec","title":"Kubesec","text":"<p>\u4e3b\u9875\uff1ahttps://kubesec.io/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>Kubesec \u662f\u4e00\u4e2a\u6bd4\u8f83\u7279\u522b\u7684 Kubernetes \u5b89\u5168\u5de5\u5177\uff0c\u5b83\u4f1a\u76f4\u63a5\u5bf9 YAML \u8fdb\u884c\u626b\u63cf\uff0c\u67e5\u627e\u5176\u4e2d\u63cf\u8ff0\u7684 Kubernetes \u8d44\u6e90\u662f\u5426\u4f7f\u7528\u4e86\u8f83\u5f31\u7684\u5b89\u5168\u53c2\u6570\u3002</p> <p>\u4f8b\u5982\u5b83\u53ef\u4ee5\u68c0\u6d4b\u5230 Pod \u7684\u8fc7\u9ad8\u6743\u9650\uff0c\u4f7f\u7528 root \u4f5c\u4e3a\u9ed8\u8ba4\u7528\u6237\u3001\u9644\u52a0\u5230\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u3001\u5371\u9669\u7684\u52a0\u8f7d\u64cd\u4f5c\uff08\u4f8b\u5982 <code>/proc</code> \u6216\u8005 Docker Socket\uff09\u3002\u5b83\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5728\u7ebf\u7684\u6f14\u793a\uff0c\u53ef\u4ee5\u5728\u4e0a\u9762\u63d0\u4ea4 YAML \u4f53\u9a8c\u8fd9\u4e00\u529f\u80fd\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#open-policy-agent","title":"Open Policy Agent","text":"<p>\u4e3b\u9875\uff1ahttps://www.openpolicyagent.org/</p> <p>\u8bb8\u53ef\uff1a\u514d\u8d39\uff08Apache\uff09</p> <p>OPA \u7684\u76ee\u6807\u662f\u628a\u5b89\u5168\u7b56\u7565\u548c\u6700\u4f73\u5b9e\u8df5\u4ece\u7279\u5b9a\u7684\u8fd0\u884c\u65f6\u5e73\u53f0\uff08Docker\u3001Kubernetes\u3001Mesosphere\u3001Openshift \u7b49\uff09\u4e2d\u89e3\u8026\u51fa\u6765\u3002</p> <p>\u4f8b\u5982\u53ef\u4ee5\u628a OPA \u4f5c\u4e3a Kubernetes \u51c6\u5165\u63a7\u5236\u5668\u540e\u7aef\u8fdb\u884c\u90e8\u7f72\uff0c\u8fd9\u6837 OPA \u4ee3\u7406\u5c31\u53ef\u4ee5\u63a5\u7ba1\u5b89\u5168\u51b3\u7b56\uff0c\u6839\u636e\u81ea\u5b9a\u4e49\u5b89\u5168\u7ea6\u675f\uff0c\u5bf9\u8bf7\u6c42\u8fdb\u884c\u6821\u9a8c\u3001\u62d2\u7edd\u751a\u81f3\u662f\u5c31\u5730\u4fee\u6539\u3002OPA \u4f7f\u7528\u4e00\u79cd\u81ea\u6709\u7684 DSL\uff08Rego\uff09\u7f16\u5199\u7b56\u7565\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#kubernetes_7","title":"\u7aef\u5230\u7aef\u7684 Kubernetes \u5b89\u5168\u5546\u4e1a\u4ea7\u54c1","text":"<p>\u6211\u4eec\u51b3\u5b9a\u521b\u5efa\u4e00\u4e2a\u5355\u72ec\u7684\u5206\u7c7b\u6765\u4ecb\u7ecd\u5546\u4e1a\u4ea7\u54c1\uff0c\u8fd9\u662f\u56e0\u4e3a\u5b83\u4eec\u7ecf\u5e38\u4f1a\u8986\u76d6\u5b89\u5168\u5de5\u4f5c\u7684\u591a\u4e2a\u65b9\u9762\u3002\u4e0b\u8868\u505a\u4e86\u4e00\u4e9b\u7b80\u8981\u5bf9\u6bd4\u3002</p> \u955c\u50cf\u626b\u63cf \u5bb9\u5668\u5408\u89c4 \u8fd0\u884c\u65f6\u5b89\u5168 \u7f51\u7edc\u5b89\u5168 Forensics Kubernetes \u5ba1\u8ba1 AquaSec Y Y Y Y Y Y Capsule8 Y Y Y Y Caviring Y Y Y Y Google SCC Y Y \u63d2\u4ef6 Y Layered Insight Y Y Y Y NeuVector Y Y Y Y Y Y StackRox Y Y Y Y Y Y Sysdig Secure Y Y Y Y Y Y Tenable Container security Y Y Y Twistlock Y Y Y Y Y Y"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#aqua-security","title":"Aqua Security","text":"<p>\u4e3b\u9875\uff1ahttps://www.aquasec.com/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>AquaSec \u662f\u4e00\u4e2a\u9488\u5bf9\u5bb9\u5668\u548c\u4e91\u8d1f\u8f7d\u7684\u5546\u4e1a\u5b89\u5168\u5de5\u5177\uff0c\u5305\u62ec\uff1a</p> <ul> <li>\u80fd\u591f\u96c6\u6210\u5230\u5bb9\u5668\u4ed3\u5e93\u6216\u8005 CICD \u7684\u955c\u50cf\u626b\u63cf\u3002</li> <li>\u80fd\u591f\u68c0\u6d4b\u5bb9\u5668\u4fee\u6539\u6216\u5f02\u5e38\u884c\u4e3a\u7684\u8fd0\u884c\u65f6\u4fdd\u62a4\u3002</li> <li>\u5bb9\u5668\u539f\u751f\u7684\u5e94\u7528\u7a0b\u5e8f\u9632\u706b\u5899\u3002</li> <li>\u9488\u5bf9\u4e91\u670d\u52a1\u7684 Serverless \u5b89\u5168\u3002</li> <li>\u96c6\u6210\u5230\u4e8b\u4ef6\u65e5\u5fd7\u7684\u5408\u89c4\u548c\u5ba1\u8ba1\u62a5\u544a\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#capsule-8","title":"Capsule 8","text":"<p>\u4e3b\u9875\uff1ahttps://capsule8.com/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>Capsule 8 \u5728\u4f60\u7684\u81ea\u5efa\u6216\u4e91\u7aef Kubernetes \u96c6\u7fa4\u4e2d\u90e8\u7f72\u63a2\u9488\uff0c\u4ece\u800c\u96c6\u6210\u5230\u57fa\u7840\u8bbe\u65bd\u4e4b\u4e2d\u3002\u8fd9\u4e2a\u63a2\u9488\u4f1a\u641c\u96c6\u4e3b\u673a\u548c\u7f51\u7edc\u6307\u6807\uff0c\u901a\u8fc7\u8fd9\u4e9b\u6570\u636e\u548c\u653b\u51fb\u884c\u4e3a\u6a21\u5f0f\u8fdb\u884c\u5339\u914d\u3002</p> <p>Capsule 8 \u56e2\u961f\u8d1f\u8d23\u5728 0 day \u653b\u51fb\u5230\u8fbe\u4f60\u7684\u96c6\u7fa4\u4e4b\u524d\u8fdb\u884c\u68c0\u6d4b\u548c\u963b\u6b62\u3002\u4ed6\u4eec\u7684\u5b89\u5168\u56e2\u961f\u80fd\u591f\u5c06\u5b89\u5168\u89c4\u5219\u63a8\u9001\u5230\u63a2\u9488\u4e0a\uff0c\u4ece\u800c\u963b\u6b62\u8f6f\u4ef6\u5a01\u80c1\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#cavirin","title":"Cavirin","text":"<p>\u4e3b\u9875\uff1ahttps://www.cavirin.com/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>Cavirin \u4e13\u6ce8\u4e8e\u4e3a\u4e0d\u540c\u7684\u5b89\u5168\u6807\u51c6\u5316\u673a\u6784\u63d0\u4f9b\u4f01\u4e1a\u7248\u672c\u3002\u5b83\u7684\u955c\u50cf\u626b\u63cf\u529f\u80fd\uff0c\u8fd8\u53ef\u4ee5\u4e0e CI/CD \u7ba1\u9053\u8fdb\u884c\u96c6\u6210\uff0c\u5728\u5c06\u4e0d\u5408\u89c4\u7684\u955c\u50cf\u63a8\u9001\u5230\u955c\u50cf\u5e93\u4e4b\u524d\u963b\u6b62\u5b83\u4eec\u3002</p> <p>Cavirin \u5b89\u5168\u5957\u4ef6\u4f7f\u7528\u673a\u5668\u5b66\u4e60\u4e3a\u7f51\u7edc\u5b89\u5168\u72b6\u6001\u63d0\u4f9b\u7c7b\u4f3c\u4fe1\u7528\u7684\u8bc4\u5206\uff0c\u63d0\u4f9b\u8865\u6551\u6280\u5de7\uff0c\u4ee5\u6539\u5584\u5b89\u5168\u72b6\u51b5\u6216\u5b89\u5168\u6807\u51c6\u5408\u89c4\u6027\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#google-cloud-security-command-center","title":"Google Cloud Security Command Center","text":"<p>\u4e3b\u9875\uff1ahttps://cloud.google.com/security-command-center/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>Google SCC \u80fd\u5e2e\u5b89\u5168\u56e2\u961f\u6536\u96c6\u6570\u636e\u3001\u8bc6\u522b\u5a01\u80c1\u5e76\u5728\u4e1a\u52a1\u635f\u5931\u4e4b\u524d\u5bf9\u5176\u91c7\u53d6\u884c\u52a8\u3002</p> <p>SCC \u662f\u4e00\u4e2a\u7edf\u4e00\u7684\u63a7\u5236\u9762\u677f\uff0c\u5728\u8fd9\u91cc\u53ef\u4ee5\u96c6\u6210\u4e0d\u540c\u7684\u5b89\u5168\u62a5\u544a\u3001\u8d44\u4ea7\u6e05\u5355\u4ee5\u53ca\u7b2c\u4e09\u65b9\u5b89\u5168\u5f15\u64ce\u3002</p> <p>SCC \u63d0\u4f9b\u7684 API \u53ef\u4ee5\u96c6\u6210\u6765\u81ea\u4e0d\u540c\u6765\u6e90\uff08Sysdig Secure \u6216\u8005 Falco\uff09\u7684 Kubernetes \u5b89\u5168\u4e8b\u4ef6\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#layered-insight-qualys","title":"Layered Insight (Qualys)","text":"<p>\u4e3b\u9875\uff1ahttps://layeredinsight.com/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>Layered Insight\uff08\u73b0\u5728\u662f Qualys \u7684\u4e00\u90e8\u5206\uff09\u662f\u56f4\u7ed5\u201c\u5d4c\u5165\u5f0f\u5b89\u5168\u6027\u201d\u7684\u6982\u5ff5\u8bbe\u8ba1\u7684\u3002\u5b83\u7528\u9759\u6001\u5206\u6790\u6280\u672f\u626b\u63cf\u539f\u6709\u955c\u50cf\u6f0f\u6d1e\u5e76\u901a\u8fc7 CVE \u68c0\u67e5\u540e\uff0cLayered Insight \u4f1a\u6ce8\u5165\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4ee3\u7406\uff0c\u751f\u6210\u4e00\u4e2a\u4e2d\u95f4\u955c\u50cf\u3002</p> <p>\u8fd9\u4e2a\u4e8c\u8fdb\u5236\u4ee3\u7406\u5305\u62ec\u5bb9\u5668\u7f51\u7edc\u6d41\u91cf\u3001I/O \u6d41\u4ee5\u53ca\u5e94\u7528\u7a0b\u5e8f\u6d3b\u52a8\u7684\u8fd0\u884c\u65f6\u5b89\u5168\u6027\u63a2\u6d4b\uff0c\u8fd8\u5305\u62ec\u57fa\u7840\u67b6\u6784\u8fd0\u8425\u5546\u6216 DevOps \u56e2\u961f\u63d0\u4f9b\u7684\u81ea\u5b9a\u4e49\u5b89\u5168\u68c0\u67e5\u5185\u5bb9\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#neuverctor","title":"Neuverctor","text":"<p>\u4e3b\u9875\uff1ahttps://neuvector.com/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>NeuVector \u901a\u8fc7\u5206\u6790\u7f51\u7edc\u6d3b\u52a8\u548c\u5e94\u7528\u7a0b\u5e8f\u884c\u4e3a\uff0c\u4e3a\u6bcf\u4e2a\u6620\u50cf\u521b\u5efa\u5b9a\u5236\u7684\u5b89\u5168\u914d\u7f6e\u6587\u4ef6\uff0c\u6765\u6267\u884c\u5bb9\u5668\u5b89\u5168\u57fa\u51c6\u548c\u8fd0\u884c\u65f6\u4fdd\u62a4\u3002\u5b83\u8fd8\u53ef\u4ee5\u4e3b\u52a8\u963b\u6b62\u5a01\u80c1\uff0c\u901a\u8fc7\u4fee\u6539\u672c\u5730\u7f51\u7edc\u9632\u706b\u5899\u6765\u9694\u79bb\u53ef\u7591\u6d3b\u52a8\u3002</p> <p>NeuVector \u7684\u7f51\u7edc\u96c6\u6210\uff0c\u6807\u8bb0\u4e3a\u201c\u5b89\u5168\u7f51\u683c\u201d\uff0c\u80fd\u591f\u5bf9\u670d\u52a1\u7f51\u683c\u4e2d\u7684\u6240\u6709\u7f51\u7edc\u8fde\u63a5\u6267\u884c\u6570\u636e\u5305\u6df1\u5ea6\u68c0\u67e5\u548c L7 \u8fc7\u6ee4\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#stackrox","title":"StackRox","text":"<p>\u4e3b\u9875\uff1ahttps://www.stackrox.com/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>StackRox \u5bb9\u5668\u5b89\u5168\u5e73\u53f0\u7684\u8bbe\u8ba1\u76ee\u6807\u662f\u6db5\u76d6 Kubernetes \u96c6\u7fa4\u4e2d\u5e94\u7528\u7a0b\u5e8f\u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u3002\u4e0e\u6b64\u5217\u8868\u4e2d\u7684\u5176\u5b83\u5546\u4e1a\u65b9\u6848\u4e00\u6837\uff0c\u5b83\u4f1a\u6839\u636e\u89c2\u5bdf\u5230\u7684\u5bb9\u5668\u884c\u4e3a\u751f\u6210\u8fd0\u884c\u65f6\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u4f1a\u5728\u53d1\u73b0\u5f02\u5e38\u60c5\u51b5\u65f6\u81ea\u52a8\u53d1\u51fa\u8b66\u62a5\u3002</p> <p>StackRox \u5e73\u53f0\u8fd8\u5c06\u4f7f\u7528 CIS Kubernetes \u57fa\u51c6\u4ee5\u53ca\u5176\u4ed6\u5bb9\u5668\u5408\u89c4\u6027\u57fa\u51c6\uff0c\u5bf9 Kubernetes \u914d\u7f6e\u8fdb\u884c\u8bc4\u4f30\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#sysdig-secure","title":"Sysdig Secure","text":"<p>\u4e3b\u9875\uff1ahttps://sysdig.com/products/secure/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>Sysdig Secure \u5728\u6574\u4e2a\u5bb9\u5668\u751f\u547d\u5468\u671f\u5185\u5bf9\u4e91\u539f\u751f\u5e94\u7528\u7a0b\u5e8f\u5b9e\u65bd\u4fdd\u62a4\u3002\u5b83\u628a\u955c\u50cf\u626b\u63cf\uff0c\u8fd0\u884c\u65f6\u4fdd\u62a4\u548c\u53d6\u8bc1\u7ed3\u5408\u5728\u4e00\u8d77\uff0c\u4ee5\u8bc6\u522b\u6f0f\u6d1e\u3001\u963b\u6b62\u5a01\u80c1\uff0c\u6267\u884c\u5408\u89c4\u6027\u5e76\u5bf9\u5fae\u670d\u52a1\u4e2d\u7684\u6d3b\u52a8\u8fdb\u884c\u5ba1\u8ba1\u3002</p> <p>\u4e00\u4e9b\u91cd\u8981\u529f\u80fd\u5305\u62ec\uff1a</p> <p>Scanning images in a registry or as part of the CI/CD process to uncover vulnerable libraries, packages, and configuration Run-time detection to protect containers in production with behavioral profiles Record pre- and post-attack activity through system calls with microsecond level granularity 250+ out of the box compliance checks to keep your configuration secure</p> <ul> <li>\u5728\u955c\u50cf\u5e93\u4e2d\uff0c\u6216\u4f5c\u4e3a CI/CD \u8fc7\u7a0b\u7684\u4e00\u90e8\u5206\u5bf9\u955c\u50cf\u8fdb\u884c\u626b\u63cf\uff0c\u4ee5\u53d1\u73b0\u6613\u53d7\u653b\u51fb\u7684\u5e93\u3001\u5305\u548c\u914d\u7f6e\u5185\u5bb9\u3002</li> <li>\u8fd0\u884c\u65f6\u68c0\u6d4b\uff0c\u4f7f\u7528\u884c\u4e3a\u914d\u7f6e\u6587\u4ef6\u6765\u4fdd\u62a4\u751f\u4ea7\u4e2d\u7684\u5bb9\u5668\u3002</li> <li>\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\uff0c\u5728\u6beb\u79d2\u4e00\u7ea7\u5bf9\u653b\u51fb\u524d\u540e\u7684\u884c\u4e3a\u8fdb\u884c\u8bb0\u5f55\u3002</li> <li>\u5f00\u7bb1\u5373\u7528\u7684\u8d85\u8fc7 250 \u9879\u5408\u89c4\u6027\u68c0\u67e5\uff0c\u5e2e\u52a9\u7528\u6237\u4fdd\u6301\u914d\u7f6e\u5b89\u5168\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#tenable-container-security","title":"Tenable Container Security","text":"<p>\u4e3b\u9875\uff1ahttps://www.tenable.com/products/tenable-io/container-security</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>\u5728\u5bb9\u5668\u95ee\u4e16\u4e4b\u524d\uff0cTenable \u5728\u5b89\u5168\u884c\u4e1a\u5e7f\u4e3a\u4eba\u77e5\uff0c\u5b83\u7684 Nusus \u662f\u4e00\u6b3e\u6d41\u884c\u7684\u6f0f\u6d1e\u626b\u63cf\u548c\u5b89\u5168\u5ba1\u8ba1\u5de5\u5177\u3002</p> <p>Tenable Container security \u5229\u7528\u4ed6\u4eec\u5728\u8ba1\u7b97\u673a\u5b89\u5168\u9886\u57df\u7684\u7ecf\u9a8c\uff0c\u5c06 CI/CD \u4e0e\u6f0f\u6d1e\u6570\u636e\u5e93\u3001\u4e13\u95e8\u7684\u6076\u610f\u8f6f\u4ef6\u68c0\u6d4b\u5f15\u64ce\u548c\u5b89\u5168\u5a01\u80c1\u8865\u6551\u5efa\u8bae\u96c6\u6210\u5728\u4e00\u8d77\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#twistlock-palo-alto-networks","title":"Twistlock (Palo Alto Networks)","text":"<p>\u4e3b\u9875\uff1ahttps://www.twistlock.com/</p> <p>\u8bb8\u53ef\uff1a\u5546\u4e1a</p> <p>Twistlock \u81ea\u8be9\u4e3a\u4e91\u4f18\u5148\u7684\u3001\u5bb9\u5668\u4f18\u5148\u7684\u5e73\u53f0\uff0c\u63d0\u4f9b\u4e0e\u4e91\u63d0\u4f9b\u5546\uff08AWS\uff0cAzure\uff0cGCP\uff09\u3001\u5bb9\u5668\u7f16\u6392\u5668\uff08Kubernetes\uff0cMesospehere\uff0cOpenshift\uff0cDocker\uff09\uff0cServerless \u8fd0\u884c\u65f6\uff0c\u7f51\u683c\u6846\u67b6\u548c CI/CD \u5de5\u5177\u7684\u7279\u5b9a\u96c6\u6210\u3002</p> <p>\u9664\u4e86\u901a\u5e38\u7684\u5bb9\u5668\u5b89\u5168\u4f01\u4e1a\u529f\u80fd\uff0c\u5982 CI/CD \u7ba1\u9053\u96c6\u6210\u6216\u955c\u50cf\u626b\u63cf\uff0cTwistlock \u4f7f\u7528\u673a\u5668\u5b66\u4e60\u6280\u672f\u6765\u751f\u6210\u884c\u4e3a\u6a21\u5f0f\u548c\u5bb9\u5668\u611f\u77e5\u7f51\u7edc\u89c4\u5219\u3002</p> <p>Twistlock \u88ab Palo Alto Networks \u6536\u8d2d\uff0cPalo Alto Networks \u4e5f\u662f Evident.io \u548c Redlock \u5b89\u5168\u89e3\u51b3\u65b9\u6848\u7684\u6240\u6709\u8005\u3002\u671f\u5f85\u8fd9\u4e09\u4e2a\u5e73\u53f0\u5408\u800c\u4e3a\u4e00\uff0c\u6574\u5408\u5230 Palo Alto \u7684 PRISMA \u4e2d\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li> <p>https://zhuanlan.zhihu.com/p/446569931</p> </li> <li> <p>https://www.redhat.com/en/resources/kubernetes-adoption-security-market-trends-2021-overview</p> </li> <li> <p>https://kubernetes.io/docs/concepts/policy/pod-security-policy/</p> </li> <li>https://github.com/stackrox/kube-linter</li> <li> <p>https://github.com/aquasecurity/kube-hunter</p> </li> <li> <p>https://cloud.tencent.com/developer/article/1468809?from=article.detail.1741460</p> </li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/","title":"kubernetes\u5b89\u5168\u4e4bPolaris","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#kubernetespolaris","title":"kubernetes\u5b89\u5168\u4e4bPolaris","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#polaris","title":"\u4e00 polaris\u7b80\u4ecb","text":"<p>Fairwinds' Polaris \u8ba9\u60a8\u7684\u96c6\u7fa4\u987a\u5229\u822a\u884c\u3002\u5b83\u8fd0\u884c\u5404\u79cd\u68c0\u67e5\u4ee5\u786e\u4fdd\u4f7f\u7528\u6700\u4f73\u5b9e\u8df5\u914d\u7f6e Kubernetes pod \u548c\u63a7\u5236\u5668\uff0c\u4ece\u800c\u5e2e\u52a9\u60a8\u907f\u514d\u5c06\u6765\u51fa\u73b0\u95ee\u9898\u3002</p> <p>Polaris \u53ef\u4ee5\u5728\u4e09\u79cd\u4e0d\u540c\u7684\u6a21\u5f0f\u4e0b\u8fd0\u884c\uff1a</p> <ul> <li> <p>\u4f5c\u4e3a\u4eea\u8868\u677f\uff0c\u60a8\u53ef\u4ee5\u5ba1\u6838\u96c6\u7fa4\u5185\u8fd0\u884c\u7684\u5185\u5bb9\u3002</p> </li> <li> <p>\u4f5c\u4e3a\u51c6\u5165\u63a7\u5236\u5668\uff0c\u60a8\u53ef\u4ee5\u81ea\u52a8\u62d2\u7edd\u4e0d\u7b26\u5408\u7ec4\u7ec7\u653f\u7b56\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002</p> </li> <li>\u4f5c\u4e3a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u60a8\u53ef\u4ee5\u6d4b\u8bd5\u672c\u5730 YAML \u6587\u4ef6\uff0c\u4f8b\u5982\u4f5c\u4e3a CI/CD \u6d41\u7a0b\u7684\u4e00\u90e8\u5206\u3002</li> </ul> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#polaris_1","title":"\u4e8c \u90e8\u7f72Polaris","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#21-dashboard","title":"2.1 DashBoard\u90e8\u7f72","text":"<p>Polaris \u4eea\u8868\u677f\u53ef\u4ee5\u4f7f\u7528 kubectl \u6216 Helm \u5b89\u88c5\u5728\u96c6\u7fa4\u4e0a\u3002\u5b83\u4e5f\u53ef\u4ee5\u5728\u672c\u5730\u8fd0\u884c\uff0c\u4f7f\u7528\u5b58\u50a8\u5728\u60a8\u7684 KUBECONFIG \u4e2d\u7684\u51ed\u8bc1\u8fde\u63a5\u5230\u60a8\u7684\u96c6\u7fa4\u3002</p> <p>\u4eea\u8868\u677f\u662f\u4e86\u89e3\u96c6\u7fa4\u6216\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u4e2d\u7684\u54ea\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u4e0d\u7b26\u5408\u6700\u4f73\u5b9e\u8df5\u7684\u597d\u65b9\u6cd5\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#211-kubectl","title":"2.1.1 kubectl\u5b89\u88c5","text":"<pre><code>kubectl apply -f https://github.com/fairwindsops/polaris/releases/latest/download/dashboard.yaml\nkubectl port-forward --namespace polaris svc/polaris-dashboard 8080:80\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#212-helm","title":"2.1.2 Helm\u5b89\u88c5","text":"<pre><code>helm repo add fairwinds-stable https://charts.fairwinds.com/stable\nhelm upgrade --install polaris fairwinds-stable/polaris --namespace polaris --create-namespace\nkubectl port-forward --namespace polaris svc/polaris-dashboard --address 0.0.0.0 8080:80\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#213-local-binary","title":"2.1.3 Local Binary","text":"<p>\u60a8\u9700\u8981\u4e3a\u4eea\u8868\u677f\u8bbe\u7f6e\u6709\u6548\u7684 KUBECONFIG \u624d\u80fd\u8fde\u63a5\u5230\u60a8\u7684\u96c6\u7fa4\u3002 \u4e8c\u8fdb\u5236\u7248\u672c\u53ef\u4ee5\u4ece\u53d1\u5e03\u9875\u9762\u4e0b\u8f7d\uff08\u6253\u5f00\u65b0\u7a97\u53e3\uff09\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Homebrew \u5b89\u88c5\uff08\u6253\u5f00\u65b0\u7a97\u53e3\uff09\uff1a</p> <pre><code>brew tap reactiveops/tap\nbrew install reactiveops/tap/polaris\npolaris dashboard --port 8080\n</code></pre> <p>\u60a8\u8fd8\u53ef\u4ee5\u5c06\u4eea\u8868\u677f\u6307\u5411\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u4e0d\u662f\u5b9e\u65f6\u96c6\u7fa4\uff1a</p> <pre><code>polaris dashboard --port 8080 --audit-path=./deploy/\n</code></pre> <p>\u56fe\u50cf\u754c\u9762</p> <p></p> <p>\u67e5\u770b\u5bb9\u5668\u914d\u7f6e\u5f02\u5e38</p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#22-admission-controller","title":"2.2 Admission Controller","text":"<p>Polaris \u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u63a5\u7eb3\u63a7\u5236\u5668\u8fd0\u884c\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u786e\u8ba4\u7684\u7f51\u7edc\u6302\u94a9\u3002\u5b83\u63a5\u53d7\u4e0e\u4eea\u8868\u677f\u76f8\u540c\u7684\u914d\u7f6e\uff0c\u5e76\u53ef\u4ee5\u8fd0\u884c\u76f8\u540c\u7684\u9a8c\u8bc1\u3002Webhook \u5c06\u62d2\u7edd\u89e6\u53d1\u5371\u9669\u7ea7\u522b\u68c0\u67e5\u7684\u4efb\u4f55\u5de5\u4f5c\u8d1f\u8f7d\u3002\u8fd9\u8868\u660e\u4e86 Polaris \u66f4\u5927\u7684\u76ee\u6807\uff0c\u4e0d\u4ec5\u4ec5\u662f\u901a\u8fc7\u4eea\u8868\u677f\u53ef\u89c1\u6027\u6765\u9f13\u52b1\u66f4\u597d\u7684\u914d\u7f6e\uff0c\u800c\u662f\u901a\u8fc7\u8fd9\u4e2a webhook \u6765\u5b9e\u9645\u6267\u884c\u5b83\u3002\u8bf7\u6ce8\u610f\uff0cPolaris \u4e0d\u4f1a\u6539\u53d8\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u53ea\u4f1a\u963b\u6b62\u4e0d\u7b26\u5408\u914d\u7f6e\u7b56\u7565\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#221","title":"2.2.1 \u5b89\u88c5","text":"<p>\u4f7f\u7528helm\u8fdb\u884c\u90e8\u7f72</p> <pre><code> helm repo add fairwinds-stable https://charts.fairwinds.com/stable\nhelm upgrade --install polaris fairwinds-stable/polaris --namespace polaris --create-namespace \\\n  --set webhook.enable=true --set dashboard.enable=false\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#23-infrastructure-as-code","title":"2.3 Infrastructure as Code","text":"<p>\u60f3\u5728\u4e00\u4e2a\u5730\u65b9\u770b\u5230\u6240\u6709\u68c0\u6d4b\u4e1a\u52a1\u7684\u7ed3\u679c\u5417\uff1f</p> <p>\u67e5\u770b Fairwinds Insights (\u6253\u5f00\u65b0\u7a97\u53e3) Polaris \u53ef\u4ee5\u5728\u547d\u4ee4\u884c\u4e0a\u7528\u4e8e\u5ba1\u6838\u5b58\u50a8\u5728 YAML \u6587\u4ef6\u4e2d\u7684\u672c\u5730 Kubernetes \u6e05\u5355\u3002</p> <p>\u8fd9\u5bf9\u4e8e\u9488\u5bf9\u4f5c\u4e3a CI/CD \u7ba1\u9053\u4e00\u90e8\u5206\u7684\u57fa\u7840\u8bbe\u65bd\u4ee3\u7801\u8fd0\u884c Polaris \u7279\u522b\u6709\u5e2e\u52a9\u3002\u4f7f\u7528\u53ef\u7528\u7684\u547d\u4ee4\u884c\u6807\u5fd7\uff0c\u5982\u679c\u60a8\u7684 Polaris \u5f97\u5206\u4e0b\u964d\u5230\u67d0\u4e2a\u9608\u503c\u4ee5\u4e0b\uff0c\u6216\u8005\u51fa\u73b0\u4efb\u4f55\u5371\u9669\u7ea7\u522b\u7684\u95ee\u9898\uff0c\u5c06\u5bfc\u81f4 CI/CD \u5931\u8d25</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#_1","title":"\u4e09 \u68c0\u67e5\u9879\u76ee","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#31-security","title":"3.1 Security","text":"<p>\u5bb9\u5668\u9700\u8981\u9075\u5faa\u5b89\u5168\u89c4\u5219</p> key default description <code>hostIPCSet</code> <code>danger</code> Fails when <code>hostIPC</code> attribute is configured. <code>hostPIDSet</code> <code>danger</code> Fails when <code>hostPID</code> attribute is configured. <code>notReadOnlyRootFilesystem</code> <code>warning</code> Fails when <code>securityContext.readOnlyRootFilesystem</code> is not true. <code>privilegeEscalationAllowed</code> <code>danger</code> Fails when <code>securityContext.allowPrivilegeEscalation</code> is true. <code>runAsRootAllowed</code> <code>warning</code> Fails when <code>securityContext.runAsNonRoot</code> is not true. <code>runAsPrivileged</code> <code>danger</code> Fails when <code>securityContext.privileged</code> is true. <code>insecureCapabilities</code> <code>warning</code> Fails when <code>securityContext.capabilities</code> includes one of the capabilities listed here(opens new window) <code>dangerousCapabilities</code> <code>danger</code> Fails when <code>securityContext.capabilities</code> includes one of the capabilities listed here(opens new window) <code>hostNetworkSet</code> <code>warning</code> Fails when <code>hostNetwork</code> attribute is configured. <code>hostPortSet</code> <code>warning</code> Fails when <code>hostPort</code> attribute is configured. <code>tlsSettingsMissing</code> <code>warning</code> Fails when an Ingress lacks TLS settings. <p>\u786e\u4fdd Kubernetes \u7684\u5de5\u4f5c\u8d1f\u8f7d\u5b89\u5168\u662f\u6574\u4e2a\u96c6\u7fa4\u5b89\u5168\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002\u603b\u4f53\u76ee\u6807\u5e94\u8be5\u662f\u786e\u4fdd\u5bb9\u5668\u4ee5\u5c3d\u53ef\u80fd\u5c11\u7684\u7279\u6743\u8fd0\u884c\u3002\u8fd9\u5305\u62ec\u907f\u514d\u4f7f\u7528\u6743\u9650\u63d0\u5347\u6587\u4ef6\uff0c\u4e0d\u4f7f\u7528\u5e26\u6709\u6839\u7528\u6237\u7684\u5bb9\u5668\uff0c\u4e0d\u7ed9\u4e3b\u673a\u7f51\u7edc\u63d0\u4f9b\u8fc7\u591a\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u4ee5\u53ca\u5c3d\u53ef\u80fd\u4f7f\u7528\u53ea\u8bfb\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u542f\u7528 hostNetwork \u5c5e\u6027\u8fd0\u884c\u7684 pod \u5c06\u53ef\u4ee5\u8bbf\u95ee\u73af\u56de\u8bbe\u5907\uff0c\u76d1\u542c\u672c\u5730\u4e3b\u673a\u4e0a\u7684\u670d\u52a1\uff0c\u5e76\u4e14\u53ef\u4ee5\u7528\u6765\u7aa5\u63a2\u540c\u4e00\u8282\u70b9\u4e0a\u5176\u4ed6\u540a\u8231\u7684\u7f51\u7edc\u6d3b\u52a8\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5c06 hostNetwork \u8bbe\u7f6e\u4e3a true\uff0c\u6bd4\u5982\u90e8\u7f72\u4e00\u4e2a\u50cf Flannel \u8fd9\u6837\u7684\u7f51\u7edc\u63d2\u4ef6\u3002</p> <p>\u5728\u5bb9\u5668\u4e0a\u8bbe\u7f6e hostPort \u5c5e\u6027\u5c06\u786e\u4fdd\u5728\u5b83\u90e8\u7f72\u5230\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7684\u7279\u5b9a\u7aef\u53e3\u4e0a\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5b83\u3002\u4e0d\u5e78\u7684\u662f\uff0c\u5f53\u5b83\u88ab\u6307\u5b9a\u65f6\uff0c\u5b83\u9650\u5236\u4e86\u4e00\u4e2a pod \u53ef\u4ee5\u5728\u96c6\u7fa4\u4e2d\u5b9e\u9645\u8c03\u5ea6\u7684\u4f4d\u7f6e\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#32-efficiency","title":"3.2 Efficiency","text":"<p>\u8fd9\u4e9b\u68c0\u67e5\u786e\u4fdd\u914d\u7f6e\u4e86 CPU \u548c\u5185\u5b58\u8bbe\u7f6e\uff0c\u4ee5\u4fbf Kubernetes \u80fd\u591f\u6709\u6548\u5730\u8c03\u5ea6\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002</p> <p>\u4e3a\u5728 Kubernetes \u8fd0\u884c\u7684\u5bb9\u5668\u914d\u7f6e\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u6700\u4f73\u5b9e\u8df5\u3002\u8bbe\u7f6e\u9002\u5f53\u7684\u8d44\u6e90\u8bf7\u6c42\u5c06\u786e\u4fdd\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u5177\u6709\u8db3\u591f\u7684\u8ba1\u7b97\u8d44\u6e90\u3002\u8bbe\u7f6e\u9002\u5f53\u7684\u8d44\u6e90\u9650\u5236\u5c06\u786e\u4fdd\u5e94\u7528\u7a0b\u5e8f\u4e0d\u4f1a\u6d88\u8017\u592a\u591a\u8d44\u6e90\u3002</p> key default description <code>cpuRequestsMissing</code> <code>warning</code> Fails when <code>resources.requests.cpu</code> attribute is not configured. <code>memoryRequestsMissing</code> <code>warning</code> Fails when <code>resources.requests.memory</code> attribute is not configured. <code>cpuLimitsMissing</code> <code>warning</code> Fails when <code>resources.limits.cpu</code> attribute is not configured. <code>memoryLimitsMissing</code> <code>warning</code> Fails when <code>resources.limits.memory</code> attribute is not configured."},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#33-reliability","title":"3.3 Reliability","text":"<p>\u8fd9\u4e9b\u68c0\u67e5\u6709\u52a9\u4e8e\u786e\u4fdd\u60a8\u7684\u5de5\u4f5c\u8d1f\u8f7d\u59cb\u7ec8\u53ef\u7528\uff0c\u5e76\u4e14\u6b63\u5728\u8fd0\u884c\u6b63\u786e\u7684\u6620\u50cf\u3002</p> key default description <code>readinessProbeMissing</code> <code>warning</code> Fails when a readiness probe is not configured for a pod. <code>livenessProbeMissing</code> <code>warning</code> Fails when a liveness probe is not configured for a pod. <code>tagNotSpecified</code> <code>danger</code> Fails when an image tag is either not specified or <code>latest</code>. <code>pullPolicyNotAlways</code> <code>warning</code> Fails when an image pull policy is not <code>always</code>. <code>priorityClassNotSet</code> <code>ignore</code> Fails when a priorityClassName is not set for a pod. <code>deploymentMissingReplicas</code> <code>warning</code> Fails when there is only one replica for a deployment. <code>missingPodDisruptionBudget</code> <code>ignore</code>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#_2","title":"\u56db \u81ea\u5b9a\u4e49\u68c0\u6d4b","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#41-quayo","title":"4.1 \u7981\u7528quay.o","text":"<pre><code> checks:\n  imageRegistry: warning\n\ncustomChecks:\n  imageRegistry:\n    successMessage: Image comes from allowed registries\n    failureMessage: Image should not be from disallowed registry\n    category: Security\n    target: Container\n    schema:\n      '$schema': http://json-schema.org/draft-07/schema\n      type: object\n      properties:\n        image:\n          type: string\n          not:\n            pattern: ^quay.io\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/#_3","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li> <p>https://polaris.docs.fairwinds.com/</p> </li> <li> <p>https://github.com/FairwindsOps/polaris</p> </li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/","title":"\u955c\u50cf\u5b89\u5168\u626b\u63cf\u4e4bTrivy","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#_1","title":"\u4e00 \u6982\u8ff0","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#11-trivy","title":"1.1 Trivy\u7b80\u4ecb","text":"<p>Trivy \u662f\u4e00\u79cd\u9002\u7528\u4e8e CI \u7684\u7b80\u5355\u800c\u5168\u9762\u7684\u5bb9\u5668\u6f0f\u6d1e\u626b\u63cf\u7a0b\u5e8f\u3002\u8f6f\u4ef6\u6f0f\u6d1e\u662f\u6307\u8f6f\u4ef6\u6216\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5b58\u5728\u7684\u6545\u969c\u3001\u7f3a\u9677\u6216\u5f31\u70b9\u3002Trivy \u68c0\u6d4b\u64cd\u4f5c\u7cfb\u7edf\u5305\uff08Alpine\u3001RHEL\u3001CentOS \u7b49\uff09\u548c\u5e94\u7528\u7a0b\u5e8f\u4f9d\u8d56\uff08Bundler\u3001Composer\u3001npm\u3001yarn \u7b49\uff09\u7684\u6f0f\u6d1e\u3002Trivy \u5f88\u5bb9\u6613\u4f7f\u7528\uff0c\u53ea\u8981\u5b89\u88c5\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5c31\u53ef\u4ee5\u626b\u63cf\u4e86\u3002\u626b\u63cf\u53ea\u9700\u6307\u5b9a\u5bb9\u5668\u7684\u955c\u50cf\u540d\u79f0\u3002\u4e0e\u5176\u4ed6\u955c\u50cf\u626b\u63cf\u5de5\u5177\u76f8\u6bd4\uff0c\u4f8b\u5982 Clair\uff0cAnchore Engine\uff0cQuay \u76f8\u6bd4\uff0cTrivy \u5728\u51c6\u786e\u6027\u3001\u65b9\u4fbf\u6027\u548c\u5bf9 CI \u7684\u652f\u6301\u7b49\u65b9\u9762\u90fd\u6709\u7740\u660e\u663e\u7684\u4f18\u52bf\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#12","title":"1.2 \u7279\u6027","text":"<ol> <li>\u68c0\u6d4b\u9762\u5f88\u5168\uff0c\u80fd\u68c0\u6d4b\u5168\u9762\u7684\u6f0f\u6d1e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u8f6f\u4ef6\u5305\uff08Alpine\u3001Red Hat Universal Base Image\u3001Red Hat Enterprise Linux\u3001CentOS\u3001Oracle Linux\u3001Debian\u3001Ubuntu\u3001Amazon Linux\u3001openSUSE Leap\u3001SUSE Enterprise Linux\u3001Photon OS \u548c Distrioless\uff09\u3001\u5e94\u7528\u7a0b\u5e8f\u4f9d\u8d56\u9879\uff08Bundler\u3001Composer\u3001Pipenv\u3001Poetry\u3001npm\u3001yarn \u548c Cargo\uff09\uff1b</li> <li>\u4f7f\u7528\u7b80\u5355\uff0c\u4ec5\u4ec5\u53ea\u9700\u8981\u6307\u5b9a\u955c\u50cf\u540d\u79f0\uff1b</li> <li>\u626b\u63cf\u5feb\u4e14\u65e0\u72b6\u6001\uff0c\u7b2c\u4e00\u6b21\u626b\u63cf\u5c06\u5728 10 \u79d2\u5185\u5b8c\u6210\uff08\u53d6\u51b3\u4e8e\u60a8\u7684\u7f51\u7edc\uff09\u3002\u968f\u540e\u7684\u626b\u63cf\u5c06\u5728\u4e00\u79d2\u949f\u5185\u5b8c\u6210\u3002\u4e0e\u5176\u4ed6\u626b\u63cf\u5668\u5728\u7b2c\u4e00\u6b21\u8fd0\u884c\u65f6\u9700\u8981\u5f88\u957f\u65f6\u95f4\uff08\u5927\u7ea6 10 \u5206\u949f\uff09\u6765\u83b7\u53d6\u6f0f\u6d1e\u4fe1\u606f\uff0c\u5e76\u9f13\u52b1\u60a8\u7ef4\u62a4\u6301\u4e45\u7684\u6f0f\u6d1e\u6570\u636e\u5e93\u4e0d\u540c\uff0cTrivy \u662f\u65e0\u72b6\u6001\u7684\uff0c\u4e0d\u9700\u8981\u7ef4\u62a4\u6216\u51c6\u5907\uff1b</li> <li>\u6613\u4e8e\u5b89\u88c5\uff0c\u5b89\u88c5\u65b9\u5f0f\uff1a</li> </ol> <p><pre><code>   1. apt-get install\n   2. yum install\n   3. brew install\n</code></pre> \u65e0\u9700\u5b89\u88c5\u6570\u636e\u5e93\u3001\u5e93\u7b49\u5148\u51b3\u6761\u4ef6\uff08\u4f8b\u5916\u60c5\u51b5\u662f\u9700\u8981\u5b89\u88c5 rpm \u4ee5\u626b\u63cf\u57fa\u4e8e RHEL/CentOS \u7684\u56fe\u50cf\uff09\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#_2","title":"\u4e8c \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#21-linux","title":"2.1 Linux\u5b89\u88c5","text":"<pre><code>$ sudo vim /etc/yum.repos.d/trivy.repo\n[trivy]\nname=Trivy repository\nbaseurl=https://knqyf263.github.io/trivy-repo/rpm/releases/$releasever/$basearch/\ngpgcheck=0\nenabled=1\n$ sudo yum -y update\n$ sudo yum -y install trivy\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#22-mac-os","title":"2.2 Mac OS\u5b89\u88c5","text":"<pre><code>$ brew install knqyf263/trivy/trivy\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#23","title":"2.3 \u4f7f\u7528\u65b9\u5f0f","text":"<pre><code>\u5f53\u7136\uff0ctrivy\u4e5f\u652f\u6301docker\u5feb\u901f\u542f\u52a8\n\ndocker run --rm -v [YOUR_CACHE_DIR]:/root/.cache/ knqyf263/trivy [YOUR_IMAGE_NAME]\n\n\u9700\u8981\u5c06YOUR_CACHE_DIR\u66ff\u6362\u6210\u4f60\u7684\u7f13\u5b58\u76ee\u5f55\uff0c\u5c06\u4e4b\u524d\u7f13\u5b58\u7684\u6f0f\u6d1e\u5e93\u6620\u5c04\u5230\u5bb9\u5668\u4e2d\uff0c\u4e0d\u7136\u542f\u52a8\u4f1a\u5f88\u6162\n\n\n\n\u5982\u679c\u60f3\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u626b\u63cf\u672c\u673a\u7684\u5bb9\u5668\u955c\u50cf\uff0c\u9700\u8981\u5c06docker.sock\u6587\u4ef6\u6620\u5c04\u5230\u5bb9\u5668\u5185\uff0c\u6bd4\u5982\n\ndocker run --rm -v /var/run/docker.sock:/var/run/docker.sock \\\n\n    -v $HOME/.cache/:/root/.cache/ knqyf263/trivy python:3.4-alpine\n\n\n\ntrivy\u4f7f\u7528\u7b80\u5355\u793a\u4f8b\u5982\u4e0b\uff1a\n\n\u626b\u63cf\u955c\u50cf\uff1a\n\ntrivy [image_name]\n\n\n\n\u626b\u63cf\u901a\u8fc7save\u65b9\u5f0f\u6253\u5305\u7684\u955c\u50cf\uff1a\n\ntrivy --input [image_name.tar]\n\n\n\n\u5c06\u626b\u63cf\u7ed3\u679c\u5b58\u4e3ajson\u6587\u4ef6\uff1a\n\ntrivy -f json -o results.json [image_name]\n\n\n\n\u901a\u8fc7\u8bbe\u7f6e\u6f0f\u6d1e\u7ea7\u522b\u8fc7\u6ee4\u6f0f\u6d1e\uff1a\n\ntrivy --severity HIGH,CRITICAL [image_name]\n\n\n\n\u901a\u8fc7\u8bbe\u7f6e\u6f0f\u6d1e\u7c7b\u578b\u8fc7\u6ee4\u6f0f\u6d1e\uff1a\n\ntrivy --vuln-type os [image_name]\n\n\u6f0f\u6d1e\u7c7b\u578b\u5206\u4e3aos\u548clibrary\n\n\n\n\u53ea\u66f4\u65b0\u67d0\u4e2a\u7cfb\u7edf\u7c7b\u578b\u7684\u6f0f\u6d1e\u5e93\uff1a\n\ntrivy --only-update alpine,debia [image_name]\n\n\n\n\u6307\u5b9a\u9000\u51fa\u4ee3\u7801\uff1a\n\ntrivy --exit-code 1 [image_name]\n\n\u6307\u5b9a\u9000\u51fa\u4ee3\u7801\uff0c\u4e3b\u8981\u662f\u4e3a\u540e\u7eed\u5224\u65ad\u63d0\u4f9b\u53ef\u64cd\u4f5c\u6027\uff0c\u4e3b\u8981\u662f\u5728CI\u4e2d\n\n\n\n\u7531\u4e8etrivy\u6709\u7f13\u5b58\uff0c\u6240\u4ee5\u5728\u626b\u63cf\u955c\u50cf\u7684latest\u7248\u672c\u7684\u65f6\u5019\uff0c\u4f1a\u51fa\u73b0\u5f02\u5e38\uff0c\u9700\u8981\u6e05\u695a\u7f13\u5b58\u64cd\u4f5c\uff1a\n\ntrivy --clear-cache [image_name]\n\n\n\n\u5982\u679c\u9700\u8981\u91cd\u5efa\u672c\u5730\u6f0f\u6d1e\u6570\u636e\u5e93\uff0c\u6216\u6e05\u9664\u6240\u6709\u7f13\u5b58\uff0c\u53ef\u4ee5\u901a\u8fc7trivy --reset\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#ci","title":"\u4e09 \u96c6\u6210\u5230CI","text":"<p>Trivy \u6709\u5bf9 CI \u53cb\u597d\u7684\u7279\u70b9\uff0c\u5e76\u4e14\u5b98\u65b9\u4e5f\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u7528\u5b83\uff0c\u60f3\u8981\u96c6\u6210 CI \u53ea\u9700\u8981\u4e00\u6bb5\u7b80\u5355\u7684 Yml \u914d\u7f6e\u6587\u4ef6\u5373\u53ef\uff0c\u5982\u679c\u53d1\u73b0\u6f0f\u6d1e\uff0c\u6d4b\u8bd5\u5c06\u5931\u8d25\u3002\u5982\u679c\u4e0d\u5e0c\u671b\u6d4b\u8bd5\u5931\u8d25\uff0c\u8bf7\u6307\u5b9a--exit code 0\u3002\u7531\u4e8e\u5728\u81ea\u52a8\u5316\u573a\u666f\uff08\u5982 CI/CD\uff09\u4e2d\uff0c\u60a8\u53ea\u5bf9\u6700\u7ec8\u7ed3\u679c\u611f\u5174\u8da3\uff0c\u800c\u4e0d\u662f\u5bf9\u5b8c\u6574\u7684\u62a5\u544a\u611f\u5174\u8da3\uff0c\u56e0\u6b64\u8bf7\u4f7f\u7528--light \u6807\u5fd7\u5bf9\u6b64\u573a\u666f\u8fdb\u884c\u4f18\u5316\uff0c\u4ee5\u83b7\u5f97\u5feb\u901f\u7684\u7ed3\u679c\u3002</p> <p>\u96c6\u6210 GitLab CI \u7684 Yml \u914d\u7f6e\u53ef\u4ee5\u53c2\u8003\uff1a</p> <p>https://github.com/aquasecurity/trivy#gitlab-ci</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#_3","title":"\u56db \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u56fd\u5185\u62c9\u53d6\u6f0f\u6d1e\u6570\u636e\u5e93\u6162\u3002</li> <li>\u540c\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u591a\u4e2a\u955c\u50cf\u626b\u63cf\u7684\u65f6\u5019\u4e0d\u53ef\u5e76\u884c\u6267\u884c\u3002</li> <li>\u53ef\u4ee5\u4f7f\u7528--light \u4f7f\u7528\u8f7b\u91cf\u7ea7\u6570\u636e\u5e93\u6765\u4f18\u5316\u6267\u884c\u626b\u63cf\u7684\u6548\u7387\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#_4","title":"\u4e94 \u53cd\u601d","text":"<p>trivy \u4e0d\u4ec5\u53ef\u4ee5\u96c6\u6210\u5728 CI \u8fc7\u7a0b\u4e2d\uff0c\u53ca\u65f6\u53d1\u73b0\u955c\u50cf\u6f0f\u6d1e\uff0c\u800c\u4e14\u53ef\u4ee5\u4e8e\u81ea\u5efa harbor \u8fdb\u884c\u96c6\u6210\uff0c\u5b9a\u65f6\u5bf9\u5df2\u7ecf\u4e0a\u4f20\u7684\u955c\u50cf\u8fdb\u884c\u626b\u63cf\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li> <p>https://github.com/aquasecurity/trivy</p> </li> <li> <p>https://blog.csdn.net/qq_31977125/article/details/105639085</p> </li> <li>https://mp.weixin.qq.com/s/n9T2kcuAMOL5Dj-_d7IH6g</li> <li>https://my.oschina.net/u/3495789/blog/4346263</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/","title":"\u5f00\u6e90\u5bb9\u5668\u5b89\u5168\u5e73\u53f0\u4e4bNeuVector","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5bb9\u5668\u5b89\u5168\u4e00\u76f4\u662f\u4f01\u4e1a\u6784\u5efa\u548c\u8fd0\u884c Kubernetes \u5e94\u7528\u7684\u5173\u952e\u9700\u6c42\uff0cNeuVector\u9879\u76ee\u4f7fRancher\u7528\u6237\u80fd\u591f\u6ee1\u8db3\u6574\u4e2a\u5e94\u7528\u751f\u547d\u5468\u671f\u4e2d\u7684\u4e3b\u8981\u5b89\u5168\u573a\u666f\u8981\u6c42\uff0c\u5305\u62ec\u6df1\u5165\u7684\u7f51\u7edc\u53ef\u89c6\u5316\u3001\u68c0\u67e5\u548c\u5fae\u9694\u79bb\uff1b\u6f0f\u6d1e\u68c0\u6d4b\u3001\u914d\u7f6e\u548c\u5408\u89c4\u7ba1\u7406\uff1b\u4ee5\u53ca\u98ce\u9669\u5206\u6790\u3001\u5a01\u80c1\u68c0\u6d4b\u548c\u4e8b\u4ef6\u54cd\u5e94\u3002NeuVector \u9879\u76ee\u5c06\u6210\u4e3a Rancher \u9ad8\u7ea7\u96c6\u7fa4\u5b89\u5168\u529f\u80fd\u7684\u57fa\u7840 \u3002</p> <p>NeuVector\u6210\u4e3a\u4e86\u4e1a\u754c\u9996\u4e2a\u7aef\u5230\u7aef\u7684\u5f00\u6e90\u5bb9\u5668\u5b89\u5168\u5e73\u53f0\uff0c\u552f\u4e00\u4e3a\u5bb9\u5668\u5316\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u4f01\u4e1a\u7ea7\u96f6\u4fe1\u4efb\u5b89\u5168\u7684\u89e3\u51b3\u65b9\u6848\u3002</p> <p>NeuVector \u662f\u4e1a\u754c\u9886\u5148\u7684\u5b89\u5168\u548c\u5408\u89c4\u89e3\u51b3\u65b9\u6848\uff0c\u5df2\u88ab\u5168\u7403\u77e5\u540d\u4f01\u4e1a\u5e7f\u6cdb\u91c7\u7528\uff1b\u5176\u4ee3\u7801\u5e93\u7684\u5f00\u6e90\u4e0d\u4ec5\u4f7f NeuVector \u6210\u4e3a\u5f00\u6e90\u793e\u533a\u7684\u9996\u9009\u6280\u672f\uff0c\u8fd8\u4e3a\u53d7\u4e25\u683c\u76d1\u7ba1\u7684\u5ba2\u6237\uff08\u5305\u62ec\u653f\u4f01\u3001\u91d1\u878d\uff09\u63d0\u4f9b\u4e86\u66f4\u53ef\u9760\u7684\u4fdd\u8bc1\u3002</p> <p>NeuVector\u5f00\u6e90\u5bb9\u5668\u955c\u50cf\u53ef\u4ee5\u5b89\u88c5\u5728\u4efb\u4f55Kubernetes\u96c6\u7fa4\u4e0a\u3002</p> <p>\u652f\u6301\u5305\u62ec\u7ea2\u5e3dOpenShift\u3001VMWare Tanzu\u3001Google GKE\u3001Amazon EKS\u3001Microsoft Azure AKS\u7b49\u5728\u5185\u7684\u4f17\u591a\u4f01\u4e1a\u7ea7\u5bb9\u5668\u7ba1\u7406\u5e73\u53f0\u3002</p> <p>NeuVector \u5c06\u9a71\u52a8 SUSE \u65d7\u8230 Kubernetes \u7ba1\u7406\u5e73\u53f0\u2014\u2014SUSE Rancher \u7684\u5bb9\u5668\u5b89\u5168\u521b\u65b0\uff0c\u6b64\u4e3e\u5c06\u6709\u52a9\u4e8e\u63a8\u52a8Kubernetes\u5b89\u5168\u9886\u57df\u7684\u91cd\u5927\u751f\u6001\u7cfb\u7edf\u9769\u65b0\uff0c\u6b64\u524d\u8fd9\u4e00\u9886\u57df\u901a\u5e38\u7531\u95ed\u6e90\u7684\u4e13\u6709\u89e3\u51b3\u65b9\u6848\u4e3b\u5bfc\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#neuvector_1","title":"\u4e8c NeuVector\u7b80\u4ecb","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#21","title":"2.1 \u529f\u80fd\u7279\u6027","text":"<p>NeuVector \u63d0\u4f9b\u5f3a\u5927\u7684\u7aef\u5230\u7aef\u5bb9\u5668\u5b89\u5168\u5e73\u53f0\u3002\u8fd9\u5305\u62ec\u5bf9\u5bb9\u5668\u3001Pod \u548c\u4e3b\u673a\u7684\u7aef\u5230\u7aef\u6f0f\u6d1e\u626b\u63cf\u548c\u5b8c\u6574\u7684\u8fd0\u884c\u65f6\u4fdd\u62a4\uff0c\u5305\u62ec\uff1a</p> <ul> <li>CI/CD \u6f0f\u6d1e\u7ba1\u7406\u548c\u51c6\u5165\u63a7\u5236\uff0c\u4f7f\u7528 Jenkins \u63d2\u4ef6\u626b\u63cf\u955c\u50cf\u3001\u626b\u63cf\u6ce8\u518c\u8868\u5e76\u5f3a\u5236\u5b9e\u65bd\u51c6\u5165\u63a7\u5236\u89c4\u5219\u4ee5\u5c06\u5176\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u4e2d\u3002</li> <li>\u8fdd\u89c4\u4fdd\u62a4\uff0c\u53d1\u73b0\u884c\u4e3a\u5e76\u521b\u5efa\u57fa\u4e8e\u767d\u540d\u5355\u7684\u7b56\u7565\u6765\u68c0\u6d4b\u8fdd\u53cd\u6b63\u5e38\u884c\u4e3a\u7684\u884c\u4e3a\u3002</li> <li>\u5a01\u80c1\u68c0\u6d4b\uff0c\u68c0\u6d4b\u5bb9\u5668\u4e0a\u7684\u5e38\u89c1\u5e94\u7528\u7a0b\u5e8f\u653b\u51fb\uff0c\u4f8b\u5982 DDoS \u548c DNS \u653b\u51fb\u3002</li> <li>DLP \u548c WAF \u4f20\u611f\u5668\u3002\u68c0\u67e5\u7f51\u7edc\u6d41\u91cf\u4ee5\u9632\u6b62\u654f\u611f\u6570\u636e\u4e22\u5931\uff0c\u5e76\u68c0\u6d4b\u5e38\u89c1\u7684 OWASP Top10 WAF \u653b\u51fb\u3002</li> <li>\u8fd0\u884c\u65f6\u6f0f\u6d1e\u626b\u63cf\u3002\u626b\u63cf\u6ce8\u518c\u8868\u3001\u955c\u50cf\u548c\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u7f16\u6392\u5e73\u53f0\u548c\u4e3b\u673a\u4ee5\u67e5\u627e\u5e38\u89c1 (CVE) \u4ee5\u53ca\u7279\u5b9a\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684\u6f0f\u6d1e\u3002</li> <li>\u5408\u89c4\u4e0e\u5ba1\u8ba1\u3002\u81ea\u52a8\u8fd0\u884c Docker Bench \u6d4b\u8bd5\u548c Kubernetes CIS Benchmarks\u3002</li> <li>\u7aef\u70b9/\u4e3b\u673a\u5b89\u5168\u3002\u68c0\u6d4b\u6743\u9650\u5347\u7ea7\uff0c\u76d1\u63a7\u4e3b\u673a\u548c\u5bb9\u5668\u5185\u7684\u8fdb\u7a0b\u548c\u6587\u4ef6\u6d3b\u52a8\uff0c\u5e76\u76d1\u63a7\u5bb9\u5668\u6587\u4ef6\u7cfb\u7edf\u7684\u53ef\u7591\u6d3b\u52a8\u3002</li> <li>\u591a\u96c6\u7fa4\u7ba1\u7406\u3002\u4ece\u5355\u4e2a\u63a7\u5236\u53f0\u76d1\u63a7\u548c\u7ba1\u7406\u591a\u4e2a Kubernetes \u96c6\u7fa4\u3002</li> </ul> <p>NeuVector \u7684\u5176\u4ed6\u7279\u6027\u5305\u62ec\u9694\u79bb\u5bb9\u5668\u548c\u901a\u8fc7 SYSLOG \u548c webhooks \u5bfc\u51fa\u65e5\u5fd7\u7684\u80fd\u529b\uff0c\u4e3a\u8c03\u67e5\u542f\u52a8\u6570\u636e\u5305\u6355\u83b7\uff0c\u4ee5\u53ca\u4e0e OpenShift RBACs\u3001 LDAP\u3001 Microsoft AD \u548c SSO \u4e0e SAML \u7684\u96c6\u6210\u3002\u6ce8\u610f: \u9694\u79bb\u610f\u5473\u7740\u6240\u6709\u7f51\u7edc\u901a\u4fe1\u90fd\u88ab\u963b\u585e\u3002\u5bb9\u5668\u5c06\u4fdd\u6301\u5e76\u7ee7\u7eed\u8fd0\u884c\u2014\u2014\u53ea\u662f\u6ca1\u6709\u4efb\u4f55\u7f51\u7edc\u8fde\u63a5\u3002Kubernetes \u4e0d\u4f1a\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u6765\u66ff\u6362\u9694\u79bb\u7684\u5bb9\u5668\uff0c\u56e0\u4e3a api-\u670d\u52a1\u5668\u4ecd\u7136\u80fd\u591f\u5230\u8fbe\u5bb9\u5668\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#22","title":"2.2 \u5168\u751f\u547d\u5468\u671f\u5b89\u5168","text":"<ul> <li>\u6784\u5efa:\u955c\u50cf\u6784\u5efa\u626b\u63cf,\u907f\u514d\u751f\u6210\u6709\u9690\u60a3\u7684\u955c\u50cf</li> <li>\u90e8\u7f72:\u901a\u8fc7\u51c6\u5165\u63a7\u5236\u7b56\u7565\u673a\u5236,\u907f\u514d\u6709\u9690\u60a3\u7684\u955c\u50cf\u548c\u4e0d\u7b26\u5408\u7b56\u7565\u8981\u6c42\u7684\u5bb9\u5668\u90e8\u7f72\u5230\u73af\u5883</li> <li>\u8fd0\u884c:\u56db\u5c42/\u4e03\u5c42\u9632\u706b\u5899\u907f\u514d\u5916\u90e8\u653b\u51fb\u548c\u6570\u636e\u7a83\u53d6</li> <li>\u8fd0\u884c:\u4e1c\u897f\u5411\u7f51\u7edc\u52a8\u6001\u5fae\u9694\u79bb,\u907f\u514d\u5185\u90e8\u653b\u51fb\u6269\u5c55\u3002WAF\u9632\u706b\u5899\u907f\u514d\u5916\u90e8\u653b\u51fb\u3002</li> <li>\u8fd0\u884c:\u5bb9\u5668\u5185\u75c5\u6bd2\u3001\u6728\u9a6c\u3001\u7834\u89e3\u5668\u9632\u62a4.</li> <li>\u4e3b\u673a\u3001Runtime\u3001 K8S\u7ea7\u522b\u5b89\u5168\u57fa\u7ebf\u626b\u63cf\uff0c\u5408\u89c4\u6027\u8bc4\u4f30\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#23","title":"2.3 \u4f18\u52bf","text":"<ul> <li>\u5f00\u653e\u6027: 100%\u5f00\u6e90,\u65e0\u9700\u62c5\u5fc3\u4f9b\u5e94\u5546\u9501\u5b9a\u3002</li> <li>\u7075\u6d3b\u6027:\u7075\u6d3b\u90e8\u7f72\u5404\u7c7bKubernetes\u53d1\u884c\u7248, Rancher\u3001Openshift\u3001EKS\u3001 GKE\u3001ACK\u3001 TKE\u3002</li> <li>\u53ef\u9760\u6027: 7\u5e74\u8fed\u4ee3,\u6210\u719f\u7a33\u5b9a\u4ea7\u54c1\u3002</li> <li>\u4e13\u4e1a\u6027:\u4e13\u4e1a\u652f\u6301\u670d\u52a1,\u4fdd\u969c\u4e1a\u52a1\u5b89\u5168\u53ef\u9760\u6301\u7eed\u8fd0\u884c\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#_2","title":"\u4e09 \u7ec4\u4ef6\u6784\u6210\u5373\u90e8\u7f72\u6a21\u5f0f","text":"<p>NeuVector \u8fd0\u884c\u65f6\u5bb9\u5668\u5b89\u5168\u65b9\u6848\u5305\u62ec\u56db\u79cd\u7c7b\u578b\u5b89\u5168\u5bb9\u5668\uff1aControllers\uff0cEnforcers\uff0cManagers\uff0cScanners\u3002</p> <p>\u5176\u80fd\u591f\u90e8\u7f72\u4e3a\u4e00\u4e2a Allinone \u7684\u7279\u6b8a\u5bb9\u5668\uff0c\u4e5f\u80fd\u5373\u5c06\u4e2a\u529f\u80fd\u7ec4\u5408\u5728\u4e00\u4e2a\u5bb9\u5668\u603b\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5728\u865a\u62df\u673a\u6216\u5355\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u88f8\u673a\u4e0a\u9762\u90e8\u7f72\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#31-controller","title":"3.1 Controller","text":"<p>Controller \u7ba1\u7406 NeuVector Enforcer \u5bb9\u5668\u96c6\u7fa4\u3002\u5b83\u8fd8\u4e3a\u7ba1\u7406\u63a7\u5236\u53f0\u63d0\u4f9b REST api\u3002\u867d\u7136\u5178\u578b\u7684\u6d4b\u8bd5\u90e8\u7f72\u53ea\u6709\u4e00\u4e2a Controller\uff0c\u4f46\u662f\u5efa\u8bae\u5728\u9ad8\u53ef\u7528\u6027\u914d\u7f6e\u4e2d\u4f7f\u7528\u591a\u4e2a Controller\u3002\u63a7\u5236\u5668\u662f Kubernetes Production \u90e8\u7f72\u793a\u4f8b yaml \u4e2d\u7684\u9ed8\u8ba4\u63a7\u5236\u5668\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#32-enforce","title":"3.2 Enforce","text":"<p>Enforcer \u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u5bb9\u5668\uff0c\u7528\u4e8e\u5f3a\u5236\u6267\u884c\u5b89\u5168\u7b56\u7565\u3002\u5e94\u8be5\u5728\u6bcf\u4e2a\u8282\u70b9(\u4e3b\u673a)\u4e0a\u90e8\u7f72\u4e00\u4e2a\u6267\u884c\u5668\uff0c\u4f8b\u5982\u4f5c\u4e3a\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\u96c6\u3002\u6ce8\u610f: \u5bf9\u4e8e Docker \u672c\u5730(\u975e Kubernetes)\u90e8\u7f72\uff0c\u6267\u884c\u5668\u5bb9\u5668\u548c\u63a7\u5236\u5668\u4e0d\u80fd\u90e8\u7f72\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a(\u4e0b\u9762\u7684 All-in-One \u60c5\u51b5\u9664\u5916)\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#33-manager","title":"3.3 Manager","text":"<p>Manager \u662f\u4e00\u4e2a\u65e0\u72b6\u6001\u5bb9\u5668\uff0c\u5b83\u4e3a\u7528\u6237\u63d0\u4f9b Web-UI\uff08\u4ec5\u9650 HTTPS\uff09\u548c CLI \u63a7\u5236\u53f0\u4ee5\u7ba1\u7406 NeuVector \u5b89\u5168\u89e3\u51b3\u65b9\u6848\u3002\u53ef\u4ee5\u6839\u636e\u9700\u8981\u90e8\u7f72\u591a\u4e2a Manager \u5bb9\u5668\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#34-scanner","title":"3.4 Scanner","text":"<p>\u626b\u63cf\u5668\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u5b83\u6267\u884c\u5bf9\u56fe\u50cf\u3001\u5bb9\u5668\u548c\u8282\u70b9\u7684\u6f0f\u6d1e\u548c\u987a\u5e94\u6027\u626b\u63cf\u3002\u5b83\u901a\u5e38\u4f5c\u4e3a\u4e00\u4e2a\u526f\u672c\u90e8\u7f72\uff0c\u5e76\u53ef\u4ee5\u6269\u5927\u5230\u6240\u9700\u7684\u8bb8\u591a\u5e76\u884c\u626b\u63cf\u4eea\uff0c\u4ee5\u63d0\u9ad8\u626b\u63cf\u6027\u80fd\u3002Controller \u4ee5\u5faa\u73af\u7684\u65b9\u5f0f\u5c06\u626b\u63cf\u4f5c\u4e1a\u5206\u914d\u7ed9\u6bcf\u4e2a\u53ef\u7528\u7684\u626b\u63cf\u5668\uff0c\u76f4\u5230\u6240\u6709\u626b\u63cf\u5b8c\u6210\u3002\u626b\u63cf\u4eea\u8fd8\u5305\u542b\u6700\u65b0\u7684 CVE \u6570\u636e\u5e93\uff0c\u5e76\u7531 NeuVector \u5b9a\u671f\u66f4\u65b0\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#_3","title":"\u56db \u5e73\u53f0\u529f\u80fd","text":"<p>NeuVector\u63d0\u4f9b\u64cd\u4f5c\u7cfb\u7edf/Runtime/K8s/\u5bb9\u5668\u5e94\u7528\u4e09\u4e2a\u5c42\u9762\u5b89\u5168\u4e1a\u52a1\u8fdb\u884c\u4fdd\u62a4\u3002</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#_4","title":"\u4e94 \u90e8\u7f72","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#51-helm","title":"5.1 Helm\u90e8\u7f72","text":"<ul> <li>\u6dfb\u52a0 repo</li> </ul> <pre><code>helm repo add neuvector https://neuvector.github.io/neuvector-helm/\nhelm search repo neuvector/core\n</code></pre> <ul> <li> </li> </ul> <pre><code>kubectl create namespace neuvector\nkubectl create serviceaccount neuvector -n neuvector\nhelm install neuvector --namespace neuvector neuvector/core  --set registry=docker.io  --set\ntag=5.0.0-preview.1 --set=controller.image.repository=neuvector/controller.preview --\nset=enforcer.image.repository=neuvector/enforcer.preview --set \nmanager.image.repository=neuvector/manager.preview --set \ncve.scanner.image.repository=neuvector/scanner.preview --set cve.updater.image.repository=neuvector/updater.preview\n\n\nNAME: my-release\nLAST DEPLOYED: Wed Jan 19 21:04:03 2022\nNAMESPACE: neuvector\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nGet the NeuVector URL by running these commands:\n  NODE_PORT=$(kubectl get --namespace neuvector -o jsonpath=\"{.spec.ports[0].nodePort}\" services neuvector-service-webui)\n  NODE_IP=$(kubectl get nodes --namespace neuvector -o jsonpath=\"{.items[0].status.addresses[0].address}\")\n  echo https://$NODE_IP:$NODE_PORT\n</code></pre> <p>Helm-chart \u53c2\u6570\u67e5\u770b\uff1a</p> <p>https://github.com/neuvector/neuvector-helm/tree/master/charts/core</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#kubernetes","title":"Kubernetes\u90e8\u7f72","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#52","title":"5.2 \u8d44\u6e90\u6e05\u5355\u90e8\u7f72","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#521","title":"5.2.1 \u5b89\u88c5\u73af\u5883","text":"<pre><code>\u8f6f\u4ef6\u7248\u672c\uff1a\nKubernetes\uff1a1.20.14\nDocker\uff1a19.03.15\nNeuVector\uff1a5.0.0-preview.1\n</code></pre>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#522","title":"5.2.2 \u5f00\u59cb\u6267\u884c\u5b89\u88c5","text":"<ul> <li>\u521b\u5efa namespace</li> </ul> <pre><code>kubectl create namespace neuvector\n</code></pre> <ul> <li>\u90e8\u7f72 CRD( Kubernetes 1.19+ \u7248\u672c)</li> </ul> <pre><code>kubectl apply -f https://raw.githubusercontent.com/neuvector/manifests/main/kubernetes/crd-k8s-1.19.yaml\n</code></pre> <ul> <li>\u90e8\u7f72 CRD(Kubernetes 1.18\u6216\u66f4\u4f4e\u7248\u672c)</li> </ul> <pre><code>kubectl apply -f https://raw.githubusercontent.com/neuvector/manifests/main/kubernetes/crd-k8s-1.16.yaml\n</code></pre> <ul> <li>\u914d\u7f6e RBAC</li> </ul> <pre><code>kubectl create clusterrole neuvector-binding-app --verb=get,list,watch,update --resource=nodes,pods,services,namespaces\nkubectl create clusterrole neuvector-binding-rbac --verb=get,list,watch --resource=rolebindings.rbac.authorization.k8s.io,roles.rbac.authorization.k8s.io,clusterrolebindings.rbac.authorization.k8s.io,clusterroles.rbac.authorization.k8s.io\nkubectl create clusterrolebinding neuvector-binding-app --clusterrole=neuvector-binding-app --serviceaccount=neuvector:default\nkubectl create clusterrolebinding neuvector-binding-rbac --clusterrole=neuvector-binding-rbac --serviceaccount=neuvector:default\nkubectl create clusterrole neuvector-binding-admission --verb=get,list,watch,create,update,delete --resource=validatingwebhookconfigurations,mutatingwebhookconfigurations\nkubectl create clusterrolebinding neuvector-binding-admission --clusterrole=neuvector-binding-admission --serviceaccount=neuvector:default\nkubectl create clusterrole neuvector-binding-customresourcedefinition --verb=watch,create,get --resource=customresourcedefinitions\nkubectl create clusterrolebinding  neuvector-binding-customresourcedefinition --clusterrole=neuvector-binding-customresourcedefinition --serviceaccount=neuvector:default\nkubectl create clusterrole neuvector-binding-nvsecurityrules --verb=list,delete --resource=nvsecurityrules,nvclustersecurityrules\nkubectl create clusterrolebinding neuvector-binding-nvsecurityrules --clusterrole=neuvector-binding-nvsecurityrules --serviceaccount=neuvector:default\nkubectl create clusterrolebinding neuvector-binding-view --clusterrole=view --serviceaccount=neuvector:default\nkubectl create rolebinding neuvector-admin --clusterrole=admin --serviceaccount=neuvector:default -n neuvector\n</code></pre> <ul> <li>\u68c0\u67e5\u662f\u5426\u6709\u4ee5\u4e0b RBAC \u5bf9\u8c61</li> </ul> <pre><code>kubectl get clusterrolebinding  | grep neuvectorkubectl get rolebinding -n neuvector | grep neuvector\nkubectl get clusterrolebinding  | grep neuvector\nneuvector-binding-admission                            ClusterRole/neuvector-binding-admission                            44hneuvector-binding-app                                  ClusterRole/neuvector-binding-app                                  44hneuvector-binding-customresourcedefinition             ClusterRole/neuvector-binding-customresourcedefinition             44hneuvector-binding-nvadmissioncontrolsecurityrules      ClusterRole/neuvector-binding-nvadmissioncontrolsecurityrules      44hneuvector-binding-nvsecurityrules                      ClusterRole/neuvector-binding-nvsecurityrules                      44hneuvector-binding-nvwafsecurityrules                   ClusterRole/neuvector-binding-nvwafsecurityrules                   44hneuvector-binding-rbac                                 ClusterRole/neuvector-binding-rbac                                 44hneuvector-binding-view                                 ClusterRole/view                                                   44h\n</code></pre> <pre><code>kubectl get rolebinding -n neuvector | grep neuvectorneuvector-admin         ClusterRole/admin            44hneuvector-binding-psp   Role/neuvector-binding-psp   44h\n</code></pre> <ul> <li>\u90e8\u7f72 NeuVector</li> <li>\u5e95\u5c42 Runtime \u4e3a Docker</li> </ul> <pre><code>kubectl apply -f https://raw.githubusercontent.com/neuvector/manifests/main/kubernetes/5.0.0/neuvector-docker-k8s.yaml\n</code></pre> <p>\u5e95\u5c42 Runtime \u4e3a Containerd\uff08\u5bf9\u4e8e k3s \u548c rke2 \u53ef\u4ee5\u4f7f\u7528\u6b64 yaml \u6587\u4ef6\uff09</p> <pre><code>kubectl apply -f https://raw.githubusercontent.com/neuvector/manifests/main/kubernetes/5.0.0/neuvector-containerd-k8s.yaml\n</code></pre> <p>1.21 \u4ee5\u4e0b\u7684 Kubernetes \u7248\u672c\u4f1a\u63d0\u793a\u4ee5\u4e0b\u9519\u8bef\uff0c\u5c06 yaml \u6587\u4ef6\u4e0b\u8f7d\u5c06 batch/v1 \u4fee\u6539\u4e3a batch/v1beta1</p> <pre><code>error: unable to recognize \"https://raw.githubusercontent.com/neuvector/manifests/main/kubernetes/5.0.0/neuvector-docker-k8s.yaml\": no matches for kind \"CronJob\" in version \"batch/v1\"\n</code></pre> <p>1.20.x cronjob \u8fd8\u5904\u4e8e beta \u9636\u6bb5\uff0c1.21 \u7248\u672c\u5f00\u59cb cronjob \u624d\u6b63\u5f0f GA \u3002</p> <p>\u9ed8\u8ba4\u90e8\u7f72web-ui\u4f7f\u7528\u7684\u662floadblance\u7c7b\u578b\u7684Service\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8bbf\u95ee\u4fee\u6539\u4e3aNodePort\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 Ingress \u5bf9\u5916\u63d0\u4f9b\u670d\u52a1</p> <pre><code>kubectl patch  svc neuvector-service-webui  -n neuvector --type='json' -p '[{\"op\":\"replace\",\"path\":\"/spec/type\",\"value\":\"NodePort\"},{\"op\":\"add\",\"path\":\"/spec/ports/0/nodePort\",\"value\":30888}]'\n</code></pre> <p>\u8bbf\u95ee https://node_ip:30888</p> <p>\u9ed8\u8ba4\u5bc6\u7801\u4e3a admin/admin</p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#523","title":"5.2.3 \u8bbf\u95ee","text":"<p>\u7531\u4e8e\u6211\u91c7\u7528minikube\u90e8\u7f72\uff0c\u4e34\u65f6\u83dc\u54df\u54e6\u90a3\u4e2aport-forward\u8bbf\u95ee\u6d4b\u8bd5\u3002</p> <pre><code>kubectl port-forward --address 0.0.0.0 -n neuvector service/neuvector-service-webui 22222:8443\n</code></pre> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#_5","title":"\u516d \u529f\u80fd\u6d4b\u8bd5","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#61-dashboard","title":"6.1 Dashboard","text":"<p>\u5728neuvector\u7684dashboard\u9875\u9762\uff0c\u9664\u4e86\u6709\u96c6\u7fa4\u7684\u5065\u5eb7\u4f53\u68c0\uff0c\u8fd8\u6709\u5165\u53e3\u548c\u51fa\u53e3\u66b4\u9732\uff0c\u5df2\u7ecfTOP\u5b89\u5168\u4e8b\u4ef6/\u8d44\u6e90/\u7b56\u7565\u7b49\u3002</p> <p></p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#62-network-activity","title":"6.2 Network Activity","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#63","title":"6.3 \u8d44\u4ea7","text":""},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#631","title":"6.3.1 \u5e73\u53f0","text":"<p>\u5728\u5e73\u53f0\u6a21\u5757\uff0c\u53ef\u4ee5\u770b\u5230\u5f53\u524d\u96c6\u7fa4\u8fd0\u884c\u7684K8s\u7248\u672c\uff0c\u53ca\u5f53\u524d\u96c6\u7fa4\u4e2d\u5b58\u5728\u7684CVE\u6f0f\u6d1e\u53ca\u8be6\u7ec6\u6f0f\u6d1e\u4fe1\u606f\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#632","title":"6.3.2 \u4e3b\u673a","text":"<p>\u5728\u6539\u6a21\u5757\u53ef\u4ee5\u770b\u5230\u8fd0\u884cK8s\u96c6\u7fa4\u7684Node\u8282\u70b9\u8d44\u6e90\u4fe1\u606f\uff0c\u4fdd\u62a4\u64cd\u4f5c\u7cfb\u7edf\u53ca\u8d44\u6e90\u8f6f\u4ef6\u7248\u672c\u7b49\u4fe1\u606f\u3002</p> <p></p> <ul> <li>\u5408\u89c4\u4fe1\u606f</li> </ul> <p></p> <ul> <li>\u6f0f\u6d1e\u4fe1\u606f</li> </ul> <p></p> <ul> <li>\u5bb9\u5668\u4fe1\u606f</li> </ul> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#633","title":"6.3.3 \u5bb9\u5668","text":"<p>\u8be5\u6a21\u5757\u53ef\u4ee5\u770b\u5230\u96c6\u7fa4\u8fd0\u884c\u7684\u6240\u6709\u5bb9\u5668\uff0c\u5e76\u53ef\u4ee5\u5bf9\u5355\u4e2a\u5bb9\u5668\u8fdb\u884c\u67e5\u8be2\u8be6\u7ec6\u4fe1\u606f\uff0c\u6f0f\u6d1e\u4fe1\u606f\uff0c\u5bb9\u5668\u8fdb\u7a0b\uff0c\u5bb9\u5668\u5b9e\u65f6\u76d1\u63a7\u7b49\u3002</p> <p></p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#634","title":"6.3.4 \u955c\u50cf\u5e93","text":"<p>\u955c\u50cf\u5e93\u53ef\u4ee5\u6dfb\u52a0\u516c\u6709\u4e91\u955c\u50cf\uff0c\u6216\u81ea\u5efa\u955c\u50cf\uff0c\u5bf9\u5176\u4e2d\u5b58\u50a8\u7684\u955c\u50cf\u8fdb\u884c\u5b89\u5168\u626b\u63cf\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#635","title":"6.3.5 \u7cfb\u7edf\u7ec4\u4ef6","text":"<p>\u8be5\u6a21\u5757\u662f\u5bf9NeeuVector\u7684\u7cfb\u7edf\u81ea\u5df1\u4f8b\u5982\u63a7\u5236\u5668/\u626b\u63cf\u5668/\u4ee3\u7406\u5668\u8fdb\u884c\u4fe1\u606f\u5c55\u793a\u548c\u76d1\u63a7\u7edf\u8ba1\u3002</p> <p></p> <p></p>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#64","title":"6.4 \u7b56\u7565","text":"<ul> <li>\u51c6\u5165\u63a7\u5236</li> </ul> <ul> <li>\u7b56\u7565\u4e86</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#65","title":"6.5 \u5b89\u5168\u9690\u60a3","text":"<ul> <li>\u6f0f\u6d1e</li> </ul> <ul> <li>\u5408\u89c4</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#67","title":"6.7 \u901a\u77e5/\u8bbe\u7f6e","text":"<ul> <li>\u98ce\u9669\u62a5\u544a</li> </ul> <ul> <li>\u4e8b\u4ef6</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#_6","title":"\u5176\u4ed6","text":"<ul> <li>NeuVector\u652f\u6301\u591a\u96c6\u7fa4\u7ba1\u7406\u3002</li> <li>\u652f\u6301\u4e30\u5bcc\u7684\u7b56\u7565\u53ca\u62a5\u544a\u5bfc\u51fa\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/#_7","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://open-docs.neuvector.com/</li> <li>https://mp.weixin.qq.com/s/iUpDaokUKt4Uf3m9aNRRVQ</li> <li>https://github.com/neuvector/neuvector</li> <li>https://github.com/neuvector/manager</li> <li>https://mp.weixin.qq.com/s/kOGNT2L2HVMibyyM6Ri2KQ</li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/","title":"Dockerfile \u6700\u4f73\u5b9e\u8df5","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_1","title":"\u4e00 \u51cf\u5c11\u6784\u5efa\u65f6\u95f4","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#11","title":"1.1 \u6784\u5efa\u987a\u5e8f\u5f71\u54cd\u7f13\u5b58\u5229\u7528\u7387","text":"<p>\u628a\u4e0d\u9700\u8981\u7ecf\u5e38\u66f4\u6539\u7684\u884c\u653e\u5230\u6700\u524d\u9762\uff0c\u66f4\u6539\u6700\u9891\u7e41\u7684\u884c\u653e\u5230\u6700\u540e\u9762</p> <p>\u955c\u50cf\u7684\u6784\u5efa\u987a\u5e8f\u5f88\u91cd\u8981\uff0c\u5f53\u4f60\u5411 Dockerfile \u4e2d\u6dfb\u52a0\u6587\u4ef6\uff0c\u6216\u8005\u4fee\u6539\u5176\u4e2d\u7684\u67d0\u4e00\u884c\u65f6\uff0c\u90a3\u4e00\u90e8\u5206\u7684\u7f13\u5b58\u5c31\u4f1a\u5931\u6548\uff0c\u8be5\u7f13\u5b58\u7684\u540e\u7eed\u6b65\u9aa4\u90fd\u4f1a\u4e2d\u65ad\uff0c\u9700\u8981\u91cd\u65b0\u6784\u5efa\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#12","title":"1.2 \u53ea\u62f7\u8d1d\u9700\u8981\u6587\u4ef6\uff0c\u9632\u6b62\u7f13\u5b58\u6ea2\u51fa","text":"<p>\u5f53\u62f7\u8d1d\u6587\u4ef6\u5230\u955c\u50cf\u4e2d\u65f6\uff0c\u5c3d\u91cf\u53ea\u62f7\u8d1d\u9700\u8981\u7684\u6587\u4ef6\uff0c\u5207\u5fcc\u4f7f\u7528 COPY . \u6307\u4ee4\u62f7\u8d1d\u6574\u4e2a\u76ee\u5f55\u3002\u5982\u679c\u88ab\u62f7\u8d1d\u7684\u6587\u4ef6\u5185\u5bb9\u53d1\u751f\u4e86\u66f4\u6539\uff0c\u7f13\u5b58\u5c31\u4f1a\u88ab\u7834\u574f\u3002\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u955c\u50cf\u4e2d\u53ea\u9700\u8981\u6784\u5efa\u597d\u7684 jar \u5305\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u62f7\u8d1d\u8fd9\u4e2a\u6587\u4ef6\u5c31\u884c\u4e86\uff0c\u8fd9\u6837\u5373\u4f7f\u5176\u4ed6\u4e0d\u76f8\u5173\u7684\u6587\u4ef6\u53d1\u751f\u4e86\u66f4\u6539\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u7f13\u5b58\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#13","title":"1.3 \u6700\u5c0f\u5316\u53ef\u7f13\u5b58\u7684\u6267\u884c\u5c42","text":"<p>\u6bcf\u4e00\u4e2aRUN\u6307\u4ee4\u90fd\u4f1a\u88ab\u770b\u4f5c\u53ef\u7f13\u5b58\u7684\u6267\u884c\u5355\u5143\uff0c\u592a\u591a\u7684RUN\u6307\u4ee4\u4f1a\u589e\u52a0\u955c\u50cf\u7684\u5c42\u6570\uff0c\u589e\u5927\u955c\u50cf\u7684\u4f53\u79ef\uff0c\u800c\u5c06\u6240\u6709\u7684\u6307\u4ee4\u90fd\u653e\u5728\u4e00\u4e2aRUN\u6307\u4ee4\u53c8\u4f1a\u7834\u574f\u7f13\u5b58\uff0c\u4ece\u800c\u5ef6\u7f13\u5f00\u653e\u5468\u671f\uff0c\u4e00\u822c\u90fd\u4f1a\u5148\u66f4\u65b0\u8f6f\u4ef6\u7d22\u5f15\u4fe1\u606f\uff0c\u7136\u540e\u518d\u5b89\u88c5\u8f6f\u4ef6\u3002\u63a8\u8350\u5c06\u66f4\u65b0\u7d22\u5f15\u548c\u5b89\u88c5\u8f6f\u4ef6\u653e\u5728\u540c\u4e00\u4e2a RUN \u6307\u4ee4\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u5f62\u6210\u4e00\u4e2a\u53ef\u7f13\u5b58\u7684\u6267\u884c\u5355\u5143\uff0c\u5426\u5219\u4f60\u53ef\u80fd\u4f1a\u5b89\u88c5\u65e7\u7684\u8f6f\u4ef6\u5305\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#14","title":"1.4 \u5220\u9664\u6bd4\u5fc5\u8981\u7684\u4f9d\u8d56","text":"<p>\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u4f9d\u8d56\uff0c\u4e0d\u8981\u5b89\u88c5\u8c03\u8bd5\u5de5\u5177\u3002\u5982\u679c\u5b9e\u5728\u9700\u8981\u8c03\u8bd5\u5de5\u5177\uff0c\u53ef\u4ee5\u5728\u5bb9\u5668\u8fd0\u884c\u4e4b\u540e\u518d\u5b89\u88c5\u3002\u67d0\u4e9b\u5305\u7ba1\u7406\u5de5\u5177\uff08\u5982 apt\uff09\u9664\u4e86\u5b89\u88c5\u7528\u6237\u6307\u5b9a\u7684\u5305\u4e4b\u5916\uff0c\u8fd8\u4f1a\u5b89\u88c5\u63a8\u8350\u7684\u5305\uff0c\u8fd9\u4f1a\u65e0\u7f18\u65e0\u6545\u589e\u52a0\u955c\u50cf\u7684\u4f53\u79ef\u3002apt \u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u53c2\u6570 -\u2013no-install-recommends \u6765\u786e\u4fdd\u4e0d\u4f1a\u5b89\u88c5\u4e0d\u9700\u8981\u7684\u4f9d\u8d56\u9879\u3002\u5982\u679c\u786e\u5b9e\u9700\u8981\u67d0\u4e9b\u4f9d\u8d56\u9879\uff0c\u8bf7\u5728\u540e\u9762\u624b\u52a8\u6dfb\u52a0\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#15","title":"1.5 \u5220\u9664\u7ba1\u7406\u5de5\u5177\u7684\u7f13\u5b58","text":"<p>\u5305\u7ba1\u7406\u5de5\u5177\u4f1a\u7ef4\u62a4\u81ea\u5df1\u7684\u7f13\u5b58\uff0c\u8fd9\u4e9b\u7f13\u5b58\u4f1a\u4fdd\u7559\u5728\u955c\u50cf\u6587\u4ef6\u4e2d\uff0c\u63a8\u8350\u7684\u5904\u7406\u65b9\u6cd5\u662f\u5728\u6bcf\u4e00\u4e2a RUN \u6307\u4ee4\u7684\u672b\u5c3e\u5220\u9664\u7f13\u5b58\u3002\u5982\u679c\u4f60\u5728\u4e0b\u4e00\u6761\u6307\u4ee4\u4e2d\u5220\u9664\u7f13\u5b58\uff0c\u4e0d\u4f1a\u51cf\u5c0f\u955c\u50cf\u7684\u4f53\u79ef\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_2","title":"\u4e8c \u53ef\u7ef4\u62a4\u6027","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#21","title":"2.1 \u5c3d\u53ef\u80fd\u4f7f\u7528\u5b98\u65b9\u955c\u50cf","text":"<p>\u4f7f\u7528\u5b98\u65b9\u955c\u50cf\u53ef\u4ee5\u8282\u7701\u5927\u91cf\u7684\u7ef4\u62a4\u65f6\u95f4\uff0c\u56e0\u4e3a\u5b98\u65b9\u955c\u50cf\u7684\u6240\u6709\u5b89\u88c5\u6b65\u9aa4\u90fd\u4f7f\u7528\u4e86\u6700\u4f73\u5b9e\u8df5\u3002\u5982\u679c\u4f60\u6709\u591a\u4e2a\u9879\u76ee\uff0c\u53ef\u4ee5\u5171\u4eab\u8fd9\u4e9b\u955c\u50cf\u5c42\uff0c\u56e0\u4e3a\u4ed6\u4eec\u90fd\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u57fa\u7840\u955c\u50cf\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#22","title":"2.2 \u4f7f\u7528\u66f4\u5177\u4f53\u7684\u6807\u7b7e","text":"<p>\u57fa\u7840\u955c\u50cf\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528 latest \u6807\u7b7e\u3002\u867d\u7136\u8fd9\u5f88\u65b9\u4fbf\uff0c\u4f46\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0clatest \u955c\u50cf\u53ef\u80fd\u4f1a\u53d1\u751f\u91cd\u5927\u53d8\u5316\u3002\u56e0\u6b64\u5728 Dockerfile \u4e2d\u6700\u597d\u6307\u5b9a\u57fa\u7840\u955c\u50cf\u7684\u5177\u4f53\u6807\u7b7e\u3002\u6211\u4eec\u4f7f\u7528 openjdk \u4f5c\u4e3a\u793a\u4f8b\uff0c\u6307\u5b9a\u6807\u7b7e\u4e3a 8\u3002\u5176\u4ed6\u66f4\u591a\u6807\u7b7e\u8bf7\u67e5\u770b\u5b98\u65b9\u4ed3\u5e93\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#23","title":"2.3 \u4f7f\u7528\u4f53\u79ef\u66f4\u5c0f\u7684\u57fa\u7840\u955c\u50cf","text":"<p>\u57fa\u7840\u955c\u50cf\u7684\u6807\u7b7e\u98ce\u683c\u4e0d\u540c\uff0c\u955c\u50cf\u4f53\u79ef\u5c31\u4f1a\u4e0d\u540c\u3002slim \u98ce\u683c\u7684\u955c\u50cf\u662f\u57fa\u4e8e Debian \u53d1\u884c\u7248\u5236\u4f5c\u7684\uff0c\u800c alpine \u98ce\u683c\u7684\u955c\u50cf\u662f\u57fa\u4e8e\u4f53\u79ef\u66f4\u5c0f\u7684 Alpine Linux \u53d1\u884c\u7248\u5236\u4f5c\u7684\u3002\u5176\u4e2d\u4e00\u4e2a\u660e\u663e\u7684\u533a\u522b\u662f\uff1aDebian \u4f7f\u7528\u7684\u662f GNU \u9879\u76ee\u6240\u5b9e\u73b0\u7684 C \u8bed\u8a00\u6807\u51c6\u5e93\uff0c\u800c Alpine \u4f7f\u7528\u7684\u662f Musl C \u6807\u51c6\u5e93\uff0c\u5b83\u88ab\u8bbe\u8ba1\u7528\u6765\u66ff\u4ee3 GNU C \u6807\u51c6\u5e93\uff08glibc\uff09\u7684\u66ff\u4ee3\u54c1\uff0c\u7528\u4e8e\u5d4c\u5165\u5f0f\u64cd\u4f5c\u7cfb\u7edf\u548c\u79fb\u52a8\u8bbe\u5907\u3002\u56e0\u6b64\u4f7f\u7528 Alpine \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4f1a\u9047\u5230\u517c\u5bb9\u6027\u95ee\u9898\u3002\u4ee5 openjdk \u4e3a\u4f8b\uff0cjre \u98ce\u683c\u7684\u955c\u50cf\u53ea\u5305\u542b Java \u8fd0\u884c\u65f6\uff0c\u4e0d\u5305\u542b SDK\uff0c\u8fd9\u4e48\u505a\u4e5f\u53ef\u4ee5\u5927\u5927\u51cf\u5c11\u955c\u50cf\u4f53\u79ef\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#24-label","title":"2.4 \u7ed9\u955c\u50cf\u8bbe\u7f6e\u5408\u9002\u7684LABEL","text":"<p>\u6bcf\u4e00\u4e2a\u5bf9\u8c61\u90fd\u5305\u542b\u76f8\u5e94\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u6bd4\u5982 Docker \u955c\u50cf\u5c31\u5305\u542b\u4f5c\u8005\u3001\u5927\u5c0f\u7b49\u7b49\u5143\u6570\u636e\u4fe1\u606f\u3002\u5728\u4f7f\u7528\u955c\u50cf\u7684\u65f6\u5019\uff0c\u5f80\u5f80\u4f1a\u901a\u8fc7\u8fd9\u4e9b\u5143\u6570\u636e\u4fe1\u606f\u6765\u67e5\u627e\u9002\u5408\u7684\u955c\u50cf\u6765\u7528\u4e8e\u5f00\u53d1\u6216\u6d4b\u8bd5\uff0c\u800c\u4e0d\u5355\u5355\u53ea\u662f\u901a\u8fc7\u540d\u5b57\u53bb\u68c0\u7d22\u3002</p> <p>\u5728 Dockerfile \u4e2d\u53ef\u4ee5\u4f7f\u7528 Label \u547d\u4ee4\u6765\u4e3a\u955c\u50cf\u589e\u52a0 Label\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u67e5\u770b\u5230 Label \u53ca\u4f7f\u7528 Label \u8fdb\u884c\u7b5b\u9009:</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_3","title":"\u4e09 \u91cd\u590d\u5229\u7528","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#31","title":"3.1 \u5728\u4e00\u81f4\u7684\u73af\u5883\u4e2d\u4ece\u6e90\u7801\u6784\u5efa","text":"<p>\u9996\u5148\u5e94\u8be5\u786e\u5b9a\u6784\u5efa\u5e94\u7528\u6240\u9700\u7684\u6240\u6709\u4f9d\u8d56\uff0c\u672c\u6587\u7684\u793a\u4f8b Java \u5e94\u7528\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981 Maven \u548c JDK\uff0c\u6240\u4ee5\u57fa\u7840\u955c\u50cf\u5e94\u8be5\u9009\u62e9\u5b98\u65b9\u7684\u4f53\u79ef\u6700\u5c0f\u7684 maven \u955c\u50cf\uff0c\u8be5\u955c\u50cf\u4e5f\u5305\u542b\u4e86 JDK\u3002\u5982\u679c\u4f60\u9700\u8981\u5b89\u88c5\u66f4\u591a\u4f9d\u8d56\uff0c\u53ef\u4ee5\u5728 RUN \u6307\u4ee4\u4e2d\u6dfb\u52a0\u3002pom.xml \u6587\u4ef6\u548c src \u6587\u4ef6\u5939\u9700\u8981\u88ab\u590d\u5236\u5230\u955c\u50cf\u4e2d\uff0c\u56e0\u4e3a\u6700\u540e\u6267\u884c mvn package \u547d\u4ee4\uff08-e \u53c2\u6570\u7528\u6765\u663e\u793a\u9519\u8bef\uff0c-B \u53c2\u6570\u8868\u793a\u4ee5\u975e\u4ea4\u4e92\u5f0f\u7684\u201c\u6279\u5904\u7406\u201d\u6a21\u5f0f\u8fd0\u884c\uff09\u6253\u5305\u7684\u65f6\u5019\u4f1a\u7528\u5230\u8fd9\u4e9b\u4f9d\u8d56\u6587\u4ef6\u3002</p> <p>\u867d\u7136\u73b0\u5728\u6211\u4eec\u89e3\u51b3\u4e86\u73af\u5883\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u4f46\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\uff1a\u6bcf\u6b21\u4ee3\u7801\u66f4\u6539\u4e4b\u540e\uff0c\u90fd\u8981\u91cd\u65b0\u83b7\u53d6\u4e00\u904d pom.xml \u4e2d\u63cf\u8ff0\u7684\u6240\u6709\u4f9d\u8d56\u9879\u3002\u4e0b\u9762\u6211\u4eec\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#32","title":"3.2 \u5728\u5355\u72ec\u7684\u6b65\u9aa4\u4e2d\u83b7\u53d6\u4f9d\u8d56\u9879\u76ee","text":"<p>\u7ed3\u5408\u524d\u9762\u63d0\u5230\u7684\u7f13\u5b58\u673a\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u83b7\u53d6\u4f9d\u8d56\u9879\u8fd9\u4e00\u6b65\u53d8\u6210\u53ef\u7f13\u5b58\u5355\u5143\uff0c\u53ea\u8981 pom.xml \u6587\u4ef6\u7684\u5185\u5bb9\u6ca1\u6709\u53d8\u5316\uff0c\u65e0\u8bba\u4ee3\u7801\u5982\u4f55\u66f4\u6539\uff0c\u90fd\u4e0d\u4f1a\u7834\u574f\u8fd9\u4e00\u5c42\u7684\u7f13\u5b58\u3002\u4e0a\u56fe\u4e2d\u4e24\u4e2a COPY \u6307\u4ee4\u4e2d\u95f4\u7684 RUN \u6307\u4ee4\u7528\u6765\u544a\u8bc9 Maven \u53ea\u83b7\u53d6\u4f9d\u8d56\u9879\u3002</p> <p>\u73b0\u5728\u53c8\u9047\u5230\u4e86\u4e00\u4e2a\u65b0\u95ee\u9898\uff1a\u8ddf\u4e4b\u524d\u76f4\u63a5\u62f7\u8d1d jar \u5305\u76f8\u6bd4\uff0c\u955c\u50cf\u4f53\u79ef\u53d8\u5f97\u66f4\u5927\u4e86\uff0c\u56e0\u4e3a\u5b83\u5305\u542b\u4e86\u5f88\u591a\u8fd0\u884c\u5e94\u7528\u65f6\u4e0d\u9700\u8981\u7684\u6784\u5efa\u4f9d\u8d56\u9879\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#33","title":"3.3 \u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa\u6765\u5220\u9664\u6784\u5efa\u65f6\u7684\u4f9d\u8d56","text":"<p>\u591a\u9636\u6bb5\u6784\u5efa\u53ef\u4ee5\u7531\u591a\u4e2a FROM \u6307\u4ee4\u8bc6\u522b\uff0c\u6bcf\u4e00\u4e2a FROM \u8bed\u53e5\u8868\u793a\u4e00\u4e2a\u65b0\u7684\u6784\u5efa\u9636\u6bb5\uff0c\u9636\u6bb5\u540d\u79f0\u53ef\u4ee5\u7528 AS \u53c2\u6570\u6307\u5b9a\u3002\u672c\u4f8b\u4e2d\u6307\u5b9a\u7b2c\u4e00\u9636\u6bb5\u7684\u540d\u79f0\u4e3a builder\uff0c\u5b83\u53ef\u4ee5\u88ab\u7b2c\u4e8c\u9636\u6bb5\u76f4\u63a5\u5f15\u7528\u3002\u4e24\u4e2a\u9636\u6bb5\u73af\u5883\u4e00\u81f4\uff0c\u5e76\u4e14\u7b2c\u4e00\u9636\u6bb5\u5305\u542b\u6240\u6709\u6784\u5efa\u4f9d\u8d56\u9879\u3002</p> <p>\u7b2c\u4e8c\u9636\u6bb5\u662f\u6784\u5efa\u6700\u7ec8\u955c\u50cf\u7684\u6700\u540e\u9636\u6bb5\uff0c\u5b83\u5c06\u5305\u62ec\u5e94\u7528\u8fd0\u884c\u65f6\u7684\u6240\u6709\u5fc5\u8981\u6761\u4ef6\uff0c\u672c\u4f8b\u662f\u57fa\u4e8e Alpine \u7684\u6700\u5c0f JRE \u955c\u50cf\u3002\u4e0a\u4e00\u4e2a\u6784\u5efa\u9636\u6bb5\u867d\u7136\u4f1a\u6709\u5927\u91cf\u7684\u7f13\u5b58\uff0c\u4f46\u4e0d\u4f1a\u51fa\u73b0\u5728\u7b2c\u4e8c\u9636\u6bb5\u4e2d\u3002\u4e3a\u4e86\u5c06\u6784\u5efa\u597d\u7684 jar \u5305\u6dfb\u52a0\u5230\u6700\u7ec8\u7684\u955c\u50cf\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 COPY --from=STAGE_NAME \u6307\u4ee4\uff0c\u5176\u4e2d STAGE_NAME \u662f\u4e0a\u4e00\u6784\u5efa\u9636\u6bb5\u7684\u540d\u79f0\u3002</p> <p></p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_4","title":"\u56db \u6784\u5efa","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#41","title":"4.1 \u5206\u9636\u6bb5\u6784\u5efa","text":"<p>\u6784\u5efa\u955c\u50cf\u6700\u5927\u7684\u6311\u6218\u83ab\u8fc7\u4e8e\u9632\u6b62\u955c\u50cf\u8fc7\u5927\uff0c\u9020\u6210\u5b9e\u9645\u8fd0\u884c\u65f6\u7531\u4e8e\u5e76\u53d1\u800c\u5bfc\u81f4\u62c9\u53d6\u6027\u80fd\u95ee\u9898\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u4e2a\u6311\u6218\uff0c\u5f88\u591a\u8f6c\u578b\u5230\u5bb9\u5668\u7684\u56e2\u961f\u91c7\u7528\u4e24\u4e2a Dockerfile\uff0c\u4e00\u4e2a\u8d1f\u8d23\u5f00\u53d1\u73af\u5883\u7684\u955c\u50cf\u6784\u5efa\uff0c\u4e00\u4e2a\u8d1f\u8d23\u751f\u4ea7\u73af\u5883\u7684\u955c\u50cf\u6784\u5efa\u3002\u5f00\u53d1\u955c\u50cf\u5305\u542b\u4e86\u4ee3\u7801\u6784\u5efa\u6240\u9700\u8981\u7684\u73af\u5883\uff0c\u955c\u50cf\u5927\u5c0f\u81ea\u7136\u6bd4\u8f83\u5927\uff0c\u751f\u4ea7\u955c\u50cf\u4ec5\u5305\u542b\u5e94\u7528\u8fd0\u884c\u6240\u9700\u8981\u7684\u5185\u5bb9\uff0c\u662f\u5f88\u7cbe\u7b80\u7684\u4f53\u79ef\u5f88\u5c0f\u7684\u955c\u50cf\u3002</p> <p>Docker \u5206\u9636\u6bb5\u6784\u5efa\u5c31\u53ef\u4ee5\u5f88\u597d\u5730\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f7f\u7528\u5982\u4e0b\u7684 Dockerfile \u5373\u53ef\uff1a</p> <p></p> <p>\u6574\u4e2a Dockerfile \u6d41\u7a0b\u5f88\u6e05\u6670\uff0c\u4e5f\u4e0d\u5728\u9700\u8981\u989d\u5916\u7684 shell \u811a\u672c\u6765\u652f\u6301\u6574\u4e2a\u6d41\u7a0b\uff0c\u5e76\u4e14\u6211\u4eec\u53ef\u4ee5\u6307\u5b9a\u6267\u884c\u7684 stage\uff0c\u5177\u4f53\u547d\u4ee4\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/","title":"Docker\u5e95\u5c42\u539f\u7406","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_1","title":"\u4e00 \u80cc\u666f","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#11","title":"1.1 \u5bb9\u5668\u4e0e\u865a\u62df\u5316","text":"<p>Container(\u5bb9\u5668)\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u865a\u62df\u5316\u6280\u672f\uff0c\u5b83\u4e0d\u9700\u8981\u6a21\u62df\u786c\u4ef6\u521b\u5efa\u865a\u62df\u673a\u3002\u5728Linux\u7cfb\u7edf\u91cc\u9762\uff0c\u4f7f\u7528\u5230Linux kernel\u7684cgroups\uff0cnamespace(ipc\uff0cnetwork\uff0c user\uff0cpid\uff0cmount\uff09\uff0ccapability\u7b49\u7528\u4e8e\u9694\u79bb\u8fd0\u884c\u73af\u5883\u548c\u8d44\u6e90\u9650\u5236\u7684\u6280\u672f\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u5bb9\u5668\u3002</p> <p>\u5bb9\u5668\u6280\u672f\u65e9\u5c31\u51fa\u73b0\u3002\u4f8b\u5982Solaris Zones \u548c BSD jails \u5c31\u662f\u975e Linux \u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u5bb9\u5668\uff0c\u800c\u7528\u4e8e Linux \u7684\u5bb9\u5668\u6280\u672f\u4e5f\u6709\u5f88\u591a\u5982 Linux-Vserver\u3001OpenVZ \u548c FreeVPS\u3002\u867d\u7136\u8fd9\u4e9b\u6280\u672f\u90fd\u5df2\u7ecf\u6210\u719f\uff0c\u4f46\u662f\u8fd9\u4e9b\u89e3\u51b3\u65b9\u6848\u8fd8\u6ca1\u6709\u5c06\u5b83\u4eec\u7684\u5bb9\u5668\u652f\u6301\u96c6\u6210\u5230\u4e3b\u6d41 Linux \u5185\u6838\u3002\u603b\u7684\u6765\u8bf4\uff0c\u5bb9\u5668\u4e0d\u7b49\u540c\u4e8eDocker\uff0c\u5bb9\u5668\u66f4\u4e0d\u662f\u865a\u62df\u673a\u3002</p> <p>LXC\u9879\u76ee\u7531\u4e00\u4e2a Linux \u5185\u6838\u8865\u4e01\u548c\u4e00\u4e9b userspace \u5de5\u5177\u7ec4\u6210\uff0c\u5b83\u63d0\u4f9b\u4e00\u5957\u7b80\u5316\u7684\u5de5\u5177\u6765\u7ef4\u62a4\u5bb9\u5668\uff0c\u7528\u4e8e\u865a\u62df\u73af\u5883\u7684\u73af\u5883\u9694\u79bb\u3001\u8d44\u6e90\u9650\u5236\u4ee5\u53ca\u6743\u9650\u63a7\u5236\u3002LXC\u6709\u70b9\u7c7b\u4f3cchroot\uff0c\u4f46\u662f\u5b83\u6bd4chroot\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u9694\u79bb\u6027\u3002</p> <p>Docker\u6700\u521d\u76ee\u6807\u662f\u505a\u4e00\u4e2a\u7279\u6b8a\u7684LXC\u7684\u5f00\u6e90\u7cfb\u7edf\uff0c\u6700\u540e\u6162\u6162\u6f14\u53d8\u4e3a\u5b83\u81ea\u5df1\u7684\u4e00\u5957\u5bb9\u5668\u8fd0\u884c\u65f6\u73af\u5883\u3002Docker\u57fa\u4e8eLinux kernel\u7684CGroups\uff0cNamespace\uff0cUnionFileSystem\u7b49\u6280\u672f\u5c01\u88c5\u6210\u4e00\u79cd\u81ea\u5b9a\u4e49\u7684\u5bb9\u5668\u683c\u5f0f\uff0c\u7528\u4e8e\u63d0\u4f9b\u4e00\u6574\u5957\u865a\u62df\u8fd0\u884c\u73af\u5883\u3002\u6beb\u65e0\u7591\u95ee\uff0c\u8fd1\u4e9b\u5e74\u6765Docker\u5df2\u7ecf\u6210\u4e3a\u4e86\u5bb9\u5668\u6280\u672f\u7684\u4ee3\u540d\u8bcd\uff0c\u5982\u5176\u5b98\u7f51\u4ecb\u7ecd\u7684Docker is world's leading software containerization platform\u3002\u672c\u6587\u4f1a\u5148\u7b80\u5355\u4ecb\u7ecdDocker\u57fa\u7840\u6982\u5ff5\uff0c\u7136\u540e\u4f1a\u5206\u6790\u4e0bDocker\u80cc\u540e\u7528\u5230\u7684\u6280\u672f\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#namespace","title":"\u4e8c namespace","text":"<p>namespace\u9694\u79bb\uff1a</p> <ul> <li>IPC\uff1a\u4e3b\u673a\u540d\u53ca\u57df\u540d\uff0cCLONE_NEWIPC</li> <li>MNT\uff1a\u6302\u8f7d\u70b9\uff0c\u6587\u4ef6\u7cfb\u7edf</li> <li>NET\uff1a\u7f51\u7edc\u8bbe\u5907\uff0c\u7f51\u7edc\u534f\u8bae\u6808\uff0c\u7aef\u53e3\u7b49</li> <li>PID\uff1a\u8fdb\u7a0b\u7f16\u53f7</li> <li>USER\uff1a\u7528\u6237\u548c\u7ec4</li> <li>UTS\uff1a\u4e3b\u673a\u540d\u53ca\u57df\u540d\uff0cCLONE_NEWUTS</li> </ul> <p></p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#21-pid-namespace","title":"2.1 PID Namespace","text":"<p>\u5728\u5bb9\u5668\u4e2d\uff0c\u6709\u81ea\u5df1\u7684Pid namespace\uff0c\u56e0\u6b64\u6211\u4eec\u770b\u5230\u7684\u53ea\u6709PID\u4e3a1\u7684\u521d\u59cb\u8fdb\u7a0b\u4ee5\u53ca\u5b83\u7684\u5b50\u8fdb\u7a0b\uff0c\u800c\u5bbf\u4e3b\u673a\u7684\u5176\u4ed6\u8fdb\u7a0b\u5bb9\u5668\u5185\u662f\u770b\u4e0d\u5230\u7684\u3002\u901a\u5e38\u6765\u8bf4\uff0cLinux\u542f\u52a8\u540e\u5b83\u4f1a\u5148\u542f\u52a8\u4e00\u4e2aPID\u4e3a1\u7684\u8fdb\u7a0b\uff0c\u8fd9\u662f\u7cfb\u7edf\u8fdb\u7a0b\u6811\u7684\u6839\u8fdb\u7a0b\uff0c\u6839\u8fdb\u7a0b\u4f1a\u63a5\u7740\u521b\u5efa\u5b50\u8fdb\u7a0b\u6765\u521d\u59cb\u5316\u7cfb\u7edf\u670d\u52a1\u3002PID namespace\u5141\u8bb8\u5728\u65b0\u7684namespace\u521b\u5efa\u4e00\u68f5\u65b0\u7684\u8fdb\u7a0b\u6811\uff0c\u5b83\u53ef\u4ee5\u6709\u81ea\u5df1\u7684PID\u4e3a1\u7684\u8fdb\u7a0b\u3002\u5728PID namespace\u7684\u9694\u79bb\u4e0b\uff0c\u5b50\u8fdb\u7a0b\u540d\u5b57\u7a7a\u95f4\u65e0\u6cd5\u77e5\u9053\u7236\u8fdb\u7a0b\u540d\u5b57\u7a7a\u95f4\u7684\u8fdb\u7a0b\uff0c\u5982\u5728Docker\u5bb9\u5668\u4e2d\u65e0\u6cd5\u770b\u5230\u5bbf\u4e3b\u673a\u7684\u8fdb\u7a0b\uff0c\u800c\u7236\u8fdb\u7a0b\u540d\u5b57\u7a7a\u95f4\u53ef\u4ee5\u770b\u5230\u5b50\u8fdb\u7a0b\u540d\u5b57\u7a7a\u95f4\u7684\u6240\u6709\u8fdb\u7a0b\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#22-ns-namespace","title":"2.2 NS Namespace","text":"<p>NS Namespace\u7528\u4e8e\u9694\u79bb\u6302\u8f7d\u70b9\uff0c\u4e0d\u540cNS Namespace\u7684\u6302\u8f7d\u70b9\u4e92\u4e0d\u5f71\u54cd\u3002\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Mount Namespace\u6548\u679c\u6709\u70b9\u7c7b\u4f3cchroot\uff0c\u4e0d\u8fc7\u5b83\u9694\u79bb\u7684\u6bd4chroot\u66f4\u52a0\u5b8c\u5168\u3002\u8fd9\u662f\u5386\u53f2\u4e0a\u7684\u7b2c\u4e00\u4e2aLinux Namespace\uff0c\u7531\u6b64\u5f97\u5230\u4e86 NS \u8fd9\u4e2a\u540d\u5b57\u800c\u4e0d\u662f\u7528\u7684 Mount\u3002</p> <p>\u5728\u6700\u521d\u7684NS Namespace\u7248\u672c\u4e2d\uff0c\u6302\u8f7d\u70b9\u662f\u5b8c\u5168\u9694\u79bb\u7684\u3002\u521d\u59cb\u72b6\u6001\u4e0b\uff0c\u5b50\u8fdb\u7a0b\u770b\u5230\u7684\u6302\u8f7d\u70b9\u4e0e\u7236\u8fdb\u7a0b\u662f\u4e00\u6837\u7684\u3002\u5728\u65b0\u7684Namespace\u4e2d\uff0c\u5b50\u8fdb\u7a0b\u53ef\u4ee5\u968f\u610fmount/umount\u4efb\u4f55\u76ee\u5f55\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u5230\u7236Namespace\u3002\u4f7f\u7528NS Namespace\u5b8c\u5168\u9694\u79bb\u6302\u8f7d\u70b9\u521d\u8877\u5f88\u597d\uff0c\u4f46\u662f\u4e5f\u5e26\u6765\u4e86\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4e0d\u65b9\u4fbf\uff0c\u6bd4\u5982\u6211\u4eec\u65b0\u52a0\u4e86\u4e00\u5757\u78c1\u76d8\uff0c\u5982\u679c\u5b8c\u5168\u9694\u79bb\u5219\u9700\u8981\u5728\u6240\u6709\u7684Namespace\u4e2d\u90fd\u6302\u8f7d\u4e00\u904d\u3002\u4e3a\u6b64\uff0cLinux\u57282.6.15\u7248\u672c\u4e2d\u52a0\u5165\u4e86\u4e00\u4e2ashared subtree\u7279\u6027\uff0c\u901a\u8fc7\u6307\u5b9aPropagation\u6765\u786e\u5b9a\u6302\u8f7d\u4e8b\u4ef6\u5982\u4f55\u4f20\u64ad\u3002\u6bd4\u5982\u901a\u8fc7\u6307\u5b9aMS_SHARED\u6765\u5141\u8bb8\u5728\u4e00\u4e2apeer group(\u5b50namespace \u548c\u7236namespace\u5c31\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7ec4)\u5171\u4eab\u6302\u8f7d\u70b9\uff0cmount/umount\u4e8b\u4ef6\u4f1a\u4f20\u64ad\u5230peer group\u6210\u5458\u4e2d\u3002\u4f7f\u7528MS_PRIVATE\u4e0d\u5171\u4eab\u6302\u8f7d\u70b9\u548c\u4f20\u64ad\u6302\u8f7d\u4e8b\u4ef6\u3002\u5176\u4ed6\u8fd8\u6709MS_SLAVE\u548cNS_UNBINDABLE\u7b49\u9009\u9879\u3002\u53ef\u4ee5\u901a\u8fc7\u67e5\u770bcat /proc/self/mountinfo\u6765\u770b\u6302\u8f7d\u70b9\u4fe1\u606f\uff0c\u82e5\u6ca1\u6709\u4f20\u64ad\u53c2\u6570\u5219\u4e3aMS_PRIVATE\u7684\u9009\u9879\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#23-net-namespace","title":"2.3 NET Namespace","text":"<p>Docker\u5bb9\u5668\u4e2d\u53e6\u4e00\u4e2a\u91cd\u8981\u7279\u6027\u662f\u7f51\u7edc\u72ec\u7acb(\u4e4b\u6240\u4ee5\u4e0d\u7528\u9694\u79bb\u4e00\u8bcd\u662f\u56e0\u4e3a\u5bb9\u5668\u7684\u7f51\u7edc\u8fd8\u662f\u8981\u501f\u52a9\u5bbf\u4e3b\u673a\u7684\u7f51\u7edc\u6765\u901a\u4fe1\u7684)\uff0c\u4f7f\u7528\u5230Linux \u7684 NET Namespace\u4ee5\u53cavet\u3002veth\u4e3b\u8981\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u8de8NET namespace\u4e4b\u95f4\u63d0\u4f9b\u4e00\u79cd\u7c7b\u4f3c\u4e8eLinux\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6280\u672f\uff0c\u6240\u4ee5veth\u603b\u662f\u6210\u5bf9\u51fa\u73b0\uff0c\u5982\u4e0b\u9762\u7684veth0\u548cveth1\u3002\u5b83\u4eec\u4f4d\u4e8e\u4e0d\u540c\u7684NET namespace\u4e2d\uff0c\u5728veth\u8bbe\u5907\u4efb\u610f\u4e00\u7aef\u63a5\u6536\u5230\u7684\u6570\u636e\uff0c\u90fd\u4f1a\u4ece\u53e6\u4e00\u7aef\u53d1\u9001\u51fa\u53bb\u3002veth\u5b9e\u73b0\u4e86\u4e0d\u540cnamespace\u7684\u7f51\u7edc\u6570\u636e\u4f20\u8f93\u3002</p> <p></p> <p>\u5728Docker\u4e2d\uff0c\u5bbf\u4e3b\u673a\u7684veth\u7aef\u4f1a\u6865\u63a5\u5230\u7f51\u6865\u4e2d\uff0c\u63a5\u6536\u5230\u5bb9\u5668\u4e2d\u7684veth\u7aef\u53d1\u8fc7\u6765\u7684\u6570\u636e\u540e\u4f1a\u7ecf\u7531\u7f51\u6865docker0\u518d\u8f6c\u53d1\u5230\u5bbf\u4e3b\u673a\u7f51\u5361eth0\uff0c\u6700\u7ec8\u901a\u8fc7eth0\u53d1\u9001\u6570\u636e\u3002\u5f53\u7136\u5728\u53d1\u9001\u6570\u636e\u524d\uff0c\u9700\u8981\u7ecf\u8fc7iptables MASQUERADE\u89c4\u5219\u5c06\u6e90\u5730\u5740\u6539\u6210\u5bbf\u4e3b\u673aip\uff0c\u8fd9\u6837\u624d\u80fd\u63a5\u6536\u5230\u54cd\u5e94\u6570\u636e\u5305\u3002\u800c\u5bbf\u4e3b\u673a\u7f51\u5361\u63a5\u6536\u5230\u7684\u6570\u636e\u4f1a\u901a\u8fc7iptables DNAT\u6839\u636e\u7aef\u53e3\u53f7\u4fee\u6539\u76ee\u7684\u5730\u5740\u548c\u7aef\u53e3\u4e3a\u5bb9\u5668\u7684ip\u548c\u7aef\u53e3\uff0c\u7136\u540e\u6839\u636e\u8def\u7531\u89c4\u5219\u53d1\u9001\u5230\u7f51\u6865docker0\u4e2d\uff0c\u5e76\u6700\u7ec8\u7531\u7f51\u6865docker0\u53d1\u9001\u5230\u5bf9\u5e94\u7684\u5bb9\u5668\u4e2d\u3002</p> <p>Docker\u91cc\u9762\u7f51\u7edc\u6a21\u5f0f\u5206\u4e3abridge\uff0chost\uff0coverlay\u7b49\u51e0\u79cd\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u662f\u91c7\u7528bridge\u6a21\u5f0f\u7f51\u7edc\u5982\u56fe\u6240\u793a\u3002\u5982\u679c\u4f7f\u7528host\u6a21\u5f0f\uff0c\u5219\u4e0d\u9694\u79bb\u76f4\u63a5\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc\u3002overlay\u7f51\u7edc\u5219\u662f\u66f4\u52a0\u9ad8\u7ea7\u7684\u6a21\u5f0f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u8de8\u4e3b\u673a\u7684\u5bb9\u5668\u901a\u4fe1\uff0c\u540e\u9762\u4f1a\u5355\u72ec\u603b\u7ed3\u4e0bDocker\u7f51\u7edc\u8fd9\u4e2a\u4e13\u9898\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#24-user-namespace","title":"2.4 USER Namespace","text":"<p>user namespace\u7528\u4e8e\u9694\u79bb\u7528\u6237\u548c\u7ec4\u4fe1\u606f\uff0c\u5728\u4e0d\u540c\u7684namespace\u4e2d\u7528\u6237\u53ef\u4ee5\u6709\u76f8\u540c\u7684 UID \u548c GID\uff0c\u5b83\u4eec\u4e4b\u95f4\u4e92\u76f8\u4e0d\u5f71\u54cd\u3002\u7236\u5b50namespace\u4e4b\u95f4\u53ef\u4ee5\u8fdb\u884c\u7528\u6237\u6620\u5c04\uff0c\u5982\u7236namespace(\u5bbf\u4e3b\u673a)\u7684\u666e\u901a\u7528\u6237\u6620\u5c04\u5230\u5b50namespace(\u5bb9\u5668)\u7684root\u7528\u6237\uff0c\u4ee5\u51cf\u5c11\u5b50namespace\u7684root\u7528\u6237\u64cd\u4f5c\u7236namespace\u7684\u98ce\u9669\u3002user namespace\u529f\u80fd\u867d\u7136\u5728\u5f88\u65e9\u5c31\u51fa\u73b0\u4e86\uff0c\u4f46\u662f\u76f4\u5230Linux kernel 3.8\u4e4b\u540e\u8fd9\u4e2a\u529f\u80fd\u624d\u8d8b\u4e8e\u5b8c\u5584\u3002</p> <p>\u521b\u5efa\u65b0\u7684user namespace\u4e4b\u540e\u7b2c\u4e00\u6b65\u5c31\u662f\u8bbe\u7f6e\u597duser\u548cgroup\u7684\u6620\u5c04\u5173\u7cfb\u3002\u8fd9\u4e2a\u6620\u5c04\u901a\u8fc7\u8bbe\u7f6e/proc/PID/uid_map(gid_map)\u5b9e\u73b0\uff0c\u683c\u5f0f\u5982\u4e0b\uff0cID-inside-ns\u662f\u5bb9\u5668\u5185\u7684uid/gid\uff0c\u800cID-outside-ns\u5219\u662f\u5bb9\u5668\u5916\u6620\u5c04\u7684\u771f\u5b9euid/gid\u3002\u6bd4\u59820 1000 1\u8868\u793a\u5c06\u771f\u5b9e\u7684uid=1000\u6620\u5c04\u4e3a\u5bb9\u5668\u5185\u7684uid=0\uff0clength\u4e3a\u6620\u5c04\u7684\u8303\u56f4\u3002</p> <pre><code>ID-inside-ns ID-outside-ns length\n</code></pre> <p>\u4e0d\u662f\u6240\u6709\u7684\u8fdb\u7a0b\u90fd\u80fd\u968f\u4fbf\u4fee\u6539\u6620\u5c04\u6587\u4ef6\u7684\uff0c\u5fc5\u987b\u540c\u65f6\u5177\u5907\u5982\u4e0b\u6761\u4ef6\uff1a</p> <ul> <li>\u4fee\u6539\u6620\u5c04\u6587\u4ef6\u7684\u8fdb\u7a0b\u5fc5\u987b\u6709PID\u8fdb\u7a0b\u6240\u5728user namespace\u7684CAP_SETUID/CAP_SETGID\u6743\u9650\u3002</li> <li>\u4fee\u6539\u6620\u5c04\u6587\u4ef6\u7684\u8fdb\u7a0b\u5fc5\u987b\u662f\u8ddfPID\u5728\u540c\u4e00\u4e2auser namespace\u6216\u8005PID\u7684\u7236namespace\u3002</li> <li>\u6620\u5c04\u6587\u4ef6uid_map\u548cgid_map\u53ea\u80fd\u5199\u5165\u4e00\u6b21\uff0c\u518d\u6b21\u5199\u5165\u4f1a\u62a5\u9519\u3002</li> </ul> <p>docker1.10\u4e4b\u540e\u7684\u7248\u672c\u53ef\u4ee5\u901a\u8fc7\u5728docker daemon\u542f\u52a8\u65f6\u52a0\u4e0a--userns-remap=[USERNAME]\u6765\u5b9e\u73b0USER Namespace\u7684\u9694\u79bb\u3002\u6211\u4eec\u6307\u5b9a\u4e86username=ssj\u542f\u52a8dockerd\uff0c\u67e5\u770bsubuid\u6587\u4ef6\u53ef\u4ee5\u53d1\u73b0ssj\u6620\u5c04\u7684uid\u8303\u56f4\u662f165536\u5230165536+65536= 231072\uff0c\u800c\u4e14\u5728docker\u76ee\u5f55\u4e0b\u9762\u5bf9\u5e94ssj\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u76ee\u5f55165536.165536\u5b58\u5728\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#25-namespace","title":"2.5 \u5176\u4ed6Namespace","text":"<p>UTS namespace\u7528\u4e8e\u9694\u79bb\u4e3b\u673a\u540d\u7b49\u3002\u53ef\u4ee5\u770b\u5230\u5728\u65b0\u7684uts namespace\u4fee\u6539\u4e3b\u673a\u540d\u5e76\u4e0d\u5f71\u54cd\u539fnamespace\u7684\u4e3b\u673a\u540d\u3002</p> <p>IPC Namespace\u7528\u4e8e\u9694\u79bbIPC\u6d88\u606f\u961f\u5217\u7b49\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u65b0\u8001ipc namespace\u7684\u6d88\u606f\u961f\u5217\u4e92\u4e0d\u5f71\u54cd\u3002</p> <p>CGROUP Namespace\u662fLinux4.6\u4ee5\u540e\u624d\u652f\u6301\u7684\u65b0namespace\u3002\u5bb9\u5668\u6280\u672f\u4f7f\u7528namespace\u548ccgroup\u5b9e\u73b0\u73af\u5883\u9694\u79bb\u548c\u8d44\u6e90\u9650\u5236\uff0c\u4f46\u662f\u5bf9\u4e8ecgroup\u672c\u8eab\u5e76\u6ca1\u6709\u9694\u79bb\u3002\u6ca1\u6709cgroup namespace\u524d\uff0c\u5bb9\u5668\u4e2d\u4e00\u65e6\u6302\u8f7dcgroup\u6587\u4ef6\u7cfb\u7edf\uff0c\u4fbf\u53ef\u4ee5\u4fee\u6539\u6574\u5168\u5c40\u7684cgroup\u914d\u7f6e\u3002\u6709\u4e86cgroup namespace\u540e\uff0c\u6bcf\u4e2anamespace\u4e2d\u7684\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684cgroup\u6587\u4ef6\u7cfb\u7edf\u89c6\u56fe\uff0c\u589e\u5f3a\u4e86\u5b89\u5168\u6027\uff0c\u540c\u65f6\u4e5f\u8ba9\u5bb9\u5668\u8fc1\u79fb\u66f4\u52a0\u65b9\u4fbf\u3002\u5728\u6211\u6d4b\u8bd5\u7684Docker18.03.1-ce\u7248\u672c\u4e2d\u5bb9\u5668\u6682\u65f6\u6ca1\u6709\u7528\u5230cgroup namespace\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u5c55\u5f00\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#cgroups","title":"\u4e09 CGroups","text":"<p>Linux CGroups\u7528\u4e8e\u8d44\u6e90\u9650\u5236\uff0c\u5305\u62ec\u9650\u5236CPU\u3001\u5185\u5b58\u3001blkio\u4ee5\u53ca\u7f51\u7edc\u7b49\u3002\u901a\u8fc7\u5de5\u5177cgroup-bin (sudo apt-get install cgroup-bin)\u53ef\u4ee5\u521b\u5efaCGroup\u5e76\u8fdb\u5165\u8be5CGroup\u6267\u884c\u547d\u4ee4\u3002</p> <p>cpu.cfs_period_us \u548c cpu.cfs_quota_us\uff0c\u5b83\u4eec\u5206\u522b\u7528\u6765\u9650\u5236\u8be5\u7ec4\u4e2d\u7684\u6240\u6709\u8fdb\u7a0b\u5728\u5355\u4f4d\u65f6\u95f4\u91cc\u53ef\u4ee5\u4f7f\u7528\u7684 cpu \u65f6\u95f4\uff0c\u8fd9\u91cc\u7684 cfs(Completely Fair Scheduler) \u662f\u5b8c\u5168\u516c\u5e73\u8c03\u5ea6\u5668\u7684\u610f\u601d\u3002cpu.cfs_period_us\u662f\u65f6\u95f4\u5468\u671f\uff0c\u9ed8\u8ba4\u4e3a100000\uff0c\u5373100\u6beb\u79d2\u3002\u800ccpu.cfs_quota_us\u662f\u5728\u65f6\u95f4\u5468\u671f\u5185\u53ef\u4ee5\u4f7f\u7528\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a-1\u5373\u65e0\u9650\u5236\u3002cpu.shares\u7528\u4e8e\u9650\u5236cpu\u4f7f\u7528\u7684\uff0c\u5b83\u7528\u4e8e\u63a7\u5236\u5404\u4e2a\u7ec4\u4e4b\u95f4\u7684\u914d\u989d\u3002\u6bd4\u5982\u7ec4cg1\u7684cpu.shares\u4e3a1024\uff0c\u7ec4cg2\u7684cpu.shares\u4e5f\u662f1024\uff0c\u5982\u679c\u90fd\u6709\u8fdb\u7a0b\u5728\u8fd0\u884c\u5219\u5b83\u4eec\u90fd\u53ef\u4ee5\u4f7f\u7528\u6700\u591a50%\u7684\u9650\u989d\u3002\u5982\u679ccg2\u7ec4\u5185\u8fdb\u7a0b\u6bd4\u8f83\u7a7a\u95f2\uff0c\u90a3\u4e48cg1\u7ec4\u53ef\u4ee5\u5c06\u4f7f\u7528\u51e0\u4e4e\u6574\u4e2acpu\uff0ctasks\u5b58\u50a8\u7684\u662f\u8be5\u7ec4\u91cc\u9762\u7684\u8fdb\u7a0bID\u3002(\u6ce8\uff1adebian8\u9ed8\u8ba4\u6ca1\u6709cfs\u548cmemory cgroup\u652f\u6301\uff0c\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u5185\u6838\u53ca\u4fee\u6539\u542f\u52a8\u53c2\u6570\uff0cdebian9\u9ed8\u8ba4\u5df2\u7ecf\u652f\u6301)</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#capabilities","title":"\u56db Capabilities","text":"<p>\u6211\u4eec\u5728\u542f\u52a8\u5bb9\u5668\u65f6\u4f1a\u65f6\u5e38\u770b\u5230\u8fd9\u6837\u7684\u53c2\u6570--cap-add=NET_ADMIN\uff0c\u8fd9\u662f\u7528\u5230\u4e86Linux\u7684capability\u7279\u6027\u3002capability\u662f\u4e3a\u4e86\u5b9e\u73b0\u66f4\u7cbe\u7ec6\u5316\u7684\u6743\u9650\u63a7\u5236\u800c\u52a0\u5165\u7684\u3002\u6211\u4eec\u4ee5\u524d\u719f\u77e5\u901a\u8fc7\u8bbe\u7f6e\u6587\u4ef6\u7684SUID\u4f4d\uff0c\u8fd9\u6837\u975eroot\u7528\u6237\u7684\u53ef\u6267\u884c\u6587\u4ef6\u8fd0\u884c\u540e\u7684euid\u4f1a\u6210\u4e3a\u6587\u4ef6\u7684\u62e5\u6709\u8005ID\uff0c\u6bd4\u5982passwd\u547d\u4ee4\u8fd0\u884c\u8d77\u6765\u540e\u6709root\u6743\u9650\uff0c\u6709SUID\u6743\u9650\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5982\u679c\u5b58\u5728\u6f0f\u6d1e\u4f1a\u6709\u5b89\u5168\u98ce\u9669\u3002(\u67e5\u770b\u6587\u4ef6\u7684capability\u7684\u547d\u4ee4\u4e3a filecap -a\uff0c\u800c\u67e5\u770b\u8fdb\u7a0bcapability\u7684\u547d\u4ee4\u4e3a pscap -a\uff0cpscap\u548cfilecap\u5de5\u5177\u9700\u8981\u5b89\u88c5 libcap-ng-utils\u8fd9\u4e2a\u5305)\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#union-file-system","title":"\u4e94 Union File System","text":"<p>UnionFS(\u8054\u5408\u6587\u4ef6\u7cfb\u7edf)\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u652f\u6301\u5c06\u4e0d\u540c\u7684\u76ee\u5f55\u6302\u8f7d\u5230\u540c\u4e00\u4e2a\u76ee\u5f55\u4e2d\u7684\u6280\u672f\u3002Docker\u652f\u6301\u7684UnionFS\u5305\u62ecOverlayFS\uff0cAUFS\uff0cdevicemapper\uff0cvfs\u4ee5\u53cabtrfs\u7b49\uff0c\u67e5\u770bUnionFS\u7248\u672c\u53ef\u4ee5\u7528docker info\u67e5\u770b\u5bf9\u5e94\u8f93\u51fa\u4e2d\u7684Storage\u9879\u5373\u53ef\uff0c\u65e9\u671f\u7684Docker\u7248\u672c\u7528AUFS\u548cdevicemapper\u5c45\u591a\uff0c\u65b0\u7248\u672cDocker\u5728Linux3.18\u4e4b\u540e\u7248\u672c\u57fa\u672c\u9ed8\u8ba4\u7528OverlayFS\uff0c\u8fd9\u91cc\u4ee5OverlayFS\u6765\u5206\u6790\u3002</p> <p>OverlayFS\u4e0e\u65e9\u671f\u7528\u8fc7\u7684AUFS\u7c7b\u4f3c\uff0c\u4e0d\u8fc7\u5b83\u6bd4AUFS\u66f4\u7b80\u5355\uff0c\u8bfb\u5199\u6027\u80fd\u66f4\u597d\uff0c\u5728docker-ce18.03\u7248\u672c\u4e2d\u9ed8\u8ba4\u7528\u7684\u5b58\u50a8\u9a71\u52a8\u662foverlay2\uff0c\u8001\u7248\u672coverlay\u5b98\u65b9\u5df2\u7ecf\u4e0d\u63a8\u8350\u4f7f\u7528\u3002\u5b83\u5c06\u4e24\u4e2a\u76ee\u5f55upperdir\u548clowdir\u8054\u5408\u6302\u8f7d\u5230\u4e00\u4e2amerged\u76ee\u5f55\uff0c\u63d0\u4f9b\u7edf\u4e00\u89c6\u56fe\u3002\u5176\u4e2dupperdir\u662f\u53ef\u8bfb\u5199\u5c42\uff0c\u5bf9\u5bb9\u5668\u4fee\u6539\u5199\u5165\u5728\u8be5\u76ee\u5f55\u4e2d\uff0c\u5b83\u4e5f\u4f1a\u9690\u85cflowerdir\u4e2d\u76f8\u540c\u7684\u6587\u4ef6\u3002\u800clowdir\u662f\u53ea\u8bfb\u5c42\uff0cDocker\u955c\u50cf\u5728\u8fd9\u5c42\u3002</p> <p></p> <ul> <li>\u8bfb\u53d6\u6587\u4ef6\u65f6\uff0c\u5982\u679cupperdir\u4e0d\u5b58\u5728\u8be5\u6587\u4ef6\uff0c\u5219\u4f1a\u4ecelowerdir\u76f4\u63a5\u8bfb\u53d6\u3002</li> <li>\u4fee\u6539\u6587\u4ef6\u65f6\u5e76\u4e0d\u5f71\u54cdlowerdir\u4e2d\u7684\u6587\u4ef6\uff0c\u56e0\u4e3a\u5b83\u662f\u53ea\u8bfb\u7684\u3002</li> <li>\u5982\u679c\u4fee\u6539\u7684\u6587\u4ef6\u5728upperdir\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u4ecelowerdir\u62f7\u8d1d\u5230upperdir\uff0c\u7136\u540e\u5728upperdir\u91cc\u9762\u4fee\u6539\u8be5\u6587\u4ef6\uff0c\u5e76\u4e0d\u5f71\u54cdlowerdir\u76ee\u5f55\u7684\u6587\u4ef6\u3002</li> <li>\u5220\u9664\u6587\u4ef6\u5219\u662f\u5c06upperdir\u4e2d\u5c06\u5bf9\u5e94\u6587\u4ef6\u8bbe\u7f6e\u6210\u4e86c\u7c7b\u578b\uff0c\u5373\u5b57\u7b26\u8bbe\u5907\u7c7b\u578b\u6765\u9690\u85cf\u5df2\u7ecf\u5220\u9664\u7684\u6587\u4ef6(\u4e0eAUFS\u521b\u5efa\u4e00\u4e2awhiteout\u6587\u4ef6\u7565\u6709\u4e0d\u540c)\u3002</li> </ul> <p>\u56de\u5230Docker\u91cc\u9762\uff0c\u6211\u4eec\u62c9\u53d6\u4e00\u4e2anginx\u955c\u50cf\uff0c\u6709\u4e09\u5c42\u955c\u50cf\uff0c\u53ef\u4ee5\u770b\u5230\u5728overlay2\u5bf9\u5e94\u6bcf\u4e00\u5c42\u90fd\u6709\u4e2a\u76ee\u5f55(\u6ce8\u610f\uff0c\u8fd9\u4e2a\u76ee\u5f55\u540d\u8ddf\u955c\u50cf\u5c42\u540d\u4ecedocker1.10\u7248\u672c\u540e\u540d\u5b57\u5df2\u7ecf\u4e0d\u5bf9\u5e94\u4e86)\uff0c\u53e6\u5916\u7684l\u76ee\u5f55\u662f\u6307\u5411\u955c\u50cf\u5c42\u7684\u8f6f\u94fe\u63a5\u3002\u6700\u5e95\u5c42\u5b58\u50a8\u7684\u662f\u57fa\u7840\u955c\u50cfdebian/alpine\uff0c\u4e0a\u4e00\u5c42\u662f\u5b89\u88c5\u4e86nginx\u589e\u52a0\u7684\u53ef\u6267\u884c\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\uff0c\u800c\u6700\u4e0a\u5c42\u662f\u94fe\u63a5/dev/stdout\u5230nginx\u65e5\u5fd7\u6587\u4ef6\u3002\u800c\u6bcf\u4e2a\u5b50\u76ee\u5f55\u4e0b\u9762\u7684diff\u76ee\u5f55\u7528\u4e8e\u5b58\u50a8\u955c\u50cf\u5185\u5bb9\uff0cwork\u76ee\u5f55\u662fOverlayFS\u5185\u90e8\u4f7f\u7528\u7684\uff0c\u800clink\u6587\u4ef6\u5b58\u50a8\u7684\u662f\u8be5\u955c\u50cf\u5c42\u5bf9\u5e94\u7684\u77ed\u540d\u79f0\uff0clower\u6587\u4ef6\u5b58\u50a8\u7684\u662f\u4e0b\u4e00\u5c42\u7684\u77ed\u540d\u79f0\u3002</p> <p>\u6b64\u65f6\u6211\u4eec\u542f\u52a8\u4e00\u4e2anginx\u5bb9\u5668\uff0c\u53ef\u4ee5\u770b\u5230overlay2\u76ee\u5f55\u591a\u4e86\u4e24\u4e2a\u76ee\u5f55\uff0c\u591a\u51fa\u6765\u7684\u5c31\u662f\u5bb9\u5668\u5c42\u7684\u76ee\u5f55\u548c\u53ea\u8bfb\u7684\u5bb9\u5668init\u5c42\u3002\u5bb9\u5668\u76ee\u5f55\u4e0b\u9762\u7684merged\u5c31\u662f\u6211\u4eec\u524d\u9762\u63d0\u5230\u7684\u8054\u5408\u6302\u8f7d\u76ee\u5f55\u4e86\uff0c\u800clowdir\u5219\u662f\u5b83\u4e0b\u5c42\u76ee\u5f55\u3002\u800c\u5bb9\u5668init\u5c42\u7528\u6765\u5b58\u50a8\u4e0e\u8fd9\u4e2a\u5bb9\u5668\u5185\u73af\u5883\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u5982 /etc/hosts\u548c/etc/resolv.conf\u6587\u4ef6\uff0c\u5b83\u5c45\u4e8e\u5176\u4ed6\u955c\u50cf\u5c42\u4e4b\u4e0a\uff0c\u5bb9\u5668\u5c42\u4e4b\u4e0b\u3002</p> <p>\u5982\u679c\u6211\u4eec\u5728\u5bb9\u5668\u4e2d\u4fee\u6539\u6587\u4ef6\uff0c\u5219\u4f1a\u53cd\u6620\u5230\u5bb9\u5668\u5c42\u7684merged\u76ee\u5f55\u76f8\u5173\u6587\u4ef6\uff0c\u5bb9\u5668\u5c42\u7684diff\u76ee\u5f55\u76f8\u5f53\u4e8eupperdir\uff0c\u5176\u4ed6\u5c42\u662flowerdir\u3002\u5982\u679c\u4e4b\u524d\u5bb9\u5668\u5c42diff\u76ee\u5f55\u4e0d\u5b58\u5728\u8be5\u6587\u4ef6\uff0c\u5219\u4f1a\u62f7\u8d1d\u8be5\u6587\u4ef6\u5230diff\u76ee\u5f55\u5e76\u4fee\u6539\u3002\u8bfb\u53d6\u6587\u4ef6\u65f6\uff0c\u5982\u679cupperdir\u76ee\u5f55\u627e\u4e0d\u5230\uff0c\u5219\u4f1a\u76f4\u63a5\u4ece\u4e0b\u5c42\u7684\u955c\u50cf\u5c42\u4e2d\u8bfb\u53d6\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/","title":"Docker \u64cd\u4f5c\u5e38\u7528\u6570\u636e\u5e93","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#_1","title":"\u524d\u8a00","text":"<p>\u5bf9\u4e8e\u540e\u7aef\u5f00\u53d1\u4eba\u5458\uff0c\u7ecf\u5e38\u9700\u8981\u4f7f\u7528\u6570\u636e\u5e93\uff0c\u5728\u672c\u5730\u5b89\u88c5\u6570\u636e\u5e93\u9ebb\u70e6\u4e14\u6613\u51fa\u9519\uff0c\u5229\u7528docker\u80fd\u975e\u5e38\u5feb\u901f\u7684\u62c9\u542f\u6240\u9700\u6570\u636e\u5e93\u73af\u5883\uff0c\u4e0d\u7528\u7684\u65f6\u5019\u53ef\u4ee5\u5220\u6389\uff0c\u5982\u679c\u9700\u8981\u672c\u5730\u5b58\u50a8\u6570\u636e\u53ef\u4ee5\u4f7f\u7528\u5355\u72ec\u6570\u636e\u76ee\u5f55\u6302\u5728\u5230\u5bb9\u5668\u5185\uff0c\u672c\u6587\u7b80\u5355\u5217\u4e3e\u51e0\u7c7b\u5e38\u7528\u6570\u636e\u5e93\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#mysql","title":"\u4e00 MySQL","text":"<pre><code># \u62c9\u53d6\u955c\u50cf\ndocker pull mysql:8.0.19\n\n# \u542f\u52a8server\ndocker run --name mysql01 -p 13306:3306 -e MYSQL_ROOT_PASSWORD=mysqladmin -d mysql:8.0.19\n\n# \u542f\u52a8\u5ba2\u6237\u7aef,\u8f93\u5165\u5bc6\u7801\uff1amysqladmin \ndocker run -it --network host --rm mysql mysql -h127.0.0.1 -P13306 --default-character-set=utf8mb4 -uroot -p\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#redis","title":"\u4e8c Redis","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#31-redis-server","title":"3.1 redis-server","text":"<pre><code># \u62c9\u53d6redis\ndocker pull redis\n# \u542f\u52a8redis\ndocker run -itd --name redis01 -p 6379:6379 redis --requirepass \"redisadmin\" --appendonly yes\n\n# \u4f7f\u7528\u5ba2\u6237\u7aef\u94fe\u63a5redis\ndocker exec -it redis01 /bin/bash\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#22-redis-cli","title":"2.2 redis-cli","text":"<p>\u53ef\u4ee5\u5229\u7528redis\u955c\u50cf\u76f4\u63a5\u4f7f\u7528\u5176\u7684cli\u8fdb\u884c\u64cd\u4f5c\u3002</p> <pre><code>docker run -itd --name redis-cli redis --requirepass \"redisadmin\" --appendonly yes\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#etcd","title":"\u4e09 Etcd","text":"<pre><code># \u62c9\u53bb\u955c\u50cf\ndocker pull appcelerator/etcd:latest\n# \u542f\u52a8\ndocker run --name etcd01 -d -p 2379:2379 -p 2380:2380 appcelerator/etcd --listen-client-urls http://0.0.0.0:2379 --advertise-client-urls http://0.0.0.0:2379 \n\n# \u5ba2\u6237\u7aef\u94fe\u63a5\ndocker exec -it etcd01 /bin/bash\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#elasticsearch","title":"\u56db Elasticsearch","text":"<pre><code># \u62c9\u53d6\u955c\u50cf\ndocker pull elasticsearch:latest\n# \u542f\u52a8\ndocker run --name es01 -d -p 9200:9200 -p 9300:9300 -e \"discovery.type=single-node\" -e  \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" elasticsearch:latest\n\n# \u4f7f\u7528head\u5ba2\u6237\u7aef\u94fe\u63a5\ndocker pull mobz/elasticsearch-head:5\n# \u542f\u52a8header \u5bb9\u5668\ndocker run -d --name my-es_admin -p 9100:9100 mobz/elasticsearch-head:5\n\n# curl\u6d4b\u8bd5\u8bbf\u95ee\n</code></pre> <p>\u7b2c\u4e00\u6b21\u6253\u5f00\u6d4f\u89c8\u5668header\u8bbf\u95ee\uff0c\u8fde\u63a5\u7684\u670d\u52a1\u5730\u5740\u662flocalhost:9200\uff0c\u4fee\u6539\u4e3adocker\u6240\u5728\u7684ip\u3002\u6b64\u65f6\u51fa\u73b0\u8fde\u63a5\u5931\u8d25\uff0c\u9700\u8981\u4fee\u6539\u955c\u50cf\u7684elasticsearch.yml\u6587\u4ef6\uff0c\u6dfb\u52a0</p> <pre><code>http.cors.enabled: true\nhttp.cors.allow-origin: \"*\"\n\n# \u91cd\u542fes\ndocker restart es01\ndocker restart my-es-head\n</code></pre> <p></p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#mongodb","title":"\u4e94 MongoDB","text":"<pre><code>#\u62c9\u53d6\u955c\u50cf\ndocker pull mongo:lastest\n\n# \u542f\u52a8\ndocker run --name mongodb01  -p 27017:27017 -d mongo:latest\n\n# \u5ba2\u6237\u7aef\u94fe\u63a5\u4ee5admin\u8fdb\u5165\u5bb9\u5668\n docker exec -it mongodb01 mongo admin\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#postgre","title":"\u516d postgre","text":"<pre><code># \u4e0b\u8f7d\ndocker pull postgres:12\n\n# \u542f\u52a8\ndocker run --name pg01 -e POSTGRES_PASSWORD=pgadmin  -p 54320:5432 -d postgres:12\n\n\n# \u5ba2\u6237\u7aef\u94fe\u63a5\n docker exec -it pg01 /bin/bash\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Docker%E6%93%8D%E4%BD%9C%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93/#_2","title":"\u5176\u4ed6","text":"<p>\u672c\u6587\u901a\u8fc7\u5229\u7528Docker\u5bb9\u5668\u5316\u5c01\u88c5\u7684\u80fd\u529b\uff0c\u5c06\u542b\u6709\u955c\u50cf\u76f4\u63a5\u4ece\u4ed3\u5e93\u62c9\u53d6\u4e0b\u6765\u540e\uff0c\u901a\u8fc7\u547d\u4ee4\u884c\u8fd0\u884c\uff0c\u5e76\u5c06\u6307\u5b9a\u7aef\u53e3\u6620\u5c04\u5230\u672c\u5730\u3002\u7136\u540e\u672c\u5730\u5f00\u53d1\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u9700\u8981\u53bb\u5173\u6ce8\u6570\u636e\u5e93\u7684\u914d\u7f6e\u548c\u5b89\u88c5\u4e86\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u67e5\u8be2\u955c\u50cf\u3001\u62c9\u53d6\u955c\u50cf\u3001\u8fd0\u884c\u955c\u50cf\u3002\u7b80\u5355\u7684\u4e09\u90e8\u64cd\u4f5c\u5c31\u53ef\u4ee5\u62e5\u6709\u4e00\u4e2a\u914d\u7f6e\u597d\u7684\u9700\u6c42\u6570\u636e\u5e93\u73af\u5883\u3002</p> <p>\u67e5\u770b\u955c\u50cf\u7248\u672c\uff1a</p> <pre><code>curl https://registry.hub.docker.com/v1/repositories/{imagename}/tags\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/","title":"Harbor/registry\u955c\u50cf\u4ed3\u5e93\u90e8\u7f72","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/#harbor","title":"\u4e00 Harbor\u90e8\u7f72","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/#11-docker","title":"1.1 \u5b89\u88c5docker","text":"<pre><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nyum install -y docker-ce yum-utils device-mapper-persistent-data lvm2\nsystemctl start docker\n\ncat &gt; /etc/docker/daemon.json &lt;&lt; EOF\n{\n\"exec-opts\": [\"native.cgroupdriver=systemd\"],\n\"log-driver\": \"json-file\",\n\"log-opts\": {\n\"max-size\": \"100m\"\n}\n}\nEOF\n\nsystemctl enable docker\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/#12-docker-compose","title":"1.2 \u5b89\u88c5docker-compose","text":"<pre><code>systemctl enable docker\n\n// \u5b89\u88c5docker-compose\nwget https://github.com/docker/compose/releases/download/1.29.2/docker-compose-Linux-x86_64\nchmod +x docker-compose-Linux-x86_64\nmv docker-compose-Linux-x86_64 docker-compose\nmv docker-compose /usr/bin\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/#13-harbor","title":"1.3 \u4e0b\u8f7dharbor","text":"<p>\u8fdb\u5165harbor\u76ee\u5f55\uff0c\u4fee\u6539harbor.yml\u914d\u7f6e\u6587\u4ef6\uff0c\u8f6f\u4ef6\u81ea\u5e26\u6709\u4e00\u4e2atmpl\u7684\u6a21\u677f\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u590d\u5236\u6b64\u6587\u4ef6\u8fdb\u884c\u7f16\u8f91\u3002</p> <pre><code>wget https://github.com/goharbor/harbor/releases/download/v2.2.2/harbor-offline-installer-v2.2.2.tgz\ntar -zxf harbor-offline-installer-v2.2.2.tgz\ncd harbor\ncp harbor.yml.tmpl harbor.yml\n\nvim harbor.yml\n\n# \u4fee\u6539\u5b8c\u6210\u540e\u8fdb\u884c\u5b89\u88c5\n./install.sh\n</code></pre> <p></p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/#14","title":"1.4 \u505c\u6b62\u548c\u542f\u52a8","text":"<p>\u56e0\u4e3aHarbor\u662f\u57fa\u4e8edocker-compose\u670d\u52a1\u7f16\u6392\u7684\uff0c\u6240\u4ee5\u901a\u8fc7 docker-compose\u542f\u52a8\u6216\u8005\u5173\u95edHarbor</p> <pre><code>docker-compose down\n\ndocker-compose up -d\n</code></pre> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/#registry","title":"\u4e8c registry","text":"<p>docker hub \u516c\u5171\u955c\u50cf\u4e2d\u6709 registry \u7684\u955c\u50cf\uff0c\u76f4\u63a5\u4ecedocker hub\u62c9\u53d6\u3002\u6b64\u64cd\u4f5c\u5728192.168.1.201\u4e0a\u6267\u884c</p> <pre><code>mkdir /registry\ndocker run -p 5000:5000  --restart=always --name registry -v /registry/:/var/lib/registry -d registry\n\n[root@img-tools registry]# docker pull centos:latest\n[root@img-tools registry]# docker tag centos:latest 127.0.0.1:5000/mycentos:latest\n[root@img-tools registry]# docker push 127.0.0.1:5000/mycentos:latest\nThe push refers to repository [127.0.0.1:5000/mycentos]\n2653d992f4ef: Pushed\nlatest: digest: sha256:dbbacecc49b088458781c16f3775f2a2ec7521079034a7ba499c8b0bb7f86875 size: 529\n[root@img-tools registry]# curl -X GET http://127.0.0.1:5000/v2/_catalog -k\n{\"repositories\":[\"mycentos\"]}\n\n// \u67e5\u770b\u83b7\u53d6\u5230\u955c\u50cf\u7684Digest\n[root@img-tools harbor]# curl -I -H \"Accept: application/vnd.docker.distribution.manifest.v2+json\" localhost:5000/v2/mycentos/manifests/latest\nHTTP/1.1 200 OK\nContent-Length: 529\nContent-Type: application/vnd.docker.distribution.manifest.v2+json\nDocker-Content-Digest: sha256:dbbacecc49b088458781c16f3775f2a2ec7521079034a7ba499c8b0bb7f86875\nDocker-Distribution-Api-Version: registry/2.0\nEtag: \"sha256:dbbacecc49b088458781c16f3775f2a2ec7521079034a7ba499c8b0bb7f86875\"\nX-Content-Type-Options: nosniff\nDate: Fri, 11 Jun 2021 09:15:55 GMT\n\n// \u67e5\u770b\u5bbf\u4e3b\u673a\u4fe1\u606f\n\n[root@img-tools ~]# tree /registry/docker/\n/registry/docker/\n\u2514\u2500\u2500 registry\n    \u2514\u2500\u2500 v2\n        \u251c\u2500\u2500 blobs\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 sha256\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 30\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 data\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 7a\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 7a0437f04f83f084b7ed68ad9c4a4947e12fc4e1b006b38129bac89114ec3621\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 data\n        \u2502\u00a0\u00a0     \u2514\u2500\u2500 db\n        \u2502\u00a0\u00a0         \u2514\u2500\u2500 dbbacecc49b088458781c16f3775f2a2ec7521079034a7ba499c8b0bb7f86875\n        \u2502\u00a0\u00a0             \u2514\u2500\u2500 data\n        \u2514\u2500\u2500 repositories\n            \u2514\u2500\u2500 mycentos\n                \u251c\u2500\u2500 _layers\n                \u2502\u00a0\u00a0 \u2514\u2500\u2500 sha256\n                \u2502\u00a0\u00a0     \u251c\u2500\u2500 300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55\n                \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 link\n                \u2502\u00a0\u00a0     \u2514\u2500\u2500 7a0437f04f83f084b7ed68ad9c4a4947e12fc4e1b006b38129bac89114ec3621\n                \u2502\u00a0\u00a0         \u2514\u2500\u2500 link\n                \u251c\u2500\u2500 _manifests\n                \u2502\u00a0\u00a0 \u251c\u2500\u2500 revisions\n                \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 sha256\n                \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 dbbacecc49b088458781c16f3775f2a2ec7521079034a7ba499c8b0bb7f86875\n                \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 link\n                \u2502\u00a0\u00a0 \u2514\u2500\u2500 tags\n                \u2502\u00a0\u00a0     \u2514\u2500\u2500 latest\n                \u2502\u00a0\u00a0         \u251c\u2500\u2500 current\n                \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2514\u2500\u2500 link\n                \u2502\u00a0\u00a0         \u2514\u2500\u2500 index\n                \u2502\u00a0\u00a0             \u2514\u2500\u2500 sha256\n                \u2502\u00a0\u00a0                 \u2514\u2500\u2500 dbbacecc49b088458781c16f3775f2a2ec7521079034a7ba499c8b0bb7f86875\n                \u2502\u00a0\u00a0                     \u2514\u2500\u2500 link\n                \u2514\u2500\u2500 _uploads\n\n27 directories, 8 files\n\n\n[root@img-tools registry]# curl -X GET http://127.0.0.1:5000/v2/_catalog -k\n{\"repositories\":[\"mycentos\"]}\n[root@img-tools registry]# curl -X GET http://127.0.0.1:5000/v2/mycentos/tags/list\n{\"name\":\"mycentos\",\"tags\":[\"latest\"]}\n\n\n\n# \u542f\u7528\u8bc1\u4e66\nmkdir -p /opt/docker/registry/certs\nopenssl req -newkey rsa:4096 -nodes -sha256 -keyout /opt/docker/registry/certs/domain.key -x509 -days 365 -out /opt/docker/registry/certs/domain.crt\n\n[root@img-tools imgtools]# ll /opt/docker/registry/certs/\n\u603b\u7528\u91cf 8\n-rw-r--r-- 1 root root 2090 6\u6708  11 18:10 domain.crt\n-rw-r--r-- 1 root root 3272 6\u6708  11 18:10 domain.key\n\n\ndocker run -p 5000:5000 --restart=always --name myregistry -v /registry/:/var/lib/registry -v /opt/docker/registry/certs:/certs -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key -d registry\n\n\n# \u8fdb\u884c\u6d4b\u8bd5\n[root@img-tools registry]# curl -X GET https://registryxl.com:5000/v2/mycentos/tags/list -k\n{\"name\":\"mycentos\",\"tags\":[\"latest\"]}\n\n\n# \u6dfb\u52a0\u57fa\u672c\u9a8c\u8bc1\nmkdir /opt/docker/registry/auth/\n[root@img-tools registry]# htpasswd -Bbn admin admin &gt; /opt/docker/registry/auth/htpasswd\n[root@img-tools registry]# cat /opt/docker/registry/auth/htpasswd\nadmin:$2y$05$7Jy0VmD3I3HDBczRBgcoa.A8Kz4rxdtlM5lx5GrHdCSDk.DrSnUXO\n\n\n\u542f\u52a8\u5e26\u8ba4\u8bc1\u7684 Docker Registry\nREGISTRY_AUTH=htpasswd # \u4ee5 htpasswd \u7684\u65b9\u5f0f\u8ba4\u8bc1\nREGISTRY_AUTH_HTPASSWD_REALM=Registry Realm # \u6ce8\u518c\u8ba4\u8bc1\nREGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd # \u8ba4\u8bc1\u7684\u7528\u6237\u5bc6\u7801\n\n# \u542f\u52a8 \u5e26\u4e0d\u53ef\u4fe1\u8bc1\u4e66\uff0c\u5f85\u7528\u6237\u8ba4\u8bc1\ndocker run -p 5000:5000 --restart=always --name myregistry -v /registry/:/var/lib/registry -v /opt/docker/registry/certs:/certs -v /opt/docker/registry/auth/:/auth/ -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key -e \"REGISTRY_AUTH=htpasswd\" -e \"REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm\" -e \"REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd\"  -d registry\n\n\n# \u4e0d\u5e26https\uff0c\u4ec5\u5f85\u7528\u6237\u8ba4\u8bc1\ndocker run -p 5000:5000 --restart=always --name myregistry -v /registry/:/var/lib/registry -v /opt/docker/registry/auth/:/auth/  -e \"REGISTRY_AUTH=htpasswd\" -e \"REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm\" -e \"REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd\"  -d registry\n\n# \u4e0d\u5b89\u5168\uff0c\n[root@img-tools ~]# curl -X GET registryxl.com:5000/v2/_catalog -uadmin\nEnter host password for user 'admin':\n{\"repositories\":[\"mycentos\"]}\n\n\n[root@img-tools registry]# docker login https://registryxl.com:5000\nUsername: admin\nPassword:\nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n\n\n\n[root@img-tools ~]# curl -X GET https://registryxl.com:5000/v2/_catalog -u admin -k\nEnter host password for user 'admin':\n{\"repositories\":[\"mycentos\"]}\n</code></pre> <p></p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li> <p>https://blog.csdn.net/wennuanddianbo/article/details/95205644</p> </li> <li> <p>https://www.cnblogs.com/chen2ha/p/14787695.html</p> </li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/","title":"OCI\u955c\u50cf\u5236\u4f5c\u5de5\u5177\u4e4bskopeo","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#ociskopeo","title":"OCI\u955c\u50cf\u5236\u4f5c\u5de5\u5177\u4e4bskopeo","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#_1","title":"\u524d\u8a00","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#slopeo","title":"\u4e00 slopeo\u7b80\u4ecb","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#11","title":"1.1 \u7b80\u4ecb","text":"<p>skopeo \u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u5bf9\u5bb9\u5668\u955c\u50cf\u548c\u955c\u50cf\u5e93\u6267\u884c\u5404\u79cd\u64cd\u4f5c\uff0c\u652f\u6301\u4f7f\u7528 OCI \u955c\u50cf\u4e0e\u539f\u59cb\u7684 Docker v2 \u955c\u50cf\u3002\u53ef\u5bf9\u5bb9\u5668\u955c\u50cf\u548c\u5bb9\u5668\u5b58\u50a8\u8fdb\u884c\u64cd\u4f5c\u3002 \u5728\u6ca1\u6709dockerd\u7684\u73af\u5883\u4e0b\uff0c\u4f7f\u7528 skopeo \u64cd\u4f5c\u955c\u50cf\u662f\u975e\u5e38\u65b9\u4fbf\u7684\u3002Skopeo \u80fd\u591f\u5728\u5bb9\u5668\u6ce8\u518c\u8868\u4e0a\u68c0\u67e5\u5b58\u50a8\u5e93\u5e76\u83b7\u53d6\u56fe\u7247\u5c42\u3002Inspect \u547d\u4ee4\u83b7\u53d6\u5b58\u50a8\u5e93\u7684\u6e05\u5355\uff0c\u5b83\u80fd\u591f\u5411\u60a8\u663e\u793a\u5173\u4e8e\u6574\u4e2a\u5b58\u50a8\u5e93\u6216\u6807\u8bb0\u7684\u7c7b\u4f3c docker inspect \u7684 json \u8f93\u51fa\u3002\u4e0e docker inspect \u4e0d\u540c\uff0c\u8fd9\u4e2a\u5de5\u5177\u53ef\u4ee5\u5e2e\u52a9\u60a8\u5728\u62c9\u53d6\u5b58\u50a8\u5e93\u6216\u6807\u8bb0\u4e4b\u524d(\u4f7f\u7528\u78c1\u76d8\u7a7a\u95f4)\u6536\u96c6\u6709\u7528\u7684\u4fe1\u606f\u3002Inspect \u547d\u4ee4\u53ef\u4ee5\u663e\u793a\u7ed9\u5b9a\u5b58\u50a8\u5e93\u53ef\u7528\u7684\u6807\u8bb0\u3001\u56fe\u50cf\u7684\u6807\u7b7e\u3001\u56fe\u50cf\u7684\u521b\u5efa\u65e5\u671f\u548c\u64cd\u4f5c\u7cfb\u7edf\u7b49\u7b49\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#12","title":"1.2 \u7279\u6027","text":"<p>skopeo \u4f7f\u7528 API V2 \u6ce8\u518c\u8868\uff0c\u4f8b\u5982 Docker \u6ce8\u518c\u8868\u3001Atomic \u6ce8\u518c\u8868\u3001\u79c1\u6709\u6ce8\u518c\u8868\u3001\u672c\u5730\u76ee\u5f55\u548c\u672c\u5730 OCI \u5e03\u5c40\u76ee\u5f55\u3002skopeo \u4e0d\u9700\u8981\u8fd0\u884c\u5b88\u62a4\u8fdb\u7a0b\uff0c\u5b83\u53ef\u4ee5\u6267\u884c\u7684\u64cd\u4f5c\u5305\u62ec\uff1a</p> <ul> <li>\u901a\u8fc7\u5404\u79cd\u5b58\u50a8\u673a\u5236\u590d\u5236\u955c\u50cf\uff0c\u4f8b\u5982\uff0c\u53ef\u4ee5\u5728\u4e0d\u9700\u8981\u7279\u6743\u7684\u60c5\u51b5\u4e0b\u5c06\u955c\u50cf\u4ece\u4e00\u4e2a\u6ce8\u518c\u8868\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u6ce8\u518c\u8868</li> <li>\u68c0\u6d4b\u8fdc\u7a0b\u955c\u50cf\u5e76\u67e5\u770b\u5176\u5c5e\u6027\uff0c\u5305\u62ec\u5176\u56fe\u5c42\uff0c\u65e0\u9700\u5c06\u955c\u50cf\u62c9\u5230\u672c\u5730</li> <li>\u4ece\u955c\u50cf\u5e93\u4e2d\u5220\u9664\u955c\u50cf</li> <li>\u5f53\u5b58\u50a8\u5e93\u9700\u8981\u65f6\uff0cskopeo \u53ef\u4ee5\u4f20\u9012\u9002\u5f53\u7684\u51ed\u636e\u548c\u8bc1\u4e66\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1</li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#_2","title":"\u4e8c \u5b89\u88c5","text":"<ul> <li>RHEL/CentOS \u2264 7.x</li> </ul> <pre><code>sudo yum -y install skopeo\n</code></pre> <ul> <li>macOS</li> </ul> <pre><code>brew install skopeo\n</code></pre> <p>\u8be6\u7ec6\u53ef\u53c2\u8003\uff1ahttps://github.com/containers/skopeo/blob/main/install.md</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#_3","title":"\u4e09 \u4f7f\u7528","text":"<pre><code>$ skopeo -h\nVarious operations with container images and container image registries\n\nUsage:\n  skopeo [flags]\n  skopeo [command]\n\nAvailable Commands:\n  copy                                          Copy an IMAGE-NAME from one location to another\n  delete                                        Delete image IMAGE-NAME\n  help                                          Help about any command\n  inspect                                       Inspect image IMAGE-NAME\n  list-tags                                     List tags in the transport/repository specified by the REPOSITORY-NAME\n  login                                         Login to a container registry\n  logout                                        Logout of a container registry\n  manifest-digest                               Compute a manifest digest of a file\n  standalone-sign                               Create a signature using local files\n  standalone-verify                             Verify a signature using local files\n  sync                                          Synchronize one or more images from one location to another\n\nFlags:\n      --command-timeout duration   timeout for the command execution\n      --debug                      enable debug output\n  -h, --help                       help for skopeo\n      --insecure-policy            run the tool without any policy check\n      --override-arch ARCH         use ARCH instead of the architecture of the machine for choosing images\n      --override-os OS             use OS instead of the running OS for choosing images\n      --override-variant VARIANT   use VARIANT instead of the running architecture variant for choosing images\n      --policy string              Path to a trust policy file\n      --registries.d DIR           use registry configuration files in DIR (e.g. for container signature storage)\n      --tmpdir string              directory used to store temporary files\n  -v, --version                    Version for Skopeo\n\nUse \"skopeo [command] --help\" for more information about a command.\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#31","title":"3.1 \u68c0\u67e5\u5b58\u50a8\u5e93","text":"<ul> <li>\u663e\u793a\u955c\u50cf\u5c5e\u6027</li> <li>\u8fdc\u7a0b\u4ed3\u5e93</li> </ul> <p><code>docker://</code>: \u662f\u4f7f\u7528 Docker Registry HTTP API V2 \u8fdb\u884c\u8fde\u63a5\u8fdc\u7aef</p> <p><code>docker.io</code>: \u8fdc\u7a0b\u4ed3\u5e93</p> <p><code>fedora:latest</code>: \u955c\u50cf\u540d\u79f0\u53catag</p> <pre><code>$ skopeo inspect docker://docker.io/fedora:latest\n</code></pre> <p>\u5229\u7528jq\u67e5\u770b\u6307\u5b9a\u7684\u4fe1\u606f\u3002</p> <pre><code>$ skopeo inspect docker://registry.fedoraproject.org/fedora:latest | jq .Digest\n</code></pre> <ul> <li>\u67e5\u770b\u672c\u5730\u955c\u50cf</li> </ul> <pre><code>$ skopeo inspect docker-daemon:mysql:8.0.19\n{\n    \"Name\": \"docker.io/library/mysql\",\n    \"Digest\": \"sha256:8084d869573a2e1be9d49d1b8dea49b54fc43301a3ead4b8124eedb809cf3c3f\",\n    \"RepoTags\": [],\n    \"Created\": \"2020-04-23T04:14:55.648457026Z\",\n    \"DockerVersion\": \"18.09.7\",\n    \"Labels\": null,\n    \"Architecture\": \"amd64\",\n    \"Os\": \"linux\",\n    \"Layers\": [\n        \"sha256:c2adabaecedbda0af72b153c6499a0555f3a769d52370469d8f6bd6328af9b13\",\n        \"sha256:49003fe88142d189c33a6e52b97081c8d62b67e0d04e9e7421ca6a2495b0d766\",\n        \"sha256:8d3b3830445d713c580008a547de7398ab721a083fda915526ce2cc557c4f40a\",\n        \"sha256:49baacc63c3bb5a7ab5077ef6458d6e246710195d7794cb704940f3a40495c23\",\n        \"sha256:24bd91e7be374167e51e37faa31e7ce143921afb0b968415c749625319386fdb\",\n        \"sha256:d84f8cf1dc236ea2ddbc0393b0c33099bedb20fffbe68bdf170d2df161a1ca16\",\n        \"sha256:ace74cb61ec0a3fd2847dc3a0b8b0cad349c95ce02732982e258fc1a337d073f\",\n        \"sha256:ba6f785586f5ff477e87528a5d2c8d0215e22f5b9ac3a8f4b19a033cad7aa832\",\n        \"sha256:c861c8d6e01539cc5b27fe773aca63958bc361391f6a980ece5322fd8dbca296\",\n        \"sha256:1ac7b6bb690abc8073c2193635afb06b8494d2d0024dc08310b296975f92bb61\",\n        \"sha256:b8e742ca24b882430bf4a6075aa97a8c1e8809f6e59d462cba05bec49d817ff3\",\n        \"sha256:7fc1a766ce1413db3d5fceb7256c1e54639386673c24eadaf69b429b07eb9223\"\n    ],\n    \"Env\": [\n        \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\n        \"GOSU_VERSION=1.12\",\n        \"MYSQL_MAJOR=8.0\",\n        \"MYSQL_VERSION=8.0.19-1debian10\"\n    ]\n}\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#32","title":"3.2 \u62f7\u8d1d\u955c\u50cf","text":"<p>\u5728\u4e0d\u4f7f\u7528 docker \u7684\u60c5\u51b5\u4e0b\u4ece\u8fdc\u7aef\u4e0b\u8f7d\u955c\u50cf</p> <pre><code># \u4e0b\u8f7d\u8fdc\u7a0b\u955c\u50cf\u5230/tmp/\u4e0b\uff0c\u547d\u540d\u4e3anginx.tar\nskopeo --insecure-policy copy docker://nginx:1.17.6 docker-archive:/tmp/nginx.tar\n\n# \u5c06\u672c\u5730tar\u955c\u50cf\u6587\u4ef6\u5bfc\u5165\u5230docker\u4e2d\nskopeo copy docker-archive:/tmp/nginx.tar docker-daemon:nginx:latest\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#33","title":"3.3 \u5220\u9664\u955c\u50cf","text":"<pre><code>skopeo delete docker://localhost:5000/nginx:latest\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#34","title":"3.4 \u6ce8\u518c\u8868\u8ba4\u8bc1","text":"<p>\u8ba4\u8bc1\u6587\u4ef6\u9ed8\u8ba4\u5b58\u653e\u5728<code>$HOME/.docker/config.json</code></p> <p>\u6587\u4ef6\u5185\u5bb9</p> <pre><code>{\n    \"auths\": {\n        \"myregistrydomain.com:5000\": {\n            \"auth\": \"dGVzdHVzZXI6dGVzdHBhc3N3b3Jk\",\n            \"email\": \"stuf@ex.cm\"\n        }\n    }\n}\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/OCI%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8Bskopeo/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.redhat.com/zh/blog/skopeo-copy-rescue</li> <li>https://github.com/containers/skopeo</li> <li>https://lework.github.io/2020/04/13/skopeo/</li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/","title":"Podman\u8be6\u89e3","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u4e4b\u524d\u4f7f\u7528Docker\uff0c\u4f46\u662f\u5728\u4e00\u4e9b\u573a\u666fDocker\u4e0d\u662f\u5f88\u9002\u7528\uff0cDocker\u662f\u4e00\u4e2aC/S\u67b6\u6784\uff0c\u8fd0\u884c\u5bb9\u5668\u9700\u8981Daemon\uff0c\u4f46\u662f\u4e00\u4e0b\u7b80\u5355\u6d4b\u8bd5\u6216\u8005CI/CD\u4e2d\uff0c\u6ca1\u6709Daemon\uff0c\u6216\u8005\u6ca1\u6709root\u6743\u9650\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u7684\u4e00\u4e9b\u9075\u5faaOCI\u63a5\u53e3\u89c4\u8303\u7684\u5de5\u5177\uff0c\u4f8b\u5982\u7ea2\u5e3d\u7684podman\uff0c\u5176\u662ffork/exec\u6a21\u578b\uff0c\u76f4\u63a5\u901a\u8fc7 OCI runtime\uff08\u9ed8\u8ba4\u4e5f\u662f <code>runc</code>\uff09\u6765\u542f\u52a8\u5bb9\u5668\uff0c\u65e0\u9700Daemon\u540e\u53f0\u8fdb\u7a0b\uff0c\u6240\u4ee5\u5229\u7528podman\u542f\u52a8\u7684\u5bb9\u5668\u662fpodman\u7684\u5b50\u8fdb\u7a0b\uff0c</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#_2","title":"\u4e8c \u6982\u5ff5","text":"<p>Podman \u662f Libpod \u7684\u4e00\u90e8\u5206\uff0c\u5b83\u7684\u5b9a\u4e49\u53ef\u4ee5\u7b80\u5355\u7528\u8fd9\u4e2a\u547d\u4ee4\u8868\u793a\uff1a<code>alias docker=podman</code></p> <p>Libpod \u662f\u4e00\u4e2a\u521b\u5efa\u5bb9\u5668 pod \u7684\u5de5\u5177\u548c\u5e93\uff0c\u5b83**\u5305\u542b pod \u7ba1\u7406\u5de5\u5177 Podman**\uff0cPodman \u7ba1\u7406 pod\u3001\u5bb9\u5668\u3001\u5bb9\u5668\u955c\u50cf\u548c\u5bb9\u5668\u5377\u3002</p> <p>\u5728\u8f83\u9ad8\u7684\u5c42\u9762\u4e0a\uff0cLibpod \u548c Podman \u7684\u4f5c\u7528\u8303\u56f4\u5982\u4e0b\uff1a</p> <ul> <li>\u652f\u6301\u591a\u79cd\u955c\u50cf\u683c\u5f0f\uff0c\u5305\u62ec OCI \u548c Docker\u3002</li> <li>\u652f\u6301\u591a\u79cd\u65b9\u5f0f\u4e0b\u8f7d\u955c\u50cf\uff0c\u5305\u62ec\u4fe1\u4efb\u548c\u955c\u50cf\u9a8c\u8bc1\u3002</li> <li>\u5bb9\u5668\u955c\u50cf\u7ba1\u7406\uff0c\u7ba1\u7406\u955c\u50cf\u5c42\u3001\u8986\u76d6\u6587\u4ef6\u7cfb\u7edf\u7b49\u3002</li> <li>\u5168\u9762\u7ba1\u7406\u5bb9\u5668\u751f\u547d\u5468\u671f\u3002</li> <li>\u652f\u6301 pod \u7ba1\u7406\u5bb9\u5668\u7ec4\u3002</li> <li>pos \u548c\u5bb9\u5668\u7684\u8d44\u6e90\u9694\u79bb\u3002</li> <li>\u4e0e CRI-O \u96c6\u6210\u4ee5\u5171\u4eab\u5bb9\u5668\u548c\u540e\u7aef\u4ee3\u7801\u3002</li> </ul> <p>\u652f\u6301 Fedora\u3001RHEL \u4e0e Ubuntu \u7b49\u7684\u4e0d\u540c\u7248\u672c\u3002</p> <ol> <li>\u5141\u8bb8 Podman CLI \u4f7f\u7528 Varlink \u540e\u7aef\u8fde\u63a5\u5230\u8fdc\u7a0b Podman \u5b9e\u4f8b\u3002</li> <li>\u5c06 Libpod \u96c6\u6210\u5230 CRI-O \u4e2d\u4ee5\u66ff\u6362\u5176\u73b0\u6709\u7684\u5bb9\u5668\u7ba1\u7406\u540e\u7aef\u3002</li> <li>\u8fdb\u4e00\u6b65\u6539\u8fdb Podman pod \u547d\u4ee4</li> <li>\u4e0d\u9700\u8981 root\uff08rootless\uff09\u5bb9\u5668\u7684\u8fdb\u4e00\u6b65\u6539\u8fdb</li> </ol>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#21-oci","title":"2.1 OCI","text":"<p>\u56e0\u4e3a\u5b83\u4eec\uff08\u5305\u62ecDocker\uff09\u90fd\u9075\u5faaOCI \uff08Open Container Initiative\uff09\u4e0b\u7684\u76f8\u540c\u89c4\u8303\u3002\u5b83\u4eec\u5305\u542b\u4e86\u5bb9\u5668\u8fd0\u884c\u65f6\u3001\u5bb9\u5668\u5206\u53d1\u548c\u5bb9\u5668\u955c\u50cf\u7684\u89c4\u8303\uff0c\u5176\u4e2d\u6db5\u76d6\u4e86\u4f7f\u7528\u5bb9\u5668\u6240\u9700\u7684\u6240\u6709\u7279\u6027\u3002</p> <p>\u6709\u4e86OCI\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u4e00\u5957\u6700\u7b26\u5408\u4f60\u9700\u6c42\u7684\u5de5\u5177\uff0c\u540c\u65f6\u4f60\u4ecd\u7136\u53ef\u4ee5\u4eab\u53d7\u8ddfDocker\u4e00\u6837\u4f7f\u7528\u76f8\u540c\u7684API\u548cCLI\u547d\u4ee4\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#22","title":"2.2 \u5bb9\u5668\u5f15\u64ce","text":"<p>\u76ee\u524d\u5df2\u7ecf\u6709\u8bb8\u591a\u5bb9\u5668\u5f15\u64ce\uff0c\u4f46Docker\u6700\u7a81\u51fa\u7684\u7ade\u4e89\u5bf9\u624b\u662f\u7531\u7ea2\u5e3d\u5f00\u53d1\u7684Podman\u3002\u4e0eDocker\u4e0d\u540c\uff0cPodman\u4e0d\u9700\u8981Daemon\u6765\u8fd0\u884c\uff0c\u4e5f\u4e0d\u9700\u8981root\u7279\u6743\uff0c\u8fd9\u662fDocker\u957f\u671f\u4ee5\u6765\u4e00\u76f4\u5173\u6ce8\u7684\u95ee\u9898\u3002\u57fa\u4e8e\u5b83\u7684\u540d\u5b57\uff0cPodman\u4e0d\u4ec5\u53ef\u4ee5\u8fd0\u884c\u5bb9\u5668\uff0c\u8fd8\u53ef\u4ee5\u8fd0\u884cpods\u3002</p> <ul> <li>LXD\u2014\u2014LXC \uff08Linux Containers\uff09\u662f\u4e00\u4e2a\u5bb9\u5668\u7ba1\u7406\u5668\uff08\u5b88\u62a4\u8fdb\u7a0b\uff09\u3002\u8be5\u5de5\u5177\u63d0\u4f9b\u4e86\u8fd0\u884c\u7cfb\u7edf\u5bb9\u5668\u7684\u80fd\u529b\uff0c\u8fd9\u4e9b\u7cfb\u7edf\u5bb9\u5668\u63d0\u4f9b\u4e86\u66f4\u7c7b\u4f3c\u4e8eVM\u7684\u5bb9\u5668\u73af\u5883\u3002\u5b83\u4f4d\u4e8e\u975e\u5e38\u72ed\u7a84\u7684\u7a7a\u95f4\uff0c\u6ca1\u4ec0\u4e48\u7528\u6237\uff0c\u6240\u4ee5\u9664\u975e\u4f60\u6709\u975e\u5e38\u5177\u4f53\u7684\u5b9e\u4f8b\uff0c\u5426\u5219\u6700\u597d\u8fd8\u662f\u4f7f\u7528Docker\u6216Podman\u3002</li> <li>CRI-O\u2014\u2014\u5f53\u4f60Google\u4ec0\u4e48\u662fCRI-O\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u5b83\u88ab\u63cf\u8ff0\u4e3a\u5bb9\u5668\u5f15\u64ce\u3002\u4e0d\u8fc7\uff0c\u5b9e\u9645\u4e0a\u5b83\u53ea\u662f\u5bb9\u5668\u8fd0\u884c\u65f6\u3002\u5176\u5b9e\u5b83\u65e2\u4e0d\u662f\u5f15\u64ce\uff0c\u4e5f\u4e0d\u9002\u5408\u201c\u6b63\u5e38\u201d\u4f7f\u7528\u3002\u6211\u7684\u610f\u601d\u662f\uff0c\u5b83\u662f\u4e13\u95e8\u4e3aKubernetes\u8fd0\u884c\u65f6\uff08CRI\uff09\u800c\u6784\u5efa\u7684\uff0c\u800c\u4e0d\u662f\u4e3a\u6700\u7ec8\u7528\u6237\u4f7f\u7528\u7684\u3002</li> <li>Rkt\u2014\u2014rkt\uff08\u201c\u706b\u7bad\u201d\uff09\u662f\u7531CoreOS\u5f00\u53d1\u7684\u5bb9\u5668\u5f15\u64ce\u3002\u8fd9\u91cc\u63d0\u5230\u8fd9\u4e2a\u9879\u76ee\u53ea\u662f\u4e3a\u4e86\u5b8c\u6574\u6027\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u9879\u76ee\u5df2\u7ecf\u7ed3\u675f\uff0c\u5f00\u53d1\u4e5f\u505c\u6b62\u4e86\u2014\u2014\u6240\u4ee5\u4e5f\u5c31\u6ca1\u5fc5\u8981\u518d\u4f7f\u7528\u4e86\u3002</li> </ul> <p>Podman \u539f\u6765\u662f CRI-O \u9879\u76ee\u7684\u4e00\u90e8\u5206\uff0c\u540e\u6765\u88ab\u5206\u79bb\u6210\u4e00\u4e2a\u5355\u72ec\u7684\u9879\u76ee\u53eb libpod\u3002Podman \u7684\u4f7f\u7528\u4f53\u9a8c\u548c Docker \u7c7b\u4f3c\uff0c\u4e0d\u540c\u7684\u662f Podman \u6ca1\u6709 daemon\u3002\u4ee5\u524d\u4f7f\u7528 Docker CLI \u7684\u65f6\u5019\uff0cDocker CLI \u4f1a\u901a\u8fc7 gRPC API \u53bb\u8ddf Docker Engine \u8bf4\u300c\u6211\u8981\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u300d\uff0c\u7136\u540e Docker Engine \u624d\u4f1a\u901a\u8fc7 OCI Container runtime\uff08\u9ed8\u8ba4\u662f runc\uff09\u6765\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u3002\u8fd9\u5c31\u610f\u5473\u7740\u5bb9\u5668\u7684\u8fdb\u7a0b\u4e0d\u53ef\u80fd\u662f Docker CLI \u7684\u5b50\u8fdb\u7a0b\uff0c\u800c\u662f Docker Engine \u7684\u5b50\u8fdb\u7a0b\u3002</p> <p>Podman \u6bd4\u8f83\u7b80\u5355\u7c97\u66b4\uff0c\u5b83\u4e0d\u4f7f\u7528 Daemon\uff0c\u800c\u662f\u76f4\u63a5\u901a\u8fc7 OCI runtime\uff08\u9ed8\u8ba4\u4e5f\u662f runc\uff09\u6765\u542f\u52a8\u5bb9\u5668\uff0c\u6240\u4ee5\u5bb9\u5668\u7684\u8fdb\u7a0b\u662f podman \u7684\u5b50\u8fdb\u7a0b\u3002\u8fd9\u6bd4\u8f83\u50cf Linux \u7684 fork/exec \u6a21\u578b\uff0c\u800c Docker \u91c7\u7528\u7684\u662f C/S\uff08\u5ba2\u6237\u7aef/\u670d\u52a1\u5668\uff09\u6a21\u578b\u3002\u4e0e C/S \u6a21\u578b\u76f8\u6bd4\uff0cfork/exec \u6a21\u578b\u6709\u5f88\u591a\u4f18\u52bf\uff0c\u6bd4\u5982\uff1a</p> <p>\u7cfb\u7edf\u7ba1\u7406\u5458\u53ef\u4ee5\u77e5\u9053\u67d0\u4e2a\u5bb9\u5668\u8fdb\u7a0b\u5230\u5e95\u662f\u8c01\u542f\u52a8\u7684\u3002</p> <p>\u5982\u679c\u5229\u7528 cgroup \u5bf9 podman \u505a\u4e00\u4e9b\u9650\u5236\uff0c\u90a3\u4e48\u6240\u6709\u521b\u5efa\u7684\u5bb9\u5668\u90fd\u4f1a\u88ab\u9650\u5236\u3002</p> <p>SD_NOTIFY : \u5982\u679c\u5c06 podman \u547d\u4ee4\u653e\u5165 systemd \u5355\u5143\u6587\u4ef6\u4e2d\uff0c\u5bb9\u5668\u8fdb\u7a0b\u53ef\u4ee5\u901a\u8fc7 podman \u8fd4\u56de\u901a\u77e5\uff0c\u8868\u660e\u670d\u52a1\u5df2\u51c6\u5907\u597d\u63a5\u6536\u4efb\u52a1\u3002</p> <p>socket \u6fc0\u6d3b : \u53ef\u4ee5\u5c06\u8fde\u63a5\u7684 socket \u4ece systemd \u4f20\u9012\u5230 podman\uff0c\u5e76\u4f20\u9012\u5230\u5bb9\u5668\u8fdb\u7a0b\u4ee5\u4fbf\u4f7f\u7528\u5b83\u4eec\u3002</p> <p>\u5e9f\u8bdd\u4e0d\u591a\u8bf4\uff0c\u4e0b\u9762\u6211\u4eec\u76f4\u63a5\u8fdb\u5165\u5b9e\u6218\u73af\u8282\uff0c\u672c\u6587\u5c06\u624b\u628a\u624b\u6559\u4f60\u5982\u4f55\u7528 podman \u6765\u90e8\u7f72\u9759\u6001\u535a\u5ba2\uff0c\u5e76\u901a\u8fc7 Sidecar \u6a21\u5f0f\u5c06\u535a\u5ba2\u6240\u5728\u7684\u5bb9\u5668\u52a0\u5165\u5230 Envoy mesh \u4e4b\u4e2d\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#_3","title":"\u4e09 \u5b9e\u64cd","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#31","title":"3.1 \u5b89\u88c5","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#311-linux","title":"3.1.1 Linux\u5b89\u88c5","text":"<p>Centos 8 \u9ed8\u8ba4\u4f7f\u7528podman</p> <pre><code>$ sudo yum -y install podman\n</code></pre> <ul> <li>\u914d\u7f6e\u52a0\u901f</li> </ul> <p>\u6539\u540d\u5e76\u5907\u4efd\u597d\u6587\u4ef6\uff1a<code>/etc/containers/registries.conf</code> \u518d\u65b0\u5efa\u4e00\u4e2a\u7a7a\u7684 registries.conf \u6587\u4ef6\uff0c\u63d2\u5165\u5982\u4e0b\u5185\u5bb9</p> <pre><code>unqualified-search-registries = [\"docker.io\"]\n[[registry]]\nprefix = \"docker.io\"\nlocation = \"5980zxy5.mirror.aliyuncs.com\"\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#312-mac","title":"3.1.2 Mac\u5b89\u88c5","text":"<pre><code>$ brew install podman\n</code></pre> <p>\u542f\u7528podman\u670d\u52a1</p> <pre><code>$ podman images ls\nCannot connect to Podman. Please verify your connection to the Linux system using `podman system connection list`, or try `podman machine init` and `podman machine start` to manage a new Linux VM\nError: unable to connect to Podman socket: Get \"http://d/v3.4.0/libpod/_ping\": dial unix ///var/folders/wn/367g1v9n1bv0sg1k8qldzym80000gn/T/podman-run--1/podman/podman.sock: connect: no such file or directory\n\n# \u9700\u8981\u542f\u52a8machine \n$ podman machine init\nDownloading VM image: fedora-coreos-34.20211004.2.0-qemu.x86_64.qcow2.xz: done\nExtracting compressed file\n$ podman machine start\nINFO[0000] waiting for clients...\nINFO[0000] listening tcp://0.0.0.0:7777\nINFO[0000] new connection from  to /var/folders/wn/367g1v9n1bv0sg1k8qldzym80000gn/T/podman/qemu_podman-machine-default.sock\nWaiting for VM ...\n2Machine \"podman-machine-default\" started successfully\n</code></pre> <p>\u6ce8\u610f\uff1a\u518d\u6b21\u4f7f\u7528\u7684\u5faevm\u4f7f\u7528\u7684\u955c\u50cf\uff0c\u4e0d\u662f\u5bbf\u4e3b\u673a\u7684\u955c\u50cf\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#32","title":"3.2 \u57fa\u7840\u547d\u4ee4","text":"<pre><code>Manage pods, containers and images\n\nUsage:\n  podman [options] [command]\n\nAvailable Commands:\n  attach      Attach to a running container\n  build       Build an image using instructions from Containerfiles\n  commit      Create new image based on the changed container\n  container   Manage containers\n  create      Create but do not start a container\n  diff        Display the changes to the object's file system\n  events      Show podman events\n  exec        Run a process in a running container\n  export      Export container's filesystem contents as a tar archive\n  generate    Generate structured data based on containers and pods.\n  healthcheck Manage health checks on containers\n  help        Help about any command\n  history     Show history of a specified image\n  image       Manage images\n  images      List images in local storage\n  import      Import a tarball to create a filesystem image\n  info        Display podman system information\n  init        Initialize one or more containers\n  inspect     Display the configuration of object denoted by ID\n  kill        Kill one or more running containers with a specific signal\n  load        Load image(s) from a tar archive\n  login       Login to a container registry\n  logout      Logout of a container registry\n  logs        Fetch the logs of one or more containers\n  manifest    Manipulate manifest lists and image indexes\n  network     Manage networks\n  pause       Pause all the processes in one or more containers\n  play        Play a pod and its containers from a structured file.\n  pod         Manage pods\n  port        List port mappings or a specific mapping for the container\n  ps          List containers\n  pull        Pull an image from a registry\n  push        Push an image to a specified destination\n  restart     Restart one or more containers\n  rm          Remove one or more containers\n  rmi         Removes one or more images from local storage\n  run         Run a command in a new container\n  save        Save image(s) to an archive\n  search      Search registry for image\n  start       Start one or more containers\n  stats       Display a live stream of container resource usage statistics\n  stop        Stop one or more containers\n  system      Manage podman\n  tag         Add an additional name to a local image\n  top         Display the running processes of a container\n  unpause     Unpause the processes in one or more containers\n  untag       Remove a name from a local image\n  version     Display the Podman Version Information\n  volume      Manage volumes\n  wait        Block on one or more containers\n\nOptions:\n  -c, --connection string   Connection to use for remote Podman service\n      --help                Help for podman\n      --identity string     path to SSH identity file, (CONTAINER_SSHKEY)\n      --log-level string    Log messages above specified level (debug, info, warn, error, fatal, panic) (default \"error\")\n      --url string          URL to access Podman service (CONTAINER_HOST) (default \"unix:/var/folders/wn/367g1v9n1bv0sg1k8qldzym80000gn/T/podman-run--1/podman/podman.sock\")\n  -v, --version             version for podman\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#33","title":"3.3 \u8fd0\u884c\u4e00\u4e2a\u57fa\u7840\u547d\u4ee4","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#331","title":"3.3.1 \u67e5\u770b\u4fe1\u606f","text":"<pre><code>$ podman --remote info\nhost:\n  arch: amd64\n  buildahVersion: 1.15.1\n  cgroupVersion: v1\n  conmon:\n    package: conmon-2.0.20-2.module_tl3+88+de755738.x86_64\n    path: /usr/bin/conmon\n    version: 'conmon version 2.0.20, commit: a9ae6b9ffaadd564332ddf93b4641d48137430bf'\n  cpus: 2\n  distribution:\n    distribution: '\"tencentos\"'\n    version: \"3.1\"\n  eventLogger: file\n  hostname: xuel-terraform-cvm-0\n  idMappings:\n    gidmap: null\n    uidmap: null\n  kernel: 5.4.119-19-0006\n  linkmode: dynamic\n  memFree: 2587340800\n  memTotal: 3851665408\n  ociRuntime:\n    name: runc\n    package: runc-1.0.0-68.rc92.module_tl3+88+de755738.x86_64\n    path: /usr/bin/runc\n    version: 'runc version spec: 1.0.2-dev'\n  os: linux\n  remoteSocket:\n    path: /run/podman/podman.sock\n  rootless: false\n  slirp4netns:\n    executable: \"\"\n    package: \"\"\n    version: \"\"\n  swapFree: 0\n  swapTotal: 0\n  uptime: 8m 7.8s\nregistries:\n  search:\n  - registry.access.redhat.com\n  - registry.redhat.io\n  - docker.io\nstore:\n  configFile: /etc/containers/storage.conf\n  containerStore:\n    number: 0\n    paused: 0\n    running: 0\n    stopped: 0\n  graphDriverName: overlay\n  graphOptions:\n    overlay.mountopt: nodev,metacopy=on\n  graphRoot: /var/lib/containers/storage\n  graphStatus:\n    Backing Filesystem: extfs\n    Native Overlay Diff: \"false\"\n    Supports d_type: \"true\"\n    Using metacopy: \"true\"\n  imageStore:\n    number: 0\n  runRoot: /var/run/containers/storage\n  volumePath: /var/lib/containers/storage/volumes\nversion:\n  APIVersion: 1\n  Built: 1618972697\n  BuiltTime: Wed Apr 21 10:38:17 2021\n  GitCommit: \"\"\n  GoVersion: go1.14.12\n  OsArch: linux/amd64\n  Version: 2.0.5\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#332","title":"3.3.2 \u8fd0\u884c\u5bb9\u5668","text":"<pre><code># \u62c9\u53d6\u5bb9\u5668\n$ podman pull nginx:latest\n\n# \u8fd0\u884c\u5bb9\u5668\n$ podman run -itd -p 80:80 nginx:latest\n6ccd9783fe8b868ef273618570bfff5d40abea9c45e252e5033a2f4b3f6725f8\n\n# \u67e5\u770b\u5bb9\u5668\n$ podman ps -a\nCONTAINER ID  IMAGE                           COMMAND               CREATED        STATUS            PORTS               NAMES\n6ccd9783fe8b  docker.io/library/nginx:latest  nginx -g daemon o...  9 seconds ago  Up 8 seconds ago  0.0.0.0:80-&gt;80/tcp  affectionate_rubin\n\n# \u67e5\u770b\u5bb9\u5668\u65e5\u5fd7\n$ podman logs 6ccd9783fe8b\n/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\n/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\n10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf\n10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh\n/docker-entrypoint.sh: Configuration complete; ready for start up\n2021/10/08 06:28:55 [notice] 1#1: using the \"epoll\" event method\n</code></pre> <p>podman \u57fa\u672c\u4e0a\u548cdocker\u547d\u4ee4\u662f\u4e00\u81f4\u7684\uff0c\u5982\u679c\u719f\u6089docker\uff0c\u53ef\u4ee5\u5c06podman\uff0calias\u4e3adocker\u6765\u4f7f\u7528</p> <pre><code>$ alias docker='podman'\n$ docker  ps -a\nCONTAINER ID  IMAGE                           COMMAND               CREATED        STATUS            PORTS               NAMES\n6ccd9783fe8b  docker.io/library/nginx:latest  nginx -g daemon o...  3 minutes ago  Up 3 minutes ago  0.0.0.0:80-&gt;80/tcp  affectionate_rubin\n$ docker  images\nREPOSITORY               TAG     IMAGE ID      CREATED     SIZE\ndocker.io/library/nginx  latest  f8f4ffc8092c  9 days ago  138 MB\n</code></pre> <p>docker \u9879\u76ee\u5bb9\u5668\u64cd\u4f5c\u518d\u6b21\u5c31\u4e0d\u8be6\u7ec6\u6f14\u793a\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#34-pod","title":"3.4 \u8fd0\u884cpod","text":"<p>podman\u987e\u540d\u601d\u4e49\uff0c\u5176\u53ef\u4ee5\u5bf9\u63a5K8s\uff0c\u5b9e\u73b0\u76f4\u63a5\u521b\u5efaPod\uff0c</p> <pre><code>$ docker pod --help\nManage pods\n\nDescription:\n  Pods are a group of one or more containers sharing the same network, pid and ipc namespaces.\n\nUsage:\n  podman pod [command]\n\nAvailable Commands:\n  create      Create a new empty pod\n  exists      Check if a pod exists in local storage\n  inspect     Displays a pod configuration\n  kill        Send the specified signal or SIGKILL to containers in pod\n  pause       Pause one or more pods\n  prune       Remove all stopped pods and their containers\n  ps          List pods\n  restart     Restart one or more pods\n  rm          Remove one or more pods\n  start       Start one or more pods\n  stats       Display a live stream of resource usage statistics for the containers in one or more pods\n  stop        Stop one or more pods\n  top         Display the running processes of containers in a pod\n  unpause     Unpause one or more pods\n</code></pre> <p>\u8fd0\u884cpod\u4f9d\u8d56\u4e0epause\u955c\u50cf\uff0c\u9700\u8981\u5148\u62c9\u53d6\u4e0b\u6765</p> <pre><code># \u5982\u679c\u4e0d\u80fd\u8bbf\u95eek8s.gcr.io\uff0c\u53ef\u4ee5\u4ece\u5176\u4ed6\u6e90\u62c9\u53d6\u518d\u4fee\u6539tag\n$ docker pull mirrorgooglecontainers/pause:3.1\n$ docker tag docker.io/mirrorgooglecontainers/pause:3.1  k8s.gcr.io/pause:3.1\n</code></pre> <p>\u542f\u52a8pod</p> <pre><code># \u521b\u5efapod\n$ docker pod create --name mynginxpod\nf26515e8caa7c5d84b15cef6702d1ba6f83be3e6760c96f0619f9f60ac5df1e0\n\n# \u67e5\u770bpod\n$ docker  pod ls\nPOD ID        NAME        STATUS   CREATED        # OF CONTAINERS  INFRA ID\n0560f1744dee  mynginxpod  Created  2 seconds ago  1                375497f7b909\n\n# \u5728pod\u4e2d\u8fd0\u884c\u5bb9\u5668\n$ docker run -d --pod mynginxpod nginx:latest\n9f9696382299d0eef711c8ec68baa02b49635e7b9a87f22d1d951e9a326b41a9\n\n$ docker  pod ls\nPOD ID        NAME        STATUS   CREATED         # OF CONTAINERS  INFRA ID\n0560f1744dee  mynginxpod  Running  44 seconds ago  2                375497f7b909\n\n# \u67e5\u770bpod\u4e2d\u6240\u6709\u5bb9\u5668\n$ docker  ps -pa\nCONTAINER ID  IMAGE                                       COMMAND               CREATED            STATUS                PORTS   NAMES               POD ID        PODNAME\n375497f7b909  docker.io/mirrorgooglecontainers/pause:3.1                        About an hour ago  Up About an hour ago          0560f1744dee-infra  0560f1744dee  mynginxpod\n9f9696382299  docker.io/library/nginx:latest              nginx -g daemon o...  About an hour ago  Up About an hour ago          pensive_montalcini  0560f1744dee  mynginxpod\n\n# \u67e5\u770b\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\n$ docker pod top mynginxpod\nUSER    PID   PPID   %CPU    ELAPSED             TTY   TIME   COMMAND\n0       1     0      0.000   1h9m55.211491679s   ?     0s     /pause\nroot    1     0      0.000   1h9m55.212004807s   ?     0s     nginx: master process nginx -g daemon off;\nnginx   30    1      0.000   1h9m55.212053645s   ?     0s     nginx: worker process\nnginx   31    1      0.000   1h9m55.212089686s   ?     0s     nginx: worker process\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#35","title":"3.5 \u5bfc\u51fa\u8d44\u6e90\u6e05\u5355","text":"<pre><code>$ docker  generate kube mynginxpod &gt; mynginxpod.yaml\n$ cat mynginxpod.yaml\n# Generation of Kubernetes YAML is still under development!\n#\n# Save the output of this file and use kubectl create -f to import\n# it into Kubernetes.\n#\n# Created with podman-2.0.5\napiVersion: v1\nkind: Pod\nmetadata:\n  creationTimestamp: \"2021-10-08T08:14:23Z\"\n  labels:\n    app: mynginxpod\n  name: mynginxpod\nspec:\n  containers:\n  - command:\n    - nginx\n    - -g\n    - daemon off;\n    env:\n    - name: PATH\n      value: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n    - name: TERM\n      value: xterm\n    - name: PKG_RELEASE\n      value: 1~buster\n    - name: container\n      value: podman\n    - name: NGINX_VERSION\n      value: 1.21.3\n    - name: NJS_VERSION\n      value: 0.6.2\n    - name: HOSTNAME\n      value: mynginxpod\n    image: docker.io/library/nginx:latest\n    name: pensivemontalcini\n    resources: {}\n    securityContext:\n      allowPrivilegeEscalation: true\n      capabilities: {}\n      privileged: false\n      readOnlyRootFilesystem: false\n      seLinuxOptions: {}\n    workingDir: /\nstatus: {}\n---\nmetadata:\n  creationTimestamp: null\nspec: {}\nstatus:\n  loadBalancer: {}\n</code></pre> <p>\u8be5\u6587\u4ef6\u4e3a\u517c\u5bb9k8s\u7684pod\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u8be5\u6587\u4ef6\u76f4\u63a5\u521b\u5efapod</p> <pre><code>$ docker  pod ls\nPOD ID        NAME        STATUS   CREATED            # OF CONTAINERS  INFRA ID\n0560f1744dee  mynginxpod  Running  About an hour ago  2                375497f7b909\n\n# \u5220\u9664pod\n$ docker  pod rm -f mynginxpod\n0560f1744dee0492627ea28e5f19664dcee33e51a1ebf2243a6be9b5ab2f6331\n$ docker  pod ls\nPOD ID  NAME    STATUS  CREATED  # OF CONTAINERS  INFRA ID\n$ docker play kube mynginxpod.yaml\nTrying to pull docker.io/library/nginx:latest...\nGetting image source signatures\nCopying blob 4ce73aa6e9b0 skipped: already exists\nCopying blob 44ac32b0bba8 skipped: already exists\nCopying blob bbe0b7acc89c skipped: already exists\nCopying blob 07aded7c29c6 skipped: already exists\nCopying blob 91d6e3e593db skipped: already exists\nCopying blob 8700267f2376 [--------------------------------------] 0.0b / 0.0b\nCopying config f8f4ffc809 done\nWriting manifest to image destination\nStoring signatures\nPod:\n3ca51af554315e1c828f81ca29a5dbaf3a256a5037170b4378ef0bc8ad1824c5\nContainer:\n3d5c5a674f6140d86138e288db73eee1594de7598da2dd982f29299cbe97ecef\n\n$ docker  pod ls\nPOD ID        NAME        STATUS   CREATED         # OF CONTAINERS  INFRA ID\n3ca51af55431  mynginxpod  Running  44 seconds ago  2                ba4e1570dc74\n</code></pre> <p>podman \u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u4e00\u4e2a\u662f podman CLI\uff0c\u8fd8\u6709\u4e00\u4e2a\u662f container runtime\uff0ccontainer runtime \u7531 conmon \u6765\u8d1f\u8d23\uff0c\u4e3b\u8981\u5305\u62ec\u76d1\u63a7\u3001\u65e5\u5fd7\u3001TTY \u5206\u914d\u4ee5\u53ca\u7c7b\u4f3c out-of-memory \u60c5\u51b5\u7684\u6742\u4e8b\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cconmon \u662f\u6240\u6709\u5bb9\u5668\u7684\u7236\u8fdb\u7a0b\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#36","title":"3.6 \u8fd0\u884c\u4e24\u4e2a\u5bb9\u5668","text":"<pre><code>$ docker  pod ls\nPOD ID        NAME        STATUS   CREATED         # OF CONTAINERS  INFRA ID\n3ca51af55431  mynginxpod  Running  17 minutes ago  2                ba4e1570dc74\n\n# \u540c\u4e00\u4e2apod\u4e2d\u542f\u52a8\u4e09\u4e2a\u5bb9\u5668\n$ docker run -d --pod mynginxpod tomcat:latest\n08b77aeb728668d2ecea9cffe86d03e1177c903fcfcee8c91fee5816e3172d22\n$ docker pod ls\nPOD ID        NAME        STATUS   CREATED         # OF CONTAINERS  INFRA ID\n3ca51af55431  mynginxpod  Running  17 minutes ago  3                ba4e1570dc74\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#_4","title":"\u56db \u76f8\u5173\u6982\u5ff5","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#41","title":"4.1 \u5bb9\u5668\u5f15\u64ce","text":"<p>Container Engine\u662f\u4e00\u79cd\u5de5\u5177\uff0c\u5b83\u4e3a\u5904\u7406\u955c\u50cf\u548c\u5bb9\u5668\u63d0\u4f9b\u7528\u6237\u754c\u9762\uff0c\u8fdc\u7a0b\u4ed3\u5e93\u63d0\u53d6\u955c\u50cf\u5e76\u5c06\u5176\u6269\u5c55\u5230\u78c1\u76d8\u3002\u5b83\u770b\u8d77\u6765\u4e5f\u662f\u8fd0\u884c\u5bb9\u5668\uff0c\u4f46\u5b9e\u9645\u4e0a\u5b83\u7684\u5de5\u4f5c\u662f\u521b\u5efa\u5bb9\u5668\u6e05\u5355\u548c\u5e26\u6709\u955c\u50cf\u5c42\u7684\u76ee\u5f55\u3002\u7136\u540e\u5b83\u5c06\u5b83\u4eec\u4f20\u9012\u5230\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u5982runC\u6216Crun</p> <ul> <li>Docker\uff1a</li> <li>Podman\uff1a</li> <li>LXD\u2014\u2014LXC \uff08Linux Containers\uff09\u662f\u4e00\u4e2a\u5bb9\u5668\u7ba1\u7406\u5668\uff08\u5b88\u62a4\u8fdb\u7a0b\uff09\u3002\u8be5\u5de5\u5177\u63d0\u4f9b\u4e86\u8fd0\u884c\u7cfb\u7edf\u5bb9\u5668\u7684\u80fd\u529b\uff0c\u8fd9\u4e9b\u7cfb\u7edf\u5bb9\u5668\u63d0\u4f9b\u4e86\u66f4\u7c7b\u4f3c\u4e8eVM\u7684\u5bb9\u5668\u73af\u5883\u3002\u5b83\u4f4d\u4e8e\u975e\u5e38\u72ed\u7a84\u7684\u7a7a\u95f4\uff0c\u6ca1\u4ec0\u4e48\u7528\u6237\uff0c\u6240\u4ee5\u9664\u975e\u4f60\u6709\u975e\u5e38\u5177\u4f53\u7684\u5b9e\u4f8b\uff0c\u5426\u5219\u6700\u597d\u8fd8\u662f\u4f7f\u7528Docker\u6216Podman\u3002</li> <li>CRI-O\u2014\u2014\u5f53\u4f60Google\u4ec0\u4e48\u662fCRI-O\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u5b83\u88ab\u63cf\u8ff0\u4e3a\u5bb9\u5668\u5f15\u64ce\u3002\u4e0d\u8fc7\uff0c\u5b9e\u9645\u4e0a\u5b83\u53ea\u662f\u5bb9\u5668\u8fd0\u884c\u65f6\u3002\u5176\u5b9e\u5b83\u65e2\u4e0d\u662f\u5f15\u64ce\uff0c\u4e5f\u4e0d\u9002\u5408\u201c\u6b63\u5e38\u201d\u4f7f\u7528\u3002\u6211\u7684\u610f\u601d\u662f\uff0c\u5b83\u662f\u4e13\u95e8\u4e3aKubernetes\u8fd0\u884c\u65f6\uff08CRI\uff09\u800c\u6784\u5efa\u7684\uff0c\u800c\u4e0d\u662f\u4e3a\u6700\u7ec8\u7528\u6237\u4f7f\u7528\u7684\u3002</li> <li>Rkt\u2014\u2014rkt\uff08\u201c\u706b\u7bad\u201d\uff09\u662f\u7531CoreOS\u5f00\u53d1\u7684\u5bb9\u5668\u5f15\u64ce\u3002\u8fd9\u91cc\u63d0\u5230\u8fd9\u4e2a\u9879\u76ee\u53ea\u662f\u4e3a\u4e86\u5b8c\u6574\u6027\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u9879\u76ee\u5df2\u7ecf\u7ed3\u675f\uff0c\u5f00\u53d1\u4e5f\u505c\u6b62\u4e86\u2014\u2014\u6240\u4ee5\u4e5f\u5c31\u6ca1\u5fc5\u8981\u518d\u4f7f\u7528\u4e86\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#42","title":"4.2 \u955c\u50cf\u6784\u5efa","text":"<ul> <li>Docker</li> <li>Buildah\u7ea2\u5e3d\u5f00\u53d1\uff0c\u76ee\u524d\u5df2\u7ecf\u96c6\u6210\u5728podman\u4e2d\uff0c\u65e0\u5b88\u62a4\u7a0b\u5e8f\u548c\u65e0\u6839\u7684\uff0c\u5e76\u9075\u5faaOCI\u7684\u955c\u50cf\u6807\u51c6\uff0c\u6240\u4ee5\u5b83\u80fd\u4fdd\u8bc1\u6240\u6784\u5efa\u7684\u955c\u50cf\u548cDocker\u6784\u5efa\u7684\u662f\u4e00\u6837\u7684</li> <li>Kaniko\u8c37\u6b4c\u5f00\u53d1\uff0cKaniko\u4e5f\u662f\u4eceDockerfile\u6784\u5efa\u5bb9\u5668\u955c\u50cf\uff0c\u8ddfBuildah\u7c7b\u4f3c\uff0c\u4e5f\u4e0d\u9700\u8981\u5b88\u62a4\u8fdb\u7a0b\u3002\u4e0eBuildah\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff0cKaniko\u66f4\u4e13\u6ce8\u4e8e\u5728Kubernetes\u4e2d\u6784\u5efa\u955c\u50cf\u3002Kaniko\u4f7f\u7528gcr.io/ Kaniko -project/executor\u4f5c\u4e3a\u955c\u50cf\u8fd0\u884c\u3002\u8fd9\u5bf9\u4e8eKubernetes\u6765\u8bf4\u662f\u884c\u5f97\u901a\u7684\uff0c\u4f46\u662f\u5bf9\u4e8e\u672c\u5730\u6784\u5efa\u6765\u8bf4\u4e0d\u662f\u5f88\u65b9\u4fbf\uff0c\u5e76\u4e14\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u8fdd\u80cc\u4e86\u5b83\u7684\u521d\u8877\uff0c\u56e0\u4e3a\u6211\u4eec\u5f97\u5148\u4f7f\u7528Docker\u6765\u8fd0\u884cKaniko\u955c\u50cf\uff0c\u7136\u540e\u518d\u53bb\u6784\u5efa\u955c\u50cf\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6b63\u5728\u4e3aKubernetes\u96c6\u7fa4\u4e2d\u6784\u5efa\u955c\u50cf\u7684\u5de5\u5177\u8fdb\u884c\u9009\u578b\uff08\u4f8b\u5982\u5728CI/CD Pipeline\u4e2d\uff09\uff0c\u90a3\u4e48Kaniko\u53ef\u80fd\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\uff0c\u56e0\u4e3a\u5b83\u662f\u65e0\u5b88\u62a4\u7a0b\u5e8f\u7684\uff0c\u800c\u4e14\uff08\u53ef\u80fd\uff09\u66f4\u5b89\u5168\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#43","title":"4.3 \u5bb9\u5668\u8fd0\u884c\u65f6","text":"<ul> <li> <p>runC\uff1a\u662f\u57fa\u4e8eOCI\u5bb9\u5668\u8fd0\u884c\u65f6\u89c4\u8303\u521b\u5efa\u7684\uff0c\u4e14\u6700\u6d41\u884c\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u3002Docker\uff08\u901a\u8fc7containerd\uff09\u3001Podman\u548ccrio\u4f7f\u7528\u5b83\uff0c\u6240\u4ee5\u51e0\u4e4e\u6240\u6709\u4e1c\u897f\u90fd\u4f9d\u8d56\u4e8eLXD\u3002\u5b83\u51e0\u4e4e\u662f\u6240\u6709\u4ea7\u54c1/\u5de5\u5177\u7684\u9ed8\u8ba4\u9996\u9009\u9879\uff0c\u6240\u4ee5\u5373\u4f7f\u4f60\u5728\u9605\u8bfb\u672c\u6587\u540e\u653e\u5f03Docker\uff0c\u4f46\u4f60\u4ecd\u7136\u4f1a\u7528\u5230runC\u3002</p> </li> <li> <p>CRI-O\uff1a\u56e0\u4e3a\u5b83\u88ab\u6784\u5efa\u4e3a\u7528\u4e8eKubernetes\u8282\u70b9\u4e0a\u7684\u8fd0\u884c\u65f6\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u88ab\u63cf\u8ff0\u4e3a\u201cKubernetes\u9700\u8981\u7684\u6240\u6709\u8fd0\u884c\u65f6\uff0c\u4ec5\u6b64\u800c\u5df2\u201d\u3002\u56e0\u6b64\uff0c\u9664\u975e\u4f60\u6b63\u5728\u8bbe\u7f6eKubernetes\u96c6\u7fa4\uff08\u6216OpenShift\u96c6\u7fa4\u2014\u2014CRI-O\u5df2\u7ecf\u662f\u9ed8\u8ba4\u9996\u9009\u9879\u4e86\uff09\uff0c\u5426\u5219\u4e0d\u5927\u53ef\u80fd\u4f1a\u63a5\u89e6\u5230\u8fd9\u4e2a\u3002</p> </li> <li>containerd\uff1a\u5b83\u662f\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\uff0c\u5145\u5f53\u5404\u79cd\u5bb9\u5668\u8fd0\u884c\u65f6\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684API\u3002\u5728\u540e\u53f0\uff0c\u5b83\u4f9d\u8d56\u4e8erunC\uff0c\u662fDocker\u5f15\u64ce\u7684\u9ed8\u8ba4\u8fd0\u884c\u65f6\u3002\u8c37\u6b4cKubernetes\u5f15\u64ce\uff08GKE\uff09\u548cIBM Kubernetes\u670d\u52a1\uff08IKS\uff09\u4e5f\u5728\u4f7f\u7528\u3002\u5b83\u662fKubernetes\u5bb9\u5668\u8fd0\u884c\u65f6\u63a5\u53e3\u7684\u4e00\u4e2a\u90e8\u7f72\uff08\u4e0eCRI-O\u76f8\u540c\uff09\uff0c\u56e0\u6b64\u5b83\u662fKubernetes\u96c6\u7fa4\u8fd0\u884c\u65f6\u7684\u4e00\u4e2a\u5f88\u597d\u7684\u5907\u9009\u9879\u3002</li> <li>Kata:kata containers\u662f\u7531OpenStack\u57fa\u91d1\u4f1a\u7ba1\u7406\uff0c\u4f46\u72ec\u7acb\u4e8eOpenStack\u9879\u76ee\u4e4b\u5916\u7684\u5bb9\u5668\u9879\u76ee\u3002kata containers\u6574\u5408\u4e86Intel\u7684 Clear Containers \u548c Hyper.sh \u7684 runV\uff0c\u80fd\u591f\u652f\u6301\u4e0d\u540c\u5e73\u53f0\u7684\u786c\u4ef6 \uff08x86-64\uff0carm\u7b49\uff09\uff0c\u5e76\u7b26\u5408OCI(Open Container Initiative)\u89c4\u8303\uff0c\u540c\u65f6\u8fd8\u53ef\u4ee5\u517c\u5bb9k8s\u7684 CRI\uff08Container Runtime Interface\uff09\u63a5\u53e3\u89c4\u8303\u3002\u9879\u76ee\u5305\u542b\u51e0\u4e2a\u914d\u5957\u7ec4\u4ef6\uff0c\u5373Runtime\uff0cAgent\uff0c Proxy\uff0cShim\u7b49\u3002\u9879\u76ee\u5df2\u4e8e6\u6708\u4efdrelease\u4e861.0\u7248\u672c\u3002Kata\u6700\u5927\u7684\u4eae\u70b9\u662f\u89e3\u51b3\u4e86\u4f20\u7edf\u5bb9\u5668\u5171\u4eab\u5185\u6838\u7684\u5b89\u5168\u548c\u9694\u79bb\u95ee\u9898</li> </ul> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://podman.io/</li> <li>https://blog.csdn.net/alex_yangchuansheng/article/details/102618128</li> <li>https://github.com/containers/podman/blob/main/docs/tutorials/mac_win_client.md</li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/","title":"\u5229\u7528katacoda\u5b9e\u73b0\u62c9\u53d6\u56fd\u5916\u955c\u50cf","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5b89\u88c5 kubernetes \u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u7528\u5230 <code>gcr.io/google_containers</code> \u4e0b\u9762\u7684\u4e00\u4e9b\u955c\u50cf\uff0c\u5728\u56fd\u5185\u662f\u4e0d\u80fd\u76f4\u63a5\u4e0b\u8f7d\u7684\u3002\u5982\u679c\u7528 Self Host \u65b9\u5f0f\u5b89\u88c5\uff0cMaster \u4e0a\u7684\u7ec4\u4ef6\u9664\u5f00 Kubelet \u4e4b\u5916\u90fd\u7528\u5bb9\u5668\u8fd0\u884c\uff0c\u751a\u81f3 CNI \u63d2\u4ef6\u4e5f\u662f\u5bb9\u5668\u8fd0\u884c\u3002\u6bd4\u5982 Flannel\uff0c\u5728 <code>quay.io/coreos</code> \u4e0b\u9762\uff0c\u5728\u56fd\u5185\u4e0b\u8f7d\u975e\u5e38\u6162\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b\u955c\u50cf\u540c\u6b65\u5230\u6211\u4eec\u7684 Docker Hub \u4ed3\u5e93\u91cc\uff0c\u518d\u914d\u4e2a Docker Hub \u52a0\u901f\u5668\uff0c\u8fd9\u6837\u4e0b\u8f7d\u955c\u50cf\u5c31\u5f88\u5feb\u4e86\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/#_2","title":"\u4e8c \u539f\u7406","text":"<p>Katacoda \u662f\u4e00\u4e2a\u5728\u7ebf\u5b66\u4e60\u5e73\u53f0\uff0c\u5728 Web \u4e0a\u63d0\u4f9b\u5b66\u4e60\u9700\u8981\u7684\u670d\u52a1\u5668\u7ec8\u7aef\uff0c\u91cc\u9762\u5305\u542b\u5b66\u4e60\u6240\u9700\u7684\u73af\u5883\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528 <code>Docker</code> \u8bfe\u7a0b\u7684\u7ec8\u7aef\u6765\u540c\u6b65\uff0c\u56e0\u4e3a\u91cc\u9762\u6709 <code>Docker</code> \u73af\u5883\uff0c\u53ef\u4ee5\u6267\u884c docker login\u3001docker pull\u3001docker tag\u3001docker push \u7b49\u547d\u4ee4\u6765\u5b9e\u73b0\u540c\u6b65\u955c\u50cf\u3002</p> <p>\u4f46\u662f\u624b\u5de5\u53bb\u6267\u884c\u547d\u4ee4\u5f88\u9ebb\u70e6\uff0c\u5982\u679c\u8981\u540c\u6b65\u7684\u955c\u50cf\u548c Tag \u6bd4\u8f83\u591a\uff0c\u624b\u5de5\u64cd\u4f5c\u90a3\u5c31\u662f\u6d6a\u8d39\u751f\u547d\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u7a0b\u5e8f\u4ee3\u66ff\u624b\u5de5\u64cd\u4f5c\uff0c\u4e0d\u8fc7 Katacoda \u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u4e0d\u5141\u8bb8\u6267\u884c\u5916\u6765\u7684\u4e8c\u8fdb\u5236\u7a0b\u5e8f\uff0c\u4f46\u662f\u53ef\u4ee5 Shell \u811a\u672c\uff0c\u6211\u5199\u597d\u4e86\u811a\u672c\uff0c\u5927\u5bb6\u53ea\u9700\u8981\u7c98\u8d34\u8fdb\u53bb\u6839\u636e\u81ea\u5df1\u9700\u8981\u7a0d\u7a0d\u4fee\u6539\u4e0b\uff0c\u7136\u540e\u8fd0\u884c\u5c31\u53ef\u4ee5\u4e86\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/#_3","title":"\u4e09 \u64cd\u4f5c\u6b65\u9aa4","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/#31-katacoda","title":"3.1 \u767b\u9646katacoda","text":"<p>\u70b9\u51fb \u8fd9\u91cc \u8fdb\u5165 Docker \u8bfe\u7a0b\u3002</p> <p></p> <p>\u70b9\u51fb <code>START SCENARIO</code> \u6216 \u7ec8\u7aef\u53f3\u4e0a\u89d2\u5168\u5c4f\u6309\u94ae\u5c06\u7ec8\u7aef\u653e\u5927\u3002</p> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/#32-dockerhub","title":"3.2 \u767b\u9646dockerhub","text":"<p>\u5229\u7528\u4e0b\u8f7d</p> <pre><code>k8s.gcr.io/metrics-server/metrics-server\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/#33","title":"3.3 \u4e0b\u8f7d\u955c\u50cf","text":"<pre><code>docker pull k8s.gcr.io/metrics-server/metrics-server:v0.5.0\ndocker tag k8s.gcr.io/metrics-server/metrics-server:v0.5.0 1832990/metrics-server:v0.5.0\ndocker push 1832990/metrics-server:v0.5.0\n</code></pre> <p>\u4e4b\u540e\u5728\u56fd\u5185\u5c31\u53ef\u4ee5\u4f7f\u7528\u6211\u4eec\u81ea\u5df1\u7684\u955c\u50cf\u4e86</p> <pre><code>1832990/metrics-server:v0.5.0\n</code></pre> <p></p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/#_4","title":"\u56db \u53cd\u601d","text":"<p>\u53ef\u4ee5\u81ea\u5b9a\u4e49\u811a\u672c\u6765\u66f4\u5feb\u5b9e\u73b0</p> <pre><code>#!/bin/bash\nsourceRegistry=\"\"\nmyRegistry=\"\"\n\nimage=\"\"\n\n# docker login\n\n# docker pull \n\n# docker tag\n\n# docker push\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://katacoda.com/</li> <li>https://blog.csdn.net/easylife206/article/details/98818707</li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/","title":"\u955c\u50cf\u5206\u5c42\u5206\u6790\u5de5\u5177\u4e4bdive","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/#dive","title":"\u955c\u50cf\u5206\u5c42\u5206\u6790\u5de5\u5177\u4e4bdive","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/#_1","title":"\u524d\u8a00","text":"<p>\u6211\u4eec\u77e5\u9053Docker\u7684\u955c\u50cf\u662f\u7531\u4e00\u5c42\u4e00\u5c42\u8054\u5408\u6587\u4ef6\u7cfb\u7edf\u6784\u6210\uff0c\u5728Dockerfile\u4e2d\uff0c\u6bcf\u5199\u4e00\u5c42\u5c31\u5bf9\u5e94\u955c\u50cf\u4e2d\u7684\u4e00\u5c42\uff0c\u90a3\u4e48\u6211\u4eec\u5982\u679c\u5bf9\u5df2\u7ecf\u5236\u4f5c\u597d\u7684\u955c\u50cf\u8fdb\u884c\u5206\u5c42\u7684\u67e5\u770b\u548c\u5ba1\u6838\uff0c\u4ee5\u53ca\u540e\u671f\u7684\u4f18\u5316\u5462\uff0cdive\u5c31\u662f\u4e00\u6b3e\u955c\u50cf\u5206\u5c42\u5206\u6790\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u53bb\u5b9e\u73b0\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/#dive_1","title":"\u4e00 dive\u7b80\u4ecb","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/#11","title":"1.1 \u7b80\u4ecb","text":"<p>\u7528\u4e8e\u63a2\u7d22 Docker \u6620\u50cf\u3001\u56fe\u5c42\u5185\u5bb9\u548c\u53d1\u73b0\u7f29\u5c0f Docker/OCI \u6620\u50cf\u5927\u5c0f\u7684\u65b9\u6cd5\u7684\u5de5\u5177\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/#12","title":"1.2 \u7279\u6027","text":"<ul> <li>\u663e\u793a\u6309\u5c42\u5206\u89e3\u7684 Docker \u56fe\u50cf\u5185\u5bb9</li> </ul> <p>\u5f53\u60a8\u9009\u62e9\u5de6\u4fa7\u7684\u56fe\u5c42\u65f6\uff0c\u60a8\u4f1a\u770b\u5230\u8be5\u56fe\u5c42\u7684\u5185\u5bb9\u4ee5\u53ca\u53f3\u4fa7\u7684\u6240\u6709\u5148\u524d\u56fe\u5c42\u3002\u6b64\u5916\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u7bad\u5934\u952e\u5168\u9762\u63a2\u7d22\u6587\u4ef6\u6811\u3002</p> <ul> <li>\u6307\u51fa\u6bcf\u4e00\u5c42\u7684\u53d8\u5316</li> </ul> <p>\u5df2\u66f4\u6539\u3001\u4fee\u6539\u3001\u6dfb\u52a0\u6216\u5220\u9664\u7684\u6587\u4ef6\u5728\u6587\u4ef6\u6811\u4e2d\u663e\u793a\u3002\u8fd9\u53ef\u4ee5\u8c03\u6574\u4ee5\u663e\u793a\u7279\u5b9a\u5c42\u7684\u66f4\u6539\uff0c\u6216\u805a\u5408\u5230\u8be5\u5c42\u7684\u66f4\u6539\u3002</p> <ul> <li>\u4f30\u8ba1\u201c\u56fe\u50cf\u6548\u7387\u201d</li> </ul> <p>\u5de6\u4e0b\u65b9\u7684\u9762\u677f\u663e\u793a\u4e86\u57fa\u672c\u7684\u56fe\u5c42\u4fe1\u606f\u548c\u4e00\u4e2a\u5b9e\u9a8c\u6027\u7684\u6307\u6807\uff0c\u6765\u731c\u6d4b\u4f60\u7684\u56fe\u7247\u5305\u542b\u4e86\u591a\u5c11\u6d6a\u8d39\u7684\u7a7a\u95f4\u3002\u8fd9\u53ef\u80fd\u662f\u7531\u4e8e\u8de8\u5c42\u590d\u5236\u6587\u4ef6\uff0c\u8de8\u5c42\u79fb\u52a8\u6587\u4ef6\uff0c\u6216\u8005\u6ca1\u6709\u5b8c\u5168\u5220\u9664\u6587\u4ef6\u3002\u63d0\u4f9b\u4e86\u767e\u5206\u6bd4\u201c\u5f97\u5206\u201d\u548c\u603b\u6d6a\u8d39\u7684\u6587\u4ef6\u7a7a\u95f4</p> <ul> <li>\u5feb\u901f\u6784\u5efa/\u5206\u6790\u5468\u671f</li> </ul> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u547d\u4ee4\u6784\u5efa Docker \u6620\u50cf\u5e76\u7acb\u5373\u8fdb\u884c\u5206\u6790\uff1adive build -t some-tag\u3002 \u60a8\u53ea\u9700\u8981\u7528\u76f8\u540c\u7684\u6f5c\u6c34\u6784\u5efa\u547d\u4ee4\u66ff\u6362\u60a8\u7684 docker build \u547d\u4ee4\u3002</p> <ul> <li>CI \u96c6\u6210</li> </ul> <p>\u6839\u636e\u56fe\u50cf\u6548\u7387\u548c\u6d6a\u8d39\u7684\u7a7a\u95f4\u5206\u6790\u56fe\u50cf\u5e76\u83b7\u5f97\u901a\u8fc7/\u5931\u8d25\u7ed3\u679c\u3002\u8c03\u7528\u4efb\u4f55\u6709\u6548\u7684\u6f5c\u6c34\u547d\u4ee4\u65f6\uff0c\u53ea\u9700\u5728\u73af\u5883\u4e2d\u8bbe\u7f6e CI=true\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/#_2","title":"\u4e8c \u5b89\u88c5","text":"<ul> <li>RHEL/CentOS</li> </ul> <pre><code>curl -OL https://github.com/wagoodman/dive/releases/download/v0.9.2/dive_0.9.2_linux_amd64.rpm\nrpm -i dive_0.9.2_linux_amd64.rpm\n</code></pre> <ul> <li>Mac</li> </ul> <pre><code>brew install dive\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/#_3","title":"\u4e09 \u4f7f\u7528","text":"<ul> <li>KeyBindings</li> </ul> Key Binding Description Ctrl + C \u9000\u51fa Tab or Ctrl + Space \u5728\u56fe\u5c42\u548c\u6587\u4ef6\u6811\u89c6\u56fe\u4e4b\u95f4\u5207\u6362 Ctrl + F \u8fc7\u6ee4\u6587\u4ef6 Ctrl + A \u56fe\u5c42\u89c6\u56fe\uff1a\u67e5\u770b\u805a\u5408\u56fe\u50cf\u4fee\u6539 Ctrl + L \u56fe\u5c42\u89c6\u56fe\uff1a\u67e5\u770b\u5f53\u524d\u56fe\u5c42\u4fee\u6539 Space Filetree\u89c6\u56fe\uff1a\u6298\u53e0/\u53d6\u6d88\u6298\u53e0\u76ee\u5f55 Ctrl + A Filetree\u89c6\u56fe\uff1a \u663e\u793a/\u9690\u85cf\u6dfb\u52a0\u7684\u6587\u4ef6 Ctrl + R Filetree\u89c6\u56fe\uff1a\u663e\u793a/\u9690\u85cf\u5df2\u5220\u9664\u7684\u6587\u4ef6 Ctrl + M Filetree\u89c6\u56fe\uff1a\u663e\u793a/\u9690\u85cf\u5df2\u4fee\u6539\u7684\u6587\u4ef6 Ctrl + U Filetree\u89c6\u56fe\uff1a\u663e\u793a/\u9690\u85cf\u672a\u4fee\u6539\u7684\u6587\u4ef6 PageUp Filetree\u89c6\u56fe\uff1a\u5411\u4e0a\u6eda\u52a8\u9875\u9762 PageDown Filetree\u89c6\u56fe\uff1a\u5411\u4e0b\u6eda\u52a8\u9875\u9762 <ul> <li>\u5206\u6790mysql\u955c\u50cf</li> </ul> <pre><code>dive mysql:8.0.19\n</code></pre> <ul> <li>\u6267\u884cCI\u626b\u63cf</li> </ul> <pre><code>dive mysql:8.0.19 --ci\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/#_4","title":"\u5176\u4ed6","text":"<p>\u5728\u6211\u4eecCI\u4e2d\u53ef\u4ee5\u96c6\u6210dive\uff0c\u5bf9\u6bcf\u6b21\u6784\u5efa\u7684\u955c\u50cf\u8fdb\u884c\u68c0\u6d4b\uff0c\u53ca\u65f6\u53d1\u73b0\u955c\u50cf\u4e2d\u7684\u5f02\u5e38\u548c\u4f18\u5316\u70b9\uff0c\u9488\u5bf9\u6027\u7684\u4f18\u5316\u955c\u50cf\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E4%B9%8Bdive/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/wagoodman/dive</li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/","title":"\u955c\u50cf\u5e95\u5c42\u539f\u7406","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_2","title":"\u4e00 \u80cc\u666f","text":"<p>\u955c\u50cf\u4ed3\u5e93\u529f\u80fd</p> <ul> <li>\u955c\u50cf\u5206\u53d1\uff1a\u5e76\u5bf9\u5916\u63d0\u4f9b\u4e00\u5957,HTTP API V2</li> <li>\u955c\u50cf\u5b58\u50a8\uff1a\u955c\u50cf\u4ed3\u5e93\u4e2d\u7684\u6240\u6709\u955c\u50cf\uff0c\u90fd\u662f\u4ee5\u6570\u636e\u5757 (Blob) \u7684\u65b9\u5f0f\u5b58\u50a8\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002\u6587\u4ef6\u7cfb\u7edf</li> </ul> <p></p> <p>\u4ee5\u4e0b\u5185\u5bb9\u5747\u9488\u5bf9\u955c\u50cf\u4ed3\u5e93\u5b58\u50a8\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u8fdb\u884c\u5c55\u5f00\u3002</p> <p>\u540c\u4e00\u955c\u50cf\uff0c\u5728\u4e0d\u540c\u7684\u955c\u50cf\u4ed3\u5e93\u4e2d\uff0c\u5b58\u50a8\u65b9\u5f0f\u548c\u5185\u5bb9\u5b8c\u5168\u4e00\u6837\u3002</p>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_3","title":"\u4e8c \u6d4b\u8bd5","text":""},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#21","title":"2.1 \u6d4b\u8bd5\u73af\u5883","text":"<ul> <li>harbor</li> </ul> <pre><code>registry\uff1aredhatxl.com \u5bf9\u5e94\u5730\u5740\uff1a1x.xx.xx\nnamespace\uff1aharbor-reg\nrepository\uff1amycentos\n\n\ndocker push redhatxl.com/harbor-reg/REPOSITORY[:TAG]\n</code></pre> <ul> <li>\u817e\u8baf\u4e91</li> </ul> <pre><code>appid:  12xxxxxxxxxx30',\nsecret_id:   AKxxxxxxxxxxxxx\nsecret_key:   kFUTDxxxxxxxxxxxxxxxxxE0Xq\n\u4ed3\u5e93\u540d\u79f0\uff1aanchnet-devops-common-test\n\u955c\u50cf\u5730\u5740\uff1accr.ccs.tencentyun.com/anchnet-devops-common-test/base-node\n\u7528\u6237\u540d\uff1axxxxxxxxx5\n\u5bc6\u7801\uff1a5xxxxxxxxxx\ndocker login --username=xxxxxxxxxx1875 -p 51idc.qcloudhub ccr.ccs.tencentyun.com\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#21-manifests","title":"2.1 \u83b7\u53d6\u955c\u50cfmanifests","text":"<pre><code>[root@img-tools imgtools]# curl -X GET redhatxl.com/v2/harbor-reg/base-python36/manifests/latest -uadmin:redhatxl\n{\n   \"schemaVersion\": 2,\n   \"mediaType\": \"application/vnd.docker.distribution.manifest.v2+json\",\n   \"config\": {\n      \"mediaType\": \"application/vnd.docker.container.image.v1+json\",\n      \"size\": 7709,\n      \"digest\": \"sha256:ed6ab02f968c4b4b6c3b98f4461e6c2cbf7c639cc611295190784674ee7dcd3e\"\n   },\n   \"layers\": [\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 75863188,\n         \"digest\": \"sha256:75f829a71a1c5277a7abf55495ac8d16759691d980bf1d931795e5eb68a294c0\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 93,\n         \"digest\": \"sha256:a16d96b1c51534d0fdb3ca64e89b49d272b274cc4370a23fd6e93f653d2ae992\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 144,\n         \"digest\": \"sha256:2f746b711ecd754fb510a5ebef61e604869e461b8813a24dd2104f5644e700a6\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 500,\n         \"digest\": \"sha256:83bd569a87758935e0112c2c590de3c308f811b74139c03a32255aaf22ae3975\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 490259,\n         \"digest\": \"sha256:a6286d6173c0992e8b5ef0ca3d384195f63e6b4649e9566a41c31809c352d25a\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 314,\n         \"digest\": \"sha256:9cd506705b843a77101c1fd074d1217f42b70eda499dc2ca64c23aaf44552c6d\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 17909802,\n         \"digest\": \"sha256:f4ca1980898549f7c6e3d8ce4005b25d4e52221a577b15b50836361f099f2872\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 30362969,\n         \"digest\": \"sha256:ac70bee47a24a8af762ed5b2f9075b491a974b8c38151198a076911d60bff3c5\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 127,\n         \"digest\": \"sha256:400b472f0ac1b04330cbd352e17293dbfef46cc94803c862a966989bfc85cfd8\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 1117,\n         \"digest\": \"sha256:12f4adb3b6429a963b92d117cfb26606d17b9b49d1c4686b0382b32a810d8450\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 55047070,\n         \"digest\": \"sha256:0a5360ec0e5db590ed9781c2d34ca61edb0df961a0e004f586d63594d35d583c\"\n      },\n      {\n         \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\",\n         \"size\": 75009416,\n         \"digest\": \"sha256:7652672f85b542bbf717656a78cc905965f53b84acdc2586826c1452d704bf85\"\n      }\n   ]\n}\n</code></pre> <ul> <li>\u83b7\u53d6config</li> </ul> <pre><code>{\"architecture\":\"amd64\",\"config\":{\"Hostname\":\"5f91842eb6f8\",\"Domainname\":\"\",\"User\":\"\",\"AttachStdin\":false,\"AttachStdout\":false,\"AttachStderr\":false,\"Tty\":false,\"OpenStdin\":false,\"StdinOnce\":false,\"Env\":[\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\"SS_AGENT_VERSION=3.22.0\",\"START_SIGSCI=0\",\"PYTHON_PIP_VERSION=19.0.3\",\"NR_MOD_VERSION=4.14.0.115\",\"SS_MOD_VERSION=1.2.0\",\"BASE_ROOT=/data\",\"LC_ALL=zh_CN.utf8\",\"LANG=zh_CN.utf8\",\"LANGUAGE=zh_CN.utf8\"],\"Cmd\":[\"/bin/bash\"],\"ArgsEscaped\":true,\"Image\":\"sha256:aa7aab57b6c571a732ef54e23b6e983859cc87866c2e84f739e50c84e6a3e0c5\",\"Volumes\":null,\"WorkingDir\":\"/data\",\"Entrypoint\":null,\"OnBuild\":[],\"Labels\":{\"maintainer\":\"kaliarch\",\"org.label-schema.build-date\":\"20200809\",\"org.label-schema.license\":\"GPLv2\",\"org.label-schema.name\":\"CentOS Base Image\",\"org.label-schema.schema-version\":\"1.0\",\"org.label-schema.vendor\":\"CentOS\",\"org.opencontainers.image.created\":\"2020-08-09 00:00:00+01:00\",\"org.opencontainers.image.licenses\":\"GPL-2.0-only\",\"org.opencontainers.image.title\":\"CentOS Base Image\",\"org.opencontainers.image.vendor\":\"CentOS\"}},\"container\":\"4fc5294025a02c0083301fbb44f72ae6eeb89d1a4bb35173728a59d8fbb1860b\",\"container_config\":{\"Hostname\":\"5f91842eb6f8\",\"Domainname\":\"\",\"User\":\"\",\"AttachStdin\":false,\"AttachStdout\":false,\"AttachStderr\":false,\"Tty\":false,\"OpenStdin\":false,\"StdinOnce\":false,\"Env\":[\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\"SS_AGENT_VERSION=3.22.0\",\"START_SIGSCI=0\",\"PYTHON_PIP_VERSION=19.0.3\",\"NR_MOD_VERSION=4.14.0.115\",\"SS_MOD_VERSION=1.2.0\",\"BASE_ROOT=/data\",\"LC_ALL=zh_CN.utf8\",\"LANG=zh_CN.utf8\",\"LANGUAGE=zh_CN.utf8\"],\"Cmd\":[\"/bin/sh\",\"-c\",\"pip3 config set global.index-url http://mirrors.aliyun.com/pypi/simple \\u0026\\u0026 pip3 config set install.trusted-host mirrors.aliyun.com;     pip3 install --upgrade pip \\u0026\\u0026 pip install --default-timeout=1000 -r ${BASE_ROOT}/requirements.txt --use-feature=2020-resolver\"],\"ArgsEscaped\":true,\"Image\":\"sha256:aa7aab57b6c571a732ef54e23b6e983859cc87866c2e84f739e50c84e6a3e0c5\",\"Volumes\":null,\"WorkingDir\":\"/data\",\"Entrypoint\":null,\"OnBuild\":[],\"Labels\":{\"maintainer\":\"kaliarch\",\"org.label-schema.build-date\":\"20200809\",\"org.label-schema.license\":\"GPLv2\",\"org.label-schema.name\":\"CentOS Base Image\",\"org.label-schema.schema-version\":\"1.0\",\"org.label-schema.vendor\":\"CentOS\",\"org.opencontainers.image.created\":\"2020-08-09 00:00:00+01:00\",\"org.opencontainers.image.licenses\":\"GPL-2.0-only\",\"org.opencontainers.image.title\":\"CentOS Base Image\",\"org.opencontainers.image.vendor\":\"CentOS\"}},\"created\":\"2020-11-19T10:08:14.838692824Z\",\"docker_version\":\"18.09.7\",\"history\":[{\"created\":\"2020-08-10T18:20:08.948813347Z\",\"created_by\":\"/bin/sh -c #(nop) ADD file:61908381d3142ffba798ae9a904476d19b197ab79d0338f14bec0f76649df8d4 in / \"},{\"created\":\"2020-08-10T18:20:09.298928893Z\",\"created_by\":\"/bin/sh -c #(nop)  LABEL org.label-schema.schema-version=1.0 org.label-schema.name=CentOS Base Image org.label-schema.vendor=CentOS org.label-schema.license=GPLv2 org.label-schema.build-date=20200809 org.opencontainers.image.title=CentOS Base Image org.opencontainers.image.vendor=CentOS org.opencontainers.image.licenses=GPL-2.0-only org.opencontainers.image.created=2020-08-09 00:00:00+01:00\",\"empty_layer\":true},{\"created\":\"2020-08-10T18:20:09.474278304Z\",\"created_by\":\"/bin/sh -c #(nop)  CMD [\\\"/bin/bash\\\"]\",\"empty_layer\":true},{\"created\":\"2020-10-31T18:26:27.646630099Z\",\"created_by\":\"/bin/sh -c mkdir /meta\"},{\"created\":\"2020-10-31T18:26:30.135647485Z\",\"created_by\":\"/bin/sh -c #(nop) ADD file:a378e744ad31356a19bb64e022e5945f43e49fede32ed700e2ae068417029dca in /meta/ \"},{\"created\":\"2020-10-31T18:26:32.620481323Z\",\"created_by\":\"/bin/sh -c #(nop) ADD file:4bee920c5635620068033e111bc61656de4bfde96f261e315fb86df24c4bd694 in /meta/ \"},{\"created\":\"2020-10-31T18:32:15.062608026Z\",\"created_by\":\"/bin/sh -c yum -y update \\u0026\\u0026 yum clean all\"},{\"created\":\"2020-10-31T18:32:17.053227485Z\",\"created_by\":\"/bin/sh -c #(nop)  ENV SS_AGENT_VERSION=3.22.0 START_SIGSCI=0\",\"empty_layer\":true},{\"created\":\"2020-10-31T18:32:19.344841625Z\",\"created_by\":\"/bin/sh -c #(nop) COPY file:7cb853b776c22e8cbde94576e69ac385a4c660581ae915b1a8c3c7554b638048 in /etc/yum.repos.d/ \"},{\"created\":\"2020-10-31T18:32:46.979408426Z\",\"created_by\":\"/bin/sh -c yum -y install sigsci-agent-${SS_AGENT_VERSION} \\u0026\\u0026 yum clean all\"},{\"created\":\"2020-10-31T18:44:08.878827379Z\",\"created_by\":\"/bin/sh -c #(nop)  ENV PYTHON_PIP_VERSION=19.0.3 NR_MOD_VERSION=4.14.0.115 SS_MOD_VERSION=1.2.0\",\"empty_layer\":true},{\"created\":\"2020-10-31T18:47:16.250803275Z\",\"created_by\":\"/bin/sh -c yum -y install epel-release wget         \\u0026\\u0026 yum -y install python36 python36-pip         \\u0026\\u0026 yum clean all         \\u0026\\u0026 python3 -m pip install --no-cache-dir --upgrade --force-reinstall \\\"pip==$PYTHON_PIP_VERSION\\\"         \\u0026\\u0026 pip3 install --no-cache-dir virtualenv         newrelic==${NR_MOD_VERSION}         https://dl.signalsciences.net/sigsci-module-python/${SS_MOD_VERSION}/src/sigscimodule-${SS_MOD_VERSION}.tar.gz\"},{\"created\":\"2020-11-19T09:48:50.78298361Z\",\"created_by\":\"/bin/sh -c #(nop)  LABEL maintainer=kaliarch\",\"empty_layer\":true},{\"created\":\"2020-11-19T09:48:51.211125932Z\",\"created_by\":\"/bin/sh -c #(nop)  ENV BASE_ROOT=/data LC_ALL=zh_CN.utf8 LANG=zh_CN.utf8 LANGUAGE=zh_CN.utf8\",\"empty_layer\":true},{\"created\":\"2020-11-19T09:48:51.512365134Z\",\"created_by\":\"/bin/sh -c #(nop) WORKDIR /data\"},{\"created\":\"2020-11-19T09:55:02.051276372Z\",\"created_by\":\"/bin/sh -c #(nop) COPY file:ea79bd23fc6540bbf011dcec29c6db19273f19edc4563451814db971813fa791 in /data/ \"},{\"created\":\"2020-11-19T09:57:27.685569884Z\",\"created_by\":\"/bin/sh -c mkdir /etc/yum.repos.d.bak \\u0026\\u0026  mv /etc/yum.repos.d/* /etc/yum.repos.d.bak/ \\u0026\\u0026 curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo;     curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo;     yum makecache fast \\u0026\\u0026 yum install -y epel-release \\u0026\\u0026 yum install freetds-devel.x86_64 freetds.x86_64 tcping openssh-clients -y;     localedef -c -f UTF-8 -i zh_CN zh_CN.utf8;     rm -rf /usr/bin/python \\u0026\\u0026 ln -sv /usr/bin/python3 /usr/bin/python \\u0026\\u0026 ln -sv /usr/bin/python3 /usr/local/bin/python;     /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\u0026\\u0026 echo 'Asia/Shanghai' \\u003e/etc/timezone\"},{\"created\":\"2020-11-19T10:08:14.838692824Z\",\"created_by\":\"/bin/sh -c pip3 config set global.index-url http://mirrors.aliyun.com/pypi/simple \\u0026\\u0026 pip3 config set install.trusted-host mirrors.aliyun.com;     pip3 install --upgrade pip \\u0026\\u0026 pip install --default-timeout=1000 -r ${BASE_ROOT}/requirements.txt --use-feature=2020-resolver\"}],\"os\":\"linux\",\"rootfs\":{\"type\":\"layers\",\"diff_ids\":[\"sha256:613be09ab3c0860a5216936f412f09927947012f86bfa89b263dfa087a725f81\",\"sha256:2dffb8082ab5202c664c374ecfb695a4adbf2f58bed6cb9e547dade04aebac1d\",\"sha256:aca83ae8a3110c67d20fadb1fcebae7074ea89e02a73091c2f95474a280d7fd0\",\"sha256:910a7d877245e11661934bde0c042784b83f91a86821b8411f316ce34f5f0093\",\"sha256:2faae2dbe3820c570317a1ef78cad54950af13263333ed7d96f8a626117a8b31\",\"sha256:765961673d6620fdd2b81bcf01407a43203792a275db0acd9f78ddae73c60953\",\"sha256:3d439b32a94378eb09c8d599fd4a2238d51ea9e2e0d1ed0ea83a9d43e0327534\",\"sha256:bf516cdb2791571140e2a7cc86fd978bb32b03f63162a35c74c05be2ae8511d0\",\"sha256:8d8713e0c8fa85dff6382d267ded8faac409db4c7a805f6a5cc632f93f8f054b\",\"sha256:398370fc331c4caadf15ce84dd22fb060b5426cc2d62e7e4018bb584d5ce6d6f\",\"sha256:26012d3f82bbe4a64c9c8d16e4987c4875119fd2e9bcf56d9714c7d735c76170\",\"sha256:7452610eee95c1fdcd38836334518b04ffffea1fc959ab9f5c7c41cd27241c2d\"]}}\n</code></pre> <ul> <li>\u83b7\u53d6blob\u5c42</li> </ul> <pre><code>curl -X GET redhatxl.com/v2/harbor-reg/base-python36/blobs/sha256:7652672f85b542bbf717656a78cc905965f53b84acdc2586826c1452d704bf85 -uadmin:redhatxl\n</code></pre>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_4","title":"\u4e09 \u7ed3\u8bba","text":"<ul> <li>\u901a\u8fc7 Registry API \u83b7\u5f97\u7684\u4e24\u4e2a\u955c\u50cf\u4ed3\u5e93\u4e2d\u76f8\u540c\u955c\u50cf\u7684 manifest \u4fe1\u606f\u5b8c\u5168\u76f8\u540c\u3002</li> <li>\u4e24\u4e2a\u955c\u50cf\u4ed3\u5e93\u4e2d\u76f8\u540c\u955c\u50cf\u7684 manifest \u4fe1\u606f\u7684\u5b58\u50a8\u8def\u5f84\u548c\u5185\u5bb9\u5b8c\u5168\u76f8\u540c\u3002</li> <li>\u4e24\u4e2a\u955c\u50cf\u4ed3\u5e93\u4e2d\u76f8\u540c\u955c\u50cf\u7684 blob \u4fe1\u606f\u7684\u5b58\u50a8\u8def\u5f84\u548c\u5185\u5bb9\u5b8c\u5168\u76f8\u540c\u3002</li> </ul>"},{"location":"cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://supereagle.github.io/2018/04/24/docker-registry/</li> <li>https://docs.docker.com/registry/spec/api/</li> <li>https://blog.csdn.net/ztsinghua/article/details/51496658</li> </ul>"},{"location":"cloud-native/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E6%A0%88/","title":"\u5fae\u670d\u52a1\u6280\u672f\u6808","text":""},{"location":"cloud-native/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E6%A0%88/#_1","title":"\u5fae\u670d\u52a1\u6280\u672f\u6808","text":""},{"location":"db/elasticsearch/elasticsearch/","title":"Elasticsearch","text":""},{"location":"db/elasticsearch/elasticsearch/#elasticsearch","title":"ElasticSearch","text":""},{"location":"db/elasticsearch/elasticsearch/#_1","title":"\u4e00 \u57fa\u7840\u6982\u5ff5","text":"<p>Elaticsearch\uff0c\u7b80\u79f0\u4e3a ES\uff0c ES \u662f\u4e00\u4e2a**\u5f00\u6e90\u7684\u9ad8\u6269\u5c55\u7684\u5206\u5e03\u5f0f\u5168\u6587\u641c\u7d22\u5f15\u64ce**\uff0c \u662f\u6574\u4e2a ElasticStack \u6280\u672f\u6808\u7684\u6838\u5fc3\u3002</p>"},{"location":"db/elasticsearch/elasticsearch/#_2","title":"\u4e8c \u73af\u5883\u90e8\u7f72","text":""},{"location":"db/elasticsearch/elasticsearch/#21","title":"2.1 \u5355\u8282\u70b9","text":"<pre><code># \u62c9\u53d6\u955c\u50cf\ndocker pull elasticsearch:latest\n# \u542f\u52a8\ndocker run --name es01 -d -p 9200:9200 -p 9300:9300 -e \"discovery.type=single-node\" -e  \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" elasticsearch:latest\n\n# \u4f7f\u7528head\u5ba2\u6237\u7aef\u94fe\u63a5\ndocker pull mobz/elasticsearch-head:5\n# \u542f\u52a8header \u5bb9\u5668\ndocker run -d --name my-es_admin -p 9100:9100 mobz/elasticsearch-head:5\n\n# curl\u6d4b\u8bd5\u8bbf\u95ee\ncurl http://127.0.0.1:9200/\n</code></pre> <p>\u7b2c\u4e00\u6b21\u6253\u5f00\u6d4f\u89c8\u5668header\u8bbf\u95ee\uff0c\u8fde\u63a5\u7684\u670d\u52a1\u5730\u5740\u662flocalhost:9200\uff0c\u4fee\u6539\u4e3adocker\u6240\u5728\u7684ip\u3002\u6b64\u65f6\u51fa\u73b0\u8fde\u63a5\u5931\u8d25\uff0c\u9700\u8981\u4fee\u6539\u955c\u50cf\u7684elasticsearch.yml\u6587\u4ef6\uff0c\u6dfb\u52a0</p> <pre><code>http.cors.enabled: true\nhttp.cors.allow-origin: \"*\"\n\n# \u91cd\u542fes\ndocker restart es01\ndocker restart my-es-head\n</code></pre> <p></p> <p></p>"},{"location":"db/elasticsearch/elasticsearch/#22","title":"2.2 \u96c6\u7fa4","text":"<pre><code># \u62c9\u53d6\u955c\u50cf\ndocker pull elasticsearch:latest\n# \u542f\u52a8\ndocker run --name es01 -d -p 9200:9200 -p 9300:9300 --restart=always  -e  \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" elasticsearch:7.4.0\n\ndocker run --name es02 -d -p 9201:9201 -p 9301:9301 --restart=always  -e  \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" elasticsearch:7.4.0\n\n# \u4f7f\u7528head\u5ba2\u6237\u7aef\u94fe\u63a5\ndocker pull mobz/elasticsearch-head:5\n# \u542f\u52a8header \u5bb9\u5668\ndocker run -d --name my-es_admin -p 9100:9100 mobz/elasticsearch-head:5\n\n# curl\u6d4b\u8bd5\u8bbf\u95ee\ncurl http://127.0.0.1:9200/\n</code></pre>"},{"location":"db/elasticsearch/elasticsearch/#_3","title":"\u4e09 \u6d4b\u8bd5","text":""},{"location":"db/elasticsearch/elasticsearch/#31","title":"3.1 \u521b\u5efa","text":"<ul> <li>\u521b\u5efa\u4e00\u4e2a\u7d22\u5f15(PUT)</li> </ul> <pre><code>http://127.0.0.1:9200/shopping\n</code></pre> <p>\u67e5\u770b\u670d\u52a1\u65e5\u5fd7</p> <p></p>"},{"location":"db/elasticsearch/elasticsearch/#32","title":"3.2 \u67e5\u770b\u7d22\u5f15","text":"<ul> <li>\u67e5\u770b\u6240\u6709\u7d22\u5f15</li> </ul> <pre><code>http://127.0.0.1:9200/_cat/indices?v\n</code></pre> \u8868\u5934 \u542b\u4e49 health green\uff0cyellow\uff0cred status open/close index \u7d22\u5f15\u540d\u79f0 uuid \u7d22\u5f15\u7edf\u4e00\u7f16\u53f7 pri \u4e3b\u5206\u7247\u6570\u91cf rep \u526f\u672c\u6570\u91cf docs.count \u53ef\u7528\u6587\u6863\u6570\u91cf docs.deleted \u6587\u6863\u5220\u9664\u72b6\u6001(\u903b\u8f91\u5220\u9664) store.size \u4e3b\u5206\u7247\u548c\u526f\u672c\u5206\u7247\u6574\u4f53\u5360\u7528\u7a7a\u95f4\u5927\u5c0f pri.store.size \u4e3b\u8981\u5206\u7247\u5360\u7528\u5927\u5c0f <ul> <li>\u67e5\u770b\u5355\u4e2a\u7d22\u5f15</li> </ul> <pre><code>http://127.0.0.1:9200/shopping\n</code></pre>"},{"location":"db/elasticsearch/elasticsearch/#34","title":"3.4 \u6587\u6863\u64cd\u4f5c","text":"<p>\u5411 ES \u670d\u52a1\u5668\u53d1 POST \u8bf7\u6c42 \uff1a http://127.0.0.1:9200/shopping/_doc/1\uff0c\u8bf7\u6c42\u4f53JSON\u5185\u5bb9\u4e3a\uff1a</p> <pre><code>{\n    \"title\":\"\u5c0f\u7c73\u624b\u673a\",\n    \"category\":\"\u5c0f\u7c73\",\n    \"images\":\"http://www.gulixueyuan.com/xm.jpg\",\n    \"price\":3999.00\n}\n</code></pre> <ul> <li>\u67e5\u770b\u7d22\u5f15\u4e0b\u6240\u6709\u5185\u5bb9</li> </ul> <p>\u5411 ES \u670d\u52a1\u5668\u53d1 GET \u8bf7\u6c42 \uff1a http://127.0.0.1:9200/shopping/_search\u3002</p> <ul> <li>\u5c40\u90e8\u4fee\u6539</li> </ul> <p>\u5c40\u90e8\u4fee\u6539 \u4fee\u6539\u6570\u636e\u65f6\uff0c\u4e5f\u53ef\u4ee5\u53ea\u4fee\u6539\u67d0\u4e00\u7ed9\u6761\u6570\u636e\u7684\u5c40\u90e8\u4fe1\u606f</p> <p>\u5728 Postman \u4e2d\uff0c\u5411 ES \u670d\u52a1\u5668\u53d1 POST \u8bf7\u6c42 \uff1a http://127.0.0.1:9200/shopping/_update/1\u3002</p> <p>\u8bf7\u6c42\u4f53JSON\u5185\u5bb9\u4e3a:</p> <pre><code>{\n    \"doc\": {\n        \"title\":\"\u5c0f\u7c73\u624b\u673a\",\n        \"category\":\"\u5c0f\u7c73\"\n    }\n}\n</code></pre> <ul> <li>\u5220\u9664</li> </ul> <p>\u5728 Postman \u4e2d\uff0c\u5411 ES \u670d\u52a1\u5668\u53d1 DELETE \u8bf7\u6c42 \uff1a http://127.0.0.1:9200/shopping/_doc/1</p>"},{"location":"db/elasticsearch/elasticsearch/#35","title":"3.5 \u67e5\u8be2","text":"<ul> <li>URL\u5e26\u53c2\u67e5\u8be2</li> </ul> <p>http://127.0.0.1:9200/shopping/_search?q=category:\u5c0f\u7c73</p> <ul> <li>\u8bf7\u6c42\u4f53\u5e26\u53c2\u67e5\u8be2</li> </ul> <p>\u63a5\u4e0b\u5e26JSON\u8bf7\u6c42\u4f53\uff0c\u8fd8\u662f**\u67e5\u627ecategory\u4e3a\u5c0f\u7c73\u7684\u6587\u6863**\uff0c\u5728 Postman \u4e2d\uff0c\u5411 ES \u670d\u52a1\u5668\u53d1 GET\u8bf7\u6c42 \uff1a http://127.0.0.1:9200/shopping/_search</p> <pre><code>{\n    \"query\":{\n        \"match\":{\n            \"category\":\"\u5c0f\u7c73\"\n        }\n    }\n}\n</code></pre> <ul> <li>\u5236\u5b9a\u5b57\u6bb5\u67e5\u8be2</li> </ul> <p>\u5982\u679c\u4f60\u60f3\u67e5\u8be2\u6307\u5b9a\u5b57\u6bb5\uff0c\u5728 Postman \u4e2d\uff0c\u5411 ES \u670d\u52a1\u5668\u53d1 GET\u8bf7\u6c42 \uff1a http://127.0.0.1:9200/shopping/_search\uff0c\u9644\u5e26JSON\u4f53\u5982\u4e0b\uff1a</p> <pre><code>{\n    \"query\":{\n        \"match_all\":{}\n    },\n    \"_source\":[\"title\"]\n}\n</code></pre> <ul> <li>\u5206\u9875\u67e5\u8be2</li> </ul> <p>\u5728 Postman \u4e2d\uff0c\u5411 ES \u670d\u52a1\u5668\u53d1 GET\u8bf7\u6c42 \uff1a http://127.0.0.1:9200/shopping/_search\uff0c\u9644\u5e26JSON\u4f53\u5982\u4e0b\uff1a</p> <pre><code>{\n    \"query\":{\n        \"match_all\":{}\n    },\n    \"from\":0,\n    \"size\":2\n}\n</code></pre> <ul> <li>\u67e5\u8be2\u6392\u5e8f</li> </ul> <p>\u5982\u679c\u4f60\u60f3\u901a\u8fc7\u6392\u5e8f\u67e5\u51fa\u4ef7\u683c\u6700\u9ad8\u7684\u624b\u673a\uff0c\u5728 Postman \u4e2d\uff0c\u5411 ES \u670d\u52a1\u5668\u53d1 GET\u8bf7\u6c42 \uff1a http://127.0.0.1:9200/shopping/_search\uff0c\u9644\u5e26JSON\u4f53\u5982\u4e0b\uff1a</p> <pre><code>{\n    \"query\":{\n        \"match_all\":{}\n    },\n    \"sort\":{\n        \"price\":{\n            \"order\":\"desc\"\n        }\n    }\n}\n</code></pre>"},{"location":"db/elasticsearch/elasticsearch/#_4","title":"\u56db \u96c6\u7fa4\u4fe1\u606f","text":""},{"location":"db/elasticsearch/elasticsearch/#_5","title":"\u5355\u673a &amp; \u96c6\u7fa4","text":"<p>\u5355\u53f0 Elasticsearch \u670d\u52a1\u5668\u63d0\u4f9b\u670d\u52a1\uff0c\u5f80\u5f80\u90fd\u6709\u6700\u5927\u7684\u8d1f\u8f7d\u80fd\u529b\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u9608\u503c\uff0c\u670d\u52a1\u5668 \u6027\u80fd\u5c31\u4f1a\u5927\u5927\u964d\u4f4e\u751a\u81f3\u4e0d\u53ef\u7528\uff0c\u6240\u4ee5\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4e00\u822c\u90fd\u662f\u8fd0\u884c\u5728\u6307\u5b9a\u670d\u52a1\u5668\u96c6\u7fa4\u4e2d\u3002 \u9664\u4e86\u8d1f\u8f7d\u80fd\u529b\uff0c\u5355\u70b9\u670d\u52a1\u5668\u4e5f\u5b58\u5728\u5176\u4ed6\u95ee\u9898\uff1a</p> <p>\u5355\u53f0\u673a\u5668\u5b58\u50a8\u5bb9\u91cf\u6709\u9650 \u5355\u670d\u52a1\u5668\u5bb9\u6613\u51fa\u73b0\u5355\u70b9\u6545\u969c\uff0c\u65e0\u6cd5\u5b9e\u73b0\u9ad8\u53ef\u7528 \u5355\u670d\u52a1\u7684\u5e76\u53d1\u5904\u7406\u80fd\u529b\u6709\u9650</p>"},{"location":"db/elasticsearch/elasticsearch/#cluster","title":"\u96c6\u7fa4 Cluster","text":"<p>\u4e00\u4e2a\u96c6\u7fa4\u5c31\u662f\u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u670d\u52a1\u5668\u8282\u70b9\u7ec4\u7ec7\u5728\u4e00\u8d77\uff0c\u5171\u540c\u6301\u6709\u6574\u4e2a\u7684\u6570\u636e\uff0c\u5e76\u4e00\u8d77\u63d0\u4f9b\u7d22\u5f15\u548c\u641c\u7d22\u529f\u80fd\u3002**\u4e00\u4e2a Elasticsearch \u96c6\u7fa4\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u540d\u5b57\u6807\u8bc6\uff0c\u8fd9\u4e2a\u540d\u5b57\u9ed8\u8ba4\u5c31\u662f\u201delasticsearch\u201d\u3002\u8fd9\u4e2a\u540d\u5b57\u662f\u91cd\u8981\u7684\uff0c\u56e0\u4e3a\u4e00\u4e2a\u8282\u70b9\u53ea\u80fd\u901a\u8fc7\u6307\u5b9a\u67d0\u4e2a\u96c6\u7fa4\u7684\u540d\u5b57\uff0c\u6765\u52a0\u5165\u8fd9\u4e2a\u96c6\u7fa4\u3002</p>"},{"location":"db/elasticsearch/elasticsearch/#node","title":"\u8282\u70b9 Node","text":"<p>\u96c6\u7fa4\u4e2d\u5305\u542b\u5f88\u591a\u670d\u52a1\u5668\uff0c \u4e00\u4e2a\u8282\u70b9\u5c31\u662f\u5176\u4e2d\u7684\u4e00\u4e2a\u670d\u52a1\u5668\u3002 \u4f5c\u4e3a\u96c6\u7fa4\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u5b58\u50a8\u6570\u636e\uff0c\u53c2\u4e0e\u96c6\u7fa4\u7684\u7d22\u5f15\u548c\u641c\u7d22\u529f\u80fd\u3002</p> <p>\u4e00\u4e2a\u8282\u70b9\u4e5f\u662f\u7531\u4e00\u4e2a\u540d\u5b57\u6765\u6807\u8bc6\u7684\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u540d\u5b57\u662f\u4e00\u4e2a\u968f\u673a\u7684\u6f2b\u5a01\u6f2b\u753b\u89d2\u8272\u7684\u540d\u5b57\uff0c\u8fd9\u4e2a\u540d\u5b57\u4f1a\u5728\u542f\u52a8\u7684\u65f6\u5019\u8d4b\u4e88\u8282\u70b9\u3002\u8fd9\u4e2a\u540d\u5b57\u5bf9\u4e8e\u7ba1\u7406\u5de5\u4f5c\u6765\u8bf4\u633a\u91cd\u8981\u7684\uff0c\u56e0\u4e3a\u5728\u8fd9\u4e2a\u7ba1\u7406\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u4f1a\u53bb\u786e\u5b9a\u7f51\u7edc\u4e2d\u7684\u54ea\u4e9b\u670d\u52a1\u5668\u5bf9\u5e94\u4e8e Elasticsearch \u96c6\u7fa4\u4e2d\u7684\u54ea\u4e9b\u8282\u70b9\u3002</p> <p>\u4e00\u4e2a\u8282\u70b9\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u96c6\u7fa4\u540d\u79f0\u7684\u65b9\u5f0f\u6765\u52a0\u5165\u4e00\u4e2a\u6307\u5b9a\u7684\u96c6\u7fa4\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u88ab\u5b89\u6392\u52a0\u5165\u5230\u4e00\u4e2a\u53eb\u505a\u201celasticsearch\u201d\u7684\u96c6\u7fa4\u4e2d\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u4f60\u5728\u4f60\u7684\u7f51\u7edc\u4e2d\u542f\u52a8\u4e86\u82e5\u5e72\u4e2a\u8282\u70b9\uff0c\u5e76\u5047\u5b9a\u5b83\u4eec\u80fd\u591f\u76f8\u4e92\u53d1\u73b0\u5f7c\u6b64\uff0c\u5b83\u4eec\u5c06\u4f1a\u81ea\u52a8\u5730\u5f62\u6210\u5e76\u52a0\u5165\u5230\u4e00\u4e2a\u53eb\u505a\u201celasticsearch\u201d\u7684\u96c6\u7fa4\u4e2d\u3002</p> <p>\u5728\u4e00\u4e2a\u96c6\u7fa4\u91cc\uff0c\u53ea\u8981\u4f60\u60f3\uff0c\u53ef\u4ee5\u62e5\u6709\u4efb\u610f\u591a\u4e2a\u8282\u70b9\u3002\u800c\u4e14\uff0c\u5982\u679c\u5f53\u524d\u4f60\u7684\u7f51\u7edc\u4e2d\u6ca1\u6709\u8fd0 \u884c\u4efb\u4f55 Elasticsearch \u8282\u70b9\uff0c\u8fd9\u65f6\u542f\u52a8\u4e00\u4e2a\u8282\u70b9\uff0c\u4f1a\u9ed8\u8ba4\u521b\u5efa\u5e76\u52a0\u5165\u4e00\u4e2a\u53eb\u505a\u201celasticsearch\u201d\u7684 \u96c6\u7fa4\u3002</p>"},{"location":"db/elasticsearch/elasticsearch/#shards","title":"\u5206\u7247Shards","text":"<p>\u4e00\u4e2a\u7d22\u5f15\u53ef\u4ee5\u5b58\u50a8\u8d85\u51fa\u5355\u4e2a\u8282\u70b9\u786c\u4ef6\u9650\u5236\u7684\u5927\u91cf\u6570\u636e\u3002\u6bd4\u5982\uff0c\u4e00\u4e2a\u5177\u6709 10 \u4ebf\u6587\u6863\u6570\u636e \u7684\u7d22\u5f15\u5360\u636e 1TB \u7684\u78c1\u76d8\u7a7a\u95f4\uff0c\u800c\u4efb\u4e00\u8282\u70b9\u90fd\u53ef\u80fd\u6ca1\u6709\u8fd9\u6837\u5927\u7684\u78c1\u76d8\u7a7a\u95f4\u3002 \u6216\u8005\u5355\u4e2a\u8282\u70b9\u5904\u7406\u641c\u7d22\u8bf7\u6c42\uff0c\u54cd\u5e94\u592a\u6162\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c**Elasticsearch \u63d0\u4f9b\u4e86\u5c06\u7d22\u5f15\u5212\u5206\u6210\u591a\u4efd\u7684\u80fd\u529b\uff0c\u6bcf\u4e00\u4efd\u5c31\u79f0\u4e4b\u4e3a\u5206\u7247\u3002**\u5f53\u4f60\u521b\u5efa\u4e00\u4e2a\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u4f60\u60f3\u8981\u7684\u5206\u7247\u7684\u6570\u91cf\u3002\u6bcf\u4e2a\u5206\u7247\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u529f\u80fd\u5b8c\u5584\u5e76\u4e14\u72ec\u7acb\u7684\u201c\u7d22\u5f15\u201d\uff0c\u8fd9\u4e2a\u201c\u7d22\u5f15\u201d\u53ef\u4ee5\u88ab\u653e\u7f6e\u5230\u96c6\u7fa4\u4e2d\u7684\u4efb\u4f55\u8282\u70b9\u4e0a\u3002</p> <p>\u5206\u7247\u5f88\u91cd\u8981\uff0c\u4e3b\u8981\u6709\u4e24\u65b9\u9762\u7684\u539f\u56e0\uff1a</p> <p>\u5141\u8bb8\u4f60\u6c34\u5e73\u5206\u5272 / \u6269\u5c55\u4f60\u7684\u5185\u5bb9\u5bb9\u91cf\u3002 \u5141\u8bb8\u4f60\u5728\u5206\u7247\u4e4b\u4e0a\u8fdb\u884c\u5206\u5e03\u5f0f\u7684\u3001\u5e76\u884c\u7684\u64cd\u4f5c\uff0c\u8fdb\u800c\u63d0\u9ad8\u6027\u80fd/\u541e\u5410\u91cf\u3002 \u81f3\u4e8e\u4e00\u4e2a\u5206\u7247\u600e\u6837\u5206\u5e03\uff0c\u5b83\u7684\u6587\u6863\u600e\u6837\u805a\u5408\u548c\u641c\u7d22\u8bf7\u6c42\uff0c\u662f\u5b8c\u5168\u7531 Elasticsearch \u7ba1\u7406\u7684\uff0c\u5bf9\u4e8e\u4f5c\u4e3a\u7528\u6237\u7684\u4f60\u6765\u8bf4\uff0c\u8fd9\u4e9b\u90fd\u662f\u900f\u660e\u7684\uff0c\u65e0\u9700\u8fc7\u5206\u5173\u5fc3\u3002</p> <p>\u88ab\u6df7\u6dc6\u7684\u6982\u5ff5\u662f\uff0c\u4e00\u4e2a Lucene \u7d22\u5f15 \u6211\u4eec\u5728 Elasticsearch \u79f0\u4f5c \u5206\u7247 \u3002 \u4e00\u4e2aElasticsearch \u7d22\u5f15 \u662f\u5206\u7247\u7684\u96c6\u5408\u3002 \u5f53 Elasticsearch \u5728\u7d22\u5f15\u4e2d\u641c\u7d22\u7684\u65f6\u5019\uff0c \u4ed6\u53d1\u9001\u67e5\u8be2\u5230\u6bcf\u4e00\u4e2a\u5c5e\u4e8e\u7d22\u5f15\u7684\u5206\u7247\uff08Lucene \u7d22\u5f15\uff09\uff0c\u7136\u540e\u5408\u5e76\u6bcf\u4e2a\u5206\u7247\u7684\u7ed3\u679c\u5230\u4e00\u4e2a\u5168\u5c40\u7684\u7ed3\u679c\u96c6\u3002</p> <p>Lucene \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a Jakarta \u9879\u76ee\u7ec4\u7684\u4e00\u4e2a\u5b50\u9879\u76ee\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u5355\u5374\u5f3a\u5927\u7684\u5e94\u7528\u7a0b\u5f0f\u63a5\u53e3\uff0c\u80fd\u591f\u505a\u5168\u6587\u7d22\u5f15\u548c\u641c\u5bfb\u3002\u5728 Java \u5f00\u53d1\u73af\u5883\u91cc Lucene \u662f\u4e00\u4e2a\u6210\u719f\u7684\u514d\u8d39\u5f00\u6e90\u5de5\u5177\u3002\u5c31\u5176\u672c\u8eab\u800c\u8a00\uff0c Lucene \u662f\u5f53\u524d\u4ee5\u53ca\u6700\u8fd1\u51e0\u5e74\u6700\u53d7\u6b22\u8fce\u7684\u514d\u8d39 Java \u4fe1\u606f\u68c0\u7d22\u7a0b\u5e8f\u5e93\u3002\u4f46 Lucene \u53ea\u662f\u4e00\u4e2a\u63d0\u4f9b\u5168\u6587\u641c\u7d22\u529f\u80fd\u7c7b\u5e93\u7684\u6838\u5fc3\u5de5\u5177\u5305\uff0c\u800c\u771f\u6b63\u4f7f\u7528\u5b83\u8fd8\u9700\u8981\u4e00\u4e2a\u5b8c\u5584\u7684\u670d\u52a1\u6846\u67b6\u642d\u5efa\u8d77\u6765\u8fdb\u884c\u5e94\u7528\u3002</p> <p>\u76ee\u524d\u5e02\u9762\u4e0a\u6d41\u884c\u7684\u641c\u7d22\u5f15\u64ce\u8f6f\u4ef6\uff0c\u4e3b\u6d41\u7684\u5c31\u4e24\u6b3e\uff1a Elasticsearch \u548c Solr,\u8fd9\u4e24\u6b3e\u90fd\u662f\u57fa\u4e8e Lucene \u642d\u5efa\u7684\uff0c\u53ef\u4ee5\u72ec\u7acb\u90e8\u7f72\u542f\u52a8\u7684\u641c\u7d22\u5f15\u64ce\u670d\u52a1\u8f6f\u4ef6\u3002\u7531\u4e8e\u5185\u6838\u76f8\u540c\uff0c\u6240\u4ee5\u4e24\u8005\u9664\u4e86\u670d\u52a1\u5668\u5b89\u88c5\u3001\u90e8\u7f72\u3001\u7ba1\u7406\u3001\u96c6\u7fa4\u4ee5\u5916\uff0c\u5bf9\u4e8e\u6570\u636e\u7684\u64cd\u4f5c \u4fee\u6539\u3001\u6dfb\u52a0\u3001\u4fdd\u5b58\u3001\u67e5\u8be2\u7b49\u7b49\u90fd\u5341\u5206\u7c7b\u4f3c\u3002</p>"},{"location":"db/elasticsearch/elasticsearch/#replicas","title":"\u526f\u672cReplicas","text":"<p>\u5728\u4e00\u4e2a\u7f51\u7edc / \u4e91\u7684\u73af\u5883\u91cc\uff0c\u5931\u8d25\u968f\u65f6\u90fd\u53ef\u80fd\u53d1\u751f\uff0c\u5728\u67d0\u4e2a\u5206\u7247/\u8282\u70b9\u4e0d\u77e5\u600e\u4e48\u7684\u5c31\u5904\u4e8e \u79bb\u7ebf\u72b6\u6001\uff0c\u6216\u8005\u7531\u4e8e\u4efb\u4f55\u539f\u56e0\u6d88\u5931\u4e86\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6709\u4e00\u4e2a\u6545\u969c\u8f6c\u79fb\u673a\u5236\u662f\u975e\u5e38\u6709\u7528\u5e76\u4e14\u662f\u5f3a\u70c8\u63a8\u8350\u7684\u3002\u4e3a\u6b64\u76ee\u7684\uff0c Elasticsearch \u5141\u8bb8\u4f60\u521b\u5efa\u5206\u7247\u7684\u4e00\u4efd\u6216\u591a\u4efd\u62f7\u8d1d\uff0c\u8fd9\u4e9b\u62f7\u8d1d\u53eb\u505a\u590d\u5236\u5206\u7247(\u526f\u672c)\u3002</p> <p>\u590d\u5236\u5206\u7247\u4e4b\u6240\u4ee5\u91cd\u8981\uff0c\u6709\u4e24\u4e2a\u4e3b\u8981\u539f\u56e0\uff1a</p> <p>\u5728\u5206\u7247/\u8282\u70b9\u5931\u8d25\u7684\u60c5\u51b5\u4e0b\uff0c\u63d0\u4f9b\u4e86\u9ad8\u53ef\u7528\u6027\u3002\u56e0\u4e3a\u8fd9\u4e2a\u539f\u56e0\uff0c\u6ce8\u610f\u5230\u590d\u5236\u5206\u7247\u4ece\u4e0d\u4e0e\u539f/\u4e3b\u8981\uff08original/primary\uff09\u5206\u7247\u7f6e\u4e8e\u540c\u4e00\u8282\u70b9\u4e0a\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002 \u6269\u5c55\u4f60\u7684\u641c\u7d22\u91cf/\u541e\u5410\u91cf\uff0c\u56e0\u4e3a\u641c\u7d22\u53ef\u4ee5\u5728\u6240\u6709\u7684\u526f\u672c\u4e0a\u5e76\u884c\u8fd0\u884c\u3002 \u603b\u4e4b\uff0c\u6bcf\u4e2a\u7d22\u5f15\u53ef\u4ee5\u88ab\u5206\u6210\u591a\u4e2a\u5206\u7247\u3002\u4e00\u4e2a\u7d22\u5f15\u4e5f\u53ef\u4ee5\u88ab\u590d\u5236 0 \u6b21\uff08\u610f\u601d\u662f\u6ca1\u6709\u590d\u5236\uff09\u6216\u591a\u6b21\u3002\u4e00\u65e6\u590d\u5236\u4e86\uff0c\u6bcf\u4e2a\u7d22\u5f15\u5c31\u6709\u4e86\u4e3b\u5206\u7247\uff08\u4f5c\u4e3a\u590d\u5236\u6e90\u7684\u539f\u6765\u7684\u5206\u7247\uff09\u548c\u590d\u5236\u5206\u7247\uff08\u4e3b\u5206\u7247\u7684\u62f7\u8d1d\uff09\u4e4b\u522b\u3002</p> <p>\u5206\u7247\u548c\u590d\u5236\u7684\u6570\u91cf\u53ef\u4ee5\u5728\u7d22\u5f15\u521b\u5efa\u7684\u65f6\u5019\u6307\u5b9a\u3002\u5728\u7d22\u5f15\u521b\u5efa\u4e4b\u540e\uff0c\u4f60\u53ef\u4ee5\u5728\u4efb\u4f55\u65f6\u5019\u52a8\u6001\u5730\u6539\u53d8\u590d\u5236\u7684\u6570\u91cf\uff0c\u4f46\u662f\u4f60\u4e8b\u540e\u4e0d\u80fd\u6539\u53d8\u5206\u7247\u7684\u6570\u91cf\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cElasticsearch \u4e2d\u7684\u6bcf\u4e2a\u7d22\u5f15\u88ab\u5206\u7247 1 \u4e2a\u4e3b\u5206\u7247\u548c 1 \u4e2a\u590d\u5236\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u4f60\u7684\u96c6\u7fa4\u4e2d\u81f3\u5c11\u6709\u4e24\u4e2a\u8282\u70b9\uff0c\u4f60\u7684\u7d22\u5f15\u5c06\u4f1a\u6709 1 \u4e2a\u4e3b\u5206\u7247\u548c\u53e6\u5916 1 \u4e2a\u590d\u5236\u5206\u7247\uff081 \u4e2a\u5b8c\u5168\u62f7\u8d1d\uff09\uff0c\u8fd9\u6837\u7684\u8bdd\u6bcf\u4e2a\u7d22\u5f15\u603b\u5171\u5c31\u6709 2 \u4e2a\u5206\u7247\uff0c \u6211\u4eec\u9700\u8981\u6839\u636e\u7d22\u5f15\u9700\u8981\u786e\u5b9a\u5206\u7247\u4e2a\u6570\u3002</p>"},{"location":"db/elasticsearch/elasticsearch/#allocation","title":"\u5206\u914dAllocation","text":"<p>\u5c06\u5206\u7247\u5206\u914d\u7ed9\u67d0\u4e2a\u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u5305\u62ec\u5206\u914d\u4e3b\u5206\u7247\u6216\u8005\u526f\u672c\u3002\u5982\u679c\u662f\u526f\u672c\uff0c\u8fd8\u5305\u542b\u4ece\u4e3b\u5206\u7247\u590d\u5236\u6570\u636e\u7684\u8fc7\u7a0b\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u7531 master \u8282\u70b9\u5b8c\u6210\u7684\u3002</p>"},{"location":"db/elasticsearch/elasticsearch/#-","title":"\u4e94 \u7cfb\u7edf\u67b6\u6784-\u7b80\u4ecb","text":"<p>\u4e00\u4e2a\u8fd0\u884c\u4e2d\u7684 Elasticsearch \u5b9e\u4f8b\u79f0\u4e3a\u4e00\u4e2a\u8282\u70b9\uff0c\u800c\u96c6\u7fa4\u662f\u7531\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u62e5\u6709\u76f8\u540c cluster.name \u914d\u7f6e\u7684\u8282\u70b9\u7ec4\u6210\uff0c \u5b83\u4eec\u5171\u540c\u627f\u62c5\u6570\u636e\u548c\u8d1f\u8f7d\u7684\u538b\u529b\u3002\u5f53\u6709\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\u4e2d\u6216\u8005\u4ece\u96c6\u7fa4\u4e2d\u79fb\u9664\u8282\u70b9\u65f6\uff0c\u96c6\u7fa4\u5c06\u4f1a\u91cd\u65b0\u5e73\u5747\u5206\u5e03\u6240\u6709\u7684\u6570\u636e\u3002</p> <p>\u5f53\u4e00\u4e2a\u8282\u70b9\u88ab\u9009\u4e3e\u6210\u4e3a\u4e3b\u8282\u70b9\u65f6\uff0c \u5b83\u5c06\u8d1f\u8d23\u7ba1\u7406\u96c6\u7fa4\u8303\u56f4\u5185\u7684\u6240\u6709\u53d8\u66f4\uff0c\u4f8b\u5982\u589e\u52a0\u3001 \u5220\u9664\u7d22\u5f15\uff0c\u6216\u8005\u589e\u52a0\u3001\u5220\u9664\u8282\u70b9\u7b49\u3002 \u800c\u4e3b\u8282\u70b9\u5e76\u4e0d\u9700\u8981\u6d89\u53ca\u5230\u6587\u6863\u7ea7\u522b\u7684\u53d8\u66f4\u548c\u641c\u7d22\u7b49\u64cd\u4f5c\uff0c\u6240\u4ee5\u5f53\u96c6\u7fa4\u53ea\u62e5\u6709\u4e00\u4e2a\u4e3b\u8282\u70b9\u7684\u60c5\u51b5\u4e0b\uff0c\u5373\u4f7f\u6d41\u91cf\u7684\u589e\u52a0\u5b83\u4e5f\u4e0d\u4f1a\u6210\u4e3a\u74f6\u9888\u3002 \u4efb\u4f55\u8282\u70b9\u90fd\u53ef\u4ee5\u6210\u4e3a\u4e3b\u8282\u70b9\u3002\u6211\u4eec\u7684\u793a\u4f8b\u96c6\u7fa4\u5c31\u53ea\u6709\u4e00\u4e2a\u8282\u70b9\uff0c\u6240\u4ee5\u5b83\u540c\u65f6\u4e5f\u6210\u4e3a\u4e86\u4e3b\u8282\u70b9\u3002</p> <p>\u4f5c\u4e3a\u7528\u6237\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u96c6\u7fa4\u4e2d\u7684\u4efb\u4f55\u8282\u70b9 \uff0c\u5305\u62ec\u4e3b\u8282\u70b9\u3002 \u6bcf\u4e2a\u8282\u70b9\u90fd\u77e5\u9053 \u4efb\u610f\u6587\u6863\u6240\u5904\u7684\u4f4d\u7f6e\uff0c\u5e76\u4e14\u80fd\u591f\u5c06\u6211\u4eec\u7684\u8bf7\u6c42\u76f4\u63a5\u8f6c\u53d1\u5230\u5b58\u50a8\u6211\u4eec\u6240\u9700\u6587\u6863\u7684\u8282\u70b9\u3002 \u65e0\u8bba\u6211\u4eec\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u54ea\u4e2a\u8282\u70b9\uff0c\u5b83\u90fd\u80fd\u8d1f\u8d23\u4ece\u5404\u4e2a\u5305\u542b\u6211\u4eec\u6240\u9700\u6587\u6863\u7684\u8282\u70b9\u6536\u96c6\u56de\u6570\u636e\uff0c\u5e76\u5c06\u6700\u7ec8\u7ed3\u679c\u8fd4\u56de\u7d66\u5ba2\u6237\u7aef\u3002 Elasticsearch \u5bf9\u8fd9\u4e00\u5207\u7684\u7ba1\u7406\u90fd\u662f\u900f\u660e\u7684\u3002</p>"},{"location":"db/elasticsearch/elasticsearch/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://blog.csdn.net/u011863024/article/details/115721328</li> </ul>"},{"location":"db/mq/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/","title":"\u6d88\u606f\u4e2d\u95f4\u4ef6","text":""},{"location":"db/mq/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/#_1","title":"\u6d88\u606f\u4e2d\u95f4\u4ef6","text":""},{"location":"db/mq/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/#_2","title":"\u4e00 \u540c\u6b65\u8c03\u7528\u7684\u7279\u70b9","text":""},{"location":"db/mq/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/#_3","title":"\u4e8c \u6d88\u606f\u4e2d\u95f4\u4ef6\u5bf9\u6bd4","text":""},{"location":"db/mq/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/#rabbitmq","title":"\u4e09 rabbitmq","text":""},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/","title":"Redis\u4f01\u4e1a\u5e94\u7528\u573a\u666f","text":""},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#redis","title":"Redis \u4f01\u4e1a\u5e94\u7528\u573a\u666f","text":""},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#_1","title":"\u4e00 \u77ed\u4fe1\u767b\u5f55","text":"<p>\u57fa\u4e8eRedis\u5b9e\u73b0\u5171\u4eabsession\u767b\u5f55</p> <ul> <li>\u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u7ed3\u6784</li> <li>\u9009\u62e9\u5408\u9002\u7684key</li> <li>\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u7c92\u5ea6</li> </ul>"},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#_2","title":"\u4e8c \u6570\u636e\u7f13\u5b58","text":""},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#21","title":"2.1 \u7f13\u5b58\u66f4\u65b0\u7b56\u7565","text":"<ul> <li>\u5185\u5b58\u6dd8\u6c70\uff1a\u5229\u7528Redis\u5185\u7f6e\u7684\u5185\u5b58\u6dd8\u6c70\u673a\u5236\uff0c\u5f53\u5185\u5b58\u4e0d\u8db3\u65f6\u81ea\u52a8\u6dd8\u6c70\u90e8\u5206\u6570\u636e\uff0c\u4e0b\u6b21\u67e5\u8be2\u65f6\u66f4\u65b0\u6570\u636e\u3002</li> <li>\u8d85\u65f6\u5254\u9664\uff1a\u7ed9\u6570\u636e\u6dfb\u52a0TTL\u65f6\u95f4\uff0c\u5230\u671f\u540e\u81ea\u52a8\u5220\u9664\u3002</li> <li>\u4e3b\u52a8\u66f4\u65b0\uff1a\u7f16\u5199\u4ee3\u7801\uff0c\u4fee\u6539\u6570\u636e\u7684\u65f6\u5019\u540c\u65f6\u66f4\u65b0\u7f13\u5b58\u3002</li> </ul> <p>\u5148\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u518d\u5220\u7f13\u5b58\u3002</p> <p></p>"},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#22","title":"2.2 \u7f13\u5b58\u95ee\u9898","text":""},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#221","title":"2.2.1 \u7f13\u5b58\u7a7f\u900f","text":"<ul> <li>\u6982\u5ff5</li> </ul> <p>\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6570\u636e\u7684\u6570\u636e\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u6837\u7f13\u5b58\u6c38\u8fdc\u4e5f\u4e0d\u80fd\u751f\u6548\uff0c\u8bf7\u6c42\u4e00\u76f4\u5230\u6570\u636e\u5e93\u5c42\uff0c\u4e00\u822c\u53ef\u80fd\u662f\u9ed1\u5ba2\u653b\u51fb\u3002</p> <ul> <li>\u89e3\u51b3\u65b9\u6848</li> <li>\u7f13\u5b58\u7a7a\u5bf9\u8c61\uff1a\u5b9e\u73b0\u7b80\u5355\uff0c\u7ef4\u62a4\u65b9\u4fbf\uff0c\u4f46\u6709\u989d\u5916\u7684\u5185\u5b58\u6d88\u8017\uff0c\u53ef\u80fd\u77ed\u65f6\u95f4\u6570\u636e\u4e0d\u4e00\u81f4\u3002</li> <li>\u5e03\u9686\u8fc7\u6ee4\u5668\uff1a\u6839\u636e\u7b97\u6cd5\u7f13\u5b58\u7d22\u5f15\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u5b58\u50a8\u4e5f\u6709\u4e00\u5b9a\u7a0b\u5ea6\u4e0d\u5b58\u5728\u7684\u53ef\u80fd\uff0c\u5185\u5b58\u5360\u7528\u5c0f\uff0c\u6ca1\u6709\u5bf9\u4e8e\u7684key\uff0c\u5b58\u5728\u8bef\u5224</li> <li>\u589e\u52a0ID\u7684\u590d\u6742\u5ea6\uff0c\u907f\u514d\u88ab\u731c\u5230ID\u7684\u89c4\u5f8b\u3002</li> <li>\u505a\u597d\u6570\u636e\u7684\u57fa\u7840\u6821\u9a8c\u3002</li> <li>\u7528\u6237\u6743\u9650\u3002</li> <li>\u70ed\u70b9\u53c2\u6570\u7684\u9650\u6d41\u3002</li> </ul>"},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#222","title":"2.2.2 \u7f13\u5b58\u96ea\u5d29","text":"<ul> <li>\u6982\u5ff5</li> </ul> <p>\u540c\u4e00\u65f6\u523b\u5b58\u5728\u5927\u91cf\u7684key\u540c\u4e8b\u5931\u6548\u6216redis\u5b95\u673a\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u5230\u8fbe\u6570\u636e\u5e93\u3002</p> <ul> <li>\u89e3\u51b3\u65b9\u6848</li> <li>\u7ed9\u4e0d\u540c\u7684key\u7684ttl\u6dfb\u52a0\u968f\u673a\u503c</li> <li>\u5229\u7528redis\u96c6\u7fa4\u63d0\u5347\u9ad8\u53ef\u7528\u6027</li> <li>\u7ed9\u7f13\u5b58\u4e1a\u52a1\u6dfb\u52a0\u964d\u7ea7\u9650\u6d41\u7b56\u7565</li> <li>\u7ed9\u4e1a\u52a1\u6dfb\u52a0\u591a\u7ea7\u7f13\u5b58</li> </ul>"},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#23","title":"2.3 \u7f13\u5b58\u51fb\u7a7f","text":"<ul> <li>\u6982\u5ff5</li> </ul> <p>\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\u4e5f\u79f0\u4e3a\u70ed\u70b9key\u95ee\u9898\uff0c\u4e00\u4e2a\u88ab\u9ad8\u5e76\u53d1\u8bbf\u95ee\u5e76\u4e14\u7f13\u5b58\u91cd\u5efa\u4e1a\u52a1\u8f83\u590d\u6742\u7684key\u7a81\u7136\u5931\u6548\uff0c\u65e0\u6570\u7684\u8bf7\u6c42\u8bbf\u95ee\u4f1a\u77ac\u95f4\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u538b\u529b\u3002</p> <ul> <li>\u89e3\u51b3\u65b9\u6848</li> <li>\u4e92\u65a5\u9501</li> <li>\u903b\u8f91\u8fc7\u671f</li> </ul> <p></p>"},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#_3","title":"\u4e09 \u6d88\u606f\u961f\u5217\u5b9e\u73b0\u79d2\u6740","text":""},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#31-id","title":"3.1 \u5168\u5c40\u552f\u4e00ID\u751f\u6210\u7b56\u7565","text":"<ul> <li>UUID</li> <li>Redis\u81ea\u589e</li> <li>snowflake\u7b97\u6cd5</li> <li>\u6570\u636e\u5e93\u81ea\u589e</li> </ul>"},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#32","title":"3.2 \u5e76\u53d1\u7ebf\u7a0b\u5b89\u5168","text":""},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#33","title":"3.3 \u4e50\u89c2\u9501","text":"<ul> <li>\u7248\u672c\u6cd5</li> <li>CAS\u6cd5\uff1a\u57fa\u4e8e\u6570\u636e\u903b\u8f91\u8fdb\u884c\u5224\u65ad\u3002</li> </ul>"},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#_4","title":"\u56db \u5206\u5e03\u5f0f\u9501","text":"<p>\u591a\u8fdb\u7a0b\u53ef\u89c1\uff0c\u5e76\u4e14\u4e92\u65a5\u7684\u9501</p>"},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#41","title":"4.1 \u7279\u5f81","text":"<ul> <li>\u591a\u8fdb\u7a0b\u53ef\u89c1</li> <li>\u4e92\u65a5</li> <li>\u9ad8\u53ef\u7528</li> <li>\u9ad8\u6027\u80fd</li> <li>\u5b89\u5168\u6027</li> </ul>"},{"location":"db/redis/redis%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#42","title":"4.2 \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501","text":"<ul> <li>\u83b7\u53d6\u9501</li> <li> <p>\u4e92\u65a5\uff1a\u786e\u4fdd\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u9501\uff08set nx ex\uff0c\u83b7\u53d6\u9501\u7684\u65f6\u5019\u5b58\u5165\u7ebf\u7a0bID\uff09</p> </li> <li> <p>\u91ca\u653e\u9501</p> </li> <li>\u624b\u52a8\u91ca\u653e\uff1a\u91ca\u653e\u7684\u65f6\u5019\u5224\u65ad\u662f\u5426\u4e0e\u5f53\u524d\u7ebf\u7a0bID\u4e00\u81f4\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\u5219\u4e0d\u91ca\u653e\u3002</li> <li>\u8d85\u65f6\u91ca\u653e\uff1a\u83b7\u53d6\u9501\u65f6\u6dfb\u52a0\u8d85\u65f6\u65f6\u95f4</li> </ul> <p></p>"},{"location":"develop/Golang/golang%20Moc%20%E6%B5%8B%E8%AF%95/","title":"Golang Moc\u6d4b\u8bd5","text":""},{"location":"develop/Golang/golang%20Moc%20%E6%B5%8B%E8%AF%95/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/golang/mock</li> </ul>"},{"location":"develop/Golang/golang%20%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/","title":"Golang \u4f9d\u8d56\u6ce8\u5165","text":""},{"location":"develop/Golang/golang%20%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/#golang_1","title":"golang\u5b9e\u73b0\u4f9d\u8d56\u6ce8\u5165","text":"<p>\u4f9d\u8d56\u6ce8\u5165\u662f\u8f6f\u4ef6\u5de5\u7a0b\u4e2d\u7ecf\u5e38\u4f7f\u7528\u5230\u7684\u4e00\u79cd\u6280\u672f\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u63a7\u5236\u53cd\u8f6c\u7684\u673a\u5236\uff0c\u628a\u63a7\u5236\u6743\u5229\u4ea4\u7ed9\u4e86\u8c03\u7528\u65b9\u3002\u8c03\u7528\u65b9\u6765\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e9b\u53c2\u6570\uff0c\u54ea\u4e9b\u5bf9\u8c61\u6765\u8fdb\u884c\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\u3002</p> <p>\u5b83\u6709\u51e0\u4e2a\u597d\u5904\uff1a 1 \u5b83\u8ba9\u8c03\u7528\u65b9\u66f4\u7075\u6d3b\u3002 2 \u5927\u91cf\u51cf\u5c11\u5b9a\u4e49\u7c7b\u578b\u7684\u4ee3\u7801\u91cf 3 \u589e\u52a0\u4ee3\u7801\u7684\u53ef\u7528\u6027\uff0c\u56e0\u4e3a\u8c03\u7528\u65b9\u53ea\u9700\u8981\u5173\u6ce8\u5b83\u9700\u8981\u7684\u53c2\u6570\uff0c\u4e0d\u9700\u8981\u987e\u53ca\u5b83\u4e0d\u9700\u8981\u7684\u53c2\u6570\u4e86\u3002</p>"},{"location":"develop/Golang/golang%20%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.cnblogs.com/yjf512/p/12121345.html</li> <li>https://github.com/codegangsta/inject </li> </ul>"},{"location":"develop/Golang/golang%20%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/","title":"Go \u5185\u5b58\u5bf9\u9f50","text":"<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n// mem align\ntype Person struct {\n    a byte\n    b int32\n    c int64\n}\n\ntype Person2 struct {\n    a byte\n    b int64\n    c int32\n}\n\nfunc main() {\n    p := Person{}\n    fmt.Println(unsafe.Alignof(p)) // 8\n    fmt.Println(unsafe.Sizeof(p))  // 16\n\n    p2 := Person2{}\n    fmt.Println(unsafe.Alignof(p2)) // 8\n    fmt.Println(unsafe.Sizeof(p2))  // 24\n}\n</code></pre>"},{"location":"develop/Golang/golang%20%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://juejin.cn/post/6975840893676814344</li> </ul>"},{"location":"develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/","title":"Golang \u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u4e4bjaeger","text":""},{"location":"develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/#_1","title":"\u4e00 \u80cc\u666f","text":"<ul> <li>\u5f00\u653e\u5f0f\u5206\u5e03\u5f0f\u8ffd\u8e2a\u89c4\u8303\uff0c\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u81ea\u884c\u767e\u5ea6 <code>google</code>\u3002</li> <li>\u5e38\u89c1\u5b9e\u73b0\uff1a</li> <li>jaeger</li> <li>zipkin </li> </ul>"},{"location":"develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/#jaeger","title":"\u4e8c jaeger\u90e8\u7f72","text":""},{"location":"develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/#21-docker","title":"2.1 Docker\u90e8\u7f72","text":"<ul> <li>docker\u8fd0\u884c</li> </ul> <pre><code>docker run -d --name jaeger \\\n  -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \\\n  -p 5775:5775/udp \\\n  -p 6831:6831/udp \\\n  -p 6832:6832/udp \\\n  -p 5778:5778 \\\n  -p 16686:16686 \\\n  -p 14268:14268 \\\n  -p 9411:9411 \\\n  jaegertracing/all-in-one:1.12\n</code></pre>"},{"location":"develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/#22","title":"2.2 \u6d4f\u89c8\u5668\u8bbf\u95ee","text":"<p>http://localhost:16686/search</p>"},{"location":"develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/#_2","title":"\u4e09 \u7f16\u5199\u4ee3\u7801","text":"<p>\u76ee\u5f55\u7ed3\u6784</p> <pre><code>$ /workspace/goworkspace/src/github.com/kaliarch/jaeger-demo \ue0b0 tree \n.\n\u251c\u2500\u2500 client\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 client.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 client_test.go\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 tracer\n    \u2514\u2500\u2500 tracer.go\n</code></pre> <p>tracer/trace.go</p> <pre><code>package tracer\n\nimport (\n    \"io\"\n    \"time\"\n\n    \"github.com/opentracing/opentracing-go\"\n    \"github.com/uber/jaeger-client-go\"\n\n    jaegercfg \"github.com/uber/jaeger-client-go/config\"\n)\n\nvar Tracer opentracing.Tracer\n\n// NewTracer \u521b\u5efa\u4e00\u4e2ajaeger trace\nfunc NewTracer(serverName, address string) (opentracing.Tracer, io.Closer, error) {\n\n    // \u751f\u6210jaegercfg\n    cfg := jaegercfg.Configuration{\n        ServiceName: serverName,\n        Sampler: &amp;jaegercfg.SamplerConfig{\n            Type:  jaeger.SamplerTypeConst,\n            Param: 1,\n        },\n        Reporter: &amp;jaegercfg.ReporterConfig{\n            LogSpans:            true,\n            BufferFlushInterval: 1 * time.Second,\n        },\n    }\n    transport, err := jaeger.NewUDPTransport(address, 0)\n    if err != nil {\n        return nil, nil, err\n    }\n    reporter := jaeger.NewRemoteReporter(transport)\n\n    options := jaegercfg.Reporter(reporter)\n    return cfg.NewTracer(options)\n}\n</code></pre> <p>main.go</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gin-gonic/gin\"\n    tracer2 \"github.com/kaliarch/jaeger-demo/tracer\"\n    \"github.com/opentracing-contrib/go-gin/ginhttp\"\n    \"net/http\"\n)\n\nconst (\n    ginServerName  = \"gin-server-demo\"\n    jaegerEndpoint = \"127.0.0.1:6831\"\n)\n\nfunc main() {\n\n    tracer, closer, err := tracer2.NewTracer(ginServerName, jaegerEndpoint)\n    if err != nil {\n        panic(err)\n    }\n    defer closer.Close()\n\n    r := gin.Default()\n\n    jaegerMiddle := ginhttp.Middleware(tracer, ginhttp.OperationNameFunc(func(r *http.Request) string {\n        return fmt.Sprintf(\"HTTP %s %s\", r.Method, r.URL.String())\n    }))\n    r.Use(ginhttp.Middleware(tracer))\n    r.Use(jaegerMiddle)\n\n    r.GET(\"/ping\", func(c *gin.Context) {\n        c.JSON(200, gin.H{\n            \"msg\": \"pong\",\n        })\n    })\n    _ = r.Run(\":8888\")\n}\n</code></pre> <p>client.go</p> <pre><code>package client\n\nimport (\n    \"context\"\n    \"fmt\"\n    tracer2 \"github.com/kaliarch/jaeger-demo/tracer\"\n    \"github.com/opentracing-contrib/go-stdlib/nethttp\"\n    \"github.com/opentracing/opentracing-go\"\n    \"github.com/opentracing/opentracing-go/ext\"\n    otlog \"github.com/opentracing/opentracing-go/log\"\n\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nconst (\n    // \u670d\u52a1\u540d \u670d\u52a1\u552f\u4e00\u6807\u793a\uff0c\u670d\u52a1\u6307\u6807\u805a\u5408\u8fc7\u6ee4\u4f9d\u636e\u3002\n    clientServerName = \"demo-gin-client\"\n    jaegerEndpoint   = \"127.0.0.1:6831\"\n    ginEndpoint      = \"http://127.0.0.1:8888\"\n)\n\nfunc HandlerError(span opentracing.Span, err error) {\n    span.SetTag(string(ext.Error), true)\n    span.LogKV(otlog.Error(err))\n    //log.Fatal(\"%v\", err)\n}\n\n// StartClient gin client \u4e5f\u662f\u6807\u51c6\u7684 http client.\nfunc StartClient() {\n\n    tracer, closer, err := tracer2.NewTracer(clientServerName, jaegerEndpoint)\n    if err != nil {\n        panic(err)\n    }\n    defer closer.Close()\n    span := tracer.StartSpan(\"CallDemoServer\")\n    ctx := opentracing.ContextWithSpan(context.Background(), span)\n    defer span.Finish()\n\n    // \u6784\u5efahttp\u8bf7\u6c42\n    req, err := http.NewRequest(\n        http.MethodGet,\n        fmt.Sprintf(\"%s/ping\", ginEndpoint),\n        nil,\n    )\n    if err != nil {\n        HandlerError(span, err)\n        return\n    }\n    // \u6784\u5efa\u5e26tracer\u7684\u8bf7\u6c42\n    req = req.WithContext(ctx)\n    req, ht := nethttp.TraceRequest(tracer, req)\n    defer ht.Finish()\n\n    // \u521d\u59cb\u5316http\u5ba2\u6237\u7aef\n    httpClient := &amp;http.Client{Transport: &amp;nethttp.Transport{}}\n    // \u53d1\u8d77\u8bf7\u6c42\n    res, err := httpClient.Do(req)\n    if err != nil {\n        HandlerError(span, err)\n        return\n    }\n    defer res.Body.Close()\n    body, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        HandlerError(span, err)\n        return\n    }\n    log.Printf(\" %s recevice: %s\\n\", clientServerName, string(body))\n}\n</code></pre>"},{"location":"develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/#_3","title":"\u56db \u6f14\u793a","text":""},{"location":"develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.jaegertracing.io/</li> <li>https://github.com/why444216978/gin-api/blob/master/routers/router.go</li> <li>https://cloud.tencent.com/document/product/1463/57863</li> </ul>"},{"location":"develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/","title":"Gin\u6846\u67b6\u70ed\u52a0\u8f7d","text":""},{"location":"develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>Air\u80fd\u591f\u5b9e\u65f6\u76d1\u542c\u9879\u76ee\u7684\u4ee3\u7801\u6587\u4ef6\uff0c\u5728\u4ee3\u7801\u53d1\u751f\u53d8\u66f4\u4e4b\u540e\u81ea\u52a8\u91cd\u65b0\u7f16\u8bd1\u5e76\u6267\u884c\uff0c\u5927\u5927\u63d0\u9ad8gin\u6846\u67b6\u9879\u76ee\u7684\u5f00\u53d1\u6548\u7387\u3002</p>"},{"location":"develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/#12","title":"1.2 \u4ec0\u4e48\u662f\u70ed\u52a0\u8f7d","text":"<p>\u5982\u679c\u4f60\u662f\u4e00\u540dpython\u5f00\u53d1\u8005\uff0c\u5e94\u8be5\u5f88\u719f\u6089\u8fd9\u4e2a\u3002\u6211\u4eec\u5728Flask\u6216\u8005Django\u6846\u67b6\u4e0b\u5f00\u53d1\u90fd\u662f\u652f\u6301\u5b9e\u65f6\u52a0\u8f7d\u7684\uff0c\u5f53\u6211\u4eec\u5bf9\u4ee3\u7801\u8fdb\u884c\u4fee\u6539\u65f6\uff0c\u7a0b\u5e8f\u80fd\u591f\u81ea\u52a8\u91cd\u65b0\u52a0\u8f7d\u5e76\u6267\u884c\uff0c\u8fd9\u5728\u6211\u4eec\u5f00\u53d1\u4e2d\u662f\u975e\u5e38\u4fbf\u5229\u7684\uff0c\u53ef\u4ee5\u5feb\u901f\u8fdb\u884c\u4ee3\u7801\u6d4b\u8bd5\uff0c\u7701\u53bb\u4e86\u6bcf\u6b21\u624b\u52a8\u91cd\u65b0\u7f16\u8bd1\u3002</p> <p>\u5982\u679c\u4f60\u662f\u4e00\u540dJAVA\u5f00\u53d1\u8005\uff0c\u4e0d\u4ec5\u4f1a\u542c\u8fc7\u70ed\u52a0\u8f7d\uff0c\u70ed\u90e8\u7f72\u4f1a\u8ddf\u7740\u4e00\u5757\u51fa\u73b0\u3002\u70ed\u90e8\u7f72\u4e00\u822c\u662f\u6307\u5bb9\u5668\uff08\u652f\u6301\u591a\u5e94\u7528\uff09\u4e0d\u91cd\u542f\uff0c\u5355\u72ec\u542f\u52a8\u5355\u4e2a\u5e94\u7528\u3002\u70ed\u52a0\u8f7d\u4e00\u822c\u6307\u91cd\u542f\u5e94\u7528\uff08JVM\uff09\uff0c\u5355\u72ec\u91cd\u65b0\u66f4\u65b0\u67d0\u4e2a\u7c7b\u6216\u8005\u914d\u7f6e\u6587\u4ef6\u3002</p>"},{"location":"develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/#_2","title":"\u4e8c \u5b9e\u73b0\u65b9\u6848","text":""},{"location":"develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/#21-fresh","title":"2.1 \u4f7f\u7528fresh\u5b9e\u73b0","text":"<pre><code>    go get github.com/pilu/fresh\n    # \u8df3\u8f6c\u5230\u8981\u8fd0\u884c\u7684\u9879\u76ee\u7684 \u6839\u76ee\u5f55 \uff0c\u8fd0\u884c fresh \u547d\u4ee4 \u3002fresh \u5c06\u4f1a\u81ea\u52a8\u8fd0\u884c\u9879\u76ee\u7684 main.go  \n    fresh\n</code></pre>"},{"location":"develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/#22-air","title":"2.2 \u4f7f\u7528air\u5b9e\u73b0","text":"<p>\u53c2\u8003\uff1ahttps://www.liwenzhou.com/posts/Go/live_reload_with_air/</p>"},{"location":"develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/#_3","title":"\u4e09 \u5b9e\u6218","text":""},{"location":"develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/#_4","title":"\u56db \u53cd\u601d","text":""},{"location":"develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.liwenzhou.com/posts/Go/live_reload_with_air/ </li> <li>https://studygolang.com/articles/30231?fr=sidebar</li> </ul>"},{"location":"develop/Golang/gin/gin-swagger/","title":"Gin + Swagger\u5feb\u901f\u751f\u6210API\u6587\u6863","text":""},{"location":"develop/Golang/gin/gin-swagger/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5728restful\u524d\u540e\u7aef\u9879\u76ee\u8fdb\u884c\u63a5\u53e3\u5bf9\u63a5\u7684\u65f6\u5019\uff0c\u9700\u8981\u6709\u660e\u786e\u7684\u63a5\u53e3\u6587\u6863\uff0c\u6b64\u65f6\u5355\u72ec\u9488\u5bf9\u63a5\u53e3\u7f16\u5199\u63a5\u53e3\u6587\u6863\uff0c\u8017\u65f6\u8017\u529b\uff0c\u5207\u4ee3\u7801\u4fee\u6539\u540e\uff0c\u8fd8\u9700\u8981\u7ef4\u62a4\u63a5\u53e3\u6587\u6863\uff0c\u6b64\u65f6\u5bb9\u6613\u51fa\u73b0\u6587\u6863\u4e0d\u7edf\u4e00\u7684\u60c5\u51b5\uff0c\u5c06\u63a5\u53e3\u6587\u6863\u76f4\u63a5\u5199\u5728\u4ee3\u7801\u4e2d\u662f\u4e00\u79cd\u6bd4\u8f83\u597d\u7684\u65b9\u5f0f\u3002</p> <p>swagger\u5c31\u662f\u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\uff0c\u5f00\u53d1\u4eba\u5458\u53ea\u9700\u8981\u6309\u7167\u7279\u5b9a\u89c4\u8303\u5728\u7f16\u5199\u63a5\u53e3\u4ee3\u7801\u65f6\u5199\u4e0aswagger\u6ce8\u91ca\uff0c\u5229\u7528swagger\u751f\u6210\u63a5\u53e3\u6587\u6863\u3002</p>"},{"location":"develop/Golang/gin/gin-swagger/#swagger-ui","title":"\u4e8c Swagger UI\u7b80\u4ecb","text":"<p><code>Swagger</code> \u662f\u4e00\u4e2a <code>API</code> \u751f\u6210\u5de5\u5177\uff0c\u53ef\u4ee5\u751f\u6210\u6587\u6863\u3002 <code>Swagger</code> \u662f\u901a\u8fc7\u7f16\u5199 <code>yaml</code> \u548c <code>json</code> \u6765\u5b9e\u73b0\u6587\u6863\u5316\u3002\u5e76\u4e14\u53ef\u4ee5\u8fdb\u884c\u6d4b\u8bd5\u7b49\u5de5\u4f5c\u3002</p> <p>\u901a\u8fc7 <code>swagger</code> \u53ef\u4ee5\u65b9\u4fbf\u7684\u751f\u6210\u63a5\u53e3\u6587\u6863\uff0c\u65b9\u4fbf\u524d\u7aef\u8fdb\u884c\u67e5\u770b\u548c\u6d4b\u8bd5\u3002</p>"},{"location":"develop/Golang/gin/gin-swagger/#_2","title":"\u4e09 \u9879\u76ee\u96c6\u6210","text":""},{"location":"develop/Golang/gin/gin-swagger/#31-swag","title":"3.1 \u5b89\u88c5swag","text":"<pre><code>$ go get github.com/swaggo/swag/cmd/swag\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#32","title":"3.2 \u751f\u6210\u6587\u4ef6","text":"<p>\u9996\u6b21\u751f\u6210\u76f8\u5173\u6587\u4ef6\uff0c\u540e\u671f\u4ee3\u7801\u4fee\u6539\u8fc7\uff0c\u6dfb\u52a0swag\u6ce8\u89e3\u540e\uff0c\u4e5f\u9700\u8981</p> <pre><code># \u5728go \u9879\u76ee\u4e2d\uff08\u5305\u542bmain.go\uff09\u7684\u76ee\u5f55\uff0c\u4f7f\u7528swag init\u547d\u4ee4\u751f\u6210\u76f8\u5173\u6587\u4ef6\u3002\n$ swag init\n2021/09/23 16:32:23 Generate swagger docs....\n2021/09/23 16:32:23 Generate general API Info, search dir:./\n2021/09/23 16:32:26 create docs.go at docs/docs.go\n2021/09/23 16:32:26 create swagger.json at docs/swagger.json\n2021/09/23 16:32:26 create swagger.yaml at docs/swagger.yaml\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#33-gin-swagger","title":"3.3 \u5b89\u88c5gin-swagger","text":"<pre><code>$ go get -u github.com/swaggo/gin-swagger\n$ go get -u github.com/swaggo/gin-swagger/swaggerFiles\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#34","title":"3.4 \u96c6\u6210","text":"<ul> <li>\u5f15\u5165\u751f\u6210\u7684docs\u5305</li> <li>\u5728\u5177\u4f53\u63a5\u53e3\u4e0a\u6839\u636e\u89c4\u8303swag\u7f16\u5199\u63a5\u53e3\u63cf\u8ff0</li> <li>\u5728\u8def\u7531\u4e2d\u8fdb\u884c\u5f15\u5165</li> <li>\u518d\u6b21\u6267\u884cswag init \u66f4\u65b0\u63a5\u53e3</li> <li>\u8fd0\u884c\u5e94\u7528\u540e\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee\uff1ahttp://localhost:8887/swagger/index.html</li> </ul> <pre><code>package main\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    swaggerFiles \"github.com/swaggo/files\"\n    ginSwagger \"github.com/swaggo/gin-swagger\"\n\n    _ \"github.com/swaggo/gin-swagger/example/basic/docs\" // docs is generated by Swag CLI, you have to import it.\n)\n\n// @title Swagger Example API\n// @version 1.0\n// @description This is a sample server Petstore server.\n// @termsOfService http://swagger.io/terms/\n\n// @contact.name API Support\n// @contact.url http://www.swagger.io/support\n// @contact.email support@swagger.io\n\n// @license.name Apache 2.0\n// @license.url http://www.apache.org/licenses/LICENSE-2.0.html\n\n// @host petstore.swagger.io\n// @BasePath /v2\nfunc main() {\n    r := gin.New()\n\n    url := ginSwagger.URL(\"http://localhost:8080/swagger/doc.json\") // The url pointing to API definition\n    r.GET(\"/swagger/*any\", ginSwagger.WrapHandler(swaggerFiles.Handler, url))\n\n    r.Run()\n}\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#_3","title":"\u56db \u4e0d\u540c\u7c7b\u578b","text":""},{"location":"develop/Golang/gin/gin-swagger/#41","title":"4.1 \u8bf7\u6c42","text":""},{"location":"develop/Golang/gin/gin-swagger/#411-url","title":"4.1.1 url\u53c2\u6570","text":"<pre><code>// @Param id path int true \"ID\"    //url\u53c2\u6570\uff1a\uff08name\uff1b\u53c2\u6570\u7c7b\u578b[query(?id=),path(/123)]\uff1b\u6570\u636e\u7c7b\u578b\uff1brequired\uff1b\u53c2\u6570\u63cf\u8ff0\uff09\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#412-body","title":"4.1.2 body\u53c2\u6570","text":"<p>\u4f8b\u5982json</p> <pre><code>// @Param data body models.RegistryAuth true \"\u8bf7\u793a\u53c2\u6570data\"\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#42","title":"4.2 \u8fd4\u56de","text":""},{"location":"develop/Golang/gin/gin-swagger/#421","title":"4.2.1 \u5b57\u7b26\u4e32","text":"<pre><code>// @Success 200 {string} json \"{\"msg\":\"ok\"}\"\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#422","title":"4.2.2 \u7ed3\u6784\u4f53\u8fd4\u56de","text":"<pre><code>// @Success 200 {object} models.Response \"\u8bf7\u6c42\u6210\u529f\"\n// @Failure 400 {object} models.ResponseErr \"\u8bf7\u6c42\u9519\u8bef\"\n// @Failure 500 {object} models.ResponseErr \"\u5185\u90e8\u9519\u8bef\"\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#_4","title":"\u4e94 \u5b9e\u6218","text":""},{"location":"develop/Golang/gin/gin-swagger/#51-main","title":"5.1 main\u51fd\u6570\u6dfb\u52a0\u5168\u5c40","text":"<pre><code>// @title smartkm_api_image Swagger Example\n// @version 1.0\n// @description This is a sample server Petstore server.\n// @termsOfService http://swagger.io/terms/\n\n// @contact.name API Support\n// @contact.url http://www.swagger.io/support\n// @contact.email support@swagger.io\n\n// @license.name Apache 2.0\n// @license.url http://www.apache.org/licenses/LICENSE-2.0.html\n\n// @host petstore.swagger.io\n// @BasePath /\nfunc main() {\n    // \u542f\u52a8\u670d\u52a1\n    run()\n}\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#52","title":"5.2 \u51fd\u6570\u7ea7\u522b","text":""},{"location":"develop/Golang/gin/gin-swagger/#521-get","title":"5.2.1 Get\u8bf7\u6c42","text":"<pre><code>// @Summary \u67e5\u770b\u8fc1\u79fb\u4efb\u52a1\u8be6\u7ec6\u4fe1\u606f\n// @Description \u67e5\u770b\u8fc1\u79fb\u4efb\u52a1\u8be6\u7ec6\u4fe1\u606f\n// @Accept json\n// @Produce  json\n// @Param task_id path string true \"task_id\"\n// @Success 200 {object} models.Response \"\u8bf7\u6c42\u6210\u529f\"\n// @Failure 400 {object} models.ResponseErr \"\u8bf7\u6c42\u9519\u8bef\"\n// @Failure 500 {object} models.ResponseErr \"\u5185\u90e8\u9519\u8bef\"\n// @Router /task [get]\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#522-post","title":"5.2.2 Post\u8bf7\u6c42","text":"<pre><code>// @Summary \u521b\u5efa\u955c\u50cf\u8fc1\u79fb\u4efb\u52a1\n// @Description \u521b\u5efa\u955c\u50cf\u8fc1\u79fb\u4efb\u52a1\n// @Accept  json\n// @Produce  json\n// @Param data body models.CreateTaskReq true \"\u8bf7\u793a\u53c2\u6570data\"\n// @Success 200 {object} models.Response \"\u8bf7\u6c42\u6210\u529f\"\n// @Failure 400 {object} models.ResponseErr \"\u8bf7\u6c42\u9519\u8bef\"\n// @Failure 500 {object} models.ResponseErr \"\u5185\u90e8\u9519\u8bef\"\n// @Router /task [post]\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#523-delete","title":"5.2.3 Delete\u8bf7\u6c42","text":"<pre><code>// @Summary \u5220\u9664\u955c\u50cf\u8fc1\u79fb\u4efb\u52a1\n// @Description \u5220\u9664\u955c\u50cf\u8fc1\u79fb\u4efb\u52a1\n// @Accept  json\n// @Produce  json\n// @Param data body models.TaskReq true \"\u8bf7\u793a\u53c2\u6570data\"\n// @Success 200 {object} models.Response \"\u8bf7\u6c42\u6210\u529f\"\n// @Failure 400 {object} models.ResponseErr \"\u8bf7\u6c42\u9519\u8bef\"\n// @Failure 500 {object} models.ResponseErr \"\u5185\u90e8\u9519\u8bef\"\n// @Router /task [delete]\n</code></pre>"},{"location":"develop/Golang/gin/gin-swagger/#_5","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5728\u8def\u7531\u6dfb\u52a0swagger\u7684\u65f6\u5019\uff0c\u9700\u8981\u5f15\u5165\u9879\u76ee\u751f\u6210\u7684docs\u5305</li> <li>\u5047\u5982func\u65b9\u6cd5\u5934\u6807\u6ce8\u7684swagger\u6ce8\u91ca\u4e0d\u6b63\u786e\uff0c\u5728\u6267\u884cswag init\u4f1a\u62a5\u9519\uff0c\u81ea\u884c\u6839\u636e\u62a5\u9519\u4fe1\u606f\u53bb\u4fee\u6539\uff1b</li> <li>\u8bbf\u95eeswagger\u63a7\u5236\u53f0\u62a5\u9519404 page not found\uff0c\u662f\u56e0\u4e3a\u6ca1\u6709\u6dfb\u52a0swagger\u7684\u8def\u7531</li> <li>\u8bbf\u95eeswagger\u63a7\u5236\u53f0\u62a5\u9519Failed to load spec\uff0c\u662f\u56e0\u4e3a\u6ca1\u6709import\u5f15\u5165\u6267\u884cswag init\u751f\u6210\u7684swagger\u7684docs\u6587\u4ef6\u5939\uff1b</li> </ul>"},{"location":"develop/Golang/gin/gin-swagger/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://studygolang.com/articles/12354</li> <li>https://github.com/go-swagger/go-swagger</li> <li>https://github.com/swaggo/gin-swagger</li> </ul>"},{"location":"develop/Golang/gin/gin-validator%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/","title":"gin-validator\u53c2\u6570\u6821\u9a8c","text":""},{"location":"develop/Golang/gin/gin-validator%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5728web\u5f00\u53d1\u4e2d\u4e00\u4e2a\u4e0d\u53ef\u907f\u514d\u7684\u73af\u8282\u5c31\u662f\u5bf9\u8bf7\u6c42\u53c2\u6570\u8fdb\u884c\u6821\u9a8c\uff0c\u901a\u5e38\u6211\u4eec\u4f1a\u5728\u4ee3\u7801\u4e2d\u5b9a\u4e49\u4e0e\u8bf7\u6c42\u53c2\u6570\u76f8\u5bf9\u5e94\u7684\u6a21\u578b\uff08\u7ed3\u6784\u4f53\uff09\uff0c\u501f\u52a9\u6a21\u578b\u7ed1\u5b9a\u5feb\u6377\u5730\u89e3\u6790\u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\uff0c\u4f8b\u5982 gin \u6846\u67b6\u4e2d\u7684<code>Bind</code>\u548c<code>ShouldBind</code>\u7cfb\u5217\u65b9\u6cd5\u3002\u672c\u6587\u5c31\u4ee5 gin \u6846\u67b6\u7684\u8bf7\u6c42\u53c2\u6570\u6821\u9a8c\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u4e00\u4e9b<code>validator</code>\u5e93\u7684\u5b9e\u7528\u6280\u5de7\u3002</p> <p>gin\u6846\u67b6\u4f7f\u7528github.com/go-playground/validator\u8fdb\u884c\u53c2\u6570\u6821\u9a8c\uff0c\u76ee\u524d\u5df2\u7ecf\u652f\u6301<code>github.com/go-playground/validator/v10</code>\u4e86\uff0c\u6211\u4eec\u9700\u8981\u5728\u5b9a\u4e49\u7ed3\u6784\u4f53\u65f6\u4f7f\u7528 <code>binding</code> tag\u6807\u8bc6\u76f8\u5173\u6821\u9a8c\u89c4\u5219\uff0c\u53ef\u4ee5\u67e5\u770bvalidator\u6587\u6863\u67e5\u770b\u652f\u6301\u7684\u6240\u6709 tag\u3002</p>"},{"location":"develop/Golang/gin/gin-validator%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/#_2","title":"\u4e8c \u793a\u4f8b","text":"<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\ntype SignUpParam struct {\n    Age        uint8  `json:\"age\" binding:\"gte=1,lte=130\"`\n    Name       string `json:\"name\" binding:\"required\"`\n    Email      string `json:\"email\" binding:\"required,email\"`\n    Password   string `json:\"password\" binding:\"required\"`\n    RePassword string `json:\"re_password\" binding:\"required,eqfield=Password\"`\n}\n\nfunc main() {\n    r := gin.Default()\n\n    r.POST(\"/signup\", func(c *gin.Context) {\n        var u SignUpParam\n        if err := c.ShouldBind(&amp;u); err != nil {\n            c.JSON(http.StatusOK, gin.H{\n                \"msg\": err.Error(),\n            })\n            return\n        }\n        // \u4fdd\u5b58\u5165\u5e93\u7b49\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801...\n\n        c.JSON(http.StatusOK, \"success\")\n    })\n\n    _ = r.Run(\":8999\")\n}\n</code></pre> <p>\u6211\u4eec\u4f7f\u7528curl\u53d1\u9001\u4e00\u4e2aPOST\u8bf7\u6c42\u6d4b\u8bd5\u4e0b\uff1a</p> <pre><code>curl -H \"Content-type: application/json\" -X POST -d '{\"name\":\"q1mi\",\"age\":18,\"email\":\"123.com\"}' http://127.0.0.1:8999/signup\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>{\"msg\":\"Key: 'SignUpParam.Email' Error:Field validation for 'Email' failed on the 'email' tag\\nKey: 'SignUpParam.Password' Error:Field validation for 'Password' failed on the 'required' tag\\nKey: 'SignUpParam.RePassword' Error:Field validation for 'RePassword' failed on the 'required' tag\"}\n</code></pre> <p>\u4ece\u6700\u7ec8\u7684\u8f93\u51fa\u7ed3\u679c\u53ef\u4ee5\u770b\u5230 <code>validator</code> \u7684\u68c0\u9a8c\u751f\u6548\u4e86\uff0c\u4f46\u662f\u9519\u8bef\u63d0\u793a\u7684\u5b57\u6bb5\u4e0d\u662f\u7279\u522b\u53cb\u597d\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u5c06\u5b83\u7ffb\u8bd1\u6210\u4e2d\u6587\u3002</p>"},{"location":"develop/Golang/gin/gin-validator%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/#_3","title":"\u4e09 \u7ffb\u8bd1\u9a8c\u8bc1\u4fe1\u606f","text":"<p><code>validator</code>\u5e93\u672c\u8eab\u662f\u652f\u6301\u56fd\u9645\u5316\u7684\uff0c\u501f\u52a9\u76f8\u5e94\u7684\u8bed\u8a00\u5305\u53ef\u4ee5\u5b9e\u73b0\u6821\u9a8c\u9519\u8bef\u63d0\u793a\u4fe1\u606f\u7684\u81ea\u52a8\u7ffb\u8bd1\u3002\u4e0b\u9762\u7684\u793a\u4f8b\u4ee3\u7801\u6f14\u793a\u4e86\u5982\u4f55\u5c06\u9519\u8bef\u63d0\u793a\u4fe1\u606f\u7ffb\u8bd1\u6210\u4e2d\u6587\uff0c\u7ffb\u8bd1\u6210\u5176\u4ed6\u8bed\u8a00\u7684\u65b9\u6cd5\u7c7b\u4f3c\u3002</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n    \"github.com/gin-gonic/gin/binding\"\n    \"github.com/go-playground/locales/en\"\n    \"github.com/go-playground/locales/zh\"\n    ut \"github.com/go-playground/universal-translator\"\n    \"github.com/go-playground/validator/v10\"\n    enTranslations \"github.com/go-playground/validator/v10/translations/en\"\n    zhTranslations \"github.com/go-playground/validator/v10/translations/zh\"\n)\n\n// \u5b9a\u4e49\u4e00\u4e2a\u5168\u5c40\u7ffb\u8bd1\u5668T\nvar trans ut.Translator\n\n// InitTrans \u521d\u59cb\u5316\u7ffb\u8bd1\u5668\nfunc InitTrans(locale string) (err error) {\n    // \u4fee\u6539gin\u6846\u67b6\u4e2d\u7684Validator\u5f15\u64ce\u5c5e\u6027\uff0c\u5b9e\u73b0\u81ea\u5b9a\u5236\n    if v, ok := binding.Validator.Engine().(*validator.Validate); ok {\n\n        zhT := zh.New() // \u4e2d\u6587\u7ffb\u8bd1\u5668\n        enT := en.New() // \u82f1\u6587\u7ffb\u8bd1\u5668\n\n        // \u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5907\u7528\uff08fallback\uff09\u7684\u8bed\u8a00\u73af\u5883\n        // \u540e\u9762\u7684\u53c2\u6570\u662f\u5e94\u8be5\u652f\u6301\u7684\u8bed\u8a00\u73af\u5883\uff08\u652f\u6301\u591a\u4e2a\uff09\n        // uni := ut.New(zhT, zhT) \u4e5f\u662f\u53ef\u4ee5\u7684\n        uni := ut.New(enT, zhT, enT)\n\n        // locale \u901a\u5e38\u53d6\u51b3\u4e8e http \u8bf7\u6c42\u5934\u7684 'Accept-Language'\n        var ok bool\n        // \u4e5f\u53ef\u4ee5\u4f7f\u7528 uni.FindTranslator(...) \u4f20\u5165\u591a\u4e2alocale\u8fdb\u884c\u67e5\u627e\n        trans, ok = uni.GetTranslator(locale)\n        if !ok {\n            return fmt.Errorf(\"uni.GetTranslator(%s) failed\", locale)\n        }\n\n        // \u6ce8\u518c\u7ffb\u8bd1\u5668\n        switch locale {\n        case \"en\":\n            err = enTranslations.RegisterDefaultTranslations(v, trans)\n        case \"zh\":\n            err = zhTranslations.RegisterDefaultTranslations(v, trans)\n        default:\n            err = enTranslations.RegisterDefaultTranslations(v, trans)\n        }\n        return\n    }\n    return\n}\n\ntype SignUpParam struct {\n    Age        uint8  `json:\"age\" binding:\"gte=1,lte=130\"`\n    Name       string `json:\"name\" binding:\"required\"`\n    Email      string `json:\"email\" binding:\"required,email\"`\n    Password   string `json:\"password\" binding:\"required\"`\n    RePassword string `json:\"re_password\" binding:\"required,eqfield=Password\"`\n}\n\nfunc main() {\n    if err := InitTrans(\"zh\"); err != nil {\n        fmt.Printf(\"init trans failed, err:%v\\n\", err)\n        return\n    }\n\n    r := gin.Default()\n\n    r.POST(\"/signup\", func(c *gin.Context) {\n        var u SignUpParam\n        if err := c.ShouldBind(&amp;u); err != nil {\n            // \u83b7\u53d6validator.ValidationErrors\u7c7b\u578b\u7684errors\n            errs, ok := err.(validator.ValidationErrors)\n            if !ok {\n                // \u975evalidator.ValidationErrors\u7c7b\u578b\u9519\u8bef\u76f4\u63a5\u8fd4\u56de\n                c.JSON(http.StatusOK, gin.H{\n                    \"msg\": err.Error(),\n                })\n                return\n            }\n            // validator.ValidationErrors\u7c7b\u578b\u9519\u8bef\u5219\u8fdb\u884c\u7ffb\u8bd1\n            c.JSON(http.StatusOK, gin.H{\n                \"msg\":errs.Translate(trans),\n            })\n            return\n        }\n        // \u4fdd\u5b58\u5165\u5e93\u7b49\u5177\u4f53\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801...\n\n        c.JSON(http.StatusOK, \"success\")\n    })\n\n    _ = r.Run(\":8999\")\n}\n</code></pre> <p>\u540c\u6837\u7684\u8bf7\u6c42\u518d\u6765\u4e00\u6b21\uff1a</p> <pre><code>curl -H \"Content-type: application/json\" -X POST -d '{\"name\":\"q1mi\",\"age\":18,\"email\":\"123.com\"}' http://127.0.0.1:8999/signup\n</code></pre> <p>\u8fd9\u4e00\u6b21\u7684\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>{\"msg\":{\"SignUpParam.Email\":\"Email\u5fc5\u987b\u662f\u4e00\u4e2a\u6709\u6548\u7684\u90ae\u7bb1\",\"SignUpParam.Password\":\"Password\u4e3a\u5fc5\u586b\u5b57\u6bb5\",\"SignUpParam.RePassword\":\"RePassword\u4e3a\u5fc5\u586b\u5b57\u6bb5\"}}\n</code></pre>"},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/","title":"Gin\u6846\u67b6\u4f18\u96c5\u5173\u673a\u548c\u91cd\u542f","text":""},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u6211\u4eec\u7f16\u5199\u7684Web\u9879\u76ee\u90e8\u7f72\u4e4b\u540e\uff0c\u7ecf\u5e38\u4f1a\u56e0\u4e3a\u9700\u8981\u8fdb\u884c\u914d\u7f6e\u53d8\u66f4\u6216\u529f\u80fd\u8fed\u4ee3\u800c\u91cd\u542f\u670d\u52a1\uff0c\u5355\u7eaf\u7684<code>kill -9 pid</code>\u7684\u65b9\u5f0f\u4f1a\u5f3a\u5236\u5173\u95ed\u8fdb\u7a0b\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u670d\u52a1\u7aef\u5f53\u524d\u6b63\u5728\u5904\u7406\u7684\u8bf7\u6c42\u5931\u8d25\uff0c\u90a3\u6709\u6ca1\u6709\u66f4\u4f18\u96c5\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u5173\u673a\u6216\u91cd\u542f\u5462\uff1f</p> <p>\u9605\u8bfb\u672c\u6587\u9700\u8981\u4e86\u89e3\u4e00\u4e9bUNIX\u7cfb\u7edf\u4e2d<code>\u4fe1\u53f7</code>\u7684\u6982\u5ff5\uff0c\u8bf7\u63d0\u524d\u67e5\u9605\u8d44\u6599\u9884\u4e60\u3002</p>"},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#_2","title":"\u4e8c \u5b9e\u73b0\u65b9\u6848","text":""},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#21-linux","title":"2.1 Linux \u4fe1\u53f7","text":""},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#211","title":"2.1.1 \u4fe1\u53f7\u540d\u79f0\u4e0e\u7f16\u53f7","text":"<p>\u6bcf\u4e2a\u4fe1\u53f7\u90fd\u6709\u4e00\u4e2a\u540d\u5b57\u548c\u7f16\u53f7\uff0c\u8fd9\u4e9b\u540d\u5b57\u90fd\u4ee5\u201cSIG\u201d\u5f00\u5934\uff0c\u4f8b\u5982\u201cSIGIO \u201d\u3001\u201cSIGCHLD\u201d\u7b49\u7b49\u3002 \u4fe1\u53f7\u5b9a\u4e49\u5728<code>signal.h</code>\u5934\u6587\u4ef6\u4e2d\uff0c\u4fe1\u53f7\u540d\u90fd\u5b9a\u4e49\u4e3a\u6b63\u6574\u6570\u3002 \u5177\u4f53\u7684\u4fe1\u53f7\u540d\u79f0\u53ef\u4ee5\u4f7f\u7528<code>kill -l</code>\u6765\u67e5\u770b\u4fe1\u53f7\u7684\u540d\u5b57\u4ee5\u53ca\u5e8f\u53f7\uff0c\u4fe1\u53f7\u662f\u4ece1\u5f00\u59cb\u7f16\u53f7\u7684\uff0c\u4e0d\u5b58\u57280\u53f7\u4fe1\u53f7\u3002kill\u5bf9\u4e8e\u4fe1\u53f70\u53c8\u7279\u6b8a\u7684\u5e94\u7528\u3002</p> <pre><code>root@1204nStrive:~# kill -l\n 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP\n 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1\n11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM\n16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP\n21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ\n26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR\n31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3\n38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8\n43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13\n48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12\n53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7\n58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2\n63) SIGRTMAX-1  64) SIGRTMAX\n</code></pre>"},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#212","title":"2.1.2 \u4fe1\u53f7\u5904\u7406","text":"<p>\u4fe1\u53f7\u7684\u5904\u7406\u6709\u4e09\u79cd\u65b9\u6cd5\uff0c\u5206\u522b\u662f\uff1a\u5ffd\u7565\u3001\u6355\u6349\u548c\u9ed8\u8ba4\u52a8\u4f5c</p> <ul> <li>\u5ffd\u7565\u4fe1\u53f7\uff0c\u5927\u591a\u6570\u4fe1\u53f7\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u65b9\u5f0f\u6765\u5904\u7406\uff0c\u4f46\u662f\u6709\u4e24\u79cd\u4fe1\u53f7\u4e0d\u80fd\u88ab\u5ffd\u7565\uff08\u5206\u522b\u662f <code>SIGKILL</code>\u548c<code>SIGSTOP</code>\uff09\u3002\u56e0\u4e3a\u4ed6\u4eec\u5411\u5185\u6838\u548c\u8d85\u7ea7\u7528\u6237\u63d0\u4f9b\u4e86\u8fdb\u7a0b\u7ec8\u6b62\u548c\u505c\u6b62\u7684\u53ef\u9760\u65b9\u6cd5\uff0c\u5982\u679c\u5ffd\u7565\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8fdb\u7a0b\u5c31\u53d8\u6210\u4e86\u6ca1\u4eba\u80fd\u7ba1\u7406\u7684\u7684\u8fdb\u7a0b\uff0c\u663e\u7136\u662f\u5185\u6838\u8bbe\u8ba1\u8005\u4e0d\u5e0c\u671b\u770b\u5230\u7684\u573a\u666f</li> <li>\u6355\u6349\u4fe1\u53f7\uff0c\u9700\u8981\u544a\u8bc9\u5185\u6838\uff0c\u7528\u6237\u5e0c\u671b\u5982\u4f55\u5904\u7406\u67d0\u4e00\u79cd\u4fe1\u53f7\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u5199\u4e00\u4e2a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u51fd\u6570\u544a\u8bc9\u5185\u6838\u3002\u5f53\u8be5\u4fe1\u53f7\u4ea7\u751f\u65f6\uff0c\u7531\u5185\u6838\u6765\u8c03\u7528\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u4ee5\u6b64\u6765\u5b9e\u73b0\u67d0\u79cd\u4fe1\u53f7\u7684\u5904\u7406\u3002</li> <li>\u7cfb\u7edf\u9ed8\u8ba4\u52a8\u4f5c\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u4fe1\u53f7\u6765\u8bf4\uff0c\u7cfb\u7edf\u90fd\u5bf9\u5e94\u7531\u9ed8\u8ba4\u7684\u5904\u7406\u52a8\u4f5c\uff0c\u5f53\u53d1\u751f\u4e86\u8be5\u4fe1\u53f7\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u6267\u884c\u3002\u4e0d\u8fc7\uff0c\u5bf9\u7cfb\u7edf\u6765\u8bf4\uff0c\u5927\u90e8\u5206\u7684\u5904\u7406\u65b9\u5f0f\u90fd\u6bd4\u8f83\u7c97\u66b4\uff0c\u5c31\u662f\u76f4\u63a5\u6740\u6b7b\u8be5\u8fdb\u7a0b\u3002    \u5177\u4f53\u7684\u4fe1\u53f7\u9ed8\u8ba4\u52a8\u4f5c\u53ef\u4ee5\u4f7f\u7528<code>man 7 signal</code>\u6765\u67e5\u770b\u7cfb\u7edf\u7684\u5177\u4f53\u5b9a\u4e49\u3002\u5728\u6b64\uff0c\u6211\u5c31\u4e0d\u8be6\u7ec6\u5c55\u5f00\u4e86\uff0c\u9700\u8981\u67e5\u770b\u7684\uff0c\u53ef\u4ee5\u81ea\u884c\u67e5\u770b\u3002\u4e5f\u53ef\u4ee5\u53c2\u8003 \u300aUNIX \u73af\u5883\u9ad8\u7ea7\u7f16\u7a0b\uff08\u7b2c\u4e09\u90e8\uff09\u300b\u7684 P251\u2014\u2014P256\u4e2d\u95f4\u5bf9\u4e8e\u6bcf\u4e2a\u4fe1\u53f7\u6709\u8be6\u7ec6\u7684\u8bf4\u660e\u3002</li> </ul>"},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#22","title":"2.2 \u4f18\u96c5\u5173\u673a","text":""},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#221","title":"2.2.1 \u4ec0\u4e48\u662f\u4f18\u96c5\u5173\u673a","text":"<p>\u4f18\u96c5\u5173\u673a\u5c31\u662f\u670d\u52a1\u7aef\u5173\u673a\u547d\u4ee4\u53d1\u51fa\u540e\u4e0d\u662f\u7acb\u5373\u5173\u673a\uff0c\u800c\u662f\u7b49\u5f85\u5f53\u524d\u8fd8\u5728\u5904\u7406\u7684\u8bf7\u6c42\u5168\u90e8\u5904\u7406\u5b8c\u6bd5\u540e\u518d\u9000\u51fa\u7a0b\u5e8f\uff0c\u662f\u4e00\u79cd\u5bf9\u5ba2\u6237\u7aef\u53cb\u597d\u7684\u5173\u673a\u65b9\u5f0f\u3002\u800c\u6267\u884c<code>Ctrl+C</code>\u5173\u95ed\u670d\u52a1\u7aef\u65f6\uff0c\u4f1a\u5f3a\u5236\u7ed3\u675f\u8fdb\u7a0b\u5bfc\u81f4\u6b63\u5728\u8bbf\u95ee\u7684\u8bf7\u6c42\u51fa\u73b0\u95ee\u9898\u3002</p>"},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#222","title":"2.2.2 \u5b9e\u73b0\u4f18\u96c5\u5173\u673a","text":"<p>Go 1.8\u7248\u672c\u4e4b\u540e\uff0chttp.Server \u5185\u7f6e\u7684Shutdown() \u65b9\u6cd5\u652f\u6301\u4f18\u96c5\u5173\u673a\uff0c\u5982\u4e0b</p>"},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#_3","title":"\u4e09 \u5b9e\u6218","text":""},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#31-httpserver-shutdown","title":"3.1 http.Server \u5185\u7f6eShutdown()\u65b9\u6cd5","text":"<pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"time\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\n// @title Docker\u76d1\u63a7\u670d\u52a1\n// @version 1.0\n// @description gin shutdown\n\n// @contact.name API Support\n// @contact.url http://www.swagger.io/support\n\n// @license.name Apache 2.0\n// @license.url http://www.apache.org/licenses/LICENSE-2.0.html\n\n// @host 127.0.0.1:9009\n// @BasePath\nfunc main() {\n    r := gin.Default()\n    r.GET(\"/\", func(c *gin.Context) {\n        time.Sleep(5 * time.Second)\n        c.String(http.StatusOK, \"gin %s\", \"ok\")\n    })\n    r.GET(\"/swagger/*any\", ginSwagger.WrapHandler(swaggerFiles.Handler))\n\n    server := http.Server{\n        Addr:    \":8080\",\n        Handler: r,\n    }\n\n    go func() {\n        if err := server.ListenAndServe(); err != nil &amp;&amp; err != http.ErrServerClosed {\n            log.Fatal(\"server listen err:%s\", err)\n        }\n    }()\n\n    quit := make(chan os.Signal, 1)\n    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)\n\n    // \u5728\u6b64\u963b\u585e\n    &lt;-quit\n\n    ctx, channel := context.WithTimeout(context.Background(), 5*time.Second)\n\n    defer channel()\n    if err := server.Shutdown(ctx); err != nil {\n        log.Fatal(\"server shutdown error\")\n    }\n    log.Println(\"server exiting...\")\n}\n</code></pre> <p>\u5982\u4f55\u9a8c\u8bc1\u4f18\u96c5\u5173\u673a\u7684\u6548\u679c\u5462\uff1f</p> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u8fd0\u884c\u540e\u4f1a\u5728\u672c\u5730\u7684<code>8080</code>\u7aef\u53e3\u5f00\u542f\u4e00\u4e2aweb\u670d\u52a1\uff0c\u5b83\u53ea\u6ce8\u518c\u4e86\u4e00\u6761\u8def\u7531<code>/</code>\uff0c\u540e\u7aef\u670d\u52a1\u4f1a\u5148sleep 5\u79d2\u949f\u7136\u540e\u624d\u8fd4\u56de\u54cd\u5e94\u4fe1\u606f\u3002</p> <p>\u6211\u4eec\u6309\u4e0b<code>Ctrl+C</code>\u65f6\u4f1a\u53d1\u9001<code>syscall.SIGINT</code>\u6765\u901a\u77e5\u7a0b\u5e8f\u4f18\u96c5\u5173\u673a\uff0c\u5177\u4f53\u505a\u6cd5\u5982\u4e0b\uff1a</p> <ol> <li>\u6253\u5f00\u7ec8\u7aef\uff0c\u7f16\u8bd1\u5e76\u6267\u884c\u4e0a\u9762\u7684\u4ee3\u7801</li> <li>\u6253\u5f00\u4e00\u4e2a\u6d4f\u89c8\u5668\uff0c\u8bbf\u95ee<code>127.0.0.1:8080/</code>\uff0c\u6b64\u65f6\u6d4f\u89c8\u5668\u767d\u5c4f\u7b49\u5f85\u670d\u52a1\u7aef\u8fd4\u56de\u54cd\u5e94\u3002</li> <li>\u5728\u7ec8\u7aef**\u8fc5\u901f**\u6267\u884c<code>Ctrl+C</code>\u547d\u4ee4\u7ed9\u7a0b\u5e8f\u53d1\u9001<code>syscall.SIGINT</code>\u4fe1\u53f7</li> <li>\u6b64\u65f6\u7a0b\u5e8f\u5e76\u4e0d\u7acb\u5373\u9000\u51fa\u800c\u662f\u7b49\u6211\u4eec\u7b2c2\u6b65\u7684\u54cd\u5e94\u8fd4\u56de\u4e4b\u540e\u518d\u9000\u51fa\uff0c\u4ece\u800c\u5b9e\u73b0\u4f18\u96c5\u5173\u673a\u3002</li> </ol>"},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#32","title":"3.2 \u4f18\u96c5\u91cd\u542f","text":"<p>\u4f18\u96c5\u5173\u673a\u5b9e\u73b0\u4e86\uff0c\u90a3\u4e48\u8be5\u5982\u4f55\u5b9e\u73b0\u4f18\u96c5\u91cd\u542f\u5462\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 fvbock/endless \u6765\u66ff\u6362\u9ed8\u8ba4\u7684 <code>ListenAndServe</code>\u542f\u52a8\u670d\u52a1\u6765\u5b9e\u73b0\uff0c \u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/fvbock/endless\"\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n    router := gin.Default()\n    router.GET(\"/\", func(c *gin.Context) {\n        time.Sleep(5 * time.Second)\n        c.String(http.StatusOK, \"hello gin!\")\n    })\n    // \u9ed8\u8ba4endless\u670d\u52a1\u5668\u4f1a\u76d1\u542c\u4e0b\u5217\u4fe1\u53f7\uff1a\n    // syscall.SIGHUP\uff0csyscall.SIGUSR1\uff0csyscall.SIGUSR2\uff0csyscall.SIGINT\uff0csyscall.SIGTERM\u548csyscall.SIGTSTP\n    // \u63a5\u6536\u5230 SIGHUP \u4fe1\u53f7\u5c06\u89e6\u53d1`fork/restart` \u5b9e\u73b0\u4f18\u96c5\u91cd\u542f\uff08kill -1 pid\u4f1a\u53d1\u9001SIGHUP\u4fe1\u53f7\uff09\n    // \u63a5\u6536\u5230 syscall.SIGINT\u6216syscall.SIGTERM \u4fe1\u53f7\u5c06\u89e6\u53d1\u4f18\u96c5\u5173\u673a\n    // \u63a5\u6536\u5230 SIGUSR2 \u4fe1\u53f7\u5c06\u89e6\u53d1HammerTime\n    // SIGUSR1 \u548c SIGTSTP \u88ab\u7528\u6765\u89e6\u53d1\u4e00\u4e9b\u7528\u6237\u81ea\u5b9a\u4e49\u7684hook\u51fd\u6570\n    if err := endless.ListenAndServe(\":8080\", router); err!=nil{\n        log.Fatalf(\"listen: %s\\n\", err)\n    }\n\n    log.Println(\"Server exiting\")\n}\n</code></pre> <p>\u5982\u4f55\u9a8c\u8bc1\u4f18\u96c5\u91cd\u542f\u7684\u6548\u679c\u5462\uff1f</p> <p>\u6211\u4eec\u901a\u8fc7\u6267\u884c<code>kill -1 pid</code>\u547d\u4ee4\u53d1\u9001<code>syscall.SIGINT</code>\u6765\u901a\u77e5\u7a0b\u5e8f\u4f18\u96c5\u91cd\u542f\uff0c\u5177\u4f53\u505a\u6cd5\u5982\u4e0b\uff1a</p> <ol> <li>\u6253\u5f00\u7ec8\u7aef\uff0c<code>go build -o graceful_restart</code>\u7f16\u8bd1\u5e76\u6267\u884c<code>./graceful_restart</code>,\u7ec8\u7aef\u8f93\u51fa\u5f53\u524dpid(\u5047\u8bbe\u4e3a43682)</li> <li>\u5c06\u4ee3\u7801\u4e2d\u5904\u7406\u8bf7\u6c42\u51fd\u6570\u8fd4\u56de\u7684<code>hello gin!</code>\u4fee\u6539\u4e3a<code>hello q1mi!</code>\uff0c\u518d\u6b21\u7f16\u8bd1<code>go build -o graceful_restart</code></li> <li>\u6253\u5f00\u4e00\u4e2a\u6d4f\u89c8\u5668\uff0c\u8bbf\u95ee<code>127.0.0.1:8080/</code>\uff0c\u6b64\u65f6\u6d4f\u89c8\u5668\u767d\u5c4f\u7b49\u5f85\u670d\u52a1\u7aef\u8fd4\u56de\u54cd\u5e94\u3002</li> <li>\u5728\u7ec8\u7aef**\u8fc5\u901f**\u6267\u884c<code>kill -1 43682</code>\u547d\u4ee4\u7ed9\u7a0b\u5e8f\u53d1\u9001<code>syscall.SIGHUP</code>\u4fe1\u53f7</li> <li>\u7b49\u7b2c3\u6b65\u6d4f\u89c8\u5668\u6536\u5230\u54cd\u5e94\u4fe1\u606f<code>hello gin!</code>\u540e\u518d\u6b21\u8bbf\u95ee<code>127.0.0.1:8080/</code>\u4f1a\u6536\u5230<code>hello q1mi!</code>\u7684\u54cd\u5e94\u3002</li> <li>\u5728\u4e0d\u5f71\u54cd\u5f53\u524d\u672a\u5904\u7406\u5b8c\u8bf7\u6c42\u7684\u540c\u65f6\u5b8c\u6210\u4e86\u7a0b\u5e8f\u4ee3\u7801\u7684\u66ff\u6362\uff0c\u5b9e\u73b0\u4e86\u4f18\u96c5\u91cd\u542f\u3002</li> </ol> <p>\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6b64\u65f6\u7a0b\u5e8f\u7684PID\u53d8\u5316\u4e86\uff0c\u56e0\u4e3a<code>endless</code> \u662f\u901a\u8fc7<code>fork</code>\u5b50\u8fdb\u7a0b\u5904\u7406\u65b0\u8bf7\u6c42\uff0c\u5f85\u539f\u8fdb\u7a0b\u5904\u7406\u5b8c\u5f53\u524d\u8bf7\u6c42\u540e\u518d\u9000\u51fa\u7684\u65b9\u5f0f\u5b9e\u73b0\u4f18\u96c5\u91cd\u542f\u7684\u3002\u6240\u4ee5\u5f53\u4f60\u7684\u9879\u76ee\u662f\u4f7f\u7528\u7c7b\u4f3c<code>supervisor</code>\u7684\u8f6f\u4ef6\u7ba1\u7406\u8fdb\u7a0b\u65f6\u5c31**\u4e0d\u9002\u7528**\u8fd9\u79cd\u65b9\u5f0f\u4e86\u3002</p>"},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#_4","title":"\u6ce8\u610f\u70b9","text":"<ol> <li>\u5f00\u542fgo\u534f\u7a0b\uff0c\u9700\u8981\u9519\u8bef\u4e0d\u7b49\u4e8ehttp.ErrServerClosed </li> </ol> <pre><code>if err := rsv.ListenAndServe(); err != nil &amp;&amp; err != http.ErrServerClosed {\n</code></pre> <ol> <li>\u5b9a\u4e49\u4fe1\u53f7\uff0c\u963b\u585e</li> </ol> <pre><code>    // kill \u9ed8\u8ba4\u4f1a\u53d1\u9001 syscall.SIGTERM \u4fe1\u53f7\n    // kill -2 \u53d1\u9001 syscall.SIGINT \u4fe1\u53f7\uff0c\u6211\u4eec\u5e38\u7528\u7684Ctrl+C\u5c31\u662f\u89e6\u53d1\u7cfb\u7edfSIGINT\u4fe1\u53f7\n    // kill -9 \u53d1\u9001 syscall.SIGKILL \u4fe1\u53f7\uff0c\u4f46\u662f\u4e0d\u80fd\u88ab\u6355\u83b7\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u6dfb\u52a0\u5b83\n    // signal.Notify\u628a\u6536\u5230\u7684 syscall.SIGINT\u6216syscall.SIGTERM \u4fe1\u53f7\u8f6c\u53d1\u7ed9quit\n    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)  // \u6b64\u5904\u4e0d\u4f1a\u963b\u585e\n    &lt;-quit  // \u963b\u585e\u5728\u6b64\uff0c\u5f53\u63a5\u6536\u5230\u4e0a\u8ff0\u4e24\u79cd\u4fe1\u53f7\u65f6\u624d\u4f1a\u5f80\u4e0b\u6267\u884c\n    log.Println(\"Shutdown Server ...\")\n</code></pre>"},{"location":"develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/#_5","title":"\u603b\u7ed3","text":"<p>\u65e0\u8bba\u662f\u4f18\u96c5\u5173\u673a\u8fd8\u662f\u4f18\u96c5\u91cd\u542f\u5f52\u6839\u7ed3\u5e95\u90fd\u662f\u901a\u8fc7\u76d1\u542c\u7279\u5b9a\u7cfb\u7edf\u4fe1\u53f7\uff0c\u7136\u540e\u6267\u884c\u4e00\u5b9a\u7684\u903b\u8f91\u5904\u7406\u4fdd\u969c\u5f53\u524d\u7cfb\u7edf\u6b63\u5728\u5904\u7406\u7684\u8bf7\u6c42\u88ab\u6b63\u5e38\u5904\u7406\u540e\u518d\u5173\u95ed\u5f53\u524d\u8fdb\u7a0b\u3002\u4f7f\u7528\u4f18\u96c5\u5173\u673a\u8fd8\u662f\u4f7f\u7528\u4f18\u96c5\u91cd\u542f\u4ee5\u53ca\u600e\u4e48\u5b9e\u73b0\uff0c\u8fd9\u5c31\u9700\u8981\u6839\u636e\u9879\u76ee\u5b9e\u9645\u60c5\u51b5\u6765\u51b3\u5b9a\u4e86\u3002</p>"},{"location":"develop/other/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/","title":"Git\u5e38\u7528\u64cd\u4f5c","text":""},{"location":"develop/other/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/#git","title":"git\u5e38\u7528\u64cd\u4f5c","text":""},{"location":"develop/other/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/#_1","title":"\u4e00 \u57fa\u672c\u6982\u5ff5","text":"<ul> <li>**\u5de5\u4f5c\u533a\uff1a**\u5c31\u662f\u4f60\u5728\u7535\u8111\u91cc\u80fd\u770b\u5230\u7684\u76ee\u5f55\u3002</li> <li>\u6682\u5b58\u533a\uff1a**\u82f1\u6587\u53eb stage \u6216 index\u3002\u4e00\u822c\u5b58\u653e\u5728 **.git \u76ee\u5f55\u4e0b\u7684 index \u6587\u4ef6\uff08.git/index\uff09\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u6682\u5b58\u533a\u6709\u65f6\u4e5f\u53eb\u4f5c\u7d22\u5f15\uff08index\uff09\u3002</li> <li>\u7248\u672c\u5e93\uff1a**\u5de5\u4f5c\u533a\u6709\u4e00\u4e2a\u9690\u85cf\u76ee\u5f55 **.git\uff0c\u8fd9\u4e2a\u4e0d\u7b97\u5de5\u4f5c\u533a\uff0c\u800c\u662f Git \u7684\u7248\u672c\u5e93\u3002</li> </ul>"},{"location":"develop/other/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/#_2","title":"\u4e8c \u57fa\u672c\u64cd\u4f5c","text":"<ul> <li>workspace\uff1a\u5de5\u4f5c\u533a</li> <li>staging area\uff1a\u6682\u5b58\u533a/\u7f13\u5b58\u533a</li> <li>local repository\uff1a\u7248\u672c\u5e93\u6216\u672c\u5730\u4ed3\u5e93</li> <li>remote repository\uff1a\u8fdc\u7a0b\u4ed3\u5e93</li> </ul> <p>1.\u5df2\u63d0\u4ea4\uff0c\u4f46\u6ca1push</p> <ul> <li>git reset \u2014soft \"\u64a4\u9500\u81f3\u4e0a\u4e00\u6b21\u7684id\" \uff1a \u64a4\u9500commit\uff0c\u4f46\u662f\u6587\u4ef6\u8fd8\u662fadd\u7684\u72b6\u6001</li> <li>git reset \u2014mixed \"\u64a4\u9500\u5230\u4e0a\u4e00\u6b21\u7684id\"\uff1a\u64a4\u9500commit\u548cadd\u4e24\u4e2a\u52a8\u4f5c</li> </ul> <p>2.\u4ee5\u63d0\u4ea4\uff0c\u5e76push</p> <ul> <li>git reset \u2014hard \"\u64a4\u9500\u5230\u4e0a\u4e00\u6b21\u7684id\"\uff1a\u64a4\u9500\u5e76\u820d\u5f03\u7248\u672c\u53f7\u4e4b\u540e\u7684\u63d0\u4ea4\u8bb0\u5f55\uff0c\u4f7f\u7528\u9700\u8c28\u614e\uff0c\u4fee\u6539\u662f\u5728\u672c\u5730\uff0c\u9700\u8981\u63a8\u9001\u5230\u8fdc\u7a0bpush -f\uff0c\u975e\u5e38\u5371\u9669</li> <li>git revert \"\u64a4\u9500\u90a3\u4e2aid\u5c31\u5199\u90a3\u4e2aid\"\uff1a\u64a4\u9500\u3002\u4f46\u662f\u4fdd\u7559\u63d0\u4ea4\u8bb0\u5f55\u3002</li> </ul>"},{"location":"develop/other/git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/#_3","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/LinXueyuanStdio/learnGit#%E9%9C%80%E6%B1%822%E5%8F%82%E4%B8%8Egithub%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BA%A4pull-request--back-to-%E7%9B%AE%E5%BD%95</li> </ul>"},{"location":"develop/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%B8%B8%E7%94%A8%E7%BD%91%E7%AB%99/","title":"\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u5e38\u7528\u7f51\u7ad9","text":""},{"location":"develop/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%B8%B8%E7%94%A8%E7%BD%91%E7%AB%99/#_1","title":"\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u5e38\u7528\u7f51\u7ad9","text":""},{"location":"develop/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%B8%B8%E7%94%A8%E7%BD%91%E7%AB%99/#httpsvisualgonet","title":"\u4e00 https://visualgo.net/","text":""},{"location":"develop/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%B8%B8%E7%94%A8%E7%BD%91%E7%AB%99/#httpsalgorithm-visualizerorg","title":"\u4e8c https://algorithm-visualizer.org/","text":"<p>https://github.com/algorithm-visualizer/algorithm-visualizer</p> <p></p>"},{"location":"develop/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%B8%B8%E7%94%A8%E7%BD%91%E7%AB%99/#httpswwwcsusfcaedugallesvisualizationalgorithmshtml","title":"\u4e09 https://www.cs.usfca.edu/~galles/visualization/Algorithms.html","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/golang%20%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/","title":"Golang\u4ee3\u7801\u89c4\u8303","text":"<ul> <li>https://github.com/xxjwxc/uber_go_guide_cn</li> </ul>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6027\u80fd01","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/#golang01","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6027\u80fd01","text":"<p>\u6027\u80fd\u65b9\u9762\u7684\u7279\u5b9a\u51c6\u5219\u53ea\u9002\u7528\u4e8e\u9ad8\u9891\u573a\u666f\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/#strconv-fmt","title":"\u4e00 \u4f18\u5148\u4f7f\u7528 strconv \u800c\u4e0d\u662f fmt","text":"<ul> <li>Bad</li> </ul> <pre><code>for i := 0; i &lt; b.N; i++ {\n  s := fmt.Sprint(rand.Int())\n}\n\n// BenchmarkFmtSprint-4    143 ns/op    2 allocs/op\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>for i := 0; i &lt; b.N; i++ {\n  s := strconv.Itoa(rand.Int())\n}\n\n// BenchmarkStrconv-4    64.2 ns/op    1 allocs/op\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/#_1","title":"\u4e8c \u907f\u514d\u5b57\u7b26\u4e32\u5230\u5b57\u8282\u7684\u8f6c\u6362","text":"<p>\u4e0d\u8981\u53cd\u590d\u4ece\u56fa\u5b9a\u5b57\u7b26\u4e32\u521b\u5efa\u5b57\u8282 slice\u3002\u76f8\u53cd\uff0c\u8bf7\u6267\u884c\u4e00\u6b21\u8f6c\u6362\u5e76\u6355\u83b7\u7ed3\u679c\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>for i := 0; i &lt; b.N; i++ {\n  w.Write([]byte(\"Hello world\"))\n}\n\n// BenchmarkBad-4   50000000   22.2 ns/op\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>data := []byte(\"Hello world\")\nfor i := 0; i &lt; b.N; i++ {\n  w.Write(data)\n}\n\n// BenchmarkGood-4  500000000   3.25 ns/op\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/#_2","title":"\u4e09 \u6307\u5b9a\u5bb9\u5668\u5bb9\u91cf","text":"<p>\u5c3d\u53ef\u80fd\u6307\u5b9a\u5bb9\u5668\u5bb9\u91cf\uff0c\u4ee5\u4fbf\u4e3a\u5bb9\u5668\u9884\u5148\u5206\u914d\u5185\u5b58\u3002\u8fd9\u5c06\u5728\u6dfb\u52a0\u5143\u7d20\u65f6\u6700\u5c0f\u5316\u540e\u7eed\u5206\u914d\uff08\u901a\u8fc7\u590d\u5236\u548c\u8c03\u6574\u5bb9\u5668\u5927\u5c0f\uff09\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/#31-map","title":"3.1 \u6307\u5b9a Map \u5bb9\u91cf\u63d0\u793a","text":"<p>\u5728\u5c3d\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u4f7f\u7528 <code>make()</code> \u521d\u59cb\u5316\u7684\u65f6\u5019\u63d0\u4f9b\u5bb9\u91cf\u4fe1\u606f</p> <pre><code>make(map[T1]T2, hint)\n</code></pre> <p>\u5411<code>make()</code>\u63d0\u4f9b\u5bb9\u91cf\u63d0\u793a\u4f1a\u5728\u521d\u59cb\u5316\u65f6\u5c1d\u8bd5\u8c03\u6574 map \u7684\u5927\u5c0f\uff0c\u8fd9\u5c06\u51cf\u5c11\u5728\u5c06\u5143\u7d20\u6dfb\u52a0\u5230 map \u65f6\u4e3a map \u91cd\u65b0\u5206\u914d\u5185\u5b58\u3002</p> <p>\u6ce8\u610f\uff0c\u4e0e slices \u4e0d\u540c\u3002map capacity \u63d0\u793a\u5e76\u4e0d\u4fdd\u8bc1\u5b8c\u5168\u7684\u62a2\u5360\u5f0f\u5206\u914d\uff0c\u800c\u662f\u7528\u4e8e\u4f30\u8ba1\u6240\u9700\u7684 hashmap bucket \u7684\u6570\u91cf\u3002 \u56e0\u6b64\uff0c\u5728\u5c06\u5143\u7d20\u6dfb\u52a0\u5230 map \u65f6\uff0c\u751a\u81f3\u5728\u6307\u5b9a map \u5bb9\u91cf\u65f6\uff0c\u4ecd\u53ef\u80fd\u53d1\u751f\u5206\u914d\u3002</p> <ul> <li>Bad</li> </ul> <p><code>m</code> \u662f\u5728\u6ca1\u6709\u5927\u5c0f\u63d0\u793a\u7684\u60c5\u51b5\u4e0b\u521b\u5efa\u7684\uff1b \u5728\u8fd0\u884c\u65f6\u53ef\u80fd\u4f1a\u6709\u66f4\u591a\u5206\u914d\u3002</p> <pre><code>m := make(map[string]os.FileInfo)\n\nfiles, _ := ioutil.ReadDir(\"./files\")\nfor _, f := range files {\n    m[f.Name()] = f\n}\n// \n</code></pre> <ul> <li>Good</li> </ul> <p><code>m</code> \u662f\u6709\u5927\u5c0f\u63d0\u793a\u521b\u5efa\u7684\uff1b\u5728\u8fd0\u884c\u65f6\u53ef\u80fd\u4f1a\u6709\u66f4\u5c11\u7684\u5206\u914d\u3002</p> <pre><code>files, _ := ioutil.ReadDir(\"./files\")\n\nm := make(map[string]os.FileInfo, len(files))\nfor _, f := range files {\n    m[f.Name()] = f\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/#32","title":"3.2 \u6307\u5b9a\u5207\u7247\u5bb9\u91cf","text":"<p>\u5728\u5c3d\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u4f7f\u7528<code>make()</code>\u521d\u59cb\u5316\u5207\u7247\u65f6\u63d0\u4f9b\u5bb9\u91cf\u4fe1\u606f\uff0c\u7279\u522b\u662f\u5728\u8ffd\u52a0\u5207\u7247\u65f6\u3002</p> <pre><code>make([]T, length, capacity)\n</code></pre> <p>\u4e0e maps \u4e0d\u540c\uff0cslice capacity \u4e0d\u662f\u4e00\u4e2a\u63d0\u793a\uff1a\u7f16\u8bd1\u5668\u5c06\u4e3a\u63d0\u4f9b\u7ed9<code>make()</code>\u7684 slice \u7684\u5bb9\u91cf\u5206\u914d\u8db3\u591f\u7684\u5185\u5b58\uff0c \u8fd9\u610f\u5473\u7740\u540e\u7eed\u7684 append()`\u64cd\u4f5c\u5c06\u5bfc\u81f4\u96f6\u5206\u914d\uff08\u76f4\u5230 slice \u7684\u957f\u5ea6\u4e0e\u5bb9\u91cf\u5339\u914d\uff0c\u5728\u6b64\u4e4b\u540e\uff0c\u4efb\u4f55 append \u90fd\u53ef\u80fd\u8c03\u6574\u5927\u5c0f\u4ee5\u5bb9\u7eb3\u5176\u4ed6\u5143\u7d20\uff09\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>for n := 0; n &lt; b.N; n++ {\n  data := make([]int, 0)\n  for k := 0; k &lt; size; k++{\n    data = append(data, k)\n  }\n}\n\n// BenchmarkBad-4    100000000    2.48s\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>for n := 0; n &lt; b.N; n++ {\n  data := make([]int, 0, size)\n  for k := 0; k &lt; size; k++{\n    data = append(data, k)\n  }\n}\n\n// BenchmarkGood-4   100000000    0.21s\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9901/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521901","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9901/#golang01","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521901","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9901/#interface","title":"\u4e00 \u6307\u5411interface\u7684\u6307\u9488","text":"<p>\u5728Golang\u4e2d\u63a5\u53e3\u5b9e\u8d28\u4e0a\u5728\u5e95\u5c42\u7528\u4e24\u4e2a\u5b57\u6bb5\u8868\u793a\uff1a</p> <ol> <li>\u4e00\u4e2a\u6307\u5411\u67d0\u4e9b\u7279\u5b9a\u7c7b\u578b\u4fe1\u606f\u7684\u6307\u9488\u3002\u60a8\u53ef\u4ee5\u5c06\u5176\u89c6\u4e3a\"type\"\u3002</li> <li>\u6570\u636e\u6307\u9488\u3002\u5982\u679c\u5b58\u50a8\u7684\u6570\u636e\u662f\u6307\u9488\uff0c\u5219\u76f4\u63a5\u5b58\u50a8\u3002\u5982\u679c\u5b58\u50a8\u7684\u6570\u636e\u662f\u4e00\u4e2a\u503c\uff0c\u5219\u5b58\u50a8\u6307\u5411\u8be5\u503c\u7684\u6307\u9488\u3002</li> </ol> <p>\u60a8\u51e0\u4e4e\u4e0d\u9700\u8981\u6307\u5411\u63a5\u53e3\u7c7b\u578b\u7684\u6307\u9488\u3002\u60a8\u5e94\u8be5\u5c06\u63a5\u53e3\u4f5c\u4e3a\u503c\u8fdb\u884c\u4f20\u9012\uff0c\u5728\u8fd9\u6837\u7684\u4f20\u9012\u8fc7\u7a0b\u4e2d\uff0c\u5b9e\u8d28\u4e0a\u4f20\u9012\u7684\u5e95\u5c42\u6570\u636e\u4ecd\u7136\u53ef\u4ee5\u662f\u6307\u9488\u3002</p> <p>\u5982\u679c\u5e0c\u671b\u63a5\u53e3\u65b9\u6cd5\u4fee\u6539\u57fa\u7840\u6570\u636e\uff0c\u5219\u5fc5\u987b\u4f7f\u7528\u6307\u9488\u4f20\u9012 (\u5c06\u5bf9\u8c61\u6307\u9488\u8d4b\u503c\u7ed9\u63a5\u53e3\u53d8\u91cf)\u3002</p> <pre><code>type interfaceFunc interface {\n  f()\n}\n\ntype S1 struct{}\n\nfunc (s S1) f() {}\n\ntype S2 struct{}\n\nfunc (s *S2) f() {}\n\n// f1.f() \u65e0\u6cd5\u4fee\u6539\u5e95\u5c42\u6570\u636e\n// f2.f() \u53ef\u4ee5\u4fee\u6539\u5e95\u5c42\u6570\u636e\uff0c\u7ed9\u63a5\u53e3\u53d8\u91cf f2 \u8d4b\u503c\u65f6\u4f7f\u7528\u7684\u662f\u5bf9\u8c61\u6307\u9488\nvar f1 F = S1{}\nvar f2 F = &amp;S2{}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9901/#interface_1","title":"\u4e8c Interface\u7684\u5408\u7406\u6027\u9a8c\u8bc1","text":"<p>\u5728\u7f16\u8bd1\u65f6\u9a8c\u8bc1\u63a5\u53e3\u7684\u7b26\u5408\u6027\u3002\u8fd9\u5305\u62ec\uff1a</p> <ul> <li>\u5c06\u5b9e\u73b0\u7279\u5b9a\u63a5\u53e3\u7684\u5bfc\u51fa\u7c7b\u578b\u4f5c\u4e3a\u63a5\u53e3 API \u7684\u4e00\u90e8\u5206\u8fdb\u884c\u68c0\u67e5</li> <li>\u5b9e\u73b0\u540c\u4e00\u63a5\u53e3\u7684 (\u5bfc\u51fa\u548c\u975e\u5bfc\u51fa) \u7c7b\u578b\u5c5e\u4e8e\u5b9e\u73b0\u7c7b\u578b\u7684\u96c6\u5408</li> <li>\u4efb\u4f55\u8fdd\u53cd\u63a5\u53e3\u5408\u7406\u6027\u68c0\u67e5\u7684\u573a\u666f\uff0c\u90fd\u4f1a\u7ec8\u6b62\u7f16\u8bd1\uff0c\u5e76\u901a\u77e5\u7ed9\u7528\u6237</li> </ul> <p>\u8865\u5145\uff1a\u4e0a\u9762 3 \u6761\u662f\u7f16\u8bd1\u5668\u5bf9\u63a5\u53e3\u7684\u68c0\u67e5\u673a\u5236\uff0c \u5927\u4f53\u610f\u601d\u662f\u9519\u8bef\u4f7f\u7528\u63a5\u53e3\u4f1a\u5728\u7f16\u8bd1\u671f\u62a5\u9519\u3002 \u6240\u4ee5\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u673a\u5236\u8ba9\u90e8\u5206\u95ee\u9898\u5728\u7f16\u8bd1\u671f\u66b4\u9732\u3002</p> Bad Good <code>// \u5982\u679c Handler \u6ca1\u6709\u5b9e\u73b0 http.Handler\uff0c\u4f1a\u5728\u8fd0\u884c\u65f6\u62a5\u9519 type Handler struct {   // ... } func (h *Handler) ServeHTTP(   w http.ResponseWriter,   r *http.Request, ) {   ... }</code> <code>type Handler struct {   // ... } // \u7528\u4e8e\u89e6\u53d1\u7f16\u8bd1\u671f\u7684\u63a5\u53e3\u7684\u5408\u7406\u6027\u68c0\u67e5\u673a\u5236 // \u5982\u679c Handler \u6ca1\u6709\u5b9e\u73b0 http.Handler\uff0c\u4f1a\u5728\u7f16\u8bd1\u671f\u62a5\u9519 var _ http.Handler = (*Handler)(nil) func (h *Handler) ServeHTTP(   w http.ResponseWriter,   r *http.Request, ) {   // ... }</code> <p>\u5982\u679c <code>*Handler</code> \u4e0e <code>http.Handler</code> \u7684\u63a5\u53e3\u4e0d\u5339\u914d\uff0c \u90a3\u4e48\u8bed\u53e5 <code>var _ http.Handler = (*Handler)(nil)</code> \u5c06\u65e0\u6cd5\u7f16\u8bd1\u901a\u8fc7\u3002</p> <p>\u8d4b\u503c\u7684\u53f3\u8fb9\u5e94\u8be5\u662f\u65ad\u8a00\u7c7b\u578b\u7684\u96f6\u503c\u3002 \u5bf9\u4e8e\u6307\u9488\u7c7b\u578b\uff08\u5982 <code>*Handler</code>\uff09\u3001\u5207\u7247\u548c\u6620\u5c04\uff0c\u8fd9\u662f <code>nil</code>\uff1b \u5bf9\u4e8e\u7ed3\u6784\u7c7b\u578b\uff0c\u8fd9\u662f\u7a7a\u7ed3\u6784\u3002</p> <pre><code>type LogHandler struct {\n  h   http.Handler\n  log *zap.Logger\n}\nvar _ http.Handler = LogHandler{}\nfunc (h LogHandler) ServeHTTP(\n  w http.ResponseWriter,\n  r *http.Request,\n) {\n  // ...\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9901/#_1","title":"\u4e09 \u63a5\u6536\u5668\u4e0e\u63a5\u53e3","text":"<p>\u4f7f\u7528\u503c\u63a5\u6536\u5668\u7684\u65b9\u6cd5\u65e2\u53ef\u4ee5\u901a\u8fc7\u503c\u8c03\u7528\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6307\u9488\u8c03\u7528\u3002</p> <p>\u5e26\u6307\u9488\u63a5\u6536\u5668\u7684\u65b9\u6cd5\u53ea\u80fd\u901a\u8fc7\u6307\u9488\u6216 addressable values \u8c03\u7528\u3002</p> <pre><code>type S struct {\n  data string\n}\n\nfunc (s S) Read() string {\n  return s.data\n}\n\nfunc (s *S) Write(str string) {\n  s.data = str\n}\n\nsVals := map[int]S{1: {\"A\"}}\n\n// \u4f60\u53ea\u80fd\u901a\u8fc7\u503c\u8c03\u7528 Read\nsVals[1].Read()\n\n// \u8fd9\u4e0d\u80fd\u7f16\u8bd1\u901a\u8fc7\uff1a\n//  sVals[1].Write(\"test\")\n\nsPtrs := map[int]*S{1: {\"A\"}}\n\n// \u901a\u8fc7\u6307\u9488\u65e2\u53ef\u4ee5\u8c03\u7528 Read\uff0c\u4e5f\u53ef\u4ee5\u8c03\u7528 Write \u65b9\u6cd5\nsPtrs[1].Read()\nsPtrs[1].Write(\"test\")\n</code></pre> <p>\u7c7b\u4f3c\u7684\uff0c\u5373\u4f7f\u65b9\u6cd5\u6709\u4e86\u503c\u63a5\u6536\u5668\uff0c\u4e5f\u540c\u6837\u53ef\u4ee5\u7528\u6307\u9488\u63a5\u6536\u5668\u6765\u6ee1\u8db3\u63a5\u53e3\u3002</p> <pre><code>type F interface {\n  f()\n}\n\ntype S1 struct{}\n\nfunc (s S1) f() {}\n\ntype S2 struct{}\n\nfunc (s *S2) f() {}\n\ns1Val := S1{}\ns1Ptr := &amp;S1{}\ns2Val := S2{}\ns2Ptr := &amp;S2{}\n\nvar i F\ni = s1Val\ni = s1Ptr\ni = s2Ptr\n\n//  \u4e0b\u9762\u4ee3\u7801\u65e0\u6cd5\u901a\u8fc7\u7f16\u8bd1\u3002\u56e0\u4e3a s2Val \u662f\u4e00\u4e2a\u503c\uff0c\u800c S2 \u7684 f \u65b9\u6cd5\u4e2d\u6ca1\u6709\u4f7f\u7528\u503c\u63a5\u6536\u5668\n//   i = s2Val\n</code></pre> <p>Effective Go \u4e2d\u6709\u4e00\u6bb5\u5173\u4e8e pointers vs. values \u7684\u7cbe\u5f69\u8bb2\u89e3\u3002</p> <p>\u8865\u5145\uff1a</p> <ul> <li>\u4e00\u4e2a\u7c7b\u578b\u53ef\u4ee5\u6709\u503c\u63a5\u6536\u5668\u65b9\u6cd5\u96c6\u548c\u6307\u9488\u63a5\u6536\u5668\u65b9\u6cd5\u96c6</li> <li>\u503c\u63a5\u6536\u5668\u65b9\u6cd5\u96c6\u662f\u6307\u9488\u63a5\u6536\u5668\u65b9\u6cd5\u96c6\u7684\u5b50\u96c6\uff0c\u53cd\u4e4b\u4e0d\u662f</li> <li>\u89c4\u5219</li> <li>\u503c\u5bf9\u8c61\u53ea\u53ef\u4ee5\u4f7f\u7528\u503c\u63a5\u6536\u5668\u65b9\u6cd5\u96c6</li> <li>\u6307\u9488\u5bf9\u8c61\u53ef\u4ee5\u4f7f\u7528 \u503c\u63a5\u6536\u5668\u65b9\u6cd5\u96c6 + \u6307\u9488\u63a5\u6536\u5668\u65b9\u6cd5\u96c6</li> <li>\u63a5\u53e3\u7684\u5339\u914d (\u6216\u8005\u53eb\u5b9e\u73b0)</li> <li>\u7c7b\u578b\u5b9e\u73b0\u4e86\u63a5\u53e3\u7684\u6240\u6709\u65b9\u6cd5\uff0c\u53eb\u5339\u914d</li> <li>\u5177\u4f53\u7684\u8bb2\uff0c\u8981\u4e48\u662f\u7c7b\u578b\u7684\u503c\u65b9\u6cd5\u96c6\u5339\u914d\u63a5\u53e3\uff0c\u8981\u4e48\u662f\u6307\u9488\u65b9\u6cd5\u96c6\u5339\u914d\u63a5\u53e3</li> </ul> <p>\u5177\u4f53\u7684\u5339\u914d\u5206\u4e24\u79cd\uff1a</p> <ul> <li>\u503c\u65b9\u6cd5\u96c6\u548c\u63a5\u53e3\u5339\u914d</li> <li>\u7ed9\u63a5\u53e3\u53d8\u91cf\u8d4b\u503c\u7684\u4e0d\u7ba1\u662f\u503c\u8fd8\u662f\u6307\u9488\u5bf9\u8c61\uff0c\u90fd ok\uff0c\u56e0\u4e3a\u90fd\u5305\u542b\u503c\u65b9\u6cd5\u96c6</li> <li>\u6307\u9488\u65b9\u6cd5\u96c6\u548c\u63a5\u53e3\u5339\u914d</li> <li>\u53ea\u80fd\u5c06\u6307\u9488\u5bf9\u8c61\u8d4b\u503c\u7ed9\u63a5\u53e3\u53d8\u91cf\uff0c\u56e0\u4e3a\u53ea\u6709\u6307\u9488\u65b9\u6cd5\u96c6\u548c\u63a5\u53e3\u5339\u914d</li> <li>\u5982\u679c\u5c06\u503c\u5bf9\u8c61\u8d4b\u503c\u7ed9\u63a5\u53e3\u53d8\u91cf\uff0c\u4f1a\u5728\u7f16\u8bd1\u671f\u62a5\u9519 (\u4f1a\u89e6\u53d1\u63a5\u53e3\u5408\u7406\u6027\u68c0\u67e5\u673a\u5236)</li> </ul> <p>\u4e3a\u5565 i = s2Val \u4f1a\u62a5\u9519\uff0c\u56e0\u4e3a\u503c\u65b9\u6cd5\u96c6\u548c\u63a5\u53e3\u4e0d\u5339\u914d\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9901/#mutex","title":"\u56db \u96f6\u503c Mutex \u662f\u6709\u6548\u7684","text":"<p>\u96f6\u503c <code>sync.Mutex</code> \u548c <code>sync.RWMutex</code> \u662f\u6709\u6548\u7684\u3002\u6240\u4ee5\u6307\u5411 mutex \u7684\u6307\u9488\u57fa\u672c\u662f\u4e0d\u5fc5\u8981\u7684\u3002</p> Bad Good <code>mu := new(sync.Mutex) mu.Lock()</code> <code>var mu sync.Mutex mu.Lock()</code> <p>\u5982\u679c\u4f60\u4f7f\u7528\u7ed3\u6784\u4f53\u6307\u9488\uff0cmutex \u5e94\u8be5\u4f5c\u4e3a\u7ed3\u6784\u4f53\u7684\u975e\u6307\u9488\u5b57\u6bb5\u3002\u5373\u4f7f\u8be5\u7ed3\u6784\u4f53\u4e0d\u88ab\u5bfc\u51fa\uff0c\u4e5f\u4e0d\u8981\u76f4\u63a5\u628a mutex \u5d4c\u5165\u5230\u7ed3\u6784\u4f53\u4e2d\u3002</p> Bad Good <code>type SMap struct {   sync.Mutex    data map[string]string }  func NewSMap() *SMap {   return &amp;SMap{     data: make(map[string]string),   } }  func (m *SMap) Get(k string) string {   m.Lock()   defer m.Unlock()    return m.data[k] }</code> <code>type SMap struct {   mu sync.Mutex    data map[string]string }  func NewSMap() *SMap {   return &amp;SMap{     data: make(map[string]string),   } }  func (m *SMap) Get(k string) string {   m.mu.Lock()   defer m.mu.Unlock()    return m.data[k] }</code> <code>Mutex</code> \u5b57\u6bb5\uff0c <code>Lock</code> \u548c <code>Unlock</code> \u65b9\u6cd5\u662f <code>SMap</code> \u5bfc\u51fa\u7684 API \u4e2d\u4e0d\u523b\u610f\u8bf4\u660e\u7684\u4e00\u90e8\u5206\u3002 mutex \u53ca\u5176\u65b9\u6cd5\u662f <code>SMap</code> \u7684\u5b9e\u73b0\u7ec6\u8282\uff0c\u5bf9\u5176\u8c03\u7528\u8005\u4e0d\u53ef\u89c1\u3002"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521902","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#golang02","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521902","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#slices-maps","title":"\u4e00 \u5728\u8fb9\u754c\u5904\u62f7\u8d1d Slices \u548c Maps","text":"<p>slices \u548c maps \u5305\u542b\u4e86\u6307\u5411\u5e95\u5c42\u6570\u636e\u7684\u6307\u9488\uff0c\u56e0\u6b64\u5728\u9700\u8981\u590d\u5236\u5b83\u4eec\u65f6\u8981\u7279\u522b\u6ce8\u610f\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#11-slices-maps","title":"1.1 \u63a5\u6536 Slices \u548c Maps","text":"<p>\u8bf7\u8bb0\u4f4f\uff0c\u5f53 map \u6216 slice \u4f5c\u4e3a\u51fd\u6570\u53c2\u6570\u4f20\u5165\u65f6\uff0c\u5982\u679c\u60a8\u5b58\u50a8\u4e86\u5bf9\u5b83\u4eec\u7684\u5f15\u7528\uff0c\u5219\u7528\u6237\u53ef\u4ee5\u5bf9\u5176\u8fdb\u884c\u4fee\u6539\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>func (d *Driver) SetTrips(trips []Trip) {\n  d.trips = trips\n}\n\ntrips := ...\nd1.SetTrips(trips)\n\n// \u4f60\u662f\u8981\u4fee\u6539 d1.trips \u5417\uff1f\ntrips[0] = ...\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>func (d *Driver) SetTrips(trips []Trip) {\n  d.trips = make([]Trip, len(trips))\n  copy(d.trips, trips)\n}\n\ntrips := ...\nd1.SetTrips(trips)\n\n// \u8fd9\u91cc\u6211\u4eec\u4fee\u6539 trips[0]\uff0c\u4f46\u4e0d\u4f1a\u5f71\u54cd\u5230 d1.trips\ntrips[0] = ...\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#12-slices-maps","title":"1.2 \u8fd4\u56de slices \u6216 maps","text":"<p>\u540c\u6837\uff0c\u8bf7\u6ce8\u610f\u7528\u6237\u5bf9\u66b4\u9732\u5185\u90e8\u72b6\u6001\u7684 map \u6216 slice \u7684\u4fee\u6539\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>type Stats struct {\n  mu sync.Mutex\n\n  counters map[string]int\n}\n\n// Snapshot \u8fd4\u56de\u5f53\u524d\u72b6\u6001\u3002\nfunc (s *Stats) Snapshot() map[string]int {\n  s.mu.Lock()\n  defer s.mu.Unlock()\n\n  return s.counters\n}\n\n// snapshot \u4e0d\u518d\u53d7\u4e92\u65a5\u9501\u4fdd\u62a4\n// \u56e0\u6b64\u5bf9 snapshot \u7684\u4efb\u4f55\u8bbf\u95ee\u90fd\u5c06\u53d7\u5230\u6570\u636e\u7ade\u4e89\u7684\u5f71\u54cd\n// \u5f71\u54cd stats.counters\nsnapshot := stats.Snapshot()\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>type Stats struct {\n  mu sync.Mutex\n\n  counters map[string]int\n}\n\nfunc (s *Stats) Snapshot() map[string]int {\n  s.mu.Lock()\n  defer s.mu.Unlock()\n\n  result := make(map[string]int, len(s.counters))\n  for k, v := range s.counters {\n    result[k] = v\n  }\n  return result\n}\n\n// snapshot \u73b0\u5728\u662f\u4e00\u4e2a\u62f7\u8d1d\nsnapshot := stats.Snapshot()\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#defer","title":"\u4e8c \u4f7f\u7528 defer \u91ca\u653e\u8d44\u6e90","text":"<p>\u4f7f\u7528 defer \u91ca\u653e\u8d44\u6e90\uff0c\u8bf8\u5982\u6587\u4ef6\u548c\u9501\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>p.Lock()\nif p.count &lt; 10 {\n  p.Unlock()\n  return p.count\n}\n\np.count++\nnewCount := p.count\np.Unlock()\n\nreturn newCount\n\n// \u5f53\u6709\u591a\u4e2a return \u5206\u652f\u65f6\uff0c\u5f88\u5bb9\u6613\u9057\u5fd8 unlock\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>p.Lock()\ndefer p.Unlock()\n\nif p.count &lt; 10 {\n  return p.count\n}\n\np.count++\nreturn p.count\n\n// \u66f4\u53ef\u8bfb\n</code></pre> <p>Defer \u7684\u5f00\u9500\u975e\u5e38\u5c0f\uff0c\u53ea\u6709\u5728\u60a8\u53ef\u4ee5\u8bc1\u660e\u51fd\u6570\u6267\u884c\u65f6\u95f4\u5904\u4e8e\u7eb3\u79d2\u7ea7\u7684\u7a0b\u5ea6\u65f6\uff0c\u624d\u5e94\u907f\u514d\u8fd9\u6837\u505a\u3002\u4f7f\u7528 defer \u63d0\u5347\u53ef\u8bfb\u6027\u662f\u503c\u5f97\u7684\uff0c\u56e0\u4e3a\u4f7f\u7528\u5b83\u4eec\u7684\u6210\u672c\u5fae\u4e0d\u8db3\u9053\u3002\u5c24\u5176\u9002\u7528\u4e8e\u90a3\u4e9b\u4e0d\u4ec5\u4ec5\u662f\u7b80\u5355\u5185\u5b58\u8bbf\u95ee\u7684\u8f83\u5927\u7684\u65b9\u6cd5\uff0c\u5728\u8fd9\u4e9b\u65b9\u6cd5\u4e2d\u5176\u4ed6\u8ba1\u7b97\u7684\u8d44\u6e90\u6d88\u8017\u8fdc\u8d85\u8fc7 <code>defer</code>\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#channel-size-1","title":"\u4e09 Channel \u7684 size \u8981\u4e48\u662f 1\uff0c\u8981\u4e48\u662f\u65e0\u7f13\u51b2\u7684","text":"<p>channel \u901a\u5e38 size \u5e94\u4e3a 1 \u6216\u662f\u65e0\u7f13\u51b2\u7684\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cchannel \u662f\u65e0\u7f13\u51b2\u7684\uff0c\u5176 size \u4e3a\u96f6\u3002\u4efb\u4f55\u5176\u4ed6\u5c3a\u5bf8\u90fd\u5fc5\u987b\u7ecf\u8fc7\u4e25\u683c\u7684\u5ba1\u67e5\u3002\u6211\u4eec\u9700\u8981\u8003\u8651\u5982\u4f55\u786e\u5b9a\u5927\u5c0f\uff0c\u8003\u8651\u662f\u4ec0\u4e48\u963b\u6b62\u4e86 channel \u5728\u9ad8\u8d1f\u8f7d\u4e0b\u548c\u963b\u585e\u5199\u65f6\u7684\u5199\u5165\uff0c\u4ee5\u53ca\u5f53\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\u65f6\u7cfb\u7edf\u903b\u8f91\u6709\u54ea\u4e9b\u53d8\u5316\u3002(\u7ffb\u8bd1\u89e3\u91ca\uff1a\u6309\u7167\u539f\u6587\u610f\u601d\u662f\u9700\u8981\u754c\u5b9a\u901a\u9053\u8fb9\u754c\uff0c\u7ade\u6001\u6761\u4ef6\uff0c\u4ee5\u53ca\u903b\u8f91\u4e0a\u4e0b\u6587\u68b3\u7406)</p> <ul> <li>Bad</li> </ul> <pre><code>// \u5e94\u8be5\u8db3\u4ee5\u6ee1\u8db3\u4efb\u4f55\u60c5\u51b5\uff01\nc := make(chan int, 64)\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// \u5927\u5c0f\uff1a1\nc := make(chan int, 1) // \u6216\u8005\n// \u65e0\u7f13\u51b2 channel\uff0c\u5927\u5c0f\u4e3a 0\nc := make(chan int)\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#1","title":"\u56db \u679a\u4e3e\u4ece 1 \u5f00\u59cb","text":"<p>\u5728 Go \u4e2d\u5f15\u5165\u679a\u4e3e\u7684\u6807\u51c6\u65b9\u6cd5\u662f\u58f0\u660e\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7c7b\u578b\u548c\u4e00\u4e2a\u4f7f\u7528\u4e86 iota \u7684 const \u7ec4\u3002\u7531\u4e8e\u53d8\u91cf\u7684\u9ed8\u8ba4\u503c\u4e3a 0\uff0c\u56e0\u6b64\u901a\u5e38\u5e94\u4ee5\u975e\u96f6\u503c\u5f00\u5934\u679a\u4e3e\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>type Operation int\n\nconst (\n  Add Operation = iota\n  Subtract\n  Multiply\n)\n\n// Add=0, Subtract=1, Multiply=2\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>type Operation int\n\nconst (\n  Add Operation = iota + 1\n  Subtract\n  Multiply\n)\n\n// Add=1, Subtract=2, Multiply=3\n</code></pre> <p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u96f6\u503c\u662f\u6709\u610f\u4e49\u7684\uff08\u679a\u4e3e\u4ece\u96f6\u5f00\u59cb\uff09\uff0c\u4f8b\u5982\uff0c\u5f53\u96f6\u503c\u662f\u7406\u60f3\u7684\u9ed8\u8ba4\u884c\u4e3a\u65f6\u3002</p> <pre><code>type LogOutput int\n\nconst (\n  LogToStdout LogOutput = iota\n  LogToFile\n  LogToRemote\n)\n\n// LogToStdout=0, LogToFile=1, LogToRemote=2\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#time","title":"\u4e94 \u4f7f\u7528 time \u5904\u7406\u65f6\u95f4","text":"<p>\u65f6\u95f4\u5904\u7406\u5f88\u590d\u6742\u3002\u5173\u4e8e\u65f6\u95f4\u7684\u9519\u8bef\u5047\u8bbe\u901a\u5e38\u5305\u62ec\u4ee5\u4e0b\u51e0\u70b9\u3002</p> <ol> <li>\u4e00\u5929\u6709 24 \u5c0f\u65f6</li> <li>\u4e00\u5c0f\u65f6\u6709 60 \u5206\u949f</li> <li>\u4e00\u5468\u6709\u4e03\u5929</li> <li>\u4e00\u5e74 365 \u5929</li> <li>\u8fd8\u6709\u66f4\u591a</li> </ol> <p>\u4f8b\u5982\uff0c1 \u8868\u793a\u5728\u4e00\u4e2a\u65f6\u95f4\u70b9\u4e0a\u52a0\u4e0a 24 \u5c0f\u65f6\u5e76\u4e0d\u603b\u662f\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u65e5\u5386\u65e5\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u5904\u7406\u65f6\u95f4\u65f6\u59cb\u7ec8\u4f7f\u7528 <code>\"time\"</code> \u5305\uff0c\u56e0\u4e3a\u5b83\u6709\u52a9\u4e8e\u4ee5\u66f4\u5b89\u5168\u3001\u66f4\u51c6\u786e\u7684\u65b9\u5f0f\u5904\u7406\u8fd9\u4e9b\u4e0d\u6b63\u786e\u7684\u5047\u8bbe\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#51-timetime","title":"5.1 \u4f7f\u7528 <code>time.Time</code> \u8868\u8fbe\u77ac\u65f6\u65f6\u95f4","text":"<p>\u5728\u5904\u7406\u65f6\u95f4\u7684\u77ac\u95f4\u65f6\u4f7f\u7528 <code>time.Time</code>\uff0c\u5728\u6bd4\u8f83\u3001\u6dfb\u52a0\u6216\u51cf\u53bb\u65f6\u95f4\u65f6\u4f7f\u7528 <code>time.Time</code> \u4e2d\u7684\u65b9\u6cd5\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>func isActive(now, start, stop int) bool {\n  return start &lt;= now &amp;&amp; now &lt; stop\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>func isActive(now, start, stop time.Time) bool {\n  return (start.Before(now) || start.Equal(now)) &amp;&amp; now.Before(stop)\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#52-timeduration","title":"5.2 \u4f7f\u7528 <code>time.Duration</code> \u8868\u8fbe\u65f6\u95f4\u6bb5","text":"<p>\u5728\u5904\u7406\u65f6\u95f4\u6bb5\u65f6\u4f7f\u7528 <code>time.Duration</code> .</p> <ul> <li>Bad</li> </ul> <pre><code>func poll(delay int) {\n  for {\n    // ...\n    time.Sleep(time.Duration(delay) * time.Millisecond)\n  }\n}\npoll(10) // \u662f\u51e0\u79d2\u949f\u8fd8\u662f\u51e0\u6beb\u79d2\uff1f\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>func poll(delay time.Duration) {\n  for {\n    // ...\n    time.Sleep(delay)\n  }\n}\npoll(10*time.Second)\n</code></pre> <p>\u56de\u5230\u7b2c\u4e00\u4e2a\u4f8b\u5b50\uff0c\u5728\u4e00\u4e2a\u65f6\u95f4\u77ac\u95f4\u52a0\u4e0a 24 \u5c0f\u65f6\uff0c\u6211\u4eec\u7528\u4e8e\u6dfb\u52a0\u65f6\u95f4\u7684\u65b9\u6cd5\u53d6\u51b3\u4e8e\u610f\u56fe\u3002\u5982\u679c\u6211\u4eec\u60f3\u8981\u4e0b\u4e00\u4e2a\u65e5\u5386\u65e5 (\u5f53\u524d\u5929\u7684\u4e0b\u4e00\u5929) \u7684\u540c\u4e00\u4e2a\u65f6\u95f4\u70b9\uff0c\u6211\u4eec\u5e94\u8be5\u4f7f\u7528 <code>Time.AddDate</code>\u3002\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u60f3\u4fdd\u8bc1\u67d0\u4e00\u65f6\u523b\u6bd4\u524d\u4e00\u65f6\u523b\u665a 24 \u5c0f\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u4f7f\u7528 <code>Time.Add</code>\u3002</p> <pre><code>newDay := t.AddDate(0 /* years */, 0 /* months */, 1 /* days */)\nmaybeNewDay := t.Add(24 * time.Hour)\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/#53-timetime-timeduration","title":"5.3 \u5bf9\u5916\u90e8\u7cfb\u7edf\u4f7f\u7528 <code>time.Time</code> \u548c <code>time.Duration</code>","text":"<p>\u5c3d\u53ef\u80fd\u5728\u4e0e\u5916\u90e8\u7cfb\u7edf\u7684\u4ea4\u4e92\u4e2d\u4f7f\u7528 <code>time.Duration</code> \u548c <code>time.Time</code> \u4f8b\u5982 :</p> <ul> <li>Command-line \u6807\u5fd7: <code>flag</code> \u901a\u8fc7 <code>time.ParseDuration</code> \u652f\u6301 <code>time.Duration</code></li> <li>JSON: <code>encoding/json</code> \u901a\u8fc7\u5176 <code>UnmarshalJSON</code> method \u65b9\u6cd5\u652f\u6301\u5c06 <code>time.Time</code> \u7f16\u7801\u4e3a RFC 3339 \u5b57\u7b26\u4e32</li> <li>SQL: <code>database/sql</code> \u652f\u6301\u5c06 <code>DATETIME</code> \u6216 <code>TIMESTAMP</code> \u5217\u8f6c\u6362\u4e3a <code>time.Time</code>\uff0c\u5982\u679c\u5e95\u5c42\u9a71\u52a8\u7a0b\u5e8f\u652f\u6301\u5219\u8fd4\u56de</li> <li>YAML: <code>gopkg.in/yaml.v2</code> \u652f\u6301\u5c06 <code>time.Time</code> \u4f5c\u4e3a RFC 3339 \u5b57\u7b26\u4e32\uff0c\u5e76\u901a\u8fc7 <code>time.ParseDuration</code> \u652f\u6301 <code>time.Duration</code>\u3002</li> </ul> <p>\u5f53\u4e0d\u80fd\u5728\u8fd9\u4e9b\u4ea4\u4e92\u4e2d\u4f7f\u7528 <code>time.Duration</code> \u65f6\uff0c\u8bf7\u4f7f\u7528 <code>int</code> \u6216 <code>float64</code>\uff0c\u5e76\u5728\u5b57\u6bb5\u540d\u79f0\u4e2d\u5305\u542b\u5355\u4f4d\u3002</p> <p>\u4f8b\u5982\uff0c\u7531\u4e8e <code>encoding/json</code> \u4e0d\u652f\u6301 <code>time.Duration</code>\uff0c\u56e0\u6b64\u8be5\u5355\u4f4d\u5305\u542b\u5728\u5b57\u6bb5\u7684\u540d\u79f0\u4e2d\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>// {\"interval\": 2}\ntype Config struct {\n  Interval int `json:\"interval\"`\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// {\"intervalMillis\": 2000}\ntype Config struct {\n  IntervalMillis int `json:\"intervalMillis\"`\n}\n</code></pre> <p>\u5f53\u5728\u8fd9\u4e9b\u4ea4\u4e92\u4e2d\u4e0d\u80fd\u4f7f\u7528 <code>time.Time</code> \u65f6\uff0c\u9664\u975e\u8fbe\u6210\u4e00\u81f4\uff0c\u5426\u5219\u4f7f\u7528 <code>string</code> \u548c RFC 3339 \u4e2d\u5b9a\u4e49\u7684\u683c\u5f0f\u65f6\u95f4\u6233\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>Time.UnmarshalText</code> \u4f7f\u7528\u6b64\u683c\u5f0f\uff0c\u5e76\u53ef\u901a\u8fc7 <code>time.RFC3339</code> \u5728 <code>Time.Format</code> \u548c <code>time.Parse</code> \u4e2d\u4f7f\u7528\u3002</p> <p>\u5c3d\u7ba1\u8fd9\u5728\u5b9e\u8df5\u4e2d\u5e76\u4e0d\u6210\u95ee\u9898\uff0c\u4f46\u8bf7\u8bb0\u4f4f\uff0c<code>\"time\"</code> \u5305\u4e0d\u652f\u6301\u89e3\u6790\u95f0\u79d2\u65f6\u95f4\u6233\uff088728\uff09\uff0c\u4e5f\u4e0d\u5728\u8ba1\u7b97\u4e2d\u8003\u8651\u95f0\u79d2\uff0815190\uff09\u3002\u5982\u679c\u60a8\u6bd4\u8f83\u4e24\u4e2a\u65f6\u95f4\u77ac\u95f4\uff0c\u5219\u5dee\u5f02\u5c06\u4e0d\u5305\u62ec\u8fd9\u4e24\u4e2a\u77ac\u95f4\u4e4b\u95f4\u53ef\u80fd\u53d1\u751f\u7684\u95f0\u79d2\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521903","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/#golang03","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521903","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/#errors","title":"\u4e00 Errors","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/#11","title":"1.1 \u9519\u8bef\u7c7b\u578b","text":"<p>\u58f0\u660e\u9519\u8bef\u7684\u9009\u9879\u5f88\u5c11\u3002 \u5728\u9009\u62e9\u6700\u9002\u5408\u60a8\u7684\u7528\u4f8b\u7684\u9009\u9879\u4e4b\u524d\uff0c\u8bf7\u8003\u8651\u4ee5\u4e0b\u4e8b\u9879\u3002</p> <ul> <li>\u8c03\u7528\u8005\u662f\u5426\u9700\u8981\u5339\u914d\u9519\u8bef\u4ee5\u4fbf\u4ed6\u4eec\u53ef\u4ee5\u5904\u7406\u5b83\uff1f \u5982\u679c\u662f\uff0c\u6211\u4eec\u5fc5\u987b\u901a\u8fc7\u58f0\u660e\u9876\u7ea7\u9519\u8bef\u53d8\u91cf\u6216\u81ea\u5b9a\u4e49\u7c7b\u578b\u6765\u652f\u6301 <code>errors.Is</code> \u6216 <code>errors.As</code> \u51fd\u6570\u3002</li> <li>\u9519\u8bef\u6d88\u606f\u662f\u5426\u4e3a\u9759\u6001\u5b57\u7b26\u4e32\uff0c\u8fd8\u662f\u9700\u8981\u4e0a\u4e0b\u6587\u4fe1\u606f\u7684\u52a8\u6001\u5b57\u7b26\u4e32\uff1f \u5982\u679c\u662f\u9759\u6001\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>errors.New</code>\uff0c\u4f46\u5bf9\u4e8e\u540e\u8005\uff0c\u6211\u4eec\u5fc5\u987b\u4f7f\u7528 <code>fmt.Errorf</code> \u6216\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b\u3002</li> <li>\u6211\u4eec\u662f\u5426\u6b63\u5728\u4f20\u9012\u7531\u4e0b\u6e38\u51fd\u6570\u8fd4\u56de\u7684\u65b0\u9519\u8bef\uff1f \u5982\u679c\u662f\u8fd9\u6837\uff0c\u8bf7\u53c2\u9605\u9519\u8bef\u5305\u88c5\u90e8\u5206\u3002</li> </ul> \u9519\u8bef\u5339\u914d\uff1f \u9519\u8bef\u6d88\u606f \u6307\u5bfc No static <code>errors.New</code> No dynamic <code>fmt.Errorf</code> Yes static top-level <code>var</code> with <code>errors.New</code> Yes dynamic custom <code>error</code> type <p>\u4f8b\u5982\uff0c \u4f7f\u7528 <code>errors.New</code> \u8868\u793a\u5e26\u6709\u9759\u6001\u5b57\u7b26\u4e32\u7684\u9519\u8bef\u3002 \u5982\u679c\u8c03\u7528\u8005\u9700\u8981\u5339\u914d\u5e76\u5904\u7406\u6b64\u9519\u8bef\uff0c\u5219\u5c06\u6b64\u9519\u8bef\u5bfc\u51fa\u4e3a\u53d8\u91cf\u4ee5\u652f\u6301\u5c06\u5176\u4e0e <code>errors.Is</code> \u5339\u914d\u3002</p> <ul> <li>\u65e0\u9519\u8bef\u5339\u914d</li> </ul> <pre><code>// package foo\n\nfunc Open() error {\n  return errors.New(\"could not open\")\n}\n\n// package bar\n\nif err := foo.Open(); err != nil {\n  // Can't handle the error.\n  panic(\"unknown error\")\n}\n</code></pre> <ul> <li>\u9519\u8bef\u5339\u914d</li> </ul> <pre><code>// package foo\n\nvar ErrCouldNotOpen = errors.New(\"could not open\")\n\nfunc Open() error {\n  return ErrCouldNotOpen\n}\n\n// package bar\n\nif err := foo.Open(); err != nil {\n  if errors.Is(err, foo.ErrCouldNotOpen) {\n    // handle the error\n  } else {\n    panic(\"unknown error\")\n  }\n}\n</code></pre> <p>\u5bf9\u4e8e\u52a8\u6001\u5b57\u7b26\u4e32\u7684\u9519\u8bef\uff0c \u5982\u679c\u8c03\u7528\u8005\u4e0d\u9700\u8981\u5339\u914d\u5b83\uff0c\u5219\u4f7f\u7528 <code>fmt.Errorf</code>\uff0c \u5982\u679c\u8c03\u7528\u8005\u786e\u5b9e\u9700\u8981\u5339\u914d\u5b83\uff0c\u5219\u81ea\u5b9a\u4e49 <code>error</code>\u3002</p> <ul> <li>\u65e0\u9519\u8bef\u5339\u914d</li> </ul> <pre><code>// package foo\n\nfunc Open(file string) error {\n  return fmt.Errorf(\"file %q not found\", file)\n}\n\n// package bar\n\nif err := foo.Open(\"testfile.txt\"); err != nil {\n  // Can't handle the error.\n  panic(\"unknown error\")\n}\n</code></pre> <ul> <li>\u9519\u8bef\u5339\u914d</li> </ul> <pre><code>// package foo\n\ntype NotFoundError struct {\n  File string\n}\n\nfunc (e *NotFoundError) Error() string {\n  return fmt.Sprintf(\"file %q not found\", e.File)\n}\n\nfunc Open(file string) error {\n  return &amp;NotFoundError{File: file}\n}\n\n\n// package bar\n\nif err := foo.Open(\"testfile.txt\"); err != nil {\n  var notFound *NotFoundError\n  if errors.As(err, &amp;notFound) {\n    // handle the error\n  } else {\n    panic(\"unknown error\")\n  }\n}\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u60a8\u4ece\u5305\u4e2d\u5bfc\u51fa\u9519\u8bef\u53d8\u91cf\u6216\u7c7b\u578b\uff0c \u5b83\u4eec\u5c06\u6210\u4e3a\u5305\u7684\u516c\u5171 API \u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/#12","title":"1.2 \u9519\u8bef\u5305\u88c5","text":"<p>There are three main options for propagating errors if a call fails: \u5982\u679c\u8c03\u7528\u5931\u8d25\uff0c\u6709\u4e09\u79cd\u4e3b\u8981\u7684\u9519\u8bef\u8c03\u7528\u9009\u9879\uff1a</p> <ul> <li>\u6309\u539f\u6837\u8fd4\u56de\u539f\u59cb\u9519\u8bef</li> <li>add context with <code>fmt.Errorf</code> and the <code>%w</code> verb</li> <li>\u4f7f\u7528<code>fmt.Errorf</code>\u548c<code>%w</code></li> <li>\u4f7f\u7528 <code>fmt.Errorf</code> \u548c <code>%v</code></li> </ul> <p>\u5982\u679c\u6ca1\u6709\u8981\u6dfb\u52a0\u7684\u5176\u4ed6\u4e0a\u4e0b\u6587\uff0c\u5219\u6309\u539f\u6837\u8fd4\u56de\u539f\u59cb\u9519\u8bef\u3002 \u8fd9\u5c06\u4fdd\u7559\u539f\u59cb\u9519\u8bef\u7c7b\u578b\u548c\u6d88\u606f\u3002 \u8fd9\u975e\u5e38\u9002\u5408\u5e95\u5c42\u9519\u8bef\u6d88\u606f\u6709\u8db3\u591f\u7684\u4fe1\u606f\u6765\u8ffd\u8e2a\u5b83\u6765\u81ea\u54ea\u91cc\u7684\u9519\u8bef\u3002</p> <p>\u5426\u5219\uff0c\u5c3d\u53ef\u80fd\u5728\u9519\u8bef\u6d88\u606f\u4e2d\u6dfb\u52a0\u4e0a\u4e0b\u6587 \u8fd9\u6837\u5c31\u4e0d\u4f1a\u51fa\u73b0\u8bf8\u5982\u201c\u8fde\u63a5\u88ab\u62d2\u7edd\u201d\u4e4b\u7c7b\u7684\u6a21\u7cca\u9519\u8bef\uff0c \u60a8\u4f1a\u6536\u5230\u66f4\u591a\u6709\u7528\u7684\u9519\u8bef\uff0c\u4f8b\u5982\u201c\u547c\u53eb\u670d\u52a1 foo\uff1a\u8fde\u63a5\u88ab\u62d2\u7edd\u201d\u3002</p> <p>\u4f7f\u7528 <code>fmt.Errorf</code> \u4e3a\u4f60\u7684\u9519\u8bef\u6dfb\u52a0\u4e0a\u4e0b\u6587\uff0c \u6839\u636e\u8c03\u7528\u8005\u662f\u5426\u5e94\u8be5\u80fd\u591f\u5339\u914d\u548c\u63d0\u53d6\u6839\u672c\u539f\u56e0\uff0c\u5728 <code>%w</code> \u6216 <code>%v</code> \u52a8\u8bcd\u4e4b\u95f4\u8fdb\u884c\u9009\u62e9\u3002</p> <ul> <li>\u5982\u679c\u8c03\u7528\u8005\u5e94\u8be5\u53ef\u4ee5\u8bbf\u95ee\u5e95\u5c42\u9519\u8bef\uff0c\u8bf7\u4f7f\u7528 <code>%w</code>\u3002 \u5bf9\u4e8e\u5927\u591a\u6570\u5305\u88c5\u9519\u8bef\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9ed8\u8ba4\u503c\uff0c \u4f46\u8bf7\u6ce8\u610f\uff0c\u8c03\u7528\u8005\u53ef\u80fd\u4f1a\u5f00\u59cb\u4f9d\u8d56\u6b64\u884c\u4e3a\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u5305\u88c5\u9519\u8bef\u662f\u5df2\u77e5<code>var</code>\u6216\u7c7b\u578b\u7684\u60c5\u51b5\uff0c\u8bf7\u5c06\u5176\u4f5c\u4e3a\u51fd\u6570\u5951\u7ea6\u7684\u4e00\u90e8\u5206\u8fdb\u884c\u8bb0\u5f55\u548c\u6d4b\u8bd5\u3002</li> <li>\u4f7f\u7528 <code>%v</code> \u6765\u6df7\u6dc6\u5e95\u5c42\u9519\u8bef\u3002 \u8c03\u7528\u8005\u5c06\u65e0\u6cd5\u5339\u914d\u5b83\uff0c\u4f46\u5982\u679c\u9700\u8981\uff0c\u60a8\u53ef\u4ee5\u5728\u5c06\u6765\u5207\u6362\u5230 <code>%w</code>\u3002</li> </ul> <p>\u5728\u4e3a\u8fd4\u56de\u7684\u9519\u8bef\u6dfb\u52a0\u4e0a\u4e0b\u6587\u65f6\uff0c\u901a\u8fc7\u907f\u514d\u4f7f\u7528\"failed to\"\u4e4b\u7c7b\u7684\u77ed\u8bed\u6765\u4fdd\u6301\u4e0a\u4e0b\u6587\u7b80\u6d01\uff0c\u5f53\u9519\u8bef\u901a\u8fc7\u5806\u6808\u5411\u4e0a\u6e17\u900f\u65f6\uff0c\u5b83\u4f1a\u4e00\u5c42\u4e00\u5c42\u88ab\u5806\u79ef\u8d77\u6765\uff1a</p> <ul> <li>Bad</li> </ul> <pre><code>s, err := store.New()\nif err != nil {\n    return fmt.Errorf(\n        \"failed to create new store: %w\", err)\n}\n\n\n// failed to x: failed to y: failed to create new store: the error\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>s, err := store.New()\nif err != nil {\n    return fmt.Errorf(\n        \"new store: %w\", err)\n}\n\n// x: y: new store: the error\n</code></pre> <p>\u7136\u800c\uff0c\u4e00\u65e6\u9519\u8bef\u88ab\u53d1\u9001\u5230\u53e6\u4e00\u4e2a\u7cfb\u7edf\uff0c\u5e94\u8be5\u6e05\u695a\u6d88\u606f\u662f\u4e00\u4e2a\u9519\u8bef\uff08\u4f8b\u5982<code>err</code> \u6807\u7b7e\u6216\u65e5\u5fd7\u4e2d\u7684\"Failed\"\u524d\u7f00\uff09\u3002</p> <p>\u53e6\u89c1 \u4e0d\u8981\u53ea\u68c0\u67e5\u9519\u8bef\uff0c\u4f18\u96c5\u5730\u5904\u7406\u5b83\u4eec\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/#13","title":"1.3 \u9519\u8bef\u547d\u540d","text":"<p>\u5bf9\u4e8e\u5b58\u50a8\u4e3a\u5168\u5c40\u53d8\u91cf\u7684\u9519\u8bef\u503c\uff0c \u6839\u636e\u662f\u5426\u5bfc\u51fa\uff0c\u4f7f\u7528\u524d\u7f00 <code>Err</code> \u6216 <code>err</code>\u3002 \u8bf7\u770b\u6307\u5357 \u5bf9\u4e8e\u672a\u5bfc\u51fa\u7684\u9876\u5c42\u5e38\u91cf\u548c\u53d8\u91cf\uff0c\u4f7f\u7528_\u4f5c\u4e3a\u524d\u7f00\u3002</p> <pre><code>var (\n  // \u5bfc\u51fa\u4ee5\u4e0b\u4e24\u4e2a\u9519\u8bef\uff0c\u4ee5\u4fbf\u6b64\u5305\u7684\u7528\u6237\u53ef\u4ee5\u5c06\u5b83\u4eec\u4e0e errors.Is \u8fdb\u884c\u5339\u914d\u3002\n\n  ErrBrokenLink = errors.New(\"link is broken\")\n  ErrCouldNotOpen = errors.New(\"could not open\")\n\n  // \u8fd9\u4e2a\u9519\u8bef\u6ca1\u6709\u88ab\u5bfc\u51fa\uff0c\u56e0\u4e3a\u6211\u4eec\u4e0d\u60f3\u8ba9\u5b83\u6210\u4e3a\u6211\u4eec\u516c\u5171 API \u7684\u4e00\u90e8\u5206\u3002 \u6211\u4eec\u53ef\u80fd\u4ecd\u7136\u5728\u5e26\u6709\u9519\u8bef\u7684\u5305\u5185\u4f7f\u7528\u5b83\u3002\n\n  errNotFound = errors.New(\"not found\")\n)\n</code></pre> <p>\u5bf9\u4e8e\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b\uff0c\u8bf7\u6539\u7528\u540e\u7f00 <code>Error</code>\u3002</p> <pre><code>// \u540c\u6837\uff0c\u8fd9\u4e2a\u9519\u8bef\u88ab\u5bfc\u51fa\uff0c\u4ee5\u4fbf\u8fd9\u4e2a\u5305\u7684\u7528\u6237\u53ef\u4ee5\u5c06\u5b83\u4e0e errors.As \u5339\u914d\u3002\n\ntype NotFoundError struct {\n  File string\n}\n\nfunc (e *NotFoundError) Error() string {\n  return fmt.Sprintf(\"file %q not found\", e.File)\n}\n\n// \u5e76\u4e14\u8fd9\u4e2a\u9519\u8bef\u6ca1\u6709\u88ab\u5bfc\u51fa\uff0c\u56e0\u4e3a\u6211\u4eec\u4e0d\u60f3\u8ba9\u5b83\u6210\u4e3a\u516c\u5171 API \u7684\u4e00\u90e8\u5206\u3002 \u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u5728\u5e26\u6709 errors.As \u7684\u5305\u4e2d\u4f7f\u7528\u5b83\u3002\ntype resolveError struct {\n  Path string\n}\n\nfunc (e *resolveError) Error() string {\n  return fmt.Sprintf(\"resolve %q\", e.Path)\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/#_1","title":"\u4e8c \u5904\u7406\u65ad\u8a00\u5931\u8d25","text":"<p>\u7c7b\u578b\u65ad\u8a00 \u5c06\u4f1a\u5728\u68c0\u6d4b\u5230\u4e0d\u6b63\u786e\u7684\u7c7b\u578b\u65f6\uff0c\u4ee5\u5355\u4e00\u8fd4\u56de\u503c\u5f62\u5f0f\u8fd4\u56de panic\u3002 \u56e0\u6b64\uff0c\u8bf7\u59cb\u7ec8\u4f7f\u7528\u201c\u9017\u53f7 ok\u201d\u4e60\u8bed\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>t := i.(string)\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>t, ok := i.(string)\nif !ok {\n  // \u4f18\u96c5\u5730\u5904\u7406\u9519\u8bef\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9904/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521904","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9904/#golang04","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521904","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9904/#panic","title":"\u4e00 \u4e0d\u8981\u4f7f\u7528 panic","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8fd0\u884c\u7684\u4ee3\u7801\u5fc5\u987b\u907f\u514d\u51fa\u73b0 panic\u3002panic \u662f \u7ea7\u8054\u5931\u8d25 \u7684\u4e3b\u8981\u6839\u6e90 \u3002\u5982\u679c\u53d1\u751f\u9519\u8bef\uff0c\u8be5\u51fd\u6570\u5fc5\u987b\u8fd4\u56de\u9519\u8bef\uff0c\u5e76\u5141\u8bb8\u8c03\u7528\u65b9\u51b3\u5b9a\u5982\u4f55\u5904\u7406\u5b83\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>func run(args []string) {\n  if len(args) == 0 {\n    panic(\"an argument is required\")\n  }\n  // ...\n}\n\nfunc main() {\n  run(os.Args[1:])\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>func run(args []string) error {\n  if len(args) == 0 {\n    return errors.New(\"an argument is required\")\n  }\n  // ...\n  return nil\n}\n\nfunc main() {\n  if err := run(os.Args[1:]); err != nil {\n    fmt.Fprintln(os.Stderr, err)\n    os.Exit(1)\n  }\n}\n</code></pre> <p>panic/recover \u4e0d\u662f\u9519\u8bef\u5904\u7406\u7b56\u7565\u3002\u4ec5\u5f53\u53d1\u751f\u4e0d\u53ef\u6062\u590d\u7684\u4e8b\u60c5\uff08\u4f8b\u5982\uff1anil \u5f15\u7528\uff09\u65f6\uff0c\u7a0b\u5e8f\u624d\u5fc5\u987b panic\u3002\u7a0b\u5e8f\u521d\u59cb\u5316\u662f\u4e00\u4e2a\u4f8b\u5916\uff1a\u7a0b\u5e8f\u542f\u52a8\u65f6\u5e94\u4f7f\u7a0b\u5e8f\u4e2d\u6b62\u7684\u4e0d\u826f\u60c5\u51b5\u53ef\u80fd\u4f1a\u5f15\u8d77 panic\u3002</p> <pre><code>var _statusTemplate = template.Must(template.New(\"name\").Parse(\"_statusHTML\"))\n</code></pre> <p>\u5373\u4f7f\u5728\u6d4b\u8bd5\u4ee3\u7801\u4e2d\uff0c\u4e5f\u4f18\u5148\u4f7f\u7528<code>t.Fatal</code>\u6216\u8005<code>t.FailNow</code>\u800c\u4e0d\u662f panic \u6765\u786e\u4fdd\u5931\u8d25\u88ab\u6807\u8bb0\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>// func TestFoo(t *testing.T)\n\nf, err := ioutil.TempFile(\"\", \"test\")\nif err != nil {\n  panic(\"failed to set up test\")\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// func TestFoo(t *testing.T)\n\nf, err := ioutil.TempFile(\"\", \"test\")\nif err != nil {\n  t.Fatal(\"failed to set up test\")\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9904/#atomic","title":"\u4e8c \u4f7f\u7528\u4f7f\u7528 atomic","text":"<p>\u4f7f\u7528 sync/atomic \u5305\u7684\u539f\u5b50\u64cd\u4f5c\u5bf9\u539f\u59cb\u7c7b\u578b (<code>int32</code>, <code>int64</code>\u7b49\uff09\u8fdb\u884c\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5f88\u5bb9\u6613\u5fd8\u8bb0\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u6765\u8bfb\u53d6\u6216\u4fee\u6539\u53d8\u91cf\u3002</p> <p>go.uber.org/atomic \u901a\u8fc7\u9690\u85cf\u57fa\u7840\u7c7b\u578b\u4e3a\u8fd9\u4e9b\u64cd\u4f5c\u589e\u52a0\u4e86\u7c7b\u578b\u5b89\u5168\u6027\u3002\u6b64\u5916\uff0c\u5b83\u5305\u62ec\u4e00\u4e2a\u65b9\u4fbf\u7684<code>atomic.Bool</code>\u7c7b\u578b\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>type foo struct {\n  running int32  // atomic\n}\n\nfunc (f* foo) start() {\n  if atomic.SwapInt32(&amp;f.running, 1) == 1 {\n     // already running\u2026\n     return\n  }\n  // start the Foo\n}\n\nfunc (f *foo) isRunning() bool {\n  return f.running == 1  // race!\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>type foo struct {\n  running atomic.Bool\n}\n\nfunc (f *foo) start() {\n  if f.running.Swap(true) {\n     // already running\u2026\n     return\n  }\n  // start the Foo\n}\n\nfunc (f *foo) isRunning() bool {\n  return f.running.Load()\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9904/#_1","title":"\u4e09 \u907f\u514d\u53ef\u53d8\u5168\u5c40\u53d8\u91cf","text":"<p>\u4f7f\u7528\u9009\u62e9\u4f9d\u8d56\u6ce8\u5165\u65b9\u5f0f\u907f\u514d\u6539\u53d8\u5168\u5c40\u53d8\u91cf\u3002 \u65e2\u9002\u7528\u4e8e\u51fd\u6570\u6307\u9488\u53c8\u9002\u7528\u4e8e\u5176\u4ed6\u503c\u7c7b\u578b</p> <ul> <li>Bad</li> </ul> <pre><code>// sign.go\nvar _timeNow = time.Now\nfunc sign(msg string) string {\n  now := _timeNow()\n  return signWithTime(msg, now)\n}\n\n// sign_test.go\nfunc TestSign(t *testing.T) {\n  oldTimeNow := _timeNow\n  _timeNow = func() time.Time {\n    return someFixedTime\n  }\n  defer func() { _timeNow = oldTimeNow }()\n  assert.Equal(t, want, sign(give))\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// sign.go\ntype signer struct {\n  now func() time.Time\n}\nfunc newSigner() *signer {\n  return &amp;signer{\n    now: time.Now,\n  }\n}\nfunc (s *signer) Sign(msg string) string {\n  now := s.now()\n  return signWithTime(msg, now)\n}\n\n// sign_test.go\nfunc TestSigner(t *testing.T) {\n  s := newSigner()\n  s.now = func() time.Time {\n    return someFixedTime\n  }\n  assert.Equal(t, want, s.Sign(give))\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9904/#_2","title":"\u56db \u907f\u514d\u5728\u516c\u5171\u7ed3\u6784\u4e2d\u5d4c\u5165\u7c7b\u578b","text":"<p>\u8fd9\u4e9b\u5d4c\u5165\u7684\u7c7b\u578b\u6cc4\u6f0f\u5b9e\u73b0\u7ec6\u8282\u3001\u7981\u6b62\u7c7b\u578b\u6f14\u5316\u548c\u6a21\u7cca\u7684\u6587\u6863\u3002</p> <p>\u5047\u8bbe\u60a8\u4f7f\u7528\u5171\u4eab\u7684 <code>AbstractList</code> \u5b9e\u73b0\u4e86\u591a\u79cd\u5217\u8868\u7c7b\u578b\uff0c\u8bf7\u907f\u514d\u5728\u5177\u4f53\u7684\u5217\u8868\u5b9e\u73b0\u4e2d\u5d4c\u5165 <code>AbstractList</code>\u3002 \u76f8\u53cd\uff0c\u53ea\u9700\u624b\u52a8\u5c06\u65b9\u6cd5\u5199\u5165\u5177\u4f53\u7684\u5217\u8868\uff0c\u8be5\u5217\u8868\u5c06\u59d4\u6258\u7ed9\u62bd\u8c61\u5217\u8868\u3002</p> <pre><code>type AbstractList struct {}\n// \u6dfb\u52a0\u5c06\u5b9e\u4f53\u6dfb\u52a0\u5230\u5217\u8868\u4e2d\u3002\nfunc (l *AbstractList) Add(e Entity) {\n  // ...\n}\n// \u79fb\u9664\u4ece\u5217\u8868\u4e2d\u79fb\u9664\u5b9e\u4f53\u3002\nfunc (l *AbstractList) Remove(e Entity) {\n  // ...\n}\n</code></pre> <ul> <li>Bad</li> </ul> <pre><code>// ConcreteList \u662f\u4e00\u4e2a\u5b9e\u4f53\u5217\u8868\u3002\ntype ConcreteList struct {\n  *AbstractList\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// ConcreteList \u662f\u4e00\u4e2a\u5b9e\u4f53\u5217\u8868\u3002\ntype ConcreteList struct {\n  list *AbstractList\n}\n// \u6dfb\u52a0\u5c06\u5b9e\u4f53\u6dfb\u52a0\u5230\u5217\u8868\u4e2d\u3002\nfunc (l *ConcreteList) Add(e Entity) {\n  l.list.Add(e)\n}\n// \u79fb\u9664\u4ece\u5217\u8868\u4e2d\u79fb\u9664\u5b9e\u4f53\u3002\nfunc (l *ConcreteList) Remove(e Entity) {\n  l.list.Remove(e)\n}\n</code></pre> <p>Go \u5141\u8bb8 \u7c7b\u578b\u5d4c\u5165 \u4f5c\u4e3a\u7ee7\u627f\u548c\u7ec4\u5408\u4e4b\u95f4\u7684\u6298\u8877\u3002\u5916\u90e8\u7c7b\u578b\u83b7\u53d6\u5d4c\u5165\u7c7b\u578b\u7684\u65b9\u6cd5\u7684\u9690\u5f0f\u526f\u672c\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u59d4\u6258\u7ed9\u5d4c\u5165\u5b9e\u4f8b\u7684\u540c\u4e00\u65b9\u6cd5\u3002</p> <p>\u7ed3\u6784\u8fd8\u83b7\u5f97\u4e0e\u7c7b\u578b\u540c\u540d\u7684\u5b57\u6bb5\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u5d4c\u5165\u7684\u7c7b\u578b\u662f public\uff0c\u90a3\u4e48\u5b57\u6bb5\u662f public\u3002\u4e3a\u4e86\u4fdd\u6301\u5411\u540e\u517c\u5bb9\u6027\uff0c\u5916\u90e8\u7c7b\u578b\u7684\u6bcf\u4e2a\u672a\u6765\u7248\u672c\u90fd\u5fc5\u987b\u4fdd\u7559\u5d4c\u5165\u7c7b\u578b\u3002</p> <p>\u5f88\u5c11\u9700\u8981\u5d4c\u5165\u7c7b\u578b\u3002 \u8fd9\u662f\u4e00\u79cd\u65b9\u4fbf\uff0c\u53ef\u4ee5\u5e2e\u52a9\u60a8\u907f\u514d\u7f16\u5199\u5197\u957f\u7684\u59d4\u6258\u65b9\u6cd5\u3002</p> <p>\u5373\u4f7f\u5d4c\u5165\u517c\u5bb9\u7684\u62bd\u8c61\u5217\u8868 interface\uff0c\u800c\u4e0d\u662f\u7ed3\u6784\u4f53\uff0c\u8fd9\u5c06\u4e3a\u5f00\u53d1\u4eba\u5458\u63d0\u4f9b\u66f4\u5927\u7684\u7075\u6d3b\u6027\u6765\u6539\u53d8\u672a\u6765\uff0c\u4f46\u4ecd\u7136\u6cc4\u9732\u4e86\u5177\u4f53\u5217\u8868\u4f7f\u7528\u62bd\u8c61\u5b9e\u73b0\u7684\u7ec6\u8282\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>// AbstractList \u662f\u5404\u79cd\u5b9e\u4f53\u5217\u8868\u7684\u901a\u7528\u5b9e\u73b0\u3002\ntype AbstractList interface {\n  Add(Entity)\n  Remove(Entity)\n}\n// ConcreteList \u662f\u4e00\u4e2a\u5b9e\u4f53\u5217\u8868\u3002\ntype ConcreteList struct {\n  AbstractList\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// ConcreteList \u662f\u4e00\u4e2a\u5b9e\u4f53\u5217\u8868\u3002\ntype ConcreteList struct {\n  list AbstractList\n}\n// \u6dfb\u52a0\u5c06\u5b9e\u4f53\u6dfb\u52a0\u5230\u5217\u8868\u4e2d\u3002\nfunc (l *ConcreteList) Add(e Entity) {\n  l.list.Add(e)\n}\n// \u79fb\u9664\u4ece\u5217\u8868\u4e2d\u79fb\u9664\u5b9e\u4f53\u3002\nfunc (l *ConcreteList) Remove(e Entity) {\n  l.list.Remove(e)\n}\n</code></pre> <p>\u65e0\u8bba\u662f\u4f7f\u7528\u5d4c\u5165\u7ed3\u6784\u8fd8\u662f\u5d4c\u5165\u63a5\u53e3\uff0c\u90fd\u4f1a\u9650\u5236\u7c7b\u578b\u7684\u6f14\u5316\u3002</p> <ul> <li>\u5411\u5d4c\u5165\u63a5\u53e3\u6dfb\u52a0\u65b9\u6cd5\u662f\u4e00\u4e2a\u7834\u574f\u6027\u7684\u6539\u53d8\u3002</li> <li>\u4ece\u5d4c\u5165\u7ed3\u6784\u4f53\u5220\u9664\u65b9\u6cd5\u662f\u4e00\u4e2a\u7834\u574f\u6027\u6539\u53d8\u3002</li> <li>\u5220\u9664\u5d4c\u5165\u7c7b\u578b\u662f\u4e00\u4e2a\u7834\u574f\u6027\u7684\u6539\u53d8\u3002</li> <li>\u5373\u4f7f\u4f7f\u7528\u6ee1\u8db3\u76f8\u540c\u63a5\u53e3\u7684\u7c7b\u578b\u66ff\u6362\u5d4c\u5165\u7c7b\u578b\uff0c\u4e5f\u662f\u4e00\u4e2a\u7834\u574f\u6027\u7684\u6539\u53d8\u3002</li> </ul> <p>\u5c3d\u7ba1\u7f16\u5199\u8fd9\u4e9b\u59d4\u6258\u65b9\u6cd5\u662f\u4e4f\u5473\u7684\uff0c\u4f46\u662f\u989d\u5916\u7684\u5de5\u4f5c\u9690\u85cf\u4e86\u5b9e\u73b0\u7ec6\u8282\uff0c\u7559\u4e0b\u4e86\u66f4\u591a\u7684\u66f4\u6539\u673a\u4f1a\uff0c\u8fd8\u6d88\u9664\u4e86\u5728\u6587\u6863\u4e2d\u53d1\u73b0\u5b8c\u6574\u5217\u8868\u63a5\u53e3\u7684\u95f4\u63a5\u6027\u64cd\u4f5c\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521905","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/#golang05","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u6307\u5bfc\u539f\u521905","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/#_1","title":"\u4e00 \u907f\u514d\u4f7f\u7528\u5185\u7f6e\u540d\u79f0","text":"<p>Go \u8bed\u8a00\u89c4\u8303 \u6982\u8ff0\u4e86\u51e0\u4e2a\u5185\u7f6e\u7684\uff0c \u4e0d\u5e94\u5728 Go \u9879\u76ee\u4e2d\u4f7f\u7528\u7684 \u9884\u5148\u58f0\u660e\u7684\u6807\u8bc6\u7b26\u3002</p> <p>\u6839\u636e\u4e0a\u4e0b\u6587\u7684\u4e0d\u540c\uff0c\u5c06\u8fd9\u4e9b\u6807\u8bc6\u7b26\u4f5c\u4e3a\u540d\u79f0\u91cd\u590d\u4f7f\u7528\uff0c \u5c06\u5728\u5f53\u524d\u4f5c\u7528\u57df\uff08\u6216\u4efb\u4f55\u5d4c\u5957\u4f5c\u7528\u57df\uff09\u4e2d\u9690\u85cf\u539f\u59cb\u6807\u8bc6\u7b26\uff0c\u6216\u8005\u6df7\u6dc6\u4ee3\u7801\u3002 \u5728\u6700\u597d\u7684\u60c5\u51b5\u4e0b\uff0c\u7f16\u8bd1\u5668\u4f1a\u62a5\u9519\uff1b\u5728\u6700\u574f\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u6837\u7684\u4ee3\u7801\u53ef\u80fd\u4f1a\u5f15\u5165\u6f5c\u5728\u7684\u3001\u96be\u4ee5\u6062\u590d\u7684\u9519\u8bef\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>var error string\n// `error` \u4f5c\u7528\u57df\u9690\u5f0f\u8986\u76d6\n\n// or\n\nfunc handleErrorMessage(error string) {\n    // `error` \u4f5c\u7528\u57df\u9690\u5f0f\u8986\u76d6\n}\n\ntype Foo struct {\n    // \u867d\u7136\u8fd9\u4e9b\u5b57\u6bb5\u5728\u6280\u672f\u4e0a\u4e0d\u6784\u6210\u9634\u5f71\uff0c\u4f46`error`\u6216`string`\u5b57\u7b26\u4e32\u7684\u91cd\u6620\u5c04\u73b0\u5728\u662f\u4e0d\u660e\u786e\u7684\u3002\n    error  error\n    string string\n}\n\nfunc (f Foo) Error() error {\n    // `error` \u548c `f.error` \u5728\u89c6\u89c9\u4e0a\u662f\u76f8\u4f3c\u7684\n    return f.error\n}\n\nfunc (f Foo) String() string {\n    // `string` and `f.string` \u5728\u89c6\u89c9\u4e0a\u662f\u76f8\u4f3c\u7684\n    return f.string\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>var errorMessage string\n// `error` \u6307\u5411\u5185\u7f6e\u7684\u975e\u8986\u76d6\n\n// or\n\nfunc handleErrorMessage(msg string) {\n    // `error` \u6307\u5411\u5185\u7f6e\u7684\u975e\u8986\u76d6\n}\n\n\ntype Foo struct {\n    // `error` and `string` \u73b0\u5728\u662f\u660e\u786e\u7684\u3002\n    err error\n    str string\n}\n\nfunc (f Foo) Error() error {\n    return f.err\n}\n\nfunc (f Foo) String() string {\n    return f.str\n}\n</code></pre> <p>\u6ce8\u610f\uff0c\u7f16\u8bd1\u5668\u5728\u4f7f\u7528\u9884\u5148\u5206\u9694\u7684\u6807\u8bc6\u7b26\u65f6\u4e0d\u4f1a\u751f\u6210\u9519\u8bef\uff0c \u4f46\u662f\u8bf8\u5982<code>go vet</code>\u4e4b\u7c7b\u7684\u5de5\u5177\u4f1a\u6b63\u786e\u5730\u6307\u51fa\u8fd9\u4e9b\u548c\u5176\u4ed6\u60c5\u51b5\u4e0b\u7684\u9690\u5f0f\u95ee\u9898\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/#init","title":"\u4e8c \u907f\u514d\u4f7f\u7528 <code>init()</code>","text":"<p>\u5c3d\u53ef\u80fd\u907f\u514d\u4f7f\u7528<code>init()</code>\u3002\u5f53<code>init()</code>\u662f\u4e0d\u53ef\u907f\u514d\u6216\u53ef\u53d6\u7684\uff0c\u4ee3\u7801\u5e94\u5148\u5c1d\u8bd5\uff1a</p> <ol> <li>\u65e0\u8bba\u7a0b\u5e8f\u73af\u5883\u6216\u8c03\u7528\u5982\u4f55\uff0c\u90fd\u8981\u5b8c\u5168\u786e\u5b9a\u3002</li> <li>\u907f\u514d\u4f9d\u8d56\u4e8e\u5176\u4ed6<code>init()</code>\u51fd\u6570\u7684\u987a\u5e8f\u6216\u526f\u4f5c\u7528\u3002\u867d\u7136<code>init()</code>\u987a\u5e8f\u662f\u660e\u786e\u7684\uff0c\u4f46\u4ee3\u7801\u53ef\u4ee5\u66f4\u6539\uff0c \u56e0\u6b64<code>init()</code>\u51fd\u6570\u4e4b\u95f4\u7684\u5173\u7cfb\u53ef\u80fd\u4f1a\u4f7f\u4ee3\u7801\u53d8\u5f97\u8106\u5f31\u548c\u5bb9\u6613\u51fa\u9519\u3002</li> <li>\u907f\u514d\u8bbf\u95ee\u6216\u64cd\u4f5c\u5168\u5c40\u6216\u73af\u5883\u72b6\u6001\uff0c\u5982\u673a\u5668\u4fe1\u606f\u3001\u73af\u5883\u53d8\u91cf\u3001\u5de5\u4f5c\u76ee\u5f55\u3001\u7a0b\u5e8f\u53c2\u6570/\u8f93\u5165\u7b49\u3002</li> <li>\u907f\u514d<code>I/O</code>\uff0c\u5305\u62ec\u6587\u4ef6\u7cfb\u7edf\u3001\u7f51\u7edc\u548c\u7cfb\u7edf\u8c03\u7528\u3002</li> </ol> <p>\u4e0d\u80fd\u6ee1\u8db3\u8fd9\u4e9b\u8981\u6c42\u7684\u4ee3\u7801\u53ef\u80fd\u5c5e\u4e8e\u8981\u4f5c\u4e3a<code>main()</code>\u8c03\u7528\u7684\u4e00\u90e8\u5206\uff08\u6216\u7a0b\u5e8f\u751f\u547d\u5468\u671f\u4e2d\u7684\u5176\u4ed6\u5730\u65b9\uff09\uff0c \u6216\u8005\u4f5c\u4e3a<code>main()</code>\u672c\u8eab\u7684\u4e00\u90e8\u5206\u5199\u5165\u3002\u7279\u522b\u662f\uff0c\u6253\u7b97\u7531\u5176\u4ed6\u7a0b\u5e8f\u4f7f\u7528\u7684\u5e93\u5e94\u8be5\u7279\u522b\u6ce8\u610f\u5b8c\u5168\u786e\u5b9a\u6027\uff0c \u800c\u4e0d\u662f\u6267\u884c\u201cinit magic\u201d</p> <ul> <li>Bad</li> </ul> <pre><code>type Foo struct {\n    // ...\n}\nvar _defaultFoo Foo\nfunc init() {\n    _defaultFoo = Foo{\n        // ...\n    }\n}\n\ntype Config struct {\n    // ...\n}\nvar _config Config\nfunc init() {\n    // Bad: \u57fa\u4e8e\u5f53\u524d\u76ee\u5f55\n    cwd, _ := os.Getwd()\n    // Bad: I/O\n    raw, _ := ioutil.ReadFile(\n        path.Join(cwd, \"config\", \"config.yaml\"),\n    )\n    yaml.Unmarshal(raw, &amp;_config)\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>var _defaultFoo = Foo{\n    // ...\n}\n// or\uff0c\u4e3a\u4e86\u66f4\u597d\u7684\u53ef\u6d4b\u8bd5\u6027\uff1a\nvar _defaultFoo = defaultFoo()\nfunc defaultFoo() Foo {\n    return Foo{\n        // ...\n    }\n}\n\ntype Config struct {\n    // ...\n}\nfunc loadConfig() Config {\n    cwd, err := os.Getwd()\n    // handle err\n    raw, err := ioutil.ReadFile(\n        path.Join(cwd, \"config\", \"config.yaml\"),\n    )\n    // handle err\n    var config Config\n    yaml.Unmarshal(raw, &amp;config)\n    return config\n}\n</code></pre> <p>\u8003\u8651\u5230\u4e0a\u8ff0\u60c5\u51b5\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c<code>init()</code>\u53ef\u80fd\u66f4\u53ef\u53d6\u6216\u662f\u5fc5\u8981\u7684\uff0c\u53ef\u80fd\u5305\u62ec\uff1a</p> <ul> <li>\u4e0d\u80fd\u8868\u793a\u4e3a\u5355\u4e2a\u8d4b\u503c\u7684\u590d\u6742\u8868\u8fbe\u5f0f\u3002</li> <li>\u53ef\u63d2\u5165\u7684\u94a9\u5b50\uff0c\u5982<code>database/sql</code>\u3001\u7f16\u7801\u7c7b\u578b\u6ce8\u518c\u8868\u7b49\u3002</li> <li>\u5bf9 Google Cloud Functions \u548c\u5176\u4ed6\u5f62\u5f0f\u7684\u786e\u5b9a\u6027\u9884\u8ba1\u7b97\u7684\u4f18\u5316\u3002</li> </ul>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/#_2","title":"\u4e09 \u8ffd\u52a0\u65f6\u4f18\u5148\u6307\u5b9a\u5207\u7247\u5bb9\u91cf","text":"<p>\u8ffd\u52a0\u65f6\u4f18\u5148\u6307\u5b9a\u5207\u7247\u5bb9\u91cf</p> <p>\u5728\u5c3d\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u521d\u59cb\u5316\u8981\u8ffd\u52a0\u7684\u5207\u7247\u65f6\u4e3a<code>make()</code>\u63d0\u4f9b\u4e00\u4e2a\u5bb9\u91cf\u503c\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>for n := 0; n &lt; b.N; n++ {\n  data := make([]int, 0)\n  for k := 0; k &lt; size; k++{\n    data = append(data, k)\n  }\n}\n\nBenchmarkBad-4    100000000    2.48s\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>for n := 0; n &lt; b.N; n++ {\n  data := make([]int, 0, size)\n  for k := 0; k &lt; size; k++{\n    data = append(data, k)\n  }\n}\n\nBenchmarkGood-4   100000000    0.21s\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/#exit","title":"\u56db \u4e3b\u51fd\u6570\u9000\u51fa\u65b9\u5f0f (Exit)","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/#41","title":"4.1 \u4e3b\u51fd\u6570\u9000\u51fa","text":"<p>Go \u7a0b\u5e8f\u4f7f\u7528 <code>os.Exit</code> \u6216\u8005 <code>log.Fatal*</code> \u7acb\u5373\u9000\u51fa (\u4f7f\u7528<code>panic</code>\u4e0d\u662f\u9000\u51fa\u7a0b\u5e8f\u7684\u597d\u65b9\u6cd5\uff0c\u8bf7 \u4e0d\u8981\u4f7f\u7528 panic\u3002)</p> <p>\u4ec5\u5728main() \u4e2d\u8c03\u7528\u5176\u4e2d\u4e00\u4e2a <code>os.Exit</code> \u6216\u8005 <code>log.Fatal*</code>\u3002\u6240\u6709\u5176\u4ed6\u51fd\u6570\u5e94\u5c06\u9519\u8bef\u8fd4\u56de\u5230\u4fe1\u53f7\u5931\u8d25\u4e2d\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>func main() {\n  body := readFile(path)\n  fmt.Println(body)\n}\nfunc readFile(path string) string {\n  f, err := os.Open(path)\n  if err != nil {\n    log.Fatal(err)\n  }\n  b, err := ioutil.ReadAll(f)\n  if err != nil {\n    log.Fatal(err)\n  }\n  return string(b)\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>func main() {\n  body, err := readFile(path)\n  if err != nil {\n    log.Fatal(err)\n  }\n  fmt.Println(body)\n}\nfunc readFile(path string) (string, error) {\n  f, err := os.Open(path)\n  if err != nil {\n    return \"\", err\n  }\n  b, err := ioutil.ReadAll(f)\n  if err != nil {\n    return \"\", err\n  }\n  return string(b), nil\n}\n</code></pre> <p>\u539f\u5219\u4e0a\uff1a\u9000\u51fa\u7684\u5177\u6709\u591a\u79cd\u529f\u80fd\u7684\u7a0b\u5e8f\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff1a</p> <ul> <li>\u4e0d\u660e\u663e\u7684\u63a7\u5236\u6d41\uff1a\u4efb\u4f55\u51fd\u6570\u90fd\u53ef\u4ee5\u9000\u51fa\u7a0b\u5e8f\uff0c\u56e0\u6b64\u5f88\u96be\u5bf9\u63a7\u5236\u6d41\u8fdb\u884c\u63a8\u7406\u3002</li> <li>\u96be\u4ee5\u6d4b\u8bd5\uff1a\u9000\u51fa\u7a0b\u5e8f\u7684\u51fd\u6570\u4e5f\u5c06\u9000\u51fa\u8c03\u7528\u5b83\u7684\u6d4b\u8bd5\u3002\u8fd9\u4f7f\u5f97\u51fd\u6570\u5f88\u96be\u6d4b\u8bd5\uff0c\u5e76\u5f15\u5165\u4e86\u8df3\u8fc7 <code>go test</code> \u5c1a\u672a\u8fd0\u884c\u7684\u5176\u4ed6\u6d4b\u8bd5\u7684\u98ce\u9669\u3002</li> <li>\u8df3\u8fc7\u6e05\u7406\uff1a\u5f53\u51fd\u6570\u9000\u51fa\u7a0b\u5e8f\u65f6\uff0c\u4f1a\u8df3\u8fc7\u5df2\u7ecf\u8fdb\u5165<code>defer</code>\u961f\u5217\u91cc\u7684\u51fd\u6570\u8c03\u7528\u3002\u8fd9\u589e\u52a0\u4e86\u8df3\u8fc7\u91cd\u8981\u6e05\u7406\u4efb\u52a1\u7684\u98ce\u9669\u3002</li> </ul>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/#42","title":"4.2 \u4e00\u6b21\u6027\u9000\u51fa","text":"<p>\u5982\u679c\u53ef\u80fd\u7684\u8bdd\uff0c\u4f60\u7684<code>main\uff08\uff09</code>\u51fd\u6570\u4e2d \u6700\u591a\u4e00\u6b21 \u8c03\u7528 <code>os.Exit</code>\u6216\u8005<code>log.Fatal</code>\u3002\u5982\u679c\u6709\u591a\u4e2a\u9519\u8bef\u573a\u666f\u505c\u6b62\u7a0b\u5e8f\u6267\u884c\uff0c\u8bf7\u5c06\u8be5\u903b\u8f91\u653e\u5728\u5355\u72ec\u7684\u51fd\u6570\u4e0b\u5e76\u4ece\u4e2d\u8fd4\u56de\u9519\u8bef\u3002 \u8fd9\u4f1a\u7f29\u77ed <code>main()</code> \u51fd\u6570\uff0c\u5e76\u5c06\u6240\u6709\u5173\u952e\u4e1a\u52a1\u903b\u8f91\u653e\u5165\u4e00\u4e2a\u5355\u72ec\u7684\u3001\u53ef\u6d4b\u8bd5\u7684\u51fd\u6570\u4e2d\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>package main\nfunc main() {\n  args := os.Args[1:]\n  if len(args) != 1 {\n    log.Fatal(\"missing file\")\n  }\n  name := args[0]\n  f, err := os.Open(name)\n  if err != nil {\n    log.Fatal(err)\n  }\n  defer f.Close()\n  // \u5982\u679c\u6211\u4eec\u8c03\u7528 log.Fatal \u5728\u8fd9\u6761\u7ebf\u4e4b\u540e\n  // f.Close \u5c06\u4f1a\u88ab\u6267\u884c\u3002\n  b, err := ioutil.ReadAll(f)\n  if err != nil {\n    log.Fatal(err)\n  }\n  // ...\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>package main\nfunc main() {\n  if err := run(); err != nil {\n    log.Fatal(err)\n  }\n}\nfunc run() error {\n  args := os.Args[1:]\n  if len(args) != 1 {\n    return errors.New(\"missing file\")\n  }\n  name := args[0]\n  f, err := os.Open(name)\n  if err != nil {\n    return err\n  }\n  defer f.Close()\n  b, err := ioutil.ReadAll(f)\n  if err != nil {\n    return err\n  }\n  // ...\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u7f16\u7a0b\u6a21\u5f0f01","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/#golang01","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u7f16\u7a0b\u6a21\u5f0f01","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/#_1","title":"\u4e00 \u8868\u9a71\u52a8\u6d4b\u8bd5","text":"<p>\u5f53\u6d4b\u8bd5\u903b\u8f91\u662f\u91cd\u590d\u7684\u65f6\u5019\uff0c\u901a\u8fc7 subtests \u4f7f\u7528 table \u9a71\u52a8\u7684\u65b9\u5f0f\u7f16\u5199 case \u4ee3\u7801\u770b\u4e0a\u53bb\u4f1a\u66f4\u7b80\u6d01\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>// func TestSplitHostPort(t *testing.T)\n\nhost, port, err := net.SplitHostPort(\"192.0.2.0:8000\")\nrequire.NoError(t, err)\nassert.Equal(t, \"192.0.2.0\", host)\nassert.Equal(t, \"8000\", port)\n\nhost, port, err = net.SplitHostPort(\"192.0.2.0:http\")\nrequire.NoError(t, err)\nassert.Equal(t, \"192.0.2.0\", host)\nassert.Equal(t, \"http\", port)\n\nhost, port, err = net.SplitHostPort(\":8000\")\nrequire.NoError(t, err)\nassert.Equal(t, \"\", host)\nassert.Equal(t, \"8000\", port)\n\nhost, port, err = net.SplitHostPort(\"1:8\")\nrequire.NoError(t, err)\nassert.Equal(t, \"1\", host)\nassert.Equal(t, \"8\", port)\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// func TestSplitHostPort(t *testing.T)\n\ntests := []struct{\n  give     string\n  wantHost string\n  wantPort string\n}{\n  {\n    give:     \"192.0.2.0:8000\",\n    wantHost: \"192.0.2.0\",\n    wantPort: \"8000\",\n  },\n  {\n    give:     \"192.0.2.0:http\",\n    wantHost: \"192.0.2.0\",\n    wantPort: \"http\",\n  },\n  {\n    give:     \":8000\",\n    wantHost: \"\",\n    wantPort: \"8000\",\n  },\n  {\n    give:     \"1:8\",\n    wantHost: \"1\",\n    wantPort: \"8\",\n  },\n}\n\nfor _, tt := range tests {\n  t.Run(tt.give, func(t *testing.T) {\n    host, port, err := net.SplitHostPort(tt.give)\n    require.NoError(t, err)\n    assert.Equal(t, tt.wantHost, host)\n    assert.Equal(t, tt.wantPort, port)\n  })\n}\n</code></pre> <p>\u5f88\u660e\u663e\uff0c\u4f7f\u7528 test table \u7684\u65b9\u5f0f\u5728\u4ee3\u7801\u903b\u8f91\u6269\u5c55\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u65b0\u589e test case\uff0c\u90fd\u4f1a\u663e\u5f97\u66f4\u52a0\u7684\u6e05\u6670\u3002</p> <p>\u6211\u4eec\u9075\u5faa\u8fd9\u6837\u7684\u7ea6\u5b9a\uff1a\u5c06\u7ed3\u6784\u4f53\u5207\u7247\u79f0\u4e3a<code>tests</code>\u3002 \u6bcf\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u79f0\u4e3a<code>tt</code>\u3002\u6b64\u5916\uff0c\u6211\u4eec\u9f13\u52b1\u4f7f\u7528<code>give</code>\u548c<code>want</code>\u524d\u7f00\u8bf4\u660e\u6bcf\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u7684\u8f93\u5165\u548c\u8f93\u51fa\u503c\u3002</p> <pre><code>tests := []struct{\n  give     string\n  wantHost string\n  wantPort string\n}{\n  // ...\n}\n\nfor _, tt := range tests {\n  // ...\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/#_2","title":"\u4e8c \u529f\u80fd\u9009\u9879","text":"<p>\u529f\u80fd\u9009\u9879\u662f\u4e00\u79cd\u6a21\u5f0f\uff0c\u60a8\u53ef\u4ee5\u5728\u5176\u4e2d\u58f0\u660e\u4e00\u4e2a\u4e0d\u900f\u660e Option \u7c7b\u578b\uff0c\u8be5\u7c7b\u578b\u5728\u67d0\u4e9b\u5185\u90e8\u7ed3\u6784\u4e2d\u8bb0\u5f55\u4fe1\u606f\u3002\u60a8\u63a5\u53d7\u8fd9\u4e9b\u9009\u9879\u7684\u53ef\u53d8\u7f16\u53f7\uff0c\u5e76\u6839\u636e\u5185\u90e8\u7ed3\u6784\u4e0a\u7684\u9009\u9879\u8bb0\u5f55\u7684\u5168\u90e8\u4fe1\u606f\u91c7\u53d6\u884c\u52a8\u3002</p> <p>\u5c06\u6b64\u6a21\u5f0f\u7528\u4e8e\u60a8\u9700\u8981\u6269\u5c55\u7684\u6784\u9020\u51fd\u6570\u548c\u5176\u4ed6\u516c\u5171 API \u4e2d\u7684\u53ef\u9009\u53c2\u6570\uff0c\u5c24\u5176\u662f\u5728\u8fd9\u4e9b\u529f\u80fd\u4e0a\u5df2\u7ecf\u5177\u6709\u4e09\u4e2a\u6216\u66f4\u591a\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>// package db\n\nfunc Open(\n  addr string,\n  cache bool,\n  logger *zap.Logger\n) (*Connection, error) {\n  // ...\n}\n\n// \u5fc5\u987b\u59cb\u7ec8\u63d0\u4f9b\u7f13\u5b58\u548c\u8bb0\u5f55\u5668\u53c2\u6570\uff0c\u5373\u4f7f\u7528\u6237\u5e0c\u671b\u4f7f\u7528\u9ed8\u8ba4\u503c\u3002\ndb.Open(addr, db.DefaultCache, zap.NewNop())\ndb.Open(addr, db.DefaultCache, log)\ndb.Open(addr, false /* cache */, zap.NewNop())\ndb.Open(addr, false /* cache */, log)\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// package db\n\ntype Option interface {\n  // ...\n}\n\nfunc WithCache(c bool) Option {\n  // ...\n}\n\nfunc WithLogger(log *zap.Logger) Option {\n  // ...\n}\n\n// Open creates a connection.\nfunc Open(\n  addr string,\n  opts ...Option,\n) (*Connection, error) {\n  // ...\n}\n\n// \u53ea\u6709\u5728\u9700\u8981\u65f6\u624d\u63d0\u4f9b\u9009\u9879\u3002\ndb.Open(addr)\ndb.Open(addr, db.WithLogger(log))\ndb.Open(addr, db.WithCache(false))\ndb.Open(\n  addr,\n  db.WithCache(false),\n  db.WithLogger(log),\n)\n</code></pre> <p>\u6211\u4eec\u5efa\u8bae\u5b9e\u73b0\u6b64\u6a21\u5f0f\u7684\u65b9\u6cd5\u662f\u4f7f\u7528\u4e00\u4e2a <code>Option</code> \u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u4fdd\u5b58\u4e00\u4e2a\u672a\u5bfc\u51fa\u7684\u65b9\u6cd5\uff0c\u5728\u4e00\u4e2a\u672a\u5bfc\u51fa\u7684 <code>options</code> \u7ed3\u6784\u4e0a\u8bb0\u5f55\u9009\u9879\u3002</p> <pre><code>type options struct {\n  cache  bool\n  logger *zap.Logger\n}\n\ntype Option interface {\n  apply(*options)\n}\n\ntype cacheOption bool\n\nfunc (c cacheOption) apply(opts *options) {\n  opts.cache = bool(c)\n}\n\nfunc WithCache(c bool) Option {\n  return cacheOption(c)\n}\n\ntype loggerOption struct {\n  Log *zap.Logger\n}\n\nfunc (l loggerOption) apply(opts *options) {\n  opts.logger = l.Log\n}\n\nfunc WithLogger(log *zap.Logger) Option {\n  return loggerOption{Log: log}\n}\n\n// Open creates a connection.\nfunc Open(\n  addr string,\n  opts ...Option,\n) (*Connection, error) {\n  options := options{\n    cache:  defaultCache,\n    logger: zap.NewNop(),\n  }\n\n  for _, o := range opts {\n    o.apply(&amp;options)\n  }\n\n  // ...\n}\n</code></pre> <p>\u6ce8\u610f\uff1a\u8fd8\u6709\u4e00\u79cd\u4f7f\u7528\u95ed\u5305\u5b9e\u73b0\u8fd9\u4e2a\u6a21\u5f0f\u7684\u65b9\u6cd5\uff0c\u4f46\u662f\u6211\u4eec\u76f8\u4fe1\u4e0a\u9762\u7684\u6a21\u5f0f\u4e3a\u4f5c\u8005\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u7075\u6d3b\u6027\uff0c\u5e76\u4e14\u66f4\u5bb9\u6613\u5bf9\u7528\u6237\u8fdb\u884c\u8c03\u8bd5\u548c\u6d4b\u8bd5\u3002\u7279\u522b\u662f\uff0c\u5728\u4e0d\u53ef\u80fd\u8fdb\u884c\u6bd4\u8f83\u7684\u60c5\u51b5\u4e0b\u5b83\u5141\u8bb8\u5728\u6d4b\u8bd5\u548c\u6a21\u62df\u4e2d\u5bf9\u9009\u9879\u8fdb\u884c\u6bd4\u8f83\u3002\u6b64\u5916\uff0c\u5b83\u8fd8\u5141\u8bb8\u9009\u9879\u5b9e\u73b0\u5176\u4ed6\u63a5\u53e3\uff0c\u5305\u62ec <code>fmt.Stringer</code>\uff0c\u5141\u8bb8\u7528\u6237\u8bfb\u53d6\u9009\u9879\u7684\u5b57\u7b26\u4e32\u8868\u793a\u5f62\u5f0f\u3002</p> <p>\u8fd8\u53ef\u4ee5\u53c2\u8003\u4e0b\u9762\u8d44\u6599\uff1a</p> <ul> <li>Self-referential functions and the design of options</li> <li>Functional options for friendly APIs</li> </ul>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/#linting","title":"\u4e09 Linting","text":"<p>\u6bd4\u4efb\u4f55 \"blessed\" linter \u96c6\u66f4\u91cd\u8981\u7684\u662f\uff0clint \u5728\u4e00\u4e2a\u4ee3\u7801\u5e93\u4e2d\u59cb\u7ec8\u4fdd\u6301\u4e00\u81f4\u3002</p> <p>\u6211\u4eec\u5efa\u8bae\u81f3\u5c11\u4f7f\u7528\u4ee5\u4e0b linters\uff0c\u56e0\u4e3a\u6211\u8ba4\u4e3a\u5b83\u4eec\u6709\u52a9\u4e8e\u53d1\u73b0\u6700\u5e38\u89c1\u7684\u95ee\u9898\uff0c\u5e76\u5728\u4e0d\u9700\u8981\u89c4\u5b9a\u7684\u60c5\u51b5\u4e0b\u4e3a\u4ee3\u7801\u8d28\u91cf\u5efa\u7acb\u4e00\u4e2a\u9ad8\u6807\u51c6\uff1a</p> <ul> <li>errcheck \u4ee5\u786e\u4fdd\u9519\u8bef\u5f97\u5230\u5904\u7406</li> <li>goimports \u683c\u5f0f\u5316\u4ee3\u7801\u548c\u7ba1\u7406 imports</li> <li>golint \u6307\u51fa\u5e38\u89c1\u7684\u6587\u4f53\u9519\u8bef</li> <li>govet \u5206\u6790\u4ee3\u7801\u4e2d\u7684\u5e38\u89c1\u9519\u8bef</li> <li>staticcheck \u5404\u79cd\u9759\u6001\u5206\u6790\u68c0\u67e5</li> </ul>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/#lint-runners","title":"Lint Runners","text":"<p>\u6211\u4eec\u63a8\u8350 golangci-lint \u4f5c\u4e3a go-to lint \u7684\u8fd0\u884c\u7a0b\u5e8f\uff0c\u8fd9\u4e3b\u8981\u662f\u56e0\u4e3a\u5b83\u5728\u8f83\u5927\u7684\u4ee3\u7801\u5e93\u4e2d\u7684\u6027\u80fd\u4ee5\u53ca\u80fd\u591f\u540c\u65f6\u914d\u7f6e\u548c\u4f7f\u7528\u8bb8\u591a\u89c4\u8303\u3002\u8fd9\u4e2a repo \u6709\u4e00\u4e2a\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6 .golangci.yml \u548c\u63a8\u8350\u7684 linter \u8bbe\u7f6e\u3002</p> <p>golangci-lint \u6709 various-linters \u53ef\u4f9b\u4f7f\u7528\u3002\u5efa\u8bae\u5c06\u4e0a\u8ff0 linters \u4f5c\u4e3a\u57fa\u672c set\uff0c\u6211\u4eec\u9f13\u52b1\u56e2\u961f\u6dfb\u52a0\u5bf9\u4ed6\u4eec\u7684\u9879\u76ee\u6709\u610f\u4e49\u7684\u4efb\u4f55\u9644\u52a0 linters\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/#_3","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u7f16\u7a0b\u6a21\u5f0f01","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u89c4\u830301","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/#golang01","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u89c4\u830301","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/#_1","title":"\u4e00 \u907f\u514d\u8fc7\u957f\u7684\u884c","text":"<p>\u907f\u514d\u4f7f\u7528\u9700\u8981\u8bfb\u8005\u6c34\u5e73\u6eda\u52a8\u6216\u8fc7\u5ea6\u8f6c\u52a8\u5934\u90e8\u7684\u4ee3\u7801\u884c\u3002</p> <p>\u6211\u4eec\u5efa\u8bae\u5c06\u884c\u957f\u5ea6\u9650\u5236\u4e3a 99 characters (99 \u4e2a\u5b57\u7b26). \u4f5c\u8005\u5e94\u8be5\u5728\u8fbe\u5230\u8fd9\u4e2a\u9650\u5236\u4e4b\u524d\u6362\u884c\uff0c \u4f46\u8fd9\u4e0d\u662f\u786c\u6027\u9650\u5236\u3002 \u5141\u8bb8\u4ee3\u7801\u8d85\u8fc7\u6b64\u9650\u5236\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/#_2","title":"\u4e8c \u4e00\u81f4\u6027","text":"<p>\u672c\u6587\u4e2d\u6982\u8ff0\u7684\u4e00\u4e9b\u6807\u51c6\u90fd\u662f\u5ba2\u89c2\u6027\u7684\u8bc4\u4f30\uff0c\u662f\u6839\u636e\u573a\u666f\u3001\u4e0a\u4e0b\u6587\u3001\u6216\u8005\u4e3b\u89c2\u6027\u7684\u5224\u65ad\uff1b</p> <p>\u4f46\u662f\u6700\u91cd\u8981\u7684\u662f\uff0c\u4fdd\u6301\u4e00\u81f4.</p> <p>\u4e00\u81f4\u6027\u7684\u4ee3\u7801\u66f4\u5bb9\u6613\u7ef4\u62a4\u3001\u662f\u66f4\u5408\u7406\u7684\u3001\u9700\u8981\u66f4\u5c11\u7684\u5b66\u4e60\u6210\u672c\u3001\u5e76\u4e14\u968f\u7740\u65b0\u7684\u7ea6\u5b9a\u51fa\u73b0\u6216\u8005\u51fa\u73b0\u9519\u8bef\u540e\u66f4\u5bb9\u6613\u8fc1\u79fb\u3001\u66f4\u65b0\u3001\u4fee\u590d bug</p> <p>\u76f8\u53cd\uff0c\u5728\u4e00\u4e2a\u4ee3\u7801\u5e93\u4e2d\u5305\u542b\u591a\u4e2a\u5b8c\u5168\u4e0d\u540c\u6216\u51b2\u7a81\u7684\u4ee3\u7801\u98ce\u683c\u4f1a\u5bfc\u81f4\u7ef4\u62a4\u6210\u672c\u5f00\u9500\u3001\u4e0d\u786e\u5b9a\u6027\u548c\u8ba4\u77e5\u504f\u5dee\u3002\u6240\u6709\u8fd9\u4e9b\u90fd\u4f1a\u76f4\u63a5\u5bfc\u81f4\u901f\u5ea6\u964d\u4f4e\u3001\u4ee3\u7801\u5ba1\u67e5\u75db\u82e6\u3001\u800c\u4e14\u589e\u52a0 bug \u6570\u91cf\u3002</p> <p>\u5c06\u8fd9\u4e9b\u6807\u51c6\u5e94\u7528\u4e8e\u4ee3\u7801\u5e93\u65f6\uff0c\u5efa\u8bae\u5728 package\uff08\u6216\u66f4\u5927\uff09\u7ea7\u522b\u8fdb\u884c\u66f4\u6539\uff0c\u5b50\u5305\u7ea7\u522b\u7684\u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7\u5c06\u591a\u4e2a\u6837\u5f0f\u5f15\u5165\u5230\u540c\u4e00\u4ee3\u7801\u4e2d\uff0c\u8fdd\u53cd\u4e86\u4e0a\u8ff0\u5173\u6ce8\u70b9\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/#_3","title":"\u4e09 \u76f8\u4f3c\u7684\u58f0\u660e\u653e\u5728\u4e00\u7ec4","text":"<p>Go \u8bed\u8a00\u652f\u6301\u5c06\u76f8\u4f3c\u7684\u58f0\u660e\u653e\u5728\u4e00\u4e2a\u7ec4\u5185\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>import \"a\"\nimport \"b\"\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>import (\n  \"a\"\n  \"b\"\n)\n</code></pre> <p>\u8fd9\u540c\u6837\u9002\u7528\u4e8e\u5e38\u91cf\u3001\u53d8\u91cf\u548c\u7c7b\u578b\u58f0\u660e\uff1a</p> <ul> <li>Bad</li> </ul> <pre><code>const a = 1\nconst b = 2\n\nvar a = 1\nvar b = 2\n\ntype Area float64\ntype Volume float64\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>const (\n  a = 1\n  b = 2\n)\n\nvar (\n  a = 1\n  b = 2\n)\n\ntype (\n  Area float64\n  Volume float64\n)\n</code></pre> <p>\u4ec5\u5c06\u76f8\u5173\u7684\u58f0\u660e\u653e\u5728\u4e00\u7ec4\u3002\u4e0d\u8981\u5c06\u4e0d\u76f8\u5173\u7684\u58f0\u660e\u653e\u5728\u4e00\u7ec4\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>type Operation int\n\nconst (\n  Add Operation = iota + 1\n  Subtract\n  Multiply\n  EnvVar = \"MY_ENV\"\n)\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>type Operation int\n\nconst (\n  Add Operation = iota + 1\n  Subtract\n  Multiply\n)\n\nconst EnvVar = \"MY_ENV\"\n</code></pre> <p>\u5206\u7ec4\u4f7f\u7528\u7684\u4f4d\u7f6e\u6ca1\u6709\u9650\u5236\uff0c\u4f8b\u5982\uff1a\u4f60\u53ef\u4ee5\u5728\u51fd\u6570\u5185\u90e8\u4f7f\u7528\u5b83\u4eec\uff1a</p> <ul> <li>Bad</li> </ul> <pre><code>func f() string {\n  red := color.New(0xff0000)\n  green := color.New(0x00ff00)\n  blue := color.New(0x0000ff)\n\n  ...\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>func f() string {\n  var (\n    red   = color.New(0xff0000)\n    green = color.New(0x00ff00)\n    blue  = color.New(0x0000ff)\n  )\n\n  ...\n}\n</code></pre> <p>\u4f8b\u5916\uff1a\u5982\u679c\u53d8\u91cf\u58f0\u660e\u4e0e\u5176\u4ed6\u53d8\u91cf\u76f8\u90bb\uff0c\u5219\u5e94\u5c06\u53d8\u91cf\u58f0\u660e\uff08\u5c24\u5176\u662f\u51fd\u6570\u5185\u90e8\u7684\u58f0\u660e\uff09\u5206\u7ec4\u5728\u4e00\u8d77\u3002\u5bf9\u4e00\u8d77\u58f0\u660e\u7684\u53d8\u91cf\u6267\u884c\u6b64\u64cd\u4f5c\uff0c\u5373\u4f7f\u5b83\u4eec\u4e0d\u76f8\u5173\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>func (c *client) request() {\n  caller := c.name\n  format := \"json\"\n  timeout := 5*time.Second\n  var err error\n  // ...\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>func (c *client) request() {\n  var (\n    caller  = c.name\n    format  = \"json\"\n    timeout = 5*time.Second\n    err error\n  )\n\n  // ...\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/#import","title":"\u56db import \u5206\u7ec4","text":"<p>\u5bfc\u5165\u5e94\u8be5\u5206\u4e3a\u4e24\u7ec4\uff1a</p> <ul> <li>\u6807\u51c6\u5e93</li> <li>\u5176\u4ed6\u5e93</li> </ul> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u662f goimports \u5e94\u7528\u7684\u5206\u7ec4\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>import (\n  \"fmt\"\n  \"os\"\n  \"go.uber.org/atomic\"\n  \"golang.org/x/sync/errgroup\"\n)\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>import (\n  \"fmt\"\n  \"os\"\n\n  \"go.uber.org/atomic\"\n  \"golang.org/x/sync/errgroup\"\n)\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/#_4","title":"\u4e94 \u5305\u540d","text":"<p>\u5f53\u547d\u540d\u5305\u65f6\uff0c\u8bf7\u6309\u4e0b\u9762\u89c4\u5219\u9009\u62e9\u4e00\u4e2a\u540d\u79f0\uff1a</p> <ul> <li>\u5168\u90e8\u5c0f\u5199\u3002\u6ca1\u6709\u5927\u5199\u6216\u4e0b\u5212\u7ebf\u3002</li> <li>\u5927\u591a\u6570\u4f7f\u7528\u547d\u540d\u5bfc\u5165\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u9700\u8981\u91cd\u547d\u540d\u3002</li> <li>\u7b80\u77ed\u800c\u7b80\u6d01\u3002\u8bf7\u8bb0\u4f4f\uff0c\u5728\u6bcf\u4e2a\u4f7f\u7528\u7684\u5730\u65b9\u90fd\u5b8c\u6574\u6807\u8bc6\u4e86\u8be5\u540d\u79f0\u3002</li> <li>\u4e0d\u7528\u590d\u6570\u3002\u4f8b\u5982<code>net/url</code>\uff0c\u800c\u4e0d\u662f<code>net/urls</code>\u3002</li> <li>\u4e0d\u8981\u7528\u201ccommon\u201d\uff0c\u201cutil\u201d\uff0c\u201cshared\u201d\u6216\u201clib\u201d\u3002\u8fd9\u4e9b\u662f\u4e0d\u597d\u7684\uff0c\u4fe1\u606f\u91cf\u4e0d\u8db3\u7684\u540d\u79f0\u3002</li> </ul> <p>\u53e6\u8bf7\u53c2\u9605 Go \u5305\u547d\u540d\u89c4\u5219 \u548c Go \u5305\u6837\u5f0f\u6307\u5357.</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/#_5","title":"\u516d \u51fd\u6570\u540d","text":"<p>\u6211\u4eec\u9075\u5faa Go \u793e\u533a\u5173\u4e8e\u4f7f\u7528 MixedCaps \u4f5c\u4e3a\u51fd\u6570\u540d \u7684\u7ea6\u5b9a\u3002\u6709\u4e00\u4e2a\u4f8b\u5916\uff0c\u4e3a\u4e86\u5bf9\u76f8\u5173\u7684\u6d4b\u8bd5\u7528\u4f8b\u8fdb\u884c\u5206\u7ec4\uff0c\u51fd\u6570\u540d\u53ef\u80fd\u5305\u542b\u4e0b\u5212\u7ebf\uff0c\u5982\uff1a<code>TestMyFunction_WhatIsBeingTested</code>.</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u89c4\u830302","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/#golang02","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u89c4\u830302","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/#_1","title":"\u4e00 \u5bfc\u5165\u522b\u540d","text":"<p>\u5982\u679c\u7a0b\u5e8f\u5305\u540d\u79f0\u4e0e\u5bfc\u5165\u8def\u5f84\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e0d\u5339\u914d\uff0c\u5219\u5fc5\u987b\u4f7f\u7528\u5bfc\u5165\u522b\u540d\u3002</p> <pre><code>import (\n  \"net/http\"\n\n  client \"example.com/client-go\"\n  trace \"example.com/trace/v2\"\n)\n</code></pre> <p>\u5728\u6240\u6709\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c\u9664\u975e\u5bfc\u5165\u4e4b\u95f4\u6709\u76f4\u63a5\u51b2\u7a81\uff0c\u5426\u5219\u5e94\u907f\u514d\u5bfc\u5165\u522b\u540d\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>import (\n  \"fmt\"\n  \"os\"\n\n  nettrace \"golang.net/x/trace\"\n)\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>import (\n  \"fmt\"\n  \"os\"\n  \"runtime/trace\"\n\n  nettrace \"golang.net/x/trace\"\n)\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/#_2","title":"\u4e8c \u51fd\u6570\u5206\u7ec4\u4e0e\u987a\u5e8f","text":"<ul> <li>\u51fd\u6570\u5e94\u6309\u7c97\u7565\u7684\u8c03\u7528\u987a\u5e8f\u6392\u5e8f\u3002</li> <li>\u540c\u4e00\u6587\u4ef6\u4e2d\u7684\u51fd\u6570\u5e94\u6309\u63a5\u6536\u8005\u5206\u7ec4\u3002</li> </ul> <p>\u56e0\u6b64\uff0c\u5bfc\u51fa\u7684\u51fd\u6570\u5e94\u5148\u51fa\u73b0\u5728\u6587\u4ef6\u4e2d\uff0c\u653e\u5728<code>struct</code>, <code>const</code>, <code>var</code>\u5b9a\u4e49\u7684\u540e\u9762\u3002</p> <p>\u5728\u5b9a\u4e49\u7c7b\u578b\u4e4b\u540e\uff0c\u4f46\u5728\u63a5\u6536\u8005\u7684\u5176\u4f59\u65b9\u6cd5\u4e4b\u524d\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e00\u4e2a <code>newXYZ()</code>/<code>NewXYZ()</code></p> <p>\u7531\u4e8e\u51fd\u6570\u662f\u6309\u63a5\u6536\u8005\u5206\u7ec4\u7684\uff0c\u56e0\u6b64\u666e\u901a\u5de5\u5177\u51fd\u6570\u5e94\u5728\u6587\u4ef6\u672b\u5c3e\u51fa\u73b0\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>func (s *something) Cost() {\n  return calcCost(s.weights)\n}\n\ntype something struct{ ... }\n\nfunc calcCost(n []int) int {...}\n\nfunc (s *something) Stop() {...}\n\nfunc newSomething() *something {\n    return &amp;something{}\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>type something struct{ ... }\n\nfunc newSomething() *something {\n    return &amp;something{}\n}\n\nfunc (s *something) Cost() {\n  return calcCost(s.weights)\n}\n\nfunc (s *something) Stop() {...}\n\nfunc calcCost(n []int) int {...}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/#_3","title":"\u4e09 \u51cf\u5c11\u5d4c\u5957","text":"<p>\u4ee3\u7801\u5e94\u901a\u8fc7\u5c3d\u53ef\u80fd\u5148\u5904\u7406\u9519\u8bef\u60c5\u51b5/\u7279\u6b8a\u60c5\u51b5\u5e76\u5c3d\u65e9\u8fd4\u56de\u6216\u7ee7\u7eed\u5faa\u73af\u6765\u51cf\u5c11\u5d4c\u5957\u3002\u51cf\u5c11\u5d4c\u5957\u591a\u4e2a\u7ea7\u522b\u7684\u4ee3\u7801\u7684\u4ee3\u7801\u91cf\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>for _, v := range data {\n  if v.F1 == 1 {\n    v = process(v)\n    if err := v.Call(); err == nil {\n      v.Send()\n    } else {\n      return err\n    }\n  } else {\n    log.Printf(\"Invalid v: %v\", v)\n  }\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>for _, v := range data {\n  if v.F1 != 1 {\n    log.Printf(\"Invalid v: %v\", v)\n    continue\n  }\n\n  v = process(v)\n  if err := v.Call(); err != nil {\n    return err\n  }\n  v.Send()\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/#else","title":"\u56db \u4e0d\u5fc5\u8981\u7684else","text":"<p>\u5982\u679c\u5728 if \u7684\u4e24\u4e2a\u5206\u652f\u4e2d\u90fd\u8bbe\u7f6e\u4e86\u53d8\u91cf\uff0c\u5219\u53ef\u4ee5\u5c06\u5176\u66ff\u6362\u4e3a\u5355\u4e2a if\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>var a int\nif b {\n  a = 100\n} else {\n  a = 10\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>a := 10\nif b {\n  a = 100\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/#_4","title":"\u4e94 \u9876\u5c42\u53d8\u91cf\u58f0\u660e","text":"<p>\u5728\u9876\u5c42\uff0c\u4f7f\u7528\u6807\u51c6<code>var</code>\u5173\u952e\u5b57\u3002\u8bf7\u52ff\u6307\u5b9a\u7c7b\u578b\uff0c\u9664\u975e\u5b83\u4e0e\u8868\u8fbe\u5f0f\u7684\u7c7b\u578b\u4e0d\u540c\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>var _s string = F()\n\nfunc F() string { return \"A\" }\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>var _s = F()\n// \u7531\u4e8e F \u5df2\u7ecf\u660e\u786e\u4e86\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u56e0\u6b64\u6211\u4eec\u6ca1\u6709\u5fc5\u8981\u663e\u5f0f\u6307\u5b9a_s \u7684\u7c7b\u578b\n// \u8fd8\u662f\u90a3\u79cd\u7c7b\u578b\n\nfunc F() string { return \"A\" }\n</code></pre> <p>\u5982\u679c\u8868\u8fbe\u5f0f\u7684\u7c7b\u578b\u4e0e\u6240\u9700\u7684\u7c7b\u578b\u4e0d\u5b8c\u5168\u5339\u914d\uff0c\u8bf7\u6307\u5b9a\u7c7b\u578b\u3002</p> <pre><code>type myError struct{}\n\nfunc (myError) Error() string { return \"error\" }\n\nfunc F() myError { return myError{} }\n\nvar _e error = F()\n// F \u8fd4\u56de\u4e00\u4e2a myError \u7c7b\u578b\u7684\u5b9e\u4f8b\uff0c\u4f46\u662f\u6211\u4eec\u8981 error \u7c7b\u578b\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/#_","title":"\u516d \u5bf9\u4e8e\u672a\u5bfc\u51fa\u7684\u9876\u5c42\u5e38\u91cf\u548c\u53d8\u91cf\uff0c\u4f7f\u7528_\u4f5c\u4e3a\u524d\u7f00","text":"<p>\u5728\u672a\u5bfc\u51fa\u7684\u9876\u7ea7<code>vars</code>\u548c<code>consts</code>\uff0c \u524d\u9762\u52a0\u4e0a\u524d\u7f00_\uff0c\u4ee5\u4f7f\u5b83\u4eec\u5728\u4f7f\u7528\u65f6\u660e\u786e\u8868\u793a\u5b83\u4eec\u662f\u5168\u5c40\u7b26\u53f7\u3002</p> <p>\u4f8b\u5916\uff1a\u672a\u5bfc\u51fa\u7684\u9519\u8bef\u503c\uff0c\u5e94\u4ee5<code>err</code>\u5f00\u5934\u3002</p> <p>\u57fa\u672c\u4f9d\u636e\uff1a\u9876\u7ea7\u53d8\u91cf\u548c\u5e38\u91cf\u5177\u6709\u5305\u8303\u56f4\u4f5c\u7528\u57df\u3002\u4f7f\u7528\u901a\u7528\u540d\u79f0\u53ef\u80fd\u5f88\u5bb9\u6613\u5728\u5176\u4ed6\u6587\u4ef6\u4e2d\u610f\u5916\u4f7f\u7528\u9519\u8bef\u7684\u503c\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>// foo.go\n\nconst (\n  defaultPort = 8080\n  defaultUser = \"user\"\n)\n\n// bar.go\n\nfunc Bar() {\n  defaultPort := 9090\n  ...\n  fmt.Println(\"Default port\", defaultPort)\n\n  // We will not see a compile error if the first line of\n  // Bar() is deleted.\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// foo.go\n\nconst (\n  _defaultPort = 8080\n  _defaultUser = \"user\"\n)\n</code></pre> <p>Exception:\u672a\u5bfc\u51fa\u7684\u9519\u8bef\u503c\u53ef\u4ee5\u4f7f\u7528\u4e0d\u5e26\u4e0b\u5212\u7ebf\u7684\u524d\u7f00 <code>err</code>\u3002 \u53c2\u89c1\u9519\u8bef\u547d\u540d\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/#_5","title":"\u4e03 \u7ed3\u6784\u4f53\u4e2d\u7684\u5d4c\u5165","text":"<p>\u5d4c\u5165\u5f0f\u7c7b\u578b\uff08\u4f8b\u5982 mutex\uff09\u5e94\u4f4d\u4e8e\u7ed3\u6784\u4f53\u5185\u7684\u5b57\u6bb5\u5217\u8868\u7684\u9876\u90e8\uff0c\u5e76\u4e14\u5fc5\u987b\u6709\u4e00\u4e2a\u7a7a\u884c\u5c06\u5d4c\u5165\u5f0f\u5b57\u6bb5\u4e0e\u5e38\u89c4\u5b57\u6bb5\u5206\u9694\u5f00\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>type Client struct {\n  version int\n  http.Client\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>type Client struct {\n  http.Client\n\n  version int\n}\n</code></pre> <p>\u5185\u5d4c\u5e94\u8be5\u63d0\u4f9b\u5207\u5b9e\u7684\u597d\u5904\uff0c\u6bd4\u5982\u4ee5\u8bed\u4e49\u4e0a\u5408\u9002\u7684\u65b9\u5f0f\u6dfb\u52a0\u6216\u589e\u5f3a\u529f\u80fd\u3002 \u5b83\u5e94\u8be5\u5728\u5bf9\u7528\u6237\u6ca1\u6709\u4efb\u4f55\u4e0d\u5229\u5f71\u54cd\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u3002\uff08\u53e6\u8bf7\u53c2\u89c1\uff1a\u907f\u514d\u5728\u516c\u5171\u7ed3\u6784\u4e2d\u5d4c\u5165\u7c7b\u578b\uff09\u3002</p> <p>\u4f8b\u5916\uff1a\u5373\u4f7f\u5728\u672a\u5bfc\u51fa\u7c7b\u578b\u4e2d\uff0cMutex \u4e5f\u4e0d\u5e94\u8be5\u4f5c\u4e3a\u5185\u5d4c\u5b57\u6bb5\u3002\u53e6\u8bf7\u53c2\u89c1\uff1a\u96f6\u503c Mutex \u662f\u6709\u6548\u7684\u3002</p> <p>\u5d4c\u5165 \u4e0d\u5e94\u8be5:</p> <ul> <li>\u7eaf\u7cb9\u662f\u4e3a\u4e86\u7f8e\u89c2\u6216\u65b9\u4fbf\u3002</li> <li>\u4f7f\u5916\u90e8\u7c7b\u578b\u66f4\u96be\u6784\u9020\u6216\u4f7f\u7528\u3002</li> <li>\u5f71\u54cd\u5916\u90e8\u7c7b\u578b\u7684\u96f6\u503c\u3002\u5982\u679c\u5916\u90e8\u7c7b\u578b\u6709\u4e00\u4e2a\u6709\u7528\u7684\u96f6\u503c\uff0c\u5219\u5728\u5d4c\u5165\u5185\u90e8\u7c7b\u578b\u4e4b\u540e\u5e94\u8be5\u4ecd\u7136\u6709\u4e00\u4e2a\u6709\u7528\u7684\u96f6\u503c\u3002</li> <li>\u4f5c\u4e3a\u5d4c\u5165\u5185\u90e8\u7c7b\u578b\u7684\u526f\u4f5c\u7528\uff0c\u4ece\u5916\u90e8\u7c7b\u578b\u516c\u5f00\u4e0d\u76f8\u5173\u7684\u51fd\u6570\u6216\u5b57\u6bb5\u3002</li> <li>\u516c\u5f00\u672a\u5bfc\u51fa\u7684\u7c7b\u578b\u3002</li> <li>\u5f71\u54cd\u5916\u90e8\u7c7b\u578b\u7684\u590d\u5236\u5f62\u5f0f\u3002</li> <li>\u66f4\u6539\u5916\u90e8\u7c7b\u578b\u7684 API \u6216\u7c7b\u578b\u8bed\u4e49\u3002</li> <li>\u5d4c\u5165\u5185\u90e8\u7c7b\u578b\u7684\u975e\u89c4\u8303\u5f62\u5f0f\u3002</li> <li>\u516c\u5f00\u5916\u90e8\u7c7b\u578b\u7684\u5b9e\u73b0\u8be6\u7ec6\u4fe1\u606f\u3002</li> <li>\u5141\u8bb8\u7528\u6237\u89c2\u5bdf\u6216\u63a7\u5236\u7c7b\u578b\u5185\u90e8\u3002</li> <li>\u901a\u8fc7\u5305\u88c5\u7684\u65b9\u5f0f\u6539\u53d8\u5185\u90e8\u51fd\u6570\u7684\u4e00\u822c\u884c\u4e3a\uff0c\u8fd9\u79cd\u5305\u88c5\u65b9\u5f0f\u4f1a\u7ed9\u7528\u6237\u5e26\u6765\u4e00\u4e9b\u610f\u6599\u4e4b\u5916\u60c5\u51b5\u3002</li> </ul> <p>\u7b80\u5355\u5730\u8bf4\uff0c\u6709\u610f\u8bc6\u5730\u548c\u6709\u76ee\u7684\u5730\u5d4c\u5165\u3002\u4e00\u79cd\u5f88\u597d\u7684\u6d4b\u8bd5\u4f53\u9a8c\u662f\uff0c \"\u662f\u5426\u6240\u6709\u8fd9\u4e9b\u5bfc\u51fa\u7684\u5185\u90e8\u65b9\u6cd5/\u5b57\u6bb5\u90fd\u5c06\u76f4\u63a5\u6dfb\u52a0\u5230\u5916\u90e8\u7c7b\u578b\" \u5982\u679c\u7b54\u6848\u662f<code>some</code>\u6216<code>no</code>\uff0c\u4e0d\u8981\u5d4c\u5165\u5185\u90e8\u7c7b\u578b - \u800c\u662f\u4f7f\u7528\u5b57\u6bb5\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>type A struct {\n    // Bad: A.Lock() and A.Unlock() \u73b0\u5728\u53ef\u7528\n    // \u4e0d\u63d0\u4f9b\u4efb\u4f55\u529f\u80fd\u6027\u597d\u5904\uff0c\u5e76\u5141\u8bb8\u7528\u6237\u63a7\u5236\u6709\u5173 A \u7684\u5185\u90e8\u7ec6\u8282\u3002\n    sync.Mutex\n}\n\ntype Book struct {\n    // Bad: \u6307\u9488\u66f4\u6539\u96f6\u503c\u7684\u6709\u7528\u6027\n    io.ReadWriter\n    // other fields\n}\n// later\nvar b Book\nb.Read(...)  // panic: nil pointer\nb.String()   // panic: nil pointer\nb.Write(...) // panic: nil pointer\n\ntype Client struct {\n    sync.Mutex\n    sync.WaitGroup\n    bytes.Buffer\n    url.URL\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>type countingWriteCloser struct {\n    // Good: Write() \u5728\u5916\u5c42\u63d0\u4f9b\u7528\u4e8e\u7279\u5b9a\u76ee\u7684\uff0c\n    // \u5e76\u4e14\u59d4\u6258\u5de5\u4f5c\u5230\u5185\u90e8\u7c7b\u578b\u7684 Write() \u4e2d\u3002\n    io.WriteCloser\n    count int\n}\nfunc (w *countingWriteCloser) Write(bs []byte) (int, error) {\n    w.count += len(bs)\n    return w.WriteCloser.Write(bs)\n}\n\ntype Book struct {\n    // Good: \u6709\u7528\u7684\u96f6\u503c\n    bytes.Buffer\n    // other fields\n}\n// later\nvar b Book\nb.Read(...)  // ok\nb.String()   // ok\nb.Write(...) // ok\n\ntype Client struct {\n    mtx sync.Mutex\n    wg  sync.WaitGroup\n    buf bytes.Buffer\n    url url.URL\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u89c4\u830303","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/#golang03","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u89c4\u830303","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/#_1","title":"\u4e00 \u4f7f\u7528\u5b57\u6bb5\u540d\u521d\u59cb\u5316\u7ed3\u6784\u4f53","text":"<p>\u521d\u59cb\u5316\u7ed3\u6784\u4f53\u65f6\uff0c\u5e94\u8be5\u6307\u5b9a\u5b57\u6bb5\u540d\u79f0\u3002\u73b0\u5728\u7531 <code>go vet</code> \u5f3a\u5236\u6267\u884c\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>k := User{\"John\", \"Doe\", true}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>k := User{\n    FirstName: \"John\",\n    LastName: \"Doe\",\n    Admin: true,\n}\n</code></pre> <p>\u4f8b\u5916\uff1a\u5982\u679c\u6709 3 \u4e2a\u6216\u66f4\u5c11\u7684\u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u5728\u6d4b\u8bd5\u8868\u4e2d\u7701\u7565\u5b57\u6bb5\u540d\u79f0\u3002</p> <pre><code>tests := []struct{\n  op Operation\n  want string\n}{\n  {Add, \"add\"},\n  {Subtract, \"subtract\"},\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/#_2","title":"\u4e8c \u672c\u5730\u53d8\u91cf\u58f0\u660e","text":"<p>\u5982\u679c\u5c06\u53d8\u91cf\u660e\u786e\u8bbe\u7f6e\u4e3a\u67d0\u4e2a\u503c\uff0c\u5219\u5e94\u4f7f\u7528\u77ed\u53d8\u91cf\u58f0\u660e\u5f62\u5f0f (<code>:=</code>)\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>var s = \"foo\"\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>s := \"foo\"\n</code></pre> <p>\u4f46\u662f\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c<code>var</code> \u4f7f\u7528\u5173\u952e\u5b57\u65f6\u9ed8\u8ba4\u503c\u4f1a\u66f4\u6e05\u6670\u3002\u4f8b\u5982\uff0c\u58f0\u660e\u7a7a\u5207\u7247\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>func f(list []int) {\n  filtered := []int{}\n  for _, v := range list {\n    if v &gt; 10 {\n      filtered = append(filtered, v)\n    }\n  }\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>func f(list []int) {\n  var filtered []int\n  for _, v := range list {\n    if v &gt; 10 {\n      filtered = append(filtered, v)\n    }\n  }\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/#nil-slice","title":"\u4e09 nil \u662f\u4e00\u4e2a\u6709\u6548\u7684 slice","text":"<p><code>nil</code> \u662f\u4e00\u4e2a\u6709\u6548\u7684\u957f\u5ea6\u4e3a 0 \u7684 slice\uff0c\u8fd9\u610f\u5473\u7740\uff0c</p> <ol> <li> <p>\u60a8\u4e0d\u5e94\u660e\u786e\u8fd4\u56de\u957f\u5ea6\u4e3a\u96f6\u7684\u5207\u7247\u3002\u5e94\u8be5\u8fd4\u56de<code>nil</code> \u6765\u4ee3\u66ff\u3002</p> </li> <li> <p>Bad</p> </li> </ol> <pre><code>if x == \"\" {\n  return []int{}\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>if x == \"\" {\n  return nil\n}\n</code></pre> <ol> <li> <p>\u8981\u68c0\u67e5\u5207\u7247\u662f\u5426\u4e3a\u7a7a\uff0c\u8bf7\u59cb\u7ec8\u4f7f\u7528<code>len(s) == 0</code>\u3002\u800c\u975e <code>nil</code>\u3002</p> </li> <li> <p>Bad</p> </li> </ol> <pre><code>func isEmpty(s []string) bool {\n  return s == nil\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>func isEmpty(s []string) bool {\n  return len(s) == 0\n}\n</code></pre> <ol> <li> <p>\u96f6\u503c\u5207\u7247\uff08\u7528<code>var</code>\u58f0\u660e\u7684\u5207\u7247\uff09\u53ef\u7acb\u5373\u4f7f\u7528\uff0c\u65e0\u9700\u8c03\u7528<code>make()</code>\u521b\u5efa\u3002</p> </li> <li> <p>Bad</p> </li> </ol> <pre><code>nums := []int{}\n// or, nums := make([]int)\n\nif add1 {\n  nums = append(nums, 1)\n}\n\nif add2 {\n  nums = append(nums, 2)\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>var nums []int\n\nif add1 {\n  nums = append(nums, 1)\n}\n\nif add2 {\n  nums = append(nums, 2)\n}\n</code></pre> <p>\u8bb0\u4f4f\uff0c\u867d\u7136 nil \u5207\u7247\u662f\u6709\u6548\u7684\u5207\u7247\uff0c\u4f46\u5b83\u4e0d\u7b49\u4e8e\u957f\u5ea6\u4e3a 0 \u7684\u5207\u7247\uff08\u4e00\u4e2a\u4e3a nil\uff0c\u53e6\u4e00\u4e2a\u4e0d\u662f\uff09\uff0c\u5e76\u4e14\u5728\u4e0d\u540c\u7684\u60c5\u51b5\u4e0b\uff08\u4f8b\u5982\u5e8f\u5217\u5316\uff09\uff0c\u8fd9\u4e24\u4e2a\u5207\u7247\u7684\u5904\u7406\u65b9\u5f0f\u53ef\u80fd\u4e0d\u540c\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/#_3","title":"\u56db \u7f29\u5c0f\u53d8\u91cf\u4f5c\u7528\u57df","text":"<p>\u5982\u679c\u6709\u53ef\u80fd\uff0c\u5c3d\u91cf\u7f29\u5c0f\u53d8\u91cf\u4f5c\u7528\u8303\u56f4\u3002\u9664\u975e\u5b83\u4e0e \u51cf\u5c11\u5d4c\u5957\u7684\u89c4\u5219\u51b2\u7a81\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>err := ioutil.WriteFile(name, data, 0644)\nif err != nil {\n return err\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>if err := ioutil.WriteFile(name, data, 0644); err != nil {\n return err\n}\n</code></pre> <p>\u5982\u679c\u9700\u8981\u5728 if \u4e4b\u5916\u4f7f\u7528\u51fd\u6570\u8c03\u7528\u7684\u7ed3\u679c\uff0c\u5219\u4e0d\u5e94\u5c1d\u8bd5\u7f29\u5c0f\u8303\u56f4\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>if data, err := ioutil.ReadFile(name); err == nil {\n  err = cfg.Decode(data)\n  if err != nil {\n    return err\n  }\n\n  fmt.Println(cfg)\n  return nil\n} else {\n  return err\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>data, err := ioutil.ReadFile(name)\nif err != nil {\n   return err\n}\n\nif err := cfg.Decode(data); err != nil {\n  return err\n}\n\nfmt.Println(cfg)\nreturn nil\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/#avoid-naked-parameters","title":"\u4e94 \u907f\u514d\u53c2\u6570\u8bed\u4e49\u4e0d\u660e\u786e (Avoid Naked Parameters)","text":"<p>\u51fd\u6570\u8c03\u7528\u4e2d\u7684<code>\u610f\u4e49\u4e0d\u660e\u786e\u7684\u53c2\u6570</code>\u53ef\u80fd\u4f1a\u635f\u5bb3\u53ef\u8bfb\u6027\u3002\u5f53\u53c2\u6570\u540d\u79f0\u7684\u542b\u4e49\u4e0d\u660e\u663e\u65f6\uff0c\u8bf7\u4e3a\u53c2\u6570\u6dfb\u52a0 C \u6837\u5f0f\u6ce8\u91ca (<code>/* ... */</code>)</p> <ul> <li>Bad</li> </ul> <pre><code>// func printInfo(name string, isLocal, done bool)\n\nprintInfo(\"foo\", true, true)\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>// func printInfo(name string, isLocal, done bool)\n\nprintInfo(\"foo\", true /* isLocal */, true /* done */)\n</code></pre> <p>\u5bf9\u4e8e\u4e0a\u9762\u7684\u793a\u4f8b\u4ee3\u7801\uff0c\u8fd8\u6709\u4e00\u79cd\u66f4\u597d\u7684\u5904\u7406\u65b9\u5f0f\u662f\u5c06\u4e0a\u9762\u7684 <code>bool</code> \u7c7b\u578b\u6362\u6210\u81ea\u5b9a\u4e49\u7c7b\u578b\u3002\u5c06\u6765\uff0c\u8be5\u53c2\u6570\u53ef\u4ee5\u652f\u6301\u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8e\u4e24\u4e2a\u72b6\u6001\uff08true/false\uff09\u3002</p> <pre><code>type Region int\n\nconst (\n  UnknownRegion Region = iota\n  Local\n)\n\ntype Status int\n\nconst (\n  StatusReady Status= iota + 1\n  StatusDone\n  // Maybe we will have a StatusInProgress in the future.\n)\n\nfunc printInfo(name string, region Region, status Status)\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/#_4","title":"\u516d \u4f7f\u7528\u539f\u59cb\u5b57\u7b26\u4e32\u5b57\u9762\u503c\uff0c\u907f\u514d\u8f6c\u4e49","text":"<p>Go \u652f\u6301\u4f7f\u7528 \u539f\u59cb\u5b57\u7b26\u4e32\u5b57\u9762\u503c\uff0c\u4e5f\u5c31\u662f \" ` \" \u6765\u8868\u793a\u539f\u751f\u5b57\u7b26\u4e32\uff0c\u5728\u9700\u8981\u8f6c\u4e49\u7684\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5e94\u8be5\u5c3d\u91cf\u4f7f\u7528\u8fd9\u79cd\u65b9\u6848\u6765\u66ff\u6362\u3002</p> <p>\u53ef\u4ee5\u8de8\u8d8a\u591a\u884c\u5e76\u5305\u542b\u5f15\u53f7\u3002\u4f7f\u7528\u8fd9\u4e9b\u5b57\u7b26\u4e32\u53ef\u4ee5\u907f\u514d\u66f4\u96be\u9605\u8bfb\u7684\u624b\u5de5\u8f6c\u4e49\u7684\u5b57\u7b26\u4e32\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>wantError := \"unknown name:\\\"test\\\"\"\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>wantError := `unknown error:\"test\"`\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u89c4\u830304","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/#golang04","title":"Golang\u7f16\u7801\u89c4\u8303\u4e4b\u89c4\u830304","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/#_1","title":"\u4e00 \u521d\u59cb\u5316\u7ed3\u6784\u4f53","text":""},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/#11","title":"1.1 \u4f7f\u7528\u5b57\u6bb5\u540d\u521d\u59cb\u5316\u7ed3\u6784","text":"<p>\u521d\u59cb\u5316\u7ed3\u6784\u65f6\uff0c\u51e0\u4e4e\u5e94\u8be5\u59cb\u7ec8\u6307\u5b9a\u5b57\u6bb5\u540d\u3002\u76ee\u524d\u7531 <code>go vet</code> \u5f3a\u5236\u6267\u884c\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>k := User{\"John\", \"Doe\", true}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>k := User{\n    FirstName: \"John\",\n    LastName: \"Doe\",\n    Admin: true,\n}\n</code></pre> <p>\u4f8b\u5916\uff1a\u5f53\u6709 3 \u4e2a\u6216\u66f4\u5c11\u7684\u5b57\u6bb5\u65f6\uff0c\u6d4b\u8bd5\u8868\u4e2d\u7684\u5b57\u6bb5\u540d*may*\u53ef\u4ee5\u7701\u7565\u3002</p> <pre><code>tests := []struct{\n  op Operation\n  want string\n}{\n  {Add, \"add\"},\n  {Subtract, \"subtract\"},\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/#12","title":"1.2 \u7701\u7565\u7ed3\u6784\u4e2d\u7684\u96f6\u503c\u5b57\u6bb5","text":"<p>\u521d\u59cb\u5316\u5177\u6709\u5b57\u6bb5\u540d\u7684\u7ed3\u6784\u65f6\uff0c\u9664\u975e\u63d0\u4f9b\u6709\u610f\u4e49\u7684\u4e0a\u4e0b\u6587\uff0c\u5426\u5219\u5ffd\u7565\u503c\u4e3a\u96f6\u7684\u5b57\u6bb5\u3002 \u4e5f\u5c31\u662f\uff0c\u8ba9\u6211\u4eec\u81ea\u52a8\u5c06\u8fd9\u4e9b\u8bbe\u7f6e\u4e3a\u96f6\u503c</p> <ul> <li>Bad</li> </ul> <pre><code>user := User{\n  FirstName: \"John\",\n  LastName: \"Doe\",\n  MiddleName: \"\",\n  Admin: false,\n}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>user := User{\n  FirstName: \"John\",\n  LastName: \"Doe\",\n}\n</code></pre> <p>\u8fd9\u6709\u52a9\u4e8e\u901a\u8fc7\u7701\u7565\u8be5\u4e0a\u4e0b\u6587\u4e2d\u7684\u9ed8\u8ba4\u503c\u6765\u51cf\u5c11\u9605\u8bfb\u7684\u969c\u788d\u3002\u53ea\u6307\u5b9a\u6709\u610f\u4e49\u7684\u503c\u3002</p> <p>\u5728\u5b57\u6bb5\u540d\u63d0\u4f9b\u6709\u610f\u4e49\u4e0a\u4e0b\u6587\u7684\u5730\u65b9\u5305\u542b\u96f6\u503c\u3002\u4f8b\u5982\uff0c\u8868\u9a71\u52a8\u6d4b\u8bd5 \u4e2d\u7684\u6d4b\u8bd5\u7528\u4f8b\u53ef\u4ee5\u53d7\u76ca\u4e8e\u5b57\u6bb5\u7684\u540d\u79f0\uff0c\u5373\u4f7f\u5b83\u4eec\u662f\u96f6\u503c\u7684\u3002</p> <pre><code>tests := []struct{\n  give string\n  want int\n}{\n  {give: \"0\", want: 0},\n  // ...\n}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/#13-var","title":"1..3 \u5bf9\u96f6\u503c\u7ed3\u6784\u4f7f\u7528 <code>var</code>","text":"<p>\u5982\u679c\u5728\u58f0\u660e\u4e2d\u7701\u7565\u4e86\u7ed3\u6784\u7684\u6240\u6709\u5b57\u6bb5\uff0c\u8bf7\u4f7f\u7528 <code>var</code> \u58f0\u660e\u7ed3\u6784\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>user := User{}\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>var user User\n</code></pre> <p>\u8fd9\u5c06\u96f6\u503c\u7ed3\u6784\u4e0e\u90a3\u4e9b\u5177\u6709\u7c7b\u4f3c\u4e8e\u4e3a \u521d\u59cb\u5316 Maps \u521b\u5efa\u7684\uff0c\u533a\u522b\u4e8e\u975e\u96f6\u503c\u5b57\u6bb5\u7684\u7ed3\u6784\u533a\u5206\u5f00\u6765\uff0c \u5e76\u4e0e\u6211\u4eec\u66f4\u559c\u6b22\u7684 \u58f0\u660e\u7a7a\u5207\u7247 \u65b9\u5f0f\u76f8\u5339\u914d\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/#14-struct","title":"1.4 \u521d\u59cb\u5316 Struct \u5f15\u7528","text":"<p>\u5728\u521d\u59cb\u5316\u7ed3\u6784\u5f15\u7528\u65f6\uff0c\u8bf7\u4f7f\u7528<code>&amp;T{}</code>\u4ee3\u66ff<code>new(T)</code>\uff0c\u4ee5\u4f7f\u5176\u4e0e\u7ed3\u6784\u4f53\u521d\u59cb\u5316\u4e00\u81f4\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>sval := T{Name: \"foo\"}\n\n// inconsistent\nsptr := new(T)\nsptr.Name = \"bar\"\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>sval := T{Name: \"foo\"}\n\nsptr := &amp;T{Name: \"bar\"}\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/#maps","title":"\u4e8c \u521d\u59cb\u5316 Maps","text":"<p>\u5bf9\u4e8e\u7a7a map \u8bf7\u4f7f\u7528 <code>make(..)</code> \u521d\u59cb\u5316\uff0c \u5e76\u4e14 map \u662f\u901a\u8fc7\u7f16\u7a0b\u65b9\u5f0f\u586b\u5145\u7684\u3002 \u8fd9\u4f7f\u5f97 map \u521d\u59cb\u5316\u5728\u8868\u73b0\u4e0a\u4e0d\u540c\u4e8e\u58f0\u660e\uff0c\u5e76\u4e14\u5b83\u8fd8\u53ef\u4ee5\u65b9\u4fbf\u5730\u5728 make \u540e\u6dfb\u52a0\u5927\u5c0f\u63d0\u793a\u3002</p> <ul> <li>Bad</li> </ul> <p>\u58f0\u660e\u548c\u521d\u59cb\u5316\u770b\u8d77\u6765\u975e\u5e38\u76f8\u4f3c\u7684</p> <pre><code>var (\n  // m1 \u8bfb\u5199\u5b89\u5168;\n  // m2 \u5728\u5199\u5165\u65f6\u4f1a panic\n  m1 = map[T1]T2{}\n  m2 map[T1]T2\n)\n</code></pre> <ul> <li>Good</li> </ul> <p>\u58f0\u660e\u548c\u521d\u59cb\u5316\u770b\u8d77\u6765\u5dee\u522b\u975e\u5e38\u5927\u3002</p> <pre><code>var (\n  // m1 \u8bfb\u5199\u5b89\u5168;\n  // m2 \u5728\u5199\u5165\u65f6\u4f1a panic\n  m1 = make(map[T1]T2)\n  m2 map[T1]T2\n)\n</code></pre> <ul> <li>Bad</li> </ul> <pre><code>m := make(map[T1]T2, 3)\nm[k1] = v1\nm[k2] = v2\nm[k3] = v3\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>m := map[T1]T2{\n  k1: v1,\n  k2: v2,\n  k3: v3,\n}\n</code></pre> <p>\u57fa\u672c\u51c6\u5219\u662f\uff1a\u5728\u521d\u59cb\u5316\u65f6\u4f7f\u7528 map \u521d\u59cb\u5316\u5217\u8868 \u6765\u6dfb\u52a0\u4e00\u7ec4\u56fa\u5b9a\u7684\u5143\u7d20\u3002\u5426\u5219\u4f7f\u7528 <code>make</code> (\u5982\u679c\u53ef\u4ee5\uff0c\u8bf7\u5c3d\u91cf\u6307\u5b9a map \u5bb9\u91cf)\u3002</p>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/#string-format","title":"\u4e09 \u5b57\u7b26\u4e32 string format","text":"<p>\u5982\u679c\u4f60\u5728\u51fd\u6570\u5916\u58f0\u660e<code>Printf</code>-style \u51fd\u6570\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\uff0c\u8bf7\u5c06\u5176\u8bbe\u7f6e\u4e3a<code>const</code>\u5e38\u91cf\u3002</p> <p>\u8fd9\u6709\u52a9\u4e8e<code>go vet</code>\u5bf9\u683c\u5f0f\u5b57\u7b26\u4e32\u6267\u884c\u9759\u6001\u5206\u6790\u3002</p> <ul> <li>Bad</li> </ul> <pre><code>msg := \"unexpected values %v, %v\\n\"\nfmt.Printf(msg, 1, 2)\n</code></pre> <ul> <li>Good</li> </ul> <pre><code>const msg = \"unexpected values %v, %v\\n\"\nfmt.Printf(msg, 1, 2)\n</code></pre>"},{"location":"develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/#printf","title":"\u56db \u547d\u540d Printf \u6837\u5f0f\u7684\u51fd\u6570","text":"<p>\u58f0\u660e<code>Printf</code>-style \u51fd\u6570\u65f6\uff0c\u8bf7\u786e\u4fdd<code>go vet</code>\u53ef\u4ee5\u68c0\u6d4b\u5230\u5b83\u5e76\u68c0\u67e5\u683c\u5f0f\u5b57\u7b26\u4e32\u3002</p> <p>\u8fd9\u610f\u5473\u7740\u60a8\u5e94\u5c3d\u53ef\u80fd\u4f7f\u7528\u9884\u5b9a\u4e49\u7684<code>Printf</code>-style \u51fd\u6570\u540d\u79f0\u3002<code>go vet</code>\u5c06\u9ed8\u8ba4\u68c0\u67e5\u8fd9\u4e9b\u3002\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 Printf \u7cfb\u5217\u3002</p> <p>\u5982\u679c\u4e0d\u80fd\u4f7f\u7528\u9884\u5b9a\u4e49\u7684\u540d\u79f0\uff0c\u8bf7\u4ee5 f \u7ed3\u675f\u9009\u62e9\u7684\u540d\u79f0\uff1a<code>Wrapf</code>\uff0c\u800c\u4e0d\u662f<code>Wrap</code>\u3002<code>go vet</code>\u53ef\u4ee5\u8981\u6c42\u68c0\u67e5\u7279\u5b9a\u7684 Printf \u6837\u5f0f\u540d\u79f0\uff0c\u4f46\u540d\u79f0\u5fc5\u987b\u4ee5<code>f</code>\u7ed3\u5c3e\u3002</p> <pre><code>$ go vet -printfuncs=wrapf,statusf\n</code></pre> <p>\u53e6\u8bf7\u53c2\u9605 go vet: Printf family check.</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/","title":"\u8bbe\u8ba1\u6a21\u5f0f\u4e4b-\u521b\u5efa\u578b\u6a21\u5f0f","text":"<p>\u521b\u5efa\u578b\u8bbe\u8ba1\u6a21\u5f0f\u5305\u62ec\uff1a\u5355\u4f8b\u6a21\u5f0f\u3001\u5de5\u5382\u6a21\u5f0f\u3001\u5efa\u9020\u8005\u6a21\u5f0f\u3001\u539f\u578b\u6a21\u5f0f\u3002\u5b83\u4e3b\u8981\u89e3\u51b3\u5bf9\u8c61\u7684\u521b\u5efa\u95ee\u9898\uff0c\u5c01\u88c5\u590d\u6742\u7684\u521b\u5efa\u8fc7\u7a0b\uff0c\u89e3\u8026\u5bf9\u8c61\u7684\u521b\u5efa\u4ee3\u7801\u548c\u4f7f\u7528\u4ee3\u7801\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u5355\u4f8b\u6a21\u5f0f","text":"<p>\u5355\u4f8b\u6a21\u5f0f\u7528\u6765\u521b\u5efa\u5168\u5c40\u552f\u4e00\u7684\u5bf9\u8c61\u3002\u4e00\u4e2a\u7c7b\u53ea\u5141\u8bb8\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\uff08\u6216\u8005\u53eb\u5b9e\u4f8b\uff09\uff0c\u90a3\u8fd9\u4e2a\u7c7b\u5c31\u662f\u4e00\u4e2a\u5355\u4f8b\u7c7b\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u5c31\u53eb\u4f5c\u5355\u4f8b\u6a21\u5f0f\u3002\u5355\u4f8b\u6709\u51e0\u79cd\u7ecf\u5178\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5b83\u4eec\u5206\u522b\u662f\uff1a\u997f\u6c49\u5f0f\u3001\u61d2\u6c49\u5f0f\u3001\u53cc\u91cd\u68c0\u6d4b\u3001\u9759\u6001\u5185\u90e8\u7c7b\u3001\u679a\u4e3e\u3002</p> <p>\u5c3d\u7ba1\u5355\u4f8b\u662f\u4e00\u4e2a\u5f88\u5e38\u7528\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u4e5f\u786e\u5b9e\u7ecf\u5e38\u7528\u5230\u5b83\uff0c\u4f46\u662f\uff0c\u6709\u4e9b \u4eba\u8ba4\u4e3a\u5355\u4f8b\u662f\u4e00\u79cd\u53cd\u6a21\u5f0f\uff08anti-pattern\uff09\uff0c\u5e76\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c\u4e3b\u8981\u7684\u7406\u7531\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <ul> <li> <p>\u5355\u4f8b\u5bf9 OOP \u7279\u6027\u7684\u652f\u6301\u4e0d\u53cb\u597d </p> </li> <li> <p>\u5355\u4f8b\u4f1a\u9690\u85cf\u7c7b\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb </p> </li> <li> <p>\u5355\u4f8b\u5bf9\u4ee3\u7801\u7684\u6269\u5c55\u6027\u4e0d\u53cb\u597d </p> </li> <li> <p>\u5355\u4f8b\u5bf9\u4ee3\u7801\u7684\u53ef\u6d4b\u8bd5\u6027\u4e0d\u53cb\u597d </p> </li> <li> <p>\u5355\u4f8b\u4e0d\u652f\u6301\u6709\u53c2\u6570\u7684\u6784\u9020\u51fd\u6570</p> </li> </ul> <p>\u90a3\u6709\u4ec0\u4e48\u66ff\u4ee3\u5355\u4f8b\u7684\u89e3\u51b3\u65b9\u6848\u5462\uff1f\u5982\u679c\u8981\u5b8c\u5168\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u80fd\u8981\u4ece\u6839\u4e0a\u5bfb\u627e\u5176\u4ed6\u65b9 \u5f0f\u6765\u5b9e\u73b0\u5168\u5c40\u552f\u4e00\u7c7b\u3002\u6bd4\u5982\uff0c\u901a\u8fc7\u5de5\u5382\u6a21\u5f0f\u3001IOC \u5bb9\u5668\u6765\u4fdd\u8bc1\u5168\u5c40\u552f\u4e00\u6027\u3002 </p> <p>\u6709\u4eba\u628a\u5355\u4f8b\u5f53\u4f5c\u53cd\u6a21\u5f0f\uff0c\u4e3b\u5f20\u675c\u7edd\u5728\u9879\u76ee\u4e2d\u4f7f\u7528\u3002\u6211\u4e2a\u4eba\u89c9\u5f97\u8fd9\u6709\u70b9\u6781\u7aef\u3002\u6a21\u5f0f\u672c\u8eab\u6ca1\u6709\u5bf9 \u9519\uff0c\u5173\u952e\u770b\u4f60\u600e\u4e48\u7528\u3002\u5982\u679c\u5355\u4f8b\u7c7b\u5e76\u6ca1\u6709\u540e\u7eed\u6269\u5c55\u7684\u9700\u6c42\uff0c\u5e76\u4e14\u4e0d\u4f9d\u8d56\u5916\u90e8\u7cfb\u7edf\uff0c\u90a3\u8bbe\u8ba1\u6210 </p> <p>\u5355\u4f8b\u7c7b\u5c31\u6ca1\u6709\u592a\u5927\u95ee\u9898\u3002\u5bf9\u4e8e\u4e00\u4e9b\u5168\u5c40\u7c7b\uff0c\u6211\u4eec\u5728\u5176\u4ed6\u5730\u65b9 new \u7684\u8bdd\uff0c\u8fd8\u8981\u5728\u7c7b\u4e4b\u95f4\u4f20\u6765\u4f20\u53bb\uff0c\u4e0d\u5982\u76f4\u63a5\u505a\u6210\u5355\u4f8b\u7c7b\uff0c\u4f7f\u7528\u8d77\u6765\u7b80\u6d01\u65b9\u4fbf\u3002 </p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u5de5\u5382\u6a21\u5f0f","text":"<p>\u5de5\u5382\u6a21\u5f0f\u5305\u62ec\u7b80\u5355\u5de5\u5382\u3001\u5de5\u5382\u65b9\u6cd5\u3001\u62bd\u8c61\u5de5\u5382\u8fd9 3 \u79cd\u7ec6\u5206\u6a21\u5f0f\u3002\u5176\u4e2d\uff0c\u7b80\u5355\u5de5\u5382\u548c\u5de5\u5382\u65b9 \u6cd5\u6bd4\u8f83\u5e38\u7528\uff0c\u62bd\u8c61\u5de5\u5382\u7684\u5e94\u7528\u573a\u666f\u6bd4\u8f83\u7279\u6b8a\uff0c\u6240\u4ee5\u5f88\u5c11\u7528\u5230\uff0c\u4e0d\u662f\u6211\u4eec\u5b66\u4e60\u7684\u91cd\u70b9\u3002 </p> <p>\u5de5\u5382\u6a21\u5f0f\u7528\u6765\u521b\u5efa\u4e0d\u540c\u4f46\u662f\u76f8\u5173\u7c7b\u578b\u7684\u5bf9\u8c61\uff08\u7ee7\u627f\u540c\u4e00\u7236\u7c7b\u6216\u8005\u63a5\u53e3\u7684\u4e00\u7ec4\u5b50\u7c7b\uff09\uff0c\u7531\u7ed9\u5b9a \u7684\u53c2\u6570\u6765\u51b3\u5b9a\u521b\u5efa\u54ea\u79cd\u7c7b\u578b\u7684\u5bf9\u8c61\u3002\u5b9e\u9645\u4e0a\uff0c\u5982\u679c\u521b\u5efa\u5bf9\u8c61\u7684\u903b\u8f91\u5e76\u4e0d\u590d\u6742\uff0c\u90a3\u6211\u4eec\u76f4\u63a5\u901a\u8fc7 new \u6765\u521b\u5efa\u5bf9\u8c61\u5c31\u53ef\u4ee5\u4e86\uff0c\u4e0d\u9700\u8981\u4f7f\u7528\u5de5\u5382\u6a21\u5f0f\u3002\u5f53\u521b\u5efa\u903b\u8f91\u6bd4\u8f83\u590d\u6742\uff0c\u662f\u4e00\u4e2a\u201c\u5927\u5de5 \u7a0b\u201d\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u8003\u8651\u4f7f\u7528\u5de5\u5382\u6a21\u5f0f\uff0c\u5c01\u88c5\u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b\uff0c\u5c06\u5bf9\u8c61\u7684\u521b\u5efa\u548c\u4f7f\u7528\u76f8\u5206 \u79bb\u3002 </p> <p>\u5f53\u6bcf\u4e2a\u5bf9\u8c61\u7684\u521b\u5efa\u903b\u8f91\u90fd\u6bd4\u8f83\u7b80\u5355\u7684\u65f6\u5019\uff0c\u6211\u63a8\u8350\u4f7f\u7528\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\uff0c\u5c06\u591a\u4e2a\u5bf9\u8c61\u7684\u521b\u5efa\u903b \u8f91\u653e\u5230\u4e00\u4e2a\u5de5\u5382\u7c7b\u4e2d\u3002\u5f53\u6bcf\u4e2a\u5bf9\u8c61\u7684\u521b\u5efa\u903b\u8f91\u90fd\u6bd4\u8f83\u590d\u6742\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u907f\u514d\u8bbe\u8ba1\u4e00\u4e2a\u8fc7\u4e8e\u5e9e\u5927\u7684\u5de5\u5382\u7c7b\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\uff0c\u5c06\u521b\u5efa\u903b\u8f91\u62c6\u5206\u5f97\u66f4\u7ec6\uff0c\u6bcf\u4e2a\u5bf9\u8c61\u7684\u521b\u5efa\u903b\u8f91\u72ec \u7acb\u5230\u5404\u81ea\u7684\u5de5\u5382\u7c7b\u4e2d\u3002 \u8be6\u7ec6\u70b9\u8bf4\uff0c\u5de5\u5382\u6a21\u5f0f\u7684\u4f5c\u7528\u6709\u4e0b\u9762 4 \u4e2a\uff0c\u8fd9\u4e5f\u662f\u5224\u65ad\u8981\u4e0d\u8981\u4f7f\u7528\u5de5\u5382\u6a21\u5f0f\u6700\u672c\u8d28\u7684\u53c2\u8003\u6807\u51c6\u3002 </p> <ul> <li> <p>\u5c01\u88c5\u53d8\u5316\uff1a\u521b\u5efa\u903b\u8f91\u6709\u53ef\u80fd\u53d8\u5316\uff0c\u5c01\u88c5\u6210\u5de5\u5382\u7c7b\u4e4b\u540e\uff0c\u521b\u5efa\u903b\u8f91\u7684\u53d8\u66f4\u5bf9\u8c03\u7528\u8005\u900f\u660e\u3002 </p> </li> <li> <p>\u4ee3\u7801\u590d\u7528\uff1a \u521b\u5efa\u4ee3\u7801\u62bd\u79bb\u5230\u72ec\u7acb\u7684\u5de5\u5382\u7c7b\u4e4b\u540e\u53ef\u4ee5\u590d\u7528\u3002 </p> </li> <li> <p>\u9694\u79bb\u590d\u6742\u6027\uff1a\u5c01\u88c5\u590d\u6742\u7684\u521b\u5efa\u903b\u8f91\uff0c\u8c03\u7528\u8005\u65e0\u9700\u4e86\u89e3\u5982\u4f55\u521b\u5efa\u5bf9\u8c61\u3002 </p> </li> <li> <p>\u63a7\u5236\u590d\u6742\u5ea6\uff1a\u5c06\u521b\u5efa\u4ee3\u7801\u62bd\u79bb\u51fa\u6765\uff0c\u8ba9\u539f\u672c\u7684\u51fd\u6570\u6216\u7c7b\u804c\u8d23\u66f4\u5355\u4e00\uff0c\u4ee3\u7801\u66f4\u7b80\u6d01\u3002 </p> </li> </ul> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u8bb2\u4e86\u5de5\u5382\u6a21\u5f0f\u4e00\u4e2a\u975e\u5e38\u7ecf\u5178\u7684\u5e94\u7528\u573a\u666f\uff1a\u4f9d\u8d56\u6ce8\u5165\u6846\u67b6\uff0c\u6bd4\u5982 Spring IOC\u3001Google Guice\uff0c\u5b83\u7528\u6765\u96c6\u4e2d\u521b\u5efa\u3001\u7ec4\u88c5\u3001\u7ba1\u7406\u5bf9\u8c61\uff0c\u8ddf\u5177\u4f53\u4e1a\u52a1\u4ee3\u7801\u89e3\u8026\uff0c\u8ba9\u7a0b\u5e8f \u5458\u805a\u7126\u5728\u4e1a\u52a1\u4ee3\u7801\u7684\u5f00\u53d1\u4e0a\u3002DI \u6846\u67b6\u5df2\u7ecf\u6210\u4e3a\u4e86\u6211\u4eec\u5e73\u65f6\u5f00\u53d1\u7684\u5fc5\u5907\u6846\u67b6\uff0c\u5728\u4e13\u680f\u4e2d\uff0c\u6211\u8fd8\u5e26\u4f60\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684 DI \u6846\u67b6\uff0c\u4f60\u53ef\u4ee5\u518d\u56de\u8fc7\u5934\u53bb\u770b\u770b\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5efa\u9020\u8005\u6a21\u5f0f","text":"<p>\u5efa\u9020\u8005\u6a21\u5f0f\u7528\u6765\u521b\u5efa\u590d\u6742\u5bf9\u8c61\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4e0d\u540c\u7684\u53ef\u9009\u53c2\u6570\uff0c\u201c\u5b9a\u5236\u5316\u201d\u5730\u521b\u5efa\u4e0d\u540c\u7684\u5bf9 \u8c61\u3002\u5efa\u9020\u8005\u6a21\u5f0f\u7684\u539f\u7406\u548c\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355\uff0c\u91cd\u70b9\u662f\u638c\u63e1\u5e94\u7528\u573a\u666f\uff0c\u907f\u514d\u8fc7\u5ea6\u4f7f\u7528\u3002 \u5982\u679c\u4e00\u4e2a\u7c7b\u4e2d\u6709\u5f88\u591a\u5c5e\u6027\uff0c\u4e3a\u4e86\u907f\u514d\u6784\u9020\u51fd\u6570\u7684\u53c2\u6570\u5217\u8868\u8fc7\u957f\uff0c\u5f71\u54cd\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u6613\u7528\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u51fd\u6570\u914d\u5408 set() \u65b9\u6cd5\u6765\u89e3\u51b3\u3002\u4f46\u662f\uff0c\u5982\u679c\u5b58\u5728\u4e0b\u9762\u60c5\u51b5\u4e2d\u7684\u4efb\u610f\u4e00\u79cd\uff0c\u6211\u4eec\u5c31\u8981\u8003\u8651\u4f7f\u7528\u5efa\u9020\u8005\u6a21\u5f0f\u4e86\u3002</p> <ul> <li> <p>\u6211\u4eec\u628a\u7c7b\u7684\u5fc5\u586b\u5c5e\u6027\u653e\u5230\u6784\u9020\u51fd\u6570\u4e2d\uff0c\u5f3a\u5236\u521b\u5efa\u5bf9\u8c61\u7684\u65f6\u5019\u5c31\u8bbe\u7f6e\u3002\u5982\u679c\u5fc5\u586b\u7684\u5c5e\u6027\u6709 \u5f88\u591a\uff0c\u628a\u8fd9\u4e9b\u5fc5\u586b\u5c5e\u6027\u90fd\u653e\u5230\u6784\u9020\u51fd\u6570\u4e2d\u8bbe\u7f6e\uff0c\u90a3\u6784\u9020\u51fd\u6570\u5c31\u53c8\u4f1a\u51fa\u73b0\u53c2\u6570\u5217\u8868\u5f88\u957f\u7684 \u95ee\u9898\u3002\u5982\u679c\u6211\u4eec\u628a\u5fc5\u586b\u5c5e\u6027\u901a\u8fc7 set() \u65b9\u6cd5\u8bbe\u7f6e\uff0c\u90a3\u6821\u9a8c\u8fd9\u4e9b\u5fc5\u586b\u5c5e\u6027\u662f\u5426\u5df2\u7ecf\u586b\u5199\u7684\u903b \u8f91\u5c31\u65e0\u5904\u5b89\u653e\u4e86\u3002 </p> </li> <li> <p>\u5982\u679c\u7c7b\u7684\u5c5e\u6027\u4e4b\u95f4\u6709\u4e00\u5b9a\u7684\u4f9d\u8d56\u5173\u7cfb\u6216\u8005\u7ea6\u675f\u6761\u4ef6\uff0c\u6211\u4eec\u7ee7\u7eed\u4f7f\u7528\u6784\u9020\u51fd\u6570\u914d\u5408 set() \u65b9 \u6cd5\u7684\u8bbe\u8ba1\u601d\u8def\uff0c\u90a3\u8fd9\u4e9b\u4f9d\u8d56\u5173\u7cfb\u6216\u7ea6\u675f\u6761\u4ef6\u7684\u6821\u9a8c\u903b\u8f91\u5c31\u65e0\u5904\u5b89\u653e\u4e86\u3002 \u5982\u679c\u6211\u4eec\u5e0c\u671b\u521b\u5efa\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u8c61\u5728\u521b\u5efa\u597d\u4e4b\u540e\uff0c\u5c31\u4e0d\u80fd\u518d\u4fee\u6539\u5185\u90e8\u7684\u5c5e \u6027\u503c\uff0c\u8981\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\uff0c\u6211\u4eec\u5c31\u4e0d\u80fd\u5728\u7c7b\u4e2d\u66b4\u9732 set() \u65b9\u6cd5\u3002\u6784\u9020\u51fd\u6570\u914d\u5408 set() \u65b9\u6cd5\u6765\u8bbe\u7f6e\u5c5e\u6027\u503c\u7684\u65b9\u5f0f\u5c31\u4e0d\u9002\u7528\u4e86\u3002</p> </li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u539f\u578b\u6a21\u5f0f","text":"<p>\u5982\u679c\u5bf9\u8c61\u7684\u521b\u5efa\u6210\u672c\u6bd4\u8f83\u5927\uff0c\u800c\u540c\u4e00\u4e2a\u7c7b\u7684\u4e0d\u540c\u5bf9\u8c61\u4e4b\u95f4\u5dee\u522b\u4e0d\u5927\uff08\u5927\u90e8\u5206\u5b57\u6bb5\u90fd\u76f8\u540c\uff09\uff0c \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5bf9\u5df2\u6709\u5bf9\u8c61\uff08\u539f\u578b\uff09\u8fdb\u884c\u590d\u5236\uff08\u6216\u8005\u53eb\u62f7\u8d1d\uff09\u7684\u65b9\u5f0f\uff0c\u6765\u521b\u5efa \u65b0\u5bf9\u8c61\uff0c\u4ee5\u8fbe\u5230\u8282\u7701\u521b\u5efa\u65f6\u95f4\u7684\u76ee\u7684\u3002\u8fd9\u79cd\u57fa\u4e8e\u539f\u578b\u6765\u521b\u5efa\u5bf9\u8c61\u7684\u65b9\u5f0f\u5c31\u53eb\u4f5c\u539f\u578b\u6a21\u5f0f\u3002</p> <p>\u539f\u578b\u6a21\u5f0f\u6709\u4e24\u79cd\u5b9e\u73b0\u65b9\u6cd5\uff0c\u6df1\u62f7\u8d1d\u548c\u6d45\u62f7\u8d1d\u3002\u6d45\u62f7\u8d1d\u53ea\u4f1a\u590d\u5236\u5bf9\u8c61\u4e2d\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6570\u636e\u548c\u5f15 \u7528\u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740\uff0c\u4e0d\u4f1a\u9012\u5f52\u5730\u590d\u5236\u5f15\u7528\u5bf9\u8c61\uff0c\u4ee5\u53ca\u5f15\u7528\u5bf9\u8c61\u7684\u5f15\u7528\u5bf9\u8c61\u2026\u2026\u800c\u6df1\u62f7\u8d1d\u5f97\u5230 \u7684\u662f\u4e00\u4efd\u5b8c\u5b8c\u5168\u5168\u72ec\u7acb\u7684\u5bf9\u8c61\u3002\u6240\u4ee5\uff0c\u6df1\u62f7\u8d1d\u6bd4\u8d77\u6d45\u62f7\u8d1d\u6765\u8bf4\uff0c\u66f4\u52a0\u8017\u65f6\uff0c\u66f4\u52a0\u8017\u5185\u5b58\u7a7a \u95f4\u3002 </p> <p>\u5982\u679c\u8981\u62f7\u8d1d\u7684\u5bf9\u8c61\u662f\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff0c\u6d45\u62f7\u8d1d\u5171\u4eab\u4e0d\u53ef\u53d8\u5bf9\u8c61\u662f\u6ca1\u95ee\u9898\u7684\uff0c\u4f46\u5bf9\u4e8e\u53ef\u53d8\u5bf9\u8c61\u6765 \u8bf4\uff0c\u6d45\u62f7\u8d1d\u5f97\u5230\u7684\u5bf9\u8c61\u548c\u539f\u59cb\u5bf9\u8c61\u4f1a\u5171\u4eab\u90e8\u5206\u6570\u636e\uff0c\u5c31\u6709\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u88ab\u4fee\u6539\u7684\u98ce\u9669\uff0c\u4e5f\u5c31 \u53d8\u5f97\u590d\u6742\u591a\u4e86\u3002\u9664\u975e\u64cd\u4f5c\u975e\u5e38\u8017\u65f6\uff0c\u6bd4\u8f83\u63a8\u8350\u4f7f\u7528\u6d45\u62f7\u8d1d\uff0c\u5426\u5219\uff0c\u6ca1\u6709\u5145\u5206\u7684\u7406\u7531\uff0c\u4e0d\u8981\u4e3a \u4e86\u4e00\u70b9\u70b9\u7684\u6027\u80fd\u63d0\u5347\u800c\u4f7f\u7528\u6d45\u62f7\u8d1d\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/","title":"\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7ed3\u6784\u578b\u6a21\u5f0f","text":"<p>\u7ed3\u6784\u578b\u6a21\u5f0f\u4e3b\u8981\u603b\u7ed3\u4e86\u4e00\u4e9b\u7c7b\u6216\u5bf9\u8c61\u7ec4\u5408\u5728\u4e00\u8d77\u7684\u7ecf\u5178\u7ed3\u6784\uff0c\u8fd9\u4e9b\u7ecf\u5178\u7684\u7ed3\u6784\u53ef\u4ee5\u89e3\u51b3\u7279\u5b9a \u5e94\u7528\u573a\u666f\u7684\u95ee\u9898\u3002\u7ed3\u6784\u578b\u6a21\u5f0f\u5305\u62ec\uff1a\u4ee3\u7406\u6a21\u5f0f\u3001\u6865\u63a5\u6a21\u5f0f\u3001\u88c5\u9970\u5668\u6a21\u5f0f\u3001\u9002\u914d\u5668\u6a21\u5f0f\u3001\u95e8\u9762\u6a21\u5f0f\u3001\u7ec4\u5408\u6a21\u5f0f\u3001\u4eab\u5143\u6a21\u5f0f\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e00 \u4ee3\u7406\u6a21\u5f0f","text":"<p>\u4ee3\u7406\u6a21\u5f0f\u5728\u4e0d\u6539\u53d8\u539f\u59cb\u7c7b\u63a5\u53e3\u7684\u6761\u4ef6\u4e0b\uff0c\u4e3a\u539f\u59cb\u7c7b\u5b9a\u4e49\u4e00\u4e2a\u4ee3\u7406\u7c7b\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u63a7\u5236\u8bbf\u95ee\uff0c \u800c\u975e\u52a0\u5f3a\u529f\u80fd\uff0c\u8fd9\u662f\u5b83\u8ddf\u88c5\u9970\u5668\u6a21\u5f0f\u6700\u5927\u7684\u4e0d\u540c\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u8ba9\u4ee3\u7406\u7c7b\u548c\u539f\u59cb\u7c7b\u5b9e\u73b0\u540c\u6837\u7684\u63a5\u53e3\u3002\u4f46\u662f\uff0c\u5982\u679c\u539f\u59cb\u7c7b\u5e76\u6ca1\u6709\u5b9a\u4e49\u63a5\u53e3\uff0c\u5e76\u4e14\u539f\u59cb\u7c7b\u4ee3\u7801\u5e76\u4e0d\u662f\u6211\u4eec\u5f00\u53d1\u7ef4\u62a4\u7684\u3002 </p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8ba9\u4ee3\u7406\u7c7b\u7ee7\u627f\u539f\u59cb\u7c7b\u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\u4ee3\u7406\u6a21\u5f0f\u3002\u9759\u6001\u4ee3\u7406\u9700\u8981\u9488\u5bf9\u6bcf\u4e2a\u7c7b\u90fd\u521b\u5efa\u4e00\u4e2a\u4ee3\u7406\u7c7b\uff0c\u5e76\u4e14\u6bcf\u4e2a\u4ee3\u7406\u7c7b\u4e2d\u7684\u4ee3\u7801\u90fd\u6709\u70b9\u50cf\u6a21\u677f\u5f0f \u7684\u201c\u91cd\u590d\u201d\u4ee3\u7801\uff0c\u589e\u52a0\u4e86\u7ef4\u62a4\u6210\u672c\u548c\u5f00\u53d1\u6210\u672c\u3002\u5bf9\u4e8e\u9759\u6001\u4ee3\u7406\u5b58\u5728\u7684\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u6765\u89e3\u51b3\u3002\u6211\u4eec\u4e0d\u4e8b\u5148\u4e3a\u6bcf\u4e2a\u539f\u59cb\u7c7b\u7f16\u5199\u4ee3\u7406\u7c7b\uff0c\u800c\u662f\u5728\u8fd0\u884c\u7684\u65f6\u5019\u52a8\u6001\u5730\u521b\u5efa\u539f\u59cb\u7c7b\u5bf9\u5e94\u7684\u4ee3\u7406\u7c7b\uff0c\u7136\u540e\u5728\u7cfb\u7edf\u4e2d\u7528\u4ee3\u7406\u7c7b\u66ff\u6362\u6389\u539f\u59cb\u7c7b\u3002</p> <p>\u4ee3\u7406\u6a21\u5f0f\u5e38\u7528\u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u5f00\u53d1\u4e00\u4e9b\u975e\u529f\u80fd\u6027\u9700\u6c42\uff0c\u6bd4\u5982\uff1a\u76d1\u63a7\u3001\u7edf\u8ba1\u3001\u9274\u6743\u3001\u9650\u6d41\u3001\u4e8b\u52a1\u3001\u5e42\u7b49\u3001\u65e5\u5fd7\u3002\u6211\u4eec\u5c06\u8fd9\u4e9b\u9644\u52a0\u529f\u80fd\u4e0e\u4e1a\u52a1\u529f\u80fd\u89e3\u8026\uff0c\u653e\u5230\u4ee3\u7406\u7c7b\u7edf\u4e00\u5904\u7406\uff0c\u8ba9\u7a0b\u5e8f\u5458\u53ea\u9700\u8981\u5173\u6ce8\u4e1a\u52a1\u65b9\u9762\u7684\u5f00\u53d1\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u4ee3\u7406\u6a21\u5f0f\u8fd8\u53ef\u4ee5\u7528\u5728 RPC\u3001\u7f13\u5b58\u7b49\u5e94\u7528\u573a\u666f\u4e2d\u3002 </p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e8c \u6865\u63a5\u6a21\u5f0f","text":"<p>\u6865\u63a5\u6a21\u5f0f\u7684\u4ee3\u7801\u5b9e\u73b0\u975e\u5e38\u7b80\u5355\uff0c\u4f46\u662f\u7406\u89e3\u8d77\u6765\u7a0d\u5fae\u6709\u70b9\u96be\u5ea6\uff0c\u5e76\u4e14\u5e94\u7528\u573a\u666f\u4e5f\u6bd4\u8f83\u5c40\u9650\uff0c\u6240\u4ee5\uff0c\u76f8\u5bf9\u6765\u8bf4\uff0c\u6865\u63a5\u6a21\u5f0f\u5728\u5b9e\u9645\u7684\u9879\u76ee\u4e2d\u5e76\u6ca1\u6709\u90a3\u4e48\u5e38\u7528\uff0c\u4f60\u53ea\u9700\u8981\u7b80\u5355\u4e86\u89e3\uff0c\u89c1\u5230\u80fd\u8ba4\u8bc6\u5c31\u53ef\u4ee5\u4e86\uff0c\u5e76\u4e0d\u662f\u6211\u4eec\u5b66\u4e60\u7684\u91cd\u70b9\u3002 </p> <p>\u6865\u63a5\u6a21\u5f0f\u6709\u4e24\u79cd\u7406\u89e3\u65b9\u5f0f\u3002\u7b2c\u4e00\u79cd\u7406\u89e3\u65b9\u5f0f\u662f\u201c\u5c06\u62bd\u8c61\u548c\u5b9e\u73b0\u89e3\u8026\uff0c\u8ba9\u5b83\u4eec\u80fd\u72ec\u7acb\u5f00\u53d1\u201d\u3002 \u8fd9\u79cd\u7406\u89e3\u65b9\u5f0f\u6bd4\u8f83\u7279\u522b\uff0c\u5e94\u7528\u573a\u666f\u4e5f\u4e0d\u591a\u3002\u53e6\u4e00\u79cd\u7406\u89e3\u65b9\u5f0f\u66f4\u52a0\u7b80\u5355\uff0c\u7b49\u540c\u4e8e\u201c\u7ec4\u5408\u4f18\u4e8e\u7ee7 \u627f\u201d\u8bbe\u8ba1\u539f\u5219\uff0c\u8fd9\u79cd\u7406\u89e3\u65b9\u5f0f\u66f4\u52a0\u901a\u7528\uff0c\u5e94\u7528\u573a\u666f\u6bd4\u8f83\u591a\u3002\u4e0d\u7ba1\u662f\u54ea\u79cd\u7406\u89e3\u65b9\u5f0f\uff0c\u5b83\u4eec\u7684\u4ee3\u7801\u7ed3\u6784\u90fd\u662f\u76f8\u540c\u7684\uff0c\u90fd\u662f\u4e00\u79cd\u7c7b\u4e4b\u95f4\u7684\u7ec4\u5408\u5173\u7cfb\u3002 </p> <p>\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u7406\u89e3\u65b9\u5f0f\uff0c\u5f04\u61c2\u5b9a\u4e49\u4e2d\u201c\u62bd\u8c61\u201d\u548c\u201c\u5b9e\u73b0\u201d\u4e24\u4e2a\u6982\u5ff5\uff0c\u662f\u7406\u89e3\u5b83\u7684\u5173\u952e\u3002\u5b9a\u4e49\u4e2d\u7684\u201c\u62bd\u8c61\u201d\uff0c\u6307\u7684\u5e76\u975e\u201c\u62bd\u8c61\u7c7b\u201d\u6216\u201c\u63a5\u53e3\u201d\uff0c\u800c\u662f\u88ab\u62bd\u8c61\u51fa\u6765\u7684\u4e00\u5957\u201c\u7c7b\u5e93\u201d\uff0c\u5b83\u53ea\u5305\u542b\u9aa8\u67b6\u4ee3\u7801\uff0c\u771f\u6b63\u7684\u4e1a\u52a1\u903b\u8f91\u9700\u8981\u59d4\u6d3e\u7ed9\u5b9a\u4e49\u4e2d\u7684\u201c\u5b9e\u73b0\u201d\u6765\u5b8c\u6210\u3002\u800c\u5b9a\u4e49\u4e2d\u7684\u201c\u5b9e\u73b0\u201d\uff0c\u4e5f\u5e76\u975e\u201c\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u201d\uff0c\u800c\u662f\u7684\u4e00\u5957\u72ec\u7acb\u7684\u201c\u7c7b\u5e93\u201d\u3002\u201c\u62bd\u8c61\u201d\u548c\u201c\u5b9e\u73b0\u201d\u72ec\u7acb\u5f00\u53d1\uff0c\u901a\u8fc7\u5bf9\u8c61\u4e4b\u95f4\u7684\u7ec4\u5408\u5173\u7cfb\u7ec4\u88c5\u5728\u4e00\u8d77\u3002 </p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_4","title":"\u4e09 \u88c5\u9970\u5668\u6a21\u5f0f","text":"<p>\u88c5\u9970\u5668\u6a21\u5f0f\u4e3b\u8981\u89e3\u51b3\u7ee7\u627f\u5173\u7cfb\u8fc7\u4e8e\u590d\u6742\u7684\u95ee\u9898\uff0c\u901a\u8fc7\u7ec4\u5408\u6765\u66ff\u4ee3\u7ee7\u627f\uff0c\u7ed9\u539f\u59cb\u7c7b\u6dfb\u52a0\u589e\u5f3a\u529f \u80fd\u3002\u8fd9\u4e5f\u662f\u5224\u65ad\u662f\u5426\u8be5\u7528\u88c5\u9970\u5668\u6a21\u5f0f\u7684\u4e00\u4e2a\u91cd\u8981\u7684\u4f9d\u636e\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u88c5\u9970\u5668\u6a21\u5f0f\u8fd8\u6709\u4e00\u4e2a\u7279 \u70b9\uff0c\u90a3\u5c31\u662f\u53ef\u4ee5\u5bf9\u539f\u59cb\u7c7b\u5d4c\u5957\u4f7f\u7528\u591a\u4e2a\u88c5\u9970\u5668\u3002\u4e3a\u4e86\u6ee1\u8db3\u8fd9\u6837\u7684\u9700\u6c42\uff0c\u5728\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u88c5\u9970 \u5668\u7c7b\u9700\u8981\u8ddf\u539f\u59cb\u7c7b\u7ee7\u627f\u76f8\u540c\u7684\u62bd\u8c61\u7c7b\u6216\u8005\u63a5\u53e3\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_5","title":"\u56db \u9002\u914d\u5668\u6a21\u5f0f","text":"<p>\u4ee3\u7406\u6a21\u5f0f\u3001\u88c5\u9970\u5668\u6a21\u5f0f\u63d0\u4f9b\u7684\u90fd\u662f\u8ddf\u539f\u59cb\u7c7b\u76f8\u540c\u7684\u63a5\u53e3\uff0c\u800c\u9002\u914d\u5668\u63d0\u4f9b\u8ddf\u539f\u59cb\u7c7b\u4e0d\u540c\u7684\u63a5 \u53e3\u3002\u9002\u914d\u5668\u6a21\u5f0f\u662f\u7528\u6765\u505a\u9002\u914d\u7684\uff0c\u5b83\u5c06\u4e0d\u517c\u5bb9\u7684\u63a5\u53e3\u8f6c\u6362\u4e3a\u53ef\u517c\u5bb9\u7684\u63a5\u53e3\uff0c\u8ba9\u539f\u672c\u7531\u4e8e\u63a5\u53e3 \u4e0d\u517c\u5bb9\u800c\u4e0d\u80fd\u4e00\u8d77\u5de5\u4f5c\u7684\u7c7b\u53ef\u4ee5\u4e00\u8d77\u5de5\u4f5c\u3002\u9002\u914d\u5668\u6a21\u5f0f\u6709\u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff1a\u7c7b\u9002\u914d\u5668\u548c\u5bf9\u8c61\u9002 \u914d\u5668\u3002\u5176\u4e2d\uff0c\u7c7b\u9002\u914d\u5668\u4f7f\u7528\u7ee7\u627f\u5173\u7cfb\u6765\u5b9e\u73b0\uff0c\u5bf9\u8c61\u9002\u914d\u5668\u4f7f\u7528\u7ec4\u5408\u5173\u7cfb\u6765\u5b9e\u73b0\u3002\u9002\u914d\u5668\u6a21\u5f0f\u662f\u4e00\u79cd\u4e8b\u540e\u7684\u8865\u6551\u7b56\u7565\uff0c\u7528\u6765\u8865\u6551\u8bbe\u8ba1\u4e0a\u7684\u7f3a\u9677\u3002\u5e94\u7528\u8fd9\u79cd\u6a21\u5f0f\u7b97\u662f\u201c\u65e0\u5948\u4e4b\u4e3e\u201d\u3002\u5982\u679c\u5728\u8bbe\u8ba1\u521d\u671f\uff0c\u6211\u4eec\u5c31\u80fd\u89c4\u907f\u63a5\u53e3\u4e0d\u517c\u5bb9\u7684\u95ee\u9898\uff0c\u90a3\u8fd9\u79cd\u6a21\u5f0f\u5c31\u65e0\u7528\u6b66\u4e4b\u5730\u4e86\u3002\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u624d\u4f1a\u51fa\u73b0\u63a5\u53e3\u4e0d\u517c\u5bb9\u5462\uff1f\u6211\u603b\u7ed3\u4e0b\u4e86\u4e0b\u9762\u8fd9 5 \u79cd\u573a\u666f\uff1a</p> <ul> <li> <p>\u5c01\u88c5\u6709\u7f3a\u9677\u7684\u63a5\u53e3\u8bbe\u8ba1 </p> </li> <li> <p>\u7edf\u4e00\u591a\u4e2a\u7c7b\u7684\u63a5\u53e3\u8bbe\u8ba1 </p> </li> <li> <p>\u66ff\u6362\u4f9d\u8d56\u7684\u5916\u90e8\u7cfb\u7edf </p> </li> <li> <p>\u517c\u5bb9\u8001\u7248\u672c\u63a5\u53e3 </p> </li> <li> <p>\u9002\u914d\u4e0d\u540c\u683c\u5f0f\u7684\u6570\u636e</p> </li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_6","title":"\u4e94 \u95e8\u9762\u6a21\u5f0f","text":"<p>\u95e8\u9762\u6a21\u5f0f\u539f\u7406\u3001\u5b9e\u73b0\u90fd\u975e\u5e38\u7b80\u5355\uff0c\u5e94\u7528\u573a\u666f\u6bd4\u8f83\u660e\u786e\u3002\u5b83\u901a\u8fc7\u5c01\u88c5\u7ec6\u7c92\u5ea6\u7684\u63a5\u53e3\uff0c\u63d0\u4f9b\u7ec4\u5408\u5404\u4e2a\u7ec6\u7c92\u5ea6\u63a5\u53e3\u7684\u9ad8\u5c42\u6b21\u63a5\u53e3\uff0c\u6765\u63d0\u9ad8\u63a5\u53e3\u7684\u6613\u7528\u6027\uff0c\u6216\u8005\u89e3\u51b3\u6027\u80fd\u3001\u5206\u5e03\u5f0f\u4e8b\u52a1\u7b49\u95ee\u9898\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_7","title":"\u516d \u7ec4\u5408\u6a21\u5f0f","text":"<p>\u7ec4\u5408\u6a21\u5f0f\u8ddf\u6211\u4eec\u4e4b\u524d\u8bb2\u7684\u9762\u5411\u5bf9\u8c61\u8bbe\u8ba1\u4e2d\u7684\u201c\u7ec4\u5408\u5173\u7cfb\uff08\u901a\u8fc7\u7ec4\u5408\u6765\u7ec4\u88c5\u4e24\u4e2a\u7c7b\uff09\u201d\uff0c\u5b8c\u5168 \u662f\u4e24\u7801\u4e8b\u3002\u8fd9\u91cc\u8bb2\u7684\u201c\u7ec4\u5408\u6a21\u5f0f\u201d\uff0c\u4e3b\u8981\u662f\u7528\u6765\u5904\u7406\u6811\u5f62\u7ed3\u6784\u6570\u636e\u3002\u6b63\u56e0\u4e3a\u5176\u5e94\u7528\u573a\u666f\u7684\u7279 \u6b8a\u6027\uff0c\u6570\u636e\u5fc5\u987b\u80fd\u8868\u793a\u6210\u6811\u5f62\u7ed3\u6784\uff0c\u8fd9\u4e5f\u5bfc\u81f4\u4e86\u8fd9\u79cd\u6a21\u5f0f\u5728\u5b9e\u9645\u7684\u9879\u76ee\u5f00\u53d1\u4e2d\u5e76\u4e0d\u90a3\u4e48\u5e38 \u7528\u3002\u4f46\u662f\uff0c\u4e00\u65e6\u6570\u636e\u6ee1\u8db3\u6811\u5f62\u7ed3\u6784\uff0c\u5e94\u7528\u8fd9\u79cd\u6a21\u5f0f\u5c31\u80fd\u53d1\u6325\u5f88\u5927\u7684\u4f5c\u7528\uff0c\u80fd\u8ba9\u4ee3\u7801\u53d8\u5f97\u975e\u5e38 \u7b80\u6d01\u3002 </p> <p>\u7ec4\u5408\u6a21\u5f0f\u7684\u8bbe\u8ba1\u601d\u8def\uff0c\u4e0e\u5176\u8bf4\u662f\u4e00\u79cd\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5012\u4e0d\u5982\u8bf4\u662f\u5bf9\u4e1a\u52a1\u573a\u666f\u7684\u4e00\u79cd\u6570\u636e\u7ed3\u6784\u548c\u7b97 \u6cd5\u7684\u62bd\u8c61\u3002\u5176\u4e2d\uff0c\u6570\u636e\u53ef\u4ee5\u8868\u793a\u6210\u6811\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u4e1a\u52a1\u9700\u6c42\u53ef\u4ee5\u901a\u8fc7\u5728\u6811\u4e0a\u7684\u9012\u5f52\u904d\u5386\u7b97 \u6cd5\u6765\u5b9e\u73b0\u3002\u7ec4\u5408\u6a21\u5f0f\uff0c\u5c06\u4e00\u7ec4\u5bf9\u8c61\u7ec4\u7ec7\u6210\u6811\u5f62\u7ed3\u6784\uff0c\u5c06\u5355\u4e2a\u5bf9\u8c61\u548c\u7ec4\u5408\u5bf9\u8c61\u90fd\u770b\u4f5c\u6811\u4e2d\u7684\u8282 \u70b9\uff0c\u4ee5\u7edf\u4e00\u5904\u7406\u903b\u8f91\uff0c\u5e76\u4e14\u5b83\u5229\u7528\u6811\u5f62\u7ed3\u6784\u7684\u7279\u70b9\uff0c\u9012\u5f52\u5730\u5904\u7406\u6bcf\u4e2a\u5b50\u6811\uff0c\u4f9d\u6b21\u7b80\u5316\u4ee3\u7801\u5b9e\u73b0\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_8","title":"\u4e03 \u4eab\u5143\u6a21\u5f0f","text":"<p>\u6240\u8c13\u201c\u4eab\u5143\u201d\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u88ab\u5171\u4eab\u7684\u5355\u5143\u3002\u4eab\u5143\u6a21\u5f0f\u7684\u610f\u56fe\u662f\u590d\u7528\u5bf9\u8c61\uff0c\u8282\u7701\u5185\u5b58\uff0c\u524d\u63d0 \u662f\u4eab\u5143\u5bf9\u8c61\u662f\u4e0d\u53ef\u53d8\u5bf9\u8c61\u3002\u5177\u4f53\u6765\u8bb2\uff0c\u5f53\u4e00\u4e2a\u7cfb\u7edf\u4e2d\u5b58\u5728\u5927\u91cf\u91cd\u590d\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u4eab\u5143\u6a21\u5f0f\uff0c\u5c06\u5bf9\u8c61\u8bbe\u8ba1 \u6210\u4eab\u5143\uff0c\u5728\u5185\u5b58\u4e2d\u53ea\u4fdd\u7559\u4e00\u4efd\u5b9e\u4f8b\uff0c\u4f9b\u591a\u5904\u4ee3\u7801\u5f15\u7528\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u5185\u5b58\u4e2d\u5bf9\u8c61\u7684\u6570\u91cf\uff0c\u4ee5\u8d77\u5230\u8282\u7701\u5185\u5b58\u7684\u76ee\u7684\u3002\u5b9e\u9645\u4e0a\uff0c\u4e0d\u4ec5\u4ec5\u76f8\u540c\u5bf9\u8c61\u53ef\u4ee5\u8bbe\u8ba1\u6210\u4eab\u5143\uff0c\u5bf9\u4e8e\u76f8\u4f3c\u5bf9\u8c61\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u5bf9\u8c61\u4e2d\u76f8\u540c\u7684\u90e8\u5206\uff08\u5b57\u6bb5\uff09\uff0c\u63d0\u53d6\u51fa\u6765\u8bbe\u8ba1\u6210\u4eab\u5143\uff0c\u8ba9\u8fd9\u4e9b\u5927\u91cf\u76f8\u4f3c\u5bf9\u8c61\u5f15\u7528\u8fd9\u4e9b\u4eab\u5143\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/","title":"\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u884c\u4e3a\u578b\u6a21\u5f0f","text":"<p>\u6211\u4eec\u77e5\u9053\uff0c\u521b\u5efa\u578b\u8bbe\u8ba1\u6a21\u5f0f\u4e3b\u8981\u89e3\u51b3\u201c\u5bf9\u8c61\u7684\u521b\u5efa\u201d\u95ee\u9898\uff0c\u7ed3\u6784\u578b\u8bbe\u8ba1\u6a21\u5f0f\u4e3b\u8981\u89e3\u51b3\u201c\u7c7b\u6216 \u5bf9\u8c61\u7684\u7ec4\u5408\u201d\u95ee\u9898\uff0c\u90a3\u884c\u4e3a\u578b\u8bbe\u8ba1\u6a21\u5f0f\u4e3b\u8981\u89e3\u51b3\u7684\u5c31\u662f\u201c\u7c7b\u6216\u5bf9\u8c61\u4e4b\u95f4\u7684\u4ea4\u4e92\u201d\u95ee\u9898\u3002\u884c\u4e3a\u578b\u6a21\u5f0f\u6bd4\u8f83\u591a\uff0c\u6709 11 \u79cd\uff0c\u5b83\u4eec\u5206\u522b\u662f\uff1a\u89c2\u5bdf\u8005\u6a21\u5f0f\u3001\u6a21\u677f\u6a21\u5f0f\u3001\u7b56\u7565\u6a21\u5f0f\u3001\u804c\u8d23\u94fe\u6a21\u5f0f\u3001 \u8fed\u4ee3\u5668\u6a21\u5f0f\u3001\u72b6\u6001\u6a21\u5f0f\u3001\u8bbf\u95ee\u8005\u6a21\u5f0f\u3001\u5907\u5fd8\u5f55\u6a21\u5f0f\u3001\u547d\u4ee4\u6a21\u5f0f\u3001\u89e3\u91ca\u5668\u6a21\u5f0f\u3001\u4e2d\u4ecb\u6a21\u5f0f\u3002 </p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e00 \u89c2\u5bdf\u8005\u6a21\u5f0f","text":"<p>\u89c2\u5bdf\u8005\u6a21\u5f0f\u5c06\u89c2\u5bdf\u8005\u548c\u88ab\u89c2\u5bdf\u8005\u4ee3\u7801\u89e3\u8026\u3002\u89c2\u5bdf\u8005\u6a21\u5f0f\u7684\u5e94\u7528\u573a\u666f\u975e\u5e38\u5e7f\u6cdb\uff0c\u5c0f\u5230\u4ee3\u7801\u5c42\u9762 \u7684\u89e3\u8026\uff0c\u5927\u5230\u67b6\u6784\u5c42\u9762\u7684\u7cfb\u7edf\u89e3\u8026\uff0c\u518d\u6216\u8005\u4e00\u4e9b\u4ea7\u54c1\u7684\u8bbe\u8ba1\u601d\u8def\uff0c\u90fd\u6709\u8fd9\u79cd\u6a21\u5f0f\u7684\u5f71\u5b50\uff0c\u6bd4 \u5982\uff0c\u90ae\u4ef6\u8ba2\u9605\u3001RSS Feeds\uff0c\u672c\u8d28\u4e0a\u90fd\u662f\u89c2\u5bdf\u8005\u6a21\u5f0f\u3002 </p> <p>\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\u548c\u9700\u6c42\u4e0b\uff0c\u8fd9\u4e2a\u6a21\u5f0f\u4e5f\u6709\u622a\u7136\u4e0d\u540c\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1a\u6709\u540c\u6b65\u963b\u585e\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4e5f \u6709\u5f02\u6b65\u975e\u963b\u585e\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1b\u6709\u8fdb\u7a0b\u5185\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4e5f\u6709\u8de8\u8fdb\u7a0b\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002\u540c\u6b65\u963b\u585e\u662f\u6700\u7ecf\u5178\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u4ee3\u7801\u89e3\u8026\uff1b\u5f02\u6b65\u975e\u963b\u585e\u9664\u4e86\u80fd\u5b9e\u73b0\u4ee3\u7801\u89e3\u8026\u4e4b\u5916\uff0c\u8fd8\u80fd\u63d0\u9ad8\u4ee3\u7801 \u7684\u6267\u884c\u6548\u7387\uff1b\u8fdb\u7a0b\u95f4\u7684\u89c2\u5bdf\u8005\u6a21\u5f0f\u89e3\u8026\u66f4\u52a0\u5f7b\u5e95\uff0c\u4e00\u822c\u662f\u57fa\u4e8e\u6d88\u606f\u961f\u5217\u6765\u5b9e\u73b0\uff0c\u7528\u6765\u5b9e\u73b0\u4e0d\u540c\u8fdb\u7a0b\u95f4\u7684\u88ab\u89c2\u5bdf\u8005\u548c\u89c2\u5bdf\u8005\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002 </p> <p>\u6846\u67b6\u7684\u4f5c\u7528\u6709\u9690\u85cf\u5b9e\u73b0\u7ec6\u8282\uff0c\u964d\u4f4e\u5f00\u53d1\u96be\u5ea6\uff0c\u5b9e\u73b0\u4ee3\u7801\u590d\u7528\uff0c\u89e3\u8026\u4e1a\u52a1\u4e0e\u975e\u4e1a\u52a1\u4ee3\u7801\uff0c\u8ba9\u7a0b\u5e8f\u5458\u805a\u7126\u4e1a\u52a1\u5f00\u53d1\u3002\u9488\u5bf9\u5f02\u6b65\u975e\u963b\u585e\u89c2\u5bdf\u8005\u6a21\u5f0f\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u5b83\u62bd\u8c61\u6210 EventBus \u6846\u67b6\u6765\u8fbe\u5230\u8fd9\u6837\u7684\u6548\u679c\u3002EventBus \u7ffb\u8bd1\u4e3a\u201c\u4e8b\u4ef6\u603b\u7ebf\u201d\uff0c\u5b83\u63d0\u4f9b\u4e86\u5b9e\u73b0\u89c2\u5bdf\u8005\u6a21\u5f0f\u7684\u9aa8\u67b6\u4ee3\u7801\u3002 </p> <p>\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e\u6b64\u6846\u67b6\u975e\u5e38\u5bb9\u6613\u5730\u5728\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\u5b9e\u73b0\u89c2\u5bdf\u8005\u6a21\u5f0f\uff0c\u4e0d\u9700\u8981\u4ece\u96f6\u5f00\u59cb\u5f00\u53d1\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e8c \u6a21\u7248\u6a21\u5f0f","text":"<p>\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u5728\u4e00\u4e2a\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u7b97\u6cd5\u9aa8\u67b6\uff0c\u5e76\u5c06\u67d0\u4e9b\u6b65\u9aa4\u63a8\u8fdf\u5230\u5b50\u7c7b\u4e2d\u5b9e\u73b0\u3002\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u53ef\u4ee5\u8ba9\u5b50\u7c7b\u5728\u4e0d\u6539\u53d8\u7b97\u6cd5\u6574\u4f53\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\uff0c\u91cd\u65b0\u5b9a\u4e49\u7b97\u6cd5\u4e2d\u7684\u67d0\u4e9b\u6b65\u9aa4\u3002\u8fd9\u91cc\u7684\u201c\u7b97\u6cd5\u201d\uff0c\u6211\u4eec\u53ef\u4ee5\u7406\u89e3\u4e3a\u5e7f\u4e49\u4e0a\u7684\u201c\u4e1a\u52a1\u903b\u8f91\u201d\uff0c\u5e76\u4e0d\u7279\u6307\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\u4e2d\u7684\u201c\u7b97\u6cd5\u201d\u3002\u8fd9\u91cc\u7684\u7b97\u6cd5\u9aa8\u67b6\u5c31\u662f\u201c\u6a21\u677f\u201d\uff0c\u5305\u542b\u7b97\u6cd5\u9aa8\u67b6\u7684\u65b9\u6cd5\u5c31\u662f\u201c\u6a21\u677f\u65b9\u6cd5\u201d\uff0c\u8fd9\u4e5f\u662f\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u540d\u5b57\u7684\u7531\u6765\u3002 </p> <p>\u6a21\u677f\u6a21\u5f0f\u6709\u4e24\u5927\u4f5c\u7528\uff1a\u590d\u7528\u548c\u6269\u5c55\u3002\u5176\u4e2d\u590d\u7528\u6307\u7684\u662f\uff0c\u6240\u6709\u7684\u5b50\u7c7b\u53ef\u4ee5\u590d\u7528\u7236\u7c7b\u4e2d\u63d0\u4f9b\u7684\u6a21\u677f\u65b9\u6cd5\u7684\u4ee3\u7801\u3002\u6269\u5c55\u6307\u7684\u662f\uff0c\u6846\u67b6\u901a\u8fc7\u6a21\u677f\u6a21\u5f0f\u63d0\u4f9b\u529f\u80fd\u6269\u5c55\u70b9\uff0c\u8ba9\u6846\u67b6\u7528\u6237\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u6846\u67b6\u6e90\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u57fa\u4e8e\u6269\u5c55\u70b9\u5b9a\u5236\u5316\u6846\u67b6\u7684\u529f\u80fd\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u8bb2\u5230\u56de\u8c03\u3002\u5b83\u8ddf\u6a21\u677f\u6a21\u5f0f\u5177\u6709\u76f8\u540c\u7684\u4f5c\u7528\uff1a\u4ee3\u7801\u590d\u7528\u548c\u6269\u5c55\u3002\u5728\u4e00\u4e9b\u6846\u67b6\u3001\u7c7b\u5e93\u3001\u7ec4\u4ef6\u7b49\u7684\u8bbe\u8ba1\u4e2d\u7ecf\u5e38\u4f1a\u7528\u5230\uff0c\u6bd4\u5982 JdbcTemplate \u5c31\u662f\u7528\u4e86\u56de\u8c03\u3002 </p> <p>\u76f8\u5bf9\u4e8e\u666e\u901a\u7684\u51fd\u6570\u8c03\u7528\uff0c\u56de\u8c03\u662f\u4e00\u79cd\u53cc\u5411\u8c03\u7528\u5173\u7cfb\u3002A \u7c7b\u4e8b\u5148\u6ce8\u518c\u67d0\u4e2a\u51fd\u6570 F \u5230 B \u7c7b\uff0cA\u7c7b\u5728\u8c03\u7528 B \u7c7b\u7684 P \u51fd\u6570\u7684\u65f6\u5019\uff0cB \u7c7b\u53cd\u8fc7\u6765\u8c03\u7528 A \u7c7b\u6ce8\u518c\u7ed9\u5b83\u7684 F \u51fd\u6570\u3002\u8fd9\u91cc\u7684 F \u51fd\u6570\u5c31\u662f\u201c\u56de\u8c03\u51fd\u6570\u201d\u3002A \u8c03\u7528 B\uff0cB \u53cd\u8fc7\u6765\u53c8\u8c03\u7528 A\uff0c\u8fd9\u79cd\u8c03\u7528\u673a\u5236\u5c31\u53eb\u4f5c\u201c\u56de\u8c03\u201d\u3002 </p> <p>\u56de\u8c03\u53ef\u4ee5\u7ec6\u5206\u4e3a\u540c\u6b65\u56de\u8c03\u548c\u5f02\u6b65\u56de\u8c03\u3002\u4ece\u5e94\u7528\u573a\u666f\u4e0a\u6765\u770b\uff0c\u540c\u6b65\u56de\u8c03\u770b\u8d77\u6765\u66f4\u50cf\u6a21\u677f\u6a21\u5f0f\uff0c\u5f02\u6b65\u56de\u8c03\u770b\u8d77\u6765\u66f4\u50cf\u89c2\u5bdf\u8005\u6a21\u5f0f\u3002\u56de\u8c03\u8ddf\u6a21\u677f\u6a21\u5f0f\u7684\u533a\u522b\uff0c\u66f4\u591a\u7684\u662f\u5728\u4ee3\u7801\u5b9e\u73b0\u4e0a\uff0c\u800c\u975e\u5e94\u7528\u573a\u666f\u4e0a\u3002\u56de\u8c03\u57fa\u4e8e\u7ec4\u5408\u5173\u7cfb\u6765\u5b9e\u73b0\uff0c\u6a21\u677f\u6a21\u5f0f\u57fa\u4e8e\u7ee7\u627f\u5173\u7cfb\u6765\u5b9e\u73b0\u3002\u56de\u8c03\u6bd4\u6a21\u677f\u6a21\u5f0f\u66f4\u52a0\u7075\u6d3b\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_4","title":"\u4e09 \u7b56\u7565\u6a21\u5f0f","text":"<p>\u7b56\u7565\u6a21\u5f0f\u5b9a\u4e49\u4e00\u65cf\u7b97\u6cd5\u7c7b\uff0c\u5c06\u6bcf\u4e2a\u7b97\u6cd5\u5206\u522b\u5c01\u88c5\u8d77\u6765\uff0c\u8ba9\u5b83\u4eec\u53ef\u4ee5\u4e92\u76f8\u66ff\u6362\u3002\u7b56\u7565\u6a21\u5f0f\u53ef\u4ee5 \u4f7f\u7b97\u6cd5\u7684\u53d8\u5316\u72ec\u7acb\u4e8e\u4f7f\u7528\u5b83\u4eec\u7684\u5ba2\u6237\u7aef\uff08\u8fd9\u91cc\u7684\u5ba2\u6237\u7aef\u4ee3\u6307\u4f7f\u7528\u7b97\u6cd5\u7684\u4ee3\u7801\uff09\u3002\u7b56\u7565\u6a21\u5f0f\u7528\u6765\u89e3\u8026\u7b56\u7565\u7684\u5b9a\u4e49\u3001\u521b\u5efa\u3001\u4f7f\u7528\u3002\u5b9e\u9645\u4e0a\uff0c\u4e00\u4e2a\u5b8c\u6574\u7684\u7b56\u7565\u6a21\u5f0f\u5c31\u662f\u7531\u8fd9\u4e09\u4e2a\u90e8\u5206\u7ec4\u6210\u7684\u3002 </p> <p>\u7b56\u7565\u7c7b\u7684\u5b9a\u4e49\u6bd4\u8f83\u7b80\u5355\uff0c\u5305\u542b\u4e00\u4e2a\u7b56\u7565\u63a5\u53e3\u548c\u4e00\u7ec4\u5b9e\u73b0\u8fd9\u4e2a\u63a5\u53e3\u7684\u7b56\u7565\u7c7b\u3002\u7b56\u7565\u7684\u521b\u5efa\u7531\u5de5\u5382\u7c7b\u6765\u5b8c\u6210\uff0c\u5c01\u88c5\u7b56\u7565\u521b\u5efa\u7684\u7ec6\u8282\u3002\u7b56\u7565\u6a21\u5f0f\u5305\u542b\u4e00\u7ec4\u7b56\u7565\u53ef\u9009\uff0c\u5ba2\u6237\u7aef\u4ee3\u7801\u9009\u62e9\u4f7f\u7528\u54ea\u4e2a\u7b56\u7565\uff0c\u6709\u4e24\u79cd\u786e\u5b9a\u65b9\u6cd5\uff1a\u7f16\u8bd1\u65f6\u9759\u6001\u786e\u5b9a\u548c\u8fd0\u884c\u65f6\u52a8\u6001\u786e\u5b9a\u3002\u5176\u4e2d\uff0c\u201c\u8fd0\u884c\u65f6\u52a8\u6001\u786e\u5b9a\u201d\u624d\u662f\u7b56\u7565\u6a21\u5f0f\u6700\u5178\u578b\u7684\u5e94\u7528\u573a\u666f\u3002 </p> <p>\u5728\u5b9e\u9645\u7684\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u7b56\u7565\u6a21\u5f0f\u4e5f\u6bd4\u8f83\u5e38\u7528\u3002\u6700\u5e38\u89c1\u7684\u5e94\u7528\u573a\u666f\u662f\uff0c\u5229\u7528\u5b83\u6765\u907f\u514d\u5197\u957f\u7684if-else \u6216 switch \u5206\u652f\u5224\u65ad\u3002\u4e0d\u8fc7\uff0c\u5b83\u7684\u4f5c\u7528\u8fd8\u4e0d\u6b62\u5982\u6b64\u3002\u5b83\u4e5f\u53ef\u4ee5\u50cf\u6a21\u677f\u6a21\u5f0f\u90a3\u6837\uff0c\u63d0\u4f9b\u6846\u67b6\u7684\u6269\u5c55\u70b9\u7b49\u7b49\u3002\u5b9e\u9645\u4e0a\uff0c\u7b56\u7565\u6a21\u5f0f\u4e3b\u8981\u7684\u4f5c\u7528\u8fd8\u662f\u89e3\u8026\u7b56\u7565\u7684\u5b9a\u4e49\u3001\u521b\u5efa\u548c\u4f7f\u7528\uff0c\u63a7\u5236\u4ee3\u7801\u7684\u590d\u6742\u5ea6\uff0c\u8ba9\u6bcf\u4e2a\u90e8\u5206\u90fd\u4e0d\u81f3\u4e8e\u8fc7\u4e8e\u590d\u6742\u3001\u4ee3\u7801\u91cf\u8fc7\u591a\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u5bf9\u4e8e\u590d\u6742\u4ee3\u7801\u6765\u8bf4\uff0c\u7b56\u7565\u6a21\u5f0f\u8fd8\u80fd\u8ba9\u5176\u6ee1\u8db3\u5f00\u95ed\u539f\u5219\uff0c\u6dfb\u52a0\u65b0\u7b56\u7565\u7684\u65f6\u5019\uff0c\u6700\u5c0f\u5316\u3001\u96c6\u4e2d\u5316\u4ee3\u7801\u6539\u52a8\uff0c\u51cf\u5c11\u5f15\u5165 bug \u7684\u98ce\u9669\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_5","title":"\u56db \u8d23\u4efb\u94fe\u6a21\u5f0f","text":"<p>\u5728\u804c\u8d23\u94fe\u6a21\u5f0f\u4e2d\uff0c\u591a\u4e2a\u5904\u7406\u5668\u4f9d\u6b21\u5904\u7406\u540c\u4e00\u4e2a\u8bf7\u6c42\u3002\u4e00\u4e2a\u8bf7\u6c42\u5148\u7ecf\u8fc7 A \u5904\u7406\u5668\u5904\u7406\uff0c\u7136\u540e\u518d\u628a\u8bf7\u6c42\u4f20\u9012\u7ed9 B \u5904\u7406\u5668\uff0cB \u5904\u7406\u5668\u5904\u7406\u5b8c\u540e\u518d\u4f20\u9012\u7ed9 C \u5904\u7406\u5668\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u5f62\u6210\u4e00\u4e2a\u94fe\u6761\u3002\u94fe\u6761\u4e0a\u7684\u6bcf\u4e2a\u5904\u7406\u5668\u5404\u81ea\u627f\u62c5\u5404\u81ea\u7684\u5904\u7406\u804c\u8d23\uff0c\u6240\u4ee5\u53eb\u4f5c\u804c\u8d23\u94fe\u6a21\u5f0f\u3002 </p> <p>\u5728 GoF \u7684\u5b9a\u4e49\u4e2d\uff0c\u4e00\u65e6\u67d0\u4e2a\u5904\u7406\u5668\u80fd\u5904\u7406\u8fd9\u4e2a\u8bf7\u6c42\uff0c\u5c31\u4e0d\u4f1a\u7ee7\u7eed\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u540e\u7eed\u7684\u5904\u7406\u5668\u4e86\u3002\u5f53\u7136\uff0c\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d\uff0c\u4e5f\u5b58\u5728\u5bf9\u8fd9\u4e2a\u6a21\u5f0f\u7684\u53d8\u4f53\uff0c\u90a3\u5c31\u662f\u8bf7\u6c42\u4e0d\u4f1a\u4e2d\u9014\u7ec8\u6b62\u4f20\u9012\uff0c\u800c\u662f\u4f1a\u88ab\u6240\u6709\u7684\u5904\u7406\u5668\u90fd\u5904\u7406\u4e00\u904d\u3002\u804c\u8d23\u94fe\u6a21\u5f0f\u5e38\u7528\u5728\u6846\u67b6\u5f00\u53d1\u4e2d\uff0c\u7528\u6765\u5b9e\u73b0\u8fc7\u6ee4\u5668\u3001\u62e6\u622a\u5668\u529f\u80fd\uff0c\u8ba9\u6846\u67b6\u7684\u4f7f\u7528\u8005\u5728\u4e0d\u9700\u8981\u4fee\u6539\u6846\u67b6\u6e90\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u65b0\u7684\u8fc7\u6ee4\u3001\u62e6\u622a\u529f\u80fd\u3002\u8fd9\u4e5f\u4f53\u73b0\u4e86\u4e4b\u524d\u8bb2\u5230\u7684\u5bf9\u6269\u5c55\u5f00\u653e\u3001\u5bf9\u4fee\u6539\u5173\u95ed\u7684\u8bbe\u8ba1\u539f\u5219\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_6","title":"\u4e94 \u8fed\u4ee3\u5668\u6a21\u5f0f","text":"<p>\u8fed\u4ee3\u5668\u6a21\u5f0f\u4e5f\u53eb\u6e38\u6807\u6a21\u5f0f\uff0c\u5b83\u7528\u6765\u904d\u5386\u96c6\u5408\u5bf9\u8c61\u3002\u8fd9\u91cc\u8bf4\u7684\u201c\u96c6\u5408\u5bf9\u8c61\u201d\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u53eb\u201c\u5bb9\u5668\u201d\u201c\u805a\u5408\u5bf9\u8c61\u201d\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5305\u542b\u4e00\u7ec4\u5bf9\u8c61\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982\uff0c\u6570\u7ec4\u3001\u94fe\u8868\u3001\u6811\u3001\u56fe\u3001 \u8df3\u8868\u3002\u8fed\u4ee3\u5668\u6a21\u5f0f\u4e3b\u8981\u4f5c\u7528\u662f\u89e3\u8026\u5bb9\u5668\u4ee3\u7801\u548c\u904d\u5386\u4ee3\u7801\u3002\u5927\u90e8\u5206\u7f16\u7a0b\u8bed\u8a00\u90fd\u63d0\u4f9b\u4e86\u73b0\u6210\u7684\u8fed\u4ee3\u5668\u53ef\u4ee5\u4f7f\u7528\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u4ece\u96f6\u5f00\u59cb\u5f00\u53d1\u3002 </p> <p>\u904d\u5386\u96c6\u5408\u4e00\u822c\u6709\u4e09\u79cd\u65b9\u5f0f\uff1afor \u5faa\u73af\u3001foreach \u5faa\u73af\u3001\u8fed\u4ee3\u5668\u904d\u5386\u3002\u540e\u4e24\u79cd\u672c\u8d28\u4e0a\u5c5e\u4e8e\u4e00\u79cd\uff0c\u90fd\u53ef\u4ee5\u770b\u4f5c\u8fed\u4ee3\u5668\u904d\u5386\u3002\u76f8\u5bf9\u4e8e for \u5faa\u73af\u904d\u5386\uff0c\u5229\u7528\u8fed\u4ee3\u5668\u6765\u904d\u5386\u6709 3 \u4e2a\u4f18\u52bf\uff1a </p> <ul> <li> <p>\u8fed\u4ee3\u5668\u6a21\u5f0f\u5c01\u88c5\u96c6\u5408\u5185\u90e8\u7684\u590d\u6742\u6570\u636e\u7ed3\u6784\uff0c\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u4e86\u89e3\u5982\u4f55\u904d\u5386\uff0c\u76f4\u63a5\u4f7f\u7528\u5bb9\u5668\u63d0\u4f9b\u7684\u8fed\u4ee3\u5668\u5373\u53ef\uff1b </p> </li> <li> <p>\u8fed\u4ee3\u5668\u6a21\u5f0f\u5c06\u96c6\u5408\u5bf9\u8c61\u7684\u904d\u5386\u64cd\u4f5c\u4ece\u96c6\u5408\u7c7b\u4e2d\u62c6\u5206\u51fa\u6765\uff0c\u653e\u5230\u8fed\u4ee3\u5668\u7c7b\u4e2d\uff0c\u8ba9\u4e24\u8005\u7684\u804c\u8d23\u66f4\u52a0\u5355\u4e00\uff1b </p> </li> <li> <p>\u8fed\u4ee3\u5668\u6a21\u5f0f\u8ba9\u6dfb\u52a0\u65b0\u7684\u904d\u5386\u7b97\u6cd5\u66f4\u52a0\u5bb9\u6613\uff0c\u66f4\u7b26\u5408\u5f00\u95ed\u539f\u5219\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u56e0\u4e3a\u8fed\u4ee3\u5668\u90fd\u5b9e\u73b0\u81ea\u76f8\u540c\u7684\u63a5\u53e3\uff0c\u5728\u5f00\u53d1\u4e2d\uff0c\u57fa\u4e8e\u63a5\u53e3\u800c\u975e\u5b9e\u73b0\u7f16\u7a0b\uff0c\u66ff\u6362\u8fed\u4ee3\u5668\u4e5f\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002</p> </li> </ul> <p>\u5728\u901a\u8fc7\u8fed\u4ee3\u5668\u6765\u904d\u5386\u96c6\u5408\u5143\u7d20\u7684\u540c\u65f6\uff0c\u589e\u52a0\u6216\u8005\u5220\u9664\u96c6\u5408\u4e2d\u7684\u5143\u7d20\uff0c\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u67d0\u4e2a\u5143\u7d20\u88ab\u91cd\u590d\u904d\u5386\u6216\u904d\u5386\u4e0d\u5230\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u6709\u4e24\u79cd\u6bd4\u8f83\u5e72\u8106\u5229\u7d22\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u6765\u907f\u514d\u51fa\u73b0\u8fd9\u79cd\u4e0d\u53ef\u9884\u671f\u7684\u8fd0\u884c\u7ed3\u679c\u3002\u4e00\u79cd\u662f\u904d\u5386\u7684\u65f6\u5019\u4e0d\u5141\u8bb8\u589e\u5220\u5143\u7d20\uff0c\u53e6\u4e00\u79cd\u662f\u589e\u5220\u5143\u7d20\u4e4b\u540e\u8ba9\u904d\u5386\u62a5\u9519\u3002\u7b2c\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\u6bd4\u8f83\u96be\u5b9e\u73b0\uff0c\u56e0\u4e3a\u5f88\u96be\u786e\u5b9a\u8fed\u4ee3\u5668\u4f7f\u7528\u7ed3\u675f\u7684\u65f6\u95f4\u70b9\u3002\u7b2c\u4e8c\u79cd\u89e3\u51b3\u65b9\u6848\u66f4\u52a0\u5408\u7406\uff0cJava \u8bed\u8a00\u5c31\u662f\u91c7\u7528\u7684\u8fd9\u79cd\u89e3\u51b3\u65b9\u6848\u3002\u589e\u5220\u5143\u7d20\u4e4b\u540e\uff0c\u6211\u4eec\u9009\u62e9 fail-fast \u89e3\u51b3\u65b9\u5f0f\uff0c\u8ba9\u904d\u5386\u64cd\u4f5c\u76f4\u63a5\u629b\u51fa\u8fd0\u884c\u65f6\u5f02\u5e38\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_7","title":"\u516d \u72b6\u6001\u6a21\u5f0f","text":"<p>\u72b6\u6001\u6a21\u5f0f\u4e00\u822c\u7528\u6765\u5b9e\u73b0\u72b6\u6001\u673a\uff0c\u800c\u72b6\u6001\u673a\u5e38\u7528\u5728\u6e38\u620f\u3001\u5de5\u4f5c\u6d41\u5f15\u64ce\u7b49\u7cfb\u7edf\u5f00\u53d1\u4e2d\u3002\u72b6\u6001\u673a\u53c8\u53eb\u6709\u9650\u72b6\u6001\u673a\uff0c\u5b83\u7531 3 \u4e2a\u90e8\u5206\u7ec4\u6210\uff1a\u72b6\u6001\u3001\u4e8b\u4ef6\u3001\u52a8\u4f5c\u3002\u5176\u4e2d\uff0c\u4e8b\u4ef6\u4e5f\u79f0\u4e3a\u8f6c\u79fb\u6761\u4ef6\u3002\u4e8b\u4ef6\u89e6\u53d1\u72b6\u6001\u7684\u8f6c\u79fb\u53ca\u52a8\u4f5c\u7684\u6267\u884c\u3002\u4e0d\u8fc7\uff0c\u52a8\u4f5c\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u4e5f\u53ef\u80fd\u53ea\u8f6c\u79fb\u72b6\u6001\uff0c\u4e0d\u6267\u884c\u4efb\u4f55\u52a8\u4f5c\u3002 </p> <p>\u9488\u5bf9\u72b6\u6001\u673a\uff0c\u6211\u4eec\u603b\u7ed3\u4e86\u4e09\u79cd\u5b9e\u73b0\u65b9\u5f0f\u3002 </p> <p>\u7b2c\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u53eb\u5206\u652f\u903b\u8f91\u6cd5\u3002\u5229\u7528 if-else \u6216\u8005 switch-case \u5206\u652f\u903b\u8f91\uff0c\u53c2\u7167\u72b6\u6001\u8f6c\u79fb\u56fe\uff0c\u5c06\u6bcf\u4e00\u4e2a\u72b6\u6001\u8f6c\u79fb\u539f\u6a21\u539f\u6837\u5730\u76f4\u8bd1\u6210\u4ee3\u7801\u3002\u5bf9\u4e8e\u7b80\u5355\u7684\u72b6\u6001\u673a\u6765\u8bf4\uff0c\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u6700\u7b80\u5355\u3001\u6700\u76f4\u63a5\uff0c\u662f\u9996\u9009\u3002 </p> <p>\u7b2c\u4e8c\u79cd\u5b9e\u73b0\u65b9\u5f0f\u53eb\u67e5\u8868\u6cd5\u3002\u5bf9\u4e8e\u72b6\u6001\u5f88\u591a\u3001\u72b6\u6001\u8f6c\u79fb\u6bd4\u8f83\u590d\u6742\u7684\u72b6\u6001\u673a\u6765\u8bf4\uff0c\u67e5\u8868\u6cd5\u6bd4\u8f83\u5408\u9002\u3002\u901a\u8fc7\u4e8c\u7ef4\u6570\u7ec4\u6765\u8868\u793a\u72b6\u6001\u8f6c\u79fb\u56fe\uff0c\u80fd\u6781\u5927\u5730\u63d0\u9ad8\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002 </p> <p>\u7b2c\u4e09\u79cd\u5b9e\u73b0\u65b9\u5f0f\u5c31\u662f\u5229\u7528\u72b6\u6001\u6a21\u5f0f\u3002\u5bf9\u4e8e\u72b6\u6001\u5e76\u4e0d\u591a\u3001\u72b6\u6001\u8f6c\u79fb\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u4e8b\u4ef6\u89e6\u53d1\u6267 </p> <p>\u884c\u7684\u52a8\u4f5c\u5305\u542b\u7684\u4e1a\u52a1\u903b\u8f91\u53ef\u80fd\u6bd4\u8f83\u590d\u6742\u7684\u72b6\u6001\u673a\u6765\u8bf4\uff0c\u6211\u4eec\u9996\u9009\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_8","title":"\u4e03 \u8bbf\u95ee\u8005\u6a21\u5f0f","text":"<p>\u8bbf\u95ee\u8005\u6a21\u5f0f\u5141\u8bb8\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u64cd\u4f5c\u5e94\u7528\u5230\u4e00\u7ec4\u5bf9\u8c61\u4e0a\uff0c\u8bbe\u8ba1\u610f\u56fe\u662f\u89e3\u8026\u64cd\u4f5c\u548c\u5bf9\u8c61\u672c\u8eab\uff0c\u4fdd\u6301\u7c7b\u804c\u8d23\u5355\u4e00\u3001\u6ee1\u8db3\u5f00\u95ed\u539f\u5219\u4ee5\u53ca\u5e94\u5bf9\u4ee3\u7801\u7684\u590d\u6742\u6027\u3002 </p> <p>\u5bf9\u4e8e\u8bbf\u95ee\u8005\u6a21\u5f0f\uff0c\u5b66\u4e60\u7684\u4e3b\u8981\u96be\u70b9\u5728\u4ee3\u7801\u5b9e\u73b0\u3002\u800c\u4ee3\u7801\u5b9e\u73b0\u6bd4\u8f83\u590d\u6742\u7684\u4e3b\u8981\u539f\u56e0\u662f\uff0c\u51fd\u6570\u91cd\u8f7d\u5728\u5927\u90e8\u5206\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u8bed\u8a00\u4e2d\u662f\u9759\u6001\u7ed1\u5b9a\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8c03\u7528\u7c7b\u7684\u54ea\u4e2a\u91cd\u8f7d\u51fd\u6570\uff0c\u662f\u5728\u7f16\u8bd1\u671f\u95f4\uff0c\u7531\u53c2\u6570\u7684\u58f0\u660e\u7c7b\u578b\u51b3\u5b9a\u7684\uff0c\u800c\u975e\u8fd0\u884c\u65f6\uff0c\u6839\u636e\u53c2\u6570\u7684\u5b9e\u9645\u7c7b\u578b\u51b3\u5b9a\u7684\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u8bb2\u5230 Double Disptach\u3002\u5982\u679c\u67d0\u79cd\u8bed\u8a00\u652f\u6301 Double Dispatch\uff0c\u90a3\u5c31\u4e0d\u9700\u8981\u8bbf\u95ee\u8005\u6a21\u5f0f\u4e86\u3002 </p> <p>\u6b63\u662f\u56e0\u4e3a\u4ee3\u7801\u5b9e\u73b0\u96be\u7406\u89e3\uff0c\u6240\u4ee5\uff0c\u5728\u9879\u76ee\u4e2d\u5e94\u7528\u8fd9\u79cd\u6a21\u5f0f\uff0c\u4f1a\u5bfc\u81f4\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u6bd4\u8f83\u5dee\u3002\u5982\u679c\u4f60\u7684\u540c\u4e8b\u4e0d\u4e86\u89e3\u8fd9\u79cd\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u53ef\u80fd\u5c31\u4f1a\u8bfb\u4e0d\u61c2\u3001\u7ef4\u62a4\u4e0d\u4e86\u4f60\u5199\u7684\u4ee3\u7801\u3002\u6240\u4ee5\uff0c\u9664\u975e\u4e0d\u5f97\u5df2\uff0c\u4e0d\u8981\u4f7f\u7528\u8fd9\u79cd\u6a21\u5f0f\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_9","title":"\u516b \u5907\u5fd8\u5f55\u6a21\u5f0f","text":"<p>\u5907\u5fd8\u5f55\u6a21\u5f0f\u4e5f\u53eb\u5feb\u7167\u6a21\u5f0f\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u5c31\u662f\u5728\u4e0d\u8fdd\u80cc\u5c01\u88c5\u539f\u5219\u7684\u524d\u63d0\u4e0b\uff0c\u6355\u83b7\u4e00\u4e2a\u5bf9\u8c61\u7684\u5185\u90e8\u72b6\u6001\uff0c\u5e76\u5728\u8be5\u5bf9\u8c61\u4e4b\u5916\u4fdd\u5b58\u8fd9\u4e2a\u72b6\u6001\uff0c\u4ee5\u4fbf\u4e4b\u540e\u6062\u590d\u5bf9\u8c61\u4e3a\u5148\u524d\u7684\u72b6\u6001\u3002\u8fd9\u4e2a\u6a21\u5f0f\u7684\u5b9a\u4e49\u8868\u8fbe\u4e86\u4e24\u90e8\u5206\u5185\u5bb9\uff1a\u4e00\u90e8\u5206\u662f\uff0c\u5b58\u50a8\u526f\u672c\u4ee5\u4fbf\u540e\u671f\u6062\u590d\uff1b\u53e6\u4e00\u90e8\u5206\u662f\uff0c\u8981\u5728\u4e0d\u8fdd\u80cc\u5c01\u88c5\u539f\u5219\u7684\u524d\u63d0\u4e0b\uff0c\u8fdb\u884c\u5bf9\u8c61\u7684\u5907\u4efd\u548c\u6062\u590d\u3002 </p> <p>\u5907\u5fd8\u5f55\u6a21\u5f0f\u7684\u5e94\u7528\u573a\u666f\u4e5f\u6bd4\u8f83\u660e\u786e\u548c\u6709\u9650\uff0c\u4e3b\u8981\u7528\u6765\u9632\u4e22\u5931\u3001\u64a4\u9500\u3001\u6062\u590d\u7b49\u3002\u5b83\u8ddf\u5e73\u65f6\u6211\u4eec\u5e38\u8bf4\u7684\u201c\u5907\u4efd\u201d\u5f88\u76f8\u4f3c\u3002\u4e24\u8005\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff0c\u5907\u5fd8\u5f55\u6a21\u5f0f\u66f4\u4fa7\u91cd\u4e8e\u4ee3\u7801\u7684\u8bbe\u8ba1\u548c\u5b9e\u73b0\uff0c\u5907\u4efd\u66f4\u4fa7\u91cd\u67b6\u6784\u8bbe\u8ba1\u6216\u4ea7\u54c1\u8bbe\u8ba1\u3002 </p> <p>\u5bf9\u4e8e\u5927\u5bf9\u8c61\u7684\u5907\u4efd\u6765\u8bf4\uff0c\u5907\u4efd\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u4f1a\u6bd4\u8f83\u5927\uff0c\u5907\u4efd\u548c\u6062\u590d\u7684\u8017\u65f6\u4f1a\u6bd4\u8f83\u957f\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e0d\u540c\u7684\u4e1a\u52a1\u573a\u666f\u6709\u4e0d\u540c\u7684\u5904\u7406\u65b9\u5f0f\u3002\u6bd4\u5982\uff0c\u53ea\u5907\u4efd\u5fc5\u8981\u7684\u6062\u590d\u4fe1\u606f\uff0c\u7ed3\u5408\u6700\u65b0\u7684\u6570\u636e\u6765\u6062\u590d\uff1b\u518d\u6bd4\u5982\uff0c\u5168\u91cf\u5907\u4efd\u548c\u589e\u91cf\u5907\u4efd\u76f8\u7ed3\u5408\uff0c\u4f4e\u9891\u5168\u91cf\u5907\u4efd\uff0c\u9ad8\u9891\u589e\u91cf\u5907\u4efd\uff0c\u4e24\u8005\u7ed3\u5408\u6765\u505a\u6062\u590d\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_10","title":"\u4e5d \u547d\u4ee4\u6a21\u5f0f","text":"<p>\u547d\u4ee4\u6a21\u5f0f\u5728\u5e73\u65f6\u5de5\u4f5c\u4e2d\u5e76\u4e0d\u5e38\u7528\uff0c\u4f60\u7a0d\u5fae\u4e86\u89e3\u4e00\u4e0b\u5c31\u53ef\u4ee5\u3002 \u843d\u5b9e\u5230\u7f16\u7801\u5b9e\u73b0\uff0c\u547d\u4ee4\u6a21\u5f0f\u7528\u5230\u6700\u6838\u5fc3\u7684\u5b9e\u73b0\u624b\u6bb5\uff0c\u5c31\u662f\u5c06\u51fd\u6570\u5c01\u88c5\u6210\u5bf9\u8c61\u3002\u6211\u4eec\u77e5\u9053\uff0c\u5728\u5927\u90e8\u5206\u7f16\u7a0b\u8bed\u8a00\u4e2d\uff0c\u51fd\u6570\u662f\u6ca1\u6cd5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u5176\u4ed6\u51fd\u6570\u7684\uff0c\u4e5f\u6ca1\u6cd5\u8d4b\u503c\u7ed9\u53d8\u91cf\u3002\u501f\u52a9\u547d\u4ee4\u6a21\u5f0f\uff0c\u6211\u4eec\u5c06\u51fd\u6570\u5c01\u88c5\u6210\u5bf9\u8c61\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0\u628a\u51fd\u6570\u50cf\u5bf9\u8c61\u4e00\u6837\u4f7f\u7528\u3002 </p> <p>\u547d\u4ee4\u6a21\u5f0f\u7684\u4e3b\u8981\u4f5c\u7528\u548c\u5e94\u7528\u573a\u666f\uff0c\u662f\u7528\u6765\u63a7\u5236\u547d\u4ee4\u7684\u6267\u884c\uff0c\u6bd4\u5982\uff0c\u5f02\u6b65\u3001\u5ef6\u8fdf\u3001\u6392\u961f\u6267\u884c\u547d\u4ee4\u3001\u64a4\u9500\u91cd\u505a\u547d\u4ee4\u3001\u5b58\u50a8\u547d\u4ee4\u3001\u7ed9\u547d\u4ee4\u8bb0\u5f55\u65e5\u5fd7\u7b49\uff0c\u8fd9\u624d\u662f\u547d\u4ee4\u6a21\u5f0f\u80fd\u53d1\u6325\u72ec\u4e00\u65e0\u4e8c\u4f5c\u7528\u7684\u5730\u65b9\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_11","title":"\u5341 \u89e3\u91ca\u5668\u6a21\u5f0f","text":"<p>\u89e3\u91ca\u5668\u6a21\u5f0f\u4e3a\u67d0\u4e2a\u8bed\u8a00\u5b9a\u4e49\u5b83\u7684\u8bed\u6cd5\uff08\u6216\u8005\u53eb\u6587\u6cd5\uff09\u8868\u793a\uff0c\u5e76\u5b9a\u4e49\u4e00\u4e2a\u89e3\u91ca\u5668\u7528\u6765\u5904\u7406\u8fd9\u4e2a\u8bed\u6cd5\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u91cc\u7684\u201c\u8bed\u8a00\u201d\u4e0d\u4ec5\u4ec5\u6307\u6211\u4eec\u5e73\u65f6\u8bf4\u7684\u4e2d\u3001\u82f1\u3001\u65e5\u3001\u6cd5\u7b49\u5404\u79cd\u8bed\u8a00\u3002\u4ece\u5e7f\u4e49\u4e0a\u6765\u8bb2\uff0c\u53ea\u8981\u662f\u80fd\u627f\u8f7d\u4fe1\u606f\u7684\u8f7d\u4f53\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u79f0\u4e4b\u4e3a\u201c\u8bed\u8a00\u201d\uff0c\u6bd4\u5982\uff0c\u53e4\u4ee3\u7684\u7ed3\u7ef3\u8bb0\u4e8b\u3001 \u76f2\u6587\u3001\u54d1\u8bed\u3001\u6469\u65af\u5bc6\u7801\u7b49\u3002 \u8981\u60f3\u4e86\u89e3\u201c\u8bed\u8a00\u201d\u8981\u8868\u8fbe\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u5c31\u5fc5\u987b\u5b9a\u4e49\u76f8\u5e94\u7684\u8bed\u6cd5\u89c4\u5219\u3002\u8fd9\u6837\uff0c\u4e66\u5199\u8005\u5c31\u53ef\u4ee5\u6839\u636e\u8bed\u6cd5\u89c4\u5219\u6765\u4e66\u5199\u201c\u53e5\u5b50\u201d\uff08\u4e13\u4e1a\u70b9\u7684\u53eb\u6cd5\u5e94\u8be5\u662f\u201c\u8868\u8fbe\u5f0f\u201d\uff09\uff0c\u9605\u8bfb\u8005\u6839\u636e\u8bed\u6cd5\u89c4\u5219\u6765\u9605 \u8bfb\u201c\u53e5\u5b50\u201d\uff0c\u8fd9\u6837\u624d\u80fd\u505a\u5230\u4fe1\u606f\u7684\u6b63\u786e\u4f20\u9012\u3002\u800c\u6211\u4eec\u8981\u8bb2\u7684\u89e3\u91ca\u5668\u6a21\u5f0f\uff0c\u5176\u5b9e\u5c31\u662f\u7528\u6765\u5b9e\u73b0\u6839\u636e\u8bed\u6cd5\u89c4\u5219\u89e3\u8bfb\u201c\u53e5\u5b50\u201d\u7684\u89e3\u91ca\u5668\u3002</p> <p>\u89e3\u91ca\u5668\u6a21\u5f0f\u7684\u4ee3\u7801\u5b9e\u73b0\u6bd4\u8f83\u7075\u6d3b\uff0c\u6ca1\u6709\u56fa\u5b9a\u7684\u6a21\u677f\u3002\u6211\u4eec\u524d\u9762\u8bf4\u8fc7\uff0c\u5e94\u7528\u8bbe\u8ba1\u6a21\u5f0f\u4e3b\u8981\u662f\u5e94\u5bf9\u4ee3\u7801\u7684\u590d\u6742\u6027\uff0c\u89e3\u91ca\u5668\u6a21\u5f0f\u4e5f\u4e0d\u4f8b\u5916\u3002\u5b83\u7684\u4ee3\u7801\u5b9e\u73b0\u7684\u6838\u5fc3\u601d\u60f3\uff0c\u5c31\u662f\u5c06\u8bed\u6cd5\u89e3\u6790\u7684\u5de5\u4f5c\u62c6\u5206\u5230\u5404\u4e2a\u5c0f\u7c7b\u4e2d\uff0c\u4ee5\u6b64\u6765\u907f\u514d\u5927\u800c\u5168\u7684\u89e3\u6790\u7c7b\u3002\u4e00\u822c\u7684\u505a\u6cd5\u662f\uff0c\u5c06\u8bed\u6cd5\u89c4\u5219\u62c6\u5206\u4e00\u4e9b\u5c0f\u7684\u72ec\u7acb\u7684\u5355\u5143\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u5355\u5143\u8fdb\u884c\u89e3\u6790\uff0c\u6700\u7ec8\u5408\u5e76\u4e3a\u5bf9\u6574\u4e2a\u8bed\u6cd5\u89c4\u5219\u7684\u89e3\u6790\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E4%B9%8B%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/#_12","title":"\u5341\u4e00 \u4e2d\u4ecb\u8005\u6a21\u5f0f","text":"<p>\u4e2d\u4ecb\u6a21\u5f0f\u7684\u8bbe\u8ba1\u601d\u60f3\u8ddf\u4e2d\u95f4\u5c42\u5f88\u50cf\uff0c\u901a\u8fc7\u5f15\u5165\u4e2d\u4ecb\u8fd9\u4e2a\u4e2d\u95f4\u5c42\uff0c\u5c06\u4e00\u7ec4\u5bf9\u8c61\u4e4b\u95f4\u7684\u4ea4\u4e92\u5173\u7cfb \uff08\u6216\u8005\u8bf4\u4f9d\u8d56\u5173\u7cfb\uff09\u4ece\u591a\u5bf9\u591a\uff08\u7f51\u72b6\u5173\u7cfb\uff09\u8f6c\u6362\u4e3a\u4e00\u5bf9\u591a\uff08\u661f\u72b6\u5173\u7cfb\uff09\u3002\u539f\u6765\u4e00\u4e2a\u5bf9\u8c61\u8981\u8ddfn \u4e2a\u5bf9\u8c61\u4ea4\u4e92\uff0c\u73b0\u5728\u53ea\u9700\u8981\u8ddf\u4e00\u4e2a\u4e2d\u4ecb\u5bf9\u8c61\u4ea4\u4e92\uff0c\u4ece\u800c\u6700\u5c0f\u5316\u5bf9\u8c61\u4e4b\u95f4\u7684\u4ea4\u4e92\u5173\u7cfb\uff0c\u964d\u4f4e\u4e86\u4ee3\u7801\u7684\u590d\u6742\u5ea6\uff0c\u63d0\u9ad8\u4e86\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002 </p> <p>\u89c2\u5bdf\u8005\u6a21\u5f0f\u548c\u4e2d\u4ecb\u6a21\u5f0f\u90fd\u662f\u4e3a\u4e86\u5b9e\u73b0\u53c2\u4e0e\u8005\u4e4b\u95f4\u7684\u89e3\u8026\uff0c\u7b80\u5316\u4ea4\u4e92\u5173\u7cfb\u3002\u4e24\u8005\u7684\u4e0d\u540c\u5728\u4e8e\u5e94\u7528\u573a\u666f\u4e0a\u3002\u5728\u89c2\u5bdf\u8005\u6a21\u5f0f\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u53c2\u4e0e\u8005\u4e4b\u95f4\u7684\u4ea4\u4e92\u6bd4\u8f83\u6709\u6761\u7406\uff0c\u4e00\u822c\u90fd\u662f\u5355\u5411\u7684\uff0c\u4e00\u4e2a\u53c2\u4e0e\u8005\u53ea\u6709\u4e00\u4e2a\u8eab\u4efd\uff0c\u8981\u4e48\u662f\u89c2\u5bdf\u8005\uff0c\u8981\u4e48\u662f\u88ab\u89c2\u5bdf\u8005\u3002\u800c\u5728\u4e2d\u4ecb\u6a21\u5f0f\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u53c2\u4e0e\u8005\u4e4b\u95f4\u7684\u4ea4\u4e92\u5173\u7cfb\u9519\u7efc\u590d\u6742\uff0c\u65e2\u53ef\u4ee5\u662f\u6d88\u606f\u7684\u53d1\u9001\u8005\u3001\u4e5f\u53ef\u4ee5\u540c\u65f6\u662f\u6d88\u606f\u7684\u63a5\u6536\u8005\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/","title":"1.\u7b80\u5355\u5de5\u5382\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u7b80\u5355\u5de5\u5382\u6a21\u5f0f","text":"<p>\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\u5e76\u4e0d\u5c5e\u4e8e GoF 23 \u4e2a\u7ecf\u5178\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u4f46\u901a\u5e38\u5c06\u5b83\u4f5c\u4e3a\u5b66\u4e60\u5176\u4ed6\u5de5\u5382\u6a21\u5f0f\u7684\u57fa\u7840\uff0c\u5b83\u7684\u8bbe\u8ba1\u601d\u60f3\u5f88\u7b80\u5355\uff0c\u5176\u57fa\u672c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p>\u9996\u5148\u5c06\u9700\u8981\u521b\u5efa\u7684\u5404\u79cd\u4e0d\u540c\u5bf9\u8c61\uff08\u4f8b\u5982\u5404\u79cd\u4e0d\u540c\u7684 Chart \u5bf9\u8c61\uff09\u7684\u76f8\u5173\u4ee3\u7801\u5c01\u88c5\u5230\u4e0d\u540c\u7684\u7c7b\u4e2d\uff0c\u8fd9\u4e9b\u7c7b\u79f0\u4e3a\u5177\u4f53\u4ea7\u54c1\u7c7b\uff0c\u800c\u5c06\u5b83\u4eec\u516c\u5171\u7684\u4ee3\u7801\u8fdb\u884c\u62bd\u8c61\u548c\u63d0\u53d6\u540e\u5c01\u88c5\u5728\u4e00\u4e2a\u62bd\u8c61\u4ea7\u54c1\u7c7b\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u5177\u4f53\u4ea7\u54c1\u7c7b\u90fd\u662f\u62bd\u8c61\u4ea7\u54c1\u7c7b\u7684\u5b50\u7c7b\uff1b\u7136\u540e\u63d0\u4f9b\u4e00\u4e2a\u5de5\u5382\u7c7b\u7528\u4e8e\u521b\u5efa\u5404\u79cd\u4ea7\u54c1\uff0c\u5728\u5de5\u5382\u7c7b\u4e2d\u63d0\u4f9b\u4e00\u4e2a\u521b\u5efa\u4ea7\u54c1\u7684\u5de5\u5382\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u53ef\u4ee5\u6839\u636e\u6240\u4f20\u5165\u7684\u53c2\u6570\u4e0d\u540c\u521b\u5efa\u4e0d\u540c\u7684\u5177\u4f53\u4ea7\u54c1\u5bf9\u8c61\uff1b\u5ba2\u6237\u7aef\u53ea\u9700\u8c03\u7528\u5de5\u5382\u7c7b\u7684\u5de5\u5382\u65b9\u6cd5\u5e76\u4f20\u5165\u76f8\u5e94\u7684\u53c2\u6570\u5373\u53ef\u5f97\u5230\u4e00\u4e2a\u4ea7\u54c1\u5bf9\u8c61\u3002</p> <p>\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\uff08Simple Factory Pattern\uff09\uff1a\u5b9a\u4e49\u4e00\u4e2a\u5de5\u5382\u7c7b\uff0c\u5b83\u53ef\u4ee5\u6839\u636e\u53c2\u6570\u7684\u4e0d\u540c\u8fd4\u56de\u4e0d\u540c\u7c7b\u7684\u5b9e\u4f8b\uff0c\u88ab\u521b\u5efa\u7684\u5b9e\u4f8b\u901a\u5e38\u90fd\u5177\u6709\u5171\u540c\u7684\u7236\u7c7b\u3002\u56e0\u4e3a\u5728\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\u4e2d\u7528\u4e8e\u521b\u5efa\u5b9e\u4f8b\u7684\u65b9\u6cd5\u662f\u9759\u6001\uff08static\uff09\u65b9\u6cd5\uff0c\u56e0\u6b64\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\u53c8\u88ab\u79f0\u4e3a\u9759\u6001\u5de5\u5382\u65b9\u6cd5\uff08Static Factory Method\uff09\u6a21\u5f0f\uff0c\u5b83\u5c5e\u4e8e\u7c7b\u521b\u5efa\u578b\u6a21\u5f0f\u3002</p> <p></p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801\u5b9e\u73b0","text":"<ul> <li>\u5de5\u5382\u65b9\u6cd5</li> </ul> <pre><code>package samplefactory\n\nimport \"fmt\"\n\n// \u7b80\u5355\u5de5\u5382\u6a21\u5f0f\u5b9e\u73b0\u4e00\u4e2a\u7f13\u5b58\u5e93\uff0c\u652f\u6301set/get\u65b9\u6cd5\n// \u6a21\u62df\u652f\u6301Redis/Memcache\n\ntype Cache interface {\n    Set(key, value string)\n    Get(key string)\n}\n\ntype Redis struct {\n    data map[string]string\n}\n\nfunc (r *Redis) Set(key, value string) {\n    r.data[key] = value\n}\n\nfunc (r *Redis) Get(key string) {\n    fmt.Println(\"redis \", r.data[key])\n}\n\ntype Memcache struct {\n    data map[string]string\n}\n\nfunc (m *Memcache) Set(key, value string) {\n    m.data[key] = value\n}\n\nfunc (m *Memcache) Get(key string) {\n    fmt.Println(\"memcache \", m.data[key])\n}\n\ntype cacheType int\n\nconst (\n    r cacheType = iota\n    m\n)\n\nfunc NewCache(i cacheType) Cache {\n    switch i {\n    case r:\n        return &amp;Redis{data: map[string]string{}}\n    case m:\n        return &amp;Memcache{data: map[string]string{}}\n    }\n    return nil\n}\n</code></pre> <ul> <li>\u6d4b\u8bd5\u4ee3\u7801</li> </ul> <pre><code>package samplefactory\n\nimport (\n    \"testing\"\n)\n\nfunc TestNewCache(t *testing.T) {\n    r := NewCache(0)\n    r.Set(\"name\", \"xuel\")\n    r.Get(\"name\")\n\n    m := NewCache(1)\n    m.Set(\"age\", \"22\")\n    m.Get(\"age\")\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<p>\u5f53\u5728\u4ee3\u7801\u91cc\u770b\u5230switch\u7684\u65f6\u5019\uff0c\u5c31\u5e94\u8be5\u601d\u8003\u662f\u5426\u7528\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ol> <li>\u5c06\u5ba2\u6237\u7aef\u548c\u521b\u5efa\u4ea7\u54c1\u5b9e\u4f8b\u89e3\u8026\u5f00\u6765\uff0c\u4f7f\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u5173\u6ce8\u5982\u4f55\u83b7\u53d6\u5b9e\u4f8b\u3002</li> <li>\u7b26\u5408\u5355\u4e00\u804c\u8d23\u3002</li> </ol>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u589e\u52a0\u65b0\u7ffb\u8bd1\u7c7b\u65f6\u8fd8\u662f\u9700\u8981\u6539\u52a8\u5de5\u5382\u7c7b\uff0c\u6ca1\u6709\u7b26\u5408\u5f00\u95ed\u539f\u5219\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://juejin.cn/post/6844903703447765005</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/","title":"2.\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\uff08\u82f1\u8bed\uff1aFactory method pattern\uff09\u662f\u4e00\u79cd\u5b9e\u73b0\u4e86\u201c\u5de5\u5382\u201d\u6982\u5ff5\u7684\u9762\u5411\u5bf9\u8c61\u8bbe\u8ba1\u6a21\u5f0f\u3002\u5c31\u50cf\u5176\u4ed6\u521b\u5efa\u578b\u6a21\u5f0f\u4e00\u6837\uff0c\u5b83\u4e5f\u662f\u5904\u7406\u5728\u4e0d\u6307\u5b9a\u5bf9\u8c61\u5177\u4f53\u7c7b\u578b\u7684\u60c5\u51b5\u4e0b\u521b\u5efa\u5bf9\u8c61\u7684\u95ee\u9898\u3002\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u7684\u5b9e\u8d28\u662f\u201c\u5b9a\u4e49\u4e00\u4e2a\u521b\u5efa\u5bf9\u8c61\u7684\u63a5\u53e3\uff0c\u4f46\u8ba9\u5b9e\u73b0\u8fd9\u4e2a\u63a5\u53e3\u7684\u7c7b\u6765\u51b3\u5b9a\u5b9e\u4f8b\u5316\u54ea\u4e2a\u7c7b\u3002\u5de5\u5382\u65b9\u6cd5\u8ba9\u7c7b\u7684\u5b9e\u4f8b\u5316\u63a8\u8fdf\u5230\u5b50\u7c7b\u4e2d\u8fdb\u884c\u3002\u201d</p> <p>\u4e0a\u9762\u662f \u7ef4\u57fa\u767e\u79d1 \u4e2d\u5bf9\u5de5\u5382\u65b9\u6cd5\u7684\u5b9a\u4e49\uff0c\u5728\u4e0a\u4e00\u7bc7 golang\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7b80\u5355\u5de5\u5382\u6a21\u5f0f \u4e2d\u6211\u4eec\u4ecb\u7ecd\u8fc7\uff0c\u552f\u4e00\u7684\u4e00\u4e2a\u5de5\u5382\u63a7\u5236\u7740 \u6240\u6709\u4ea7\u54c1\u7684\u5b9e\u4f8b\u5316\uff0c\u800c <code>\u5de5\u5382\u65b9\u6cd5</code> \u4e2d\u5305\u62ec\u4e00\u4e2a\u5de5\u5382\u63a5\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u52a8\u6001\u7684\u5b9e\u73b0\u591a\u79cd\u5de5\u5382\uff0c\u8fbe\u5230\u6269\u5c55\u7684\u76ee\u7684</p> <ul> <li>\u7b80\u5355\u5de5\u5382\u9700\u8981:</li> <li>\u5de5\u5382\u7ed3\u6784\u4f53</li> <li>\u4ea7\u54c1\u63a5\u53e3</li> <li>\u4ea7\u54c1\u7ed3\u6784\u4f53</li> <li>\u5de5\u5382\u65b9\u6cd5\u9700\u8981:</li> <li>\u5de5\u5382\u63a5\u53e3</li> <li>\u5de5\u5382\u7ed3\u6784\u4f53</li> <li>\u4ea7\u54c1\u63a5\u53e3</li> <li>\u4ea7\u54c1\u7ed3\u6784\u4f53</li> </ul> <p>\u5728 <code>\u7b80\u5355\u5de5\u5382</code> \u4e2d\uff0c\u4f9d\u8d56\u4e8e\u552f\u4e00\u7684\u5de5\u5382\u5bf9\u8c61\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u5b9e\u4f8b\u5316\u4e00\u4e2a\u4ea7\u54c1\uff0c\u90a3\u4e48\u5c31\u8981\u5411\u5de5\u5382\u4e2d\u4f20\u5165\u4e00\u4e2a\u53c2\u6570\u83b7\u53d6\u5bf9\u5e94\u5bf9\u8c61\uff0c\u5982\u679c\u8981\u589e\u52a0\u4e00\u79cd\u4ea7\u54c1\uff0c\u5c31\u8981\u5728\u5de5\u5382\u4e2d\u4fee\u6539\u521b\u5efa\u4ea7\u54c1\u7684\u51fd\u6570\uff0c\u8026\u5408\u6027\u8fc7\u9ad8 \uff0c\u800c\u5728 <code>\u5de5\u5382\u65b9\u6cd5</code> \u4e2d\uff0c\u4f9d\u8d56\u5de5\u5382\u63a5\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b9e\u73b0\u5de5\u5382\u63a5\u53e3\uff0c\u521b\u5efa\u591a\u79cd\u5de5\u5382\uff0c\u5c06\u5bf9\u8c61\u521b\u5efa\u7531\u4e00\u4e2a\u5bf9\u8c61\u8d1f\u8d23\u6240\u6709\u5177\u4f53\u7c7b\u7684\u5b9e\u4f8b\u5316\uff0c\u53d8\u6210\u7531\u4e00\u7fa4\u5b50\u7c7b\u6765\u8d1f\u8d23\u5bf9\u5177\u4f53\u7c7b\u7684\u5b9e\u4f8b\u5316\uff0c\u5c06\u8fc7\u7a0b\u89e3\u8026\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package factorymethod\n\n// \u9700\u6c42\uff1a\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u6a21\u62df\u5b9e\u73b0\u4e00\u4e2a\u7f13\u5b58\u5e93\uff0c\u652f\u6301get/set\u65b9\u6cd5\uff0c\u540c\u65f6\u652f\u6301Redis/Memcache\n\n// \u5b9a\u4e49\u7f13\u5b58\u5e93\ntype Cache interface {\n    Set(key, value string)\n    Get(key string) string\n}\n\n// \u5b9a\u4e49Redis\u5bf9\u8c61\ntype Redis struct {\n    data map[string]string\n}\n\nfunc NewRedis() *Redis {\n    return &amp;Redis{\n        data: make(map[string]string),\n    }\n}\n\nfunc (r *Redis) Set(key, value string) {\n    r.data[key] = value\n}\n\nfunc (r *Redis) Get(key string) string {\n    return r.data[key]\n}\n\n// \u5b9a\u4e49Memcache\u5bf9\u8c61\ntype Memcache struct {\n    data map[string]string\n}\n\nfunc NewMemcache() *Memcache {\n    return &amp;Memcache{\n        data: make(map[string]string),\n    }\n}\n\nfunc (m *Memcache) Set(key, value string) {\n    m.data[key] = value\n}\n\nfunc (m *Memcache) Get(key string) string {\n    return m.data[key]\n}\n\ntype CacheFactory interface {\n    Create() Cache\n}\n\ntype RedisFactory struct {\n}\n\nfunc (rf RedisFactory) Create() Cache {\n    return NewRedis()\n}\n\ntype MemcacheFactory struct {\n}\n\nfunc (mf MemcacheFactory) Create() Cache {\n    return NewMemcache()\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package factorymethod\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestMemcache_Create(t *testing.T) {\n    var memCacheFacotory CacheFactory\n\n    memCacheFacotory = MemcacheFactory{}\n    memcache := memCacheFacotory.Create()\n    memcache.Set(\"name\", \"xuel\")\n    rest := memcache.Get(\"name\")\n    fmt.Println(rest)\n\n}\nfunc TestRedisFactory_Create(t *testing.T) {\n    var redisFactory CacheFactory\n    redisFactory = RedisFactory{}\n    redis := redisFactory.Create()\n    redis.Set(\"age\", \"22\")\n    rest := redis.Get(\"age\")\n    fmt.Println(rest)\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<p>\u7b80\u5355\u5de5\u5382\u6a21\u5f0f\u548c\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u770b\u8d77\u6765\u5f88\u76f8\u4f3c\uff0c\u672c\u8d28\u533a\u522b\u5c31\u5728\u4e8e\uff0c\u5982\u679c\u5728\u5305\u5b50\u5e97\u4e2d\u76f4\u63a5\u521b\u5efa\u5305\u5b50\u4ea7\u54c1\uff0c\u662f\u4f9d\u8d56\u5177\u4f53\u5305\u5b50\u5e97\u7684\uff0c\u6269\u5c55\u6027\u3001\u5f39\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u90fd\u8f83\u5dee\uff0c\u800c\u5982\u679c\u5c06\u5b9e\u4f8b\u5316\u7684\u4ee3\u7801\u62bd\u8c61\u51fa\u6765\uff0c\u4e0d\u518d\u4f9d\u8d56\u5177\u4f53\u5305\u5b50\u5e97\uff0c\u800c\u662f\u4f9d\u8d56\u4e8e\u62bd\u8c61\u7684\u5305\u5b50\u63a5\u53e3\uff0c\u4f7f\u5bf9\u8c61\u7684\u5b9e\u73b0\u4ece\u4f7f\u7528\u4e2d\u89e3\u8026\uff0c\u8fd9\u6837\u5c31\u62e5\u6709\u5f88\u5f3a\u7684\u6269\u5c55\u6027\u4e86\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e3a \u300e\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\u300f</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9:","text":"<ol> <li>\u7b26\u5408\u201c\u5f00\u95ed\u201d\u539f\u5219\uff0c\u5177\u6709\u5f88\u5f3a\u7684\u7684\u6269\u5c55\u6027\u3001\u5f39\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002\u4fee\u6539\u65f6\u53ea\u9700\u8981\u6dfb\u52a0\u5bf9\u5e94\u7684\u5de5\u5382\u7c7b\u5373\u53ef</li> <li>\u4f7f\u7528\u4e86\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\uff0c\u4f9d\u8d56\u62bd\u8c61\u800c\u4e0d\u662f\u5177\u4f53\uff0c\u4f7f\u7528\uff08\u5ba2\u6237\uff09\u548c\u5b9e\u73b0\uff08\u5177\u4f53\u7c7b\uff09\u677e\u8026\u5408</li> <li>\u5ba2\u6237\u53ea\u9700\u8981\u77e5\u9053\u6240\u9700\u4ea7\u54c1\u7684\u5177\u4f53\u5de5\u5382\uff0c\u800c\u65e0\u987b\u77e5\u9053\u5177\u4f53\u5de5\u5382\u7684\u521b\u5efa\u4ea7\u54c1\u7684\u8fc7\u7a0b\uff0c\u751a\u81f3\u4e0d\u9700\u8981\u77e5\u9053\u5177\u4f53\u4ea7\u54c1\u7684\u7c7b\u540d\u3002</li> </ol>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9:","text":"<ol> <li>\u6bcf\u589e\u52a0\u4e00\u4e2a\u4ea7\u54c1\u65f6\uff0c\u90fd\u9700\u8981\u4e00\u4e2a\u5177\u4f53\u7c7b\u548c\u4e00\u4e2a\u5177\u4f53\u521b\u5efa\u8005\uff0c\u4f7f\u5f97\u7c7b\u7684\u4e2a\u6570\u6210\u500d\u589e\u52a0\uff0c\u5bfc\u81f4\u7cfb\u7edf\u7c7b\u6570\u76ee\u8fc7\u591a\uff0c\u590d\u6742\u6027\u589e\u52a0</li> <li>\u5bf9\u7b80\u5355\u5de5\u5382\uff0c\u589e\u52a0\u529f\u80fd\u4fee\u6539\u7684\u662f\u5de5\u5382\u7c7b\uff1b\u5bf9\u5de5\u5382\u65b9\u6cd5\uff0c\u589e\u52a0\u529f\u80fd\u4fee\u6539\u7684\u662f\u4ea7\u54c1\u7c7b\u3002</li> </ol>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://juejin.cn/post/6844903704189992967</li> <li>https://github.com/silsuer/golang-design-patterns</li> <li>https://refactoringguru.cn/design-patterns/factory-method</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/","title":"3.\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\uff08\u82f1\u8bed\uff1aAbstract factory pattern\uff09\u662f\u4e00\u79cd\u8f6f\u4ef6\u5f00\u53d1\u8bbe\u8ba1\u6a21\u5f0f\u3002\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5c06\u4e00\u7ec4\u5177\u6709\u540c\u4e00\u4e3b\u9898\u7684\u5355\u72ec\u7684\u5de5\u5382\u5c01\u88c5\u8d77\u6765\u3002\u5728\u6b63\u5e38\u4f7f\u7528\u4e2d\uff0c\u5ba2\u6237\u7aef\u7a0b\u5e8f\u9700\u8981\u521b\u5efa\u62bd\u8c61\u5de5\u5382\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u7136\u540e\u4f7f\u7528\u62bd\u8c61\u5de5\u5382\u4f5c\u4e3a\u63a5\u53e3\u6765\u521b\u5efa\u8fd9\u4e00\u4e3b\u9898\u7684\u5177\u4f53\u5bf9\u8c61\u3002\u5ba2\u6237\u7aef\u7a0b\u5e8f\u4e0d\u9700\u8981\u77e5\u9053\uff08\u6216\u5173\u5fc3\uff09\u5b83\u4ece\u8fd9\u4e9b\u5185\u90e8\u7684\u5de5\u5382\u65b9\u6cd5\u4e2d\u83b7\u5f97\u5bf9\u8c61\u7684\u5177\u4f53\u7c7b\u578b\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u4ec5\u4f7f\u7528\u8fd9\u4e9b\u5bf9\u8c61\u7684\u901a\u7528\u63a5\u53e3\u3002\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u5c06\u4e00\u7ec4\u5bf9\u8c61\u7684\u5b9e\u73b0\u7ec6\u8282\u4e0e\u4ed6\u4eec\u7684\u4e00\u822c\u4f7f\u7528\u5206\u79bb\u5f00\u6765\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package abstractfactory\n\ntype Cache interface {\n    Get(key string) string\n    Set(key, value string)\n}\n\ntype Redis struct {\n    date map[string]string\n}\n\nfunc NewRedis() *Redis {\n    return &amp;Redis{\n        date: make(map[string]string),\n    }\n}\n\nfunc (r *Redis) Get(key string) string  {\n    if v, ok := r.date[key] ; ok {\n        return v\n    }\n    return \"\"\n}\n\nfunc (r *Redis) Set(key,value string)  {\n    r.date[key]=value\n}\n\ntype Memcache struct {\n    date map[string]string\n}\n\nfunc NewMemcache() *Memcache {\n    return &amp;Memcache{\n        date: make(map[string]string),\n    }\n}\n\nfunc (r *Memcache) Get(key string) string  {\n    if v, ok := r.date[key] ; ok {\n        return v\n    }\n    return \"\"\n}\n\nfunc (r *Memcache) Set(key,value string)  {\n    r.date[key]=value\n}\n\ntype CacheSampleFactory interface {\n    CreateRedis() Cache\n    CreateMemcache() Cache\n}\n\ntype SampleFactory struct {\n}\n\nfunc NewSampleFactory() *SampleFactory {\n    return &amp;SampleFactory{}\n}\n\nfunc (s *SampleFactory) CreateRedis() Cache  {\n    return NewRedis()\n}\n\nfunc (s *SampleFactory) CreateMemcache() Cache  {\n    return NewMemcache()\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package abstractfactory\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestNewSampleFactory(t *testing.T) {\n    s := NewSampleFactory()\n    r := s.CreateRedis()\n\n    r.Set(\"r\", \"rv\")\n    t.Logf(r.Get(\"r\"))\n    fmt.Println(r.Get(\"r\"))\n\n    m := s.CreateMemcache()\n    m.Set(\"m\",\"mv\")\n    t.Logf(m.Get(\"m\"))\n    fmt.Println(m.Get(\"m\"))\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u62bd\u8c61\u5de5\u5382\u4e3a\u4f60\u63d0\u4f9b\u4e86\u4e00\u4e2a\u63a5\u53e3\uff0c \u53ef\u7528\u4e8e\u521b\u5efa\u6bcf\u4e2a\u7cfb\u5217\u4ea7\u54c1\u7684\u5bf9\u8c61\u3002 \u53ea\u8981\u4ee3\u7801\u901a\u8fc7\u8be5\u63a5\u53e3\u521b\u5efa\u5bf9\u8c61\uff0c \u90a3\u4e48\u4f60\u5c31\u4e0d\u4f1a\u751f\u6210\u4e0e\u5e94\u7528\u7a0b\u5e8f\u5df2\u751f\u6210\u7684\u4ea7\u54c1\u7c7b\u578b\u4e0d\u4e00\u81f4\u7684\u4ea7\u54c1\u3002</li> <li>\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u57fa\u4e8e\u4e00\u7ec4\u7684\u7c7b\uff0c\u4e14\u5176\u4e3b\u8981\u529f\u80fd\u56e0\u6b64\u53d8\u5f97\u4e0d\u660e\u786e\uff0c\u90a3\u4e48\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u3002</li> <li>\u5728\u8bbe\u8ba1\u826f\u597d\u7684\u7a0b\u5e8f\u4e2d\uff0c \u6bcf\u4e2a\u7c7b\u4ec5\u8d1f\u8d23\u4e00\u4ef6\u4e8b\u3002 \u5982\u679c\u4e00\u4e2a\u7c7b\u4e0e\u591a\u79cd\u7c7b\u578b\u4ea7\u54c1\u4ea4\u4e92\uff0c \u5c31\u53ef\u4ee5\u8003\u8651\u5c06\u5de5\u5382\u65b9\u6cd5\u62bd\u53d6\u5230\u72ec\u7acb\u7684\u5de5\u5382\u7c7b\u6216\u5177\u5907\u5b8c\u6574\u529f\u80fd\u7684\u62bd\u8c61\u5de5\u5382\u7c7b\u4e2d\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":"<ul> <li>\u4f18\u70b9: \u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u9664\u4e86\u5177\u6709\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u7684\u4f18\u70b9\u5916\uff0c\u6700\u4e3b\u8981\u7684\u4f18\u70b9\u5c31\u662f\u53ef\u4ee5\u5728\u7c7b\u7684\u5185\u90e8\u5bf9\u4ea7\u54c1\u65cf\u8fdb\u884c\u7ea6\u675f\u3002\u6240\u8c13\u7684\u4ea7\u54c1\u65cf\uff0c\u4e00\u822c\u6216\u591a\u6216\u5c11\u7684\u90fd\u5b58\u5728\u4e00\u5b9a\u7684\u5173\u8054\uff0c\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u5c31\u53ef\u4ee5\u5728\u7c7b\u5185\u90e8\u5bf9\u4ea7\u54c1\u65cf\u7684\u5173\u8054\u5173\u7cfb\u8fdb\u884c\u5b9a\u4e49\u548c\u63cf\u8ff0\uff0c\u800c\u4e0d\u5fc5\u4e13\u95e8\u5f15\u5165\u4e00\u4e2a\u65b0\u7684\u7c7b\u6765\u8fdb\u884c\u7ba1\u7406\u3002</li> <li>\u7f3a\u70b9: \u4ea7\u54c1\u65cf\u7684\u6269\u5c55\u5c06\u662f\u4e00\u4ef6\u5341\u5206\u8d39\u529b\u7684\u4e8b\u60c5\uff0c\u5047\u5982\u4ea7\u54c1\u65cf\u4e2d\u9700\u8981\u589e\u52a0\u4e00\u4e2a\u65b0\u7684\u4ea7\u54c1\uff0c\u5219\u51e0\u4e4e\u6240\u6709\u7684\u5de5\u5382\u7c7b\u90fd\u9700\u8981\u8fdb\u884c\u4fee\u6539\u3002\u6240\u4ee5\u4f7f\u7528\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u65f6\uff0c\u5bf9\u4ea7\u54c1\u7b49\u7ea7\u7ed3\u6784\u7684\u5212\u5206\u662f\u975e\u5e38\u91cd\u8981\u7684</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://juejin.cn/post/6844903705091768334</li> <li>https://github.com/silsuer/golang-design-patterns</li> <li>https://refactoringguru.cn/design-patterns/abstract-factory</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/","title":"4.\u5efa\u9020\u8005(\u751f\u6210\u5668)\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u5efa\u9020\u8005\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u9020\u8005\u6a21\u5f0f(Builder Pattern)\uff1a\u5c06\u4e00\u4e2a\u590d\u6742\u5bf9\u8c61\u7684\u6784\u5efa\u4e0e\u5b83\u7684\u8868\u793a\u5206\u79bb\uff0c\u4f7f\u5f97\u540c\u6837\u7684\u6784\u5efa\u8fc7\u7a0b\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u8868\u793a\u3002</p> <p>\u5efa\u9020\u8005\u6a21\u5f0f\u662f\u4e00\u6b65\u4e00\u6b65\u521b\u5efa\u4e00\u4e2a\u590d\u6742\u7684\u5bf9\u8c61\uff0c\u5b83\u5141\u8bb8\u7528\u6237\u53ea\u901a\u8fc7\u6307\u5b9a\u590d\u6742\u5bf9\u8c61\u7684\u7c7b\u578b\u548c\u5185\u5bb9\u5c31\u53ef\u4ee5\u6784\u5efa\u5b83\u4eec\uff0c\u7528\u6237\u4e0d\u9700\u8981\u77e5\u9053\u5185\u90e8\u7684\u5177\u4f53\u6784\u5efa\u7ec6\u8282\u3002\u5efa\u9020\u8005\u6a21\u5f0f\u5c5e\u4e8e\u5bf9\u8c61\u521b\u5efa\u578b\u6a21\u5f0f\u3002\u6839\u636e\u4e2d\u6587\u7ffb\u8bd1\u7684\u4e0d\u540c\uff0c\u5efa\u9020\u8005\u6a21\u5f0f\u53c8\u53ef\u4ee5\u79f0\u4e3a\u751f\u6210\u5668\u6a21\u5f0f\u3002</p> <p>\u5f53\u4e00\u4e2a\u65b9\u6cd5\u6709\u591a\u4e2a\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5728\u8c03\u7528\u8be5\u65b9\u6cd5\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u56e0\u4e3a\u53c2\u6570\u7684\u987a\u5e8f\u3001\u4e2a\u6570\u9519\u8bef\uff0c\u800c\u9020\u6210\u8c03\u7528\u9519\u8bef\u6216\u8005\u4e0d\u80fd\u8fbe\u5230\u6211\u4eec\u9884\u671f\u7684\u76ee\u7684\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u7684\u5efa\u9020\u8bbe\u8ba1\u6a21\u5f0f\u53ef\u4ee5\u5b8c\u7f8e\u7684\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package builder\n\nimport \"fmt\"\n\ntype Deployment struct {\n    Name string\n    // \u955c\u50cf\u4fe1\u606f\n    Image, ContainerName string\n    // \u7aef\u53e3\u4fe1\u606f\n    SvcPort, ContainerPort int\n}\n\nfunc (d *Deployment) String() string {\n    return fmt.Sprintf(\"Name:%s,Image:%s,ContainerName:%s,SvcPort:%d,ContainerPort:%d\",\n        d.Name,d.Image,d.ContainerName,d.SvcPort,d.ContainerPort)\n}\n\ntype DeploymentBuilder struct {\n    deployment *Deployment\n}\n\n// \u603b\u4f53deployment \u5de5\u5382\u51fd\u6570\nfunc NewDeploymentBuilder() *DeploymentBuilder  {\n    return &amp;DeploymentBuilder{deployment: &amp;Deployment{}}\n}\n\n// Deployment \u955c\u50cf\u5efa\u9020\u8005\ntype DeployImgBuilder struct {\n    DeploymentBuilder\n}\n\n// Deployment \u7aef\u53e3\u5efa\u9020\u8005\ntype DeployPortBuilder struct {\n    DeploymentBuilder\n}\n\n// \u955c\u50cf\u5efa\u9020\nfunc (d *DeploymentBuilder) imgs() *DeployImgBuilder {\n    return &amp;DeployImgBuilder{*d}\n}\n\n// \u7aef\u53e3\u5efa\u9020\nfunc (d *DeploymentBuilder) ports() *DeployPortBuilder  {\n    return &amp;DeployPortBuilder{*d}\n}\n\n// \u4f7f\u7528 DeployImgBuilder/DeployPortBuilder \u521b\u5efa\u4e00\u4e9b\u884c\u4e3a/\u51fd\u6570/\u65b9\u6cd5\uff0c\u7528\u4e8e\u8bbe\u7f6eDeployment\u7684\u5c5e\u6027\nfunc (d *DeploymentBuilder) Name(name string) *DeploymentBuilder  {\n    d.deployment.Name = name\n    return d\n}\n\n// DeployImgBuilder \u8bbe\u7f6e\u955c\u50cf\u540d\u79f0\nfunc (i *DeployImgBuilder) Image(n string) *DeployImgBuilder {\n    i.deployment.Image = n\n    return i\n}\n\n// DeployImgBuilder \u8bbe\u7f6e\u5bb9\u5668\u540d\u79f0\nfunc (i *DeployImgBuilder) ContainerName(n string) *DeployImgBuilder  {\n    i.deployment.ContainerName = n\n    return i\n}\n\n// DeployPortBuilder \u8bbe\u7f6esvc\u7aef\u53e3\nfunc (p *DeployPortBuilder) SvcPort(o int) *DeployPortBuilder  {\n    p.deployment.SvcPort = o\n    return p\n}\n\n// DeployPortBuilder \u8bbe\u7f6e\u5bb9\u5668\u7aef\u53e3\nfunc (p *DeployPortBuilder) ContainerPort(o int) *DeployPortBuilder  {\n    p.deployment.ContainerPort = o\n    return p\n}\n\n// \u6700\u540e\u4f7f\u7528DeploymentBuilder \u6765\u8fd4\u56debuilder\nfunc (b *DeploymentBuilder) build() *Deployment  {\n    return b.deployment\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package builder\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestNewDeploymentBuilder(t *testing.T) {\n    db := NewDeploymentBuilder()\n    deploy := db.Name(\"deployname\").\n        imgs().\n            ContainerName(\"cname\").\n            Image(\"cimage\").\n        ports().\n            ContainerPort(80).\n            SvcPort(30088).\n        build()\n    t.Logf(deploy.String())\n    fmt.Println(deploy.String())\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u9700\u8981\u751f\u6210\u7684\u4ea7\u54c1\u5bf9\u8c61\u6709\u590d\u6742\u7684\u5185\u90e8\u7ed3\u6784\uff0c\u8fd9\u4e9b\u4ea7\u54c1\u5bf9\u8c61\u901a\u5e38\u5305\u542b\u591a\u4e2a\u6210\u5458\u5c5e\u6027\u3002</li> <li>\u9700\u8981\u751f\u6210\u7684\u4ea7\u54c1\u5bf9\u8c61\u7684\u5c5e\u6027\u76f8\u4e92\u4f9d\u8d56\uff0c\u9700\u8981\u6307\u5b9a\u5176\u751f\u6210\u987a\u5e8f\u3002</li> <li>\u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b\u72ec\u7acb\u4e8e\u521b\u5efa\u8be5\u5bf9\u8c61\u7684\u7c7b\u3002\u5728\u5efa\u9020\u8005\u6a21\u5f0f\u4e2d\u5f15\u5165\u4e86\u6307\u6325\u8005\u7c7b\uff0c\u5c06\u521b\u5efa\u8fc7\u7a0b\u5c01\u88c5\u5728\u6307\u6325\u8005\u7c7b\u4e2d\uff0c\u800c\u4e0d\u5728\u5efa\u9020\u8005\u7c7b\u4e2d\u3002</li> <li>\u9694\u79bb\u590d\u6742\u5bf9\u8c61\u7684\u521b\u5efa\u548c\u4f7f\u7528\uff0c\u5e76\u4f7f\u5f97\u76f8\u540c\u7684\u521b\u5efa\u8fc7\u7a0b\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u4ea7\u54c1\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ul> <li>\u751f\u6210\u4e0d\u540c\u5f62\u5f0f\u7684\u4ea7\u54c1\u65f6\uff0c \u4f60\u53ef\u4ee5\u590d\u7528\u76f8\u540c\u7684\u5236\u9020\u4ee3\u7801\u3002</li> <li>\u4f60\u53ef\u4ee5\u5206\u6b65\u521b\u5efa\u5bf9\u8c61\uff0c \u6682\u7f13\u521b\u5efa\u6b65\u9aa4\u6216\u9012\u5f52\u8fd0\u884c\u521b\u5efa\u6b65\u9aa4\u3002</li> <li>\u5355\u4e00\u804c\u8d23\u539f\u5219\u3002 \u4f60\u53ef\u4ee5\u5c06\u590d\u6742\u6784\u9020\u4ee3\u7801\u4ece\u4ea7\u54c1\u7684\u4e1a\u52a1\u903b\u8f91\u4e2d\u5206\u79bb\u51fa\u6765\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u7531\u4e8e\u8be5\u6a21\u5f0f\u9700\u8981\u65b0\u589e\u591a\u4e2a\u7c7b\uff0c \u56e0\u6b64\u4ee3\u7801\u6574\u4f53\u590d\u6742\u7a0b\u5ea6\u4f1a\u6709\u6240\u589e\u52a0\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://juejin.cn/post/6844903704189992967</li> <li>https://github.com/silsuer/golang-design-patterns</li> <li>https://refactoringguru.cn/design-patterns/factory-method</li> <li>https://www.bookstack.cn/read/design-patterns/98fde31c319ecbaa.md</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/","title":"5.\u5355\u4f8b\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u5355\u4f8b\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u5355\u4f8b\u6a21\u5f0f\uff0c\u4e5f\u53eb\u5355\u5b50\u6a21\u5f0f\uff0c\u662f\u4e00\u79cd\u5e38\u7528\u7684\u8f6f\u4ef6\u8bbe\u8ba1\u6a21\u5f0f\u3002\u5728\u5e94\u7528\u8fd9\u4e2a\u6a21\u5f0f\u65f6\uff0c\u5355\u4f8b\u5bf9\u8c61\u7684\u7c7b\u5fc5\u987b\u4fdd\u8bc1\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u5b58\u5728\u3002\u8bb8\u591a\u65f6\u5019\u6574\u4e2a\u7cfb\u7edf\u53ea\u9700\u8981\u62e5\u6709\u4e00\u4e2a\u7684\u5168\u5c40\u5bf9\u8c61\uff0c\u8fd9\u6837\u6709\u5229\u4e8e\u6211\u4eec\u534f\u8c03\u7cfb\u7edf\u6574\u4f53\u7684\u884c\u4e3a\u3002\u6bd4\u5982\u5728\u67d0\u4e2a\u670d\u52a1\u5668\u7a0b\u5e8f\u4e2d\uff0c\u8be5\u670d\u52a1\u5668\u7684\u914d\u7f6e\u4fe1\u606f\u5b58\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u8fd9\u4e9b\u914d\u7f6e\u6570\u636e\u7531\u4e00\u4e2a\u5355\u4f8b\u5bf9\u8c61\u7edf\u4e00\u8bfb\u53d6\uff0c\u7136\u540e\u670d\u52a1\u8fdb\u7a0b\u4e2d\u7684\u5176\u4ed6\u5bf9\u8c61\u518d\u901a\u8fc7\u8fd9\u4e2a\u5355\u4f8b\u5bf9\u8c61\u83b7\u53d6\u8fd9\u4e9b\u914d\u7f6e\u4fe1\u606f\u3002\u8fd9\u79cd\u65b9\u5f0f\u7b80\u5316\u4e86\u5728\u590d\u6742\u73af\u5883\u4e0b\u7684\u914d\u7f6e\u7ba1\u7406\u3002</p> <p>\u5355\u4f8b\u6a21\u5f0f\u8981\u5b9e\u73b0\u7684\u6548\u679c\u5c31\u662f\uff0c\u5bf9\u4e8e\u5e94\u7528\u5355\u4f8b\u6a21\u5f0f\u7684\u7c7b\uff0c\u6574\u4e2a\u7a0b\u5e8f\u4e2d\u53ea\u5b58\u5728\u4e00\u4e2a\u5b9e\u4f8b\u5316\u5bf9\u8c61</p> <p>go\u5e76\u4e0d\u662f\u4e00\u79cd\u9762\u5411\u5bf9\u8c61\u7684\u8bed\u8a00\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u7ed3\u6784\u4f53\u6765\u66ff\u4ee3</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package singleton\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\n// \u61d2\u6c49\u6a21\u5f0f, \u518d\u9700\u8981\u7684\u65f6\u5019\u8fdb\u884c\u521d\u59cb\u5316, \u76f8\u8f83\u4e8e\u997f\u6c49\u6a21\u5f0f\u6bd4\u8f83\u5757\ntype Deploy struct {\n    name string\n    image string\n}\nvar d *Deploy\n\nfunc CreateDeploy() *Deploy  {\n    if d == nil {\n        d = new(Deploy)\n    }\n    return d\n}\n\nfunc DeployTest()  {\n    dObj := CreateDeploy()\n    dObj.name = \"dname\"\n    dObj.image = \"dimage\"\n    fmt.Println(dObj.name,dObj.image)\n\n    d2 := CreateDeploy()\n    fmt.Println(\"\u61d2\u6c49\u6a21\u5f0f:\",d2.name)\n}\n\n// \u997f\u6c49\u6a21\u5f0f,\u521d\u59cb\u5316\u5305\u7684\u65f6\u5019\u5c31\u4f7f\u7528\uff0c\u4f46\u662f\u76f8\u5bf9\u6bd4\u8f83\u5b89\u5168\ntype Service struct {\n    name string\n}\n\nvar s *Service\n\nfunc init()  {\n    s = new(Service)\n    s.name = \"sname\"\n}\n\nfunc getService() *Service {\n    return s\n}\n\nfunc ServiceTest()  {\n    sObj := getService()\n    fmt.Println(\"\u997f\u6c49\u6a21\u5f0f:\",sObj.name)\n}\n\n// \u5355\u72ec\u4f8b\u6a21\u5f0f\ntype SinglePod struct {\n    name ,image string\n}\n\nvar pod1 *SinglePod\nvar once sync.Once\n\nfunc GetPod() *SinglePod {\n    once.Do(func() {\n        pod1 = new(SinglePod)\n        pod1.name = \"podname\"\n        pod1.image = \"podimage\"\n    })\n    return pod1\n}\n\nfunc PodTest()  {\n    fmt.Println(\"\u5355\u4f8b\u5b50\u6a21\u5f0f\")\n    p1 := GetPod()\n    fmt.Println(p1.name, p1.image)\n\n    p2 := GetPod()\n    fmt.Println(p2.name, p2.image)\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package singleton\n\nimport \"testing\"\n\n// \u61d2\u6c49\u6a21\u5f0f\nfunc TestCreateDeploy(t *testing.T) {\n    DeployTest()\n}\n\n// \u997f\u6c49\u6a21\u5f0f\nfunc TestServiceTest(t *testing.T) {\n    ServiceTest()\n}\n\n// \u5355\u4f8b\u6a21\u5f0f\n//\nfunc TestPodTest(t *testing.T) {\n   PodTest()\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u7cfb\u7edf\u53ea\u9700\u8981\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u5982\u7cfb\u7edf\u8981\u6c42\u63d0\u4f9b\u4e00\u4e2a\u552f\u4e00\u7684\u5e8f\u5217\u53f7\u751f\u6210\u5668\uff0c\u6216\u8005\u9700\u8981\u8003\u8651\u8d44\u6e90\u6d88\u8017\u592a\u5927\u800c\u53ea\u5141\u8bb8\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u3002</li> <li>\u5ba2\u6237\u8c03\u7528\u7c7b\u7684\u5355\u4e2a\u5b9e\u4f8b\u53ea\u5141\u8bb8\u4f7f\u7528\u4e00\u4e2a\u516c\u5171\u8bbf\u95ee\u70b9\uff0c\u9664\u4e86\u8be5\u516c\u5171\u8bbf\u95ee\u70b9\uff0c\u4e0d\u80fd\u901a\u8fc7\u5176\u4ed6\u9014\u5f84\u8bbf\u95ee\u8be5\u5b9e\u4f8b\u3002</li> <li>\u5728\u4e00\u4e2a\u7cfb\u7edf\u4e2d\u8981\u6c42\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u65f6\u624d\u5e94\u5f53\u4f7f\u7528\u5355\u4f8b\u6a21\u5f0f\u3002\u53cd\u8fc7\u6765\uff0c\u5982\u679c\u4e00\u4e2a\u7c7b\u53ef\u4ee5\u6709\u51e0\u4e2a\u5b9e\u4f8b\u5171\u5b58\uff0c\u5c31\u9700\u8981\u5bf9\u5355\u4f8b\u6a21\u5f0f\u8fdb\u884c\u6539\u8fdb\uff0c\u4f7f\u4e4b\u6210\u4e3a\u591a\u4f8b\u6a21\u5f0f</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ul> <li>\u4f60\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u3002</li> <li>\u4f60\u83b7\u5f97\u4e86\u4e00\u4e2a\u6307\u5411\u8be5\u5b9e\u4f8b\u7684\u5168\u5c40\u8bbf\u95ee\u8282\u70b9\u3002</li> <li>\u4ec5\u5728\u9996\u6b21\u8bf7\u6c42\u5355\u4f8b\u5bf9\u8c61\u65f6\u5bf9\u5176\u8fdb\u884c\u521d\u59cb\u5316\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u8fdd\u53cd\u4e86_\u5355\u4e00\u804c\u8d23\u539f\u5219_\u3002 \u8be5\u6a21\u5f0f\u540c\u65f6\u89e3\u51b3\u4e86\u4e24\u4e2a\u95ee\u9898\u3002</li> <li>\u5355\u4f8b\u6a21\u5f0f\u53ef\u80fd\u63a9\u76d6\u4e0d\u826f\u8bbe\u8ba1\uff0c \u6bd4\u5982\u7a0b\u5e8f\u5404\u7ec4\u4ef6\u4e4b\u95f4\u76f8\u4e92\u4e86\u89e3\u8fc7\u591a\u7b49\u3002</li> <li>\u8be5\u6a21\u5f0f\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u9700\u8981\u8fdb\u884c\u7279\u6b8a\u5904\u7406\uff0c \u907f\u514d\u591a\u4e2a\u7ebf\u7a0b\u591a\u6b21\u521b\u5efa\u5355\u4f8b\u5bf9\u8c61\u3002</li> <li>\u5355\u4f8b\u7684\u5ba2\u6237\u7aef\u4ee3\u7801\u5355\u5143\u6d4b\u8bd5\u53ef\u80fd\u4f1a\u6bd4\u8f83\u56f0\u96be\uff0c \u56e0\u4e3a\u8bb8\u591a\u6d4b\u8bd5\u6846\u67b6\u4ee5\u57fa\u4e8e\u7ee7\u627f\u7684\u65b9\u5f0f\u521b\u5efa\u6a21\u62df\u5bf9\u8c61\u3002 \u7531\u4e8e\u5355\u4f8b\u7c7b\u7684\u6784\u9020\u51fd\u6570\u662f\u79c1\u6709\u7684\uff0c \u800c\u4e14\u7edd\u5927\u90e8\u5206\u8bed\u8a00\u65e0\u6cd5\u91cd\u5199\u9759\u6001\u65b9\u6cd5\uff0c \u6240\u4ee5\u4f60\u9700\u8981\u60f3\u51fa\u4ed4\u7ec6\u8003\u8651\u6a21\u62df\u5355\u4f8b\u7684\u65b9\u6cd5\u3002 \u8981\u4e48\u5e72\u8106\u4e0d\u7f16\u5199\u6d4b\u8bd5\u4ee3\u7801\uff0c \u6216\u8005\u4e0d\u4f7f\u7528\u5355\u4f8b\u6a21\u5f0f\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://refactoringguru.cn/design-patterns/singleton</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/","title":"1.\u88c5\u9970\u5668\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u88c5\u9970\u5668\u6a21\u5f0f\u7b80\u4ecb","text":"<p>**\u88c5\u9970\u6a21\u5f0f**\u662f\u4e00\u79cd\u7ed3\u6784\u578b\u8bbe\u8ba1\u6a21\u5f0f\uff0c \u5141\u8bb8\u4f60\u901a\u8fc7\u5c06\u5bf9\u8c61\u653e\u5165\u5305\u542b\u884c\u4e3a\u7684\u7279\u6b8a\u5c01\u88c5\u5bf9\u8c61\u4e2d\u6765\u4e3a\u539f\u5bf9\u8c61\u7ed1\u5b9a\u65b0\u7684\u884c\u4e3a\u3002</p> <p>*\u5c01\u88c5\u5668*\u662f\u88c5\u9970\u6a21\u5f0f\u7684\u522b\u79f0\uff0c \u8fd9\u4e2a\u79f0\u8c13\u660e\u786e\u5730\u8868\u8fbe\u4e86\u8be5\u6a21\u5f0f\u7684\u4e3b\u8981\u601d\u60f3\u3002  \u201c\u5c01\u88c5\u5668\u201d \u662f\u4e00\u4e2a\u80fd\u4e0e\u5176\u4ed6 \u201c\u76ee\u6807\u201d \u5bf9\u8c61\u8fde\u63a5\u7684\u5bf9\u8c61\u3002 \u5c01\u88c5\u5668\u5305\u542b\u4e0e\u76ee\u6807\u5bf9\u8c61\u76f8\u540c\u7684\u4e00\u7cfb\u5217\u65b9\u6cd5\uff0c \u5b83\u4f1a\u5c06\u6240\u6709\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u59d4\u6d3e\u7ed9\u76ee\u6807\u5bf9\u8c61\u3002 \u4f46\u662f\uff0c \u5c01\u88c5\u5668\u53ef\u4ee5\u5728\u5c06\u8bf7\u6c42\u59d4\u6d3e\u7ed9\u76ee\u6807\u524d\u540e\u5bf9\u5176\u8fdb\u884c\u5904\u7406\uff0c \u6240\u4ee5\u53ef\u80fd\u4f1a\u6539\u53d8\u6700\u7ec8\u7ed3\u679c\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package decorator\n\nimport \"fmt\"\n\n// \u88c5\u9970\u5668\u6a21\u5f0f\n\n// \u5b9a\u4e49Going \u7684\u63a5\u53e3,\u5305\u542b run \u65b9\u6cd5\ntype Going interface {\n    Run()\n}\n\n// \u5b9a\u4e49 Car \u5bf9\u8c61, \u5b9e\u73b0run\u65b9\u6cd5\ntype Car struct {\n    name string\n}\n\nfunc (d *Car) Run() {\n    fmt.Println(\"decorator do function\")\n}\n\n// \u4e3a\u4e86\u7ed9Car \u65b9\u6cd5\u589e\u52a0\u989d\u5916\u529f\u80fd\uff0c\u4f8b\u5982fly\n// \u8be5\u88c5\u9970\u63a5\u53e3\u5305\u542b\u88ab\u88c5\u9970\u7684\u63a5\u53e3\uff0c\u5e76\u4e14\u65b0\u589e\u989d\u5916\u65b9\u6cd5\ntype AdvantageCar interface {\n    Going\n    Fly\n}\n\n// \u5b9a\u4e49\u65b0\u589e\u65b9\u6cd5\u63a5\u53e3\ntype Fly interface {    \n    Flying()\n}\n\n// \u5b9a\u4e49\u88c5\u9970\u540e\u7684\u5bf9\u8c61, \u5176\u5c5e\u6027\u5305\u542b\u88ab\u88c5\u9970\u7684\u63a5\u53e3\ntype ACar struct {\n    Going\n}\n\n// \u65b0\u5bf9\u8c61\u5b9e\u73b0\u989d\u5916\u65b0\u589e\u529f\u80fd\u63a5\u53e3\u65b9\u6cd5\nfunc (a *ACar) Flying() {\n    fmt.Println(\"flaying \")\n}\n\nfunc (a *ACar) Run() {\n    // \u5148\u5b9e\u73b0\u4e4b\u524d\u88ab\u88c5\u9970\u524d\u7684\u65b9\u6cd5\n    a.Going.Run()\n    // \u5728\u5b9e\u73b0\u989d\u5916\u65b0\u589e\u529f\u80fd\u65b9\u6cd5\n    a.Flying()\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package decorator\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestCar_Run(t *testing.T) {\n    c := Car{name: \"BYD\"}\n    c.Run()\n}\n\nfunc TestACar_Run(t *testing.T) {\n    fmt.Println(\"acar test......\")\n    ac := ACar{}\n\n    g := &amp;Car{name: \"BMW\"}\n    ac.Going = g\n\n    ac.Run()\n\n}\n\n\n/*\ndecorator do function\nacar test......\ndecorator do function\nflaying \nPASS\nok      github.com/kaliarch/mycode/design-patterns/structural/decorator 0.015s\n*/\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ul> <li> <p>\u5982\u679c\u4f60\u5e0c\u671b\u5728\u65e0\u9700\u4fee\u6539\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u5373\u53ef\u4f7f\u7528\u5bf9\u8c61\uff0c\u4e14\u5e0c\u671b\u5728\u8fd0\u884c\u65f6\u4e3a\u5bf9\u8c61\u65b0\u589e\u989d\u5916\u7684\u884c\u4e3a\uff0c\u53ef\u4ee5\u4f7f\u7528\u88c5\u9970\u6a21\u5f0f\uff0c \u88c5\u9970\u80fd\u5c06\u4e1a\u52a1\u903b\u8f91\u7ec4\u7ec7\u4e3a\u5c42\u6b21\u7ed3\u6784\uff0c \u4f60\u53ef\u4e3a\u5404\u5c42\u521b\u5efa\u4e00\u4e2a\u88c5\u9970\uff0c \u5728\u8fd0\u884c\u65f6\u5c06\u5404\u79cd\u4e0d\u540c\u903b\u8f91\u7ec4\u5408\u6210\u5bf9\u8c61\u3002 \u7531\u4e8e\u8fd9\u4e9b\u5bf9\u8c61\u90fd\u9075\u5faa\u901a\u7528\u63a5\u53e3\uff0c \u5ba2\u6237\u7aef\u4ee3\u7801\u80fd\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u4f7f\u7528\u8fd9\u4e9b\u5bf9\u8c61\u3002</p> </li> <li> <p>\u5982\u679c\u7528\u7ee7\u627f\u6765\u6269\u5c55\u5bf9\u8c61\u884c\u4e3a\u7684\u65b9\u6848\u96be\u4ee5\u5b9e\u73b0\u6216\u8005\u6839\u672c\u4e0d\u53ef\u884c\uff0c \u4f60\u53ef\u4ee5\u4f7f\u7528\u8be5\u6a21\u5f0f\uff0c \u8bb8\u591a\u7f16\u7a0b\u8bed\u8a00\u4f7f\u7528 <code>final</code>\u6700\u7ec8\u5173\u952e\u5b57\u6765\u9650\u5236\u5bf9\u67d0\u4e2a\u7c7b\u7684\u8fdb\u4e00\u6b65\u6269\u5c55\u3002 \u590d\u7528\u6700\u7ec8\u7c7b\u5df2\u6709\u884c\u4e3a\u7684\u552f\u4e00\u65b9\u6cd5\u662f\u4f7f\u7528\u88c5\u9970\u6a21\u5f0f\uff1a \u7528\u5c01\u88c5\u5668\u5bf9\u5176\u8fdb\u884c\u5c01\u88c5\u3002</p> </li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9:","text":"<ul> <li>\u4f60\u65e0\u9700\u521b\u5efa\u65b0\u5b50\u7c7b\u5373\u53ef\u6269\u5c55\u5bf9\u8c61\u7684\u884c\u4e3a\u3002</li> <li>\u4f60\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u6dfb\u52a0\u6216\u5220\u9664\u5bf9\u8c61\u7684\u529f\u80fd\u3002</li> <li>\u4f60\u53ef\u4ee5\u7528\u591a\u4e2a\u88c5\u9970\u5c01\u88c5\u5bf9\u8c61\u6765\u7ec4\u5408\u51e0\u79cd\u884c\u4e3a\u3002</li> <li>\u5355\u4e00\u804c\u8d23\u539f\u5219\u3002 \u4f60\u53ef\u4ee5\u5c06\u5b9e\u73b0\u4e86\u8bb8\u591a\u4e0d\u540c\u884c\u4e3a\u7684\u4e00\u4e2a\u5927\u7c7b\u62c6\u5206\u4e3a\u591a\u4e2a\u8f83\u5c0f\u7684\u7c7b\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9:","text":"<ul> <li>\u5728\u5c01\u88c5\u5668\u6808\u4e2d\u5220\u9664\u7279\u5b9a\u5c01\u88c5\u5668\u6bd4\u8f83\u56f0\u96be\u3002</li> <li>\u5b9e\u73b0\u884c\u4e3a\u4e0d\u53d7\u88c5\u9970\u6808\u987a\u5e8f\u5f71\u54cd\u7684\u88c5\u9970\u6bd4\u8f83\u56f0\u96be\u3002</li> <li>\u5404\u5c42\u7684\u521d\u59cb\u5316\u914d\u7f6e\u4ee3\u7801\u770b\u4e0a\u53bb\u53ef\u80fd\u4f1a\u5f88\u7cdf\u7cd5\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/silsuer/golang-design-patterns</li> <li>https://refactoringguru.cn/design-patterns/decorator</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/","title":"2.\u4ee3\u7406\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u4ee3\u7406\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u4ee3\u7406\u6a21\u5f0f\uff08\u82f1\u8bed\uff1aProxy Pattern\uff09\u662f\u7a0b\u5e8f\u8bbe\u8ba1\u4e2d\u7684\u4e00\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u3002</p> <p>\u6240\u8c13\u7684\u4ee3\u7406\u8005\u662f\u6307\u4e00\u4e2a\u7c7b\u53ef\u4ee5\u4f5c\u4e3a\u5176\u5b83\u4e1c\u897f\u7684\u63a5\u53e3\u3002\u4ee3\u7406\u8005\u53ef\u4ee5\u4f5c\u4efb\u4f55\u4e1c\u897f\u7684\u63a5\u53e3\uff1a\u7f51\u7edc\u8fde\u63a5\u3001\u5185\u5b58\u4e2d\u7684\u5927\u5bf9\u8c61\u3001\u6587\u4ef6\u6216\u5176\u5b83\u6602\u8d35\u6216\u65e0\u6cd5\u590d\u5236\u7684\u8d44\u6e90\u3002</p> <p>\u8457\u540d\u7684\u4ee3\u7406\u6a21\u5f0f\u4f8b\u5b50\u4e3a\u5f15\u7528\u8ba1\u6570\uff08\u82f1\u8bed\uff1areference counting\uff09\u6307\u9488\u5bf9\u8c61\u3002</p> <p>\u5f53\u4e00\u4e2a\u590d\u6742\u5bf9\u8c61\u7684\u591a\u4efd\u526f\u672c\u987b\u5b58\u5728\u65f6\uff0c\u4ee3\u7406\u6a21\u5f0f\u53ef\u4ee5\u7ed3\u5408\u4eab\u5143\u6a21\u5f0f\u4ee5\u51cf\u5c11\u5185\u5b58\u7528\u91cf\u3002\u5178\u578b\u4f5c\u6cd5\u662f\u521b\u5efa\u4e00\u4e2a\u590d\u6742\u5bf9\u8c61\u53ca\u591a\u4e2a\u4ee3\u7406\u8005\uff0c\u6bcf\u4e2a\u4ee3\u7406\u8005\u4f1a\u5f15\u7528\u5230\u539f\u672c\u7684\u590d\u6742\u5bf9\u8c61\u3002\u800c\u4f5c\u7528\u5728\u4ee3\u7406\u8005\u7684\u8fd0\u7b97\u4f1a\u8f6c\u9001\u5230\u539f\u672c\u5bf9\u8c61\u3002\u4e00\u65e6\u6240\u6709\u7684\u4ee3\u7406\u8005\u90fd\u4e0d\u5b58\u5728\u65f6\uff0c\u590d\u6742\u5bf9\u8c61\u4f1a\u88ab\u79fb\u9664\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u4ee3\u7801","text":"<pre><code>package proxy\n\nconst (\n    maxRequest int =3\n)\n\n// \u5b9a\u4e49\u516c\u5171server\u63a5\u53e3\ntype Server interface {\n    handleRequest(url, method string) (int, string)\n}\n\n// \u5b9a\u4e49\u5177\u4f53\u5b9e\u4f53\u7c7b\ntype Application struct {\n}\n\nfunc (a Application) handleRequest(url , method string) (int, string) {\n    if url == \"\" &amp;&amp; method == \"\" {\n        return 401, \"Url and Method is empty\"\n    }\n    if url == \"/\" &amp;&amp; method == \"POST\" {\n        return 200, \"ok\"\n    }\n    return 404, \"not found\"\n}\n\n// \u5b9a\u4e49\u4ee3\u7406 nginx \u7c7b\u578b, \u5185\u90e8\u5305\u542b\u539f\u59cbnginx\ntype Nginx struct {\n    a *Application\n    maxAllowedRequest int\n    rateLimter map[string]int\n}\n\nfunc NewNginx(limit int) *Nginx  {\n    return &amp;Nginx{\n        a: &amp;Application{},\n        maxAllowedRequest: limit,\n        rateLimter: make(map[string]int),\n    }\n}\n\n// nginx \u65b0\u589e\u4e1a\u52a1\u903b\u8f91\nfunc (n *Nginx) checkRateLimit(url string) bool  {\n    if n.rateLimter[url] == 0 {\n        n.rateLimter[url] = 1\n    }\n\n    if n.rateLimter[url] &gt; n.maxAllowedRequest {\n        return false\n    }\n    n.rateLimter[url] = n.rateLimter[url] +1\n    return true\n}\n\n// nginx \u5b9e\u73b0\u539f\u59cb\u4e1a\u52a1\nfunc (n *Nginx) handleRequest(url, method string) (int,string)  {\n    if !n.checkRateLimit(url) {\n        return 403, \"Not Allowed\"\n    }\n    return n.a.handleRequest(url, method)\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package proxy\n\nimport (\n    \"reflect\"\n    \"testing\"\n)\n\ntype http struct {\n    limit int\n    url string\n    method string\n}\n\ntype Rest struct {\n    code int\n    msg string\n}\n\nfunc TestNewNginx(t *testing.T) {\n    //got1 := http{\n    //    limit: 2,\n    //    url: \"/\",\n    //    method: \"GET\",\n    //}\n\n    got2 := http{\n        limit: 2,\n        url: \"/\",\n        method: \"POST\",\n    }\n    want1 := Rest{\n        code: 200,\n        msg: \"ok\",\n    }\n\n    //n := NewNginx(got1.limit)\n    //code, msg := n.handleRequest(got1.url,got1.method)\n    //\n    //if !reflect.DeepEqual(want1.code, code) {\n    //    t.Errorf(\"want %d, got: %d\", want1.code, code)\n    //}\n    //if !reflect.DeepEqual(want1.msg, msg) {\n    //\n    //    t.Errorf(\"want %s, got: %s\", want1.msg, msg)\n    //}\n\n\n    n2 := NewNginx(got2.limit)\n    code2, msg2 := n2.handleRequest(got2.url,got2.method)\n\n    if !reflect.DeepEqual(want1.code, code2) {\n        t.Errorf(\"want %d, got: %d\", want1.code, code2)\n    }\n    t.Logf(\"test success %d,%d\",want1.code, code2)\n\n\n    if !reflect.DeepEqual(want1.msg, msg2) {\n        t.Errorf(\"want %s, got: %s\", want1.msg, msg2)\n    }\n    t.Logf(\"test success: %s,%s\",want1.msg, msg2)\n\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u8fdc\u7a0b(Remote)\u4ee3\u7406\uff1a\u4e3a\u4e00\u4e2a\u4f4d\u4e8e\u4e0d\u540c\u7684\u5730\u5740\u7a7a\u95f4\u7684\u5bf9\u8c61\u63d0\u4f9b\u4e00\u4e2a\u672c\u5730 \u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u4e0d\u540c\u7684\u5730\u5740\u7a7a\u95f4\u53ef\u4ee5\u662f\u5728\u540c\u4e00\u53f0\u4e3b\u673a\u4e2d\uff0c\u4e5f\u53ef\u662f\u5728 \u53e6\u4e00\u53f0\u4e3b\u673a\u4e2d\uff0c\u8fdc\u7a0b\u4ee3\u7406\u53c8\u53eb\u505a\u5927\u4f7f(Ambassador)\u3002</li> <li>\u865a\u62df(Virtual)\u4ee3\u7406\uff1a\u5982\u679c\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u8d44\u6e90\u6d88\u8017\u8f83\u5927\u7684\u5bf9\u8c61\uff0c\u5148\u521b\u5efa\u4e00\u4e2a\u6d88\u8017\u76f8\u5bf9\u8f83\u5c0f\u7684\u5bf9\u8c61\u6765\u8868\u793a\uff0c\u771f\u5b9e\u5bf9\u8c61\u53ea\u5728\u9700\u8981\u65f6\u624d\u4f1a\u88ab\u771f\u6b63\u521b\u5efa\u3002</li> <li>Copy-on-Write\u4ee3\u7406\uff1a\u5b83\u662f\u865a\u62df\u4ee3\u7406\u7684\u4e00\u79cd\uff0c\u628a\u590d\u5236\uff08\u514b\u9686\uff09\u64cd\u4f5c\u5ef6\u8fdf \u5230\u53ea\u6709\u5728\u5ba2\u6237\u7aef\u771f\u6b63\u9700\u8981\u65f6\u624d\u6267\u884c\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u5bf9\u8c61\u7684\u6df1\u514b\u9686\u662f\u4e00\u4e2a \u5f00\u9500\u8f83\u5927\u7684\u64cd\u4f5c\uff0cCopy-on-Write\u4ee3\u7406\u53ef\u4ee5\u8ba9\u8fd9\u4e2a\u64cd\u4f5c\u5ef6\u8fdf\uff0c\u53ea\u6709\u5bf9\u8c61\u88ab\u7528\u5230\u7684\u65f6\u5019\u624d\u88ab\u514b\u9686\u3002</li> <li>\u4fdd\u62a4(Protect or Access)\u4ee3\u7406\uff1a\u63a7\u5236\u5bf9\u4e00\u4e2a\u5bf9\u8c61\u7684\u8bbf\u95ee\uff0c\u53ef\u4ee5\u7ed9\u4e0d\u540c\u7684\u7528\u6237\u63d0\u4f9b\u4e0d\u540c\u7ea7\u522b\u7684\u4f7f\u7528\u6743\u9650\u3002</li> <li>\u7f13\u51b2(Cache)\u4ee3\u7406\uff1a\u4e3a\u67d0\u4e00\u4e2a\u76ee\u6807\u64cd\u4f5c\u7684\u7ed3\u679c\u63d0\u4f9b\u4e34\u65f6\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u4ee5\u4fbf\u591a\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u5171\u4eab\u8fd9\u4e9b\u7ed3\u679c\u3002</li> <li>\u9632\u706b\u5899(Firewall)\u4ee3\u7406\uff1a\u4fdd\u62a4\u76ee\u6807\u4e0d\u8ba9\u6076\u610f\u7528\u6237\u63a5\u8fd1\u3002</li> <li>\u540c\u6b65\u5316(Synchronization)\u4ee3\u7406\uff1a\u4f7f\u51e0\u4e2a\u7528\u6237\u80fd\u591f\u540c\u65f6\u4f7f\u7528\u4e00\u4e2a\u5bf9\u8c61\u800c\u6ca1\u6709\u51b2\u7a81\u3002</li> <li>\u667a\u80fd\u5f15\u7528(Smart Reference)\u4ee3\u7406\uff1a\u5f53\u4e00\u4e2a\u5bf9\u8c61\u88ab\u5f15\u7528\u65f6\uff0c\u63d0\u4f9b\u4e00\u4e9b\u989d\u5916\u7684\u64cd\u4f5c\uff0c\u5982\u5c06\u6b64\u5bf9\u8c61\u88ab\u8c03\u7528\u7684\u6b21\u6570\u8bb0\u5f55\u4e0b\u6765\u7b49\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ul> <li>\u4ee3\u7406\u6a21\u5f0f\u80fd\u591f\u534f\u8c03\u8c03\u7528\u8005\u548c\u88ab\u8c03\u7528\u8005\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u964d\u4f4e\u4e86\u7cfb \u7edf\u7684\u8026\u5408\u5ea6\u3002</li> <li>\u8fdc\u7a0b\u4ee3\u7406\u4f7f\u5f97\u5ba2\u6237\u7aef\u53ef\u4ee5\u8bbf\u95ee\u5728\u8fdc\u7a0b\u673a\u5668\u4e0a\u7684\u5bf9\u8c61\uff0c\u8fdc\u7a0b\u673a\u5668 \u53ef\u80fd\u5177\u6709\u66f4\u597d\u7684\u8ba1\u7b97\u6027\u80fd\u4e0e\u5904\u7406\u901f\u5ea6\uff0c\u53ef\u4ee5\u5feb\u901f\u54cd\u5e94\u5e76\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\u3002</li> <li>\u865a\u62df\u4ee3\u7406\u901a\u8fc7\u4f7f\u7528\u4e00\u4e2a\u5c0f\u5bf9\u8c61\u6765\u4ee3\u8868\u4e00\u4e2a\u5927\u5bf9\u8c61\uff0c\u53ef\u4ee5\u51cf\u5c11\u7cfb \u7edf\u8d44\u6e90\u7684\u6d88\u8017\uff0c\u5bf9\u7cfb\u7edf\u8fdb\u884c\u4f18\u5316\u5e76\u63d0\u9ad8\u8fd0\u884c\u901f\u5ea6\u3002</li> <li>\u4fdd\u62a4\u4ee3\u7406\u53ef\u4ee5\u63a7\u5236\u5bf9\u771f\u5b9e\u5bf9\u8c61\u7684\u4f7f\u7528\u6743\u9650\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u7531\u4e8e\u5728\u5ba2\u6237\u7aef\u548c\u771f\u5b9e\u4e3b\u9898\u4e4b\u95f4\u589e\u52a0\u4e86\u4ee3\u7406\u5bf9\u8c61\uff0c\u56e0\u6b64 \u6709\u4e9b\u7c7b\u578b\u7684\u4ee3\u7406\u6a21\u5f0f\u53ef\u80fd\u4f1a\u9020\u6210\u8bf7\u6c42\u7684\u5904\u7406\u901f\u5ea6\u53d8\u6162\u3002</li> <li>\u5b9e\u73b0\u4ee3\u7406\u6a21\u5f0f\u9700\u8981\u989d\u5916\u7684\u5de5\u4f5c\uff0c\u6709\u4e9b\u4ee3\u7406\u6a21\u5f0f\u7684\u5b9e\u73b0 \u975e\u5e38\u590d\u6742\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/silsuer/golang-design-patterns</li> <li>https://www.bookstack.cn/read/Design-Pattern/lesson9-README.md</li> <li>https://refactoringguru.cn/design-patterns/proxy</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/","title":"3.\u6865\u63a5\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u6865\u63a5\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u6865\u63a5\uff08Bridge\uff09\u6a21\u5f0f\u7684\u5b9a\u4e49\uff1a\u5c06\u62bd\u8c61\u4e0e\u5b9e\u73b0\u5206\u79bb\uff0c\u4f7f\u5b83\u4eec\u53ef\u4ee5\u72ec\u7acb\u53d8\u5316\u3002\u5b83\u662f\u7528\u7ec4\u5408\u5173\u7cfb\u4ee3\u66ff\u7ee7\u627f\u5173\u7cfb\u6765\u5b9e\u73b0\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u62bd\u8c61\u548c\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u53ef\u53d8\u7ef4\u5ea6\u7684\u8026\u5408\u5ea6\u3002</p> <p>\u5b9a\u4e49\u6765\u770b\uff0c\u6865\u63a5\u6a21\u5f0f\u9075\u5faa\u4e86\u91cc\u6c0f\u66ff\u6362\u539f\u5219\u548c\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\uff0c\u6700\u7ec8\u5b9e\u73b0\u4e86\u5f00\u95ed\u539f\u5219\uff0c\u5bf9\u4fee\u6539\u5173\u95ed\uff0c\u5bf9\u6269\u5c55\u5f00\u653e\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package bridge\n\nimport \"fmt\"\n\n// \u6865\u63a5\u6a21\u5f0f\u5206\u79bb\u62bd\u8c61\u90e8\u5206\u548c\u5b9e\u73b0\u90e8\u5206\u3002\u4f7f\u5f97\u4e24\u90e8\u5206\u72ec\u7acb\u6269\u5c55\u3002\n\n// \u5b9a\u4e49\u4e24\u79cd\u5b9e\u73b0\u7c7b\u578b\u62bd\u8c61\u5b9a\u4e49\uff0c\u4f8b\u5982\u5b9a\u4e49\u7535\u8111\u63a5\u53e3\u548c\u5b9a\u4e49\u6253\u5370\u673a\u63a5\u53e3\n\n// \u4e00\u4e2a\u7c7b\u578b\u5185\u90e8\u5305\u542b\u65b9\u6cd5\u5b9a\u4e49\uff0c\n\n// \u4e00\u4e2a\u7c7b\u578b\u5185\u90e8\u5b9e\u73b0\u81ea\u8eab\u4e1a\u52a1\u903b\u8f91\n\n// \u5ba2\u6237\u7aef\u5b9e\u4f8b\u8bdd\u5bf9\u5e94\u5bf9\u8c61\uff0c\u8fdb\u884c\u5bf9\u8c61\u4efb\u610f\u7ec4\u5408\n\n// \u7535\u8111\u63a5\u53e3\ntype computer interface {\n    print()\n    setPrinter(printer)\n}\n\n// \u6253\u5370\u673a\u63a5\u53e3\ntype printer interface {\n    printFile()\n}\n\ntype epson struct {\n}\n\nfunc (e *epson) printFile()  {\n    fmt.Println(\"printing by epson printer\")\n}\n\ntype hp struct {\n}\n\nfunc (p *hp) printFile()  {\n    fmt.Println(\"printing by hp printer\")\n}\n\n\n\ntype Win struct {\n    printer printer\n}\n\nfunc (w *Win) print()  {\n    fmt.Println(\"print win\")\n    w.printer.printFile()\n}\n\nfunc (w *Win) setPrinter(p printer)  {\n    w.printer = p\n}\n\ntype Mac struct {\n    printer printer\n}\n\nfunc (m *Mac) print()  {\n    fmt.Println(\"print mac\")\n    m.printer.printFile()\n}\n\nfunc (m *Mac) setPrinter(p printer)  {\n    m.printer = p\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package bridge\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestBridge(t *testing.T)  {\n    hpPrinter := &amp;hp{}\n\n    epsonPrinter := &amp;epson{}\n\n    m := Mac{}\n\n    m.setPrinter(hpPrinter)\n    m.print()\n    m.setPrinter(epsonPrinter)\n    m.print()\n\n    fmt.Println(\"------\")\n\n    w := Win{}\n    w.setPrinter(epsonPrinter)\n    w.print()\n    w.setPrinter(hpPrinter)\n    w.print()\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#23","title":"2.3 \u8fd0\u884c\u8f93\u51fa","text":"<pre><code>=== RUN   TestBridge\nprint mac\nprinting by hp printer\nprint mac\nprinting by epson printer\n------\nprint win\nprinting by epson printer\nprint win\nprinting by hp printer\n--- PASS: TestBridge (0.00s)\nPASS\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ul> <li> <p>\u5982\u679c\u4f60\u60f3\u8981\u62c6\u5206\u6216\u91cd\u7ec4\u4e00\u4e2a\u5177\u6709\u591a\u91cd\u529f\u80fd\u7684\u5e9e\u6742\u7c7b\uff08\u4f8b\u5982\u80fd\u4e0e\u591a\u4e2a\u6570\u636e\u5e93\u670d\u52a1\u5668\u8fdb\u884c\u4ea4\u4e92\u7684\u7c7b\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528\u6865\u63a5\u6a21\u5f0f\u3002</p> </li> <li> <p>\u5982\u679c\u4f60\u5e0c\u671b\u5728\u51e0\u4e2a\u72ec\u7acb\u7ef4\u5ea6\u4e0a\u6269\u5c55\u4e00\u4e2a\u7c7b\uff0c \u53ef\u4f7f\u7528\u8be5\u6a21\u5f0f\u3002</p> </li> <li>\u5982\u679c\u4f60\u9700\u8981\u5728\u8fd0\u884c\u65f6\u5207\u6362\u4e0d\u540c\u5b9e\u73b0\u65b9\u6cd5\uff0c \u53ef\u4f7f\u7528\u6865\u63a5\u6a21\u5f0f\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ul> <li>\u62bd\u8c61\u4e0e\u5b9e\u73b0\u5206\u79bb\uff0c\u6269\u5c55\u80fd\u529b\u5f3a</li> <li>\u7b26\u5408\u5f00\u95ed\u539f\u5219</li> <li>\u7b26\u5408\u5408\u6210\u590d\u7528\u539f\u5219</li> <li>\u5176\u5b9e\u73b0\u7ec6\u8282\u5bf9\u5ba2\u6237\u900f\u660e</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u7531\u4e8e\u805a\u5408\u5173\u7cfb\u5efa\u7acb\u5728\u62bd\u8c61\u5c42\uff0c\u8981\u6c42\u5f00\u53d1\u8005\u9488\u5bf9\u62bd\u8c61\u5316\u8fdb\u884c\u8bbe\u8ba1\u4e0e\u7f16\u7a0b\uff0c\u80fd\u6b63\u786e\u5730\u8bc6\u522b\u51fa\u7cfb\u7edf\u4e2d\u4e24\u4e2a\u72ec\u7acb\u53d8\u5316\u7684\u7ef4\u5ea6\uff0c\u8fd9\u589e\u52a0\u4e86\u7cfb\u7edf\u7684\u7406\u89e3\u4e0e\u8bbe\u8ba1\u96be\u5ea6\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.bookstack.cn/read/Design-Pattern/lesson22-README.md</li> <li>https://refactoringguru.cn/design-patterns/bridge</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/","title":"4.\u9002\u914d\u5668\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u9002\u914d\u5668\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u9002\u914d\u5668\u6a21\u5f0f\u7528\u4e8e\u8f6c\u6362\u4e00\u79cd\u63a5\u53e3\u9002\u914d\u53e6\u4e00\u79cd\u63a5\u53e3\u3002</p> <p>\u5b9e\u9645\u4f7f\u7528\u4e2dAdaptee\u4e00\u822c\u4e3a\u63a5\u53e3\uff0c\u5e76\u4e14\u4f7f\u7528\u5de5\u5382\u51fd\u6570\u751f\u6210\u5b9e\u4f8b\u3002</p> <p>\u5728Adapter\u4e2d\u533f\u540d\u7ec4\u5408Adaptee\u63a5\u53e3\uff0c\u6240\u4ee5Adapter\u7c7b\u4e5f\u62e5\u6709SpecificRequest\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u53c8\u56e0\u4e3aGo\u8bed\u8a00\u4e2d\u975e\u5165\u4fb5\u5f0f\u63a5\u53e3\u7279\u5f81\uff0c\u5176\u5b9eAdapter\u4e5f\u9002\u914dAdaptee\u63a5\u53e3\u3002</p> <p>\u5728\u73b0\u5b9e\u751f\u6d3b\u4e2d\uff0c\u7ecf\u5e38\u51fa\u73b0\u4e24\u4e2a\u5bf9\u8c61\u56e0\u63a5\u53e3\u4e0d\u517c\u5bb9\u800c\u4e0d\u80fd\u5728\u4e00\u8d77\u5de5\u4f5c\u7684\u5b9e\u4f8b\uff0c\u8fd9\u65f6\u9700\u8981\u7b2c\u4e09\u8005\u8fdb\u884c\u9002\u914d\u3002\u4f8b\u5982\uff0c\u8bb2\u4e2d\u6587\u7684\u4eba\u540c\u8bb2\u82f1\u6587\u7684\u4eba\u5bf9\u8bdd\u65f6\u9700\u8981\u4e00\u4e2a\u7ffb\u8bd1\uff0c\u7528\u76f4\u6d41\u7535\u7684\u7b14\u8bb0\u672c\u7535\u8111\u63a5\u4ea4\u6d41\u7535\u6e90\u65f6\u9700\u8981\u4e00\u4e2a\u7535\u6e90\u9002\u914d\u5668\uff0c\u7528\u8ba1\u7b97\u673a\u8bbf\u95ee\u7167\u76f8\u673a\u7684 SD \u5185\u5b58\u5361\u65f6\u9700\u8981\u4e00\u4e2a\u8bfb\u5361\u5668\u7b49\u3002</p> <p>\u5728\u8f6f\u4ef6\u8bbe\u8ba1\u4e2d\u4e5f\u53ef\u80fd\u51fa\u73b0\uff1a\u9700\u8981\u5f00\u53d1\u7684\u5177\u6709\u67d0\u79cd\u4e1a\u52a1\u529f\u80fd\u7684\u7ec4\u4ef6\u5728\u73b0\u6709\u7684\u7ec4\u4ef6\u5e93\u4e2d\u5df2\u7ecf\u5b58\u5728\uff0c\u4f46\u5b83\u4eec\u4e0e\u5f53\u524d\u7cfb\u7edf\u7684\u63a5\u53e3\u89c4\u8303\u4e0d\u517c\u5bb9\uff0c\u5982\u679c\u91cd\u65b0\u5f00\u53d1\u8fd9\u4e9b\u7ec4\u4ef6\u6210\u672c\u53c8\u5f88\u9ad8\uff0c\u8fd9\u65f6\u7528\u9002\u914d\u5668\u6a21\u5f0f\u80fd\u5f88\u597d\u5730\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002</p> <p></p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package adapter\n\nimport \"fmt\"\n\nvar ExpectContent string = \"AdapteeImple\"\n\n// \u88ab\u9002\u914d\u63a5\u53e3\ntype Adaptee interface {\n    SpecificRequest() string\n}\n\n// \u88ab\u9002\u914d\u5bf9\u8c61\ntype AdapteeImpl struct {\n}\n\n// \u88ab\u9002\u914d\u5bf9\u8c61\u5de5\u5382\u51fd\u6570\nfunc NewAdaptee() *AdapteeImpl {\n    return &amp;AdapteeImpl{}\n}\n\nfunc (a *AdapteeImpl) SpecificRequest() string {\n    return fmt.Sprintf(\"%s\", ExpectContent)\n}\n\n// \u76ee\u6807\u63a5\u53e3\ntype Target interface {\n    Request() string\n}\n\n// \u9002\u914d\u5668\u5bf9\u8c61\ntype Adapter struct {\n    Adaptee\n}\n\nfunc NewAdapter(adaptee Adaptee) *Adapter {\n    return &amp;Adapter{\n        Adaptee: adaptee,\n    }\n}\nfunc (ad *Adapter) Request() string {\n    return ad.SpecificRequest()\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package adapter\n\nimport (\n    \"testing\"\n)\n\nfunc TestNewAdapter(t *testing.T) {\n    adaptee := NewAdaptee()\n\n    adapter := NewAdapter(adaptee)\n\n    res := adapter.SpecificRequest()\n\n    if res != ExpectContent {\n        t.Fatalf(\"expect: %s, actual: %s\", ExpectContent, res)\n    }\n\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#23","title":"2.3 \u8fd0\u884c\u8f93\u51fa","text":"<pre><code>PASS\nok      github.com/kaliarch/mycode/design-patterns/structural/adapter   0.637s\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u4ee5\u524d\u5f00\u53d1\u7684\u7cfb\u7edf\u5b58\u5728\u6ee1\u8db3\u65b0\u7cfb\u7edf\u529f\u80fd\u9700\u6c42\u7684\u7c7b\uff0c\u4f46\u5176\u63a5\u53e3\u540c\u65b0\u7cfb\u7edf\u7684\u63a5\u53e3\u4e0d\u4e00\u81f4\u3002</li> <li>\u4f7f\u7528\u7b2c\u4e09\u65b9\u63d0\u4f9b\u7684\u7ec4\u4ef6\uff0c\u4f46\u7ec4\u4ef6\u63a5\u53e3\u5b9a\u4e49\u548c\u81ea\u5df1\u8981\u6c42\u7684\u63a5\u53e3\u5b9a\u4e49\u4e0d\u540c\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u4f18\u7f3a\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ul> <li>\u5ba2\u6237\u7aef\u901a\u8fc7\u9002\u914d\u5668\u53ef\u4ee5\u900f\u660e\u5730\u8c03\u7528\u76ee\u6807\u63a5\u53e3\u3002</li> <li>\u590d\u7528\u4e86\u73b0\u5b58\u7684\u7c7b\uff0c\u7a0b\u5e8f\u5458\u4e0d\u9700\u8981\u4fee\u6539\u539f\u6709\u4ee3\u7801\u800c\u91cd\u7528\u73b0\u6709\u7684\u9002\u914d\u8005\u7c7b\u3002</li> <li>\u5c06\u76ee\u6807\u7c7b\u548c\u9002\u914d\u8005\u7c7b\u89e3\u8026\uff0c\u89e3\u51b3\u4e86\u76ee\u6807\u7c7b\u548c\u9002\u914d\u8005\u7c7b\u63a5\u53e3\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002</li> <li>\u5728\u5f88\u591a\u4e1a\u52a1\u573a\u666f\u4e2d\u7b26\u5408\u5f00\u95ed\u539f\u5219\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u9002\u914d\u5668\u7f16\u5199\u8fc7\u7a0b\u9700\u8981\u7ed3\u5408\u4e1a\u52a1\u573a\u666f\u5168\u9762\u8003\u8651\uff0c\u53ef\u80fd\u4f1a\u589e\u52a0\u7cfb\u7edf\u7684\u590d\u6742\u6027\u3002</li> <li>\u589e\u52a0\u4ee3\u7801\u9605\u8bfb\u96be\u5ea6\uff0c\u964d\u4f4e\u4ee3\u7801\u53ef\u8bfb\u6027\uff0c\u8fc7\u591a\u4f7f\u7528\u9002\u914d\u5668\u4f1a\u4f7f\u7cfb\u7edf\u4ee3\u7801\u53d8\u5f97\u51cc\u4e71\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/ssbandjl/golang-design-pattern/tree/master/02_adapter</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/","title":"1.\u7b56\u7565\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u7b56\u7565\u6a21\u5f0f\u7b80\u4ecb","text":"<p>**\u7b56\u7565\u6a21\u5f0f**\u662f\u4e00\u79cd\u884c\u4e3a\u8bbe\u8ba1\u6a21\u5f0f\uff0c \u5b83\u80fd\u8ba9\u4f60\u5b9a\u4e49\u4e00\u7cfb\u5217\u7b97\u6cd5\uff0c \u5e76\u5c06\u6bcf\u79cd\u7b97\u6cd5\u5206\u522b\u653e\u5165\u72ec\u7acb\u7684\u7c7b\u4e2d\uff0c \u4ee5\u4f7f\u7b97\u6cd5\u7684\u5bf9\u8c61\u80fd\u591f\u76f8\u4e92\u66ff\u6362\u3002</p> <p>\u7b56\u7565\u6a21\u5f0f\u5efa\u8bae\u627e\u51fa\u8d1f\u8d23\u7528\u8bb8\u591a\u4e0d\u540c\u65b9\u5f0f\u5b8c\u6210\u7279\u5b9a\u4efb\u52a1\u7684\u7c7b\uff0c \u7136\u540e\u5c06\u5176\u4e2d\u7684\u7b97\u6cd5\u62bd\u53d6\u5230\u4e00\u7ec4\u88ab\u79f0\u4e3a*\u7b56\u7565*\u7684\u72ec\u7acb\u7c7b\u4e2d\u3002</p> <p>\u540d\u4e3a*\u4e0a\u4e0b\u6587*\u7684\u539f\u59cb\u7c7b\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u6210\u5458\u53d8\u91cf\u6765\u5b58\u50a8\u5bf9\u4e8e\u6bcf\u79cd\u7b56\u7565\u7684\u5f15\u7528\u3002 \u4e0a\u4e0b\u6587\u5e76\u4e0d\u6267\u884c\u4efb\u52a1\uff0c \u800c\u662f\u5c06\u5de5\u4f5c\u59d4\u6d3e\u7ed9\u5df2\u8fde\u63a5\u7684\u7b56\u7565\u5bf9\u8c61\u3002</p> <p>\u4e0a\u4e0b\u6587\u4e0d\u8d1f\u8d23\u9009\u62e9\u7b26\u5408\u4efb\u52a1\u9700\u8981\u7684\u7b97\u6cd5\u2014\u2014\u5ba2\u6237\u7aef\u4f1a\u5c06\u6240\u9700\u7b56\u7565\u4f20\u9012\u7ed9\u4e0a\u4e0b\u6587\u3002 \u5b9e\u9645\u4e0a\uff0c \u4e0a\u4e0b\u6587\u5e76\u4e0d\u5341\u5206\u4e86\u89e3\u7b56\u7565\uff0c \u5b83\u4f1a\u901a\u8fc7\u540c\u6837\u7684\u901a\u7528\u63a5\u53e3\u4e0e\u6240\u6709\u7b56\u7565\u8fdb\u884c\u4ea4\u4e92\uff0c \u800c\u8be5\u63a5\u53e3\u53ea\u9700\u66b4\u9732\u4e00\u4e2a\u65b9\u6cd5\u6765\u89e6\u53d1\u6240\u9009\u7b56\u7565\u4e2d\u5c01\u88c5\u7684\u7b97\u6cd5\u5373\u53ef\u3002</p> <p>\u56e0\u6b64\uff0c \u4e0a\u4e0b\u6587\u53ef\u72ec\u7acb\u4e8e\u5177\u4f53\u7b56\u7565\u3002 \u8fd9\u6837\u4f60\u5c31\u53ef\u5728\u4e0d\u4fee\u6539\u4e0a\u4e0b\u6587\u4ee3\u7801\u6216\u5176\u4ed6\u7b56\u7565\u7684\u60c5\u51b5\u4e0b\u6dfb\u52a0\u65b0\u7b97\u6cd5\u6216\u4fee\u6539\u5df2\u6709\u7b97\u6cd5\u4e86\u3002</p> <p>\u5728\u5bfc\u6e38\u5e94\u7528\u4e2d\uff0c \u6bcf\u4e2a\u8def\u7ebf\u89c4\u5212\u7b97\u6cd5\u90fd\u53ef\u88ab\u62bd\u53d6\u5230\u53ea\u6709\u4e00\u4e2a <code>build\u00adRoute</code>\u751f\u6210\u8def\u7ebf\u65b9\u6cd5\u7684\u72ec\u7acb\u7c7b\u4e2d\u3002 \u8be5\u65b9\u6cd5\u63a5\u6536\u8d77\u70b9\u548c\u7ec8\u70b9\u4f5c\u4e3a\u53c2\u6570\uff0c \u5e76\u8fd4\u56de\u8def\u7ebf\u4e2d\u9014\u70b9\u7684\u96c6\u5408\u3002</p> <p>\u5373\u4f7f\u4f20\u9012\u7ed9\u6bcf\u4e2a\u8def\u5f84\u89c4\u5212\u7c7b\u7684\u53c2\u6570\u4e00\u6a21\u4e00\u6837\uff0c \u5176\u6240\u521b\u5efa\u7684\u8def\u7ebf\u4e5f\u53ef\u80fd\u5b8c\u5168\u4e0d\u540c\u3002 \u4e3b\u8981\u5bfc\u6e38\u7c7b\u7684\u4e3b\u8981\u5de5\u4f5c\u662f\u5728\u5730\u56fe\u4e0a\u6e32\u67d3\u4e00\u7cfb\u5217\u4e2d\u9014\u70b9\uff0c \u4e0d\u4f1a\u5728\u610f\u5982\u4f55\u9009\u62e9\u7b97\u6cd5\u3002 \u8be5\u7c7b\u4e2d\u8fd8\u6709\u4e00\u4e2a\u7528\u4e8e\u5207\u6362\u5f53\u524d\u8def\u5f84\u89c4\u5212\u7b56\u7565\u7684\u65b9\u6cd5\uff0c \u56e0\u6b64\u5ba2\u6237\u7aef \uff08\u4f8b\u5982\u7528\u6237\u754c\u9762\u4e2d\u7684\u6309\u94ae\uff09 \u53ef\u7528\u5176\u4ed6\u7b56\u7565\u66ff\u6362\u5f53\u524d\u9009\u62e9\u7684\u8def\u5f84\u89c4\u5212\u884c\u4e3a\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package stragtegy\n\nimport \"fmt\"\n\n// \u7b56\u7565\u6a21\u5f0f\n\n// Person \u5b9a\u4e49 Person \u7ed3\u6784\u4f53\u5bf9\u8c61,Going \u63a5\u53e3\u5c5e\u6027\ntype Person struct {\n    Going\n}\n\n// Going \u5b9a\u4e49 Goging \u65b9\u6cd5,\u5185\u5305\u542b Run\u65b9\u6cd5\ntype Going interface {\n    Run()\n}\n\n// \u5b9a\u4e49Going \u7684\u4e0d\u540c\u7b56\u7565\n\n// 1. \u5b9a\u4e49cat\u5bf9\u8c61\n\ntype Car struct {\n    name string\n}\n\nfunc (c *Car) Run() {\n    fmt.Println(c.name, \"Running\")\n}\n\n// 2. \u5b9a\u4e49train\ntype Train struct {\n    name string\n}\n\nfunc (t *Train) Run() {\n    fmt.Println(t.name, \"Running\")\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package stragtegy\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestCar_Run(t *testing.T) {\n    c := &amp;Car{name: \"BYD\"}\n    c.Run()\n}\n\nfunc TestTrain_Run(t *testing.T) {\n    c := &amp;Train{name: \"tianqi01\"}\n    c.Run()\n}\n\n// \u5355\u5143\u6d4b\u8bd5\n// \u5bf9\u5b9a\u4e49\u7684\u5bf9\u8c61\u4e2d\u5c5e\u6027\u63a5\u53e3\u8fdb\u884c\u4e0d\u540c\u7684\u7b56\u7565\uff0c\u4ee5\u8fbe\u5230\u4e0d\u540c\u7684\u6548\u679c\nfunc TestPerson_Run(t *testing.T) {\n    fmt.Println(\"Person Test......,car\")\n    p := Person{}\n    c := &amp;Car{name: \"BMW\"}\n    p.Going = c\n    p.Run()\n\n    fmt.Println(\"Person Test......,train\")\n    tr := &amp;Train{name: \"tianqi01\"}\n\n    p.Going = tr\n    p.Run()\n\n}\n\n/*\nBYD Running\ntianqi01 Running\nPerson Test......,car\nBMW Running\nPerson Test......,train\ntianqi01 Running\n\n*/\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u5f53\u4f60\u60f3\u4f7f\u7528\u5bf9\u8c61\u4e2d\u5404\u79cd\u4e0d\u540c\u7684\u7b97\u6cd5\u53d8\u4f53\uff0c \u5e76\u5e0c\u671b\u80fd\u5728\u8fd0\u884c\u65f6\u5207\u6362\u7b97\u6cd5\u65f6\uff0c \u53ef\u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\u3002\u7b56\u7565\u6a21\u5f0f\u8ba9\u4f60\u80fd\u591f\u5c06\u5bf9\u8c61\u5173\u8054\u81f3\u53ef\u4ee5\u4e0d\u540c\u65b9\u5f0f\u6267\u884c\u7279\u5b9a\u5b50\u4efb\u52a1\u7684\u4e0d\u540c\u5b50\u5bf9\u8c61\uff0c \u4ece\u800c\u4ee5\u95f4\u63a5\u65b9\u5f0f\u5728\u8fd0\u884c\u65f6\u66f4\u6539\u5bf9\u8c61\u884c\u4e3a\u3002</li> <li>\u5f53\u4f60\u6709\u8bb8\u591a\u4ec5\u5728\u6267\u884c\u67d0\u4e9b\u884c\u4e3a\u65f6\u7565\u6709\u4e0d\u540c\u7684\u76f8\u4f3c\u7c7b\u65f6\uff0c \u53ef\u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\u3002 \u7b56\u7565\u6a21\u5f0f\u8ba9\u4f60\u80fd\u5c06\u4e0d\u540c\u884c\u4e3a\u62bd\u53d6\u5230\u4e00\u4e2a\u72ec\u7acb\u7c7b\u5c42\u6b21\u7ed3\u6784\u4e2d\uff0c \u5e76\u5c06\u539f\u59cb\u7c7b\u7ec4\u5408\u6210\u540c\u4e00\u4e2a\uff0c \u4ece\u800c\u51cf\u5c11\u91cd\u590d\u4ee3\u7801\u3002</li> <li>\u5982\u679c\u7b97\u6cd5\u5728\u4e0a\u4e0b\u6587\u7684\u903b\u8f91\u4e2d\u4e0d\u662f\u7279\u522b\u91cd\u8981\uff0c \u4f7f\u7528\u8be5\u6a21\u5f0f\u80fd\u5c06\u7c7b\u7684\u4e1a\u52a1\u903b\u8f91\u4e0e\u5176\u7b97\u6cd5\u5b9e\u73b0\u7ec6\u8282\u9694\u79bb\u5f00\u6765\u3002\u7b56\u7565\u6a21\u5f0f\u8ba9\u4f60\u80fd\u5c06\u5404\u79cd\u7b97\u6cd5\u7684\u4ee3\u7801\u3001 \u5185\u90e8\u6570\u636e\u548c\u4f9d\u8d56\u5173\u7cfb\u4e0e\u5176\u4ed6\u4ee3\u7801\u9694\u79bb\u5f00\u6765\u3002 \u4e0d\u540c\u5ba2\u6237\u7aef\u53ef\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u63a5\u53e3\u6267\u884c\u7b97\u6cd5\uff0c \u5e76\u80fd\u5728\u8fd0\u884c\u65f6\u8fdb\u884c\u5207\u6362\u3002</li> <li>\u5f53\u7c7b\u4e2d\u4f7f\u7528\u4e86\u590d\u6742\u6761\u4ef6\u8fd0\u7b97\u7b26\u4ee5\u5728\u540c\u4e00\u7b97\u6cd5\u7684\u4e0d\u540c\u53d8\u4f53\u4e2d\u5207\u6362\u65f6\uff0c \u53ef\u4f7f\u7528\u8be5\u6a21\u5f0f\u3002\u7b56\u7565\u6a21\u5f0f\u5c06\u6240\u6709\u7ee7\u627f\u81ea\u540c\u6837\u63a5\u53e3\u7684\u7b97\u6cd5\u62bd\u53d6\u5230\u72ec\u7acb\u7c7b\u4e2d\uff0c \u56e0\u6b64\u4e0d\u518d\u9700\u8981\u6761\u4ef6\u8bed\u53e5\u3002 \u539f\u59cb\u5bf9\u8c61\u5e76\u4e0d\u5b9e\u73b0\u6240\u6709\u7b97\u6cd5\u7684\u53d8\u4f53\uff0c \u800c\u662f\u5c06\u6267\u884c\u5de5\u4f5c\u59d4\u6d3e\u7ed9\u5176\u4e2d\u7684\u4e00\u4e2a\u72ec\u7acb\u7b97\u6cd5\u5bf9\u8c61\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ul> <li>\u4f60\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u5207\u6362\u5bf9\u8c61\u5185\u7684\u7b97\u6cd5\u3002</li> <li>\u4f60\u53ef\u4ee5\u5c06\u7b97\u6cd5\u7684\u5b9e\u73b0\u548c\u4f7f\u7528\u7b97\u6cd5\u7684\u4ee3\u7801\u9694\u79bb\u5f00\u6765\u3002</li> <li>\u4f60\u53ef\u4ee5\u4f7f\u7528\u7ec4\u5408\u6765\u4ee3\u66ff\u7ee7\u627f\u3002</li> <li>\u5f00\u95ed\u539f\u5219\u3002 \u4f60\u65e0\u9700\u5bf9\u4e0a\u4e0b\u6587\u8fdb\u884c\u4fee\u6539\u5c31\u80fd\u591f\u5f15\u5165\u65b0\u7684\u7b56\u7565\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u5982\u679c\u4f60\u7684\u7b97\u6cd5\u6781\u5c11\u53d1\u751f\u6539\u53d8\uff0c \u90a3\u4e48\u6ca1\u6709\u4efb\u4f55\u7406\u7531\u5f15\u5165\u65b0\u7684\u7c7b\u548c\u63a5\u53e3\u3002 \u4f7f\u7528\u8be5\u6a21\u5f0f\u53ea\u4f1a\u8ba9\u7a0b\u5e8f\u8fc7\u4e8e\u590d\u6742\u3002</li> <li>\u5ba2\u6237\u7aef\u5fc5\u987b\u77e5\u6653\u7b56\u7565\u95f4\u7684\u4e0d\u540c\u2014\u2014\u5b83\u9700\u8981\u9009\u62e9\u5408\u9002\u7684\u7b56\u7565\u3002</li> <li>\u8bb8\u591a\u73b0\u4ee3\u7f16\u7a0b\u8bed\u8a00\u652f\u6301\u51fd\u6570\u7c7b\u578b\u529f\u80fd\uff0c \u5141\u8bb8\u4f60\u5728\u4e00\u7ec4\u533f\u540d\u51fd\u6570\u4e2d\u5b9e\u73b0\u4e0d\u540c\u7248\u672c\u7684\u7b97\u6cd5\u3002 \u8fd9\u6837\uff0c \u4f60\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\u7684\u65b9\u5f0f\u5c31\u548c\u4f7f\u7528\u7b56\u7565\u5bf9\u8c61\u65f6\u5b8c\u5168\u76f8\u540c\uff0c \u65e0\u9700\u501f\u52a9\u989d\u5916\u7684\u7c7b\u548c\u63a5\u53e3\u6765\u4fdd\u6301\u4ee3\u7801\u7b80\u6d01\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/silsuer/golang-design-patterns</li> <li>https://refactoringguru.cn/design-patterns/strategy</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/","title":"2.\u89c2\u5bdf\u8005\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u89c2\u5bdf\u8005\u6a21\u5f0f\u7b80\u4ecb","text":"<p>**\u89c2\u5bdf\u8005\u6a21\u5f0f**\u662f\u4e00\u79cd\u884c\u4e3a\u8bbe\u8ba1\u6a21\u5f0f\uff0c \u5141\u8bb8\u4f60\u5b9a\u4e49\u4e00\u79cd\u8ba2\u9605\u673a\u5236\uff0c \u53ef\u5728\u5bf9\u8c61\u4e8b\u4ef6\u53d1\u751f\u65f6\u901a\u77e5\u591a\u4e2a \u201c\u89c2\u5bdf\u201d \u8be5\u5bf9\u8c61\u7684\u5176\u4ed6\u5bf9\u8c61\u3002</p> <p>\u591a\u4e2a\u5bf9\u8c61\u540c\u65f6\u89c2\u5bdf\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5f53\u8fd9\u4e2a\u88ab\u89c2\u5bdf\u7684\u5bf9\u8c61\u53d1\u751f\u53d8\u5316\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u90fd\u4f1a\u5f97\u5230\u901a\u77e5\uff0c\u53ef\u4ee5\u505a\u4e00\u4e9b\u64cd\u4f5c...</p> <p>\u62e5\u6709\u4e00\u4e9b\u503c\u5f97\u5173\u6ce8\u7684\u72b6\u6001\u7684\u5bf9\u8c61\u901a\u5e38\u88ab\u79f0\u4e3a*\u76ee\u6807*\uff0c \u7531\u4e8e\u5b83\u8981\u5c06\u81ea\u8eab\u7684\u72b6\u6001\u6539\u53d8\u901a\u77e5\u7ed9\u5176\u4ed6\u5bf9\u8c61\uff0c \u6211\u4eec\u4e5f\u5c06\u5176\u79f0\u4e3a*\u53d1\u5e03\u8005* \uff08publisher\uff09\u3002 \u6240\u6709\u5e0c\u671b\u5173\u6ce8\u53d1\u5e03\u8005\u72b6\u6001\u53d8\u5316\u7684\u5176\u4ed6\u5bf9\u8c61\u88ab\u79f0\u4e3a*\u8ba2\u9605\u8005* \uff08subscribers\uff09\u3002</p> <p>\u89c2\u5bdf\u8005\u6a21\u5f0f\u5efa\u8bae\u4f60\u4e3a\u53d1\u5e03\u8005\u7c7b\u6dfb\u52a0\u8ba2\u9605\u673a\u5236\uff0c \u8ba9\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u80fd\u8ba2\u9605\u6216\u53d6\u6d88\u8ba2\u9605\u53d1\u5e03\u8005\u4e8b\u4ef6\u6d41\u3002 \u4e0d\u8981\u5bb3\u6015\uff01 \u8fd9\u5e76\u4e0d\u50cf\u542c\u4e0a\u53bb\u90a3\u4e48\u590d\u6742\u3002 \u5b9e\u9645\u4e0a\uff0c \u8be5\u673a\u5236\u5305\u62ec 1\uff09 \u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u8ba2\u9605\u8005\u5bf9\u8c61\u5f15\u7528\u7684\u5217\u8868\u6210\u5458\u53d8\u91cf\uff1b 2\uff09 \u51e0\u4e2a\u7528\u4e8e\u6dfb\u52a0\u6216\u5220\u9664\u8be5\u5217\u8868\u4e2d\u8ba2\u9605\u8005\u7684\u516c\u6709\u65b9\u6cd5\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package observer\n\nimport \"fmt\"\n\n\n// \u5b9a\u4e49\u89c2\u5bdf\u8005\u63a5\u53e3\ntype observer interface {\n    // \u66f4\u65b0\u6570\u636e,\u53d1\u9001\u901a\u77e5\n    update(string)\n\n    // \u83b7\u53d6\u5177\u4f53\u6570\u636e\u5bf9\u8c61id\n    getID() string\n}\n\n\n// \u5177\u4f53\u89c2\u5bdf\u8005\ntype customer struct {\n    id string\n}\n\n// \u66f4\u65b0\uff0c\u53d1\u9001email\u7d66\u7528\u6237\nfunc (c *customer) update(itemName string)  {\n    fmt.Printf(\"Sending email to customer %s for item %s\\n\", c.id,itemName)\n}\n\n// \u83b7\u53d6\u7528\u6237id\nfunc (c *customer) getID() string  {\n    return c.id\n}\n\n// \u5b9a\u4e49\u88ab\u89c2\u5bdf\u8005, \u4e5f\u5c31\u662f\u4e3b\u9898\ntype subject interface {\n    register(Observer observer)\n    deregister(Observer observer)\n    notifyAll()\n}\n\n// \u5b9a\u4e49\u5177\u4f53\u53d1\u5e03\u8005\u88ab\u89c2\u5bdf\u8005\u4e3b\u4f53\ntype item struct {\n    observerList []observer\n    name string\n    isStock bool\n}\n\nfunc newItem(name string) *item {\n    return &amp;item{\n        name: name,\n    }\n}\n\nfunc (i *item) updateAvailability()  {\n    fmt.Printf(\"Item %s is now in stock\\n\",i.name)\n    i.isStock = true\n    i.notifyAll()\n}\n\n// \u6ce8\u518c\u5230\u88ab\u89c2\u6d4b\u8005\nfunc (i *item) register(o observer)  {\n    i.observerList = append(i.observerList, o)\n}\n\n// \u6ce8\u9500\nfunc (i *item) deregister(o observer)  {\n    i.observerList = removeFromslice(i.observerList, o)\n}\n\n// \u901a\u77e5\nfunc (i *item) notifyAll()  {\n    for _, observer := range i.observerList {\n        observer.update(i.name)\n    }\n}\n\n// \u5c06\u4e00\u4e2a\u5143\u7d20\u4eceslice\u4e2d\u79fb\u9664\nfunc removeFromslice(observerList []observer, observerToRemove observer) []observer  {\n    observerListLength := len(observerList)\n    for i,observer := range observerList {\n        if observerToRemove.getID() == observer.getID() {\n            observerList[observerListLength-1], observerList[i] = observerList[i],observerList[observerListLength-1]\n            return observerList[:observerListLength-1]\n        }\n    }\n    return observerList\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package observer\n\nimport (\n    \"testing\"\n)\nfunc TestObserver(t *testing.T)  {\n    shirtItem := newItem(\"nike\")\n\n    observerOne := &amp;customer{id: \"xuel\"}\n    observertwo := &amp;customer{id: \"wangj\"}\n\n    shirtItem.register(observerOne)\n    shirtItem.register(observertwo)\n\n\n    shirtItem.updateAvailability()\n\n    shirtItem.deregister(observertwo)\n\n    shirtItem.updateAvailability()\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#23","title":"2.3 \u8fd0\u884c\u7ed3\u679c","text":"<pre><code>=== RUN   TestObserver\nItem nike is now in stock\nSending email to customer xuel for item nike\nSending email to customer wangj for item nike\nItem nike is now in stock\nSending email to customer xuel for item nike\n--- PASS: TestObserver (0.00s)\nPASS\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<p>\u5f53\u4e00\u4e2a\u5bf9\u8c61\u72b6\u6001\u7684\u6539\u53d8\u9700\u8981\u6539\u53d8\u5176\u4ed6\u5bf9\u8c61\uff0c \u6216\u5b9e\u9645\u5bf9\u8c61\u662f\u4e8b\u5148\u672a\u77e5\u7684\u6216\u52a8\u6001\u53d8\u5316\u7684\u65f6\uff0c \u53ef\u4f7f\u7528\u89c2\u5bdf\u8005\u6a21\u5f0f\u3002</p> <p>\u5f53\u4f60\u4f7f\u7528\u56fe\u5f62\u7528\u6237\u754c\u9762\u7c7b\u65f6\u901a\u5e38\u4f1a\u9047\u5230\u4e00\u4e2a\u95ee\u9898\u3002 \u6bd4\u5982\uff0c \u4f60\u521b\u5efa\u4e86\u81ea\u5b9a\u4e49\u6309\u94ae\u7c7b\u5e76\u5141\u8bb8\u5ba2\u6237\u7aef\u5728\u6309\u94ae\u4e2d\u6ce8\u5165\u81ea\u5b9a\u4e49\u4ee3\u7801\uff0c \u8fd9\u6837\u5f53\u7528\u6237\u6309\u4e0b\u6309\u94ae\u65f6\u5c31\u4f1a\u89e6\u53d1\u8fd9\u4e9b\u4ee3\u7801\u3002</p> <p>\u89c2\u5bdf\u8005\u6a21\u5f0f\u5141\u8bb8\u4efb\u4f55\u5b9e\u73b0\u4e86\u8ba2\u9605\u8005\u63a5\u53e3\u7684\u5bf9\u8c61\u8ba2\u9605\u53d1\u5e03\u8005\u5bf9\u8c61\u7684\u4e8b\u4ef6\u901a\u77e5\u3002 \u4f60\u53ef\u5728\u6309\u94ae\u4e2d\u6dfb\u52a0\u8ba2\u9605\u673a\u5236\uff0c \u5141\u8bb8\u5ba2\u6237\u7aef\u901a\u8fc7\u81ea\u5b9a\u4e49\u8ba2\u9605\u7c7b\u6ce8\u5165\u81ea\u5b9a\u4e49\u4ee3\u7801\u3002</p> <p>\u5f53\u5e94\u7528\u4e2d\u7684\u4e00\u4e9b\u5bf9\u8c61\u5fc5\u987b\u89c2\u5bdf\u5176\u4ed6\u5bf9\u8c61\u65f6\uff0c \u53ef\u4f7f\u7528\u8be5\u6a21\u5f0f\u3002 \u4f46\u4ec5\u80fd\u5728\u6709\u9650\u65f6\u95f4\u5185\u6216\u7279\u5b9a\u60c5\u51b5\u4e0b\u4f7f\u7528\u3002</p> <p>\u8ba2\u9605\u5217\u8868\u662f\u52a8\u6001\u7684\uff0c \u56e0\u6b64\u8ba2\u9605\u8005\u53ef\u968f\u65f6\u52a0\u5165\u6216\u79bb\u5f00\u8be5\u5217\u8868\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ul> <li>\u5f00\u95ed\u539f\u5219\u3002 \u4f60\u65e0\u9700\u4fee\u6539\u53d1\u5e03\u8005\u4ee3\u7801\u5c31\u80fd\u5f15\u5165\u65b0\u7684\u8ba2\u9605\u8005\u7c7b \uff08\u5982\u679c\u662f\u53d1\u5e03\u8005\u63a5\u53e3\u5219\u53ef\u8f7b\u677e\u5f15\u5165\u53d1\u5e03\u8005\u7c7b\uff09\u3002</li> <li>\u4f60\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u5efa\u7acb\u5bf9\u8c61\u4e4b\u95f4\u7684\u8054\u7cfb\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u8ba2\u9605\u8005\u7684\u901a\u77e5\u987a\u5e8f\u662f\u968f\u673a\u7684\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://refactoringguru.cn/design-patterns/observer</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/","title":"2.\u6a21\u7248\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u6a21\u7248\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u6a21\u7248\u65b9\u6cd5\u6a21\u5f0f\u4f7f\u7528\u7ee7\u627f\u673a\u5236\uff0c\u628a\u901a\u7528\u6b65\u9aa4\u548c\u901a\u7528\u65b9\u6cd5\u653e\u5230\u7236\u7c7b\u4e2d\uff0c\u628a\u5177\u4f53\u5b9e\u73b0\u5ef6\u8fdf\u5230\u5b50\u7c7b\u4e2d\u5b9e\u73b0\u3002\u4f7f\u5f97\u5b9e\u73b0\u7b26\u5408\u5f00\u95ed\u539f\u5219\u3002</p> <p>\u5982\u5b9e\u4f8b\u4ee3\u7801\u4e2d\u901a\u7528\u6b65\u9aa4\u5728\u7236\u7c7b\u4e2d\u5b9e\u73b0\uff08<code>\u51c6\u5907</code>\u3001<code>\u4e0b\u8f7d</code>\u3001<code>\u4fdd\u5b58</code>\u3001<code>\u6536\u5c3e</code>\uff09\u4e0b\u8f7d\u548c\u4fdd\u5b58\u7684\u5177\u4f53\u5b9e\u73b0\u7559\u5230\u5b50\u7c7b\u4e2d\uff0c\u5e76\u4e14\u63d0\u4f9b <code>\u4fdd\u5b58</code>\u65b9\u6cd5\u7684\u9ed8\u8ba4\u5b9e\u73b0\u3002</p> <p>\u56e0\u4e3aGolang\u4e0d\u63d0\u4f9b\u7ee7\u627f\u673a\u5236\uff0c\u9700\u8981\u4f7f\u7528\u533f\u540d\u7ec4\u5408\u6a21\u62df\u5b9e\u73b0\u7ee7\u627f\u3002</p> <p>\u6b64\u5904\u9700\u8981\u6ce8\u610f\uff1a\u56e0\u4e3a\u7236\u7c7b\u9700\u8981\u8c03\u7528\u5b50\u7c7b\u65b9\u6cd5\uff0c\u6240\u4ee5\u5b50\u7c7b\u9700\u8981\u533f\u540d\u7ec4\u5408\u7236\u7c7b\u7684\u540c\u65f6\uff0c\u7236\u7c7b\u9700\u8981\u6301\u6709\u5b50\u7c7b\u7684\u5f15\u7528\u3002</p> <p>\u5728\u9762\u5411\u5bf9\u8c61\u7a0b\u5e8f\u8bbe\u8ba1\u8fc7\u7a0b\u4e2d\uff0c\u7a0b\u5e8f\u5458\u5e38\u5e38\u4f1a\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff1a\u8bbe\u8ba1\u4e00\u4e2a\u7cfb\u7edf\u65f6\u77e5\u9053\u4e86\u7b97\u6cd5\u6240\u9700\u7684\u5173\u952e\u6b65\u9aa4\uff0c\u800c\u4e14\u786e\u5b9a\u4e86\u8fd9\u4e9b\u6b65\u9aa4\u7684\u6267\u884c\u987a\u5e8f\uff0c\u4f46\u67d0\u4e9b\u6b65\u9aa4\u7684\u5177\u4f53\u5b9e\u73b0\u8fd8\u672a\u77e5\uff0c\u6216\u8005\u8bf4\u67d0\u4e9b\u6b65\u9aa4\u7684\u5b9e\u73b0\u4e0e\u5177\u4f53\u7684\u73af\u5883\u76f8\u5173\u3002</p> <p>\u4f8b\u5982\uff0c\u53bb\u94f6\u884c\u529e\u7406\u4e1a\u52a1\u4e00\u822c\u8981\u7ecf\u8fc7\u4ee5\u4e0b4\u4e2a\u6d41\u7a0b\uff1a\u53d6\u53f7\u3001\u6392\u961f\u3001\u529e\u7406\u5177\u4f53\u4e1a\u52a1\u3001\u5bf9\u94f6\u884c\u5de5\u4f5c\u4eba\u5458\u8fdb\u884c\u8bc4\u5206\u7b49\uff0c\u5176\u4e2d\u53d6\u53f7\u3001\u6392\u961f\u548c\u5bf9\u94f6\u884c\u5de5\u4f5c\u4eba\u5458\u8fdb\u884c\u8bc4\u5206\u7684\u4e1a\u52a1\u5bf9\u6bcf\u4e2a\u5ba2\u6237\u662f\u4e00\u6837\u7684\uff0c\u53ef\u4ee5\u5728\u7236\u7c7b\u4e2d\u5b9e\u73b0\uff0c\u4f46\u662f\u529e\u7406\u5177\u4f53\u4e1a\u52a1\u5374\u56e0\u4eba\u800c\u5f02\uff0c\u5b83\u53ef\u80fd\u662f\u5b58\u6b3e\u3001\u53d6\u6b3e\u6216\u8005\u8f6c\u8d26\u7b49\uff0c\u53ef\u4ee5\u5ef6\u8fdf\u5230\u5b50\u7c7b\u4e2d\u5b9e\u73b0\u3002</p> <p>\u8fd9\u6837\u7684\u4f8b\u5b50\u5728\u751f\u6d3b\u4e2d\u8fd8\u6709\u5f88\u591a\uff0c\u4f8b\u5982\uff0c\u4e00\u4e2a\u4eba\u6bcf\u5929\u4f1a\u8d77\u5e8a\u3001\u5403\u996d\u3001\u505a\u4e8b\u3001\u7761\u89c9\u7b49\uff0c\u5176\u4e2d\u201c\u505a\u4e8b\u201d\u7684\u5185\u5bb9\u6bcf\u5929\u53ef\u80fd\u4e0d\u540c\u3002\u6211\u4eec\u628a\u8fd9\u4e9b\u89c4\u5b9a\u4e86\u6d41\u7a0b\u6216\u683c\u5f0f\u7684\u5b9e\u4f8b\u5b9a\u4e49\u6210\u6a21\u677f\uff0c\u5141\u8bb8\u4f7f\u7528\u8005\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u53bb\u66f4\u65b0\u5b83\uff0c\u4f8b\u5982\uff0c\u7b80\u5386\u6a21\u677f\u3001\u8bba\u6587\u6a21\u677f\u3001Word \u4e2d\u6a21\u677f\u6587\u4ef6\u7b49\u3002</p> <p>\u4ee5\u4e0b\u4ecb\u7ecd\u7684\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u5c06\u89e3\u51b3\u4ee5\u4e0a\u7c7b\u4f3c\u7684\u95ee\u9898\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package templatemethod\n\nimport \"fmt\"\n\ntype iOtp interface {\n    genRandomOTP(int) string\n    saveOTPCache(string)\n    getMessage(string) string\n    sendNotification(string) error\n    publishMetric()\n}\n\n// \u6a21\u7248\u6a21\u5f0f\u57fa\u4e8e\u7ee7\u627f\uff0c\u5728\u7c7b\u5c42\u9762\u8fdb\u884c\ntype Otp struct {\n    iOtp iOtp\n}\n\nfunc (i Otp) genAndSendMsg(optLength int) error {\n    opt := i.iOtp.genRandomOTP(optLength)\n    i.iOtp.saveOTPCache(opt)\n    msg := i.iOtp.getMessage(opt)\n    if err := i.iOtp.sendNotification(msg); err != nil {\n        return err\n    }\n    i.iOtp.publishMetric()\n    return nil\n}\n\n// \u6a21\u7248\u6a21\u5f0f\u57fa\u4e8e\u7ee7\u627f\uff0c\u5728\u7c7b\u5c42\u9762\u8fdb\u884c\ntype Email struct {\n    Otp\n}\n\n// \u7ee7\u627f\u91cd\u5199\u7236\u7c7b\u65b9\u6cd5\nfunc (e *Email) genRandomOTP(int) string {\n    fmt.Println(\"email gen random otp\")\n    return fmt.Sprintf(\"%s, gen random otp\", e)\n}\n\nfunc (e *Email) saveOTPCache(otp string) {\n    fmt.Println(\"email save otp\", otp)\n}\n\nfunc (e *Email) getMessage(opt string) string {\n    return fmt.Sprintf(\"%s,msg\", opt)\n}\nfunc (e *Email) sendNotification(msg string) error {\n    fmt.Println(\"e send notification\", msg)\n    return nil\n}\nfunc (e *Email) publishMetric() {\n    fmt.Println(\"email publish\")\n}\n\ntype SMS struct {\n    Otp\n}\n\n// \u7ee7\u627f\u91cd\u5199\u7236\u7c7b\u65b9\u6cd5\nfunc (e *SMS) genRandomOTP(int) string {\n    fmt.Println(\"SMS gen random otp\")\n    return fmt.Sprintf(\"%s, gen random otp\", e)\n}\n\nfunc (e *SMS) saveOTPCache(otp string) {\n    fmt.Println(\"SMS save otp\", otp)\n}\n\nfunc (e *SMS) getMessage(opt string) string {\n    return fmt.Sprintf(\"%s,msg\", opt)\n}\nfunc (e *SMS) sendNotification(msg string) error {\n    fmt.Println(\"SMS send notification\", msg)\n    return nil\n}\nfunc (e *SMS) publishMetric() {\n    fmt.Println(\"SMS publish\")\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package templatemethod\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nconst (\n    emailLength = 10\n    SmsLength   = 20\n)\n\nfunc TestOtp(t *testing.T) {\n\n    emopt := &amp;Email{}\n\n    opt := Otp{\n        iOtp: emopt,\n    }\n\n    _ = opt.genAndSendMsg(emailLength)\n\n    fmt.Println(\"\")\n\n    smsopt := &amp;SMS{}\n\n    opt = Otp{\n        iOtp: smsopt,\n    }\n    _ = opt.genAndSendMsg(SmsLength)\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#23","title":"2.3 \u8fd0\u884c\u7ed3\u679c","text":"<pre><code>email gen random otp\nemail save otp &amp;{{&lt;nil&gt;}}, gen random otp\ne send notification &amp;{{&lt;nil&gt;}}, gen random otp,msg\nemail publish\n\nSMS gen random otp\nSMS save otp &amp;{{&lt;nil&gt;}}, gen random otp\nSMS send notification &amp;{{&lt;nil&gt;}}, gen random otp,msg\nSMS publish\nPASS\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u5f53\u4e00\u4e2a\u5bf9\u8c61\u72b6\u6001\u7684\u6539\u53d8\u9700\u8981\u6539\u53d8\u5176\u4ed6\u5bf9\u8c61\uff0c \u6216\u5b9e\u9645\u5bf9\u8c61\u662f\u4e8b\u5148\u672a\u77e5\u7684\u6216\u52a8\u6001\u53d8\u5316\u7684\u65f6\uff0c \u53ef\u4f7f\u7528\u89c2\u5bdf\u8005\u6a21\u5f0f\u3002</li> <li>\u5f53\u5e94\u7528\u4e2d\u7684\u4e00\u4e9b\u5bf9\u8c61\u5fc5\u987b\u89c2\u5bdf\u5176\u4ed6\u5bf9\u8c61\u65f6\uff0c \u53ef\u4f7f\u7528\u8be5\u6a21\u5f0f\u3002 \u4f46\u4ec5\u80fd\u5728\u6709\u9650\u65f6\u95f4\u5185\u6216\u7279\u5b9a\u60c5\u51b5\u4e0b\u4f7f\u7528\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ul> <li>\u5b83\u5c01\u88c5\u4e86\u4e0d\u53d8\u90e8\u5206\uff0c\u6269\u5c55\u53ef\u53d8\u90e8\u5206\u3002\u5b83\u628a\u8ba4\u4e3a\u662f\u4e0d\u53d8\u90e8\u5206\u7684\u7b97\u6cd5\u5c01\u88c5\u5230\u7236\u7c7b\u4e2d\u5b9e\u73b0\uff0c\u800c\u628a\u53ef\u53d8\u90e8\u5206\u7b97\u6cd5\u7531\u5b50\u7c7b\u7ee7\u627f\u5b9e\u73b0\uff0c\u4fbf\u4e8e\u5b50\u7c7b\u7ee7\u7eed\u6269\u5c55\u3002</li> <li>\u5b83\u5728\u7236\u7c7b\u4e2d\u63d0\u53d6\u4e86\u516c\u5171\u7684\u90e8\u5206\u4ee3\u7801\uff0c\u4fbf\u4e8e\u4ee3\u7801\u590d\u7528\u3002</li> <li>\u90e8\u5206\u65b9\u6cd5\u662f\u7531\u5b50\u7c7b\u5b9e\u73b0\u7684\uff0c\u56e0\u6b64\u5b50\u7c7b\u53ef\u4ee5\u901a\u8fc7\u6269\u5c55\u65b9\u5f0f\u589e\u52a0\u76f8\u5e94\u7684\u529f\u80fd\uff0c\u7b26\u5408\u5f00\u95ed\u539f\u5219\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u5bf9\u6bcf\u4e2a\u4e0d\u540c\u7684\u5b9e\u73b0\u90fd\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u5b50\u7c7b\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u7c7b\u7684\u4e2a\u6570\u589e\u52a0\uff0c\u7cfb\u7edf\u66f4\u52a0\u5e9e\u5927\uff0c\u8bbe\u8ba1\u4e5f\u66f4\u52a0\u62bd\u8c61\uff0c\u95f4\u63a5\u5730\u589e\u52a0\u4e86\u7cfb\u7edf\u5b9e\u73b0\u7684\u590d\u6742\u5ea6\u3002</li> <li>\u7236\u7c7b\u4e2d\u7684\u62bd\u8c61\u65b9\u6cd5\u7531\u5b50\u7c7b\u5b9e\u73b0\uff0c\u5b50\u7c7b\u6267\u884c\u7684\u7ed3\u679c\u4f1a\u5f71\u54cd\u7236\u7c7b\u7684\u7ed3\u679c\uff0c\u8fd9\u5bfc\u81f4\u4e00\u79cd\u53cd\u5411\u7684\u63a7\u5236\u7ed3\u6784\uff0c\u5b83\u63d0\u9ad8\u4e86\u4ee3\u7801\u9605\u8bfb\u7684\u96be\u5ea6\u3002</li> <li>\u7531\u4e8e\u7ee7\u627f\u5173\u7cfb\u81ea\u8eab\u7684\u7f3a\u70b9\uff0c\u5982\u679c\u7236\u7c7b\u6dfb\u52a0\u65b0\u7684\u62bd\u8c61\u65b9\u6cd5\uff0c\u5219\u6240\u6709\u5b50\u7c7b\u90fd\u8981\u6539\u4e00\u904d\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://refactoringguru.cn/design-patterns/observer</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/","title":"4.\u804c\u8d23\u94fe\u6a21\u5f0f","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#_1","title":"\u4e00 \u804c\u8d23\u94fe\u6a21\u5f0f\u7b80\u4ecb","text":"<p>\u804c\u8d23\u94fe\u6a21\u5f0f\u7528\u4e8e\u5206\u79bb\u4e0d\u540c\u804c\u8d23\uff0c\u5e76\u4e14\u52a8\u6001\u7ec4\u5408\u76f8\u5173\u804c\u8d23\u3002</p> <p>Golang\u5b9e\u73b0\u804c\u8d23\u94fe\u6a21\u5f0f\u65f6\u5019\uff0c\u56e0\u4e3a\u6ca1\u6709\u7ee7\u627f\u7684\u652f\u6301\uff0c\u4f7f\u7528\u94fe\u5bf9\u8c61\u5305\u6db5\u804c\u8d23\u7684\u65b9\u5f0f\uff0c\u5373\uff1a</p> <ul> <li>\u94fe\u5bf9\u8c61\u5305\u542b\u5f53\u524d\u804c\u8d23\u5bf9\u8c61\u4ee5\u53ca\u4e0b\u4e00\u4e2a\u804c\u8d23\u94fe\u3002</li> <li>\u804c\u8d23\u5bf9\u8c61\u63d0\u4f9b\u63a5\u53e3\u8868\u793a\u662f\u5426\u80fd\u5904\u7406\u5bf9\u5e94\u8bf7\u6c42\u3002</li> <li>\u804c\u8d23\u5bf9\u8c61\u63d0\u4f9b\u5904\u7406\u51fd\u6570\u5904\u7406\u76f8\u5173\u804c\u8d23\u3002</li> </ul> <p>\u540c\u65f6\u53ef\u5728\u804c\u8d23\u94fe\u7c7b\u4e2d\u5b9e\u73b0\u804c\u8d23\u63a5\u53e3\u76f8\u5173\u51fd\u6570\uff0c\u4f7f\u804c\u8d23\u94fe\u5bf9\u8c61\u53ef\u4ee5\u5f53\u505a\u4e00\u822c\u804c\u8d23\u5bf9\u8c61\u662f\u7528\u3002</p>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#_2","title":"\u4e8c \u4ee3\u7801","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#21","title":"2.1 \u5f00\u53d1\u4ee3\u7801","text":"<pre><code>package responsibilitychain\n\nimport \"fmt\"\n\ntype patient struct {\n    name              string\n    registrationDone  bool\n    doctorCheckUpDone bool\n    medicineDone      bool\n    paymentDone       bool\n}\n\ntype department interface {\n    // \u8fd9\u4e2a\u90e8\u95e8\u8fdb\u884c\u5904\u7406\n    execute(*patient)\n    // \u8bbe\u7f6e\u4e0b\u4e00\u4e2a\u90e8\u95e8\n    setNext(department)\n}\n\ntype reception struct {\n    next department\n}\n\nfunc (r *reception) execute(p *patient) {\n    if p.registrationDone {\n        fmt.Println(\"registration done\")\n        r.next.execute(p)\n        return\n    }\n    fmt.Println(\"registration doing\")\n    p.registrationDone = true\n    r.next.execute(p)\n}\n\nfunc (r *reception) setNext(next department) {\n    r.next = next\n}\n\ntype doctor struct {\n    next department\n}\n\nfunc (d *doctor) execute(p *patient) {\n    if p.doctorCheckUpDone {\n        fmt.Println(\"docker done\")\n        d.next.execute(p)\n        return\n    }\n    fmt.Println(\"docker doing\")\n    p.doctorCheckUpDone = true\n    d.next.execute(p)\n}\n\nfunc (d *doctor) setNext(next department) {\n    d.next = next\n}\n\ntype medical struct {\n    next department\n}\n\nfunc (m *medical) execute(p *patient) {\n    if p.medicineDone {\n        fmt.Println(\"medical done\")\n        m.next.execute(p)\n        return\n    }\n    fmt.Println(\"medical doing\")\n    p.medicineDone = true\n    m.next.execute(p)\n}\n\nfunc (m *medical) setNext(next department) {\n    m.next = next\n}\n\ntype cashier struct {\n    next department\n}\n\nfunc (c *cashier) setNext(next department) {\n    c.next = next\n}\n\nfunc (c *cashier) execute(p *patient) {\n    if p.paymentDone {\n        fmt.Println(\"cashier done\")\n        fmt.Println(\"patient end\")\n        return\n    }\n    fmt.Println(\"cashier doing\")\n    fmt.Println(\"patient end\")\n}\n\nfunc main() {\n    p := &amp;patient{name: \"xiaoming\"}\n\n    c := &amp;cashier{}\n\n    m := &amp;medical{}\n    m.setNext(c)\n\n    d := &amp;doctor{}\n    d.setNext(m)\n\n    r := &amp;reception{}\n    r.setNext(d)\n\n    r.execute(p)\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#22","title":"2.2 \u6d4b\u8bd5","text":"<pre><code>package responsibilitychain\n\nimport \"testing\"\n\nfunc TestPatient(t *testing.T) {\n    p := &amp;patient{name: \"xiaoming\"}\n\n    c := &amp;cashier{}\n\n    m := &amp;medical{}\n    m.setNext(c)\n\n    d := &amp;doctor{}\n    d.setNext(m)\n\n    r := &amp;reception{}\n    r.setNext(d)\n\n    r.execute(p)\n}\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#23","title":"2.3 \u8f93\u51fa","text":"<pre><code>registration doing\ndocker doing\nmedical doing\ncashier doing\npatient end\n</code></pre>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#_3","title":"\u4e09 \u5e94\u7528\u573a\u666f","text":"<ol> <li>\u591a\u4e2a\u5bf9\u8c61\u53ef\u4ee5\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u4f46\u5177\u4f53\u7531\u54ea\u4e2a\u5bf9\u8c61\u5904\u7406\u8be5\u8bf7\u6c42\u5728\u8fd0\u884c\u65f6\u81ea\u52a8\u786e\u5b9a\u3002</li> <li>\u53ef\u52a8\u6001\u6307\u5b9a\u4e00\u7ec4\u5bf9\u8c61\u5904\u7406\u8bf7\u6c42\uff0c\u6216\u6dfb\u52a0\u65b0\u7684\u5904\u7406\u8005\u3002</li> <li>\u9700\u8981\u5728\u4e0d\u660e\u786e\u6307\u5b9a\u8bf7\u6c42\u5904\u7406\u8005\u7684\u60c5\u51b5\u4e0b\uff0c\u5411\u591a\u4e2a\u5904\u7406\u8005\u4e2d\u7684\u4e00\u4e2a\u63d0\u4ea4\u8bf7\u6c42\u3002</li> </ol>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#_4","title":"\u56db \u7279\u70b9","text":""},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#41","title":"4.1 \u4f18\u70b9","text":"<ul> <li>\u964d\u4f4e\u4e86\u5bf9\u8c61\u4e4b\u95f4\u7684\u8026\u5408\u5ea6\u3002\u8be5\u6a21\u5f0f\u4f7f\u5f97\u4e00\u4e2a\u5bf9\u8c61\u65e0\u987b\u77e5\u9053\u5230\u5e95\u662f\u54ea\u4e00\u4e2a\u5bf9\u8c61\u5904\u7406\u5176\u8bf7\u6c42\u4ee5\u53ca\u94fe\u7684\u7ed3\u6784\uff0c\u53d1\u9001\u8005\u548c\u63a5\u6536\u8005\u4e5f\u65e0\u987b\u62e5\u6709\u5bf9\u65b9\u7684\u660e\u786e\u4fe1\u606f\u3002</li> <li>\u589e\u5f3a\u4e86\u7cfb\u7edf\u7684\u53ef\u6269\u5c55\u6027\u3002\u53ef\u4ee5\u6839\u636e\u9700\u8981\u589e\u52a0\u65b0\u7684\u8bf7\u6c42\u5904\u7406\u7c7b\uff0c\u6ee1\u8db3\u5f00\u95ed\u539f\u5219\u3002</li> <li>\u589e\u5f3a\u4e86\u7ed9\u5bf9\u8c61\u6307\u6d3e\u804c\u8d23\u7684\u7075\u6d3b\u6027\u3002\u5f53\u5de5\u4f5c\u6d41\u7a0b\u53d1\u751f\u53d8\u5316\uff0c\u53ef\u4ee5\u52a8\u6001\u5730\u6539\u53d8\u94fe\u5185\u7684\u6210\u5458\u6216\u8005\u8c03\u52a8\u5b83\u4eec\u7684\u6b21\u5e8f\uff0c\u4e5f\u53ef\u52a8\u6001\u5730\u65b0\u589e\u6216\u8005\u5220\u9664\u8d23\u4efb\u3002</li> <li>\u8d23\u4efb\u94fe\u7b80\u5316\u4e86\u5bf9\u8c61\u4e4b\u95f4\u7684\u8fde\u63a5\u3002\u6bcf\u4e2a\u5bf9\u8c61\u53ea\u9700\u4fdd\u6301\u4e00\u4e2a\u6307\u5411\u5176\u540e\u7ee7\u8005\u7684\u5f15\u7528\uff0c\u4e0d\u9700\u4fdd\u6301\u5176\u4ed6\u6240\u6709\u5904\u7406\u8005\u7684\u5f15\u7528\uff0c\u8fd9\u907f\u514d\u4e86\u4f7f\u7528\u4f17\u591a\u7684 if \u6216\u8005 if\u00b7\u00b7\u00b7else \u8bed\u53e5\u3002</li> <li>\u8d23\u4efb\u5206\u62c5\u3002\u6bcf\u4e2a\u7c7b\u53ea\u9700\u8981\u5904\u7406\u81ea\u5df1\u8be5\u5904\u7406\u7684\u5de5\u4f5c\uff0c\u4e0d\u8be5\u5904\u7406\u7684\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u5bf9\u8c61\u5b8c\u6210\uff0c\u660e\u786e\u5404\u7c7b\u7684\u8d23\u4efb\u8303\u56f4\uff0c\u7b26\u5408\u7c7b\u7684\u5355\u4e00\u804c\u8d23\u539f\u5219\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#42","title":"4.2 \u7f3a\u70b9","text":"<ul> <li>\u4e0d\u80fd\u4fdd\u8bc1\u6bcf\u4e2a\u8bf7\u6c42\u4e00\u5b9a\u88ab\u5904\u7406\u3002\u7531\u4e8e\u4e00\u4e2a\u8bf7\u6c42\u6ca1\u6709\u660e\u786e\u7684\u63a5\u6536\u8005\uff0c\u6240\u4ee5\u4e0d\u80fd\u4fdd\u8bc1\u5b83\u4e00\u5b9a\u4f1a\u88ab\u5904\u7406\uff0c\u8be5\u8bf7\u6c42\u53ef\u80fd\u4e00\u76f4\u4f20\u5230\u94fe\u7684\u672b\u7aef\u90fd\u5f97\u4e0d\u5230\u5904\u7406\u3002</li> <li>\u5bf9\u6bd4\u8f83\u957f\u7684\u804c\u8d23\u94fe\uff0c\u8bf7\u6c42\u7684\u5904\u7406\u53ef\u80fd\u6d89\u53ca\u591a\u4e2a\u5904\u7406\u5bf9\u8c61\uff0c\u7cfb\u7edf\u6027\u80fd\u5c06\u53d7\u5230\u4e00\u5b9a\u5f71\u54cd\u3002</li> <li>\u804c\u8d23\u94fe\u5efa\u7acb\u7684\u5408\u7406\u6027\u8981\u9760\u5ba2\u6237\u7aef\u6765\u4fdd\u8bc1\uff0c\u589e\u52a0\u4e86\u5ba2\u6237\u7aef\u7684\u590d\u6742\u6027\uff0c\u53ef\u80fd\u4f1a\u7531\u4e8e\u804c\u8d23\u94fe\u7684\u9519\u8bef\u8bbe\u7f6e\u800c\u5bfc\u81f4\u7cfb\u7edf\u51fa\u9519\uff0c\u5982\u53ef\u80fd\u4f1a\u9020\u6210\u5faa\u73af\u8c03\u7528\u3002</li> </ul>"},{"location":"develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://refactoringguru.cn/design-patterns/chain-of-responsibility</li> <li>https://github.com/ssbandjl/golang-design-pattern/tree/master/21_chain_of_responsibility</li> </ul>"},{"location":"devops/Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/","title":"1.\u654f\u6377\u65e0\u654c\u4e4bGitlab CI","text":""},{"location":"devops/Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/#_1","title":"\u80cc\u666f\uff1a","text":"<p>\u5728\u76ee\u524d\u5feb\u8282\u594f\u751f\u6d3b\u5df2\u7ecf\u6210\u4e3a\u793e\u4f1a\u98ce\u6f6e\u7684\u5927\u80cc\u666f\u4e0b\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u4e92\u8054\u7f51\u516c\u53f8\u4e3a\u4e86\u5176\u5e94\u7528\u4ea7\u54c1\u80fd\u66f4\u5feb\u7684\u638c\u63a7\u98ce\u5411\u8109\u640f\uff0c\u62a2\u5360\u5e02\u573a\u7ea2\u5229\uff0c\u9700\u8981\u66f4\u5feb\u901f\u7684\u5e94\u7528\u4ea7\u54c1\u5f00\u53d1\u4e0a\u7ebf\uff0c\u5728\u5e02\u573a\u7684\u53cd\u9988\u4e0b\uff0c\u4e0d\u65ad\u7684\u8fed\u4ee3\u65b0\u529f\u80fd\u3002\u5728\u6b64\u9700\u6c42\u4e0b\uff0c\u6301\u7eed\u96c6\u6210\uff0c\u6301\u7eed\u90e8\u7f72\uff0c\u6301\u7eed\u4ea4\u4ed8\u88ab\u8d8a\u6765\u6108\u591a\u516c\u53f8\u6240\u63a8\u5d07\uff0cDevOPS\u6587\u5316\u7684\u5174\u8d77\uff0c\u4e00\u65b9\u9762\u662f\u5b9e\u8df5\u6253\u7834\u8fd0\u7ef4\u4e0e\u7814\u53d1\u7684\u5821\u5792\u4e4b\u5899\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u662f\u654f\u6377\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u7684\u5fc5\u8981\u4ea7\u7269\u3002</p> <p>\u63d0\u9ad8\u8f6f\u4ef6\u5f00\u53d1\u6548\u80fd\uff0c\u5feb\u901f\u8fed\u4ee3\u3001\u5feb\u901f\u8bd5\u9519\uff0c\u4ee5\u53ca\u6839\u636e\u81ea\u5df1\u5f00\u53d1\u56e2\u961f\u7279\u70b9\uff0c\u4f7f\u7528\u600e\u6837\u7684\u6280\u672f\u624b\u6bb5\uff0c\u624d\u80fd\u662f\u8f6f\u4ef6\u5f00\u53d1\u6548\u80fd\u6700\u9ad8\uff0c\u66f4\u4e3a\u5feb\u901f\u654f\u6377\uff0c\u4ee5\u53ca\u600e\u6837\u624d\u80fd\u6ee1\u8db3\u4ea7\u54c1\u80fd\u5728\u6700\u77ed\u5468\u671f\u3001\u9ad8\u8d28\u91cf\u7684\u4ea4\u4ed8\u4e1a\u52a1\u7684\u8bc9\u6c42\uff1f</p> <p>\u672c\u4e13\u680f\u5728\u6b64\u80cc\u666f\u4e0b\u4e3a\u5927\u5bb6\u63d0\u4f9bGitlab CI\u6301\u7eed\u96c6\u6210\u65b9\u6848\uff0c\u901a\u8fc7\u4e00\u4e9b\u5217\u5b9e\u6218\uff0c\u8ba9\u5404\u4f4d\u80fd\u591f\u80fd\u76f4\u89c2\u6e05\u6670\u7684\u7406\u89e3\u8fd9\u79cd\u6a21\u5f0f\uff0c\u672c\u4e13\u680f\u4e3a\u629b\u7816\u5f15\u7389\uff0c\u5404\u4f4d\u7ed3\u5408\uff0c\u8bfb\u8005\u53ef\u4ee5\u7ed3\u5408\u81ea\u5df1\u5b9e\u9645\u7684\u751f\u4ea7\u73af\u5883\u6765\u8003\u8651\u662f\u5426\u5f15\u5165\u6b64\u4e2d\u6a21\u5f0f\uff0c\u4f18\u5316\u4ea4\u4ed8\u6d41\u7a0b\uff0c\u91ca\u653e\u7814\u53d1\u6700\u80fd\u5927\u6f5c\u80fd\uff0c\u4e0e\u6b64\u540c\u65f6\uff0c\u8bfb\u8005\u53ef\u4ee5\u5728\u672c\u4e13\u680f\u4f53\u9a8c\u7aef\u5230\u7aef\u7684 CICD \u7684\u5982\u4e1d\u822c\u987a\u6ed1\u7684CI\u4f53\u9a8c\uff0c\u5e76\u4e14\u65e0\u8bba\u8fd0\u7ef4\u4eba\u5458\u8fd8\u662f\u5f00\u53d1\u4eba\u5458\u90fd\u80fd\u591f\u5728\u672c\u4e13\u680f\u66f4\u7cfb\u7edf\u5b8f\u89c2\u7684\u4e86\u89e3\u548c\u5b66\u4e60Gitlab CI\u7684\u6d41\u7a0b\u53ca\u5177\u4f53\u64cd\u4f5c\u65b9\u5f0f\u3002</p>"},{"location":"devops/Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/#gitlab","title":"\u4e00 Gitlab","text":"<p>\u63d0\u5230Gitlab CI\uff0c\u5927\u5bb6\u53ef\u80fd\u90fd\u4f1a\u60f3\u5230Gitlab\uff0c\u5176\u4f5c\u4e3a\u76ee\u524d\u6700\u706b\u7684\u5f00\u4e1agit\u6258\u7ba1\u670d\u52a1\u7aef\uff0c\u76f8\u8f83\u4e8eGithub\uff0c\u5404\u4f01\u4e1a\u53ef\u4ee5\u8fdb\u884c\u79c1\u6709\u5316\u90e8\u7f72\uff0c\u670d\u52a1\u5668\u81ea\u5df1\u7ef4\u62a4\uff0c\u9879\u76ee\u6570\u636e\u66f4\u52a0\u5b89\u5168\u66f4\u53ef\u63a7\uff0c\u7f51\u7edc\u4e5f\u66f4\u5feb\u53ca\u66f4\u5b89\u5168\u3002</p> <p>Gitlab \u4e3a\u7528\u6237\u63d0\u4f9b\u53cb\u597d\u7684web\u754c\u9762\uff0c\u53ef\u4ee5\u5728\u7ebf\u4ee3\u7801\u67e5\u770b\u63d0\u4ea4\uff0c\u591a\u4eba\u534f\u4f5c\u5728\u7ebfcode review\uff0c\u53e6\u5916\u63d0\u4f9bwebhook\u53ca\u81ea\u5efa\u5e94\u7528\u4ecb\u5165\uff0c\u5f3a\u5927\u7684\u529f\u80fd\u5df2\u7ecf\u4e3a\u5927\u591a\u6570\u4e92\u8054\u7f51\u516c\u53f8\u4f5c\u4e3a\u9996\u9009\u7684\u4ee3\u7801\u4ed3\u5e93\uff0c\u5176\u81ea\u5e26\u7684Gitlab CI\uff0c\u4e0d\u4f9d\u6258\u4e8e\u5176\u4ed6\u53d1\u5e03\u8f6f\u4ef6\uff0c\u5929\u7136\u5feb\u901f\u96c6\u6210\u9879\u76eeCI\u529f\u80fd\uff0c\u66f4\u597d\u7684\u5207\u5408\u4e1a\u52a1\u654f\u6377\u5f00\u53d1\u5feb\u901f\u6301\u7eed\u96c6\u6210\u53ca\u90e8\u7f72\u7684\u9700\u6c42\u3002</p>"},{"location":"devops/Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/#_2","title":"\u4e8c \u6301\u7eed\u96c6\u6210","text":"<p>\u5728\u8c08\u8bbaGitlab CI\u524d\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u6301\u7eed\u96c6\u6210\uff0c\u5b83\u662f\u4e00\u79cd\u8f6f\u4ef6\u5f00\u53d1\u5b9e\u8df5\uff0c\u5176\u4e3a\u4e86\u4fdd\u8bc1\u8ba9\u5f00\u53d1\u7684\u4ea7\u54c1\u53ef\u4ee5\u4fdd\u6301\u9ad8\u8d28\u91cf\u7684\u60c5\u51b5\u4e0b\u5feb\u901f\u8fed\u4ee3\uff0c\u9891\u7e41\u7684\u5c06\u6d4b\u8bd5\u901a\u8fc7\u7684\u4ee3\u7801\u5408\u5e76\u5230\u4e3b\u5206\u652f\u4e2d\uff0c\u4e0d\u65ad\u7684\u53bb\u5c3d\u65e9\u7684\u8bd5\u9519\uff0c\u66f4\u4e3a\u654f\u6377\u7684\u5f00\u53d1\u3002</p>"},{"location":"devops/Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/#gitlab-ci","title":"\u4e09 Gitlab CI","text":"<p>\u901a\u8fc7\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u6e05\u695a\u7684\u77e5\u9053\u5728\u5feb\u901f\u53d1\u5c55\u7684\u5f53\u4e0b\uff0c\u654f\u6377\u662f\u4e00\u79cd\u9ad8\u6548\u7684\u5f00\u53d1\u6a21\u5f0f\uff0c\u6301\u7eed\u96c6\u6210\u662f\u6211\u4eec\u5728\u5176\u8fc7\u7a0b\u4e2d\u7684\u5fc5\u8981\u63aa\u65bd\uff0c\u90a3\u4e48\u5982\u4f55\u5b9e\u73b0\u8fd9\u4e2a\u6301\u7eed\u96c6\u6210\u5462\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u6211\u4eec\u901a\u8fc7\u4e00DevOPS\u7684\u89e3\u51b3\u65b9\u6848\u6765\u5b9e\u73b0\uff0c\u5728\u6b64\u6211\u4eec\u77e5\u9053\u4e86\u5927\u591a\u6570\u4f01\u4e1a\u5229\u7528Gitlab\uff0c\u90a3\u4eec\u6211\u4eec\u4f7f\u7528Gitlab CI\u6765\u540c\u4e00\u5957\u7cfb\u7edf\u6765\u5b9e\u73b0\u6301\u7eed\u96c6\u6210\u7ed9\u4e3a\u5feb\u6377\u7edf\u4e00\u3002</p>"},{"location":"devops/Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/#gitlab-ci_1","title":"\u56db Gitlab CI\u7684\u4f18\u52bf","text":"<ul> <li> <p>\u4f5c\u4e3aGitlab\u81ea\u5e26\u7684\u6301\u7eed\u96c6\u6210\u89e3\u51b3\u65b9\u6848\uff0c\u4ee3\u7801\u4f7f\u7528 GitLab \u8fdb\u884c\u6258\u7ba1\uff0cGitlab CI\u5929\u7136\u96c6\u65e0\u9700\u989d\u5916\u914d\u7f6e\uff0c\u4e0d\u9700\u8981\u8fd0\u7ef4\u4eba\u5458\u53bb\u5355\u72ec\u7ef4\u62a4\u5176\u4ed6CI\u7cfb\u7edf\uff0c\u907f\u514d\u591a\u70b9\u6545\u969c\u5f15\u5165\uff0c\u53ea\u7528\u505a\u597dGitlab\u7684\u7ef4\u62a4\u5373\u53ef\u3002</p> </li> <li> <p>Gitlab CI\u7684\u89e6\u53d1\u4e3aGit\u63d0\u4ea4\u68c0\u7d22.gitlab-ci.yaml\u6587\u4ef6\u89e6\u53d1\uff0c\u5176\u514d\u53bb\u4e86\u7b2c\u4e09\u65b9CI\u670d\u52a1\u5668\u5bf9\u5229\u7528webhook\u5b9a\u65f6\u8bf7\u6c42Gitlab\u7684\u538b\u529b\uff0c\u5982\u679c\u914d\u7f6e\u7684\u9879\u76ee\u6d41\u6c34\u7ebf\u5f88\u591a\uff0c\u8fd9\u4e2a\u538b\u529b\u4e0d\u5bb9\u5c0f\u89d1\u3002</p> </li> <li>Gitlab CI\u672c\u8eab\u8bbe\u8ba1\u4e3a<code>Config as Code</code>\u5c06CI/CD\u914d\u7f6e\u6258\u7ba1\u5728\u9879\u76ee\u4e2d\uff0c\u907f\u514d\u6bcf\u4e2a\u4eba\u624b\u5de5\u914d\u7f6e\u7684CI\u6216\u8fd8\u6709\u4e0d\u4e00\u81f4\u5e26\u6765\u7684\u95ee\u9898\u3002</li> <li>Gitlab CI\u771f\u6b63\u7684\u67b6\u6784\u4e3aC/S\u67b6\u6784\u6a21\u5f0f\uff0c\u53ef\u65b9\u9762\u7684\u8fdb\u884c\u6a2a\u5411\u6269\u5c55\uff0c\u8fd0\u884cjob\u6027\u80fd\u4e0a\u4e0d\u4f1a\u6709\u5f71\u54cd\uff0c</li> <li>\u5176\u6784\u5efa\u5305\u542b\u6784\u5efa\u65e5\u5fd7\uff0c\u5bb9\u6613\u6eaf\u6e90\u8ffd\u8e2a\u3002</li> <li>\u5176CI\u8fc7\u7a0b\u5229\u7528gitlab \u81ea\u5e26\u7684\u90ae\u4ef6\u901a\u77e5\uff0c\u4e0d\u7528\u989d\u5916\u914d\u7f6e\u901a\u77e5\u3002</li> </ul> <p>\u4e86\u89e3\u4e86Gitlab CI\u7684\u4f18\u52bf\uff0c\u662f\u4e0d\u662f\u6709\u4e86\u4e00\u5b9a\u7684\u5174\u8da3\u8dc3\u8dc3\u6b32\u8bd5\uff0c\u8ba9\u6211\u4eec\u6765\u4e00\u5757\u8d70\u8fdbGitlab CI\u5f97\u5b9e\u6218\uff0c\u4e00\u5757\u9886\u7565\u5982\u4e1d\u822c\u987a\u6ed1\u7684\u6301\u7eed\u96c6\u6210\u4f53\u9a8c\uff0c\u901a\u8fc7\u4e13\u680f\u901a\u8fc7\u56db\u4e2a\u5b9e\u6218\uff0c\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u516c\u53f8\u7279\u70b9\u6765\u6539\u8fdb\u6d41\u6c34\u7ebf\uff0c\u9002\u7528\u4e8e\u53d1\u5e03\u7269\u7406\u670d\u52a1\u5668\uff0c\u865a\u62df\u673a\uff0c\u516c\u6709\u4e91/\u79c1\u6709\u4e91\uff0c\u5df2\u7ecfK8s\u7b49\u3002\u6253\u7834\u7814\u53d1\u4e0e\u8fd0\u7ef4\u7684\u58c1\u5792\uff0c\u63d0\u9ad8\u56e2\u961f\u53ca\u534f\u4f5c/\u5feb\u901f\u53cd\u9988/\u54cd\u5e94\u53d8\u5316\u3002</p>"},{"location":"devops/Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/#_3","title":"\u4e94 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u672c\u6587\u5185\u5bb9\u7531\u6d45\u5165\u6df1\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u867d\u7136\u4e3a\u5fae\u4e13\u680f\uff0c\u4f46\u662f\u80fd\u4eceCI\u539f\u7406\u6d41\u7a0b\u5206\u6790\u53ca\u524d\u540e\u7aef\u9879\u76ee\u591a\u73af\u5883\u6df7\u5408\u90e8\u7f72\uff0c\u5168\u65b9\u4f4d\u591a\u5c42\u6b21\u7684\u6df1\u5165\u4e86\u89e3\u53ca\u5b9e\u6218Gitlab CI\uff0c\u76f8\u4fe1\u65e0\u8bba\u60a8\u76ee\u524d\u4f7f\u7528\u7684\u662f\u90a3\u79cdCI/CD\u65b9\u6848\uff0c\u901a\u8fc7\u672c\u4e13\u680f\u4e00\u5b9a\u80fd\u8ba9\u60a8\u4ece\u4e0d\u540c\u89d2\u5ea6\u6765\u91cd\u65b0\u8ba4\u8bc6CI\u3002</li> <li>\u672c\u6587\u524d\u4e24\u4e2a\u5b9e\u6218\u95e8\u69db\u8f83\u4f4e\uff0c\u4f7f\u7528\u4e8e\u7269\u7406\u670d\u52a1\u5668/\u865a\u62df\u673a/\u4e91\u670d\u52a1\u5668\u7b49\uff0c\u7b2c\u4e09\u7bc7\u9700\u8981\u8bfb\u8005\u5177\u5907\u4e00\u5b9a\u7684K8s\u77e5\u8bc6\uff0c\u76f8\u4fe1\u5728\u4e0d\u4e45\u7684\u5c06\u6765\uff0c\u5fae\u670d\u52a1\u5927\u884c\u5176\u9053\uff0c\u7b2c\u4e09\u7bc7\u5b9a\u80fd\u795d\u4f60\u4e00\u81c2\u4e4b\u529b\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/","title":"2.\u654f\u6377\u65e0\u654c\u4e4bGitlab CI\u67b6\u6784\u6d41\u7a0b\u8be6\u89e3","text":""},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#_1","title":"\u4e00 \u5f15\u5b50","text":"<p>\u5728\u6211\u4eec\u77e5\u9053\u4e86Gitlab CI\u662f\u4ec0\u4ee5\u53ca\u5b83\u80fd\u4e3a\u6211\u4eec\u5e26\u6765\u4ec0\u4e48\uff0c\u5728\u6211\u4eec\u5229\u7528Gitlab CI\u4e4b\u524d\uff0c\u9700\u8981\u5148\u4e86\u89e3\u5176\u67b6\u6784\u6d41\u7a0b\uff0c\u901a\u8fc7\u672c\u8282\u5b66\u4e60Gitlab CI\u7684\u57fa\u7840\u6982\u5ff5\u53ca\u76f8\u5173\u5143\u7d20\uff0c\u66f4\u52a0\u6709\u5229\u4e8e\u4e4b\u540e\u7684\u4e09\u7bc7\u5b9e\u6218\u7406\u89e3\uff0cGitlab CI\u57fa\u4e8e\u81ea\u52a8\u6267\u884c\u811a\u672c\uff0c\u6700\u5927\u9650\u5ea6\u7684\u51cf\u5c11\u5728\u73af\u5883\u90e8\u7f72\u53ca\u4e0a\u7ebf\u65f6\u5f15\u5165\u9519\u8bef\u7684\u53ef\u80fd\u6027\uff0c\u5f53\u4e00\u6761Gitlab CI\u96c6\u6210\u5b8c\u6210\uff0c\u4ece\u65b0\u4ee3\u7801\u7684\u5f00\u53d1\u5230\u90e8\u7f72\uff0c\u6781\u5c11\u6216\u8005\u6839\u672c\u4e0d\u9700\u8981\u4eba\u4e3a\u7684\u5e72\u9884\uff0c\u5728\u6bcf\u6b21\u5c0f\u7684\u8fed\u4ee3\u4e2d\u4e0d\u65ad\u6784\u5efa\uff0c\u6d4b\u8bd5\u548c\u90e8\u7f72\uff0c\u5c3d\u53ef\u80fd\u65e9\u7684\u8bd5\u9519\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e3a\u6700\u9002\u5408\u654f\u6377\u9ad8\u6548\u7684\u5f00\u53d1\u3002</p> <p>\u90a3\u4e48\u5982\u4f55\u5f00\u59cb\u6211\u4eec\u7684Gitlab CI\u4e4b\u65c5\u5462\uff0c\u5176\u5b9e\u4f60\u9700\u8981\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u6dfb\u52a0\u4e00\u4e2a .gitlab-ci.yml \u6587\u4ef6\uff0c\u7136\u540e\u5728\u7ec4\u6216\u8005\u9879\u76ee\u4e2d\u6ce8\u518c\u4e00\u4e2a Runner\uff0c\u5373\u53ef\u8fdb\u884c\u6301\u7eed\u96c6\u6210\uff0c\u90a3\u4e48\u4ec0\u4e48\u53c8\u662fRunner\uff0c<code>.gitlab-ci.yml</code>\u6587\u4ef6\u53c8\u8be5\u5982\u4f55\u5199\u5462\uff0c\u76f8\u4fe1\u901a\u8fc7\u672c\u7ae0\u8282\uff0c\u8bfb\u8005\u80fd\u6e05\u695a\u7684\u4e86\u89e3Gitlab CI\u7684\u67b6\u6784\u6d41\u7a0b\u53ca\u5176\u5143\u7d20\u7ec4\u4ef6\uff0c\u4e3a\u6211\u4eec\u540e\u9762\u7684\u5b9e\u6218\u505a\u597d\u5145\u5206\u7684\u51c6\u5907\u3002</p>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#_2","title":"\u4e8c \u57fa\u7840\u6982\u5ff5","text":""},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#21-gitlab-runner","title":"2.1 Gitlab-Runner","text":""},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#211-gitlab-runer","title":"2.1.1 Gitlab-Runer\u662f\u4ec0\u4e48","text":"<p>Gitlab CI\u7684\u67b6\u6784\u4e3aC/S\u6a21\u578b\uff0cGtilab\u4e3a\u670d\u52a1\u7aef\uff0c\u5176\u8d1f\u8d23\u4ee3\u7801\u7684\u6258\u7ba1\uff0cGitlab CI\u4efb\u52a1\u7684\u89e6\u53d1\u53ca\u7ed3\u679c\u65e5\u5fd7\u8bb0\u5f55\u7b49\uff0c\u771f\u6b63\u8fd0\u884c\u6211\u4eec\u5728<code>.gitlab-ci.yml</code>\u4e2d\u7684\u5b9a\u4e49\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u662f\u5728\u5ba2\u6237\u7aefGitlab-Runner\u4e0a\u6267\u884c\u7684\uff0c\u90a3\u4e48\u4ec0\u4e48\u662fGitlab-Runner\u5462\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u53f0\u8fd0\u884c\u6709Gitlab-Runner\u7684\u670d\u52a1\u5668\u6216\u4e00\u4e2a\u5bb9\u5668\uff0c\u53ea\u8981\u5b89\u88c5\u6709Gitlab-Runner\uff0c\u5e76\u4e14\u8fd9\u4e2a\u670d\u52a1\u5668\u5728Gitlab Server\u7aef\u8fdb\u884c\u6ce8\u518c\uff0c\u8fd9\u4e2aGitlab-Runner\u5c31\u53ef\u4ee5\u5728Gitlab Server\u7aef\u7684<code>.gitlab-ci.yml</code>\u4e2d\u4f7f\u7528\u6b64Runner\u6765\u6267\u884cpipeline\u4e2d\u7684stage\u3002</p>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#212-gitlab-runer","title":"2.1.2 Gitlab-Runer\u7684\u5206\u7c7b","text":"<p>\u4f5c\u4e3a\u627f\u8f7d\u5177\u4f53job\u7684\u6267\u884c\u8005\uff0cRunner\u53ef\u4ee5\u5206\u5e03\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u9488\u5bf9\u670d\u52a1\u5668\u540c\u65f6\u4e00\u53f0\u4e3b\u673a\u4e5f\u53ef\u4ee5\u8fd0\u884c\u591a\u4e2aRunner</p> <p>Gitlab-Runner\u7684\u5206\u7c7b\uff1a</p> <ul> <li>Shared Runner\uff1a\u5171\u4eab\u578bRunner\uff0c\u6240\u6709\u7684\u9879\u76ee\u5de5\u7a0b\u90fd\u53ef\u4ee5\u5229\u7528\u6b64Runner\u6765\u6267\u884cjob\u3002</li> <li> <p>Specific Runner\uff1a\u7279\u5b9a\u578bRunner\uff0c\u7531\u4e8e\u6709\u6743\u9650\u63a7\u5236\u6b64Runner\u53ea\u80fd\u4e3a\u6307\u5b9a\u7684\u9879\u76ee\u5de5\u7a0b\u670d\u52a1\u3002</p> </li> <li> <p>Group Runner\uff1a\u5982\u679c\u5c06Runner\u6ce8\u518c\u5728\u9879\u76ee\u7ec4\u91cc\u9762\uff0c\u90a3\u4e48\u8be5\u7ec4\u5185\u7684\u9879\u76ee\u53ef\u4ee5\u6307\u5b9a\u516c\u7528\u8fd9\u4e2aRunner\u3002</p> </li> <li>Locked\uff1aRunner\u7684\u4e00\u79cd\u72b6\u6001\uff0c\u6b64\u523b\u8be5Runner\u4ee5\u53ca\u5904\u4e8eLocked\u72b6\u6001\uff0c\u88ab\u7528\u9879\u76ee\u9501\u5b9a\uff0c\u4e0d\u80fd\u7528\u4e8e\u5176\u4ed6\u9879\u76ee\u6784\u5efa</li> <li>Paused\uff1aRunner\u4ee5\u53ca\u88ab\u6682\u505c\uff0c\u4e0d\u80fd\u63a5\u53d7\u4efb\u4f55Job\u4efb\u52a1\u3002</li> </ul> <p>\u4e86\u89e3\u4e86Runner\u7684\u5206\u7c7b\u548c\u72b6\u6001\uff0c\u6211\u4eec\u4e00\u8d77\u901a\u8fc7\u4e0b\u56fe\u66f4\u76f4\u89c2\u7684\u770b\u4e0bRunner</p> <p></p> <p>\u5728\u4e0a\u56fe\u4e2d\uff0c\u5f53\u7814\u53d1\u4eba\u5458\u63d0\u4ea4\u4ee3\u7801\u6216\u63d0\u4ea4Merge Request\u65f6\u5019\u89e6\u53d1Pipeline\uff0c\u7136\u540e\u901a\u8fc7Runner\u6765\u6267\u884c\uff0c\u6b64\u65f6des-server\u53ef\u4ee5\u5b89\u88c5\u90e8\u7f72\u591a\u4e2aRunner\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u90e8\u7f72\u4e00\u4e2a\u516c\u5171\u7684Runner\u670d\u52a1\u5668\uff0c\u7136\u540e\u901a\u8fc7\u8be5\u516c\u5171\u670d\u52a1\u5668\u7684Runner\u90e8\u7f72\u4ee3\u7801\u5230des-server\u4e0a\u3002</p>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#213-executor","title":"2.1.3 Executor","text":"<p>\u4e0a\u9762\u7406\u89e3\u4e86Gitlab Runner\u7684\u6982\u5ff5\u53ca\u5206\u7c7b\uff0c\u5728\u6211\u4eec\u5c06Gitlab Runner\u8fd0\u884c\u5728\u670d\u52a1\u5668\u4e0a\u540e\u9700\u8981\u5728\u5e73\u53f0\u8fdb\u884c\u6ce8\u518c\u8be5Gitlab Runner\uff0c\u6ce8\u518c\u7684\u65f6\u5019\u53ef\u4ee5\u9009\u62e9\u8be5Gitlab Runner\u7684Executor\uff0cGitlab CI\u4e3a\u4e86\u5b9e\u73b0\u5728\u4e0d\u540c\u573a\u666f\u4e0b\u8fd0\u884c\u6784\u5efa\u7684\u4efb\u52a1\uff0c\u5206\u4e3a\u5f88\u591a\u7684\u6267\u884c\u5668\u3002\u5bf9\u4e8e\u6784\u5efa\u4e00\u4e2a\u9879\u76ee\uff0c\u4e0d\u540c\u7684Executor\u652f\u6301\u4e0d\u540c\u7684\u5e73\u53f0\u4ee5\u53ca\u6267\u884c\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u6765\u4e86\u89e3\u5404\u4e2aExecutor\u7684\u9002\u5e94\u573a\u666f\uff0c\u6839\u636e\u5176\u7279\u6027\u5e76\u7ed3\u5408\u81ea\u5df1\u7684\u4e1a\u52a1\u6765\u8fdb\u884c\u9009\u62e9\u3002</p> <ul> <li>Shell\uff1aShell  Executor\u662f\u914d\u7f6e\u7684\u6700\u7b80\u5355\u7684\u6267\u884c\u5668\uff0c\u5728\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u5b89\u88c5Gitlab Runner\u540e\uff0c\u76f4\u63a5\u5c06\u5176\u6ce8\u518c\u5230Server\u7aef\u53e3\uff0c\u5e76\u4e14\u540e\u671f\u8fd0\u884c\u7684job\u6240\u9700\u7684\u6240\u6709\u4f9d\u8d56\u9879\u90fd\u9700\u8981\u624b\u52a8\u5b89\u88c5\u5728\u5b89\u88c5\u5728\u8fd9\u53f0\u6ce8\u518c\u7684\u7cfb\u7edf\u4e0a\u3002</li> <li>Docker\uff1a\u987e\u540d\u601d\u4e49\uff0c\u5229\u7528Docker \u955c\u50cf\u6765\u4f5c\u4e3aExecutor\uff0c\u5176\u80fd\u591f\u4fdd\u6301\u5e72\u51c0\u7684\u6784\u5efa\u73af\u5883\uff0c\u5e76\u4e14\u5bb9\u6613\u8fdb\u884c\u4f9d\u8d56\u7ba1\u7406(\u6784\u5efa\u9879\u76ee\u7684\u6240\u6709\u4f9d\u8d56\u9879\u90fd\u53ef\u4ee5\u653e\u5728 Docker \u6620\u50cf\u4e2d)\u3002</li> <li>Docker Machine and Docker Machine SSH\uff08autoscaling\uff09\uff1aDocker Machine \u662f Docker \u6267\u884c\u5668\u7684\u4e00\u4e2a\u7279\u6b8a\u7248\u672c\uff0c\u652f\u6301\u81ea\u52a8\u7f29\u653e\u3002 \u5b83\u7684\u5de5\u4f5c\u539f\u7406\u4e0e\u4e00\u822c\u7684 Docker \u6267\u884c\u7a0b\u5e8f\u7c7b\u4f3c\uff0c\u4f46\u4f7f\u7528\u7684\u662f Docker Machine \u7684\u6784\u5efa\u673a\u3002</li> <li>VirtualBox\uff1a\u5176\u4e3a\u8fd0\u884c\u4f7f\u7528\u865a\u62df\u673a\u4f5c\u4e3a\u6267\u884cjob\u7684\u65b9\u5f0f\uff0cGitlab CI\u63d0\u4f9b\u4e24\u4e2a\u7cfb\u7edf\u865a\u62df\u5316\u9009\u9879: VirtualBox \u548c Parallels\u3002 \u7136\u540e GitLab Runner \u8fde\u63a5\u5230\u865a\u62df\u673a\u5e76\u5728\u5176\u4e0a\u8fd0\u884c\u6784\u5efa\u7248\u672c\uff0c\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5f88\u5927\u7a0b\u5ea6 \u964d\u4f4e\u57fa\u7840\u8bbe\u65bd\u6210\u672c\u3002</li> <li>SSH\uff1a\u4e3a\u4e86\u5b8c\u6574\u6027\uff0c\u6dfb\u52a0\u4e86 SSH \u6267\u884c\u5668\uff0c\u5b83\u662f GitLab Runner \u8fde\u63a5\u5230\u4e00\u4e2a\u5916\u90e8\u670d\u52a1\u5668\uff0c\u5e76\u5728\u90a3\u91cc\u8fd0\u884c\u6784\u5efa,\u7c7b\u4f3c\u4e00\u4e2a\u8df3\u677f\u4e00\u6837\u3002</li> <li>Kubernete\uff1a\u5728\u5fae\u670d\u52a1\u76db\u884c\u7684\u4eca\u5929\uff0cKubernetes \u6267\u884c\u5668\u5141\u8bb8\u5c06\u6784\u5efa\u8fc7\u7a0b\u653e\u7f6e\u5728Kubernetes\u96c6\u7fa4\u5185\u5b8c\u6210\uff0c \u6267\u884c\u8005\u5c06\u8c03\u7528 Kubernetes \u96c6\u7fa4 API\uff0c\u5e76\u4e3a\u6bcf\u4e2a GitLab \u4f5c\u4e1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Pod \u6765\u8fd0\u884c\u6784\u5efa\u4efb\u52a1\uff0c\u6784\u5efa\u5b8c\u6210\u540e\u53bb\u91ca\u653e\u6389\u6b21POD\uff0c\u5f53\u6709\u8bf7\u6c42\u5728\u521b\u5efa\uff0c\u6b64\u4e2d\u52a8\u6001\u65b9\u5f0f\u975e\u5e38\u5229\u7528\u8d44\u6e90\u7684\u5229\u7528\u4ee5\u53ca\u73af\u5883\u4e00\u81f4\u6027\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#22-gitlab-ciyml","title":"2.2 .gitlab-ci.yml","text":"<p>\u4e86\u89e3\u4e86gitlab-runner\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u4e86\u89e3<code>.gitlab-ci.yml</code>\u4e2d\u7684\u4e2a\u5143\u7d20\u6982\u5ff5\uff0c\u4e86\u89e3\u4e86\u8fd9\u4e9b\uff0c\u540e\u671f\u901a\u8fc7\u8fd9\u4e9b\u57fa\u7840\u914d\u7f6e\uff0c\u6765\u5b8c\u6210\u590d\u6742\u9ad8\u7ea7\u7684CI\u4efb\u52a1\u3002</p>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#221-pipeline","title":"2.2.1 Pipeline","text":"<p>Pipeline\uff1a\u4e3a\u4e00\u4e2a\u6784\u5efa\u4efb\u52a1\u7684\u96c6\u5408\uff0c\u5176\u4e3a\u4e00\u6b21\u6784\u5efa\u4efb\u52a1\uff0c\u5f53\u5f00\u53d1\u4eba\u5458\u63d0\u4ea4\u4ee3\u7801\u6216Merge Request\u5408\u5e76\u7684\u65f6\u5019\u90fd\u53ef\u4ee5\u89e6\u53d1Pipeline\uff0c\u5176\u5185\u90e8\u5305\u542b\u5f88\u591a\u6d41\u7a0b\uff0c</p> <p>\u4f8b\u5982\u4f9d\u8d56\u5b89\u88c5\u3001\u7f16\u8bd1\u3001\u6d4b\u8bd5\u3001\u90e8\u7f72\u7b49\u3002</p>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#222-stages","title":"2.2.2 Stages","text":"<p>Stages\uff1a\u4e3a\u6211\u4eec\u4e0a\u9762\u63d0\u5230\u4e00\u4e2aPipeline\u4e2d\u7684\u5404\u4e2a\u6d41\u7a0b\uff0cPipeline\u4e3a\u4e00\u4e2a\u603b\u7684\u6784\u5efa\u4efb\u52a1\uff0c\u5185\u90e8\u5305\u542b\u591a\u4e2aStages\uff0cStages\u6267\u884c\u4efb\u52a1\u9700\u8981\u9075\u5faa\u4e00\u4e9b\u6d41\u7a0b\u89c4\u5219</p> <ul> <li>\u6240\u6709\u7684Stages\u90fd\u662f\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u6267\u884c\uff0c\u5f53\u7b2c\u4e00\u4e2aStages\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u5f00\u59cb\u4e0b\u4e2aStages\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff1b</li> <li>\u5f53\u5176\u4e2d\u4efb\u4f55\u4e00\u4e2aStages\u6267\u884c\u5931\u8d25\u540e\uff0c\u7531\u4e8e\u662f\u987a\u5e8f\u6267\u884c\u540e\u9762\u7684Stages\u5c06\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u8be5Pipeline\u5219\u4e3a\u5931\u8d25\u72b6\uff1b</li> <li>\u5f53\u4e00\u4e2aPipeline\u4e2d\u6240\u6709\u7684Stages\u90fd\u6210\u529f\u6267\u884c\u5b8c\u6210\u540e\uff0c\u8be5Pipeline\u72b6\u6001\u624d\u4e3a\u6210\u529f\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#223-jobs","title":"2.2.3 Jobs","text":"<p>\u6211\u4eec\u53ef\u4ee5\u7406\u89e3Pipeline\u4e3a\u4e00\u4e2a\u603b\u4f53\u7684\u5927\u4efb\u52a1\uff0c\u5b8c\u6210\u8fd9\u4e2a\u5927\u4efb\u52a1\uff0c\u9700\u8981\u5f88\u591a\u6b65\u9aa4\uff0c\u8fd9\u4e9b\u6b65\u9aa4\u5c31\u662fStages\uff0c\u6bcf\u4e2aStage\u6709\u53ef\u4ee5\u6709\u591a\u4e2ajobs\u6765\u7ec4\u6210\uff0c\u540cStages\u4e00\u6837\uff0cjobs\u7684\u8fd0\u884c\u4e5f\u9700\u8981\u9075\u5faa\u4e00\u4e9b\u6d41\u7a0b\u89c4\u5219</p> <ul> <li>\u5728\u540c\u4e00\u4e2aStage\u4e2d\u53ef\u80fd\u542b\u6709\u591a\u4e2aJob\uff0c\u8fd9\u4e9bJobs\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u5e76\u884c\u6267\u884c\uff1b</li> <li>\u4e00\u4e2aStage\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2ajob\u6267\u884c\u5931\u8d25\uff0c\u90a3\u4e48\u8be5Stage\u5931\u8d25\uff0c\u540c\u6837\u7684Pipeline\u72b6\u6001\u4e5f\u4e3a\u5931\u8d25\uff1b</li> <li>\u53ea\u6709\u5f53\u4e00\u4e2aStage\u4e2d\u7684\u6240\u6709job\u90fd\u6267\u884c\u6210\u529f\u65f6\uff0c\u8be5Stage\u624d\u4e3a\u6210\u529f\u3002</li> </ul> <p>\u4e86\u89e3\u4e86\u4e0a\u9762\u7684\u57fa\u672c\u6982\u5ff5\uff0c\u6211\u4eec\u4ee5\u56fe\u7684\u5f62\u5f0f\u518d\u6765\u56de\u987e\u4e0b\u5404\u4e2a\u6982\u5ff5\uff1a</p> <p></p> <p>\u5982\u4e0a\u56fe\uff0c\u4e00\u4e2aPipeline\u4e3a\u4e00\u6b21\u6784\u5efa\u4efb\u52a1\uff0c\u5176\u4e2d\u5305\u542b\u591a\u4e2a\u6b65\u9aa4Stage\uff0c\u4f8b\u5982\u5b89\u88c5\u4f9d\u8d56/\u6d4b\u8bd5/\u90e8\u7f72\u7b49\uff0c\u4f8b\u5982\u5728\u5b89\u88c5\u4f9d\u8d56\u4e00\u4e2aStage\u5185\u53c8\u6709\u591a\u4e2aJob\uff0c\u8fd9\u4e9bjob\u5e76\u884c\u8fd0\u884c\uff0c\u4f8b\u5982\u5b89\u88c5\u591a\u4e2a\u8f6f\u4ef6\uff0c\u8fd9\u4e9bJob\u5982\u679c\u6709\u4e00\u4e2a\u5931\u8d25\uff0c\u90a3\u4e2a\u8fd9\u4e2aStage\u5c31\u4e3a\u5931\u8d25\uff0cStage\u662f\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u6267\u884c\uff0c\u5982\u679c\u5176\u4e2d\u6709\u4e00\u4e2aStage\u72b6\u6001\u5931\u8d25\uff0c\u5219\u672c\u6b21\u6784\u5efa\u4efb\u52a1\u4e5f\u5c31\u662f\u8fd9\u4e2aPipeline\u5c31\u662f\u5931\u8d25\u7684\u3002</p>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#gitlab-cicd","title":"\u4e09 Gitlab CI/CD\u5de5\u4f5c\u6d41\u7a0b","text":"<p>\u5728\u6211\u4eec\u4e86\u89e3\u4e86Gitlab CI\u7684\u76f8\u6982\u5ff5\u540e\uff0c\u8ba9\u6211\u4eec\u6765\u5168\u5c40\u6027\u7684\u4e86\u89e3Gitlab CI/CD\u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u4ece\u56fe\u4e2d\u770b\u5230Gitlab \u7684CI/CD\u5de5\u4f5c\u6d41\u53ea\u8981\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5</p>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#31","title":"3.1 \u6821\u9a8c","text":"<p>\u5728\u8be5\u6b65\u9aa4\u4e2dGitlab \u4e3b\u8981\u5b8c\u6210CI\u529f\u80fd\uff0c</p> <ul> <li>\u5f00\u653e\u4eba\u5458\u63d0\u4ea4\u4ee3\u7801\u5230\u4e00\u4e2a\u7279\u5b9a\u7684\u5206\u652f\uff0c\u6539\u5206\u652f\u5177\u6709Gitlab CI</li> <li>Gitlab CI\u5b8c\u6574\u6784\u5efa\u5728\u5176\u4e2d\u6709\u4ee3\u7801\u626b\u63cf\uff0c\u6027\u80fd\u6d4b\u8bd5\uff0c\u5355\u5143\u6d4b\u8bd5\uff0c\u5bb9\u5668\u626b\u63cf\uff0c\u4f9d\u8d56\u626b\u63cf\u7b49</li> <li>\u5728\u5176\u4e2dGitlab\u7684\u90a3\u4e2astage\u5931\u8d25\u540e\uff0c\u9700\u8981\u5f00\u53d1\u8005\u53bb\u8fdb\u884c\u5bf9\u5e94\u4fee\u590d\uff0c\u76f4\u5230\u8be5\u5206\u652f\u7684pipeline\u90fd\u6784\u5efa\u548c\u6d4b\u8bd5\u6b63\u5e38</li> </ul>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#32","title":"3.2 \u6253\u5305","text":"<ul> <li>\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7\u5e94\u7528\u8fdb\u884c\u9884\u89c8\u5e94\u7528\uff0c\u6700\u7ec8\u5c06\u6210\u529f\u7684\u8fdb\u884c\u5236\u54c1\u7ba1\u7406</li> <li>\u901a\u8fc7\uff1aContainer Registry\u5b58\u50a8docker\u955c\u50cf</li> <li>\u901a\u8fc7\uff1aNPM Registry\u5b58\u50a8NPM\u5305</li> <li>\u901a\u8fc7Maven Repository\u5b58\u50a8Maven\u5de5\u4ef6</li> <li>\u901a\u8fc7\uff1aConan Repository\u5b58\u50a8Conan\u5305</li> </ul>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#33","title":"3.3 \u53d1\u5e03","text":"<ul> <li>\u6301\u7eed\u90e8\u7f72\uff0c\u5c06\u901a\u8fc7\u6d4b\u8bd5\u548c\u6784\u5efa\u7684\u5206\u652fmerge \u5230\u4e3b\u5206\u652f</li> <li>\u901a\u8fc7\u624b\u52a8\u786e\u8ba4\u5ba1\u6279\u90e8\u7f72\u5c06\u5e94\u7528\u90e8\u7f72\u8fdb\u5165\u6b63\u5f0f\u73af\u5883\uff0c\u8fdb\u884c\u5e94\u7528\u53d1\u5e03</li> <li>\u901a\u8fc7GitLab Pages\u90e8\u7f72\u9759\u6001\u7f51\u7ad9</li> <li>\u8fdb\u884c\u91d1\u4e1d\u96c0\u53d1\u5e03\uff0c\u8ba9\u4e00\u5b9a\u6bd4\u4f8b\u7684\u7528\u6237\u7fa4\u65b0\u529f\u80fd</li> <li>\u901a\u8fc7GitLab Releases\u589e\u52a0\u53d1\u65b0\u7684\u8bb0\u5f55</li> </ul>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#gitlab-ci","title":"\u56db Gitlab CI\u4e2d\u7684\u5173\u952e\u5b57","text":""},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#41","title":"4.1 \u5173\u952e\u5b57","text":"<p>\u5728\u4e0a\u9762\u6211\u4eec\u5168\u5c40\u7684\u4e86\u89e3Gitlab CI/CD\u7684\u5de5\u4f5c\u6d41\u7a0b\u540e\uff0c\u90a3\u4eec\u6211\u4eec\u8be5\u600e\u6837\u5f00\u59cb\u6211\u4eec\u7684CI\u4e4b\u65c5\u5462\uff0c\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5e94gitlab-ci.yml\u4e2d\u7684\u6838\u5fc3\u5173\u952e\u5b57\u9700\u8981\u6709\u975e\u5e38\u6e05\u695a\u7684\u8ba4\u8bc6\uff0c\u5728\u540e\u7eed\u5b9e\u6218\u4e2d\uff0c\u5b8c\u6210\u5177\u4f53\u7684CI\u529f\u80fd\u5168\u90e8\u90fd\u662f\u4f9d\u8d56\u4e8e\u8fd9\u4e9b\u5173\u952e\u5b57,\u5728\u6b64\u4ec5\u5217\u51fa\u4e00\u4e9b\u6211\u4eec\u7ecf\u5e38\u7528\u7684\u6838\u5fc3\u5173\u952e\u5b57\uff0c\u540e\u7eed\u5982\u679c\u6839\u636e\u5b9e\u6218\u6848\u4f8b\u6709\u81ea\u5df1\u81ea\u5b9a\u4e49\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863\u8fdb\u884c\u67e5\u9605\uff1ahttps://docs.gitlab.com/ce/ci/yaml/README.html</p> <p>\u6ce8\u610f\uff1a\u5728\u4ee5\u4e0b\u7684\u6838\u5fc3\u5173\u952e\u5b57\u4f5c\u4e3aGitlab CI\u5185\u7f6e\u7684\u4fdd\u7559\u5b57\u6bb5\uff0c\u4e0d\u80fd\u591f\u4f5c\u4e3ajob\u7684\u540d\u79f0</p> \u5173\u952e\u5b57 \u63cf\u8ff0 Stages \u5b9a\u4e49\u6784\u5efa\u4efb\u52a1\uff0c\u53ef\u4ee5\u88abjob\u6240\u5f15\u7528\uff0c\u53ef\u4ee5\u662f\u4e00\u7cfb\u5217job\u7684\u96c6\u5408 Jobs \u5b9a\u4e49\u771f\u6b63\u5b9e\u73b0\u6267\u884c\u4efb\u52a1\uff0c\u6bcf\u4e2ajobs\u5fc5\u987b\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u540d\u5b57 variables \u5728CI\u6587\u4ef6\u4e2d\u7f16\u5199\u53d8\u4e86\uff0c\u5e76\u5728job\u73af\u5883\u4e2d\u8d77\u4f5c\u7528\uff0c<code>CI_COMMIT_REG_NAME</code>\u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\uff0c\u5b83\u7684\u503c\u8868\u793a\u7528\u4e8e\u6784\u5efa\u9879\u76ee\u7684\u5206\u652f\u6216tag\u540d\u79f0\uff0c\u9664\u4e86\u5728<code>.gitlab-ci.yml</code>\u4e2d\u8bbe\u7f6e\u53d8\u91cf\u5916\uff0c\u8fd8\u6709\u53ef\u4ee5\u901a\u8fc7GitLab\u7684\u754c\u9762\u4e0a\u8bbe\u7f6e\u79c1\u6709\u53d8\u91cf\u3002 environment \u7528\u4e8e\u5b9a\u4e49job\u90e8\u7f72\u5230\u7279\u6b8a\u7684\u73af\u5883\u4e2d\u3002\u5982\u679c\u6307\u5b9a\u4e86<code>environment</code>\uff0c\u5e76\u4e14\u6ca1\u6709\u8be5\u540d\u79f0\u4e0b\u7684\u73af\u5883\uff0c\u5219\u4f1a\u81ea\u52a8\u521b\u5efa\u65b0\u73af\u5883\u3002 scripts Runner\u6267\u884c\u7684\u547d\u4ee4\u6216\u811a\u672c\uff0c\u8be5\u5173\u952e\u5b50\u4e3a\u5fc5\u9009 tags \u5e94\u7528\u6307\u5b9a\u6ce8\u518c\u5728\u8be5\u9879\u76ee\u4e0b\u7684gitlab runner\uff08\u540c\u65f6Runner\u4e5f\u8981\u8bbe\u7f6etags\uff09 except \u5728\u4e00\u4e2ajob\u4e0b\uff0c\u6307\u5b9a\u4e00\u4e2agit\u5206\u652f\u4e0d\u80fd\u6267\u884c\u6b64\u6784\u5efa\uff0c\u5982\u679c<code>only</code>\u548c<code>except</code>\u5728\u4e00\u4e2ajob\u914d\u7f6e\u4e2d\u540c\u65f6\u5b58\u5728\uff0c\u5219\u4ee5<code>only</code>\u4e3a\u51c6 only \u5728\u4e00\u4e2ajob\u4e0b\uff0c\u6307\u5b9a\u4e00\u4e2agit\u5206\u652f\u53ef\u4ee5\u6267\u884c\u6b64\u6784\u5efa when \u5b9a\u4e49\u4f55\u65f6\u5f00\u59cbjob\u3002\u53ef\u4ee5\u662f<code>on_success</code>\uff0c<code>on_failure</code>\uff0c<code>always</code>\u6216\u8005<code>manual</code> before_script \u91cd\u5199\u4e00\u7ec4\u5728\u4f5c\u4e1a\u524d\u6267\u884c\u7684\u547d\u4ee4 after_script \u5b9a\u4e49\u6b64\u4f5c\u4e1a\u5b8c\u6210\u90e8\u7f72\u7684\u73af\u5883\u540d\u79f0 cache \u5b9a\u4e49\u4e00\u7ec4\u6587\u4ef6\u5217\u8868\uff0c\u53ef\u5728\u540e\u7eed\u7684stage\u4f7f\u7528\u3002 image \u6267\u884cstage\u4f7f\u7528\u7684docker\u955c\u50cf"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#42","title":"4.2 \u793a\u4f8b","text":"<p>\u4e0a\u9762\u6211\u4eec\u4e86\u89e3\u4e86\u4e00\u4e9b\u6838\u5fc3\u7684\u5173\u952e\u5b57\uff0c\u4e0b\u9762\u8ba9\u6211\u4eec\u4ee5\u4e00\u4e2a\u524d\u7aef\u9879\u76ee\u7684\u793a\u4f8b\u6765\u66f4\u4e3a\u76f4\u89c2\u7684\u5bf9\u5173\u952e\u5b57\u8fdb\u884c\u8bf4\u660e</p> <pre><code>stages:        # \u5b9a\u4e49\u8be5pipeline\u6267\u884c\u7684stage\u6709\u4e09\u4e2a\uff0c\u7ed3\u6784\u4e3a\u5217\u8868\n  - build      # \u6784\u5efastage\n  - test       # \u6d4b\u8bd5stage\n  - deploy     # \u90e8\u7f72stage\n\nvariables:                                 # \u5b9a\u4e49\u53d8\u91cf\uff0c\u7ed3\u6784\u4e3a\u5b57\u5178\n  BASE_DIR: \"/data/frontendadmin/\"         # \u53d8\u91cf\u7684key\u4e3aBASE_DIR\uff0c value\u4e3a\u5177\u4f53\u7684\u4e3b\u8def\u5f84\n\ncache:                                  # \u5b9a\u4e49\u7f13\u5b58\n  paths:                                # \u5b9a\u4e49\u7f13\u5b58\u7684\u76ee\u5f55\uff0c\u7ed3\u679c\u4e3a\u5217\u8868\n  - node_modules/               # \u5177\u4f53\u9700\u8981\u7f13\u5b58\u7684\u8def\u5f84\n  - dist/\n\nbefore_script:                                                                              # \u5728\u5f00\u59cbjob\u4e4b\u524d\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u4e00\u822c\u7528\u6765\u521d\u59cb\u5316\u73af\u5883\u7b49\n  - cp ${BASE_DIR}.env.example ${BASE_DIR}.env\n  - yarn install\n  - yarn build\n\nbuild_job:                                      # \u5b9a\u4e49\u6784\u5efajob\u7684\u540d\u79f0\n  stage: build                              # \u5177\u4f53\u996e\u7528stages\u4e2d\u7684job\uff0c\u9700\u8981\u540d\u5b57\u4fdd\u6301\u4e00\u81f4\n  script:                                           # \u5728\u8be5job\u4e2d\u6267\u884c\u7684\u811a\u672c\n   - yarn build\n  tags:                                             # \u9009\u62e9\u4f7f\u7528\u90a3\u4e2agitlab runner\u6765\u6267\u884c\u6b64job\n    - dev\n  only:\n    - develop                                   # \u9009\u5b9a\u6539\u9879\u76eegit\u4ed3\u5e93\u4e2d\u7684develop\u5206\u652f\u8fdb\u884c\u6267\u884c\u6539job\n  when: always                              # \u65e0\u8bba\u4ec0\u4e48\u6761\u4ef6\u90fd\u6267\u884c\u6539job\n\ntest_job:                                       \n  stage: test\n  script:\n   - yarn test\n  tags:\n    - dev\n  only:\n    - develop\n  when: manual                              # \u6307\u5b9a\u9700\u8981\u624b\u52a8\u70b9\u51fb\u624d\u6267\u884c\u6539job\n\ndeploy_job:\n  stage: deploy\n  only:\n   - master                                     # \u4ec5\u5bf9master\u5206\u652f\u8fdb\u884c\u6267\u884c\u6539job\n  script:\n   - pm2 delete api || true\n   - pm2 start dist/index.js --name api\n  tags:\n    - dev\n  when: always\n</code></pre> <p>\u901a\u8fc7\u4e0a\u95e8\u8fd9\u4e2a<code>.gitlab-ci.yml</code>\u6211\u4eec\u80fd\u591f\u66f4\u52a0\u66f4\u52a0\u76f4\u89c2\u7684\u8ba4\u8bc6\u5230Gitlab CI\u4e2d\u7684\u4e00\u4e9b\u5173\u952e\u5b57\u7684\u4f5c\u7528\u548c\u6574\u4e2aCI\u6587\u4ef6\u7684\u5927\u4f53\u7ed3\u6784\uff0c</p> <p>\u5728\u8fd9\u4e2apipeline\u4e2d\uff0c\u5b9a\u4e49\u6765\u4e09\u4e2astage</p> <ul> <li>\u5728\u5168\u5c40\u5b9a\u4e49\u4e86\u73af\u5883\u53d8\u91cfBASE_DIR\uff0c\u53ef\u4ee5\u5728\u540e\u7eed\u7684job\u4e2d\u8fdb\u884c\u5f15\u7528\uff0c\u5982\u679c\u5b9a\u4e49\u5728\u67d0\u4e00\u4e2ajob\u4e2d\u5219\u53ea\u80fd\u88ab\u6539job\u5f15\u7528\uff0c\u5f15\u7528\u65b9\u5f0f:${BASE_DIR}</li> <li> <p>\u5b9a\u4e49\u4e86cache\u73af\u5883\uff0c\u7528\u6237\u4e3a\u5404job\u4e2d\u4f20\u9012\u4e00\u4e9b\u6301\u4e45\u5316\u7684\u7f13\u5b58\u6587\u4ef6,\u4f8b\u5982\u5728java\u9879\u76ee\u4e2d\u7f16\u8bd1\u7684jar/war\u5305\u7b49\u3002</p> </li> <li> <p>\u5229\u7528before_script\uff0c\u5728\u8fd0\u884cstage\u524d\u5bf9\u6211\u4eec\u90e8\u7f72\u7684\u73af\u5883\u8fdb\u884c\u4e86\u521d\u59cb\u5316</p> </li> <li> <p>build\uff1a\u4e0d\u7ba1\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u4e5f\u5c31\u662f\u603b\u662f\u5bf9\u9879\u76ee\u7684develop\u5206\u652f\u5229\u7528tag\u4e3adev\u7684gitlab runner\u8fdb\u884c\u6784\u5efa</p> </li> <li>test\uff1a\u9700\u8981\u624b\u52a8\u53bb\u70b9\u51fb\u6267\u884cjob\uff0c\u540c\u6837\u5bf9develop\u5206\u652f\u8fdb\u5229\u7528tag\u4e3adev\u7684gitlab runner\u6267\u884c\u6d4b\u8bd5</li> <li>deploy\uff1a\u603b\u662f\u5bf9master\u5206\u652f\uff0c\u5229\u7528tag\u4e3adev\u7684gitlab runner\u6267\u884c\u6539\u90e8\u7f72job</li> </ul> <p>\u4e0a\u9762\u7684\u793a\u4f8b\u662f\u4e3a\u4e86\u6211\u4eec\u4e86\u89e3\u5404\u5173\u952e\u5b57\u800c\u8bbe\u7acb\u7684\u4e00\u4e2a\u524d\u7aef\u9879\u76ee\uff0c\u5728\u540e\u9762\u7ae0\u8282\u7684\u5b9e\u6218\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u80fd\u591f\u7ed3\u5408\u5b9e\u9645\u6848\u4f8b\u6765\u66f4\u6e05\u695a\u7684\u4e86\u89e3\u6bcf\u4e00\u4e2a\u6b65\u9aa4\uff0c\u540c\u65f6\u6211\u4eec\u53ef\u4ee5\u5bf9\u81ea\u5df1\u73b0\u6709\u7684\u9879\u76ee\u7684CI\u8fdb\u884c\u62bd\u8c61\u5316\u4e3a\u5404\u4e2astage\uff0c\u81ea\u5df1\u53bb\u7f16\u5199<code>.gitlab-ci.yml</code>\u8fdb\u884c\u4e0d\u65ad\u7684\u6d4b\u8bd5\u6765\u4e86\u89e3\u5173\u952e\u5b57\u5373\u7ed3\u6784\u3002</p>"},{"location":"devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/#_3","title":"\u4e94 \u603b\u7ed3","text":"<p>\u901a\u8fc7\u8be5\u7ae0\u8282\u6211\u4eec\u80fd\u591f\u7cfb\u7edf\u7684\u5b66\u4e60\u5230gitlab\u4e2d\u7684\u5173\u952e\u7ec4\u5efa\u7684\u542b\u4e49/\u5206\u7c7b\u4ee5\u53ca<code>.gitlab-ci.yml</code>\u7684\u8bed\u6cd5\u53ca\u5173\u952e\u5b57\uff0c\u5176\u6b21\u5bf9Gitlab CI/CD\u7684\u5de5\u4f5c\u6d41\u7a0b\u6709\u4e86\u76f4\u89c2\u7684\u8ba4\u8bc6\uff0c\u901a\u8fc7\u5b9e\u4f8b\u66f4\u6e05\u695a\u76f4\u89c2\u7684\u5b66\u4e60\u5176\u4e2d\u5173\u952e\u5b57\u7684\u7528\u6237\u548cCI\u6587\u4ef6\u7684\u7ed3\u6784\u3002</p> <p>\u603b\u7ed3\u6765\u8bf4\uff0c\u60f3\u8981\u4f7f\u6211\u4eec\u7684\u9879\u76ee\u80fd\u591f\u96c6\u6210Gitlab CI\uff0c\u53ea\u9700\u8981\u5728\u9879\u76ee\u4e2d\u6ce8\u518cgitlab runner\uff0c\u5176\u6b21\u5728\u9879\u76ee\u76ee\u5f55\u4e0b\u6839\u636e\u81ea\u5df1\u4e1a\u52a1\u7f16\u5199<code>.gitlab-ci.yml</code>\u5373\u53ef\uff0c\u81f3\u6b64\u6211\u4eec\u7684\u9879\u76ee\u5df2\u7ecf\u62e5\u6709\u4e86CI\u7684\u80fd\u529b\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u4ec0\u4e48\u6837\u7684\u573a\u666f\u4e0b\u8be5\u5982\u4f55\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u7f16\u5199CI\u6587\u4ef6\u5462\uff0c\u540e\u7eed\u6211\u4eec\u5c06\u51e0\u4e2a\u5178\u578b\u7684\u5b9e\u6218\u9879\u76ee\uff0c\u4ece\u96f6\u5230\u4e00\u5b9e\u6218Gitlab CI\uff0c\u76f8\u4fe1\u901a\u8fc7\u5b9e\u6218\u5b9a\u4f1a\u5bf9\u4f60\u540e\u7eed\u7684\u9879\u76ee\u6709\u66f4\u6df1\u5c42\u6b21\u7684\u7406\u89e3\u548c\u8ba4\u8bc6\u3002</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/","title":"3.\u5b9e\u6218Gitlab CI + Supervisor \u53d1\u5e03Python\u9879\u76ee","text":""},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5728\u4e0a\u4e00\u8282\u6211\u4eec\u7cfb\u7edf\u7684\u4e86\u89e3\u4e86Gitlab CI\u7684\u6d41\u7a0b\u53ca\u5982\u679c\u5c06\u4e00\u4e2a\u9879\u76ee\u96c6\u6210CI\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u5728\u8fd9\u4e00\u8282\u8bfe\u6211\u4eec\u6765\u901a\u8fc7\u5b9e\u6218Gitlab CI\u5728Python\u9879\u76ee\u4e2d\u7684\u5e94\u7528\uff0c\u8fdb\u4e00\u6b65\u9886\u7565Gitlab CI\u7684\u9b45\u529b\u3002</p> <p>\u672c\u6b21\u9879\u76ee\u4e3a\u4e00\u4e2aPython\u7684\u9879\u76ee\uff0cPython\u9879\u76ee\u4e3a\u4eec\u90fd\u77e5\u9053\u4e0d\u9700\u8981\u53bb\u7f16\u8bd1\u548c\u6253\u5305\u3002\u6211\u4eec\u901a\u8fc7\u8fd9\u4e00\u8282\u7cfb\u7edf\u6765\u4eceGitlab Runner\u7684\u6ce8\u518c\u5230<code>gitlab-ci.yml</code>\u6587\u4ef6\u7684\u7f16\u5199\u518d\u5230\u6d4b\u8bd5\u90e8\u7f72\u4e0a\u7ebf\uff0c\u6765\u5b8c\u6574\u7684\u5b9e\u6218Pyhon\u9879\u76ee\u7684CI\u3002</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#_2","title":"\u4e8c \u601d\u8def\u89e3\u6790","text":"<p>\u6211\u4eec\u90fd\u77e5\u9053Python\u4e3a\u89e3\u91ca\u6027\u8bed\u8a00\uff0cPython \u89e3\u91ca\u578b\u8bed\u8a00\u4e0d\u9700\u8981\u7f16\u8bd1\u6253\u5305\uff0c\u81ea\u8eab\u6e90\u4ee3\u7801\u5373\u76ee\u6807\u90e8\u7f72\u6587\u4ef6\uff0c\u4f46\u662f\u5728\u90e8\u7f72\u65f6\u9700\u8981\u6ce8\u610f\u4e00\u4e9b\u5b9e\u73b0</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#21","title":"2.1 \u73af\u5883\u7ba1\u7406","text":""},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#211","title":"2.1.1 \u73af\u5883\u95ee\u9898","text":"<p>\u5982\u679c\u6211\u4eec\u6709\u591a\u4e2aPython\u9879\u76ee\uff0c\u5728\u8fd9\u4e9b\u9879\u76ee\u7684\u6784\u5efa\u4e2d\u6211\u4eec\u9700\u8981\u8fd0\u884c\u5355\u5143\u6d4b\u8bd5\uff0c\u4f46\u662f\u8fd9\u4e9b\u9879\u76ee\u7684Python\u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u4f9d\u8d56\u7684\u5e93\u7684\u7248\u672c\u4e5f\u4e0d\u4e00\u81f4\u6b64\u65f6\u6211\u4eec\u8be5\u600e\u4e48\u89e3\u51b3\u8fd9\u6837\u7684\u90e8\u7f72\u95ee\u9898\u5462\uff1f</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#212","title":"2.1.2 \u89e3\u51b3\u65b9\u6cd5","text":"<ul> <li>\u5982\u679c\u6211\u4eec\u4e3a\u4e86\u8282\u7701\u670d\u52a1\u5668\u8d44\u6e90\uff0c\u591a\u4e2a\u9879\u76ee\u5171\u7528\u4e00\u4e2a\u516c\u5171\u7684gitlab-runner\u7528\u8fd9\u53f0\u670d\u52a1\u5668\u6765\u8fdb\u884c\u4efb\u52a1\u6784\u5efa\u53d1\u5e03\uff0c\u6b64\u65f6\u9488\u5bf9Python\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528Python\u73af\u5883\u7ba1\u7406\u5de5\u5177\u4f8b\u5982anconda/virtulenv\u7b49\u6765\u8fdb\u884c\u6bcf\u4e2a\u9879\u76ee\u4e00\u4e2a\u72ec\u7acb\u7684\u73af\u5883\uff0c\u5bf9\u5176\u8fdb\u884c\u6bcf\u6b21job\u4efb\u52a1\u7684\u90e8\u7f72\u3002</li> <li>\u5f53\u7136\u5982\u679c\u670d\u52a1\u5668\u8d44\u6e90\u5145\u8db3\uff0c\u90a3\u4eec\u6211\u4eec\u5bf9\u4e8ePython\u9879\u76ee\uff0c\u53ef\u4ee5\u5728\u90e8\u7f72\u7684\u76ee\u6807\u670d\u52a1\u5668\u5b89\u88c5gitlab-runner\uff0c\u5c06\u5176\u6ce8\u518c\u5728\u9879\u76ee\u4e0b\uff0c\u76f4\u63a5\u5229\u7528\u5176\u8fdb\u884c\u5355\u73af\u5883Job\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#22","title":"2.2 \u8fdb\u7a0b\u7ba1\u7406","text":""},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#221","title":"2.2.1 \u8fdb\u7a0b\u95ee\u9898","text":"<p>\u5728\u90e8\u7f72\u76ee\u524d\u4e3b\u529b\u7684Python\u6846\u67b6\u9879\u76ee\uff0c\u4f8b\u5982Django/Flask/Tornado\u7b49\uff0c\u5982\u5c06\u9879\u76ee\u8fd0\u884c\u5728\u524d\u53f0\u6216\u5229\u7528<code>nohup &amp;</code>\u653e\u5728\u540e\u53f0\uff0cgitlab pipeline\u65e0\u6cd5\u8fdb\u884c\u9000\u51fa\u4e14\u540e\u671f\u4e0d\u4fbf\u4e8e\u6211\u4eec\u7ef4\u62a4\u7ba1\u7406\uff0c\u90a3\u6211\u4eec\u8be5\u5982\u679c\u66f4\u52a0\u4f18\u96c5\u7684\u7ba1\u7406\u542f\u52a8\u8fdb\u7a0b\u5462\uff1f</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#222","title":"2.2.2  \u89e3\u51b3\u65b9\u6cd5","text":"<ul> <li> <p>\u5bf9\u6b64\uff0c\u6709\u7684\u5c0f\u4f19\u4f34\u53ef\u80fd\u60f3\u5230\uff0c\u5f88\u7b80\u5355\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7f16\u5199\u542f\u52a8\u811a\u672c\uff0c\u4f46\u662f\u5229\u7528\u811a\u672c\u542f\u52a8\u8fdb\u7a0b\uff0c\u4e0d\u4ec5\u7f16\u5199\u811a\u672c\u8017\u65f6\u8017\u529b\u4e14\u9700\u8981\u505a\u5355\u72ec\u5bf9\u8fdb\u7a0b\u76d1\u63a7\uff0c\u4e0d\u4fbf\u4e8e\u6211\u4eec\u7edf\u4e00\u7ba1\u7406\u7ef4\u62a4\u3002</p> </li> <li> <p>\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8fdb\u7a0b\u7ba1\u7406\u7cfb\u7edfSuperviosr\u89e3\u51b3\u6b64\u75db\u70b9\uff0cSuperviosr\u4e3a\u7528Python\u8bed\u8a00\u5f00\u53d1\u5bf9\u4e00\u5957\u901a\u7528\u8fdb\u7a0b\u7ba1\u7406\u7cfb\u7edf\uff0c\u53ef\u5229\u7528pip\u6216yum\u8fdb\u884c\u5b89\u88c5\uff0c\u5176\u80fd\u5c06\u4e00\u4e2a\u666e\u901a\u5bf9\u547d\u4ee4\u884c\u8fdb\u7a0b\u53d8\u4e3adaemon\uff0c\u5e76\u76d1\u63a7\u5176\u8fdb\u7a0b\u72b6\u6001\uff0c\u53ef\u901a\u8fc7\u914d\u7f6e\u5982\u679c\u76d1\u63a7\u8fdb\u7a0b\u5f02\u5e38\u9000\u51fa\u5219\u81ea\u52a8\u5bf9\u5176\u8fdb\u884c\u91cd\u542f\uff0c\u540c\u65f6\u4e5f\u62e5\u6709web\u7ba1\u7406\u754c\u9762\u65b9\u4fbf\u7ba1\u7406\u67e5\u770b\u3002\u6765\u5b9e\u73b0\u5bf9\u90e8\u7f72\u9879\u76eestart/stop/restart/reload\u670d\u52a1\u7ba1\u7406\uff0c\u901a\u8fc7fork/exec\u7684\u65b9\u5f0f\u628a\u8fd9\u4e9b\u88ab\u7ba1\u7406\u7684\u8fdb\u7a0b\uff0c\u5f53supervisor\u7684\u5b50\u8fdb\u7a0b\u6765\u542f\u52a8\uff0c\u5b8c\u7f8e\u89e3\u51b3\u6765\u9879\u76ee\u90e8\u7f72\u5bf9\u96be\u9898\u3002</p> </li> </ul>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#23","title":"2.3 \u8f6f\u4ef6\u96c6\u6210","text":""},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#231","title":"2.3.1 \u8f6f\u4ef6\u5982\u4f55\u96c6\u6210","text":"<p>\u6211\u4eec\u77e5\u9053Jenkins\u4f5c\u4e3a\u6301\u7eed\u96c6\u6210\u7684\u5229\u5668\uff0c\u5176\u4e00\u5927\u7279\u70b9\u5c31\u662f\u4e30\u5bcc\u7684\u63d2\u4ef6\uff0c\u90a3\u4e48\u6211\u4eec\u4f7f\u7528Gitlab CI\u8be5\u5982\u4f55\u96c6\u6210\u5176\u4ed6\u8f6f\u4ef6\u5462\u3002</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#232","title":"2.3.2 \u89e3\u51b3\u65b9\u6cd5","text":"<ul> <li>\u5728Gitlab CI\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u6709\u4f7f\u7528\u5230\u5176\u4ed6\u7684\u5de5\u5177\u6216\u8f6f\u4ef6\uff0c\u53ef\u4ee5\u5728\u6ce8\u518c\u7684gitlab-runner\u4e0a\u9762\u8fdb\u884c\u5ba2\u6237\u7aef\u6216\u5de5\u5177\u7684\u5b89\u88c5\uff0c\u4e4b\u540e\u5728CI\u7684scripts\u4e2d\u5177\u4f53\u6765\u8c03\u7528gitlab-runner\u4e0a\u9762\u7684\u5de5\u5177\u6765\u5b9e\u73b0\u6211\u4eec\u7684\u5177\u4f53\u9700\u6c42\u5373\u53ef\u3002</li> <li>\u65e2\u7136Gitlab CI\u96c6\u6210\u5176\u4ed6\u8f6f\u4ef6\u662f\u5728gitlab-runner\u4e0a\u9762\uff0c\u90a3\u4e48\u5982\u679c\u6709\u9700\u6c42\u5176\u4ed6\u7cfb\u7edf\u8c03\u7528Gitlab\u7684\u63a5\u53e3\uff0c\u6216\u4f7f\u7528gitlab\u7684\u529f\u80fd\u8be5\u600e\u4e48\u529e\u5462\uff0cgitlab\u63d0\u4f9b\u4e86\u65b0\u5efa\u5e94\u7528\uff0c\u53ef\u4ee5\u5bf9\u5e94\u7528\u6388\u4e88\u7279\u5b9a\u6743\u9650\uff0c\u63a5\u7740\u521b\u5efatoken\u6765\u4f9b\u5176\u4ed6\u5e94\u7528\u8c03\u7528\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#_3","title":"\u4e09 \u67b6\u6784\u89e3\u6790","text":"<p>\u5728\u6211\u4eec\u89e3\u51b3\u4e86\u4e0a\u9762\u7684\u4e00\u4e9b\u7591\u60d1\uff0c\u5df2\u7ecf\u5bf9\u90e8\u7f72\u6709\u4e86\u6574\u4f53\u7684\u601d\u8def\u4e4b\u540e\uff0c\u6211\u4eec\u6765\u8fdb\u884c\u5177\u4f53\u7684\u5b9e\u65bd\u64cd\u4f5c</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#31","title":"3.1 \u670d\u52a1\u5668\u5217\u8868","text":"\u540d\u79f0 IP \u8f6f\u4ef6 \u5907\u6ce8 Gitlab-Server 10.57.61.253 gitlab-server Gitlab \u670d\u52a1\u5668 Gitlab-Common-Runner 10.57.61.10 gitlab-runner \u516c\u7528gitlab-runner\u670d\u52a1\u5668 Des-Server01 172.16.100.2 miniconda/supervisor \u9879\u76ee\u90e8\u7f72\u76ee\u6807\u670d\u52a1\u5668"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#32","title":"3.2 \u67b6\u6784\u56fe","text":"<p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6211\u4eec\u7684gitlab-runner\u53ef\u4ee5\u6709\u4e24\u79cd\u6a21\u5f0f</p> <ul> <li>\u4e00\u79cd\u4e3a\u516c\u5171\u7684gitlab-runner\uff1a</li> <li>\u4f18\u70b9\uff1a\u8282\u7701\u670d\u52a1\u5668\u8d44\u6e90\uff0c\u5728\u4e00\u53f0\u670d\u52a1\u5668\u90e8\u7f72gitlab-runner\uff0c\u514d\u53bb\u5728\u6bcf\u4e2a\u90e8\u7f72\u7684\u670d\u52a1\u5668\u90fd\u9700\u8981\u5b89\u88c5\u7ef4\u62a4\u5e94\u7528\u3002</li> <li>\u7f3a\u70b9\uff1a\u73af\u5883\u7ba1\u7406\u590d\u6742\uff0c\u9700\u8981\u73af\u5883\u7ba1\u7406\u8f6f\u4ef6\u914d\u5408\u4f7f\u7528\uff0c\u5982\u679c\u6b64\u670d\u52a1\u5668\u7684gitlab-runner\u6302\u6389\uff0c\u90a3\u5176\u4ed6\u7684\u4efb\u52a1\u4e5f\u4f1a\u6536\u5230\u5f71\u54cd\uff0c\u5e76\u4e14\u8fd9\u53f0\u670d\u52a1\u5668\u670d\u52a1\u5668\u9700\u8981\u4e0e\u90e8\u7f72\u7684\u76ee\u6807\u670d\u52a1\u5668\u80fd\u591f\u8fdb\u884cssh\u514d\u5bc6\u94a5\u8fdc\u7a0b\u767b\u5f55\u3002</li> <li>\u6bcf\u53f0\u90e8\u7f72\u7684\u76ee\u6807\u670d\u52a1\u5668\u90fd\u5b89\u88c5gitlab-runner\uff1a</li> <li>\u4f18\u70b9\uff1a\u6bcf\u4e2a\u670d\u52a1\u5668\u73af\u5883\u90fd\u53ea\u7ef4\u62a4\u81ea\u5df1\u7684\u73af\u5883\uff0c\u4e0d\u9700\u8981\u7ba1\u5176\u4ed6\u7684\uff0c\u5982\u679c\u5176\u4ed6gitlab-runner\u5f02\u5e38\u4e0d\u4f1a\u9020\u6210\u5176\u4ed6\u5f71\u54cd</li> <li>\u7f3a\u70b9\uff1a\u5b89\u88c5\u7e41\u7410\uff0c\u6bcf\u5929\u90e8\u7f72\u7684\u76ee\u6807\u670d\u52a1\u5668\u90fd\u9700\u8981\u5b89\u88c5\u5e76\u540e\u671f\u7ef4\u62a4\uff0c\u5982\u679cgitlab-runne\u4f17\u591a\u4f1a\u5bf9\u670d\u52a1\u7aef\u9020\u6210\u538b\u529b\u3002</li> </ul> <p>\u90a3\u4eec\u5bf9\u4e8e\u6211\u4eec\u8be5\u8fdb\u884c\u5982\u4f55\u53d6\u820d\u5462\uff0c\u5728\u8fd9\u91cc\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u53ca\u6bcf\u4e2a\u516c\u53f8\u4e0d\u540c\u4e1a\u52a1\u7ebf\u7684\u89c4\u6a21\u6765\u8861\u91cf\uff0c\u4f8b\u5982\u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u4e2a\u9879\u76ee\u7684\u591a\u6761\u90e8\u7f72\u4efb\u52a1\u5171\u7528\u4e00\u4e2a\u516c\u5171\u7684gitlab-runner\uff0c\u7136\u540e\u5bf9\u4e8e\u5176\u4ed6\u5355\u72ec\u7684\u5c11\u91cf\u7684\u76f4\u63a5\u5355\u72ec\u5b89\u88c5gitlab-runner\u6ce8\u518c\u5230\u670d\u52a1\u7aef\u3002</p> <p>\u95f2\u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u6765\u8fdb\u884c\u5b9e\u64cd\uff0c</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#_4","title":"\u56db \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#41","title":"4.1 \u524d\u671f\u51c6\u5907","text":"<ul> <li> <p>\u5177\u6709Gitlab Server</p> </li> <li> <p>Gitlab-runner\u670d\u52a1\u5668\u7684gitlab-runner\u7528\u6237\u53ef\u4ee5\u514d\u5bc6\u94a5\u767b\u5f55des-server\u670d\u52a1</p> </li> <li>\u5728gitlab-common\u670d\u52a1\u53ca\u76ee\u6807\u670d\u52a1\u5668\u5b89\u88c5\u914d\u7f6econda\u865a\u62df\u73af\u5883</li> <li>\u5728\u76ee\u6807\u670d\u52a1\u5668\u8fdb\u884csupervisor\u90e8\u7f72\u914d\u7f6e</li> </ul>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#42-gitlab-runner","title":"4.2 gitlab-runner\u5b89\u88c5\u914d\u7f6e","text":""},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#421-gitlab-runner","title":"4.2.1 gitlab-runner\u5b89\u88c5","text":"<p>\u5728gitlab-common\u670d\u52a1\u5668\u4e0a\u5b89\u88c5gitlab-runner</p> <pre><code># \u914d\u7f6eyum\u6e90\ncurl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh | sudo bash\n# \u5b89\u88c5runner\nsudo yum install -y gitlab-ci-multi-runner\n</code></pre>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#422","title":"4.2.2 \u9879\u76ee\u6743\u9650\u914d\u7f6e","text":"<p>\u9700\u8981\u9879\u76ee\u5f00\u542fpipeline\u7684\u6743\u9650\uff0c\u9700\u8981\u624b\u52a8\u5f00\u542f settings-&gt;General-&gt;Visibility, project features, permissions-&gt;Pipelines \uff0c\u53ef\u4ee5\u914d\u7f6e\u6240\u6709\u4eba\u6216\u6b64\u9879\u76ee\u7684Members\u53ef\u4ee5\u914d\u7f6e\u7ba1\u7406Pipeline\u3002</p> <p></p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#423","title":"4.2.3 \u8bb0\u5f55\u6ce8\u518c\u4fe1\u606f","text":"<p>\u5728\u6b64\u9700\u8981\u96c6\u6210Gitlab CI\u7684\u9879\u76ee\u4e2d\uff0c\u8bb0\u5f55\u6ce8\u518cRunner\u7684URL\u548ctoken\uff0cgitlab \u4e0a\u7684settings-&gt;CI/CD&gt;Runners</p> <p></p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#424","title":"4.2.4 \u670d\u52a1\u5668\u8fdb\u884c\u6ce8\u518c","text":"<p>\u5728gitlab-commo-runner\u670d\u52a1\u5668\u8fdb\u884cgitlab-runner\u7684\u6ce8\u518c,\u6b64\u5904\u6211\u4eec\u9009\u62e9\u7684Executor\u4e3ashell\uff0c\u6ce8\u610f\u5728\u6b64\u6ce8\u518c\u4e2d\u978b\u7684tags\u5728\u6211\u4eec\u540e\u9762\u7684<code>.gitlab-ci.yml</code>\u4e2d\u5c06\u4f1a\u7528\u5230\uff0c\u7528\u6765\u6307\u5b9a\u4f7f\u7528\u90a3\u4e2arunner\u6765\u8fd0\u884c\u6b64job\u3002</p> <pre><code># gitlab runner\u6ce8\u518c\u5230\u5e73\u53f0\nsudo gitlab-ci-multi-runner register\n</code></pre> <p></p> <p>\u5728\u6211\u4eec\u6ce8\u518c\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u767b\u5f55gitlab\u7684\u9879\u76ee\u4e0b\u53bb\u67e5\u770b\u5df2\u7ecf\u6ce8\u518c\u4e0a\u6765\u7684Runner\uff0c\u5728\u6b64\u6211\u4eec\u9700\u8981\u6ce8\u91cd\u8bb0\u5f55\u6211\u4eec\u7684tags\uff0c\u540e\u7eed\u5728\u6587\u4ef6\u4e2d\u5f15\u7528\u3002</p> <p></p> <p>\u81f3\u6b64\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u5c06gitlab-runner\u6ce8\u518c\u5230gitlab server\u4e0a\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u6765\u5b9e\u9645\u7f16\u5199\u9879\u76ee\u7684\u90e8\u7f72\u6587\u4ef6</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#43-ci","title":"4.3 CI\u6587\u4ef6\u7684\u7f16\u5199","text":""},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#421-gitlab-ciyml","title":"4.2.1 .gitlab-ci.yml","text":"<p>\u5728\u9879\u76ee\u4e2d\u96c6\u6210<code>.gitlab-ci.yml</code></p> <pre><code>stages:\n  - clean_env            # \u6e05\u7406\u73af\u5883\u53ca\u6740\u6b7b\u8fdb\u7a0b\n  - deploy_src           # \u90e8\u7f72\u6e90\u7801\n  - install_dependency   # \u66f4\u65b0\u4f9d\u8d56  \n  - restart_server       # \u91cd\u542f\u670d\u52a1\n  - check_server         # \u68c0\u6d4b\u670d\u52a1\n\n\nvariables:                          # \u5b9a\u4e49\u53d8\u91cf\n  BASE_DIR: \"/data/go2cloud_platform/\"\n\njob clean_env_job:          # \u6e05\u7406\u73af\u5883job\n  stage: clean_env\n  script:\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 pkill supervisord || true\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 killall /data/miniconda3/bin/python || true\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 killall /data/miniconda3/envs/go2cloud_platform/bin/python || true\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 rm -rf /project${BASE_DIR}*\n  tags:\n    - go2cloud_platform         # \u6ce8\u518c\u5728gitlab \u4e0a\u7684gitlab runner\u7684tag\n  only:\n    - dev\n  when: always\n\n\njob deploy_src_job:\n  stage: deploy_src                 # \u5c06\u9879\u76ee\u6e90\u7801\u62f7\u8d1d\u5230des\u670d\u52a1\u5668 \n  script:\n    - scp -r /home/gitlab-runner/builds/QFafrHEq/0/devops/${BASE_DIR}* root@172.16.100.2:/project${BASE_DIR}\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 cp /project/config/config.yml /project${BASE_DIR}\n  tags:\n    - go2cloud_platform\n  only:\n    - dev\n  when: always\n\n\njob install_dependency_job:\n  stage: install_dependency         # \u5b89\u88c5\u4f9d\u8d56\n  script:\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 /data/miniconda3/envs/go2cloud_platform/bin/python -m pip install -r /project${BASE_DIR}requirements/requirements.txt\n  tags:\n    - go2cloud_platform\n  only:\n    - dev   \n  when: manual                                  # \u4e3a\u624b\u52a8\u8fd0\u884c\n\n\njob restart_server_job:                 # \u542f\u52a8\u8fdb\u7a0b\n  stage: restart_server\n  script:\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 sleep 7\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 supervisord -c /etc/supervisord.conf\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 ps -ef |grep supervisord |grep -v grep\n  tags:\n    - go2cloud_platform\n  only:\n    - dev\n  when: always\n\njob check_server_job:                     # \u68c0\u67e5\u670d\u52a1\n  stage: check_server\n  script:\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 sleep 7\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 ps -ef|grep \"8088\"\n  tags:\n    - go2cloud_platform\n  only:\n    - dev\n  when: always\n</code></pre>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#432-stages","title":"4.3.2 Stages\u8be6\u89e3","text":"<p>\u5728\u6b64\u9879\u76ee\u4e2d\u6211\u4eec\u4f7f\u7528\u7684common-server\uff0c\u6574\u4e2apipeline\u5206\u4e3a\u4e94\u4e2astage</p> <ul> <li>\u6e05\u7406\u73af\u5883\uff1a\u53ef\u4ee5\u914d\u7f6e\u4e3a\u5168\u90e8\u5220\u9664\u76ee\u6807\u6e90\u4ee3\u7801\u6216\u8fd9rsync/scp\u589e\u91cf\u8986\u76d6\u5230\u76ee\u6807\u670d\u52a1\u5668\uff0c\u5982\u679c\u589e\u91cf\u90e8\u7f72\uff0c\u9700\u8981\u8003\u8651\u8fc1\u79fb\u6570\u636e\u5e93\u5230\u91cd\u590d\u6267\u884c\u3002</li> <li>\u90e8\u7f72\u6e90\u7801\uff1a\u5c06gitlab-runner\u670d\u52a1\u5668pull\u4e0b\u6765\u5230\u4ee3\u7801scp\u5230\u76ee\u6807\u670d\u52a1\u5668\u5230\u76ee\u6807\u670d\u52a1\u5668\u90e8\u7f72\u76ee\u5f55\uff0c</li> <li>\u5b89\u88c5\u4f9d\u8d56\uff1a\u6b64\u5904\u6709\u53ef\u80fd\u540e\u671f\u66f4\u65b0requirements\uff0c\u914d\u7f6e\u4e3amanual\u624b\u52a8\u53bb\u6267\u884c\u66f4\u65b0\uff0c\u5982\u679c\u6211\u4eec\u77e5\u9053\u6211\u4eec\u8fd9\u6b21\u6709\u65b0\u7684\u4f9d\u8d56\u5305\u5b89\u88c5\u65b0\u589e\u6216\u66f4\u65b0\uff0c\u624b\u52a8\u53bb\u5b89\u88c5\u3002</li> <li>\u91cd\u542f\u670d\u52a1\uff1a\u542f\u52a8\u4e3asupervisord\u670d\u52a1\uff0c\u542f\u52a8\u540e\u53ef\u4ee5\u81ea\u52a8\u542f\u52a8\u914d\u7f6e\u5230\u9879\u76ee\u670d\u52a1\u3002</li> <li>\u68c0\u6d4b\u8fdb\u7a0b\uff1a\u4e3a\u4e86\u66f4\u76f4\u89c2\u68c0\u6d4b\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u4e3a\u4eec\u5728\u6700\u540e\u68c0\u6d4b\u8fdb\u7a0b\u5224\u65ad\u90e8\u7f72\u662f\u5426\u6210\u529f\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#_5","title":"\u4e94 \u6d4b\u8bd5","text":"<p>\u5f53\u6211\u4eec\u63d0\u4ea4\u4ee3\u7801\u540e\uff0cmerge\u5230\u6211\u4eec\u5728CI\u6587\u4ef6\u4e2d\u5199\u7684dev\u5206\u652f\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u7684pipeline\u7684\u8fd0\u884c\u72b6\u6001\u3002</p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#51","title":"5.1 \u67e5\u770b\u8fd0\u884c\u7ed3\u679c","text":""},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#52-job","title":"5.2 \u67e5\u770b\u67d0\u4e2a\u5177\u4f53job","text":"<p>\u67e5\u770b\u5177\u4f53jobs\u4fe1\u606f\uff0c\u5728\u53f3\u4e0a\u89d2\u5982\u679c\u90e8\u7f72\u6709\u5f02\u5e38\uff0c\u6211\u4eec\u53ef\u4ee5\u70b9\u51fbRetry\u8fdb\u884c\u91cd\u8bd5\uff0c\u5728\u9875\u9762\u4e2d\u53ef\u4ee5\u770b\u5230\u5b9e\u65f6\u7684\u65e5\u5fd7\u4fe1\u606f\u3002</p> <p></p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#53-cicd-charts","title":"5.3 \u67e5\u770bCI/CD charts","text":"<p>charts\u76f4\u89c2\u7684\u5c55\u793a\u6765\u6784\u5efa\u5230\u6210\u529f\u53ca\u5931\u8d25\u56fe\u8868\uff0c\u4e00\u822c\u5982\u679c\u6211\u4eecCI\u6587\u4ef6\u7ecf\u8fc7\u8c03\u8bd5\u7a33\u5b9a\u4ee5\u540e\uff0c\u540e\u7eed\u5c31\u4e0d\u7528\u5173\u5fc3\u4e0a\u7ebf\u95ee\u9898\u3002</p> <p></p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#54","title":"5.4 \u6784\u5efa\u901a\u77e5","text":"<p>Gitlab CI\u7684\u6784\u5efa\u65e0\u9700\u6211\u4eecJenkins\u4e00\u6837\u53bb\u8fdb\u884c\u914d\u7f6e\uff0c\u5982\u679cGitlab \u5df2\u7ecf\u914d\u7f6e\u4e86\u90ae\u4ef6\u901a\u77e5\uff0c\u90a3\u4eec\u6211\u4eec\u5728\u6267\u884c\u5b8cpipeline\u540e\u4f1a\u6539\u9879\u76ee\u76f8\u5173\u5982\u4eba\u5458\u53d1\u9001\u6784\u5efa\u901a\u77e5\u3002</p> <p></p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#55","title":"5.5 \u65e5\u5fd7\u67e5\u770b","text":"<p>\u5728\u6784\u5efa\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u8be6\u7ec6\u770b\u6211\u4eec\u6784\u5efa\u7684\u6bcf\u4e00\u6b65\u65e5\u5fd7</p> <p></p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#56","title":"5.6 \u8fdb\u7a0b\u67e5\u770b","text":"<p>\u4e3a\u4eec\u53ef\u4ee5\u767b\u5f55\u670d\u52a1\u5668\u53bb\u67e5\u770b\u8fdb\u7a0b\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u5229\u7528Supervisor\u6765\u67e5\u770b\u8fdb\u7a0b</p> <p></p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#57-ci","title":"5.7 CI\u5fbd\u7ae0\u914d\u7f6e","text":"<p>\u4e3a\u4eec\u5728\u9879\u76ee\u4e0b\u9762\u53ef\u4ee5\u96c6\u6210CI\u7684\u5fbd\u7ae0\u65b9\u4fbf\u67e5\u770bPipeline\u7684\u6267\u884c\u72b6\u6001</p> <p>Settings-&gt; CI/CD-&gt;General pipelines -&gt; Pipeline status</p> <p></p> <p>\u5728\u9879\u76ee\u4e0b\u8fdb\u884c\u96c6\u6210</p> <p>Settings-&gt;Badges</p> <p></p>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#_6","title":"\u516d \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u8be5\u9879\u76ee\u6211\u4eec\u9700\u8981\u63d0\u524d\u51c6\u5907\u597dcommon-server\u670d\u52a1\u5668\uff0c\u9700\u8981\u5728\u5176\u4e0a\u5b89\u88c5\u4e00\u4e9b\u9700\u8981\u7684\u73af\u5883\uff1b</li> <li>\u5728\u6267\u884c\u7684\u65f6\u5019\u53ef\u80fd\u524d\u9762\u51e0\u6b21\u90fd\u662f\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5982\u679c\u5931\u8d25\u53ef\u4ee5\u8fdb\u5165\u63a7\u5236\u53f0\u8be6\u7ec6\u67e5\u770b\u65e5\u5fd7\uff1b</li> <li>\u5728common-server\u4e0a\u6267\u884c\u7684\u7528\u6237\u4e3agitlab-runner\u7528\u6237\uff0c\u5982\u679c\u4e00\u4e9b\u5de5\u5177\u6216\u547d\u4ee4\u6ca1\u6709\u6743\u9650\uff0c\u53ef\u4ee5\u5c06\u8be5\u7528\u6237\u914d\u7f6esudo\u6743\u9650\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/#_7","title":"\u4e03 \u53cd\u601d","text":"<p>\u901a\u8fc7\u8be5\u9879\u76ee\u4e3a\u4eec\u4e3a\u90e8\u7f72Python\u9879\u76ee\uff0c\u76f4\u63a5\u90e8\u7f72\u6e90\u4ee3\u5f62\u5f0f\uff0c\u6ca1\u6709\u7f16\u8bd1\u6253\u5305\u7b49\u8fc7\u7a0b\uff0c\u5728\u5176\u4e2d\u5c31\u662f\u5229\u7528\u4e86\u5c06\u65e5\u5e38\u6bcf\u6b21\u90e8\u7f72\u4f7f\u7528\u7684\u547d\u4ee4\uff0c\u8fdb\u884c\u7ec4\u7ec7\u7f16\u6392\u6210yaml\u7684stage\uff0c\u540c\u65f6\u5229\u7528\u4e86\u5df2\u7ecf\u4e8b\u5148\u5b89\u88c5\u5728common-server\u6216des-server\u4e0a\u7684\u7ba1\u7406\u5173\u952e\u8fdb\u884c\u9879\u76ee\u7684\u73af\u5883\u548c\u8fdb\u7a0b\u7ba1\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9879\u76ee\u5b9e\u9645\u60c5\u51b5\u6765\u8fdb\u884cstage\u89c4\u5212\uff0c\u4f8b\u5982\u4e00\u4e2a\u7c7b\u578b\u7684\u9879\u76ee\u5171\u7528\u4e00\u4e2agitlab-runner\uff0c\u6216\u8005\u5bf9\u73af\u5883\u6ca1\u6709\u8981\u6c42\u7684\u53ef\u4ee5\u5171\u7528\u4e00\u4e2arunner\uff0c \u5982\u679c\u4ec5\u662f\u96f6\u6563\u7684\u5355\u4e2a\u9879\u76ee\u53ef\u4ee5\u76f4\u63a5\u5c06gitlab-runner\u90e8\u7f72\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\uff0c\u5728\u6b64\u629b\u7816\u5f15\u7389\uff0c\u8bfb\u8005\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u6765\u8003\u91cf\u4fee\u6539\u3002</p> <p>\u200b       </p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/","title":"4.\u5b9e\u6218\u524d\u540e\u7aef\u9879\u76ee\u53ca\u6df7\u5408\u73af\u5883Gitlab CI","text":""},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u6211\u4eec\u4e0a\u4e00\u8282\u4ee5\u4e00\u4e2a\u7b80\u5355Python\u9879\u76ee\u793a\u4f8b\u4e3a\u6211\u4eec\u5c55\u793a\u4e86Gitlab CI\u7684\u9b45\u529b\uff0c\u5728\u5176\u4e2d\u6211\u4eec\u5df2\u7ecf\u8bb2\u89e3\u4e86Gitlab runners\u7684\u5b89\u88c5\u914d\u7f6e\u4ee5\u53ca\u76f8\u5173\u67e5\u770b\u65b9\u5f0f\u3002\u672c\u7ae0\u8282\u6211\u4eec\u6765\u5b9e\u6218Gitlab CI\u5728\u524d\u7aef\u53ca\u7f16\u5199\u6253\u5305\u5f62\u9879\u76ee\u4e2d\u7684\u5e94\u7528\uff0c\u4ee5\u53ca\u793a\u4f8b\u7b2c\u4e09\u65b9\u5de5\u5177\u7684\u96c6\u6210\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#_2","title":"\u4e8c \u5de5\u5177\u96c6\u6210","text":""},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#21-gitlab-cisonarqube","title":"2.1 Gitlab CI\u96c6\u6210SonarQube","text":"<p>\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e\u9879\u76ee\u4ee3\u7801\u8d28\u91cf\u7ba1\u7406\uff0c\u5728\u76ee\u524d\u7684\u5fae\u670d\u52a1/\u6a21\u5757\u5316/\u5feb\u8fed\u4ee3\u654f\u6377\u5f00\u53d1\u4e2d\u5982\u679c\u4ec5\u4f9d\u8d56IDE\u7b80\u5355\u68c0\u67e5\u548c\u4eba\u4e3a\u7684codereview\u5bf9\u4e8e\u5927\u91cf\u4ee3\u7801\u5f88\u4e0d\u9002\u5408\uff0c\u4e0d\u4ec5\u4ec5\u4f9d\u9760\u5f00\u53d1\u4eba\u5458\u7684\u7f16\u7801\u89c4\u8303\u7f16\u7801\uff0c\u66f4\u9700\u8981\u4e00\u4e9b\u5de5\u5177\u6765\u5e2e\u52a9\u6211\u4eec\u63d0\u524d\u9884\u9632\u548c\u5f3a\u5236\u68c0\u6d4b\u89c4\u8303\u3002\u5728\u6211\u4eec\u4ee3\u7801\u5f00\u653e\u4e2d\u6709\u4e00\u9879\u975e\u5e38\u91cd\u8981\u7684\u4e8b\u60c5\u5c31\u662f\u4ee3\u7801\u6f0f\u6d1e\u53ca\u5b89\u5168\u626b\u63cf\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06SonarQube\u4ee3\u7801\u626b\u63cf\u5373\u6210\u5728\u6211\u4eec\u7684Gitlab CI\u4e2d\uff0c\u6bcf\u6b21\u4efb\u52a1\u8dd1\u5b8c\uff0c\u53ef\u4ee5\u81ea\u5df1\u53bb\u68c0\u6d4b\u626b\u63cf\u51fa\u6765\u7684\u6f0f\u6d1e\u8fdb\u884c\u4fee\u590d\uff0c\u5728\u6b64\u6211\u4eec\u89c1\u6765\u5b9e\u8df5\u4e0bGitlab CI\u96c6\u6210SonarQube\uff0c</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#211-sonarqube","title":"2.1.1 SonarQube\u7684\u4ecb\u7ecd","text":""},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#2111","title":"2.1.1.1 \u7b80\u4ecb","text":"<p>Sonarqube \u662f\u4e00\u6b3e\u4ee3\u7801\u5206\u6790\u68c0\u6d4b\u5de5\u5177\uff0c\u5c06\u5176\u4e0e\u6211\u4eec\u7684CI/CD\u7ed3\u5408\uff0c\u4f8b\u5982\u96c6\u6210\u5230gitlab ci/cd\u6216jenkins\u4e2d\u5b9e\u73b0\u90e8\u7f72\u81ea\u52a8\u4ee3\u7801\u68c0\u67e5\uff0c\u53ca\u65f6\u53d1\u73b0\u5e76\u5904\u7406bug\uff0c\u6700\u5927\u9650\u5ea6\u7684\u5c06bug\u548c\u4e0d\u89c4\u8303\u627c\u6740\u5728\u7f16\u7801\u9636\u6bb5\uff0c\u5176\u5185\u90e8\u96c6\u6210\u5f88\u591a\u5206\u6790\u5de5\u5177\uff0c\u6bd4\u5982pmd-cpd\u3001checkstyle\u3001findbugs\u3001\u4ece\u4e03\u4e2a\u65b9\u9762\u5e2e\u6211\u4eec\u6765\u6e90\u7801\u8d28\u91cf\u7ba1\u7406\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#2112","title":"2.1.1.2 \u7279\u70b9","text":"<ul> <li>\u68c0\u67e5\u4ee3\u7801\u662f\u5426\u9075\u5faa\u7f16\u7a0b\u6807\u51c6\uff1a\u5982\u547d\u540d\u89c4\u8303\uff0c\u7f16\u5199\u7684\u89c4\u8303\u7b49\u3002</li> <li>\u68c0\u67e5\u8bbe\u8ba1\u5b58\u5728\u7684\u6f5c\u5728\u7f3a\u9677\uff1aSonarQube \u901a\u8fc7\u63d2\u4ef6 Findbugs\u3001Checkstyle \u7b49\u5de5\u5177\u68c0\u6d4b\u4ee3\u7801\u5b58\u5728\u7684\u7f3a\u9677\u3002</li> <li>\u68c0\u6d4b\u4ee3\u7801\u7684\u91cd\u590d\u4ee3\u7801\u91cf\uff1aSonarQube \u53ef\u4ee5\u5c55\u793a\u9879\u76ee\u4e2d\u5b58\u5728\u5927\u91cf\u590d\u5236\u7c98\u8d34\u7684\u4ee3\u7801\u3002</li> <li>\u68c0\u6d4b\u4ee3\u7801\u4e2d\u6ce8\u91ca\u7684\u7a0b\u5ea6\uff1a\u6e90\u7801\u6ce8\u91ca\u8fc7\u591a\u6216\u8005\u592a\u5c11\u90fd\u4e0d\u597d\uff0c\u5f71\u54cd\u7a0b\u5e8f\u7684\u53ef\u8bfb\u53ef\u7406\u89e3\u6027\u3002</li> <li>\u68c0\u6d4b\u4ee3\u7801\u4e2d\u5305\u3001\u7c7b\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a\u5206\u6790\u7c7b\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u5426\u5408\u7406\uff0c\u590d\u6742\u5ea6\u60c5\u51b5\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#2113","title":"2.1.1.3 \u7ec4\u4ef6","text":"<ul> <li>SonarQube Server\uff1asonarqube\u670d\u52a1\u7aef\uff0c\u63a5\u53d7\u5ba2\u6237\u7aef\u626b\u63cf\u62a5\u544a\u3002</li> <li>SonarQube Database\uff1aES/\u53ca\u6570\u636e\u5e93\u5f15\u64ceoracle\uff0cpostgresql\uff0cmssql\u3002</li> <li>SonarQube Plugins\uff1a\u53ef\u4ee5\u540e\u671f\u5728sonarqube\u670d\u52a1\u7aef\u5b89\u88c5\u63d2\u4ef6\u3002</li> <li>SonarQube Scanner\uff1a\u5b89\u88c5\u5728\u5ba2\u6237\u7aef\u626b\u63cf\u5de5\u5177\u3002</li> </ul> <p>\u5728\u6b64\u6211\u4eec\u7684\u91cd\u70b9\u4e3aGitlab CI\u56e0\u6b64\u5c31\u4e0d\u8fc7\u591a\u7684\u4ecb\u7ecd\u5173\u4e8eSonarQube\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u6211\u4eec\u77e5\u9053Gitlab CI\u96c6\u6210\u8f6f\u4ef6\u53ea\u9700\u8981\u5728common-server\u4e0a\u5b89\u88c5\u5de5\u5177\u6216\u8005\u5ba2\u6237\u7aef\u63a5\u53e3\uff0c\u56e0\u6b64\u5728\u6b64\u5904\u6211\u4eec\u4e3a\u4eec\u5728gitlab-common-runner\u4e0a\u9762\u5b89\u88c5SonarQube Scanner\u5373\u53ef\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#2114","title":"2.1.1.4 \u6d41\u7a0b","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86\u5982\u679c\u5c06SonarQube Scanner\u96c6\u6210\u5230Gitlab CI\u4e2d\uff0c\u8ba9\u6211\u4eec\u4ee5\u4e0b\u56fe\u66f4\u76f4\u89c2\u7684\u5f62\u5f0f\u6765\u5206\u6790\u5176\u6d41\u7a0b\u3002</p> <p></p> <p>\u5f00\u53d1\u4eba\u5458\u628a\u4ee3\u7801push\u5230SCM\uff08\u5982gitlab\uff09\uff0c\u7531\u4e8e\u9879\u76ee\u5b58\u5728<code>.gitlab-ci.yml</code>\u6587\u4ef6\u89e6\u53d1Gilab CI\uff0c\u5728\u5176\u4e2d\u7684stage\u91cc\u9762\u5b9a\u4e49\u4ee3\u7801\u626b\u63cf\u7684job\uff0c\u5728common-runner\u670d\u52a1\u5668\u4e0a\u8c03\u7528\u5df2\u7ecf\u5b89\u88c5\u597d\u7684SonarQube Scanner\u6765\u626b\u63cf\u9879\u76ee\u4ee3\u7801\uff0c\u626b\u63cf\u5b8c\u6210\u540e\u5c06\u751f\u6210\u7684xml\u62a5\u544apush\u5230SonarQube Server\u4e0a\uff0c\u6b64\u523b\u6211\u4eec\u5c31\u53ef\u4ee5\u5728SonnarQube Server\u67e5\u770b\u62a5\u544a\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#212","title":"2.1.2 \u914d\u7f6e\u90e8\u7f72","text":"<p>\u5728\u6b64SonarQube\u670d\u52a1\u7aef\u7684\u5b89\u88c5\u914d\u7f6e\u6211\u4eec\u5c31\u4e0d\u518d\u6b64\u8fc7\u591a\u7684\u7bc7\u5e45\u5c55\u5f00\uff0c\u4e3b\u8981\u96c6\u4e2d\u5728\u4e0eGitlab CI\u7684\u96c6\u6210\u8fd9\u8fb9</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#2121-sonarqube","title":"2.1.2.1 SonarQube\u9879\u76ee\u914d\u7f6e","text":"<p>Create new project-&gt;Provide a token-&gt;</p> <p></p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#2122","title":"2.1.2.2 \u8bb0\u5f55\u811a\u672c\u547d\u4ee4","text":"<p>\u5728\u6b64\u6211\u4eec\u9700\u8981\u6839\u636e\u5177\u4f53\u9879\u76ee\u4e3b\u8981\u7684\u7f16\u5199\u8bed\u8a00\u53ca\u64cd\u4f5c\u7cfb\u7edf\u6765\u9009\u62e9\u6267\u884c\u811a\u672c</p> <p></p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#2123-gitlab-ci","title":"2.1.2.3 \u4e0eGitlab CI\u96c6\u6210","text":"<pre><code> stages:\n   - sonarqube_scan                     # \u6307\u5b9a\u626b\u63cfstage\n\n job sonarqube_scan_job:\n   stage: sonarqube_scan\n   # \u6ce8\u610f\uff0c\u6b64\u7528\u6237\u4e3agitlab-runner\u6267\u884c\uff0c\u6307\u5b9a/.\u4e3a\u6b64\u9879\u76ee\u76ee\u5f55\n   script:\n     - sonar-scanner -Dsonar.projectKey=go2cloud_api_test -Dsonar.sources=/. -Dsonar.host.url=http://43.xxx.xxx.xxx:9110 -Dsonar.login=a393276xxxxxxxxxxxxxxxxxxx03004a714\n   tags:\n     - common-runner                    # \u7528\u6765\u8fd0\u884c\u626b\u63cf\u7684gitlab runner\uff0c\u8be5runner\u4e0a\u9700\u8981\u5b89\u88c5sonar-scanner\n   only:\n     - go2cloud-platform-test           # \u4ec5\u5728\u9879\u76ee\u7684\u8be5branch\u8fdb\u884c\u626b\u63cf\n   when: always\n</code></pre> <p>\u5982\u4e0a\u5c31\u5b8c\u6210\u4e86\u6211\u4eec\u7684sonarqube\u7684\u96c6\u6210\uff0c\u53ea\u9700\u8981\u5728gitlab-runner\u4e0a\u5b89\u88c5\u626b\u63cf\u5ba2\u6237\u7aef\uff0c\u5728\u6211\u4eec\u7684CI\u7684\u4e00\u4e2astage\u4e2d\u8fdb\u884c\u5f15\u7528\u5373\u53ef\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#_3","title":"\u4e09 \u524d\u540e\u7aef\u9879\u76ee","text":"<p>\u5728\u6211\u4eec\u5b9e\u9645\u7684\u9879\u76ee\u4e2d\uff0c\u4e00\u4e2a\u5177\u4f53\u7684\u9879\u76ee\u6211\u4eec\u4e00\u904d\u90fd\u662f\u524d\u540e\u7aef\u5206\u79bb\uff0c\u6b64\u65f6\u8be5\u5982\u4f55\u8fdb\u884c\u4e00\u4e2a\u9879\u76ee\u7684\u7edf\u4e00\u53d1\u5e03\uff0cgitlab CI\u5728\u524d\u7aef\u5e94\u7528\u4e2d\u53c8\u8be5\u5982\u4f55\u4f7f\u7528\uff0c\u8ba9\u6211\u4eec\u4e00\u5757\u5b9e\u8df5\u524d\u540e\u7aef\u4e1a\u52a1\u7684\u53d1\u5e03\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#31","title":"3.1 \u524d\u7aef\u9879\u76ee","text":""},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#311","title":"3.1.1 \u9879\u76ee\u5206\u6790","text":"<p>\u524d\u7aef\u9879\u76ee\u76ee\u524d\u4e3b\u6d41\u7684\u4f8b\u5982vue\uff0c\u6211\u4eec\u4ee5\u6b64\u9879\u76ee\u8fdb\u884c\u4e3e\u4f8b</p> <ul> <li>\u9996\u9009\u9700\u8981\u5728\u9879\u76ee\u5185\u81ea\u5b9a\u4e49\u6253\u5305\u7684\u76ee\u5f55\u53ca\u6253\u5305\u7684\u76f8\u5bf9\u8def\u5f84</li> </ul> <pre><code>const path = require('path')\n\nconst CaseSensitivePathsPlugin = require('case-sensitive-paths-webpack-plugin')\n\nfunction resolve(dir) {\n  return path.join(__dirname, dir)\n}\n\nmodule.exports = {\n  configureWebpack: {\n    resolve: {\n      extensions: ['.js', '.vue', '.json', '.scss', '/index.vue', '/Index.vue']\n    },\n    plugins: [\n      new CaseSensitivePathsPlugin()\n    ]\n  },\n</code></pre> <ul> <li>\u5728common-runner\u670d\u52a1\u5668\u9700\u8981\u90e8\u7f72\u5b89\u88c5\u90e8\u7f72node\uff0c\u5229\u7528npm\u6765\u6253\u5305\u524d\u7aef\u9879\u76ee</li> <li>\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u9700\u8981Web\u670d\u52a1\u5668\uff0c\u4f8b\u5982nginx\uff0c\u9700\u8981\u4e8b\u5148\u90e8\u7f72\u597d\uff0c\u5e76\u5b9a\u4e49\u597dweb\u76ee\u5f55\uff0c\u5c06\u6211\u4eec\u7f16\u8bd1\u6253\u5305\u597d\u7684\u9759\u6001\u6587\u4ef6\u53d1\u5e03\u4e0a\u53bb\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e3aweb\u670d\u52a1\u5668\u7684\u7f51\u7ad9\u6570\u636e\u76ee\u5f55\u505a\u4e00\u4e2a\u94fe\u63a5\uff0c\u4e4b\u540e\u5229\u7528rsync\u5c06\u6bcf\u6b21\u7f16\u8bd1\u597d\u7684\u6587\u4ef6\u540c\u6b65\u5230\u76ee\u6807\u76ee\u5f55\uff0c\u5b9e\u73b0\u9759\u6001\u6587\u4ef6\u7684\u53d1\u5e03\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#312","title":"3.1.2 \u67b6\u6784\u56fe","text":"<p>\u6b64\u5904\u4e3a\u4eec\u4f8b\u5982\u5171\u7528\u8fd9\u4e2acomm-runner\u6765\u505a\u4ee3\u7801\u626b\u63cf\u5e76\u5229\u7528\u5728\u5176\u4e0a\u5b89\u88c5\u7684node\u73af\u5883\u8fdb\u884c\u524d\u7aef\u9879\u76ee\u6253\u5305\uff0c\u6700\u7ec8\u5c06\u6253\u5305\u597d\u7684\u9759\u6001\u6587\u4ef6rsync\u5230\u76ee\u6807\u670d\u52a1\u5668nginx\u7684web\u76ee\u5f55\u4e0b\u3002</p> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u5b89\u88c5node\uff0c\u5728\u76ee\u6807\u670d\u52a1\u5668\u6253\u5305\u7136\u540ersync\u5230nginx\u7684web\u76ee\u5f55\u4e0b\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#313-ci","title":"3.1.3 \u96c6\u6210CI","text":"<p>\u5728\u6b64\u8fd9\u4e2a\u524d\u7aef\u9879\u76ee\u4e2d\u521a\u597d\u6211\u4eec\u4e5f\u987a\u4fbf\u6f14\u793a\u4e0bSonarQube\u7684\u96c6\u6210\uff0c\u5c06\u5176\u4f5c\u4e3a\u4e00\u4e2astage\uff0c\u8ba9\u6211\u4eec\u76f4\u63a5\u6765\u5f00\u59cb\u770b<code>.gitlab-ci.yml</code>\u6587\u4ef6</p> <pre><code>stages:\n  - sonarqube_scan        # \u4ee3\u7801\u626b\u63cf\n  - deploy_src                  # \u6253\u5305\u90e8\u7f72\n  - check_server                # \u670d\u52a1\u68c0\u6d4b\n\nvariables:\n  RUNNER_HOME: \"/home/gitlab-runner/builds/1sWu8AdN/0/devops\"\n  BASE_DIR: \"/smartms_frontendadmin/\"\n\njob sonarqube_scan_job:\n  stage: sonarqube_scan\n  script:\n    - sonar-scanner -Dsonar.projectKey=smartms_frontendadmin_test -Dsonar.sources=. -Dsonar.host.url=http://43x.xx.xx.xx -Dsonar.login=a3932xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx714           # \u4ee3\u7801\u626b\u63cf\n  tags:\n    - smartms-frontend-test\n  only:\n    - develop\n  when: always\n\njob deploy_src_job:\n  stage: deploy_src\n  cache:\n    paths:\n    - node_modules/\n  script:\n    - cnpm install                                          # \u5b89\u88c5\u4f9d\u8d56\n    - cnpm install vue-cli\n    - cnpm run build                                        # \u6784\u5efa\n    - rsync -az --delete ${RUNNER_HOME}${BASE_DIR}dist/ root@172.15.100.2:/data/dist/           # \u540c\u6b65\u6587\u4ef6\n  tags:\n    - smartms-frontend-test\n  only:\n    - develop\n  when: always\n\njob check_server_job:\n  stage: check_server\n  script:\n    - ssh -o stricthostkeychecking=no root@172.16.100.2 ps -ef|grep \"nginx\"                 # \u68c0\u6d4b\u8fdb\u7a0b\n  tags:\n    - smartms-frontend-test\n  only:\n    - develop\n  when: always\n</code></pre> <p>\u5728\u6b64\u524d\u7aef\u9879\u76ee\u4e2d\u6211\u4eec\u8fdb\u884c\u4e86\u4e09\u4e2a\u5927\u7684\u6b65\u9aa4\uff0c</p> <ul> <li>\u4ee3\u7801\u626b\u63cf\uff1a\u5229\u7528\u96c6\u6210\u7684sonar-scanner\u6765\u5bf9\u4ee3\u7801\u8fdb\u884c\u626b\u63cf\uff0c\u5c06\u62a5\u544a\u53d1\u9001\u81f3\u670d\u52a1\u7aef\u3002</li> <li>\u6253\u5305\u90e8\u7f72\uff1a\u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86cache\u76ee\u5f55\u4e3a<code>node_modules</code>\u4e3a\u7f13\u5b58\u76ee\u5f55\uff0c\u4e4b\u540e\u5229\u7528cnpm\u5bf9\u6211\u4eec\u7684\u9879\u76ee\u8fdb\u884c\u6253\u5305\uff0c\u6700\u540e\u5229\u7528rsync\u5c06\u751f\u6210\u597d\u7684\u9759\u6001\u6587\u4ef6\u4ece\u90a3\u4e2adist/ \u76ee\u5f55\u540c\u6b65\u5230\u76ee\u6807\u7684nginx\u670d\u52a1\u5668\u7684web\u76ee\u5f55\u4e0b\u8fdb\u884c\u53d1\u5e03\u3002</li> <li>\u670d\u52a1\u68c0\u6d4b\uff1a\u6211\u4eec\u5728common-runner\u670d\u52a1\u5668\u4e0a\u68c0\u6d4b\u76ee\u6807\u670d\u52a1\u5668nginx\u662f\u5426\u8fd0\u884c\u6b63\u5e38\u3002</li> </ul> <p>\u5f53\u7136\u5728\u5176\u4e2d\u53ef\u4ee5\u9488\u5bf9\u6700\u8fd1\u7684\u4e1a\u52a1\u8fdb\u884c\u66f4\u8be6\u7ec6\u7684\u914d\u7f6e\uff0c\u4f8b\u5982\u5355\u5143\u6d4b\u8bd5\uff0c\u901a\u77e5\u7b49\u90fd\u53ef\u4ee5\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002\u6211\u4eec\u5728\u53d1\u5e03\u5b8c\u6210\u540e\u53ef\u4ee5\u901a\u8fc7\u9489\u9489\u673a\u5668\u4eba\u6216\u8005\u4f01\u4e1a\u5fae\u4fe1\u6d88\u606f\u901a\u77e5\u76f8\u5173\u4eba\u5458\uff0c\u5982\u679c\u6709\u76d1\u63a7\u5de5\u5177\uff0c\u540c\u6837\u53ef\u4ee5\u5c06\u6784\u5efa\u7684\u76f8\u5173\u6570\u636e\u6307\u6807\u53d1\u9001\u81f3\u76d1\u63a7Server\u7aef\u53e3\uff0c\u6765\u8fdb\u884c\u544a\u8b66\u901a\u77e5\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#313","title":"3.1.3 \u6d4b\u8bd5","text":"<ul> <li>\u67e5\u770bpipeline\u8fd0\u884c\u72b6\u6001</li> </ul> <ul> <li>\u67e5\u770b\u6253\u5305\u90e8\u7f72\u7684stage</li> </ul> <ul> <li>\u6700\u7ec8\u4e3a\u4eec\u53ef\u4ee5\u6d4f\u89c8\u5668\u8bbf\u95ee\u6211\u4eec\u7684nginx\u8fdb\u884c\u9875\u9762\u6d4b\u8bd5\uff0c\u6700\u5927\u7a0b\u5ea6\u7684\u9690\u85cf\u4e86\u90e8\u7f72\u7684\u7ec6\u8282\uff0c\u4e0d\u7528\u5173\u7cfb\u6bcf\u6b21\u90e8\u7f72\u53d1\u5e03\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#32","title":"3.2 \u540e\u7aef\u9879\u76ee","text":""},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#321","title":"3.2.1 \u9879\u76ee\u5206\u6790","text":"<p>\u540e\u9879\u76ee\u4f8b\u5982\u4e4b\u524d\u4e3a\u4eec\u53d1\u5e03\u7684Python\u662f\u4ee5\u6e90\u7801\u7684\u65b9\u5f0f\uff0c\u5728\u6b64\u4e3a\u4eec\u4ee5Java\u9879\u76ee\u4e3a\u4f8b\uff0c\u9700\u8981\u6253\u5305\uff0c\u6700\u7ec8\u53d1\u5e03\u5230\u76ee\u6807\u670d\u52a1\u5668\u3002</p> <ul> <li>\u9700\u8981\u5728\u4e2d\u8f6c\u670d\u52a1\u5668\u8fdb\u884c\u6253\u5305\u5de5\u5177\u7684\u5b89\u88c5\uff0c\u5728\u6b64\u6211\u4eec\u4ee5gradlew \u4e3a\u4f8b,\u9700\u8981\u63d0\u524d\u5728common-runner\u4e0a\u9762\u5b89\u88c5\u90e8\u7f72\u8be5\u5de5\u5177\u3002</li> <li>\u5728\u76ee\u6807\u670d\u52a1\u5668\u9700\u8981\u5982\u679c\u4e3awar\u5305\uff0c\u9700\u8981\u63d0\u4ea4\u5b89\u88c5\u90e8\u7f72tomcat\u7b49web\u670d\u52a1\uff0c\u5982\u679c\u4e3ajar\u5305\u5219\u53ef\u4ee5\u7f16\u5199\u811a\u672c\u6216\u5229\u7528supervisor\u6765\u7ba1\u7406\u8fdb\u7a0b\u8d77\u505c\u3002</li> <li>\u540e\u7aef\u9879\u76ee\u9700\u8981\u80fd\u591f\u6b63\u8fde\u63a5\u6570\u636e\u5e93\uff0c\u6211\u4eec\u76ee\u6807\u670d\u52a1\u5668\u9700\u8981\u80fd\u591f\u6b63\u5e38\u8bbf\u95ee\u6570\u636e\u5e93\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#322","title":"3.2.2 \u67b6\u6784\u56fe","text":"<p>\u5728\u6b64\u5904\u6211\u4eec\u5171\u7528\u8fd9\u4e2acomm-runner\u6765\u505a\u53d1\u5e03\uff0c\u9700\u8981\u5728common-runner\u670d\u52a1\u5668\u4e0a\u90e8\u7f72java\u9879\u76ee\u7684\u6253\u5305\u5de5\u5177\uff0c\u6700\u7ec8\u5c06\u751f\u6210\u7684\u5236\u54c1rsync\u5230\u76ee\u6807\u670d\u52a1\u5668\u4e0a\uff0cwar\u5305\u53ef\u4ee5\u53d1\u5e03\u5230tomcat\u7684webapp\u76ee\u5f55\u4e0b\uff0cjar\u5305\u53ef\u4ee5\u5b9e\u5148\u6307\u5b9a\u6570\u636e\u76ee\u5f55\uff0c\u6700\u7ec8\u91cd\u542ftomcat\u6216\u5229\u7528supervisor\u6765\u7ba1\u7406\u8fdb\u7a0b\u3002</p> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u5b89\u88c5\u6253\u5305\u5de5\u5177\uff0c\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e4b\u95f4\u8fdb\u884c\u53d1\u5e03\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#323-ci","title":"3.2.3 \u96c6\u6210CI","text":"<pre><code>variables:\n  APP_NAME: cmserver                # \u5b9a\u4e49app\u540d\u79f0\n\nbuild:dev:\n  stage: build-src                  # \u90e8\u7f72\u7684dev\u73af\u5883\n  script:\n    - ./gradlew build -x test\n    - scp ./build/libs/$APP_NAME.jar ubuntu@172.16.100.3:/tmp\n    - ssh ubuntu@172.16.100.3 /etc/init.d/$APP_NAME stop\n    - ssh ubuntu@172.16.100.3 cp -a /tmp/$APP_NAME.jar /opt/$CI_PROJECT_PATH/\n    - ssh ubuntu@172.16.100.3 /etc/init.d/$APP_NAME start\n  tags:\n    - common-runner\n  only:\n    - dev                                       # \u6839\u636e\u6b64\u9879\u76ee\u7684dev\u5206\u652f\u8fdb\u884c\u53d1\u5e03\n  when: manual                          # \u9700\u8981\u4eba\u624b\u5de5\u786e\u8ba4\n\nbuild:test:\n  stage: build-src                  # \u90e8\u7f72\u7684dev\u73af\u5883\n  script:\n    - ./gradlew build -x test\n    - scp ./build/libs/$APP_NAME.jar ubuntu@192.168.201.118:/tmp\n    - ssh ubuntu@172.16.100.34 /etc/init.d/$APP_NAME stop\n    - ssh ubuntu@172.16.100.34 cp -a /tmp/$APP_NAME.jar /opt/$CI_PROJECT_PATH/\n    - ssh ubuntu@172.16.100.34 /etc/init.d/$APP_NAME start\n  tags:\n    - common-runner\n  only:\n    - test                                  # \u6839\u636e\u6b64\u9879\u76ee\u7684dev\u5206\u652f\u8fdb\u884c\u53d1\u5e03\n\n\npublish-api-docs:\n  stage: deploy-doc                 # \u53d1\u5e03\u6587\u6863\n  script:\n    - ./gradlew asciidoctor\n    - scp build/asciidoc/html5/*.html root@172.16.100.7:/var/www/html/docs/$CI_PROJECT_PATH\n  tags:\n    - common-runner                 \n  only:\n    - dev                                       # dev\u5206\u652f\u8fdb\u884c\u6587\u6863\u53d1\u5e03\n</code></pre> <p>\u5728\u901a\u8fc7\u4e0a\u9762\u90e8\u7f72\u5185\u5bb9\uff0c\u6211\u4eec\u80fd\u591f\u770b\u5230\u8be5build\u5206\u4e3a\u4e86\u4e24\u4e2a\u73af\u5883\uff0c\u5bf9\u4e8e\u591a\u73af\u5883\uff0c\u6211\u4eec\u6307\u5b9adev\u5206\u652f\u81ea\u52a8\u53d1\u5e03\u5230dev\u73af\u5883\u4e2d\uff0c\u5bf9\u4e8e\u6d4b\u8bd5\u73af\u5883\u9700\u8981\u624b\u5de5\u786e\u8ba4\u53d1\u5e03\u5230test\u73af\u5883\uff0c\u540c\u65f6\u5bf9\u4e8edev\u73af\u5883\u81ea\u52a8\u53d1\u5e03\u6587\u6863\u3002</p> <p>\u5728\u5176\u4e2d\u5c06\u53d1\u5e03\u7684\u4e00\u4e9b\u4e86\u64cd\u4f5c\u5199\u5728\u4e86\u4e00\u4e2astage\u4e2d\uff0c\u6b64\u79cd\u65b9\u6cd5\u6709\u5229\u6709\u5f0a</p> <ul> <li>\u4f18\u70b9\uff1a\u5982\u679c\u53d1\u5e03\u591a\u73af\u5883\uff0c\u7531\u4e8e\u5728\u96c6\u6210Gitlab CI\u53ea\u80fd\u5728<code>.gitlab-ci.yml</code>\u4e00\u4e2a\u6587\u4ef6\u4e2d\u7f16\u5199\uff0c\u5c06stage\u5199\u7684\u592a\u591a\u4e0d\u5229\u4e8e\u591a\u73af\u5883\u7684\u53d1\u5e03\u7ba1\u7406</li> <li>\u7f3a\u70b9\uff1a\u5c06\u6240\u6709job\u64cd\u4f5c\u5199\u5728\u4e00\u4e2astage\u91cc\u9762\u6ca1\u6709\u66f4\u4e3a\u6df7\u6dc6\uff0c\u4e0d\u4fbf\u4e8e\u76f8\u5173\u4eba\u5458\u67e5\u770bjob\u3002</li> </ul> <p>\u5bf9\u6b64\u6211\u4eec\u53ef\u4ee5\u6298\u4e2d\uff0c\u5bf9\u4e8e\u591a\u73af\u5883\u5c3d\u53ef\u80fd\u51cf\u5c11stage\uff0c\u8fd9\u6837\u5229\u4e8e\u591a\u73af\u5883\u7684\u7ba1\u7406\uff0c\u5982\u679c\u4e3a\u5355\u4e00\u73af\u5883\u53ef\u4ee5\u5c06stage\u62c6\u89e3\u5f00\u6765\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#324","title":"3.2.4 \u6d4b\u8bd5","text":"<ul> <li>\u67e5\u770bjob\u8fd0\u884c</li> </ul> <ul> <li>\u67e5\u770b\u670d\u52a1</li> </ul>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#ci","title":"\u56db \u6df7\u5408\u73af\u5883CI","text":""},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#41","title":"4.1 \u9879\u76ee\u80cc\u666f","text":"<p>\u5f53\u4e0d\u540c\u9879\u76ee\u7ec4\u8fdb\u884c\u6d4b\u8bd5\u73af\u5883\u96c6\u6210\uff0c\u76ee\u524d\u9047\u5230\u4e86dev\u73af\u5883\u5728\u4e00\u53f0\u5355\u72ec\u7684\u4e91\u670d\u52a1\u5668\uff0c\u4f46\u662ftest\u73af\u5883\u5728k8s\u4e2d\uff0c\u5229\u7528gitlab ci\u5b9e\u73b0\u6301\u7eed\u96c6\u6210\uff0c\u7b80\u5355\u5feb\u901f\u9ad8\u6548\u4e0a\u7ebf\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u7684Gitlab CI\u8be5\u5982\u4f55\u5b9e\u73b0\u5462\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#42","title":"4.2 \u4e0a\u7ebf\u6d41\u7a0b","text":"<p>\u9996\u5148\u63d0\u4ea4\u81ea\u5df1\u7684\u4ee3\u7801merge\u5230dev\u73af\u5883\u540edev\u7684gitlab ci pipeline\u81ea\u52a8\u6784\u5efa\u90e8\u7f72\u5230\u6d4b\u8bd5\u73af\u5883\uff0c\u6784\u5efa\u6210\u529f\u540e\uff0c\u5148\u5728\u6d4b\u8bd5\u73af\u5883\u8fdb\u884c\u529f\u80fd\u6d4b\u8bd5\u53cabug fix\uff0c\u5f85\u4e00\u4e2a\u5927\u7248\u672c\u529f\u80fd\u5b8c\u6210\u540e\u5c06dev merge\u5230master\u5206\u652f\uff0cmaster\u6267\u884cmaster\u5206\u652f\u7684gitlab ci pipeline\uff0c\u8fdb\u884c\u6b63\u5f0f\u73af\u5883k8s\u7684\u6784\u5efa\u90e8\u7f72\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#43","title":"4.3 \u73af\u5883\u5dee\u5f02","text":"<p>\u76ee\u524d\u5728\u9879\u76ee\u4e0b\u6ce8\u518c\u4e86\u4e24\u4e2agitlab runner\u6765\u5206\u522b\u6267\u884c\u4e0d\u901a\u5206\u652f\u7684ci\u4efb\u52a1</p> <ul> <li>\u4e24\u4e2a\u4e0d\u540c\u7684runner\u8d1f\u8d23\u6267\u884c\u4e0d\u540c\u73af\u5883\u7684ci job\uff0c\u76ee\u524d\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883\u5229\u7528\u7684\u662f\u4e0ek8s\u7684node\u8282\u70b9\u7f51\u7edc\u53ef\u4ee5\u4e92\u901a\u7684\u4e91\u670d\u52a1\u5668\uff0c\u540e\u7eed\u53ef\u4ee5\u6539\u8fdb\u4e3a\u8fd0\u884c\u5728K8s\u4e2d\u7684POD\u5f62\u5f0f\uff0c\u53ef\u4ee5\u6765\u5e76\u53d1\u6267\u884c\uff0c\u4e14\u53ef\u4ee5\u4fdd\u8bc1\u73af\u5883\u4e00\u81f4\u6027\u3002 \u6ce8\u610f\u26a0\ufe0f\uff1arunner\u6ce8\u518c\u4e3agitlab-runner\u7528\u6237\uff0c\u9700\u8981\u5207\u6362\u5230\u6b64\u7528\u6237\u8fdb\u884ck8s\u6b63\u5f0f\u73af\u5883\u8bbf\u95ee\u3002</li> </ul> <p></p> <ul> <li>\u73af\u5883\u53d8\u91cf\u6ce8\u5165\uff0c\u4e3a\u4e86\u907f\u514d\u654f\u611f\u4fe1\u606f\u66b4\u9732\u5728\u4ee3\u7801\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5c06harbor\u4ed3\u5e93\u767b\u5f55\u4fe1\u606f\u53cakubeconf\u7b49\u654f\u611f\u4fe1\u606f\u5229\u7528gitlab ci \u7684\u73af\u5883\u7ba1\u7406\u6765\u8fdb\u884c\u6ce8\u5165</li> </ul> <p></p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#44-ci","title":"4.4 \u96c6\u6210CI","text":"<pre><code>stages:\n  - deploy_src_dev                      # \u90e8\u7f72\u6e90\u7801\u5230dev\u73af\u5883\n  - install_dependency_dev      # \u5b89\u88c5\u4f9d\u8d56\n  - restart_server_dev              # \u91cd\u542f\u670d\u52a1\n  - deploy_static_src_dev           # \u90e8\u7f72\u9759\u6001\u6587\u4ef6\n  - check_server_dev                    # \u68c0\u6d4b\u670d\u52a1\n  - deploy_src_test                     # \u90e8\u7f72\u6e90\u7801\u5230test\u73af\u5883\n  - build_image_test                    # build docker\u955c\u50cf\n  - deploy_k8s_test                     # \u90e8\u7f72\u8fdbk8s\n  - check_k8s_test                      # \u68c0\u6d4b\u670d\u52a1\n\n\nvariables:\n  DEV_RUNNER_HOME: \"/home/gitlab-runner/builds/ZxxxxxxxC/0/devops\"\n  PROD_RUNNER_HOME: \"/home/gitlab-runner/builds/FKxxxxxF/0/devops\"\n  BASE_DIR: \"/sxxxxxxxps/\"\n  APP_NAME: \"smartcs_ops\"\n  PROJECET_NAME: \"devops\"\n\n\nbefore_script:\n  - export APP_TAG=\"${CI_COMMIT_TAG:-${CI_COMMIT_SHA::8}}\"                  # \u5b9a\u4e49Docker \u7684tag\n\njob deploy_src_test_job:\n  stage: deploy_src_dev\n  script:\n    - sudo rsync -az --delete ${DEV_RUNNER_HOME}${BASE_DIR}/ /opt${BASE_DIR}            # \u540c\u6b65\u6587\u4ef6\n  tags:\n    - smartops-opsaudit\n  only:\n    - dev\n  when: always\n\n\njob install_dependency_test_job:\n  stage: install_dependency_dev\n  script:\n    - sudo /opt/py3/bin/python -m pip install -r /opt${BASE_DIR}requirements/requirements.txt           # \u5b89\u88c5\u4f9d\u8d56\n    - sudo \\cp -rf /opt/config/config.yml /opt${BASE_DIR}/cfg/          # \u62f7\u8d1d\u914d\u7f6e\u6587\u4ef6\n    - sudo mkdir -p /opt${BASE_DIR}/tmp\n  tags:\n    - smartops-opsaudit\n  only:\n    - dev\n  when: always\n\n\njob restart_server_test_job:\n  stage: restart_server_dev\n  script:\n    - sudo /opt/py3/bin/supervisorctl restart all               # \u5229\u7528supervisor\u7ba1\u7406dev\u73af\u5883\u8fdb\u7a0b\n  tags:\n    - smartops-opsaudit\n  only:\n    - dev\n  when: always\n\n\njob deploy_static_src_test_job:\n  stage: deploy_static_src_dev\n  script:\n    - sudo mkdir /opt/smartcs-ops/data/ops-audit\n    - sudo \\cp -rf /opt/smartcs-ops/data/static/ /opt/smartcs-ops/data/ops-audit            # \u540c\u6b65\u6587\u4ef6\n  tags:\n    - smartops-opsaudit\n  only:\n    - dev\n  when: always\n\n\njob check_server_test_job:\n  stage: check_server_dev\n  script:\n    - sudo /opt/py3/bin/supervisorctl status                # \u5229\u7528supervisor\u7ba1\u7406\u8fdb\u7a0b\n  tags:\n    - smartops-opsaudit\n  only:\n    - dev\n  when: always\n\n\njob deploy_src_test_job:\n  stage: deploy_src_test\n  script:\n    - sudo rsync -az --delete ${PROD_RUNNER_HOME}${BASE_DIR}/ /opt${BASE_DIR}           # \u540c\u6b65\u9759\u6001\u6587\u4ef6\n    - sudo \\cp -rf /opt${BASE_DIR}apps/static /opt${BASE_DIR}data\n    - sudo mkdir /opt${BASE_DIR}data/ops-audit\n    - sudo \\cp -rf /opt${BASE_DIR}data/static/ /opt${BASE_DIR}data/ops-audit\n  tags:\n    - smartcs-ops-prod\n  only:\n    - master\n  when: always\n\n\njob build_image_test_job:\n  stage: build_image_test\n  script:\n    - sudo chmod +x entrypoint.sh run_server.py\n    - sudo docker build -t ${HARBOR_REGISTRY}/${PROJECET_NAME}/${APP_NAME}:${APP_TAG} .         # \u5236\u4f5c\u955c\u50cf\n    - sudo echo \"${HARBOR_PASSWORD}\" | docker login ${HARBOR_REGISTRY} -u \"${HARBOR_USERNAME}\" --password-stdin # \u767b\u5f55dockerhub\n    - sudo docker push ${HARBOR_REGISTRY}/${PROJECET_NAME}/${APP_NAME}:${APP_TAG}                       # \u63a8\u9001\u955c\u50cf\n  tags:\n    - smartcs-ops-prod\n  only:\n    - master\n  when: always\n\n\njob deploy_k8s_test_job:\n  stage: deploy_k8s_test\n  script:\n    - '[ -n \"${KUBE_CONFIG_CONTENT}\" ] &amp;&amp; mkdir -p \"${HOME}/.kube\" &amp;&amp; echo \"${KUBE_CONFIG_CONTENT}\" &gt; \"${HOME}/.kube/config\"'                       # \u5728\u6b64\u4e3a\u5c06\u6ce8\u5165\u7684kubeconfig\u6587\u4ef6\u751f\u6210\u6587\u4ef6\n    - sudo grep -E \"^[[:space:]]+image:\" deploy-prod/*-deployment.yml |awk '{print $2}' |head -1            # \u83b7\u53d6\u8001\u7684\u955c\u50cf\n    - sudo sed -i \"s@$(grep -E \"^[[:space:]]+image:\" deploy-prod/*-deployment.yml |awk '{print $2}' |head -1)@${HARBOR_REGISTRY}/${PROJECET_NAME}/${APP_NAME}:${APP_TAG}@g\" deploy-prod/*-deployment.yml            # \u66ff\u6362\u4e3a\u65b0\u955c\u50cf\n    - kubectl apply -f deploy-prod/.                    # \u90e8\u7f72\u8fdbk8s\n  tags:\n    - smartcs-ops-prod\n  only:\n    - master\n  when: always\n\n\njob check_backend_test_job:\n  stage: check_k8s_test\n  script:\n    - kubectl rollout status -w --timeout=120s deployment/smartcs-ops-backend           # \u68c0\u6d4brollout\u662f\u5426\u5b8c\u6210\n  tags:\n    - smartcs-ops-prod\n  only:\n    - master\n  when: always\n\n\njob check_celery_test_job:\n  stage: check_k8s_test\n  script:\n    - kubectl rollout status -w --timeout=120s deployment/smartcs-ops-celery\n  tags:\n    - smartcs-ops-prod\n  only:\n    - master\n  when: always\n\n\njob check_beat_test_job:\n  stage: check_k8s_test\n  script:\n    - kubectl rollout status -w --timeout=120s deployment/smartcs-ops-beat\n  tags:\n    - smartcs-ops-prod\n  only:\n    - master\n  when: always\n</code></pre> <ul> <li> <p>deploy_src_prod \u6b64\u6b65\u9aa4\u4e3a\u62c9\u53d6\u6e90\u7801\u5230prod\u670d\u52a1\u5668\u4e0a\uff0c\u8fdb\u884cnginx\u9759\u6001\u6587\u4ef6\u7684\u66f4\u65b0</p> </li> <li> <p>build_image_prod \u6b64\u6b65\u9aa4\u4e3a\u6784\u5efa\u955c\u50cf\uff0c\u5e76\u63a8\u9001\u955c\u50cf\u81f3harbor</p> </li> <li> <p>deploy_k8s_prod \u6b64\u6b65\u9aa4\u4e3a\u66ff\u6362\u4ee3\u7801\u6258\u7ba1\u4e2d\u7684\u955c\u50cftag\uff0c\u4e4b\u540e\u90e8\u7f72\u8fdbk8s\u73af\u5883\u4e2d</p> </li> <li> <p>check_k8s_prod \u8bbe\u7acb\u5931\u8d25\u68c0\u6d4b\u673a\u5236\uff0c\u901a\u8fc7rollout status -w\u5728\u90e8\u7f72\u671f\u95f4\u5b9e\u65f6\u68c0\u6d4b\u5bb9\u5668\u662f\u5426\u66f4\u65b0\u5b8c\u6210\uff0c\u5982\u679c\u5bb9\u5668\u6709\u5f02\u5e38\u672a\u542f\u52a8\uff0c\u5219\u72b6\u6001\u4e3a\u5f02\u5e38\u4e0d\u4f1a\u66f4\u65b0\u5bb9\u5668\u4e2d\u7684\u955c\u50cf\uff0c\u5e76\u884c\u68c0\u6d4b\u4e09\u4e2adeployment\u7684\u72b6\u6001\u3002</p> </li> </ul>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#45","title":"4.5 \u6d4b\u8bd5","text":"<ul> <li>\u67e5\u770bpipeline</li> </ul> <ul> <li>\u67e5\u770b\u6b63\u5f0f\u73af\u5883\u90e8\u7f72pipeline</li> </ul> <p>\u81f3\u6b64\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u6df7\u5408\u73af\u5883\u7684CI\u4efb\u52a1\u3002</p>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#_4","title":"\u4e94 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li> <p>\u5728\u591a\u73af\u5883\u914d\u7f6e\u4e0b\u6211\u4eec\u5e94\u8be5\u6839\u636e\u81ea\u8eab\u73af\u5883\u8fdb\u884c\u53d6\u820d\uff0c\u662f\u62c6\u5206\u591a\u4e2astage\u8fd8\u662f\u5171\u7528\u4e00\u4e2astage</p> </li> <li> <p>\u6b64gitlab ci\u6587\u4ef6\u9002\u7528\u4e8e\u5229\u7528gitlab ci\u5b8c\u6210CI\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728\u4e00\u4e2a.gitlab-ci.yml\u4e2d\u7f16\u5199\u591a\u4e2a\u73af\u5883\u7684job\u3002</p> </li> <li> <p>runner\u53ef\u4ee5\u540e\u671f\u6539\u9020\u6210docker\u5f62\u5f0f\uff0c\u6765\u5e76\u53d1\u6267\u884c\u591a\u4e2ajob\u4e14\u4fdd\u8bc1\u73af\u5883\u4e00\u81f4\u6027\u3002</p> </li> <li> <p>\u955c\u50cf\u7684tag\u5728\u6b64\u9879\u76ee\u4e2d\u5b9a\u4e49\u4e3acommit id\uff0c\u65b9\u4fbf\u6392\u67e5</p> </li> <li> <p>\u5c06k8s\u7684yaml\u6587\u4ef6\u6258\u7ba1\u5728\u9879\u76ee\u4ee3\u7801\u7684\u76ee\u5f55\u7ed3\u6784\u4e0b\uff0c\u6bcf\u6b21\u4ec5\u66ff\u6362image\u7684tag\uff0c\u7136\u540e\u5e42\u7b49\u6027\u7684apply\u3002</p> </li> </ul>"},{"location":"devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/#_5","title":"\u516d \u53cd\u601d","text":"<p>\u7531\u4e8e\u6211\u4eec\u6539\u5c0f\u8282\u4e3a\u5b9e\u6218\u9879\u76ee\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u4e00\u4e9b\u5de5\u5177\u5728\u6b64\u4e0d\u4fbf\u5c55\u5f00\u8be6\u89e3\uff0c\u8fd9\u4e9b\u5982\u679c\u5927\u5bb6\u6709\u5728\u5de5\u4f5c\u4e2d\u6ca1\u6709\u7528\u7684\uff0c\u53ef\u4ee5\u53bb\u81ea\u5df1\u5c1d\u8bd5\u5b66\u4e60\u4f7f\u7528\uff0c\u5728\u6b64\u4e3b\u8981\u4e3a\u5927\u5bb6\u63d0\u4f9b\u4e00\u4e2a\u601d\u8def\uff0c\u5177\u4f53\u7684\u7ec6\u8282\u9700\u8981\u81ea\u5df1\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\u4eb2\u81ea\u5b9e\u8df5\u624d\u80fd\u66f4\u52a0\u76f4\u89c2\u7684\u8ba4\u8bc6\u3002\u6bcf\u4e2a\u56e2\u961f\u5bf9\u5e94\u81ea\u5df1\u7684\u4e1a\u52a1\u90fd\u6709\u7279\u6b8a\u6027\uff0c\u6839\u636e\u81ea\u8eab\u4e1a\u52a1\u51fa\u53d1\uff0c\u627e\u5230\u6700\u5408\u9002\u7684\u65b9\u4fbf\u5c31\u662f\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/","title":"5.\u5b9e\u6218Kubernetes Gitlab CI","text":""},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5728\u76ee\u524d\u5fae\u670d\u52a1\u5927\u884c\u5176\u9053\u7684\u80cc\u666f\u4e0b\uff0cGitlab CI\u96c6\u6210kubernetes\u5df2\u7ecf\u662f\u4e0d\u53ef\u6216\u7f3a\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u6211\u4eec\u524d\u51e0\u8282\u7cfb\u7edf\u7684\u5b9e\u6218\u4e86\u524d\u540e\u7aef\u9879\u76ee\u4ee5\u53ca\u7269\u7406/K8s\u6df7\u5408\u73af\u5883\u90e8\u7f72\uff0c\u8fd9\u8282\u8bfe\u6211\u4eec\u6765\u5b66\u4e60Gitlab CI\u5982\u4f55\u5c06\u5e94\u7528\u53d1\u5e03\u8fdbK8s\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u5728\u4e4b\u524d\u7684\u5c06gitlab-runner\u90e8\u7f72\u5728\u670d\u52a1\u5668\u4e0a\u9762\u662f\u5b58\u5728\u4e00\u5b9a\u7684\u98ce\u9669\uff0c\u5982\u679c\u8fd0\u884cpipeline\u7684\u670d\u52a1\u5668\u5b95\u673a\uff0c\u53d1\u5e03\u4efb\u52a1\u5c31\u6ca1\u529e\u6cd5\u7ee7\u7eed\u4e86\uff0c\u66f4\u53ef\u6015\u7684\u65f6\u5019\u5982\u679ccommon-runner\u53d1\u9001\u6545\u969c\uff0c\u591a\u4e2a\u53d1\u5e03\u4efb\u52a1\u5c31\u90fd\u6709\u95ee\u9898\uff0c\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u4e0d\u53ef\u53d8\u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u5bb9\u5668\u7684\u81ea\u5305\u542b\u73af\u5883\u4f7f\u5f97\u6211\u4eec\u53d1\u5e03\u53d8\u5f97\u66f4\u52a0\u7b80\u5355\u5feb\u6377\uff0c\u4e0d\u7528\u5728\u8003\u8651\u62c5\u5fc3runner\u7684\u73af\u5883\u5982\u4f55\u6839\u636e\u4e0d\u540c\u7684\u9879\u76ee\u533a\u5206\uff0c\u4e14\u52a8\u6001\u7684Job\u89e6\u53d1\uff0c\u6211\u4eec\u4f1a\u968f\u65f6\u62c9\u8d77\u4e00\u4e2aPod\u6765\u8fd0\u884c\u6211\u4eec\u7684Job\uff0c\u8fd0\u884c\u5b8c\u6210\u540e\u53c8\u8fdb\u884c\u9500\u6bc1\uff0c\u8fd9\u6837\u4e0d\u4ec5\u80fd\u5b9e\u73b0\u52a8\u6001\u8fd0\u884c\u8282\u7701\u8d44\u6e90\uff0c\u800c\u4e14\u53ef\u4ee5\u4e0d\u7528\u8003\u8651\u591a\u9879\u76ee\u591a\u4efb\u52a1\u5e76\u53d1\u6784\u5efa\u7684\u95ee\u9898\uff0c\u8fd9\u8282\u8bfe\u5c31\u8ba9\u6211\u4eec\u6765\u5c3d\u60c5\u4eab\u53d7K8s+Gitlab CI\u4e3a\u6211\u4eec\u5e26\u6765\u7545\u5feb\u6dcb\u6f13\u7684\u53d1\u5e03\u4f53\u9a8c\u3002</p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#_2","title":"\u4e8c \u67b6\u6784\u89e3\u6790","text":"<p>\u672c\u6587\u4ee5\u6784\u5efa\u4e00\u4e2aJava\u8f6f\u4ef6\u9879\u76ee\u5e76\u5c06\u5176\u90e8\u7f72\u5230\u963f\u91cc\u4e91\u5bb9\u5668\u670d\u52a1Kubernetes\u96c6\u7fa4\u4e2d\u4e3a\u4f8b\uff0c\u8bf4\u660e\u5982\u4f55\u4f7f\u7528GitLab CI\u5728\u963f\u91cc\u4e91Kubernetes\u670d\u52a1\u4e0a\u8fd0\u884cGitLab Runner\u3001\u914d\u7f6eKubernetes\u7c7b\u578b\u7684executor\uff0c\u5e76\u6267\u884cPipeline\u3002</p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#21-gitlab-ci","title":"2.1 Gitlab CI\u6d41\u7a0b\u56fe","text":"<p>\u200b   </p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#22","title":"2.2 \u6d41\u7a0b\u8be6\u89e3","text":"<p>\u5982\u4e0a\u56fe\u4e3a\u4e00\u4e2a\u7b80\u5355\u7684Gitlab CI\u90e8\u7f72\u8fdbK8s\u6d41\u7a0b\u56fe\uff0c\u540c\u4e4b\u524d\u6211\u4eec\u8bb2\u5230\u7684CI\u96c6\u6210\u4e00\u81f4\uff0c\u53ea\u9700\u8981\u9879\u76ee\u4e2d\u5b58\u5728.gitlab-ci.yml\u6587\u4ef6\u5373\u53ef\uff0c\u4e0e\u4e4b\u524d\u7684\u5dee\u5f02\u4e3a\u5728\u96c6\u6210kubernetes\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8bb2\u6211\u4eec\u7684gitlab-runner\u8fd0\u884c\u5728\u6211\u4eecK8s\u5185\uff0c\u5176\u4e3a\u4e00\u4e2aPOD\u5f62\u5f0f\u8fd0\u884c\uff0c\u5176\u63a7\u5236\u7740\u540e\u7eed\u7684pipeline\u4e2d\u5404stage\u7684\u6267\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u4e00\u4e2apipeline\u6709\u591a\u4e2astage\uff0c\u6bcf\u4e2astage\u90fd\u662f\u6709\u4e00\u4e2a\u5355\u72ec\u7684Pod\u53bb\u6267\u884c\uff0c\u8fd9\u4e2aPod\u4f7f\u7528\u7684\u955c\u50cf\u5728\u6211\u4eecCI\u7684.gitlab-ci.yml \u7684\u6bcf\u4e2astage\u7684image\u4e2d\u5b9a\u4e49\uff0c\u5982\u6240\u793a\u4e3a\u4e00\u4e2a\u90e8\u7f72Java\u9879\u76ee\u7684\u6d41\u7a0b</p> <ul> <li>\u5f00\u53d1\u8005\u6216\u9879\u76ee\u7ef4\u62a4\u8005merge request\u5230\u7279\u5b9a\u5206\u652f\uff0c\u6539\u5206\u652f\u5b58\u5728CI\u6587\u4ef6\uff0c\u5f00\u59cb\u8fdb\u884cCI</li> <li>CI\u4efb\u52a1\u7531\u5df2\u7ecf\u6ce8\u518c\u5728gitlab-server\u8fd0\u884c\u5728K8s\u96c6\u7fa4\u5185\u7684giitlab-runner\u8fdb\u884c\u4e0b\u53d1</li> <li>\u7b2c\u4e00\u4e2a\u4e3apackage\uff0c\u5bf9java\u9879\u76ee\u5229\u7528maven\u955c\u50cf\u8fdb\u884c\u6253\u5305\uff0c\u751f\u6210war\u5305\u5236\u54c1\u5230\u7f13\u5b58\u76ee\u5f55\u4e2d\uff1b</li> <li>\u5229\u7528docker\u955c\u50cf\u5bf9\u6839\u636e\u9879\u76ee\u4e2d\u7684Dockerfile\u5bf9\u7f13\u5b58\u4e2d\u7684\u5236\u54c1\u8fdb\u884c\u955c\u50cf\u6784\u5efa\uff0c\u6784\u5efa\u5b8c\u6210\u540e\u767b\u5f55\u955c\u50cf\u4ed3\u5e93\u8fdb\u884c\u955c\u50cf\u63a8\u9001\uff1b</li> <li>\u5728\u6b64\u6211\u4eec\u5229\u7528\u5c06\u90e8\u7f72\u6587\u4ef6\u6258\u7ba1\u5728\u9879\u76ee\u5185\uff0c\u4e5f\u4f53\u73b0\u4e86gitops\u7684\u601d\u60f3\uff0c\u5c06\u4e4b\u524d\u6784\u5efa\u63a8\u9001\u6210\u529f\u7684\u955c\u50cf\u5730\u5740\u4fe1\u606f\u5728deployment.yaml\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\uff0c\u4e4b\u540eapply\u8fdbk8s\u4e2d\uff0cjava\u9879\u76ee\u6784\u5efa\u7684\u955c\u50cf\u5c31\u8fd0\u884c\u5728K8s\u96c6\u7fa4\u5185\u4e86\uff0c\u5b8c\u6210\u6574\u4e2a\u7684\u53d1\u5e03\u3002</li> </ul> <p>\u5728\u6d41\u7a0b\u4e2d\u6709\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u6211\u4eec\u53ef\u4ee5\u5728stage\u4e2d\u6dfb\u52a0\u81ea\u5df1\u4e1a\u52a1\u9700\u6c42\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\u5355\u5143\u6d4b\u8bd5\uff0c\u4ee3\u7801\u626b\u63cf\u7b49\u3002</li> <li>\u5728\u90e8\u7f72\u6587\u4ef6\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6574\u4e2a\u9879\u76ee\u5236\u4f5c\u6210helm\u7684chart\uff0c\u66ff\u6362\u5176\u4e2d\u7684\u955c\u50cf\uff0c\u5229\u7528helm\u6765\u8fdb\u884c\u6574\u4e2a\u5e94\u7528\u7684\u90e8\u7f72\u3002</li> <li>\u5e94\u7528\u5728\u90e8\u7f72\u4e2d\u5355\u4e2astage\u5229\u7528\u7684\u662f\u4e0d\u540c\u7684image\uff0c\u5728\u5404\u4e2astage\u4e2d\u4f20\u9012\u5df2\u7ecf\u751f\u6210\u7684\u5236\u54c1\u4f8b\u5982war/jar\u5305\uff0c\u9700\u8981\u4f7f\u7528\u5230\u5916\u90e8\u5b58\u50a8\u6765\u7f13\u5b58\u5236\u54c1\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#_3","title":"\u4e09  \u4f18\u70b9","text":"<p>\u901a\u8fc7\u4e0a\u9762\u7684Gitlab CI\u6d41\u7a0b\u6211\u4eec\u80fd\u591f\u770b\u5230\u5c06gitlab runner\u8fd0\u884c\u5728K8s\u96c6\u7fa4\u4e2d\uff0c\u6bcf\u4e2aJob\u542f\u52a8\u5355\u72ec\u7684POD\u8fd0\u884c\u64cd\u4f5c\uff0c\u6b64\u79cd\u65b9\u5f0f\u5b8c\u5168\u5229\u7528\u8d77\u4e86K8s\u7684\u4e00\u4e9b\u4f18\u70b9</p> <ul> <li>\u9ad8\u53ef\u7528\uff1a\u5f53\u67d0\u4e2a\u8282\u70b9\u51fa\u73b0\u6545\u969c\u65f6\uff0cKubernetes \u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 GitLab-Runner \u5bb9\u5668\uff0c\u5e76\u6302\u8f7d\u540c\u6837\u7684 Runner \u914d\u7f6e\uff0c\u4f7f\u670d\u52a1\u8fbe\u5230\u9ad8\u53ef\u7528\u3002</li> <li>\u5f39\u6027\u4f38\u7f29\uff1a\u89e6\u53d1\u5f0f\u4efb\u52a1\uff0c\u5408\u7406\u4f7f\u7528\u8d44\u6e90\uff0c\u6bcf\u6b21\u8fd0\u884c\u811a\u672c\u4efb\u52a1\u65f6\uff0cGitlab-Runner \u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u6216\u591a\u4e2a\u65b0\u7684\u4e34\u65f6 Runner\u6765\u8fd0\u884cJob\u3002</li> <li>\u8d44\u6e90\u6700\u5927\u5316\u5229\u7528\uff1a\u52a8\u6001\u521b\u5efaPod\u8fd0\u884cJob\uff0c\u8d44\u6e90\u81ea\u52a8\u91ca\u653e\uff0c\u800c\u4e14 Kubernetes \u4f1a\u6839\u636e\u6bcf\u4e2a\u8282\u70b9\u8d44\u6e90\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u52a8\u6001\u5206\u914d\u4e34\u65f6 Runner \u5230\u7a7a\u95f2\u7684\u8282\u70b9\u4e0a\u521b\u5efa\uff0c\u964d\u4f4e\u51fa\u73b0\u56e0\u67d0\u8282\u70b9\u8d44\u6e90\u5229\u7528\u7387\u9ad8\uff0c\u8fd8\u6392\u961f\u7b49\u5f85\u5728\u8be5\u8282\u70b9\u7684\u60c5\u51b5\u3002</li> <li>\u6269\u5c55\u6027\u597d\uff1a\u5f53 Kubernetes \u96c6\u7fa4\u7684\u8d44\u6e90\u4e25\u91cd\u4e0d\u8db3\u800c\u5bfc\u81f4\u4e34\u65f6 Runner \u6392\u961f\u7b49\u5f85\u65f6\uff0c\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u6dfb\u52a0\u4e00\u4e2a Kubernetes Node \u5230\u96c6\u7fa4\u4e2d\uff0c\u4ece\u800c\u5b9e\u73b0\u6a2a\u5411\u6269\u5c55\u3002</li> </ul> <p>\u5982\u679c\u60a8\u7684\u4e1a\u52a1\u76ee\u524d\u8fd0\u884c\u73af\u5883\u4e3aK8s\uff0c\u90a3\u4e48Gitlab CI\u5b8c\u5168\u5951\u5408\u60a8\u7684\u4e1a\u52a1\u573a\u666f\uff0c\u60a8\u53ea\u9700\u8981\u81ea\u5b9a\u4e49gitlab-ci.yml\u4e2d\u7684\u5404\u4e2a\u81ea\u5df1\u9700\u6c42\u7684stage\u5373\u53ef\uff0c\u914d\u5408gitops\u5c06\u914d\u7f6e\u4e5f\u6258\u7ba1\u5728\u9879\u76ee\u5185\uff0c\u8ddf\u968f\u9879\u76ee\u4e00\u5757\u7ef4\u62a4\u7ba1\u7406\uff0c\u5b9e\u73b0\u7aef\u5230\u7aef\u7684CI\u5de5\u4f5c\u6d41\uff0c\u4f7f\u5f97\u8fd0\u7ef4\u5de5\u4f5c\u4e5f\u53ef\u901a\u8fc7git\u8ffd\u6eaf\uff0c\u63d0\u9ad8\u5de5\u4f5c\u6548\u80fd\uff0c\u654f\u6377\u5f00\u53d1\u4e0a\u7ebf\u90e8\u7f72\u3002</p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#_4","title":"\u56db \u5b9e\u6218","text":"<p>\u6211\u4eec\u5728\u4e0a\u9762\u4e86\u89e3\u6765Gitlab CI\u4e0eKubernetes\u7684\u96c6\u6210\u53ca\u5176\u4f18\u70b9\uff0c\u4e0b\u9762\u5c31\u8ba9\u6211\u4eec\u901a\u8fc7\u5b9e\u6218\u6765\u66f4\u5177\u4f53\u7684\u4e86\u89e3\u5176\u6d41\u7a0b\u3002</p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#41","title":"4.1 \u73af\u5883\u51c6\u5907","text":"<ul> <li> <p>\u9700\u8981\u6709Gitlab \u670d\u52a1\u5668\uff0c\u53ef\u4ee5\u662f\u90e8\u7f72\u5728\u7269\u7406\u670d\u52a1\u5668\u4e0a\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u90e8\u7f72\u5728K8s\u96c6\u7fa4\u5185\u90e8\u3002</p> </li> <li> <p>\u6211\u9700\u8981\u51c6\u5907\u597dK8s\u96c6\u7fa4\uff0c\u53ef\u4ee5\u4e3a\u516c\u6709\u4e91\u7684\u5bb9\u5668\u7f16\u6392\u5f15\u64ce\uff0c\u4f8b\u5982\u963f\u91cc\u7684ACK\uff0c\u817e\u8baf\u7684TKE\uff0c\u534e\u4e3a\u7684CCE\u7b49\u90fd\u9002\u7528\u8fd9\u4e9b\u65b9\u5f0f\u3002</p> </li> <li> <p>\u7531\u4e8egitlab-runner\u5b89\u88c5\u8f83\u4e3a\u590d\u6742\uff0c\u6211\u4eec\u5728\u793a\u4f8b\u4e2d\u4f7f\u7528helm\u6765\u8fdb\u884c\u5b89\u88c5\uff0chelm\u7248\u672c\u4e3av2.14.3\uff0c\u5982\u679c\u6709\u80fd\u529b\u53ef\u4ee5\u81ea\u5df1\u7f16\u5199\u8d44\u6e90\u6e05\u5355\u90e8\u7f72\u3002</p> </li> </ul>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#411","title":"4.1.1 \u8bb0\u5f55\u6ce8\u518c\u4fe1\u606f","text":"<p>\u767b\u5f55Gitlab \u670d\u52a1\u5668\u8bb0\u5f55gitlab \u7684 url \u548c\u6ce8\u518c\u4ee4\u724c\uff0c\u5728\u6211\u4eec\u90e8\u7f72\u8fdbK8s\u7684gitlab-runnner\u7684\u914d\u7f6e\u4e2d\u9700\u8981\u586b\u5199\u8be5\u4fe1\u606f\uff0c\u8fd0\u884c\u5728K8s\u4e2d\u7684Pod\u5c31\u5229\u7528\u6b64\u6b64\u4fe1\u606f\u5728gitlab\u670d\u52a1\u5668\u8fdb\u884c\u6ce8\u518c\u3002</p> <p></p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#412-gitlab-runner","title":"4.1.2 \u83b7\u53d6gitlab-runner","text":"<p>\u7531\u4e8e\u5355\u72ec\u90e8\u7f72gitlab-runner\u8fdbK8s\u4e2d\uff0c\u81ea\u5df1\u53bb\u5199\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\u96be\u5ea6\u8f83\u5927\uff0c\u800c\u4e14\u5bb9\u6613\u51fa\u9519\uff0c\u6211\u4eec\u5728\u6b64\u5229\u7528\u5b98\u65b9\u7684chart\u955c\u50cf\u901a\u8fc7helm\u6765\u8fdb\u884c\u90e8\u7f72\uff0c\u4ec5\u4fee\u6539\u5176\u4e2d\u6211\u4eec\u5173\u7cfb\u7684\u5b57\u6bb5\u5373\u53ef\uff0c\u9996\u5148\u5728\u767b\u5f55K8s\u96c6\u7fa4\u8fdb\u884cgitlab-runner\u7684helm repo\u7684\u6dfb\u52a0\uff0c\u4e4b\u540e\u5c06chart\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u89e3\u538b\u6587\u4ef6\u5e76\u4fee\u6539\u5176\u4e2d\u7684values.yml\u6587\u4ef6\u3002</p> <ul> <li>\u6dfb\u52a0repo\u83b7\u53d6charts</li> </ul> <pre><code>[root@master common-service]# helm repo add gitlab https://charts.gitlab.io\n\"gitlab\" has been added to your repositories\n[root@master common-service]# helm repo update\nHang tight while we grab the latest from your chart repositories...\n...Skip local chart repository\n...Successfully got an update from the \"aliyun\" chart repository\n...Successfully got an update from the \"apphub\" chart repository\n...Successfully got an update from the \"gitlab\" chart repository\n...Successfully got an update from the \"stable\" chart repository\nUpdate Complete.\n[root@master common-service]# helm search gitlab-runner\nNAME                    CHART VERSION   APP VERSION     DESCRIPTION  \ngitlab/gitlab-runner    0.14.0          12.8.0          GitLab Runner\n</code></pre> <p>\u6211\u770b\u5df2\u7ecf\u770b\u5230\u4e86 gitlab-runner\u7684chart\uff0c\u5176\u662f helm \u4e2d\u63cf\u8ff0\u76f8\u5173\u7684\u4e00\u7ec4 Kubernetes \u8d44\u6e90\u7684\u6587\u4ef6\u96c6\u5408\uff0c\u91cc\u9762\u5305\u542b\u4e86\u4e00\u4e2a value.yaml \u914d\u7f6e\u6587\u4ef6\u548c\u4e00\u7cfb\u5217\u6a21\u677f\uff08deployment.yaml\u3001svc.yaml \u7b49\uff09\u3002\u5f53\u7136\u5982\u679c\u6211\u4eec\u80fd\u529b\u591f\uff0c\u53ef\u4ee5\u81ea\u5df1\u53bb\u7f16\u5199\u8fd9\u4e9b\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\u3002</p> <p>\u5728\u6b64\u6709\u60f3\u53bb\u7684\u4f19\u4f34\u53ef\u4ee5\u67e5\u770b\u4e4b\u524dK8s\u5b66\u4e60\u7b14\u8bb0\uff0c\u5e0c\u671b\u80fd\u5bf9\u8bfb\u8005\u5b66\u4e60K8s\u6709\u5e2e\u52a9\uff1aawesome-kubernetes-notes</p> <ul> <li>\u521b\u5efa\u89d2\u8272\u5e76\u7ed1\u5b9a\u6743\u9650</li> </ul> <p>gitlab-runner\u5728\u8fd0\u884c\u7684\u65f6\u5019\u9700\u8981\u8bbf\u95ee\u6211\u4eecK8s\u7684api\uff0c\u6211\u4eec\u5728\u6b64\u4e3a\u671f\u521b\u5efaServiceAccount\u5e76\u4e3a\u5176\u8fdb\u884cRBAC\u6388\u6743\uff0c\u9996\u5148\u521b\u5efa\u4e00\u4e2agitlab-runners\u7684\u540d\u79f0\u7a7a\u95f4\uff0c\u5e76\u521b\u5efa\u5bf9\u7528\u7684Role\uff0c\u5c06ServiceAccount\u4e8eRole\u8fdb\u884c\u7ed1\u5b9a\u3002</p> <pre><code>[root@master gitlab-runner]# cat &gt; rbac-runner-config.yaml &lt;&lt;EOF\napiVersion: v1\nkind: ServiceAccount                                        # \u5728gitlab-runners\u540d\u79f0\u7a7a\u95f4\u4e0b\u521b\u5efa\u540d\u4e3agitlab\u7684serviceaccount\nmetadata:\n  name: gitlab\n  namespace: gitlab-runners\n---\nkind: Role                                                              # \u521b\u5efagitlab\u89d2\u8272\uff0c\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  namespace: gitlab-runners\n  name: gitlab\nrules:\n- apiGroups: [\"\"] #\"\" indicates the core API group\n  resources: [\"*\"]\n  verbs: [\"*\"]\n- apiGroups: [\"apps\"]                               \n  resources: [\"deployments\"]\n  verbs: [\"*\"]\n- apiGroups: [\"extensions\"]\n  resources: [\"deployments\"]\n  verbs: [\"*\"]\n\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: gitlab                                                                      # \u5c06sa\u4e0e\u89d2\u8272\u8fdb\u884c\u7ed1\u5b9a\n  namespace: gitlab-runners\nsubjects:\n- kind: ServiceAccount\n  name: gitlab # Name is case sensitive\n  apiGroup: \"\"\nroleRef:\n  kind: Role #this must be Role or ClusterRole\n  name: gitlab # this must match the name of the Role or ClusterRole you wish to bind to\n  apiGroup: rbac.authorization.k8s.io\n\nEOF\n# \u521b\u5efa\u8d44\u6e90\u6e05\u5355\n[root@master gitlab-runner]# kubectl create -f rbac-runner-config.yaml\nserviceaccount/gitlab created\nrole.rbac.authorization.k8s.io/gitlab created\nrolebinding.rbac.authorization.k8s.io/gitlab created\n</code></pre> <ul> <li>\u83b7\u53d6charts\u6587\u4ef6\uff0c\u5e76\u8fdb\u884c\u914d\u7f6e</li> </ul> <pre><code>[root@master gitlab-runner]# helm fetch gitlab/gitlab-runner                        \n[root@master gitlab-runner]# tar xf gitlab-runner-0.14.0.tgz\n[root@master gitlab-runner]# vim gitlab-runner/values.yaml \n</code></pre> <p>helm\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u5728\u5b89\u88c5 runner \u7684\u65f6\u5019\u4e3a\u5176\u6ce8\u518c\u4e00\u4e2a\u9ed8\u8ba4\u7684 runner\u3002\u6211\u4eec\u53ef\u4ee5\u53bb gitlab-runner \u7684\u9879\u76ee\u6e90\u7801 \u4e2d\u83b7\u53d6\u5230 <code>values.yaml</code> \u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002</p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#413-dockersock","title":"4.1.3 \u7ed1\u5b9adocker.sock","text":"<p>\u7531\u4e8e\u5728gitlab-runner\u4e2d\u9700\u8981\u6267\u884cdocker build \u547d\u4ee4\uff0c\u9700\u8981docker\u670d\u52a1\u7aef\uff0c\u6211\u4eec\u53ef\u4ee5\u6765\u7ed1\u5b9aK8s node\u8282\u70b9\u7684docker.sock\u6765\u5b9e\u73b0\uff0c\u7f16\u8f91chart\u4e0b\u9762\u7684template\u76ee\u5f55\u4e2d\u7684configmap.yaml\uff0c\u5728\u5927\u7ea642\u884c\u4fee\u6539</p> <p></p> <pre><code># add volume and bind docker.sock\ncat &gt;&gt;/home/gitlab-runner/.gitlab-runner/config.toml &lt;&lt;EOF\n  [[runners.kubernetes.volumes.pvc]]\n    name = \"{{.Values.maven.cache.pvcName}}\"\n    mount_path = \"{{.Values.maven.cache.mountPath}}\"\n  [[runners.kubernetes.volumes.host_path]]\n    name = \"docker\"\n    mount_path = \"/var/run/docker.sock\"\nEOF\n</code></pre>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#414","title":"4.1.4 \u914d\u7f6e\u7f13\u5b58","text":"<p>\u5728\u6211\u4eec\u7684\u6d41\u7a0b\u8be6\u89e3\u4e2d\u80fd\u591f\u770b\u5230\u751f\u6210\u7684war/jar\u5305\u5236\u54c1\u9700\u8981\u5b58\u50a8\u5728\u4e00\u4e2a\u5730\u65b9\uff0c\u8fd9\u4e2a\u5730\u65b9\u5c31\u9700\u8981\u6211\u4eec\u6302\u8f7d\u4e00\u5757\u5916\u7f6e\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u5728k8s\u4e2d\u6211\u4eec\u9700\u8981\u4e3a\u5176\u63d0\u4f9bPVC\uff0c\u5982\u679c\u4f60\u6709NFS\u5b58\u50a8\u6216\u8005\u5206\u5e03\u5f0fceph\u5236\u6210\u7684\u5b58\u50a8\u7c7b\u90fd\u53ef\u4ee5\u3002</p> <p>\u518d\u6b64\uff0c\u6211\u4eec\u673a\u5668\u4e2d\u4f7f\u7528\u7684\u4e3astorageclass\uff0c\u6f14\u793a\u5229\u7528\u5b58\u50a8\u7c7b\u6765\u58f0\u660ePVC\uff0c\u5728POD\u4e2d\u8fdb\u884c\u6302\u8f7d</p> <ul> <li>\u521b\u5efapvc\u58f0\u660e\u6587\u4ef6gitlab-runner-pvc.yaml</li> </ul> <pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: gitlab-runner-pvc           # \u521b\u5efa\u540d\u79f0\u4e3agitlab-runner-pvc\u7684pvc\n  namespace: gitlab-runners\nspec:\n  accessModes:\n    - ReadWriteMany                     # \u8bbf\u95ee\u6a21\u5f0f\n  storageClassName: rbd             # \u5b58\u50a8\u7c7b\u540d\u79f0\n  resources:\n    requests:\n      storage: 2Gi                      # \u5b58\u50a8\u5927\u5c0f\n</code></pre> <ul> <li>\u521b\u5efapvc</li> </ul> <pre><code>[root@master gitlab-runner]# kubectl apply -f gitlab-runner-pvc.yaml                                         \npersistentvolumeclaim/gitlab-runner-pvc created\n[root@master gitlab-runner]# kubectl get pvc -n gitlab-runners       \nNAME                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\ngitlab-runner-pvc   Bound    pvc-a620cd43-f396-4626-8599-c973c19cddd3   2Gi        RWO            rbd            4s\n</code></pre> <p>\u67e5\u770b\u5df2\u7ecf\u5728gitlab-runners\u540d\u79f0\u7a7a\u95f4\u4e0b\u5df2\u7ecf\u521b\u5efa\u597d\u4e86PVC\u3002</p> <ul> <li>\u914d\u7f6evalues</li> </ul> <p>\u5728\u4e0a\u9762\u6211\u4eec\u914d\u7f6e\u7ed1\u5b9a\u5bbf\u4e3b\u673adocker\u8fdb\u7a0b\u7684\u65f6\u5019\u4e5f\u5df2\u7ecf\u5c06pvc\u914d\u7f6e\u8fdb\u53bb\u4e86\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5728charts\u7684values.yaml\u4e0b\u9762\u65b0\u6dfb\u52a0\u914d\u7f6e volume \u7684\u4fe1\u606f\uff0c\u5e76\u5728 values.yaml \u914d\u7f6e\u76f8\u5e94\u7684\u53d8\u91cf</p> <pre><code># \u6dfb\u52a0\u5728values.yaml \u7684\u6700\u540e\u5373\u53ef\nmaven:\n  cache:\n    pvcName: gitlab-runner-pvc\n    mountPath: /home/cache/maven\n</code></pre>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#415-gitlab-runner","title":"4.1.5 \u5b89\u88c5gitlab-runner","text":"<p>\u914d\u7f6e\u6587\u4ef6\u6bd4\u8f83\u957f\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u8981\u81ea\u5df1\u53bb\u914d\u7f6e\uff0c\u4e0b\u9762\u5c31\u8d34\u4e0b\u672c\u6587\u4e2d\u9700\u8981\u914d\u7f6e\u7684\u5730\u65b9\u3002</p> <pre><code>[root@master gitlab-runner]# egrep \"^$|^#|^[[:space:]]+#\" -v values.yaml \nimagePullPolicy: IfNotPresent\ngitlabUrl: http://43.xx.xx.xx/                                              # gitlab url\nrunnerRegistrationToken: \"nnxxxxxxxxxxxxxxxS\"                   # gitlab token\nunregisterRunners: true\nterminationGracePeriodSeconds: 3600\nconcurrent: 10\ncheckInterval: 30\nrbac:\n  create: true\n  clusterWideAccess: false\n  serviceAccountName: gitlab                                                    # rbac\u7684sa\nmetrics:\n  enabled: true\nrunners:\n  image: ubuntu:16.04                                                                   # \u4f7f\u7528\u7684\u955c\u50cf\n  tags: \"gitlab-runner\"\n  privileged: true\n  imagePullPolicy: \"if-not-present\"                                     # \u5982\u679c\u6267\u884c\u5177\u4f53job\u7684runner\u4e0d\u5b58\u5728\u5219\u62c9\u53d6\n  pollTimeout: 180\n  outputLimit: 4096\n  cache: {}\n  builds: {}\n  services: {}\n  helpers: {}\n  serviceAccountName: gitlab                                                    # serviceaccount\n  nodeSelector: {}\n\nsecurityContext:\n  fsGroup: 65533\n  runAsUser: 100\nresources: {}\naffinity: {}\nnodeSelector: {}\ntolerations: []\nhostAliases: []\npodAnnotations: {}\npodLabels: {}\nmaven:                                                                                              # \u914d\u7f6emaven\u7f13\u5b58\u4fe1\u606f\n  cache:\n    pvcName: gitlab-runner-pvc                                              # pvc\u4fe1\u606f\n    mountPath: /home/cache/maven                                            # \u6302\u8f7d\u70b9\n</code></pre> <ul> <li>\u5b89\u88c5gitlab-runner</li> </ul> <p>\u5728\u914d\u7f6e\u5b8c\u6210values.yaml\u76f8\u5173\u7684\u5b57\u6bb5\u540e\uff0c\u6211\u4eec\u5229\u7528helm\u6765\u5176 \u8fdb\u884c\u5b89\u88c5\uff0c\u540e\u671f\u5982\u679c\u6211\u4eec\u6709\u53d8\u52a8\uff0c\u76f4\u63a5\u4fee\u6539value.yml \uff0c\u7136\u540e\u8fdb\u884c\u66f4\u65b0\u5373\u53ef<code>helm upgrade gitlab-rujner gitlab-runner/</code></p> <pre><code>[root@master gitlab-runner]# helm install --name gitlab-runner -f gitlab-runner/values.yaml --namespace gitlab-runners gitlab-runner/\nNAME:   gitlab-runner\nLAST DEPLOYED: Sun Feb 23 22:45:37 2020\nNAMESPACE: gitlab-runners\nSTATUS: DEPLOYED\n\nRESOURCES:\n==&gt; v1/ConfigMap\nNAME                         DATA  AGE\ngitlab-runner-gitlab-runner  5     1s\n\n==&gt; v1/Deployment\nNAME                         READY  UP-TO-DATE  AVAILABLE  AGE\ngitlab-runner-gitlab-runner  0/1    1           0          1s\n\n==&gt; v1/Pod(related)\nNAME                                          READY  STATUS   RESTARTS  AGE\ngitlab-runner-gitlab-runner-6745dd4cd6-r9z28  0/1    Pending  0         0s\n\n==&gt; v1/Secret\nNAME                         TYPE    DATA  AGE\ngitlab-runner-gitlab-runner  Opaque  2     1s\n\n\nNOTES:\n\nYour GitLab Runner should now be registered against the GitLab instance reachable at: \"http://43.254.54.93:88/\"\n</code></pre> <p>\u67e5\u770b\u5df2\u7ecf\u8fd0\u884cok\u7684\u76f8\u5173pod\u8d44\u6e90\uff0cgitlab-runner\u7684\u914d\u7f6e\u662f\u901a\u8fc7configmap\u6302\u8f7d\u8fdb\u53bb\uff0c\u5982\u679c\u6211\u4eec\u6709\u65b0\u7684\u914d\u7f6e\u53ef\u4ee5\u4fee\u6539\uff0c\u5e76\u5220\u9664\u4e4b\u524d\u7684gitlab-runner\u7684pod\uff0c\u5176deployment\u63a7\u5236\u5668\u4f1a\u8fdb\u884c\u521b\u5efaPod\u6302\u8f7d\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\u3002</p> <ul> <li>\u67e5\u770bpod\u8fd0\u884c\u72b6\u6001</li> </ul> <pre><code>[root@master ~]# kubectl get po -n gitlab-runners \nNAME                                           READY   STATUS    RESTARTS   AGE\ngitlab-runner-gitlab-runner-6745dd4cd6-r9z28   1/1     Running   0          21h\n</code></pre> <ul> <li>\u67e5\u770bconfigmap\u53capod\u4e2d\u6302\u8f7d\u7684\u914d\u7f6e</li> </ul> <p>\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u8fdb\u5165 pod \u770b\u4e00\u4e0b runner \u7684\u914d\u7f6e\u6587\u4ef6\uff08<code>/home/gitlab-runner/.gitlab-runner/config.toml</code>\uff09\u4e86\u3002\u8fd9\u4e2a\u6587\u4ef6\u5c31\u662f\u6839\u636e\u4e4b\u524d\u914d\u7f6e\u7684 values.yaml \u81ea\u52a8\u751f\u6210\u7684\u3002</p> <pre><code>[root@master ~]# kubectl get cm -n gitlab-runners  gitlab-runner-gitlab-runner \nNAME                          DATA   AGE\ngitlab-runner-gitlab-runner   5      21h\n</code></pre> <ul> <li>\u767b\u5f55gitlab\u63a7\u5236\u53f0\u67e5\u770b\u76ee\u524dgitlab-runner\u5df2\u7ecf\u6ce8\u518c\u4e0a\u4e86\u3002</li> </ul> <p></p> <ul> <li>\u5f53pod\u8fd0\u884c\u8d77\u6765\u540e\uff0c\u67e5\u770b\u5b8c\u6574\u914d\u7f6e</li> </ul> <pre><code>[root@master gitlab-runner]# kubectl exec -it -n gitlab-runners gitlab-runner-gitlab-runner-6c7dfd859c-62dv5 -- cat /home/gitlab-runner/.gitlab-runner/config.toml\nlisten_address = \"[::]:9252\"\nconcurrent = 10\ncheck_interval = 30\nlog_level = \"info\"\n\n[session_server]\n  session_timeout = 1800\n\n[[runners]]\n  name = \"gitlab-runner-gitlab-runner-6c7dfd859c-62dv5\"\n  output_limit = 4096\n  request_concurrency = 1\n  url = \"http://43.254.54.93:88/\"                                   # \u6ce8\u518c\u7684url\n  token = \"eRskGn8Q-g4FZnZib63q\"                                    # gitlab\u6ce8\u518c\u7684token\n  executor = \"kubernetes\"                                                   # executor\u4e3akubernetes\n  [runners.custom_build_dir]\n  [runners.cache]\n    [runners.cache.s3]\n    [runners.cache.gcs]\n  [runners.kubernetes]\n    host = \"\"\n    bearer_token_overwrite_allowed = false\n    image = \"ubuntu:16.04\"                                              # \u4f7f\u7528\u7684\u955c\u50cf\u4e3aubuntu\n    namespace = \"gitlab-runners\"                                    # \u4f7f\u7528\u7684namespace\u4e3agitlab-runners\n    namespace_overwrite_allowed = \"\"\n    privileged = true\n    poll_timeout = 180\n    service_account = \"gitlab\"                                      # serviceaccont \u4e3agitlab\n    service_account_overwrite_allowed = \"\"\n    pod_annotations_overwrite_allowed = \"\"\n    [runners.kubernetes.pod_security_context]\n    [runners.kubernetes.volumes]\n  [[runners.kubernetes.volumes.pvc]]\n    name = \"gitlab-runner-pvc\"                                      # \u6302\u8f7d\u7684pvc\u540d\u79f0\n    mount_path = \"/home/cache/maven\"                            # \u6302\u8f7d\u5728pod\u4e0b\u7684\u7f13\u5b58\u76ee\u5f55\n  [[runners.kubernetes.volumes.host_path]]\n    name = \"docker\"\n    mount_path = \"/var/run/docker.sock\"                     # \u7ed1\u5b9a\u5bbf\u4e3b\u673a\u7684docker.sock\n</code></pre> <p>\u81f3\u6b64\u6211\u4eec\u5df2\u7ecf\u5c06gitlab-runner\u5728K8s\u96c6\u7fa4\u4e2d\u8fd0\u884c\u8d77\u6765\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u6765\u96c6\u6210CI\u3002</p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#42-ci","title":"4.2 \u96c6\u6210CI","text":""},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#421","title":"4.2.1 \u5b9a\u4e49\u6587\u4ef6","text":"<p>\u7531\u4e8e\u4f7f\u7528\u7684 executor \u4e0d\u540c\uff0c\u6240\u4ee5. gitlab-ci.yml \u548c\u4e4b\u524d\u670d\u52a1\u5668\u4e5f\u6709\u4e9b\u4e0d\u540c\uff0c\u4e0d\u5982image\uff0c\u9ed8\u8ba4\u5982\u679c\u6bcf\u4e2astage\u4e2d\u6ca1\u6709\u5199\u6307\u5b9a\u67d0\u4e2aimage\u5219\u4f7f\u7528\u8be5image</p> <pre><code>image: docker:latest\nvariables:\n  DOCKER_DRIVER: overlay2\n  # k8s \u6302\u8f7d\u672c\u5730\u5377\u4f5c\u4e3a maven \u7684\u7f13\u5b58\n  MAVEN_OPTS: \"-Dmaven.repo.local=/home/cache/maven\"\n\nstages:\n  - package                         # \u6e90\u7801\u6253\u5305\u9636\u6bb5\n  - docker_build        # \u955c\u50cf\u6784\u5efa\u548c\u6253\u5305\u63a8\u9001\u9636\u6bb5\n  - deploy_k8s                  # \u5e94\u7528\u90e8\u7f72\u9636\u6bb5\n\nbefore_script:\n  - export APP_TAG=\"${CI_COMMIT_TAG:-${CI_COMMIT_SHA::8}}\"              # \u5b9a\u4e49\u5236\u4f5c\u597d\u7684\u955c\u50cftag\n\nmaven-package:\n  #image: maven:3.5-jdk-8-alpine\n  image: registry.cn-beijing.aliyuncs.com/codepipeline/public-blueocean-codepipeline-slave-java:0.1-63b99a20        # maven\u955c\u50cf\u8fdb\u884cjava\u6e90\u7801\u7684build\n  tags:\n    - gitlab-runner             # \u6307\u5b9a\u4f7f\u7528gitlab-runner\u6765\u8ffd\u5bfb\n  stage: package\n  script:\n    - mvn clean package -Dmaven.test.skip=true\n  artifacts:                            # \u5c06\u751f\u6210\u7684war\u5305\u4e0a\u4f20\u5230pvc\u6302\u8f7d\u76ee\u5f55\u4e2d\n    paths:\n      - target/*.war\ndocker-build:\n  tags:\n    - gitlab-runner\n  stage: build\n  script:\n    - echo \"Building Dockerfile-based application...\"\n    - docker build -t ${REGISTRY}/${QHUB_NAMESPACE}/${APP_NAME}:${APP_TAG} .                    # \u6784\u5efa\u955c\u50cf\n    - docker login --username=${DOCKER_USERNAME} ${REGISTRY} -p ${DOCKER_PASSWORD}      # \u767b\u5f55\u955c\u50cf\u4ed3\n    - docker push ${REGISTRY}/${QHUB_NAMESPACE}/${APP_NAME}:${APP_TAG}                              # push\u955c\u50cf\n  only:\n    - master\nk8s-deploy:\n  image: bitnami/kubectl:latest             # \u4f7f\u7528kubectl\u955c\u50cf\u6765\u8fdb\u884c\u6700\u7ec8\u7684\u90e8\u7f72\n  tags:\n    - gitlab-runner\n  stage: deploy\n  script:\n    - echo \"deploy to k8s cluster...\"\n    - sed -i \"s@$(grep -E \"^[[:space:]]+image:\" deployment.yaml | awk '{print $2}' |head -1)@${REGISTRY}/${QHUB_NAMESPACE}/${APP_NAME}:${APP_TAG}@g\"    deployment.yaml         # \u66ff\u6362deployment\u4e2d\u7684\u955c\u50cf\n    - kubectl apply -f deployment.yaml                      # \u5e94\u7528\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\n  only:\n    - master\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230CI\u6587\u4ef6\u4e2d\u6211\u4eec\u5b9a\u4e49\u4e86\u4e09\u4e2astage\uff1a</p> <ol> <li>\u5229\u7528maven\u955c\u50cf\u8fdb\u884c\u6253\u5305\uff0c\u751f\u6210war\u5305\u5236\u54c1\u5230\u7f13\u5b58\u76ee\u5f55\u4e2d\u3002</li> <li>\u5229\u7528docker\u955c\u50cf\u5bf9\u6839\u636e\u9879\u76ee\u4e2d\u7684Dockerfile\u5bf9\u7f13\u5b58\u4e2d\u7684\u5236\u54c1\u8fdb\u884c\u955c\u50cf\u6784\u5efa\uff0c\u6784\u5efa\u5b8c\u6210\u540e\u767b\u5f55\u955c\u50cf\u4ed3\u5e93\u8fdb\u884c\u955c\u50cf\u63a8\u9001\u3002</li> <li>\u5229\u7528kubectl\u955c\u50cf\u5148\u5bf9\u539f\u6709deployment\u6587\u4ef6\u8fdb\u884c\u955c\u50cf\u66ff\u6362\uff0c\u4e4b\u540e\u8fdb\u884c\u5c06\u8d44\u6e90\u6e05\u5355\u66f4\u65b0\u81f3K8s\u96c6\u7fa4\u4e2d\u3002</li> <li>\u5728\u4e3a\u955c\u50cf\u6253tag\u65f6\uff0c\u53ef\u4ee5\u81ea\u884c\u8bbe\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528commit\u6765\u8fdb\u884c\u4e0egit\u7248\u672c\u5bf9\u7167\u3002</li> </ol>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#422","title":"4.2.2 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u7531\u4e8e\u5728\u955c\u50cf\u6784\u5efa\u7684stage\u4e2d\uff0c\u9700\u8981\u4f7f\u7528docker\u547d\u4ee4\u6765\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\uff0c\u9700\u8981\u7ed1\u5b9a\u672c\u5730 Docker \u5b88\u62a4\u8fdb\u7a0b\u3002</li> <li>maven \u4ed3\u5e93\u7684\u7f13\u5b58\uff0c\u5728\u53c8\u9700\u8981\u751f\u4ea7\u5236\u54c1\u5e76\u4fdd\u5b58\u7684\u6784\u5efa\u4e2d\uff0c\u9700\u8981\u5916\u90e8\u5b58\u50a8\u6765\u5b58\u653e\u5236\u54c1\u3002</li> <li>\u5728stage\u4e2d\u5f15\u7528\u7684\u955c\u50cf\u6700\u597d\u80fd\u4e8b\u5148pull\u5230\u5404\u4e2anode\u8282\u70b9\u4e0a\uff0c\u4e0d\u7136\u5728\u7b2c\u4e00\u6b21\u8fd0\u884cCI\uff0c\u5982\u679c\u7f51\u7edc\u6709\u6ce2\u52a8\u6216\u5e26\u5bbd\u5c0f\uff0c\u53ef\u80fd\u4f1a\u56e0\u4e3a\u955c\u50cf\u4e0b\u8f7d\u8d85\u65f6\u5bfc\u81f4CI\u5931\u8d25\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#423","title":"4.2.3 \u914d\u7f6e\u53d8\u91cf","text":"<p>\u7531\u4e8e\u5728CI\u6587\u4ef6\u4e2d\u53c8\u4e00\u4e9b\u654f\u611f\u4fe1\u606f\uff0c\u4f8b\u5982\u955c\u50cf\u4ed3\u5e93\u7684\u767b\u5f55\u4fe1\u606f\u4ee5\u53ca\u540e\u671f\u53ef\u4ee5\u66f4\u6539\u7684\u955c\u50cf\u540d\u79f0\u7b49\uff0c\u5229\u7528\u73af\u5883\u6ce8\u5165\u7684\u65b9\u5f0f\uff0c\u4f7f\u5f97CI\u6587\u4ef6\u8131\u654f\u800c\u4e14\u66f4\u5177\u7075\u6d3b\u6027\u548c\u9002\u7528\u6027\u3002</p> <p>Project \u2192 Settings \u2192 CI/CD \u2192 Variables\uff0c \u6dfb\u52a0GitLab Runner\u53ef\u7528\u7684\u73af\u5883\u53d8\u91cf\uff0c\u672c\u793a\u4f8b\u6dfb\u52a0\u53d8\u91cf\u5982\u4e0b\uff1a</p> <p></p> <ul> <li> <p>APP_NAME\uff1a\u5236\u4f5c\u5b8c\u6210\u540e\u955c\u50cf\u7684\u540d\u79f0</p> </li> <li> <p>DOCKER_USERNAME\uff1a \u955c\u50cf\u4ed3\u5e93\u7528\u6237\u540d</p> </li> <li>DOCKER_PASSWORD \u955c\u50cf\u4ed3\u5e93\u5bc6\u7801</li> <li>QHUB_NAMESPACE\uff1a\u955c\u50cf\u4ed3\u5e93\u7684\u540d\u79f0\u7a7a\u95f4\uff0c\u5728\u8be5\u9879\u76ee\u4e2d\u6211\u4eec\u4f7f\u7528\u7684\u817e\u8baf\u7684\u955c\u50cf\u4ed3\u5e93\uff0c\u5f53\u7136\u53ef\u4ee5\u81ea\u5efaharbor\u6216\u4f7f\u7528\u5176\u4ed6\u516c\u6709\u4e91\u63d0\u4f9b\u7684\u955c\u50cf\u4ed3\u5e93\u6216\u8005dockerhub\u7b49\u3002 </li> <li>REGISTRY\uff1a\u955c\u50cf\u4ed3\u5e93\u7684\u5730\u5740</li> </ul>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#43","title":"4.3 \u8fd0\u884c\u6d4b\u8bd5","text":"<p>\u5728\u6211\u4eec\u914d\u7f6e\u597d\u4e86CI\u6587\u4ef6\u597d\uff0c\u8ba9\u6211\u4eec\u6765\u8fd0\u884c\u6d4b\u8bd5\uff0c\u63d0\u4ea4\u4ee3\u7801\uff0c\u6216\u8005\u624b\u52a8\u8fd0\u884c\u3002</p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#431-pipeline","title":"4.3.1 \u8fd0\u884cpipeline","text":"<p>\u5728\u9879\u76eeCI/CD-&gt;Pipelines\u53f3\u4e0a\u89d2\u6709RunPipeline</p> <p></p> <p>\u5728\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5728\u5176\u4e2d\u662f\u53ef\u4ee5\u5e76\u884c\u8fd0\u884c\u591a\u4e2apipeline\uff0c\u4e92\u4e0d\u5f71\u54cd\u3002</p> <p>\u9009\u62e9\u5bf9\u5e94\u7684\u5206\u652f\u6216\u8005\u4f20\u5165\u53d8\u91cf\u624b\u52a8\u8fd0\u884cpipeline</p> <p></p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#432-pod","title":"4.3.2 \u67e5\u770b\u8fd0\u884cPOD","text":"<p>\u767b\u5f55K8s\u96c6\u7fa4\uff0c\u67e5\u770b\u6b64\u65f6\u8fd0\u884c\u7684POD</p> <p></p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#433-job","title":"4.3.3 \u67e5\u770bJob","text":"<ul> <li>\u6253\u5305\u955c\u50cf</li> </ul> <ul> <li>\u955c\u50cf\u6784\u5efa</li> </ul> <ul> <li>\u90e8\u7f72\u8fdbK8s</li> </ul>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#434","title":"4.3.4 \u67e5\u770b\u6784\u5efa\u60c5\u51b5","text":"<ul> <li>\u67e5\u770bpipeline</li> </ul> <ul> <li>\u67e5\u770b\u6784\u5efa\u5e94\u7528</li> </ul> <p>\u81f3\u6b64\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u793a\u4f8bGitlab CI\u3002</p>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#_5","title":"\u4e94 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5728\u5b9e\u6218\u4e2d\u7684\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\u53ea\u5199\u6765deployment\uff0c\u8bfb\u8005\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9879\u76ee\u6765\uff0c\u53ef\u4ee5\u5c06service/configmap/hpa\u7b49\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\u4e5f\u653e\u5728\u9879\u76ee\u4e2d\u6258\u7ba1\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5236\u4f5c\u6210helm\u5e94\u7528\uff0c\u6bcf\u6b21\u53d1\u5e03\u5229\u7528helm\u6765\u66f4\u65b0\u5e94\u7528</li> <li>\u5728Gitlab CI\u4e2d\u6ce8\u610f\u5c06\u654f\u611f\u4fe1\u606f\u4f8b\u5982\u955c\u50cf\u4ed3\u5e93\u7684\u767b\u5f55\u65b9\u5f0f\u7b49\u8fdb\u884c\u8131\u654f\uff0c\u5c06\u6709\u53d8\u5316\u7684\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u53d8\u91cf\uff0c\u4e3a\u6b64\u8fdb\u884c\u4f20\u5165\u662f\u7684CI\u66f4\u6269\u5c55\u6027\u53ca\u7075\u6d3b\u6027\u3002</li> <li>\u5728\u6b64\u8282\u4e2d\u90e8\u5206\u5185\u5bb9\u9700\u8981\u8bfb\u8005\u5177\u5907\u4e00\u5b9a\u7684K8s\u7ecf\u9a8c\uff0c\u4f8b\u5982\u5176\u4e2d\u7684helm\u53ca\u76f8\u5173\u7684\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\uff0c\u5982\u679c\u524d\u671f\u4e86\u89e3\u540e\u671f\u4e1a\u52a1\u5fae\u670d\u52a1\u8bdd\u540e\u770b\u672c\u7ae0\u8282\u5185\u5bb9\u66f4\u4e3a\u5408\u9002\u3002</li> <li>\u6ce8\u610f\u5728\u5199rbac\u4e0epvc\u7684\u8d44\u6e90\u6e05\u5355\u7684\u540d\u79f0\u7a7a\u95f4\u4e3a\u4f60\u60f3\u90e8\u7f72\u4e1a\u52a1\u7684\u540d\u79f0\u7a7a\u95f4\uff0c\u5373\u4f8b\u5982\u4f60\u60f3\u628a\u8d44\u6e90\u6e05\u5355\u90e8\u7f72\u5728common\u540d\u79f0\u7a7a\u95f4\u4e0b\uff0c\u4f60\u5c31\u9700\u8981\u628apvc\u548crbac\u521b\u5efa\u5728common\u540d\u79f0\u7a7a\u95f4\u4e0b\uff0c\u5c06gitlab-runner\u6ce8\u518c\u5728common\u540d\u79f0\u7a7a\u95f4\u4e0b\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#_6","title":"\u516d \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u4e1a\u52a1\u5bb9\u5668\u5fae\u670d\u52a1\u5316\uff0c\u6216\u534a\u5fae\u670d\u52a1\u5316</li> <li>\u9700\u8981\u8fd0\u7ef4\u4eba\u5458\u5177\u6709\u8f83\u5f3a\u7684K8s\u8fd0\u7ef4\u80fd\u529b</li> <li>\u8ffd\u6c42\u6781\u81f4\u6301\u7eed\u96c6\u6210\u6301\u7eed\u4ea4\u4ed8\u4f53\u9a8cgitops\u8ffd\u5d07\u8005</li> <li>\u6709\u660e\u786e\u7684\u6d41\u7a0b\u89c4\u8303\uff0c\u4e0a\u7ebf\u90e8\u7f72\u89c4\u8303\u53ca\u660e\u786e\u53ef\u5faa\u7684\u6807\u51c6</li> </ul>"},{"location":"devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/#_7","title":"\u4e03 \u53cd\u601d","text":"<p>\u901a\u8fc7\u672c\u6b21\u654f\u6377\u65e0\u654c\u4e4bGitlab CI\u5b9e\u6218\uff0c\u518d\u6b21\u7b14\u8005\u611f\u8c22\u5927\u5bb6\u80fd\u591f\u4e86\u89e3Gitlab\u7684\u6b64\u7279\u6027\uff0c\u5982\u679c\u60a8\u7684\u516c\u53f8\u5728\u4f7f\u7528Gitlab\u5e76\u4e14\u6709\u4f7f\u7528\u5176\u4ed6\u7684CI\u5de5\u5177\uff0c \u56f0\u4e8e\u591a\u5957\u7cfb\u7edf\u7ef4\u62a4\u7684\u590d\u6742\u6027\uff0c\u4e0d\u59a8\u5c1d\u8bd5\u4e0bGitlab CI\u7b80\u5355\u96c6\u6210\uff0cGitops\u7684\u7aef\u5230\u7aef\u8fd0\u7ef4\u5de5\u4f5c\uff0c\u5728\u4e91\u539f\u751f\u65f6\u4ee3\uff0c\u5c06\u5de5\u5177\u6216\u4e2d\u95f4\u4ef6\u4e0b\u6c89\u5230\u57fa\u7840\u8bbe\u65bd\u4e2d\uff0c\u7528\u6237\u53ea\u9700\u8981\u4e13\u6ce8\u4e8e\u81ea\u8eab\u4e1a\u52a1\u7684\u5f00\u53d1,\u654f\u6377\u9ad8\u6548\u3001\u6587\u5316\u4e2d\u534f\u4f5c\u3001\u5feb\u901f\u8bd5\u9519\u3001\u5feb\u901f\u53cd\u9988\u3001\u6301\u7eed\u6539\u8fdb\u3001\u4e0d\u65ad\u8fed\u4ee3\uff0c\u4ee5Git\u4e3a\u6765\u6e90\u6253\u7834\u7814\u53d1\u4e0e\u8fd0\u7ef4\u58c1\u5792\u9694\u9602\uff0c\u5b9e\u73b0\u4ea7\u54c1\u66f4\u5feb\u3001\u66f4\u9891\u7e41\u3001\u66f4\u7a33\u5b9a\u7684\u4ea4\u4ed8\u3002</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/","title":"Gitlab CI\u4e4b\u5355\u5143\u6d4b\u8bd5\u548c\u4ee3\u7801\u626b\u63cf","text":""},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/#_1","title":"\u4e00 \u4ee3\u7801\u626b\u63cf","text":""},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/#11-sonarqube","title":"1.1 sonarqube\u89c4\u8303","text":"<p>\u7531\u4e8e\u9879\u76ee\u8f83\u591a\uff0csonarqube\u7684token\u5728\u7528\u6237\u4e0b\u5b9a\u4e49\uff0c\u8fd9\u6837\u591a\u9879\u76ee\u5c31\u53ef\u4ee5\u516c\u7528\u8fd9\u4e00\u4e2atoken</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/#12","title":"1.2 \u53d8\u91cf","text":"<ul> <li>SONAR_TOKEN\uff1asonarqube token\uff0c\u5728sonarqube \u670d\u52a1\u5668\u521b\u5efa\u5728\u7528\u6237\u4e0b\uff0c\u6240\u6709\u9879\u76ee\u7edf\u4e00\u7528\u6b64token\uff0c\u8be5\u53d8\u91cf\u8bbe\u7f6e\u5728gitlab \u670d\u52a1\u7aef\u73af\u5883\u53d8\u91cf\u4e2d\u3002* * * * </li> <li> <p>SONAR_HOST\uff1asonarqube \u670d\u52a1\u5668\u5730\u5740\uff0c\u5728\u8be5\u53d8\u91cf\u8bbe\u7f6e\u5728gitlab \u670d\u52a1\u7aef\u73af\u5883\u53d8\u91cf\u4e2d\u3002</p> </li> <li> <p>PROJECT_NAME\uff1a\u9879\u76ee\u540d\u79f0\uff0c\u653e\u5728\u5168\u5c40\u53d8\u91cf\u4e2d</p> </li> </ul>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/#13-ci","title":"1.3 CI\u6587\u4ef6","text":"<pre><code>.scan:\n  script:\n    - echo -e \"\\033[5;35;40m code scan \\033[0m\"\n    - sonar-scanner -Dsonar.projectKey=${PROJECT_NAME} -Dsonar.sources=. -Dsonar.host.url=${SONAR_HOST} -Dsonar.login=${SONAR_TOKEN}\n  retry:\n    max: 2\n    when:\n      - always\n  #parallel: 2\n  allow_failure: true\n</code></pre>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/#_2","title":"\u4e8c \u5355\u5143\u6d4b\u8bd5","text":"<p>\u5c06\u5355\u5143\u6d4b\u8bd5\u96c6\u6210\u5728CI\u7684test stage\u4e2d\uff0c\u7136\u540e\u5c06deploy pages\u96c6\u6210\u5728deploy\u6b65\u9aa4\u4e2d\u3002</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/#21-gitlab-pages","title":"2.1 Gitlab Pages\u5f00\u542f","text":"<p>\u5f00\u542fgitlab pages\u9700\u8981\u5728gitlab\u670d\u52a1\u7aef\u914d\u7f6e\u8fdb\u884c\u5f00\u542f\uff0c\u9700\u8981\u914d\u5408gitlab CI\u6765\u5b8c\u6210\uff0c\u9700\u8981\u6ce8\u610f\uff0c\u540d\u5b57\u5fc5\u987b\u4e3apages\uff0cstage\u5fc5\u987b\u4e3adeploy\u3002Gitlab pages\u4f1a\u4e00\u76f4\u53bb\u5728\u5f00\u542f\u4e86gitlab pages\uff0c\u8fd9\u4e2a\u5b58\u50a8\u5e93\u7684public\u76ee\u5f55\u627e\u9759\u6001\u6587\u4ef6\u73b0\u5b9e\u5728gitlab pages\u4e2d\uff0c\u6ce8\u610f\uff1a\u8fd9\u4e2apublic\u662f\u6307\u5b58\u50a8\u5e93\u7684public\uff0c\u4e0e\u9879\u76ee\u7ed3\u6784\u65e0\u5173\u3002\u6362\u8a00\u4e4b\uff0c\u8fd9\u4e2apublic\u76ee\u5f55\u4e0d\u53ef\u89c1\u3002</p> <ul> <li>\u542f\u7528gitlab pages</li> </ul> <p>\u7f16\u8f91/etc/gitlab/gitlab.rb,\u542f\u7528gitlab page</p> <pre><code>gitlab_pages['access_control'] = true\npages_external_url \"http://43.xx.xx.93:89\"\ngitlab_pages['enable'] = true\n</code></pre> <p>\u6267\u884c<code>gitlab-ctl reconfigure</code>\u751f\u6548\u542f\u7528pages,</p> <ul> <li>\u4f7f\u7528IP\u52a0\u7aef\u53e3\u65b9\u5f0f\u8bbf\u95ee</li> </ul> <p>\u4f46\u662f\u5982\u679c\u4f60\u4e0d\u60f3\u90a3\u4e48\u9ebb\u70e6\u8fd8\u5f97\u914d\u7f6e\u57df\u540d\u7684\u8bdd\uff0c\u8fd9\u91cc\u4e5f\u6709\u89e3\u51b3\u65b9\u6cd5\uff0c\u7531\u4e8eGitLab Pages\u670d\u52a1\u662f\u90e8\u7f72\u5230Nginx\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u540c\u914d\u7f6eNginx\u6765\u901a\u8fc7IP\u5730\u5740\u8bbf\u95ee\u3002</p> <p>\u9996\u5148\u8981\u627e\u554a\u627e\uff0c\u627e\u5230Pages\u7684\u53d1\u5e03\u4f4d\u7f6e\uff0c\u548cGitLab\u5185\u7f6eNginx\u7684\u4f4d\u7f6e\uff0c\u5206\u522b\u5982\u4e0b\uff1a</p> <p>1\u3001Pages\u90e8\u7f72\u76ee\u5f55\uff1a/var/opt/gitlab/gitlab-rails/shared/pages</p> <p>2\u3001\u5185\u7f6eNginx\u76ee\u5f55\uff1a/var/opt/gitlab/nginx</p> <p>\u4f7f\u7528IP\u52a0\u7aef\u53e3\u65b9\u5f0f\u8bbf\u95ee\uff0c\u9700\u8981\u914d\u7f6egitlab nginx\uff0c\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6/var/opt/gitlab/nginx/conf/gitlab-pages.conf</p> <pre><code>server {\n  listen *:89;\n  server_name  ~^(?&lt;group&gt;.*)\\.43\\.xxx\\.xxx\\.93$;\n  server_tokens off; ## Don't show the nginx version number, a security best practice\n\n  ## Disable symlink traversal\n  disable_symlinks on;\n  access_log  /var/log/gitlab/nginx/gitlab_pages_access.log gitlab_access;\n  error_log   /var/log/gitlab/nginx/gitlab_pages_error.log;\n\n  # Pass everything to pages daemon\n  location / {\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto http;\n    proxy_cache off;\n    root /var/opt/gitlab/gitlab-rails/shared/pages/devops;    \n    #proxy_pass          http://localhost:8090;\n  }\n  error_page 403 /403.html;\n  error_page 404 /404.html;\n}\n</code></pre> <p>\u4f7f\u7528restart\u6765\u91cd\u65b0\u751f\u6548<code>gitlab-ctl restart nginx</code>\u3002</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/#22","title":"2.2 \u6267\u884c\u5355\u5143\u6d4b\u8bd5","text":"<p>\u6267\u884c\u5355\u5143\u6d4b\u8bd5\u751f\u4ea7html\u62a5\u544a\uff0c\u751f\u6210\u9875\u9762\u6587\u4ef6\u5728coverage\u76ee\u5f55\u4e2d\u3002</p> <pre><code>test-dev:\n  image: python:3.6\n  variables:\n    RUN_PY: runtests.py\n    PROJECT_NAME: smartant_api_linux\n    PROJECT_GROUP: devops\n  tags:\n    - devops-dev-runner\n  stage: test-scan\n  script:\n    - echo -e \"\\033[5;35;40m code scan \\033[0m\"\n    - cd /builds/${PROJECT_GROUP}/${PROJECT_NAME}\n    - pip install --default-timeout=500 -r requirements/requirements.txt -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com            # \u5b89\u88c5\u73af\u5883\u4f9d\u8d56\n    - cd test &amp;&amp; coverage run --include=../application.py,../logs.py,../libs/*.py,../views/*.py  --omit=\"test_*.py\" ${RUN_PY} &amp;&amp; echo 0 || echo 0               # \u6267\u884c\u5355\u5143\u6d4b\u8bd5\n    - coverage report -m\n    - coverage html -d ../coverage  # \u751f\u4ea7\u62a5\u544a\n    - ls -l\n    - pwd\n  artifacts:\n    paths:\n      - coverage                # \u5c06\u62a5\u544a\u5b58\u50a8\u5728\u5236\u54c1\u4e2d\n  only:\n    - dev\n  retry:\n    max: 2\n    when:\n      - always\n  allow_failure: true\n</code></pre>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/#23-pages","title":"2.3 \u90e8\u7f72pages","text":"<p>\u4e0a\u4e00\u6b65\u5df2\u7ecf\u5b8c\u6210\u4e86\u5355\u5143\u6d4b\u8bd5\u5e76\u6839\u636e\u5355\u5143\u6d4b\u8bd5\u5b8c\u6210\u8986\u76d6html\u6587\u4ef6\u751f\u6210\uff0c\u5728\u6b64\u90e8\u7f72\u5c06pages\u8fdb\u884c\u90e8\u7f72\uff0c\u6ce8\u610f\uff1a\u540d\u5b57\u5fc5\u987b\u4e3apages\uff0c\u4e14stage\u4e3adeploy\uff0c\u5176\u4e2d\u8be5\u6b65\u9aa4\u4f9d\u8d56\u4e8e\u751f\u6210\u9759\u6001\u6587\u4ef6\u7684stage\uff0c\u5e76\u5c06\u5236\u54c1\u5728\u8be5\u6b65\u9aa4\u4e2d\u8fdb\u884c\u4f20\u9012\uff0c\u91cd\u547d\u540d\u4e3apublic\uff0c\u7531\u4e8e\u4e4b\u524d\u5df2\u7ecf\u914d\u7f6e\u4e86nginx\uff0c\u6b64\u523b\uff0c\u5229\u7528IP\u7aef\u53e3\u5c31\u80fd\u8bbf\u95ee\u5230public\u4e0b\u9762\u7684\u6587\u4ef6\u3002</p> <pre><code>pages:\n  variables:\n    PROJECT_NAME: smartant_api_linux\n  tags:\n    - devops-dev-runner\n  stage: deploy\n  dependencies:\n    - test-dev\n  script:\n    - echo -e \"\\033[5;35;40m deploy gitlab page \\033[0m\"\n    - mv coverage/ public/\n  artifacts:\n    expire_in: 3 days\n    paths:\n      - public/\n  only:\n    - dev\n</code></pre> <p></p> <p>\u8bbf\u95ee\uff1a\u901a\u8fc7\u9879\u76ee\u540d\u79f0+ public\u8fdb\u884c\u8bbf\u95ee\u3002</p> <p></p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/#_3","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://about.gitlab.com/blog/2016/11/03/publish-code-coverage-report-with-gitlab-pages/</li> <li>https://docs.gitlab.com/ee/user/project/pages/index.html</li> <li>https://gitlab.com/pages</li> <li>https://www.youtube.com/watch?v=dD8c7WNcc6s</li> <li>https://my.oschina.net/doctorlzr1988/blog/3044964</li> <li>https://docs.gitlab.com/ee/ci/yaml/#include</li> <li>https://docs.gitlab.com/ee/ci/yaml/includes.html</li> </ul>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/","title":"Gitlab CI\u8fdb\u9636\u4e4b\u5171\u4eabCI\u5e93","text":""},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u76ee\u524d\u5bf9\u4e8egitlab CI\u662f\u5728\u5355\u72ec\u7684\u9879\u76ee\u4e0b\u521b\u5efa.gitlab-ci.yaml\u6587\u4ef6\u6765\u5b9a\u4e49\u90e8\u7f72\u8fc7\u7a0b\uff0c\u5bf9\u4e8e\u5171\u540c\u7684\u4e00\u4e9b\u6b65\u9aa4\u6bd4\u5982\u6784\u5efa\u90e8\u7f72\u7b49\uff0c\u5728\u6bcf\u4e00\u4e2agitlab CI\u6587\u4ef6\u4e2d\u7f16\u5199\uff0c\u4e3a\u4e86\u80fd\u591f\u4f7f\u4ee3\u7801\u5728\u4e0d\u540c\u9879\u76ee\u590d\u7528\uff0c\u5c06\u5176\u5b58\u653e\u5728\u4e00\u4e2a\u4e13\u95e8\u7528\u4e8e\u6784\u5efa\u7684gitlab CI\u4ed3\u5e93\uff0c\u5176\u4ed6\u9879\u76ee\u60f3\u8981\u4f7f\u7528\u8be5stage\u53ef\u4ee5\u5f15\u7528\u516c\u5171\u7684CI\u6587\u4ef6\uff0c\u540e\u7eed\u4ec5\u9700\u8981\u7ef4\u62a4\u516c\u5171\u7684gitlab CI\u5e93\u5373\u53ef\uff0c\u4f46\u662f\u9700\u8981\u516c\u5171CI\u5e93\u5c06\u4e00\u4e9b\u7279\u5f81\u6570\u636e\u63d0\u53d6\u51fa\u6765\uff0c\u7531 CI \u786e\u4fdd\u4ee3\u7801\u98ce\u683c\u4e00\u81f4\uff0c\u5e76\u6267\u884c\u5355\u5143\u6d4b\u8bd5\u548c\u9759\u6001\u68c0\u67e5\u7b49\u3002\u7531\u4e8e\u4ed3\u5e93\u6570\u91cf\u4f17\u591a\uff0c\u5982\u4f55\u6709\u6548\u5730\u7ec4\u7ec7\u548c\u7ba1\u7406 CI \u914d\u7f6e\u6210\u4e86\u95ee\u9898\u3002\u7ecf\u8fc7\u957f\u65f6\u95f4\u7684\u63a2\u7d22\u548c\u4f18\u5316\uff0c\u6211\u6574\u7406\u4e86\u4e00\u4e9b\u7ecf\u9a8c\uff0c\u5e0c\u671b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002\u516c\u5171\u5e93\u9700\u8981\u8f83\u597d\u7684\u6269\u5c55\u6027\u4e0e\u517c\u5bb9\u6027\u3002</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#_2","title":"\u4e8c \u57fa\u7840\u8bed\u6cd5\u89e3\u6790","text":"<p>\u5728\u5171\u4eab\u4ed3\u5e93\u4e2d\u5c06\u5355\u4e2a\u64cd\u4f5c\u62bd\u8c61\u4e3a\u4e00\u4e2a\u539f\u5b50jobs\uff0c\u5355\u72ec\u5199\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u5728\u6a21\u7248\u4e2d\u5f15\u7528\u8fd9\u4e9b\u539f\u5b50jobs\uff0c\u6839\u636e\u4e0d\u540c\u7684\u53d8\u91cf\uff0ctags\u7684runner\uff0c\u53cabranch\u53ef\u4ee5\u4efb\u610f\u7ec4\u5408\u6210\u9700\u8981\u7684\u6a21\u7248\u3002\u5bf9\u6b64\u4e3b\u8981\u7528\u5230\u4e24\u4e2aGitlab CI\u4e2d\u7684\u5173\u952e\u5b57\uff0cinclude\u548cextends\u3002</p> <p>include\u548cextends\u662f\u914d\u5408\u4f7f\u7528\u7684\uff0cinclude\u4e3a\u5f15\u7528\u9879\u76ee\u4e2d\u7684yaml\u6587\u4ef6\uff0cextends\uff0c\u4e3a\u7ee7\u627f\u6587\u4ef6\u4e2d\u7684\u5177\u4f53jobs</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#21-include","title":"2.1 Include","text":""},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#211","title":"2.1.1 \u529f\u80fd","text":"<p>\u5229\u7528<code>include</code>\u5173\u952e\u5b57\u80fd\u591f\u5f15\u7528\u5176\u4ed6\u5916\u90e8\u7684yaml\u6587\u4ef6\uff0c\u8fd9\u6709\u52a9\u4e8e\u5c06CI/CD\u914d\u7f6e\u5206\u89e3\u4e3a\u591a\u4e2a\u6587\u4ef6\uff0c\u5e76\u63d0\u9ad8\u957f\u914d\u7f6e\u6587\u4ef6\u7684\u53ef\u8bfb\u6027\u3002</p> <ul> <li>\u53ef\u4ee5\u5c06\u901a\u7528\u7684\u4e00\u4e9b\u64cd\u4f5c\uff0c\u62bd\u8c61\u4e3a\u5355\u4e2a\u539f\u5b50jobs\uff0c\u7f16\u5199\u5171\u4eabgitlab ci\u5e93\uff0c\u5728\u6a21\u7248\u4e2dincloud\u8fd9\u4e9b\u539f\u5b50\u64cd\u4f5cjobs\uff0c\u6765\u7ec4\u5408\u6210\u6a21\u7248\u3002</li> <li>\u5728\u5355\u4e2a\u7684\u9879\u76ee\u4e2d\uff0c\u53ef\u4ee5include\u5171\u4eab\u5e93\u4e2d\u9884\u5b9a\u4e8e\u597d\u7684\u6a21\u7248\uff0c\u4ec5\u91cd\u5199\u9879\u76ee\u4e2d\u7684\u4e00\u4e9b\u53d8\u91cf\u5373\u53ef\u3002</li> </ul>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#212","title":"2.1.2 \u65b9\u5f0f","text":"<p>include\u52a0\u8f7d\u5176\u4ed6\u5916\u90e8yaml\u6587\u4ef6\uff0c\u6587\u4ef6\u540d\u79f0\u6269\u5c55\u5fc5\u987b\u4e3a<code>.yaml</code>\u6216<code>.yml</code>\u3002</p> <p>include\u652f\u6301\u52a0\u8f7d\u65b9\u6cd5\u5305\u542b\u4ee5\u4e0b\u56db\u79cd\uff1a</p> Method Description <code>local</code> Include a file from the local project repository. <code>file</code> Include a file from a different project repository. <code>remote</code> Include a file from a remote URL. Must be publicly accessible. <code>template</code> Include templates which are provided by GitLab."},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#213","title":"2.1.3 \u793a\u4f8b","text":"<ul> <li>include:local:</li> </ul> <p>include:\u672c\u5730\u5305\u542b\u4e0e.gitlab\u6765\u81ea\u540c\u4e00\u5b58\u50a8\u5e93\u7684\u6587\u4ef6-\u8bcdyml. \u5b83\u662f\u4f7f\u7528\u76f8\u5bf9\u4e8e\u6839\u76ee\u5f55\uff08/\uff09\u7684\u5b8c\u6574\u8def\u5f84\u5f15\u7528\u7684\u3002</p> <p>\u60a8\u53ea\u80fd\u5728\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u7684\u540c\u4e00\u5206\u652f\u4e0a\u4f7f\u7528Git\u5f53\u524d\u8ddf\u8e2a\u7684\u6587\u4ef6\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5f53\u4f7f\u7528\u5305\u62ec\uff1a\u672c\u5730\uff0c\u786e\u4fdd\u4e24\u8005\u90fd\u662f\u3002gitlab-\u8bcdyml\u672c\u5730\u6587\u4ef6\u5728\u540c\u4e00\u4e2a\u5206\u652f\u4e0a\u3002</p> <pre><code>include:\n  - local: '/templates/.gitlab-ci-template.yml'\n</code></pre> <p>\u6216\u8005\u7b80\u77ed\u7684\u65b9\u6cd5\uff1a</p> <pre><code>include: '.gitlab-ci-production.yml'\n</code></pre> <ul> <li>include:file</li> </ul> <p>\u8981\u5728\u540c\u4e00\u4e2aGitLab\u5b9e\u4f8b\u4e0b\u5305\u542b\u6765\u81ea\u53e6\u4e00\u4e2a\u79c1\u6709\u9879\u76ee\u7684\u6587\u4ef6\uff0c\u8bf7\u4f7f\u7528\u5305\u62ec\uff1a\u6587\u4ef6\u3002\u4f7f\u7528\u76f8\u5bf9\u4e8e\u6839\u76ee\u5f55\uff08/\uff09\u7684\u5b8c\u6574\u8def\u5f84\u5f15\u7528\u6b64\u6587\u4ef6\u3002\u4f8b\u5982\uff1a</p> <pre><code>include:\n  - project: 'my-group/my-project'\n    file: '/templates/.gitlab-ci-template.yml'\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u6307\u5b9aref.</p> <pre><code>include:\n  - project: 'my-group/my-project'\n    ref: master\n    file: '/templates/.gitlab-ci-template.yml'\n\n  - project: 'my-group/my-project'\n    ref: v1.0.0\n    file: '/templates/.gitlab-ci-template.yml'\n\n  - project: 'my-group/my-project'\n    ref: 787123b47f14b552955ca2786bc9542ae66fee5b # Git SHA\n    file: '/templates/.gitlab-ci-template.yml'\n</code></pre> <ul> <li>include:remote</li> </ul> <p>Remote\u7528\u4e8e\u5305\u542b\u6765\u81ea\u4e0d\u540c\u4f4d\u7f6e\u7684\u6587\u4ef6\uff0c\u4f7f\u7528HTTP/HTTPS\uff0c\u901a\u8fc7\u4f7f\u7528\u5b8c\u6574\u7684URL\u5f15\u7528\u3002\u8fdc\u7a0b\u6587\u4ef6\u5fc5\u987b\u901a\u8fc7\u7b80\u5355\u7684GET\u8bf7\u6c42\u516c\u5f00\u8bbf\u95ee\uff0c\u56e0\u4e3a\u8fdc\u7a0bURL\u4e2d\u7684\u8eab\u4efd\u9a8c\u8bc1\u67b6\u6784\u4e0d\u53d7\u652f\u6301\u3002\u4f8b\u5982\uff1a</p> <pre><code>include:\n  - remote: 'https://gitlab.com/awesome-project/raw/master/.gitlab-ci-template.yml'\n</code></pre> <ul> <li>include:template</li> </ul> <p>\u5229\u7528template\u53ef\u4ee5\u52a0\u8f7dgitlab\u4e0a\u5df2\u7ecf\u9884\u7f6e\u7684\u4e00\u4e9b\u6a21\u7248\uff0c</p> <p>https://gitlab.com/gitlab-org/gitlab/tree/master/lib/gitlab/ci/templates</p> <pre><code># File sourced from GitLab's template collection\ninclude:\n  - template: Auto-DevOps.gitlab-ci.yml\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5f15\u7528\u591a\u4e2a\u6a21\u7248</p> <pre><code>include:\n  - template: Android-Fastlane.gitlab-ci.yml\n  - template: Auto-DevOps.gitlab-ci.yml\n</code></pre>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#22-extends","title":"2.2 Extends","text":""},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#221","title":"2.2.1 \u529f\u80fd","text":"<p>\u53ef\u4ee5\u628a\u4e00\u4e9b\u516c\u5171\u5c5e\u6027\u6216\u8005\u65b9\u6cd5\uff08\u4e3b\u8981\u662fScript\uff09\u4e5f\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\u3002\u5c06\u5176\u62bd\u79bb\u5728\u5355\u72ec\u7684jobs\u4e2d\uff0c\u5728\u5177\u4f53\u7684stages\u4e2d\u8fdb\u884c\u7ee7\u627f\u3002</p> <p>extends\u5b9a\u4e49\u4f7f\u7528extends\u7684\u4f5c\u4e1a\u5c06\u4ece\u4e2d\u7ee7\u627f\u7684\u6761\u76ee\u540d\u3002</p> <p>\u5b83\u7684\u4f7f\u7528\u76f8\u8f83\u4e8eyaml anchors\uff0c\u66f4\u7075\u6d3b\u548c\u66f4\u6613\u8bfb\u3002</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#222","title":"2.2.2 \u793a\u4f8b","text":"<pre><code>.tests:\n  script: rake test\n  stage: test\n  only:\n    refs:\n      - branches\n\nrspec:\n  extends: .tests\n  script: rake rspec\n  only:\n    variables:\n      - $RSPEC\n</code></pre> <p>\u5728\u4e0a\u8ff0\u7684\u793a\u4f8b\u4e2d\uff0crspec \u7684job\u5185\u5d4c\u4e86.tests\u6a21\u7248\u7684job\uff0cgitlab\u5c06\u8981\u6267\u884c\u6df1\u5ea6\u5408\u5e76,\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>rspec:\n  script: rake rspec\n  stage: test\n  only:\n    refs:\n      - branches\n    variables:\n      - $RSPEC\n</code></pre>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#_3","title":"\u4e09 \u5b9e\u6218","text":""},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#31","title":"3.1 \u9879\u76ee\u7ed3\u6784","text":"<pre><code>\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 jobs                                # \u57fa\u7840jobs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 build.yaml                      # \u6784\u5efajobs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 check.yaml                      # k8s \u90e8\u7f72\u68c0\u6d4bjobs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 deploy.yaml                     # k8s \u90e8\u7f72jobs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 scan.yaml                       # k8s \u4ee3\u7801\u626b\u63cfjobs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 test.yaml                       # k8s dan\u5355\u5143\u6d4b\u8bd5jobs\n\u2514\u2500\u2500 templates                           # pipelines \u6a21\u7248\n    \u251c\u2500\u2500 backend-k8s-private.yaml        # \u79c1\u6709\u5316\u540e\u7aef\u90e8\u7f72\u6a21\u7248\n    \u251c\u2500\u2500 backend-k8s-saas.yaml           # saas\u540e\u7aef\u90e8\u7f72\u6a21\u7248\n    \u251c\u2500\u2500 frontend-k8s-private.yaml       # \u79c1\u6709\u5316\u524d\u7aef\u90e8\u7f72\u6a21\u7248\n    \u2514\u2500\u2500 frontend-k8s-saas.yaml          # saas\u524d\u7aef\u90e8\u7f72\u6a21\u7248\n</code></pre> <ul> <li>\u5c06\u539f\u5b50\u64cd\u4f5c\u62bd\u8c61\u6210\u5355\u4e2ajobs</li> <li>\u5728templates\u4e2d\u5b9a\u4e49\u540e\u7aef\u79c1\u6709\u5316\u51e0saas \u7684CI\u6a21\u7248\uff0c\u5728\u5176\u4e2d\u5f15\u7528</li> </ul>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#32-ci-jobs","title":"3.2 CI jobs\u53ca\u6a21\u7248","text":""},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#321-jobs","title":"3.2.1 jobs","text":"<p>\u5728jobs\u4e2d\u5b9a\u4e49\u539f\u5b50\u64cd\u4f5c\uff0c\u5728\u6b64\u5b9e\u4f8bbuild</p> <pre><code>.build:\n  script:\n    - echo -e \"\\033[5;35;40m Building Dockerfile-based application ${REGISTRY}/${NAMESPACE}/${APP_NAME}:${APP_TAG}... \\033[0m\"\n    - docker build -t \"${REGISTRY}/${NAMESPACE}/${APP_NAME}:${APP_TAG}\" .\n    - echo \"${REGISTRY_PWD}\" | docker login ${REGISTRY} -u \"${REGISTRY_USER}\" --password-stdin\n    - docker push \"${REGISTRY}/${NAMESPACE}/${APP_NAME}:${APP_TAG}\"\n    - docker rmi ${REGISTRY}/${NAMESPACE}/${APP_NAME}:${APP_TAG}\n  retry:\n    max: 2\n    when:\n      - always\n\n.upload:\n  script:\n    - cd /builds/${PROJECT_GROUP}\n    - tar -zcf /tmp/${PROJECT_NAME}.tgz ${PROJECT_NAME}\n    - coscmd config -a${ACCESS_ID} -s${ACCESS_KEY} -b${BUCKET} -r${REGION}\n    - coscmd upload /tmp/${PROJECT_NAME}.tgz ${OBJECT_PATH}/\n  retry:\n    max: 2\n    when:\n      - always\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u5176\u4e2d\u5b9a\u4e49build\u548cupload\u591a\u4e2a\u64cd\u4f5c\uff0c\u5728\u5176\u4e2d\u4e0d\u5b9a\u4e49stage/branch/tags\u7b49\u3002</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#322-templates","title":"3.2.2 templates","text":"<p>\u5728templates\u4e2d\u5b9a\u4e49\u4e0d\u540c\u573a\u666f\u7684CI\u6a21\u7248\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u81ea\u5df1\u6839\u636e\u9879\u76ee\u662f\u79c1\u6709\u5316\u90e8\u7f72\u6216\u662fsaas \u6765include\u4e0d\u540c\u7684jobs\u6587\u4ef6\uff0c\u5e76\u7ee7\u627f\u5176\u4e2d\u5177\u4f53jobs\u3002 </p> <p>\u5728\u81ea\u5b9a\u4e49\u6a21\u7248\u4e2d\uff0c\u4e3b\u8981\u5305\u542b\u56db\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>\u5bfc\u5165jobs\u7684yaml\u6587\u4ef6</li> <li>\u5b9a\u4e49\u5168\u5c40\u5c31stage\u4e2d\u53d8\u91cf</li> <li>\u5b9a\u4e49\u6a21\u7248\u8fd0\u884cCI\u7684stage</li> <li>\u5b9e\u73b0\u5177\u4f53stage\uff0c\u7ba1\u7406\u5177\u4f53stages\uff0c\u7ee7\u627fjobs\u3002</li> </ul> <p>\u5728\u6b64\u4e49deploy\u6765\u793a\u4f8b\uff1a</p> <pre><code># 1.\u5bfc\u5165\u4f5c\u4e1a\u6a21\u7248\ninclude:\n  - project: 'devops/gitlabci-templates'\n    ref: master\n    file: 'jobs/test.yaml'\n  - project: 'devops/gitlabci-templates'\n    ref: master\n    file: 'jobs/scan.yaml'\n  - project: 'devops/gitlabci-templates'\n    ref: master\n    file: 'jobs/build.yaml'\n  - project: 'devops/gitlabci-templates'\n    ref: master\n    file: 'jobs/deploy.yaml'\n  - project: 'devops/gitlabci-templates'\n    ref: master\n    file: 'jobs/check.yaml'\n\n# 2.\u5b9a\u4e49\u5168\u5c40\u53castage\u53d8\u91cf\nvariables:\n  # 2.1 \u5168\u5c40\u53d8\u91cf\n  # 2.1.1 \u5168\u5c40\u57fa\u672c\u4e0d\u7528\u4fee\u6539\u53d8\u91cf\n  # \u5168\u5c40\u9ed8\u8ba4\u6784\u5efa\u5bb9\u5668\n  IMAGE: docker:latest\n  # \u955c\u50cf\u4ed3\u5e93\n  REGISTRY: ccr.ccs.tencentyun.com\n  # gitlab\u9879\u76ee\u7ec4\n  PROJECT_GROUP: devops\n  # \u90e8\u7f72\u914d\u7f6e\n  DEPLOY_DIR: deploy\n  DEPLOY_NAME: deployment.yaml\n  # \u914d\u7f6e\u6587\u4ef6\n  CONFIG_DIR: cfg\n  CONFIG_KEY: config.yaml\n\n  # \u90e8\u7f72\u4e0d\u540c\u73af\u5883\u7684\u76ee\u5f55\n  DEV_ENV_DIR: dev\n  TEST_ENV_DIR: test\n  PROD_ENV_DIR: prod\n\n  # \u914d\u7f6enamespace\uff0c\u8be5\u540d\u79f0\u7a7a\u95f4\u5728\u955c\u50cf\u4ed3\u5e93\u548ck8s\u4e2d\u540d\u79f0\u7a7a\u95f4\u4fdd\u6301\u4e00\u81f4\n  DEV_NAMESPACE: anchnet-devops-dev\n  TEST_NAMESPACE: anchnet-devops-test\n  PROD_NAMESPACE: anchnet-devops-prod\n  # \u5b9a\u4e49\u5404\u9636\u6bb5\u4f7f\u7528\u955c\u50cf\n  SCAN_IMAGE: sonarsource/sonar-scanner-cli:latest\n  TEST_IMAGE: python:3.6\n  UPLOAD_IMAGE: ccr.ccs.tencentyun.com/anchnet-devops-common-test/python-coscmd:latest\n  DEPLOY_IMAGE: kubesphere/kubectl:v1.0.0\n  # \u5b9a\u4e49\u4e0a\u4f20\u5230cos\u914d\u7f6e\n  OBJECT_PATH: /smartant/saas\n  BUCKET: go2tencent-1253329830\n  REGION: ap-shanghai\n\n  # 2.1.2 \u5168\u5c40\u9700\u8981\u6839\u636e\u9879\u76ee\u81ea\u5b9a\u4e49\u53d8\u91cf\n  # \u4e3b\u8981\u7528\u4e8e\u5bf9k8s\u8d44\u6e90\u64cd\u4f5c\n  APP_NAME: smartant-backend\n  # \u9879\u76ee\u540d\u79f0\u4e0e\u4ee3\u7801\u4ed3\u5e93\u540d\u79f0\u4fdd\u6301\u4e00\u81f4\uff0c\u7528\u4e8e\u5bf9\u76ee\u5f55\u64cd\u4f5c\n  PROJECT_NAME: smartant_backend\n\n\n  # 2.2 \u5404\u4e2astage\u53d8\u91cf\n  # 2.2.1 \u4ee3\u7801\u626b\u63cf\u6d4b\u8bd5\uff0ctest-scan\u53d8\u91cf\n  REQUIREMENTS: requirements/requirements.txt\n  TEST_DIR: test\n  TEST_PARAM: --include=../application.py,../logs.py,../libs/*.py,../views/*.py  --omit=\"test_*.py\" runtests.py\n  # 2.2.2 \u6784\u5efa\u548c\u4e0a\u4f20\u6e90\u7801\u5230cos\uff0cbuild-upload\u53d8\u91cf\n\n\n  # 2.2.3 \u90e8\u7f72\u5230k8s\uff0cdeploy\u53d8\u91cf\n  DEV_CONFIG_FILE: config_dev.yaml\n  TEST_CONFIG_FILE: config_test.yaml\n  PROD_CONFIG_FILE: config_prod.yaml\n  # \u90e8\u7f72\u5728k8s\u4e2dk8s\u7684configmap\u540d\u79f0\uff0c\u4e00\u822c\u4e3aAPP_NAME-cm\n  CM_NAME: smartant-backend-cm\n\n  # 2.2.4 \u68c0\u67e5k8s deploy\u670d\u52a1\uff0ccheck\u53d8\u91cf\n\n\nbefore_script:\n  - export APP_TAG=\"${CI_COMMIT_TAG:-${CI_COMMIT_SHA::8}}\"\n\n# 3.\u914d\u7f6e\u8fd0\u884cstage\nstages:\n  - test-scan\n  - build-upload\n  - deploy\n  - check\n\n\n# 4.\u4f5c\u4e1a\u914d\u7f6e\n\nimage: ${IMAGE}\n\n\n# --------------test and scan stage----------------\n# dev\u73af\u5883\u4ee3\u7801\u626b\u63cf\nscan-dev:\n  image: ${SCAN_IMAGE}\n  tags:\n    - devops-dev-runner\n  stage: test-scan\n  extends: .scan\n  only:\n    - dev\n\n# dev\u73af\u5883\u5355\u5143\u6d4b\u8bd5\ntest-dev:\n  image: ${TEST_IMAGE}\n  tags:\n    - devops-dev-runner\n  stage: test-scan\n  extends: .test\n  only:\n    - dev\n\n\n# --------------build upload stage---------------\n# dev\u73af\u5883\u6784\u5efa\u955c\u50cf\nbuild-dev:\n  variables:\n    NAMESPACE: ${DEV_NAMESPACE}\n  tags:\n    - devops-dev-runner\n  stage: build-upload\n  extends: .build\n  only:\n    - dev\n\n\n# test\u73af\u5883\u6784\u5efa\u955c\u50cf\nbuild-test:\n  variables:\n    NAMESPACE: ${DEV_NAMESPACE}\n  tags:\n    - devops-test-runner\n  stage: build-upload\n  extends: .build\n  only:\n    - test\n\n# \u6b63\u5f0f\u73af\u5883\u6784\u5efa\u955c\u50cf\nbuild-prod:\n  variables:\n    NAMESPACE: ${PROD_NAMESPACE}\n  tags:\n    - devops-prod-runner\n  stage: build-upload\n  extends: .build\n  only:\n    - master\n\n# \u6b63\u5f0f\u73af\u5883\u6253\u5305\u4ee3\u7801\u4e0a\u4f20\u81f3cos\nupload-prod:\n  image: ${UPLOAD_IMAGE}\n  variables:\n    NAMESPACE: ${PROD_NAMESPACE}\n  tags:\n    - devops-prod-runner\n  stage: build-upload\n  extends: .upload\n  only:\n    - master\n\n# --------------deploy stage---------------\n# dev\u73af\u5883\u53d1\u5e03pages\npages:\n  tags:\n    - devops-dev-runner\n  stage: deploy\n  dependencies:\n    - test-dev\n  extends: .pages\n  only:\n    - dev\n\n# dev \u73af\u5883\u90e8\u7f72\ndeploy-dev:\n  image: ${DEPLOY_IMAGE}\n  variables:\n    NAMESPACE: ${DEV_NAMESPACE}\n    DEPLOY_ENV: ${DEV_ENV_DIR}\n    CONFIG_FILE: ${DEV_CONFIG_FILE}\n  tags:\n    - devops-dev-runner\n  stage: deploy\n  extends: .deploy\n  only:\n    - dev\n\n# test\u73af\u5883\u90e8\u7f72\ndeploy-test:\n  image: ${DEPLOY_IMAGE}\n  variables:\n    NAMESPACE: ${TEST_NAMESPACE}\n    DEPLOY_ENV: ${DEV_ENV_DIR}\n    CONFIG_FILE: ${DEV_CONFIG_FILE}\n  tags:\n    - devops-test-runner\n  stage: deploy\n  extends: .deploy\n  only:\n    - test\n\n# --------------check stage---------------\n# dev\u73af\u5883k8s\u6d4b\u8bd5\ncheck-dev:\n  image: ${DEPLOY_IMAGE}\n  variables:\n    NAMESPACE: ${DEV_NAMESPACE}\n  tags:\n    - devops-dev-runner\n  stage: check\n  extends: .check\n  only:\n    - dev\n\n# test\u73af\u5883k8s\u6d4b\u8bd5\ncheck-test:\n  image: ${DEPLOY_IMAGE}\n  variables:\n    NAMESPACE: ${TEST_NAMESPACE}\n  tags:\n    - devops-test-runner\n  stage: check\n  extends: .check\n  only:\n    - test\n</code></pre> <p>\u5728\u8be5\u6a21\u7248\u4e2d\u5229\u7528stage\u4e2d\u7684image/tags/runner/branch\u8fdb\u884c\u7075\u6d3b\u7ec4\u5408\uff0c\u4ece\u800c\u5b9e\u73b0\u9002\u5e94\u4e0d\u540c\u573a\u666f\u7684CI\u3002</p> <p>\u81f3\u6b64\u5171\u4eabCI\u6a21\u7248\u5e93\u5c31\u5df2\u7ecf\u521b\u5efa\u5b8c\u6210\uff0c\u9700\u8981\u5728\u5177\u4f53\u7684\u9879\u76ee\u4e2d\u8fdb\u884c\u5e94\u7528\u3002</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#33","title":"3.3 \u9879\u76ee\u4e2d\u5f15\u7528","text":"<p>\u5728\u5177\u4f53\u7684\u9879\u76ee\u4e2d\u5f15\u7528\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u4ee3\u7801\u4ed3\u5e93\u4e2d\u7f16\u5199<code>.gitlab-ci.yaml</code>\u5373\u53ef\u5b9e\u73b0CI\u7ee7\u627f\uff0c\u5728\u6b64\u6211\u4eec\u793a\u4f8b\u4e00\u4e2apython\u7684\u540e\u7aefsaas\u9879\u76ee\uff0c\u7ee7\u627fbackend\u7684saas\u6a21\u7248\u3002</p> <pre><code>include:\n  - project: 'devops/gitlabci-templates'\n    ref: master\n    file: 'templates/backend-k8s-saas.yaml'\n\nvariables:\n  APP_NAME: smartant-api-linux\n  # \u9879\u76ee\u540d\u79f0\u4e0e\u4ee3\u7801\u4ed3\u5e93\u540d\u79f0\u4fdd\u6301\u4e00\u81f4\uff0c\u7528\u4e8e\u5bf9\u76ee\u5f55\u64cd\u4f5c\n  PROJECT_NAME: smartant_api_linux\n\n  # 2.2 \u5404\u4e2astage\u53d8\u91cf\n  # 2.2.1 \u4ee3\u7801\u626b\u63cf\u6d4b\u8bd5\uff0ctest-scan\u53d8\u91cf\n  REQUIREMENTS: requirements/requirements.txt\n  TEST_DIR: test\n  TEST_PARAM: --include=../application.py,../logs.py,../libs/*.py,../views/*.py  --omit=\"test_*.py\" runtests.py\n  # 2.2.2 \u6784\u5efa\u548c\u4e0a\u4f20\u6e90\u7801\u5230cos\uff0cbuild-upload\u53d8\u91cf\n\n  # 2.2.3 \u90e8\u7f72\u5230k8s\uff0cdeploy\u53d8\u91cf\n  DEV_CONFIG_FILE: config_dev.yaml\n  TEST_CONFIG_FILE: config_test.yaml\n  PROD_CONFIG_FILE: config_prod.yaml\n  # \u90e8\u7f72\u5728k8s\u4e2dk8s\u7684configmap\u540d\u79f0\uff0c\u4e00\u822c\u4e3aAPP_NAME-cm\n  CM_NAME: smartant-api-linux-cm\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5728\u5177\u4f53\u7684\u9879\u76ee\u4e2d\u96c6\u6210gitlab CI\u5f15\u7528\u6a21\u7248\u5e93\u975e\u5e38\u7684\u7b80\u5355\uff0c\u53ea\u7528\u5f15\u7528\u6587\u4ef6\uff0c\u5e76\u6839\u636e\u9879\u76ee\u6765\u5b9a\u4e49\u53d8\u91cf\u5373\u53ef\u5b8c\u6210\u96c6\u6210\u3002</p> <p></p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#_4","title":"\u56db \u6ce8\u610f\u4e8b\u9879","text":""},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#41","title":"4.1 \u5f15\u7528\u6ce8\u610f","text":"<ul> <li>\u5f15\u7528\u7684\u65f6\u5019\u5982\u679c\u4e3a\u540c\u4e00\u4e2a\u4ed3\u5e93\u53ef\u4ee5\u4f7f\u7528include:local\u8fdb\u884c\u540c\u4e00\u4e2a\u4ed3\u5e93\u6587\u4ef6\u672c\u5730\u5f15\u7528</li> <li>\u5bf9\u4e8e\u5728\u540c\u4e00\u4e2agitlab\u670d\u52a1\u5668\u4e0a\u7684\u9879\u76ee\uff0c\u53ef\u4ee5\u4f7f\u7528project\u6765\u5f15\u7528\uff0c\u6ce8\u610f\u5f15\u7528\u672b\u5c3e\u6ca1\u6709.git</li> </ul>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#42","title":"4.2 \u5171\u4eab\u5e93\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>jobs\u4e2d\u7684\u539f\u5b50\u64cd\u4f5c\u4e0d\u7528\u5b9a\u4e49stages\uff0c\u548cbranch\uff0c\u53ca\u8fd0\u884c\u7684gitlab runner\u7684tags</li> <li>\u5c06\u516c\u5171\u53d8\u91cf\u63d0\u51fa\u6765\uff0c\u5c06\u6839\u636e\u9879\u76ee\u5b9a\u4e49\u7684\u53d8\u91cf\u4e5f\u63d0\u51fa\u6765\uff0c\u63d0\u9ad8\u5171\u4eab\u5e93\u7684\u53ef\u6269\u5c55\u6027\u53ca\u7075\u6d3b\u6027</li> <li>\u5728\u5177\u4f53\u9879\u76ee\u4e2d\u5f15\u7528\u6a21\u7248\uff0c\u91cd\u65b0\u5b9a\u4e49\u53d8\u91cf\uff0c\u5c06\u8986\u76d6\u5168\u5c40\u53d8\u91cf</li> </ul>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#_5","title":"\u4e94 \u53cd\u601d","text":"<p>\u4e3a\u4e86\u63d0\u5347CI\u590d\u7528\u6027\u548c\u6269\u5c55\u6027\u53ca\u89c4\u8303CI\u6d41\u7a0b\uff0cgitlab CI\u5171\u4eab\u5e93\u975e\u5e38\u597d\u7684\u89e3\u51b3\u4e86\u6b64\u95ee\u9898\uff0c\u4f46\u662f\u8981\u6c42\u7f16\u5199\u7684\u5177\u4f53jobs\u9700\u8981\u80fd\u65e0\u72b6\u6001\u5316\uff0c\u9700\u8981\u5177\u5907\u5f88\u9ad8\u7684\u6269\u5c55\u6027\u548c\u7ef4\u62a4\u884c\uff0c\u5bf9\u4e8e\u524d\u671f\u7684\u89c4\u5212\u548c\u7f16\u5199jobs\u90fd\u63d0\u51fa\u4e86\u5f88\u9ad8\u7684\u8981\u6c42\u3002</p>"},{"location":"devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/#_6","title":"\u516d \u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://docs.gitlab.com/ee/ci/yaml/#include</li> <li>https://docs.gitlab.com/ee/ci/yaml/includes.html</li> <li>https://www.jianshu.com/p/cc07db6de12d</li> </ul>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/","title":"IaC\u626b\u63cf\u5de5\u5177\u4e4bTerrascan","text":""},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>\u5bf9\u4e8e\u57fa\u7840\u8bbe\u65bd\uff0c\u4f8b\u5982dockerfile/kubernetes\u8d44\u6e90\u6e05\u5355\uff0c\u8fd8\u6709terraform.tf \u6587\u4ef6\uff0c\u9700\u8981\u8fdb\u884c\u68c0\u6d4b\u626b\u63cf\u3002</p>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#terrasacn","title":"\u4e8c Terrasacn\u7b80\u4ecb","text":""},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#21-terrascan","title":"2.1 Terrascan\u7b80\u4ecb","text":"<p>Terrascan \u662f\u57fa\u7840\u67b6\u6784\u5373\u4ee3\u7801\u7684\u9759\u6001\u4ee3\u7801\u5206\u6790\u5668\u3002\u5b83\u53ef\u4ee5\u4ee5\u591a\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u5b89\u88c5\u548c\u8fd0\u884c\uff0c\u6700\u5e38\u7528\u4e8e\u81ea\u52a8\u5316\u7ba1\u9053\u4e2d\uff0c\u4ee5\u5728\u914d\u7f6e\u4e0d\u5b89\u5168\u7684\u57fa\u7840\u67b6\u6784\u4e4b\u524d\u8bc6\u522b\u7b56\u7565\u8fdd\u89c4\u884c\u4e3a\u3002</p>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#22","title":"2.2 \u7279\u6027","text":"<p>Terrascan \u662f\u57fa\u7840\u67b6\u6784\u5373\u4ee3\u7801\u7684\u9759\u6001\u4ee3\u7801\u5206\u6790\u5668\u3002 Terrascan \u5141\u8bb8\u60a8\uff1a</p> <ul> <li>\u65e0\u7f1d\u5730\u626b\u63cf\u57fa\u7840\u8bbe\u65bd\u4f5c\u4e3a\u9519\u8bef\u914d\u7f6e\u7684\u4ee3\u7801\u3002</li> <li>\u76d1\u89c6\u6709\u51c6\u5907\u7684\u4e91\u57fa\u7840\u8bbe\u65bd\uff0c\u4ee5\u9632\u6b62\u5f15\u5165\u59ff\u6001\u6f02\u79fb\u7684\u914d\u7f6e\u66f4\u6539\uff0c\u5e76\u652f\u6301\u6062\u590d\u5230\u5b89\u5168\u59ff\u6001\u3002</li> <li>\u68c0\u6d4b\u5b89\u5168\u6f0f\u6d1e\u548c\u8fdd\u89c4\u884c\u4e3a\u3002</li> <li>\u5728\u63d0\u4f9b\u4e91\u672c\u5730\u57fa\u7840\u8bbe\u65bd\u4e4b\u524d\u964d\u4f4e\u98ce\u9669\u3002</li> <li>\u63d0\u4f9b\u672c\u5730\u8fd0\u884c\u6216\u4e0e CI CD \u96c6\u6210\u7684\u7075\u6d3b\u6027\u3002</li> </ul>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#_2","title":"\u4e09 \u5b89\u88c5","text":"<p>Terrascan \u662f\u4e00\u4e2a\u53ef\u79fb\u690d\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u5b89\u88c5\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a Docker Hub \u4e2d\u7684\u5bb9\u5668\u955c\u50cf\u4f7f\u7528\u3002\u60a8\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u559c\u597d\u4ee5\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\u4f7f\u7528 Terrascan\uff1a</p>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#31-macos-linux","title":"3.1 macOS &amp; Linux","text":"<pre><code>$ curl -L \"$(curl -s https://api.github.com/repos/accurics/terrascan/releases/latest | grep -o -E \"https://.+?_Darwin_x86_64.tar.gz\")\" &gt; terrascan.tar.gz\n$ tar -xf terrascan.tar.gz terrascan &amp;&amp; rm terrascan.tar.gz\n$ install terrascan /usr/local/bin &amp;&amp; rm terrascan\n$ terrascan\n</code></pre>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#32-docker","title":"3.2 Docker","text":"<pre><code>$ docker run --rm accurics/terrascan version\n\n$ alias terrascan=\"docker run --rm -it -v \"$(pwd):/iac\" -w /iac accurics/terrascan\"\n</code></pre>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#_3","title":"\u56db \u4f7f\u7528","text":""},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#41","title":"4.1 \u547d\u4ee4\u884c\u6a21\u5f0f","text":"<pre><code>$ terrascan\nTerrascan\n\nDetect compliance and security violations across Infrastructure as Code to mitigate risk before provisioning cloud native infrastructure.\nFor more information, please visit https://docs.accurics.com\n\nUsage:\n  terrascan [command]\n\nAvailable Commands:\n  help        Provides usage info about any command\n  init        Initialize Terrascan\n  scan        Start scan to detect compliance and security violations across Infrastructure as Code.\n  server      Run Terrascan as an API server\n  version     Shows the Terrascan version you are currently using.\n\nFlags:\n  -c, --config-path string   config file path\n  -h, --help                 help for terrascan\n  -l, --log-level string     log level (debug, info, warn, error, panic, fatal) (default \"info\")\n  -x, --log-type string      log output type (console, json) (default \"console\")\n  -o, --output string        output type (human, json, yaml, xml) (default \"human\")\n\nUse \"terrascan [command] --help\" for more information about a command.\n</code></pre> <p>\u5236\u5b9a\u7279\u5b9aprovider\u626b\u63cf</p> <pre><code># \u626b\u63cfaws\n$ terrascan scan -t aws\n# \u626b\u63cfk8s\n$ terrascan scan -i k8s\n# \u8fdc\u7a0b\u626b\u63cf\n$ terrascan scan -t aws -r git -u git@github.com:accurics/KaiMonkey.git//terraform/aws\n# \u626b\u63cfhelm chart\n$ terrascan scan -i helm\n# \u626b\u63cfdockerfile\n$ terrascan scan -i docker\n</code></pre>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#42","title":"4.2 \u670d\u52a1\u7aef\u6a21\u5f0f","text":"<p>\u670d\u52a1\u5668\u6a21\u5f0f\u5c06\u6267\u884c Terrascan \u7684 API \u670d\u52a1\u5668\u3002\u5f53\u4f7f\u7528 Terrascan \u5728\u8f6f\u4ef6\u5f00\u53d1\u7ba1\u9053\u7684\u591a\u4e2a\u90e8\u5206\u5b9e\u65bd\u4e00\u5957\u7edf\u4e00\u7684\u7b56\u7565\u548c\u914d\u7f6e\u65f6\uff0c\u8fd9\u662f\u975e\u5e38\u6709\u7528\u7684\u3002\u5b83\u8fd8\u7b80\u5316\u4e86\u4e0e Terrascan \u7684\u7a0b\u5e8f\u4ea4\u4e92\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0chttp \u670d\u52a1\u5668\u76d1\u542c\u7aef\u53e39010\u5e76\u652f\u6301\u4ee5\u4e0b\u8def\u7531:</p> <ul> <li>\u626b\u63cfIaC File</li> </ul> <pre><code>POST - /v1/{iac}/{iacVersion}/{cloud}/local/file/scan\n</code></pre> <p>POST Parameter: <code>file</code> - Content of the file to be scanned</p> <pre><code>Example: curl -i -F \"file=@aws_cloudfront_distribution.tf\" localhost:9010/v1/terraform/v14/aws/local/file/scan\n</code></pre> <ul> <li>\u8fd0\u884cTerrascan\u4e3a\u670d\u52a1\u7aef\u6a21\u5f0f</li> </ul> <pre><code>$ terrascan server\n$ docker run --rm --name terrascan -p 9010:9010 accurics/terrascan\n</code></pre> <ul> <li>\u8bf7\u6c42\u793a\u4f8b\u5b50</li> </ul> <pre><code>$ curl -i -F \"file=@aws_cloudfront_distribution.tf\" localhost:9010/v1/terraform/v14/aws/local/file/scan\nHTTP/1.1 100 Continue\n\nHTTP/1.1 200 OK\nDate: Sun, 16 Aug 2020 02:45:35 GMT\nContent-Type: text/plain; charset=utf-8\nTransfer-Encoding: chunked\n\n{\n  \"results\": {\n    \"violations\": [\n      {\n        \"rule_name\": \"cloudfrontNoGeoRestriction\",\n        \"description\": \"Ensure that geo restriction is enabled for your Amazon CloudFront CDN distribution to whitelist or blacklist a country in order to allow or restrict users in specific locations from accessing web application content.\",\n        \"rule_id\": \"AWS.CloudFront.Network Security.Low.0568\",\n        \"severity\": \"LOW\",\n        \"category\": \"Network Security\",\n        \"resource_name\": \"s3-distribution-TLS-v1\",\n        \"resource_type\": \"aws_cloudfront_distribution\",\n        \"file\": \"terrascan-492583054.tf\",\n        \"line\": 7\n      },\n      {\n        \"rule_name\": \"cloudfrontNoHTTPSTraffic\",\n        \"description\": \"Use encrypted connection between CloudFront and origin server\",\n        \"rule_id\": \"AWS.CloudFront.EncryptionandKeyManagement.High.0407\",\n        \"severity\": \"HIGH\",\n        \"category\": \"Encryption and Key Management\",\n        \"resource_name\": \"s3-distribution-TLS-v1\",\n        \"resource_type\": \"aws_cloudfront_distribution\",\n        \"file\": \"terrascan-492583054.tf\",\n        \"line\": 7\n      },\n      {\n        \"rule_name\": \"cloudfrontNoHTTPSTraffic\",\n        \"description\": \"Use encrypted connection between CloudFront and origin server\",\n        \"rule_id\": \"AWS.CloudFront.EncryptionandKeyManagement.High.0407\",\n        \"severity\": \"HIGH\",\n        \"category\": \"Encryption and Key Management\",\n        \"resource_name\": \"s3-distribution-TLS-v1\",\n        \"resource_type\": \"aws_cloudfront_distribution\",\n        \"file\": \"terrascan-492583054.tf\",\n        \"line\": 7\n      },\n      {\n        \"rule_name\": \"cloudfrontNoLogging\",\n        \"description\": \"Ensure that your AWS Cloudfront distributions have the Logging feature enabled in order to track all viewer requests for the content delivered through the Content Delivery Network (CDN).\",\n        \"rule_id\": \"AWS.CloudFront.Logging.Medium.0567\",\n        \"severity\": \"MEDIUM\",\n        \"category\": \"Logging\",\n        \"resource_name\": \"s3-distribution-TLS-v1\",\n        \"resource_type\": \"aws_cloudfront_distribution\",\n        \"file\": \"terrascan-492583054.tf\",\n        \"line\": 7\n      },\n      {\n        \"rule_name\": \"cloudfrontNoSecureCiphers\",\n        \"description\": \"Secure ciphers are not used in CloudFront distribution\",\n        \"rule_id\": \"AWS.CloudFront.EncryptionandKeyManagement.High.0408\",\n        \"severity\": \"HIGH\",\n        \"category\": \"Encryption and Key Management\",\n        \"resource_name\": \"s3-distribution-TLS-v1\",\n        \"resource_type\": \"aws_cloudfront_distribution\",\n        \"file\": \"terrascan-492583054.tf\",\n        \"line\": 7\n      }\n    ],\n    \"count\": {\n      \"low\": 1,\n      \"medium\": 1,\n      \"high\": 3,\n      \"total\": 5\n    }\n  }\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#cicd","title":"\u4e94 CI/CD\u96c6\u6210","text":""},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#51-gitlab-ci","title":"5.1 Gitlab CI","text":"<p>GitLab CI \u53ef\u4ee5\u4f7f\u7528 Docker \u955c\u50cf\u4f5c\u4e3a\u7ba1\u9053\u7684\u4e00\u90e8\u5206\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u6b64\u529f\u80fd\u5e76\u5c06 Terrascan \u7684 docker \u6620\u50cf\u7528\u4f5c\u7ba1\u9053\u7684\u4e00\u90e8\u5206\uff0c\u4ee5\u5c06\u57fa\u7840\u8bbe\u65bd\u4f5c\u4e3a\u4ee3\u7801\u8fdb\u884c\u626b\u63cf\u3002</p> <p>\u4e3a\u6b64\uff0c\u60a8\u53ef\u4ee5\u66f4\u65b0\u60a8\u7684\u3002gitlab ci\u3002yml\u6587\u4ef6\u4f7f\u7528\u5e26\u6709[\u201cbin/sh\u201d\u3001\u201c-c\u201d]\u5165\u53e3\u70b9\u7684\u201caccurics/terrascan:latest\u201d\u56fe\u50cf\u3002Terrascan\u53ef\u4ee5\u5728\u56fe\u50cf\u4e2d\u7684\u201c/go/bin\u201d\u4e0a\u627e\u5230\uff0c\u60a8\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4f7f\u7528\u4efb\u4f55Terrascan\u547d\u4ee4\u884c\u9009\u9879\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5b50\u3002gitlab ci\u3002yml\u6587\u4ef6\uff1a</p> <pre><code>stages:\n  - scan\n\nterrascan:\n  image:\n    name: accurics/terrascan:latest\n    entrypoint: [\"/bin/sh\", \"-c\"]\n  stage: scan\n  script:\n    - /go/bin/terrascan scan .\n</code></pre>"},{"location":"devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/#_4","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.freebuf.com/articles/web/256898.html</li> <li>https://github.com/accurics/terrascan</li> <li>https://docs.accurics.com/projects/accurics-terrascan/en/latest/</li> </ul>"},{"location":"devops/IaC/Terraform/IaC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B9%8BTerratest/","title":"IaC\u6d4b\u8bd5\u5de5\u5177\u4e4bTerratest","text":""},{"location":"devops/IaC/Terraform/IaC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B9%8BTerratest/#_1","title":"\u4e8c \u7b80\u4ecb","text":"<p>Terratest \u662f\u4e00\u4e2a\u5f00\u6e90\u7684 Go \u8bed\u8a00\u5e93\uff0c\u53ef\u66f4\u8f7b\u677e\u5730\u4e3a\u57fa\u7840\u8bbe\u65bd\u4ee3\u7801\u7f16\u5199\u81ea\u52a8\u5316\u6d4b\u8bd5\u3002\u5b83\u4e3a\u901a\u7528\u57fa\u7840\u8bbe\u65bd\u7684\u6d4b\u8bd5\u4efb\u52a1\u63d0\u4f9b\u4e86\u5404\u79cd\u5e2e\u52a9\u51fd\u6570\u548c\u6a21\u5f0f\uff0c\u5176\u4e2d\u5305\u62ec\uff1a</p> <ul> <li>\u6d4b\u8bd5 Terraform \u4ee3\u7801</li> <li>\u6d4b\u8bd5\u6253\u5305\u5668\u6a21\u677f</li> <li>\u6d4b\u8bd5 Docker \u955c\u50cf</li> <li>\u901a\u8fc7 SSH \u5728\u670d\u52a1\u5668\u4e0a\u6267\u884c\u547d\u4ee4</li> <li>\u4f7f\u7528 AWS API</li> <li>\u53d1\u9001 HTTP \u8bf7\u6c42</li> <li>\u8fd0\u884c shell \u547d\u4ee4</li> </ul> <p>\u8fd9\u91cc\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6765\u8bf4\u660e\u5982\u4f55\u6d4b\u8bd5\u4e00\u4e9b Terraform \u4ee3\u7801\uff1a</p>"},{"location":"devops/IaC/Terraform/IaC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B9%8BTerratest/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.oschina.net/p/terratest?hmsr=aladdin1e1</li> <li>https://docs.microsoft.com/zh-cn/azure/developer/terraform/test-modules-using-terratest</li> </ul>"},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/","title":"Terraform\u4f7f\u7528cloud init\u5b8c\u6210\u7aef\u5230\u7aef\u57fa\u7840\u8bbe\u65bd\u7f16\u6392","text":""},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#terraformcloud-init","title":"Terraform\u4f7f\u7528cloud-init\u5b8c\u6210\u7aef\u5230\u7aef\u57fa\u7840\u8bbe\u65bd\u7f16\u6392","text":""},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>Terraform\u603b\u6240\u5468\u77e5\uff0c\u5df2\u6210\u4e3a\u4e91\u4e0a\u57fa\u7840\u8bbe\u65bd\u7f16\u6392\u7684\u7684\u884c\u4e1a\u6807\u51c6\uff0c\u4f46\u5176\u66f4\u591a\u7684\u5173\u6ce8\u70b9\u805a\u7126\u5728\u652f\u6301\u7684provider\u7684\u5404\u7c7b\u8d44\u6e90\u7f16\u6392\uff0c\u5bf9\u4e8e\u7f16\u6392\u51fa\u6765\u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u5bf9\u5176\u5185\u90e8\u7684\u914d\u7f6e\u53d8\u66f4\uff0c\u9700\u8981\u914d\u5408\u5176\u4ed6\u914d\u7f6e\u7ba1\u7406\u5de5\u5177\u8fdb\u884c\u6574\u5408\u4f7f\u7528\uff0c\u4ee5\u8fbe\u5230\u7aef\u5230\u7aef\u7684\u914d\u7f6e\u3002</p>"},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_2","title":"\u4e8c \u76f8\u5173\u6982\u5ff5","text":""},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#21-cloud-init","title":"2.1 cloud-init","text":"<p>cloud-init \u662f\u5927\u591a\u6570 Linux \u53d1\u884c\u7248\u548c\u6240\u6709\u4e3b\u8981\u4e91\u63d0\u4f9b\u5546\u90fd\u63d0\u4f9b\u7684\u6807\u51c6\u914d\u7f6e\u652f\u6301\u5de5\u5177\u3002 cloud-init \u5141\u8bb8\u60a8\u5c06 shell \u811a\u672c\u4f20\u9012\u7ed9\u60a8\u7684\u5b9e\u4f8b\uff0c\u8be5\u5b9e\u4f8b\u6839\u636e\u60a8\u7684\u89c4\u8303\u5b89\u88c5\u6216\u914d\u7f6e\u673a\u5668\u3002\u5f00\u901a\u670d\u52a1\u5668\uff0c\u5c06cloud-init\u5185\u5bb9\u653e\u5230\u5b9e\u4f8b\u7684meta_data \u4e2d\uff0c\u901a\u8fc7\u670d\u52a1\u5668\u8fdb\u884c\u670d\u52a1\u5185\u90e8\u914d\u7f6e\u7ba1\u7406\u3002</p>"},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_3","title":"\u4e09 \u573a\u666f","text":"<p>\u5229\u7528terraform\u7f16\u6392\u51fa\u817e\u8baf\u4e91\u670d\u52a1\u5668\uff0c\u5e76\u901a\u8fc7cloud-init \u5728\u670d\u52a1\u5668\u5185\u90e8\u8fdb\u884c\u914d\u7f6e\u3002</p>"},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_4","title":"\u56db \u6d41\u7a0b","text":"<ul> <li>\u5728\u670d\u52a1\u5668\u7684metadata\u4e2d\u586b\u5199\u811a\u672c\u6267\u884c\u5185\u5bb9\uff0c\u901a\u8fc7\u7f16\u6392\u5b9e\u73b0\u3002</li> </ul>"},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_5","title":"\u4e94 \u5b9e\u6218","text":""},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#51-tf","title":"5.1 \u7f16\u5199TF\u4ee3\u7801","text":"<pre><code>locals {\n  cidr_block_vpc_name    = \"10.0.0.0/16\"\n  cidr_block_subnet_name = \"10.0.1.0/24\"\n  count                  = 2\n  metadata_file = \"add-ssh-web-app.sh\"\n}\n\ndata \"template_file\" \"user_data\" {\n\n  template = file(format(\"./scripts/%s\", local.metadata_file))\n}\n\ndata \"tencentcloud_images\" \"image\" {\n  image_type = [\"PUBLIC_IMAGE\"]\n  os_name    = \"centos 7.5\"\n}\n\ndata \"tencentcloud_instance_types\" \"instanceType\" {\n  cpu_core_count = 1\n  memory_size    = 1\n  filter {\n    name   = \"instance-family\"\n    values = [\"S3\"]\n  }\n}\n\ndata \"tencentcloud_availability_zones\" \"zone\" {}\n\nresource \"tencentcloud_vpc\" \"vpc\" {\n  cidr_block = local.cidr_block_vpc_name\n  name       = \"xuel_tf_vpc\"\n}\n\nresource \"tencentcloud_subnet\" \"subnet\" {\n  availability_zone = data.tencentcloud_availability_zones.zone.zones.0.name\n  cidr_block        = local.cidr_block_subnet_name\n  name              = \"xuel_tf_subnet\"\n  vpc_id            = tencentcloud_vpc.vpc.id\n}\n\nresource \"tencentcloud_key_pair\" \"xuel-tf-key\" {\n  key_name   = \"xueltfkey\"\n  public_key = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDCcJxzfjqQDikRRShExu22kvNOfMKeWrn++s5nQMTm+9SNsQISEk+P15JhFVachgjumupMcOIrfJQAAQcnzNmxoRCTCJQfmegGpDZVpE1cyHUhGMA5kwu67PmK1Snm8hkg2Xzlduhr1xysL2mRn3+6o5tsFXhGrYOcSSXnf5SpTPgMjqo339ksH0iv8kvu3NaZRueygLYaVEMjixJvsnUisL3uY8LQ+4cm2Zu5mdQamhWhN0kkSdlfbjPgzxexL4AglD9YDy4I9Q80vKzy33Ubwo17a2aNCF3uPpYvCKiV0H9z2XtMxisKDfsQQA01Q1vpccUIK6L48xSbers8hV2xxpSEWzEuoZg18eG2ikAencA6mhGjFWcp9A1dllY2rUhcEdrjcjXji1SGabjYLsv23ki6EMGjM/AK+fq+vj3pIPUMpscX3xVDGmz/zusq6v1KfOtQw7B/Dg8c2cxKUlEWZqqC3A7rt3JO/RVEbeqSe5mlRm2yngINVemmhkcfZNs= xuel@kaliarchmacbookpro\"\n}\n\nresource \"tencentcloud_instance\" \"xuel_tf_ansible\" {\n  availability_zone = data.tencentcloud_availability_zones.zone.zones[0].name\n  image_id          = data.tencentcloud_images.image.images[0].image_id\n  instance_type     = data.tencentcloud_instance_types.instanceType.instance_types[0].instance_type\n  vpc_id            = tencentcloud_vpc.vpc.id\n  subnet_id         = tencentcloud_subnet.subnet.id\n  //  allocate_public_ip = true\n  system_disk_size = 50\n  system_disk_type = \"CLOUD_PREMIUM\"\n  key_name         = tencentcloud_key_pair.xuel-tf-key.id\n  allocate_public_ip = true\n  internet_max_bandwidth_out = 2\n  user_data = base64encode(data.template_file.user_data.rendered)\n\n  data_disks {\n    data_disk_size = 50\n    data_disk_type = \"CLOUD_PREMIUM\"\n  }\n  hostname             = format(\"xuel-tf-server-%d\", count.index)\n  instance_charge_type = \"POSTPAID_BY_HOUR\"\n  count                = local.count\n  instance_name        = format(\"xuel-tf-server-%d\", count.index)\n\n  tags = {\n    tagkey = \"xueltag\"\n  }\n}\n\noutput \"summary\" {\n  value = {\n    //    image = {for k,v in data.tencentcloud_images.image:k=&gt;v}\n    //    instanceType = {for k,v in data.tencentcloud_instance_types\n    //    .instanceType:k=&gt;v}\n    //    zone = {for k,v in data.tencentcloud_availability_zones.zone: k=&gt;v}\n    instance = { for k, v in tencentcloud_instance.xuel_tf_ansible : k =&gt; v }\n  }\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#53","title":"5.3 \u6d4b\u8bd5","text":"<pre><code>$ terraform apply\ntencentcloud_key_pair.xuel-tf-key: Refreshing state... [id=skey-4141cd1b]\ntencentcloud_vpc.vpc: Refreshing state... [id=vpc-i2ir344l]\ntencentcloud_subnet.subnet: Refreshing state... [id=subnet-4znec1qo]\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  # tencentcloud_instance.xuel_tf_ansible[0] will be created\n  + resource \"tencentcloud_instance\" \"xuel_tf_ansible\" {\n      + allocate_public_ip                      = true\n      + availability_zone                       = \"ap-guangzhou-3\"\n      + create_time                             = (known after apply)\n      + disable_monitor_service                 = false\n      + disable_security_service                = false\n      + expired_time                            = (known after apply)\n      + force_delete                            = false\n      + hostname                                = \"xuel-tf-server-0\"\n      + id                                      = (known after apply)\n      + image_id                                = \"img-oikl1tzv\"\n      + instance_charge_type                    = \"POSTPAID_BY_HOUR\"\n      + instance_charge_type_prepaid_renew_flag = (known after apply)\n      + instance_name                           = \"xuel-tf-server-0\"\n      + instance_status                         = (known after apply)\n      + instance_type                           = \"S3.SMALL1\"\n      + internet_charge_type                    = (known after apply)\n      + internet_max_bandwidth_out              = 2\n      + key_name                                = \"skey-4141cd1b\"\n      + private_ip                              = (known after apply)\n      + project_id                              = 0\n      + public_ip                               = (known after apply)\n      + running_flag                            = true\n      + security_groups                         = (known after apply)\n      + subnet_id                               = \"subnet-4znec1qo\"\n      + system_disk_id                          = (known after apply)\n      + system_disk_size                        = 50\n      + system_disk_type                        = \"CLOUD_PREMIUM\"\n      + tags                                    = {\n          + \"tagkey\" = \"xueltag\"\n        }\n      + user_data                               = \"IyEvYmluL2Jhc2gKeXVtIC15IGluc3RhbGwgbmdpbngKZWNobyB4dWVsdGZ0ZXN0ID4gL3Vzci9zaGFyZS9uZ2lueC9odG1sL2luZGV4Lmh0bWwKc3lzdGVtY3RsIHN0YXJ0IG5naW54CnN5c3RlbWN0bCBzdGF0dXMgbmdpbng=\"\n      + vpc_id                                  = \"vpc-i2ir344l\"\n\n      + data_disks {\n          + data_disk_id           = (known after apply)\n          + data_disk_size         = 50\n          + data_disk_type         = \"CLOUD_PREMIUM\"\n          + delete_with_instance   = true\n          + encrypt                = false\n          + throughput_performance = 0\n        }\n    }\n\n  # tencentcloud_instance.xuel_tf_ansible[1] will be created\n  + resource \"tencentcloud_instance\" \"xuel_tf_ansible\" {\n      + allocate_public_ip                      = true\n      + availability_zone                       = \"ap-guangzhou-3\"\n      + create_time                             = (known after apply)\n      + disable_monitor_service                 = false\n      + disable_security_service                = false\n      + expired_time                            = (known after apply)\n      + force_delete                            = false\n      + hostname                                = \"xuel-tf-server-1\"\n      + id                                      = (known after apply)\n      + image_id                                = \"img-oikl1tzv\"\n      + instance_charge_type                    = \"POSTPAID_BY_HOUR\"\n      + instance_charge_type_prepaid_renew_flag = (known after apply)\n      + instance_name                           = \"xuel-tf-server-1\"\n      + instance_status                         = (known after apply)\n      + instance_type                           = \"S3.SMALL1\"\n      + internet_charge_type                    = (known after apply)\n      + internet_max_bandwidth_out              = 2\n      + key_name                                = \"skey-4141cd1b\"\n      + private_ip                              = (known after apply)\n      + project_id                              = 0\n      + public_ip                               = (known after apply)\n      + running_flag                            = true\n      + security_groups                         = (known after apply)\n      + subnet_id                               = \"subnet-4znec1qo\"\n      + system_disk_id                          = (known after apply)\n      + system_disk_size                        = 50\n      + system_disk_type                        = \"CLOUD_PREMIUM\"\n      + tags                                    = {\n          + \"tagkey\" = \"xueltag\"\n        }\n      + user_data                               = \"IyEvYmluL2Jhc2gKeXVtIC15IGluc3RhbGwgbmdpbngKZWNobyB4dWVsdGZ0ZXN0ID4gL3Vzci9zaGFyZS9uZ2lueC9odG1sL2luZGV4Lmh0bWwKc3lzdGVtY3RsIHN0YXJ0IG5naW54CnN5c3RlbWN0bCBzdGF0dXMgbmdpbng=\"\n      + vpc_id                                  = \"vpc-i2ir344l\"\n\n      + data_disks {\n          + data_disk_id           = (known after apply)\n          + data_disk_size         = 50\n          + data_disk_type         = \"CLOUD_PREMIUM\"\n          + delete_with_instance   = true\n          + encrypt                = false\n          + throughput_performance = 0\n        }\n    }\n\nPlan: 2 to add, 0 to change, 0 to destroy.\n\nChanges to Outputs:\n  + summary = {\n      + instance = {\n          + 0 = {\n              + allocate_public_ip                      = true\n              + availability_zone                       = \"ap-guangzhou-3\"\n              + bandwidth_package_id                    = null\n              + cam_role_name                           = null\n              + cdh_host_id                             = null\n              + cdh_instance_type                       = null\n              + create_time                             = (known after apply)\n              + data_disks                              = [\n                  + {\n                      + data_disk_id           = (known after apply)\n                      + data_disk_size         = 50\n                      + data_disk_snapshot_id  = null\n                      + data_disk_type         = \"CLOUD_PREMIUM\"\n                      + delete_with_instance   = true\n                      + encrypt                = false\n                      + throughput_performance = 0\n                    },\n                ]\n              + disable_monitor_service                 = false\n              + disable_security_service                = false\n              + expired_time                            = (known after apply)\n              + force_delete                            = false\n              + hostname                                = \"xuel-tf-server-0\"\n              + id                                      = (known after apply)\n              + image_id                                = \"img-oikl1tzv\"\n              + instance_charge_type                    = \"POSTPAID_BY_HOUR\"\n              + instance_charge_type_prepaid_period     = null\n              + instance_charge_type_prepaid_renew_flag = (known after apply)\n              + instance_count                          = null\n              + instance_name                           = \"xuel-tf-server-0\"\n              + instance_status                         = (known after apply)\n              + instance_type                           = \"S3.SMALL1\"\n              + internet_charge_type                    = (known after apply)\n              + internet_max_bandwidth_out              = 2\n              + keep_image_login                        = null\n              + key_name                                = \"skey-4141cd1b\"\n              + password                                = null\n              + placement_group_id                      = null\n              + private_ip                              = (known after apply)\n              + project_id                              = 0\n              + public_ip                               = (known after apply)\n              + running_flag                            = true\n              + security_groups                         = (known after apply)\n              + spot_instance_type                      = null\n              + spot_max_price                          = null\n              + stopped_mode                            = null\n              + subnet_id                               = \"subnet-4znec1qo\"\n              + system_disk_id                          = (known after apply)\n              + system_disk_size                        = 50\n              + system_disk_type                        = \"CLOUD_PREMIUM\"\n              + tags                                    = {\n                  + \"tagkey\" = \"xueltag\"\n                }\n              + user_data                               = \"IyEvYmluL2Jhc2gKeXVtIC15IGluc3RhbGwgbmdpbngKZWNobyB4dWVsdGZ0ZXN0ID4gL3Vzci9zaGFyZS9uZ2lueC9odG1sL2luZGV4Lmh0bWwKc3lzdGVtY3RsIHN0YXJ0IG5naW54CnN5c3RlbWN0bCBzdGF0dXMgbmdpbng=\"\n              + user_data_raw                           = null\n              + vpc_id                                  = \"vpc-i2ir344l\"\n            }\n          + 1 = {\n              + allocate_public_ip                      = true\n              + availability_zone                       = \"ap-guangzhou-3\"\n              + bandwidth_package_id                    = null\n              + cam_role_name                           = null\n              + cdh_host_id                             = null\n              + cdh_instance_type                       = null\n              + create_time                             = (known after apply)\n              + data_disks                              = [\n                  + {\n                      + data_disk_id           = (known after apply)\n                      + data_disk_size         = 50\n                      + data_disk_snapshot_id  = null\n                      + data_disk_type         = \"CLOUD_PREMIUM\"\n                      + delete_with_instance   = true\n                      + encrypt                = false\n                      + throughput_performance = 0\n                    },\n                ]\n              + disable_monitor_service                 = false\n              + disable_security_service                = false\n              + expired_time                            = (known after apply)\n              + force_delete                            = false\n              + hostname                                = \"xuel-tf-server-1\"\n              + id                                      = (known after apply)\n              + image_id                                = \"img-oikl1tzv\"\n              + instance_charge_type                    = \"POSTPAID_BY_HOUR\"\n              + instance_charge_type_prepaid_period     = null\n              + instance_charge_type_prepaid_renew_flag = (known after apply)\n              + instance_count                          = null\n              + instance_name                           = \"xuel-tf-server-1\"\n              + instance_status                         = (known after apply)\n              + instance_type                           = \"S3.SMALL1\"\n              + internet_charge_type                    = (known after apply)\n              + internet_max_bandwidth_out              = 2\n              + keep_image_login                        = null\n              + key_name                                = \"skey-4141cd1b\"\n              + password                                = null\n              + placement_group_id                      = null\n              + private_ip                              = (known after apply)\n              + project_id                              = 0\n              + public_ip                               = (known after apply)\n              + running_flag                            = true\n              + security_groups                         = (known after apply)\n              + spot_instance_type                      = null\n              + spot_max_price                          = null\n              + stopped_mode                            = null\n              + subnet_id                               = \"subnet-4znec1qo\"\n              + system_disk_id                          = (known after apply)\n              + system_disk_size                        = 50\n              + system_disk_type                        = \"CLOUD_PREMIUM\"\n              + tags                                    = {\n                  + \"tagkey\" = \"xueltag\"\n                }\n              + user_data                               = \"IyEvYmluL2Jhc2gKeXVtIC15IGluc3RhbGwgbmdpbngKZWNobyB4dWVsdGZ0ZXN0ID4gL3Vzci9zaGFyZS9uZ2lueC9odG1sL2luZGV4Lmh0bWwKc3lzdGVtY3RsIHN0YXJ0IG5naW54CnN5c3RlbWN0bCBzdGF0dXMgbmdpbng=\"\n              + user_data_raw                           = null\n              + vpc_id                                  = \"vpc-i2ir344l\"\n            }\n        }\n    }\n\n\nWarning: This data source will been deprecated in Terraform TencentCloud provider later version. Please use `tencentcloud_availability_zones_by_product` instead.\n\n  on main.tf line 30, in data \"tencentcloud_availability_zones\" \"zone\":\n  30: data \"tencentcloud_availability_zones\" \"zone\" {}\n\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only 'yes' will be accepted to approve.\n\n  Enter a value: yes\n\ntencentcloud_instance.xuel_tf_ansible[0]: Creating...\ntencentcloud_instance.xuel_tf_ansible[1]: Creating...\ntencentcloud_instance.xuel_tf_ansible[0]: Still creating... [10s elapsed]\ntencentcloud_instance.xuel_tf_ansible[1]: Still creating... [10s elapsed]\ntencentcloud_instance.xuel_tf_ansible[1]: Still creating... [20s elapsed]\ntencentcloud_instance.xuel_tf_ansible[0]: Still creating... [20s elapsed]\ntencentcloud_instance.xuel_tf_ansible[0]: Creation complete after 30s [id=ins-9jm7nugy]\ntencentcloud_instance.xuel_tf_ansible[1]: Creation complete after 30s [id=ins-17yf6ate]\n\nApply complete! Resources: 2 added, 0 changed, 0 destroyed.\n\nOutputs:\n\nsummary = {\n  \"instance\" = {\n    \"0\" = {\n      \"allocate_public_ip\" = true\n      \"availability_zone\" = \"ap-guangzhou-3\"\n      \"bandwidth_package_id\" = tostring(null)\n      \"cam_role_name\" = \"\"\n      \"cdh_host_id\" = tostring(null)\n      \"cdh_instance_type\" = tostring(null)\n      \"create_time\" = \"2022-03-25T07:55:36Z\"\n      \"data_disks\" = tolist([\n        {\n          \"data_disk_id\" = \"disk-jh6puobk\"\n          \"data_disk_size\" = 50\n          \"data_disk_snapshot_id\" = \"\"\n          \"data_disk_type\" = \"CLOUD_PREMIUM\"\n          \"delete_with_instance\" = true\n          \"encrypt\" = false\n          \"throughput_performance\" = 0\n        },\n      ])\n      \"disable_monitor_service\" = false\n      \"disable_security_service\" = false\n      \"expired_time\" = \"\"\n      \"force_delete\" = false\n      \"hostname\" = \"xuel-tf-server-0\"\n      \"id\" = \"ins-9jm7nugy\"\n      \"image_id\" = \"img-oikl1tzv\"\n      \"instance_charge_type\" = \"POSTPAID_BY_HOUR\"\n      \"instance_charge_type_prepaid_period\" = tonumber(null)\n      \"instance_charge_type_prepaid_renew_flag\" = \"\"\n      \"instance_count\" = tonumber(null)\n      \"instance_name\" = \"xuel-tf-server-0\"\n      \"instance_status\" = \"RUNNING\"\n      \"instance_type\" = \"S3.SMALL1\"\n      \"internet_charge_type\" = \"TRAFFIC_POSTPAID_BY_HOUR\"\n      \"internet_max_bandwidth_out\" = 2\n      \"keep_image_login\" = tobool(null)\n      \"key_name\" = \"skey-4141cd1b\"\n      \"password\" = tostring(null)\n      \"placement_group_id\" = tostring(null)\n      \"private_ip\" = \"10.0.1.16\"\n      \"project_id\" = 0\n      \"public_ip\" = \"175.178.248.164\"\n      \"running_flag\" = true\n      \"security_groups\" = toset([\n        \"sg-el0589mr\",\n      ])\n      \"spot_instance_type\" = tostring(null)\n      \"spot_max_price\" = tostring(null)\n      \"stopped_mode\" = tostring(null)\n      \"subnet_id\" = \"subnet-4znec1qo\"\n      \"system_disk_id\" = \"disk-ffynw5ag\"\n      \"system_disk_size\" = 50\n      \"system_disk_type\" = \"CLOUD_PREMIUM\"\n      \"tags\" = tomap({})\n      \"user_data\" = \"IyEvYmluL2Jhc2gKeXVtIC15IGluc3RhbGwgbmdpbngKZWNobyB4dWVsdGZ0ZXN0ID4gL3Vzci9zaGFyZS9uZ2lueC9odG1sL2luZGV4Lmh0bWwKc3lzdGVtY3RsIHN0YXJ0IG5naW54CnN5c3RlbWN0bCBzdGF0dXMgbmdpbng=\"\n      \"user_data_raw\" = tostring(null)\n      \"vpc_id\" = \"vpc-i2ir344l\"\n    }\n    \"1\" = {\n      \"allocate_public_ip\" = true\n      \"availability_zone\" = \"ap-guangzhou-3\"\n      \"bandwidth_package_id\" = tostring(null)\n      \"cam_role_name\" = \"\"\n      \"cdh_host_id\" = tostring(null)\n      \"cdh_instance_type\" = tostring(null)\n      \"create_time\" = \"2022-03-25T07:55:34Z\"\n      \"data_disks\" = tolist([\n        {\n          \"data_disk_id\" = \"disk-lssq5o74\"\n          \"data_disk_size\" = 50\n          \"data_disk_snapshot_id\" = \"\"\n          \"data_disk_type\" = \"CLOUD_PREMIUM\"\n          \"delete_with_instance\" = true\n          \"encrypt\" = false\n          \"throughput_performance\" = 0\n        },\n      ])\n      \"disable_monitor_service\" = false\n      \"disable_security_service\" = false\n      \"expired_time\" = \"\"\n      \"force_delete\" = false\n      \"hostname\" = \"xuel-tf-server-1\"\n      \"id\" = \"ins-17yf6ate\"\n      \"image_id\" = \"img-oikl1tzv\"\n      \"instance_charge_type\" = \"POSTPAID_BY_HOUR\"\n      \"instance_charge_type_prepaid_period\" = tonumber(null)\n      \"instance_charge_type_prepaid_renew_flag\" = \"\"\n      \"instance_count\" = tonumber(null)\n      \"instance_name\" = \"xuel-tf-server-1\"\n      \"instance_status\" = \"RUNNING\"\n      \"instance_type\" = \"S3.SMALL1\"\n      \"internet_charge_type\" = \"TRAFFIC_POSTPAID_BY_HOUR\"\n      \"internet_max_bandwidth_out\" = 2\n      \"keep_image_login\" = tobool(null)\n      \"key_name\" = \"skey-4141cd1b\"\n      \"password\" = tostring(null)\n      \"placement_group_id\" = tostring(null)\n      \"private_ip\" = \"10.0.1.5\"\n      \"project_id\" = 0\n      \"public_ip\" = \"175.178.247.246\"\n      \"running_flag\" = true\n      \"security_groups\" = toset([\n        \"sg-el0589mr\",\n      ])\n      \"spot_instance_type\" = tostring(null)\n      \"spot_max_price\" = tostring(null)\n      \"stopped_mode\" = tostring(null)\n      \"subnet_id\" = \"subnet-4znec1qo\"\n      \"system_disk_id\" = \"disk-fazgk0hs\"\n      \"system_disk_size\" = 50\n      \"system_disk_type\" = \"CLOUD_PREMIUM\"\n      \"tags\" = tomap({})\n      \"user_data\" = \"IyEvYmluL2Jhc2gKeXVtIC15IGluc3RhbGwgbmdpbngKZWNobyB4dWVsdGZ0ZXN0ID4gL3Vzci9zaGFyZS9uZ2lueC9odG1sL2luZGV4Lmh0bWwKc3lzdGVtY3RsIHN0YXJ0IG5naW54CnN5c3RlbWN0bCBzdGF0dXMgbmdpbng=\"\n      \"user_data_raw\" = tostring(null)\n      \"vpc_id\" = \"vpc-i2ir344l\"\n    }\n  }\n}\n</code></pre> <p>\u901a\u8fc7\u516c\u52a1IP\u8fdb\u884c\u6d4b\u8bd5\uff1a</p> <p></p>"},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_6","title":"\u516d \u5176\u4ed6","text":"<p>\u76ee\u524d\u914d\u7f6e\u7ba1\u7406\u901a\u8fc7cloud-init \u901a\u8fc7\u6587\u4ef6\u5f62\u5f0f\u8bfb\u8fdb\u6765\u64cd\u4f5c\u914d\u7f6e\u5185\u5bb9\uff0c\u4f46\u662f\u5177\u4f53\u4efb\u52a1\u7684\u6267\u884c\u72b6\u6001\u8fd8\u662f\u4e0d\u53ef\u63a7\uff0c\u9700\u8981\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u5c06\u8fd0\u884c\u7ed3\u679c\u8fdb\u884c\u53cd\u9988\u3002</p>"},{"location":"devops/IaC/Terraform/Terraform%E4%BD%BF%E7%94%A8cloud-init%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_7","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://learn.hashicorp.com/tutorials/terraform/cloud-init</li> </ul>"},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/","title":"Terraform\u5b8c\u6210\u7aef\u5230\u7aef\u57fa\u7840\u8bbe\u65bd\u7f16\u6392","text":""},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#terraform","title":"Terraform\u5b8c\u6210\u7aef\u5230\u7aef\u57fa\u7840\u8bbe\u65bd\u7f16\u6392","text":""},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>Terraform\u603b\u6240\u5468\u77e5\uff0c\u5df2\u6210\u4e3a\u4e91\u4e0a\u57fa\u7840\u8bbe\u65bd\u7f16\u6392\u7684\u7684\u884c\u4e1a\u6807\u51c6\uff0c\u4f46\u5176\u66f4\u591a\u7684\u5173\u6ce8\u70b9\u805a\u7126\u5728\u652f\u6301\u7684provider\u7684\u5404\u7c7b\u8d44\u6e90\u7f16\u6392\uff0c\u5bf9\u4e8e\u7f16\u6392\u51fa\u6765\u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u5bf9\u5176\u5185\u90e8\u7684\u914d\u7f6e\u53d8\u66f4\uff0c\u9700\u8981\u914d\u5408\u5176\u4ed6\u914d\u7f6e\u7ba1\u7406\u5de5\u5177\u8fdb\u884c\u6574\u5408\u4f7f\u7528\uff0c\u4ee5\u8fbe\u5230\u7aef\u5230\u7aef\u7684\u914d\u7f6e\u3002</p>"},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_2","title":"\u4e8c \u6d41\u7a0b","text":"<p>Terraform\u5229\u7528\u8d44\u6e90null_resource \u548c\u5185\u90e8\u5c5e\u6027provisioner \u7684 remote-exec \u7c7b\u578b\u5bf9\u7f16\u6392\u51fa\u6765\u7684\u57fa\u7840\u8bbe\u65bd\u8fdb\u884c\u914d\u7f6e\u7ba1\u7406\uff0c\u5b8c\u6210\u81ea\u5b9a\u4e49\u811a\u672c\u6267\u884c\uff0c\u4ece\u800c\u8fbe\u5230\u7aef\u5230\u7aef\u7684\u8d44\u6e90\u7f16\u6392\u548c\u914d\u7f6e\u7ba1\u7406\u3002</p>"},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_3","title":"\u4e09 \u573a\u666f","text":"<p>\u5229\u7528terraform\u7f16\u6392\u51fa\u817e\u8baf\u4e91\u670d\u52a1\u5668\uff0c\u5e76\u5728\u670d\u52a1\u5668\u5185\u90e8\u8fdb\u884c\u57fa\u7840\u8bbe\u65bd\u5b89\u88c5</p>"},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_4","title":"\u56db \u6d41\u7a0b","text":"<ul> <li>\u672c\u5730\u751f\u6210ssh\u516c\u94a5\u79c1\u81ea\u94a5\uff0c\u7528\u4e8e\u767b\u5f55\u670d\u52a1\u5668</li> <li>\u7f16\u6392tencentcloud_key_pair \u5bf9\u8c61\uff0c\u7528\u4e8e\u540e\u671f\u767b\u5f55\u670d\u52a1\u5668</li> <li>\u7f16\u6392cvm\u5bf9\u8c61</li> <li>\u7f16\u6392null_resource \u7528\u4e8e\u6267\u884c\u5bf9\u670d\u52a1\u5668\u7684\u64cd\u4f5c</li> <li>\u8f93\u51fa\u670d\u52a1\u5668\u8be6\u7ec6\u4fe1\u606f</li> </ul>"},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_5","title":"\u4e94 \u5b9e\u6218","text":""},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#51-ssh","title":"5.1 \u751f\u6210ssh\u5bc6\u94a5","text":"<pre><code>ssh-keygen -t rsa -P \"\" -f xuel_rsa -q \n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#52-tf","title":"5.2 \u7f16\u5199TF\u4ee3\u7801","text":"<pre><code>locals {\n  cidr_block_vpc_name    = \"10.0.0.0/16\"\n  cidr_block_subnet_name = \"10.0.1.0/24\"\n  count                  = 2\n}\n\n// \u7528\u4e8e\u67e5\u627e\u60ca\u559c\ndata \"tencentcloud_images\" \"image\" {\n  image_type = [\"PUBLIC_IMAGE\"]\n  os_name    = \"centos 7.5\"\n}\n\n// \u67e5\u627e\u5b9e\u4f8b\u7c7b\u578b\ndata \"tencentcloud_instance_types\" \"instanceType\" {\n  cpu_core_count = 1\n  memory_size    = 1\n  filter {\n    name   = \"instance-family\"\n    values = [\"S3\"]\n  }\n}\n\n// \u67e5\u627e\u53ef\u7528zone\ndata \"tencentcloud_availability_zones\" \"zone\" {}\n\n// \u5b9a\u4e49vpc\u8d44\u6e90\nresource \"tencentcloud_vpc\" \"vpc\" {\n  cidr_block = local.cidr_block_vpc_name\n  name       = \"xuel_tf_vpc\"\n}\n\n// \u5b9a\u4e49\u5b50\u7f51\u8d44\u6e90\nresource \"tencentcloud_subnet\" \"subnet\" {\n  availability_zone = data.tencentcloud_availability_zones.zone.zones.0.name\n  cidr_block        = local.cidr_block_subnet_name\n  name              = \"xuel_tf_subnet\"\n  vpc_id            = tencentcloud_vpc.vpc.id\n}\n\n// \u5b9a\u4e49\u516c\u94a5\u5bf9\nresource \"tencentcloud_key_pair\" \"xuel-tf-key\" {\n  key_name   = \"xueltfkey\"\n  public_key = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDCcJxzfjqQDikRRShExu22kvNOfMKeWrn++s5nQMTm+9SNsQISEk+P15JhFVachgjumupMcOIrfJQAAQcnzNmxoRCTCJQfmegGpDZVpE1cyHUhGMA5kwu67PmK1Snm8hkg2Xzlduhr1xysL2mRn3+6o5tsFXhGrYOcSSXnf5SpTPgMjqo339ksH0iv8kvu3NaZRueygLYaVEMjixJvsnUisL3uY8LQ+4cm2Zu5mdQamhWhN0kkSdlfbjPgzxexL4AglD9YDy4I9Q80vKzy33Ubwo17a2aNCF3uPpYvCKiV0H9z2XtMxisKDfsQQA01Q1vpccUIK6L48xSbers8hV2xxpSEWzEuoZg18eG2ikAencA6mhGjFWcp9A1dllY2rUhcEdrjcjXji1SGabjYLsv23ki6EMGjM/AK+fq+vj3pIPUMpscX3xVDGmz/zusq6v1KfOtQw7B/Dg8c2cxKUlEWZqqC3A7rt3JO/RVEbeqSe5mlRm2yngINVemmhkcfZNs= xuel@kaliarchmacbookpro\"\n}\n\n// \u5b9a\u4e49cvm\u5b9e\u4f8b\nresource \"tencentcloud_instance\" \"xuel_tf_ansible\" {\n  availability_zone = data.tencentcloud_availability_zones.zone.zones[0].name\n  image_id          = data.tencentcloud_images.image.images[0].image_id\n  instance_type     = data.tencentcloud_instance_types.instanceType.instance_types[0].instance_type\n  vpc_id            = tencentcloud_vpc.vpc.id\n  subnet_id         = tencentcloud_subnet.subnet.id\n  //  allocate_public_ip = true\n  system_disk_size = 50\n  system_disk_type = \"CLOUD_PREMIUM\"\n  key_name         = tencentcloud_key_pair.xuel-tf-key.id\n  allocate_public_ip = true\n  internet_max_bandwidth_out = 2\n\n  data_disks {\n    data_disk_size = 50\n    data_disk_type = \"CLOUD_PREMIUM\"\n  }\n  hostname             = format(\"xuel-tf-server-%d\", count.index)\n  instance_charge_type = \"POSTPAID_BY_HOUR\"\n  count                = local.count\n  instance_name        = format(\"xuel-tf-server-%d\", count.index)\n\n  tags = {\n    tagkey = \"xueltag\"\n  }\n\n}\n\n// \u5b9a\u4e49\u540e\u671fshell \u6267\u884c\nresource \"null_resource\" \"shell\" {\n  count = local.count\n    // \u5b9a\u4e49triggers\n  triggers = {\n    instance_ids = element(tencentcloud_instance.xuel_tf_ansible.*.id, count.index)\n  }\n\n  // \u5b9a\u4e49\u6267\u884c\u8005\n  provisioner \"remote-exec\" {\n    connection {\n      host        = element(tencentcloud_instance.xuel_tf_ansible.*.public_ip, count.index)\n      type        = \"ssh\"\n      user        = \"root\"\n      private_key = file(\"/Users/xuel/.ssh/id_rsa\")\n\n    }\n        // \u5b9a\u4e49\u5185\u90e8\u6267\u884c\u811a\u672c\n    inline = [\n      \"echo index.html &gt; /xueltf.txt\",\n      \"yum -y install nginx\"\n    ]\n  }\n}\n\n// \u5b9a\u4e49\u8f93\u51fa\noutput \"summary\" {\n  value = {\n    //    image = {for k,v in data.tencentcloud_images.image:k=&gt;v}\n    //    instanceType = {for k,v in data.tencentcloud_instance_types\n    //    .instanceType:k=&gt;v}\n    //    zone = {for k,v in data.tencentcloud_availability_zones.zone: k=&gt;v}\n    instance = { for k, v in tencentcloud_instance.xuel_tf_ansible : k =&gt; v }\n  }\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#53","title":"5.3 \u6d4b\u8bd5","text":"<pre><code>$ terraform apply                                                   \n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  # null_resource.shell[0] will be created\n  + resource \"null_resource\" \"shell\" {\n      + id       = (known after apply)\n      + triggers = (known after apply)\n    }\n\n  # null_resource.shell[1] will be created\n  + resource \"null_resource\" \"shell\" {\n      + id       = (known after apply)\n      + triggers = (known after apply)\n    }\n\n  # tencentcloud_instance.xuel_tf_ansible[0] will be created\n  + resource \"tencentcloud_instance\" \"xuel_tf_ansible\" {\n      + allocate_public_ip                      = true\n      + availability_zone                       = \"ap-guangzhou-3\"\n      + create_time                             = (known after apply)\n      + disable_monitor_service                 = false\n      + disable_security_service                = false\n      + expired_time                            = (known after apply)\n      + force_delete                            = false\n      + hostname                                = \"xuel-tf-server-0\"\n      + id                                      = (known after apply)\n      + image_id                                = \"img-oikl1tzv\"\n      + instance_charge_type                    = \"POSTPAID_BY_HOUR\"\n      + instance_charge_type_prepaid_renew_flag = (known after apply)\n      + instance_name                           = \"xuel-tf-server-0\"\n      + instance_status                         = (known after apply)\n      + instance_type                           = \"S3.SMALL1\"\n      + internet_charge_type                    = (known after apply)\n      + internet_max_bandwidth_out              = 2\n      + key_name                                = (known after apply)\n      + private_ip                              = (known after apply)\n      + project_id                              = 0\n      + public_ip                               = (known after apply)\n      + running_flag                            = true\n      + security_groups                         = (known after apply)\n      + subnet_id                               = (known after apply)\n      + system_disk_id                          = (known after apply)\n      + system_disk_size                        = 50\n      + system_disk_type                        = \"CLOUD_PREMIUM\"\n      + tags                                    = {\n          + \"tagkey\" = \"xueltag\"\n        }\n      + vpc_id                                  = (known after apply)\n\n      + data_disks {\n          + data_disk_id           = (known after apply)\n          + data_disk_size         = 50\n          + data_disk_type         = \"CLOUD_PREMIUM\"\n          + delete_with_instance   = true\n          + encrypt                = false\n          + throughput_performance = 0\n        }\n    }\n\n  # tencentcloud_instance.xuel_tf_ansible[1] will be created\n  + resource \"tencentcloud_instance\" \"xuel_tf_ansible\" {\n      + allocate_public_ip                      = true\n      + availability_zone                       = \"ap-guangzhou-3\"\n      + create_time                             = (known after apply)\n      + disable_monitor_service                 = false\n      + disable_security_service                = false\n      + expired_time                            = (known after apply)\n      + force_delete                            = false\n      + hostname                                = \"xuel-tf-server-1\"\n      + id                                      = (known after apply)\n      + image_id                                = \"img-oikl1tzv\"\n      + instance_charge_type                    = \"POSTPAID_BY_HOUR\"\n      + instance_charge_type_prepaid_renew_flag = (known after apply)\n      + instance_name                           = \"xuel-tf-server-1\"\n      + instance_status                         = (known after apply)\n      + instance_type                           = \"S3.SMALL1\"\n      + internet_charge_type                    = (known after apply)\n      + internet_max_bandwidth_out              = 2\n      + key_name                                = (known after apply)\n      + private_ip                              = (known after apply)\n      + project_id                              = 0\n      + public_ip                               = (known after apply)\n      + running_flag                            = true\n      + security_groups                         = (known after apply)\n      + subnet_id                               = (known after apply)\n      + system_disk_id                          = (known after apply)\n      + system_disk_size                        = 50\n      + system_disk_type                        = \"CLOUD_PREMIUM\"\n      + tags                                    = {\n          + \"tagkey\" = \"xueltag\"\n        }\n      + vpc_id                                  = (known after apply)\n\n      + data_disks {\n          + data_disk_id           = (known after apply)\n          + data_disk_size         = 50\n          + data_disk_type         = \"CLOUD_PREMIUM\"\n          + delete_with_instance   = true\n          + encrypt                = false\n          + throughput_performance = 0\n        }\n    }\n\n  # tencentcloud_key_pair.xuel-tf-key will be created\n  + resource \"tencentcloud_key_pair\" \"xuel-tf-key\" {\n      + id         = (known after apply)\n      + key_name   = \"xueltfkey\"\n      + project_id = 0\n      + public_key = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDCcJxzfjqQDikRRShExu22kvNOfMKeWrn++s5nQMTm+9SNsQISEk+P15JhFVachgjumupMcOIrfJQAAQcnzNmxoRCTCJQfmegGpDZVpE1cyHUhGMA5kwu67PmK1Snm8hkg2Xzlduhr1xysL2mRn3+6o5tsFXhGrYOcSSXnf5SpTPgMjqo339ksH0iv8kvu3NaZRueygLYaVEMjixJvsnUisL3uY8LQ+4cm2Zu5mdQamhWhN0kkSdlfbjPgzxexL4AglD9YDy4I9Q80vKzy33Ubwo17a2aNCF3uPpYvCKiV0H9z2XtMxisKDfsQQA01Q1vpccUIK6L48xSbers8hV2xxpSEWzEuoZg18eG2ikAencA6mhGjFWcp9A1dllY2rUhcEdrjcjXji1SGabjYLsv23ki6EMGjM/AK+fq+vj3pIPUMpscX3xVDGmz/zusq6v1KfOtQw7B/Dg8c2cxKUlEWZqqC3A7rt3JO/RVEbeqSe5mlRm2yngINVemmhkcfZNs=\"\n    }\n\n  # tencentcloud_subnet.subnet will be created\n  + resource \"tencentcloud_subnet\" \"subnet\" {\n      + availability_zone  = \"ap-guangzhou-3\"\n      + available_ip_count = (known after apply)\n      + cidr_block         = \"10.0.1.0/24\"\n      + create_time        = (known after apply)\n      + id                 = (known after apply)\n      + is_default         = (known after apply)\n      + is_multicast       = true\n      + name               = \"xuel_tf_subnet\"\n      + route_table_id     = (known after apply)\n      + vpc_id             = (known after apply)\n    }\n\n  # tencentcloud_vpc.vpc will be created\n  + resource \"tencentcloud_vpc\" \"vpc\" {\n      + assistant_cidrs        = (known after apply)\n      + cidr_block             = \"10.0.0.0/16\"\n      + create_time            = (known after apply)\n      + default_route_table_id = (known after apply)\n      + dns_servers            = (known after apply)\n      + id                     = (known after apply)\n      + is_default             = (known after apply)\n      + is_multicast           = true\n      + name                   = \"xuel_tf_vpc\"\n    }\n\nPlan: 7 to add, 0 to change, 0 to destroy.\n\nChanges to Outputs:\n  + summary = {\n      + instance = {\n          + 0 = {\n              + allocate_public_ip                      = true\n              + availability_zone                       = \"ap-guangzhou-3\"\n              + bandwidth_package_id                    = null\n              + cam_role_name                           = null\n              + cdh_host_id                             = null\n              + cdh_instance_type                       = null\n              + create_time                             = (known after apply)\n              + data_disks                              = [\n                  + {\n                      + data_disk_id           = (known after apply)\n                      + data_disk_size         = 50\n                      + data_disk_snapshot_id  = null\n                      + data_disk_type         = \"CLOUD_PREMIUM\"\n                      + delete_with_instance   = true\n                      + encrypt                = false\n                      + throughput_performance = 0\n                    },\n                ]\n              + disable_monitor_service                 = false\n              + disable_security_service                = false\n              + expired_time                            = (known after apply)\n              + force_delete                            = false\n              + hostname                                = \"xuel-tf-server-0\"\n              + id                                      = (known after apply)\n              + image_id                                = \"img-oikl1tzv\"\n              + instance_charge_type                    = \"POSTPAID_BY_HOUR\"\n              + instance_charge_type_prepaid_period     = null\n              + instance_charge_type_prepaid_renew_flag = (known after apply)\n              + instance_count                          = null\n              + instance_name                           = \"xuel-tf-server-0\"\n              + instance_status                         = (known after apply)\n              + instance_type                           = \"S3.SMALL1\"\n              + internet_charge_type                    = (known after apply)\n              + internet_max_bandwidth_out              = 2\n              + keep_image_login                        = null\n              + key_name                                = (known after apply)\n              + password                                = null\n              + placement_group_id                      = null\n              + private_ip                              = (known after apply)\n              + project_id                              = 0\n              + public_ip                               = (known after apply)\n              + running_flag                            = true\n              + security_groups                         = (known after apply)\n              + spot_instance_type                      = null\n              + spot_max_price                          = null\n              + stopped_mode                            = null\n              + subnet_id                               = (known after apply)\n              + system_disk_id                          = (known after apply)\n              + system_disk_size                        = 50\n              + system_disk_type                        = \"CLOUD_PREMIUM\"\n              + tags                                    = {\n                  + \"tagkey\" = \"xueltag\"\n                }\n              + user_data                               = null\n              + user_data_raw                           = null\n              + vpc_id                                  = (known after apply)\n            }\n          + 1 = {\n              + allocate_public_ip                      = true\n              + availability_zone                       = \"ap-guangzhou-3\"\n              + bandwidth_package_id                    = null\n              + cam_role_name                           = null\n              + cdh_host_id                             = null\n              + cdh_instance_type                       = null\n              + create_time                             = (known after apply)\n              + data_disks                              = [\n                  + {\n                      + data_disk_id           = (known after apply)\n                      + data_disk_size         = 50\n                      + data_disk_snapshot_id  = null\n                      + data_disk_type         = \"CLOUD_PREMIUM\"\n                      + delete_with_instance   = true\n                      + encrypt                = false\n                      + throughput_performance = 0\n                    },\n                ]\n              + disable_monitor_service                 = false\n              + disable_security_service                = false\n              + expired_time                            = (known after apply)\n              + force_delete                            = false\n              + hostname                                = \"xuel-tf-server-1\"\n              + id                                      = (known after apply)\n              + image_id                                = \"img-oikl1tzv\"\n              + instance_charge_type                    = \"POSTPAID_BY_HOUR\"\n              + instance_charge_type_prepaid_period     = null\n              + instance_charge_type_prepaid_renew_flag = (known after apply)\n              + instance_count                          = null\n              + instance_name                           = \"xuel-tf-server-1\"\n              + instance_status                         = (known after apply)\n              + instance_type                           = \"S3.SMALL1\"\n              + internet_charge_type                    = (known after apply)\n              + internet_max_bandwidth_out              = 2\n              + keep_image_login                        = null\n              + key_name                                = (known after apply)\n              + password                                = null\n              + placement_group_id                      = null\n              + private_ip                              = (known after apply)\n              + project_id                              = 0\n              + public_ip                               = (known after apply)\n              + running_flag                            = true\n              + security_groups                         = (known after apply)\n              + spot_instance_type                      = null\n              + spot_max_price                          = null\n              + stopped_mode                            = null\n              + subnet_id                               = (known after apply)\n              + system_disk_id                          = (known after apply)\n              + system_disk_size                        = 50\n              + system_disk_type                        = \"CLOUD_PREMIUM\"\n              + tags                                    = {\n                  + \"tagkey\" = \"xueltag\"\n                }\n              + user_data                               = null\n              + user_data_raw                           = null\n              + vpc_id                                  = (known after apply)\n            }\n        }\n    }\n\n\nWarning: This data source will been deprecated in Terraform TencentCloud provider later version. Please use `tencentcloud_availability_zones_by_product` instead.\n\n  on main.tf line 21, in data \"tencentcloud_availability_zones\" \"zone\":\n  21: data \"tencentcloud_availability_zones\" \"zone\" {}\n\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only 'yes' will be accepted to approve.\n\n  Enter a value: yes\n\n\ntencentcloud_vpc.vpc: Creating...\ntencentcloud_key_pair.xuel-tf-key: Creating...\ntencentcloud_key_pair.xuel-tf-key: Creation complete after 2s [id=skey-ermat2er]\ntencentcloud_vpc.vpc: Creation complete after 5s [id=vpc-gu4gmx1h]\ntencentcloud_subnet.subnet: Creating...\ntencentcloud_subnet.subnet: Creation complete after 2s [id=subnet-079md4re]\ntencentcloud_instance.xuel_tf_ansible[1]: Creating...\ntencentcloud_instance.xuel_tf_ansible[0]: Creating...\ntencentcloud_instance.xuel_tf_ansible[0]: Still creating... [10s elapsed]\ntencentcloud_instance.xuel_tf_ansible[1]: Still creating... [10s elapsed]\ntencentcloud_instance.xuel_tf_ansible[1]: Still creating... [20s elapsed]\ntencentcloud_instance.xuel_tf_ansible[0]: Still creating... [20s elapsed]\ntencentcloud_instance.xuel_tf_ansible[1]: Creation complete after 24s [id=ins-562f4vl0]\ntencentcloud_instance.xuel_tf_ansible[0]: Creation complete after 25s [id=ins-ifzhv2g6]\nnull_resource.shell[0]: Creating...\nnull_resource.shell[1]: Creating...\nnull_resource.shell[0]: Provisioning with 'remote-exec'...\nnull_resource.shell[1]: Provisioning with 'remote-exec'...\nnull_resource.shell[0] (remote-exec): Connecting to remote host via SSH...\nnull_resource.shell[0] (remote-exec):   Host: 175.178.92.230\nnull_resource.shell[0] (remote-exec):   User: root\nnull_resource.shell[0] (remote-exec):   Password: false\nnull_resource.shell[0] (remote-exec):   Private key: true\nnull_resource.shell[0] (remote-exec):   Certificate: false\nnull_resource.shell[0] (remote-exec):   SSH Agent: true\nnull_resource.shell[0] (remote-exec):   Checking Host Key: false\nnull_resource.shell[1] (remote-exec): Connecting to remote host via SSH...\nnull_resource.shell[1] (remote-exec):   Host: 175.178.227.93\nnull_resource.shell[1] (remote-exec):   User: root\nnull_resource.shell[1] (remote-exec):   Password: false\nnull_resource.shell[1] (remote-exec):   Private key: true\nnull_resource.shell[1] (remote-exec):   Certificate: false\nnull_resource.shell[1] (remote-exec):   SSH Agent: true\nnull_resource.shell[1] (remote-exec):   Checking Host Key: false\nnull_resource.shell[1] (remote-exec): Connected!\nnull_resource.shell[0] (remote-exec): Connecting to remote host via SSH...\nnull_resource.shell[0] (remote-exec):   Host: 175.178.92.230\nnull_resource.shell[0] (remote-exec):   User: root\nnull_resource.shell[0] (remote-exec):   Password: false\nnull_resource.shell[0] (remote-exec):   Private key: true\nnull_resource.shell[0] (remote-exec):   Certificate: false\nnull_resource.shell[0] (remote-exec):   SSH Agent: true\nnull_resource.shell[0] (remote-exec):   Checking Host Key: false\nnull_resource.shell[1] (remote-exec): Loaded plugins: fastestmirror, langpacks\nnull_resource.shell[1] (remote-exec): Determining fastest mirrors\nnull_resource.shell[1] (remote-exec): epel             | 4.7 kB     00:00\nnull_resource.shell[1] (remote-exec): extras           | 2.9 kB     00:00\nnull_resource.shell[1] (remote-exec): os               | 3.6 kB     00:00\nnull_resource.shell[1] (remote-exec): updates          | 2.9 kB     00:00\nnull_resource.shell[0] (remote-exec): Connected!\nnull_resource.shell[1] (remote-exec): (1/7): epel/7/x86_ |  96 kB   00:00\nnull_resource.shell[1] (remote-exec): (2/7): os/7/x86_64 | 153 kB   00:00\nnull_resource.shell[1] (remote-exec): (3/7): extras/7/x8 | 246 kB   00:00\nnull_resource.shell[1] (remote-exec): (5/7): epel/7/x 3% | 1.1 MB   --:-- ETA\nnull_resource.shell[1] (remote-exec): (4/7): epel/7/x86_ | 1.1 MB   00:00\nnull_resource.shell[1] (remote-exec): (5/7): epel/7/x86_ | 7.0 MB   00:00\nnull_resource.shell[1] (remote-exec): (6/7): os/7/x86_64 | 6.1 MB   00:00\nnull_resource.shell[0] (remote-exec): Loaded plugins: fastestmirror, langpacks\nnull_resource.shell[0] (remote-exec): Determining fastest mirrors\nnull_resource.shell[0] (remote-exec): epel             | 4.7 kB     00:00\nnull_resource.shell[1] (remote-exec): (7/7): updates/7/x |  14 MB   00:00\nnull_resource.shell[0] (remote-exec): extras           | 2.9 kB     00:00\nnull_resource.shell[0] (remote-exec): os               | 3.6 kB     00:00\nnull_resource.shell[0] (remote-exec): updates          | 2.9 kB     00:00\nnull_resource.shell[0] (remote-exec): (1/7): epel/7/x86_ |  96 kB   00:00\nnull_resource.shell[0]: Still creating... [10s elapsed]\nnull_resource.shell[1]: Still creating... [10s elapsed]\nnull_resource.shell[0] (remote-exec): (2/7): extras/7/x8 | 246 kB   00:00\nnull_resource.shell[0] (remote-exec): (4/7): epel/7/x 3% | 1.1 MB   --:-- ETA\nnull_resource.shell[0] (remote-exec): (3/7): os/7/x86_64 | 153 kB   00:00\nnull_resource.shell[0] (remote-exec): (4/7): epel/7/x86_ | 1.1 MB   00:00\nnull_resource.shell[0] (remote-exec): (5/7): epel/7/x86_ | 7.0 MB   00:00\nnull_resource.shell[0] (remote-exec): (7/7): updates 51% |  15 MB   00:00 ETA\nnull_resource.shell[0] (remote-exec): (6/7): os/7/x86_64 | 6.1 MB   00:00\nnull_resource.shell[0] (remote-exec): (7/7): updates 89% |  26 MB   00:00 ETA\nnull_resource.shell[0] (remote-exec): (7/7): updates/7/x |  14 MB   00:00\nnull_resource.shell[1] (remote-exec): Resolving Dependencies\nnull_resource.shell[1] (remote-exec): --&gt; Running transaction check\nnull_resource.shell[1] (remote-exec): ---&gt; Package nginx.x86_64 1:1.20.1-9.el7 will be installed\nnull_resource.shell[0] (remote-exec): Resolving Dependencies\nnull_resource.shell[0] (remote-exec): --&gt; Running transaction check\nnull_resource.shell[0] (remote-exec): ---&gt; Package nginx.x86_64 1:1.20.1-9.el7 will be installed\nnull_resource.shell[1] (remote-exec): --&gt; Processing Dependency: nginx-filesystem = 1:1.20.1-9.el7 for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[0] (remote-exec): --&gt; Processing Dependency: nginx-filesystem = 1:1.20.1-9.el7 for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[1] (remote-exec): --&gt; Processing Dependency: libcrypto.so.1.1(OPENSSL_1_1_0)(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[1] (remote-exec): --&gt; Processing Dependency: libssl.so.1.1(OPENSSL_1_1_0)(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[1] (remote-exec): --&gt; Processing Dependency: libssl.so.1.1(OPENSSL_1_1_1)(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[1] (remote-exec): --&gt; Processing Dependency: nginx-filesystem for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[1] (remote-exec): --&gt; Processing Dependency: libcrypto.so.1.1()(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[1] (remote-exec): --&gt; Processing Dependency: libprofiler.so.0()(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[1] (remote-exec): --&gt; Processing Dependency: libssl.so.1.1()(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[1] (remote-exec): --&gt; Running transaction check\nnull_resource.shell[1] (remote-exec): ---&gt; Package gperftools-libs.x86_64 0:2.6.1-1.el7 will be installed\nnull_resource.shell[1] (remote-exec): ---&gt; Package nginx-filesystem.noarch 1:1.20.1-9.el7 will be installed\nnull_resource.shell[1] (remote-exec): ---&gt; Package openssl11-libs.x86_64 1:1.1.1k-2.el7 will be installed\nnull_resource.shell[0] (remote-exec): --&gt; Processing Dependency: libcrypto.so.1.1(OPENSSL_1_1_0)(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[0] (remote-exec): --&gt; Processing Dependency: libssl.so.1.1(OPENSSL_1_1_0)(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[0] (remote-exec): --&gt; Processing Dependency: libssl.so.1.1(OPENSSL_1_1_1)(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[0] (remote-exec): --&gt; Processing Dependency: nginx-filesystem for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[0] (remote-exec): --&gt; Processing Dependency: libcrypto.so.1.1()(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[0] (remote-exec): --&gt; Processing Dependency: libprofiler.so.0()(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[0] (remote-exec): --&gt; Processing Dependency: libssl.so.1.1()(64bit) for package: 1:nginx-1.20.1-9.el7.x86_64\nnull_resource.shell[0] (remote-exec): --&gt; Running transaction check\nnull_resource.shell[0] (remote-exec): ---&gt; Package gperftools-libs.x86_64 0:2.6.1-1.el7 will be installed\nnull_resource.shell[0] (remote-exec): ---&gt; Package nginx-filesystem.noarch 1:1.20.1-9.el7 will be installed\nnull_resource.shell[0] (remote-exec): ---&gt; Package openssl11-libs.x86_64 1:1.1.1k-2.el7 will be installed\nnull_resource.shell[1] (remote-exec): --&gt; Finished Dependency Resolution\n\nnull_resource.shell[1] (remote-exec): Dependencies Resolved\n\nnull_resource.shell[1] (remote-exec): ========================================\nnull_resource.shell[1] (remote-exec):  Package\nnull_resource.shell[1] (remote-exec):        Arch   Version        Repository\nnull_resource.shell[1] (remote-exec):                                    Size\nnull_resource.shell[1] (remote-exec): ========================================\nnull_resource.shell[1] (remote-exec): Installing:\nnull_resource.shell[1] (remote-exec):  nginx x86_64 1:1.20.1-9.el7 epel 587 k\nnull_resource.shell[1] (remote-exec): Installing for dependencies:\nnull_resource.shell[1] (remote-exec):  gperftools-libs\nnull_resource.shell[1] (remote-exec):        x86_64 2.6.1-1.el7    os   272 k\nnull_resource.shell[1] (remote-exec):  nginx-filesystem\nnull_resource.shell[1] (remote-exec):        noarch 1:1.20.1-9.el7 epel  24 k\nnull_resource.shell[1] (remote-exec):  openssl11-libs\nnull_resource.shell[1] (remote-exec):        x86_64 1:1.1.1k-2.el7 epel 1.5 M\n\nnull_resource.shell[1] (remote-exec): Transaction Summary\nnull_resource.shell[1] (remote-exec): ========================================\nnull_resource.shell[1] (remote-exec): Install  1 Package (+3 Dependent packages)\n\nnull_resource.shell[1] (remote-exec): Total download size: 2.3 M\nnull_resource.shell[1] (remote-exec): Installed size: 6.6 M\nnull_resource.shell[1] (remote-exec): Downloading packages:\nnull_resource.shell[1] (remote-exec): (1/4): nginx-files |  24 kB   00:00\nnull_resource.shell[1] (remote-exec): (2/4): gperftools- | 272 kB   00:00\nnull_resource.shell[1] (remote-exec): (3/4): nginx-1.20. | 587 kB   00:00\nnull_resource.shell[1] (remote-exec): (4/4): openssl11-l | 1.5 MB   00:00\nnull_resource.shell[1] (remote-exec): ----------------------------------------\nnull_resource.shell[1] (remote-exec): Total      6.3 MB/s | 2.3 MB  00:00\nnull_resource.shell[1] (remote-exec): Running transaction check\nnull_resource.shell[1] (remote-exec): Running transaction test\nnull_resource.shell[1] (remote-exec): Transaction test succeeded\nnull_resource.shell[1] (remote-exec): Running transaction\nnull_resource.shell[1] (remote-exec): Warning: RPMDB altered outside of yum.\nnull_resource.shell[0] (remote-exec): --&gt; Finished Dependency Resolution\n\nnull_resource.shell[0] (remote-exec): Dependencies Resolved\n\nnull_resource.shell[0] (remote-exec): ========================================\nnull_resource.shell[0] (remote-exec):  Package\nnull_resource.shell[0] (remote-exec):        Arch   Version        Repository\nnull_resource.shell[0] (remote-exec):                                    Size\nnull_resource.shell[0] (remote-exec): ========================================\nnull_resource.shell[0] (remote-exec): Installing:\nnull_resource.shell[0] (remote-exec):  nginx x86_64 1:1.20.1-9.el7 epel 587 k\nnull_resource.shell[0] (remote-exec): Installing for dependencies:\nnull_resource.shell[0] (remote-exec):  gperftools-libs\nnull_resource.shell[0] (remote-exec):        x86_64 2.6.1-1.el7    os   272 k\nnull_resource.shell[0] (remote-exec):  nginx-filesystem\nnull_resource.shell[0] (remote-exec):        noarch 1:1.20.1-9.el7 epel  24 k\nnull_resource.shell[0] (remote-exec):  openssl11-libs\nnull_resource.shell[0] (remote-exec):        x86_64 1:1.1.1k-2.el7 epel 1.5 M\n\nnull_resource.shell[0] (remote-exec): Transaction Summary\nnull_resource.shell[0] (remote-exec): ========================================\nnull_resource.shell[0] (remote-exec): Install  1 Package (+3 Dependent packages)\n\nnull_resource.shell[0] (remote-exec): Total download size: 2.3 M\nnull_resource.shell[0] (remote-exec): Installed size: 6.6 M\nnull_resource.shell[0] (remote-exec): Downloading packages:\nnull_resource.shell[0] (remote-exec): (1/4): nginx-files |  24 kB   00:00\nnull_resource.shell[0] (remote-exec): (2/4): gperftools- | 272 kB   00:00\nnull_resource.shell[0] (remote-exec): (3/4): nginx-1.20. | 587 kB   00:00\nnull_resource.shell[0] (remote-exec): (4/4): openssl11-l | 1.5 MB   00:00\nnull_resource.shell[0] (remote-exec): ----------------------------------------\nnull_resource.shell[0] (remote-exec): Total      5.3 MB/s | 2.3 MB  00:00\nnull_resource.shell[0] (remote-exec): Running transaction check\nnull_resource.shell[0] (remote-exec): Running transaction test\nnull_resource.shell[0] (remote-exec): Transaction test succeeded\nnull_resource.shell[0] (remote-exec): Running transaction\nnull_resource.shell[1]: Still creating... [20s elapsed]\nnull_resource.shell[0]: Still creating... [20s elapsed]\nnull_resource.shell[0] (remote-exec):   Installing : 1:openss [         ] 1/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:openss [#        ] 1/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:openss [##       ] 1/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:openss [###      ] 1/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:openss [####     ] 1/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:openss [#####    ] 1/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:openss [######   ] 1/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:openss [#######  ] 1/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:openss [######## ] 1/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:openssl11-libs-1   1/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftoo [         ] 2/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftoo [#        ] 2/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftoo [##       ] 2/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftoo [###      ] 2/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftoo [####     ] 2/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftoo [#####    ] 2/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftoo [######   ] 2/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftoo [#######  ] 2/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftoo [######## ] 2/4\nnull_resource.shell[0] (remote-exec):   Installing : gperftools-libs-2.   2/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [         ] 3/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [##       ] 3/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [###      ] 3/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [####     ] 3/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [#####    ] 3/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [######   ] 3/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [#######  ] 3/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx-filesystem   3/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [         ] 4/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [#        ] 4/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [##       ] 4/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [###      ] 4/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [####     ] 4/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [#####    ] 4/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [######   ] 4/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [#######  ] 4/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx- [######## ] 4/4\nnull_resource.shell[0] (remote-exec):   Installing : 1:nginx-1.20.1-9.e   4/4\nnull_resource.shell[0] (remote-exec):   Verifying  : 1:nginx-filesystem   1/4\nnull_resource.shell[0] (remote-exec):   Verifying  : gperftools-libs-2.   2/4\nnull_resource.shell[0] (remote-exec):   Verifying  : 1:openssl11-libs-1   3/4\nnull_resource.shell[0] (remote-exec):   Verifying  : 1:nginx-1.20.1-9.e   4/4\n\nnull_resource.shell[0] (remote-exec): Installed:\nnull_resource.shell[0] (remote-exec):   nginx.x86_64 1:1.20.1-9.el7\n\nnull_resource.shell[0] (remote-exec): Dependency Installed:\nnull_resource.shell[0] (remote-exec):   gperftools-libs.x86_64 0:2.6.1-1.el7\nnull_resource.shell[0] (remote-exec):   nginx-filesystem.noarch 1:1.20.1-9.el7\nnull_resource.shell[0] (remote-exec):   openssl11-libs.x86_64 1:1.1.1k-2.el7\n\nnull_resource.shell[0] (remote-exec): Complete!\nnull_resource.shell[0] (remote-exec): \u25cf nginx.service - The nginx HTTP and reverse proxy server\nnull_resource.shell[0] (remote-exec):    Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)\nnull_resource.shell[0] (remote-exec):    Active: active (running) since Fri 2022-03-25 13:39:46 CST; 7ms ago\nnull_resource.shell[0] (remote-exec):   Process: 1879 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)\nnull_resource.shell[0] (remote-exec):   Process: 1877 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)\nnull_resource.shell[0] (remote-exec):   Process: 1875 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)\nnull_resource.shell[0] (remote-exec):  Main PID: 1881 (nginx)\nnull_resource.shell[0] (remote-exec):    CGroup: /system.slice/nginx.service\nnull_resource.shell[0] (remote-exec):            \u251c\u25001881 nginx: master proce...\nnull_resource.shell[0] (remote-exec):            \u2514\u25001883 nginx: master proce...\n\nnull_resource.shell[0] (remote-exec): Mar 25 13:39:46 xuel-tf-server-0 systemd[1]: ...\nnull_resource.shell[0] (remote-exec): Mar 25 13:39:46 xuel-tf-server-0 nginx[1877]: ...\nnull_resource.shell[0] (remote-exec): Mar 25 13:39:46 xuel-tf-server-0 nginx[1877]: ...\nnull_resource.shell[0] (remote-exec): Mar 25 13:39:46 xuel-tf-server-0 systemd[1]: ...\nnull_resource.shell[0] (remote-exec): Hint: Some lines were ellipsized, use -l to show in full.\nnull_resource.shell[0]: Creation complete after 21s [id=1417174727151706057]\nnull_resource.shell[1] (remote-exec): ** Found 2 pre-existing rpmdb problem(s), 'yum check' output follows:\nnull_resource.shell[1] (remote-exec): sudo-1.8.23-9.el7.x86_64 has missing requires of config(sudo) = ('0', '1.8.23', '9.el7')\nnull_resource.shell[1] (remote-exec): sudo-1.8.23-10.el7_9.1.x86_64 is a duplicate with sudo-1.8.23-9.el7.x86_64\nnull_resource.shell[1] (remote-exec):   Installing : 1:openss [         ] 1/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:openss [#        ] 1/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:openss [##       ] 1/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:openss [###      ] 1/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:openss [####     ] 1/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:openss [#####    ] 1/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:openss [######   ] 1/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:openss [#######  ] 1/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:openss [######## ] 1/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:openssl11-libs-1   1/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftoo [         ] 2/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftoo [#        ] 2/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftoo [##       ] 2/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftoo [###      ] 2/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftoo [####     ] 2/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftoo [#####    ] 2/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftoo [######   ] 2/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftoo [#######  ] 2/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftoo [######## ] 2/4\nnull_resource.shell[1] (remote-exec):   Installing : gperftools-libs-2.   2/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [         ] 3/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [##       ] 3/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [###      ] 3/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [####     ] 3/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [#####    ] 3/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [######   ] 3/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [#######  ] 3/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx-filesystem   3/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [         ] 4/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [#        ] 4/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [##       ] 4/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [###      ] 4/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [####     ] 4/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [#####    ] 4/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [######   ] 4/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [#######  ] 4/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx- [######## ] 4/4\nnull_resource.shell[1] (remote-exec):   Installing : 1:nginx-1.20.1-9.e   4/4\nnull_resource.shell[1] (remote-exec):   Verifying  : 1:nginx-filesystem   1/4\nnull_resource.shell[1] (remote-exec):   Verifying  : gperftools-libs-2.   2/4\nnull_resource.shell[1] (remote-exec):   Verifying  : 1:openssl11-libs-1   3/4\nnull_resource.shell[1] (remote-exec):   Verifying  : 1:nginx-1.20.1-9.e   4/4\n\nnull_resource.shell[1] (remote-exec): Installed:\nnull_resource.shell[1] (remote-exec):   nginx.x86_64 1:1.20.1-9.el7\n\nnull_resource.shell[1] (remote-exec): Dependency Installed:\nnull_resource.shell[1] (remote-exec):   gperftools-libs.x86_64 0:2.6.1-1.el7\nnull_resource.shell[1] (remote-exec):   nginx-filesystem.noarch 1:1.20.1-9.el7\nnull_resource.shell[1] (remote-exec):   openssl11-libs.x86_64 1:1.1.1k-2.el7\n\nnull_resource.shell[1] (remote-exec): Complete!\nnull_resource.shell[1] (remote-exec): \u25cf nginx.service - The nginx HTTP and reverse proxy server\nnull_resource.shell[1] (remote-exec):    Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)\nnull_resource.shell[1] (remote-exec):    Active: active (running) since Fri 2022-03-25 13:39:48 CST; 29ms ago\nnull_resource.shell[1] (remote-exec):   Process: 1877 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)\nnull_resource.shell[1] (remote-exec):   Process: 1875 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)\nnull_resource.shell[1] (remote-exec):   Process: 1873 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)\nnull_resource.shell[1] (remote-exec):  Main PID: 1879 (nginx)\nnull_resource.shell[1] (remote-exec):    CGroup: /system.slice/nginx.service\nnull_resource.shell[1] (remote-exec):            \u251c\u25001879 nginx: master proce...\nnull_resource.shell[1] (remote-exec):            \u2514\u25001881 nginx: master proce...\n\nnull_resource.shell[1] (remote-exec): Mar 25 13:39:47 xuel-tf-server-1 systemd[1]: ...\nnull_resource.shell[1] (remote-exec): Mar 25 13:39:47 xuel-tf-server-1 nginx[1875]: ...\nnull_resource.shell[1] (remote-exec): Mar 25 13:39:47 xuel-tf-server-1 nginx[1875]: ...\nnull_resource.shell[1] (remote-exec): Mar 25 13:39:48 xuel-tf-server-1 systemd[1]: ...\nnull_resource.shell[1] (remote-exec): Hint: Some lines were ellipsized, use -l to show in full.\nnull_resource.shell[1]: Creation complete after 24s [id=295940961618086294]\n\nApply complete! Resources: 7 added, 0 changed, 0 destroyed.\n\nOutputs:\n\nsummary = {\n  \"instance\" = {\n    \"0\" = {\n      \"allocate_public_ip\" = true\n      \"availability_zone\" = \"ap-guangzhou-3\"\n      \"bandwidth_package_id\" = tostring(null)\n      \"cam_role_name\" = \"\"\n      \"cdh_host_id\" = tostring(null)\n      \"cdh_instance_type\" = tostring(null)\n      \"create_time\" = \"2022-03-25T05:39:18Z\"\n      \"data_disks\" = tolist([\n        {\n          \"data_disk_id\" = \"disk-41j4k4fc\"\n          \"data_disk_size\" = 50\n          \"data_disk_snapshot_id\" = \"\"\n          \"data_disk_type\" = \"CLOUD_PREMIUM\"\n          \"delete_with_instance\" = true\n          \"encrypt\" = false\n          \"throughput_performance\" = 0\n        },\n      ])\n      \"disable_monitor_service\" = false\n      \"disable_security_service\" = false\n      \"expired_time\" = \"\"\n      \"force_delete\" = false\n      \"hostname\" = \"xuel-tf-server-0\"\n      \"id\" = \"ins-ifzhv2g6\"\n      \"image_id\" = \"img-oikl1tzv\"\n      \"instance_charge_type\" = \"POSTPAID_BY_HOUR\"\n      \"instance_charge_type_prepaid_period\" = tonumber(null)\n      \"instance_charge_type_prepaid_renew_flag\" = \"\"\n      \"instance_count\" = tonumber(null)\n      \"instance_name\" = \"xuel-tf-server-0\"\n      \"instance_status\" = \"RUNNING\"\n      \"instance_type\" = \"S3.SMALL1\"\n      \"internet_charge_type\" = \"TRAFFIC_POSTPAID_BY_HOUR\"\n      \"internet_max_bandwidth_out\" = 2\n      \"keep_image_login\" = tobool(null)\n      \"key_name\" = \"skey-ermat2er\"\n      \"password\" = tostring(null)\n      \"placement_group_id\" = tostring(null)\n      \"private_ip\" = \"10.0.1.17\"\n      \"project_id\" = 0\n      \"public_ip\" = \"175.178.92.230\"\n      \"running_flag\" = true\n      \"security_groups\" = toset([\n        \"sg-el0589mr\",\n      ])\n      \"spot_instance_type\" = tostring(null)\n      \"spot_max_price\" = tostring(null)\n      \"stopped_mode\" = tostring(null)\n      \"subnet_id\" = \"subnet-079md4re\"\n      \"system_disk_id\" = \"disk-iwrdhd2c\"\n      \"system_disk_size\" = 50\n      \"system_disk_type\" = \"CLOUD_PREMIUM\"\n      \"tags\" = tomap({\n        \"tagkey\" = \"xueltag\"\n      })\n      \"user_data\" = tostring(null)\n      \"user_data_raw\" = tostring(null)\n      \"vpc_id\" = \"vpc-gu4gmx1h\"\n    }\n    \"1\" = {\n      \"allocate_public_ip\" = true\n      \"availability_zone\" = \"ap-guangzhou-3\"\n      \"bandwidth_package_id\" = tostring(null)\n      \"cam_role_name\" = \"\"\n      \"cdh_host_id\" = tostring(null)\n      \"cdh_instance_type\" = tostring(null)\n      \"create_time\" = \"2022-03-25T05:39:16Z\"\n      \"data_disks\" = tolist([\n        {\n          \"data_disk_id\" = \"disk-hbccuysq\"\n          \"data_disk_size\" = 50\n          \"data_disk_snapshot_id\" = \"\"\n          \"data_disk_type\" = \"CLOUD_PREMIUM\"\n          \"delete_with_instance\" = true\n          \"encrypt\" = false\n          \"throughput_performance\" = 0\n        },\n      ])\n      \"disable_monitor_service\" = false\n      \"disable_security_service\" = false\n      \"expired_time\" = \"\"\n      \"force_delete\" = false\n      \"hostname\" = \"xuel-tf-server-1\"\n      \"id\" = \"ins-562f4vl0\"\n      \"image_id\" = \"img-oikl1tzv\"\n      \"instance_charge_type\" = \"POSTPAID_BY_HOUR\"\n      \"instance_charge_type_prepaid_period\" = tonumber(null)\n      \"instance_charge_type_prepaid_renew_flag\" = \"\"\n      \"instance_count\" = tonumber(null)\n      \"instance_name\" = \"xuel-tf-server-1\"\n      \"instance_status\" = \"RUNNING\"\n      \"instance_type\" = \"S3.SMALL1\"\n      \"internet_charge_type\" = \"TRAFFIC_POSTPAID_BY_HOUR\"\n      \"internet_max_bandwidth_out\" = 2\n      \"keep_image_login\" = tobool(null)\n      \"key_name\" = \"skey-ermat2er\"\n      \"password\" = tostring(null)\n      \"placement_group_id\" = tostring(null)\n      \"private_ip\" = \"10.0.1.9\"\n      \"project_id\" = 0\n      \"public_ip\" = \"175.178.227.93\"\n      \"running_flag\" = true\n      \"security_groups\" = toset([\n        \"sg-el0589mr\",\n      ])\n      \"spot_instance_type\" = tostring(null)\n      \"spot_max_price\" = tostring(null)\n      \"stopped_mode\" = tostring(null)\n      \"subnet_id\" = \"subnet-079md4re\"\n      \"system_disk_id\" = \"disk-apa47ubq\"\n      \"system_disk_size\" = 50\n      \"system_disk_type\" = \"CLOUD_PREMIUM\"\n      \"tags\" = tomap({})\n      \"user_data\" = tostring(null)\n      \"user_data_raw\" = tostring(null)\n      \"vpc_id\" = \"vpc-gu4gmx1h\"\n    }\n  }\n}\n</code></pre> <p>\u751f\u6210\u56fe\u7247</p> <pre><code>terraform graph | dot -Tsvg &gt; graph.svg\n</code></pre> <p></p> <p>\u901a\u8fc7\u516c\u52a1IP\u8fdb\u884c\u6d4b\u8bd5\uff1a</p> <p></p>"},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_6","title":"\u516d \u5176\u4ed6","text":"<p>\u76ee\u524d\u914d\u7f6e\u7ba1\u7406\u901a\u8fc7terraform\u63d0\u4f9b\u7684provisioner\u6765\u5b9e\u73b0\uff0c\u4f46\u662f\u5176\u5b58\u5728\u4e00\u5b9a\u7684\u5f0a\u7aef\uff0c\u4f8b\u5982\u811a\u672c\u5185\u5bb9\u76f4\u63a5\u8026\u5408\u5728tf\u5b9e\u4f8b\u4e2d\uff0c\u4e0d\u80fd\u5f88\u597d\u7684\u89e3\u8026\u57fa\u7840\u8bbe\u65bd\u548c\u914d\u7f6e\uff0cprovisioner \u4e2d\u7684\u811a\u672c\u5982\u679c\u6267\u884c\u5931\u8d25\u4e0d\u53ef\u63a7\uff0c\u4e0d\u5177\u5907</p>"},{"location":"devops/IaC/Terraform/Terraform%E5%AE%8C%E6%88%90%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%BC%96%E6%8E%92/#_7","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://developer.aliyun.com/article/118719</li> <li>https://spacelift.io/blog/ansible-vs-terraform</li> <li>https://www.gingerdoc.com/tutorials/how-to-use-ansible-with-terraform-for-configuration-management</li> <li>https://www.hashicorp.com/resources/ansible-terraform-better-together</li> <li>https://alex.dzyoba.com/blog/terraform-ansible/</li> </ul>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/","title":"Terraform \u76f8\u5173\u6982\u5ff5\u53ca\u51fd\u6570","text":""},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#metadata","title":"\u4e00 Metadata","text":"<p>Metadata\u662fTerraform\u652f\u6301\u7684\u5185\u7f6e\u5143\u53c2\u6570\uff0c\u53ef\u4ee5\u5728 provider\uff0cresource\uff0cdata\u5757\u4e2d\u4f7f\u7528\u3002\u672c\u7ae0\u8282\u4e3b\u8981\u4ecb\u7ecd resource\u5757\u652f\u6301\u7684\u5143\u53c2\u6570\uff0c\u4e3b\u8981\u5305\u62ec\uff1a</p> <ul> <li>depends_on\uff1a\u7528\u4e8e\u6307\u5b9a\u8d44\u6e90\u7684\u4f9d\u8d56\u9879</li> <li>count\uff1a\u7528\u4e8e\u521b\u5efa\u591a\u4e2a\u76f8\u540c\u914d\u7f6e\u7684\u8d44\u6e90</li> <li>for_each\uff1a\u7528\u4e8e\u6839\u636e\u6620\u5c04\u3001\u5b57\u7b26\u4e32\u96c6\u5408\u521b\u5efa\u591a\u4e2a\u8d44\u6e90</li> <li>provider\uff1a\u7528\u4e8e\u9009\u62e9\u975e\u9ed8\u8ba4\u7684 provider</li> <li>lifecycle\uff1a\u7528\u4e8e\u5b9a\u5236\u8d44\u6e90\u7684\u751f\u547d\u5468\u671f</li> </ul>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#11-depends_on","title":"1.1 depends_on","text":"<p>\u5728\u540c\u4e00\u4e2a Terraform \u914d\u7f6e\u6587\u4ef6\u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u8d44\u6e90\u3002\u901a\u8fc7\u5728\u8d44\u6e90\u4e2d\u5f15\u7528\u5176\u4ed6\u8d44\u6e90\u7684\u5c5e\u6027\u503c\uff0cTerraform\u53ef\u4ee5\u81ea\u52a8\u63a8\u65ad\u51fa\u8d44\u6e90\u7684\u4f9d\u8d56\u5173\u7cfb\u3002\u7136\u800c\uff0c\u67d0\u4e9b\u8d44\u6e90\u7684\u4f9d\u8d56\u5173\u7cfb\u5bf9\u4e8eTerraform\u662f\u4e0d\u53ef\u89c1\u7684\uff0c\u8fd9\u5c31\u9700\u8981\u4f7f\u7528 depends_on \u6765\u521b\u5efa\u663e\u5f0f\u4f9d\u8d56\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 depends_on \u6765\u66f4\u6539\u8d44\u6e90\u7684\u521b\u5efa\u987a\u5e8f\u6216\u6267\u884c\u987a\u5e8f\uff0c\u4f7f\u5176\u5728\u6240\u4f9d\u8d56\u8d44\u6e90\u4e4b\u540e\u5904\u7406\u3002depends_on \u7684\u8868\u8fbe\u5f0f\u662f\u4f9d\u8d56\u8d44\u6e90\u7684\u5730\u5740\u5217\u8868\u3002\u4f8b\u5982\u6211\u4eec\u5728\u8fdc\u7a0b\u64cd\u4f5c\u4e00\u53f0ECS\u670d\u52a1\u5668\u4e4b\u524d\uff0c\u9700\u8981\u4e3a\u5176\u7ed1\u5b9aEIP\u6216\u914d\u7f6eNAT\u89c4\u5219\u3002</p> <pre><code>resource \"huaweicloud_compute_instance\" \"myinstance\" {\n  ...\n}\n\nresource \"huaweicloud_vpc_eip\" \"myeip\" {\n  ...\n}\n\nresource \"huaweicloud_compute_eip_associate\" \"associated\" {\n  public_ip   = huaweicloud_vpc_eip.myeip.address\n  instance_id = huaweicloud_compute_instance.myinstance.id\n}\n\nresource \"null_resource\" \"provision\" {\n  depends_on = [huaweicloud_compute_eip_associate.associated]\n\n  provisioner \"remote-exec\" {\n    connection {\n      # \u901a\u8fc7\u516c\u7f51\u5730\u5740\u8bbf\u95ee ECS\n      host = huaweicloud_vpc_eip.myeip.address\n      ...\n    }\n    inline = [\n      ...\n    ]\n  }\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#12-count","title":"1.2 count","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cTerraform\u7684 resource\u5757\u53ea\u914d\u7f6e\u4e00\u4e2a\u8d44\u6e90\u3002\u5f53\u6211\u4eec\u9700\u8981\u521b\u5efa\u591a\u4e2a\u76f8\u540c\u7684\u8d44\u6e90\u65f6\uff0c\u5982\u679c\u914d\u7f6e\u591a\u4e2a\u72ec\u7acb\u7684 resource\u5757\u5c31\u663e\u5f97\u5f88\u5197\u4f59\uff0c\u4e14\u4e0d\u5229\u4e8e\u7ef4\u62a4\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 count \u6216 for_each \u53c2\u6570\u5728\u540c\u4e00\u4e2a resource\u5757\u4e2d\u7ba1\u7406\u591a\u4e2a\u76f8\u540c\u7684\u8d44\u6e90\u3002\u5728\u540c\u4e00\u4e2a resource\u5757\u4e2d\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528count \u548c for_each \u53c2\u6570\u3002\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>resource \"huaweicloud_evs_volume\" \"volumes\" {\n  count = 3\n\n  size              = 20\n  volume_type       = \"SSD\"\n  availability_zone = \"cn-north-4a\"\n}\n</code></pre> <p>\u6211\u4eec\u901a\u8fc7\u5982\u4e0a\u914d\u7f6e\u521b\u5efa\u4e863\u4e2a\u76f8\u540c\u7684\u4e91\u786c\u76d8\uff08EVS\uff09\u3002\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\uff0cProvider \u8981\u6c42\u521b\u5efa\u8d44\u6e90\u7684\u67d0\u4e9b\u53c2\u6570\u5177\u6709\u552f\u4e00\u6027\uff0c\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \"count.index\" \u5c5e\u6027\u6765\u8fdb\u884c\u533a\u5206\uff0c\u8fd9\u662f\u4e00\u4e2a\u4ece0\u5f00\u59cb\u8ba1\u6570\u7684\u7d22\u5f15\u503c\u3002</p> <pre><code>resource \"huaweicloud_vpc\" \"vpcs\" {\n  count = 2\n  name  = \"myvpc_${count.index}\"\n  cidr  = \"192.168.0.0/16\"\n}\n</code></pre> <p>\u6211\u4eec\u901a\u8fc7\u5982\u4e0a\u914d\u7f6e\u521b\u5efa\u4e86\u4e24\u4e2aVPC\uff0c\u540d\u5b57\u5206\u522b\u4e3a myvpc_0 \u548c myvpc_1\uff0c\u5b83\u4eec\u5177\u6709\u76f8\u540c\u7684CIDR\u503c\u3002\u5982\u679c\u8fdb\u4e00\u6b65\u4fee\u6539CIDR\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u58f0\u660e\u4e00\u4e2astring\u5217\u8868\u7528\u4e8e\u5b58\u50a8\u4e0d\u540cVPC\u7684CIDR\u503c\uff0c\u7136\u540e\u901a\u8fc7 count.index \u53bb\u8bbf\u95ee\u5217\u8868\u5143\u7d20\u3002</p> <pre><code>variable \"name_list\" {\n  type    = list(string)\n  default = [\"vpc_demo1\", \"vpc_demo2\"]\n}\nvariable \"cidr_list\" {\n  type    = list(string)\n  default = [\"192.168.0.0/16\", \"172.16.0.0/16\"]\n}\n\nresource \"huaweicloud_vpc\" \"vpcs\" {\n  count = 2\n  name  = var.name_list[count.index]\n  cidr  = var.cidr_list[count.index]\n}\n</code></pre> <p>\u4f7f\u7528 count \u521b\u5efa\u7684\u8d44\u6e90\u9700\u8981\u901a\u8fc7\u7d22\u5f15\u503c\u8fdb\u884c\u8bbf\u95ee\uff0c\u683c\u5f0f\u4e3a\uff1a&lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u540d\u79f0&gt;[\u7d22\u5f15\u503c]</p> <pre><code># \u8bbf\u95ee\u7b2c\u4e00\u4e2aVPC\n&gt; huaweicloud_vpc.vpcs[0]\n\n# \u8bbf\u95ee\u7b2c\u4e00\u4e2aVPC\u7684ID\n&gt; huaweicloud_vpc.vpcs[0].id\n\n# \u8bbf\u95ee\u6240\u6709VPC\u7684ID\n&gt; huaweicloud_vpc.vpcs[*].id\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#13-for_each","title":"1.3 for_each","text":"<p>for_each \u5728\u529f\u80fd\u4e0a\u4e0e count \u76f8\u4f3c\uff0cfor_each \u4f7f\u7528\u952e\u503c\u5bf9\u6216\u5b57\u7b26\u4e32\u96c6\u5408\u7684\u5f62\u5f0f\u5feb\u901f\u5730\u5c06\u503c\u586b\u5165\u5230\u5bf9\u5e94\u7684\u5c5e\u6027\u4e2d\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u4f18\u5316\u811a\u672c\u7ed3\u6784\u4e5f\u6709\u5229\u4e8e\u7406\u89e3\u591a\u5b9e\u4f8b\u95f4\u7684\u5173\u7cfb\u3002</p> <p>\u5728\u4f7f\u7528\u6620\u5c04\u7c7b\u578b\u8868\u8fbe\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \"each.key\" \u548c \"each.value\" \u6765\u8bbf\u95ee\u6620\u5c04\u7684\u952e\u548c\u503c\u3002\u4ee5\u521b\u5efaVPC\u4e3a\u4f8b\uff0c\u901a\u8fc7 for_each \u4e2d\u7684\u952e\u503c\u5bf9\uff0c\u6211\u4eec\u53ef\u4ee5\u7075\u6d3b\u914d\u7f6eVPC\u7684\u540d\u79f0\u548cCIDR\u3002</p> <pre><code>resource \"hauweicloud_vpc\" \"vpc\" {\n  for_each = {\n    vpc_demo1 = \"192.168.0.0/16\"\n    vpc_demo2 = \"172.16.0.0/16\"\n}\n\n  name = each.key\n  cidr = each.value\n}\n</code></pre> <p>\u5728\u4f7f\u7528\u5b57\u7b26\u4e32\u96c6\u5408\u7c7b\u578b\u8868\u8fbe\u65f6\uff0c\"each.key\" \u7b49\u540c\u4e8e \"each.value\"\uff0c\u6211\u4eec\u4e00\u822c\u4f7f\u7528 each.key\u8868\u793a\uff0c\u53e6\u5916\uff0c\u53ef\u4ee5\u901a\u8fc7 toset() \u51fd\u6570\u5c06\u5b9a\u4e49\u7684 list \u7c7b\u578b\u8fdb\u884c\u8f6c\u5316</p> <pre><code>resource \"huaweicloud_networking_secgroup\" \"mysecgroup\" {\n  for_each = toset([\"secgroup_demo1\", \"secgroup_demo2\"])\n  name     = each.key\n}\n\n# \u901a\u8fc7\u53d8\u91cf\u8868\u793a for _each\nvariable \"secgroup_name\" {\n  type = set(string)\n}\nresource \"huaweicloud_networking_secgroup\" \"mysecgroup\" {\n  for_each = var.secgroup_name\n  name     = each.key\n}\n</code></pre> <p>\u4f7f\u7528 for_each \u521b\u5efa\u7684\u8d44\u6e90\u9700\u8981\u901a\u8fc7\u952e\u540d\u8fdb\u884c\u8bbf\u95ee\uff0c\u683c\u5f0f\u4e3a\uff1a&lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u540d\u79f0&gt;[\u952e\u540d]</p> <pre><code># \u8bbf\u95ee vpc_demo1\n&gt; huaweicloud_vpc.vpcs[\"vpc_demo1\"]\n\n# \u8bbf\u95ee vpc_demo1 \u7684ID\n&gt; huaweicloud_vpc.vpcs[\"vpc_demo1\"].id\n</code></pre> <p>\u7531\u4e8e count \u548c for_each \u90fd\u53ef\u7528\u4e8e\u521b\u5efa\u591a\u4e2a\u8d44\u6e90\uff0c\u5efa\u8bae\u53c2\u8003\u4ee5\u4e0b\u89c4\u5219\u8fdb\u884c\u9009\u62e9\uff1a</p> <p>1\u3001\u5982\u679c\u8d44\u6e90\u5b9e\u4f8b\u7684\u53c2\u6570\u5b8c\u5168\u6216\u8005\u5927\u90e8\u5206\u4e00\u81f4\uff0c\u5efa\u8bae\u4f7f\u7528count\uff1b</p> <p>2\u3001\u5982\u679c\u8d44\u6e90\u7684\u67d0\u4e9b\u53c2\u6570\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7684\u503c\u5e76\u4e14\u8fd9\u4e9b\u503c\u4e0d\u80fd\u7531\u6574\u6570\u6d3e\u751f\uff0c\u5efa\u8bae\u4f7f\u7528 for_each\uff1b</p>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#14-provider","title":"1.4 provider","text":"<p>\u5728Terraform\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 provider\u5757\u521b\u5efa\u591a\u4e2a\u914d\u7f6e\uff0c\u5176\u4e2d\u4e00\u4e2a provider\u5757\u4e3a\u9ed8\u8ba4\u914d\u7f6e\uff0c\u5176\u5b83\u5757\u4f7f\u7528 \"alias\" \u6807\u8bc6\u4e3a\u975e\u9ed8\u8ba4\u914d\u7f6e\u3002\u5728\u8d44\u6e90\u4e2d\u4f7f\u7528\u5143\u53c2\u6570 provider \u53ef\u4ee5\u9009\u62e9\u975e\u9ed8\u8ba4\u7684 provider\u5757\u3002\u4f8b\u5982\u6211\u4eec\u9700\u8981\u5728\u4e0d\u540c\u7684\u5730\u533a\u7ba1\u7406\u8d44\u6e90\uff0c\u9996\u5148\u9700\u8981\u58f0\u660e\u591a\u4e2a provider\u5757\uff1a</p> <pre><code>provider \"huaweicloud\" {\n  region = \"cn-north-1\"\n  ...\n}\n\nprovider \"huaweicloud\" {\n  alias  = \"guangzhou\"\n  region = \"cn-south-1\"\n  ...\n}\n</code></pre> <p>\u793a\u4f8b\u4e2d\u6211\u4eec\u58f0\u660e\u4e86\u5317\u4eac\u548c\u5e7f\u5dde\u7684\u534e\u4e3a\u4e91provider\uff0c\u5e76\u5bf9\u5e7f\u5dde\u5730\u533a\u7684provider\u589e\u52a0\u4e86\u522b\u540d\u3002\u6211\u4eec\u5728\u8d44\u6e90\u4e2d\u4f7f\u7528\u5143\u53c2\u6570 provider \u6765\u9009\u62e9\u975e\u9ed8\u8ba4\u7684 provider\u5757\uff0c\u5176\u683c\u5f0f\u4e3a\uff1a.&lt;\u522b\u540d&gt;\u3002 <pre><code>resource \"huaweicloud_networking_secgroup\" \"mysecgroup\" {\n  # \u4f7f\u7528\u975e\u9ed8\u8ba4 provider\u5757\u540d\uff0c\u5bf9\u5e94\u975e\u9ed8\u8ba4provider\u5757\u7684\u522b\u540d(alias)\n  provider = huaweicloud.guangzhou\n  ...\n}\n</code></pre> <p>\u534e\u4e3a\u4e91Provider \u652f\u6301\u5728Resource\u4e2d\u6307\u5b9aregion\u53c2\u6570\uff0c\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u5730\u533a\u521b\u5efa\u8d44\u6e90\u3002\u76f8\u6bd4 alias + provider \u7684\u65b9\u5f0f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u66f4\u52a0\u7075\u6d3b\u7b80\u5355\u3002</p> <pre><code>provider \"huaweicloud\" {\n  region = \"cn-north-1\"\n  ...\n}\n\nresource \"huaweicloud_vpc\" \"example\" {\n  region = \"cn-south-1\"\n  name   = \"terraform_vpc\"\n  cidr   = \"192.168.0.0/16\"\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#15-lifecycle","title":"1.5 lifecycle","text":"<p>\u6bcf\u4e2a\u8d44\u6e90\u5b9e\u4f8b\u90fd\u5177\u6709\u521b\u5efa \u3001\u66f4\u65b0\u548c\u9500\u6bc1\u4e09\u4e2a\u9636\u6bb5\uff0c\u5728\u4e00\u4e2a\u8d44\u6e90\u5b9e\u4f8b\u7684\u751f\u547d\u5468\u671f\u8fc7\u7a0b\u4e2d\u90fd\u4f1a\u7ecf\u5386\u5176\u4e2d\u76842\u81f33\u4e2a\u9636\u6bb5\u3002\u901a\u8fc7\u5143\u53c2\u6570 lifecycle \u53ef\u4ee5\u5bf9\u8d44\u6e90\u5b9e\u4f8b\u7684\u751f\u547d\u5468\u671f\u8fc7\u7a0b\u8fdb\u884c\u6539\u53d8\uff0clifecycle \u652f\u6301\u4ee5\u4e0b\u53c2\u6570\uff1a</p>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#151-create_before_destroy","title":"1.5.1 create_before_destroy","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u6211\u4eec\u9700\u8981\u6539\u53d8\u8d44\u6e90\u4e2d\u4e0d\u652f\u6301\u66f4\u65b0\u7684\u53c2\u6570\u65f6\uff0cTerraform\u4f1a\u5148\u9500\u6bc1\u5df2\u6709\u5b9e\u4f8b\uff0c\u518d\u4f7f\u7528\u65b0\u914d\u7f6e\u7684\u53c2\u6570\u521b\u5efa\u65b0\u7684\u5bf9\u8c61\u8fdb\u884c\u66ff\u6362\u3002\u5f53\u6211\u4eec\u5c06 create_before_destroy \u53c2\u6570\u8bbe\u7f6e\u4e3a true \u65f6\uff0cTerraform\u5c06\u5148\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b\uff0c\u518d\u9500\u6bc1\u4e4b\u524d\u7684\u5b9e\u4f8b\u3002\u8fd9\u4e2a\u53c2\u6570\u53ef\u4ee5\u9002\u7528\u4e8e\u4fdd\u6301\u4e1a\u52a1\u8fde\u7eed\u7684\u573a\u666f\uff0c\u7531\u4e8e\u65b0\u65e7\u5b9e\u4f8b\u4f1a\u540c\u65f6\u5b58\u5728\uff0c\u9700\u8981\u63d0\u524d\u786e\u8ba4\u8d44\u6e90\u5b9e\u4f8b\u662f\u5426\u6709\u552f\u4e00\u7684\u540d\u79f0\u8981\u6c42\u6216\u5176\u4ed6\u7ea6\u675f\u3002</p> <pre><code>lifecycle {\n  create_before_destroy = true\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#152-prevent_destroy","title":"1.5.2 prevent_destroy","text":"<p>\u5f53\u6211\u4eec\u5c06 prevent_destroy \u53c2\u6570\u8bbe\u7f6e\u4e3atrue\u65f6\uff0cTerraform\u5c06\u4f1a\u963b\u6b62\u5bf9\u6b64\u8d44\u6e90\u7684\u5220\u9664\u64cd\u4f5c\u5e76\u8fd4\u56de\u9519\u8bef\u3002\u8fd9\u4e2a\u5143\u53c2\u6570\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u79cd\u9632\u6b62\u56e0\u610f\u5916\u64cd\u4f5c\u800c\u91cd\u65b0\u521b\u5efa\u6210\u672c\u8f83\u9ad8\u5b9e\u4f8b\u7684\u5b89\u5168\u63aa\u65bd\uff0c\u4f8b\u5982\u6570\u636e\u5e93\u5b9e\u4f8b\u3002\u5982\u679c\u8981\u5220\u9664\u6b64\u8d44\u6e90\uff0c\u9700\u8981\u5c06\u8fd9\u4e2a\u914d\u7f6e\u5220\u9664\u540e\u518d\u6267\u884c destroy \u64cd\u4f5c\u3002</p> <pre><code>lifecycle {\n  prevent_destroy = true\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#153-ignore_changes","title":"1.5.3 ignore_changes","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cTerraform plan/apply \u64cd\u4f5c\u5c06\u68c0\u6d4b\u4e91\u4e0a\u8d44\u6e90\u7684\u5c5e\u6027\u548c\u672c\u5730\u8d44\u6e90\u5757\u4e2d\u7684\u5dee\u5f02\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\u5c06\u4f1a\u8c03\u7528\u66f4\u65b0\u6216\u8005\u91cd\u5efa\u64cd\u4f5c\u6765\u5339\u914d\u914d\u7f6e\u3002\u6211\u4eec\u53ef\u4ee5\u7528 ignore_changes \u6765\u5ffd\u7565\u67d0\u4e9b\u53c2\u6570\u4e0d\u8fdb\u884c\u66f4\u65b0\u6216\u91cd\u65b0\u3002ignore_changes \u7684\u503c\u53ef\u4ee5\u662f\u5c5e\u6027\u7684\u76f8\u5bf9\u5730\u5740\u5217\u8868\uff0c\u5bf9\u4e8e Map \u548c List \u7c7b\u578b\uff0c\u53ef\u4ee5\u4f7f\u7528\u7d22\u5f15\u8868\u793a\u6cd5\u5f15\u7528\uff0c\u5982 tags[\"Name\"]\uff0clist[0] \u7b49\u3002</p> <pre><code>resource \"huaweicloud_rds_instance\" \"myinstance\" {\n  ...\n  lifecycle {\n    ignore_changes = [\n      name,\n    ]\n  }\n}\n</code></pre> <p>\u6b64\u65f6\uff0cTerraform \u5c06\u4f1a\u5ffd\u7565\u5bf9 name \u53c2\u6570\u7684\u4fee\u6539\u3002\u9664\u4e86\u5217\u8868\u4e4b\u5916\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5173\u952e\u5b57 all \u5ffd\u7565\u6240\u6709\u5c5e\u6027\u7684\u66f4\u65b0\u3002</p> <pre><code>resource \"huaweicloud_rds_instance\" \"myinstance\" {\n  ...\n  lifecycle {\n    ignore_changes = all\n  }\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#_1","title":"\u4e8c \u5e38\u7528\u51fd\u6570","text":""},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#21-cocatflatten","title":"2.1 cocat\u4e0eflatten \u533a\u522b","text":"<ul> <li>Concat \u63a5\u53d7\u4e24\u4e2a\u6216\u591a\u4e2a\u5217\u8868\u5e76\u5c06\u5b83\u4eec\u7ec4\u5408\u6210\u5355\u4e2a\u5217\u8868\u3002</li> </ul> <pre><code>&gt; concat([\"a\", \"\"], [\"b\", \"c\"])\n[\n  \"a\",\n  \"\",\n  \"b\",\n  \"c\",\n]\n</code></pre> <ul> <li>flatten</li> </ul> <p>flatten \u63a5\u53d7\u4e00\u4e2a\u5217\u8868\u5e76\u5c06\u4efb\u4f55\u5217\u8868\u5143\u7d20\u66ff\u6362\u4e3a\u5217\u8868\u5185\u5bb9\u7684\u6241\u5e73\u5e8f\u5217\u3002</p> <pre><code>&gt; flatten([[\"a\", \"b\"], [], [\"c\"]])\n[\"a\", \"b\", \"c\"]\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#22-lookup-element","title":"2.2 lookup \u548c element","text":"<ul> <li>lookup</li> </ul> <pre><code>&gt; lookup({a=\"ay\", b=\"bee\"}, \"a\", \"what?\")\nay\n&gt; lookup({a=\"ay\", b=\"bee\"}, \"c\", \"what?\")\nwhat?\n</code></pre> <ul> <li>element</li> </ul> <pre><code># element \u4ece\u5217\u8868\u4e2d\u68c0\u7d22\u5355\u4e2a\u5143\u7d20\u3002\n&gt; element([\"a\", \"b\", \"c\"], 1)\nb\n\n# \u5982\u679c\u7ed9\u5b9a\u7684\u7d22\u5f15\u5927\u4e8e\u5217\u8868\u7684\u957f\u5ea6\uff0c\u5219\u901a\u8fc7\u5c06\u7d22\u5f15\u53d6\u6a21\u5217\u8868\u7684\u957f\u5ea6\u6765\u201c\u73af\u7ed5\u201d\u7d22\u5f15\uff1a\n&gt; element([\"a\", \"b\", \"c\"], 3)\na\n\n&gt; element([\"a\", \"b\", \"c\"], length([\"a\", \"b\", \"c\"])-1)\nc\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#23-merge","title":"2.3 Merge","text":"<p>Merge \u63a5\u53d7\u4efb\u610f\u6570\u91cf\u7684\u6620\u5c04\u6216\u5bf9\u8c61\uff0c\u5e76\u8fd4\u56de\u5305\u542b\u6765\u81ea\u6240\u6709\u53c2\u6570\u7684\u5408\u5e76\u5143\u7d20\u96c6\u7684\u5355\u4e2a\u6620\u5c04\u6216\u5bf9\u8c61\u3002\u5982\u679c\u591a\u4e2a\u7ed9\u5b9a\u7684\u6620\u5c04\u6216\u5bf9\u8c61\u5b9a\u4e49\u4e86\u76f8\u540c\u7684\u952e\u6216\u5c5e\u6027\uff0c\u90a3\u4e48\u53c2\u6570\u5e8f\u5217\u4e2d\u540e\u9762\u7684\u90a3\u4e2a\u5c06\u4f18\u5148\u3002\u5982\u679c\u53c2\u6570\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u5219\u5728\u5e94\u7528\u5408\u5e76\u89c4\u5219\u4e4b\u540e\uff0c\u7ed3\u679c\u7c7b\u578b\u5c06\u662f\u4e0e\u5c5e\u6027\u7c7b\u578b\u7ed3\u6784\u5339\u914d\u7684\u5bf9\u8c61\u3002</p> <pre><code>&gt; merge({a=\"b\", c=\"d\"}, {e=\"f\", c=\"z\"})\n{\n  \"a\" = \"b\"\n  \"c\" = \"z\"\n  \"e\" = \"f\"\n}\n\n&gt; merge({a=\"b\"}, {a=[1,2], c=\"z\"}, {d=3})\n{\n  \"a\" = [\n    1,\n    2,\n  ]\n  \"c\" = \"z\"\n  \"d\" = 3\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#_2","title":"\u4e09 \u8868\u8fbe\u5f0f","text":"<p>\u5982\u679c var.list \u662f\u6240\u6709\u5177\u6709\u5c5e\u6027 id \u7684\u5bf9\u8c61\u7684\u5217\u8868\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b for \u8868\u8fbe\u5f0f\u751f\u6210 id \u5217\u8868\uff1a</p> <pre><code>[for o in var.list : o.id]\nvar.list[*].id\n\n\nvar.list[*].interfaces[0].name\n[for o in var.list : o.interfaces[0].name]\n</code></pre>"},{"location":"devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/#_3","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://support.huaweicloud.com/basics-terraform/terraform_0015.html</li> <li>https://cloud.tencent.com/document/product/1213/67049</li> <li>https://www.terraform.io/language/functions/merge</li> </ul>"},{"location":"devops/IaC/Terraform/terraform%20cloud/","title":"Terraform cloud","text":""},{"location":"devops/IaC/Terraform/terraform%20cloud/#terraform-cloud","title":"Terraform Cloud","text":""},{"location":"devops/IaC/Terraform/terraform%20cloud/#_1","title":"\u4e00 \u80cc\u666f","text":"<p>Hashicorp\u57282019\u5e745\u6708\u51b3\u5b9a\u5c06Terraform Cloud\u7684\u8fdc\u7a0b\u72b6\u6001\u7ba1\u7406\u529f\u80fd\u514d\u8d39\u5f00\u653e\u7ed9\u5f00\u6e90\u7248\u7528\u6237\u3002\u8fd9\u4e2a\u7248\u672c\u4e5f\u540c\u65f6\u5f00\u653e\u4e86\u66f4\u591a\u7684\u514d\u8d39\u529f\u80fd\u7ed9\u4e0d\u8d85\u8fc75\u4eba\u7684\u56e2\u961f\u4f7f\u7528\u3002Terraform Cloud\u7684\u529f\u80fd\u5206\u6210\u514d\u8d39\u7248\u3001\u56e2\u961f\u7248\u4ee5\u53ca\u96c6\u4e2d\u63a7\u5236\u529f\u80fd\uff0c\u672c\u6587\u4e3b\u8981\u5bf9\u514d\u8d39\u7248\u529f\u80fd\u8fdb\u884c\u4ecb\u7ecd\u3002</p> <p>Terraform Cloud \u662f\u4e00\u4e2a\u5e2e\u52a9\u56e2\u961f\u4e00\u8d77\u4f7f\u7528 Terraform \u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u5b83\u7ba1\u7406 Terraform \u5728\u4e00\u4e2a\u4e00\u81f4\u548c\u53ef\u9760\u7684\u73af\u5883\u4e2d\u8fd0\u884c\uff0c\u5305\u62ec\u5bb9\u6613\u8bbf\u95ee\u5171\u4eab\u7684\u72b6\u6001\u548c\u79d8\u5bc6\u6570\u636e\uff0c\u7528\u4e8e\u6279\u51c6\u57fa\u7840\u8bbe\u65bd\u66f4\u6539\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u7528\u4e8e\u5171\u4eab Terraform \u6a21\u5757\u7684\u79c1\u6709\u6ce8\u518c\uff0c\u7528\u4e8e\u7ba1\u7406 Terraform \u914d\u7f6e\u5185\u5bb9\u7684\u8be6\u7ec6\u7b56\u7565\u63a7\u5236\uff0c\u7b49\u7b49\u3002</p>"},{"location":"devops/IaC/Terraform/terraform%20cloud/#_2","title":"\u4e8c \u8d26\u53f7\u6ce8\u518c","text":"<p>https://app.terraform.io/signup/account?utm_source=cloud_landing&amp;utm_content=offers_tfc</p> <p></p> <p></p>"},{"location":"devops/IaC/Terraform/terraform%20cloud/#_3","title":"\u4e09 \u7b80\u5355\u793a\u4f8b","text":"<p>\u5c1d\u8bd5\u4e00\u4e2a\u793a\u4f8b\u914d\u7f6e</p> <ol> <li>\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5e76\u6309\u7167\u63d0\u793a\u83b7\u53d6 API \u4ee4\u724c\u4ee5\u4f9b Terraform \u4f7f\u7528\u3002\u5982\u679c\u60a8\u6ca1\u6709 Terraform 0.13 \u6216\u66f4\u9ad8\u7248\u672c\uff0c\u5219\u9700\u8981\u5b89\u88c5\u5b83 \u7b2c\u4e00\u7684</li> </ol> <pre><code>terraform login\n</code></pre> <p></p> <p>\u83b7\u53d6\u767b\u5f55token\uff0c\u586b\u5199\u81f3cli\u7ec8\u7aef\u8fdb\u884c\u767b\u5f55\u3002</p> <p></p> <ol> <li>\u514b\u9686\u793a\u4f8b\u4ed3\u5e93 .</li> </ol> <pre><code>git clone https://github.com/hashicorp/tfc-getting-started.git\n</code></pre> <ol> <li>\u8fd0\u884c\u8bbe\u7f6e\u811a\u672c\u5e76\u6309\u7167\u63d0\u793a\u5b8c\u6210\u8bbe\u7f6e\u5e76\u6267\u884c\u60a8\u7684\u7b2c\u4e00\u6b21 Terraform Cloud \u8fd0\u884c\uff01</li> </ol> <pre><code>cd tfc-getting-started &amp;&amp; ./scripts/setup.sh\n</code></pre> <p></p> <p></p> <p></p> <p></p> <p></p> <ul> <li>state\u6587\u4ef6</li> </ul> <p></p>"},{"location":"devops/IaC/Terraform/terraform%20cloud/#_4","title":"\u56db \u81ea\u5efa\u7ec4\u7ec7\u548c\u5de5\u4f5c\u7a7a\u95f4","text":"<p>\u521b\u5efa\u7ec4\u7ec7\uff0c\u521b\u5efaworkspace</p> <p></p> <p></p> <p>\u9009\u62e9github\uff0c\u9664\u4e86GitHub\u8fd8\u652f\u6301GitLab\uff0cBitbucket\uff0cAzure DevOps\u3002</p> <p></p> <p></p> <p>Fork \u8fd9\u4e2a\u793a\u4f8b\u4ed3\u5e93\u5230\u81ea\u5df1github\uff1ahttps://github.com/redhatxl/tencent-cloud-simple-example</p> <p></p> <p></p> <p>\u4e0b\u4e00\u6b65\u5bf9workspace\u7684\u53d8\u91cf\u8fdb\u884c\u914d\u7f6e\u3002\u8fd9\u91cc\u7684\u53d8\u91cf\u5305\u62ec\u4ee5\u524d\u5728\u5355\u673a\u7248\u4e0a\u7684\u73af\u5883\u53d8\u91cf\uff0c\u4ee5\u53ca\u6e90\u4ee3\u7801tfvars\u6587\u4ef6\u4e2d\u7684terraform\u53d8\u91cf\uff1a</p> <p>\u6ce8\u610f\u8fd9\u91cc\u53ef\u4ee5\u6709\u9009\u62e9\u7684\u5c06\u4e00\u4e9b\u53d8\u91cf\u6807\u8bb0\u6210\u654f\u611f\uff0c\u8fd9\u6837\u8be5\u53d8\u91cf\u7684\u5177\u4f53\u6570\u503c\u5c31\u4e0d\u4f1a\u5728\u754c\u9762\u4e0a\u663e\u793a\uff0c\u800c\u5176\u5b83\u7528\u6237\u751a\u81f3\u7ba1\u7406\u5458\u4e5f\u4e0d\u80fd\u770b\u5230\u8fd9\u4e2a\u503c\u3002</p> <p>\u53d8\u91cf\u914d\u7f6e\u5b8c\u6210\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u56fe\u5f62\u754c\u9762\u9a71\u52a8\u8ba1\u5212\u548c\u5b9e\u65bd\u4e86\uff1a</p> <ul> <li>\u624b\u52a8\u89e6\u53d1plan</li> </ul> <p></p> <p></p> <ul> <li>\u6d4b\u8bd5GitHub\u63d0\u4ea4PR\u51fa\u53d1</li> </ul> <p></p> <p>\u6b64\u523bterraform\u81ea\u52a8\u5c31\u56de\u53bb\u6267\u884c\u3002</p>"},{"location":"devops/IaC/Terraform/terraform%20cloud/#_5","title":"\u4e94 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u53ef\u4ee5\u5728workspace\u8bbe\u7f6eterraform\u7684\u7248\u672c\uff1a</li> </ul> <ul> <li>tencent\u7684provider\u9700\u8981\u6307\u660esource\u5730\u5740</li> </ul> <pre><code>provider \"tencentcloud\" {\n  secret_id  = \"\"\n  secret_key = \"\"\n  region     = \"\"\n}\n\n\nterraform {\n  required_providers {\n    tencentcloud = {\n      source  = \"registry.terraform.io/tencentcloudstack/tencentcloud\"\n\n    }\n  }\n\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform%20cloud/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://cloud.tencent.com/developer/article/1505878</li> <li>https://app.terraform.io/</li> </ul>"},{"location":"devops/IaC/Terraform/terraform-book/","title":"Terraform book","text":""},{"location":"devops/IaC/Terraform/terraform-book/#terraform-book","title":"Terraform-Book","text":""},{"location":"devops/IaC/Terraform/terraform-book/#terraform","title":"\u4e00 Terraform\u6982\u5ff5","text":"<p>Terraform \u662f\u4e00\u79cd\u5b89\u5168\u6709\u6548\u5730\u6784\u5efa\u3001\u66f4\u6539\u548c\u7248\u672c\u63a7\u5236\u57fa\u7840\u8bbe\u65bd\u7684\u5de5\u5177(\u57fa\u7840\u67b6\u6784\u81ea\u52a8\u5316\u7684\u7f16\u6392\u5de5\u5177)\u3002\u5b83\u7684\u76ee\u6807\u662f \"Write, Plan, and create Infrastructure as Code\", \u57fa\u7840\u67b6\u6784\u5373\u4ee3\u7801\u3002Terraform \u51e0\u4e4e\u53ef\u4ee5\u652f\u6301\u6240\u6709\u5e02\u9762\u4e0a\u80fd\u89c1\u5230\u7684\u4e91\u670d\u52a1\u3002\u5177\u4f53\u7684\u8bf4\u5c31\u662f\u53ef\u4ee5\u7528\u4ee3\u7801\u6765\u7ba1\u7406\u7ef4\u62a4 IT \u8d44\u6e90\uff0c\u628a\u4e4b\u524d\u9700\u8981\u624b\u52a8\u64cd\u4f5c\u7684\u4e00\u90e8\u5206\u4efb\u52a1\u901a\u8fc7\u7a0b\u5e8f\u6765\u81ea\u52a8\u5316\u7684\u5b8c\u6210\uff0c\u8fd9\u6837\u7684\u505a\u7684\u7ed3\u679c\u975e\u5e38\u660e\u663e\uff1a\u9ad8\u6548\u3001\u4e0d\u6613\u51fa\u9519\u3002</p> <p>Terraform \u63d0\u4f9b\u4e86\u5bf9\u8d44\u6e90\u548c\u63d0\u4f9b\u8005\u7684\u7075\u6d3b\u62bd\u8c61\u3002\u8be5\u6a21\u578b\u5141\u8bb8\u8868\u793a\u4ece\u7269\u7406\u786c\u4ef6\u3001\u865a\u62df\u673a\u548c\u5bb9\u5668\u5230\u7535\u5b50\u90ae\u4ef6\u548c DNS \u63d0\u4f9b\u8005\u7684\u6240\u6709\u5185\u5bb9\u3002\u7531\u4e8e\u8fd9\u79cd\u7075\u6d3b\u6027\uff0cTerraform \u53ef\u4ee5\u7528\u6765\u89e3\u51b3\u8bb8\u591a\u4e0d\u540c\u7684\u95ee\u9898\u3002\u8fd9\u610f\u5473\u7740\u6709\u8bb8\u591a\u73b0\u6709\u7684\u5de5\u5177\u4e0eTerraform \u7684\u529f\u80fd\u91cd\u53e0\u3002\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cTerraform \u4e0e\u5176\u4ed6\u7cfb\u7edf\u5e76\u4e0d\u76f8\u4e92\u6392\u65a5\u3002\u5b83\u53ef\u4ee5\u7528\u4e8e\u7ba1\u7406\u5c0f\u5230\u5355\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6216\u8fbe\u5230\u6574\u4e2a\u6570\u636e\u4e2d\u5fc3\u7684\u4e0d\u540c\u5bf9\u8c61\u3002</p> <p>Terraform \u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u63cf\u8ff0\u7ba1\u7406\u7684\u7ec4\u4ef6(\u5c0f\u5230\u5355\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fbe\u5230\u6574\u4e2a\u6570\u636e\u4e2d\u5fc3)\u3002Terraform \u751f\u6210\u4e00\u4e2a\u6267\u884c\u8ba1\u5212\uff0c\u63cf\u8ff0\u5b83\u5c06\u505a\u4ec0\u4e48\u6765\u8fbe\u5230\u6240\u9700\u7684\u72b6\u6001\uff0c\u7136\u540e\u6267\u884c\u5b83\u6765\u6784\u5efa\u6240\u63cf\u8ff0\u7684\u57fa\u7840\u7ed3\u6784\u3002\u968f\u7740\u914d\u7f6e\u7684\u53d8\u5316\uff0cTerraform \u80fd\u591f\u786e\u5b9a\u53d1\u751f\u4e86\u4ec0\u4e48\u53d8\u5316\uff0c\u5e76\u521b\u5efa\u53ef\u5e94\u7528\u7684\u589e\u91cf\u6267\u884c\u8ba1\u5212\u3002</p> <p>Terraform \u662f\u7528 Go \u8bed\u8a00\u5f00\u53d1\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u4f60\u53ef\u4ee5\u5728 github \u4e0a\u8bbf\u95ee\u5230\u5b83\u7684\u6e90\u4ee3\u7801\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#terraform_1","title":"\u4e8c Terraform\u6838\u5fc3\u529f\u80fd","text":"<ul> <li>\u57fa\u7840\u67b6\u6784\u5373\u4ee3\u7801(Infrastructure as Code)</li> <li>\u6267\u884c\u8ba1\u5212(Execution Plans)</li> <li>\u8d44\u6e90\u56fe(Resource Graph)</li> <li>\u81ea\u52a8\u5316\u53d8\u66f4(Change Automation)</li> </ul> <p>\u57fa\u7840\u67b6\u6784\u5373\u4ee3\u7801(Infrastructure as Code) \u4f7f\u7528\u9ad8\u7ea7\u914d\u7f6e\u8bed\u6cd5\u6765\u63cf\u8ff0\u57fa\u7840\u67b6\u6784\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5bf9\u6570\u636e\u4e2d\u5fc3\u7684\u84dd\u56fe\u8fdb\u884c\u7248\u672c\u63a7\u5236\uff0c\u5c31\u50cf\u5bf9\u5f85\u5176\u4ed6\u4ee3\u7801\u4e00\u6837\u5bf9\u5f85\u5b83\u3002</p> <p>\u6267\u884c\u8ba1\u5212(Execution Plans) Terraform \u6709\u4e00\u4e2a plan \u6b65\u9aa4\uff0c\u5b83\u751f\u6210\u4e00\u4e2a\u6267\u884c\u8ba1\u5212\u3002\u6267\u884c\u8ba1\u5212\u663e\u793a\u4e86\u5f53\u6267\u884c apply \u547d\u4ee4\u65f6 Terraform \u5c06\u505a\u4ec0\u4e48\u3002\u901a\u8fc7 plan \u8fdb\u884c\u63d0\u524d\u68c0\u67e5\uff0c\u53ef\u4ee5\u4f7f Terraform \u64cd\u4f5c\u771f\u6b63\u7684\u57fa\u7840\u7ed3\u6784\u65f6\u907f\u514d\u610f\u5916\u3002</p> <p>\u8d44\u6e90\u56fe(Resource Graph) Terraform \u6784\u5efa\u7684\u6240\u6709\u8d44\u6e90\u7684\u56fe\u8868\uff0c\u5b83\u80fd\u591f\u5e76\u884c\u5730\u521b\u5efa\u548c\u4fee\u6539\u4efb\u4f55\u6ca1\u6709\u76f8\u4e92\u4f9d\u8d56\u7684\u8d44\u6e90\u3002\u56e0\u6b64\uff0cTerraform \u53ef\u4ee5\u9ad8\u6548\u5730\u6784\u5efa\u57fa\u7840\u8bbe\u65bd\uff0c\u64cd\u4f5c\u4eba\u5458\u4e5f\u53ef\u4ee5\u901a\u8fc7\u56fe\u8868\u6df1\u5165\u5730\u89e3\u5176\u57fa\u7840\u8bbe\u65bd\u4e2d\u7684\u4f9d\u8d56\u5173\u7cfb\u3002</p> <p>\u81ea\u52a8\u5316\u53d8\u66f4(Change Automation) \u628a\u590d\u6742\u7684\u53d8\u66f4\u96c6\u5e94\u7528\u5230\u57fa\u7840\u8bbe\u65bd\u4e2d\uff0c\u800c\u65e0\u9700\u4eba\u5de5\u4ea4\u4e92\u3002\u901a\u8fc7\u524d\u9762\u63d0\u5230\u7684\u6267\u884c\u8ba1\u5212\u548c\u8d44\u6e90\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u786e\u5207\u5730\u77e5\u9053 Terraform \u5c06\u4f1a\u6539\u53d8\u4ec0\u4e48\uff0c\u4ee5\u4ec0\u4e48\u987a\u5e8f\u6539\u53d8\uff0c\u4ece\u800c\u907f\u514d\u8bb8\u591a\u53ef\u80fd\u7684\u4eba\u4e3a\u9519\u8bef\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#_1","title":"\u4e09 \u5b89\u88c5\u90e8\u7f72","text":"<pre><code>https://www.terraform.io/downloads.html\nunzip terraform_0.13.5_linux_amd64.zip\nmv terraform /usr/local/bin/\nterraform -version  # \u67e5\u770bTerraform\u7248\u672c\u548cProvider\u7684\u63a5\u53e3\u7248\u672c\u4fe1\u606f\n</code></pre> <p>Terraform\u662f\u901a\u8fc7\u4e00\u4e2a\u975e\u5e38\u5bb9\u6613\u4f7f\u7528\u7684\u547d\u4ee4\u884c\u754c\u9762\uff08CLI\uff09\u6765\u63a7\u5236\u7684\uff0c\u5e76\u4e14\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u547d\u4ee4\u884c\u7a0b\u5e8f\uff1a<code>terraform</code>\u8fdb\u884c\u7ba1\u7406\u3002\u8f93\u5165<code>terraform</code>\uff0c\u53ef\u4ee5\u770b\u5230\u5f53\u524d\u7248\u672c\u53ef\u7528\u7684\u5b50\u547d\u4ee4\u5217\u8868\uff0c\u5982<code>apply</code>\uff0c<code>plan</code>\u7b49\u3002\u540c\u65f6\uff0c<code>terraform</code>\u4e5f\u54cd\u5e94<code>-h</code>\u548c<code>help</code>\uff0c\u8f93\u5165<code>terraform -h</code>\u6216<code>terraform help</code>\u4e5f\u53ef\u4ee5\u67e5\u770b\u6240\u6709\u53ef\u7528\u547d\u4ee4\u3002</p> <p>\u521d\u59cb\u5316provider\uff0c\u4f7f\u7528Terraform\u914d\u7f6e\u8bed\u6cd5\u751f\u6210 .tf \u8d44\u6e90\u6587\u4ef6\uff0c\u4f7f\u7528CLI\u5b9e\u73b0\u8d44\u6e90\u7ba1\u7406\uff1bTerraform\u4f1a\u5c06\u6574\u4e2a\u8d44\u6e90\u90e8\u7f72\u60c5\u51b5\u66f4\u65b0\u5728 <code>*.tf.state</code> \u6587\u4ef6\u4e2d\uff0c\u8ba9\u7528\u6237\u5728\u524d\u7aef\u63a7\u5236\u53f0\u548c\u540e\u7aef\u5e73\u53f0\u90fd\u6e05\u6670\u7684\u628a\u63a7\u81ea\u5df1\u7684\u4e91\u8d44\u6e90</p> <pre><code>vi k8smain.tf\nprovider \"kubernetes\" {}\nterraform init  \nls -al\n# \u6267\u884c terraform init \u521d\u59cb\u5316Terraform\u3002\u6b64\u6b65\u9aa4\uff0cTerraform\u4f1a\u81ea\u52a8\u68c0\u6d4b .tf \u6587\u4ef6\u4e2d\u7684 provider \u5b57\u6bb5\uff0c\u53d1\u9001\u8bf7\u6c42\u5230Terraform\u5b98\u65b9GitHub\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u76f8\u5173\u8d44\u6e90\u7684\u6a21\u5757\u548c\u63d2\u4ef6\uff0c\u521d\u59cb\u5316\u6210\u529f\u65f6\u5f53\u524d\u811a\u672c\u7684\u7248\u672c\u4fe1\u606f\u4e5f\u4f1a\u663e\u793a\u51fa\u6765\u3002\n# \u6709\u65b0\u7684\u7248\u672c\u53d1\u5e03\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 terraform init -upgrade \u6307\u4ee4\u66f4\u65b0\u811a\u672c\uff0c\u83b7\u53d6\u6700\u65b0\u7684\u5e94\u7528\u3002\n# \u540c\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 terraform plan \u9884\u89c8\u5c06\u8981\u5b8c\u6210\u7684\u64cd\u4f5c\uff0c\u51c6\u5907\u597d\u521b\u5efa\u8d44\u6e90\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 terraform apply \u8fdb\u884c\u8d44\u6e90\u90e8\u7f72\u3002\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#terraform_2","title":"\u56db Terraform\u5173\u952e\u6982\u5ff5","text":""},{"location":"devops/IaC/Terraform/terraform-book/#41-configuration","title":"4.1 Configuration\uff1a\u57fa\u7840\u8bbe\u65bd\u7684\u5b9a\u4e49\u548c\u63cf\u8ff0","text":"<p>\u201c\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\uff08Infrastructure as Code\uff09\u201d\uff0c\u8fd9\u91cc\u7684Code\u5c31\u662f\u5bf9\u57fa\u7840\u8bbe\u65bd\u8d44\u6e90\u7684\u4ee3\u7801\u5b9a\u4e49\u548c\u63cf\u8ff0\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u4ee3\u7801\u8868\u8fbe\u6211\u4eec\u60f3\u8981\u7ba1\u7406\u7684\u8d44\u6e90\u3002</p> <pre><code># VPC \u8d44\u6e90\nresource \"alicloud_vpc\" \"vpc\" {\n        name          = \"tf_vpc\"\n        cidr_block  = \"172.16.0.0/16\"\n}\n# VSwitch \u8d44\u6e90\nresource \"alicloud_vswitch\" \"vswitch\" {\n        vpc_id            = alicloud_vpc.vpc.id\n        cidr_block        = \"172.16.1.0/24\"\n        availability_zone = \"cn-beijing-a\"\n}\n</code></pre> <p>\u5bf9\u6240\u6709\u8d44\u6e90\u7684\u4ee3\u7801\u63cf\u8ff0\u90fd\u9700\u8981\u5b9a\u4e49\u5728\u4e00\u4e2a\u4ee5 <code>tf</code> \u7ed3\u5c3e\u7684\u6587\u4ef6\u7528\u4e8eTerraform\u52a0\u8f7d\u548c\u89e3\u6790\uff0c\u8fd9\u4e2a\u6587\u4ef6\u6211\u4eec\u79f0\u4e4b\u4e3a\u201cTerraform\u6a21\u677f\u201d\u6216\u8005\u201cConfiguration\u201d\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#42-provider","title":"4.2 Provider\uff1a\u57fa\u7840\u8bbe\u65bd\u7ba1\u7406\u7ec4\u4ef6","text":"<p>Terraform \u901a\u5e38\u7528\u4e8e\u5bf9\u4e91\u4e0a\u57fa\u7840\u8bbe\u65bd\uff0c\u5982\u865a\u62df\u673a\uff0c\u7f51\u7edc\u8d44\u6e90\uff0c\u5bb9\u5668\u8d44\u6e90\uff0c\u5b58\u50a8\u8d44\u6e90\u7b49\u7684\u521b\u5efa\uff0c\u66f4\u65b0\uff0c\u67e5\u770b\uff0c\u5220\u9664\u7b49\u7ba1\u7406\u52a8\u4f5c\uff0c\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u7269\u7406\u673a\u7684\u7ba1\u7406\uff0c\u5982\u5b89\u88c5\u8f6f\u4ef6\uff0c\u90e8\u7f72\u5e94\u7528\u7b49\u3002</p> <p>\u3010Provider\u3011 \u662f\u4e00\u4e2a\u4e0eOpen API\u76f4\u63a5\u4ea4\u4e92\u7684\u540e\u7aef\u9a71\u52a8\uff0cTerraform \u5c31\u662f\u901a\u8fc7Provider\u6765\u5b8c\u6210\u5bf9\u57fa\u7840\u8bbe\u65bd\u8d44\u6e90\u7684\u7ba1\u7406\u7684\u3002\u4e0d\u540c\u7684\u57fa\u7840\u8bbe\u65bd\u63d0\u4f9b\u5546\u90fd\u9700\u8981\u63d0\u4f9b\u4e00\u4e2aProvider\u6765\u5b9e\u73b0\u5bf9\u81ea\u5bb6\u57fa\u7840\u8bbe\u65bd\u7684\u7edf\u4e00\u7ba1\u7406\u3002\u76ee\u524dTerraform\u76ee\u524d\u652f\u6301\u8d85\u8fc7160\u591a\u79cd\u7684providers\uff0c\u5927\u591a\u6570\u4e91\u5e73\u53f0\u7684Provider\u63d2\u4ef6\u5747\u5df2\u7ecf\u5b9e\u73b0\u4e86\uff0c\u963f\u91cc\u4e91\u5bf9\u5e94\u7684Provider\u4e3a <code>alicloud</code> \u3002</p> <p>\u5728\u64cd\u4f5c\u73af\u5883\u4e2d\uff0cTerraform\u548cProvider\u662f\u4e24\u4e2a\u72ec\u7acb\u5b58\u5728\u7684package\uff0c\u5f53\u8fd0\u884cTerraform\u65f6\uff0cTerraform\u4f1a\u6839\u636e\u7528\u6237\u6a21\u677f\u4e2d\u6307\u5b9a\u7684provider\u6216\u8005resource\uff0fdatasource\u7684\u6807\u5fd7\u81ea\u52a8\u7684\u4e0b\u8f7d\u6a21\u677f\u6240\u7528\u5230\u7684\u6240\u6709provider\uff0c\u5e76\u5c06\u5176\u653e\u5728\u6267\u884c\u76ee\u5f55\u4e0b\u7684\u4e00\u4e2a\u9690\u85cf\u76ee\u5f55 <code>.terraform</code> \u4e0b\u3002</p> <pre><code>provider \"alicloud\" {\n  version              = \"&gt;=1.56.0\"\n  region               = \"cn-hangzhou\"\n  configuration_source = \"terraform-alicloud-modules/classic-load-balance\"\n}\n</code></pre> <p>\u6a21\u677f\u4e2d\u663e\u793a\u6307\u5b9a\u4e86\u4e00\u4e2a\u963f\u91cc\u4e91\u7684Provider\uff0c\u5e76\u663e\u793a\u8bbe\u7f6e\u4e86provider\u7684\u7248\u672c\u4e3a <code>1.56.0+</code> \uff08\u9ed8\u8ba4\u4e0b\u8f7d\u6700\u65b0\u7684\u7248\u672c\uff09\uff0c\u6307\u5b9a\u4e86\u9700\u8981\u7ba1\u7406\u8d44\u6e90\u7684region\uff0c\u6307\u5b9a\u4e86\u5f53\u524d\u8fd9\u4e2a\u6a21\u677f\u7684\u6807\u8bc6\u3002 \u901a\u5e38Provider\u90fd\u5305\u542b\u4e24\u4e2a\u4e3b\u8981\u5143\u7d20 resource \u548c data source\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#43-resource","title":"4.3 Resource\uff1a\u57fa\u7840\u8bbe\u65bd\u8d44\u6e90\u548c\u670d\u52a1\u7684\u7ba1\u7406","text":"<p>\u5728Terraform\u4e2d\uff0c\u4e00\u4e2a\u5177\u4f53\u7684\u8d44\u6e90\u6216\u8005\u670d\u52a1\u79f0\u4e4b\u4e3a\u4e00\u4e2aresource\uff0c\u6bd4\u5982\u4e00\u53f0ECS \u5b9e\u4f8b\uff0c\u4e00\u4e2aVPC\u7f51\u7edc\uff0c\u4e00\u4e2aSLB\u5b9e\u4f8b\u3002\u6bcf\u4e2a\u7279\u5b9a\u7684resource\u5305\u542b\u4e86\u82e5\u5e72\u53ef\u7528\u4e8e\u63cf\u8ff0\u5bf9\u5e94\u8d44\u6e90\u6216\u8005\u670d\u52a1\u7684\u5c5e\u6027\u5b57\u6bb5\uff0c\u901a\u8fc7\u8fd9\u4e9b\u5b57\u6bb5\u6765\u5b9a\u4e49\u4e00\u4e2a\u5b8c\u6574\u7684\u8d44\u6e90\u6216\u8005\u670d\u52a1\uff0c\u6bd4\u5982\u5b9e\u4f8b\u7684\u540d\u79f0\uff08name\uff09\uff0c\u5b9e\u4f8b\u7684\u89c4\u683c\uff08instance_type\uff09\uff0cVPC\u6216\u8005VSwitch\u7684\u7f51\u6bb5\uff08cidr_block\uff09\u7b49\u3002</p> <p>\u5b9a\u4e49\u4e00\u4e2aResource\u7684\u8bed\u6cd5\u975e\u5e38\u7b80\u5355\uff0c\u901a\u8fc7 <code>resource</code> \u5173\u952e\u5b57\u58f0\u660e\uff0c\u5982\u4e0b\uff1a</p> <pre><code># \u5b9a\u4e49\u4e00\u4e2aECS\u5b9e\u4f8b\nresource \"alicloud_instance\" \"default\" {\n  image_id        = \"ubuntu_16_04_64_20G_alibase_20190620.vhd\"\n  instance_type   = \"ecs.sn1ne.large\"\n  instance_name   = \"my-first-vm\"\n  system_disk_category = \"cloud_ssd\"\n  ...\n}\n</code></pre> <ul> <li>\u5176\u4e2d <code>alicloud_instance</code> \u4e3a**\u8d44\u6e90\u7c7b\u578b\uff08Resource Type)**\uff0c\u5b9a\u4e49\u8fd9\u4e2a\u8d44\u6e90\u7684\u7c7b\u578b\uff0c\u544a\u8bc9Terraform\u8fd9\u4e2aResource\u662f\u963f\u91cc\u4e91\u7684ECS\u5b9e\u4f8b\u8fd8\u662f\u963f\u91cc\u4e91\u7684VPC\u3002</li> <li><code>default</code> \u4e3a**\u8d44\u6e90\u540d\u79f0(Resource Name)**\uff0c\u8d44\u6e90\u540d\u79f0\u5728\u540c\u4e00\u4e2a\u6a21\u5757\u4e2d\u5fc5\u987b\u552f\u4e00\uff0c\u4e3b\u8981\u7528\u4e8e\u4f9b\u5176\u4ed6\u8d44\u6e90\u5f15\u7528\u8be5\u8d44\u6e90\u3002</li> <li>\u5927\u62ec\u53f7\u91cc\u9762\u7684block\u5757\u4e3a**\u914d\u7f6e\u53c2\u6570(Configuration Arguments)**\uff0c\u5b9a\u4e49\u8d44\u6e90\u7684\u5c5e\u6027\uff0c\u6bd4\u5982ECS \u5b9e\u4f8b\u7684\u89c4\u683c\u3001\u955c\u50cf\u3001\u540d\u79f0\u7b49\u3002</li> </ul> <p>\u663e\u7136\u8fd9\u4e2aTerraform\u6a21\u677f\u7684\u529f\u80fd\u4e3a\u5728\u963f\u91cc\u4e91\u4e0a\u521b\u5efa\u4e00\u4e2aECS\u5b9e\u4f8b\uff0c\u955c\u50cfID\u4e3a <code>ubuntu_16_04_64_20G_alibase_20190620.vhd</code> \uff0c\u89c4\u683c\u4e3a <code>ecs.sn1ne.large</code> \uff0c\u81ea\u5b9a\u4e49\u4e86\u5b9e\u4f8b\u540d\u79f0\u548c\u7cfb\u7edf\u76d8\u7684\u7c7b\u578b\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5728Terraform\u4e2d\uff0c\u4e00\u4e2a\u8d44\u6e90\u4e0e\u53e6\u4e00\u4e2a\u8d44\u6e90\u7684\u5173\u7cfb\u4e5f\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u8d44\u6e90\uff0c\u5982\u4e00\u5757\u4e91\u76d8\u4e0e\u4e00\u53f0ECS\u5b9e\u4f8b\u7684\u6302\u8f7d\uff0c\u4e00\u4e2a\u5f39\u6027IP\uff08EIP\uff09\u4e0e\u4e00\u53f0ECS\u6216\u8005SLB\u5b9e\u4f8b\u7684\u7ed1\u5b9a\u5173\u7cfb\u3002\u8fd9\u6837\u5b9a\u4e49\u7684\u597d\u5904\u662f\uff0c\u4e00\u65b9\u9762\u8d44\u6e90\u67b6\u6784\u975e\u5e38\u6e05\u6670\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u5f53\u6a21\u677f\u4e2d\u6709\u82e5\u5e72\u4e2aEIP\u9700\u8981\u4e0e\u82e5\u5e72\u53f0ECS\u5b9e\u4f8b\u7ed1\u5b9a\u65f6\uff0c\u53ea\u9700\u8981\u901a\u8fc7Terraform\u7684 <code>count</code> \u529f\u80fd\u5c31\u53ef\u4ee5\u5728\u65e0\u9700\u7f16\u5199\u5927\u91cf\u91cd\u590d\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\u5b9e\u73b0\u7ed1\u5b9a\u529f\u80fd\u3002</p> <pre><code>resource \"alicloud_instance\" \"default\" {\n  count = 5\n  ...\n}\nresource \"alicloud_eip\" \"default\" {\n    count = 5\n  ...\n}\nresource \"alicloud_eip_association\" \"default\" {\n  count = 5\n  instance_id = alicloud_instance.default[count.index].id\n  allocation_id = alicloud_eip.default[count.index].id\n}\n</code></pre> <p>\u663e\u7136\u8fd9\u4e2aTerraform\u6a21\u677f\u7684\u529f\u80fd\u4e3a\u5728\u963f\u91cc\u4e91\u4e0a\u521b\u5efa5\u4e2aECS\u5b9e\u4f8b\u548c5\u4e2a\u5f39\u6027IP\uff0c\u5e76\u5c06\u5b83\u4eec\u4e00\u4e00\u7ed1\u5b9a\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#44-data-source","title":"4.4 Data Source\uff1a\u57fa\u7840\u8bbe\u65bd\u8d44\u6e90\u548c\u670d\u52a1\u7684\u67e5\u8be2","text":"<p>\u5bf9\u8d44\u6e90\u7684\u67e5\u8be2\u662f\u8fd0\u7ef4\u4eba\u5458\u6216\u8005\u7cfb\u7edf\u6700\u5e38\u4f7f\u7528\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\uff0c\u67e5\u770b\u67d0\u4e2aregion\u4e0b\u6709\u54ea\u4e9b\u53ef\u7528\u533a\uff0c\u67d0\u4e2a\u53ef\u7528\u533a\u4e0b\u6709\u54ea\u4e9b\u5b9e\u4f8b\u89c4\u683c\uff0c\u6bcf\u4e2aregion\u4e0b\u6709\u54ea\u4e9b\u955c\u50cf\uff0c\u5f53\u524d\u8d26\u53f7\u4e0b\u6709\u591a\u5c11\u673a\u5668\u7b49\uff0c\u901a\u8fc7\u5bf9\u8d44\u6e90\u53ca\u5176\u8d44\u6e90\u5c5e\u6027\u7684\u67e5\u8be2\u53ef\u4ee5\u5e2e\u52a9\u548c\u5f15\u5bfc\u5f00\u53d1\u8005\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684\u64cd\u4f5c\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5728\u7f16\u5199Terraform\u6a21\u677f\u65f6\uff0cResource\u4f7f\u7528\u7684\u53c2\u6570\u6709\u4e9b\u662f\u56fa\u5b9a\u7684\u9759\u6001\u53d8\u91cf\uff0c\u4f46\u6709\u4e9b\u60c5\u51b5\u4e0b\u53ef\u80fd\u53c2\u6570\u53d8\u91cf\u4e0d\u786e\u5b9a\u6216\u8005\u53c2\u6570\u53ef\u80fd\u968f\u65f6\u53d8\u5316\u3002\u6bd4\u5982\u6211\u4eec\u521b\u5efaECS \u5b9e\u4f8b\u65f6\uff0c\u901a\u5e38\u9700\u8981\u6307\u5b9a\u6211\u4eec\u81ea\u5df1\u7684\u955c\u50cfID\u548c\u5b9e\u4f8b\u89c4\u683c\uff0c\u4f46\u6211\u4eec\u7684\u6a21\u677f\u53ef\u80fd\u968f\u65f6\u66f4\u65b0\uff0c\u5982\u679c\u5728\u4ee3\u7801\u4e2d\u6307\u5b9aImageID\u548cInstance\uff0c\u5219\u4e00\u65e6\u6211\u4eec\u66f4\u65b0\u955c\u50cf\u6a21\u677f\u5c31\u9700\u8981\u91cd\u65b0\u4fee\u6539\u4ee3\u7801\u3002 \u5728Terraform \u4e2d\uff0cData Source \u63d0\u4f9b\u7684\u5c31\u662f\u4e00\u4e2a\u67e5\u8be2\u8d44\u6e90\u7684\u529f\u80fd\uff0c\u6bcf\u4e2adata source\u5b9e\u73b0\u5bf9\u4e00\u4e2a\u8d44\u6e90\u7684\u52a8\u6001\u67e5\u8be2\uff0cData Souce\u7684\u7ed3\u679c\u53ef\u4ee5\u8ba4\u4e3a\u662f\u52a8\u6001\u53d8\u91cf\uff0c\u53ea\u6709\u5728\u8fd0\u884c\u65f6\u624d\u80fd\u77e5\u9053\u53d8\u91cf\u7684\u503c\u3002</p> <p>Data Sources\u901a\u8fc7 <code>data</code> \u5173\u952e\u5b57\u58f0\u660e\uff0c\u5982\u4e0b\uff1a</p> <pre><code>// Images data source for image_id\ndata \"alicloud_images\" \"default\" {\n  most_recent = true\n  owners      = \"system\"\n  name_regex  = \"^ubuntu_18.*_64\"\n}\n\ndata \"alicloud_zones\" \"default\" {\n  available_resource_creation = \"VSwitch\"\n  enable_details              = true\n}\n\n// Instance_types data source for instance_type\ndata \"alicloud_instance_types\" \"default\" {\n  availability_zone = data.alicloud_zones.default.zones.0.id\n  cpu_core_count    = 2\n  memory_size       = 4\n}\n\nresource \"alicloud_instance\" \"web\" {\n  image_id        = data.alicloud_images.default.images[0].id\n  instance_type   = data.alicloud_instance_types.default.instance_types[0].id\n  instance_name   = \"my-first-vm\"\n  system_disk_category = \"cloud_ssd\"\n  ...\n}\n</code></pre> <p>\u5982\u4e0a\u4f8b\u5b50\u4e2d\u7684ECS Instance \u6ca1\u6709\u6307\u5b9a\u955c\u50cfImageID\u548c\u5b9e\u4f8b\u89c4\u683c\uff0c\u800c\u662f\u901a\u8fc7 <code>data</code>\u5f15\u7528\uff0cTerraform\u8fd0\u884c\u65f6\u5c06\u9996\u5148\u6839\u636e\u955c\u50cf\u540d\u79f0\u524d\u7f00\u9009\u62e9\u7cfb\u7edf\u955c\u50cf\uff0c\u5982\u679c\u540c\u65f6\u6709\u591a\u4e2a\u955c\u50cf\u6ee1\u8db3\u6761\u4ef6\uff0c\u5219\u9009\u62e9\u6700\u65b0\u7684\u955c\u50cf\u3002\u5b9e\u4f8b\u89c4\u683c\u4e5f\u662f\u7c7b\u4f3c\uff0c\u5728\u67d0\u4e2a\u53ef\u7528\u533a\u4e0b\u9009\u62e92\u68384G\u7684\u5b9e\u4f8b\u89c4\u683c\u8fdb\u884c\u8fd4\u56de\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#45-state","title":"4.5 State\uff1a\u4fdd\u5b58\u8d44\u6e90\u5173\u7cfb\u53ca\u5176\u5c5e\u6027\u6587\u4ef6\u7684\u6570\u636e\u5e93","text":"<p>Terraform\u521b\u5efa\u548c\u7ba1\u7406\u7684\u6240\u6709\u8d44\u6e90\u90fd\u4f1a\u4fdd\u5b58\u5230\u81ea\u5df1\u7684\u6570\u636e\u5e93\u4e0a\uff0c\u8fd9\u4e2a\u6570\u636e\u5e93\u4e0d\u662f\u901a\u5e38\u610f\u4e49\u4e0a\u7684\u6570\u636e\u5e93\uff08MySQL\uff0cRedis\u7b49\uff09\uff0c\u800c\u662f\u4e00\u4e2a\u6587\u4ef6\u540d\u4e3a <code>terraform.tfstate</code> \u7684\u6587\u4ef6\uff0c\u5728Terraform \u4e2d\u79f0\u4e4b\u4e3a <code>state</code> \uff0c\u9ed8\u8ba4\u5b58\u653e\u5728\u6267\u884cTerraform\u547d\u4ee4\u7684\u672c\u5730\u76ee\u5f55\u4e0b\u3002\u8fd9\u4e2a <code>state</code> \u6587\u4ef6\u975e\u5e38\u91cd\u8981\uff0c\u5982\u679c\u8be5\u6587\u4ef6\u635f\u574f\uff0cTerraform \u5c06\u8ba4\u4e3a\u5df2\u521b\u5efa\u7684\u8d44\u6e90\u88ab\u7834\u574f\u6216\u8005\u9700\u8981\u91cd\u5efa\uff08\u5b9e\u9645\u7684\u4e91\u8d44\u6e90\u901a\u5e38\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\uff09\uff0c\u56e0\u4e3a\u5728\u6267\u884cTerraform\u547d\u4ee4\u662f\uff0cTerraform\u5c06\u4f1a\u5229\u7528\u8be5\u6587\u4ef6\u4e0e\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6a21\u677f\u505aDiff\u6bd4\u8f83\uff0c\u5982\u679c\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0cTerraform\u5c06\u6309\u7167\u6a21\u677f\u4e2d\u7684\u5b9a\u4e49\u91cd\u65b0\u521b\u5efa\u6216\u8005\u4fee\u6539\u5df2\u6709\u8d44\u6e90\uff0c\u76f4\u5230\u6ca1\u6709Diff\uff0c\u56e0\u6b64\u53ef\u4ee5\u8ba4\u4e3aTerraform\u662f\u4e00\u4e2a\u6709\u72b6\u6001\u670d\u52a1\u3002</p> <p>\u5f53\u6d89\u53ca\u591a\u4eba\u534f\u4f5c\u65f6\u4e0d\u4ec5\u9700\u8981\u62f7\u8d1d\u6a21\u677f\uff0c\u8fd8\u9700\u8981\u62f7\u8d1d <code>state</code> \u6587\u4ef6\uff0c\u8fd9\u65e0\u5f62\u4e2d\u589e\u52a0\u4e86\u7ef4\u62a4\u6210\u672c\u3002\u5e78\u8fd0\u7684\u662f\uff0c\u76ee\u524dTerraform\u652f\u6301\u628a <code>state</code> \u6587\u4ef6\u653e\u5230\u8fdc\u7aef\u7684\u5b58\u50a8\u670d\u52a1 <code>OSS</code> \u4e0a\u6216\u8005 <code>consul</code> \u4e0a\uff0c\u6765\u5b9e\u73b0 <code>state</code> \u6587\u4ef6\u548c\u6a21\u677f\u4ee3\u7801\u7684\u5206\u79bb\u3002\u5177\u4f53\u7ec6\u8282\u53ef\u53c2\u8003\u5b98\u65b9\u6587\u6863Remote State\u6216\u8005\u5173\u6ce8\u540e\u7eed\u6587\u7ae0\u7684\u8be6\u7ec6\u4ecb\u7ecd\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#46-backend-state","title":"4.6 Backend\uff1a\u5b58\u653e State \u6587\u4ef6\u7684\u8f7d\u4f53","text":"<p>\u6b63\u5982\u4e0a\u8282\u63d0\u5230\uff0cTerraform \u5728\u521b\u5efa\u5b8c\u8d44\u6e90\u540e\uff0c\u4f1a\u5c06\u8d44\u6e90\u7684\u5c5e\u6027\u5b58\u653e\u5728\u4e00\u4e2a <code>state</code> \u6587\u4ef6\u4e2d\uff0c\u8fd9\u4e2a\u6587\u4ef6\u53ef\u4ee5\u5b58\u653e\u5728\u672c\u5730\u4e5f\u53ef\u4ee5\u5b58\u653e\u5728\u8fdc\u7aef\u3002\u5b58\u653e <code>state</code> \u6587\u4ef6\u7684\u8f7d\u4f53\u5c31\u662f <code>Backend</code> \u3002 <code>Backend</code> \u5206\u4e3a\u672c\u5730\uff08local\uff09\u548c\u8fdc\u7aef\uff08remote\uff09\u4e24\u7c7b\uff0c\u9ed8\u8ba4\u4e3a\u672c\u5730\u3002\u8fdc\u7aef\u7684\u7c7b\u578b\u4e5f\u975e\u5e38\u591a\uff0c\u76ee\u524d\u5b98\u65b9\u7f51\u7ad9\u63d0\u4f9b\u7684\u670913\u79cd\uff0c\u5e76\u4e14\u963f\u91cc\u4e91\u7684OSS\u5c31\u4f4d\u5217\u5176\u4e2d\u3002</p> <p>\u4f7f\u7528\u8fdc\u7aef\u7684Backend\uff0c\u65e2\u53ef\u4ee5\u964d\u4f4e\u591a\u4eba\u534f\u4f5c\u65f6\u5bf9state\u7684\u7ef4\u62a4\u6210\u672c\uff0c\u800c\u4e14\u53ef\u4ee5\u5c06\u4e00\u4e9b\u654f\u611f\u7684\u6570\u636e\u5b58\u653e\u5728\u8fdc\u7aef\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u5b89\u5168\u6027\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#47-provisioner","title":"4.7 Provisioner\uff1a\u5728\u673a\u5668\u4e0a\u6267\u884c\u64cd\u4f5c\u7684\u7ec4\u4ef6","text":"<p>Provisioner \u901a\u5e38\u7528\u6765\u5728\u672c\u5730\u673a\u5668\u6216\u8005\u767b\u9646\u8fdc\u7a0b\u4e3b\u673a\u6267\u884c\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u5982 <code>local-exec</code> provisioner \u7528\u6765\u6267\u884c\u672c\u5730\u7684\u547d\u4ee4\uff0c <code>chef</code> provisioner \u7528\u6765\u5728\u8fdc\u7a0b\u673a\u5668\u5b89\u88c5\uff0c\u914d\u7f6e\u548c\u6267\u884cchef client\uff0c <code>remote-exec</code> provisioner \u7528\u6765\u767b\u5f55\u8fdc\u7a0b\u4e3b\u673a\u5e76\u5728\u5176\u4e0a\u6267\u884c\u547d\u4ee4\u3002</p> <p>Provisioner \u901a\u5e38\u8ddf Provider\u4e00\u8d77\u914d\u5408\u4f7f\u7528\uff0cprovider\u7528\u6765\u521b\u5efa\u548c\u7ba1\u7406\u8d44\u6e90\uff0cprovisioner\u5728\u521b\u5efa\u597d\u7684\u673a\u5668\u4e0a\u6267\u884c\u5404\u79cd\u64cd\u4f5c\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#48","title":"4.8 \u53d8\u91cf","text":"<p>Terraform \u8fd0\u884c\u65f6\u4f1a\u8bfb\u53d6\u5de5\u4f5c\u76ee\u5f55\u4e2d\u6240\u6709\u7684 *.tf, *.tfvars \u6587\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u5fc5\u628a\u6240\u6709\u7684\u4e1c\u897f\u90fd\u5199\u5728\u5355\u4e2a\u6587\u4ef6\u4e2d\u53bb\uff0c\u5e94\u6309\u804c\u8d23\u5206\u5217\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d\uff0c\u4f8b\u5982\uff1a</p> <p>provider.tf -- provider \u914d\u7f6e</p> <p>terraform.tfvars -- \u914d\u7f6e provider \u8981\u7528\u5230\u7684\u53d8\u91cf</p> <p>varable.tf -- \u901a\u7528\u53d8\u91cf</p> <p>resource.tf -- \u8d44\u6e90\u5b9a\u4e49</p> <p>data.tf -- \u5305\u6587\u4ef6\u5b9a\u4e49</p> <p>output.tf -- \u8f93\u51fa</p> <p>Terraform\u5f15\u7528\u4e86\u4e00\u4e9b\u73af\u5883\u53d8\u91cf\u6765\u63a7\u5236\u90e8\u5206\u529f\u80fd\uff0c\u8fd9\u4e9b\u73af\u5883\u53d8\u91cf\u90fd\u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u4f46\u662f\u53ef\u4ee5\u6539\u53d8\u4e00\u4e9bTerraform\u7684\u9ed8\u8ba4\u884c\u4e3a\uff0c\u5e2e\u52a9\u7528\u6237\u9002\u914d\u66f4\u591a\u5e94\u7528\u573a\u666f</p> <pre><code># \u64cd\u4f5c\u65e5\u5fd7\u662f\u91cd\u8981\u7684\u8fd0\u7ef4\u4fe1\u606f\u6765\u6e90\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u65e5\u5fd7\u7c7b\u578bTF_LOG\u548c\u65e5\u5fd7\u4fdd\u5b58\u8def\u5f84TF_LOG_PATH\uff0c\u5c06\u8be6\u7ec6\u7684\u65e5\u5fd7\u6253\u5370\u5230stderr\uff0c\u4ee5\u83b7\u53d6\u8c03\u8bd5\u4fe1\u606f\u3002TF_LOG\u652f\u6301\u4e94\u79cd\u53ef\u7528\u503c\uff0cTRACE\uff0cDEBUG\uff0cINFO\uff0cWARN\uff0cERROR\uff0c\u5206\u522b\u4ee3\u8868\u4e94\u79cd\u4e0d\u540c\u7684\u65e5\u5fd7\u7ea7\u522b\uff0c\u5176\u4e2dTRACE\u8868\u793a\u6700\u8be6\u7ec6\u7684\u65e5\u5fd7\nexport TF_LOG=TRACE   # DEBUG INFO WARN ERROR\nexport TF_LOG_PATH=/root/optf/tf.log\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#49-terraform","title":"4.9 Terraform\u4e2d\u8f93\u5165\u53d8\u91cf","text":"<p><code>variable</code>\u662fTerraform\u91cd\u8981\u7684\u914d\u7f6e\u6587\u4ef6\u7c7b\u578b\u4e4b\u4e00\uff0c\u901a\u8fc7\u5bf9\u53d8\u91cf\u7684\u96c6\u4e2d\u7ba1\u7406\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u8d44\u6e90\u6587\u4ef6\u4e2d\u76f4\u63a5\u5f15\u7528\u53d8\u91cf\u540d\u8fdb\u884c\u8d4b\u503c\u3002\u9996\u5148\u9700\u8981\u5148\u5b9a\u4e49(\u58f0\u660e)\u53d8\u91cf\uff0c\u653e\u5230\u4e00\u4e2a<code>.tf</code>\u6587\u4ef6\u4e2d\uff0c\u5982\uff1a</p> <p>\u521b\u5efa<code>variable.tf</code>\u6587\u4ef6\uff0c\u914d\u7f6e\u53c2\u6570\u7684\u9ed8\u8ba4\u503c</p> <pre><code>variable \"access_key\" {}\nvariable \"secret_key\" {}\nvariable \"region\" {\n  default = \"us-east-1\"\n}\nvariable \"f5user\" {\n  type = string\n  default = \"admin\"\n}\nvariable \"f5pass\" {\n  type = string\n  default = \"admin\"\n}\n</code></pre> <p>\u4e0a\u9762\u5b9a\u4e49\u4e86\u53d8\u91cf\u3002\u524d\u4e24\u4e2a\u53d8\u91cf\u662f\u7a7a\u7684\uff0c\u7b2c\u4e09\u4e2a\u7ed9\u4e86\u4e00\u4e2a\u9ed8\u8ba4\u503c(\u9ed8\u8ba4\u53c2\u6570)\u3002\u6b64\u65f6\u8fd0\u884c<code>terraform plan</code>\uff0cTerraform\u4f1a\u63d0\u793a\u8f93\u5165\u8fd9\u4e9b\u5c1a\u672a\u5b9a\u4e49\u7684\u53d8\u91cf\u3002</p> <p>\u5f15\u7528\u53d8\u91cf\uff0c\u4f7f\u7528<code>${var.xxx}</code>\u7684\u5f62\u5f0f\u3002\u8fd9\u6837\u5728\u8d44\u6e90\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u53c2\u6570\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528var.f5user</p> <pre><code>provider \"aws\" {\n  access_key    =   \"${var.access_key}\"\n  secret_key    =   \"${var.secret_key}\"\n  region        =   \"${var.region}\"\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#410","title":"4.10 \u53d8\u91cf\u8d4b\u503c","text":"<p>\u524d\u9762\u6211\u4eec\u58f0\u660e\u4e86\u53d8\u91cf\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u7ed9\u53d8\u91cf\u8d4b\u503c\uff0c\u65e0\u6cd5\u771f\u6b63\u4f7f\u7528\u3002\u7ed9\u53d8\u91cf\u8d4b\u503c\uff0c\u6709\u4ee5\u4e0b\u51e0\u79cd\u65b9\u6cd5\uff0c\u4e0b\u9762\u51e0\u79cd\u65b9\u6cd5\u6309\u7167\u53d8\u91cf\u8d4b\u503c\u7684\u4f18\u5148\u987a\u5e8f\u6392\u5e8f\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#4101","title":"4.10.1 \u547d\u4ee4\u884c\u58f0\u660e","text":"<p>\u4f7f\u7528terraform\u7684\u5404\u79cd\u547d\u4ee4\u65f6\uff0c\u4f7f\u7528<code>-var</code>\u9009\u9879\uff0c\u53ef\u4ee5\u5728\u540e\u9762\u76f4\u63a5\u8ddf\u53d8\u91cf\u7684\u5b9a\u4e49\uff0c\u5982\uff1a</p> <pre><code>    # terraform apply \\\n      -var 'access_key=foo' \n      -var 'secret_key=bar'\n    # ...\n</code></pre> <p>\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u8d4b\u503c\u53d8\u91cf\u662f\u4e00\u6b21\u6027\u7684\uff0c\u5e76\u4e0d\u4f1a\u4fdd\u5b58\u5b83\u4eec\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0b\u4e00\u6b21\u91cd\u65b0\u6267\u884c\u547d\u4ee4\u65f6\uff0c\u9700\u8981\u91cd\u65b0\u8d4b\u503c\u3002</p> <p>\u5728terraform apply\u4e2d\uff0c\u76f4\u63a5\u8bbe\u7f6e\u53d8\u91cf\u503c\u4f1a\u8986\u76d6\u6389<code>variable.tf</code>\u4e2d\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u503c</p>"},{"location":"devops/IaC/Terraform/terraform-book/#4102","title":"4.10.2 \u4ece\u6587\u4ef6\u5bfc\u5165","text":"<p>\u4e3a\u6c38\u4e45\u6027\u5b58\u50a8\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u53ef\u4ee5\u5c06\u5176\u653e\u5728\u6587\u4ef6\u4e2d\u4fdd\u5b58\u3002Terraform\u4f1a\u81ea\u52a8\u52a0\u8f7d\u5f53\u524d\u76ee\u5f55\u4e0b\u6269\u5c55\u540d\u4e3a<code>.tfvars</code>\u548c<code>.auto.tfvars</code>\u7684\u6587\u4ef6\u6765\u586b\u5145\u5b9a\u4e49\u7684\u53d8\u91cf\u3002\u5982\u679c\u4ee5\u5176\u4ed6\u683c\u5f0f\u5b58\u653e\uff0c\u53ef\u4ee5\u4f7f\u7528<code>-var-file</code>\u9009\u9879\u6765\u624b\u52a8\u6307\u5b9a\u9700\u8981\u52a0\u8f7d\u7684\u53d8\u91cf\u503c\u6587\u4ef6\u3002\u8fd9\u4e9b\u6587\u4ef6\u4f7f\u7528Terraform\u683c\u5f0f\u6216JSON\u683c\u5f0f\u3002</p> <p>\u4f7f\u7528\u6587\u4ef6\u4e5f\u65b9\u4fbf\u7248\u672c\u63a7\u5236\uff0c\u4f46\u662f\u7528\u6237\u540d\u3001\u5bc6\u7801\u8fd9\u79cd\u4e1c\u897f\u5c31\u4e0d\u8981\u7528\u7248\u672c\u63a7\u5236\u7ba1\u7406\u7684\u3002\u56e0\u6b64\u53ef\u4ee5\u5c06\u7528\u6237\u540d\u548c\u5bc6\u7801\u8fd9\u7c7b\u4fe1\u606f\u5355\u72ec\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u4f7f\u7528<code>-var-file</code>\u6765\u624b\u52a8\u6307\u5b9a\u3002\u5176\u4ed6\u7684\uff0c\u53ef\u4ee5\u81ea\u52a8\u586b\u5145\uff0c\u65b9\u4fbf\u4f7f\u7528\u7248\u672c\u63a7\u5236\u7ba1\u7406\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u653e\u5728<code>.tfvars</code>\u6587\u4ef6\u4e2d\uff0cTerraform\u4f1a\u81ea\u52a8\u52a0\u8f7d\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#4103","title":"4.10.3 \u73af\u5883\u53d8\u91cf","text":"<p>Terraform\u4f1a\u8bfb\u53d6<code>TF_VAR_name</code>\u8fd9\u79cd\u683c\u5f0f\u7684\u73af\u5883\u53d8\u91cf\uff0c\u7528\u6765\u586b\u5145\u5b9a\u4e49\u597d\u7684\u53d8\u91cf\u3002\u6bd4\u5982\uff0c\u73af\u5883\u53d8\u91cf\u4e2d\u6709\u4e00\u4e2a<code>TF_VAR_access_key</code>\u7684\u53d8\u91cf\uff0cTerraform\u5c31\u4f1a\u8bfb\u53d6\u5230\uff0c\u5e76\u7528\u4e8e\u586b\u5145<code>access_key</code>\u53d8\u91cf\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#4104-default","title":"4.10.4 default\u503c","text":"<p>\u5982\u679c\u67d0\u4e2a\u53d8\u91cf\u6ca1\u6709\u91c7\u7528\u4ee5\u4e0a\u4efb\u4f55\u4e00\u79cd\u65b9\u6cd5\u6765\u8fdb\u884c\u8d4b\u503c\uff0c\u90a3\u4e48\u5982\u679c\u5728\u53d8\u91cf\u7684\u5b9a\u4e49\u4e2d\u6709\u4e2a<code>default</code>\u5c5e\u6027\uff0c\u90a3\u4e48Terraform\u5c31\u4f1a\u4f7f\u7528<code>default</code>\u7684\u503c\u6765\u5bf9\u53d8\u91cf\u8fdb\u884c\u8d4b\u503c\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#4105","title":"4.10.5","text":"<p>\u6ca1\u6709\u4f7f\u7528\u4efb\u4f55\u65b9\u6cd5\u6765\u5bf9\u53d8\u91cf\u8d4b\u503c\uff0c\u5728\u8f93\u5165\u547d\u4ee4\u65f6\u4f7f\u5f97Terraform\u4e0d\u77e5\u9053\u5982\u4f55\u5904\u7406\uff0c\u6b64\u65f6\u5c31\u4f1a\u51fa\u73b0\u4ea4\u4e92\u754c\u9762\uff0c\u8ba9\u7528\u6237\u624b\u52a8\u8f93\u5165\u53d8\u91cf\u503c\uff0c\u6765\u7ed9\u53d8\u91cf\u8d4b\u503c\u3002</p> <p>\u4e5f\u53ef\u4ee5\u5229\u7528<code>TF_VAR_name</code>\u628a\u53d8\u91cf\u8bbe\u7f6e\u5728\u73af\u5883\u53d8\u91cf\u4e2d</p> <pre><code>export TF_VAR_f5user=\"admin\"\n</code></pre> <p>\u914d\u7f6e<code>TF_INPUT</code>\uff0c\u53ef\u4ee5\u5173\u95ed\u5bf9\u672a\u6307\u5b9a\u503c\u7684\u53d8\u91cf\u7684\u63d0\u793a\u3002\u5c06\u521a\u624d\u7684<code>variable.tf</code>\u4e2d\u8bbe\u7f6e\u7684\u53c2\u6570\u5220\u9664</p> <pre><code>export export TF_INPUT=1\n</code></pre> <p>\u6267\u884cTerraform\u6307\u4ee4\uff0c\u4f1a\u8981\u6c42\u5199\u5165\u53c2\u6570\u503c</p> <p>\u8bbe\u7f6e<code>TF_INPUT</code>\u4e3a<code>false</code>\u6216<code>0</code>\uff0c\u518d\u6b21\u6267\u884c\u6307\u4ee4\uff0c\u7cfb\u7edf\u62a5\u9519\uff1a\u672a\u6307\u5b9a\u53d8\u91cf\u7684\u503c</p> <pre><code>export export TF_INPUT=0\n</code></pre> <p>CLI Config File</p> <p>\u7528\u6237\u53ef\u4ee5\u901a\u8fc7CLI\u7684\u914d\u7f6e\u6587\u4ef6\u5bf9CLI\u8fdb\u884c\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u9002\u7528\u4e8e\u6240\u6709Terraform\u7684\u5de5\u4f5c\u76ee\u5f55\uff0c\u4e0e\u8d44\u6e90\u914d\u7f6e\u6587\u4ef6\u662f\u533a\u5206\u5f00\u7684\u3002</p> <p>\u914d\u7f6e\u6587\u4ef6\u4e2d\u652f\u6301\u7684\u53c2\u6570\u6709\uff1a</p> <p>\u2460 \u662f\u5426\u5f00\u542f\u66f4\u65b0\u4e0e\u5b89\u5168\u68c0\u67e5\uff1a<code>disable_checkpoint</code></p> <p>\u2461 \u5141\u8bb8\u66f4\u65b0\u4e0e\u5b89\u5168\u68c0\u67e5\uff0c\u4f46\u7981\u6b62\u4f7f\u7528\u533f\u540did\u5220\u9664\u8b66\u544a\u6d88\u606f\uff1a<code>disable_checkpoint_signature</code></p> <p>\u2462 \u542f\u7528\u63d2\u4ef6\u7f13\u5b58\uff0c\u4ee5\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u6307\u5b9a\u63d2\u4ef6\u7f13\u5b58\u76ee\u5f55\u7684\u4f4d\u7f6e\uff1a<code>plugin_cache_dir</code></p> <p>\u2463 Terraform\u4f01\u4e1a\u7248\u51ed\u8bc1\uff1a<code>credentials</code></p> <p>\u53ef\u4ee5\u5728\u73af\u5883\u53d8\u91cf\u4e2d\u914d\u7f6eCLI Config File\u7684\u4f4d\u7f6e</p> <pre><code>export TF_CLI_CONFIG_FILE=\"$HOME/.terraformrc-custom\"\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#_2","title":"\u4e94 \u8d44\u6e90\u7ba1\u7406\u5e38\u7528\u547d\u4ee4","text":""},{"location":"devops/IaC/Terraform/terraform-book/#51-terraform-plan","title":"5.1 terraform plan\uff1a\u8d44\u6e90\u7684\u9884\u89c8","text":"<p>\u5728\u521d\u59cb\u5316\u76ee\u5f55\u4e0b\u6267\u884c <code>terraform plan</code> \u67e5\u770b\u90e8\u7f72\u8ba1\u5212\uff1b\u53c2\u6570\u524d\u9762\u7684<code>+</code>\u4ee3\u8868\u65b0\u6dfb\u52a0\u7684\u8d44\u6e90\uff0c\u5f53\u9500\u6bc1\u8d44\u6e90\u65f6\uff0c\u53c2\u6570\u524d\u9762\u5bf9\u5e94\u7684\u7b26\u53f7\u4f1a\u53d8\u4e3a<code>-</code>\uff1b\u66f4\u6539\u4e00\u4e9b\u53c2\u6570\u9700\u8981\u91cd\u65b0\u90e8\u7f72\u8d44\u6e90\u65f6\uff0c\u8be5\u8d44\u6e90\u524d\u9762\u7684\u7b26\u53f7\u4e3a<code>-/+</code>\uff1b\u5728\u65e7\u53c2\u6570\u548c\u65b0\u53c2\u6570\u5185\u5bb9\u4e4b\u95f4\u6709<code>\u2192</code>\u7b26\u53f7\u6807\u8bc6\u3002</p> <p>plan\u547d\u4ee4\u7528\u4e8e\u5bf9\u6a21\u677f\u4e2d\u6240\u5b9a\u4e49\u8d44\u6e90\u7684\u9884\u89c8\uff0c\u4e3b\u8981\u7528\u4e8e\u4ee5\u4e0b\u51e0\u4e2a\u573a\u666f\uff1a</p> <ul> <li> <p>\u9884\u89c8\u5f53\u524d\u6a21\u677f\u4e2d\u5b9a\u4e49\u7684\u8d44\u6e90\u662f\u5426\u7b26\u5408\u7ba1\u7406\u9884\u671f\uff0c\u548cMarkdown\u7684\u9884\u89c8\u529f\u80fd\u7c7b\u4f3c\u3002</p> </li> <li> <p>\u5982\u679c\u5f53\u524d\u6a21\u677f\u5df2\u7ecf\u5b58\u5728\u5bf9\u5e94\u7684state\u6587\u4ef6\uff0c\u90a3\u4e48plan\u547d\u4ee4\u5c06\u4f1a\u5c55\u793a\u6a21\u677f\u5b9a\u4e49\u4e0estate\u6587\u4ef6\u5185\u5bb9\u7684diff\u7ed3\u679c\uff0c\u5982\u679c\u6709\u53d8\u66f4\uff0c\u4f1a\u5c06\u7ed3\u679c\u5728\u4e0b\u65b9\u663e\u793a\u51fa\u6765\u3002</p> </li> <li>\u5bf9DataSource\u800c\u8a00\uff0c\u6267\u884cplan\u547d\u4ee4\uff0c\u5373\u53ef\u76f4\u63a5\u83b7\u53d6\u5e76\u8f93\u51fa\u6240\u8981\u67e5\u8be2\u7684\u8d44\u6e90\u53ca\u5176\u5c5e\u6027\u3002</li> </ul>"},{"location":"devops/IaC/Terraform/terraform-book/#52-terraform-apply","title":"5.2 terraform apply\uff1a\u8d44\u6e90\u7684\u65b0\u5efa\u548c\u53d8\u66f4","text":"<p>apply\u547d\u4ee4\u7528\u4e8e\u5b9e\u9645\u8d44\u6e90\u7684\u65b0\u5efa\u548c\u53d8\u66f4\u64cd\u4f5c\uff0c\u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u5728\u547d\u4ee4\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u589e\u52a0\u4e86\u4eba\u5de5\u4ea4\u4e92\u7684\u8fc7\u7a0b\uff0c\u5373\u9700\u8981\u624b\u52a8\u786e\u8ba4\u662f\u5426\u7ee7\u7eed\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7**--auto-approve**\u53c2\u6570\u6765\u8df3\u8fc7\u4eba\u5de5\u786e\u8ba4\u7684\u8fc7\u7a0b\u3002</p> <p>apply\u547d\u4ee4\u9002\u7528\u4e8e\u4ee5\u4e0b\u51e0\u79cd\u573a\u666f\uff1a</p> <ul> <li>\u521b\u5efa\u65b0\u7684\u8d44\u6e90\u3002</li> <li>\u901a\u8fc7\u4fee\u6539\u6a21\u677f\u53c2\u6570\u6765\u4fee\u6539\u8d44\u6e90\u7684\u5c5e\u6027\u3002</li> <li>\u5982\u679c\u4ece\u5f53\u524d\u6a21\u677f\u4e2d\u5220\u9664\u67d0\u4e2a\u8d44\u6e90\u7684\u5b9a\u4e49\uff0capply\u547d\u4ee4\u4f1a\u5c06\u8be5\u8d44\u6e90\u5f7b\u5e95\u5220\u9664\u3002\u53ef\u4ee5\u7406\u89e3\u4e3a\u201c\u8d44\u6e90\u7684\u79fb\u9664\u4e5f\u662f\u4e00\u79cd\u53d8\u66f4\u201d\u3002</li> </ul>"},{"location":"devops/IaC/Terraform/terraform-book/#53-terraform-show","title":"5.3 terraform show\uff1a\u8d44\u6e90\u7684\u5c55\u793a","text":"<p>show\u547d\u4ee4\u7528\u4e8e\u5c55\u793a\u5f53\u524dstate\u4e2d\u6240\u6709\u88ab\u7ba1\u7406\u7684\u8d44\u6e90\u53ca\u5176\u6240\u6709\u5c5e\u6027\u503c\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#54-terraform-destroy","title":"5.4 terraform destroy\uff1a\u8d44\u6e90\u7684\u91ca\u653e","text":"<p>destroy\u547d\u4ee4\u7528\u4e8e\u5bf9\u8d44\u6e90\u7684\u91ca\u653e\u64cd\u4f5c\uff0c\u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u5728\u547d\u4ee4\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u589e\u52a0\u4e86\u4eba\u5de5\u4ea4\u4e92\u7684\u8fc7\u7a0b\uff0c\u5982\u679c\u60f3\u8981\u8df3\u8fc7\u624b\u52a8\u786e\u8ba4\u64cd\u4f5c\uff0c\u53ef\u4ee5\u901a\u8fc7**--force**\u53c2\u6570\u6765\u8df3\u8fc7\u3002</p> <p>terraform destroy\u9ed8\u8ba4\u4f1a\u91ca\u653e\u5f53\u524d\u6a21\u677f\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u8d44\u6e90\uff0c\u5982\u679c\u53ea\u60f3\u91ca\u653e\u5176\u4e2d\u67d0\u4e2a\u7279\u5b9a\u7684\u8d44\u6e90\uff0c\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570<code>-target=&lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u8d44\u6e90\u540d\u79f0&gt;</code>\u6765\u6307\u5b9a\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#55-terraform-import","title":"5.5 terraform import\uff1a\u8d44\u6e90\u7684\u5bfc\u5165","text":"<p>import\u547d\u4ee4\u7528\u4e8e\u5c06\u5b58\u91cf\u7684\u4e91\u8d44\u6e90\u5bfc\u5165\u5230terraform state\u4e2d\uff0c\u8fdb\u800c\u52a0\u5165\u5230Terraform\u7684\u7ba1\u7406\u4f53\u7cfb\u4e2d</p>"},{"location":"devops/IaC/Terraform/terraform-book/#56-terraform-taint","title":"5.6 terraform taint\uff1a\u6807\u8bb0\u8d44\u6e90\u4e3a\u88ab\u6c61\u67d3","text":"<p>taint\u547d\u4ee4\u7528\u4e8e\u628a\u67d0\u4e2a\u8d44\u6e90\u6807\u8bb0\u4e3a\u88ab\u6c61\u67d3\u72b6\u6001\uff0c\u5f53\u518d\u6b21\u6267\u884capply\u547d\u4ee4\u65f6\uff0c\u8fd9\u4e2a\u88ab\u6c61\u67d3\u7684\u8d44\u6e90\u5c06\u4f1a\u88ab\u5148\u91ca\u653e\uff0c\u7136\u540e\u518d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\uff0c\u76f8\u5f53\u4e8e\u5bf9\u8fd9\u4e2a\u7279\u5b9a\u8d44\u6e90\u505a\u4e86\u5148\u5220\u9664\u540e\u65b0\u5efa\u7684\u64cd\u4f5c\u3002</p> <p>\u547d\u4ee4\u7684\u8be6\u7ec6\u683c\u5f0f\u4e3a\uff1a <code>terraform taint &lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u8d44\u6e90\u540d\u79f0&gt;</code> \uff0c\u5982\uff1a</p> <pre><code>terraform taint bigip_ltm_pool_attachment.attach_nodeqat01\nResource instance bigip_ltm_pool_attachment.attach_nodeqat01 has been marked as tainted.\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#57-terraform-untaint","title":"5.7 terraform untaint\uff1a\u53d6\u6d88\u88ab\u6c61\u67d3\u6807\u8bb0","text":"<p>untaint\u547d\u4ee4\u662ftaint\u7684\u9006\u5411\u64cd\u4f5c\uff0c\u7528\u4e8e\u53d6\u6d88\u88ab\u6c61\u67d3\u6807\u8bb0\uff0c\u4f7f\u5176\u6062\u590d\u5230\u6b63\u5e38\u7684\u72b6\u6001\u3002\u547d\u4ee4\u7684\u8be6\u7ec6\u683c\u5f0f\u548ctaint\u7c7b\u4f3c\u4e3a\uff1a<code>terraform untaint &lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u8d44\u6e90\u540d\u79f0&gt;</code> \uff0c\u5982\uff1a</p> <pre><code>terraform untaint untaint bigip_ltm_pool_attachment.attach_nodeqat01\nResource instance bigip_ltm_pool_attachment.attach_nodeqat01 has been successfully untainted.\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#58-terraform-output","title":"5.8 terraform output\uff1a\u6253\u5370\u51fa\u53c2\u53ca\u5176\u503c","text":"<p>\u5982\u679c\u5728\u6a21\u677f\u4e2d\u663e\u793a\u5b9a\u4e49\u4e86output\u53c2\u6570\uff0c\u90a3\u4e48\u8fd9\u4e2aoutput\u7684\u503c\u5c06\u5728apply\u547d\u4ee4\u4e4b\u540e\u5c55\u793a\uff0c\u4f46plan\u547d\u4ee4\u5e76\u4e0d\u4f1a\u5c55\u793a\uff0c\u5982\u679c\u60f3\u968f\u65f6\u968f\u5730\u5feb\u901f\u67e5\u770boutput\u7684\u503c\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u547d\u4ee4 terraform output</p> <p>Terraform\u5bf9\u8d44\u6e90\u72b6\u6001\u7684\u7ba1\u7406\uff0c\u5b9e\u9645\u4e0a\u662f\u5bf9State\u6587\u4ef6\u4e2d\u6570\u636e\u7684\u7ba1\u7406\u3002State\u6587\u4ef6\u4fdd\u5b58\u4e86\u5f53\u524dTerraform\u7ba1\u7406\u7684\u6240\u6709\u8d44\u6e90\u53ca\u5176\u5c5e\u6027\uff0c\u5185\u5bb9\u90fd\u662f\u7531Terraform\u81ea\u52a8\u5b58\u50a8\u7684\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u5b8c\u6574\u6027\uff0c\u4e0d\u5efa\u8bae\u624b\u52a8\u4fee\u6539State\u5185\u5bb9\u3002\u5bf9State\u6570\u636e\u7684\u64cd\u4f5c\u53ef\u4ee5\u901a\u8fc7**terraform state**\u547d\u4ee4\u6765\u5b8c\u6210\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#59-terraform-state-liststate","title":"5.9 terraform state list\uff1a\u5217\u51fa\u5f53\u524dstate\u4e2d\u7684\u6240\u6709\u8d44\u6e90","text":"<p>**state list**\u547d\u4ee4\u4f1a\u6309\u7167 <code>&lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u8d44\u6e90\u540d\u79f0&gt;</code> \u7684\u683c\u5f0f\u5217\u51fa\u5f53\u524dstate\u4e2d\u5b58\u5728\u7684\u6240\u6709\u8d44\u6e90\uff08\u5305\u62ecdatasource\uff09\uff0c\u4f8b\u5982\uff1a</p> <pre><code>$ terraform state list\ndata.alicloud_slbs.default\nalicloud_vpc.default\nalicloud_vswitch.this\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#510-terraform-state-show","title":"5.10 terraform state show\uff1a\u5c55\u793a\u67d0\u4e00\u4e2a\u8d44\u6e90\u7684\u5c5e\u6027","text":"<p>**state show**\u547d\u4ee4\u6309\u7167Key-Value\u7684\u683c\u5f0f\u5c55\u793a\u51fa\u7279\u5b9a\u8d44\u6e90\u7684\u6240\u6709\u5c5e\u6027\u53ca\u5176\u503c\uff0c\u547d\u4ee4\u7684\u5b8c\u6574\u683c\u5f0f\u4e3a <code>terraformstate show &lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u8d44\u6e90\u540d\u79f0&gt;</code> \uff0c\u4f8b\u5982\uff1a</p> <pre><code>$ terraform state show alicloud_vswitch.this\n# alicloud_vswitch.this:\nresource \"alicloud_vswitch\" \"this\" {  \n    availability_zone = \"eu-central-1a\"\n    cidr_block        = \"172.16.0.0/24\"\n    id                = \"vsw-gw8gl31wz******\"\n    vpc_id            = \"vpc-gw8calnzt*******\"\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#511-terraform-state-pullstate","title":"5.11 terraform state pull\uff1a\u83b7\u53d6\u5f53\u524dstate\u5185\u5bb9\u5e76\u5c55\u793a","text":"<p>**state pull**\u547d\u4ee4\u7528\u4e8e\u539f\u6837\u5c55\u793a\u5f53\u524dstate\u6587\u4ef6\u6570\u636e\uff0c\u7c7b\u4f3c\u4e0eShell\u4e0b\u7684cat\u547d\u4ee4\uff0c\u4f8b\u5982\uff1a</p> <pre><code>$ terraform state pull\n{\n    \"version\": 4,\n    \"terraform_version\": \"0.12.8\",\n    \"serial\": 615, \n    \"lineage\": \"39aeeee2-b3bd-8130-c897-2cb8595cf8ec\", \n    \"outputs\": {\n        ***\n    }\n  }, \n\"resources\": [\n    {     \n        \"mode\": \"data\",    \n        \"type\": \"alicloud_slbs\",     \n        \"name\": \"default\",     \n        \"provider\": \"provider.alicloud\",\n          ***\n    },\n    {     \n        \"mode\": \"managed\",    \n        \"type\": \"alicloud_vpc\",     \n        \"name\": \"default\",    \n        \"provider\": \"provider.alicloud\",\n          ***\n    }\n  ]\n}\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#512-terraform-state-rm","title":"5.12 terraform state rm\uff1a\u79fb\u9664\u7279\u5b9a\u7684\u8d44\u6e90","text":"<p>**state rm**\u547d\u4ee4\u7528\u4e8e\u5c06state\u4e2d\u7684\u67d0\u4e2a\u8d44\u6e90\u79fb\u9664\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5e76\u4e0d\u4f1a\u771f\u6b63\u5220\u9664\u8fd9\u4e2a\u8d44\u6e90\uff0c\u547d\u4ee4\u683c\u5f0f\u4e3a\uff1a<code>terraformstate rm &lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u8d44\u6e90\u540d\u79f0&gt;</code> \uff0c\u4f8b\u5982\uff1a</p> <pre><code>$ terraform state rm alicloud_vswitch.this\nRemoved alicloud_vswitch.this\nSuccessfully removed 1 resource instance(s).\n</code></pre> <p>\u79fb\u9664\u540e\uff0c\u5982\u679c\u6a21\u677f\u5185\u5bb9\u4e0d\u53d8\u5e76\u4e14\u518d\u6b21\u6267\u884c**apply**\u547d\u4ee4\uff0c\u5c06\u4f1a\u65b0\u589e\u4e00\u4e2a\u540c\u6837\u7684\u8d44\u6e90\u3002\u79fb\u9664\u540e\u7684\u8d44\u6e90\u53ef\u4ee5\u518d\u6b21\u901a\u8fc7**import**\u547d\u4ee4\u518d\u6b21\u52a0\u5165\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#513-terraform-state-mv","title":"5.13 terraform state mv\uff1a\u53d8\u66f4\u7279\u5b9a\u8d44\u6e90\u7684\u5b58\u653e\u5730\u5740","text":"<p>\u5982\u679c\u60f3\u8c03\u6574\u67d0\u4e2a\u8d44\u6e90\u6240\u5728\u7684state\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7**state mv**\u547d\u4ee4\u6765\u5b8c\u6210\uff0c\u7c7b\u4f3c\u4e8eShell\u4e0b\u7684**mv**\u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f7f\u7528\u6709\u591a\u79cd\u9009\u9879\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 terraform state mv --help \u6765\u8be6\u7ec6\u4e86\u89e3\u3002\u672c\u6587\u53ea\u4ecb\u7ecd\u6700\u5e38\u7528\u7684\u4e00\u79cd\uff1a<code>terraform state mv --state=./terraform.tfstate --state-out=&lt;target path&gt;/terraform-target.tfstate &lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u8d44\u6e90\u540d\u79f0A&gt; &lt;\u8d44\u6e90\u7c7b\u578b&gt;.&lt;\u8d44\u6e90\u540d\u79f0B&gt;</code> \uff0c\u5982\uff1a</p> <pre><code>$ terraform state mv --state-out=../tf.tfstate alicloud_vswitch.this alicloud_vswitch.default\nMove \"alicloud_vswitch.this\" to \"alicloud_vswitch.default\"\nSuccessfully moved 1 object(s)\n</code></pre> <p>\u5982\u4e0a\u547d\u4ee4\u7701\u7565\u4e86\u9ed8\u8ba4\u7684<code>--state=./terraform.tfstate</code>\u9009\u9879\uff0c\u547d\u4ee4\u6700\u7ec8\u7684\u7ed3\u679c\u662f\u5c06\u5f53\u524dState\u4e2d\u7684VSwitch\u8d44\u6e90\u79fb\u52a8\u5230\u4e86\u4e0a\u5c42\u76ee\u5f55\u4e0b\u540d\u4e3a <code>tf.tfstate</code> \u7684State\u4e2d\uff0c\u5e76\u4e14\u5c06VSwitch\u7684\u8d44\u6e90\u540d\u79f0\u7531\u201cthis\u201d\u6539\u4e3a\u4e86\u201cdefault\u201d\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#514-terraform-refreshstate","title":"5.14 terraform refresh\uff1a\u5237\u65b0\u5f53\u524dstate","text":"<p>**refresh**\u547d\u4ee4\u53ef\u4ee5\u7528\u6765\u5237\u65b0\u5f53\u524dState\u7684\u5185\u5bb9\uff0c\u5373\u518d\u6b21\u8c03\u7528API\u5e76\u62c9\u53d6\u6700\u65b0\u7684\u6570\u636e\u5199\u5165\u5230state\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"devops/IaC/Terraform/terraform-book/#515-terraform-graph","title":"5.15 terraform graph\uff1a\u8f93\u51fa\u5f53\u524d\u6a21\u677f\u5b9a\u4e49\u7684\u8d44\u6e90\u5173\u7cfb\u56fe","text":"<p>\u6bcf\u4e2a\u6a21\u677f\u5b9a\u4e49\u7684\u8d44\u6e90\u4e4b\u95f4\u90fd\u5b58\u5728\u4e0d\u540c\u7a0b\u5ea6\u7684\u5173\u7cfb\uff0c\u5982\u679c\u60f3\u770b\u8d44\u6e90\u5173\u7cfb\u56fe\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4**terraform graph**:</p> <pre><code>$ terraform graph\ndigraph {\n        compound = \"true\"\n        newrank = \"true\"\n        subgraph \"root\" {\n                \"[root] alicloud_vpc.default\" [label = \"alicloud_vpc.default\", shape = \"box\"]\n                \"[root] alicloud_vswitch.this\" [label = \"alicloud_vswitch.this\", shape = \"box\"]             \n                ******\n                \"[root] output.vswitchId\" -&gt; \"[root] alicloud_vswitch.this\"\n                \"[root] provider.alicloud (close)\" -&gt; \"[root] alicloud_vswitch.this\"\n                ******\n                \"[root] root\" -&gt; \"[root] provider.alicloud (close)\"\n        }\n} \n</code></pre> <p>\u8be5\u547d\u4ee4\u7684\u7ed3\u679c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4<code>terraform graph | dot -Tsvg &gt; graph.svg</code>\u76f4\u63a5\u5bfc\u51fa\u4e3a\u4e00\u5f20\u56fe\u7247\uff08\u9700\u8981\u63d0\u524d\u5b89\u88c5graphviz\uff1a <code>brew install graphviz</code>\uff09\uff1a</p> <p></p>"},{"location":"devops/IaC/Terraform/terraform-book/#516-terraform-validate","title":"5.16 terraform validate\uff1a\u9a8c\u8bc1\u6a21\u677f\u8bed\u6cd5\u662f\u5426\u6b63\u786e","text":"<p>Terraform\u6a21\u677f\u7684\u7f16\u5199\u9700\u8981\u9075\u5faa\u5176\u81ea\u8eab\u5b9a\u4e49\u7684\u4e00\u5957\u7b80\u5355\u7684\u8bed\u6cd5\u89c4\u8303\uff0c\u7f16\u5199\u5b8c\u6210\u540e\uff0c\u5982\u679c\u60f3\u8981\u68c0\u67e5\u6a21\u677f\u662f\u5426\u5b58\u5728\u8bed\u6cd5\u9519\u8bef\u6216\u8005\u5728\u8fd0\u884c**plan**\u548c**apply**\u547d\u4ee4\u7684\u65f6\u5019\u62a5\u8bed\u6cd5\u9519\u8bef\uff0c\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u547d\u4ee4**terraform validate**\u6765\u68c0\u67e5\u548c\u5b9a\u4f4d\u9519\u8bef\u51fa\u73b0\u7684\u8be6\u7ec6\u4f4d\u7f6e\u548c\u539f\u56e0\u3002</p> <p>\u8be6\u7ec6\u4ecb\u7ecd\u6bcf\u4e00\u4e2a\u5177\u4f53\u7684\u6307\u4ee4\uff0c\u5305\u62ec\u5982\u4f55\u4f7f\u7528\u548c\u53ef\u80fd\u9047\u5230\u7684\u95ee\u9898</p> <ul> <li>apply</li> </ul> <p><code>terraform apply</code> \u7528\u4e8e\u5e94\u7528\u6240\u9700\u7684\u66f4\u6539\uff0c\u4ee5\u8fbe\u5230\u6240\u9700\u7684\u914d\u7f6e\u72b6\u6001\uff0c\u540c\u65f6\u6267\u884c\u7ed3\u679c\u4f1a\u4fdd\u5b58\u5728\u672c\u5730\u72b6\u6001\u6587\u4ef6<code>terraform.tfstate</code>\u4e2d\u3002</p> <p>\u6807\u51c6\u8bed\u6cd5\uff1a<code>terraform apply [options] [dir-or-plan]</code></p> <ul> <li><code>options</code>\u7528\u6765\u586b\u5199<code>apply</code>\u7684flags</li> <li><code>dir-or-plan</code>\u7528\u6765\u6307\u5b9a\u914d\u7f6e\u8ba1\u5212\u6216\u8ba1\u5212\u7684\u8def\u5f84</li> </ul> <p>\u5728\u5f53\u524d\u76ee\u5f55\u53ea\u914d\u7f6e<code>provider.tf</code>\uff0c\u4e0d\u6dfb\u52a0\u4efb\u4f55\u8d44\u6e90\u6587\u4ef6\uff0c\u6267\u884c<code>terraform apply</code>\uff0c\u663e\u793a\u6ca1\u6709\u4efb\u4f55\u8d44\u6e90\u88ab\u90e8\u7f72</p> <p>\u5728\u5f53\u524d\u76ee\u5f55\u6267\u884c<code>terraform apply ./tftest</code>\u547d\u4ee4\uff0c\u521b\u5efa\u5728<code>/tftest</code>\u76ee\u5f55\u7684\u8d44\u6e90\u6587\u4ef6\u5c06\u88ab\u90e8\u7f72</p> <pre><code>terraform apply ./tftest\n</code></pre> <p>options</p> <ul> <li><code>-backup=path</code> - \u5907\u4efd\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u8bbe\u7f6e\u4e3a<code>-</code>\u65f6\u8868\u793a\u7981\u7528</li> </ul> <pre><code>terraform apply -backup=-\n</code></pre> <p>\u5220\u9664<code>terraform.tfstate.backup</code>\uff0c\u6267\u884c<code>terraform apply -backup=-</code>\uff0c\u4e0d\u518d\u81ea\u52a8\u4fdd\u5b58\u5907\u4efd</p> <ul> <li><code>-auto-approve</code> - \u8df3\u8fc7\u90e8\u7f72\u8ba1\u5212\u524d\u7684\u5ba1\u6279\u8fc7\u7a0b\uff0c\u76f4\u63a5\u521b\u5efa\u8d44\u6e90</li> </ul> <pre><code>terraform apply -auto-approve\n</code></pre> <ul> <li><code>-no-color</code> - \u7981\u7528\u8f93\u51fa\u65f6\u5b57\u7b26\u7684\u989c\u8272</li> </ul> <pre><code>terraform apply -no-color\n</code></pre> <ul> <li><code>-parallelism=n</code> - \u9650\u5236\u5e76\u53d1\u64cd\u4f5c\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u662f<code>10</code></li> </ul> <pre><code>terraform apply -parallelism=5\n</code></pre> <ul> <li><code>-refresh=true</code> - \u5728\u8ba1\u5212\u548c\u5e94\u7528\u4e4b\u524d\uff0c\u66f4\u65b0\u6bcf\u4e00\u4e2a\u8d44\u6e90\u7684\u72b6\u6001</li> </ul> <pre><code>terraform apply -refresh=true\n</code></pre> <ul> <li><code>-state=path</code> - \u72b6\u6001\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u4e3a<code>terraform.tfstate</code></li> </ul> <pre><code>terraform apply -state=./test_state\n</code></pre> <p>\u5220\u9664<code>terraform.tfstate</code>\uff0c\u6267\u884c<code>terraform apply -state=./test_state</code>\uff0c\u5c06\u72b6\u6001\u6587\u4ef6\u4fdd\u5b58\u5728\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u7684<code>test_state</code>\u4e2d</p> <ul> <li>console</li> </ul> <p><code>terraform console</code>\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u4e8e\u8bc4\u4f30\u548c\u9a8c\u8bc1\u8868\u8fbe\u5f0f\u7684\u4ea4\u4e92\u63a7\u5236\u53f0\u3002</p> <p>\u6807\u51c6\u8bed\u6cd5\uff1a<code>terraform console [options] [dir]</code></p> <ul> <li><code>options</code>\u7528\u6765\u586b\u5199<code>console</code>\u7684flags</li> <li><code>dir</code>\u7528\u6765\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3a\u5f53\u524d\u76ee\u5f55</li> </ul> <pre><code>    // Evaluating and experimenting with expressions\n    $ echo \"1 + 2\" | terraform console\n</code></pre> <ul> <li>destroy</li> </ul> <p><code>terraform destroy</code>\u7528\u4e8e\u9500\u6bc1terraform\u7ba1\u7406\u7684\u57fa\u7840\u8bbe\u65bd\u3002</p> <p>\u6807\u51c6\u8bed\u6cd5\uff1a<code>terraform destroy [options] [dir]</code></p> <p><code>options</code>\u7528\u6765\u586b\u5199<code>destroy</code>\u7684flags</p> <ul> <li><code>dir</code>\u7528\u6765\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3a\u5f53\u524d\u76ee\u5f55</li> <li> <p><code>-auto-approve</code> - \u540c<code>apply</code>\u547d\u4ee4\u4e2d\u7684<code>-auto-approve</code>\uff0c\u8df3\u8fc7\u9500\u6bc1\u8ba1\u5212\u524d\u7684\u5ba1\u6279\u8fc7\u7a0b\uff0c\u76f4\u63a5\u9500\u6bc1\u8d44\u6e90</p> </li> <li> <p>fmt</p> </li> </ul> <p><code>terraform fmt</code>\u7528\u4e8e\u5c06terraform\u914d\u7f6e\u6587\u4ef6\u91cd\u5199\u4e3a\u89c4\u8303\u683c\u5f0f\u548c\u6837\u5f0f\uff0c\u786e\u4fdd\u6587\u4ef6\u7684\u4e00\u81f4\u6027\u3002\u5728\u5347\u7ea7Terraform\u4e4b\u540e\uff0c\u5efa\u8bae\u60a8\u5728\u6a21\u5757\u4e0a\u9884\u5148\u8fd0\u884c<code>Terraform fmt</code>\uff0c\u4f7f\u4e4b\u524d\u7684\u6587\u4ef6\u9002\u914d\u65b0\u7248\u672c\u3002</p> <p>\u6807\u51c6\u8bed\u6cd5\uff1a<code>terraform fmt [options] [dir]</code></p> <ul> <li><code>options</code>\u7528\u6765\u586b\u5199<code>fmt</code>\u7684flags</li> <li><code>dir</code>\u7528\u6765\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3a\u5f53\u524d\u76ee\u5f55</li> <li><code>-list=false</code> - \u4e0d\u5217\u51fa\u683c\u5f0f\u4e0d\u4e00\u81f4\u7684\u6587\u4ef6</li> </ul> <pre><code>    // Don't list the files containing formatting inconsistencies\n    $ terraform fmt -list=false\n</code></pre> <ul> <li><code>-diff</code> - \u663e\u793a\u683c\u5f0f\u66f4\u6539\u7684\u5dee\u5f02</li> </ul> <pre><code>    // Display diffs of formatting changes\n    $ terraform fmt -diff\n</code></pre>"},{"location":"devops/IaC/Terraform/terraform-book/#_3","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://github.com/ilzj/terraform-book/blob/main/learn.md</li> </ul>"},{"location":"devops/IaC/Terraform/terraform%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/","title":"Terraform \u6700\u4f73\u5b9e\u8df5","text":""},{"location":"devops/IaC/Terraform/terraform%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_1","title":"\u4e00 \u6700\u4f73\u5b9e\u8df5","text":"<ul> <li>Plan before Apply/Stage before Prod</li> </ul> <p>\u5728\u6b63\u5f0f\u5e94\u7528\u8d44\u6e90\u6e05\u5355\u94b1\uff0c\u5148plan\uff0c\u4e3a\u4fdd\u969c\u7ebf\u4e0a\u5b89\u5168\uff0c\u9700\u8981\u73b0\u5728dev/stage\u73af\u5883\u6d4b\u8bd5\uff0c\u518d\u4e0aprod</p> <ul> <li>\u73af\u5883\u9694\u79bb(global/stage/prod/mgmt)</li> </ul> <p>\u5355\u4e2a\u73af\u5883\u8fdb\u884c\u9694\u79bb</p> <ul> <li>\u6bcf\u4e2a\u76ee\u5f55\u5355\u72ec.tfstate</li> </ul> <p>\u6bcf\u4e2a\u76ee\u5f55\u5355\u72ec.tfstate \u72b6\u6001\u7ba1\u7406\uff0c\u907f\u514d\u9879\u76ee\u51b2\u7a81\u4e0e\u6df7\u4e71</p> <ul> <li> <p>\u76ee\u5f55\u95f4\u4f7f\u7528terraofrm_remote_state\u5171\u4eab\u72b6\u6001</p> </li> <li> <p>\u529f\u80fd\u7ec4\u4ef6\u5206\u79bb(web/db...)</p> </li> <li>\u4f7f\u7528\u6a21\u5757modules</li> <li>Version Constraints</li> <li>variable\u4e2d\u6dfb\u52a0validation rules</li> <li>\u4f7f\u7528\u5e26\u6a21\u7248\u7684\u6a21\u5757(git ref)</li> <li>\u5c06\u6a21\u5757\u4ee3\u7801\u653e\u5230\u5355\u72ecRepo</li> <li>Remote state\u5b58\u50a8\u4f7f\u7528\u52a0\u5bc6\uff0c\u5e76\u542f\u7528\u7248\u672c\uff08S3 Versioning\uff09</li> <li>TF\u6a21\u7248\u4e2d\u907f\u514d\u786c\u7f16\u7801\uff08eg\uff1a\u4f7f\u7528date\u83b7\u53d6vpc_id/account_id/region\uff09</li> <li>Tag\uff08\u8ddf\u8e2a\u6210\u672c/\u533a\u5206\u624b\u52a8\u521b\u5efa\uff09</li> <li> <p>\u4f7f\u7528terrascan\u626b\u63cf\u9690\u60a3\u3002</p> </li> <li> <p>module\u7f16\u5199\u5b8c\u6210\u540e\uff0c</p> </li> <li>\u5229\u7528terraform fmt\u683c\u5f0f\u5316\u5185\u5bb9</li> <li>\u5229\u7528terratest\u8fdb\u884c\u6d4b\u8bd5</li> </ul>"},{"location":"devops/IaC/Terraform/terraform%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#module","title":"\u4e8c \u7f16\u5199module\u89c4\u8303","text":"<p>Module \u4ed3\u5e93\u5efa\u7acb\u5b8c\u6bd5\u540e\uff0c\u9996\u5148\u8981 fork \u4ed3\u5e93\u5e76\u5c06\u5176clone\u5230\u672c\u5730\u3002\u63a5\u4e0b\u6765\uff0c\u5f00\u59cb Mudole \u7684\u7f16\u5199\u5de5\u4f5c\u3002\u5b98\u65b9\u5df2\u7ecf\u7ed9\u51fa\u4e86\u4e00\u4e2a\u6807\u51c6\u7684 Module \u5e94\u8be5\u9075\u5faa\u7684\u539f\u5219\u548c\u89c4\u8303\uff0c\u8be6\u89c1 standard-module-structure . \u672c\u6587\u5c06\u5728\u6b64\u57fa\u7840\u4e0a\u8fdb\u884c\u8865\u5145\u3002</p> <ol> <li>\u57fa\u672c\u539f\u5219 \u6bcf\u4e2aModule\u4e0d\u5b9c\u5305\u542b\u8fc7\u591a\u7684\u8d44\u6e90\uff0c\u8981\u5c3d\u53ef\u80fd\u53ea\u5305\u542b\u540c\u4e00\u4ea7\u54c1\u7684\u76f8\u5173\u8d44\u6e90\uff0c\u8fd9\u6837\u5e26\u6765\u7684\u597d\u5904\u662fModule\u7684\u590d\u6742\u5ea6\u4e0d\u9ad8\uff0c\u4fbf\u4e8e\u7ef4\u62a4\u548c\u9605\u8bfb\uff1b \u5bf9\u4e8e\u7edf\u4e00\u4ea7\u54c1\u7684\u4e0d\u540c\u8d44\u6e90\uff0c\u5e94\u8be5\u5206\u522b\u653e\u5728\u4e0d\u540c\u7684\u5b50module\u4e2d\uff0c\u7136\u540e\u5728\u6700\u5916\u5c42\u7684main.tf\u4e2d\u7ec4\u7ec7\u6240\u6709\u7684\u5b50\u8d44\u6e90\uff0c\u6bd4\u5982 module slb \u4e2d\u5b9a\u4e49\u4e86\u4e24\u4e2a\u8d44\u6e90 slb instance \u548c slb attachment\uff0c\u8fd9\u4e24\u4e2a\u5b50\u8d44\u6e90\u5206\u522b\u5b9a\u4e49\u5728\u4e86 modules/slb \u548c modules/slb_attachment \u4e2d\uff0c\u7136\u540e\u5728\u6700\u5916\u5c42\u7684 main.tf\u4e2d\u5c06\u8fd9\u4e24\u4e2amodule\u7ec4\u5408\u4e3a\u4e00\u4e2a\u65b0\u7684module \u6bcf\u4e2amodule\u8981\u5c3d\u53ef\u80fd\u5355\u5143\u5316\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u81ea\u7531\u6dfb\u52a0\u548c\u5220\u9664\u800c\u4e0d\u5f71\u54cd\u5176\u4ed6resource\u3002\u5373\u4e00\u4e2amodule\u5c3d\u53ef\u80fd\u53d9\u8ff01-2\u4ef6\u4e8b\u60c5\uff0c\u5982\u521b\u5efa\u4e00\u4e2aslb\u5b9e\u4f8b\uff0c\u5e76\u5c06\u4e00\u7ec4ecs\u7684\u6302\u8f7d\u5230\u8fd9\u4e2aslb\u4e0b\uff08slb\u7684\u4f5c\u7528\u5c31\u662f\u5b9e\u73b0\u5bf9ecs\u7684\u8d1f\u8f7d\u5747\u8861\uff09\uff0c\u81f3\u4e8eslb\u7684listener\u914d\u7f6e\uff0c\u5e94\u8be5\u653e\u7f6e\u5728\u4e00\u4e2a\u72ec\u7acb\u7684mudule\u4e2d\uff0c\u4e00\u65b9\u9762listeners\u6bd4\u8f83\u590d\u6742\uff0c\u6d89\u53ca\u56db\u79cd\u534f\u8bae\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u5bf9\u4e8e\u540c\u4e00\u534f\u8bae\u7684listener\uff0c\u9664\u4e86\u76d1\u542c\u7aef\u53e3\u5916\uff0c\u5927\u90e8\u5206\u7684\u914d\u7f6e\u90fd\u662f\u76f8\u540c\u7684\uff0c\u800c\u8fd9\u4e9b\u76f8\u540c\u7684\u914d\u7f6e\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u5355\u72ec\u7684module\u88ab\u590d\u7528\u5728\u4e0d\u540c\u5176\u4ed6\u8d44\u6e90\u6a21\u677f\u4e2d\uff1b \u6a21\u677f\u7f16\u5199\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u4f7f\u7528\u5230\u5927\u91cf\u7684TF\u8bed\u6cd5\uff0c\u8be6\u89c1configuration syntax \u548c interpolation syntax\u3002</li> <li>main.tf \u6bcf\u4e2a Module \u90fd\u5fc5\u987b\u5305\u542b\u4e00\u4e2a main.tf \u7528\u4e8e\u5b58\u653e resource \u548c datasource\u3002resource\u548cdatasource\u7684\u53c2\u6570\u7981\u6b62\u4f7f\u7528\u786c\u7f16\u7801\uff0c\u5fc5\u987b\u901a\u8fc7\u53d8\u91cf\u8fdb\u884c\u5f15\u7528\uff1b \u4e3a\u4e86\u6807\u51c6\u8d77\u89c1\uff0c\u6bcf\u4e2a resource \u548c data source \u7684\u547d\u540d\u5747\u4ee5\u4e00\u4e9b\u5173\u952e\u5b57\u6216\u8005\u5173\u952e\u5b57\u524d\u7f00\u4e3a\u4e3b\uff0c\u5982this\uff0cdefault\uff0c\u5c3d\u91cf\u907f\u514d\u4f7f\u7528foo\uff0ctest\u7b49 \u4e3a\u4e86\u66f4\u597d\u7684\u4e86\u89e3Module\u88ab\u4ed6\u4eba\u5f15\u7528\u7684\u6b21\u6570\uff0c\u963f\u91cc\u4e91Provider\u652f\u6301\u5bf9\u6bcf\u4e2aModule\u8fdb\u884c\u6253\u6807\uff0c\u5373\u5728main.tf\u7684provider\u4e2d\u58f0\u660e\u5b57\u6bb5configuration_source\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a provider \"alicloud\" { ... configuration_source = \"terraform-alicloud-modules/demo\" // This should be replaced by the specified owner and module name }</li> <li>variables.tf \u6bcf\u4e2a\u53d8\u91cf\u90fd\u8981\u6dfb\u52a0\u8be5\u53c2\u6570\u5bf9\u5e94\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u8fd9\u4e2a\u4fe1\u606f\u6700\u7ec8\u662f\u8981\u5448\u73b0\u5728terraform registry\u5b98\u7f51\u4e0a\u7684\uff1b \u5bf9\u4e8e\u4e00\u4e9b\u975e\u5173\u7cfb\u578b\u7684\u53c2\u6570\uff0c\u53ef\u8bbe\u7f6e\u4e00\u4e2a\u9ed8\u8ba4\u503c\uff0c\u5982name\uff0cdescription\u7b49 \u5bf9\u4e8e\u590d\u6742\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u8981\u663e\u793a\u58f0\u660e\u5176\u7c7b\u578b\uff0c\u5982list\uff0cmap \u5b50\u8d44\u6e90\u7684\u53d8\u91cf\u8981\u5728Readme\u4e2d\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u4e88\u4ee5\u5448\u73b0</li> <li>outputs.tf module\u4e2doutput\u7684\u4f5c\u7528\u662f\u88ab\u5176\u4ed6\u6a21\u677f\u548cmodule\u5f15\u7528\uff0c\u56e0\u6b64\uff0c\u6bcf\u4e2amodule\u8981\u8bb2\u4e00\u4e9b\u91cd\u8981\u7684\u4fe1\u606f\u8f93\u51fa\u51fa\u6765\uff0c\u5982\u8d44\u6e90ID\uff0c\u8d44\u6e90name \u7b49\uff1b \u91cd\u590d\u8d44\u6e90\u7684\u53d8\u91cf\u8981\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u4e88\u4ee5\u8f93\u51fa\uff0c\u5982module ecs-instance\u4e2d\uff0c\u521b\u5efa\u591a\u4e2ainstance\u8d44\u6e90\uff0c\u8fd9\u4e9b\u8d44\u6e90\u7684ID\u5e94\u8be5\u8f93\u51fa\u5230\u4e00\u4e2alist\u53d8\u91cfinstance_ids\u4e2d \u548cvariables\u4e00\u6837\uff0c\u5b50\u8d44\u6e90\u7684output\u53d8\u91cf\u4e5f\u8981\u5728Readme\u4e2d\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u4e88\u4ee5\u5448\u73b0</li> <li>README \u63cf\u8ff0\u4e0b\u5f53\u524dModule\u662f\u7528\u6765\u5e72\u4ec0\u4e48\u7684\uff0c\u6d89\u53ca\u54ea\u4e9bresource\u548cdata source \u589e\u52a0 Usage\uff0c\u6307\u660e\u8be5\u5982\u4f55\u4f7f\u7528\u8fd9\u4e2a Module\u3002Module \u7684source \u683c\u5f0f\u4e3a source = \"//alicloud\"\uff0c\u5982\uff1asource = \"terraform-alicloud-modules/slb-listener/alicloud\" \u6dfb\u52a0module\u66b4\u9732\u7684\u5165\u53c2\u548c\u51fa\u53c2\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u66f4\u597d\u7684\u4f7f\u7528Module \u5177\u4f53\u7ec6\u8282\u53ef\u53c2\u8003\u5176\u4ed6module <li>\u6267\u884c\u53ef\u5f00\u542f\u65e5\u5fd7</li> <pre><code>export TF_LOG=TRACE\nexport TF_LOG_PATH=./terraform.log\n</code></pre> <p>\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u53ef\u67e5\u770b Terraform \u672c\u5730\u6587\u4ef6\u5939\u4f1a\u751f\u6210\u4e00\u4e2a <code>terraform.log</code> \u7684\u6587\u4ef6\u3002\u6587\u4ef6\u8bb0\u5f55\u4e86  provider \u5b9a\u4e49\u7684\u65e5\u5fd7\u8f93\u51fa\u3002</p>"},{"location":"devops/IaC/Terraform/terraform%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_2","title":"\u4e09 \u5b9e\u6218","text":""},{"location":"devops/IaC/Terraform/terraform%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#31-stats","title":"3.1 \u4f7f\u7528stats\u6587\u4ef6\u4f5c\u4e3a\u67e5\u8be2\u6e90","text":"<p>\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u53ef\u80fdmodule A \u9700\u8981\u4f9d\u8d56\u5df2\u7ecf\u8fd0\u884c\u5b8c\u6210\u540e\u7684module B \u7684outputs\uff0c\u4f8b\u5982\u5b9e\u4f8b\u7ed1\u5b9a\u5b89\u5168\u7ec4\uff0c\u9700\u8981\u5148\u8fd0\u884c\u5b89\u5168\u7ec4module\u5c06\u7ed3\u679c\u5b58\u50a8\u5728state\u6587\u4ef6\u4e2d\uff0cmodule A\u4ee5module B\u7684\u8fd0\u884c\u7ed3\u679cstate\u6587\u4ef6\u4f5c\u4e3a\u6570\u636e\u8f93\u5165\u6e90\u8fdb\u884c\u67e5\u8be2\u64cd\u4f5c\u3002</p> <p>\u4f8b\u5982\u4f7f\u7528cos\u4f5c\u4e3abackend\u540e\u7aef\u5b58\u50a8\u3002</p> <pre><code>provider \"tencentcloud\" {\n  region = \"ap-beijing\"\n}\n\nterraform {\n  required_providers {\n    tencentcloud = {\n      source  = \"registry.terraform.io/tencentcloudstack/tencentcloud\"\n      version = \"&gt;=1.61.5\"\n    }\n  }\n  backend \"cos\" {\n    region = \"ap-beijing\"\n    bucket = \"cfabackend-xxxxxx\"\n    prefix = \"terraform/state\"\n  }\n}\n</code></pre> <p>\u4f7f\u7528cos\u4e2d\u7684state\u6587\u4ef6\u4f5c\u4e3aterraform_remote_state\u3002</p> <pre><code>data \"terraform_remote_state\" \"cam\" {\n  backend = \"cos\"\n  config = {\n    region = \"ap-beijing\"\n    bucket = \"cfabackend-xxxxxx\"\n    prefix = \"terraform/state\"\n  }\n}\n\nlocals {\n    standards = data.terraform_remote_state.cam.outputs\n}\n\noutput \"result\" {\n  value = {\n    items = { for k, v in local.standards :k=&gt;v}\n  }\n}\n</code></pre> <p>\u200b   </p>"},{"location":"devops/other/Argo%20CD/","title":"Argo CD","text":""},{"location":"devops/other/Argo%20CD/#gitopsargo-cd","title":"GitOps\u5de5\u5177Argo CD\u5b9e\u6218","text":""},{"location":"devops/other/Argo%20CD/#_1","title":"\u80cc\u666f","text":"<p>GitOps \u7684\u6982\u5ff5\u6700\u521d\u6765\u6e90\u4e8e Weaveworks \u7684\u8054\u5408\u521b\u59cb\u4eba Alexis \u5728 2017 \u5e74 8 \u6708\u53d1\u8868\u7684\u4e00\u7bc7\u535a\u5ba2 GitOps - Operations by Pull Request\u3002\u5176\u662f\u5f00\u53d1\u8005\u548c\u8fd0\u7ef4\u5728\u96c6\u7fa4\u4e0a\u7ebf\u548c\u66f4\u65b0\u5728 Kubernetes \u8fd0\u884c\u7684\u590d\u6742\u5e94\u7528\u7a0b\u5e8f\u7684\u4e00\u79cd\u5feb\u901f\u3001\u5b89\u5168\u7684\u65b9\u6cd5\u3002Alexis\u7684\u6587\u7ae0\u6587\u7ae0\u4ecb\u7ecd\u4e86 Weaveworks \u7684\u5de5\u7a0b\u5e08\u5982\u4f55\u4ee5 Git \u4f5c\u4e3a\u4e8b\u5b9e\u7684\u552f\u4e00\u771f\u5b9e\u6765\u6e90\uff0c\u90e8\u7f72\u3001\u7ba1\u7406\u548c\u76d1\u63a7\u57fa\u4e8e Kubernetes \u7684 SaaS \u5e94\u7528\u3002</p> <p>\u6838\u5fc3\uff1a</p> <ul> <li> <p>\u5bf9\u4e8eK8s\u548c\u5176\u4ed6\u4e91\u539f\u751f\u6280\u672fGitOps\u53ef\u8c13\u4e00\u4e2a\u64cd\u4f5c\u6a21\u578b\uff0c\u63d0\u4f9b\u4e86\u4e00\u7ec4\u6700\u4f73\u5b9e\u8df5\uff0c\u5bf9\u4e8e\u5bb9\u5668\u96c6\u7fa4\u548c\u5e94\u7528\u7684\u7edf\u4e00\u90e8\u7f72\uff0c\u7ba1\u7406\u548c\u76d1\u63a7\u3002</p> </li> <li> <p>\u7aef\u5230\u7aef\u7684 CICD \u7ba1\u9053\u548c git \u5de5\u4f5c\u6d41\u90fd\u5e94\u7528\u4e8e\u64cd\u4f5c\u548c\u5f00\u53d1\u901a\u5411\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1\u4eba\u5458\u4f53\u9a8c\u4e4b\u8def; </p> </li> </ul> <p>\u8fd1\u6765\u7814\u7a76GitOps\u5de5\u5177Arog\uff0c\u4e00\u6587\u8d70\u5165GitOps\u4e4b\u95e8\uff0c\u4f53\u9a8c\u4e3a\u5f00\u53d1\u4eba\u5458\u5e26\u6765\u7684\u5c06\u4e0a\u7ebf\u90e8\u7f72\u7ed3\u5408\u5728Git\u4e2d\u7684\u7545\u5feb\u4f53\u9a8c\uff0cgit commit/reserve\u7684\u4e0a\u7ebf\u53d1\u5e03\u4e0e\u56de\u6eda\u53d8\u7684\u5982\u6b64\u7b80\u5355\u3002</p> <p>\u4e00 \u6982\u8ff0</p>"},{"location":"devops/other/Argo%20CD/#11-argo-cd","title":"1.1 \u4ec0\u4e48\u65f6\u5019Argo CD","text":"<p>argo CD\u5bf9k8s\u662f\u4e00\u4e2a\u58f0\u660e\u5f0f\u7684\uff0cgitops\u7684\u6301\u7eed\u96c6\u6210\u5de5\u5177\u3002</p>"},{"location":"devops/other/Argo%20CD/#12-argo-cd","title":"1.2 \u4e3a\u4ec0\u4e48\u4f7f\u7528Argo CD","text":"<p>\u5e94\u7528\u7684\u5b9a\u4e49/\u914d\u7f6e\u548c\u73af\u5883\u5e94\u8be5\u88ab\u58f0\u660e\u548c\u7248\u672c\u7ba1\u7406\uff0c\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u548c\u751f\u547d\u5468\u671f\u7ba1\u7406\u5e94\u8be5\u662f\u81ea\u52a8\u5316\u7684\uff0c\u53ef\u5ba1\u6838\u7684\u4e14\u6613\u4e8e\u7406\u89e3\u7684\u3002</p>"},{"location":"devops/other/Argo%20CD/#13","title":"1.3 \u4f7f\u7528","text":""},{"location":"devops/other/Argo%20CD/#131","title":"1.3.1 \u5de5\u4f5c\u65b9\u5f0f","text":"<p>Argo CD\u9075\u5faaGitOps\u6a21\u5f0f\uff0c\u8be5\u6a21\u5f0f\u4f7f\u7528Git\u5b58\u50a8\u5e93\u4f5c\u4e3a\u5b9a\u4e49\u6240\u9700\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u7684\u771f\u5b9e\u6765\u6e90\u3002Kubernetes\u6e05\u5355\u53ef\u4ee5\u901a\u8fc7\u51e0\u79cd\u65b9\u5f0f\u6307\u5b9a\uff1a</p> <ul> <li>kustomize applications</li> <li>helm charts</li> <li>ksonnet applications</li> <li>jsonnet files</li> <li>Plain directory of YAML/json manifests</li> <li>Any custom config management tool configured as a config management plugin</li> </ul> <p>Argo CD\u53ef\u5728\u6307\u5b9a\u7684\u76ee\u6807\u73af\u5883\u4e2d\u81ea\u52a8\u90e8\u7f72\u6240\u9700\u7684\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u3002\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u53ef\u4ee5\u5728Git\u63d0\u4ea4\u65f6\u8ddf\u8e2a\u5bf9\u5206\u652f\uff0c\u6807\u7b7e\u7684\u66f4\u65b0\uff0c\u6216\u56fa\u5b9a\u5230\u6e05\u5355\u7684\u7279\u5b9a\u7248\u672c\u3002\u6709\u5173\u53ef\u7528\u7684\u4e0d\u540c\u8ddf\u8e2a\u7b56\u7565\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u8ddf\u8e2a\u7b56\u7565\u3002</p>"},{"location":"devops/other/Argo%20CD/#132","title":"1.3.2 \u67b6\u6784","text":"<p>Argo CD\u88ab\u5b9e\u73b0\u4e3akubernetes\u63a7\u5236\u5668\uff0c\u8be5\u63a7\u5236\u5668\u8fde\u7eed\u76d1\u89c6\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u5c06\u5f53\u524d\u7684\u6d3b\u52a8\u72b6\u6001\u4e0e\u6240\u9700\u7684\u76ee\u6807\u72b6\u6001\uff08\u5728Git\u5b58\u50a8\u5e93\u4e2d\u6307\u5b9a\uff09\u8fdb\u884c\u6bd4\u8f83\u3002\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u504f\u79bb\u76ee\u6807\u72b6\u6001\u7684\u5df2\u90e8\u7f72\u5e94\u7528\u7a0b\u5e8f\u88ab\u89c6\u4e3aOutOfSync\u3002Argo CD\u62a5\u544a\u5e76\u53ef\u89c6\u5316\u5dee\u5f02\uff0c\u540c\u65f6\u63d0\u4f9b\u4e86\u81ea\u52a8\u6216\u624b\u52a8\u5c06\u5b9e\u65f6\u72b6\u6001\u540c\u6b65\u56de\u6240\u9700\u76ee\u6807\u72b6\u6001\u7684\u529f\u80fd\u3002\u5728Git\u5b58\u50a8\u5e93\u4e2d\u5bf9\u6240\u9700\u76ee\u6807\u72b6\u6001\u6240\u505a\u7684\u4efb\u4f55\u4fee\u6539\u90fd\u53ef\u4ee5\u81ea\u52a8\u5e94\u7528\u5e76\u53cd\u6620\u5728\u6307\u5b9a\u7684\u76ee\u6807\u73af\u5883\u4e2d\u3002</p>"},{"location":"devops/other/Argo%20CD/#_2","title":"\u4e8c \u57fa\u7840\u6982\u5ff5","text":"<p>\u5728\u6709\u6548\u4f7f\u7528Argo CD\u4e4b\u524d\uff0c\u6709\u5fc5\u8981\u4e86\u89e3\u8be5\u5e73\u53f0\u6240\u57fa\u4e8e\u7684\u57fa\u7840\u6280\u672f\u3002\u8fd8\u9700\u8981\u4e86\u89e3\u5411\u60a8\u63d0\u4f9b\u7684\u529f\u80fd\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\u3002\u4ee5\u4e0b\u90e8\u5206\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6709\u7528\u7684\u94fe\u63a5\uff0c\u53ef\u4ee5\u5e2e\u52a9\u60a8\u7406\u89e3\u3002</p>"},{"location":"devops/other/Argo%20CD/#21","title":"2.1 \u4e86\u89e3\u57fa\u7840","text":""},{"location":"devops/other/Argo%20CD/#211-k8s","title":"2.1.1 k8s\u77e5\u8bc6\u70b9","text":"<ul> <li>A Beginner-Friendly Introduction to Containers, VMs and Docker</li> <li>Introduction to Kubernetes</li> <li>Tutorials</li> <li>Hands on labs</li> </ul>"},{"location":"devops/other/Argo%20CD/#212","title":"2.1.2 \u81ea\u5b9a\u4e49\u6a21\u7248","text":"<ul> <li>Kustomize</li> <li>Helm</li> <li>Ksonnet</li> </ul>"},{"location":"devops/other/Argo%20CD/#213-jenkins","title":"2.1.3 jenkins\u96c6\u6210","text":"<ul> <li>Jenkins User Guide</li> </ul>"},{"location":"devops/other/Argo%20CD/#_3","title":"\u4e09 \u6838\u5fc3\u6982\u5ff5","text":"<p>\u5047\u8bbe\u60a8\u719f\u6089\u6838\u5fc3\u7684Git\uff0cDocker\uff0cKubernetes\uff0c\u6301\u7eed\u4ea4\u4ed8\u548cGitOps\u6982\u5ff5\u3002</p> <ul> <li> <p>Application\uff1a\u6e05\u5355\u5b9a\u4e49\u7684\u4e00\u7ec4Kubernetes\u8d44\u6e90\u3002\u8fd9\u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49\uff08CRD\uff09\u3002</p> </li> <li> <p>Application source type\uff1a\u4f7f\u7528\u54ea\u4e2a\u5de5\u5177\u6765\u6784\u5efa\u5e94\u7528\u7a0b\u5e8f</p> </li> <li>Target state\uff1a\u5e94\u7528\u7a0b\u5e8f\u7684\u671f\u671b\u72b6\u6001\uff0c\u7531Git\u5b58\u50a8\u5e93\u4e2d\u7684\u6587\u4ef6\u8868\u793a\u3002</li> <li>Live state\uff1a\u8be5\u5e94\u7528\u7a0b\u5e8f\u7684\u5b9e\u65f6\u72b6\u6001\u3002\u90e8\u7f72\u4e86\u54ea\u4e9bPod\u7b49\u3002</li> <li>Sync status\uff1a\u5b9e\u65f6\u72b6\u6001\u662f\u5426\u4e0e\u76ee\u6807\u72b6\u6001\u5339\u914d\u3002\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u4e0eGit\u6240\u8bf4\u7684\u76f8\u540c\uff1f</li> <li>Sync\uff1a\u4f7f\u5e94\u7528\u7a0b\u5e8f\u79fb\u81f3\u5176\u76ee\u6807\u72b6\u6001\u7684\u8fc7\u7a0b\u3002\u4f8b\u5982\u3002\u901a\u8fc7\u5c06\u66f4\u6539\u5e94\u7528\u4e8eKubernetes\u96c6\u7fa4\u3002</li> <li>Refresh\uff1a\u5c06Git\u4e2d\u7684\u6700\u65b0\u4ee3\u7801\u4e0e\u5b9e\u65f6\u72b6\u6001\u8fdb\u884c\u6bd4\u8f83\u3002\u627e\u51fa\u6709\u4ec0\u4e48\u4e0d\u540c\u3002</li> <li>Health:\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u72b6\u51b5\u662f\u5426\u6b63\u5e38\u8fd0\u884c\uff1f\u5b83\u53ef\u4ee5\u6ee1\u8db3\u8bf7\u6c42\u5417\uff1f</li> <li>Tool:\u4ece\u6587\u4ef6\u76ee\u5f55\u521b\u5efa\u6e05\u5355\u7684\u5de5\u5177\u3002\u4f8b\u5982\u3002Kustomize\u6216Ksonnet\u3002\u8bf7\u53c2\u9605\u5e94\u7528\u7a0b\u5e8f\u6e90\u7c7b\u578b\u3002</li> </ul>"},{"location":"devops/other/Argo%20CD/#_4","title":"\u56db \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"devops/other/Argo%20CD/#41-argo-cd","title":"4.1 \u5b89\u88c5Argo CD","text":"<pre><code>kubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\n</code></pre> <p>\u8fd9\u5c06\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u547d\u540d\u7a7a\u95f4argocd\uff0cArgo CD\u670d\u52a1\u548c\u5e94\u7528\u7a0b\u5e8f\u8d44\u6e90\u5c06\u9a7b\u7559\u5728\u8be5\u547d\u540d\u7a7a\u95f4\u4e2d\u3002</p>"},{"location":"devops/other/Argo%20CD/#42-argo-cd-cli","title":"4.2 \u4e0b\u8f7dArgo CD CLI","text":"<p>\u4ece https://github.com/argoproj/argo-cd/releases/latest.\u4e0b\u8f7dArgo CD\u5de5\u5177</p> <ul> <li>mac\u53ef\u4ee5\u5229\u7528\u5982\u4e0b\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5</li> </ul> <pre><code>brew tap argoproj/tap\nbrew install argoproj/tap/argocd\n</code></pre> <ul> <li>Linux\u5b89\u88c5</li> </ul> <pre><code>VERSION=$(curl --silent \"https://api.github.com/repos/argoproj/argo-cd/releases/latest\" | grep '\"tag_name\"' | sed -E 's/.*\"([^\"]+)\".*/\\1/')\ncurl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64\nchmod +x /usr/local/bin/argocd\n</code></pre> <p>\u53ef\u4ee5\u53c2\u8003\uff1ahttps://argoproj.github.io/argo-cd/cli_installation/</p>"},{"location":"devops/other/Argo%20CD/#43-argo-cd-api-server","title":"4.3 \u8bbf\u95eeArgo CD API server","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cArgo CD API\u670d\u52a1\u5668\u672a\u4f7f\u7528\u5916\u90e8IP\u516c\u5f00\u3002\u8981\u8bbf\u95eeAPI\u670d\u52a1\u5668\uff0c\u8bf7\u9009\u62e9\u4ee5\u4e0b\u6280\u672f\u4e4b\u4e00\u4ee5\u516c\u5f00Argo CD API\u670d\u52a1\u5668\uff1a</p> <p>\u7aef\u53e3\u8f6c\u53d1</p> <pre><code>[root@master ~]# kubectl port-forward svc/argocd-server -n argocd --address 0.0.0.0 8080:443\n</code></pre>"},{"location":"devops/other/Argo%20CD/#44-cliargo","title":"4.4 \u901a\u8fc7CLI\u767b\u5f55Argo","text":"<p>\u521d\u59cb\u5bc6\u7801\u5c06\u81ea\u52a8\u751f\u6210\u4e3aArgo CD API\u670d\u52a1\u5668\u7684\u5bb9\u5668\u540d\u79f0\u3002\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c\u68c0\u7d22\uff1a</p> <pre><code>[root@master ~]# kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2\nargocd-server-656f9b895b-bfjvw\n</code></pre> <p>\u4f7f\u7528\u7528\u6237\u540dadmin\u548c\u4e0a\u9762\u7684\u5bc6\u7801\uff0c\u767b\u5f55\u5230Argo CD\u7684IP\u6216\u4e3b\u673a\u540d\uff1a</p> <pre><code>argocd login &lt;ARGOCD_SERVER&gt;\n</code></pre> <p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u66f4\u6539\u5bc6\u7801\uff1a</p> <pre><code>argocd account update-password\n</code></pre> <pre><code># \u767b\u5f55\n[root@master ~]# argocd login localhost:8080\nWARNING: server certificate had error: x509: certificate signed by unknown authority. Proceed insecurely (y/n)? yes\nUsername: admin\nPassword: \n'admin' logged in successfully\nContext 'localhost:8080' updated\n# \u4fee\u6539\u5bc6\u7801\n[root@master ~]# argocd account update-password\n*** Enter current password: \n*** Enter new password: \n*** Confirm new password: \nPassword updated\nContext 'localhost:8080' updated\n</code></pre>"},{"location":"devops/other/Argo%20CD/#45","title":"4.5 \u6ce8\u518c\u96c6\u7fa4\u4ee5\u5c06\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u5230\uff08\u53ef\u9009\uff09","text":"<p>\u6b64\u6b65\u9aa4\u5c06\u7fa4\u96c6\u7684\u51ed\u636e\u6ce8\u518c\u5230Argo CD\uff0c\u4ec5\u5728\u90e8\u7f72\u5230\u5916\u90e8\u7fa4\u96c6\u65f6\u624d\u9700\u8981\u3002\u5728\u5185\u90e8\u8fdb\u884c\u90e8\u7f72\uff08\u5230\u4e0eArgo CD\u8fd0\u884c\u6240\u5728\u7684\u540c\u4e00\u96c6\u7fa4\uff09\u65f6\uff0c\u5e94\u5c06https\uff1a//kubernetes.default.svc\u7528\u4f5c\u5e94\u7528\u7a0b\u5e8f\u7684K8s API\u670d\u52a1\u5668\u5730\u5740\u3002</p> <p>\u9996\u5148\u5217\u51fa\u5f53\u524dkubconfig\u4e2d\u7684\u6240\u6709\u96c6\u7fa4\u4e0a\u4e0b\u6587\uff1a</p> <pre><code>argocd cluster add\n</code></pre> <p>\u4e0a\u9762\u7684\u547d\u4ee4\u5c06ServiceAccount\uff08argocd-manager\uff09\u5b89\u88c5\u5230\u8be5kubectl\u4e0a\u4e0b\u6587\u7684kube-system\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u5e76\u5c06\u670d\u52a1\u5e10\u6237\u7ed1\u5b9a\u5230\u7ba1\u7406\u5458\u7ea7\u522b\u7684ClusterRole\u3002Argo CD\u4f7f\u7528\u6b64\u670d\u52a1\u5e10\u6237\u4ee4\u724c\u6267\u884c\u5176\u7ba1\u7406\u4efb\u52a1\uff08\u5373\u90e8\u7f72/\u76d1\u89c6\uff09\u3002</p> <p>\u53ef\u4ee5\u4fee\u6539argocd-manager-role\u89d2\u8272\u7684\u89c4\u5219\uff0c\u4f7f\u5176\u4ec5\u5177\u6709\u5bf9\u4e00\u7ec4\u6709\u9650\u7684\u540d\u79f0\u7a7a\u95f4\uff0c\u7ec4\u548c\u79cd\u7c7b\u7684\u521b\u5efa\uff0c\u66f4\u65b0\uff0c\u4fee\u8865\uff0c\u5220\u9664\u7279\u6743\u3002\u4f46\u662f\uff0c\u5728\u7fa4\u96c6\u4f5c\u7528\u57df\u4e2d\uff0c\u83b7\u53d6\uff0c\u5217\u51fa\uff0c\u76d1\u89c6\u7279\u6743\u662fArgo CD\u8d77\u4f5c\u7528\u6240\u5fc5\u9700\u7684\u3002</p>"},{"location":"devops/other/Argo%20CD/#46-git","title":"4.6 \u4eceGit\u5b58\u50a8\u5e93\u521b\u5efa\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u4e00\u4e2aguestbook\u7684\u5e94\u7528\u6765\u4ed3\u5e93\u4fdd\u62a4\u793a\u4f8b\uff0c\u6765\u8bf4\u660eArgo CD\u5982\u4f55\u53bb\u5de5\u4f5c\uff1ahttps://github.com/argoproj/argocd-example-apps.git</p> <p></p>"},{"location":"devops/other/Argo%20CD/#461-cliapp","title":"4.6.1 \u901a\u8fc7CLI\u521b\u5efaAPP","text":"<p>You can access Argo CD using port forwarding: add <code>--port-forward-namespace argocd</code> flag to every CLI command or set <code>ARGOCD_OPTS</code> environment variable: <code>export ARGOCD_OPTS='--port-forward-namespace argocd'</code>:</p> <pre><code>argocd app create guestbook --repo https://github.com/argoproj/argocd-example-apps.git --path guestbook --dest-server https://kubernetes.default.svc --dest-namespace default\n</code></pre>"},{"location":"devops/other/Argo%20CD/#462-web-uiapp","title":"4.6.2 \u901a\u8fc7web UI\u521b\u5efaAPP","text":"<p>\u6253\u5f00\u6d4f\u89c8\u5668\u8fdb\u5165Argo CD\u5916\u90e8UI\uff0c\u7136\u540e\u901a\u8fc7\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95eeIP /\u4e3b\u673a\u540d\u767b\u5f55\u5e76\u4f7f\u7528\u5728\u6b65\u9aa44\u4e2d\u8bbe\u7f6e\u7684\u51ed\u636e\u3002</p> <p></p> <p>\u7ed9\u60a8\u7684\u5e94\u7528\u547d\u540d\u4e3a\u7559\u8a00\u7c3f\uff0c\u4f7f\u7528\u9879\u76ee\u9ed8\u8ba4\u503c\uff0c\u5e76\u5c06\u540c\u6b65\u7b56\u7565\u4fdd\u7559\u4e3a\u201c\u624b\u52a8\u201d\uff1a</p> <p></p> <p>Connect the https://github.com/redhatxl/argocd-example-apps.git  repo to Argo CD by setting repository url to the github repo url, leave revision as <code>HEAD</code>, and set the path to <code>guestbook</code>:</p> <p>\u6ce8\u610f\uff1a\u4ed3\u5e93\u53ef\u4ee5\u4f7f\u7528\u6211fork\u7684\uff0c\u76ee\u524d\u4ee5\u53ca\u66f4\u6539\u4e86\u955c\u50cf\u5730\u5740\uff0c\u53ef\u4ee5\u6b63\u5e38\u62c9\u53d6\uff0c</p> <p></p> <p>\u26a0\ufe0f\u6ce8\u610f\uff1aPath\u5bf9\u5e94\u9879\u76ee\u4e2d\u8d44\u6e90\u6e05\u5355\u7684\u76ee\u5f55\u3002  </p> <p>\u5bf9\u4e8e\u76ee\u6807\uff0c\u5c06\u96c6\u7fa4\u8bbe\u7f6e\u4e3a\u96c6\u7fa4\u5185\uff0c\u5e76\u5c06\u540d\u79f0\u7a7a\u95f4\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c\uff1a</p> <p></p> <p>\u586b\u5199\u5b8c\u4ee5\u4e0a\u4fe1\u606f\u540e\uff0c\u8bf7\u5355\u51fbUI\u9876\u90e8\u7684\u201c\u521b\u5efa\u201d\u4ee5\u521b\u5efa\u7559\u8a00\u7c3f\u5e94\u7528\u7a0b\u5e8f\uff1a</p> <p></p>"},{"location":"devops/other/Argo%20CD/#47","title":"4.7 \u540c\u6b65\uff08\u90e8\u7f72\uff09\u5e94\u7528","text":"<p>\u521b\u5efa\u7559\u8a00\u7c3f\u5e94\u7528\u7a0b\u5e8f\u540e\uff0c\u60a8\u73b0\u5728\u53ef\u4ee5\u67e5\u770b\u5176\u72b6\u6001\uff1a</p> <pre><code>[root@master ~]# argocd app get guestbook\nName:               guestbook\nProject:            default\nServer:             https://kubernetes.default.svc\nNamespace:          default\nURL:                https://localhost:8080/applications/guestbook\nRepo:               https://github.com/redhatxl/argocd-example-apps.git\nTarget:             HEAD\nPath:               guestbook\nSyncWindow:         Sync Allowed\nSync Policy:        &lt;none&gt;\nSync Status:        OutOfSync from HEAD (4973f15)\nHealth Status:      Missing\n\nGROUP  KIND        NAMESPACE  NAME          STATUS     HEALTH   HOOK  MESSAGE\n       Service     default    guestbook-ui  OutOfSync  Missing        \napps   Deployment  default    guestbook-ui  OutOfSync  Missing \n</code></pre> <p>\u7531\u4e8e\u5c1a\u672a\u90e8\u7f72\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u4e14\u5c1a\u672a\u521b\u5efaKubernetes\u8d44\u6e90\uff0c\u56e0\u6b64\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u6700\u521d\u5904\u4e8eOutOfSync\u72b6\u6001\u3002\u8981\u540c\u6b65\uff08\u90e8\u7f72\uff09\u5e94\u7528\u7a0b\u5e8f\uff0c\u8bf7\u8fd0\u884c\uff1a</p> <pre><code>[root@master ~]# argocd app sync guestbook\nTIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME    STATUS    HEALTH        HOOK  MESSAGE\n2020-01-24T12:59:13+08:00            Service     default          guestbook-ui  OutOfSync  Missing              \n2020-01-24T12:59:13+08:00   apps  Deployment     default          guestbook-ui  OutOfSync  Missing              \n2020-01-24T12:59:14+08:00            Service     default          guestbook-ui    Synced  Healthy              \n\nName:               guestbook\nProject:            default\nServer:             https://kubernetes.default.svc\nNamespace:          default\nURL:                https://localhost:8080/applications/guestbook\nRepo:               https://github.com/redhatxl/argocd-example-apps.git\nTarget:             HEAD\nPath:               guestbook\nSyncWindow:         Sync Allowed\nSync Policy:        &lt;none&gt;\nSync Status:        Synced to HEAD (4973f15)\nHealth Status:      Progressing\n\nOperation:          Sync\nSync Revision:      4973f150497aa18bc5fbd81b19102db2469eb6f0\nPhase:              Succeeded\nStart:              2020-01-24 12:59:11 +0800 CST\nFinished:           2020-01-24 12:59:12 +0800 CST\nDuration:           1s\nMessage:            successfully synced (all tasks run)\n\nGROUP  KIND        NAMESPACE  NAME          STATUS  HEALTH       HOOK  MESSAGE\n       Service     default    guestbook-ui  Synced  Healthy            service/guestbook-ui created\napps   Deployment  default    guestbook-ui  Synced  Progressing        deployment.apps/guestbook-ui created\n</code></pre> <p></p> <p>\u6b64\u547d\u4ee4\u4ece\u5b58\u50a8\u5e93\u4e2d\u68c0\u7d22\u6e05\u5355\uff0c\u5e76\u5bf9\u6e05\u5355\u6267\u884ckubectl\u5e94\u7528\u3002\u8be5\u7559\u8a00\u7c3f\u5e94\u7528\u7a0b\u5e8f\u73b0\u5728\u6b63\u5728\u8fd0\u884c\uff0c\u60a8\u73b0\u5728\u53ef\u4ee5\u67e5\u770b\u5176\u8d44\u6e90\u7ec4\u4ef6\uff0c\u65e5\u5fd7\uff0c\u4e8b\u4ef6\u548c\u8bc4\u4f30\u7684\u5065\u5eb7\u72b6\u6001\uff1a</p> <p>\u90e8\u7f72\u5b8c\u6210\u540e\u72b6\u6001\uff1a</p> <p></p> <p></p> <pre><code>[root@master ~]# kubectl  get all -l app=guestbook-ui\nNAME                                READY   STATUS    RESTARTS   AGE\npod/guestbook-ui-7bc795dc8c-m69fl   1/1     Running   0          3m6s\n\nNAME                                      DESIRED   CURRENT   READY   AGE\nreplicaset.apps/guestbook-ui-7bc795dc8c   1         1         1       3m6s\n</code></pre> <p>\u4fee\u6539guestbook\u7684\u8bbf\u95ee\u65b9\u5f0f\u4e3aNodePort</p> <p></p> <p></p>"},{"location":"devops/other/Argo%20CD/#_5","title":"\u4e94 \u64cd\u4f5c\u624b\u518c","text":""},{"location":"devops/other/Argo%20CD/#51","title":"5.1 \u6982\u8ff0","text":"<p>\u672c\u6307\u5357\u9002\u7528\u4e8e\u5e0c\u671b\u4e3a\u5176\u4ed6\u5f00\u53d1\u4eba\u5458\u5b89\u88c5\u548c\u914d\u7f6eArgo CD\u7684\u7ba1\u7406\u5458\u548c\u64cd\u4f5c\u5458\u3002</p>"},{"location":"devops/other/Argo%20CD/#52","title":"5.2 \u67b6\u6784\u6982\u8ff0","text":""},{"location":"devops/other/Argo%20CD/#521-api-server","title":"5.2.1 API Server","text":"<p>API\u670d\u52a1\u5668\u662fgRPC / REST\u670d\u52a1\u5668\uff0c\u5b83\u516c\u5f00\u4e86Web UI\uff0cCLI\u548cCI / CD\u7cfb\u7edf\u4f7f\u7528\u7684API\u3002\u5b83\u5177\u6709\u4ee5\u4e0b\u804c\u8d23\uff1a</p> <ul> <li>\u5e94\u7528\u7ba1\u7406\u548c\u72b6\u6001\u62a5\u544a</li> <li>\u5e94\u7528\u8c03\u7528\u64cd\u4f5c\uff08\u540c\u6b65\uff0c\u56de\u6eda\uff0c\u7528\u6237\u5b9a\u4e49\uff09</li> <li>\u4ed3\u5e93\u548c\u96c6\u7fa4\u8ba4\u8bc1\u7ba1\u7406</li> <li>\u5411\u5916\u90e8\u8eab\u4efd\u63d0\u4f9b\u8005\u7684\u8eab\u4efd\u9a8c\u8bc1\u548c\u8eab\u4efd\u9a8c\u8bc1\u59d4\u6d3e</li> <li>RBAC\u5f3a\u5236\u6267\u884c</li> <li>\u76d1\u542c/\u8f6c\u53d1Git webhook events</li> </ul>"},{"location":"devops/other/Argo%20CD/#522-repository-server","title":"5.2.2 Repository Server","text":"<p>\u4ed3\u5e93\u670d\u52a1\u662f\u4e00\u4e2a\u5185\u90e8\u7684\u670d\u52a1\uff0c\u7ef4\u62a4\u4e86\u4e00\u4e2a\u672c\u5730\u7684git\u4ed3\u5e93\u7f13\u5b58\u4e86\u5e94\u7528\u7684manifests\uff0c\u5229\u7528\u4ed6\u6765\u751f\u6210\u548c\u8fd4\u56dekubernetes\u7684manifests\u5f53\u63d0\u4f9b\u4e00\u4e0b\u7684\u8f93\u5165\u7684\u65f6\u5019</p> <ul> <li>\u4ed3\u5e93URL</li> <li>\u7248\u672c\uff08commit\uff0ctag\uff0cbranch\uff09</li> <li>\u5e94\u7528\u8865\u4e01</li> <li>\u6a21\u7248\u8bbe\u7f6e</li> </ul>"},{"location":"devops/other/Argo%20CD/#523-application-controller","title":"5.2.3 Application Controller","text":"<p>\u5e94\u7528\u63a7\u5236\u5668\u662f\u4e00\u4e2ak8s\u7684\u63a7\u5236\u5668\uff0c\u5229\u7528\u4ed6\u6765\u6301\u7eed\u7684\u76d1\u63a7\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u548c\u5bf9\u6bd4\u5f53\u524d\u7684\u72b6\u6001\uff0c\u548c\u5b58\u6d3b\u7684\u72b6\u6001\u5206\u914d\u5df2\u7ecf\u671f\u671b\u7684\u76ee\u6807\u72b6\u6001\uff08\u6765\u6e90\u4e8e\u5236\u5b9a\u7684repo\uff09\uff0c \u4ed6\u68c0\u6d4boutofsync\u5e94\u7528\u72b6\u6001\u548c\u53ef\u9009\u7684\u4efb\u52a1\uff0c\u5b83\u8c03\u7528\u4efb\u4f55\u7528\u6237\u81ea\u5b9a\u4e49\u7684hooks\u5bf9\u4e8e\u58f0\u660e\u5468\u671f\u4e8b\u4ef6</p>"},{"location":"devops/other/Argo%20CD/#53","title":"5.3 \u58f0\u660e\u8bbe\u7f6e","text":""},{"location":"devops/other/Argo%20CD/#531","title":"5.3.1 \u5feb\u901f\u53c2\u8003","text":"<p>\u53ef\u4ee5\u4f7f\u7528Kubernetes\u6e05\u5355\u58f0\u660e\u6027\u5730\u5b9a\u4e49Argo CD\u5e94\u7528\u7a0b\u5e8f\uff0c\u9879\u76ee\u548c\u8bbe\u7f6e\u3002</p> Name Kind Description <code>argocd-cm.yaml</code> ConfigMap General Argo CD configuration <code>argocd-secret.yaml</code> Secret Password, Certificates, Signing Key <code>argocd-rbac-cm.yaml</code> ConfigMap RBAC Configuration <code>argocd-tls-certs-cm.yaml</code> ConfigMap Custom TLS certificates for connecting Git repositories via HTTPS (v1.2 and later) <code>argocd-ssh-known-hosts-cm.yaml</code> ConfigMap SSH known hosts data for connecting Git repositories via SSH (v1.2 and later) <code>application.yaml</code> Application Example application spec <code>project.yaml</code> AppProject Example project spec"},{"location":"devops/other/Argo%20CD/#532","title":"5.3.2 \u5e94\u7528","text":"<p>Application CRD\u662fKubernetes\u8d44\u6e90\u5bf9\u8c61\uff0c\u4ee3\u8868\u73af\u5883\u4e2d\u5df2\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\u3002\u5b83\u7531\u4e24\u4e2a\u5173\u952e\u4fe1\u606f\u5b9a\u4e49\uff1a</p> <ul> <li> <p>\u5bf9Git\u4e2d\u6240\u9700\u72b6\u6001\u7684\u6e90\u5f15\u7528\uff08\u5b58\u50a8\u5e93\uff0c\u4fee\u8ba2\u7248\uff0c\u8def\u5f84\uff0c\u73af\u5883\uff09\u5bf9</p> </li> <li> <p>\u76ee\u6807\u96c6\u7fa4\u548c\u540d\u79f0\u7a7a\u95f4\u7684\u76ee\u6807\u5f15\u7528\u3002</p> </li> </ul> <p>\u6700\u4f4e\u7684\u5e94\u7528\u7a0b\u5e8f\u89c4\u8303\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: guestbook\n  namespace: argocd\nspec:\n  project: default\n  source:\n    repoURL: https://github.com/argoproj/argocd-example-apps.git\n    targetRevision: HEAD\n    path: guestbook\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: guestbook\n</code></pre> <p>\u53c2\u8003 application.yaml \u67e5\u770b\u9644\u52a0\u5b57\u6bb5</p> <p>\u540d\u79f0\u7a7a\u95f4\u5fc5\u987b\u4e0eArgo cd\u7684\u540d\u79f0\u7a7a\u95f4\u5339\u914d\uff0c\u901a\u5e38\u4e3aargocd\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5220\u9664\u5e94\u7528\u7a0b\u5e8f\u5c06\u4e0d\u4f1a\u6267\u884c\u7ea7\u8054\u5220\u9664\uff0c\u4ece\u800c\u5220\u9664\u5176\u8d44\u6e90\u3002\u5982\u679c\u9700\u8981\u8fd9\u79cd\u884c\u4e3a\uff0c\u5219\u5fc5\u987b\u6dfb\u52a0\u7ec8\u7ed3\u5668-\u60a8\u53ef\u80fd\u4e0d\u5e0c\u671b\u8fd9\u6837\u505a\u3002</p> <p>\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u53ef\u4ee5\u521b\u5efa\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u8be5\u5e94\u7528\u7a0b\u5e8f\u53c8\u53ef\u4ee5\u521b\u5efa\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u6837\uff0c\u60a8\u5c31\u53ef\u4ee5\u58f0\u660e\u6027\u5730\u7ba1\u7406\u53ef\u4ee5\u534f\u8c03\u90e8\u7f72\u548c\u914d\u7f6e\u7684\u4e00\u7ec4\u5e94\u7528\u7a0b\u5e8f\u3002\u8bf7\u53c2\u9605\u7fa4\u96c6\u5f15\u5bfc\u3002</p> <p>AppProject CRD\u662fKubernetes\u8d44\u6e90\u5bf9\u8c61\uff0c\u4ee3\u8868\u5e94\u7528\u7a0b\u5e8f\u7684\u903b\u8f91\u5206\u7ec4\u3002\u5b83\u7531\u4ee5\u4e0b\u5173\u952e\u4fe1\u606f\u5b9a\u4e49\uff1a</p> <ul> <li>sourceRepos\u5f15\u7528\u9879\u76ee\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u4ece\u4e2d\u63d0\u53d6\u6e05\u5355\u7684\u5b58\u50a8\u5e93\u3002</li> <li>\u76ee\u6807\u5f15\u7528\u9879\u76ee\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u90e8\u7f72\u5230\u7684\u7fa4\u96c6\u548c\u540d\u79f0\u7a7a\u95f4\u3002</li> <li>\u5b9e\u4f53\u7684\u89d2\u8272\u5217\u8868\u53ca\u5176\u5728\u9879\u76ee\u4e2d\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u7684\u5b9a\u4e49\u3002</li> </ul>"},{"location":"devops/other/Argo%20CD/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://argoproj.github.io/argo-cd/?spm=a2c4e.10696291.0.0.6fc419a4zmeq9o</li> <li>https://www.weave.works/blog/gitops-is-cloud-native?spm=a2c4e.10696291.0.0.6e0319a4UJmgT6</li> </ul>"},{"location":"devops/other/Github/","title":"Github","text":""},{"location":"devops/other/Github/#label","title":"\u6dfb\u52a0label","text":"<ul> <li>https://docs.github.com/en/rest/reference/issues#labels</li> </ul>"},{"location":"devops/other/Github/#_1","title":"\u5982\u679c\u63d0\u95ee","text":"<ul> <li>https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md</li> </ul>"},{"location":"devops/other/Github/#good-first-issue","title":"good-first-issue","text":"<ul> <li>https://github.com/deepsourcelabs/good-first-issue</li> </ul>"},{"location":"devops/other/Github/#_2","title":"\u5f00\u6e90\u6700\u4f73\u5b9e\u8df5","text":"<ul> <li>https://github.com/LinuxSuRen/open-source-best-practice</li> </ul>"},{"location":"devops/other/Github/#_3","title":"\u5f00\u6e90\u5236\u5317","text":"<ul> <li>https://gitee.com/gitee-community/opensource-guide</li> </ul>"},{"location":"devops/other/Github/#_4","title":"\u5f00\u6e90\u8f6f\u4ef6\u6307\u5357","text":"<ul> <li>https://opensource.guide/zh-hans/</li> </ul>"},{"location":"devops/other/Github/#_5","title":"\u5f00\u6e90\u89c6\u9891","text":"<ul> <li>https://github.com/LinuxSuRen/open-source-best-practice/blob/master/audios-and-videos.md</li> </ul>"},{"location":"devops/other/Github/#english","title":"english","text":"<ul> <li>https://github.com/LinuxSuRen/open-source-best-practice/blob/master/english.md</li> </ul>"},{"location":"devops/other/Github/#_6","title":"\u5f00\u6e90\u9762\u5bf9\u9762","text":"<ul> <li>https://github.com/opensource-f2f/episode</li> </ul>"},{"location":"devops/other/Github/#_7","title":"\u77e5\u8bc6\u5171\u4eab\u7f72\u540d","text":"<p>https://creativecommons.org/licenses/by/4.0/</p>"},{"location":"devops/other/Github/#_8","title":"\u5f00\u6e90\u534f\u8bae","text":"<p>https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/licensing-a-repository#where-does-the-license-live-on-my-repository</p>"},{"location":"devops/other/Github/#_9","title":"\u5b9e\u6218\u5f00\u6e90","text":"<p>https://kubesphere.com.cn/forum/d/2956-kubesphere</p>"},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/","title":"IaC\u4e4bTerraform \u4e0ePulumi\u4f7f\u7528\u5bf9\u6bd4","text":""},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#iacterraform-pulumi","title":"IaC\u4e4bTerraform \u4e0ePulumi\u4f7f\u7528\u5bf9\u6bd4","text":""},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#_1","title":"\u4e00 \u7b80\u4ecb","text":"<p>\u5728iac(Infarftruce As Code)\u65b9\u9762\uff0c\u8001\u5c06Terraform\u5df2\u7ecf\u5229\u7528yaml\u72ec\u9886\u98ce\u9a9a\u5f88\u957f\u65f6\u95f4\uff0c\u65b0\u519bpulumi\u4ee5\u5176\u72ec\u5230\u7684\u4ee3\u7801\u5b9e\u73b0\u8d44\u6e90\u7f16\u6392\u4e00\u51fa\u573a\u5c31\u5149\u8292\u56db\u5c04\uff0c\u5bf9\u4e8e\u4e0d\u540c\u573a\u666f\uff0c\u4e0d\u540c\u516c\u53f8\u7ec4\u7ec7\u67b6\u6784\uff0c\u4ee5\u53ca\u4e0d\u540c\u7684\u5382\u5546\u8303\u56f4\uff0c\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u5185\u5bb9\u8fdb\u884c\u67e5\u770b\u5176\u533a\u522b\u3002</p>"},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#_2","title":"\u4e8c \u529f\u80fd","text":""},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#21-terraform","title":"2.1 terraform","text":"<ul> <li>\u6982\u5ff5\uff1aTerraform \u662f Hashicorp \u516c\u53f8\u5f00\u6e90\u7684\u4e00\u79cd\u591a\u4e91\u8d44\u6e90\u7f16\u6392\u5de5\u5177\u3002\u4f7f\u7528\u8005\u901a\u8fc7\u4e00\u79cd\u7279\u5b9a\u7684\u914d\u7f6e\u8bed\u8a00\uff08HCL, Hashicorp Configuration Language\uff09\u6765\u63cf\u8ff0\u57fa\u7840\u8bbe\u65bd\uff0c\u7531 Terraform \u5de5\u5177\u7edf\u4e00\u89e3\u6790\uff0c\u6784\u5efa\u8d44\u6e90\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u751f\u6210\u6267\u884c\u8ba1\u5212\uff0c\u5e76\u901a\u8fc7\u8c03\u7528\u5404\u5bb6\u4e91\u5382\u5546\u7684\u5177\u4f53\u5b9e\u73b0\u6765\u5b8c\u6210\u6574\u4e2a\u57fa\u7840\u8bbe\u65bd\u751f\u547d\u5468\u671f\u7684\u7ba1\u7406\u3002</li> <li>\u8bed\u8a00\u7279\u6027\uff1a\u58f0\u660e\u5f0f\u8bed\u8a00\u63cf\u8ff0\u8d44\u6e90\u6e05\u5355\uff0c\u4ee3\u7801\u4e0d\u5bb9\u6613\u590d\u7528\uff0c\u5bf9\u4e8eyaml\u8bed\u6cd5\u5904\u7406\u5faa\u73af\uff0c\u6761\u4ef6\u5224\u65ad\uff0c\u4ee5\u53ca\u5bf9\u5b57\u7b26\u4e32\u505a\u5904\u7406\u7b49\u5404\u79cd\u5de5\u4f5c\uff0c\u800c terraform \u5728\u8fd9\u4e00\u5757\u7684\u8868\u73b0\u529b\u592a\u5f31\uff0c\u4f7f\u5f97\u4ee3\u7801\u5199\u8d77\u6765\u975e\u5e38\u5197\u957f\uff0c\u5f88\u591a\u65f6\u5019\u4e0d\u5f97\u4e0d\u590d\u5236\u7c98\u8d34\u3002</li> <li>\u72b6\u6001\u7ba1\u7406\u56f0\u96be\uff1a\u72b6\u6001\u7ba1\u7406\u662f terraform \u7528\u6237\u4f53\u9a8c\u975e\u5e38\u5dee\u7684\u4e00\u73af\uff0c\u7531\u4e8e\u6ca1\u6709\u63d0\u4f9b\u76f8\u5e94\u7684\u529f\u80fd\uff0c\u5ba2\u6237\u53ea\u80fd\u81ea\u5df1\u5728\u5f00\u6e90\u793e\u533a\u91cc\u627e\u89e3\u51b3\u65b9\u6848\uff1b</li> <li>\u53ef\u89c6\u5316\uff1a\u72b6\u6001\u7684\u5c55\u793a\uff0c\u90e8\u7f72\u7684\u8fc7\u7a0b\u5176\u5b9e\u90fd\u53ef\u80fd\u505a\u5f88\u591a\u53ef\u89c6\u5316\u7684\u4e8b\u60c5\uff0c\u8ba9\u6574\u4f53\u4f53\u9a8c\u66f4\u597d\u4e00\u4e9b\uff0c\u51cf\u5c11 devOps \u72af\u9519\u3002\u7136\u800c\uff0cterraform \u5e76\u6ca1\u6709\u505a\u8fd9\u65b9\u9762\u7684\u652f\u6301\u3002</li> <li>\u751f\u6001\uff1a\u751f\u6001\u5b8c\u5584\uff0c\u56fd\u5185\u4f8b\u5982\u963f\u91cc/\u817e\u8baf/\u534e\u4e3a/Ucloud/\u767e\u5ea6\u4e91\u7b49\u90fd\u652f\u6301\uff0c\u56fd\u5916\u7684\u57fa\u672c\u90fd\u652f\u6301\u3002</li> <li>DevOPS\uff1a\u9700\u8981\u5355\u72ec\u96c6\u6210\u5230CI/CD\u4e2d\uff0c\u914d\u5408\u5176\u5b9e\u73b0\u8d44\u6e90\u7f16\u6392\u3002</li> </ul>"},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#22-pulumi","title":"2.2 pulumi","text":"<ul> <li>\u6982\u5ff5\uff1aPulumi\u662f\u4e00\u4e2a\u6700\u65b0\u7684\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u5e73\u53f0\uff0c\u4ed6\u5305\u542bCLI\u3001\u8fd0\u884c\u65f6\u3001\u8fd0\u884c\u5e93\u3001\u548c\u4e00\u4e2a\u6258\u7ba1\u670d\u52a1\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u5f3a\u5927\u7684\u8c03\u914d\uff0c\u66f4\u65b0\u548c\u7ba1\u7406\u4e91\u57fa\u7840\u67b6\u6784\u7684\u65b9\u5f0f\u3002 Pulumi\u66ff\u4ee3\u4e86YAML\u6216\u7279\u5b9a\u9886\u57df\u8bed\u8a00\uff08DSL\uff09\uff0c\u800c\u5229\u7528\u4e86\u73b0\u6709\u7684\uff0c\u719f\u6089\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u5305\u62ecTypeScript\uff0cJavaScript\uff0cPython\uff0cGo\u548c.NET\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u672c\u673a\u5de5\u5177\uff0c\u5e93\u548c\u5305\u7ba1\u7406\u5668\u3002</li> <li>\u8bed\u8a00\u7279\u6027\uff1a\u5229\u7528\u7f16\u7a0b\u8bed\u8a00\u63cf\u8ff0\u8d44\u6e90\u6e05\u5355\uff0c\u5bb9\u6613\u7f16\u5199\u7c7b\u590d\u7528\u7b49\uff0c\u7f16\u7a0b\u8bed\u8a00\u5bf9\u4e8e\u5faa\u73af\uff0c\u5224\u65ad\u5904\u7406\u5177\u5907\u826f\u597d\u7684\u652f\u6301\uff0c\u4e14\u4ee3\u7801\u91cf\u5f88\u5c11\uff0c\u4ee3\u7801\u8868\u73b0\u529b\u5f3a\u3002</li> <li>\u72b6\u6001\u7ba1\u7406\uff1a\u7531\u4e8e\u4f7f\u7528\u5404\u5f00\u53d1\u8bed\u8a00\u5b9e\u73b0\uff0c\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u5728\u4ee3\u7801\u91cc\u9762\u4f7f\u7528\u5404\u7c7b\u6570\u636e\u5e93\u8fdb\u884c\u6570\u636e\u64cd\u4f5c\u3002</li> <li>\u53ef\u89c6\u5316\uff1a\u53ef\u4ee5\u6ce8\u518cpulumi\u7f51\u7ad9\uff0c\u53ef\u89c6\u5316\u7ba1\u7406\u3002</li> <li>\u751f\u6001\uff1a\u751f\u6001\u5904\u4e8e\u53d1\u5c55\u9636\u6bb5\uff0c\u56fd\u5185\u76ee\u524d\u4ec5\u963f\u91cc/\u652f\u6301\uff0c\u56fd\u5916\u7684\u57fa\u672c\u90fd\u652f\u6301\u3002</li> <li>DevOPS\uff0c\u76f4\u63a5\u5728\u8bed\u8a00\u4e2d\u5b9e\u73b0\uff0c\u975e\u5e38\u65b9\u4fbf\u5c06\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801\u548c\u8d44\u6e90\u7f16\u6392\u5b58\u653e\u5728\u4ee3\u7801\u5e93\uff0c\u9002\u5408\u4e8eGitOPS\u3002</li> </ul>"},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#_3","title":"\u4e09 \u652f\u6301\u8303\u56f4","text":""},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#31-terraform","title":"3.1 terraform \u652f\u6301","text":""},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#32-pulumi","title":"3.2 pulumi\u652f\u6301","text":"<p>\u4ece\u4e0a\u8ff0\u4e24\u6b3e\u4ea7\u54c1\u7684provider\u6765\u770b\uff0cTerraform\u7684\u56fd\u5185\u4e91\u5382\u5546\u548c\u652f\u6301\u7684\u8303\u56f4\u66f4\u5e7f\uff0cpulumi\u56fd\u5916\u652f\u6301\u7684\u591a\uff0c\u56fd\u5185\u76ee\u524d\u4ec5\u963f\u91cc\u6709\u3002</p>"},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#_4","title":"\u56db \u901a\u7528\u6027","text":""},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#41-terraform","title":"4.1 terraform","text":"<p>terraform\u4f7f\u7528HCL\u6765\u7684yaml\u6765\u63cf\u8ff0\u8d44\u6e90\u6e05\u5355\uff0c\u867d\u7136\u7edf\u4e00\uff0c\u4f46\u662f\u5bf9\u4e8e\u8d1f\u8d23\u573a\u666f\u7f16\u6392\uff0c\u5f88\u96be\u7528yaml\u8bed\u8a00\u63cf\u8ff0\uff0c\u4e14\u5f00\u53d1\u4eba\u5458\u9700\u8981\u5355\u72ec\u5b66\u4e60yaml\u8bed\u6cd5\u3002</p>"},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#42-pulumi","title":"4.2 pulumi","text":"<p>pulumi\u4f7f\u7528\u5404\u7c7b\u7814\u53d1\u4eba\u5458\u719f\u6089\u7684\u5f00\u53d1\u8bed\u8a00\u6765\u63cf\u8ff0\u8d44\u6e90\u6e05\u5355\uff0c\u53ef\u8c13\u4e0b\u4e00\u4ee3IaC\uff0c\u4e0d\u7528\u5f00\u53d1\u4eba\u5458\u6765\u5355\u72ec\u5b66\u4e60yaml\u8bed\u6cd5\uff0c\u4f7f\u7528\u81ea\u5df1\u719f\u6089\u7684\u8bed\u8a00\u6765\u63cf\u8ff0\u9700\u8981\u7684\u6e05\u5355\u5373\u53ef\uff0c\u4f46\u662f\u76ee\u524d\u9002\u914d\u56fd\u5185\u516c\u6709\u4e91\u4e0d\u662f\u5f88\u591a\uff0c\u5982\u679c\u5728\u8303\u56f4\u5185\u53ef\u4ee5\u8003\u8651\u3002</p>"},{"location":"devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/#_5","title":"\u4e94 \u7ed3\u8bba","text":"<p>\u6839\u636e\u4ee5\u4e0a\u5185\u5bb9\uff0cterraform\u9002\u5e94\u4e8e\u591a\u4e91\u96c6\u6210\u573a\u666f\uff0c\u6709\u66f4\u591a\u7684\u652f\u6301\u8303\u56f4\uff0c\u4f46\u662f\u5bf9\u4e8e\u8bed\u8a00\u5b9e\u73b0\u548c\u72b6\u6001\u5b58\u50a8\u8f83\u4e3a\u5f31\uff0c\u9700\u8981\u5355\u72ec\u5b66\u4e60yaml\u8bed\u6cd5\uff0c\u9002\u5e94\u4e8e\u6709\u5355\u72ecDevops\u8fd0\u7ef4\u90e8\u95e8\u3002</p> <p>pulumi\u7a0b\u5e8f\u5458\u66f4\u4e3a\u559c\u6b22\uff0c\u53ef\u4ee5\u4f7f\u7528\u5404\u79cd\u7f16\u7a0b\u8bed\u8a00\u6765\u505a\u8d44\u6e90\u7f16\u6392\uff0c\u4f46\u662f\u9002\u5e94\u573a\u666f\u76ee\u524d\u4ecd\u5904\u4e8e\u53d1\u5c55\u9636\u6bb5\uff0c\u521b\u65b0\u6027\u7684\u516c\u53f8\u6ca1\u6709\u8fd0\u7ef4\uff0c\u6216\u8fd0\u7ef4\u5f88\u5c11\u975e\u5e38\u9002\u5408\uff0c\u5728\u672a\u6765pulumi\u9002\u5e94\u66f4\u591a\u7684\u652f\u6301\u8303\u56f4\uff0c\u914d\u5408serverless\u65e0\u7f1d\u7ed3\u5408\uff0c\u76f8\u4fe1\u4f1a\u6709\u66f4\u597d\u7684\u573a\u666f\u5b9e\u8df5\u3002</p>"},{"location":"devops/other/IaC%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/","title":"IaC\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"devops/other/IaC%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#iac","title":"IaC\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"devops/other/IaC%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://stackify.com/what-is-infrastructure-as-code-how-it-works-best-practices-tutorials/</li> </ul>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/","title":"Jenkins\u8be6\u89e3","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#jenkins_1","title":"\u4e00 Jenkins\u6982\u8ff0","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#1","title":"1 \u5b9a\u4e49\u6b65\u9aa4","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#11","title":"1.1 \u58f0\u660e\u5f0f","text":"<pre><code>pipeline {\n    agent any\n    stages {\n        stage {\n            steps {\n\n            }\n            steps {\n\n            }\n            ...\n        }\n    }\n    stage {\n\n    }\n    ...\n}\n</code></pre>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#12","title":"1.2 \u811a\u672c\u5f0f","text":"<pre><code>node {\n    stage('Build') {\n        echo 'Building....'\n    }\n    stage('Test') {\n        echo 'Building....'\n    }\n    stage('Deploy') {\n        echo 'Deploying....'\n    }\n}\n</code></pre>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#2","title":"2 \u6267\u884c\u73af\u5883","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#21","title":"2.1 \u58f0\u660e\u5f0f","text":"<pre><code>pipeline {\n        # \u5b9a\u4e49\u6267\u884c\u73af\u5883\n    agent {\n        docker { image 'node:7-alpine' }\n    }\n    stages {\n        stage('Test') {\n            steps {\n                sh 'node --version'\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#22","title":"2.2 \u811a\u672c\u5f0f","text":"<pre><code>node {\n    /* Requires the Docker Pipeline plugin to be installed */\n    docker.image('node:7-alpine').inside {\n        stage('Test') {\n            sh 'node --version'\n        }\n    }\n}\n</code></pre>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#3","title":"3 \u73af\u5883\u53d8\u91cf","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#31","title":"3.1 \u58f0\u660e\u5f0f","text":"<pre><code>pipeline {\n    agent any\n        # \u4f7f\u7528\u73af\u5883\u53d8\u91cf\n    environment {\n        DISABLE_AUTH = 'true'\n        DB_ENGINE    = 'sqlite'\n        # ak\u4fe1\u606f\n        AWS_ACCESS_KEY_ID     = credentials('AWS_ACCESS_KEY_ID')\n            AWS_SECRET_ACCESS_KEY = credentials('AWS_SECRET_ACCESS_KEY')\n            # \u7528\u6237\u540d\u548c\u5bc6\u7801credentials\u4ec5\u9002\u7528\u4e8e\u58f0\u660e\u6027Pipeline\n            SAUCE_ACCESS = credentials('sauce-lab-dev')\n    }\n    #\u58f0\u660e\u5f0fPipeline\u652f\u6301\u5f00\u7bb1\u5373\u7528\u7684\u53c2\u6570\uff0c\u5141\u8bb8Pipeline\u5728\u8fd0\u884c\u65f6\u901a\u8fc7parameters\u6307\u4ee4\u63a5\u53d7\u7528\u6237\u6307\u5b9a\u7684\u53c2\u6570\u3002\u4f7f\u7528\u811a\u672cPipeline\u914d\u7f6e\u53c2\u6570\u662f\u901a\u8fc7properties\u6b65\u9aa4\u5b8c\u6210\u7684\uff0c\u53ef\u4ee5\u5728\u4ee3\u7801\u6bb5\u751f\u6210\u5668\u4e2d\u627e\u5230\u3002\n        #\u5982\u679c\u60a8\u4f7f\u7528\u201c\u4f7f\u7528\u6784\u5efa\u53c2\u6570\u201d\u9009\u9879\u6765\u914d\u7f6ePipeline\u4ee5\u63a5\u53d7\u53c2\u6570\uff0c\u90a3\u4e48\u8fd9\u4e9b\u53c2\u6570\u53ef\u4f5c\u4e3aparams \u53d8\u91cf\u7684\u6210\u5458\u8bbf\u95ee\u3002\n        #   \u5047\u8bbe\u4e00\u4e2a\u540d\u4e3a\u201cGreeting\u201d\u7684String\u53c2\u6570\u5df2\u7ecf\u5728\u914d\u7f6e\u4e2d Jenkinsfile\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7${params.Greeting}\u4ee5\u4e0b\u65b9\u5f0f\u8bbf\u95ee\u8be5\u53c2\u6570\uff1a\n    parameters {\n        string(name: 'Greeting', defaultValue: 'Hello', description: 'How should I greet the world?')\n    }\n\n    stages {\n        stage('Build') {\n            steps {\n                sh 'printenv'\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#32","title":"3.2 \u811a\u672c\u5f0f","text":"<pre><code>properties([parameters([string(defaultValue: 'Hello', description: 'How should I greet the world?', name: 'Greeting')])])\nnode {\n    withEnv(['DISABLE_AUTH=true',\n             'DB_ENGINE=sqlite']) {\n        stage('Build') {\n            sh 'printenv'\n        }\n    }\n}\n</code></pre>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#4","title":"4 \u6d4b\u8bd5\u6e05\u7406","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#41","title":"4.1 \u58f0\u660e\u5f0f","text":"<pre><code>pipeline {\n    agent any\n    stages {\n        stage('Build') {\n            steps {\n                sh './gradlew build'\n            }\n        }\n        stage('Test') {\n            steps {\n                sh './gradlew check'\n            }\n        }\n    }\n    post {\n        always {\n            junit 'build/reports/**/*.xml'\n            archive 'build/libs/**/*.jar'\n            junit 'build/reports/**/*.xml'\n        }\n        success {\n            echo 'I succeeeded!'\n        }\n        unstable {\n            echo 'I am unstable :/'\n        }\n        failure {\n            echo 'I failed :('\n        }\n        changed {\n            echo 'Things were different before...'\n        }\n        failure {\n        mail to: 'team@example.com',\n             subject: \"Failed Pipeline: ${currentBuild.fullDisplayName}\",\n             body: \"Something is wrong with ${env.BUILD_URL}\"\n    }\n    }\n}\n</code></pre>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#42","title":"4.2 \u811a\u672c\u5f0f","text":"<pre><code>node {\n    try {\n        stage('No-op') {\n            sh 'ls'\n        }\n    }\n}\ncatch (exc) {\n    echo 'I failed'\n}\nfinally {\n    if (currentBuild.result == 'UNSTABLE') {\n        echo 'I am unstable :/'\n    } else {\n        echo 'One way or another, I have finished'\n    }\n}\n</code></pre>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#pipeline","title":"\u4e8c Pipeline","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#1_1","title":"1 \u6982\u8ff0","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#11_1","title":"1.1 \u6982\u5ff5","text":"<p>Jenkins Pipeline\u662f\u4e00\u5957\u63d2\u4ef6\uff0c\u652f\u6301\u5c06\u8fde\u7eed\u8f93\u9001Pipeline\u5b9e\u65bd\u548c\u6574\u5408\u5230Jenkins\u3002Pipeline\u63d0\u4f9b\u4e86\u4e00\u7ec4\u53ef\u6269\u5c55\u7684\u5de5\u5177\uff0c\u7528\u4e8e\u901a\u8fc7PipelineDSL\u4e3a\u4ee3\u7801\u521b\u5efa\u7b80\u5355\u5230\u590d\u6742\u7684\u4f20\u9001Pipeline\u3002 </p> <p>\u590d\u6742\u7684Pipeline\u96be\u4ee5\u5728Pipeline\u914d\u7f6e\u9875\u9762\u7684\u6587\u672c\u533a\u57df\u5185\u8fdb\u884c\u5199\u5165\u548c\u7ef4\u62a4\u3002\u4e3a\u4e86\u4f7f\u8fd9\u66f4\u5bb9\u6613\uff0cPipeline\u4e5f\u53ef\u4ee5\u5199\u5728\u6587\u672c\u7f16\u8f91\u5668\u4e2d\uff0c\u5e76\u68c0\u67e5\u6e90\u63a7\u4ef6\uff0c\u4f5c\u4e3aJenkinsfile\uff0cJenkins\u53ef\u4ee5\u901a\u8fc7Pipeline\u811a\u672c\u4eceSCM\u9009\u9879\u52a0\u8f7d\u7684\u63a7\u4ef6</p> <p>\u4e3a\u6b64\uff0c\u5728\u5b9a\u4e49Pipeline\u65f6\uff0c\u4eceSCM\u4e2d\u9009\u62e9Pipeline\u811a\u672c\u3002</p> <p>\u9009\u62e9SCM\u9009\u9879\u4e2d\u7684Pipeline\u811a\u672c\u540e\uff0c\u4e0d\u8981\u5728Jenkins UI\u4e2d\u8f93\u5165\u4efb\u4f55Groovy\u4ee3\u7801; \u60a8\u53ea\u9700\u6307\u5b9a\u8981\u4ece\u5176\u4e2d\u68c0\u7d22Pipeline\u7684\u6e90\u4ee3\u7801\u4e2d\u7684\u8def\u5f84\u3002\u66f4\u65b0\u6307\u5b9a\u7684\u5b58\u50a8\u5e93\u65f6\uff0c\u53ea\u8981Pipeline\u914d\u7f6e\u4e86SCM\u8f6e\u8be2\u89e6\u53d1\u5668\uff0c\u5c31\u4f1a\u89e6\u53d1\u4e00\u4e2a\u65b0\u6784\u5efa\u3002</p>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#12_1","title":"1.2 \u793a\u4f8b","text":"<pre><code>pipeline {\n        #agent \u8868\u793aJenkins\u5e94\u8be5\u4e3aPipeline\u7684\u8fd9\u4e00\u90e8\u5206\u5206\u914d\u4e00\u4e2a\u6267\u884c\u8005\u548c\u5de5\u4f5c\u533a\u3002\n    agent any \n\n\n    stages {\n            #stage \u63cf\u8ff0\u4e86\u8fd9\u6761Pipeline\u7684\u4e00\u4e2a\u9636\u6bb5\n        stage('Build') { \n\n                #steps \u63cf\u8ff0\u4e86\u8981\u5728\u5176\u4e2d\u8fd0\u884c\u7684\u6b65\u9aa4 stage\n            steps { \n                    #sh \u6267\u884c\u7ed9\u5b9a\u7684shell\u547d\u4ee4\n                sh 'make' \n            }\n        }\n        stage('Test'){\n            steps {\n                sh 'make check'\n                #junit\u662f\u7531JUnit\u63d2\u4ef6\u63d0\u4f9b\u7684 \u7528\u4e8e\u805a\u5408\u6d4b\u8bd5\u62a5\u544a\u7684Pipeline\u6b65\u9aa4\u3002\n                junit 'reports/**/*.xml' \n            }\n        }\n        stage('Deploy') {\n            steps {\n                # \u4f7f\u7528\u5185\u8054shell conditional\uff08sh 'make || true'\uff09\u786e\u4fdd\u8be5 sh\u6b65\u9aa4\u59cb\u7ec8\u770b\u5230\u96f6\u9000\u51fa\u4ee3\u7801\uff0c\u4ece\u800c\u4f7f\u8be5junit\u6b65\u9aa4\u6709\u673a\u4f1a\u6355\u83b7\u548c\u5904\u7406\u6d4b\u8bd5\u62a5\u544a\u3002\u4e0b\u9762\u7684\u201c \u5904\u7406\u6545\u969c\u201d\u90e8\u5206\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5176\u4ed6\u65b9\u6cd5\u3002\n                sh 'make check || true' \n                        junit '**/target/*.xml' \n            }\n        }\n    }\n}\n</code></pre>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#13","title":"1.3 \u529f\u80fd","text":"<ul> <li> <p>\u4ee3\u7801\uff1aPipeline\u4ee5\u4ee3\u7801\u7684\u5f62\u5f0f\u5b9e\u73b0\uff0c\u901a\u5e38\u88ab\u68c0\u5165\u6e90\u4ee3\u7801\u63a7\u5236\uff0c\u4f7f\u56e2\u961f\u80fd\u591f\u7f16\u8f91\uff0c\u5ba1\u67e5\u548c\u8fed\u4ee3\u5176\u4f20\u9001\u6d41\u7a0b\u3002</p> </li> <li> <p>\u8010\u7528\uff1aPipeline\u53ef\u4ee5\u5728\u8ba1\u5212\u548c\u8ba1\u5212\u5916\u91cd\u65b0\u542f\u52a8Jenkins\u7ba1\u7406\u65f6\u540c\u65f6\u5b58\u5728\u3002</p> </li> <li> <p>Pausable\uff1aPipeline\u53ef\u4ee5\u9009\u62e9\u505c\u6b62\u5e76\u7b49\u5f85\u4eba\u5de5\u8f93\u5165\u6216\u6279\u51c6\uff0c\u7136\u540e\u518d\u7ee7\u7eedPipeline\u8fd0\u884c\u3002</p> </li> <li> <p>\u591a\u529f\u80fd\uff1aPipeline\u652f\u6301\u590d\u6742\u7684\u73b0\u5b9e\u4e16\u754c\u8fde\u7eed\u4ea4\u4ed8\u8981\u6c42\uff0c\u5305\u62ec\u5e76\u884c\u5206\u53c9/\u8fde\u63a5\uff0c\u5faa\u73af\u548c\u6267\u884c\u5de5\u4f5c\u7684\u80fd\u529b\u3002</p> </li> <li> <p>\u53ef\u6269\u5c55\uff1aPipeline\u63d2\u4ef6\u652f\u6301\u5176DSL\u7684\u81ea\u5b9a\u4e49\u6269\u5c55 \u4ee5\u53ca\u4e0e\u5176\u4ed6\u63d2\u4ef6\u96c6\u6210\u7684\u591a\u4e2a\u9009\u9879\u3002</p> </li> </ul>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#14","title":"1.4 \u8bed\u6cd5\u5b66\u4e60","text":"<ul> <li> <p>\u5185\u7f6e\u8bed\u6cd5</p> </li> <li> <p>localhost\uff1a8080 / pipeline-syntax /</p> </li> <li> <p>\u4ee3\u7801\u751f\u6210\u5668</p> </li> <li> <p>\u5185\u7f6e\u7684\u201cSnippet Generator\u201d\u5b9e\u7528\u7a0b\u5e8f\u6709\u52a9\u4e8e\u4e3a\u5355\u4e2a\u6b65\u9aa4\u521b\u5efa\u4e00\u4e9b\u4ee3\u7801\uff0c\u53d1\u73b0\u63d2\u4ef6\u63d0\u4f9b\u7684\u65b0\u6b65\u9aa4\uff0c\u6216\u4e3a\u7279\u5b9a\u6b65\u9aa4\u5c1d\u8bd5\u4e0d\u540c\u7684\u53c2\u6570\u3002</p> <p>Snippet Generator\u52a8\u6001\u586b\u5145Jenkins\u5b9e\u4f8b\u53ef\u7528\u7684\u6b65\u9aa4\u5217\u8868\u3002\u53ef\u7528\u7684\u6b65\u9aa4\u6570\u91cf\u53d6\u51b3\u4e8e\u5b89\u88c5\u7684\u63d2\u4ef6\uff0c\u5b83\u660e\u786e\u5730\u66b4\u9732\u4e86\u5728Pipeline\u4e2d\u4f7f\u7528\u7684\u6b65\u9aa4\u3002</p> </li> </ul>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#2_1","title":"2 \u8bed\u6cd5","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#3-blueocean","title":"3 BlueOcean","text":""},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#31_1","title":"3.1 \u6982\u5ff5","text":"<p>BlueOcean\u91cd\u65b0\u8003\u8651\u4e86Jenkins\u7684\u7528\u6237\u4f53\u9a8c\u3002BlueOcean\u7531Jenkins Pipeline\u8bbe\u8ba1\uff0c\u4f46\u4ecd\u7136\u517c\u5bb9\u81ea\u7531\u5f0f\u5de5\u4f5c\uff0c\u51cf\u5c11\u4e86\u56e2\u961f\u6210\u5458\u7684\u6df7\u4e71\uff0c\u589e\u52a0\u4e86\u6e05\u6670\u5ea6\u3002</p> <ul> <li>\u8fde\u7eed\u4ea4\u4ed8\uff08CD\uff09Pipeline\u7684\u590d\u6742\u53ef\u89c6\u5316\uff0c\u5141\u8bb8\u5feb\u901f\u548c\u76f4\u89c2\u5730\u4e86\u89e3Pipeline\u7684\u72b6\u6001\u3002</li> <li>Pipeline\u7f16\u8f91\u5668\u901a\u8fc7\u5f15\u5bfc\u7528\u6237\u76f4\u89c2\u548c\u53ef\u89c6\u5316\u7684\u8fc7\u7a0b\u521b\u5efaPipeline\uff0c\u4f7f\u521b\u5efaPipeline\u5e73\u6613\u8fd1\u4eba\u3002</li> <li>\u4e2a\u6027\u5316\uff0c\u4ee5\u9002\u5e94\u56e2\u961f\u6bcf\u4e2a\u6210\u5458\u7684\u89d2\u8272\u9700\u6c42\u3002</li> <li>\u9700\u8981\u5e72\u9884\u548c/\u6216\u51fa\u73b0\u95ee\u9898\u65f6\u786e\u5b9a\u7cbe\u5ea6\u3002BlueOcean\u663e\u793a\u4e86Pipeline\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\uff0c\u4fbf\u4e8e\u5f02\u5e38\u5904\u7406\u548c\u63d0\u9ad8\u751f\u4ea7\u7387\u3002</li> <li>\u7528\u4e8e\u5206\u652f\u548c\u62c9\u53d6\u8bf7\u6c42\u7684\u672c\u5730\u96c6\u6210\u53ef\u4ee5\u5728GitHub\u548cBitbucket\u4e2d\u4e0e\u5176\u4ed6\u4eba\u8fdb\u884c\u4ee3\u7801\u534f\u4f5c\u65f6\u6700\u5927\u9650\u5ea6\u63d0\u9ad8\u5f00\u53d1\u4eba\u5458\u7684\u751f\u4ea7\u529b\u3002</li> </ul>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#32_1","title":"3.2 \u5b89\u88c5","text":"<p>BlueOcean\u53ef\u4ee5\u5b89\u88c5\u5728\u73b0\u6709\u7684Jenkins\u73af\u5883\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528Docker\u8fdb\u884c\u8fd0\u884c \u3002</p> <p>\u8981\u5f00\u59cb\u5728\u73b0\u6709\u7684Jenkins\u73af\u5883\u4e2d\u4f7f\u7528Blue Ocean\u63d2\u4ef6\uff0c\u5b83\u5fc5\u987b\u8fd0\u884cJenkins 2.7.x\u6216\u66f4\u9ad8\u7248\u672c\uff1a</p> <ol> <li>\u767b\u5f55\u5230\u60a8\u7684Jenkins\u670d\u52a1\u5668</li> <li>\u5355\u51fb\u8fb9\u680f\u4e2d\u7684\u7ba1\u7406Jenkins\u7136\u540e\u7ba1\u7406\u63d2\u4ef6</li> <li>\u9009\u62e9\u53ef\u7528\u7684\u9009\u9879\u5361\uff0c\u5e76\u4f7f\u7528\u641c\u7d22\u680f\u67e5\u627eBlueOcean</li> <li>\u5355\u51fb\u201c\u5b89\u88c5\u201d\u5217\u4e2d\u7684\u590d\u9009\u6846</li> <li>\u5355\u51fb\u5b89\u88c5\u800c\u4e0d\u91cd\u65b0\u542f\u52a8\u6216\u7acb\u5373\u4e0b\u8f7d\u5e76\u91cd\u65b0\u542f\u52a8\u540e\u5b89\u88c5</li> </ol> <p></p>"},{"location":"devops/other/Jenkins%E8%AF%A6%E8%A7%A3/#_1","title":"\u53c2\u8003\u94fe\u63a5:","text":"<ul> <li> <p>Grooy\u8bed\u6cd5</p> </li> <li> <p>jenkins\u7b14\u8bb0</p> </li> </ul>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/","title":"Jenkins\u90e8\u7f72Python\u9879\u76ee\u5b9e\u6218","text":""},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#_1","title":"\u4e00\u3001\u80cc\u666f","text":"<p>\u6211\u4eec\u5de5\u4f5c\u4e2d\u5e38\u7528Jenkins\u90e8\u7f72Java\u4ee3\u7801\uff0c\u56e0\u5176\u7075\u6d3b\u7684\u63d2\u4ef6\u7279\u6027\uff0c\u4f8b\u5982jdk\uff0cmaven\uff0cant\u7b49\u4f7f\u5f97java\u9879\u76ee\u7f16\u8bd1\u540e\u4e0a\u7ebf\u90e8\u7f72\u4e00\u6c14\u5475\u6210\uff0c\u540c\u6837\u5bf9\u4e8e\u811a\u672c\u8bed\u8a00\u7c7b\u578b\u5982Python\u4e0a\u7ebf\u90e8\u7f72\uff0c\u5229\u7528Jenkins\u5f3a\u5927\u7684\u63d2\u4ef6\u529f\u80fd\uff0c\u8f7b\u677e\u5b9e\u73b0CI/CD\uff0c\u4f46\u5982\u679c\u90e8\u7f72\u591a\u9879\u76ee\u5230\u540c\u4e00\u53f0\u670d\u52a1\u5668\u6d89\u53ca\u73af\u5883\u4e00\u81f4\u6027\u95ee\u9898\uff0c\u5bf9\u6b64\u53ef\u4ee5\u5229\u7528\u5bb9\u5668\u6280\u672fDocker\u89e3\u51b3\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528Python\u865a\u62df\u73af\u5883\u4f8b\u5982virutalenv\u6216conda\u7b49\u4f18\u79c0\u7b49\u5de5\u5177\u89e3\u51b3\uff0c\u5728\u6b64\u7531\u4e8e\u540e\u671f\u6839\u636erequirements\u6765\u5b89\u88c5\u4f9d\u8d56\u5305\u6bd4\u8f83\u6162\uff0c\u4e14\u540e\u671f\u9700\u8981\u5c06Python\u6574\u4e2a\u73af\u5883\u6253\u5305\uff0c\u5229\u7528conda\u5de5\u5177\u6765\u5bf9\u9879\u76ee\u73af\u5883\u8fdb\u884c\u7ba1\u7406\uff0c\u65b9\u4fbf\u5feb\u901f\u79fb\u690d\u3002 \u672c\u6587\u8f83\u7cfb\u7edf\u7684\u8bb0\u5f55\u4e0b\u90e8\u7f72\u4e00\u4e2a\u5177\u4f53\u7684Django\u9879\u76ee\uff0c\u5305\u62ec\u5229\u7528conda\u5de5\u5177\u6765\u5b9e\u73b0Python\u591a\u73af\u5883\u7ba1\u7406\uff0cPylint\u5de5\u5177\u6765\u5b9e\u73b0\u4ee3\u7801\u68c0\u67e5\uff0c\u4f7f\u7528nose\u6846\u67b6\u505a\u5355\u5143\u6d4b\u8bd5\u548c\u8986\u76d6\u7387\u3002</p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#_2","title":"\u4e8c\u3001\u5fc5\u5907\u77e5\u8bc6","text":"<ul> <li>Jenkins\u57fa\u7840\u5b89\u88c5\u90e8\u7f72</li> </ul> <p>\u53ef\u53c2\u8003\uff1ahttps://blog.51cto.com/kaliarch/2050862 * Conda\u8f6f\u4ef6\u5305\u7ba1\u7406\u7cfb\u7edf</p> <p>\u7531\u4e8econda\u5305\u8f83\u5927\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528Miniconda \u5b98\u7f51\u4e0b\u8f7d\u5730\u5740\uff1ahttps://conda.io/en/latest/miniconda.html \u57fa\u7840\u4f7f\u7528\u547d\u4ee4\uff1a <pre><code>\u4e00\u3001\u5de5\u5177\u5305\u7ba1\u7406\u547d\u4ee4\n1.\u66f4\u65b0\u5de5\u5177\u5305\nconda update conda\nconda upgrade --all\n\n2.\u5b89\u88c5\u5305(\u8fdb\u5165\u865a\u62df\u73af\u5883\uff0c\u4e5f\u53ef\u7528pip\u5b89\u88c5)\nconda install package_name\n\u53ef\u4ee5\u6307\u5b9a\u7248\u672c\nconda install package_name=1.10\n\n3.\u79fb\u9664\u5305\nconda remove package_name\n\n4.\u67e5\u770b\u5305\nconda list\n\n5.\u67e5\u8be2\u5305\nconda search package_name\n\n6.\u6e90\u914d\u7f6e\n\u56e0\u4e3aanaconda\u7684\u670d\u52a1\u5668\u5728\u56fd\u5916\uff0c\u56e0\u6b64\u6709\u65f6\u5019\u901f\u5ea6\u4f1a\u6bd4\u8f83\u6162\uff0c\u53ef\u4ee5\u6362\u5230\u56fd\u5185\u6e90\uff0c\u6bd4\u5982\u6e05\u534e\u7684TUNA\u3002\n\nconda config --show-sources #\u67e5\u770b\u5f53\u524d\u4f7f\u7528\u6e90\nconda config --remove channels \u6e90\u540d\u79f0\u6216\u94fe\u63a5 #\u5220\u9664\u6307\u5b9a\u6e90\nconda config --add channels \u6e90\u540d\u79f0\u6216\u94fe\u63a5 #\u6dfb\u52a0\u6307\u5b9a\u6e90\n\n# \u6dfb\u52a0Anaconda\u7684TUNA\u955c\u50cf\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/\n# TUNA\u7684help\u4e2d\u955c\u50cf\u5730\u5740\u52a0\u6709\u5f15\u53f7\uff0c\u9700\u8981\u53bb\u6389\n\n# \u8bbe\u7f6e\u641c\u7d22\u65f6\u663e\u793a\u901a\u9053\u5730\u5740\nconda config --set show_channel_urls yes\n\n\n\u4e8c\u3001Python\u73af\u5883\u7ba1\u7406\u547d\u4ee4\n1.\u663e\u793a\u521b\u5efa\u7684\u6240\u6709\u73af\u5883\nconda env list\n\n2.\u521b\u5efapython\u73af\u5883\uff1a\nconda create -n env_name list of packages\neg:conda create -n py2 python=2.7 request\n\n3.\u8fdb\u5165python\u73af\u5883\uff1a(windows \u73af\u5883\u4e0d\u9700\u8981\u52a0source)\nsource activate env_name\neg:source activate py2\n\n4.\u9000\u51fa\u73af\u5883\uff1a\nsource deactivate\n\n5.\u67e5\u770b\u67d0\u73af\u5883\u4e0b\u5df2\u5b89\u88c5\u7684\u5305\nconda list -n python2\n\n6.\u590d\u5236\u73af\u5883\uff1a\nconda create --name &lt;new_env_name&gt; --clone &lt;copied_env_name&gt;\n\n7.\u5220\u9664\u73af\u5883\uff1a\nconda remove -n go2cloud-api-env --all\n\n8.\u73af\u5883\u751f\u6210\u4e3aYAML\u6587\u4ef6\n\u5f53\u5206\u4eab\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u540c\u65f6\u4e5f\u9700\u8981\u5c06\u8fd0\u884c\u73af\u5883\u5206\u4eab\u7ed9\u5927\u5bb6\uff0c\u9996\u5148\u8fdb\u5165\u5230\u73af\u5883\u4e2d\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u53ef\u4ee5\u5c06\u5f53\u524d\u73af\u5883\u4e0b\u7684 package \u4fe1\u606f\u5b58\u5165\u540d\u4e3a environment \u7684 YAML \u6587\u4ef6\u4e2d\u3002    \n</code></pre> * conda env export &gt; environment.yaml</p> <p>\u540c\u6837\uff0c\u5f53\u6267\u884c\u4ed6\u4eba\u7684\u4ee3\u7801\u65f6\uff0c\u4e5f\u9700\u8981\u914d\u7f6e\u76f8\u5e94\u7684\u73af\u5883\u3002\u8fd9\u65f6\u4f60\u53ef\u4ee5\u7528\u5bf9\u65b9\u5206\u4eab\u7684 YAML \u6587\u4ef6\u6765\u521b\u5efa\u4e00\u6478\u4e00\u6837\u7684\u8fd0\u884c\u73af\u5883 </p> <p>conda env create -f environment.yaml</p> <p>Shell\u57fa\u7840</p> <p>\u53ef\u53c2\u8003\uff1ahttps://myshell-note.readthedocs.io/en/latest/index.html * GIT\u57fa\u7840</p> <p>\u53ef\u53c2\u8003\uff1ahttps://blog.51cto.com/kaliarch/2049724</p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#_3","title":"\u4e09\u3001\u4f18\u5316","text":"<ul> <li>\u751f\u6210\u4e3b\u9898</li> </ul> <p>\u4e3b\u9898\u5de5\u5177\u751f\u6210\u94fe\u63a5\uff1ahttp://afonsof.com/jenkins-material-theme/ \u5728\u4e3b\u9898\u5de5\u5177\u751f\u6210\u559c\u6b22\u7684\u989c\u8272\u5df2\u7ecf\u4e0a\u4f20logo\u4e0b\u8f7d\u751f\u6210\u7684\u4e3b\u9898\u5230Jenkins\u670d\u52a1\u5668\u7684jenkins \u5bb6\u76ee\u5f55\uff0c\u4e00\u822c\u4e3a\u5b89\u88c5\u542f\u52a8jenkins\u7cfb\u7edf\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u4e0b.jenkins/userContent/material/,\u5982\u679c\u6ca1\u6709\u6b64\u76ee\u5f55\u9700\u8981\u65b0\u5efa\u76ee\u5f55\uff0ccss\u6587\u4ef6\u79fb\u52a8\u5230\u76ee\u5f55\u4e0b\uff0c\u4f8b\u5982/root/.jenkins/userContent/material/blue.css\u3002 * Jenkins\u4e0a\u914d\u7f6e\u4e3b\u9898</p> <p>a.Install\u00a0Jenkins Simple Theme Plugin\u00a0 b.\u70b9\u51fbManage Jenkins\u00a0 c.\u70b9\u51fbConfigure System\u00a0 d.\u627e\u5230 Theme \u914d\u7f6e\u00a0 e.\u586b\u5199\u672c\u5730\u4e3b\u9898cssurl\uff0c\u4f8b\u5982\uff1ahttp://localhost:8080/jenkins/userContent/material/blue.css\u00a0 f.Click\u00a0Save g.\u4fdd\u5b58\u53ef\u67e5\u770b\u6548\u679c\u3002 * \u6ce8\u610f</p> <p>\u672c\u5730css\u7684url\u53ef\u4ee5\u6d4f\u89c8\u5668\u6253\u5f00\u6d4b\u8bd5\u8bbf\u95ee\uff0c\u5982\u679c\u8bbf\u95ee\u4e0d\u5230\u4f1a\u9ed8\u8ba4\u52a0\u8f7dJenkins\u9ed8\u8ba4\u4e3b\u9898 \u540e\u671f\u8fc1\u79fburl\u6700\u597d\u5199\u6210localhost\uff0c\u5982\u679c\u5199\u516c\u7f51IP\uff0ccss\u6587\u4ef6\u4e0d\u5b58\u5728404\uff0cJenkins\u9875\u9762\u4f1a\u5f88\u5361\u3002</p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#_4","title":"\u56db\u3001\u90e8\u7f72\u5b9e\u6218","text":""},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#41","title":"4.1 \u670d\u52a1\u5668\u5217\u8868","text":"\u540d\u79f0 IP \u8f6f\u4ef6 \u5907\u6ce8 Jenkins-server 10.57.61.138 miniconda Jenkins\u670d\u52a1\u5668 Des-server 172.21.0.10 miniconda \u9879\u76ee\u90e8\u7f72\u670d\u52a1\u5668"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#42","title":"4.2 \u67b6\u6784\u56fe","text":""},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#43","title":"4.3 \u524d\u671f\u51c6\u5907","text":"<ol> <li>\u5b89\u88c5\u4f9d\u8d56\u5305</li> <li>pylint: Python\u9759\u6001\u4ee3\u7801\u5ba1\u67e5\u5305\uff0c\u53c2\u8003\uff1ahttp://pylint.pycqa.org/en/latest/user_guide/run.html</li> <li>mock: \u7528\u6765\u751f\u6210\u6d4b\u8bd5\u6570\u636e\u3002</li> <li>nose: Python\u5355\u5143\u6d4b\u8bd5\u5305\u3002</li> <li>coverage: Python\u4ee3\u7801\u8986\u76d6\u7387\u5305\u3002</li> </ol> <p>\u5bf9\u4f9d\u8d56\u5305\u9700\u8981\u5728Jenkins-server\u670d\u52a1\u5668\u8fdb\u884c\u5b89\u88c5\uff0c\u9996\u5148\u6839\u636e\u9879\u76ee\u91cc\u9762conda\u521b\u5efa\u5bf9\u5e94\u9879\u76ee\u5bf9\u865a\u62df\u73af\u5883<code>conda create -n &lt;project_name&gt; python=3.6</code>\uff0c\u521b\u5efa\u5b8c\u6210\u5229\u7528<code>conda env list</code>\u67e5\u770b\u73af\u5883\uff0c\u4e3a\u907f\u514d\u73af\u5883\u6c61\u67d3\uff0c\u5728\u9879\u76ee\u73af\u5883\u5185\u5229\u7528pip\u5de5\u5177\u5b89\u88c5\u8f6f\u4ef6<code>pip install pylint mock nose coverage</code>\u3002 1. \u5b89\u88c5Jenkins\u63d2\u4ef6   * JUnit: \u7528\u6765\u5c55\u793anose\u6846\u67b6\u751f\u6210\u7684\u5355\u5143\u6d4b\u8bd5\u62a5\u8868(Allows JUnit-format test results to be published.)   * Cobertura Plugin\uff1a\u7528\u6765\u5c55\u793aPython\u4ee3\u7801\u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u8868(This plugin integrates\u00a0Cobertura coverage reports\u00a0to Jenkins.)   * Violations plugin\uff1a\u7528\u6765\u5c55\u793aPython\u9759\u6001\u4ee3\u7801\u5ba1\u67e5\u62a5\u8868(This plugin does reports on checkstyle, csslint, pmd, cpd, fxcop, pylint, jcReport, findbugs, and perlcritic violations.)\uff0c\u53c2\u8003\uff1ahttps://wiki.jenkins.io/display/JENKINS/Violations   * Git Plugin\uff1a\u7528\u6765\u4eceGitbucket\u6e90\u4ee3\u7801\u5e93\u62c9\u53d6\u4ee3\u7801(This plugin allows\u00a0GitLab\u00a0to trigger Jenkins builds and display their results in the GitLab UI.)   * Git Parameter\uff1a\u7528\u4e8e\u53c2\u6570\u5316\u6784\u5efa\u9009\u62e9git\u7684branch\uff08Adds ability to choose branches, tags or revisions from git repositories configured in project.\uff09</p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#44","title":"4.4 \u521b\u5efa\u4efb\u52a1","text":"<ul> <li>\u521b\u5efa\u81ea\u7531\u98ce\u683c\u8f6f\u4ef6\u9879\u76ee</li> </ul> <p>New\u4efb\u52a1-&gt;\u6784\u5efa\u4e00\u4e2a\u81ea\u7531\u98ce\u683c\u7684\u8f6f\u4ef6\u9879\u76ee,\u586b\u5199\u63cf\u8ff0\uff0c\u5728\u6b64\u7531\u4e8e\u540e\u671f\u4f1a\u5229\u7528pylint\u8fdb\u884c\u4ee3\u7801\u68c0\u67e5\uff0c\u7ed9\u51fa\u4e86\u4ee3\u7801\u68c0\u67e5\u7684\u6d88\u606f\u7c7b\u578b\uff0c\u53ef\u4ee5\u6839\u636e\u6d88\u606f\u7c7b\u578b\u8fdb\u884c\u76f8\u5e94\u4fee\u590d\u5904\u7406\u3002  * \u914d\u7f6e\u53c2\u6570\u5316\u6784\u5efa</p> <p>\u914d\u7f6e\u9009\u62e9git\u5177\u4f53branch\u8fdb\u884c\u6784\u5efa\uff0c\u548c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u7aef\u53e3\uff0c\u5728\u6b64\u9700\u8981\u6ce8\u610f\u53c2\u6570\u5316\u6784\u5efa\u7684\u53d8\u4e86Name\uff0c\u5728\u540e\u7eed\u9700\u8981\u7528\u5230\u3002  * \u6e90\u7801\u7ba1\u7406</p> <p>\u5728\u6b64\u9700\u8981\u9009\u62e9\u6e90\u7801\u4ed3\u5e93\uff0c\u9009\u62e9gitlab\u5df2\u7ecf\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u9700\u8981\u6ce8\u610f\u7531\u4e8e\u53c2\u6570\u5316\u6784\u5efa\u9009\u62e9\u4e86branch\uff0c\u5728Branches to build\u9700\u8981\u5f15\u7528\u4e0a\u9762\u7684\u53d8\u91cf$branch\u3002  * \u6784\u5efa\u914d\u7f6e   * \u6267\u884cshell</p> <p>\u6267\u884cshell\u6b64shell\u4e3a\u5728Jenkins\u670d\u52a1\u5668\u4e0a\u6267\u884c\uff0c\u6240\u4ee5\u9700\u8981\u9884\u5148\u5728\u5176\u4e0a\u914d\u7f6ePython\u865a\u62df\u73af\u5883\uff0c\u5728\u5176\u4e0a\u8fdb\u884c\u4ee3\u7801\u5ba1\u67e5\uff0c\u5355\u5143\u6d4b\u8bd5\u751f\u6210nosetests.xml\u6587\u4ef6\uff0c\u5df2\u7ecf\u4ee3\u7801\u8986\u76d6\u7387\u6d4b\u8bd5\u751f\u6210coverage.xml\u6587\u4ef6\uff0cpylint\u6d4b\u8bd5\u751f\u6210pylint.xml\u6587\u4ef6\u3002 </p> <p>\u4ee5\u4e0b\u4e3a\u6b64\u9879\u76ee\u793a\u4f8bshell\u811a\u672c\uff0c\u6b64\u811a\u672c\u9700\u8981\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u6765\u4fee\u6539\uff0c\u9700\u8981\u6ce8\u610fPython\u9879\u76ee\u7ed3\u6784\u4e0e\u9700\u8981\u4ee3\u7801\u68c0\u67e5\u7684\u6807\u8bc6\u7b26\u3002 <pre><code>base_dir=/root/.jenkins/workspace/\nproject=go2cloud-api-deploy-prod/\nproject_env=go2cloud-api-env\n# \u5207\u6362python\u73af\u5883\nsource activate ${project_env}\n$(which python) -m pip install mock nose coverage\n# \u66f4\u65b0python\u73af\u5883\necho \"+++\u66f4\u65b0Python\u73af\u5883+++\"\n\nif [ -f ${base_dir}${project}requirements.txt ];then\n\u00a0 \u00a0 $(which python) -m pip install -r ${base_dir}${project}requirements.txt &amp;&amp; echo 0 || echo 0\nfi\n\n# \u4ee3\u7801\u68c0\u67e5/\u5355\u5143\u6d4b\u8bd5/\u4ee3\u7801\u6d4b\u8bd5\u8986\u76d6\u7387\necho \"+++\u4ee3\u7801\u68c0\u67e5+++\"\ncd ${base_dir}\n# \u751f\u6210pylint.xml\n$(which pylint) -f parseable --disable=C0103,E0401,C0302 $(find ${project}/* -name *.py) &gt;${base_dir}pylint.xml || echo 0\n\necho \"+++\u5355\u5143\u6d4b\u8bd5+++\"\n# \u751f\u6210nosetests.xml\n#$(which nosetests) --with-xunit --all-modules --traverse-namespace --with-coverage --cover-package=go2cloud-api-deploy-prod --cover-inclusive || echo 0\n$(which nosetests) --with-xunit --all-modules --traverse-namespace --with-coverage --py3where=go2cloud-api-deploy-prod --cover-package=go2cloud-api-deploy-prod --cover-inclusive || echo 0\necho \"+++\u4ee3\u7801\u8986\u76d6\u7387+++\"\n# \u751f\u6210coverage.xml\n</code></pre> python -m coverage xml --include=go2cloud-api-deploy-prod* || echo 0</p> <ul> <li>\u53d1\u9001\u6587\u4ef6\u53ca\u547d\u4ee4\u5230\u76ee\u6807\u670d\u52a1\u5668</li> </ul> <p> \u5728\u6b64\u9700\u8981\u5236\u5b9a\u53d1\u5e03\u5230\u76ee\u6807\u5230\u7684\u670d\u52a1\u5668\u8fdc\u7aef\u76ee\u5f55\uff0c\u5df2\u7ecf\u6267\u884c\u7684\u547d\u4ee4\uff0c\u5728\u6b64\u6267\u884c\u91cd\u542f\u811a\u672c\u3002 \u7531\u4e8e\u5728\u6b64\u9879\u76ee\u4e3aDjango\u9879\u76ee\uff0c\u9700\u8981\u5236\u5b9a\u865a\u62df\u73af\u5883/\u5165\u53e3\u542f\u52a8\u6587\u4ef6/\u542f\u52a8\u7aef\u53e3\u3002 \u5c06\u4e4b\u524d\u53c2\u6570\u5316\u6784\u5efa\u7684\u7aef\u53e3\u5f53\u4f5c\u53d8\u91cf\u4f20\u9012\u7ed9\u811a\u672c\uff0c\u542f\u52a8\u76f8\u5e94\u7684\u7aef\u53e3 <pre><code>#!/usr/bin/env bash\n\n# \u5f53\u524d\u76ee\u5f55\nBASEPATH=$(cd `dirname $0`;pwd)\n\n# python\u89e3\u91ca\u5668\u5177\u4f53\u8def\u5f84\nPYTHON_BIN=$1\n\n# mananger\u6587\u4ef6\u8def\u5f84\nMAIN_APP=$2\n\n# python\nSERVER_PORT=$3\n\n[ $# -lt 3 ] &amp;&amp; echo \"\u7f3a\u5c11\u53c2\u6570\" &amp;&amp; exit 1\n\nLOG_DIR=${BASEPATH}/logs/\n[ ! -d ${LOG_DIR} ] &amp;&amp; mkdir ${LOG_DIR}\n\nOLD_PID=`netstat -lntup | awk -v SERVER_PORT=${SERVER_PORT} '{if($4==\"0.0.0.0:\"SERVER_PORT) print $NF}'|cut -d/ -f1`\n[ -n \"${OLD_PID}\" ] &amp;&amp; kill -9 ${OLD_PID}\n\necho \"---------$0 $(date) excute----------\" &gt;&gt; ${LOG_DIR}server-$(date +%F).log\n\n# \u542f\u52a8\u670d\u52a1\n</code></pre> nohup ${PYTHON_BIN} -u \\({MAIN_APP} runserver 0.0.0.0:\\) &amp;&gt;&gt; \\({LOG_DIR}server-\\)(date +%F).log 2&gt;&amp;1 &amp;</p> <ul> <li>\u6784\u5efa\u540e\u52a8\u4f5c</li> <li>JUnit\u63d2\u4ef6\u5b9e\u73b0\u5355\u5143\u6d4b\u8bd5\u62a5\u544a\uff0c\u9700\u8981\u6307\u5b9anosetests.xml</li> </ul> <p>   * Cobertura Plugin\u63d2\u4ef6\u5b9e\u73b0\u8986\u76d6\u7387\u6d4b\u8bd5</p> <p>   * Violations\u63d2\u4ef6\u8fdb\u884c\u4ee3\u7801\u5ba1\u8ba1\uff0c\u9700\u8981\u5236\u5b9aJenkins-server\u4e0a\u7684\u751f\u6210\u7684pylint.xml\u6587\u4ef6\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u6587\u4ef6\u8def\u5f84\u4e3ajenkins\u670d\u52a1\u5668pylint.xml\uff0c\u4ee5\u53ca\u5bf9\u5e94\u751f\u6210\u6587\u4ef6\u7684\u7f16\u7801\u3002  </p> <ul> <li>\u90ae\u4ef6\u901a\u77e5\u914d\u7f6e</li> </ul> <p>\u9009\u62e9\u90ae\u4ef6\u5185\u5bb9\u4e3aContent Type\u4e3aHTML\uff0c\u8fd9\u6837\u53ef\u4ee5\u7f16\u5199\u90ae\u4ef6HTML\u6a21\u7248\uff0c\u751f\u6210\u8f83\u4e3a\u597d\u770b\u7684\u90ae\u4ef6\u901a\u77e5\u6a21\u7248\u3002 \u6ce8\u610f\u9009\u62e9\u89e6\u53d1\u544a\u8b66\u53ef\u4ee5\u9009\u62e9\u7c7b\u578b\uff0c\u5931\u8d25\u51e0\u6b21\u6216\u65e0\u8bba\u6784\u5efa\u6210\u529f\u5931\u8d25\u90fd\u53d1\u9001\uff0c\u53ef\u6839\u636e\u5177\u4f53\u9700\u6c42\u914d\u7f6e\u3002   \u90ae\u4ef6HTML\u6a21\u7248 <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta charset=\"UTF-8\"&gt;\n&lt;title&gt;${ENV, var=\"JOB_NAME\"}-\u7b2c${BUILD_NUMBER}\u6b21\u6784\u5efa\u65e5\u5fd7&lt;/title&gt;\n&lt;/head&gt;\n\n&lt;body leftmargin=\"8\" marginwidth=\"0\" topmargin=\"8\" marginheight=\"4\"\n\u00a0 \u00a0 offset=\"0\"&gt;\n\u00a0 \u00a0 &lt;table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\"\n\u00a0 \u00a0 \u00a0 \u00a0 style=\"font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif\"&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;(\u672c\u90ae\u4ef6\u662f\u7a0b\u5e8f\u81ea\u52a8\u4e0b\u53d1\u7684\uff0c\u8bf7\u52ff\u56de\u590d\uff01)&lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;&lt;h2&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;font color=\"#0000FF\"&gt;\u6784\u5efa\u7ed3\u679c - ${BUILD_STATUS}&lt;/font&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;/h2&gt;&lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;&lt;br /&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;b&gt;&lt;font color=\"#0B610B\"&gt;\u6784\u5efa\u4fe1\u606f&lt;/font&gt;&lt;/b&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;hr size=\"2\" width=\"100%\" align=\"center\" /&gt;&lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;ul&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;li&gt;\u9879\u76ee\u540d\u79f0&amp;nbsp;\uff1a&amp;nbsp;${PROJECT_NAME}&lt;/li&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;li&gt;\u6784\u5efa\u7f16\u53f7&amp;nbsp;\uff1a&amp;nbsp;\u7b2c${BUILD_NUMBER}\u6b21\u6784\u5efa&lt;/li&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;li&gt;SVN&amp;nbsp;\u7248\u672c\uff1a&amp;nbsp;${SVN_REVISION}&lt;/li&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;li&gt;\u89e6\u53d1\u539f\u56e0\uff1a&amp;nbsp;${CAUSE}&lt;/li&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;li&gt;\u6784\u5efa\u65e5\u5fd7\uff1a&amp;nbsp;&lt;a href=\"${BUILD_URL}console\"&gt;${BUILD_URL}console&lt;/a&gt;&lt;/li&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;li&gt;\u6784\u5efa&amp;nbsp;&amp;nbsp;Url&amp;nbsp;\uff1a&amp;nbsp;&lt;a href=\"${BUILD_URL}\"&gt;${BUILD_URL}&lt;/a&gt;&lt;/li&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;li&gt;\u5de5\u4f5c\u76ee\u5f55&amp;nbsp;\uff1a&amp;nbsp;&lt;a href=\"${PROJECT_URL}ws\"&gt;${PROJECT_URL}ws&lt;/a&gt;&lt;/li&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;li&gt;\u9879\u76ee&amp;nbsp;&amp;nbsp;Url&amp;nbsp;\uff1a&amp;nbsp;&lt;a href=\"${PROJECT_URL}\"&gt;${PROJECT_URL}&lt;/a&gt;&lt;/li&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;/ul&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;&lt;b&gt;&lt;font color=\"#0B610B\"&gt;Changes Since Last\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Successful Build:&lt;/font&gt;&lt;/b&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;hr size=\"2\" width=\"100%\" align=\"center\" /&gt;&lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;ul&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;li&gt;\u5386\u53f2\u53d8\u66f4\u8bb0\u5f55 : &lt;a href=\"${PROJECT_URL}changes\"&gt;${PROJECT_URL}changes&lt;/a&gt;&lt;/li&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;/ul&gt; ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format=\"Changes for Build #%n:&lt;br /&gt;%c&lt;br /&gt;\",showPaths=true,changesFormat=\"&lt;pre&gt;[%a]&lt;br /&gt;%m&lt;/pre&gt;\",pathFormat=\"&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;%p\"}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;&lt;b&gt;Failed Test Results&lt;/b&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;hr size=\"2\" width=\"100%\" align=\"center\" /&gt;&lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;&lt;pre\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 style=\"font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif\"&gt;$FAILED_TESTS&lt;/pre&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;br /&gt;&lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;&lt;b&gt;&lt;font color=\"#0B610B\"&gt;\u6784\u5efa\u65e5\u5fd7 (\u6700\u540e 100\u884c):&lt;/font&gt;&lt;/b&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;hr size=\"2\" width=\"100%\" align=\"center\" /&gt;&lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;!-- &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;Test Logs (if test has ran): &lt;a\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 href=\"${PROJECT_URL}ws/TestResult/archive_logs/Log-Build-${BUILD_NUMBER}.zip\"&gt;${PROJECT_URL}/ws/TestResult/archive_logs/Log-Build-${BUILD_NUMBER}.zip&lt;/a&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;br /&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;br /&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt; --&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;tr&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;td&gt;&lt;textarea cols=\"80\" rows=\"30\" readonly=\"readonly\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 style=\"font-family: Courier New\"&gt;${BUILD_LOG, maxLines=100}&lt;/textarea&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &lt;/td&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 &lt;/tr&gt;\n\u00a0 \u00a0 &lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre></p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#45","title":"4.5 \u8fdb\u884c\u6784\u5efa\u6d4b\u8bd5","text":"<ul> <li>\u89e6\u53d1\u6784\u5efa</li> </ul> <p>\u9009\u62e9\u5bf9\u5e94\u7684branch\u4e0e\u7aef\u53e3  * \u67e5\u770bconsle log   * pylint\u68c0\u67e5</p> <p>   * nosetests\u5355\u5143\u6d4b\u8bd5\u53ca\u4ee3\u7801\u8986\u76d6\u7387</p> <p>    * \u76ee\u6807\u670d\u52a1\u5668\u67e5\u770b\u5177\u4f53\u9879\u76ee</p> <p></p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#46","title":"4.6 \u67e5\u770b\u6784\u7ed3\u679c","text":"<ul> <li>\u603b\u89c8\u67e5\u770b</li> </ul> <p> * \u67e5\u770b\u4ee3\u7801\u8986\u76d6\u7387</p> <p> \u67e5\u770b\u5177\u4f53\u4e0d\u5408\u89c4\u4ee3\u7801 \u5728\u6e90\u4ee3\u7801\u5206\u6790\u7ed3\u675f\u540e\u9762\uff0c\u4f1a\u6709\u4e00\u7cfb\u5217\u7684\u62a5\u544a\uff0c\u6bcf\u4e2a\u62a5\u544a\u5173\u6ce8\u4e8e\u9879\u76ee\u7684\u67d0\u4e9b\u65b9\u9762\uff0c\u5982\u6bcf\u79cd\u7c7b\u522b\u7684 message \u7684\u6570\u76ee\uff0c\u6a21\u5757\u7684\u4f9d\u8d56\u5173\u7cfb\u7b49\u7b49\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u62a5\u544a\u4e2d\u4f1a\u5305\u542b\u5982\u4e0b\u7684\u65b9\u9762\uff1a MESSAGE_TYPE \u6709\u5982\u4e0b\u51e0\u79cd\uff1a <pre><code>(C) convention\u00a0\u60ef\u4f8b\u3002\u8fdd\u53cd\u4e86\u7f16\u7801\u98ce\u683c\u6807\u51c6\n(R) refactor\u00a0\u91cd\u6784\u3002\u5199\u5f97\u975e\u5e38\u7cdf\u7cd5\u7684\u4ee3\u7801\u3002\n(W)\u00a0warning \u8b66\u544a\u3002\u67d0\u4e9b Python \u7279\u5b9a\u7684\u95ee\u9898\u3002\n(E) error\u00a0\u9519\u8bef\u3002\u5f88\u53ef\u80fd\u662f\u4ee3\u7801\u4e2d\u7684\u9519\u8bef\u3002\n(F) fatal \u81f4\u547d\u9519\u8bef\u3002\u963b\u6b62 Pylint \u8fdb\u4e00\u6b65\u8fd0\u884c\u7684\u9519\u8bef\u3002\n</code></pre>  * \u67e5\u770b\u90ae\u4ef6</p> <p></p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#_5","title":"\u4e94\u3001\u6d41\u6c34\u7ebf\u90e8\u7f72","text":""},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#51-pipeline","title":"5.1 pipeline\u57fa\u7840\u6982\u5ff5","text":"<ul> <li>pipeline\u662f\u4ec0\u4e48</li> </ul> <p>pipeline\u4e3a\u8fd0\u884c\u4e8eJenkins\u4e0a\u7684\u5de5\u4f5c\u6d41\u6846\u67b6\uff0cproject\u4e2d\u7684\u914d\u7f6e\u4fe1\u606f\u4ee5steps\u7684\u65b9\u5f0f\u653e\u5728\u4e00\u4e2a\u811a\u672c\u91cc\u5c06\u539f\u672c\u72ec\u7acb\u8fd0\u884c\u4e8e\u5355\u4e2a\u6216\u8005\u591a\u4e2a\u8282\u70b9\u7684\u4efb\u52a1\u8fde\u63a5\u8d77\u6765\uff0c\u5b9e\u73b0\u5355\u4e2a\u4efb\u52a1\u96be\u4ee5\u5b8c\u6210\u7684\u590d\u6742\u6d41\u7a0b\u7f16\u6392\u4e0e\u53ef\u89c6\u5316\u3002 * \u57fa\u7840\u6982\u5ff5   * Stage: \u9636\u6bb5\uff1a\u544a\u8bc9Jenkins\u505a\u4ec0\u4e48\uff0c\u4e00\u4e2aPipeline\u53ef\u4ee5\u5212\u5206\u4e3a\u82e5\u5e72\u4e2aStage\uff0c\u6bcf\u4e2aStage\u4ee3\u8868\u4e00\u7ec4\u64cd\u4f5c\u3002\u6ce8\u610f\uff0cStage\u662f\u4e00\u4e2a\u903b\u8f91\u5206\u7ec4\u7684\u6982\u5ff5\uff0c\u53ef\u4ee5\u8de8\u591a\u4e2aNode\u3002   * Node: \u8282\u70b9\uff1a\u544a\u8bc9Jenkins\u5728job\u5728\u54ea\u8fd0\u884c\u4e00\u4e2aNode\u5c31\u662f\u4e00\u4e2aJenkins\u8282\u70b9\uff0c\u6216\u8005\u662fMaster\uff0c\u6216\u8005\u662fslave\uff0c\u662f\u6267\u884cStep\u7684\u5177\u4f53\u8fd0\u884c\u671f\u73af\u5883\u3002   * Step: \u6b65\u9aa4\uff1a\u5177\u4f53\u7ec6\u5316\u5230\u6bcf\u4e00\u6b65\u6784\u5efa\u64cd\u4f5c\uff0cStep\u662f\u6700\u57fa\u672c\u7684\u64cd\u4f5c\u5355\u5143\uff0c\u5c0f\u5230\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u5927\u5230\u6784\u5efa\u4e00\u4e2aDocker\u955c\u50cf\uff0c\u7531\u5404\u7c7bJenkins Plugin\u63d0\u4f9b\u3002 * \u8bed\u53d1\u5de5\u5177</p> <p>Pipeline\u63d0\u4f9b\u4e86\u4e00\u7ec4\u53ef\u6269\u5c55\u7684\u5de5\u5177\uff0c\u901a\u8fc7Pipeline Domain Specific Language\uff08DSL\uff09syntax\u53ef\u4ee5\u8fbe\u5230Pipeline as Code\uff08Jenkinsfile\u5b58\u50a8\u5728\u9879\u76ee\u7684\u6e90\u4ee3\u7801\u5e93\uff09\u7684\u76ee\u7684\u3002</p> <p>\u53c2\u8003\uff1ahttps://wiki.jenkins.io/display/JENKINS/Pipeline+Plugin</p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#52-pipeline","title":"5.2 pipeline\u7684\u7279\u6027","text":"<p>\u57fa\u4e8e Jenkins Pipeline\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u4e00\u4e2a JenkinsFile \u4e2d\u5feb\u901f\u5b9e\u73b0\u4e00\u4e2a\u9879\u76ee\u7684\u4ece\u6784\u5efa\u3001\u6d4b\u8bd5\u4ee5\u5230\u53d1\u5e03\u7684\u5b8c\u6574\u6d41\u7a0b\uff0c\u5e76\u4e14\u53ef\u4ee5\u4fdd\u5b58\u8fd9\u4e2a\u6d41\u6c34\u7ebf\u7684\u5b9a\u4e49\u3002 * \u4ee3\u7801:Pipeline\u4ee5\u4ee3\u7801\u7684\u5f62\u5f0f\u5b9e\u73b0\uff0c\u901a\u5e38\u88ab\u68c0\u5165\u6e90\u4ee3\u7801\u63a7\u5236\uff0c\u4f7f\u56e2\u961f\u80fd\u591f\u7f16\u8f91\u3001\u5ba1\u67e5\u548c\u8fed\u4ee3\u5176CD\u6d41\u7a0b\u3002 * \u53ef\u6301\u7eed\u6027\uff1aJenklins\u91cd\u542f\u6216\u8005\u4e2d\u65ad\u540e\u90fd\u4e0d\u4f1a\u5f71\u54cdPipeline Job\u3002 * \u505c\u987f\uff1aPipeline\u53ef\u4ee5\u9009\u62e9\u505c\u6b62\u5e76\u7b49\u5f85\u4efb\u5de5\u8f93\u5165\u6216\u6279\u51c6\uff0c\u7136\u540e\u518d\u7ee7\u7eedPipeline\u8fd0\u884c\u3002 * \u591a\u529f\u80fd\uff1aPipeline\u652f\u6301\u73b0\u5b9e\u4e16\u754c\u7684\u590d\u6742CD\u8981\u6c42\uff0c\u5305\u62ecfork/join\u5b50\u8fdb\u7a0b\uff0c\u5faa\u73af\u548c\u5e76\u884c\u6267\u884c\u5de5\u4f5c\u7684\u80fd\u529b * \u53ef\u6269\u5c55\uff1aPipeline\u63d2\u4ef6\u652f\u6301\u5176DSL\u7684\u81ea\u5b9a\u4e49\u6269\u5c55\u4ee5\u53ca\u4e0e\u5176\u4ed6\u63d2\u4ef6\u96c6\u6210\u7684\u591a\u4e2a\u9009\u9879\u3002</p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#53-pipeline","title":"5.3 pipeline\u8bed\u6cd5","text":"<ul> <li>\u58f0\u660e\u5f0f <pre><code>pipeline {\n/* insert Declarative Pipeline here */\n}\n</code></pre> \u5728\u58f0\u660e\u5f0f\u6d41\u6c34\u7ebf\u4e2d\u6709\u6548\u7684\u57fa\u672c\u8bed\u53e5\u548c\u8868\u8fbe\u5f0f\u9075\u5faa\u4e0e\u00a0Groovy\u7684\u8bed\u6cd5\u540c\u6837\u7684\u89c4\u5219\uff0c \u6709\u4ee5\u4e0b\u4f8b\u5916:</li> <li>\u6d41\u6c34\u7ebf\u9876\u5c42\u5fc5\u987b\u662f\u4e00\u4e2a\u00a0block, \u7279\u522b\u5730:\u00a0pipeline { }</li> <li>\u6ca1\u6709\u5206\u53f7\u4f5c\u4e3a\u8bed\u53e5\u5206\u9694\u7b26\uff0c\uff0c\u6bcf\u6761\u8bed\u53e5\u90fd\u5fc5\u987b\u5728\u81ea\u5df1\u7684\u884c\u4e0a\u3002</li> <li>\u5757\u53ea\u80fd\u7531\u00a0\u8282\u6bb5,\u00a0\u6307\u4ee4,\u00a0\u6b65\u9aa4, \u6216\u8d4b\u503c\u8bed\u53e5\u7ec4\u6210\u3002 *\u5c5e\u6027\u5f15\u7528\u8bed\u53e5\u88ab\u89c6\u4e3a\u65e0\u53c2\u65b9\u6cd5\u8c03\u7528\u3002 \u4f8b\u5982, input\u88ab\u89c6\u4e3a input()</li> </ul> <p>\u793a\u4f8b\uff1a <pre><code>Jenkinsfile (Declarative Pipeline)\npipeline {\n    agent none \n    stages {\n        stage('Example Build') {\n            agent { docker 'maven:3-alpine' } \n            steps {\n                echo 'Hello, Maven'\n                sh 'mvn --version'\n            }\n        }\n        stage('Example Test') {\n            agent { docker 'openjdk:8-jre' } \n            steps {\n                echo 'Hello, JDK'\n                sh 'java -version'\n            }\n        }\n    }\n}\n</code></pre> \u8be6\u7ec6\u5b66\u4e60\u53ef\u53c2\u8003\uff1ahttps://jenkins.io/zh/doc/book/pipeline/syntax/ * \u811a\u672c\u5f0f</p> <p>\u811a\u672c\u5316\u6d41\u6c34\u7ebf, \u4e0e[declarative-pipeline]\u4e00\u6837\u7684\u662f, \u662f\u5efa\u7acb\u5728\u5e95\u5c42\u6d41\u6c34\u7ebf\u7684\u5b50\u7cfb\u7edf\u4e0a\u7684\u4e0e\u58f0\u660e\u5f0f\u4e0d\u540c\u7684\u662f, \u811a\u672c\u5316\u6d41\u6c34\u7ebf\u5b9e\u9645\u4e0a\u662f\u7531\u00a0Groovy\u6784\u5efa\u7684\u901a\u7528 DSL\u00a0[2]\u3002 Groovy \u8bed\u8a00\u63d0\u4f9b\u7684\u5927\u90e8\u5206\u529f\u80fd\u90fd\u53ef\u4ee5\u7528\u4e8e\u811a\u672c\u5316\u6d41\u6c34\u7ebf\u7684\u7528\u6237\u3002\u8fd9\u610f\u5473\u7740\u5b83\u662f\u4e00\u4e2a\u975e\u5e38\u6709\u8868\u73b0\u529b\u548c\u7075\u6d3b\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b83\u7f16\u5199\u6301\u7eed\u4ea4\u4ed8\u6d41\u6c34\u7ebf\u3002</p> <p>\u793a\u4f8b\uff1a <pre><code>node('master') {\u00a0 \u00a0 \u00a0//master\u8282\u70b9\u8fd0\u884c\uff0c\u4ee5\u4e0bstage\u4e5f\u53ef\u6307\u5b9a\u8282\u70b9\n\u00a0 \u00a0 stage 'Prepare'\u00a0 //\u6e05\u7a7a\u53d1\u5e03\u76ee\u5f55\n\u00a0 \u00a0 \u00a0 \u00a0 bat '''if exist D:\\\\publish\\\\LoginServiceCore (rd/s/q D:\\\\publish\\\\LoginServiceCore)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if exist C:\\\\Users\\\\Administrator\\\\.nuget (rd/s/q C:\\\\Users\\\\Administrator\\\\.nuget)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0exit'''\n\n\u00a0 \u00a0 //\u62c9\u53d6git\u4ee3\u7801\u4ed3\u5e93\n\u00a0 \u00a0 stage 'Checkout'\n\u00a0 \u00a0 \u00a0 \u00a0 checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [],\u00a0\n\u3000\u3000\u3000\u3000\u3000\u3000\u3000submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'c6d98bbd-5cfb-4e26-aa56-f70b054b350d',\u00a0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 url: 'http://xxx/xxx/xxx']]])\n\u00a0 \u00a0\n\u00a0 \u00a0 //\u6784\u5efa\n\u00a0 \u00a0 stage 'Build'\n\u00a0 \u00a0 \u00a0 \u00a0 bat '''cd \"D:\\\\Program Files (x86)\\\\Jenkins\\\\workspace\\\\LoginServiceCore\\\\LoginApi.Hosting.Web\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 dotnet restore\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 dotnet build\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 dotnet publish --configuration Release --output D:\\\\publish\\\\LoginServiceCore'''\n\u00a0 \u00a0\u00a0\n\u00a0 \u00a0 //\u90e8\u7f72\n\u00a0 \u00a0 stage 'Deploy'\n\u00a0 \u00a0 \u00a0 \u00a0 bat '''\n\u00a0 \u00a0 \u00a0 \u00a0 cd D:\\\\PipelineScript\\\\LoginServiceCore\n\u00a0 \u00a0 \u00a0 \u00a0 python LoginServiceCore.py\n\u00a0 \u00a0 \u00a0 \u00a0 '''\n\n\u00a0 \u00a0 //\u81ea\u52a8\u5316\u6d4b\u8bd5\uff08python\u4ee3\u7801\u5b9e\u73b0\uff09\u00a0 \u00a0\u00a0\n\u00a0 \u00a0 stage 'Test'\n\u00a0 \u00a0 \u00a0 \u00a0 bat'''\n\u00a0 \u00a0 \u00a0 \u00a0 cd D:\\\\PipelineScript\\\\LoginServiceCore\n\u00a0 \u00a0 \u00a0 \u00a0 python LoginServiceCoreApitest.py\n\u00a0 \u00a0 \u00a0 \u00a0 '''\u00a0 \u00a0\n}\n</code></pre></p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#54","title":"5.4 \u793a\u4f8b","text":"<p>\u5728\u6b64\u5c06\u4e0a\u9762\u7684\u9879\u76ee\u5229\u7528pipeline\u8fdb\u884c\u53d1\u5e03 * \u521b\u5efa\u81ea\u7531\u98ce\u683c\u8f6f\u4ef6\u9879\u76ee</p> <p>New\u4efb\u52a1-&gt;\u6d41\u6c34\u7ebf\uff0c\u586b\u5199\u4efb\u52a1\u63cf\u8ff0\u3002 </p> <p></p> <ul> <li>Pipeline</li> </ul> <p>\u5982\u679c\u5bf9Pipeline\u8bed\u6cd5\u4e0d\u719f\u6089\uff0c\u53ef\u4ee5\u5229\u7528\u5de5\u5177\u751f\u6210  \u5728\u6b64\u7684pipeline <pre><code>pipeline {\n\u00a0 agent any\n\u00a0 parameters {\n\u00a0 \u00a0 gitParameter branchFilter: 'origin/(.*)', defaultValue: 'master', name: 'BRANCH', type: 'PT_BRANCH'\n\u00a0 }\n\u00a0 stages {\n\u00a0 \u00a0 stage('checkout src code') {\n\u00a0 \u00a0 \u00a0 \u00a0 steps {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 echo \"checkout src code\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 git branch: \"${params.BRANCH}\",'http://123.206.xxx.xxx/xuel/go2cloud_platform.git'\n\u00a0 \u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 }\n\u00a0 \u00a0 stage('exec shell'){\n\u00a0 \u00a0 \u00a0 \u00a0 steps{\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 echo \"pylint,Unit test\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 sh '''# jenkins \u670d\u52a1\u5668\u9879\u76eeworkspace\u76ee\u5f55\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 base_dir=/root/.jenkins/workspace/\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u9879\u76ee\u540d\u79f0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 project=go2cloud_platform\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u9879\u76ee\u73af\u5883python\u73af\u5883\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 project_env=go2cloud_platform_pipeline\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u5207\u6362python\u73af\u5883\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 source /data/miniconda3/bin/activate ${project_env}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 $(which python) -m pip install mock nose coverage pylint\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u66f4\u65b0python\u73af\u5883\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 echo \"++++++\u66f4\u65b0Python\u73af\u5883+++\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if [ -f ${base_dir}${project}requirements/requirements.txt ];then\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 $(which python) -m pip install -r ${base_dir}${project}/requirements/requirements.txt &amp;&amp; echo 0 || echo 0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 fi\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u4ee3\u7801\u68c0\u67e5/\u5355\u5143\u6d4b\u8bd5/\u4ee3\u7801\u6d4b\u8bd5\u8986\u76d6\u7387\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 echo \"++\u4ee3\u7801\u68c0\u67e5++\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cd ${base_dir}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u751f\u6210pylint.xml\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 $(which pylint) -f parseable --disable=C0103,E0401,C0302 $(find ${project}/* -name *.py) &gt;${base_dir}${project}_pylint.xml || echo 0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 echo \"++\u5355\u5143\u6d4b\u8bd5++\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u751f\u6210nosetests.xml\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 #$(which nosetests) --with-xunit --all-modules --traverse-namespace --with-coverage --cover-package=go2cloud-api-deploy-prod --cover-inclusive || echo 0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 $(which nosetests) --with-xunit --all-modules --traverse-namespace --with-coverage --py3where=${project} --cover-package=${project} --cover-inclusive || echo 0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 echo \"++\u4ee3\u7801\u8986\u76d6\u7387+++\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u751f\u6210coverage.xml\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 python -m coverage xml --include=${project_env}* || echo 0'''\n\n\u00a0 \u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 }\n\u00a0 \u00a0 stage(\"deploy\") {\n\u00a0 \u00a0 \u00a0 \u00a0 steps {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 echo \"send file\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 sshPublisher(publishers: [sshPublisherDesc(configName: 'go2cloud_platform_host', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: '''base_dir=/devops_pipeline\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 project_src=go2cloud_platform\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 project_env=/data/miniconda3/envs/go2cloud_platform_pipeline/bin/python\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 echo \"+++++++\u66f4\u65b0\u90e8\u7f72\u670d\u52a1\u5668python\u73af\u5883++++++++++\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if [ -f ${base_dir}/requirements/requirements.txt ];then\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ${project_env} -m pip install -r ${base_dir}/requirements/requirements.txt &amp;&amp; echo 0 || echo 0\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 fi\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 echo -e \"\\\\033[32m \u542f\u52a8\u670d\u52a1\u811a\u672c \\\\033[0m\"\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 $(which bash) ${base_dir}/run_server.sh ${project_env} ${base_dir}/apps/manage.py ${port}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ''', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: '/devops_pipeline', remoteDirectorySDF: false, removePrefix: '', sourceFiles: '**/**')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 }\n}\n</code></pre> * \u8fd0\u884c\u6784\u5efa</p> <p> * \u67e5\u770b\u7ed3\u679c</p> <p> </p>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#_6","title":"\u4e94\u3001\u6ce8\u610f\u8981\u70b9","text":"<ul> <li>\u5728\u90e8\u7f72\u524d\u4e00\u5b9a\u68b3\u7406\u597d\u6d41\u7a0b\uff0c\u9700\u8981\u7406\u89e3\u54ea\u4e00\u6b65\u5728\u76ee\u6807\u670d\u52a1\u5668\u8fd8\u4e0a\u5728Jenkins\u670d\u52a1\u5668\u4e0a\u6267\u884c</li> <li>\u9700\u8981\u5bf9\u5e94\u597d\u76ee\u5f55\u53caPython\u865a\u62df\u73af\u5883\uff0c\u907f\u514d\u73af\u5883\u6c61\u67d3</li> </ul>"},{"location":"devops/other/Jenkins%E9%83%A8%E7%BD%B2Python%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/#_7","title":"\u516d\u3001\u53cd\u601d","text":"<ul> <li>\u5728\u6b64\u5229\u7528\u6765Conda\u865a\u62df\u73af\u5883\u7ba1\u7406\uff0c\u6765\u5728\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u89e3\u51b3\u73af\u5883\u4e0d\u4e00\u81f4\u884c\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528Docker\u6765\u89e3\u51b3</li> <li>\u5229\u7528Pipeline\u9879\u76ee\u53d1\u5e03\u53ef\u89c6\u5316\uff0c\u660e\u786e\u9636\u6bb5\uff0c\u65b9\u4fbfstage\u67e5\u770b\u4e0e\u6392\u9519\uff0cJenkinsfile\u53ef\u653e\u5728git\u4ed3\u5e93\u8fdb\u884c</li> </ul>"},{"location":"devops/other/Packer/","title":"\u955c\u50cf\u5b9a\u4e49\u5de5\u5177Packer\u5b9e\u6218","text":""},{"location":"devops/other/Packer/#_1","title":"\u4e00 \u6982\u8ff0","text":""},{"location":"devops/other/Packer/#11-packer","title":"1.1 \u4ec0\u4e48\u662fpacker","text":"<p>Packer\u662f\u7528\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u591a\u79cd\u4e91\u8ba1\u7b97\u5e73\u53f0\u4e0a\u521b\u5efa\u5b8c\u5168\u4e00\u81f4\u955c\u50cf\u7684\u5f00\u6e90\u5de5\u5177\u3002Packer\u662f\u7531HashiCorp\u57282013\u5e74\u5de6\u53f3\u63a8\u51fa\u7684\u3002Packer\u53ef\u4ee5\u5728\u5404\u79cd\u4e3b\u6d41\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fd0\u884c\uff0c\u53ef\u4ee5\u9ad8\u901f\u3001\u5e76\u884c\u5728\u591a\u79cd\u4e91\u5e73\u53f0\u4e0a\u521b\u5efa\u955c\u50cf\u3002Packer\u5e76\u4e0d\u80fd\u53d6\u4ee3puppet\u6216\u8005Chef\u4e4b\u7c7b\u7684\u4e3b\u673a\u914d\u7f6e\u5de5\u5177\uff0c\u800c\u662f\u4e92\u4e3a\u8865\u5145-Packer\u5728\u521b\u5efa\u955c\u50cf\u65f6\uff0c\u53ef\u4ee5\u8c03\u7528\u8fd9\u4e9b\u5de5\u5177\u5728\u57fa\u7840\u955c\u50cf\u4e0a\u5b89\u88c5\u3001\u914d\u7f6e\u8f6f\u4ef6\u3002</p> <p>\u955c\u50cf\u662f\u6307\u4e00\u4e2a\u9884\u5148\u5b89\u88c5\u4e86\u8f6f\u4ef6\u3001\u914d\u7f6e\u597d\u4e86\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd9\u4e2a\u955c\u50cf\u53ef\u4ee5\u88ab\u7528\u5f00\u5feb\u901f\u521b\u5efa\u4e91\u4e3b\u673a\u3002\u6bcf\u4e2a\u4e91\u5e73\u53f0\u901a\u5e38\u6709\u4e0d\u540c\u7684\u955c\u50cf\u683c\u5f0f\u3002</p>"},{"location":"devops/other/Packer/#12-packer","title":"1.2 \u4e3a\u4ec0\u4e48\u4f7f\u7528packer","text":"<p>Packer\u53ea\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u6613\u4e8e\u901a\u8fc7\u7ec8\u7aef\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u5f88\u7b80\u5355\u7684\u653e\u5230\u81ea\u52a8\u5316\u5de5\u5177\u91cc\u8fb9\uff0c\u7528\u6765\u81ea\u52a8\u521b\u5efa\u4efb\u4f55\u7c7b\u578b\u7684\u4e3b\u673a\u955c\u50cf\u3002</p> <p>Packer\u662f\u4e00\u4e2a\u5f00\u653e\u6e90\u4ee3\u7801\u5de5\u5177\uff0c\u53ef\u4ece\u4e00\u4e2a\u6e90\u914d\u7f6e\u4e3a\u591a\u4e2a\u5e73\u53f0\u521b\u5efa\u76f8\u540c\u7684\u673a\u5668\u6620\u50cf\u3002Packer\u8f7b\u5de7\uff0c\u53ef\u5728\u6bcf\u4e2a\u4e3b\u8981\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fd0\u884c\uff0c\u5e76\u4e14\u6027\u80fd\u5353\u8d8a\uff0c\u53ef\u4e3a\u591a\u4e2a\u5e73\u53f0\u5e76\u884c\u521b\u5efa\u673a\u5668\u6620\u50cf\u3002Packer\u4e0d\u4f1a\u53d6\u4ee3Chef\u6216Puppet\u7b49\u914d\u7f6e\u7ba1\u7406\u3002\u5b9e\u9645\u4e0a\uff0c\u5728\u6784\u5efa\u6620\u50cf\u65f6\uff0cPacker\u80fd\u591f\u4f7f\u7528Chef\u6216Puppet\u7b49\u5de5\u5177\u5728\u6620\u50cf\u4e0a\u5b89\u88c5\u8f6f\u4ef6\u3002\u673a\u5668\u6620\u50cf\u662f\u4e00\u4e2a\u9759\u6001\u5355\u5143\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u9884\u5148\u914d\u7f6e\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u5df2\u5b89\u88c5\u7684\u8f6f\u4ef6\uff0c\u7528\u4e8e\u5feb\u901f\u521b\u5efa\u65b0\u7684\u8fd0\u884c\u4e2d\u7684\u673a\u5668\u3002\u673a\u5668\u6620\u50cf\u683c\u5f0f\u968f\u6bcf\u4e2a\u5e73\u53f0\u800c\u53d8\u5316\u3002\u4e00\u4e9b\u793a\u4f8b\u5305\u62ec\u7528\u4e8eEC2\u7684AMI\uff0c\u7528\u4e8eVMware\u7684VMDK / VMX\u6587\u4ef6\uff0c\u7528\u4e8eVirtualBox\u7684OVF\u5bfc\u51fa\u7b49\u3002</p>"},{"location":"devops/other/Packer/#13","title":"1.3 \u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801","text":"<p>\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u7684\u610f\u601d\u662f\u628a\u57fa\u7840\u8bbe\u65bd\u7684\u5b9e\u73b0\u65b9\u5f0f\u5199\u6210\u4ee3\u7801\u3002\u544a\u522b\u624b\u5de5\u914d\u7f6e\u5404\u7c7b\u8d44\u6e90\u800c\u91c7\u7528\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u83b7\u5f97\u591a\u79cd\u597d\u5904\uff1a</p> <ul> <li>\u53ef\u91cd\u590d-\u53ef\u4ee5\u968f\u65f6\u91cd\u65b0\u521b\u5efa\u57fa\u7840\u67b6\u6784\uff0c\u4f8b\u5982\u5728\u707e\u5907\u73af\u5883\u91cd\u65b0\u521b\u5efa\u751f\u4ea7\u73af\u5883\u3002</li> <li>\u53ef\u4e00\u81f4\u6027-\u5728\u5404\u4e2a\u4e0d\u540c\u7684\u73af\u5883\u4e4b\u95f4\u5b9e\u73b0\u6700\u5927\u7a0b\u5ea6\u7684\u4e00\u81f4\u6027\uff0c\u51cf\u5c11\u73af\u5883\u5dee\u5f02\u5bfc\u81f4\u7684\u751f\u4ea7\u3001\u6d4b\u8bd5\u6548\u7387\u4e0b\u964d\u3002</li> <li>\u53ef\u8ffd\u6eaf\u56de\u6eda-\u73af\u5883\u7684\u6240\u6709\u53d8\u5316\u90fd\u901a\u8fc7\u4ee3\u7801\u5b9e\u73b0\uff0c\u800c\u4ee3\u7801\u7684\u53d8\u5316\u662f\u53ef\u4ee5\u8ffd\u6eaf\u56de\u6eda\u7684\u3002</li> <li>\u5feb\u901f-\u7531\u4e8e\u57fa\u7840\u67b6\u6784\u662f\u901a\u8fc7\u4ee3\u7801\u5b9e\u73b0\u7684\uff0c\u90a3\u4e48\u6539\u53d8\u6216\u8005\u91cd\u5efa\u7cfb\u7edf\u65f6\u5c31\u4f1a\u975e\u5e38\u5feb\uff0c\u662f\u654f\u6377\u5f00\u53d1\u548cDevOps\u4e2d\u5fc5\u4e0d\u53ef\u5c11\u7684\u4e00\u6b65\u3002</li> </ul> <p>Packer\u53ef\u4ee5\u8bf4\u662f\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\u7684\u7b2c\u4e00\u6b65\u3002</p> <p>\u5728\u4e91\u539f\u751f\u67b6\u6784\u4e2d\uff0c\u6280\u672f\u8bbe\u65bd\u5373\u4ee3\u7801\u4e0e\u5fae\u670d\u52a1/\u58f0\u660e\u5f0f\u7684API/\u670d\u52a1\u7f51\u683c\u6210\u4e3a\u67b6\u6784\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206</p>"},{"location":"devops/other/Packer/#14-packer","title":"1.4 packer\u4f18\u70b9","text":"<ul> <li> <p>\u5feb\u901f\u7684\u57fa\u7840\u67b6\u6784\u5b9e\u65bd\uff1aPacker\u521b\u5efa\u7684\u955c\u50cf\u53ef\u4ee5\u8ba9\u8fd0\u7ef4\u4eba\u5458\u51e0\u79d2\u949f\u5185\u521b\u5efa\u4e00\u4e2a\u9884\u5148\u914d\u7f6e\u597d\u7684\u4e91\u4e3b\u673a\uff0c\u800c\u4e0d\u662f\u51e0\u5206\u949f\u751a\u81f3\u51e0\u4e2a\u5c0f\u65f6\u3002\u8fd9\u4e00\u597d\u5904\u4e0d\u4f46\u5bf9\u751f\u4ea7\u73af\u5883\uff0c\u4e5f\u5bf9\u6d4b\u8bd5\u53ca\u5f00\u53d1\u73af\u5883\u6709\u76ca\u3002</p> </li> <li> <p>\u591a\u5e73\u53f0\u517c\u5bb9\uff1a\u7531\u4e8ePacker\u53ef\u4ee5\u4e3a\u591a\u4e2a\u5e73\u53f0\u521b\u5efa\u5b8c\u5168\u4e00\u81f4\u7684\u955c\u50cf\uff0c\u4f60\u53ef\u4ee5\u5728\u817e\u8baf\u4e91\u4e0a\u8fd0\u884c\u751f\u4ea7\u73af\u5883\uff0c\u5728\u81ea\u5df1\u7684\u79c1\u6709\u4e91\u91cc\u8fb9\u8fd0\u884c\u6d4b\u8bd5\u73af\u5883\uff0c\u5728\u81ea\u5df1\u7684vmware\u865a\u62df\u673a\u91cc\u8fd0\u884c\u5f00\u53d1\u73af\u5883\u3002\u800c\u6bcf\u4e2a\u73af\u5883\u90fd\u5b8c\u5168\u4e00\u81f4\u3002</p> </li> <li> <p>\u63d0\u9ad8\u7a33\u5b9a\u6027\uff1aPacker\u5728\u521b\u5efa\u955c\u50cf\u65f6\u5b89\u88c5\u5e76\u914d\u7f6e\u8f6f\u4ef6\u3002\u5b89\u88c5\u6216\u8005\u914d\u7f6e\u6b65\u9aa4\u4e2d\u7684\u95ee\u9898\u4f1a\u5728\u8fd9\u65f6\u5019\u53d1\u73b0\uff0c\u800c\u4e0d\u662f\u5728\u7a7f\u4ef6\u4e91\u4e3b\u673a\u7684\u65f6\u5019\u3002</p> </li> <li> <p>\u63d0\u9ad8\u53ef\u6d4b\u8bd5\u6027\uff1a\u955c\u50cf\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u5f88\u5feb\u7684\u542f\u52a8\u4e00\u4e2a\u4e91\u4e3b\u673a\u5e76\u5bf9\u5176\u8fdb\u884c\u6d4b\u8bd5\u3002\u5982\u679c\u6d4b\u8bd5\u901a\u8fc7\uff0c\u90a3\u5c31\u53ef\u4ee5\u76f8\u4fe1\uff0c\u901a\u8fc7\u8fd9\u4e2a\u955c\u50cf\u521b\u5efa\u7684\u4e91\u4e3b\u673a\u90fd\u4f1a\u901a\u8fc7\u6d4b\u8bd5\u3002</p> </li> </ul>"},{"location":"devops/other/Packer/#15-packer","title":"1.5 packer\u4e0e\u4f20\u7edf\u521b\u5efa\u955c\u50cf\u5bf9\u6bd4","text":"\u540d\u79f0 \u63a7\u5236\u53f0\u521b\u5efa\u955c\u50cf Packer \u521b\u5efa\u955c\u50cf \u4f7f\u7528\u65b9\u5f0f \u63a7\u5236\u53f0\u70b9\u51fb \u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u6784\u5efa \u53ef\u590d\u7528\u6027 \u4f4e\u3002\u6bcf\u6b21\u90fd\u9700\u6267\u884c\u76f8\u540c\u64cd\u4f5c\uff0c\u4e14\u65e0\u6cd5\u4fdd\u8bc1\u955c\u50cf\u4e00\u81f4\u6027\uff0c\u65e0\u6cd5\u7248\u672c\u5316\u7ba1\u7406 \u9ad8\u3002\u914d\u7f6e\u6587\u4ef6\u62f7\u8d1d\u3001\u4fee\u6539\u5373\u53ef\uff0c\u53ef\u7248\u672c\u5316\u7ba1\u7406 \u64cd\u4f5c\u590d\u6742\u5ea6 \u9ad8\u3002\u5148\u4f7f\u7528\u57fa\u7840\u955c\u50cf\u521b\u5efa\u4e91\u4e3b\u673a\uff0c\u5e76\u81ea\u884c\u767b\u9646\u5230\u4e91\u4e3b\u673a\u4e2d\u8fdb\u884c\u90e8\u7f72\uff0c\u4e4b\u540e\u624b\u52a8\u5236\u4f5c\u955c\u50cf \u4f4e\u3002\u6267\u884c\u914d\u7f6e\u6587\u4ef6\uff0c\u81ea\u52a8\u6267\u884c\u9884\u914d\u7f6e\u81ea\u52a8\u5316\u811a\u672c\uff0c\u7136\u540e\u81ea\u52a8\u6784\u5efa\u955c\u50cf \u521b\u5efa\u65f6\u95f4 \u957f\u3002\u6d41\u7a0b\u5316\u64cd\u4f5c\uff0c\u9700\u8981\u4eba\u5de5\u503c\u5b88\uff0c\u65e0\u6cd5\u51c6\u786e\u7b49\u5f85\u6bcf\u4e2a\u6d41\u7a0b\u7684\u6267\u884c \u77ed\u3002\u81ea\u52a8\u5316\u5de5\u4f5c\u6d41\u64cd\u4f5c\uff0c\u5b8c\u5584\u7684\u8f6e\u8be2\u7b49\u5f85\u673a\u5236\uff0c\u65e0\u7f1d\u8854\u63a5\u6bcf\u4e2a\u6d41\u7a0b"},{"location":"devops/other/Packer/#_2","title":"\u4e8c \u5e94\u7528\u573a\u666f","text":""},{"location":"devops/other/Packer/#21","title":"2.1 \u6301\u7eed\u4ea4\u4ed8","text":"<p>Packer\u662f\u7528\u547d\u4ee4\u884c\u9a71\u52a8\u7684\uff0c\u800c\u4e14\u4e0d\u9700\u8981\u5f88\u591a\u8d44\u6e90\u3002\u56e0\u6b64\u53ef\u4ee5\u5f88\u5bb9\u6613\u628aPacker\u653e\u5230\u6301\u7eed\u4ea4\u4ed8\u7684pipeline\u91cc\uff0c\u521b\u5efa\u955c\u50cf\u3002\u5728\u6301\u7eed\u4ea4\u4ed8\u968f\u540e\u7684\u6b65\u9aa4\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u6b64\u955c\u50cf\u8fdb\u884c\u6d4b\u8bd5\uff0c\u770b\u57fa\u7840\u8bbe\u65bd\u7684\u53d8\u5316\u662f\u4e0d\u662f\u80fd\u591f\u901a\u8fc7\u6d4b\u8bd5\u3002\u5982\u679c\u6d4b\u8bd5\u901a\u8fc7\uff0c\u90a3\u5c31\u53ef\u4ee5\u76f8\u4fe1\u5728\u8fd9\u4e00\u955c\u50cf\u57fa\u7840\u4e0a\u642d\u5efa\u7684\u4e91\u4e3b\u673a\u4e5f\u4f1a\u5de5\u4f5c\u3002\u8fd9\u5bf9\u57fa\u7840\u8bbe\u65bd\u53d8\u5316\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u6d4b\u8bd5\u6027\u63d0\u4f9b\u4e86\u57fa\u7840\u3002</p> <p>Packer\u662f\u8f7b\u91cf\u7ea7\u7684\u3001\u53ef\u79fb\u690d\u7684\u548c\u547d\u4ee4\u884c\u9a71\u52a8\u7684\u3002\u8fd9\u4f7f\u5f97\u5b83\u6210\u4e3a\u4e00\u4e2a\u5b8c\u7f8e\u7684\u5de5\u5177\uff0c\u653e\u5728\u60a8\u7684\u8fde\u7eed\u4ea4\u4ed8\u7ba1\u9053\u4e2d\u95f4\u3002Packer\u53ef\u7528\u4e8e\u5728\u5bf9Chef/Puppet\u7684\u6bcf\u6b21\u66f4\u6539\u4e0a\u4e3a\u591a\u4e2a\u5e73\u53f0\u751f\u6210\u65b0\u7684\u673a\u5668\u6620\u50cf\u3002</p> <p>\u4f5c\u4e3a\u8fd9\u4e2a\u7ba1\u9053\u7684\u4e00\u90e8\u5206\uff0c\u53ef\u4ee5\u542f\u52a8\u5e76\u6d4b\u8bd5\u65b0\u521b\u5efa\u7684\u6620\u50cf\uff0c\u4ece\u800c\u9a8c\u8bc1\u57fa\u7840\u7ed3\u6784\u66f4\u6539\u7684\u5de5\u4f5c\u3002\u5982\u679c\u6d4b\u8bd5\u901a\u8fc7\uff0c\u60a8\u53ef\u4ee5\u786e\u4fe1\u6620\u50cf\u5728\u90e8\u7f72\u65f6\u5c06\u5de5\u4f5c\u3002\u8fd9\u4e3a\u57fa\u7840\u8bbe\u65bd\u7684\u53d8\u5316\u5e26\u6765\u4e86\u65b0\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u6d4b\u8bd5\u6027\u3002</p>"},{"location":"devops/other/Packer/#22-devprod","title":"2.2 dev/prod \u4ea7\u54c1\u6bd4\u4ef7","text":"<p>Packer\u5e2e\u52a9\u4fdd\u6301\u5f00\u53d1\uff0c\u6682\u5b58\u548c\u751f\u4ea7\u5c3d\u53ef\u80fd\u76f8\u4f3c\u3002Packer\u53ef\u7528\u4e8e\u540c\u65f6\u4e3a\u591a\u4e2a\u5e73\u53f0\u751f\u6210\u6620\u50cf\u3002\u56e0\u6b64\uff0c\u5982\u679c\u5c06AWS\u7528\u4e8e\u751f\u4ea7\u800c\u5c06VMware\uff08\u4e5f\u8bb8\u4e0eVagrant\u7ed3\u5408\u4f7f\u7528\uff09\u7528\u4e8e\u5f00\u53d1\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528Packer\u4ece\u540c\u4e00\u6a21\u677f\u540c\u65f6\u751f\u6210AMI\u548cVMware\u8ba1\u7b97\u673a\u3002</p>"},{"location":"devops/other/Packer/#23","title":"2.3 \u8bbe\u5907/\u6f14\u793a\u521b\u5efa","text":"<p>\u7531\u4e8ePacker\u53ef\u4ee5\u5e76\u884c\u5730\u4e3a\u591a\u4e2a\u5e73\u53f0\u521b\u5efa\u4e00\u81f4\u7684\u6620\u50cf\uff0c\u56e0\u6b64\u975e\u5e38\u9002\u5408\u521b\u5efa\u7535\u5668\u548c\u4e00\u6b21\u6027\u4ea7\u54c1\u6f14\u793a\u3002\u968f\u7740\u8f6f\u4ef6\u7684\u66f4\u6539\uff0c\u60a8\u53ef\u4ee5\u81ea\u52a8\u521b\u5efa\u5e26\u6709\u9884\u5b89\u88c5\u8f6f\u4ef6\u7684\u8bbe\u5907\u3002\u7136\u540e\uff0c\u6f5c\u5728\u7684\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5c06\u8f6f\u4ef6\u90e8\u7f72\u5230\u4ed6\u4eec\u9009\u62e9\u7684\u73af\u5883\u4e2d\u6765\u5f00\u59cb\u4f7f\u7528\u60a8\u7684\u8f6f\u4ef6\u3002\u6253\u5305\u5177\u6709\u590d\u6742\u8981\u6c42\u7684\u8f6f\u4ef6\u4ece\u672a\u5982\u6b64\u7b80\u5355\u3002</p>"},{"location":"devops/other/Packer/#_3","title":"\u4e09 \u5b89\u88c5","text":""},{"location":"devops/other/Packer/#31","title":"3.1 \u4e8c\u8fdb\u5236\u5b89\u88c5","text":"<p>\u9009\u62e9\u5408\u9002\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u8fdb\u884c\u5b89\u88c5</p> <p>https://www.packer.io/downloads.html</p> <pre><code>wget https://releases.hashicorp.com/packer/1.5.1/packer_1.5.1_linux_amd64.zip\nunzip packer_1.5.1_linux_amd64.zip\ncp packer /usr/bin/\n</code></pre>"},{"location":"devops/other/Packer/#32","title":"3.2 \u6e90\u7801\u7f16\u8bd1\u5b89\u88c5","text":""},{"location":"devops/other/Packer/#321-go","title":"3.2.1 go\u73af\u5883\u5b89\u88c5","text":"<p>\u6b64\u5904\u793a\u4f8b\u4e3aCentOS7</p> <pre><code>cd /opt\nwget -c https://dl.google.com/go/go1.13.6.linux-amd64.tar.gz\ntar -C /usr/local -zxvf  go1.13.6.linux-amd64.tar.gz\ncat &gt;&gt;/etc/profile &lt;&lt;EOF    \nexport GOROOT=/usr/local/go\nexport PATH=\\$PATH:\\$GOROOT/bin\nEOF\nsource /etc/profile\n\nvim .bash_profile\n\nexport GOPATH=$HOME/go\n</code></pre> <p></p>"},{"location":"devops/other/Packer/#322-packer","title":"3.2.2 packer\u7f16\u8bd1","text":"<pre><code>$ mkdir -p $(go env GOPATH)/src/github.com/hashicorp &amp;&amp; cd $_\n$ git clone https://github.com/hashicorp/packer.git\n$ cd packer\n\n$ make dev\n$ cp $(go env GOPATH)/bin/packer /usr/sbin\n</code></pre>"},{"location":"devops/other/Packer/#_4","title":"\u56db \u793a\u4f8b","text":""},{"location":"devops/other/Packer/#41","title":"4.1 \u817e\u8baf\u4e91\u793a\u4f8b","text":""},{"location":"devops/other/Packer/#411-template","title":"4.1.1 \u7f16\u5199template","text":"<pre><code>{\n  \"variables\": {\n    \"tc_secret_id\": \"{{env `TENCENTCLOUD_ACCESS_KEY`}}\",\n    \"tc_secret_key\": \"{{env `TENCENTCLOUD_SECRET_KEY`}}\"\n  },        \n  \"builders\": [\n    {\n    \"type\": \"tencentcloud-cvm\",\n    \"secret_id\": \"{{user `tc_secret_id` }}\",\n    \"secret_key\": \"{{user `tc_secret_key`}}\",\n    \"region\": \"ap-guangzhou\",\n    \"zone\": \"ap-guangzhou-3\",\n    \"instance_type\": \"S2.SMALL1\",   \n    \"disk_type\": \"CLOUD_PREMIUM\",\n    \"associate_public_ip_address\": true,\n    \"source_image_id\": \"img-9qabwvbn\",\n    \"ssh_username\" : \"root\",\n    \"image_name\": \"nginx-service-v1\"\n  }\n  ],\n  \"provisioners\": [{\n    \"type\": \"shell\",\n    \"inline\": [\n      \"rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\",\n      \"yum install -y nginx\",\n      \"systemctl enable nginx\",\n      \"systemctl start nginx\"\n    ]\n  }]\n}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u4e00\u5f00\u59cb\uff0c\u5f15\u5165\u4e86\u4e24\u4e2a\u53d8\u91cf\uff0c\u5206\u522b\u662ftc_secret_id\u548ctc_secret_key\uff0c\u5b83\u4eec\u7684\u503c\u5206\u522b\u53d6\u81ea\u73af\u5883\u53d8\u91cfTENCENTCLOUD_ACCESS_KEY\u548cTENCENTCLOUD_SECRET_KEY\uff0c\u8fd9\u4e0e\u817e\u8baf\u4e91Terraform\u5e94\u7528\u6307\u5357\u4e2d\u63d0\u5230\u8bbe\u7f6e\u662f\u4e00\u6837\u7684\u3002</p> <p>\u968f\u540e\u7d27\u8ddf\u7684\u662f\u4e00\u4e2abuilder\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6307\u5b9a\u5728\u817e\u8baf\u4e91\u5e7f\u5dde\u5927\u533a\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u955c\u50cfnginx-service-v1\uff0c\u8be5\u955c\u50cf\u7684\u57fa\u7840\u955c\u50cf\u662f\u817e\u8baf\u4e91\u7684\u5171\u6709\u955c\u50cfimg-9qabwvbn\uff0c\u8fd9\u4e2a\u955c\u50cfid\u662f\u4ece\u817e\u8baf\u4e91\u63a7\u5236\u53f0\u67e5\u5230\u7684\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p>builder\u540e\u8fb9\u662f\u4e00\u4e2aprovisioner\u7684\u5b9a\u4e49\uff0c\u6307\u5b9a\u4e86\u51e0\u4e2a\u547d\u4ee4\u884c\u53ca\u53c2\u6570\u3002</p>"},{"location":"devops/other/Packer/#412","title":"4.1.2 \u6267\u884c","text":"<p>\u968f\u540e\u53ef\u4ee5\u6267\u884c\uff1a</p> <pre><code>TENCENTCLOUD_ACCESS_KEY=AKIDZyGQXbErpY4MPDl7D4g3HH2c5KL8Y8G8\nTENCENTCLOUD_SECRET_KEY=kFUTDk38yZw4xc5JHzRdZFfspWxDE0Xq\n# \u9a8c\u8bc1\u6587\u4ef6\u6b63\u786e\u6027\n[root@VM_0_17_centos data]# packer validate cvm-template.json\nTemplate validated successfully.\n\n# \u6267\u884c\nexport TENCENTCLOUD_ACCESS_KEY=AKIDZyGQXbErpY4MPDl7D4g3HH2c5KL8Y8G8\nexport TENCENTCLOUD_SECRET_KEY=kFUTDk38yZw4xc5JHzRdZFfspWxDE0Xq\npacker build tencent-nginx.json\n</code></pre>"},{"location":"devops/other/Packer/#413","title":"4.1.3 \u67e5\u770b\u6267\u884c\u7ed3\u679c","text":"<pre><code>[root@VM_0_17_centos data]# packer build cvm-template.json\ntencentcloud-cvm: output will be in this color.\n\n==&gt; tencentcloud-cvm: Trying to check image name: nginx-service-v1...\n    tencentcloud-cvm: Image name: useable\n==&gt; tencentcloud-cvm: Trying to check source image: img-9qabwvbn...\n    tencentcloud-cvm: Image found: CentOS 7.6 64bit\n==&gt; tencentcloud-cvm: Trying to create a new keypair: packer_5e2bb832...\n    tencentcloud-cvm: Keypair created: skey-ae69a70z\n==&gt; tencentcloud-cvm: Trying to create a new vpc...\n    tencentcloud-cvm: Vpc created: vpc-b4ofbh47\n==&gt; tencentcloud-cvm: Trying to create a new subnet...\n    tencentcloud-cvm: Subnet created: subnet-5817hc7k\n==&gt; tencentcloud-cvm: Trying to create a new securitygroup...\n    tencentcloud-cvm: Securitygroup created: sg-d9p13qth\n==&gt; tencentcloud-cvm: Trying to create securitygroup polices...\n    tencentcloud-cvm: Securitygroup polices created\n==&gt; tencentcloud-cvm: Trying to create a new instance...\n    tencentcloud-cvm: Waiting for instance ready\n    tencentcloud-cvm: Instance created: ins-389nxgpa\n==&gt; tencentcloud-cvm: Using ssh communicator to connect: 134.175.96.85\n==&gt; tencentcloud-cvm: Waiting for SSH to become available...\n==&gt; tencentcloud-cvm: Connected to SSH!\n==&gt; tencentcloud-cvm: Provisioning with shell script: /tmp/packer-shell361573813\n==&gt; tencentcloud-cvm: warning: /var/tmp/rpm-tmp.s33FeG: Header V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY\n    tencentcloud-cvm: Retrieving http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n    tencentcloud-cvm: Preparing...                          ########################################\n    tencentcloud-cvm: Updating / installing...\n    tencentcloud-cvm: nginx-release-centos-7-0.el7.ngx      ########################################\n    tencentcloud-cvm: Loaded plugins: fastestmirror, langpacks\n    tencentcloud-cvm: Determining fastest mirrors\n    tencentcloud-cvm: Resolving Dependencies\n    tencentcloud-cvm: --&gt; Running transaction check\n    tencentcloud-cvm: ---&gt; Package nginx.x86_64 1:1.16.1-1.el7.ngx will be installed\n    tencentcloud-cvm: --&gt; Finished Dependency Resolution\n    tencentcloud-cvm:\n    tencentcloud-cvm: Dependencies Resolved\n    tencentcloud-cvm:\n    tencentcloud-cvm: ================================================================================\n    tencentcloud-cvm:  Package       Arch           Version                       Repository     Size\n    tencentcloud-cvm: ================================================================================\n    tencentcloud-cvm: Installing:\n    tencentcloud-cvm:  nginx         x86_64         1:1.16.1-1.el7.ngx            nginx         766 k\n    tencentcloud-cvm:\n    tencentcloud-cvm: Transaction Summary\n    tencentcloud-cvm: ================================================================================\n    tencentcloud-cvm: Install  1 Package\n    tencentcloud-cvm:\n    tencentcloud-cvm: Total download size: 766 k\n    tencentcloud-cvm: Installed size: 2.7 M\n    tencentcloud-cvm: Downloading packages:\n    tencentcloud-cvm: Running transaction check\n    tencentcloud-cvm: Running transaction test\n    tencentcloud-cvm: Transaction test succeeded\n    tencentcloud-cvm: Running transaction\n    tencentcloud-cvm:   Installing : 1:nginx-1.16.1-1.el7.ngx.x86_64                              1/1\n    tencentcloud-cvm: ----------------------------------------------------------------------\n    tencentcloud-cvm:\n    tencentcloud-cvm: Thanks for using nginx!\n    tencentcloud-cvm:\n    tencentcloud-cvm: Please find the official documentation for nginx here:\n    tencentcloud-cvm: * http://nginx.org/en/docs/\n    tencentcloud-cvm:\n    tencentcloud-cvm: Please subscribe to nginx-announce mailing list to get\n    tencentcloud-cvm: the most important news about nginx:\n    tencentcloud-cvm: * http://nginx.org/en/support.html\n    tencentcloud-cvm:\n    tencentcloud-cvm: Commercial subscriptions for nginx are available on:\n    tencentcloud-cvm: * http://nginx.com/products/\n    tencentcloud-cvm:\n    tencentcloud-cvm: ----------------------------------------------------------------------\n    tencentcloud-cvm:   Verifying  : 1:nginx-1.16.1-1.el7.ngx.x86_64                              1/1\n    tencentcloud-cvm:\n    tencentcloud-cvm: Installed:\n    tencentcloud-cvm:   nginx.x86_64 1:1.16.1-1.el7.ngx\n    tencentcloud-cvm:\n    tencentcloud-cvm: Complete!\n==&gt; tencentcloud-cvm: Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.\n==&gt; tencentcloud-cvm: Trying to detach keypair: skey-ae69a70z...\n    tencentcloud-cvm: Keypair detached\n==&gt; tencentcloud-cvm: Trying to create a new image: nginx-service-v1...\n    tencentcloud-cvm: Waiting for image ready\n    tencentcloud-cvm: Image created: img-lw1glokq\n==&gt; tencentcloud-cvm: Cleaning up instance...\n==&gt; tencentcloud-cvm: Cleaning up securitygroup...\n==&gt; tencentcloud-cvm: Cleaning up subnet...\n==&gt; tencentcloud-cvm: Cleaning up vpc...\n==&gt; tencentcloud-cvm: Cleaning up keypair...\nBuild 'tencentcloud-cvm' finished.\n\n==&gt; Builds finished. The artifacts of successful builds are:\n--&gt; tencentcloud-cvm: Tencentcloud images(ap-guangzhou: img-lw1glokq) were created.\n</code></pre>"},{"location":"devops/other/Packer/#413_1","title":"4.1.3 \u67e5\u770b\u6267\u884c\u7ed3\u679c","text":""},{"location":"devops/other/Packer/#_5","title":"\u4e94 \u53cd\u601d","text":"<ul> <li>\u5728\u57fa\u7840\u67b6\u6784\u5411kubernetes\u5fae\u670d\u52a1\u67b6\u6784\u7684\u8f6c\u578b\u4e2d\uff0c\u5982\u679c\u67b6\u6784\u5904\u4e8ecloud hosting\uff0c\u6216\u6df7\u5408\u4e91\u67b6\u6784\uff0cPacker\u4e3a\u60a8\u7b80\u5316\u6301\u7eed\u4ea4\u4ed8\u6d41\u7a0b\uff0c\u5feb\u901f\u7684\u955c\u50cf\u6d4b\u8bd5\u3002</li> <li>Packer \u521b\u5efa\u955c\u50cf\u5bf9\u6bd4\u4eba\u5de5\u624b\u52a8\u70b9\u51fb\uff0c\u4ee5\u5176\u57fa\u7840\u8bbe\u65bd\u5373\u4ee3\u7801\uff0c\u4ee3\u7801\u53ef\u590d\u7528\u6027\uff0c\u7248\u672c\u7ba1\u7406\uff0c\u81ea\u52a8\u5316\u6d41\u7a0b\u7ba1\u7406\u7b49\u3002</li> </ul>"},{"location":"devops/other/Packer/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.packer.io/intro/index.html</li> <li>https://cloud.tencent.com/developer/article/1474736</li> <li>https://www.mdslq.cn/archives/bc880644.html</li> </ul>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/","title":"\u4e00 \u6982\u8ff0","text":"<p>\u5bf9\u4e8e\u9879\u76ee\u4ee3\u7801\u8d28\u91cf\u7ba1\u7406\uff0c\u5728\u76ee\u524d\u7684\u5fae\u670d\u52a1/\u6a21\u5757\u5316/\u5feb\u8fed\u4ee3\u654f\u6377\u5f00\u53d1\u4e2d\u5982\u679c\u4ec5\u4f9d\u8d56IDE\u7b80\u5355\u68c0\u67e5\u548c\u4eba\u4e3a\u7684codereview\u5bf9\u4e8e\u5927\u91cf\u4ee3\u7801\u5f88\u4e0d\u9002\u5408\uff0c\u4e0d\u4ec5\u4ec5\u4f9d\u9760\u5f00\u53d1\u4eba\u5458\u7684\u7f16\u7801\u89c4\u8303\u7f16\u7801\u53ca\u6ce8\u610f\u7a0b\u5e8f\u5065\u58ee\u6027\uff0c\u540c\u65f6\u9700\u8981\u4e00\u4e9b\u5de5\u5177\u6765\u5e2e\u52a9\u6211\u4eec\u63d0\u524d\u9884\u9632\u548c\u5f3a\u5236\u68c0\u6d4b\u89c4\u8303\u3002</p> <p>Sonarqube \u662f\u4e00\u6b3e\u4ee3\u7801\u5206\u6790\u68c0\u6d4b\u5de5\u5177\uff0c\u5c06\u5176\u4e0edevops\u7ed3\u5408\uff0c\u4f8b\u5982\u96c6\u6210\u5230gitlab ci/cd\u6216jenkins\u4e2d\u5b9e\u73b0\u90e8\u7f72\u81ea\u52a8\u4ee3\u7801\u68c0\u67e5\uff0c\u53ca\u65f6\u53d1\u73b0\u5e76\u5904\u7406bug\uff0c\u6700\u5927\u9650\u5ea6\u7684\u5c06bug\u548c\u4e0d\u89c4\u8303\u627c\u6740\u5728\u7f16\u7801\u9636\u6bb5\uff0c\u5176\u5185\u90e8\u96c6\u6210\u5f88\u591a\u5206\u6790\u5de5\u5177\uff0c\u6bd4\u5982pmd-cpd\u3001checkstyle\u3001findbugs\u3001Jenkins\uff0c\u4ece\u4e03\u4e2a\u65b9\u9762\u5e2e\u6211\u4eec\u6765\u6e90\u7801\u8d28\u91cf\u7ba1\u7406\u3002\u6b64\u6587\u7ae0\u5b89\u88c5\u6700\u65b0\u7248SonarQube-7.9.1\uff0c\u6b64\u7248\u672c\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49\u6570\u636e\u5e93MySQL\uff0cjdk\u9700\u8981\u5b89\u88c5\u9ad8\u7248\u672c11\u3002</p>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#11","title":"1.1 \u7279\u70b9","text":"<ul> <li>\u68c0\u67e5\u4ee3\u7801\u662f\u5426\u9075\u5faa\u7f16\u7a0b\u6807\u51c6\uff1a\u5982\u547d\u540d\u89c4\u8303\uff0c\u7f16\u5199\u7684\u89c4\u8303\u7b49\u3002</li> <li>\u68c0\u67e5\u8bbe\u8ba1\u5b58\u5728\u7684\u6f5c\u5728\u7f3a\u9677\uff1aSonarQube \u901a\u8fc7\u63d2\u4ef6 Findbugs\u3001Checkstyle \u7b49\u5de5\u5177\u68c0\u6d4b\u4ee3\u7801\u5b58\u5728\u7684\u7f3a\u9677\u3002</li> <li>\u68c0\u6d4b\u4ee3\u7801\u7684\u91cd\u590d\u4ee3\u7801\u91cf\uff1aSonarQube \u53ef\u4ee5\u5c55\u793a\u9879\u76ee\u4e2d\u5b58\u5728\u5927\u91cf\u590d\u5236\u7c98\u8d34\u7684\u4ee3\u7801\u3002</li> <li> <p>\u68c0\u6d4b\u4ee3\u7801\u4e2d\u6ce8\u91ca\u7684\u7a0b\u5ea6\uff1a\u6e90\u7801\u6ce8\u91ca\u8fc7\u591a\u6216\u8005\u592a\u5c11\u90fd\u4e0d\u597d\uff0c\u5f71\u54cd\u7a0b\u5e8f\u7684\u53ef\u8bfb\u53ef\u7406\u89e3\u6027\u3002</p> </li> <li> <p>\u68c0\u6d4b\u4ee3\u7801\u4e2d\u5305\u3001\u7c7b\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a\u5206\u6790\u7c7b\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u5426\u5408\u7406\uff0c\u590d\u6742\u5ea6\u60c5\u51b5\u3002</p> </li> </ul>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#12","title":"1.2 \u7ec4\u4ef6","text":"<ul> <li>SonarQube Server\uff1asonarqube\u670d\u52a1\u7aef\uff0c\u63a5\u53d7\u5ba2\u6237\u7aef\u626b\u63cf\u62a5\u544a</li> <li>SonarQube Database\uff1aES/\u53ca\u6570\u636e\u5e93\u5f15\u64ceoracle\uff0cpostgresql\uff0cmssql</li> <li>SonarQube Plugins\uff1a\u53ef\u4ee5\u540e\u671f\u5728sonarqube\u670d\u52a1\u7aef\u5b89\u88c5\u63d2\u4ef6</li> <li>SonarQube Scanner\uff1a\u5b89\u88c5\u5728\u5ba2\u6237\u7aef\u626b\u63cf\u5de5\u5177</li> </ul>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#13","title":"1.3 \u67b6\u6784\u56fe","text":"<p>\u5f00\u53d1\u4eba\u5458\u628a\u4ee3\u7801push\u5230SCM\uff08\u5982gitlab\uff09-&gt;jenkins\u6784\u5efa\u5b9a\u4e49\u597d\u7684job\uff0c\u7136\u540e\u901a\u8fc7jenkins \u63d2\u4ef6\uff08sonar scanner\uff09\u5206\u6790\u6e90\u7801-&gt;jenkins/gitlab-ci \u4e2d\u7684scanner\u5ba2\u6237\u7aef\u628a\u5206\u6790\u62a5\u544a\u53d1\u5230sonarqube server</p>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#_2","title":"\u4e8c \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#21-sonarqube-server","title":"2.1 SonarQube Server\u5b89\u88c5","text":""},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#211","title":"2.1.1 \u5bbf\u4e3b\u673a\u6d4b\u8bd5\u73af\u5883\u7b80\u5355\u90e8\u7f72","text":"<pre><code># \u4e0b\u8f7d\nwget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.9.1.zip\n# \u89e3\u538b\n/opt/sonarqube/\nunzip /opt/sonarqube/bin/[OS]/sonar.sh console\n\n# \u767b\u5f55\u5bbf\u4e3b\u673ahttp://localhost:9000 \uff08admin/admin\uff09\n</code></pre>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#212","title":"2.1.2 \u5bbf\u4e3b\u673a\u751f\u4ea7\u73af\u5883\u90e8\u7f72","text":"<pre><code># \u5bbf\u4e3b\u673arequirementes\nsysctl -w vm.max_map_count=262144\nsysctl -w fs.file-max=65536\nulimit -n 65536\nulimit -u 4096\n\ncat &gt;&gt; /etc/sysctl.conf  &lt;&lt; EOF\nvm.max_map_count=262144\nfs.file-max=65536\nEOF\n\n\n# sonarqube\u4e0d\u80fd\u7528root\u7528\u6237\u6267\u884c\nuseradd sonarqube\necho \"sonarqubepwd\" | passwd --stdin sonarqube\n\n# \u68c0\u67e5\u7cfb\u7edf\n[root@devops-sonarqube ~]# grep SECCOMP /boot/config-$(uname -r)\nCONFIG_HAVE_ARCH_SECCOMP_FILTER=y\nCONFIG_SECCOMP_FILTER=y\nCONFIG_SECCOMP=y\n\ncat &gt; /etc/security/limits.d/99-sonarqube.conf &lt;&lt;EOF\nsonarqube   -   nofile   65536\nsonarqube   -   nproc    65535\nEOF\n\n# sonarqube es\u9700\u8981\u5b89\u88c5\u5b89\u88c5jdk11\nyum -y install java-11-openjdk.x86_64\n\n\n# 7.9\u6700\u65b0\u7248\u672c\u4e0d\u652f\u6301mysql\uff0c\u6570\u636e\u5e93\u652f\u6301MSSQL/Oracle/PostgreSQL\n# \u5b89\u88c5PostgreSQL\n# \u521b\u5efasonarqube\u7528\u6237\uff0c\u6388\u6743\u7528\u6237create, update, and delete\u6743\u9650\n# \u5982\u679c\u60f3\u81ea\u5b9a\u4e49\u6570\u636e\u5e93\u540d\u79f0\uff0c\u4e0d\u7528pulic\uff0c\u5219\u9700\u8981\u641c\u7d22\u8def\u5f84\u4fee\u6539\nyum install -y https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-centos96-9.6-3.noarch.rpm\nyum install -y postgresql96-server postgresql96-contrib\n/usr/pgsql-9.6/bin/postgresql96-setup initdb\nsystemctl start postgresql-9.6\nsystemctl enable postgresql-9.6\nsu - postgres\npsql\ncreate user sonarqube with password 'sonarqube';\ncreate database sonarqube owner sonarqube;\ngrant all  on database sonarqube to sonarqube;\n\\q \n\n# \u67e5\u770bpostgresql\u76d1\u542c\nvi /var/lib/pgsql/9.6/data/postgresql.conf\n\n# \u914d\u7f6e\u767d\u540d\u5355\nvi /var/lib/pgsql/9.6/data/pg_hba.conf\nhost    all              all             127.0.0.1/32           md5\n#\u91cd\u542f\u670d\u52a1\nsystemctl restart postgresql-9.6\n\nss -tan | grep 5432\n# \u521b\u5efa\u5e93/\u7528\u6237\uff0c\u5e76\u6388\u6743\npsql -h 127.0.0.1 -p 5432  -U postgres\n\n\n# \u4e0b\u8f7d\u8f6f\u4ef6\u5305\ncd /opt &amp;&amp; wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.9.1.zip\nln -sv sonarqube-7.9.1 sonarqube\nchown sonarqube.sonarqube sonarqube/* -R\n\n# \u5207\u6362\u5230\u7cfb\u7edfsonarqube\u7528\u6237\u5f00\u59cb\u5b89\u88c5\nsu - sonarqube\n\n# \u8bbe\u7f6e\u6570\u636e\u5e93\u8bbf\u95ee\uff0c\u7f16\u8f91$SONARQUBE-HOME/conf/sonar.properties\nsonar.jdbc.username=sonarqube\nsonar.jdbc.password=sonarqube\n# \u6ce8\u610f\u4e3a127.0.0.1\nsonar.jdbc.url=jdbc:postgresql://127.0.0.1/sonarqube\n\n# \u914d\u7f6eES\u5b58\u50a8\u8def\u5f84\uff0c\u7f16\u8f91SONARQUBE-HOME/conf/sonar.properties \nsonar.path.data=/var/sonarqube/data\nsonar.path.temp=/var/sonarqube/temp\n\n# \u914d\u7f6eweb server\uff0c\u7f16\u8f91SONARQUBE-HOME/conf/sonar.properties\nsonar.web.host=192.0.0.1\nsonar.web.port=80\nsonar.web.context=/sonarqube\n\n# web\u670d\u52a1\u5668\u6027\u80fd\u8c03\u4f18\n$SONARQUBE-HOME/conf/sonar.properties\nsonar.web.javaOpts=-server\n\n\n$SONARQUBE-HOME/conf/wrapper.conf \nwrapper.java.command=/path/to/my/jdk/bin/java\n\n\n# \u6267\u884c\u542f\u52a8\u811a\u672c\nStart:\n$SONAR_HOME/bin/linux-x86-64/sonar.sh start\n\nGraceful shutdown:\n$SONAR_HOME/bin/linux-x86-64/sonar.sh stop\n\nHard stop:\n$SONAR_HOME/bin/linux-x86-64/sonar.sh force-stop\n\n# \u63d2\u4ef6\u5b89\u88c5\n1.Marketplace\u65b9\u5f0f\u5b89\u88c5\uff08Administration &gt; Marketplace\uff09\n2.\u624b\u52a8\u5b89\u88c5\uff08\u5c06\u4e0b\u8f7d\u597d\u7684\u63d2\u4ef6\u4e0a\u4f20\u81f3\u670d\u52a1\u5668\u76ee\u5f55\uff1a$SONARQUBE_HOME/extensions/plugins\uff0c\u91cd\u542fsonarqube\u670d\u52a1\uff09\n</code></pre>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#213-docker","title":"2.1.3 docker\u65b9\u5f0f\u90e8\u7f72","text":"<pre><code>docker pull sonarqube\n\ndocker run -d --name sonarqube -p 9000:9000 sonarqube\n\n# \u5206\u6790mvn\u9879\u76ee\n# On Linux:\n$ mvn sonar:sonar\n\n# With boot2docker:\n$ mvn sonar:sonar -Dsonar.host.url=http://$(boot2docker ip):9000\n\n# docker\u4e3b\u673a\u7cfb\u7edf\u8981\u6c42\nsysctl -w vm.max_map_count=262144\nsysctl -w fs.file-max=65536\nulimit -n 65536\nulimit -u 4096\n</code></pre>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#22-gitlab","title":"2.2 Gitlab\u96c6\u6210","text":""},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#221-sonar-scanner","title":"2.2.1 sonar-scanner\u5b89\u88c5","text":"<p>\u7531\u4e8egitlab\u9879\u76ee\u8f83\u591a\uff0c\u5171\u7528\u4e86gitlab-runner\uff0c\u56e0\u6b64\u5728gitlab-runner\u5b89\u88c5sonner-scanner\u5373\u53ef\uff0c\u53ef\u901a\u7528\u5bf9\u6784\u5efa\u7684\u9879\u76ee\u8fdb\u884c\u626b\u63cf</p> <pre><code># \u4e0b\u8f7d\u5b89\u88c5\ncd /opt &amp;&amp; wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.0.0.1744-linux.zip\n\n# \u6dfb\u52a0\u8fdbPATH\nmv sonar-scanner-4.0.0.1744-linux sonar-scanner\ncat &gt; /etc/profile.d/sonar-scanner.sh &lt;&lt;EOF\nexport PATH=$PATH:/opt/sonar-scanner/bin\nEOF\nsource /etc/profile.d/sonar-scanner.sh\n\n[root@common-runner ~]# sonar-scanner -h\nINFO: \nINFO: usage: sonar-scanner [options]\nINFO: \nINFO: Options:\nINFO:  -D,--define &lt;arg&gt;     Define property\nINFO:  -h,--help             Display help information\nINFO:  -v,--version          Display version information\nINFO:  -X,--debug            Produce execution debug output\n</code></pre>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#222-sonarqube-web","title":"2.2.2 sonarqube web\u914d\u7f6e\u9879\u76ee","text":"<p>Create new project-&gt;Provide a token-&gt;</p> <p></p> <p></p>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#223-gitlab-ci","title":"2.2.3 \u914d\u7f6egitlab-ci","text":"<p>Gitlab ci/cd\u53d1\u5e03 vue\u9879\u76ee</p> <pre><code>stages:\n  - sonarqube_scan\n  - deploy_src\n  - check_server\n\nvariables:\n  RUNNER_HOME: \"/home/gitlab-runner/builds/1sWu8AdN/0/haoxing\"\n  BASE_DIR: \"/smartms_frontendadmin/\"\n\njob sonarqube_scan_job:\n  stage: sonarqube_scan\n  script:\n    - sonar-scanner -Dsonar.projectKey=smartms_frontendadmin_test -Dsonar.sources=. -Dsonar.host.url=http://43.254.54.93:9000 -Dsonar.login=a393276921f1f3307a316dd88a7fe5203004a714\n  tags:\n    - smartms-frontend-test\n  only:\n    - develop\n  when: always\n\njob deploy_src_job:\n  stage: deploy_src\n  cache:\n    paths:\n    - node_modules/\n  script:\n    - cnpm install\n    - cnpm install vue-cli\n    - cnpm run build\n    - rsync -az --delete ${RUNNER_HOME}${BASE_DIR}dist/ /data/dist/\n  tags:\n    - smartms-frontend-test\n  only:\n    - develop\n  when: always\n\njob check_server_job:\n  stage: check_server\n  script:\n    - netstat -lntup |grep nginx\n  tags:\n    - smartms-frontend-test\n  only:\n    - develop\n  when: always\n</code></pre> <p>\u53d1\u5e03python\u9879\u76ee</p> <pre><code>stages:\n  - sonarqube_scan\n  - deploy_src\n  - install_dependency\n  - restart_server\n  - check_server\n\nvariables:\n  RUNNER_BASE_DIR: \"/home/gitlab-runner/builds/QFafxxxEq/0/devops/\"\n  BASE_DIR: \"/go2cloud_api/\"\n\njob sonarqube_scan_job:\n  stage: sonarqube_scan\n  # \u6ce8\u610f\uff0c\u6b64\u7528\u6237\u4e3agitlab-runner\u6267\u884c\uff0c\u6307\u5b9a/.\u4e3a\u6b64\u9879\u76ee\u76ee\u5f55\n  script:\n    - sonar-scanner -Dsonar.projectKey=go2cloud_api_test -Dsonar.sources=/. -Dsonar.host.url=http://43.xxx.xxx.xxx:9110 -Dsonar.login=a393276xxxxxxxxxxxxxxxxxxx03004a714\n  tags:\n    - 51common-runner\n  only:\n    - go2cloud-platform-test\n  when: always\n\njob deploy_src_job:\n  stage: deploy_src\n  script:\n    - scp -r ${RUNNER_BASE_DIR}${BASE_DIR}* root@172.16.100.5:/project${BASE_DIR}\n  tags:\n    - 51common-runner\n  only:\n    - go2cloud-platform-test\n  when: always\n</code></pre> <p></p> <p>\u63d0\u4ea4\u4ee3\u7801\u6d4b\u8bd5\uff1a</p> <p></p> <p>\u67e5\u770b\u8fd0\u884cjob</p> <p></p> <p>\u67e5\u770bsonarqube\u9879\u76ee</p> <p>![image-20190810110741896](/Users/xuel/Library/Application Support/typora-user-images/image-20190810110741896.png</p> <p></p> <p>\u67e5\u770b\u8be6\u60c5</p> <p></p>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#23-jenkins","title":"2.3 jenkins\u96c6\u6210","text":"<p>\u53ef\u4ee5\u5229\u7528\u63d2\u4ef6\u96c6\u6210\uff0c\u4e5f\u53ef\u4ee5\u5c06sonar-scanner \u5b89\u88c5\u5728jenkins\u670d\u52a1\u533a\u4e0a\u9762\uff0c\u6bcf\u6b21\u8fdb\u884c\u5de5\u5177\u626b\u63cf\u3002</p>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#231-sonar-scanner","title":"2.3.1 sonar-scanner\u5b89\u88c5","text":"<p>sonar-scanner\u5b89\u88c5\u548cgitlab-runner\u4e0a\u5b89\u88c5\u4e00\u6837\uff0c\u8be6\u89c1\uff1a2.2.1 sonar-scanner\u5b89\u88c5</p> <p>\u53ef\u4ee5\u4e24\u79cd\u65b9\u5f0f\u96c6\u6210\uff1a\u76f4\u63a5\u5728\u6784\u5efa\u7684\u65f6\u5019\u6267\u884c\u626b\u63cf\u547d\u4ee4\u5206\u6790\u62a5\u544a\uff0c\u63d2\u4ef6\u5f62\u5f0f\u96c6\u6210\u3002</p>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#232-job","title":"2.3.2 \u96c6\u6210job","text":""},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#2321","title":"2.3.2.1 \u811a\u672c\u6784\u5efa\u96c6\u6210","text":"<p>\u5728\u6784\u5efa\u7684\u65f6\u5019\u5229\u7528\u5b89\u88c5\u597d\u7684sonar-scanner\u547d\u4ee4\u96c6\u6210</p> <pre><code># \u914d\u7f6ePATH\nexport PATH=/data/apps/miniconda3/bin:/data/apps/miniconda3/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/data/apps/miniconda3/bin:/data/apps/software/sonar-scanner/bin:/root/bin\n# \u6307\u5b9ajenkins\u7684workspace\u76ee\u5f55\nBASE_DIR=/root/.jenkins/workspace/\n# \u6307\u5b9a\u9879\u76ee\u540d\u79f0\uff0c\u6b64job\u7684\u540d\u79f0\nPROJECT=go2cloud_api_prod_job\n# \u6307\u5b9aconda\u4e2d\u9879\u76ee\u7684\u865a\u62df\u73af\u5883\nPROJECT_ENV=go2cloud-api-prod-env\n# \u5207\u6362python\u73af\u5883\nsource activate ${PROJECT_ENV}\n$(which python) -m pip install mock nose coverage\n# \u66f4\u65b0python\u73af\u5883\necho \"++++++++++++++++++++++++++++++\u66f4\u65b0Python\u73af\u5883+++++++++++++++++++++++++++++++++++++++\"\n\nif [ -f ${BASE_DIR}${PROJECT}/requirements.txt ];then\n    $(which python) -m pip install -r ${BASE_DIR}${PROJECT}/requirements.txt &amp;&amp; echo 0 || echo 0\nfi\n\n# \u4ee3\u7801\u68c0\u67e5/\u5355\u5143\u6d4b\u8bd5/\u4ee3\u7801\u6d4b\u8bd5\u8986\u76d6\u7387\necho \"+++++++++++++++++++++++++++++++\u4ee3\u7801\u68c0\u67e5+++++++++++++++++++++++++++++++++++++++\"\ncd ${BASE_DIR}\n# \u751f\u6210pylint.xml\n$(which pylint) -f parseable --disable=C0103,E0401,C0302 $(find ${PROJECT}/* -name *.py) &gt;${BASE_DIR}${PROJECT}-pylint.xml || echo 0\n\n#echo \"+++++++++++++++++++++++++++++++\u5355\u5143\u6d4b\u8bd5+++++++++++++++++++++++++++++++++++++++\"\n# \u751f\u6210nosetests.xml\n#$(which nosetests) --with-xunit --all-modules --traverse-namespace --with-coverage --cover-package=go2cloud-api-deploy-prod --cover-inclusive || echo 0\n#$(which nosetests) --with-xunit --all-modules --traverse-namespace --with-coverage --py3where=${PROJECT} --cover-package=${PROJECT} --cover-inclusive || echo 0\n#echo \"+++++++++++++++++++++++++++++++\u4ee3\u7801\u8986\u76d6\u7387+++++++++++++++++++++++++++++++++++++++\"\n# \u751f\u6210coverage.xml\n# -m coverage xml --include=${PROJECT}* || echo 0\n\n# sonarqube \u4ee3\u7801\u626b\u63cf\nsonar-scanner \\\n  -Dsonar.projectKey=go2cloud_api_prod \\\n  -Dsonar.sources=${BASE_DIR}${PROJECT}/. \\\n  -Dsonar.host.url=http://xxx.xxx.xxx.xxx:9100 \\\n  -Dsonar.login=2194d90xxxxxxxxxxxxxxxxxxxxxxxxbec7f69\n</code></pre> <p></p> <p>\u8fd0\u884c\u9879\u76ee\u67e5\u770b</p> <p></p> <p>\u67e5\u770bsonarqube\u9879\u76ee</p> <p></p> <p></p> <p></p>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#2322","title":"2.3.2.2 \u63d2\u4ef6\u5f62\u5f0f\u96c6\u6210","text":"<ul> <li>jenkins\u670d\u52a1\u5668scanner\u914d\u7f6e</li> </ul> <pre><code># \u5982\u679c\u5728\u6784\u5efa\u4e2d\u672a\u6307\u5b9a\u5c06\u626b\u63cf\u62a5\u544a\u53d1\u9001\u7ed9server\u7aef\u5730\u5740\uff0c\u9700\u8981\u5728\u5ba2\u6237\u7aef\u4e2d\u914d\u7f6e,\u5728\u5b89\u88c5\u597dscanner\u7684conf\u76ee\u5f55\u4e0b\u4fee\u6539\uff1asonar-scanner.properties \u670d\u52a1\u7aef\u7684\u5730\u5740\nsonar.host.url=http://xxx.xxx.xxx.xxx:9100\n</code></pre> <ul> <li>jenkins\u670d\u52a1\u5668\u5b89\u88c5scanner</li> </ul> <ul> <li>\u5de5\u5177\u4e2d\u914d\u7f6escanner</li> </ul> <ul> <li>sonarqube server\u751f\u4ea7token</li> </ul> <p>\u9700\u8981\u5728sonarqube server\u914d\u7f6ejenkins\u7684api token\uff0c\u7528\u6765jenkins\u5c06\u62a5\u544a\u53d1\u9001\u7ed9sonarqube server</p> <p></p> <ul> <li>\u5168\u5c40\u5de5\u5177\u914d\u7f6e\u4e2d\u6dfb\u52a0SonarQube servers</li> </ul> <p>jenkins\u5229\u7528sonarqube\u7684token\u521b\u5efa\u51ed\u636e</p> <p></p> <p></p> <ul> <li>\u6784\u5efa\u9879\u76ee\u914d\u7f6e</li> </ul> <p></p> <p>\u6839\u636e\u626b\u63cf\u7684\u7a0b\u5e8f\u8bed\u8a00\u586b\u5199\u5bf9\u5e94\u7684analysis properties\uff0c\u5728\u6b64\u586b\u5199\u9879\u76ee\u76f8\u5173\u4fe1\u606f\u3002</p> <p>\u5982\u679c\u4f7f\u7528pipeline\uff0c\u53ef\u4ee5\u53c2\u8003\u58f0\u660e\u5f0f\u793a\u4f8b</p> <pre><code>pipeline {\n    agent any\n    stages {\n        stage('SonarQube analysis 1') {\n            steps {\n                sh 'mvn clean package sonar:sonar'\n            }\n        }\n        stage(\"Quality Gate 1\") {\n            steps {\n                waitForQualityGate abortPipeline: true\n            }\n        }\n        stage('SonarQube analysis 2') {\n            steps {\n                sh 'gradle sonarqube'\n            }\n        }\n        stage(\"Quality Gate 2\") {\n            steps {\n                waitForQualityGate abortPipeline: true\n            }\n        }\n    }\n}\n</code></pre> <ul> <li>\u67e5\u770b\u626b\u63cf\u7ed3\u679c</li> </ul> <p>\u5728jenkins\u4e0a\u9762\u914d\u7f6e\u4e86projectname\uff0c\u5728sonarqube\u4e0a\u5c31\u4e0d\u7528\u914d\u7f6e\u9879\u76ee</p> <p></p>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#_3","title":"\u4e09 \u601d\u8003","text":"<ul> <li>\u96c6\u6210\u573a\u666f\u7531\u4e8e\u9879\u76ee\u540e\u7aef\u4e3apython\uff0c\u5728\u6b64\u6ca1\u6709\u7f16\u8bd1\uff0cjava\u9879\u76ee\u9700\u8981\u5b89\u88c5\u5bf9\u5e94mvn\u6216\u5176\u4ed6\u7f16\u8bd1\u5de5\u5177\uff0c</li> <li>\u6d4b\u8bd5\u73af\u5883\u4e4b\u95f4\u4e3agitlab ci/cd\uff0c\u6b63\u5f0f\u73af\u5883\u5229\u7528jenkins\u53d1\u5e03</li> <li>\u5bf9\u6bd4jenkins\u811a\u672c\u96c6\u6210\u548c\u63d2\u4ef6\u65b9\u5f0f\u96c6\u6210\uff0c\u53ef\u4ee5\u53d1\u73b0\u811a\u672c\u65b9\u5f0f\u9700\u8981\u5728\u4e24\u8fb9\u90fd\u914d\u7f6e\uff0c\u800c\u4e14\u9488\u5bf9\u4e0d\u540c\u7684\u9879\u76ee\uff0c\u6bcf\u6b21\u90fd\u9700\u8981\u7533\u8bf7token\u548c\u5173\u8054\u9879\u76ee\u7b14\u8bb0\u6bd4\u8f83\u9ebb\u70e6\uff0c\u63d2\u4ef6\u5f62\u5f0f\u4e00\u6b21\u914d\u7f6e\u597d\uff0c\u5c31\u4e0d\u7528\u5728\u53bbsonarqube\u4e0a\u53bb\u914d\u7f6e\uff0c\u4e4b\u540e\u914d\u7f6ejenkins\u7684job\u53ea\u9700\u8981\u914d\u7f6e\u7b80\u5355\u7684projectname\u5373\u53ef\uff0c\u6bd4\u8f83\u65b9\u4fbf\u3002</li> </ul>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#_4","title":"\u56db \u9519\u8bef\u5904\u7406","text":"<ul> <li>Gitlab-runner\u8f93\u51fa\u9650\u5236\uff0cgitlab\u754c\u9762\u663e\u793a\u4e0d\u5168<code>ob's log exceeded limit of 4194304 bytes.</code></li> </ul> <pre><code>https://gitlab.com/gitlab-org/gitlab-runner/blob/master/docs/configuration/advanced-configuration.md#the-runners-section\n</code></pre>"},{"location":"devops/other/SonarQube%E9%9B%86%E6%88%90gitlab%3Ajenkins/#_5","title":"\u4e94 \u53c2\u8003\u94fe\u63a5\uff1a","text":"<ul> <li>Docker\u955c\u50cf</li> <li>\u5b98\u65b9\u6587\u6863</li> <li> <p>postgresql\u5e38\u7528\u547d\u4ee4</p> </li> <li> <p>sonarqube\u5347\u7ea7</p> </li> </ul>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/","title":"TAPD \u96c6\u6210 GitLab","text":""},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#_1","title":"\u4e00 \u80cc\u666f","text":""},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#11","title":"1.1 \u9700\u6c42","text":"<p>\u5f00\u53d1\u4eba\u5458\u63d0\u4ea4\u7684\u4ee3\u7801\u65e0\u6cd5\u81ea\u52a8\u548ctapd\u4e0a\u7684story\u6216task\u76f8\u5173\u8054\uff0c\u9700\u8981\u4eba\u5de5\u5f3a\u5236\u5c06\u63d0\u4ea4\u7684\u5408\u5e76\u8bf7\u6c42\u4e0etapd\u4e0a\u9762\u7684ID\u5173\u8054\uff0c\u4e14\u65e0\u6cd5\u65e0\u6cd5\u5f62\u6210\u6709\u6548\u8bb0\u5f55\u548c</p> <p>\u9700\u8981tapd\u4e0egitlab\u8054\u52a8\uff0ctapd\u63d0\u4f9b\u6e90\u7801\u63d0\u4ea4\u8d8b\u52bf\uff0c\u5e76\u81ea\u52a8\u5173\u8054\u63d0\u4ea4\u7684\u3002</p> <p>\u5728Gitlab CI\u5b8c\u6210\u540e\u914d\u7f6e\u6d88\u606f\u901a\u77e5\uff0c\u68c0\u6d4b\u670d\u52a1\u5668\u5f02\u5e38\uff0c\u5df2\u7ecfpipeline\u53d1\u5e03\u72b6\u6001\uff0c\u8fdb\u884c\u901a\u77e5\u3002</p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#12","title":"1.2 \u573a\u666f","text":"<ul> <li>gitlab \u63d0\u4ea4\u4ee3\u7801\u5e26\u4e0acommit\u53f7\uff0c\u5728tapd\u4e0a\u5173\u8054\u56fe\u5f62\u5316\u5c55\u793a</li> <li>tapd\u6d41\u6c34\u7ebf\u96c6\u6210\u4f01\u4e1a\u4f7f\u7528\u6301\u7eed\u96c6\u6210\u5e73\u53f0\uff0c\u5c06\u6301\u7eed\u96c6\u6210\u5e73\u53f0\u6570\u636e\u5728tapd\u6d41\u6c34\u7ebf\u53ef\u89c6\u5316\u3002</li> <li>\u901a\u8fc7\u4f01\u4e1a\u5fae\u4fe1\u673a\u5668\u4eba\u5bf9\u6d41\u6c34\u7ebf\u8fdb\u884c\u901a\u77e5\u3002</li> </ul>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#gitlab","title":"\u4e8c Gitlab\u914d\u7f6e","text":""},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#21-webhook","title":"2.1 \u83b7\u53d6webhook\u4fe1\u606f","text":"<ul> <li>\u5728Tapd\u7684\u9879\u76ee\u4e2d\u7684\u5e94\u7528\u914d\u7f6e-&gt;\u6dfb\u52a0\u5e94\u7528-&gt;Gitlab\u6e90\u7801</li> </ul> <ul> <li>\u5f00\u542fSecret Token\uff0c\u83b7\u53d6\u5230webhook url\u548c\u9879\u76eetoken</li> </ul> <p>DevOPS\u9879\u76eewebhook:</p> <pre><code>Webhook URL:https://www.tapd.cn/hook/index/67659124/6930c28927370ecfb819991d0cc2c730\nSecret Token:af07d39ff1f8cb90660bb3799e840c03\n</code></pre> <p></p> <p>\u5f53gitlab \u63d0\u4ea4\u4ee3\u7801\u7684\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7POST\u8bf7\u6c42\u901a\u77e5\u5230TAPD\u4e2d\u3002</p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#22-gitlab-ci","title":"2.2 \u5173\u8054Gitlab CI","text":"<ul> <li>\u5728Gitlab \u9879\u76ee\u4e2d\u96c6\u6210tapd</li> </ul> <p>\u5728\u9879\u76ee-&gt;\u8bbe\u7f6e-&gt;\u96c6\u6210\u4e2d\u65b0\u589ewebhook\u3002</p> <p></p> <p></p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#tapd","title":"\u4e09 Tapd\u914d\u7f6e\u6d41\u6c34\u7ebf","text":""},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#31","title":"3.1 \u4ee3\u7801\u5173\u8054","text":""},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#32","title":"3.2 \u6301\u7eed\u96c6\u6210\u5173\u8054","text":"<p>\u5173\u8054\u5de5\u5177\u5e73\u53f0\uff0cTAPD\u652f\u6301\u5173\u8054Jenkins\u3001Gitlab CI\u7b49\u5de5\u5177\u5e73\u53f0\u3002\u901a\u8fc7\u4e0eTAPD\u8fdb\u884c\u8054\u7cfb\uff0c\u53ef\u4ee5\u5728TAPD\u67e5\u770b\u6307\u5b9a\u6784\u5efa\u4efb\u52a1\u7684\u8303\u56f4\u3001\u7ed3\u679c\u4e0e\u6784\u5efa\u5386\u53f2\u3002</p> <p></p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#33","title":"3.3 \u4ee3\u7801\u8d28\u91cf\u5206\u6790","text":"<p>TAPD\u652f\u6301\u5173\u8054\u4e3b\u6d41\u4ee3\u7801\u68c0\u6d4b\u5de5\u5177\u3002\u53ef\u4ee5\u5c06\u56e2\u961f\u6b63\u5728\u4f7f\u7528\u7684\u68c0\u6d4b\u5de5\u5177\u4e0eTAPD\u8fdb\u884c\u5173\u8054\uff0c\u901a\u8fc7TAPD\u6d41\u6c34\u7ebf\u67e5\u770b\u6bcf\u6b21\u4ee3\u7801\u626b\u63cf\u7ed3\u679c\uff0c\u8fdb\u884c\u95ee\u9898\u8ddf\u8e2a\u4e0e\u89e3\u51b3\u3002</p> <p>\u4ee3\u7801\u8d28\u91cf\u68c0\u6d4b\u4f9d\u8d56\u4e8e\u5df2\u5173\u8054\u7684\u6301\u7eed\u96c6\u6210\u670d\u52a1\u3002\u4ee5Jenkins\u4e3a\u4f8b\uff0c\u5728Jenkins\u4e2d\u5b89\u88c5SonarQube\u670d\u52a1\u53ca\u63d2\u4ef6\uff0c\u5728\u5df2\u5173\u8054\u7684\u6784\u5efa\u4efb\u52a1\u4e2d\u914d\u7f6eSonarQube\u6b65\u9aa4\uff0c\u5373\u53ef\u901a\u8fc7TAPD\u6d41\u6c34\u7ebf\u67e5\u770b\u6bcf\u6b21\u8d28\u91cf\u5206\u6790\u6570\u636e\u3002</p> <p></p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#34","title":"3.4 \u5236\u54c1\u7ba1\u7406","text":"<p>\u5236\u54c1/\u5305\u7ba1\u7406\u4f9d\u8d56\u4e8e\u5df2\u5173\u8054\u7684\u6301\u7eed\u96c6\u6210\u670d\u52a1\u3002\u4ee5Jenkins\u4e3a\u4f8b\uff0c\u5728Jenkins\u4e2d\u5b89\u88c5Nexus\u63d2\u4ef6\uff0c\u901a\u8fc7\u5728\u6784\u5efa\u4efb\u52a1\u4e2d\u6dfb\u52a0Nexus Repository Manager Publisher \u6b65\u9aa4\uff0c\u5373\u53ef\u5c06\u6bcf\u6b21\u6784\u5efa\u5236\u54c1\u4fe1\u606f\u5c55\u793a\u5728TAPD\u6d41\u6c34\u7ebf\u4e2d\u3002</p> <p></p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#35","title":"3.5 \u81ea\u52a8\u5316\u6d4b\u8bd5","text":"<p>\u81ea\u52a8\u5316\u6d4b\u8bd5\u6267\u884c\u4f9d\u8d56\u4e8e\u5df2\u5173\u8054\u7684\u6301\u7eed\u96c6\u6210\u670d\u52a1\u3002\u4ee5Jenkins\u4e3a\u4f8b\uff0c\u5728Jenkins \u6784\u5efa\u4efb\u52a1\u4e2d\u914d\u7f6e\u81ea\u52a8\u5316\u6d4b\u8bd5\u6b65\u9aa4\uff0c\u5e76\u5728\u6784\u5efa\u540e\u6b65\u9aa4\u4e2d\u6dfb\u52a0\u201cTAPD\u81ea\u52a8\u5316\u6d4b\u8bd5\u62a5\u544a\u89e3\u6790\u201d\u4efb\u52a1\uff0c\u586b\u5199\u81ea\u52a8\u5316\u6d4b\u8bd5\u7ed3\u679c\u6587\u4ef6\u8def\u5f84\uff0c\u5373\u53ef\u5728TAPD\u6d41\u6c34\u7ebf\u4e2d\u67e5\u770b\u7528\u4f8b\u6267\u884c\u60c5\u51b5\u53ca\u6d4b\u8bd5\u62a5\u544a\u3002</p> <p></p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#36","title":"3.6 \u53d1\u5e03\u90e8\u7f72","text":"<p>\u90e8\u7f72\u53d1\u5e03\u4f9d\u8d56\u4e8e\u5df2\u5173\u8054\u7684\u6301\u7eed\u96c6\u6210\u670d\u52a1\u3002\u4ee5Jenkins\u4e3a\u4f8b\uff0c\u5728Jenkins\u4e2d\u5b89\u88c5Ansible\u63d2\u4ef6\uff0c\u901a\u8fc7\u5728\u6784\u5efa\u4efb\u52a1\u4e2d\u6dfb\u52a0 Invoke Ansible Playbook\u6b65\u9aa4\uff0c\u5373\u53ef\u5728TAPD\u6d41\u6c34\u7ebf\u4e2d\u67e5\u770b\u90e8\u7f72\u53d1\u5e03\u4fe1\u606f\u3002</p> <p></p> <p>\u96c6\u6210\u5b8c\u6210\u540e\uff0c\u540e\u7eed\u5c31\u53ef\u4ee5\u901a\u8fc7gitlab \u4e0etapd\u8fdb\u884c\u8054\u52a8\uff0c\u4ecetapd\u4e0a\u8df3\u8f6c\u5230gitlab\u5bf9\u5e94\u7684\u4ee3\u7801\u63d0\u4ea4\u9875\u9762\u3002</p> <p>\u6ce8\u610f\uff1a\u5728\u63d0\u4ea4\u4ee3\u7801\u7684\u65f6\u5019\u89c4\u8303\uff1a</p> <pre><code># \u5148\u5199\u81ea\u5df1\u4fee\u6539\u7684\u5185\u5bb9\uff1a\nfix: fix src_info\n---\n# \u590d\u5236story\u4e2d\u7684\u6e90\u7801\u63d0\u4ea4\u5173\u952e\u5b57\n--story=1008370 --user=\u859b\u78ca \u3010\u793a\u4f8b\u3011\u7236\u9700\u6c42 https://www.tapd.cn/48151165/s/1014039\n</code></pre> <p></p> <p>\u5728gitlab \u63d0\u4ea4\u4ee3\u7801\uff0c\u5728tapd\u67e5\u770b\u6d41\u6c34\u7ebf\u8be6\u60c5\uff1a</p> <p></p> <p></p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#gitlab-ci","title":"\u56db gitlab CI\u901a\u8fc7\u4f01\u4e1a\u5fae\u4fe1\u673a\u5668\u4eba\u901a\u77e5","text":""},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#41-webhook","title":"4.1 \u83b7\u53d6\u4f01\u4e1a\u5fae\u4fe1\u673a\u5668\u4ebawebhook","text":"<p>\u53ef\u4ee5\u5728\u6700\u540e\u4e00\u6b65\u901a\u8fc7\u4f01\u4e1a\u5fae\u4fe1\u673a\u5668\u4eba\u901a\u77e5\u6784\u5efa\u6d88\u606f\u3002</p> <p>\u53ef\u4ee5\u5148\u5728\u4f01\u4e1a\u5fae\u4fe1\u62c9\u53d6\u7814\u53d1\u4eba\u5458\u7fa4\uff0c\u5229\u7528\u624b\u673a\u64cd\u4f5c\u5728\u7fa4\u5185\u62c9\u53bb\u673a\u5668\u4eba\uff0c\u4e4b\u540e\u5728\u6784\u5efa\u7684\u65f6\u5019\u901a\u8fc7\u673a\u5668\u4eba\u901a\u77e5\u3002</p> <p>\u673a\u5668\u4eba\u7684webhook\u5982\u4e0b\uff1a</p> <pre><code>https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=777c9eaa-df67-4c69-9b0b-06394c067f5c\n</code></pre>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#42-gitlab-webhook","title":"4.2 gitlab \u914d\u7f6e\u673a\u5668\u4ebawebhook","text":"<p>\u4e3a\u4fdd\u969c\u5fae\u4fe1\u673a\u5668\u4ebawebhook \u7684\u5b89\u5168\u6027\uff0c\u5c06\u5176\u914d\u7f6e\u5728\u7ec4\u7684\u73af\u5883\u53d8\u91cf\u4e2d\uff0c\u65b9\u4fbf\u5728ci\u4e2d\u8fdb\u884c\u5f15\u7528\u3002</p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#43-gitlab-ci","title":"4.3 \u5728gitlab ci\u4e2d\u96c6\u6210\u901a\u77e5","text":"<p>\u7531\u4e8e\u4f7f\u7528\u4e86gitlab \u5171\u4eab\u6a21\u7248\u5e93\uff0c\u96c6\u6210\u975e\u5e38\u65b9\u4fbf\uff0c\u53ea\u9700\u5728gitlabci-templates\u7684check job\u4e2d\u96c6\u6210\u5373\u53ef</p> <pre><code>.check:\n  script:\n    - echo -e \"\\033[5;35;40m check ${APP_NAME} in k8s ${DEPLOY_ENV} environment status... \\033[0m\"\n    - kubectl rollout status -w --timeout=300s deployment/${APP_NAME}-deploy -n ${NAMESPACE} &amp;&amp;\n      curl ${WECHAT_WEBHOOK} -H 'Content-Type:application/json' -d \"{\\\"msgtype\\\":\\\"markdown\\\",\\\"markdown\\\":{\\\"content\\\":\\\"${PROJECT_NAME}\u9879\u76ee\u6784\u5efa\u7ed3\u679c\uff1a&lt;font color=\\\\\"info\\\\\"&gt;\u6210\u529f&lt;/font&gt;\\n&gt;\u672c\u6b21\u6784\u5efa\u7531\uff1a$GITLAB_USER_NAME \u89e6\u53d1\\n&gt;\u9879\u76ee\u540d\u79f0\uff1a$CI_PROJECT_NAME\\n&gt;\u63d0\u4ea4\u53f7\uff1a$CI_COMMIT_SHA\\n&gt;\u63d0\u4ea4\u65e5\u5fd7\uff1a$CI_COMMIT_MESSAGE\\n&gt;\u6784\u5efa\u5206\u652f\uff1a$CI_COMMIT_REF_NAME\\n&gt;\u955c\u50cf\u4fe1\u606f\uff1a${REGISTRY}/${NAMESPACE}/${APP_NAME}:${APP_TAG}\\n&gt;\u6d41\u6c34\u7ebf\u5730\u5740\uff1a[$CI_PIPELINE_URL]($CI_PIPELINE_URL)\\\"}}\" ||\n      curl ${WECHAT_WEBHOOK} -H 'Content-Type:application/json' -d \"{\\\"msgtype\\\":\\\"markdown\\\",\\\"markdown\\\":{\\\"content\\\":\\\"${PROJECT_NAME}\u9879\u76ee\u6784\u5efa\u7ed3\u679c\uff1a&lt;font color=\\\\\"warning\\\\\"&gt;\u5931\u8d25&lt;/font&gt;\\n&gt;\u672c\u6b21\u6784\u5efa\u7531\uff1a$GITLAB_USER_NAME \u89e6\u53d1\\n&gt;\u9879\u76ee\u540d\u79f0\uff1a$CI_PROJECT_NAME\\n&gt;\u63d0\u4ea4\u53f7\uff1a$CI_COMMIT_SHA\\n&gt;\u63d0\u4ea4\u65e5\u5fd7\uff1a$CI_COMMIT_MESSAGE\\n&gt;\u6784\u5efa\u5206\u652f\uff1a$CI_COMMIT_REF_NAME\\n&gt;\u955c\u50cf\u4fe1\u606f\uff1a${REGISTRY}/${NAMESPACE}/${APP_NAME}:${APP_TAG}\\n&gt;\u6d41\u6c34\u7ebf\u5730\u5740\uff1a[$CI_PIPELINE_URL]($CI_PIPELINE_URL)\\\"}}\"\n\n  retry:\n    max: 1\n    when:\n      - always\n  allow_failure: true\n</code></pre> <p></p>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#_2","title":"\u4e94 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5c06tapd\u4e0a\u9762\u6e90\u7801\u96c6\u6210\u4e2d\u751f\u6210\u7684webhook\u914d\u7f6e\u5230gitlab\u65f6\uff0c\u4e0d\u80fd\u5728gitlab\u7684\u7ec4\u4e2d\u96c6\u6210\u4e2d\u914d\u7f6e\uff0c\u9700\u8981\u5728\u6d89\u53ca\u5230\u5355\u4e2a\u9879\u76ee\u4e2d\u914d\u7f6e\u3002</li> <li>tapd \u4efb\u52a1\u4e0egitlab \u8054\u52a8\uff0c\u9700\u8981\u5728\u63d0\u4ea4\u4ee3\u7801\u7684\u65f6\u5019\u590d\u5236\u6e90\u7801\u63d0\u4ea4\u5173\u952e\u5b57\u3002</li> </ul>"},{"location":"devops/other/TAPD%20%E4%B8%8EGitLab%E9%9B%86%E6%88%90/#_3","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>https://work.weixin.qq.com/api/doc/90000/90136/91770</li> <li>http://172.16.100.3:88/help/ci/variables/README#variables</li> </ul>"},{"location":"devops/other/apiFox/","title":"apiFox","text":""},{"location":"devops/other/apiFox/#gitopsargo-cd","title":"GitOps\u5de5\u5177Argo CD\u5b9e\u6218","text":""},{"location":"devops/other/apiFox/#_1","title":"\u80cc\u666f","text":"<p>GitOps \u7684\u6982\u5ff5\u6700\u521d\u6765\u6e90\u4e8e Weaveworks \u7684\u8054\u5408\u521b\u59cb\u4eba Alexis \u5728 2017 \u5e74 8 \u6708\u53d1\u8868\u7684\u4e00\u7bc7\u535a\u5ba2 GitOps - Operations by Pull Request\u3002\u5176\u662f\u5f00\u53d1\u8005\u548c\u8fd0\u7ef4\u5728\u96c6\u7fa4\u4e0a\u7ebf\u548c\u66f4\u65b0\u5728 Kubernetes \u8fd0\u884c\u7684\u590d\u6742\u5e94\u7528\u7a0b\u5e8f\u7684\u4e00\u79cd\u5feb\u901f\u3001\u5b89\u5168\u7684\u65b9\u6cd5\u3002Alexis\u7684\u6587\u7ae0\u6587\u7ae0\u4ecb\u7ecd\u4e86 Weaveworks \u7684\u5de5\u7a0b\u5e08\u5982\u4f55\u4ee5 Git \u4f5c\u4e3a\u4e8b\u5b9e\u7684\u552f\u4e00\u771f\u5b9e\u6765\u6e90\uff0c\u90e8\u7f72\u3001\u7ba1\u7406\u548c\u76d1\u63a7\u57fa\u4e8e Kubernetes \u7684 SaaS \u5e94\u7528\u3002</p> <p>\u6838\u5fc3\uff1a</p> <ul> <li> <p>\u5bf9\u4e8eK8s\u548c\u5176\u4ed6\u4e91\u539f\u751f\u6280\u672fGitOps\u53ef\u8c13\u4e00\u4e2a\u64cd\u4f5c\u6a21\u578b\uff0c\u63d0\u4f9b\u4e86\u4e00\u7ec4\u6700\u4f73\u5b9e\u8df5\uff0c\u5bf9\u4e8e\u5bb9\u5668\u96c6\u7fa4\u548c\u5e94\u7528\u7684\u7edf\u4e00\u90e8\u7f72\uff0c\u7ba1\u7406\u548c\u76d1\u63a7\u3002</p> </li> <li> <p>\u7aef\u5230\u7aef\u7684 CICD \u7ba1\u9053\u548c git \u5de5\u4f5c\u6d41\u90fd\u5e94\u7528\u4e8e\u64cd\u4f5c\u548c\u5f00\u53d1\u901a\u5411\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1\u4eba\u5458\u4f53\u9a8c\u4e4b\u8def; </p> </li> </ul> <p>\u8fd1\u6765\u7814\u7a76GitOps\u5de5\u5177Arog\uff0c\u4e00\u6587\u8d70\u5165GitOps\u4e4b\u95e8\uff0c\u4f53\u9a8c\u4e3a\u5f00\u53d1\u4eba\u5458\u5e26\u6765\u7684\u5c06\u4e0a\u7ebf\u90e8\u7f72\u7ed3\u5408\u5728Git\u4e2d\u7684\u7545\u5feb\u4f53\u9a8c\uff0cgit commit/reserve\u7684\u4e0a\u7ebf\u53d1\u5e03\u4e0e\u56de\u6eda\u53d8\u7684\u5982\u6b64\u7b80\u5355\u3002</p> <p>\u4e00 \u6982\u8ff0</p>"},{"location":"devops/other/apiFox/#11-argo-cd","title":"1.1 \u4ec0\u4e48\u65f6\u5019Argo CD","text":"<p>argo CD\u5bf9k8s\u662f\u4e00\u4e2a\u58f0\u660e\u5f0f\u7684\uff0cgitops\u7684\u6301\u7eed\u96c6\u6210\u5de5\u5177\u3002</p>"},{"location":"devops/other/apiFox/#12-argo-cd","title":"1.2 \u4e3a\u4ec0\u4e48\u4f7f\u7528Argo CD","text":"<p>\u5e94\u7528\u7684\u5b9a\u4e49/\u914d\u7f6e\u548c\u73af\u5883\u5e94\u8be5\u88ab\u58f0\u660e\u548c\u7248\u672c\u7ba1\u7406\uff0c\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u548c\u751f\u547d\u5468\u671f\u7ba1\u7406\u5e94\u8be5\u662f\u81ea\u52a8\u5316\u7684\uff0c\u53ef\u5ba1\u6838\u7684\u4e14\u6613\u4e8e\u7406\u89e3\u7684\u3002</p>"},{"location":"devops/other/apiFox/#13","title":"1.3 \u4f7f\u7528","text":""},{"location":"devops/other/apiFox/#131","title":"1.3.1 \u5de5\u4f5c\u65b9\u5f0f","text":"<p>Argo CD\u9075\u5faaGitOps\u6a21\u5f0f\uff0c\u8be5\u6a21\u5f0f\u4f7f\u7528Git\u5b58\u50a8\u5e93\u4f5c\u4e3a\u5b9a\u4e49\u6240\u9700\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u7684\u771f\u5b9e\u6765\u6e90\u3002Kubernetes\u6e05\u5355\u53ef\u4ee5\u901a\u8fc7\u51e0\u79cd\u65b9\u5f0f\u6307\u5b9a\uff1a</p> <ul> <li>kustomize applications</li> <li>helm charts</li> <li>ksonnet applications</li> <li>jsonnet files</li> <li>Plain directory of YAML/json manifests</li> <li>Any custom config management tool configured as a config management plugin</li> </ul> <p>Argo CD\u53ef\u5728\u6307\u5b9a\u7684\u76ee\u6807\u73af\u5883\u4e2d\u81ea\u52a8\u90e8\u7f72\u6240\u9700\u7684\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u3002\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u53ef\u4ee5\u5728Git\u63d0\u4ea4\u65f6\u8ddf\u8e2a\u5bf9\u5206\u652f\uff0c\u6807\u7b7e\u7684\u66f4\u65b0\uff0c\u6216\u56fa\u5b9a\u5230\u6e05\u5355\u7684\u7279\u5b9a\u7248\u672c\u3002\u6709\u5173\u53ef\u7528\u7684\u4e0d\u540c\u8ddf\u8e2a\u7b56\u7565\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u8ddf\u8e2a\u7b56\u7565\u3002</p>"},{"location":"devops/other/apiFox/#132","title":"1.3.2 \u67b6\u6784","text":"<p>Argo CD\u88ab\u5b9e\u73b0\u4e3akubernetes\u63a7\u5236\u5668\uff0c\u8be5\u63a7\u5236\u5668\u8fde\u7eed\u76d1\u89c6\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u5c06\u5f53\u524d\u7684\u6d3b\u52a8\u72b6\u6001\u4e0e\u6240\u9700\u7684\u76ee\u6807\u72b6\u6001\uff08\u5728Git\u5b58\u50a8\u5e93\u4e2d\u6307\u5b9a\uff09\u8fdb\u884c\u6bd4\u8f83\u3002\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u504f\u79bb\u76ee\u6807\u72b6\u6001\u7684\u5df2\u90e8\u7f72\u5e94\u7528\u7a0b\u5e8f\u88ab\u89c6\u4e3aOutOfSync\u3002Argo CD\u62a5\u544a\u5e76\u53ef\u89c6\u5316\u5dee\u5f02\uff0c\u540c\u65f6\u63d0\u4f9b\u4e86\u81ea\u52a8\u6216\u624b\u52a8\u5c06\u5b9e\u65f6\u72b6\u6001\u540c\u6b65\u56de\u6240\u9700\u76ee\u6807\u72b6\u6001\u7684\u529f\u80fd\u3002\u5728Git\u5b58\u50a8\u5e93\u4e2d\u5bf9\u6240\u9700\u76ee\u6807\u72b6\u6001\u6240\u505a\u7684\u4efb\u4f55\u4fee\u6539\u90fd\u53ef\u4ee5\u81ea\u52a8\u5e94\u7528\u5e76\u53cd\u6620\u5728\u6307\u5b9a\u7684\u76ee\u6807\u73af\u5883\u4e2d\u3002</p>"},{"location":"devops/other/apiFox/#_2","title":"\u4e8c \u57fa\u7840\u6982\u5ff5","text":"<p>\u5728\u6709\u6548\u4f7f\u7528Argo CD\u4e4b\u524d\uff0c\u6709\u5fc5\u8981\u4e86\u89e3\u8be5\u5e73\u53f0\u6240\u57fa\u4e8e\u7684\u57fa\u7840\u6280\u672f\u3002\u8fd8\u9700\u8981\u4e86\u89e3\u5411\u60a8\u63d0\u4f9b\u7684\u529f\u80fd\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\u3002\u4ee5\u4e0b\u90e8\u5206\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6709\u7528\u7684\u94fe\u63a5\uff0c\u53ef\u4ee5\u5e2e\u52a9\u60a8\u7406\u89e3\u3002</p>"},{"location":"devops/other/apiFox/#21","title":"2.1 \u4e86\u89e3\u57fa\u7840","text":""},{"location":"devops/other/apiFox/#211-k8s","title":"2.1.1 k8s\u77e5\u8bc6\u70b9","text":"<ul> <li>A Beginner-Friendly Introduction to Containers, VMs and Docker</li> <li>Introduction to Kubernetes</li> <li>Tutorials</li> <li>Hands on labs</li> </ul>"},{"location":"devops/other/apiFox/#212","title":"2.1.2 \u81ea\u5b9a\u4e49\u6a21\u7248","text":"<ul> <li>Kustomize</li> <li>Helm</li> <li>Ksonnet</li> </ul>"},{"location":"devops/other/apiFox/#213-jenkins","title":"2.1.3 jenkins\u96c6\u6210","text":"<ul> <li>Jenkins User Guide</li> </ul>"},{"location":"devops/other/apiFox/#_3","title":"\u4e09 \u6838\u5fc3\u6982\u5ff5","text":"<p>\u5047\u8bbe\u60a8\u719f\u6089\u6838\u5fc3\u7684Git\uff0cDocker\uff0cKubernetes\uff0c\u6301\u7eed\u4ea4\u4ed8\u548cGitOps\u6982\u5ff5\u3002</p> <ul> <li> <p>Application\uff1a\u6e05\u5355\u5b9a\u4e49\u7684\u4e00\u7ec4Kubernetes\u8d44\u6e90\u3002\u8fd9\u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49\uff08CRD\uff09\u3002</p> </li> <li> <p>Application source type\uff1a\u4f7f\u7528\u54ea\u4e2a\u5de5\u5177\u6765\u6784\u5efa\u5e94\u7528\u7a0b\u5e8f</p> </li> <li>Target state\uff1a\u5e94\u7528\u7a0b\u5e8f\u7684\u671f\u671b\u72b6\u6001\uff0c\u7531Git\u5b58\u50a8\u5e93\u4e2d\u7684\u6587\u4ef6\u8868\u793a\u3002</li> <li>Live state\uff1a\u8be5\u5e94\u7528\u7a0b\u5e8f\u7684\u5b9e\u65f6\u72b6\u6001\u3002\u90e8\u7f72\u4e86\u54ea\u4e9bPod\u7b49\u3002</li> <li>Sync status\uff1a\u5b9e\u65f6\u72b6\u6001\u662f\u5426\u4e0e\u76ee\u6807\u72b6\u6001\u5339\u914d\u3002\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u4e0eGit\u6240\u8bf4\u7684\u76f8\u540c\uff1f</li> <li>Sync\uff1a\u4f7f\u5e94\u7528\u7a0b\u5e8f\u79fb\u81f3\u5176\u76ee\u6807\u72b6\u6001\u7684\u8fc7\u7a0b\u3002\u4f8b\u5982\u3002\u901a\u8fc7\u5c06\u66f4\u6539\u5e94\u7528\u4e8eKubernetes\u96c6\u7fa4\u3002</li> <li>Refresh\uff1a\u5c06Git\u4e2d\u7684\u6700\u65b0\u4ee3\u7801\u4e0e\u5b9e\u65f6\u72b6\u6001\u8fdb\u884c\u6bd4\u8f83\u3002\u627e\u51fa\u6709\u4ec0\u4e48\u4e0d\u540c\u3002</li> <li>Health:\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u72b6\u51b5\u662f\u5426\u6b63\u5e38\u8fd0\u884c\uff1f\u5b83\u53ef\u4ee5\u6ee1\u8db3\u8bf7\u6c42\u5417\uff1f</li> <li>Tool:\u4ece\u6587\u4ef6\u76ee\u5f55\u521b\u5efa\u6e05\u5355\u7684\u5de5\u5177\u3002\u4f8b\u5982\u3002Kustomize\u6216Ksonnet\u3002\u8bf7\u53c2\u9605\u5e94\u7528\u7a0b\u5e8f\u6e90\u7c7b\u578b\u3002</li> </ul>"},{"location":"devops/other/apiFox/#_4","title":"\u56db \u5b89\u88c5\u90e8\u7f72","text":""},{"location":"devops/other/apiFox/#41-argo-cd","title":"4.1 \u5b89\u88c5Argo CD","text":"<pre><code>kubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\n</code></pre> <p>\u8fd9\u5c06\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u547d\u540d\u7a7a\u95f4argocd\uff0cArgo CD\u670d\u52a1\u548c\u5e94\u7528\u7a0b\u5e8f\u8d44\u6e90\u5c06\u9a7b\u7559\u5728\u8be5\u547d\u540d\u7a7a\u95f4\u4e2d\u3002</p>"},{"location":"devops/other/apiFox/#42-argo-cd-cli","title":"4.2 \u4e0b\u8f7dArgo CD CLI","text":"<p>\u4ece https://github.com/argoproj/argo-cd/releases/latest.\u4e0b\u8f7dArgo CD\u5de5\u5177</p> <ul> <li>mac\u53ef\u4ee5\u5229\u7528\u5982\u4e0b\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5</li> </ul> <pre><code>brew tap argoproj/tap\nbrew install argoproj/tap/argocd\n</code></pre> <ul> <li>Linux\u5b89\u88c5</li> </ul> <pre><code>VERSION=$(curl --silent \"https://api.github.com/repos/argoproj/argo-cd/releases/latest\" | grep '\"tag_name\"' | sed -E 's/.*\"([^\"]+)\".*/\\1/')\ncurl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64\nchmod +x /usr/local/bin/argocd\n</code></pre> <p>\u53ef\u4ee5\u53c2\u8003\uff1ahttps://argoproj.github.io/argo-cd/cli_installation/</p>"},{"location":"devops/other/apiFox/#43-argo-cd-api-server","title":"4.3 \u8bbf\u95eeArgo CD API server","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cArgo CD API\u670d\u52a1\u5668\u672a\u4f7f\u7528\u5916\u90e8IP\u516c\u5f00\u3002\u8981\u8bbf\u95eeAPI\u670d\u52a1\u5668\uff0c\u8bf7\u9009\u62e9\u4ee5\u4e0b\u6280\u672f\u4e4b\u4e00\u4ee5\u516c\u5f00Argo CD API\u670d\u52a1\u5668\uff1a</p> <p>\u7aef\u53e3\u8f6c\u53d1</p> <pre><code>[root@master ~]# kubectl port-forward svc/argocd-server -n argocd --address 0.0.0.0 8080:443\n</code></pre>"},{"location":"devops/other/apiFox/#44-cliargo","title":"4.4 \u901a\u8fc7CLI\u767b\u5f55Argo","text":"<p>\u521d\u59cb\u5bc6\u7801\u5c06\u81ea\u52a8\u751f\u6210\u4e3aArgo CD API\u670d\u52a1\u5668\u7684\u5bb9\u5668\u540d\u79f0\u3002\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c\u68c0\u7d22\uff1a</p> <pre><code>[root@master ~]# kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2\nargocd-server-656f9b895b-bfjvw\n</code></pre> <p>\u4f7f\u7528\u7528\u6237\u540dadmin\u548c\u4e0a\u9762\u7684\u5bc6\u7801\uff0c\u767b\u5f55\u5230Argo CD\u7684IP\u6216\u4e3b\u673a\u540d\uff1a</p> <pre><code>argocd login &lt;ARGOCD_SERVER&gt;\n</code></pre> <p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u66f4\u6539\u5bc6\u7801\uff1a</p> <pre><code>argocd account update-password\n</code></pre> <pre><code># \u767b\u5f55\n[root@master ~]# argocd login localhost:8080\nWARNING: server certificate had error: x509: certificate signed by unknown authority. Proceed insecurely (y/n)? yes\nUsername: admin\nPassword: \n'admin' logged in successfully\nContext 'localhost:8080' updated\n# \u4fee\u6539\u5bc6\u7801\n[root@master ~]# argocd account update-password\n*** Enter current password: \n*** Enter new password: \n*** Confirm new password: \nPassword updated\nContext 'localhost:8080' updated\n</code></pre>"},{"location":"devops/other/apiFox/#45","title":"4.5 \u6ce8\u518c\u96c6\u7fa4\u4ee5\u5c06\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u5230\uff08\u53ef\u9009\uff09","text":"<p>\u6b64\u6b65\u9aa4\u5c06\u7fa4\u96c6\u7684\u51ed\u636e\u6ce8\u518c\u5230Argo CD\uff0c\u4ec5\u5728\u90e8\u7f72\u5230\u5916\u90e8\u7fa4\u96c6\u65f6\u624d\u9700\u8981\u3002\u5728\u5185\u90e8\u8fdb\u884c\u90e8\u7f72\uff08\u5230\u4e0eArgo CD\u8fd0\u884c\u6240\u5728\u7684\u540c\u4e00\u96c6\u7fa4\uff09\u65f6\uff0c\u5e94\u5c06https\uff1a//kubernetes.default.svc\u7528\u4f5c\u5e94\u7528\u7a0b\u5e8f\u7684K8s API\u670d\u52a1\u5668\u5730\u5740\u3002</p> <p>\u9996\u5148\u5217\u51fa\u5f53\u524dkubconfig\u4e2d\u7684\u6240\u6709\u96c6\u7fa4\u4e0a\u4e0b\u6587\uff1a</p> <pre><code>argocd cluster add\n</code></pre> <p>\u4e0a\u9762\u7684\u547d\u4ee4\u5c06ServiceAccount\uff08argocd-manager\uff09\u5b89\u88c5\u5230\u8be5kubectl\u4e0a\u4e0b\u6587\u7684kube-system\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u5e76\u5c06\u670d\u52a1\u5e10\u6237\u7ed1\u5b9a\u5230\u7ba1\u7406\u5458\u7ea7\u522b\u7684ClusterRole\u3002Argo CD\u4f7f\u7528\u6b64\u670d\u52a1\u5e10\u6237\u4ee4\u724c\u6267\u884c\u5176\u7ba1\u7406\u4efb\u52a1\uff08\u5373\u90e8\u7f72/\u76d1\u89c6\uff09\u3002</p> <p>\u53ef\u4ee5\u4fee\u6539argocd-manager-role\u89d2\u8272\u7684\u89c4\u5219\uff0c\u4f7f\u5176\u4ec5\u5177\u6709\u5bf9\u4e00\u7ec4\u6709\u9650\u7684\u540d\u79f0\u7a7a\u95f4\uff0c\u7ec4\u548c\u79cd\u7c7b\u7684\u521b\u5efa\uff0c\u66f4\u65b0\uff0c\u4fee\u8865\uff0c\u5220\u9664\u7279\u6743\u3002\u4f46\u662f\uff0c\u5728\u7fa4\u96c6\u4f5c\u7528\u57df\u4e2d\uff0c\u83b7\u53d6\uff0c\u5217\u51fa\uff0c\u76d1\u89c6\u7279\u6743\u662fArgo CD\u8d77\u4f5c\u7528\u6240\u5fc5\u9700\u7684\u3002</p>"},{"location":"devops/other/apiFox/#46-git","title":"4.6 \u4eceGit\u5b58\u50a8\u5e93\u521b\u5efa\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u4e00\u4e2aguestbook\u7684\u5e94\u7528\u6765\u4ed3\u5e93\u4fdd\u62a4\u793a\u4f8b\uff0c\u6765\u8bf4\u660eArgo CD\u5982\u4f55\u53bb\u5de5\u4f5c\uff1ahttps://github.com/argoproj/argocd-example-apps.git</p> <p></p>"},{"location":"devops/other/apiFox/#461-cliapp","title":"4.6.1 \u901a\u8fc7CLI\u521b\u5efaAPP","text":"<p>You can access Argo CD using port forwarding: add <code>--port-forward-namespace argocd</code> flag to every CLI command or set <code>ARGOCD_OPTS</code> environment variable: <code>export ARGOCD_OPTS='--port-forward-namespace argocd'</code>:</p> <pre><code>argocd app create guestbook --repo https://github.com/argoproj/argocd-example-apps.git --path guestbook --dest-server https://kubernetes.default.svc --dest-namespace default\n</code></pre>"},{"location":"devops/other/apiFox/#462-web-uiapp","title":"4.6.2 \u901a\u8fc7web UI\u521b\u5efaAPP","text":"<p>\u6253\u5f00\u6d4f\u89c8\u5668\u8fdb\u5165Argo CD\u5916\u90e8UI\uff0c\u7136\u540e\u901a\u8fc7\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95eeIP /\u4e3b\u673a\u540d\u767b\u5f55\u5e76\u4f7f\u7528\u5728\u6b65\u9aa44\u4e2d\u8bbe\u7f6e\u7684\u51ed\u636e\u3002</p> <p></p> <p>\u7ed9\u60a8\u7684\u5e94\u7528\u547d\u540d\u4e3a\u7559\u8a00\u7c3f\uff0c\u4f7f\u7528\u9879\u76ee\u9ed8\u8ba4\u503c\uff0c\u5e76\u5c06\u540c\u6b65\u7b56\u7565\u4fdd\u7559\u4e3a\u201c\u624b\u52a8\u201d\uff1a</p> <p></p> <p>Connect the https://github.com/redhatxl/argocd-example-apps.git  repo to Argo CD by setting repository url to the github repo url, leave revision as <code>HEAD</code>, and set the path to <code>guestbook</code>:</p> <p>\u6ce8\u610f\uff1a\u4ed3\u5e93\u53ef\u4ee5\u4f7f\u7528\u6211fork\u7684\uff0c\u76ee\u524d\u4ee5\u53ca\u66f4\u6539\u4e86\u955c\u50cf\u5730\u5740\uff0c\u53ef\u4ee5\u6b63\u5e38\u62c9\u53d6\uff0c</p> <p></p> <p>\u26a0\ufe0f\u6ce8\u610f\uff1aPath\u5bf9\u5e94\u9879\u76ee\u4e2d\u8d44\u6e90\u6e05\u5355\u7684\u76ee\u5f55\u3002  </p> <p>\u5bf9\u4e8e\u76ee\u6807\uff0c\u5c06\u96c6\u7fa4\u8bbe\u7f6e\u4e3a\u96c6\u7fa4\u5185\uff0c\u5e76\u5c06\u540d\u79f0\u7a7a\u95f4\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c\uff1a</p> <p></p> <p>\u586b\u5199\u5b8c\u4ee5\u4e0a\u4fe1\u606f\u540e\uff0c\u8bf7\u5355\u51fbUI\u9876\u90e8\u7684\u201c\u521b\u5efa\u201d\u4ee5\u521b\u5efa\u7559\u8a00\u7c3f\u5e94\u7528\u7a0b\u5e8f\uff1a</p> <p></p>"},{"location":"devops/other/apiFox/#47","title":"4.7 \u540c\u6b65\uff08\u90e8\u7f72\uff09\u5e94\u7528","text":"<p>\u521b\u5efa\u7559\u8a00\u7c3f\u5e94\u7528\u7a0b\u5e8f\u540e\uff0c\u60a8\u73b0\u5728\u53ef\u4ee5\u67e5\u770b\u5176\u72b6\u6001\uff1a</p> <pre><code>[root@master ~]# argocd app get guestbook\nName:               guestbook\nProject:            default\nServer:             https://kubernetes.default.svc\nNamespace:          default\nURL:                https://localhost:8080/applications/guestbook\nRepo:               https://github.com/redhatxl/argocd-example-apps.git\nTarget:             HEAD\nPath:               guestbook\nSyncWindow:         Sync Allowed\nSync Policy:        &lt;none&gt;\nSync Status:        OutOfSync from HEAD (4973f15)\nHealth Status:      Missing\n\nGROUP  KIND        NAMESPACE  NAME          STATUS     HEALTH   HOOK  MESSAGE\n       Service     default    guestbook-ui  OutOfSync  Missing        \napps   Deployment  default    guestbook-ui  OutOfSync  Missing \n</code></pre> <p>\u7531\u4e8e\u5c1a\u672a\u90e8\u7f72\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u4e14\u5c1a\u672a\u521b\u5efaKubernetes\u8d44\u6e90\uff0c\u56e0\u6b64\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u6700\u521d\u5904\u4e8eOutOfSync\u72b6\u6001\u3002\u8981\u540c\u6b65\uff08\u90e8\u7f72\uff09\u5e94\u7528\u7a0b\u5e8f\uff0c\u8bf7\u8fd0\u884c\uff1a</p> <pre><code>[root@master ~]# argocd app sync guestbook\nTIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME    STATUS    HEALTH        HOOK  MESSAGE\n2020-01-24T12:59:13+08:00            Service     default          guestbook-ui  OutOfSync  Missing              \n2020-01-24T12:59:13+08:00   apps  Deployment     default          guestbook-ui  OutOfSync  Missing              \n2020-01-24T12:59:14+08:00            Service     default          guestbook-ui    Synced  Healthy              \n\nName:               guestbook\nProject:            default\nServer:             https://kubernetes.default.svc\nNamespace:          default\nURL:                https://localhost:8080/applications/guestbook\nRepo:               https://github.com/redhatxl/argocd-example-apps.git\nTarget:             HEAD\nPath:               guestbook\nSyncWindow:         Sync Allowed\nSync Policy:        &lt;none&gt;\nSync Status:        Synced to HEAD (4973f15)\nHealth Status:      Progressing\n\nOperation:          Sync\nSync Revision:      4973f150497aa18bc5fbd81b19102db2469eb6f0\nPhase:              Succeeded\nStart:              2020-01-24 12:59:11 +0800 CST\nFinished:           2020-01-24 12:59:12 +0800 CST\nDuration:           1s\nMessage:            successfully synced (all tasks run)\n\nGROUP  KIND        NAMESPACE  NAME          STATUS  HEALTH       HOOK  MESSAGE\n       Service     default    guestbook-ui  Synced  Healthy            service/guestbook-ui created\napps   Deployment  default    guestbook-ui  Synced  Progressing        deployment.apps/guestbook-ui created\n</code></pre> <p></p> <p>\u6b64\u547d\u4ee4\u4ece\u5b58\u50a8\u5e93\u4e2d\u68c0\u7d22\u6e05\u5355\uff0c\u5e76\u5bf9\u6e05\u5355\u6267\u884ckubectl\u5e94\u7528\u3002\u8be5\u7559\u8a00\u7c3f\u5e94\u7528\u7a0b\u5e8f\u73b0\u5728\u6b63\u5728\u8fd0\u884c\uff0c\u60a8\u73b0\u5728\u53ef\u4ee5\u67e5\u770b\u5176\u8d44\u6e90\u7ec4\u4ef6\uff0c\u65e5\u5fd7\uff0c\u4e8b\u4ef6\u548c\u8bc4\u4f30\u7684\u5065\u5eb7\u72b6\u6001\uff1a</p> <p>\u90e8\u7f72\u5b8c\u6210\u540e\u72b6\u6001\uff1a</p> <p></p> <p></p> <pre><code>[root@master ~]# kubectl  get all -l app=guestbook-ui\nNAME                                READY   STATUS    RESTARTS   AGE\npod/guestbook-ui-7bc795dc8c-m69fl   1/1     Running   0          3m6s\n\nNAME                                      DESIRED   CURRENT   READY   AGE\nreplicaset.apps/guestbook-ui-7bc795dc8c   1         1         1       3m6s\n</code></pre> <p>\u4fee\u6539guestbook\u7684\u8bbf\u95ee\u65b9\u5f0f\u4e3aNodePort</p> <p></p> <p></p>"},{"location":"devops/other/apiFox/#_5","title":"\u4e94 \u64cd\u4f5c\u624b\u518c","text":""},{"location":"devops/other/apiFox/#51","title":"5.1 \u6982\u8ff0","text":"<p>\u672c\u6307\u5357\u9002\u7528\u4e8e\u5e0c\u671b\u4e3a\u5176\u4ed6\u5f00\u53d1\u4eba\u5458\u5b89\u88c5\u548c\u914d\u7f6eArgo CD\u7684\u7ba1\u7406\u5458\u548c\u64cd\u4f5c\u5458\u3002</p>"},{"location":"devops/other/apiFox/#52","title":"5.2 \u67b6\u6784\u6982\u8ff0","text":""},{"location":"devops/other/apiFox/#521-api-server","title":"5.2.1 API Server","text":"<p>API\u670d\u52a1\u5668\u662fgRPC / REST\u670d\u52a1\u5668\uff0c\u5b83\u516c\u5f00\u4e86Web UI\uff0cCLI\u548cCI / CD\u7cfb\u7edf\u4f7f\u7528\u7684API\u3002\u5b83\u5177\u6709\u4ee5\u4e0b\u804c\u8d23\uff1a</p> <ul> <li>\u5e94\u7528\u7ba1\u7406\u548c\u72b6\u6001\u62a5\u544a</li> <li>\u5e94\u7528\u8c03\u7528\u64cd\u4f5c\uff08\u540c\u6b65\uff0c\u56de\u6eda\uff0c\u7528\u6237\u5b9a\u4e49\uff09</li> <li>\u4ed3\u5e93\u548c\u96c6\u7fa4\u8ba4\u8bc1\u7ba1\u7406</li> <li>\u5411\u5916\u90e8\u8eab\u4efd\u63d0\u4f9b\u8005\u7684\u8eab\u4efd\u9a8c\u8bc1\u548c\u8eab\u4efd\u9a8c\u8bc1\u59d4\u6d3e</li> <li>RBAC\u5f3a\u5236\u6267\u884c</li> <li>\u76d1\u542c/\u8f6c\u53d1Git webhook events</li> </ul>"},{"location":"devops/other/apiFox/#522-repository-server","title":"5.2.2 Repository Server","text":"<p>\u4ed3\u5e93\u670d\u52a1\u662f\u4e00\u4e2a\u5185\u90e8\u7684\u670d\u52a1\uff0c\u7ef4\u62a4\u4e86\u4e00\u4e2a\u672c\u5730\u7684git\u4ed3\u5e93\u7f13\u5b58\u4e86\u5e94\u7528\u7684manifests\uff0c\u5229\u7528\u4ed6\u6765\u751f\u6210\u548c\u8fd4\u56dekubernetes\u7684manifests\u5f53\u63d0\u4f9b\u4e00\u4e0b\u7684\u8f93\u5165\u7684\u65f6\u5019</p> <ul> <li>\u4ed3\u5e93URL</li> <li>\u7248\u672c\uff08commit\uff0ctag\uff0cbranch\uff09</li> <li>\u5e94\u7528\u8865\u4e01</li> <li>\u6a21\u7248\u8bbe\u7f6e</li> </ul>"},{"location":"devops/other/apiFox/#523-application-controller","title":"5.2.3 Application Controller","text":"<p>\u5e94\u7528\u63a7\u5236\u5668\u662f\u4e00\u4e2ak8s\u7684\u63a7\u5236\u5668\uff0c\u5229\u7528\u4ed6\u6765\u6301\u7eed\u7684\u76d1\u63a7\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u548c\u5bf9\u6bd4\u5f53\u524d\u7684\u72b6\u6001\uff0c\u548c\u5b58\u6d3b\u7684\u72b6\u6001\u5206\u914d\u5df2\u7ecf\u671f\u671b\u7684\u76ee\u6807\u72b6\u6001\uff08\u6765\u6e90\u4e8e\u5236\u5b9a\u7684repo\uff09\uff0c \u4ed6\u68c0\u6d4boutofsync\u5e94\u7528\u72b6\u6001\u548c\u53ef\u9009\u7684\u4efb\u52a1\uff0c\u5b83\u8c03\u7528\u4efb\u4f55\u7528\u6237\u81ea\u5b9a\u4e49\u7684hooks\u5bf9\u4e8e\u58f0\u660e\u5468\u671f\u4e8b\u4ef6</p>"},{"location":"devops/other/apiFox/#53","title":"5.3 \u58f0\u660e\u8bbe\u7f6e","text":""},{"location":"devops/other/apiFox/#531","title":"5.3.1 \u5feb\u901f\u53c2\u8003","text":"<p>\u53ef\u4ee5\u4f7f\u7528Kubernetes\u6e05\u5355\u58f0\u660e\u6027\u5730\u5b9a\u4e49Argo CD\u5e94\u7528\u7a0b\u5e8f\uff0c\u9879\u76ee\u548c\u8bbe\u7f6e\u3002</p> Name Kind Description <code>argocd-cm.yaml</code> ConfigMap General Argo CD configuration <code>argocd-secret.yaml</code> Secret Password, Certificates, Signing Key <code>argocd-rbac-cm.yaml</code> ConfigMap RBAC Configuration <code>argocd-tls-certs-cm.yaml</code> ConfigMap Custom TLS certificates for connecting Git repositories via HTTPS (v1.2 and later) <code>argocd-ssh-known-hosts-cm.yaml</code> ConfigMap SSH known hosts data for connecting Git repositories via SSH (v1.2 and later) <code>application.yaml</code> Application Example application spec <code>project.yaml</code> AppProject Example project spec"},{"location":"devops/other/apiFox/#532","title":"5.3.2 \u5e94\u7528","text":"<p>Application CRD\u662fKubernetes\u8d44\u6e90\u5bf9\u8c61\uff0c\u4ee3\u8868\u73af\u5883\u4e2d\u5df2\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\u3002\u5b83\u7531\u4e24\u4e2a\u5173\u952e\u4fe1\u606f\u5b9a\u4e49\uff1a</p> <ul> <li> <p>\u5bf9Git\u4e2d\u6240\u9700\u72b6\u6001\u7684\u6e90\u5f15\u7528\uff08\u5b58\u50a8\u5e93\uff0c\u4fee\u8ba2\u7248\uff0c\u8def\u5f84\uff0c\u73af\u5883\uff09\u5bf9</p> </li> <li> <p>\u76ee\u6807\u96c6\u7fa4\u548c\u540d\u79f0\u7a7a\u95f4\u7684\u76ee\u6807\u5f15\u7528\u3002</p> </li> </ul> <p>\u6700\u4f4e\u7684\u5e94\u7528\u7a0b\u5e8f\u89c4\u8303\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: guestbook\n  namespace: argocd\nspec:\n  project: default\n  source:\n    repoURL: https://github.com/argoproj/argocd-example-apps.git\n    targetRevision: HEAD\n    path: guestbook\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: guestbook\n</code></pre> <p>\u53c2\u8003 application.yaml \u67e5\u770b\u9644\u52a0\u5b57\u6bb5</p> <p>\u540d\u79f0\u7a7a\u95f4\u5fc5\u987b\u4e0eArgo cd\u7684\u540d\u79f0\u7a7a\u95f4\u5339\u914d\uff0c\u901a\u5e38\u4e3aargocd\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5220\u9664\u5e94\u7528\u7a0b\u5e8f\u5c06\u4e0d\u4f1a\u6267\u884c\u7ea7\u8054\u5220\u9664\uff0c\u4ece\u800c\u5220\u9664\u5176\u8d44\u6e90\u3002\u5982\u679c\u9700\u8981\u8fd9\u79cd\u884c\u4e3a\uff0c\u5219\u5fc5\u987b\u6dfb\u52a0\u7ec8\u7ed3\u5668-\u60a8\u53ef\u80fd\u4e0d\u5e0c\u671b\u8fd9\u6837\u505a\u3002</p> <p>\u60a8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u53ef\u4ee5\u521b\u5efa\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u8be5\u5e94\u7528\u7a0b\u5e8f\u53c8\u53ef\u4ee5\u521b\u5efa\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u6837\uff0c\u60a8\u5c31\u53ef\u4ee5\u58f0\u660e\u6027\u5730\u7ba1\u7406\u53ef\u4ee5\u534f\u8c03\u90e8\u7f72\u548c\u914d\u7f6e\u7684\u4e00\u7ec4\u5e94\u7528\u7a0b\u5e8f\u3002\u8bf7\u53c2\u9605\u7fa4\u96c6\u5f15\u5bfc\u3002</p> <p>AppProject CRD\u662fKubernetes\u8d44\u6e90\u5bf9\u8c61\uff0c\u4ee3\u8868\u5e94\u7528\u7a0b\u5e8f\u7684\u903b\u8f91\u5206\u7ec4\u3002\u5b83\u7531\u4ee5\u4e0b\u5173\u952e\u4fe1\u606f\u5b9a\u4e49\uff1a</p> <ul> <li>sourceRepos\u5f15\u7528\u9879\u76ee\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u4ece\u4e2d\u63d0\u53d6\u6e05\u5355\u7684\u5b58\u50a8\u5e93\u3002</li> <li>\u76ee\u6807\u5f15\u7528\u9879\u76ee\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u90e8\u7f72\u5230\u7684\u7fa4\u96c6\u548c\u540d\u79f0\u7a7a\u95f4\u3002</li> <li>\u5b9e\u4f53\u7684\u89d2\u8272\u5217\u8868\u53ca\u5176\u5728\u9879\u76ee\u4e2d\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u7684\u5b9a\u4e49\u3002</li> </ul>"},{"location":"devops/other/apiFox/#_6","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://argoproj.github.io/argo-cd/?spm=a2c4e.10696291.0.0.6fc419a4zmeq9o</li> <li>https://www.weave.works/blog/gitops-is-cloud-native?spm=a2c4e.10696291.0.0.6e0319a4UJmgT6</li> </ul>"},{"location":"english/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/","title":"\u82f1\u8bed\u5b66\u4e60","text":""},{"location":"english/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/#_1","title":"\u82f1\u8bed\u5b66\u4e60","text":""},{"location":"english/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/#_2","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.runoob.com/w3cnote/common-english-terminology-in-programming.html</li> <li>https://www.bilibili.com/video/BV1ht4y1D7H9?p=3&amp;spm_id_from=pageDriver</li> <li>https://www.bilibili.com/video/BV1Z4411C7jG?from=search&amp;seid=4495203158090810844&amp;spm_id_from=333.337.0.0</li> <li></li> </ul>"},{"location":"english/%E8%AF%AD%E6%B3%95/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/","title":"\u82f1\u8bed\u8bed\u6cd5","text":""},{"location":"english/%E8%AF%AD%E6%B3%95/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/#_1","title":"\u82f1\u8bed\u8bed\u6cd5","text":""},{"location":"english/%E8%AF%AD%E6%B3%95/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/#_2","title":"\u4e00 \u82f1\u8bed\u8bed\u6cd5\u6846\u67b6","text":""},{"location":"english/%E8%AF%AD%E6%B3%95/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/#11-10","title":"1.1 10\u79cd\u8bcd\u6027","text":"<p>\u51a0\u8bcd\uff1aart\u3002a\uff0can\uff0cthe</p> <p>\u526f\u8bcd\uff1aadv\u3002next\uff0cmuch\uff0cback</p> <p>\u4ecb\u8bcd\uff1aprep\u3002at\uff0cin\uff0con</p> <p>\u8fde\u8bcd\uff1aconj\u3002and\uff0calse\uff0cbut</p> <p>\u611f\u53f9\uff1aint\u3002what\uff0cyum\uff0cblah</p>"},{"location":"english/%E8%AF%AD%E6%B3%95/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/#12-9","title":"1.2 9\u79cd\u6210\u5206","text":""},{"location":"english/%E8%AF%AD%E6%B3%95/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/#13-8","title":"1.3 8\u79cd\u53e5\u578b","text":""},{"location":"english/%E8%AF%AD%E6%B3%95/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/#_3","title":"\u4e8c \u82f1\u8bed\u7b80\u5355\u53e5","text":""},{"location":"english/%E8%AF%AD%E6%B3%95/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/#_4","title":"\u4e09 \u6570\u8bcd","text":""},{"location":"english/%E8%AF%AD%E6%B3%95/%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.runoob.com/w3cnote/common-english-terminology-in-programming.html</li> <li>https://www.bilibili.com/video/BV1ht4y1D7H9?p=3&amp;spm_id_from=pageDriver</li> <li>https://www.bilibili.com/video/BV1Z4411C7jG?from=search&amp;seid=4495203158090810844&amp;spm_id_from=333.337.0.0</li> <li>https://jackmiao.notion.site/English-Grammar-PowerPoint-Mind-Map-9e70224b7d9e4fb5a37b39e4c0fc3d0f</li> </ul>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/","title":"1.\u7b2c\u4e00\u4e2a Shell \u7a0b\u5e8f","text":""},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#1-shell_1","title":"1. Shell \u811a\u672c\u7684\u6784\u6210\u53ca\u89c4\u8303","text":"<p>Shell \u811a\u672c\u6709\u4e00\u4e9b\u7ea6\u5b9a\u4fd7\u6210\u7684\u89c4\u8303\uff0c\u5927\u5bb6\u90fd\u9075\u5faa\u8fd9\u4e9b\u89c4\u5219\uff0c\u7f16\u5199\u51fa\u6765\u7684\u811a\u672c\u66f4\u80fd\u88ab\u5927\u5bb6\u63a5\u53d7\uff0cShell \u811a\u672c\u5176\u5b9e\u4e0d\u80fd\u79f0\u4e3a\u4e00\u95e8\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b83\u66f4\u50cf\u662f\u4e00\u4e2a\u5de5\u5177\uff0c\u7528\u6765\u6742\u7cc5\u4e0d\u540c\u7684\u7a0b\u5e8f\u53ca\u547d\u4ee4\u4f9b\u6211\u4eec\u8c03\u7528\u6765\u5b8c\u6210\u81ea\u5df1\u7684\u9884\u671f\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#11","title":"1.1 \u547d\u540d\u89c4\u8303","text":"<ul> <li>Shell \u811a\u672c\u5728\u547d\u540d\u65b9\u9762\u6ca1\u6709\u4e25\u683c\u7684\u8981\u6c42\uff0c\u4f46\u662f\u6211\u4eec\u547d\u540d\u9700\u8981\u9075\u5faa\u89c1\u660e\u77e5\u610f\uff0c\u5373\u53ef\u901a\u8fc7 Shell \u811a\u672c\u7684\u540d\u79f0\u77e5\u9053\u5176\u529f\u80fd\u3002</li> <li>\u6587\u4ef6\u540d\u7ea6\u5b9a\u4fd7\u6210\u4ee5.sh \u7ed3\u5c3e\uff0c\u65b9\u4fbf\u8bc6\u522b\u5176\u4e3a Shell \u811a\u672c\u6587\u4ef6\uff1b</li> <li>\u6587\u4ef6\u7edf\u4e00\u547d\u540d\u98ce\u683c\uff0c\u5199 Shell \u4e00\u822c\u7528\u5c0f\u5199\u5b57\u6bcd\u52a0\u4e0b\u5212\u7ebf\uff0c\u4f8b\u5982 <code>install_mysql.sh</code>, \u6211\u4eec\u770b\u5230\u8be5\u540d\u79f0\u5c31\u80fd\u77e5\u9053\u5176\u4e3a\u4e00\u4e2a\u5b89\u88c5 mysql \u7684\u811a\u672c\u6587\u4ef6\u3002</li> </ul>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#12-shell","title":"1.2 Shell \u811a\u672c\u7ed3\u6784","text":"<p>Shell \u811a\u672c\u5728\u5176\u4e2d\u7684\u7b2c\u4e00\u884c\u9700\u8981\u6709\u6307\u660e\u89e3\u91ca\u5668\uff0c\u5728\u4e0a\u9762 CLI Shell \u4e2d\u7684\u90a3\u4e9b\u89e3\u91ca\u5668\uff0c\u90fd\u53ef\u4ee5\u5199\uff0c\u5728\u4ee5<code>./install_mysql.sh</code> \u7684\u65f6\u5019\uff0c\u6b64\u65f6\u5c31\u662f\u5229\u7528\u811a\u672c\u4e2d\u7b2c\u4e00\u884c\u7684\u89e3\u91ca\u5668\u6765\u8fd0\u884c\u811a\u672c\uff0c\u5176\u683c\u5f0f\u4e3a <code>#!Shell\u89e3\u91ca\u5668</code>\uff0c\u4f8b\u5982<code>#!/bin/bash</code>, \u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u4e00\u5b9a\u7684\u5c40\u9650\u6027\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528 env \u73af\u5883\u53d8\u91cf\u4e2d\u7684 bash\uff0c\u63a8\u8350\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f<code>#!/usr/bin/env bash</code>\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#13","title":"1.3 \u7f16\u7801\u7edf\u4e00","text":"<p>\u5728\u7f16\u5199 Shell \u7684\u65f6\u5019\u6211\u4eec\u5c3d\u53ef\u80fd\u4f7f\u7528 UTF-8 \u7f16\u7801\uff0c\u53ef\u4ee5\u652f\u6301\u4e2d\u6587\u53ca\u5927\u591a\u6570\u7b26\u53f7\uff0c\u5728\u5176\u4e2d\u6211\u4eec\u6ce8\u91ca\u4f7f\u7528\u82f1\u6587\uff0c\u4f8b\u5982\u5728\u4e0d\u652f\u6301\u4e2d\u6587\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u811a\u672c\u66f4\u597d\u7684\u652f\u6301\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#14","title":"1.4 \u4f5c\u8005\u4fe1\u606f","text":"<p>\u5728\u7f16\u5199 Shell \u811a\u672c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u6307\u5b9a Shell \u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u4ee5\u53ca\u8be5\u811a\u672c\u7684\u4f5c\u8005\uff0c\u7f16\u5199\u8be5\u811a\u672c\u7684\u65e5\u671f\u53ca\u8054\u7cfb\u65b9\u5f0f\uff0c\u4ee5\u53ca\u811a\u672c\u7684\u7248\u672c\uff0c\u65b9\u4fbf\u540e\u671f\u5176\u4ed6\u4eba\u9605\u8bfb\u53ca\u8054\u7cfb\u3002 \u4f8b\u5982\u5728\u5934\u90e8\u6dfb\u52a0\u5982\u4e0b\u6ce8\u91ca\u4fe1\u606f\uff1a</p> <pre><code>#!/bin/env bash\n# Description: /mybin/myvim scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# Date: 2020-02-15 13:36\n# Version: 1.0\n</code></pre>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#2-shell","title":"2. Shell \u7684\u8fd0\u884c\u65b9\u5f0f","text":"<p>\u8fd0\u884c\u811a\u672c\u53ef\u4ee5\u5f52\u7eb3\u4e3a\u4e09\u79cd\u65b9\u5f0f\uff0c\u6ce8\u610f\u4e00\u822c\u5728\u8fd0\u884c\u811a\u672c\u7684\u65f6\u5019\u4e3a\u811a\u672c\u6dfb\u52a0 <code>x</code> \u53ef\u6267\u884c\u6743\u9650</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#21","title":"2.1 \u663e\u5f0f\u5236\u5b9a\u89e3\u91ca\u5668\u6267\u884c","text":"<pre><code>[root@shell workspace]# ll\ntotal 4\n-rw-r--r-- 1 root root 44 Sep  3 14:16 01-scripts.sh\n[root@shell workspace]# cat 01-scripts.sh \n#!/bin/env bash\n# Description: /mybin/myvim scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# Date: 2020-02-15 13:36\n# Version: 1.0\n\necho \"this is my first script\"\ncd /\n[root@shell workspace]# bash 01-scripts.sh \nthis is my first script\n</code></pre> <p>\u5728\u5f53\u524d bash \u73af\u5883\u4e0b\uff0c\u5f53\u524d\u7ec8\u7aef\u767b\u5f55\u7684 Shell \u4e3a\u7236 Shell\uff0c\u6b64\u79cd\u65b9\u5f0f\u4e3a\u5728\u5f53\u524d Shell \u4e0b\u518d\u542f\u52a8\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u8fd0\u884c Shell \u811a\u672c\u3002</p> <p>Tips: \u6b64\u65b9\u6cd5\u76f4\u63a5\u5728\u7ec8\u7aef\u6307\u5b9a\u89e3\u91ca\u5668\u6765\u6267\u884c\u811a\u672c\uff0c\u6b64\u65f6\u7684\u89e3\u91ca\u5668\u4e3a\u7ec8\u7aef\u6307\u5b9a\u7684\uff0c\u4e0d\u4f7f\u7528\u811a\u672c\u5185\u7b2c\u4e00\u884c\u6307\u5b9a\u7684\u89e3\u91ca\u5668\u6267\u884c\uff0c\u76f4\u63a5\u6307\u5b9a\u89e3\u91ca\u5668\uff0c\u6b64\u65f6\u4e0d\u9700\u8981\u4e3a\u811a\u672c\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#22","title":"2.2 \u76f4\u63a5\u6307\u5b9a\u811a\u672c\u6587\u4ef6\u540d\u79f0","text":"<pre><code>[root@shell workspace]# ll\ntotal 4\n-rw-r--r-- 1 root root 44 Sep  3 14:16 01-scripts.sh\n[root@shell workspace]# . ./01-scripts.sh\n-bash: ./01-scripts.sh: Permission denied\n[root@shell workspace]# chmod +x 01-scripts.sh \n[root@shell workspace]# ll\ntotal 4\n-rwxr-xr-x 1 root root 44 Sep  3 14:16 01-scripts.sh\n[root@shell workspace]# . ./01-scripts.sh \nthis is my first script\n[root@shell workspace]# /workspace/01-scripts.sh \nthis is my first script\n</code></pre> <p>\u5229\u7528\u76f4\u63a5\u5728\u7ec8\u7aef\u6307\u5b9a\u811a\u672c\u6587\u4ef6\u540d\u79f0\u65b9\u5f0f\u6267\u884c\uff0c\u6b64\u79cd\u65b9\u5f0f\u9700\u8981\u4e3a\u811a\u672c\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\uff0c\u5728\u5f53\u524d Shell \u6765\u6267\u884c\uff0c\u4e0d\u542f\u52a8\u5b50 Shell\uff0c\u5229\u7528\u6b64\u79cd\u65b9\u5f0f\u6267\u884c\u811a\u672c\u7684\u89e3\u91ca\u5668\u4e3a\u811a\u672c\u5185\u7684\u7b2c\u4e00\u884c\u6307\u5b9a\u7684\u89e3\u91ca\u5668\uff0c\u4f8b\u5982\u6b64\u4f8b\u4e2d\u4e3a<code>#!/bin/bash</code>\uff0c\u5229\u7528<code>.</code> \u547d\u4ee4\u6765\u6267\u884c\u811a\u672c\uff0c\u4e00\u822c\u7528\u5728\u5f53\u524d\u76ee\u5f55\u6ca1\u6709\u5728 PATH \u4e2d\uff0c\u6240\u4ee5\u7b2c\u4e8c\u4e2a<code>./</code> \u662f\u7528\u6765\u8868\u793a\u5f53\u524d\u76ee\u5f55\u7684\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#23-source","title":"2.3 source \u6267\u884c","text":"<pre><code>[root@xuel-transfer workspace]# bash 01-scripts.sh\nthis is my first script\n[root@xuel-transfer workspace]# ./01-scripts.sh\nthis is my first script\n[root@xuel-transfer workspace]# source 01-scripts.sh\nthis is my first script\n[root@xuel-transfer /]# pwd\n/\n</code></pre> <p>\u5229\u7528\u6b64\u79cd\u65b9\u5f0f\u4e5f\u53ef\u6267\u884c\u811a\u672c\uff0c\u6b64\u65b9\u5f0f\u5728\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u811a\u672c\uff0c\u4e0d\u4f1a\u751f\u6210\u65b0\u7684\u5b50\u8fdb\u7a0b\u3002\u811a\u672c\u6267\u884c\u5b8c\u6bd5\uff0c\u56de\u5230\u5f53\u524d Shell\uff0c\u811a\u672c\u5185\u5982\u679c\u6709 <code>cd \u547d\u4ee4</code>\u811a\u672c\u9000\u51fa\u540e\u4f1a\u5f71\u54cd\u5f53\u524d\u7684\u73af\u5883\u4e0a\u4e0b\u6587\uff0c\u6b64\u79cd\u65b9\u5f0f\u8fd0\u884c Shell\uff0c\u811a\u672c\u4e5f\u53ef\u4ee5\u6ca1\u6709\u53ef\u6267\u884c\u6743\u9650\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#3","title":"3. \u8c03\u8bd5","text":"<p>\u5728\u6211\u4eec\u6267\u884c Shell \u811a\u672c\u7684\u65f6\u5019\u4e3a\u6765\u65b9\u4fbf\u6392\u9664\u5f02\u5e38\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528 <code>-x</code> \u6765\u5f00\u542f\u8c03\u8bd5\uff0c\u4f8b\u5982</p> <pre><code>[root@xuel-transfer workspace]# bash -x 01-scripts.sh\n+ echo 'this is my first script'\nthis is my first script\n+ cd /\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa + \u540e\u9762\u4e3a\u811a\u672c\u7684\u5185\u5bb9\uff0c\u6ca1\u6709 + \u7684\u4e3a\u811a\u672c\u6267\u884c\u7684\u8f93\u51fa</p> <p>\u540c\u65f6\u6211\u4eec\u4e3a\u4e86\u65b9\u4fbf\u67e5\u770b\u811a\u672c\u6253\u5370\u6b63\u5728\u6267\u884c\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u8fd8\u53ef\u4ee5\u5229\u7528 <code>-v</code> \u53c2\u6570\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#4","title":"4. \u5b9e\u4f8b","text":""},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#41-shell","title":"4.1 \u7b2c\u4e00\u4e2a Shell \u9700\u6c42","text":"<p>\u5728\u6b64\u6211\u4eec\u4e5f\u4e0d\u5199 <code>Hello Shell</code> \u4e86\uff0c\u4e3e\u4e00\u4e2a\u975e\u5e38\u5b9e\u7528\u7684\u4f8b\u5b50\uff0c\u91cc\u9762\u8bbe\u8ba1\u4e00\u4e9b\u8bed\u6cd5\u5728\u540e\u671f\u7684\u6587\u7ae0\u4e2d\u5927\u5bb6\u90fd\u80fd\u5b66\u5230\uff0c\u53ef\u4ee5\u5148\u6309\u7167\u64cd\u4f5c\u6b65\u9aa4\u5b9e\u73b0\u3002 \u7ecf\u8fc7\u4e0a\u9762\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u77e5\u9053\u6211\u4eec\u5728\u5199 Shell \u811a\u672c\u7684\u65f6\u5019\u9700\u6700\u597d\u5199\u4e00\u4e9b\u4f5c\u8005\u7684\u4fe1\u606f\uff0c\u5982\u679c\u6bcf\u6b21\u7f16\u5199\u90fd\u624b\u52a8\u6dfb\u52a0\u4e00\u6b21\u5c31\u5f88\u9ebb\u70e6\uff0c\u5982\u679c\u662f IDE \u4e00\u822c\u5de5\u5177\u90fd\u53ef\u4ee5\u81ea\u5b9a\u4e49\u914d\u7f6e\u6dfb\u52a0\u9996\u90e8 banner\uff0c\u4f46\u662f\u5728 Linux \u7cfb\u7edf\u5185\u90e8\u7f16\u5199\u7b80\u5355 Shell \u6216\u6587\u672c\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5c0f\u5de5\u5177\u6765\u5b9e\u73b0\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#42","title":"4.2 \u601d\u8def","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u65b0\u589e\u4e00\u4e2a\u811a\u672c\u5c06\u5176\u6dfb\u52a0\u8fdb PATH \u4e2d\uff0c\u5982\u679c\u5229\u7528\u6b64\u547d\u4ee4\u6253\u5f00\u5df2\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u5229\u7528 vim \u76f4\u63a5\u6253\u5f00\uff0c\u4e0d\u5bf9\u539f\u5185\u5bb9\u4f5c\u51fa\u66f4\u6539\uff0c\u5982\u679c\u4e4b\u524d\u6587\u4ef6\u672a\u5b58\u5728\uff0c\u5c31\u5728\u6587\u4ef6\u9996\u90e8\u81ea\u52a8\u6dfb\u52a0 banner \u5e76\u7528 vim \u6253\u5f00\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#43","title":"4.3 \u5b9e\u73b0","text":"<ul> <li>\u521b\u5efa\u6587\u4ef6   \u9996\u5148\u521b\u5efa\u4e2a\u6587\u4ef6 myvim</li> <li>\u7f16\u5199\u5185\u5bb9</li> </ul> <pre><code>#!/bin/env bash\n# Description: /mybin/myvim scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: auto generate banner\n# Date: 2020-02-15 13:36\n# Version: 1.0\n\n\n# file not exist\n[ $# -eq 0 ] &amp;&amp; echo \"$0 [file],At least one parameter!\" &amp;&amp; exit 1\n\n# add banner\nadd_banner() {\ncat &gt; $1 &lt;&lt; EOF\n#!/bin/env bash\n# Description: $0 scripts\n# Auth: $USER\n# Date: $(date +%F\" \"%H:%M)\n# Version: 1.0\nEOF\n}\n\n# exist file\nfor file in $*;\ndo\n    if [ -f ${file} ];then\n        vim ${file} &amp;&amp; exit 0\n    else\n        touch ${file} &amp;&amp; add_banner ${file} &amp;&amp; vim ${file} &amp;&amp; exit 0\n    fi\ndone\n</code></pre> <ul> <li>\u6dfb\u52a0\u8fdb PATH \u4e2d</li> </ul> <pre><code>[root@devops-server mybin]# chmod +x myvim     # \u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\n[root@devops-server mybin]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin\n[root@devops-server mybin]# echo \"export PATH=\\$PATH:/mybin\" &gt;&gt; /etc/profile       # \u5c06mybin\u6dfb\u52a0\u8fdbPATH\u4e2d\n[root@devops-server mybin]# source /etc/profile\n[root@devops-server mybin]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin:/mybin\n</code></pre>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#44","title":"4.4 \u6548\u679c","text":"<p>\u5229\u7528 myvim \u6765\u7f16\u8f91\u811a\u672c\u53ef\u4ee5\u81ea\u52a8\u751f\u6210 banner\uff0c\u518d\u6b21\u6253\u5f00\u53ef\u4ee5\u7ee7\u7eed\u7f16\u8f91\uff0c\u8fd9\u6837\u5c31\u514d\u53bb\u6765\u6211\u4eec\u6bcf\u6b21\u624b\u52a8\u7f16\u5199 banner \u7684\u9ebb\u70e6\u3002\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u8fdb\u884c\u5c1d\u8bd5\uff0c\u662f\u4e0d\u662f\u611f\u89c9 Shell \u53ef\u4ee5\u4e3a\u6211\u4eec\u5e26\u6765\u65e0\u7a77\u7684\u4e50\u8da3\u3002</p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#5","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u518d\u6b21\u6ce8\u610f\u7f16\u5199 Shell \u9700\u8981\u9075\u5b88\u5176\u89c4\u8303\uff0c\u8fd9\u4e9b\u7ea6\u5b9a\u4fd7\u6210\u7684\u89c4\u5219\u80fd\u5728\u65e5\u540e\u7684\u751f\u4ea7\u73af\u5883\u4e2d\u4e3a\u6211\u4eec\u907f\u514d\u5f88\u591a\u4e0d\u5fc5\u8981\u7684\u5751\u3002</li> <li>\u5b66\u4e60 Shell \u9700\u8981\u591a\u52a8\u624b\u5b9e\u8df5\uff0c\u5b9e\u8df5\u51fa\u771f\u7406\uff0c\u591a\u5199\u52e4\u7ec3\uff0c\u9488\u5bf9\u7ed3\u679c\u591a\u601d\u8003\uff0c\u719f\u7ec3\u8fd0\u7528 man \u6307\u4ee4\u6765\u67e5\u770b Shell \u811a\u672c\u4e2d\u7528\u7684\u7684\u547d\u4ee4\u7684\u53c2\u6570\u53ca\u9009\u9879\u3002</li> <li>\u4e3e\u4e00\u53cd\u4e09\uff0c\u9488\u5bf9\u4e00\u4e2a\u811a\u672c\u5982\u4f55\u80fd\u65e0\u72b6\u6001\uff0c\u66f4\u5065\u58ee\uff0c\u66f4\u7075\u6d3b\u6613\u7ef4\u62a4\uff0c\u9700\u8981\u591a\u6b21\u7684\u4fee\u6539\uff0c\u53cd\u590d\u7684\u6267\u884c\u9a8c\u8bc1\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\uff0c\u5c06\u6570\u636e\u62bd\u8c61\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012\uff0c\u53ef\u4ee5\u8fbe\u5230\u662f\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c\u3002</li> </ul>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#6","title":"6. \u7ecf\u9a8c\u5206\u4eab","text":"<p>\u4f8b\u5982\u4e0a\u9762\u7684\u6211\u7684\u7b2c\u4e00\u4e2a Shell \u811a\u672c\u4f8b\u5b50\uff0c\u518d\u6b21\u53ea\u662f\u629b\u7816\u5f15\u7389\u4f5c\u7528\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4e3e\u4e00\u53cd\u4e09\u601d\u8003\u66f4\u591a\u7684\u7528\u5904\uff0c\u4f8b\u5982\uff0c\u53ef\u4ee5\u83b7\u53d6\u5929\u6c14\uff0c\u5229\u7528\u81ea\u5236\u5c0f\u5de5\u5177\u6765\u8fdb\u884c Shell \u4e0b\u5feb\u901f\u7ffb\u8bd1\u7b49\u3002</p> <p></p>"},{"location":"linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/#7","title":"7. \u5c0f\u7ed3","text":"<p>\u76ee\u524d Shell \u7684\u5185\u5bb9\u975e\u5e38\u591a\uff0c\u5176\u4f5c\u4e3a\u7528\u6237\u548c\u7cfb\u7edf\u5185\u6838\u7684\u6865\u6881\uff0c\u5176\u529f\u80fd\u5f3a\u5927\u4e0d\u8a00\u800c\u55bb\uff0c\u6211\u4eec\u9700\u8981\u5c06\u6709\u9650\u7684\u7cbe\u529b\u653e\u5728\u70ed\u70b9\u77e5\u8bc6\u4e0a\uff0c\u597d\u94a2\u7528\u5728\u5200\u5203\u4e0a\uff0c\u6ce8\u610f\u5b66\u4e60\u65b9\u6cd5\u5b66\u4f1a\u4e3e\u4e00\u53cd\u4e09\uff0c\u8fd9\u6837\u5728\u540e\u671f\u7684 Shell \u5b66\u4e60\u4e2d\u80fd\u591f\u66f4\u52a0\u7684\u5feb\u901f\u9ad8\u6548\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/","title":"10.Shell\u8f93\u5165/\u8f93\u51fa\u91cd\u5b9a\u5411","text":""},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#1-shell","title":"1. Shell \u91cd\u5b9a\u5411","text":""},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#11-shell","title":"1.1 Shell \u91cd\u5b9a\u5411\u662f\u4ec0\u4e48","text":"<p>\u6211\u4eec\u5728\u4e4b\u524d\u7ae0\u8282\u6709\u5b66\u4e60 echo/printf \u6765\u5c06\u6211\u4eec\u7684\u9700\u6c42\u8f93\u51fa\uff0c\u6b64\u65f6\u5c31\u662f\u6211\u4eec\u5c06\u7cfb\u7edf\u7684\u8fd4\u56de\u8f93\u51fa\u5230\u6211\u4eec\u6807\u51c6\u7ec8\u7aef\uff0c\u4f7f\u5f97\u6211\u4eec\u80fd\u591f\u770b\u5230\u6b63\u5e38\u7684\u8f93\u51fa\u7684\u7ed3\u679c\uff0cUnix \u547d\u4ee4\u9ed8\u8ba4\u7684\u8f93\u5165\u8bbe\u5907\u5373 <code>stdin</code> \u4e3a\u952e\u76d8\uff0c\u6807\u51c6\u548c\u9519\u8bef\u8bbe\u5907\u5373 <code>stdout</code> \u4e3a\u663e\u793a\u5668\uff0c\u6211\u4eec\u5229\u7528\u91cd\u5b9a\u5411\u53ef\u4ee5\u5c06\u8f93\u5165\u6539\u4e3a\u6587\u4ef6\uff0c\u6216\u8005\u5c06\u8f93\u51fa\u91cd\u65b0\u5b9a\u5411\u5230\u5176\u4ed6\u8bbe\u5907\u6216\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u91cd\u5b9a\u5411","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86\u7cfb\u7edf\u9ed8\u8ba4\u7684\u8f93\u5165\u4e3a\u952e\u76d8\uff0c\u6807\u51c6\u8f93\u51fa\u4e0e\u9519\u8bef\u8f93\u51fa\u4e3a\u663e\u793a\u5668\uff0c\u5f53\u6211\u4eec\u5728\u7f16\u5199 Shell \u7684\u65f6\u5019\u6709\u4e00\u4e9b\u975e\u4ea4\u4e92\u7684\u64cd\u4f5c\uff0c\u4e0d\u80fd\u901a\u8fc7\u952e\u76d8\u8f93\u5165\uff0c\u6216\u663e\u793a\u7684\u7ed3\u679c\u6211\u4eec\u4e0d\u5e0c\u671b\u5728\u663e\u793a\u5668\u663e\u793a\u7684\u65f6\u5019\uff0c\u6b64\u573a\u666f\u5c31\u9700\u8981\u5229\u7528\u8f93\u5165\u8f93\u51fa\u91cd\u5b9a\u5411\u4e86\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#2-shell","title":"2. Shell \u8f93\u5165\u8f93\u51fa\u91cd\u5b9a\u5411","text":"<p>Linux Shell \u91cd\u5b9a\u5411\u5206\u4e3a\u4e24\u79cd\uff0c\u987e\u540d\u601d\u4e49\uff0c\u8f93\u5165\u91cd\u5b9a\u5411\u5373\u6539\u53d8\u6807\u51c6\u7684\u9ed8\u8ba4\u7cfb\u7edf\u952e\u76d8\u8f93\u5165\uff0c\u8f93\u51fa\u91cd\u5b9a\u5411\u5373\u6539\u53d8\u9ed8\u8ba4\u7684\u7cfb\u7edf\u663e\u793a\u5668\u8f93\u51fa\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#21","title":"2.1 \u6587\u4ef6\u63cf\u8ff0\u7b26","text":"<p>\u5728 Linux \u4e2d\u4e00\u5207\u7686\u6587\u4ef6\uff0c\u5305\u62ec\u6807\u51c6\u8f93\u5165\u8bbe\u5907\uff08\u952e\u76d8\uff09\u548c\u6807\u51c6\u8f93\u51fa\u8bbe\u5907\uff08\u663e\u793a\u5668\uff09\u5728\u5185\u7684\u6240\u6709\u8ba1\u7b97\u673a\u786c\u4ef6\u90fd\u662f\u6587\u4ef6\u3002\u4e3a\u4e86\u8868\u793a\u548c\u533a\u5206\u5df2\u7ecf\u6253\u5f00\u7684\u6587\u4ef6\uff0cLinux \u4f1a\u7ed9\u6bcf\u4e2a\u6587\u4ef6\u5206\u914d\u4e00\u4e2a ID\uff0c\u8fd9\u4e2a ID \u5c31\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u88ab\u79f0\u4e3a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08File Descriptor\uff09\u3002</p> <p>\u5982\u4e0b\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u7c7b\u578b\u53ca\u5176\u5bf9\u5e94\u7684\u8bbe\u5907\u3002</p> \u6587\u4ef6\u63cf\u8ff0\u7b26 \u6587\u4ef6\u540d \u7c7b\u578b \u786c\u4ef6 0 stdin \u6807\u51c6\u8f93\u5165\u6587\u4ef6 \u952e\u76d8 1 stdout \u6807\u51c6\u8f93\u51fa\u6587\u4ef6 \u663e\u793a\u5668 2 stderr \u6807\u51c6\u9519\u8bef\u8f93\u51fa\u6587\u4ef6 \u663e\u793a\u5668 <p>Linux \u7a0b\u5e8f\u5728\u4f60\u6267\u884c\u4efb\u4f55\u5f62\u5f0f\u7684 I/O \u64cd\u4f5c\u65f6\uff0c\u5176\u5b9e\u90fd\u662f\u5728\u5bf9\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u8fdb\u884c\u8bfb\u53d6\u6216\u5199\u5165\uff0c\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u53ea\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u4ef6\u76f8\u5173\u8054\u7684\u6574\u6570\uff0c\u5728\u5176\u80cc\u540e\u5c31\u662f\u786c\u76d8\u4e0a\u4e00\u4e2a\u666e\u901a\u6587\u4ef6\u6216\u7ba1\u9053\uff0c\u952e\u76d8\uff0c\u663e\u793a\u5668\uff0c\u6216\u662f\u4e00\u4e2a\u7f51\u7edc\u94fe\u63a5\u7b49\u3002</p> <p></p> <p>\u5982\u56fe\u66f4\u4e3a\u5f62\u8c61\u7684\u5c55\u793a\u952e\u76d8\u662f Linux \u7cfb\u7edf\u9ed8\u8ba4\u6807\u51c6\u8f93\u5165\u8bbe\u5907\uff0c\u5f53\u7136\u53ef\u4ee5\u91cd\u5b9a\u5411\u4e3a file\uff0c\u5bf9\u5e94\u7684\u547d\u4ee4\u6267\u884c\u7684\u6807\u51c6\u8f93\u51fa\u4e0e\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u8bbe\u5907\u4e3a\u5c4f\u5e55\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#22","title":"2.2 \u8f93\u5165\u91cd\u5b9a\u5411","text":"<p>\u8f93\u5165\u65b9\u5411\u4e3a\u6570\u636e\u4ece\u90a3\u6d41\u5165\u7a0b\u5e8f\uff0c\u8f93\u5165\u91cd\u5b9a\u5411\u5373\u6539\u53d8\u9ed8\u8ba4\u7684\u7cfb\u7edf\u952e\u76d8\u8f93\u5165\uff0c\u6539\u53d8\u5176\u4ece\u5176\u4ed6\u5bf9\u65b9\u6d41\u5165\u7a0b\u5e8f\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#221","title":"2.2.1 &lt;","text":"<p>command &lt;file\uff0c\u5c06 file \u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u4f5c\u4e3a command \u7684\u8f93\u5165\u3002</p> <p>\u683c\u5f0f\uff1a</p> <pre><code> [n]&lt; word \n</code></pre> <p>\u6ce8\u610f [n] \u4e0e &lt; \u4e4b\u95f4\u6ca1\u6709\u7a7a\u683c\uff0c\u5176\u4e2d\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26 n \u91cd\u5b9a\u5411\u5230 word \u6307\u4ee3\u7684\u6587\u4ef6\uff08\u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6253\u5f00), \u5982\u679c\u4e0d\u663e\u793a\u6307\u660e n\uff0c\u9ed8\u8ba4\u5c31\u4e3a 0\uff0c\u6807\u51c6\u8f93\u5165\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat testfile.txt\ntest content\n[root@xuel-terraform-cvm-0 ~]# cat 0&lt; testfile.txt\ntest content\n[root@xuel-terraform-cvm-0 ~]# cat &lt; testfile.txt\ntest content\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230 <code>testfile.txt</code> \u6587\u4ef6\u5185\u5bb9\u4e3a <code>test content</code>\uff0c\u5728\u8f93\u5165\u91cd\u5b9a\u5411\u65f6\uff0c\u6211\u4eec\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26 0 \u91cd\u5b9a\u5411\u5230 <code>testfile.txt</code>\uff0c\u6240\u4ee5\u5229\u7528\u547d\u4ee4 cat \u67e5\u770b\uff0c\u7ed3\u679c\u5c31\u4e3a\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u9ed8\u8ba4\u5c31\u662f\u6807\u51c6\u8f93\u5165\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e0d\u5199 0\u3002</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# 0&lt; testfile.txt cat\ntest content\n[root@xuel-terraform-cvm-0 ~]# &lt; testfile.txt cat\ntest content\n</code></pre> <p>\u89e3\u6790\u5668\u89e3\u6790\u5230 \u201c&lt;\u201d \u4ee5\u540e\u4f1a\u5148\u5904\u7406\u91cd\u5b9a\u5411\uff0c\u5c06\u6807\u51c6\u8f93\u5165\u91cd\u5b9a\u5411\u5230 file\uff0c\u4e4b\u540e cat \u518d\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u6807\u51c6\u8f93\u5165\u5df2\u7ecf\u91cd\u5b9a\u5411\u5230\u4e86 file \uff0c\u4e8e\u662f cat \u5c31\u4ece file \u4e2d\u8bfb\u53d6\u6307\u4ee4\u4e86\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#222-eof","title":"2.2.2 &lt;&lt;EOF","text":"<p>command &lt;&lt;END\uff0c\u4ece\u6807\u51c6\u8f93\u5165\uff08\u952e\u76d8\uff09\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u76f4\u5230\u9047\u89c1\u5206\u754c\u7b26 END \u624d\u505c\u6b62\uff0c\u5206\u754c\u7b26\u53ef\u4ee5\u662f\u81ea\u5b9a\u4e49\u7684\u4efb\u610f\u5b57\u7b26\uff0c\u5728\u6b64\u5efa\u8bae\u4f7f\u7528 EOF\u3002</p> <p>\u8be5\u8f93\u5165\u91cd\u5b9a\u5411\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7528\u4e8e\u6279\u91cf\u6587\u4ef6\u7684\u8f93\u5165\uff0c\u53ef\u4ee5\u7528\u6b64\u6765\u521b\u5efa\u6587\u4ef6\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat &gt; file1.txt &lt;&lt;EOF\n&gt; hello shell\n&gt; hello go\n&gt; test file\n&gt; EOF\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\nhello shell\nhello go\ntest file\n</code></pre> <p>\u5728\u6b64\u5229\u7528\u4e86\u5c06 cat \u7684\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6587\u4ef6 <code>file1.txt</code> \u4e2d\uff0c\u4e4b\u540e\u5229\u7528 &lt;&lt;EOF \u6765\u4ece\u6807\u51c6\u8f93\u5165\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u76f4\u5230\u9047\u5230\u7ed3\u675f\u6807\u793a EOF \u505c\u6b62\u3002</p> <p>\u4f8b\u5982\u6211\u4eec\u5728\u5b66\u4e60\u6d41\u7a0b\u63a7\u5236\u4e2d\u7684 while \u5faa\u73af\u8bfb\u53d6\u6587\u4ef6\u5c31\u5229\u7528\u4e86\u8f93\u5165\u91cd\u5b9a\u5411\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat while.sh\n#!/bin/bash\n\nFILE=file1.txt\nwhile read str; do\n    echo $str\ndone &lt;$FILE\n\n[root@xuel-terraform-cvm-0 ~]# bash while.sh\nhello shell\nhello go\ntest file\n</code></pre> <p>\u5728\u6b64\u5c06\u6587\u4ef6\u7ed1\u5b9a\u5230\u8f93\u5165\u91cd\u5b9a\u5411\u4e0a\uff0c\u5229\u7528 while \u6765\u9010\u884c\u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#23","title":"2.3 \u8f93\u51fa\u91cd\u5b9a\u5411","text":"<p>\u8f93\u51fa\u65b9\u5411\u4e3a\u6570\u636e\u8f93\u51fa\u5230\u90a3\u4e2a\u7ec8\u7aef\uff0c\u8f93\u51fa\u91cd\u5b9a\u5411\u5373\u6539\u53d8\u9ed8\u8ba4\u7684\u663e\u793a\u5668\u8f93\u51fa\uff0c\u6539\u53d8\u5176\u4ece\u5176\u4ed6\u8bbe\u5907\u8f93\u51fa\u3002</p> <p>\u4e00\u822c\u8f93\u51fa\u91cd\u5b9a\u5411\u7684\u5e94\u7528\u573a\u666f\u591a\u4e3a\u5c06\u6807\u51c6\u8f93\u51fa\u6216\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u5206\u522b\u4fdd\u6301\u5230\u4e0d\u540c\u7684\u6587\u4ef6\uff0c\u6216\u8005\u662f\u6211\u4eec\u4e0d\u5173\u5fc3\u8f93\u51fa\u7b49\u60c5\u51b5\u7b49\u3002</p> <p>\u5982\u4e0b\u6574\u7406\u7684\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411\u4e0e\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u91cd\u5b9a\u5411\uff1a</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#231","title":"2.3.1 \u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411","text":"<ul> <li>\u8986\u76d6\u65b9\u5f0f</li> </ul> <p>\u8bed\u6cd5\uff1a<code>command &gt;file</code></p> <p>\u6807\u51c6\u8f93\u5165\u91cd\u5b9a\u5411\u8986\u76d6\u65b9\u5f0f\uff0c\u76f4\u63a5\u5c06 command \u547d\u4ee4\u7684\u6807\u51c6\u8f93\u51fa\uff0c\u4ee5\u8986\u76d6\u65b9\u5f0f\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat file1.txt\nhello shell\nhello go\ntest file\n[root@xuel-terraform-cvm-0 ~]# echo \"test\" &gt; file1.txt\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\ntest\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5c06\u6587\u4ef6\u7684\u539f\u59cb\u5185\u5bb9\u5df2\u7ecf\u8986\u76d6\u6389\u4e86\uff0c\u4e5f\u53ef\u4ee5\u7528\u6765\u6e05\u7a7a\u6587\u4ef6\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat file1.txt\ntest\n[root@xuel-terraform-cvm-0 ~]# &gt;file1.txt\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\n</code></pre> <ul> <li>\u8ffd\u52a0\u65b9\u5f0f</li> </ul> <p>\u8bed\u6cd5\uff1a<code>command &gt;&gt;file</code></p> <p>\u5c06\u6807\u51c6\u7684\u8f93\u51fa\u8ffd\u52a0\u5230\u6587\u4ef6\u4e2d\uff0c\u6ce8\u610f\u8ffd\u52a0\u4e3a\u4e0d\u8986\u76d6\u539f\u59cb\u6587\u4ef6\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat file1.txt\ntest\n[root@xuel-terraform-cvm-0 ~]# echo \"test222\" &gt;&gt; file1.txt\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\ntest\ntest222\n</code></pre>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#232","title":"2.3.2 \u9519\u8bef\u8f93\u51fa\u91cd\u5b9a\u5411","text":"<ul> <li>\u8986\u76d6\u65b9\u5f0f\uff1a</li> </ul> <p>\u8bed\u6cd5\uff1a<code>command 2&gt;file</code></p> <p>\u4e0e\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411\u4e00\u6837\uff0c\u53ea\u662f\u7ed1\u5b9a\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u6587\u4ef6\u63cf\u8ff0\u7b26 2\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# ls /none\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n[root@xuel-terraform-cvm-0 ~]# ls /none 2&gt; error.txt\n[root@xuel-terraform-cvm-0 ~]# cat error.txt\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>ls</code> \u67e5\u770b\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u4f1a\u8f93\u51fa\u6807\u51c6\u9519\u8bef\u8f93\u51fa\uff0c\u5c06\u5176\u91cd\u5b9a\u5411\u5230 error.txt \u4e2d\u3002</p> <ul> <li>\u8ffd\u52a0\u65b9\u5f0f:</li> </ul> <p>\u8bed\u6cd5\uff1a<code>command 2&gt;&gt;file</code></p> <p>\u4e0e\u6807\u51c6\u8f93\u51fa\u8ffd\u52a0\u65b9\u5f0f\u4e00\u6837\uff0c\u53ea\u662f\u7ed1\u5b9a\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# abc 2&gt;&gt;error.txt\n[root@xuel-terraform-cvm-0 ~]# cat error.txt\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n-bash: abc: command not found\n</code></pre> <p>\u6211\u4eec\u4f7f\u7528\u547d\u4ee4 abc\uff0cShell \u63d0\u793a\u6211\u4eec\u6ca1\u6709\u8fd9\u4e2a\u547d\u4ee4\uff0c\u5728\u6b64\u5c31\u5c06\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u4ee5\u8ffd\u52a0\u5f62\u5f0f\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#233","title":"2.3.3 \u5168\u90e8\u91cd\u5b9a\u5411","text":"<p>\u5728\u6211\u4eec\u4f7f\u7528\u8f93\u51fa\u91cd\u5b9a\u5411\u5206\u4e3a\u6807\u51c6\u8f93\u51fa\u4e0e\u9519\u8bef\u8f93\u51fa\uff0c\u5f53\u6211\u4eec\u5e0c\u671b\u5c06\u4e24\u8005\u90fd\u91cd\u5b9a\u5411\u5230\u67d0\u6587\u4ef6\u4f7f\u7528\u53ef\u4ee5\u4f7f\u7528 <code>&amp;&gt;</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat totle.txt\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n/tmp:\ncpulimit-0.2\ncvm_init.log\nnet_affinity.log\nnohup.out\nnv_driver_install.log\nnv_gpu_conf.log\nsetRps.log\nv0.2.tar.gz\nvirtio_blk_affinity.log\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u65e0\u8bba\u6807\u51c6\u8f93\u51fa\u6216\u9519\u8bef\u8f93\u51fa\u90fd\u91cd\u5b9a\u5411\u5230\u4e86 <code>totle.txt</code> \u6587\u4ef6\u4e2d\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#24","title":"2.4 \u7ec4\u5408\u4f7f\u7528","text":"<p>\u8f93\u5165\u548c\u8f93\u51fa\u4e5f\u662f\u53ef\u4ee5\u7ec4\u5408\u4f7f\u7528\u7684\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ec4\u5408\u4e3b\u8981\u5e94\u7528\u4e8e\u5728 Shell \u811a\u672c\u5f53\u4e2d\u4ea7\u751f\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\u7684\u573a\u666f\u4e0b\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat &gt; file1.txt &lt;&lt;EOF\n&gt; hello shell\n&gt; hello go\n&gt; test file\n&gt; EOF\n[root@xuel-terraform-cvm-0 ~]# cat file1.txt\nhello shell\nhello go\ntest file\n</code></pre> <p>\u5728\u6b64\u5c31\u7ec4\u5408\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411\u4e0e\u8f93\u5165\u91cd\u5b9a\u5411\u7ec4\u5408\u4f7f\u7528\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#25","title":"2.5 \u7a7a\u8bbe\u5907","text":"<p>\u5728 Linux \u7cfb\u7edf\u4e2d\u5b58\u5728\u4e00\u4e2a\u7a7a\u8bbe\u5907\uff0c\u4e5f\u6210\u4e3a\u9ed1\u6d1e\u8bbe\u5907\uff0c\u5176\u4e3a <code>/dev/null</code>\u3002\u5f53\u6211\u4eec\u5c06\u5185\u5bb9\u91cd\u5b9a\u5411\u5230\u5b83\u65f6\u4f1a\u88ab\u4e22\u5f03\uff0c\u5bf9\u5176\u4e5f\u65e0\u6cd5\u8fdb\u884c\u8bfb\u53d6\u5185\u5bb9\u64cd\u4f5c\uff0c\u5229\u7528\u5b83\uff0c\u53ef\u4ee5\u5728\u6211\u4eec\u7f16\u5199 Shell \u4e2d\u80fd\u591f\u8d77\u5230\u7981\u6b62\u5f02\u5e38\u8f93\u51fa\u7684\u529f\u6548\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# ls / /none\nls: \u65e0\u6cd5\u8bbf\u95ee/none: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n/:\nbin  boot  data  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  selinux  srv  sys  tmp  usr  var\n[root@xuel-terraform-cvm-0 ~]# ls / /none &gt;/dev/null 2&gt;&amp;1\n[root@xuel-terraform-cvm-0 ~]# ls / /none &amp;&gt;/dev/null\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5148\u5c06\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411\u5230 <code>/dev/null</code>\uff0c\u5bf9\u4e8e\u9519\u8bef\u6807\u51c6\u8f93\u51fa\u5168\u90e8\u53c8\u91cd\u5b9a\u5411\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u4ece\u800c\u8fbe\u5230\u4e86\u5c06\u5168\u90e8\u8f93\u51fa\u7981\u6b62\u6389\u3002</p> <p>\u6216\u8005\u6211\u4eec\u4f7f\u7528 <code>&amp;</code> \u5c06\u6807\u51c6\u8f93\u51fa\u4e0e\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u5168\u90e8\u91cd\u5b9a\u5411\u5230 <code>/dev/null</code>\uff0c\u540c\u6837\u80fd\u8fbe\u5230\u7981\u6b62\u8f93\u51fa\u7684\u6548\u679c\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#3","title":"3. \u5b9e\u4f8b","text":""},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#31","title":"3.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u83b7\u53d6 Linux \u7cfb\u7edf\u7684 CPU \u548c\u5185\u5b58\u4fe1\u606f\uff0c\u7136\u540e\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#32","title":"3.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u51fd\u6570\u6765\u5206\u522b\u7f16\u5199 CPU \u548c\u5185\u5b58\u4fe1\u606f\uff0c\u6700\u540e\u5229\u7528\u91cd\u5b9a\u5c06\u4fe1\u606f\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#33","title":"3.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# Description: sys check\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: sys check\n# Date: 2020-03-29 14:00\n# Version: 1.0\n\n[ $(id -u) -gt 0 ] &amp;&amp; echo \"\u8bf7\u7528root\u7528\u6237\u6267\u884c\u6b64\u811a\u672c\uff01\" &amp;&amp; exit 1\nsysversion=$(rpm -q centos-release|cut -d- -f3)\nline=\"-------------------------------------------------\"\n\n\n[ -d logs ] || mkdir logs\n\nsys_check_file=\"logs/$(ip a show dev eth0|grep -w inet|awk '{print $2}'|awk -F '/' '{print $1}')-`date +%Y%m%d`.txt\"\n\n# \u83b7\u53d6\u7cfb\u7edfcpu\u4fe1\u606f\nfunction get_cpu_info() {\n    Physical_CPUs=$(grep \"physical id\" /proc/cpuinfo| sort | uniq | wc -l)\n    Virt_CPUs=$(grep \"processor\" /proc/cpuinfo | wc -l)\n    CPU_Kernels=$(grep \"cores\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}')\n    CPU_Type=$(grep \"model name\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq)\n    CPU_Arch=$(uname -m)\ncat &lt;&lt;EOF | column -t\nCPU\u4fe1\u606f:\n\u7269\u7406CPU\u4e2a\u6570: $Physical_CPUs\n\u903b\u8f91CPU\u4e2a\u6570: $Virt_CPUs\n\u6bcfCPU\u6838\u5fc3\u6570: $CPU_Kernels\nCPU\u578b\u53f7: $CPU_Type\nCPU\u67b6\u6784: $CPU_Arch\nEOF\n}\n\n# \u83b7\u53d6\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f\nfunction get_mem_info() {\n    check_mem=$(free -m)\n    MemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}')  #KB\n    MemFree=$(grep MemFree /proc/meminfo| awk '{print $2}')    #KB\n    let MemUsed=MemTotal-MemFree\n    MemPercent=$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\n    report_MemTotal=\"$((MemTotal/1024))\"\"MB\"        #\u5185\u5b58\u603b\u5bb9\u91cf(MB)\n    report_MemFree=\"$((MemFree/1024))\"\"MB\"          #\u5185\u5b58\u5269\u4f59(MB)\n    report_MemUsedPercent=\"$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\"\"%\"   #\u5185\u5b58\u4f7f\u7528\u7387%\n\ncat &lt;&lt;EOF\n\u5185\u5b58\u4fe1\u606f\uff1a\n${check_mem}\nEOF\n}\n\n# \u5b9a\u4e49\u4e3b\u51fd\u6570\nfunction sys_check() {\n    get_cpu_info\n    echo ${line}\n    get_mem_info\n    echo ${line}\n}\n\n# \u6267\u884c\u4e3b\u51fd\u6570\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u4e2d\nsys_check &gt; ${sys_check_file}\n\n# \u6267\u884c\u6d4b\u8bd5\n[root@xuel-terraform-cvm-0 ~]# bash sys_check.sh\n[root@xuel-terraform-cvm-0 ~]# cat logs/10.0.1.15-20200329.txt\nCPU\u4fe1\u606f:\n\u7269\u7406CPU\u4e2a\u6570:  1\n\u903b\u8f91CPU\u4e2a\u6570:  1\n\u6bcfCPU\u6838\u5fc3\u6570:  1\nCPU\u578b\u53f7:      Intel(R)  Xeon(R)  CPU  E5-26xx  v4\nCPU\u67b6\u6784:      x86_64\n-------------------------------------------------\n\u5185\u5b58\u4fe1\u606f\uff1a\n             total       used       free     shared    buffers     cached\nMem:           996        920         76          0        191        600\n-/+ buffers/cache:        127        868\nSwap:            0          0          0\n-------------------------------------------------\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5229\u7528\u4e86\u4e24\u4e2a\u51fd\u6570\u6765\u83b7\u53d6\u7cfb\u7edf\u7684\u4fe1\u606f\uff0c\u5c06\u5176\u5229\u7528\u91cd\u5b9a\u5411\u65b9\u5f0f\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#4","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u4e00\u6761 shell \u547d\u4ee4\uff0c\u90fd\u4f1a\u7ee7\u627f\u5176\u7236\u8fdb\u7a0b\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u56e0\u6b64\u6240\u6709\u7684 shell \u547d\u4ee4\uff0c\u90fd\u4f1a\u9ed8\u8ba4\u6709\u4e09\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff1b</li> <li>\u6587\u4ef6\u6240\u6709\u8f93\u5165\u8f93\u51fa\u90fd\u662f\u7531\u8be5\u8fdb\u7a0b\u6240\u6709\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u63a7\u5236\u7684\uff0cLinux \u4e00\u5207\u7686\u6587\u4ef6\uff0c\u56e0\u6b64\u4ed6\u4eec\u7684\u8f93\u5165\u8f93\u51fa\u4e5f\u662f\u7531\u6587\u4ef6\u63cf\u8ff0\u7b26\u63a7\u5236\uff1b</li> <li>\u5728 <code>&lt;</code>\u4e2d\u5206\u754c\u7b26\u53ef\u4ee5\u662f\u81ea\u5b9a\u4e49\u7684\u4efb\u610f\u5b57\u7b26\uff0c\u5728\u6b64\u5efa\u8bae\u4f7f\u7528 EOF\uff1b</li> <li>\u5728\u8fdb\u884c\u6587\u4ef6\u8ffd\u52a0\u7684\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528\u8ffd\u52a0\u65b9\u5f0f\u91cd\u5b9a\u5411\uff0c\u5207\u8bb0\u64cd\u4f5c\u6587\u4ef6\u524d\u5907\u4efd\u8001\u6587\u4ef6\uff0c\u4ee5\u514d\u6587\u4ef6\u5185\u5bb9\u5f02\u5e38\u3002</li> </ul>"},{"location":"linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/#5","title":"5. \u5c0f\u7ed3","text":"<p>\u5bf9\u4e8e\u91cd\u5b9a\u5411\u7279\u522b\u9002\u7528\u4e8e\u6587\u4ef6\u7684\u64cd\u4f5c\u6216\u8005\u67d0\u4e9b\u4e0d\u5173\u6ce8\u8f93\u51fa\u7ed3\u679c\u7684\u573a\u666f\uff0c\u5728\u672c\u7ae0\u8282\u9700\u8981\u6ce8\u610f\u8986\u76d6\u5f0f\u4e0e\u8ffd\u52a0\u6a21\u5f0f\u7684\u533a\u522b\uff0c\u7075\u6d3b\u914d\u5408\u7a7a\u8bbe\u5907\u5bf9\u7279\u5b9a\u573a\u666f\u8fdb\u884c\u5e94\u7528\uff0c\u7406\u89e3\u4e09\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u767e\u53d8\u4e0d\u79bb\u5176\u4e2d\u7075\u6d3b\u7ec4\u5408\u4f7f\u7528\u3002</p>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/","title":"11.Shell \u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#1-shell","title":"1 Shell \u6b63\u5219\u8868\u8fbe\u5f0f\u6982\u8ff0","text":""},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#11","title":"1.1 \u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4ec0\u4e48","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f (regular expression) \u662f\u4e00\u4e9b\u5177\u4f53\u6709\u7279\u6b8a\u542b\u4e49\u7684\u7b26\u53f7\uff0c\u7ec4\u5408\u5728\u4e00\u8d77\u7684\u5171\u540c\u63cf\u8ff0\u5b57\u7b26\u6216\u5b57\u7b26\u4e32\u7684\u65b9\u6cd5\uff0c\u901a\u4fd7\u6765\u8bb2\u6b63\u5219\u4e3a\u63cf\u8ff0\u540c\u4e00\u7c7b\u4e8b\u7269\u7684\u89c4\u5219\uff0c\u4f8b\u5982\u6211\u4eec\u751f\u6d3b\u4e2d\u63cf\u8ff0\u53ef\u4ee5\u98de\u884c\u7684\u662f\u4e8b\u7269\uff0c\u5219\u6ee1\u8db3\u8fd9\u6761\u89c4\u5219\u7684\u53ef\u4ee5\u662f\u9e1f\uff0c\u8774\u8776\uff0c\u4e5f\u53ef\u4ee5\u662f\u98de\u673a\u7b49\u3002</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u901a\u5e38\u7528\u6765\u5bf9\u5b57\u7b26\u6216\u5b57\u7b26\u4e32\u6765\u8fdb\u884c\u5904\u7406\uff0c\u5b83\u662f\u7528\u4e8e\u63cf\u8ff0\u5b57\u7b26\u6392\u5217\u6216\u5339\u914d\u6a21\u5f0f\u7684\u4e00\u79cd\u8bed\u8a00\u89c4\u5219\u3002</p>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u6211\u4eec\u77e5\u9053\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4e00\u4e2a\u63cf\u8ff0\u5b57\u7b26\u6392\u5217\u6216\u6a21\u5f0f\u5339\u914d\u7684\u89c4\u5219\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5b83\u6765\u5236\u5b9a\u81ea\u5df1\u7684\u89c4\u5219\uff0c\u83b7\u53d6\u5230\u6211\u4eec\u60f3\u8981\u7684\u7ed3\u679c\u7b49\u3002\u5728\u540e\u7eed\u7684 Shell \u4e09\u5251\u5ba2 grep/awk/sed Shell \u7684\u5b66\u4e60\u4e2d\uff0c\u6211\u4eec\u4f1a\u7ed3\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0e\u8fd9\u4e9b\u547d\u4ee4\u8fdb\u884c\u7ed3\u5408\u4f7f\u7528\uff0c\u6765\u5b9e\u73b0\u66f4\u5f3a\u5927\u7684\u6587\u672c\u5904\u7406\u529f\u80fd\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u6211\u4eec Shell \u5b66\u4e60\u7684\u6838\u5fc3\u4e5f\u662f\u96be\u70b9\uff0c\u5728 Linux \u4e2d\u4e00\u5207\u7686\u6587\u4ef6\uff0c\u591a\u6587\u4ef6\u7684\u5904\u7406\u53ef\u4ee5\u8986\u76d6\u6211\u4eec\u65e5\u5e38\u5de5\u4f5c\u7684 90%\uff0c\u6240\u6709\u719f\u7ec3\u638c\u63e1\u6b63\u5219\u8868\u8fbe\u5f0f\u663e\u5f97\u5c24\u4e3a\u91cd\u8981\uff0c\u5728\u4e4b\u540e\u7075\u6d3b\u914d\u5408\u5176\u4ed6\u547d\u4ee4\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u6ee1\u8db3\u6211\u4eec\u7684\u65e5\u5e38\u5904\u7406\u9700\u6c42\u3002</p>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#2-shell","title":"2 Shell \u6b63\u5219\u8868\u8fbe\u64cd\u4f5c","text":"<p>\u5728\u5b66\u4e60\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u64cd\u4f5c\u4e4b\u524d\u6211\u4eec\u9700\u8981\u4e86\u89e3\u4e0b POSIX \u53ca\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5206\u7c7b\u3002</p>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#21","title":"2.1 \u9884\u5907\u77e5\u8bc6","text":""},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#211-posix","title":"2.1.1 POSIX","text":"<p>POSIX \u79f0\u4e3a\uff1aPortable Operating System Interface\uff08\u672b\u5c3e\u589e\u52a0 X \u53ea\u662f\u4e3a\u4e86\u66f4\u6d41\u7545\uff09\u7684\u7f29\u5199\uff0c\u540e\u6765\u88ab IEEE \u91c7\u7eb3\uff0c\u7531\u4e8e\u5728\u65e9\u671f Unix \u7cfb\u7edf\u65f6\u4ee3\u5404\u5382\u5546\u53d1\u5e03\u4e0d\u540c\u7248\u672c\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5404\u7248\u672c\u4e4b\u95f4\u5b58\u5728\u7740\u4ea7\u54c1\u7684\u5dee\u5f02\uff0c\u4e4b\u540e IEEE \u53d1\u5e03\u4e86\u4e00\u5957 Unix \u548c\u7c7b Unix \u7cfb\u7edf\u5de5\u4f5c\u65b9\u5f0f\u89c4\u8303\uff0c\u81f3\u6b64\u5404\u5e38\u89c1\u9075\u5faa\u6b64\u89c4\u8303\u6765\u8fbe\u5230\u8f6f\u4ef6\u517c\u5bb9\u7684\u6548\u679c\u3002</p>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#212","title":"2.1.2 \u6b63\u5219\u8868\u8fbe\u5f0f\u5206\u7c7b","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u5e38\u89c1\u7684\u6709\u4e24\u79cd\u5206\u7c7b\uff1a</p> <ul> <li>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\uff1aBasic Regular Expression \u53c8\u53eb Basic RegEx \u7b80\u79f0 BREs\uff0c\u5728\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u4f5c\u7528\u7684\u5143\u5b57\u7b26\u4e3a\uff1a^ \u3001$\u3001 . \u3001[\u3001] \u3001*\u3002</li> <li>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff1aExtended Regular Expression \u53c8\u53eb Extended RegEx \u7b80\u79f0 EREs\uff0c\u5176\u4e3a\u5728\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0a\u65b0\u589e\u4e86 (\u3001) \u3001{ \u3001} \u3001?\u3001 + \u3001\u7b49\u5143\u5b57\u7b26\u5143\u5b57\u7b26\uff0c\u4f7f\u5f97\u6b63\u5219\u8868\u8fbe\u5f0f\u66f4\u52a0\u7b80\u6d01\u6613\u7528\u3002</li> </ul>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#213","title":"2.1.3 \u5b57\u7b26","text":"<p>\u5728\u5b66\u4e60\u6b63\u5219\u8868\u8fbe\u5f0f\u524d\u9700\u8981\u5148\u5b66\u4e60\u5b57\u7b26\u3002</p> <ul> <li>POSIX \u5b57\u7b26</li> </ul> <p>\u901a\u7528 POSIX \u539f\u5b57\u7b26\u5165\u4e0b\uff1a</p> <pre><code>[:alnum:] \u5b57\u6bcd\u6570\u5b57[a-z A-Z 0-9]\n[:alpha:]   \u5b57\u6bcd[a-z A-Z]\n[:blank:]   \u7a7a\u683c\u6216\u5236\u8868\u952e\n[:cntrl:] \u4efb\u4f55\u63a7\u5236\u5b57\u7b26\n[:digit:] \u6570\u5b57 [0-9]\n[:graph:] \u4efb\u4f55\u53ef\u89c6\u5b57\u7b26\uff08\u65e0\u7a7a\u683c\uff09\n[:lower:] \u5c0f\u5199 [a-z]\n[:print:] \u975e\u63a7\u5236\u5b57\u7b26 \n[:punct:] \u6807\u70b9\u5b57\u7b26\n[:space:] \u7a7a\u683c\n[:upper:] \u5927\u5199 [A-Z]\n[:xdigit:] \u5341\u516d\u8fdb\u5236\u6570\u5b57 [0-9 a-f A-F]\n</code></pre> <ul> <li>\u7279\u6b8a\u5b57\u7b26</li> </ul> <p>\u5728\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u52a0\u4e0a <code>\\</code> \u5219\u88ab\u8ba4\u4e3a\u5176\u5177\u6709\u7279\u6b8a\u542b\u4e49\uff1a</p> <pre><code>\\w \u5339\u914d\u4efb\u610f\u6570\u5b57\u548c\u5b57\u6bcd\uff0c\u7b49\u6548[a-zA-Z0-9_]\n\\W \u548c\\w\u76f8\u53cd\uff0c\u7b49\u6548[^a-zA-Z0-9_]\n\\b \u5339\u914d\u5b57\u7b26\u4e32\u5f00\u59cb\u6216\u7ed3\u675f\uff0c\u7b49\u6548\\&lt;\u548c\\&gt;\n\\s \u5339\u914d\u4efb\u610f\u7684\u7a7a\u767d\u5b57\u7b26\n\\S \u5339\u914d\u975e\u7a7a\u767d\u5b57\u7b26\n</code></pre>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#214","title":"2.1.4 \u533a\u522b","text":"<ul> <li>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5143\u5b57\u7b26\uff1a\u53ea\u6709 ^$.*\uff1b</li> <li>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u5143\u5b57\u7b26\uff1a^$.*+(){}?|\uff1b</li> <li>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u5bf9\u4e8e {m,n} \u548c () \u4e0d\u9700\u8981\u518d\u5411\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u9700\u8981 <code>\\</code> \u6765\u8f6c\u8bd1\u3002</li> </ul>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#22","title":"2.2 \u6b63\u5219\u8868\u8fbe\u5f0f\u64cd\u4f5c","text":"<p>\u5728 Linux \u4e2d\u6b63\u5219\u8868\u8fbe\u5f0f\u7528\u6765\u5904\u7406\u6587\u672c\uff0c\u5728\u6b64\u6211\u4eec\u4f7f\u7528 grep \u5de5\u5177\u5bf9\u6b63\u5219\u8868\u8fbe\u5f0f\u8fdb\u884c\u64cd\u4f5c\uff0cgrep \u4e3a\u6587\u672c\u8fc7\u6ee4\u5de5\u5177\uff0c\u5728 grep \u547d\u4ee4\u4e2d\u9ed8\u8ba4\u4f7f\u7528\u7684\u65f6\u5019\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528\u9009\u9879 <code>-E</code> \u6765\u5f00\u542f\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u6309\u7167\u6307\u5b9a\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u53d6\u51fa\u6211\u4eec\u9700\u6c42\u7684\u5185\u5bb9\u3002</p>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#221","title":"2.2.1 \u5b57\u7b26\u5339\u914d","text":"<p>\u5728\u5b57\u7b26\u5339\u914d\u524d\u9700\u8981\u5148\u5b66\u4e60\u3002</p> <ul> <li><code>.</code>: \u5339\u914d\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test.txt \nshe\nsh\ns1e\n[root@master reg]# grep \"s.e\" test.txt \nshe\ns1e\n</code></pre> <p><code>.</code> \u5339\u914d\u5fc5\u987b\u4e3a\u5b57\u6bcd s \u4e0e e \u4e2d\u6709\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\u3002</p> <ul> <li></li> </ul> <pre><code>[root@master reg]# cat test.txt \nshe\nsh\ns1e\n[root@master reg]# grep \"s[a-z]e\" test.txt \nshe\n[root@master reg]# grep \"s[1-9]e\" test.txt    \ns1e\n[root@master reg]# grep \"s[[:alnum:]]e\" test.txt      // \u5339\u914d\u5b57\u7b26\u6216\u6570\u5b57  \nshe\ns1e\n[root@master reg]# grep \"s[[:alpha:]]e\" test.txt    \nshe\n[root@master reg]# grep \"s[[:digit:]]e\" test.txt      \ns1e\n</code></pre> <p>\u4e2d\u62ec\u53f7\u5185\u53ef\u4ee5\u5229\u7528\u5143\u5b57\u7b26\u6765\u8868\u793a\u3002</p> <ul> <li></li> </ul> <pre><code>[root@master reg]# cat test.txt \nshe\nsh\ns1e\n[root@master reg]# grep \"s[^[:digit:]]e\" test.txt    \nshe\n[root@master reg]# grep \"s[^a-z]e\" test.txt          \ns1e\n</code></pre> <p>\u5982\u4e0a\uff0c\u5339\u914d\u7684\u5143\u5b57\u7b26\u53d6\u53cd\uff0c\u4e5f\u5c31\u662f\u4e0d\u5305\u542b\u5339\u914d\u7684\u5185\u5bb9\u3002</p>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#222","title":"2.2.2 \u6b21\u6570\u5339\u914d","text":"<p>\u6b21\u6570\u5339\u914d\u7528\u5728\u6307\u5b9a\u7684\u5b57\u7b26\u540e\u9762\uff0c\u8868\u793a\u6307\u5b9a\u5339\u914d\u5230\u524d\u9762\u7684\u5b57\u7b26\u51fa\u73b0\u591a\u5c11\u6b21\u3002</p> <ul> <li><code>*</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u4efb\u610f\u6b21\uff080 \u6b21\u83b7\u65e0\u6570\u6b21\uff09\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s*\" test2.txt \nssssh\nsheee\nhell    \n</code></pre> <p>\u5982\u4e0a\u5339\u914d\u5b57\u7b26 s\uff0c0 \u6b21\u6216\u591a\u6b21\u3002</p> <ul> <li><code>\\?</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26 0 \u6b21\u6216 1 \u6b21\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\?h\" test2.txt \nssssh                       # \u5339\u914d\u6700\u540e\u7684sh\nsheee                       # \u5339\u914dsh\nhell                        # \u5339\u914dh\n[root@master reg]# grep -E \"s?h\" test2.txt  \nssssh\nsheee\nhell\n</code></pre> <p>\u5982\u4e0a\u5339\u914d s \u53ef\u4ee5\u5b58\u5728 0 \u6b21\uff0c\u6216\u8005\u5b58\u5728 1 \u6b21\u4e4b\u540e\u9700\u8981\u6709 h \u5b57\u7b26\uff0c\u6ce8\u610f\u5229\u7528\u9009\u9879 <code>-E</code> \u5f00\u542f\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u76f8\u8f83\u4e0e\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0d\u9700\u8981 <code>\\</code>\u3002</p> <ul> <li><code>+</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u81f3\u5c11 1 \u6b21\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\+h\" test2.txt  \nssssh                       # \u5339\u914dssssh\nsheee                       # \u5339\u914dsh\n[root@master reg]# grep -E \"s+h\" test2.txt\nssssh\nsheee\n</code></pre> <p>\u5982\u4e0a\u5339\u914d s \u81f3\u5c11\u5b58\u5728 1 \u6b21\u6216\u65e0\u6570\u6b21\u3002</p> <ul> <li><code>\\{m\\,}</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u81f3\u5c11 m \u6b21\uff08\u9ed8\u8ba4\u5de5\u4f5c\u5728\u8d2a\u5a6a\u6a21\u5f0f\u4e0b\uff0c? \u53d6\u6d88\u8d2a\u5a6a\u6a21\u5f0f\uff09\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\{1,\\}\" test2.txt \nssssh\nsheee\n[root@master reg]# grep -E \"s{1,}\" test2.txt   \nssssh\nsheee\n[root@master reg]# grep \"s\\{2,\\}\" test2.txt  \nssssh\n[root@master reg]# grep -E \"s{2,}\" test2.txt   \nssssh\n</code></pre> <p>\u5339\u914d\u5b57\u7b26 s\uff0c\u6700\u5c11 1 \u6b21\u3002</p> <ul> <li><code>\\{,n}</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u6700\u591a n \u6b21\uff08\u9ed8\u8ba4\u5de5\u4f5c\u5728\u8d2a\u5a6a\u6a21\u5f0f\u4e0b\uff0c? \u53d6\u6d88\u8d2a\u5a6a\u6a21\u5f0f\uff09\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\{,2\\}\" test2.txt     \nssssh\nsheee\nhell\n[root@master reg]# grep -E \"s{,2}\" test2.txt  \nssssh\nsheee\nhell\n</code></pre> <p>\u5339\u914d\u5b57\u7b26 s\uff0c\u6700\u591a 2 \u6b21\u3002</p> <ul> <li><code>\\{m,n\\}</code>: \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u81f3\u5c11 m \u6b21\uff0c\u81f3\u591a n \u6b21\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"s\\{1,2\\}\" test2.txt    \nssssh\nsheee\n[root@master reg]# grep -E \"s{1,2}\" test2.txt \nssssh\nsheee\n</code></pre> <p>\u5339\u914d\u5b57\u7b26 s\uff0c1-2 \u6b21\u4e4b\u95f4\u3002</p> <ul> <li><code>.*</code>: \u5339\u914d\u4efb\u610f\u5b57\u7b26\u4efb\u610f\u6b21\u6570\u3002</li> </ul>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#223","title":"2.2.3 \u4f4d\u7f6e\u94c6\u5b9a","text":"<ul> <li><code>^</code>: \u884c\u9996\u951a\u5b9a\uff0c\u7528\u4e8e\u6a21\u5f0f\u6700\u5de6\u8fb9\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"^s\" test2.txt \nssssh\nsheee\n</code></pre> <p>\u5339\u914d\u4ee5 s \u5f00\u5934\u7684\u884c\u3002</p> <ul> <li><code>$</code>: \u884c\u5c3e\u951a\u5b9a\uff0c\u7528\u4e8e\u6a21\u5f0f\u6700\u53f3\u8fb9\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \nssssh\nsheee\nhell\n[root@master reg]# grep \"h$\" test2.txt \nssssh\n</code></pre> <p>\u5339\u914d\u4ee5 h \u7ed3\u5c3e\u7684\u884c\u3002</p> <ul> <li><code>\\&lt;</code> \u6216 <code>\\b</code>: \u951a\u5b9a\u8bcd\u9996\uff0c\u7528\u4e8e\u5355\u8bcd\u6a21\u5f0f\u5de6\u4fa7\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# cat test2.txt \ngo root user\nroot:shell;gousers\nhellorootgouser\n[root@master reg]# grep \"\\&lt;ro\" test2.txt \ngo root user\nroot:shell;gousers\n[root@master reg]# grep \"\\bro\" test2.txt         \ngo root user\nroot:shell;gousers\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6b64\u523b\u5339\u914d\u662f\u4ee5\u5355\u8bcd\u6a21\u5f0f\uff0c\u6ca1\u6709\u5339\u914d helloroot\u3002</p> <ul> <li><code>\\&gt;</code> \u6216 <code>\\b</code>: \u951a\u5b9a\u8bcd\u5c3e\uff0c\u7528\u4e8e\u5355\u8bcd\u6a21\u5f0f\u53f3\u4fa7\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master reg]# grep \"gouser\\b\" test2.txt \nhellorootgouser\n[root@master reg]# grep \"gouser\\&gt;\" test2.txt  \nhellorootgouser\n</code></pre>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#224","title":"2.2.4 \u5206\u7ec4\u5f15\u7528","text":"<ul> <li><code>()</code> \u5206\u7ec4\uff1a\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\u5f53\u6210\u4e00\u4e2a\u6574\u4f53\u6765\u8fdb\u884c\u540e\u7eed\u5904\u7406\uff1b</li> <li><code>1\u2026\u6570\u5b57</code>\u5f15\u7528\uff1a\u4ece\u5de6\u4fa7\u8d77\uff0c\u5f15\u7528\u7b2c\u4e00\u4e2a\u5de6\u62ec\u53f7\u4ee5\u53ca\u4e0e\u4e4b\u5339\u914d\u53f3\u62ec\u53f7\u4e4b\u95f4\u7684\u6a21\u5f0f\u6240\u5339\u914d\u5230\u7684\u5b57\u7b26\uff0c\u540e\u5411\u5f15\u7528\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>grep -E \"(root).*\\1\" /etc/passwd\n</code></pre> <p>\u5229\u7528 () \u5c06 root \u5f15\u7528\u8d77\u6765\uff0c\u540e\u9762\u5229\u7528\u6570\u5b57 1 \u5f15\u7528\u3002</p>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#3","title":"3 \u5b9e\u4f8b","text":"<pre><code>1.\u663e\u793a/etc/init.d/functions\u6587\u4ef6\u4e2d\u4ee5\u5927\u5c0fs\u5f00\u5934\u7684\u884c\ngrep '^[Pp]' /etc/init.d/functions\n\n2.\u663e\u793a/etc/passwd\u6587\u4ef6\u4e2d\u4ee5/bin/bash\u7ed3\u5c3e\u7684\u884c\ngrep \"/bin/bash$\" /etc/passwd\n\n3.\u663e\u793a/etc/passwd\u6587\u4ef6\u4e2dID\u53f7\u6700\u5927\u7528\u6237\u7684\u7528\u6237\u540d\nsort -t: -k3 -n /etc/passwd |tail -1 |cut -d: -f1\n\n4.\u5982\u679croot\u7528\u6237\u5b58\u5728,\u663e\u793a\u5176\u9ed8\u8ba4\u7684shell\u7a0b\u5e8f\nid root &amp;&amp; grep '^\\&lt;root\\&gt;' /etc/passwd |awk -F: '{print $NF}'\n\n5.\u627e\u51fa/etc/passwd\u4e2d\u7684\u4e24\u4f4d\u6216\u4e09\u4f4d\u6570\ngrep -o \"[0-9]\\{2,3\\}\" /etc/passwd\n\n6.\u663e\u793a/etc/rc.d/rc.sysinit\u6587\u4ef6\u4e2d,\u81f3\u5c11\u4ee5\u4e00\u4e2a\u7a7a\u767d\u5b57\u7b26\u5f00\u5934\u7684\u4e14\u540e\u9762\u5b58\u975e\u7a7a\u767d\u5b57\u7b26\u7684\u884c:\ngrep '^[[:space:]]\\+[^[:space:]]' /etc/rc.d/rc.sysinit\n\n\n7.\u627e\u51fa\"netstat -tan\"\u547d\u4ee4\u7684\u7ed3\u679c\u4ee5\"LISTEN\"\u540e\u8ddf0,1\u6216\u591a\u4e2a\u7a7a\u767d\u5b57\u7b26\u7ed3\u5c3e\u7684\u884c\nnetstat -tan|grep 'LISTEN[[:space:]]*$'\n\n8.\u5982\u679croot\u7528\u6237\u767b\u5f55\u4e86\u7cfb\u7edf,\u5c31\u663e\u793aroot\u7528\u6237\u5728\u7ebf,\u5426\u5219\u8bf4\u660e\u672a\u767b\u5f55\nw |grep '^\\&lt;root\\&gt;'&gt;/dev/null &amp;&amp; echo \"root\u5728\u7ebf\"|| echo \"root\u672a\u767b\u5f55\"\n\n9.\u627e\u51fa/etc/rc.d/init.d/functions\u6587\u4ef6\u4e2d\u67d0\u5355\u8bcd\u540e\u9762\u8ddf\u4e00\u5bf9\u5c0f\u62ec\u53f7\u7684\u884c\ngrep '[[:alpha:]]*()' /etc/rc.d/init.d/functions\n\n10.\u4f7f\u7528echo\u8f93\u51fa\u4e00\u4e2a\u8def\u5f84,\u4f7f\u7528egrep\u53d6\u51fa\u57fa\u540d\necho /tmp/tmp1/vmstat.8.gz |grep -E  -o '[^/]+/?$'|cut -d/ -f1\n\n11.\u5339\u914dPPID\u5f00\u5934\uff0c\u884c\u4e2d\u53c8\u518d\u6b21\u51fa\u73b0PPID\u7684\u5185\u5bb9\u3002/etc/init.d/functions\ngrep -E \"(PPID).*\\1\" /etc/init.d/functions\n\n12.\u5229\u7528awk\u627e\u51fa/etc/ssh/sshd_config\u5185\u51fa\u8fc7\u7a7a\u884c\u4e0e\u4ee5#\u5f00\u5934\u7684\u884c\ngrep -v -E '^#|^$' /etc/ssh/sshd_config\n</code></pre>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#4","title":"4 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0e\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u914d\u5408\u5176\u5b83\u64cd\u4f5c\uff0c\u80fd\u591f\u5343\u53d8\u4e07\u5316\uff0c\u975e\u5e38\u7075\u6d3b\uff0c\u6839\u636e\u4e0d\u540c\u573a\u666f\u53ef\u4ee5\u8fdb\u884c\u6b63\u5411\u5339\u914d\u548c\u53cd\u5411\u5339\u914d\uff1b</li> <li>\u6b63\u5219\u8868\u8fbe\u5f0f\u914d\u5408\u547d\u4ee4\u901a\u5e38\u4e3a\u4e09\u5251\u5ba2 grep/awk/sed \u7b49\uff0c\u540e\u671f\u7075\u6d3b\u8fdb\u884c\u7ec4\u5408\u8fbe\u5230\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c\uff1b</li> <li>\u6211\u4eec\u5728\u6587\u672c\u6a21\u5f0f\u5339\u914d\u7684\u65f6\u5019\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u6269\u5c55\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4ece\u800c\u907f\u514d\u4f7f\u7528\u8fc7\u591a\u7684\u8f6c\u4e49\u5b57\u7b26\u3002</li> </ul>"},{"location":"linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#5","title":"5 \u5c0f\u7ed3","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u8c13 Shell \u4e2d\u7684\u7cbe\u534e\uff0c\u5176\u5b9e\u5728\u5176\u4ed6\u8bed\u8a00\u4e2d\u4e5f\u5f88\u901a\u7528\uff0c\u9700\u8981\u8fdb\u884c\u52e4\u52a0\u7ec3\u4e60\u624d\u80fd\u8fbe\u5230\u719f\u7ec3\u638c\u63e1\uff0c\u6ce8\u610f\u533a\u5206\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0e\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u8bed\u6cd5\u533a\u522b\uff0c\u914d\u5408\u5176\u4ed6\u5de5\u5177\u7075\u6d3b\u8fd0\u7528\u3002\u5728\u4e0d\u540c\u573a\u666f\u53ef\u4ee5\u5229\u7528\u547d\u4ee4\u9009\u9879\u914d\u5408\u4f7f\u7528\uff0c\u5728\u540e\u671f Shell \u811a\u672c\u4e09\u5251\u5ba2\u4e2d\u4e5f\u4f1a\u9891\u7e41\u51fa\u73b0\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u653b\u514b\u6b63\u5219\u8868\u8fbe\u5f0f\u8fd9\u4e2a\u96be\u5173\uff0cShell \u811a\u672c\u7f16\u7a0b\u5c31\u5df2\u7ecf\u4e8b\u534a\u529f\u500d\u3002</p> <ol> <li> <p>\u5339\u914d\u6307\u5b9a\u8303\u56f4\u5916\u7684\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\uff0c\u4f8b\u5982\uff1a\u00a0\u21a9</p> </li> </ol>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/","title":"12.Shell \u4e09\u5251\u5ba2\u4e4bgrep","text":""},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#1-grep","title":"1 grep\u6982\u8ff0","text":""},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#11-grep","title":"1.1 grep\u662f\u4ec0\u4e48","text":"<p>\u5728\u6211\u4eec\u65e5\u5e38Linux\u8fd0\u7ef4\u8fc7\u7a0b\u4e2d\uff0c\u6700\u591a\u7684\u5c31\u662f\u5bf9Linux\u6587\u4ef6\u8fdb\u884c\u5904\u7406\uff0cgrep\uff08global search regular expression(RE) and print out the line\uff09\u4f5c\u4e3a\u4e00\u6b3e\u975e\u5e38\u65b9\u4fbf\u4e14\u5f3a\u5927\u7684\u6587\u672c\u641c\u7d22\u5de5\u5177\uff0c\u5176\u80fd\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u641c\u7d22\u6587\u672c\uff0c\u5e76\u628a\u5339\u914d\u7684\u884c\u6253\u5370\u51fa\u6765\uff0c\u5176\u4f7f\u7528\u5bf9\u8c61\u4e3aLinux\u7cfb\u7edf\u7684\u6240\u6709\u7528\u6237\uff0c\u4f7f\u5f97\u6211\u4eec\u65e5\u5e38\u64cd\u4f5c\u66f4\u52a0\u65b9\u4fbf\u7b80\u5355\u3002</p>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#12-grep","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528grep","text":"<p>\u5728Linux\u7cfb\u7edf\u4e2d\u4e00\u5207\u7686\u6587\u4ef6\uff0c\u6211\u4eec\u65e5\u5e38\u7684\u5de5\u4f5c\u5c31\u662f\u4e0e\u6587\u4ef6\u6253\u4ea4\u9053\uff0c\u80fd\u591f\u8fd0\u7528grep\u8fd9\u6b3e\u6587\u4ef6\u641c\u7d22\u5de5\u5177\uff0c\u53ef\u4ee5\u5927\u5927\u63d0\u4f9b\u6211\u4eec\u7684\u5de5\u4f5c\u6548\u7387\uff0c\u6211\u4eec\u4e0a\u8282\u8bfe\u5b66\u4e60\u4e86\u6b63\u5219\u8868\u8fbe\u5f0f\uff0cgrep\u914d\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u80fd\u591f\u4f5c\u51fa1+1\u5927\u4e8e2\u7684\u6548\u679c\uff0c\u7075\u6d3b\u4f7f\u7528\u4f7f\u5f97\u6211\u4eec\u7684\u5de5\u4f5c\u66f4\u52a0\u9ad8\u6548\u5feb\u6377\u3002</p>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#2-grep","title":"2 grep\u8be6\u89e3","text":""},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#21-grep","title":"2.1 grep\u5206\u7c7b","text":"<p>Unix \u7684 grep \u5bb6\u65cf\u5305\u62ec grep\u3001egrep \u548c fgrep\u3002egrep \u548c fgrep \u7684\u547d\u4ee4\u53ea\u8ddf grep \u6709\u5f88\u5c0f\u4e0d\u540c\u3002</p> <ul> <li>egrep \u662f grep \u7684\u6269\u5c55\uff0c\u5176\u652f\u6301\u66f4\u591a re\u5143\u5b57\u7b26\uff0c\u548c\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u7b49\u3002</li> <li>fgrep \u5c31\u662f fixed grep \u6216 fast grep\uff0c\u5b83\u4eec\u628a\u6240\u6709\u7684\u5b57\u6bcd\u90fd\u770b\u4f5c\u5355\u8bcd\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u7684\u5143\u5b57\u7b26\u8868\u793a\u5176\u81ea\u8eab\u7684\u5b57\u9762\u610f\u4e49\uff0c\u4e0d\u518d\u7279\u6b8a\u3002</li> <li>linux \u4f7f\u7528 GNU \u7248\u672c\u7684 grep\u3002\u5b83\u529f\u80fd\u66f4\u5f3a\uff0c\u53ef\u4ee5\u901a\u8fc7-G\u3001-E\u3001-F\u547d\u4ee4\u884c\u9009\u9879\u6765\u4f7f\u7528 egrep \u548c fgrep \u7684\u529f\u80fd\u3002</li> </ul>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#22-grep","title":"2.2 grep \u5de5\u4f5c\u65b9\u5f0f","text":"<p>grep \u7684\u5de5\u4f5c\u65b9\u5f0f\u4e3a\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u6587\u4ef6\u4e2d\u641c\u7d22\u5b57\u7b26\u4e32\u6a21\u7248\u3002\u5982\u679c\u6a21\u7248\u5305\u62ec\u7a7a\u683c\uff0c\u5219\u5fc5\u987b\u88ab\u5f15\u7528\uff0c\u6a21\u677f\u540e\u7684\u6240\u6709\u5b57\u7b26\u4e32\u88ab\u770b\u4f5c\u6587\u4ef6\u540d\u3002\u641c\u7d22\u7684\u7ed3\u679c\u88ab\u9001\u5230\u5c4f\u5e55\uff0c\u4e0d\u5f71\u54cd\u539f\u6587\u4ef6\u5185\u5bb9\u3002</p> <p>grep \u547d\u4ee4\u7ed3\u675f\u540e\u901a\u8fc7\u4e00\u4e2a\u72b6\u6001\u503c\u6765\u8bf4\u660e\u641c\u7d22\u72b6\u6001\uff0c\u5982\u679c\u4e3a0\u5219\u610f\u5473\u641c\u7d22\u6210\u529f\uff0c\u53cd\u4e4b\u5219\u4e3a\u5931\u8d25\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5176\u5bf9\u6587\u4ef6\u81ea\u52a8\u5316\u5904\u7406\u3002</p>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#23-grep","title":"2.3 grep \u8bed\u6cd5","text":"<pre><code>grep [OPTION]... PATTERN [FILE]\n</code></pre> <p>\u5176\u4e2d<code>OPTION</code>\u6709\u5f88\u591a\u65b9\u5f0f\uff0c\u4f8b\u5982-A3\u8868\u793a\u663e\u793a\u7b26\u5408\u8303\u672c\u6837\u5f0f\u7684\u90a3\u4e00\u884c\u4e4b\u5916\uff0c\u5e76\u663e\u793a\u8be5\u884c\u4e4b\u540e\u76843\u884c\u5185\u5bb9\u3002</p> <p><code>PATTERN</code>\u8868\u793a\uff1a\u5339\u914d\u7684\u6a21\u5f0f\uff0c\u901a\u5e38\u4e3a\u4e00\u4e2a\u8868\u8fbe\u5f0f\u3002</p> <p><code>FilE</code>\u4e3a\u5177\u4f53\u7684\u9700\u8981\u5904\u7406\u7684\u95ee\u9898\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e3a\u6807\u51c6\u8f93\u5165\u3002</p>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#23","title":"2.3 \u53c2\u6570\u8be6\u89e3","text":"<p>\u5728\u4e0a\u4e00\u8282\u4e2d\u6211\u4eec\u8be6\u7ec6\u8bb2\u89e3\u4e86\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5b83\u5c31\u53ef\u4ee5\u7528\u5728 grep \u547d\u4ee4\u7684<code>PATTERN</code> \u5b57\u6bb5\u4e2d,\u4f7f\u5f97grep\u66f4\u52a0\u5f3a\u5927\uff0c\u672c\u7ae0\u8282\u6211\u4eec\u7740\u91cd\u6765\u8bb2\u89e3 grep \u547d\u4ee4\u7684<code>OPTION</code>\u3002</p> <p>\u4e0d\u52a0\u53c2\u6570\uff0c\u5339\u914d /etc/passwd \u6587\u4ef6\u4e2d\u7684 root \u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep \"root\" /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\noperator:x:11:0:operator:/root:/sbin/nologin\n</code></pre> <ul> <li>-A\uff1a\u663e\u793a\u6a21\u5f0f\u5339\u914d\u540e\u7684\u51e0\u884c</li> </ul> <p>\u67e5\u627e /etc/passwd \u6587\u4ef6\u4e2d\u4ee5 root \u5f00\u5934\u7684\u540e\u4e24\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -A2 \"^root\" /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n</code></pre> <ul> <li>-B\uff1a\u663e\u793a\u6a21\u5f0f\u5339\u914d\u884c\u7684\u524d\u51e0\u884c</li> </ul> <p>\u67e5\u627e /etc/passwd \u6587\u4ef6\u4e2d\u4ee5 bin \u5f00\u5934\u7684\u524d\u4e00\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -B1 \"^bin\" /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\n</code></pre> <ul> <li>-C\uff1a\u663e\u793a\u6a21\u5f0f\u5339\u914d\u7684\u524d\u540e\u5404\u51e0\u884c</li> </ul> <p>\u67e5\u627e /etc/passwd \u6587\u4ef6\u4e2d\u4ee5 ftp \u5f00\u5934\u7684\u524d\u540e\u5404 2 \u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -C2 \"^ftp\" /etc/passwd     \noperator:x:11:0:operator:/root:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\nftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\nnobody:x:99:99:Nobody:/:/sbin/nologin\nsystemd-network:x:192:192:systemd Network Management:/:/sbin/nologin\n</code></pre> <ul> <li>-i\uff1a\u5ffd\u7565\u5927\u5c0f\u5199\u5339\u914d</li> </ul> <p>\u5339\u914d /etc/passwd \u5305\u542b\"Nobody\"\u7684\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -i \"Nobody\" /etc/passwd\nnobody:x:99:99:Nobody:/:/sbin/nologin\nnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin\n</code></pre> <ul> <li>-o \uff1a\u53ea\u663e\u793a\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32</li> </ul> <p>\u5339\u914d\u51fa /etc/passwd \u6587\u4ef6\u4e2d\u5b57\u7b26\u4e32\u957f\u5ea6\u6700\u5c11 10 \u4f4d\u7684\u5b57\u7b26 \uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -o \"[[:alnum:]]\\{10,\\}\" /etc/passwd\nManagement\nKubernetes\n</code></pre> <ul> <li>-n\uff1a\u8f93\u51fa\u5339\u914d\u5230\u7684\u884c\u7684\u884c\u53f7</li> </ul> <p>\u5339\u914d\u51fa /etc/passwd \u6587\u4ef6\u4e2d\u5305\u542b root \u7684\u5b57\u7b26\u4e32\u7684\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -n \"root\" /etc/passwd\n1:root:x:0:0:root:/root:/bin/bash\n10:operator:x:11:0:operator:/root:/sbin/nologin\n</code></pre> <ul> <li>-v\uff1a\u53cd\u5411\u9009\u62e9\uff0c\u5373\u663e\u793a\u9664\u8fc7 \u5339\u914d'\u641c\u5bfb\u5b57\u7b26\u4e32' \u5185\u5bb9\u7684\u90a3\u4e00\u884c</li> </ul> <p>\u5339\u914d\u51fa /etc/passwd \u4e2d\u4e0d\u5305\u542b bash \u7684\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -v \"nologin\" /etc/passwd    \nroot:x:0:0:root:/root:/bin/bash\nsync:x:5:0:sync:/sbin:/bin/sync\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\nhalt:x:7:0:halt:/sbin:/sbin/halt\n</code></pre> <ul> <li>-c :\u8ba1\u7b97\u627e\u5230 '\u641c\u5bfb\u5b57\u7b26\u4e32' \u7684\u6b21\u6570</li> </ul> <p>\u8ba1\u7b97 /etc/passwd \u6587\u4ef6\u4e2d root \u5b57\u7b26\u4e32\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -c \"root\" /etc/passwd\n2\n</code></pre> <ul> <li>-E: \u5f00\u542f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u76f8\u5f53\u4e8e\u4f7f\u7528\u547d\u4ee4<code>egrep</code></li> </ul> <p>\u67e5\u627e /etc/passwd \u6587\u4ef6\u4e2d\u5305\u542b\u4e09\u4f4d\u6570\u5b57\u7684\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master grep]# grep -E \"[[:digit:]]{3}\" /etc/passwd\ngames:x:12:100:games:/usr/games:/sbin/nologin\nsystemd-network:x:192:192:systemd Network Management:/:/sbin/nologin\npolkitd:x:999:997:User for polkitd:/:/sbin/nologin\nceph:x:167:167:Ceph daemons:/var/lib/ceph:/sbin/nologin\nkube:x:998:996:Kubernetes user:/home/kube:/sbin/nologin\netcd:x:997:993:Etcd user:/var/lib/etcd:/bin/nologin\ngluster:x:996:992:GlusterFS daemons:/run/gluster:/sbin/nologin\nnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin\nchrony:x:995:991::/var/lib/chrony:/sbin/nologin\nredis:x:994:990:Redis Database Server:/var/lib/redis:/sbin/nologin\n</code></pre>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#3","title":"3 \u5b9e\u4f8b","text":""},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#31","title":"3.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u83b7\u53d6Linux\u7cfb\u7edf\u7684\u670d\u52a1\u4fe1\u606f\uff0c\u5c06\u7ed3\u679c\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#32","title":"3.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u51fd\u6570\u6765\u7f16\u5199\u83b7\u53d6Linux\u670d\u52a1\u76f8\u5173\u4fe1\u606f\uff0c\u6700\u540e\u5229\u7528\u91cd\u5b9a\u5411\u5c06\u4fe1\u606f\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#33","title":"3.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# Description: service check\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: sys check\n# Date: 2020-04-11 14:00\n# Version: 1.0\n\n[ $(id -u) -gt 0 ] &amp;&amp; echo \"\u8bf7\u7528root\u7528\u6237\u6267\u884c\u6b64\u811a\u672c\uff01\" &amp;&amp; exit 1\nsysversion=$(rpm -q centos-release|cut -d- -f3)\nline=\"-------------------------------------------------\"\n\n\n[ -d logs ] || mkdir logs\n\nservice_check_file=\"logs/service-`date +%Y%m%d`.txt\"\n\n# \u83b7\u53d6\u670d\u52a1\u4fe1\u606f\nfunction get_service_info() {\n    port_listen=$(netstat -lntup|grep -v \"Active Internet\")\n    kernel_config=$(sysctl -p 2&gt;/dev/null)\n    if [ ${sysversion} -gt 6 ];then\n        service_config=$(systemctl list-unit-files --type=service --state=enabled|grep \"enabled\")\n        run_service=$(systemctl list-units --type=service --state=running |grep \".service\")\n    else\n        service_config=$(/sbin/chkconfig | grep -E \":on|:\u542f\u7528\" |column -t)\n        run_service=$(/sbin/service --status-all|grep -E \"running\")\n    fi\ncat &lt;&lt;EOF\n\u670d\u52a1\u542f\u52a8\u914d\u7f6e:\n${service_config}\n${line}\n\u8fd0\u884c\u7684\u670d\u52a1:\n${run_service}\n${line}\n\u76d1\u542c\u7aef\u53e3:\n${port_listen}\n${line}\n\u5185\u6838\u53c2\u8003\u914d\u7f6e:\n${kernel_config}\nEOF\n}\n\n\nfunction sys_check() {\n    get_service_info\n    echo ${line}\n}\n\n\n\n\n# \u6267\u884c\u4e3b\u51fd\u6570\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u4e2d\nsys_check &gt; ${sys_check_file}\n\n# \u6267\u884c\u6d4b\u8bd5\n[root@xuel-terraform-cvm-0 ~]# bash sys_check.sh\n[root@xuel-terraform-cvm-0 ~]# cat logs/10.0.1.15-20200329.txt\n[root@master grep]# cat logs/service-20200411.txt \n\u670d\u52a1\u542f\u52a8\u914d\u7f6e:\nauditd.service                              enabled\nautovt@.service                             enabled\nceph-mon@.service                           enabled\nceph-osd@.service                           enabled\nchronyd.service                             enabled\ncrond.service                               enabled\ndbus-org.freedesktop.NetworkManager.service enabled\ndbus-org.freedesktop.nm-dispatcher.service  enabled\ndocker.service                              enabled\netcd.service                                enabled\ngapd.service                                enabled\ngetty@.service                              enabled\nirqbalance.service                          enabled\nkdump.service                               enabled\nkubelet.service                             enabled\nmicrocode.service                           enabled\nNetworkManager-dispatcher.service           enabled\nNetworkManager.service                      enabled\npostfix.service                             enabled\nrpcbind.service                             enabled\nrsyslog.service                             enabled\nsmarteye-server-agent.service               enabled\nsshd.service                                enabled\nsystemd-readahead-collect.service           enabled\nsystemd-readahead-drop.service              enabled\nsystemd-readahead-replay.service            enabled\ntuned.service                               enabled\n-------------------------------------------------\n\u8fd0\u884c\u7684\u670d\u52a1:\nauditd.service                loaded active running Security Auditing Service\nceph-mon@master.service       loaded active running Ceph cluster monitor daemon\nceph-osd@0.service            loaded active running Ceph object storage daemon\nchronyd.service               loaded active running NTP client/server\ncrond.service                 loaded active running Command Scheduler\ndbus.service                  loaded active running D-Bus System Message Bus\ndocker.service                loaded active running Docker Application Container Engine\netcd.service                  loaded active running etcd docker wrapper\ngapd.service                  loaded active running guest agent for pitrix\ngetty@tty1.service            loaded active running Getty on tty1\ngssproxy.service              loaded active running GSSAPI Proxy Daemon\nirqbalance.service            loaded active running irqbalance daemon\nkubelet.service               loaded active running Kubernetes Kubelet Server\nNetworkManager.service        loaded active running Network Manager\npolkit.service                loaded active running Authorization Manager\npostfix.service               loaded active running Postfix Mail Transport Agent\nrpcbind.service               loaded active running RPC bind service\nrsyslog.service               loaded active running System Logging Service\nsmarteye-server-agent.service loaded active running The Smarteye Monitoring of server\nsshd.service                  loaded active running OpenSSH server daemon\nsystemd-journald.service      loaded active running Journal Service\nsystemd-logind.service        loaded active running Login Service\nsystemd-udevd.service         loaded active running udev Kernel Device Manager\ntuned.service                 loaded active running Dynamic System Tuning Daemon\n-------------------------------------------------\n\u76d1\u542c\u7aef\u53e3:\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 127.0.0.1:9099          0.0.0.0:*               LISTEN      10444/calico-node   \ntcp        0      0 172.16.60.2:2379        0.0.0.0:*               LISTEN      1321/etcd            \ntcp6       0      0 :::9353                 :::*                    LISTEN      2058/node-cache     \nudp        0      0 0.0.0.0:37811           0.0.0.0:*                           610/dhclient        \nudp        0      0 169.254.25.10:53        0.0.0.0:*                           2058/node-cache     \nudp        0      0 0.0.0.0:68              0.0.0.0:*                           610/dhclient        \nudp        0      0 0.0.0.0:111             0.0.0.0:*                           1/systemd           \nudp        0      0 0.0.0.0:123             0.0.0.0:*                           530/chronyd         \nudp        0      0 127.0.0.1:323           0.0.0.0:*                           530/chronyd         \nudp        0      0 0.0.0.0:703             0.0.0.0:*                           535/rpcbind         \nudp6       0      0 :::35267                :::*                                610/dhclient        \nudp6       0      0 :::111                  :::*                                1/systemd           \nudp6       0      0 ::1:323                 :::*                                530/chronyd         \nudp6       0      0 :::703                  :::*                                535/rpcbind         \n-------------------------------------------------\n\u5185\u6838\u53c2\u8003\u914d\u7f6e:\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_local_reserved_ports = 30000-32767\nnet.bridge.bridge-nf-call-arptables = 1\n-------------------------------------------------\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5229\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\u6765\u83b7\u53d6\u7cfb\u7edf\u7684\u4fe1\u606f\uff0c\u4e3b\u51fd\u6570\u5c06\u8f93\u51fa\u5229\u7528\u91cd\u5b9a\u5411\u65b9\u5f0f\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#4","title":"4 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>grep\u5bf9\u4e8e\u6587\u4ef6\u641c\u7d22\u6548\u7387\u975e\u5e38\u9ad8\uff0c\u5176\u4e0d\u4f1a\u5bf9\u6e90\u6587\u4ef6\u4f5c\u51fa\u4fee\u6539\uff1b</li> <li>\u9ed8\u8ba4Linux\u7cfb\u7edfgrep\u53ef\u4ee5\u4f7f\u7528\u53c2\u6570-E\uff0c-F\u6765\u4f7f\u7528egrep/fgrep\uff1b</li> <li>\u5bf9\u4e8e\u590d\u6742\u7684\u6761\u4ef6\u53ef\u4ee5\u5229\u7528grep\u914d\u5408\u7ba1\u9053\u591a\u5339\u914d\u6765\u8fbe\u5230\u76ee\u7684\u3002</li> </ul>"},{"location":"linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/#5","title":"5 \u5c0f\u7ed3","text":"<p>grep\u547d\u4ee4\u662fLinux\u7cfb\u7edf\u975e\u5e38\u5f3a\u5927\u7684\u6587\u672c\u641c\u7d22\u5de5\u5177\uff0c\u53ef\u4ee5\u914d\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u53ca\u5176\u4e30\u5bcc\u7684\u9009\u9879\u6765\u7075\u6d3b\u5904\u7406\uff0c\u540c\u65f6\u5bf9\u4e8e\u590d\u6742\u7684\u6587\u4ef6\u641c\u7d22\uff0c\u53ef\u4ee5\u914d\u5408\u7ba1\u9053\u591a\u6b21\u5339\u914d\u6765\u8fbe\u5230\u641c\u7d22\u7684\u76ee\u7684\uff0c\u7279\u6b8a\u60c5\u51b5\u4e0b\u53ef\u4ee5\u5229\u7528\u9009\u9879-E\uff0c\u5f00\u542f\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u63d0\u4f9b\u5f3a\u5927\u7684\u6a21\u5f0f\u5339\u914d\u5904\u7406\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/","title":"13.Shell\u4e09\u5251\u5ba2\u4e4bsed","text":""},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#1-sed","title":"1 Sed\u6982\u8ff0","text":""},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#11-sed","title":"1.1 Sed\u662f\u4ec0\u4e48","text":"<p>Sed\u5168\u540d\u4e3aStream EDitor\uff0c\u987e\u540d\u601d\u4e49\u662f\u5bf9\u6570\u636e\u6d41\u8fdb\u884c\u7f16\u8f91\u64cd\u4f5c\u7684\u4e00\u4e2a\u547d\u4ee4\uff0c\u5b83\u80fd\u591f\u904d\u5386\u6587\u4ef6\u6216\u6587\u4ef6\u6d41\uff0c\u5bf9\u8bfb\u5165\u7684\u8f93\u5165\u6d41\u53ef\u4ee5\u5c06\u5176\u5148\u5b58\u50a8\u5728\u6a21\u5f0f\u7a7a\u95f4\u4e2d\uff0c\u5e76\u5c06\u884c\u53f7\u8bb0\u5f55\u5728\u5185\u5b58\u4e2d\uff0c\u5229\u7528\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u4e00\u7cfb\u5217\u6307\u5b9a\u547d\u4ee4\u5bf9\u5176\u8fdb\u884c\u64cd\u4f5c\uff0c\u5f85\u64cd\u4f5c\u5b8c\u6210\u540e\u4ece\u6a21\u5f0f\u7a7a\u95f4\u8f93\u51fa\u5230stdout\uff0c\u7c7b\u4f3c\u4e8e\u5728\u4e00\u4e2a\u7ba1\u9053\u5728\u5176\u4e2d\u5bf9\u6570\u636e\u8fdb\u884c\u52a0\u5de5\uff0c\u5b8c\u6210\u540e\u4ece\u53e6\u4e00\u5934\u8f93\u51fa\uff0c\u63a5\u7740\u8bfb\u53d6\u4e0b\u4e00\u884c\uff0c\u91cd\u590d\u5f80\u8fd4\uff0c\u76f4\u81f3\u5c06\u6240\u6709\u6807\u51c6\u8f93\u5165\u8bfb\u53d6\u5904\u7406\u5b8c\u6210\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#12-sed","title":"1.2 \u4e3a\u4ec0\u4e48\u7528Sed","text":"<p>Sed\u76f8\u8f83\u4e8egrep/awk\uff0c\u5176\u4e3b\u8981\u529f\u80fd\u4e3a\u5bf9\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\u5904\u7406\uff0c\u53ef\u4ee5\u5bf9\u6587\u4ef6\u6216\u6807\u51c6\u8f93\u5165\u6570\u636e\u6d41\u8fdb\u884c\u589e\u5220\u6539\u67e5\u7b49\u64cd\u4f5c\uff0c\u5c24\u5176\u9002\u7528\u4e8e\u5927\u6587\u4ef6\u6216\u6709\u89c4\u5f8b\u7684\u6587\u4ef6\uff0c\u5229\u7528\u6b64\u5de5\u5177\uff0c\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u5feb\u6377\u7684\u5728\u7f16\u5199Shell\u811a\u672c\u4e2d\u5f97\u5fc3\u5e94\u624b\u7684\u5bf9\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#2-sed","title":"2 Sed\u7684\u9002\u7528\u573a\u666f","text":"<ul> <li> <p>\u8d85\u5927\u6587\u4ef6\u5904\u7406\uff1b</p> </li> <li> <p>\u6709\u89c4\u5f8b\u7684\u6587\u672c\uff0c\u4f8b\u5982\u683c\u5f0f\u5316\u540e\u7684\u65e5\u5fd7\u6587\u4ef6\u7b49\uff1b</p> </li> <li>\u5bf9\u6587\u4ef6\u8fdb\u884c\u6279\u91cf\u589e\u52a0\uff0c\u66ff\u6362\u7b49\u3002</li> </ul>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#3-sed","title":"3 Sed\u7684\u5904\u7406\u6a21\u5f0f","text":"<p>Sed\u5bf9\u8f93\u5165\u7684\u4e00\u884c\u6570\u636e\u8fdb\u884c\u5904\u7406\u7684\u6a21\u5f0f\uff0c\u5bf9\u6574\u4e2a\u6587\u4ef6\u8fdb\u884c\u91cd\u590d\u6267\u884c\u6b64\u6a21\u5f0f\u5904\u7406\uff0c\u5728\u6b64\u8bf4\u660e\u5bf9\u8f93\u5165\u7684\u4e00\u884c\u6570\u636e\u5904\u7406\u7684\u5185\u5728\u673a\u5236\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ol> <li> <p>\u9996\u5148\u8bfb\u5165\u6587\u4ef6\u6d41\u7684\u4e00\u884c\u5230\u6a21\u5f0f\u7a7a\u95f4\uff1b</p> </li> <li> <p>\u5728\u6a21\u5f0f\u7a7a\u95f4\u5185\uff0c\u5bf9\u5185\u5bb9\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u5904\u7406\uff1b</p> </li> <li> <p>\u8f93\u51fa\u5904\u7406\u540e\u7684\u6570\u636e\u5185\u5bb9\uff1b</p> </li> <li> <p>\u6e05\u7a7a\u5f53\u524d\u6a21\u5f0f\u7a7a\u95f4\uff1b</p> </li> <li> <p>\u8bfb\u53d6\u7b2c\u4e8c\u884c\u8f93\u5165\u6d41\u5230\u6a21\u5f0f\u7a7a\u95f4\uff1b</p> </li> <li>\u53c8\u5f00\u59cb\u5bf9\u6a21\u5f0f\u7a7a\u95f4\u5185\u7684\u4e0b\u4e00\u884c\u8f93\u5165\u6570\u636e\u8fdb\u884c\u5904\u7406\u3002</li> </ol>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#4","title":"4 \u8bed\u6cd5\u8be6\u89e3","text":"<p>sed\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <pre><code>sed [option] 'address command' [file \u2026]\n</code></pre> <p>sed\u7684\u8bed\u6cd5\u683c\u5f0f\u4e3b\u8981\u5206\u4e3a\u56db\u4e2a\u5b57\u6bb5\uff0coptions\u9009\u9879\uff0c\u5f15\u53f7\u5185\u6709\u5730\u5740\u5b9a\u754c/\u547d\u4ee4\uff0c\u4ee5\u53ca\u8981\u5904\u7406\u7684\u6587\u4ef6\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u8be6\u7ec6\u8bb2\u89e3\u6bcf\u4e00\u4e2a\u8bed\u6cd5\u5b57\u6bb5\uff0c\u66f4\u5168\u9762\u7684\u8ba4\u8bc6sed\u8fd9\u4e2a\u811a\u672c\u5229\u5668\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#41-options","title":"4.1 options\uff1a","text":"<p>\u9009\u9879\u4e3a\u53ef\u9009\uff0c\u5229\u7528\u5b83\u6765\u4e3ased\u6307\u5b9a\u4e00\u4e9b\u5904\u7406\u65b9\u5f0f\uff0c\u4e3b\u8981\u7684\u6709\u5982\u4e0b\uff1a</p> <ul> <li>-n:\u9759\u9ed8\u6a21\u5f0f\uff0c\u6211\u4eec\u77e5\u9053sed\u9ed8\u8ba4\u5904\u7406\u5b8c\u6a21\u5f0f\u7a7a\u95f4\u540e\u5c06\u5185\u5bb9\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u5229\u7528\u8fd9\u4e2a\u8fd9\u4e2a\u53c2\u6570\u4ec5\u663e\u793ascript\u5904\u7406\u540e\u7684\u7ed3\u679c\uff0c\u4e0d\u518d\u9ed8\u8ba4\u663e\u793a\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a\u6253\u5370/etc/passwd\u7684\u5730\u4e09\u884c</li> </ul> <pre><code>[root@shell workspace]# sed -n '3p' /etc/passwd\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n</code></pre> <p>\u5728\u6b64\u76f4\u63a5\u6307\u5b9a\u5730\u5740\u5b9a\u754c3\uff0c\u7136\u540ecommand\u4e3ap\u6253\u5370\u8f93\u51fa\uff0c\u7531\u4e8e\u4e0d\u60f3\u8f93\u51fa/etc/passwd\u7684\u5168\u90e8\u5185\u5bb9\uff0c\u56e0\u6b64\u6dfb\u52a0\u4e86-n\u9009\u9879\u3002</p> <pre><code>* -e:&lt;script&gt;\u6216--expression=&lt;script&gt; \u4ee5\u9009\u9879\u4e2d\u6307\u5b9a\u7684script\u6765\u5904\u7406\u8f93\u5165\u7684\u6587\u672c\u6587\u4ef6\uff0c\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u591a\u4e2a\u811a\u672c\uff1b\n* -f:\u5bf9\u5236\u5b9a\u7684\u6587\u4ef6\u76f4\u63a5\u8fdb\u884csed\u7684command\u64cd\u4f5c\uff1b\n* -i:\u76f4\u63a5\u4fee\u6539\u539f\u6587\u4ef6\uff0c\u6211\u4eec\u90fd\u77e5\u9053sed\u9ed8\u8ba4\u4e0d\u5bf9\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\uff0c\u53ea\u662f\u8bfb\u5165\u4e00\u884c\u5230\u6a21\u5f0f\u7a7a\u95f4\u4e2d\uff0c\u5904\u7406\u5b8c\u6210\u540e\u8f93\u51fa\uff0c\u6b64\u53c2\u6570\u4e3a\u4e5f\u76f4\u63a5\u4fee\u6539\u4e86\u6e90\u6587\u4ef6\uff1b\n* -r:\u652f\u6301\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u9ed8\u8ba4\u7684\u57fa\u7840\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u7c7b\u6bd4grep\u547d\u4ee4\u7684egrep\uff0c\u66f4\u52a0\u5feb\u6377\u7b80\u6d01\u7684\u4f7f\u7528\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u56e0\u4e3a\u6709\u4e9b\u5143\u5b57\u7b26\u4e0d\u7528\u518d\u4f7f\u7528\u53cd\u659c\u7ebf\"\\\\\"\u4e86\u3002\n</code></pre>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#42-address","title":"4.2 address:","text":"<p>\u5730\u5740\u5b9a\u754c\u7528\u6765\u6307\u5b9a\u8bfb\u5165\u6587\u4ef6\u7684\u8fb9\u754c\u6216\u6b65\u957f\u3002</p> <ul> <li><code>startline\uff0cendline</code>\uff1a\u6307\u5b9a\u8bfb\u5165\u6587\u4ef6\u7684\u5f00\u59cb\u884c\u4e8e\u7ed3\u675f\u884c\u53f7\u3002</li> <li><code>/regexp/</code>:\u5229\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u5230\u7684\u884c\u8fdb\u884c\u5904\u7406\uff0c\u4f8b\u5982\uff1a\u6253\u5370/etc/passwd\u4ece\u4ee5root\u5f00\u59cb\u5230sync\u7ed3\u675f\u7684\u5185\u5bb9</li> </ul> <pre><code>[root@shell workspace]# sed -n '/^root/,/^sync/p' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nsync:x:5:0:sync:/sbin:/bin/sync\n</code></pre> <p>\u5728\u6b64\u5229\u7528\u4e86\u5339\u914d\u5143\u5b57\u7b26<code>^</code>\u7528\u6765\u5339\u914d\u884c\u9996\uff0c\u6b64\u5185\u5bb9\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u5df2\u7ecf\u8fdb\u884c\u4e86\u8be6\u7ec6\u89e3\u91ca\u3002</p> <ul> <li><code>/pattern1/,/pattern2/</code>:\u7b2c\u4e00\u6b21\u88abpattern1\u5339\u914d\u5230\u7684\u884c\u5f00\u59cb\uff0c\u76f4\u5230\u88abpattern2\u5339\u914d\u5230\u7684\u884c\u7ed3\u675f\uff0c\u4f8b\u5982\uff1a\u6253\u5370/etc/passwd\u7684\u7b2c\u56db\u884c\u5230\u7b2c\u4e03\u884c\u7684\u5185\u5bb9</li> </ul> <pre><code>[root@shell workspace]# sed -n '3,7p' /etc/passwd\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nsync:x:5:0:sync:/sbin:/bin/sync\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\n</code></pre> <ul> <li><code>linenuber</code>:\u76f4\u63a5\u6307\u5b9a\u884c\u53f7\uff0c\u9700\u8981\u5904\u7406\u54ea\u4e00\u884c\u3002</li> <li><code>startline\uff0c+n</code>:\u4ece\u90a3\u4e00\u884c\u5f00\u59cb\uff0c\u5f80\u540en\u884c\u7ed3\u675f\uff0c\u4f8b\u5982\uff1a\u6253\u5370/etc/passwd\u7684\u4ece\u7b2c\u4e09\u884c\u5f00\u59cb\u5f80\u540e\u76842\u884c\u7684\u5185\u5bb9</li> </ul> <pre><code>[root@shell workspace]# sed -n \"3,+2p\" /etc/passwd\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n</code></pre> <ul> <li><code>startline~step</code>:\u6307\u5b9a\u6b65\u957f\uff0c\u6bcf\u9694step\u6b65\u8fdb\u884c\u5904\u7406\uff0c\u5e38\u7528\u5728\u5947\u5076\u6570\u5904\u7406\uff0c\u4f8b\u5982\uff1a\u6253\u5370\u5947\u6570\u884c</li> </ul> <pre><code>seq 10 |sed -n '1~2p'\n</code></pre> <p>seq\u6765\u8f93\u51fa\u4ee5\u6570\u5b57\u4e3a\u5185\u5bb9\u768410\u884c\uff0c\u7136\u540e\u5229\u7528<code>~2</code>\u4f5c\u4e3a\u6b65\u957f\u6253\u5370\u8f93\u51fa\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#43-command","title":"4.3 command\uff1a","text":"<p>\u5177\u4f53\u5bf9\u6307\u5b9a\u7684\u6587\u4ef6\u8fdb\u884c\u600e\u6837\u7684\u5904\u7406\uff0c\u4f8b\u5982\u5bf9\u6a21\u5f0f\u7a7a\u95f4\u5185\u7684\u5185\u5bb9\u8fdb\u884c\u589e\u5220\u6539\u67e5\u5177\u4f53\u7684\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#431","title":"4.3.1 \u589e","text":"<ul> <li>i\uff1ainsert\uff0c\u5728\u5236\u5b9a\u6216\u5339\u914d\u5230\u7684\u884c\u524d\u9762\u6dfb\u52a0\u65b0\u884c\u5185\u5bb9\u4e3astring\uff0c<code>i\\string</code>\uff0c \u4e3a/etc/passwd \u4e2d\u7684\u7b2c\u4e00\u884c\u524d\u9762\u6dfb\u52a0\u4e00\u884c\u5185\u5bb9\u4e3a\"####\"\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@shell workspace]# sed '1i####' /etc/passwd\n####\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n.....\n</code></pre> <ul> <li>a\uff1aappend\uff0c\u5728\u6307\u5b9a\u6216\u5339\u914d\u5230\u7684\u884c\u540e\u9762\u8ffd\u52a0\u65b0\u884c\uff0c\u5185\u5bb9\u4e3astring\uff0c<code>a\\string</code>\u3002 \u4e3a/etc/passwd\u7684\u7b2c\u4e00\u884c\u540e\u9762\u6dfb\u52a0\u5185\u5bb9\"aaa\"\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@shell workspace]# sed '1a###' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\n###\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\n</code></pre>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#432","title":"4.3.2 \u5220","text":"<ul> <li>d\uff1adelete\uff0c\u5220\u9664\u7b26\u5408\u5730\u5740\u5b9a\u754c\u6761\u4ef6\u7684\u7684\u884c</li> </ul> <p>\u5220\u9664/etc/inittab\u6587\u4ef6\u4e2d\u6ce8\u91ca\u884c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>sed '/^#/d' /etc/inittab\n</code></pre> <p>\u76f4\u63a5\u5229\u7528\u5143\u5b57\u7b26\u5339\u914d\u94c6\u5b9a\u4ee5<code>#</code>\u5f00\u5934\u7684\u884c\u8fdb\u884c\u5220\u9664\u64cd\u4f5c\uff0c\u6ce8\u610f\u6b64\u5904\u6ca1\u6709\u76f4\u63a5\u4fee\u6539\u6587\u4ef6\uff0c\u5982\u679c\u6dfb\u52a0<code>-i</code>\u9009\u9879\uff0c\u5219\u76f4\u63a5\u5bf9\u6e90\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\uff0c\u4e00\u822c\u9700\u8981\u5148\u5907\u4efd\uff0c\u7136\u540e\u64cd\u4f5c\u4ee5\u514d\u8bef\u64cd\u4f5c\u539f\u59cb\u6587\u4ef6\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#433","title":"4.3.3 \u6539","text":"<ul> <li>s\uff1a<code>s/pattern/string/\u4fee\u9970\u7b26</code>: \u67e5\u627e\u5e76\u66ff\u6362\uff0c\u9ed8\u8ba4\u53ea\u66ff\u6362\u6bcf\u884c\u4e2d\u7b2c\u4e00\u6b21\u88ab\u6a21\u5f0f\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32 \uff0c\u5982\u679c\u4fee\u9970\u7b26\u4e3ag,\u5219\u4e3a\u5168\u90e8\u66ff\u6362\u3002 \u66ff\u6362/etc/passwd\u4e2d\u7684root\u4e3a\u5927\u5199\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@shell workspace]# sed 's/root/ROOT/g' /etc/passwd\nROOT:x:0:0:ROOT:/ROOT:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n...\n</code></pre> <p>\u66ff\u6362/etc/inittab\u6587\u4ef6\u4e2d\"id:3:initdefault:\"\u4e00\u884c\u4e2d\u7684\u6570\u5b57\u4e3a5\uff0c\u4f8b\u5982\uff1a</p> <pre><code>sed 's/id:[0-9]/id:5/g' /etc/inittab\n</code></pre> <p>\u5728\u6b64\u5229\u7528\u5143\u5b57\u7b26\u5339\u914d[0-9]\u7684\u4e00\u4e2a\u6570\u5b57\u8fdb\u884c\u66ff\u6362\u4e3a<code>id:5</code>\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#434","title":"4.3.4 \u67e5","text":"<ul> <li>p\uff1aprint\uff0c\u9ed8\u8ba4sed\u5bf9\u6a21\u5f0f\u7a7a\u95f4\u5185\u7684\u5904\u7406\u5b8c\u6bd5\u540e\uff0c\u5c06\u8f93\u51fa\u7684\u7ed3\u679c\u8f93\u51fa\u5728\u6807\u51c6\u8f93\u51fa\uff0c\u6dfb\u52a0p\u547d\u4ee4\uff0c\u76f8\u5f53\u4e8e\u8f93\u51fa\u4e86\u539f\u6587\uff0c\u53c8\u4e00\u6b21\u8f93\u51fa\u4e86\u6a21\u5f0f\u5339\u914d\u5904\u7406\u540e\u7684\u5185\u5bb9\u3002</li> </ul> <p>\u6253\u5370/etc/passwd\u7684\u7b2c\u4e09\u884c\uff0c\u6307\u5b9a\u884c\u53f7\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@shell workspace]# sed -n '3p' /etc/passwd\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\n</code></pre> <p>\u5728\u6b64\u76f4\u63a5\u6307\u5b9a\u5730\u5740\u5b9a\u754c3\uff0c\u7136\u540ecommand\u4e3ap\u6253\u5370\u8f93\u51fa\uff0c\u7531\u4e8e\u4e0d\u60f3\u8f93\u51fa/etc/passwd\u7684\u5168\u90e8\u5185\u5bb9\uff0c\u56e0\u6b64\u6dfb\u52a0\u4e86-n\u9009\u9879\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#5","title":"5 \u5b9e\u4f8b","text":""},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#51","title":"5.1 \u9700\u6c42","text":"<p>\u76ee\u524d\u817e\u8baf\u4e91\u670d\u52a1\u5668Ubuntu\u7248\u672c\u7528\u6237\u4e3aubuntu\u7528\u6237\uff0c\u73b0\u53c81000\u53f0\u670d\u52a1\u5668\u9700\u8981\u53bb\u5f00\u542froot\u8fdc\u7a0b\u767b\u5f55\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#52","title":"5.2 \u601d\u8def","text":"<p>\u5f00\u542fubuntu\u670d\u52a1\u5668\u7684\u8fdc\u7a0b\u767b\u5f55\u5373\u4fee\u6539\u5176\u7684/etc/ssh/sshd_config \u6587\u4ef6\u7684prohibit-password\u4e3ayes\u5373\u53ef\uff0c\u91cd\u542fsshd\u670d\u52a1\u5373\u53ef\uff0c\u5229\u7528\u811a\u672c\u903b\u8f91\u5904\u7406\u3002</p>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#53","title":"5.3 \u5b9e\u73b0","text":"<p>\u6838\u5fc3\u5229\u7528sed\u4ee3\u7801\uff1a</p> <pre><code>if [ ${ostype} == 'Ubuntu' ];then\n    sed -i 's/prohibit-password/yes/g' /etc/ssh/sshd_config\n    # \u91cd\u542fssh\u670d\u52a1\n    service sshd restart\n    [ $? -eq 0] &amp;&amp; echo \"${OSTYPE} sshd \u5f00\u542f\u6210\u529f\" &gt;&gt;${LOG_FILE}\nfi\n</code></pre>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#6","title":"6 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>sed\u4e2d\u5229\u7528\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u914d\u5408\u53ef\u4ee5\u5f97\u52301+1\u5927\u4e8e\u4e8c\u7684\u6548\u679c\uff0c\u914d\u5408\u4f7f\u7528\u529f\u80fd\u66f4\u52a0\u4e30\u5bcc\u5f3a\u5927\uff1b</li> <li>sed\u5e38\u7528\u4e8e\u4fee\u6539\u6587\u4ef6\uff0c\u5982\u679c\u4e3a\u67e5\u8be2\u6587\u4ef6\u53ef\u4ee5\u5229\u7528grep\uff0c\u56e0\u4e3agrep\u68c0\u7d22\u6587\u4ef6\u6548\u7387\u6700\u9ad8\uff0c\u5982\u679c\u4e3a\u683c\u5f0f\u5316\u8f93\u51fa\u5efa\u8bae\u4f7f\u7528awk\uff1b</li> <li>sed\u5728\u4fee\u6539\u6587\u4ef6\u7684\u65f6\u5019\u5c3d\u53ef\u80fd\u5148\u4e0d\u8981\u6dfb\u52a0<code>-i</code> options\uff0c\u4ee5\u514d\u5c06\u6e90\u59cb\u6587\u4ef6\u4fee\u6539\u5f02\u5e38\u96be\u4ee5\u6062\u590d\u3002</li> </ul>"},{"location":"linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/#7","title":"7 \u5c0f\u7ed3","text":"<p>sed\u7684\u529f\u80fd\u975e\u5e38\u5f3a\u5927\uff0c\u5b83\u662f\u6211\u4eecshell\u7f16\u7a0b\u4e2d\u5bf9\u6587\u4ef6\u4fee\u6539\u4e0d\u53ef\u6216\u7f3a\u7684\u5229\u5668\uff0c\u914d\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u5e38\u7528\u6765\u6279\u91cf\u4fee\u6539\u5927\u6587\u4ef6\uff0c\u6216\u6709\u4e00\u5b9a\u683c\u5f0f\u89c4\u5f8b\u7684\u6587\u4ef6\uff0c\u5176\u8fd8\u6709\u5f88\u591a\u9ad8\u7ea7\u529f\u80fd\u3002\u5982\u679c\u5b66\u6709\u4f59\u529b\u5efa\u8bae\u53bbman\u624b\u518c\u8be6\u7ec6\u5b66\u4e60\u67e5\u770b\uff0c\u5728\u5229\u7528sed\u5de5\u5177\u7684\u65f6\u5019\u9700\u8981\u65f6\u523b\u8111\u6d77\u4e2d\u7262\u8bb0\u6c42\u8bed\u6cd5\u683c\u5f0f\uff0c\u4e07\u53d8\u4e0d\u79bb\u5176\u5b97\uff0c\u9075\u5faa\u8bed\u6cd5\u4e3e\u4e00\u53cd\u4e09\u80fd\u591f\u8fbe\u5230\u5b66\u751f\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c\u3002</p>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/","title":"14.Shell\u4e09\u5251\u5ba2\u4e4bawk","text":""},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#1-awk","title":"1 awk\u6982\u8ff0","text":""},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#11-awk","title":"1.1 awk\u662f\u4ec0\u4e48","text":"<p>awk\u4e0d\u540c\u4e8egrep\u7684\u6587\u672c\u641c\u7d22\u4e0esed\u5de5\u5177\u7684\u6587\u672c\u5904\u7406\uff0c\u5b83\u66f4\u504f\u5411\u4e8e\u5bf9\u6587\u672c\u7684\u683c\u5f0f\u5316\u5904\u7406\u8f93\u51fa\uff0c\u5b83\u4e0d\u4ec5\u4ec5\u662f\u4e00\u5757\u5de5\u5177\uff0c\u4e5f\u662f\u4e00\u95e8\u89e3\u91ca\u5f62\u8bed\u8a00\uff0c\u5176\u540d\u5b57\u6765\u6e90\u4e8e\u5b83\u7684\u4e09\u4f4d\u4f5c\u8005\u7684\u59d3\u6c0f\uff1aAlfred Aho\uff0c Peter Weinberger \u548c Brian Kernighan\uff0c\u5728\u6587\u672c\u5904\u7406\u9886\u529f\u80fd\u975e\u5e38\u5f3a\u5927\uff0c\u662f\u4e00\u6b3eLinux\u670d\u52a1\u5668\u6587\u672c\u62a5\u544a\u751f\u6210\u5668\u548c\u683c\u5f0f\u5316\u6587\u672c\u8f93\u51fa\u5de5\u5177\u3002</p>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#12-awk","title":"1.2 \u4e3a\u4ec0\u4e48\u7528awk","text":"<p>\u6211\u4eec\u65e5\u5e38\u5de5\u4f5c\u4e2d\u6709\u5f88\u591a\u9700\u8981\u683c\u5f0f\u5316\u6253\u5370\u8f93\u51fa\u7684\u9700\u6c42\uff0c\u66f4\u591a\u7684\u662f\u5173\u6ce8\u5217\u64cd\u4f5c\u65f6\u5c31\u53ef\u4ee5\u5229\u7528awk\u5de5\u5177\u6765\u8fdb\u884c\u5904\u7406\u3002awk\u9664\u4e86\u662f\u5de5\u5177\u4e5f\u540c\u6837\u662f\u4e00\u95e8\u8bed\u8a00\uff0c\u5176\u5141\u8bb8\u7528\u6237\u521b\u5efa\u7b80\u77ed\u7684\u7a0b\u5e8f\u6765\u5904\u7406\u81ea\u5df1\u7684\u9700\u6c42\uff0c\u8fd9\u4e9b\u7a0b\u5e8f\u8bfb\u53d6\u8f93\u5165\u6587\u4ef6\u3001\u4e3a\u6570\u636e\u6392\u5e8f\u3001\u5904\u7406\u6570\u636e\u3001\u5bf9\u8f93\u5165\u6267\u884c\u8ba1\u7b97\u4ee5\u53ca\u751f\u6210\u62a5\u8868\u7b49\u3002\u529f\u80fd\u975e\u5e38\u7684\u5f3a\u5927\uff0c\u76f8\u4fe1\u5728\u638c\u63e1\u4e86awk\uff0c\u65e5\u5e38\u8fd0\u7ef4\u5de5\u4f5c\u66f4\u52a0\u65b9\u4fbf\u9ad8\u6548\u7b80\u5355\u3002</p>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#2-awk","title":"2 awk\u7684\u9002\u7528\u573a\u666f","text":"<ul> <li>\u8d85\u5927\u6587\u4ef6\u5904\u7406\uff1b</li> <li>\u8f93\u51fa\u683c\u5f0f\u5316\u7684\u6587\u672c\u62a5\u8868\uff1b</li> <li>\u6267\u884c\u7b97\u6570\u8fd0\u7b97\uff1b</li> <li>\u6267\u884c\u5b57\u7b26\u4e32\u64cd\u4f5c\u7b49\u3002</li> </ul>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#3-awk","title":"3 awk\u7684\u5904\u7406\u6a21\u5f0f","text":"<p>\u4e00\u822c\u662f\u904d\u5386\u4e00\u4e2a\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u884c\uff0c\u7136\u540e\u5206\u522b\u5bf9\u6587\u4ef6\u7684\u6bcf\u4e00\u884c\u8fdb\u884c\u5904\u7406\u3002</p> <p>awk\u5bf9\u8f93\u5165\u7684\u4e00\u884c\u6570\u636e\u8fdb\u884c\u5904\u7406\u7684\u6a21\u5f0f\uff0c\u5bf9\u6574\u4e2a\u6587\u4ef6\u8fdb\u884c\u91cd\u590d\u6267\u884c\u6b64\u6a21\u5f0f\u5904\u7406\uff0c\u5728\u6b64\u8bf4\u660e\u5bf9\u8f93\u5165\u7684\u4e00\u884c\u6570\u636e\u5904\u7406\u7684\u5185\u5728\u673a\u5236\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5904\u7406\u8fc7\u7a0b\u4e0d\u65ad\u91cd\u590d\uff0c\u76f4\u5230\u5230\u8fbe\u6587\u4ef6\u7ed3\u5c3e\u3002</p> <ol> <li>\u9996\u5148\u8bfb\u5165\u6587\u4ef6\u6d41\u7684\u4e00\u884c\u5230\u6a21\u5f0f\u7a7a\u95f4\uff1b</li> <li>\u5728\u6a21\u5f0f\u7a7a\u95f4\u5185\uff0c\u5bf9\u5185\u5bb9\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u5904\u7406\uff1b</li> <li>\u7136\u540e\u8f93\u51fa\u5904\u7406\u540e\u7684\u6570\u636e\u5185\u5bb9\uff1b</li> <li>\u6e05\u7a7a\u5f53\u524d\u6a21\u5f0f\u7a7a\u95f4\uff1b</li> <li>\u8bfb\u53d6\u7b2c\u4e8c\u884c\u8f93\u5165\u6d41\u5230\u6a21\u5f0f\u7a7a\u95f4\uff1b</li> <li>\u53c8\u5f00\u59cb\u5bf9\u6a21\u5f0f\u7a7a\u95f4\u5185\u7684\u7b2c\u4e8c\u884c\u8f93\u5165\u6570\u636e\u8fdb\u884c\u5904\u7406\u3002</li> </ol> <p>\u603b\u4f53\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u4e09\u90e8\uff1a</p> <ul> <li> <p>\u8bfb( Read )\uff1aAWK \u4ece\u8f93\u5165\u6d41\uff08\u6587\u4ef6\u3001\u7ba1\u9053\u6216\u8005\u6807\u51c6\u8f93\u5165\uff09\u4e2d\u8bfb\u5165\u4e00\u884c\u7136\u540e\u5c06\u5176\u5b58\u5165\u5185\u5b58\u4e2d\u3002</p> </li> <li> <p>\u6267\u884c(Execute)\uff1a\u5bf9\u4e8e\u6bcf\u4e00\u884c\u8f93\u5165\uff0c\u6240\u6709\u7684 AWK \u547d\u4ee4\u6309\u987a\u6267\u884c\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAWK \u547d\u4ee4\u662f\u9488\u5bf9\u4e8e\u6bcf\u4e00\u884c\u8f93\u5165\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u9650\u5236\u5728\u6307\u5b9a\u7684\u6a21\u5f0f\u4e2d\u3002</p> </li> <li>\u91cd\u590d\uff08Repeate\uff09\uff1a\u4e00\u76f4\u91cd\u590d\u4e0a\u8ff0\u4e24\u4e2a\u8fc7\u7a0b\u76f4\u5230\u6587\u4ef6\u7ed3\u675f\u3002</li> </ul>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#4","title":"4 \u8bed\u6cd5\u53ca\u7ed3\u6784","text":""},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#41","title":"4.1 \u8bed\u6cd5","text":"<p>Awk\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <pre><code>awk [options] 'PATTERN {action}' file1,file2\n</code></pre> <p>awk\u7684\u8bed\u6cd5\u683c\u5f0f\u4e3b\u8981\u5206\u4e3a\u56db\u4e2a\u5b57\u6bb5\uff0coptions\u9009\u9879\uff0c\u5f15\u53f7\u5185\u6709\u6a21\u5757\u4e0e\u52a8\u4f5c\uff0c\u4ee5\u53ca\u8981\u5904\u7406\u7684\u6587\u4ef6\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u8be6\u7ec6\u8bb2\u89e3\u6bcf\u4e00\u4e2a\u8bed\u6cd5\u5b57\u6bb5\uff0c\u66f4\u5168\u9762\u7684\u8ba4\u8bc6awk\u8fd9\u4e2a\u811a\u672c\u5229\u5668\u3002</p>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#42","title":"4.2 \u7a0b\u5e8f\u7ed3\u6784","text":"<p>awk\u5728\u5f15\u53f7\u5185\u6709\u4e00\u5b9a\u7684\u7a0b\u5e8f\u7ed3\u6784\uff0c\u4e3b\u8981\u4e3a\u4ee5\u4e0b\uff1a</p> <ul> <li>\u5f00\u59cb\u5757\uff08BEGIN BLOCK\uff09\uff1a</li> </ul> <pre><code>\u8bed\u6cd5\uff1a\nBEGIN{awk-commands}\n\u5f00\u59cb\u5757\u5c31\u662fawk\u7a0b\u5e8f\u542f\u52a8\u65f6\u6267\u884c\u7684\u4ee3\u7801\u90e8\u5206\uff08\u5728\u5904\u7406\u8f93\u5165\u6d41\u4e4b\u524d\u6267\u884c\uff09\uff0c\u5e76\u4e14\u5728\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u53ea\u6267\u884c\u4e00\u6b21\uff1b\n\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5728\u5f00\u59cb\u5757\u4e2d\u521d\u59cb\u5316\u4e00\u4e9b\u53d8\u91cf\u3002BEGIN\u662fawk\u7684\u5173\u952e\u5b57\uff0c\u56e0\u6b64\u5fc5\u987b\u8981\u5927\u5199\u3002\u3010\u6ce8\uff1a\u5f00\u59cb\u5757\u90e8\u5206\u662f\u53ef\u9009\uff0c\u5373\u4f60\u7684awk\u7a0b\u5e8f\u53ef\u4ee5\u6ca1\u6709\u5f00\u59cb\u5757\u90e8\u5206\u3011\n</code></pre> <ul> <li>\u4e3b\u4f53\u5757\uff08Body Block\uff09\uff1a</li> </ul> <pre><code>\u8bed\u6cd5\uff1a\n/pattern/{awk-commands}\n\u9488\u5bf9\u6bcf\u4e00\u4e2a\u8f93\u5165\u7684\u884c\u90fd\u4f1a\u6267\u884c\u4e00\u6b21\u4e3b\u4f53\u90e8\u5206\u7684\u547d\u4ee4\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bf9\u4e8e\u8f93\u5165\u7684\u6bcf\u4e00\u884c\uff0cawk\u90fd\u4f1a\u6267\u884c\u4e3b\u4f53\u90e8\u5206\u7684\u547d\u4ee4\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528/pattern/\u9650\u5236\u5176\u5728\u6307\u5b9a\u6a21\u5f0f\u4e0b\u3002\n</code></pre> <ul> <li>\u7ed3\u675f\u5757\uff08END BLOCK\uff09\uff1a</li> </ul> <pre><code>\u8bed\u6cd5\uff1a\nEND{awk-commands}\n\u7ed3\u675f\u5757\u662fawk\u7a0b\u5e8f\u7ed3\u675f\u65f6\u6267\u884c\u7684\u4ee3\u7801\uff08\u5728\u5904\u7406\u5b8c\u8f93\u5165\u6d41\u4e4b\u540e\u6267\u884c\uff09\uff0cEND\u4e5f\u662fawk\u7684\u5173\u952e\u5b57\uff0c\u5fc5\u987b\u5927\u5199\uff0c\u4e0e\u5f00\u59cb\u5757\u7c7b\u4f3c\uff0c\u7ed3\u675f\u5757\u4e5f\u662f\u53ef\u9009\u7684\u3002\n</code></pre>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#43-awk","title":"4.3 awk\u547d\u4ee4\u8be6\u89e3","text":""},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#431-awk","title":"4.3.1 awk \u8f93\u51fa","text":"<ul> <li>awk print\u8f93\u51fa\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>print item1,item2...\n</code></pre> <p>1.\u5404\u5b57\u6bb5\u4e4b\u95f4\u9017\u53f7\u9694\u5f00\uff0c\u8f93\u51fa\u65f6\u4ee5\u7a7a\u767d\u5b57\u7b26\u5206\u5272\uff1b</p> <p>2.\u8f93\u51fa\u7684\u5b57\u6bb5\u53ef\u4ee5\u4e3a\u5b57\u7b26\u4e32\u6216\u6570\u503c\uff0c\u5f53\u524d\u8bb0\u5f55\u7684\u5b57\u6bb5\uff08\u5982$1\uff09\u3001\u53d8\u91cf\u6216awk\u7684\u8868\u8fbe\u5f0f\uff1b\u6570\u503c\u5148\u4f1a\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u7136\u540e\u8f93\u51fa;</p> <p>3.print\u547d\u4ee4\u540e\u9762\u7684item\u53ef\u4ee5\u7701\u7565\uff0c\u6b64\u65f6\u5176\u529f\u80fd\u76f8\u5f53\u4e8e<code>print $0</code>,\u5982\u679c\u60f3\u8f93\u51fa\u7a7a\u767d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>print \"\"</code>;</p> <p>\u4f8b\u5982\uff1a</p> <p><pre><code>[root@master ~]# awk -F: '{print $1,$NF}' /etc/passwd|column -t\nroot             /bin/bash\nbin              /sbin/nologin\ndaemon           /sbin/nologin\nadm              /sbin/nologin\nlp               /sbin/nologin\nsync             /bin/sync\n</code></pre> * awk printf\u8f93\u51fa</p> <p>printf\u547d\u4ee4\u7684\u4f7f\u7528\u683c\u5f0f\uff1a</p> <pre><code>printf &lt;format&gt; item1,item2...\n</code></pre> <p>\u8981\u70b9\uff1a</p> <p>1.\u5176\u4e0eprint\u547d\u4ee4\u6700\u5927\u533a\u522b,printf \u9700\u8981\u6307\u5b9aformat,format\u5fc5\u987b\u7ed9\u51fa\uff1b</p> <p>2.format\u7528\u4e8e\u6307\u5b9a\u540e\u9762\u7684\u6bcf\u4e2aitem\u8f93\u51fa\u683c\u5f0f\uff1b</p> <p>3.printf \u8bed\u53e5\u4e0d\u4f1a\u81ea\u52a8\u6253\u5370\u6362\u884c\u5b57\u7b26<code>\\n</code>\u3002</p> <p>format\u683c\u5f0f\u7684\u6307\u793a\u7b26\u90fd\u4ee5%\u5f00\u5934\uff0c\u540e\u8ddf\u4e00\u4e2a\u5b57\u7b26:</p> <pre><code>%c:\u663e\u793aascall\u7801\n%d:%i:\u5341\u8fdb\u5236\u6574\u6570\n%e\uff0c%E\uff1a\u79d1\u5b66\u8ba1\u6570\u6cd5\n%f:\u6d6e\u70b9\u6570\n%s\uff1a\u5b57\u7b26\u4e32\n%u\uff1a\u65e0\u7b26\u53f7\u6574\u6570\n%%\uff1a\u663e\u793a%\u81ea\u8eab\n\n\u4fee\u9970\u7b26\uff1a\n#[.#]:\u7b2c\u4e00\u4e2a#\u63a7\u5236\u663e\u793a\u7684\u5bbd\u5ea6\uff1a\u7b2c\u4e8c\u4e2a#\u8868\u793a\u5c0f\u6570\u70b9\u540e\u7684\u7cbe\u5ea6\uff1a\n\n%3.1f\n\n-:\u5de6\u5bf9\u9f50\n+\uff1a\u663e\u793a\u6570\u7ec4\u7b26\u53f7\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# awk -F: '{printf \"Username:%-15s   ,Uid:%d\\n\",$1,$3}' /etc/passwd\nUsername:root              ,Uid:0\nUsername:bin               ,Uid:1\nUsername:daemon            ,Uid:2\nUsername:adm               ,Uid:3\nUsername:lp                ,Uid:4\nUsername:sync              ,Uid:5\nUsername:shutdown          ,Uid:6\n</code></pre>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#432-awk","title":"4.3.2 awk\u53d8\u91cf","text":"<ul> <li> <p>awk\u5185\u7f6e\u53d8\u91cf\u4e4b\u8bb0\u5f55\u53d8\u91cf\uff1a</p> <ul> <li>IFS:input field separator\uff0c\u8f93\u5165\u5b57\u6bb5\u5206\u9694\u7b26\uff08\u9ed8\u8ba4\u7a7a\u767d\uff09</li> <li>OFS:output field separator\uff0c\u8f93\u51fa\u5b57\u6bb5\u5206\u9694\u7b26</li> <li> <p>RS:Record separator:\u8f93\u5165\u6587\u672c\u6362\u884c\u7b26\uff08\u9ed8\u8ba4\u56de\u8f66\uff09</p> </li> <li> <p>ORS:\u8f93\u51fa\u6587\u672c\u6362\u884c\u7b26</p> </li> </ul> </li> <li> <p>awk\u5185\u7f6e\u53d8\u91cf\u4e4b\u6570\u636e\u53d8\u91cf</p> <ul> <li>NR:the number of input records,awk\u547d\u4ee4\u6240\u5904\u7406\u7684\u6587\u4ef6\u7684\u884c\u6570\uff0c\u5982\u679c\u6709\u591a\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6570\u76ee\u4f1a\u5c06\u5904\u7406\u7684\u591a\u4e2a\u6587\u4ef6\u8ba1\u6570</li> <li>NF:number of field,\u5f53\u524d\u8bb0\u5f55\u7684field\u4e2a\u6570</li> </ul> <pre><code>{print NF},{print $NF}\n</code></pre> <ul> <li> <p>ARGV:\u6570\u7ec4\uff0c\u4fdd\u5b58\u547d\u4ee4\u884c\u672c\u8eab\u8fd9\u4e2a\u5b57\u7b26\u4e32</p> </li> <li> <p>ARGC\uff1aawk\u547d\u4ee4\u7684\u53c2\u6570\u4e2a\u6570</p> </li> <li> <p>FILENAME:awk\u547d\u4ee4\u5904\u7406\u7684\u6587\u4ef6\u540d\u79f0</p> </li> <li> <p>ENVIRON\uff1a\u5f53\u524dshell\u73af\u5883\u53d8\u91cf\u53ca\u5176\u503c\u7684\u5173\u8054\u6570\u7ec4 <pre><code>awk 'BEGIN{print ENVIRON[\"PATH\"]}'\n</code></pre></p> </li> </ul> </li> <li> <p>\u81ea\u5b9a\u4e49\u53d8\u91cf     <code>-v var=value</code></p> <p>\u53d8\u91cf\u540d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]#  awk -v test=\"abc\" 'BEGIN{print test}'\nabc\n[root@master ~]# awk 'BEGIN{var=\"name\";print var}'\nname\n</code></pre> </li> <li> <p>\u7b97\u672f\u8fd0\u7b97</p> <ul> <li>+,-,*,/,^,%\u3002\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk 'BEGIN{a=5;b=3;print \"a + b =\",a+b}'\na + b = 8\n</code></pre> </li> <li> <p>\u5b57\u7b26\u4e32\u64cd\u4f5c</p> <ul> <li>\u65e0\u7b26\u53f7\u64cd\u4f5c\u7b26\uff0c\u8868\u793a\u5b57\u7b26\u4e32\u8fde\u63a5\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk 'BEGIN { str1=\"Hello,\"; str2=\"World\"; str3 = str1 str2; print str3 }'\nHello,World\n</code></pre> </li> <li> <p>\u8d4b\u503c\u64cd\u4f5c\u7b26\uff1a</p> <ul> <li>=\uff0c+=\uff0c-=\uff0c*=\uff0c/=\uff0c%=\uff0c^=\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk 'BEGIN{a=5;b=6;if(a == b) print \"a == b\";else print \"a!=b\"}' \na!=b\n\n[root@master ~]# awk -F: '{sum+=$3}END{print sum}' /etc/passwd\n72349\n</code></pre> </li> <li> <p>\u6bd4\u8f83\u64cd\u4f5c\u7b26\uff1a</p> <ul> <li>&gt;,&gt;=,&lt;,&lt;=,!=,==</li> </ul> </li> <li> <p>\u6a21\u5f0f\u5339\u914d\u7b26\uff1a</p> <ul> <li>~:\u662f\u5426\u5339\u914d</li> <li>!~:\u662f\u5426\u4e0d\u5339\u914d</li> </ul> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# awk -F: '$1~\"root\"{print $0}' /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\n</code></pre> </li> <li> <p>\u903b\u8f91\u64cd\u4f5c\u7b26\uff1a</p> <ul> <li>&amp;&amp; \u3001 || \u3001 \uff01\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk 'BEGIN{a=6;if(a &gt; 0 &amp;&amp; a &lt;= 6) print \"true\";else print \"false\"}'\ntrue\n</code></pre> </li> <li> <p>\u51fd\u6570\u8c03\u7528\uff1a</p> <ul> <li>function_name(argu1,augu2)</li> </ul> </li> <li> <p>\u6761\u4ef6\u8868\u8fbe\u5f0f(\u4e09\u5143\u8fd0\u7b97):</p> <ul> <li>selection\uff1fif-true-expresssion\uff1aif-false-expression</li> </ul> <pre><code>[root@master ~]# awk -F: '{$3&gt;=100?usertype=\"common user\":usertype=\"sysadmin\";printf \"%15s:%s\\n\",$1,usertype}' /etc/passwd\n           root:sysadmin\n            bin:sysadmin\n         daemon:sysadmin\n            adm:sysadmin\n             lp:sysadmin\n           sync:sysadmin\n       shutdown:sysadmin\n           halt:sysadmin\n</code></pre> </li> </ul>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#433","title":"4.3.3 \u64cd\u4f5c\u7b26","text":""},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#434-pattern","title":"4.3.4 Pattern","text":"<ul> <li>empty:\u7a7a\u6a21\u5f0f\uff0c\u5339\u914d\u6bcf\u4e00\u884c</li> <li> <p>/regular expression/:\u4ec5\u5904\u7406\u80fd\u88ab\u6b64\u5904\u6a21\u5f0f\u5339\u914d\u5230\u7684\u884c\uff0c\u4f8b\u5982\uff1b <pre><code>[root@master ~]# awk -F: '$NF==\"/bin/bash\"{printf \"%15s,%s\\n\",$NF,$1}' /etc/passwd\n      /bin/bash,root\n</code></pre></p> </li> <li> <p>relational expression\uff1a\u5173\u7cfb\u8868\u8fbe\u5f0f\uff0c\u7ed3\u679c\u4e3a\u201c\u771f\u201d\u6709\u201c\u5047\u201d\uff0c\u7ed3\u679c\u4e3a\u201c\u771f\u201d\u624d\u4f1a\u88ab\u5904\u7406\u3002</p> </li> </ul> <p>Tips\uff1a\u4f7f\u7528\u6a21\u5f0f\u9700\u8981\u4f7f\u7528\u53cc\u659c\u7ebf\u62ec\u8d77\u6765\uff0c\u771f\uff1a\u7ed3\u679c\u4e3a\u975e0\u503c\uff0c\u975e\u7a7a\u5b57\u7b26\u4e32\u3002</p> <pre><code>[root@master ~]# awk -F: '$3&gt;100{print $1,$3}' /etc/passwd\nsystemd-network 192\npolkitd 999\nceph 167\nkube 998\netcd 997\ngluster 996\nnfsnobody 65534\nchrony 995\nredis 994\n</code></pre> <p><pre><code>awk -F: '$NF==\"/bin/bash\"{printf \"%15s,%s\\n\",$NF,$1}' /etc/passwd\n</code></pre> <pre><code>awk -F: '$NF~/bash$/{printf \"%15s,%s\\n\",$NF,$1}' /etc/passwd\n</code></pre> <pre><code>df -Th|awk '/^\\/dev/{print}'\n</code></pre></p> <ul> <li> <p>line ranges\uff1a\u884c\u8303\u56f4\uff0c\u5236\u5b9astartline\uff0cendline\u3002</p> <pre><code>[root@master ~]# awk -F: '/10/,/20/{print $1}' /etc/passwd\ngames\nftp\nnobody\nsystemd-network\ndbus\npolkitd\npostfix\nsshd\nceph\nkube\netcd\ngluster\nrpc\n</code></pre> </li> <li> <p>BEGIN/END\u6a21\u5f0f</p> <ul> <li>BEGIN{}\uff1a\u4ec5\u5728\u5f00\u59cb\u5904\u7406\u6587\u672c\u4e4b\u524d\u6267\u884c\u4e00\u6b21</li> <li>END{}\uff1a\u4ec5\u5728\u6587\u672c\u5904\u7406\u5b8c\u6210\u4e4b\u540e\u6267\u884c\u4e00\u6b21</li> </ul> </li> </ul> <pre><code>    [root@master ~]# awk -F: 'BEGIN{print \"username     uid\\n--------------------\"}{printf \"%-15s:%d\\n\",$1,$3}END{print \"-----------------\\nend\"}' /etc/passwd\nusername     uid\n    --------------------\n    root           :0\n    bin            :1\n    daemon         :2\n    adm            :3\n    lp             :4\n    rpc            :32\n    rpcuser        :29\n    nfsnobody      :65534\n    chrony         :995\n    redis          :994\n    -----------------\n    end\n</code></pre>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#435","title":"4.3.5 \u63a7\u5236\u8bed\u53e5","text":"<ul> <li>if(condition) {statements}\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk -F: '{if($3&gt;100) print $1,$3}' /etc/passwd\nsystemd-network 192\npolkitd 999\nceph 167\nkube 998\netcd 997\ngluster 996\nnfsnobody 65534\nchrony 995\nredis 994\n</code></pre> <ul> <li>if(condition) {statments} [else {statments}]\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>[root@master ~]# awk -F: '{if($3&gt;100) {printf \"Common user:%-15s\\n\",$1} else {printf \"sysadmin user:%-15s\\n\",$1}}' /etc/passwd\nsysadmin user:root           \nsysadmin user:bin            \nsysadmin user:daemon         \nsysadmin user:adm            \nsysadmin user:lp             \nsysadmin user:sync           \nsysadmin user:shutdown       \nsysadmin user:halt           \nsysadmin user:mail           \nsysadmin user:operator       \nsysadmin user:games          \n</code></pre>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#5","title":"5 \u5b9e\u4f8b","text":"<pre><code>1.\u7edf\u8ba1/etc/fstab\u6587\u4ef6\u4e2d\u6bcf\u4e2a\u5355\u8bcd\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5e76\u6309\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\nawk '{for(i=1;i&lt;=NF;i++){words[$i]++}}END{for(key in words)print key,words[key]}' /etc/fstab|sort -k2 -nr\n\nawk '{ips[$1]++}END{for(i in ips) print i,ips[i]}' access_nginx.log |column -t|sort -k2 -nr\n\n2.\u7edf\u8ba1/etc/fstab\u6bcf\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b\u51fa\u73b0\u7684\u6b21\u6570\nawk '!/^#/&amp;&amp;!/^$/{dev[$3]++}END{for(i in dev) print i,dev[i]}' /etc/fstab\n\n3.ping\u4e00\u4e2a\u57df\u540d\uff0c\u8f93\u51faping\u6b64\u523b\u7684\u65f6\u95f4\nping baidu.com|awk '{print $0\" \"strftime(\"%Y-%m-%d %H:%M:%S\")}'\n\n4.\u5229\u7528netstat\u76d1\u63a7\u670d\u52a1\u662f\u5426\u6b63\u5e38\u76d1\u542c\nnetstat -lntup|awk 'NR&gt;2{if($4 ~/.*:22/) print $0\"yes\";exit 0}'\n\n5.\u7edf\u8ba1web\u670d\u52a1\u5668\u65e5\u5fd7\u72b6\u6001\u7801\nawk '$9~\"[0-9]\"{stat[$9]++}END{for(i in stat) print i,stat[i]}' access_log\n</code></pre>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#6","title":"6 \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li> <p><code>awk</code>\u540c<code>sed</code>\u547d\u4ee4\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7<code>sed</code>\u64c5\u957f\u53d6\u884c\uff0c<code>awk</code>\u547d\u4ee4\u64c5\u957f\u53d6\u5217\uff0cawk\u662f\u5bf9\u6587\u672c\u8fdb\u884c\u683c\u5f0f\u5316\u8f93\u51fa\uff0csed\u66f4\u503e\u5411\u4e8e\u5bf9\u6587\u4ef6\u8fdb\u884c\u4fee\u6539\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u8bfb\u5165\u7684\u6587\u4ef6\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u9700\u6c42\u5bf9IFS/OFS\u5bf9\u8f93\u5165\u548c\u8f93\u51fa\u8fdb\u884c\u4fee\u6539\u3002</p> </li> <li> <p>awk\u975e\u5e38\u7684\u5f3a\u5927\uff0c\u4f46\u662f\u4e5f\u662f\u4e09\u5251\u5ba2\u4e2d\u6700\u96be\u7684\u4e00\u4e2a\uff0c\u5176\u4f5c\u4e3a\u4e00\u95e8\u5355\u72ec\u7684\u8bed\u8a00\uff0c\u6211\u4eec\u5728Shell\u7f16\u7a0b\u4e2d\u5b66\u4e60\u5e38\u7528\u7684\u547d\u4ee4\u53ca\u8bed\u6cd5\u5c31\u5df2\u7ecf\u8db3\u591f\u6211\u4eec\u4f7f\u7528\u3002</p> </li> </ul>"},{"location":"linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/#7","title":"7 \u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u8282\u6211\u4eec\u7cfb\u7edf\u6027\u7684\u5b66\u4e60\u4e86awk\u7684\u8bed\u6cd5\u7ed3\u6784\u53ca\u5904\u7406\u6a21\u5f0f\uff0c\u5176\u76f8\u8f83\u4e8e\u5176\u4ed6\u6587\u672c\u5904\u7406\u5de5\u5177\uff0c\u66f4\u9002\u5408\u5bf9\u6587\u672c\u8fdb\u884c\u683c\u5f0f\u5316\u8f93\u51fa\uff0c\u6211\u4eec\u9700\u8981\u5728\u5408\u9002\u7684\u5730\u65b9\u4f7f\u7528\uff0c\u5176\u4f5c\u4e3aLinux\u7cfb\u7edf\u4e0a\u4e00\u4e2a\u975e\u5e38\u5f3a\u5927\u7684\u6587\u672c\u683c\u5f0f\u8f93\u51fa\u5de5\u5177\uff0c\u4e5f\u662f\u4e00\u95e8\u8bed\u8a00\uff0c\u540e\u671f\u9700\u8981\u5728\u5b9e\u8df5\u5de5\u4f5c\u4e2d\u66f4\u591a\u7684\u7075\u6d3b\u8fd0\u7528\uff0c\u4f7f\u5f97\u811a\u672c\u7f16\u5199\u66f4\u52a0\u65b9\u4fbf\u3002</p>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/","title":"15.Shell\u5e38\u7528\u5de5\u5177","text":"<p>Linux\u4e2d\u6709\u5f88\u591a\u975e\u5e38\u5b9e\u7528\u7684\u5de5\u5177\u6216\u547d\u4ee4\uff0c\u7075\u6d3b\u8fd0\u7528\u8fd9\u4e9b\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5728Shell\u7f16\u7a0b\u4e2d\u5316\u7e41\u4e3a\u7b80\uff0c\u5982\u864e\u6dfb\u7ffc\u3002\u53ef\u80fd\u4e00\u4e2a\u5de5\u5177\u6216\u547d\u4ee4\u5c31\u80fd\u8ba9\u539f\u672c\u8d1f\u8d23\u7684\u95ee\u9898\u5feb\u901f\u89e3\u51b3\uff0c\u672c\u7ae0\u8282\u6211\u4eec\u6765\u4e00\u8d77\u4e30\u5bcc\u6211\u4eec\u7684\u5de5\u5177\u5e93\uff0c\u65e5\u5e38\u53ef\u4ee5\u591a\u79ef\u7d2f\u603b\u7ed3\uff0c\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u7684\u7f16\u5199Shell\u3002</p>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#1-sort","title":"1. sort","text":"<p>\u7b80\u4ecb\uff1a\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u7528\u6765\u6392\u5e8f\u7684\u5de5\u5177\uff0c\u5728\u6211\u4eec\u65e5\u5e38\u5de5\u4f5c\u4e2d\u5bf9\u4e8e\u91cd\u590d\u5217\u7684\u591a\u884c\u8f93\u51fa\uff0c\u5982\u679c\u60f3\u8981\u5bf9\u5185\u5bb9\u6309\u7167\u7279\u5b9a\u89c4\u5219\u6392\u5e8f\uff0c\u6b64\u65f6\u5c31\u7528\u5230\u4e86sort\u5de5\u5177\u3002</p> <p>\u539f\u7406\uff1asort \u5c06\u6587\u4ef6\u7684\u6bcf\u4e00\u884c\u4f5c\u4e3a\u4e00\u4e2a\u5355\u4f4d\uff0c\u76f8\u4e92\u6bd4\u8f83\uff0c\u6bd4\u8f83\u539f\u5219\u9ed8\u8ba4\u60c5\u51b5\u662f\u4ece\u9996\u5b57\u7b26\u5411\u540e\uff0c\u4f9d\u6b21\u6309 ASCII \u7801\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c \u540e\u5c06\u4ed6\u4eec\u6309\u5347\u5e8f\u8f93\u51fa\u3002</p> <p>\u8bed\u6cd5\uff1a<code>sort [OPTION]... [FILE]\u2026</code></p> <p>\u9009\u9879\u8bf4\u660e\uff1a</p> <ul> <li>-t\uff1a\u6307\u5b9a\u4ee5\u4ec0\u4e48\u4f5c\u4e3a\u5217\u5206\u5272</li> <li>-k\uff1a\u7528\u6765\u5236\u5b9a\u5229\u7528\u90a3\u5217\u8fdb\u884c\u6392\u5e8f\uff0c\u901a\u5e38<code>-t</code>\u4e8e<code>-k</code>\u914d\u5408\u4f7f\u7528</li> <li>-r\uff1a\u5c06\u6587\u672c\u6587\u4ef6\u964d\u5e8f\u8f93\u51fa</li> <li>-n\uff1a\u4ee5\u6570\u7ec4\u6765\u8fdb\u884c\u751f\u5e8f\u6392\u5e8f</li> <li>-f\uff1a\u5ffd\u7565\u5927\u5c0f\u5199\u5b57\u6bcd</li> <li>-u\uff1a\u53d6\u6d88\u91cd\u590d\u7684\u884c</li> </ul> <p>\u5728\u6b64\u6211\u4eec\u4e0d\u5168\u90e8\u5c55\u5f00\u8d77\u6240\u6709\u9009\u9879\uff0c\u53ea\u6839\u636e\u65e5\u5e38\u7ecf\u9a8c\u7ed3\u5408\u5b9e\u9645\u6848\u4f8b\u5217\u4e3e\u6700\u5e38\u7528\u7684\u9009\u9879\u8fdb\u884c\u8bf4\u660e\u3002</p> <p>\u5b9e\u4f8b\uff1a</p> <ul> <li>\u5bf9/etc/passwd\u4e2d\u4ee5uid\u4ece\u5927\u5230\u5c0f\u6392\u5e8f</li> </ul> <pre><code>[root@10-234-1-235 ~]# sort -t: -k3 -n -r /etc/passwd\nsaslauth:x:499:76:Saslauthd user:/var/empty/saslauth:/sbin/nologin\ngitlab-www:x:498:497::/var/opt/gitlab/nginx:/bin/false\ngit:x:497:496::/var/opt/gitlab:/bin/sh\ngitlab-redis:x:496:495::/var/opt/gitlab/redis:/bin/false\ngitlab-psql:x:495:494::/var/opt/gitlab/postgresql:/bin/sh\ngitlab-prometheus:x:494:493::/var/opt/gitlab/prometheus:/bin/sh\nmongod:x:493:492:mongod:/var/lib/mongo:/bin/false\nnobody:x:99:99:Nobody:/:/sbin/nologin\npostfix:x:89:89::/var/spool/postfix:/sbin/nologin\ndbus:x:81:81:System message bus:/:/sbin/nologin\nsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin\nvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin\napache:x:48:48:Apache:/var/www:/sbin/nologin\nftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\ngopher:x:13:30:gopher:/var/gopher:/sbin/nologin\ngames:x:12:100:games:/usr/games:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\nuucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin\nmail:x:8:12:mail:/var/spool/mail:/sbin/nologin\nhalt:x:7:0:halt:/sbin:/sbin/halt\nshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\nsync:x:5:0:sync:/sbin:/bin/sync\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nbin:x:1:1:bin:/bin:/sbin/nologin\nroot:x:0:0:root:/root:/bin/bash\n</code></pre> <p>\u901a\u8fc7\u4e0a\u4f8b\u53ef\u4ee5\u770b\u5230\uff0c\u5229\u7528<code>-t</code>\u9009\u9879\u6307\u5b9a/etc/passwd\u6587\u4ef6\u4e2d\uff0c\u4ee5<code>:</code>\u4f5c\u4e3a\u5217\u8fdb\u884c\u5206\u5272\uff0c\u6307\u5b9auid\u7684\u5217\u4e3a<code>k3</code>\uff0c-n\u4ee5\u6570\u5b57\u8fdb\u884c\u6392\u5e8f\uff0c<code>-r</code>\u4e3a\u5012\u5e8f\u6392\u5e8f\u8f93\u51fa\u3002</p>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#2-uniq","title":"2. uniq","text":"<p>\u7b80\u4ecb\uff1a\u5bf9\u4e8e\u4e00\u4e9b\u91cd\u590d\u8f93\u51fa\u7684\u884c\u8fdb\u884c\u53bb\u91cd\u3002</p> <p>\u8bed\u6cd5\uff1a<code>uniq [OPTION]... [INPUT [OUTPUT]]</code></p> <p>\u9009\u9879\u8bf4\u660e\uff1a</p> <ul> <li> <p>-c\uff1a \u6253\u5370\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u53ea\u80fd\u7edf\u8ba1\u76f8\u90bb\u7684\u3002</p> </li> <li> <p>-d\uff1a \u53ea\u6253\u5370\u91cd\u590d\u884c\u3002</p> </li> <li> <p>-u\uff1a \u53ea\u6253\u5370\u4e0d\u91cd\u590d\u884c\u3002</p> </li> <li> <p>-D\uff1a \u53ea\u6253\u5370\u91cd\u590d\u884c\uff0c\u5e76\u4e14\u628a\u6240\u6709\u91cd\u590d\u884c\u6253\u5370\u51fa\u6765\u3002</p> </li> </ul> <p>\u5b9e\u4f8b\uff1a</p> <ul> <li>\u5bf9/etc/passwd\u4e2d\u4ee5<code>:</code>\uff0c\u5bf9\u6700\u540e\u4e00\u5217\u6c42\u51fa\u73b0\u7684\u6b21\u6570</li> </ul> <pre><code>[root@master ~]# awk -F\":\" '{print $NF}' /etc/passwd\n/bin/bash\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/bin/sync\n/sbin/shutdown\n/sbin/halt\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/bin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n/sbin/nologin\n[root@master ~]# awk -F\":\" '{print $NF}' /etc/passwd |sort |uniq -c |sort -nr\n     22 /sbin/nologin\n      1 /sbin/shutdown\n      1 /sbin/halt\n      1 /bin/sync\n      1 /bin/nologin\n      1 /bin/bash\n</code></pre> <p>\u5148\u5229\u7528awk\u6253\u5370\u51fa\u6700\u540e\u4e00\u5217\u5185\u5bb9\uff0c\u4e4b\u540e\u5229\u7528sort \u6765\u8fdb\u884c\u6392\u5e8f\uff0c\u5c06\u76f8\u540c\u7684\u5b57\u7b26\u89c4\u5728\u4e00\u8d77\u8f93\u51fa\uff0c\u6700\u540e\u5bf9\u76f8\u540c\u7684\u884c\u8fdb\u884c\u53bb\u91cd\uff0c\u5f97\u51fa\u6bcf\u79cd\u4e0d\u540c\u7c7b\u578bshell\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u6700\u540e\u5bf9\u6570\u5b66\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u3002</p>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#3-find","title":"3. find","text":"<p>\u7b80\u4ecb\uff1a\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u7528\u6765\u5728\u7cfb\u7edf\u4e2d\u67e5\u627e\u6587\u4ef6\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u57fa\u7840\u8d77\u59cb\u76ee\u5f55\uff0c\u6839\u636e\u4e0d\u540c\u7684\u9009\u9879\u67e5\u627e\u4e0d\u540c\u7684\u6587\u4ef6\u3002</p> <p>\u8bed\u6cd5\uff1a<code>find   path   -option   [   -print ]   [ -exec   -ok   command ]   {} \\;</code></p> <p>\u539f\u7406\uff1afind \u6839\u636eoption\u5728\u6307\u5b9a\u7684\u7cfb\u7edf\u8def\u5f84\u4e2d\u67e5\u627e\u6587\u4ef6\uff0c\u5982\u679c\u67e5\u627e\u5230\u4e0e\u5bf9\u5e94\u7684exec\u547d\u4ee4\uff0c\u5219\u6267\u884c\u5bf9\u5e94\u7684command\u3002</p> <p>-print\uff1a find \u547d\u4ee4\u5c06\u5339\u914d\u7684\u6587\u4ef6\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\uff1b -exec\uff1a find \u547d\u4ee4\u5bf9\u5339\u914d\u7684\u6587\u4ef6\u6267\u884c\u8be5\u53c2\u6570\u6240\u7ed9\u51fa\u7684 shell \u547d\u4ee4\u3002\u76f8\u5e94\u547d\u4ee4\u7684\u5f62\u5f0f\u4e3a 'command' {} \\;\uff0c\u6ce8\u610f {} \u548c \\\uff1b\u4e4b\u95f4\u7684\u7a7a\u683c\uff1b -ok\uff1a \u548c - exec \u7684\u4f5c\u7528\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u4ee5\u4e00\u79cd\u66f4\u4e3a\u5b89\u5168\u7684\u6a21\u5f0f\u6765\u6267\u884c\u8be5\u53c2\u6570\u6240\u7ed9\u51fa\u7684 shell \u547d\u4ee4\uff0c\u5728\u6267\u884c\u6bcf\u4e00\u4e2a\u547d\u4ee4\u4e4b\u524d\uff0c\u90fd\u4f1a\u7ed9\u51fa\u63d0\u793a\uff0c\u8ba9\u7528\u6237\u6765\u786e\u5b9a\u662f\u5426\u6267\u884c\uff1b</p> <p>\u9009\u9879\u8bf4\u660e\uff1a</p> <pre><code>- -name   filename               #\u67e5\u627e\u540d\u4e3a filename \u7684\u6587\u4ef6\n- -perm                          #\u6309\u6267\u884c\u6743\u9650\u6765\u67e5\u627e\n- -user    username              #\u6309\u6587\u4ef6\u5c5e\u4e3b\u6765\u67e5\u627e\n- -group groupname               #\u6309\u7ec4\u6765\u67e5\u627e\n- -mtime   -n +n                 #\u6309\u6587\u4ef6\u66f4\u6539\u65f6\u95f4\u6765\u67e5\u627e\u6587\u4ef6\uff0c-n \u6307 n \u5929\u4ee5\u5185\uff0c+n \u6307 n \u5929\u4ee5\u524d\n- -atime    -n +n                #\u6309\u6587\u4ef6\u8bbf\u95ee\u65f6\u95f4\u6765\u67e5 GIN: 0px\"&gt;\n- -ctime    -n +n                #\u6309\u6587\u4ef6\u521b\u5efa\u65f6\u95f4\u6765\u67e5\u627e\u6587\u4ef6\uff0c-n \u6307 n \u5929\u4ee5\u5185\uff0c+n \u6307 n \u5929\u4ee5\u524d\n- -type    b/d/c/p/l/f           #\u67e5\u662f\u5757\u8bbe\u5907\u3001\u76ee\u5f55\u3001\u5b57\u7b26\u8bbe\u5907\u3001\u7ba1\u9053\u3001\u7b26\u53f7\u94fe\u63a5\u3001\u666e\u901a\u6587\u4ef6\n- -size      n [c]               #\u67e5\u957f\u5ea6\u4e3a n \u5757 [\u6216 n \u5b57\u8282] \u7684\u6587\u4ef6\n- -depth                         #\u4f7f\u67e5\u627e\u5728\u8fdb\u5165\u5b50\u76ee\u5f55\u524d\u5148\u884c\u67e5\u627e\u5b8c\u672c\u76ee\u5f55\n- -prune\u3000\u3000                      #\u901a\u5e38\u548c -path \u4e00\u8d77\u4f7f\u7528\uff0c\u7528\u4e8e\u5c06\u7279\u5b9a\u76ee\u5f55\u6392\u9664\u5728\u641c\u7d22\u6761\u4ef6\u4e4b\u5916\u3002\u8fc7\u6ee4\u6761\u4ef6\u5199\u5728\u5176\u4ed6\u6761\u4ef6\u524d\u9762\u3002\n</code></pre> <p>\u5728\u6b64\u6211\u4eec\u5bf9\u547d\u4ee4\u652f\u6301\u7684\u9009\u9879\u5168\u90e8\u5c55\u5f00\u8be6\u89e3\uff0c\u6839\u636e\u65e5\u5e38\u7ecf\u9a8c\u7ed3\u5408\u5b9e\u9645\u6848\u4f8b\u5217\u4e3e\u6700\u5e38\u7528\u7684\u9009\u9879\u8fdb\u884c\u8bf4\u660e\uff1a</p> <p>\u5b9e\u4f8b:</p> <ul> <li>\u5728\u5f53\u524d\u76ee\u5f55\u5bfb\u627e\u6587\u4ef6\u540d\u79f0\u4ee5<code>.txt</code>\u7ed3\u5c3e\u7684\u6587\u4ef6\u5e76\u6253\u5370\u51fa\u6765</li> </ul> <pre><code>[root@master ~]# find   ~   -name   \"*.txt\"   -print \n/root/kubesphere-all-advanced-2.0.2/scripts/os/requirements.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/storages/NFS-Server/files/nfs-server-provisioner/templates/NOTES.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/ks-devops/jenkins/files/jenkins/jenkins-update-center/templates/NOTES.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/ks-devops/harbor/files/harbor/harbor/templates/NOTES.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/metrics-server/files/metrics-server/templates/NOTES.txt\n/root/kubesphere-all-advanced-2.0.2/kubesphere/roles/openpitrix/files/openpitrix/kubernetes/password.txt\n</code></pre> <ul> <li>\u67e5\u627e/usr/bin\u76ee\u5f55\u4e0b\u5927\u4e8e10M\u7684\u6587\u4ef6</li> </ul> <pre><code>[root@master ~]# find /usr/bin -size +10000k -exec ls -ld {} \\; \n-rwxr-xr-x. 1 root root 13606800 Jul 10  2018 /usr/bin/ceph-dencoder\n-rwxr-xr-x. 1 root root 15863688 Jul 10  2018 /usr/bin/ceph-objectstore-tool\n-rwxr-xr-x. 1 root root 15589080 Jul 10  2018 /usr/bin/ceph-osd\n-rwxr-xr-x. 1 root root 33073928 Feb 10  2019 /usr/bin/docker\n-rwxr-xr-x. 1 root root 38088856 Feb 10  2019 /usr/bin/docker-containerd\n-rwxr-xr-x. 1 root root 68608416 Feb 10  2019 /usr/bin/dockerd\n-rwxr-xr-x. 1 root root 20895160 Feb 10  2019 /usr/bin/docker-containerd-ctr\n-rwxr-xr-x. 1 root root 10785264 Jul 10  2018 /usr/bin/ceph-mon\n</code></pre> <ul> <li>\u67e5\u627e\u5f53\u524d\u76ee\u5f55\u4e0b\u6743\u9650\u4e3a777\u7684\u6587\u4ef6</li> </ul> <pre><code>[root@master ~]# find . -perm 777 -print   \n./.helm/repository/cache/local-index.yaml\n./kubesphere-all-v2.1.0/k8s/extra_playbooks/inventory\n./kubesphere-all-v2.1.0/k8s/extra_playbooks/roles\n./kubesphere-all-v2.1.0/k8s/contrib/terraform/openstack/hosts\n</code></pre>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#4-date","title":"4. date","text":"<p>\u5728\u6211\u4eec\u7f16\u5199Shell\u7684\u65f6\u5019\u7ecf\u5e38\u9047\u5230\u9700\u8981\u8bb0\u5f55\u65e5\u5fd7\u7684\u60c5\u51b5\uff0c\u5728\u8bb0\u5f55\u65e5\u5fd7\u7684\u65f6\u5019\u9700\u8981\u6253\u4e0a\u65f6\u95f4\u6233\uff0c\u4ee5\u4fbf\u540e\u671f\u67e5\u770b\u90a3\u4e2a\u65f6\u95f4\u8282\u70b9\u8fd0\u884c\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u7528\u5230date\u547d\u4ee4</p> <p>\u7b80\u4ecb\uff1adate \u53ef\u4ee5\u7528\u6765\u663e\u793a\u6216\u8bbe\u5b9a\u7cfb\u7edf\u7684\u65e5\u671f\u4e0e\u65f6\u95f4\u3002</p> <p>\u9009\u9879\uff1a</p> <pre><code>-d&lt;\u5b57\u7b26\u4e32&gt;\uff1a\u663e\u793a\u5b57\u7b26\u4e32\u6240\u6307\u7684\u65e5\u671f\u4e0e\u65f6\u95f4\u3002\u5b57\u7b26\u4e32\u524d\u540e\u5fc5\u987b\u52a0\u4e0a\u53cc\u5f15\u53f7\uff1b \n-s&lt;\u5b57\u7b26\u4e32&gt;\uff1a\u6839\u636e\u5b57\u7b26\u4e32\u6765\u8bbe\u7f6e\u65e5\u671f\u4e0e\u65f6\u95f4\u3002\u5b57\u7b26\u4e32\u524d\u540e\u5fc5\u987b\u52a0\u4e0a\u53cc\u5f15\u53f7\uff1b \n-u\uff1a\u663e\u793aGMT\uff1b \n</code></pre> <p>\u65f6\u95f4\u683c\u5f0f\uff1a</p> <pre><code>%Y -- \u5e74\u4efd\n%m -- \u6708\u4efd\n%d -- \u5f53\u6708\u7b2c\u51e0\u5929\n%t -- Tab \u8df3\u683c\n%H -- \u5c0f\u65f6\uff0c24 \u5c0f\u65f6\u683c\u5f0f (0~23)\n%I -- \u5c0f\u65f6\uff0c12 \u5c0f\u65f6\u683c\u5f0f (0~12)\n%M -- \u5206\u949f (00~59)\n%S -- \u79d2 (00~59)\n%j -- \u4eca\u5e74\u4e2d\u7684\u7b2c\u51e0\u5929\n%Z -- \u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8f93\u51fa\u5f53\u524d\u65f6\u533a\n%z -- \u4ee5\u6570\u5b57\u5f62\u5f0f\u8f93\u51fa\u5f53\u524d\u65f6\u533a\n%F --  \u6587\u4ef6\u65f6\u95f4\u683c\u5f0f same as % Y-% m-% d\n%T -- 24 \u5c0f\u65f6\u5236\u65f6\u95f4\u8868\u793a (hh:mm:ss)\n</code></pre> <ul> <li>\u5b9e\u4f8b</li> </ul> <p>\u8ba1\u7b97\u4e00\u4e2a\u547d\u4ee4\u6267\u884c\u6240\u9700\u8981\u7684\u8017\u65f6</p> <pre><code>#!/bin/bash \nstart=$(date +%s) \necho \"$(date +%F\" \"%T) \u5f00\u59cb\u6267\u884c\u547d\u4ee4\"\nsleep 5\necho \"$(date +%F\" \"%T) \u6267\u884c\u547d\u4ee4\u5b8c\u6210\"\nend=$(date +%s) \ndifference=$(( end - start )) \necho \"\u6267\u884c\u547d\u4ee4\u603b\u8017\u65f6:$difference seconds.\"\n\n[root@master ~]# bash time.sh \n2020-04-19 10:19:58 \u5f00\u59cb\u6267\u884c\u547d\u4ee4\n2020-04-19 10:20:03 \u6267\u884c\u547d\u4ee4\u5b8c\u6210\n\u6267\u884c\u547d\u4ee4\u603b\u8017\u65f6:5 seconds.\n</code></pre>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#5-xargs","title":"5. xargs","text":"<p>\u7b80\u4ecb\uff1axargs \u5168\u79f0\u662f transform arguments\uff0c\u610f\u4e3a\u8f6c\u6362\u53c2\u6570\uff0c\u5b83\u5c06\u6807\u51c6\u8f93\u5165\u8f6c\u6362\u4e3a\u547d\u4ee4\u884c\u53c2\u6570\u3002\u56e0\u4e3a linux \u547d\u4ee4\u884c\u4e2d\u7ecf\u5e38\u8981\u4f7f\u7528\u5230\u7ba1\u9053\u7b26\u8fde\u63a5\u4e0d\u540c\u7684\u547d\u4ee4\uff0c\u4f46\u662f\u6709\u4e9b\u547d\u4ee4\u4e0d\u652f\u6301\u6807\u51c6\u8f93\u5165\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u4f7f\u7528 xargs \u5c06\u6807\u51c6\u8f93\u5165\u8f6c\u6362\u4e3a\u53c2\u6570\uff0c</p> <p>\u8bed\u6cd5\uff1a<code>stdin_input | xargs [option] cmd</code></p> <p>\u539f\u7406\uff1axargs \u4e00\u822c\u662f\u901a\u8fc7\u7ba1\u9053\u7b26\u63a5\u53d7\u6807\u51c6\u8f93\u5165\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u547d\u4ee4\u884c\u53c2\u6570\u4f20\u9012\u7ed9 cmd\u3002</p> <p>\u5b9e\u4f8b\uff1a</p> <ul> <li>\u5c06\u6807\u51c6\u8f93\u5165\u8f6c\u6362\u6210\u547d\u4ee4\u884c\u53c2\u6570</li> </ul> <pre><code>[root@master ~]# seq 1 6\n1\n2\n3\n4\n5\n6\n[root@master ~]# seq 1 6 |xargs -n 2\n1 2\n3 4\n5 6\n</code></pre> <ul> <li>\u5220\u9664\u65e5\u5fd7\u6587\u4ef6</li> </ul> <pre><code>ls *.log |xargs rm -r   f {} \n</code></pre> <ul> <li>\u67e5\u627e/home/data\u4e0b\u6743\u9650\u4e3a644\u7684\u6587\u4ef6\u4fee\u6539\u6743\u9650\u4e3a600</li> </ul> <pre><code>find /home/data -perm 644 | xargs chmod 600 \n</code></pre> <ul> <li>\u67e5\u627ejpg\u6587\u4ef6\u5e76\u6253\u5305</li> </ul> <pre><code>find / -name *.jpg -type f -print | xargs tar -cvzf images.tar.gz\n</code></pre>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#6","title":"6. \u5b9e\u4f8b","text":""},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#61","title":"6.1 \u9700\u6c42","text":"<p>\u6211\u4eec\u7ecf\u5e38\u5728Linux\u7cfb\u7edf\u64cd\u4f5c\u64cd\u4f5c\u6587\u4ef6\uff0c\u4fd7\u8bdd\u8bf4\u5e38\u5728\u6cb3\u8fb9\u8d70\uff0c\u54ea\u6709\u4e0d\u6e7f\u978b\uff0c\u4e00\u4e0d\u5c0f\u5fc3\u5220\u9664\u91cd\u8981\u6587\u4ef6\u662f\u975e\u5e38\u5371\u9669\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528Shell\u811a\u672c\u6765\u5236\u4f5c\u4e00\u4e2a\u7c7b\u4f3c\u4e8eWindows\u4e0b\u7684\u56de\u6536\u7ad9\uff0c\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9a\u671f\u6e05\u7406\u8fd9\u4e2a\u56de\u6536\u7ad9\u4e2d\u7684\u5185\u5bb9\uff0c\u4ece\u800c\u8fbe\u5230\u7f13\u51b2\u53ca\u89c4\u907f\u5371\u9669\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#62","title":"6.2 \u601d\u8def","text":"<ul> <li>\u901a\u8fc7 alias rm \u6765\u5c06\u5220\u9664\u7684\u6587\u4ef6\uff0c\u79fb\u52a8\u6587\u4ef6\u5230\u4e00\u4e2a\u56de\u6536\u7ad9\u76ee\u5f55;</li> <li>\u5b9a\u671f\u7684\u5728\u7cfb\u7edf\u78c1\u76d8\u5141\u8bb8\u53ef\u63a7\u7684\u4f7f\u7528\u7387\u60c5\u51b5\u4e0b\uff0c\u5bf9\u56de\u6536\u7ad9\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u5220\u9664\u3002</li> </ul>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#63","title":"6.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# function:\u81ea\u5b9a\u4e49rm\u547d\u4ee4\uff0c\u6bcf\u5929\u665a\u4e0a\u5b9a\u65f6\u6e05\u7406\n\n# \u6307\u5b9a\u53d8\u91cf\nCMD_SCRIPTS=$HOME/.rm_scripts.sh\nTRASH_DIR=$HOME/.TRASH_DIR\nCRON_FILE=/var/spool/cron/root\nBASHRC=$HOME/.bashrc\n\n[ ! -d ${TRASH_DIR} ] &amp;&amp; mkdir -p ${TRASH_DIR}\ncat &gt; $CMD_SCRIPTS &lt;&lt;EOF\nPARA_CNT=\\$#\nTRASH_DIR=$TRASH_DIR\n\nfor i in \\$*; do\n     DATE=\\$(date +%F%T)\n     fileName=\\$(basename \\$i)\n     mv \\$i \\$TRASH_DIR/\\$fileName.\\$DATE\ndone\nEOF\n\nsed -i \"s@$(grep 'alias rm=' $BASHRC)@alias rm='bash ${CMD_SCRIPTS}'@g\" $BASHRC\nsource $HOME/.bashrc\n\n# \u5236\u4f5c\u5b9a\u65f6\u6e05\u7406\u4efb\u52a1\necho \"0 0 * * * rm -rf $TRASH_DIR/*\" &gt;&gt; $CRON_FILE\necho \"\u5220\u9664\u76ee\u5f55:$TRASH_DIR\"\necho \"\u5220\u9664\u811a\u672c:$CMD_SCRIPTS\"\necho \"\u8bf7\u6267\u884c:source $BASHRC \u6765\u52a0\u8f7d\u6587\u4ef6\u6216\u9000\u51fa\u5f53\u524dshell\u91cd\u65b0\u767b\u5f55\"\n</code></pre> <p>\u5bf9\u9632\u6cbb\u8bef\u5220\u9664\u811a\u672c\u8fdb\u884c\u7cfb\u7edf\u6d4b\u8bd5\u3002</p> <pre><code>[root@10-234-1-235 ~]# bash custom_rm.sh \n\u5220\u9664\u76ee\u5f55:/root/.TRASH_DIR\n\u5220\u9664\u811a\u672c:/root/.rm_scripts.sh\n\u8bf7\u6267\u884c:source /root/.bashrc \u6765\u52a0\u8f7d\u6587\u4ef6\u6216\u9000\u51fa\u5f53\u524dshell\u91cd\u65b0\u767b\u5f55\n[root@10-234-1-235 ~]# rm testdir/\n[root@10-234-1-235 ~]# rm wget-log \n[root@10-234-1-235 ~]# ls -la .TRASH_DIR/\ntotal 16\ndrwxr-xr-x.  3 root root 4096 Apr 18 20:11 .\ndr-xr-x---. 13 root root 4096 Apr 18 20:11 ..\ndrwxr-xr-x.  2 root root 4096 Apr 18 20:10 testdir.2020-04-1820:11:37\n-rw-r--r--.  1 root root    0 Jan  9 21:59 wget-log.2020-04-1820:11:40\n\n# \u67e5\u770b\u5b9a\u65f6\u4efb\u52a1\n[root@10-234-1-235 ~]# crontab -l\n0 0 * * * rm -rf /root/.TRASH_DIR/*\n</code></pre>"},{"location":"linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/#7","title":"7. \u5c0f\u7ed3","text":"<p>Shell\u7f16\u7a0b\u5c31\u662f\u5229\u7528\u5de5\u5177\u52a0\u6570\u636e\u7ed3\u6784\u6d41\u7a0b\u63a7\u5236\u5b9e\u73b0\u4e00\u7ec4\u64cd\u4f5c\uff0c\u6240\u4ee5\u638c\u63e1\u66f4\u591a\u5e38\u7528\u7684\u5de5\u5177\u6216\u547d\u4ee4\u975e\u5e38\u5229\u4e8e\u6211\u4eec\u7f16\u5199Shell\u811a\u672c\uff0c\u5e73\u65f6\u53ef\u4ee5\u591a\u5c1d\u8bd5\u5229\u7528\u5404\u79cd\u547d\u4ee4\u6216\u5de5\u5177\uff0c\u5e76\u5728Shell\u4e2d\u719f\u7ec3\u8fd0\u7528\u5b83\u4eec\uff0c\u52e4\u7ec3\u5e76\u53cd\u601d\u603b\u7ed3\uff0c\u5f52\u7eb3\u6574\u7406\uff0c\u65e5\u79ef\u6708\u7d2f\u5c31\u4f1a\u5f62\u6210\u81ea\u5df1\u5f3a\u5927\u7684\u5de5\u5177\u5e93\u3002</p>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/","title":"16.Shell\u5b9e\u6218\u9879\u76ee","text":""},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#1","title":"1. \u7cfb\u7edf\u5de1\u68c0","text":""},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#11","title":"1.1 \u9700\u6c42","text":"<p>\u9700\u8981\u5bf9Linux\u670d\u52a1\u5668\uff0c\u5de1\u68c0\u7cfb\u7edf/\u670d\u52a1/\u7aef\u53e3\u5404\u6307\u6807\u53ca\u53c2\u6570\uff0c\u7f16\u5199\u7cfb\u7edf\u5feb\u901f\u68c0\u67e5\u811a\u672c\uff0c\u8f93\u51fa\u7cfb\u7edf\u4fe1\u606f\u5230\u811a\u672c\u8fd0\u884c\u7684 logs \u76ee\u5f55\u4e0b\u3002</p>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#12","title":"1.2 \u601d\u8def","text":"<p>\u901a\u5e38\u7cfb\u7edf\u7684\u72b6\u6001\u90fd\u5728/proc/\u76ee\u5f55\u4e0b\uff0c\u5bf9\u6587\u4ef6\u4e2d\u7684\u5173\u6ce8\u7cfb\u7edf\u6307\u6807\u6570\u5b57\u8fdb\u884c\u8fc7\u6ee4\u5904\u7406\uff0c\u5f97\u5230\u7cfb\u7edf\u72b6\u6001\uff0c\u5176\u4e2d\u6d89\u53ca\u6570\u7ec4\u7684\u9700\u8981\u8ba1\u7b97\uff0c\u53ef\u4ee5\u5229\u7528\u51fd\u6570\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u9700\u8981\u5de1\u68c0\u7684\u7ed3\u679c\u5229\u7528\u5355\u72ec\u4e00\u4e2a\u51fd\u6570\u7f16\u5199\uff0c\u6700\u540e\u5229\u7528main\u51fd\u6570\u8c03\u7528\u5176\u4ed6\u51fd\u6570\u5f97\u51fa\u6700\u7ec8\u7ed3\u679c\u3002</p>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#13","title":"1.3 \u5b9e\u73b0","text":"<p>\u6838\u5fc3\u5229\u7528sed\u4ee3\u7801\uff1a</p> <pre><code>#!/bin/bash\n# auth:kaliarch\n# func:sys info check\n# version:v1.0\n# sys:centos6.x/7.x\n\n[ $(id -u) -gt 0 ] &amp;&amp; echo \"\u8bf7\u7528root\u7528\u6237\u6267\u884c\u6b64\u811a\u672c\uff01\" &amp;&amp; exit 1\nsysversion=$(rpm -q centos-release|cut -d- -f3)\nline=\"-------------------------------------------------\"\n\n\n[ -d logs ] || mkdir logs\n\nsys_check_file=\"logs/$(ip a show dev eth0|grep -w inet|awk '{print $2}'|awk -F '/' '{print $1}')-`date +%Y%m%d`.txt\"\n\n# \u83b7\u53d6\u7cfb\u7edfcpu\u4fe1\u606f\nfunction get_cpu_info() {\n    Physical_CPUs=$(grep \"physical id\" /proc/cpuinfo| sort | uniq | wc -l)\n    Virt_CPUs=$(grep \"processor\" /proc/cpuinfo | wc -l)\n    CPU_Kernels=$(grep \"cores\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}')\n    CPU_Type=$(grep \"model name\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq)\n    CPU_Arch=$(uname -m)\ncat &lt;&lt;EOF | column -t \nCPU\u4fe1\u606f:\n\n\u7269\u7406CPU\u4e2a\u6570: $Physical_CPUs\n\u903b\u8f91CPU\u4e2a\u6570: $Virt_CPUs\n\u6bcfCPU\u6838\u5fc3\u6570: $CPU_Kernels\nCPU\u578b\u53f7: $CPU_Type\nCPU\u67b6\u6784: $CPU_Arch\nEOF\n}\n\n# \u83b7\u53d6\u7cfb\u7edf\u5185\u5b58\u4fe1\u606f\nfunction get_mem_info() {\n    check_mem=$(free -m)\n    MemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}')  #KB\n    MemFree=$(grep MemFree /proc/meminfo| awk '{print $2}')    #KB\n    let MemUsed=MemTotal-MemFree\n    MemPercent=$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\n    report_MemTotal=\"$((MemTotal/1024))\"\"MB\"        #\u5185\u5b58\u603b\u5bb9\u91cf(MB)\n    report_MemFree=\"$((MemFree/1024))\"\"MB\"          #\u5185\u5b58\u5269\u4f59(MB)\n    report_MemUsedPercent=\"$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\"\"%\"   #\u5185\u5b58\u4f7f\u7528\u7387%\n\ncat &lt;&lt;EOF\n\u5185\u5b58\u4fe1\u606f\uff1a\n\n${check_mem}\nEOF\n}\n\n# \u83b7\u53d6\u7cfb\u7edf\u7f51\u7edc\u4fe1\u606f\nfunction get_net_info() {\n    pri_ipadd=$(ip a show dev eth0|grep -w inet|awk '{print $2}'|awk -F '/' '{print $1}')\n    pub_ipadd=$(curl ifconfig.me -s)\n    gateway=$(ip route | grep default | awk '{print $3}')\n    mac_info=$(ip link| egrep -v \"lo\"|grep link|awk '{print $2}')\n    dns_config=$(egrep -v \"^$|^#\" /etc/resolv.conf)\n    route_info=$(route -n)\ncat &lt;&lt;EOF | column -t \nIP\u4fe1\u606f:\n\n\u7cfb\u7edf\u516c\u7f51\u5730\u5740: ${pub_ipadd}\n\u7cfb\u7edf\u79c1\u7f51\u5730\u5740: ${pri_ipadd}\n\u7f51\u5173\u5730\u5740: ${gateway}\nMAC\u5730\u5740: ${mac_info}\n\n\u8def\u7531\u4fe1\u606f:\n${route_info}\n\nDNS \u4fe1\u606f:\n${dns_config}\nEOF\n}\n\n# \u83b7\u53d6\u7cfb\u7edf\u78c1\u76d8\u4fe1\u606f\nfunction get_disk_info() {\n    disk_info=$(fdisk -l|grep \"Disk /dev\"|cut -d, -f1)\n    disk_use=$(df -hTP|awk '$2!=\"tmpfs\"{print}')\n    disk_inode=$(df -hiP|awk '$1!=\"tmpfs\"{print}')\n\ncat &lt;&lt;EOF\n\u78c1\u76d8\u4fe1\u606f:\n\n${disk_info}\n\u78c1\u76d8\u4f7f\u7528:\n\n${disk_use}\ninode\u4fe1\u606f:\n\n${disk_inode}\nEOF\n\n\n}\n\n# \u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\nfunction get_systatus_info() {\n    sys_os=$(uname -o)\n    sys_release=$(cat /etc/redhat-release)\n    sys_kernel=$(uname -r)\n    sys_hostname=$(hostname)\n    sys_selinux=$(getenforce)\n    sys_lang=$(echo $LANG)\n    sys_lastreboot=$(who -b | awk '{print $3,$4}')\n    sys_runtime=$(uptime |awk '{print  $3,$4}'|cut -d, -f1)\n    sys_time=$(date)\n    sys_load=$(uptime |cut -d: -f5)\n\ncat &lt;&lt;EOF | column -t \n\u7cfb\u7edf\u4fe1\u606f:\n\n\u7cfb\u7edf: ${sys_os}\n\u53d1\u884c\u7248\u672c:   ${sys_release}\n\u7cfb\u7edf\u5185\u6838:   ${sys_kernel}\n\u4e3b\u673a\u540d:    ${sys_hostname}\nselinux\u72b6\u6001:  ${sys_selinux}\n\u7cfb\u7edf\u8bed\u8a00:   ${sys_lang}\n\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4: ${sys_time}\n\u7cfb\u7edf\u6700\u540e\u91cd\u542f\u65f6\u95f4:   ${sys_lastreboot}\n\u7cfb\u7edf\u8fd0\u884c\u65f6\u95f4: ${sys_runtime}\n\u7cfb\u7edf\u8d1f\u8f7d:   ${sys_load}\nEOF\n}\n\n# \u83b7\u53d6\u670d\u52a1\u4fe1\u606f\nfunction get_service_info() {\n    port_listen=$(netstat -lntup|grep -v \"Active Internet\")\n    kernel_config=$(sysctl -p 2&gt;/dev/null)\n    if [ ${sysversion} -gt 6 ];then\n        service_config=$(systemctl list-unit-files --type=service --state=enabled|grep \"enabled\")\n        run_service=$(systemctl list-units --type=service --state=running |grep \".service\")\n    else\n        service_config=$(/sbin/chkconfig | grep -E \":on|:\u542f\u7528\" |column -t)\n        run_service=$(/sbin/service --status-all|grep -E \"running\")\n    fi\ncat &lt;&lt;EOF\n\u670d\u52a1\u542f\u52a8\u914d\u7f6e:\n\n${service_config}\n${line}\n\u8fd0\u884c\u7684\u670d\u52a1:\n\n${run_service}\n${line}\n\u76d1\u542c\u7aef\u53e3:\n\n${port_listen}\n${line}\n\u5185\u6838\u53c2\u8003\u914d\u7f6e:\n\n${kernel_config}\nEOF\n}\n\n\nfunction get_sys_user() {\n    login_user=$(awk -F: '{if ($NF==\"/bin/bash\") print $0}' /etc/passwd)\n    ssh_config=$(egrep -v \"^#|^$\" /etc/ssh/sshd_config)\n    sudo_config=$(egrep -v \"^#|^$\" /etc/sudoers |grep -v \"^Defaults\")\n    host_config=$(egrep -v \"^#|^$\" /etc/hosts)\n    crond_config=$(for cronuser in /var/spool/cron/* ;do ls ${cronuser} 2&gt;/dev/null|cut -d/ -f5;egrep -v \"^$|^#\" ${cronuser} 2&gt;/dev/null;echo \"\";done)\ncat &lt;&lt;EOF\n\u7cfb\u7edf\u767b\u5f55\u7528\u6237:\n\n${login_user}\n${line}\nssh \u914d\u7f6e\u4fe1\u606f:\n\n${ssh_config}\n${line}\nsudo \u914d\u7f6e\u7528\u6237:\n\n${sudo_config}\n${line}\n\u5b9a\u65f6\u4efb\u52a1\u914d\u7f6e:\n\n${crond_config}\n${line}\nhosts \u4fe1\u606f:\n\n${host_config}\nEOF\n}\n\n\nfunction process_top_info() {\n\n    top_title=$(top -b n1|head -7|tail -1)\n    cpu_top10=$(top b -n1 | head -17 | tail -10)\n    mem_top10=$(top -b n1|head -17|tail -10|sort -k10 -r)\n\ncat &lt;&lt;EOF\nCPU\u5360\u7528top10:\n\n${top_title}\n${cpu_top10}\n\n\u5185\u5b58\u5360\u7528top10:\n\n${top_title}\n${mem_top10}\nEOF\n}\n\n\nfunction sys_check() {\n    get_cpu_info\n    echo ${line}\n    get_mem_info\n    echo ${line}\n    get_net_info\n    echo ${line}\n    get_disk_info\n    echo ${line}\n    get_systatus_info\n    echo ${line}\n    get_service_info\n    echo ${line}\n    get_sys_user\n    echo ${line}\n    process_top_info\n}\n\n\nsys_check &gt; ${sys_check_file}\n</code></pre>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#14","title":"1.4 \u6d4b\u8bd5","text":"<pre><code>[root@master workspace]# bash sys_check.sh \n[root@master workspace]# ls\nlogs  sys_check.sh\n[root@master workspace]# cat logs/172.16.60.2-20200419.txt \nCPU\u4fe1\u606f:\n\u7269\u7406CPU\u4e2a\u6570:  4\n\u903b\u8f91CPU\u4e2a\u6570:  4\n\u6bcfCPU\u6838\u5fc3\u6570:  1\nCPU\u578b\u53f7:      QEMU    Virtual  CPU\nCPU\u67b6\u6784:      x86_64\n-------------------------------------------------\n\u5185\u5b58\u4fe1\u606f\uff1a\n\n              total        used        free      shared  buff/cache   available\nMem:          16047       12536         179         885        3331        2007\nSwap:             0           0           0\n-------------------------------------------------\nIP\u4fe1\u606f:\n\u7cfb\u7edf\u516c\u7f51\u5730\u5740:      4x.xxx.xxx.18\n\u7cfb\u7edf\u79c1\u7f51\u5730\u5740:      172.16.60.2\n\u7f51\u5173\u5730\u5740:          172.16.60.1\nMAC\u5730\u5740:           52:54:73:7b:c9:11\n\u8def\u7531\u4fe1\u606f:\nKernel             IP                 routing          table\nDestination        Gateway            Genmask          Flags  Metric  Ref  Use  Iface\n0.0.0.0            172.16.60.1        0.0.0.0          UG     100     0    0    eth0\n10.233.88.192      172.16.60.5        255.255.255.192  UG     0       0    0    tunl0\n172.16.60.0        0.0.0.0            255.255.255.0    U      100     0    0    eth0\n172.17.0.0         0.0.0.0            255.255.0.0      U      0       0    0    docker0\nDNS                \u4fe1\u606f:\nnameserver         10.17.50.3\nnameserver         1.2.4.8\n-------------------------------------------------\n\u78c1\u76d8\u4fe1\u606f:\n\nDisk /dev/vda: 21.5 GB\nDisk /dev/vdb: 8589 MB\n\u78c1\u76d8\u4f7f\u7528:\n\nFilesystem     Type      Size  Used Avail Use% Mounted on\n/dev/vda1      ext4       20G  5.0G   14G  27% /\ndevtmpfs       devtmpfs  7.9G     0  7.9G   0% /dev\n/dev/vdc       ext4      197G   46G  142G  25% /data\n/dev/vdd       xfs       500G   53G  448G  11% /var/local/osd0\n\ninode\u4fe1\u606f:\n\nFilesystem     Inodes IUsed IFree IUse% Mounted on\n/dev/vda1        1.3M   54K  1.2M    5% /\ndevtmpfs         2.0M   398  2.0M    1% /dev\n/dev/vdc          13M  1.3M   12M   11% /data\n/dev/vdd         250M   14K  250M    1% /var/local/osd0\noverlay           13M  1.3M   12M   11% 2c99089efbac12ffc5d7a8f6ccf99d95ab3c1674b441205a61829ebe635/merged\n\n\u7cfb\u7edf:              GNU/Linux\n\u53d1\u884c\u7248\u672c:          CentOS                 Linux  release  7.4.1708  (Core)\n\u7cfb\u7edf\u5185\u6838:          3.10.0-693.el7.x86_64\n\u4e3b\u673a\u540d:            master\nselinux\u72b6\u6001:       Permissive\n\u7cfb\u7edf\u8bed\u8a00:          en_US.UTF-8\n\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4:      Sun                    Apr    19       12:34:35  CST     2020\n\u7cfb\u7edf\u6700\u540e\u91cd\u542f\u65f6\u95f4:  2020-03-18             16:15\n\u7cfb\u7edf\u8fd0\u884c\u65f6\u95f4:      31                     days\n\u7cfb\u7edf\u8d1f\u8f7d:          1.55,                  1.73,  1.95\n-------------------------------------------------\n\u670d\u52a1\u542f\u52a8\u914d\u7f6e:\n\nauditd.service                              enabled\nautovt@.service                             enabled\nceph-mon@.service                           enabled\netcd.service                                enabled\ngapd.service                                enabled\ngetty@.service                              enabled\nirqbalance.service                          enabled\nkdump.service                               enabled\nkubelet.service                             enabled\nmicrocode.service                           enabled\nNetworkManager-dispatcher.service           enabled\nNetworkManager.service                      enabled\npostfix.service                             enabled\nrpcbind.service                             enabled\nrsyslog.service                             enabled\nsmarteye-server-agent.service               enabled\nsshd.service                                enabled\nsystemd-readahead-collect.service           enabled\nsystemd-readahead-drop.service              enabled\nsystemd-readahead-replay.service            enabled\ntuned.service                               enabled\n-------------------------------------------------\n\u8fd0\u884c\u7684\u670d\u52a1:\n\nauditd.service                loaded active running Security Auditing Service\nceph-mon@master.service       loaded active running Ceph cluster monitor daemon\nceph-osd@0.service            loaded active running Ceph object storage daemon\nchronyd.service               loaded active running NTP client/server\ncrond.service                 loaded active running Command Scheduler\ndbus.service                  loaded active running D-Bus System Message Bus\ndocker.service                loaded active running Docker Application Container Engine\netcd.service                  loaded active running etcd docker wrapper\ngapd.service                  loaded active running guest agent for pitrix\ngetty@tty1.service            loaded active running Getty on tty1\ngssproxy.service              loaded active running GSSAPI Proxy Daemon\nirqbalance.service            loaded active running irqbalance daemon\nkubelet.service               loaded active running Kubernetes Kubelet Server\nNetworkManager.service        loaded active running Network Manager\npolkit.service                loaded active running Authorization Manager\npostfix.service               loaded active running Postfix Mail Transport Agent\nrpcbind.service               loaded active running RPC bind service\nrsyslog.service               loaded active running System Logging Service\nsmarteye-server-agent.service loaded active running The Smarteye Monitoring of server\nsshd.service                  loaded active running OpenSSH server daemon\nsystemd-journald.service      loaded active running Journal Service\nsystemd-logind.service        loaded active running Login Service\nsystemd-udevd.service         loaded active running udev Kernel Device Manager\ntuned.service                 loaded active running Dynamic System Tuning Daemon\n-------------------------------------------------\n\u76d1\u542c\u7aef\u53e3:\n\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 127.0.0.1:9099          0.0.0.0:*               LISTEN      10444/calico-node   \ntcp        0      0 172.16.60.2:2379        0.0.0.0:*               LISTEN      1321/etcd           \ntcp        0      0 127.0.0.1:2379          0.0.0.0:*               LISTEN      1321/etcd           \ntcp        0      0 172.16.60.2:9100        0.0.0.0:*               LISTEN      2868/./kube-rbac-pr \ntcp        0      0 127.0.0.1:9100          0.0.0.0:*               LISTEN      2314/node_exporter  \ntcp        0      0 172.16.60.2:2380        0.0.0.0:*               LISTEN      1321/etcd           \ntcp        0      0 172.16.60.2:10255       0.0.0.0:*               LISTEN      1222/kubelet        \ntcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      1/systemd           \ntcp        0      0 0.0.0.0:6800            0.0.0.0:*               LISTEN      850/ceph-osd        \ntcp        0      0 0.0.0.0:6801            0.0.0.0:*               LISTEN      850/ceph-osd        \ntcp        0      0 0.0.0.0:6802            0.0.0.0:*               LISTEN      850/ceph-osd        \ntcp        0      0 0.0.0.0:179             0.0.0.0:*               LISTEN      10755/bird          \ntcp        0      0 0.0.0.0:6803            0.0.0.0:*               LISTEN      850/ceph-osd        \ntcp        0      0 169.254.25.10:53        0.0.0.0:*               LISTEN      2058/node-cache     \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      552/sshd            \ntcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      786/master          \ntcp        0      0 127.0.0.1:40416         0.0.0.0:*               LISTEN      1222/kubelet        \ntcp        0      0 172.16.60.2:6789        0.0.0.0:*               LISTEN      661/ceph-mon        \ntcp        0      0 169.254.25.10:9254      0.0.0.0:*               LISTEN      2058/node-cache     \ntcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      1222/kubelet        \ntcp        0      0 127.0.0.1:10249         0.0.0.0:*               LISTEN      2854/kube-proxy     \ntcp        0      0 172.16.60.2:10250       0.0.0.0:*               LISTEN      1222/kubelet        \ntcp6       0      0 :::10251                :::*                    LISTEN      12358/kube-schedule \ntcp6       0      0 :::6443                 :::*                    LISTEN      1929/kube-apiserver \ntcp6       0      0 :::10252                :::*                    LISTEN      12366/kube-controll \nudp6       0      0 :::111                  :::*                                1/systemd           \nudp6       0      0 ::1:323                 :::*                                530/chronyd         \nudp6       0      0 :::703                  :::*                                535/rpcbind         \n-------------------------------------------------\n\u5185\u6838\u53c2\u8003\u914d\u7f6e:\n\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_local_reserved_ports = 30000-32767\nnet.bridge.bridge-nf-call-arptables = 1\n-------------------------------------------------\n\u7cfb\u7edf\u767b\u5f55\u7528\u6237:\n\nroot:x:0:0:root:/root:/bin/bash\n-------------------------------------------------\nssh \u914d\u7f6e\u4fe1\u606f:\n\nHostKey /etc/ssh/ssh_host_rsa_key\nHostKey /etc/ssh/ssh_host_ecdsa_key\nHostKey /etc/ssh/ssh_host_ed25519_key\nSyslogFacility AUTHPRIV\nAuthorizedKeysFile      .ssh/authorized_keys\nPasswordAuthentication yes\nChallengeResponseAuthentication no\nGSSAPIAuthentication no\nGSSAPICleanupCredentials no\nUsePAM yes\nX11Forwarding yes\nAcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES\nAcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT\nAcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE\nAcceptEnv XMODIFIERS\nSubsystem       sftp    /usr/libexec/openssh/sftp-server\nPermitRootLogin yes\nPermitEmptyPasswords no\nUseDNS no\n-------------------------------------------------\nsudo \u914d\u7f6e\u7528\u6237:\n\nroot    ALL=(ALL)       ALL\n%wheel  ALL=(ALL)       ALL\n-------------------------------------------------\n\u5b9a\u65f6\u4efb\u52a1\u914d\u7f6e:\n\nroot\n@weekly /usr/bin/docker system prune -f\n*/30 * * * * /opt/etcd_back/etcd_backup.sh\n-------------------------------------------------\nhosts \u4fe1\u606f:\n\n127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1 localhost6 localhost6.localdomain6 localhost6.localdomain\n172.16.60.2 master\n172.16.60.3 node01\n172.16.60.4 node02\n172.16.60.5 node03\n172.16.60.2 master.cluster.local master\n172.16.60.3 node01.cluster.local node01\n172.16.60.4 node02.cluster.local node02\n172.16.60.5 node03.cluster.local node03\n172.16.60.2  harbor.devops.kubesphere.local\n172.16.60.2  gitlab.devops.kubesphere.local\n-------------------------------------------------\nCPU\u5360\u7528top10:\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 1222 root      20   0 1401200 142324  19560 S  11.8  0.9   6197:32 kubelet\n 7119 root      20   0  144632  16016   4840 S   5.9  0.1 263:45.19 coredns\n 9761 1001      20   0  133952  19360   3444 S   5.9  0.1 589:46.42 jaeger-operator\n12366 root      20   0  821212 130924  21304 S   5.9  0.8  20:30.77 kube-controller\n15129 root      20   0  169104  39880   6176 S   5.9  0.2 212:52.15 mixs\n15251 root      20   0  157848   2148   1408 R   5.9  0.0   0:00.02 top\n19934 root      20   0 10.074g  26564   4612 S   5.9  0.2 342:47.40 etcd\n    1 root      20   0  194876   6912   2996 S   0.0  0.0   7:21.74 systemd\n    2 root      20   0       0      0      0 S   0.0  0.0   0:09.02 kthreadd\n    3 root      20   0       0      0      0 S   0.0  0.0  20:13.67 ksoftirqd/0\n\n\u5185\u5b58\u5360\u7528top10:\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 1929 root      20   0 1667544 832556  23912 S  11.8  5.1   5571:22 kube-apiserver\n12967 root      20   0  9.914g 6.834g   1580 S   5.9 43.6   3672:00 java\n28651 polkitd   20   0 4161568 217472   2180 S   5.9  1.3 185:46.09 java\n 1321 root      20   0 10.188g 170880  18380 S  11.8  1.0   2154:47 etcd\n12366 root      20   0  821212 130924  21304 S   5.9  0.8  20:30.78 kube-controller\n  661 ceph      20   0  463516  67048   4476 S   5.9  0.4 280:35.51 ceph-mon\n17654 root      20   0  167812  11044   2808 S   5.9  0.1   9:13.12 envoy\n    1 root      20   0  194876   6912   2996 S   0.0  0.0   7:21.74 systemd\n15255 root      20   0  157848   2152   1408 R  11.8  0.0   0:00.03 top\n14093 polkitd   20   0  288608   6848   4208 S   5.9  0.0   0:00.02 postgres\n</code></pre>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#2-elk","title":"2 ELK\u5b89\u88c5","text":""},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#21","title":"2.1 \u9700\u6c42","text":"<p>\u5bf9\u4e8e\u8f6f\u4ef6\u5b89\u88c5\uff0c\u901a\u5e38\u4eba\u5de5\u64cd\u4f5c\u4e0d\u4ec5\u7e41\u7410\u8017\u65f6\uff0c\u4e14\u6613\u51fa\u9519\uff0c\u53ef\u4ee5\u7528\u7f16\u5199Shell\u6765\u5b8c\u6210\uff0c\u540e\u671f\u5982\u679c\u6709\u91cd\u590d\u9700\u6c42\uff0c\u53ef\u4ee5\u4e00\u52b3\u6c38\u9038\uff0c\u5b89\u88c5\u4e0d\u6613\u51fa\u9519\u4e14\u63d0\u5347\u6548\u7387\uff0cELK\u4e3a\u5f00\u6e90\u65e5\u5fd7\u7cfb\u7edf \u7531 Elasticsearch\u3001Logstash \u548c Kibana \u4e09\u90e8\u5206\u7ec4\u4ef6\u7ec4\u6210\u3002</p>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#22","title":"2.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u9488\u5bf9\u9700\u8981\u6309\u7167\u7684\u5404\u670d\u52a1\u5355\u72ec\u7f16\u5199\u811a\u672c\u6765\u8fdb\u884c\u6309\u7167\uff0c\u5176\u4e2d\u5229\u7528\u4e86\u7cfb\u7edf\u5185\u7684\u5f88\u591a\u547d\u4ee4\uff0c\u4e5f\u5305\u542b\u6587\u4ef6\u7684\u64cd\u4f5c\u7b49\uff0c\u5728\u6b64\u521a\u597d\u56de\u987e\u6211\u4eec\u4e4b\u524d\u5b66\u4e60\u7684\u5185\u5bb9\u3002</p>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#23","title":"2.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n#mail:xuel@anchnet.com\n#data:2020/4/10\n#AutoInstall ELK scripts\n#Software:elasticsearch-5.4.1/logstash-5.4.1/filebeat-5.4.1/kibana-5.4.1\nclear\necho \"##########################################\"\necho \"#       Auto Install ELK.               ##\"\necho \"#       Press Ctrl + C to cancel        ##\"\necho \"#       Any key to continue             ##\"\necho \"##########################################\"\nread -p \n# \u5b9a\u4e49\u53d8\u91cf\nsoftware_dir=\"/usr/local/software\"\nelasticsearch_url=\"https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.4.1.tar.gz\"\nkibana_url=\"https://artifacts.elastic.co/downloads/kibana/kibana-5.4.1-linux-x86_64.tar.gz\"\nlogstash_url=\"https://artifacts.elastic.co/downloads/logstash/logstash-5.4.1.tar.gz\"\nfilebeat_url=\"https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.4.1-linux-x86_64.tar.gz\"\nsys_version=`cat /etc/redhat-release |awk '{print $4}'|cut -d. -f1`\nIP=`ip addr|grep \"inet \"|grep -v 127.0.0.1|awk '{print $2}'|cut -d/ -f1`\njvm_conf=\"/usr/local/elasticsearch/config/jvm.options\"\nsys_mem=`free -m|grep Mem:|awk '{print $2}'|awk '{sum+=$1} END {print sum/1024}'|cut -d. -f1`\n\n#wget software\nwget_fun() {\nif [ ! -d ${software_dir} ];then\n    mkdir -p ${software_dir} &amp;&amp; cd ${software_dir}\nelse\n    cd ${software_dir}\nfi\nfor software in $elasticsearch_url $kibana_url $logstash_url $filebeat_url\ndo\n    wget -c $software\ndone\nclear\n}\n\n#initial system:install java wget;set hostname;disable firewalld\ninit_sys() {\n[ -f /etc/init.d/functions ] &amp;&amp; . /etc/init.d/functions\n[ \"${sys_version}\" != \"7\" ] &amp;&amp; echo \"Error:This Scripts Support Centos7.xx\" &amp;&amp; exit 1\n[ $(id -u) != \"0\" ] &amp;&amp; echo \"Error: You must be root to run this script\" &amp;&amp; exit 1\nsed -i \"s/SELINUX=enforcing/SELINUX=disabled/\"  /etc/selinux/config\nsetenforce 0\nyum install -y java-1.8.0-openjdk wget net-tools\nhostnamectl set-hostname elk-server          \nsystemctl stop firewalld\ncat &gt;&gt;/etc/security/limits.conf&lt;&lt;EOF\n* soft nofile 65536 \n* hard nofile 65536 \n* soft nproc 65536 \n* hard nproc 65536\nEOF\n}\n\n#install elasticsearch\ninstall_elasticsearch() {\ncd $software_dir\ntar zxf elasticsearch-5.4.1.tar.gz\nmv elasticsearch-5.4.1 /usr/local/elasticsearch\nmkdir -p /usr/local/elasticsearch/data /usr/local/elasticsearch/logs\nuseradd elasticsearch\nchown -R elasticsearch:elasticsearch /usr/local/elasticsearch\necho \"vm.max_map_count = 655360\" &gt;&gt;/etc/sysctl.conf &amp;&amp; sysctl -p\nif [ ${sys_mem} -eq 0 ];then\n    sed -i \"s#`grep \"^-Xmx\" ${jvm_conf}`#\"-Xmx512m\"#g\" ${jvm_conf}\n    sed -i \"s#`grep \"^-Xms\" ${jvm_conf}`#\"-Xms512m\"#g\" ${jvm_conf}\nelse\n    sed -i \"s#`grep \"^-Xmx\" ${jvm_conf}`#\"-Xmx${sys_mem}g\"#g\" ${jvm_conf}\n    sed -i \"s#`grep \"^-Xms\" ${jvm_conf}`#\"-Xms${sys_mem}g\"#g\" ${jvm_conf}\nfi\ncat &gt;&gt;/usr/local/elasticsearch/config/elasticsearch.yml&lt;&lt;EOF\ncluster.name: my-application\nnode.name: elk-server\npath.data: /usr/local/elasticsearch/data\npath.logs: /usr/local/elasticsearch/logs\nnetwork.host: 127.0.0.1\nhttp.port: 9200\ndiscovery.zen.ping.unicast.hosts: [\"elk-server\"]\nEOF\nsu - elasticsearch -c \"nohup /usr/local/elasticsearch/bin/elasticsearch &amp;\"\n}\n\n#install logstash\ninstall_logstash() {\ncd $software_dir\ntar -zxf logstash-5.4.1.tar.gz\nmv logstash-5.4.1 /usr/local/logstash\ncat&gt;/usr/local/logstash/config/01-syslog.conf&lt;&lt;EOF\ninput {\n    beats {\n        port =&gt; \"5044\"\n        }\n    }\noutput {\n    elasticsearch {\n        hosts =&gt; \"127.0.0.1:9200\"\n    }\n    stdout { codec =&gt; rubydebug }\n}\nEOF\nnohup /usr/local/logstash/bin/logstash -f /usr/local/logstash/config/01-syslog.conf &amp; &gt;/dev/null\n}\n\n#install filebeat\ninstall_filebeat() {\ncd $software_dir\ntar -zxf filebeat-5.4.1-linux-x86_64.tar.gz\nmv filebeat-5.4.1-linux-x86_64 /usr/local/filebeat\ncat &gt;/usr/local/filebeat/filebeat.yml&lt;&lt;EOF\nfilebeat.prospectors:\n- input_type: log\n  paths:\n    - /var/log/*.log\noutput.logstash:\n  hosts: [\"127.0.0.1:5044\"]\nEOF\ncd /usr/local/filebeat/\nnohup /usr/local/filebeat/filebeat &amp; &gt;/dev/null\n}\n\n#install kibana\ninstall_kibana() {\ncd $software_dir\ntar -zxf kibana-5.4.1-linux-x86_64.tar.gz\nmv kibana-5.4.1-linux-x86_64 /usr/local/kibana\ncat &gt;&gt; /usr/local/kibana/config/kibana.yml &lt;&lt;EOF\nserver.port: 5601\nserver.host: \"0.0.0.0\"\nelasticsearch.url: \"http://127.0.0.1:9200\"\nEOF\nnohup /usr/local/kibana/bin/kibana &amp; &gt;/dev/null\n}\n\ncheck() {\nport=$1\nprogram=$2\ncheck_port=`netstat -lntup|grep ${port}|wc -l`\ncheck_program=`ps -ef|grep ${program}|grep -v grep|wc -l`\nif [ $check_port -gt 0 ] &amp;&amp; [ $check_program -gt 0 ];then\n        action \"${program} run is ok!\" /bin/true\nelse\n        action \"${program} run is error!\" /bin/false\nfi\n}\n\nmain() {\ninit_sys\nwget_fun\ninstall_elasticsearch\ninstall_filebeat\ninstall_logstash\ninstall_kibana\necho -e \"\\033[32m Checking Elasticsearch...\\033[0m\"\nsleep 20\ncheck :9200 \"elasticsearch\"\necho -e \"\\033[32m Checking Logstash...\\033[0m\"\nsleep 2\ncheck \":9600\" \"logstash\"\necho -e \"\\033[32m Checking Kibana...\\033[0m\"\nsleep 2\ncheck \":5601\" \"kibana\"\naction \"ELK install is success!\" /bin/true\necho \"url:http://$IP:5601\"\n}\nmain\n</code></pre>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#24","title":"2.4 \u6d4b\u8bd5","text":"<p>\u5b89\u88c5\u5b8c\u6210\u8bbf\u95eehttp://IP:5601\u5373\u53ef\uff0c\u6ce8\u610fIP\u5730\u5740\u4e3a\u6309\u7167ELK\u7684\u670d\u52a1\u5668IP\u5730\u5740\u3002</p> <p></p>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#3","title":"3. \u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u8282\u6211\u4eec\u7b80\u5355\u7684\u5217\u4e3e\u4e86\u4e24\u4e2a\u5177\u4f53\u5b9e\u4f8b\uff0c\u6765\u5b9e\u6218Shell\u811a\u672c\u7f16\u5199\u5904\u7406\u5177\u4f53\u95ee\u9898\uff0c\u81f3\u6b64\u5c31\u7ed3\u675f\u4e86Shell\u7684\u5168\u90e8\u7ae0\u8282\uff0c\u5728\u6b64\u5e0c\u671b\u672c\u6587\u53ef\u4ee5\u5e26\u7ed9\u5927\u5bb6Shell\u5b66\u4e60\u7684\u4e00\u4e9b\u601d\u8def\u8fc7\u65b9\u6cd5\u3002</p> <p>\u5b66\u4e60Shell\u9700\u8981\u591a\u52a8\u624b\u5b9e\u8df5\uff0c\u5728\u65e5\u5e38\u7f16\u5199\u4e2d\u4e3e\u4e00\u53cd\u4e09\uff0c\u9488\u5bf9\u4e00\u4e2a\u811a\u672c\u5982\u4f55\u80fd\u65e0\u72b6\u6001\uff0c\u66f4\u5065\u58ee\uff0c\u66f4\u7075\u6d3b\u6613\u7ef4\u62a4\uff0c\u9700\u8981\u591a\u6b21\u7684\u4fee\u6539\uff0c\u53cd\u590d\u7684\u6267\u884c\u9a8c\u8bc1\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\uff0c\u5c06\u6570\u636e\u62bd\u8c61\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012\uff0c\u53ef\u4ee5\u8fbe\u5230\u662f\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c\u3002\u6ce8\u610f\u5c06\u6709\u9650\u7684\u7cbe\u529b\u653e\u5728\u70ed\u70b9\u77e5\u8bc6\u4e0a\uff0c\u5176\u4ed6\u5de5\u5177\u6216\u547d\u4ee4\u7684\u5e38\u7528\u9009\u9879\u6216\u53c2\u6570\u7262\u8bb0\u5373\u53ef\uff0c\u5176\u4ed6\u4e0d\u5e38\u7528\u9009\u9879\u4e0d\u5efa\u8bae\u6b7b\u8bb0\u786c\u80cc\uff0c\u6d3b\u7528<code>\u2014help</code>\u6216<code>man</code>\u624b\u518c\u67e5\u770b\uff0c\u8fd9\u6837\u5728\u540e\u671f\u7684 Shell \u7f16\u5199\u4e2d\u80fd\u591f\u66f4\u52a0\u7684\u5feb\u901f\u9ad8\u6548\u3002</p>"},{"location":"linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/#4","title":"4. \u94fe\u63a5","text":"<ul> <li>https://github.com/fengyuhetao/shell</li> <li>https://github.com/daily-scripts/shell-scripts</li> </ul>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/","title":"2.Shell \u53d8\u91cf","text":""},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#1-shell","title":"1. Shell \u53d8\u91cf\u6982\u8ff0","text":"<p>\u53d8\u91cf\u662f\u4efb\u4f55\u7a0b\u5e8f\u6216\u811a\u672c\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u53d8\u91cf\u4e3a\u7a0b\u5e8f\u6216\u811a\u672c\u8bbf\u95ee\u5185\u5b58\u4e2d\u7684\u53ef\u4fee\u6539\u7684\u4e00\u5757\u6570\u636e\u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u65b9\u5f0f\u3002</p> <p>Linux Shell \u4e2d\u7684\u53d8\u91cf\u53ef\u4ee5\u88ab\u6307\u5b9a\u4e3a\u4efb\u610f\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6bd4\u5982\u6587\u672c\u5b57\u7b26\u4e32\u6216\u8005\u6570\u503c\u3002\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 Shell \u4e2d\u7684\u53d8\u91cf\u6765\u6539\u53d8 Shell \u7684\u6837\u5f0f\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u8ba9\u6211\u4eec\u6765\u4e86\u89e3\u548c\u5b66\u4e60\u4e00\u4e0b Shell \u4e2d\u7684\u53d8\u91cf\u5427\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#11-shell","title":"1.1 Shell \u53d8\u91cf\u662f\u4ec0\u4e48","text":"<p>Shell \u53d8\u91cf\u662f\u4ec0\u4e48\u5462\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u53ef\u4ee5\u53d8\u5316\u7684\u91cf\uff0c\u5982\u679c\u6709\u7f16\u7a0b\u57fa\u7840\u7684\u8bfb\u8005\u77e5\u9053\u4efb\u4f55\u7a0b\u5e8f\u4e2d\u90fd\u6709\u53d8\u91cf\uff0c\u4ece\u6211\u4eec\u5c0f\u65f6\u5019\u505a\u6570\u5b66\u9898\uff0c\u5b9a\u4e49\u7684 x \u53d8\u91cf\uff0c\u6700\u7ec8\u7ed9\u5b9a\u503c\uff0c\u7528\u503c\u66ff\u6362 x \u53d8\u91cf\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u6700\u521d\u63a5\u89e6\u7684\u53d8\u91cf\uff0c\u5b83\u548c\u6211\u4eec\u5728 Shell \u4e2d\u63a5\u89e6\u7684\u53d8\u91cf\u672c\u8d28\u4e0a\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u53d8\u91cf\u5728 Shell \u4e2d\u662f\u5b58\u50a8\u8ba1\u7b97\u5668\u5185\u5b58\u7684\u5355\u5143\uff0c\u5176\u4e2d\u5b58\u653e\u7684\u503c\u53ef\u4ee5\u6539\u53d8\uff0c\u5f53\u6211\u4eec\u5728\u7f16\u5199 Shell \u811a\u672c\u4e2d\uff0c\u5982\u679c\u4e00\u4e9b\u7ecf\u5e38\u7528\u7684\u5b57\u7b26\u4e32\u6216\u6570\u5b57\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf\uff0c\u5c06\u5177\u4f53\u7684\u503c\u8d4b\u7ed9\u8fd9\u4e2a\u53d8\u91cf\uff0c\u7136\u540e\u5728\u5177\u4f53\u7684\u51fd\u6570\u6216\u811a\u672c\u4e2d\u5f15\u7528\u8fd9\u4e2a\u53d8\u91cf\uff0c\u5c31\u76f8\u5f53\u4e8e\u62ff\u5230\u4e86\u8fd9\u4e2a\u503c\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u53d8\u91cf","text":"<p>\u6211\u4eec\u5927\u6982\u4e86\u89e3\u4e86 Shell \u53d8\u91cf\u662f\u4ec0\u4e48\uff0c\u90a3\u4e48\u4e3a\u4ec0\u4e48\u5728 Shell \u811a\u672c\u4e2d\u9700\u8981\u53d8\u91cf\u5462\uff1f</p> <p>\u4f8b\u5982\u5728\u4e00\u4e2a Shell \u811a\u672c\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u76ee\u5f55\uff0c\u811a\u672c\u5185\u591a\u5904\u8c03\u7528\u4e86\u8fd9\u4e2a\u76ee\u5f55\u540d\u79f0\uff0c\u73b0\u5728\u6211\u4eec\u6709\u4e2a\u9700\u6c42\u76ee\u5f55\u540d\u79f0\u6539\u53d8\u4e86\uff0c\u6211\u4eec\u8be5\u600e\u4e48\u529e\u5462\uff0c\u5728\u811a\u672c\u4e2d\u6bcf\u4e2a\u4f7f\u7528\u8be5\u76ee\u5f55\u7684\u5730\u65b9\u90fd\u9700\u8981\u6539\u6210\u65b0\u7684\u76ee\u5f55\u540d\u79f0\uff0c\u6709\u6ca1\u6709\u7b80\u5355\u7684\u65b9\u6cd5\u53ea\u9700\u8981\u6539\u4e00\u5904\u5730\u65b9\u5462\uff0c\u8fd9\u65f6\u5019\u5c31\u7528\u5230\u4e86\u6211\u4eec\u7684\u53d8\u91cf\uff0c\u5728\u811a\u672c\u7684\u5168\u5c40\u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf\u4f8b\u5982 <code>BASE_DIR</code>\uff0c\u7136\u540e\u5c06\u76ee\u5f55\u8d4b\u503c\u7ed9\u8fd9\u4e2a\u53d8\u91cf\uff0c\u5728\u5177\u4f53\u5f15\u7528\u7684\u65f6\u5019\u5229\u7528\u8fd9\u4e2a\u76ee\u5f55\u7684\u53d8\u91cf\u540d\u79f0\uff0c\u4e0b\u6b21\u9700\u8981\u6211\u4eec\u6539\uff0c\u53ea\u7528\u6539\u6700\u524d\u9762\u8fd9\u4e2a\u53d8\u91cf\u5373\u53ef\u3002</p> <p>\u56e0\u6b64\u6211\u4eec\u4f7f\u7528\u53d8\u91cf\u5c31\u662f\u4e3a\u65b9\u4fbf\uff0c\u540c\u65f6\u4e5f\u4f7f\u5f97\u6211\u4eec\u7684\u811a\u672c\u66f4\u5177\u7075\u6d3b\u6027\u6269\u5c55\u6027\u4e0e\u540e\u671f\u7684\u53ef\u7ef4\u62a4\u6027\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#2-shell","title":"2. Shell \u53d8\u91cf\u57fa\u672c\u64cd\u4f5c","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 Shell \u4e2d\u53d8\u91cf\u662f\u4ec0\u4e48\u4ee5\u53ca\u5176\u5728 Shell \u7f16\u5199\u4e2d\u7684\u91cd\u8981\u6027\uff0c\u90a3\u4e48\u8ba9\u6211\u4eec\u5148\u6765\u5b66\u4e60 Shell \u53d8\u91cf\u7684\u57fa\u672c\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#21","title":"2.1 \u53d8\u91cf\u7684\u5b9a\u4e49","text":"<p>\u5728\u4f7f\u7528 Shell \u53d8\u91cf\u524d\uff0c\u9700\u8981\u5148\u5b9a\u4e49\u53d8\u91cf\uff0c\u5b9a\u4e49\u53d8\u91cf\u7684\u65b9\u5f0f\u6709\u4e09\u79cd\uff1a</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#211","title":"2.1.1 \u76f4\u63a5\u8d4b\u503c","text":"<p>\u987e\u540d\u601d\u4e49\u5c31\u662f\u76f4\u63a5\u5c06\u4e00\u4e2a\u503c\u8d4b\u503c\u7ed9\u4e00\u4e2a\u53d8\u91cf\u540d\u79f0\uff0c\u8fd9\u79cd\u9700\u8981\u6ce8\u610f\u503c\u4e2d\u4e0d\u80fd\u5305\u542b\u7a7a\u767d\u5b57\u7b26</p> <p>\u4f8b\u5982\uff1a\u6b63\u786e\u7684\u76f4\u63a5\u8d4b\u503c\u53d8\u91cf\uff1a<code>DIR=/tmp</code>\uff0c\u5176\u4e2d <code>DIR</code> \u4e3a\u53d8\u91cf\u540d\uff0c<code>/tmp</code> \u4e3a\u503c</p> <p>\u9519\u8bef\u7684\u76f4\u63a5\u8d4b\u503c\uff1a<code>STRING=hello Shell</code>\uff0c\u5176\u4e2d <code>STRINNG</code> \u4e3a\u53d8\u91cf\u540d\uff0c<code>hello Shell</code> \u4e3a\u503c\uff0c\u5176\u4e2d\u503c\u5305\u542b\u4e86\u7a7a\u767d\u5b57\u7b26\uff0c\u8fd9\u79cd\u8d4b\u503c\u53d8\u91cf\u5c31\u662f\u9519\u8bef\u7684\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#212","title":"2.1.2 \u5355\u5f15\u53f7\u8d4b\u503c","text":"<p>\u5982\u679c\u503c\u4e2d\u4e3a\u666e\u901a\u5b57\u7b26\uff0c\u90a3\u4e48\u5355\u5f15\u53f7\u8d4b\u503c\u4e0e\u53cc\u5f15\u53f7\u8d4b\u503c\u6ca1\u6709\u533a\u522b\uff0c\u5176\u53ef\u4ee5\u5305\u542b\u7a7a\u767d\u5b57\u7b26\uff0c\u4f46\u662f\u5982\u679c\u5176\u4e2d\u5305\u542b\u4e86\u53d8\u91cf\u7684\u4f7f\u7528\uff0c\u90a3\u4e48\u5355\u5f15\u53f7\u8d4b\u503c\u65b9\u5f0f\u4e3a\u5355\u5f15\u53f7\u91cc\u9762\u7684\u5185\u5bb9\u662f\u4ec0\u4e48\u5c31\u8f93\u51fa\u4ec0\u4e48\uff0c\u6b64\u79cd\u8d4b\u503c\u65b9\u5f0f\u9002\u7528\u4e8e\u4e0d\u5e0c\u671b\u89e3\u6790\u53d8\u91cf\u7684\u573a\u666f\uff0c\u4ec5\u663e\u793a\u7eaf\u5b57\u7b26\u4e32\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n[root@master ~]# DIR='$PATH'\n[root@master ~]# echo $DIR\n$PATH\n[root@master ~]# DATE='$(date)'\n[root@master ~]# echo $DATE\n$(date)\n</code></pre> <p><code>PATH</code> \u4e3a linux \u7cfb\u7edf\u5185\u7f6e\u7684\u4e00\u4e2a\u73af\u5883\u53d8\u91cf\uff0cDIR \u4e3a\u6211\u4eec\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u503c\u4e3a\u5355\u5f15\u53f7\u5f15\u8d77\u6765\u7684 <code>$PATH</code>\uff0c\u67e5\u770b\u5176\u5185\u5bb9\u4e5f\u4e3a <code>$PATH</code>\uff0c\u540c\u7406\u5bf9\u4e8e\u6267\u884c <code>date</code> \u547d\u4ee4\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#213","title":"2.1.3 \u53cc\u5f15\u53f7\u8d4b\u503c","text":"<p>\u4e0e\u5355\u5f15\u53f7\u8d4b\u503c\u4e00\u6837\uff0c\u5176\u4e5f\u53ef\u4ee5\u5305\u542b\u7a7a\u767d\u5b57\u7b26\uff0c\u4f46\u662f\u4e0e\u5355\u5f15\u53f7\u8d4b\u503c\u4e0d\u540c\u7684\u662f\uff0c\u53cc\u5f15\u53f7\u8d4b\u503c\u53ef\u4ee5\u89e3\u6790\u5f15\u53f7\u5185\u7684\u53d8\u91cf\u6216\u6267\u884c\u547d\u4ee4\uff0c\u5373\u4e0d\u662f\u5c06\u53cc\u5f15\u53f7\u4e2d\u7684\u53d8\u91cf\u540d\u548c\u547d\u4ee4\u539f\u6837\u8f93\u51fa\uff0c\u800c\u662f\u89e3\u6790\u5176\u4e2d\u53d8\u91cf\u7684\u5185\u5bb9\uff0c\u7136\u540e\u8fdb\u884c\u8f93\u51fa\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n[root@master ~]# DIR=\"$PATH\"\n[root@master ~]# echo $DIR\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n[root@master ~]# DATE=\"$(date)\" \n[root@master ~]# echo $DATE    \nSun Mar 8 22:13:57 CST 2020\n</code></pre> <p>\u53ef\u4ee5\u901a\u8fc7\u4e0e\u5355\u5f15\u53f7\u793a\u4f8b\u5bf9\u7167\u67e5\u770b\uff0c\u53cc\u5f15\u53f7\u8d4b\u503c\u89e3\u6790\u4e86 <code>PATH</code> \u53d8\u91cf\u7684\u503c\u7136\u540e\u8f93\u51fa\uff0c\u540c\u7406\u5bf9\u4e8e\u6267\u884c\u547d\u4ee4 <code>date</code>\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#22","title":"2.2 \u53d8\u91cf\u7684\u4f7f\u7528","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86\u53d8\u91cf\u7684\u5b9a\u4e49\u65b9\u5f0f\uff0c\u90a3\u4e48\u8be5\u5982\u4f55\u4f7f\u7528\u53d8\u91cf\u5462\uff1f\u4f7f\u7528\u53d8\u91cf\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u5b9a\u4e49\u7684\u53d8\u91cf\u540d\u524d\u9762\u6dfb\u52a0 <code>$</code> \u5373\u53ef\u4f7f\u7528\u5b9a\u4e49\u7684\u53d8\u91cf</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# DIR=/tmp\n[root@master ~]# echo $DIR\n/tmp\n</code></pre> <p>\u5728\u4f7f\u7528\u53d8\u91cf\u4e2d\u6709\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\uff0c\u9700\u8981\u6211\u4eec\u624b\u52a8\u6307\u5b9a\u53d8\u91cf\u7684\u8fb9\u754c\u662f\u4ec0\u4e48\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u4f7f\u7528\u5230 <code>{}</code>\u3002</p> <pre><code>[root@master ~]# STRING=\"hello Shell\"\n[root@master ~]# echo \"test $STRINGtest\"\ntest \n[root@master ~]# echo \"test ${STRING}test\"\ntest hello Shelltest\n</code></pre> <p>\u901a\u8fc7\u793a\u4f8b\u6211\u4eec\u80fd\u591f\u770b\u51fa\uff0c\u4e0d\u4f7f\u7528 <code>{}</code> \u5f15\u8d77\u6765\u53d8\u91cf\uff0c\u5982\u679c\u53d8\u91cf\u540d\u540e\u9762\u7ee7\u7eed\u6709\u5b57\u7b26\uff0cShell \u65e0\u6cd5\u5224\u65ad\u6211\u4eec\u7684\u53d8\u91cf\u8fb9\u754c\u5728\u54ea\u91cc\uff0c\u6211\u4eec\u63a8\u8350\u5728\u4f7f\u7528\u53d8\u91cf\u7684\u65f6\u5019\u90fd\u5e26\u4e0a <code>{}</code> \u51cf\u5c11\u51fa\u9519\u7684\u6982\u7387\uff0c\u5e76\u4e14\u65b9\u4fbf\u6211\u4eec\u4eba\u4e3a\u8bc6\u522b\u53d8\u91cf\u7684\u8fb9\u754c\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#23","title":"2.3 \u53d8\u91cf\u7684\u66f4\u65b0","text":"<p>\u6211\u4eec\u5df2\u7ecf\u5b9a\u4e49\u4e86\u53d8\u91cf\uff0c\u5982\u679c\u5bf9\u53d8\u91cf\u8fdb\u884c\u66f4\u65b0\u4fee\u6539\u5462\uff0c\u66f4\u65b0\u4fee\u6539\u53d8\u91cf\u91cd\u65b0\u8d4b\u503c\u5373\u53ef</p> <p>\u4f8b\u5982:</p> <pre><code>[root@master ~]# DIR=/tmp\n[root@master ~]# echo $DIR\n/tmp\n[root@master ~]# DIR=/root\n[root@master ~]# echo $DIR\n/root\n</code></pre> <p>\u53e6\u5916\u5728\u53d8\u91cf\u4e2d\u5b58\u5728\u53ea\u8bfb\u53d8\u91cf\uff0c\u987e\u540d\u601d\u4e49\u5176\u4e3a\u5b9a\u4e49\u597d\u540e\uff0c\u53ea\u80fd\u53ea\u8bfb\uff0c\u4e0d\u80fd\u5bf9\u5176\u8fdb\u884c\u4fee\u6539\uff0c\u4f7f\u7528 readonly \u547d\u4ee4\u53ef\u4ee5\u5c06\u53d8\u91cf\u5b9a\u4e49\u4e3a\u53ea\u8bfb\u53d8\u91cf</p> <pre><code>[root@master ~]# readonly STRING=\"Shell\"\n[root@master ~]# echo ${STRING}\nShell\n[root@master ~]# STRING=\"test\"\n-bash: STRING: readonly variable\n[root@master ~]# echo ${STRING}\nShell\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u4f7f\u7528 readonly \u5b9a\u4e49\u53d8\u91cf\u540e\uff0c\u5bf9\u53d8\u91cf\u8fdb\u884c\u4fee\u6539\u65f6\u5019\u62a5\u9519\uff0c\u53ea\u8bfb\u53d8\u91cf\u65e0\u6cd5\u8fdb\u884c\u4fee\u6539\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#24","title":"2.4 \u53d8\u91cf\u7684\u5220\u9664","text":"<p>\u53d8\u91cf\u7684\u5220\u9664\u4f7f\u7528 unset\uff0c\u5220\u9664\u540e\u5c31\u6d88\u9664\u4e86\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u53d8\u91cf\u88ab\u5220\u9664\u540e\u4e0d\u80fd\u518d\u6b21\u4f7f\u7528\uff1bunset \u547d\u4ee4\u4e0d\u80fd\u5220\u9664\u53ea\u8bfb\u53d8\u91cf\u3002</p> <p>\u4f8b\u5982</p> <pre><code>[root@master ~]# DIR=/tmp \n[root@master ~]# echo \"dir is ${DIR}\"            \ndir is /tmp\n[root@master ~]# unset DIR\n[root@master ~]# echo \"dir is ${DIR}\" \ndir is\n</code></pre>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#3-shell","title":"3. Shell \u53d8\u91cf\u89c4\u8303","text":"<p>\u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0cShell \u4e2d\u53d8\u91cf\u4e5f\u9700\u8981\u9075\u5faa\u4e00\u5b9a\u7684\u89c4\u8303\uff0c</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#31","title":"3.1 \u547d\u540d\u89c4\u8303","text":"<ul> <li>\u53d8\u91cf\u547d\u540d\u53ea\u80fd\u4f7f\u7528\u82f1\u6587\u5b57\u6bcd\uff0c\u6570\u5b57\u548c\u4e0b\u5212\u7ebf\uff0c\u9996\u5b57\u6bcd\u4e0d\u80fd\u4ee5\u6570\u5b57\u5f00\u5934</li> <li>\u4f8b\u5982<ul> <li>\u6b63\u5e38\u53d8\u91cf\uff1a<code>BASE_DIR</code>,<code>File_Name</code>,<code>AEG3</code>,<code>_DIR</code> \u7b49\u90fd\u662f\u6b63\u5e38\u7684\u53d8\u91cf</li> <li>\u65e0\u6548\u53d8\u91cf\uff1a<code>1file</code>,<code>#dir</code></li> </ul> </li> <li>\u53d8\u91cf\u540d\u4e2d\u95f4\u4e0d\u80fd\u4f7f\u7528\u7a7a\u683c\u6216\u6807\u70b9\u7b26\u53f7</li> <li>\u4f8b\u5982\uff1a<code>DIR FILE</code>\uff0c<code>DIR?FILE</code> \u5c31\u4e3a\u65e0\u6548\u53d8\u91cf\uff0c</li> <li>\u53d8\u91cf\u547d\u540d\u4e0d\u80fd\u4f7f\u7528 base \u91cc\u9762\u7684\u5173\u952e\u5b57\uff08help \u6765\u67e5\u770b\u5173\u952e\u5b57\uff09</li> <li>Shell \u53d8\u91cf\u5927\u5c0f\u5199\u654f\u611f\uff0c\u4e5f\u5c31\u662f\u5b9a\u4e49\u4e3a\u5927\u5199\u7684\u53d8\u91cf\u540d\uff0c\u5f15\u7528\u7684\u65f6\u5019\u5fc5\u987b\u5b8c\u5168\u4e00\u81f4\u3002</li> <li>\u4f8b\u5982:<code>DIRNAME</code> \u548c <code>dirname</code> \u5c31\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u53d8\u91cf</li> </ul>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#32","title":"3.2 \u8d4b\u503c\u89c4\u8303","text":"<ul> <li> <p>\u53d8\u91cf\u4e0e\u503c\u76f4\u63a5\u4f7f\u7528 \"=\" \u8fde\u63a5\uff0c\u7b49\u53f7\u4e24\u8fb9\u4e0d\u80fd\u5b58\u5728\u7a7a\u767d\u5b57\u7b26</p> </li> <li> <p>\u4f8b\u5982\uff1a <code>dirname = \"/tmp\"</code> \u6539\u8d4b\u503c\u65b9\u6cd5\u5c31\u662f\u9519\u8bef\u7684</p> </li> <li> <p>\u5982\u679c\u503c\u4e2d\u6709\u7a7a\u767d\u5b57\u7b26\uff0c\u4f7f\u7528\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\uff0c\u53cc\u5f15\u53f7\u5bf9\u4e8e\u5176\u4e2d\u5f15\u7528\u7684\u503c\u5c06\u4f1a\u6839\u636e\u5176\u5185\u5bb9\u8f6c\u5316\uff0c\u5355\u5f15\u53f7\u5185\u7684\u7279\u6b8a\u5b57\u7b26\u5219\u4e00\u5f8b\u5f53\u5b57\u7b26\u4e32\u8fdb\u884c\u5904\u7406\u3002</p> </li> <li> <p>\u4f8b\u5982\uff1a<code>DIRNAME=\"$PATH\"</code> \u7684\u503c\u4e3a\u7cfb\u7edf PATH \u5b9e\u9645\u7684\u53ef\u6267\u884c\u6587\u4ef6\u8def\u5f84\uff0c<code>DIRNAME='$PATH'</code> \u7684\u503c\u4e3a $PATH \u7684\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p>\u53ef\u7528 <code>\\</code> \u6765\u8f6c\u8bd1\u53d8\u91cf\uff0c\u8ba9\u5176\u53d8\u4e3a\u4e00\u822c\u5b57\u7b26\u3002</p> </li> <li> <p>\u4f8b\u5982\uff1a<code>DIRNAME=\\$PATH</code> \u7684\u503c\u4e3a $PATH \u7684\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p>\u5982\u679c\u53d8\u91cf\u7684\u503c\u4e3a\u6307\u4ee4\uff0c\u53ef\u7528\u4f7f\u7528\u53cd\u6487\u53f7\uff0c\u6216 $() \u6765\u65f6\u5f15\u7528\u3002</p> </li> <li> <p>\u4f8b\u5982\uff1a\u4e0b\u9762\u4e24\u4e2a\u662f\u4e00\u6837\u7684</p> </li> <li> <p><code>bash   DATE=`date`   DATE=$(date)</code></p> </li> <li> <p>\u5728\u811a\u672c\u4e2d\u5b9a\u4e49\u666e\u901a\u5b57\u7b26\u4e32\u53d8\u91cf\u65f6\uff0c\u5e94\u5c3d\u91cf\u628a\u53d8\u91cf\u7684\u5185\u5bb9\u7528\u53cc\u5f15\u53f7\u62ec\u8d77\u6765\uff1b</p> </li> <li> <p>\u4f8b\u5982\uff1a<code>DIRNAME=\"/tmp\"</code></p> </li> <li> <p>\u5355\u7eaf\u6570\u5b57\u7684\u53d8\u91cf\u5185\u5bb9\u53ef\u4ee5\u4e0d\u52a0\u5f15\u53f7\uff1b</p> </li> <li> <p>\u4f8b\u5982\uff1a<code>NUM=10</code></p> </li> </ul>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#4","title":"4. \u53d8\u91cf\u7684\u5206\u7c7b","text":"<p>Shell \u7684\u53d8\u91cf\u6709\u4e09\u79cd\u5206\u7c7b\uff0c\u6bcf\u79cd\u90fd\u6709\u5176\u4e0d\u540c\u7684\u4f5c\u7528\u8303\u56f4</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#41","title":"4.1 \u5c40\u90e8\u53d8\u91cf","text":"<p>\u5c40\u90e8\u53d8\u91cf\uff0c\u6545\u540d\u601d\u4e49\u5176\u53ea\u5728 Shell \u811a\u672c\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u6216\u5728 Shell \u811a\u672c\u51fd\u6570\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u53ea\u80fd\u5728 Shell \u811a\u672c\u4e2d\u4f7f\u7528\uff0c\u6216\u53ea\u80fd\u5728 Shell \u811a\u672c\u51fd\u6570\u4e2d\u4f7f\u7528</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell]# cat local_var.sh \n#!/bin/bash\n\nDIR=/tmp\necho \"dir is ${DIR}\"\n[root@master Shell]# bash local_var.sh \ndir is /tmp\n[root@master Shell]# echo \"dir is ${DIR}\"\ndir is \n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u5728\u811a\u672c\u5185\u90e8\u5b9a\u4e49\u7684\u53d8\u91cf <code>DIR</code> \u53ea\u5728 <code>local_var</code> \u811a\u672c\u5185\u53ef\u4ee5\u4f7f\u7528\uff0c\u5728\u5168\u5c40\u4e0b\u6ca1\u6709\u6b64\u53d8\u91cf\uff0c\u540e\u671f\u6211\u4eec\u5b66\u5230\u51fd\u6570\u518d\u6765\u8bf4\u660e\u51fd\u6570\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#42","title":"4.2 \u73af\u5883\u53d8\u91cf","text":"<p>\u73af\u5883\u53d8\u91cf\u4e3a\u5f53\u524d Shell \u4e2d\u5b9a\u4e49\u7684\u4e34\u65f6\u53d8\u91cf\uff0c\u5728\u5f53\u524d Shell \u5b9a\u4e49\u7684\u53d8\u91cf\u53ef\u4ee5\u4f20\u9012\u7ed9\u5b50 Shell\uff0c\u6ca1\u6709\u7236\u5b50\u5173\u7cfb\u7684 Shell \u4e0d\u80fd\u4f7f\u7528\u6b64\u53d8\u91cf\uff0c\u5f53\u7136\u53ef\u4ee5\u5229\u7528 <code>export</code> \u5c06\u5f53\u524d Shell \u7684\u53d8\u91cf\u4f20\u9012\u7ed9\u5176\u4ed6\u7ec8\u7aef\u7684 Shell \u4e2d\u3002</p> <p>\u5f53\u524d Shell \u4e3a\u7236 Shell\uff0c\u5728\u5176\u4e0a\u8fd0\u884c <code>bash</code> \u5c31\u53ef\u4ee5\u8fdb\u5165\u5230\u5b50 Shell \u4e2d\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u793a\u4f8b</p> <pre><code># \u5728\u5f53\u524dShell\u4e2d\u5b9a\u4e49\u53d8\u91cfSTR\n[root@master Shell]# STR=\"Shell\"                        \n[root@master Shell]# echo \"hello ${STR}\"\nhello Shell\n# \u8fd0\u884c\u547d\u4ee4bash\u8fdb\u5165\u5b50Shell\n[root@master Shell]# bash\n# \u5728\u5b50Shell\u4e2d\u67e5\u770b\u6ca1\u6709\u53d8STR\n[root@master Shell]# echo \"hello ${STR}\"\nhello \n# \u9000\u51fa\u5b50Shell\u4f1a\u5230\u7236Shell\n[root@master Shell]# exit\nexit\n# \u5229\u7528export\u5bfc\u5165\u73af\u5883\u53d8\u91cf\n[root@master Shell]# export STR=\"Shell\"\n# \u5728\u6b64\u8fdb\u5165\u5b50Shell\n[root@master Shell]# bash\n# \u67e5\u770b\u5b50Shell\u4e2d\u5df2\u7ecf\u6709\u4e86\u53d8\u91cfSTR\n[root@master Shell]# echo \"hello ${STR}\"\nhello Shell\n</code></pre> <p>\u73af\u5883\u53d8\u91cf\u4e3a\u4e34\u65f6\u7684\uff0c\u5728\u6211\u4eec\u542f\u52a8\u7ec8\u7aef\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u4ece\u7279\u5b9a\u7684\u6587\u4ef6\u4e2d\u52a0\u8f7d\u4e00\u7cfb\u5217\u73af\u5883\u53d8\u91cf\u3002</p> <p>\u7cfb\u7edf\u4e2d\u8fd8\u6709\u4e00\u4e9b\u7cfb\u7edf\u5185\u7f6e\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 <code>PATH</code>\uff0c<code>USER</code> \u7b49\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u547d\u4ee4 env \u6216 export \u6765\u67e5\u770b\u5f53\u524d Shell \u7684\u73af\u5883\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell]# env\nXDG_SESSION_ID=1276\nHOSTNAME=master\nSELINUX_ROLE_REQUESTED=\nShell=/bin/bash\nTERM=xterm\nHISTSIZE=1000\nSSH_CLIENT=61.150.11.174 55929 22\nSELINUX_USE_CURRENT_RANGE=\nSSH_TTY=/dev/pts/0\nUSER=root\n...\n\n# \u67e5\u770b\u5f53\u524dShell\n[root@master Shell]# echo $Shell\n/bin/bash\n# \u67e5\u770b\u53ef\u6267\u884c\u547d\u4ee4\u7684\u8def\u5f84\n[root@master Shell]# echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n# \u67e5\u770b\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u7528\u6237\n[root@master Shell]# echo $USER\nroot\n</code></pre> <p>linux \u7cfb\u7edf\u7684\u4e00\u4e9b\u5185\u7f6e\u53c2\u6570</p> <pre><code>$Shell      \u9ed8\u8ba4 Shel\n$HOME       \u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55\n$IFS        \u5185\u90e8\u5b57\u6bb5\u5206\u9694\u7b26\n$LANG       \u9ed8\u8ba4\u8bed\n$PATH       \u9ed8\u8ba4\u53ef\u6267\u884c\u7a0b\u5e8f\u8def\u5f84\n$PWD        \u5f53\u524d\u76ee\u5f55\n$UID        \u5f53\u524d\u7528\u6237 ID\n$USER       \u5f53\u524d\u7528\u6237\n$HISTSIZE   \u5386\u53f2\u547d\u4ee4\u5927\u5c0f\uff0c\u53ef\u901a\u8fc7 HISTTIMEFORMAT \u53d8\u91cf\u8bbe\u7f6e\u547d\u4ee4\u6267\u884c\u65f6\u95f4\n$RANDOM     \u968f\u673a\u751f\u6210\u4e00\u4e2a 0 \u81f3 32767 \u7684\u6574\u6570\n$HOSTNAME   \u4e3b\u673a\u540d\n</code></pre>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#43","title":"4.3 \u5168\u5c40\u53d8\u91cf","text":"<p>\u5168\u5c40\u53d8\u91cf\u4e3a\u5728\u5f53\u524d Shell \u8fdb\u7a0b\u4e2d\u8fd0\u884c\u7684\u811a\u672c\u90fd\u53ef\u4ee5\u4f7f\u7528\u8be5\u53d8\u91cf\uff0c\u5728 Shell \u4e2d\u9ed8\u8ba4\u5b9a\u4e49\u7684\u53d8\u91cf\u5c31\u662f\u5168\u5c40\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell]# cat global_var1.sh \n#!/bin/bash\necho \"${STR1}\"              # \u67e5\u770bSTR1\u53d8\u91cf\u7684\u5185\u5bb9\nSTR2=\"sh\"                           # \u5b9a\u4e49STR2\u53d8\u91cf\u7684\u503c\u4e3ash\n[root@master Shell]# cat global_var2.sh \n#!/bin/bash\necho \"${STR2}\"              # \u67e5\u770bSTR2\u53d8\u91cf\u7684\u5185\u5bb9\n[root@master Shell]# STR1=\"Shell\"                    \n[root@master Shell]# . ./global_var1.sh \nShell\n[root@master Shell]# . ./global_var2.sh \nsh\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u5229\u7528<code>.</code> \u6765\u8fd0\u884c Shell \u811a\u672c\uff0c\u662f\u5728\u5f53\u524d\u7528\u6237\u767b\u5f55\u7684 Shell \u7ec8\u7aef\u4e2d\u8fd0\u884c\uff0c\u5176\u53d8\u91cf\u662f\u5728\u5f53\u524d Shell \u8fdb\u7a0b\u4e2d\u53ef\u4ee5\u5171\u4eab\u7684\u3002</p>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#5","title":"5. \u5b9e\u4f8b","text":"<p>\u6211\u4eec\u901a\u8fc7\u7b80\u5355\u7f16\u5199\u4e00\u4e2a\u83b7\u53d6\u5f53\u524d\u7528\u6237\u767b\u5f55\u4fe1\u606f\u7684\u811a\u672c\uff0c\u6765\u5c55\u793a\u76ee\u524d\u767b\u5f55\u7528\u6237\u7684\u4fe1\u606f</p> <pre><code>[root@master Shell_var]# cat login_info.sh  \n#!/bin/bash\n# Description: login info scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: show user info\n# Date: 2020-03-08 13:36\n# Version: 1.0\n\necho \"\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u7528\u4e3a:  ${USER}\"\necho \"\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u65f6\u95f4:  $(date +\"%Y-%m-%d %H:%M:%S\")\"\necho \"\u5f53\u524d\u767b\u5f55\u7cfb\u7edfShell: ${Shell}\"\necho \"\u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55\u4e3a:  ${HOME}\"\n\n# \u8fd0\u884c\u811a\u672c\u67e5\u770b\u5185\u5bb9\n[root@master Shell_var]# bash login_info.sh \n\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u7528\u4e3a:  root\n\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u65f6\u95f4:  2020-03-08 12:16:04\n\u5f53\u524d\u767b\u5f55\u7cfb\u7edfShell: /bin/bash\n\u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55\u4e3a:  /root\n</code></pre>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#6","title":"6. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5728\u5f15\u7528\u53d8\u91cf\u662f\u6211\u4eec\u9075\u5b88\u89c4\u8303\uff0c\u5e26\u4e0a <code>{}</code>\uff0c\u53ef\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u9ebb\u70e6\u548c\u5751\uff1b</li> <li>\u547d\u540d\u53d8\u91cf\u89c1\u540d\u77e5\u610f\uff0c\u5f62\u6210\u6709\u81ea\u5df1\u4e00\u5957\u7684\u547d\u540d\u89c4\u8303\uff1b</li> <li>\u5b66\u4e60 Shell \u9700\u8981\u591a\u52a8\u624b\u5b9e\u8df5\uff0c\u5c06\u53d8\u91cf\u7684\u4e09\u79cd\u7c7b\u578b\u901a\u8fc7\u5b9e\u8df5\u771f\u6b63\u7406\u89e3\uff0c\u540e\u671f\u5728\u7f16\u5199 Shell \u7684\u65f6\u5019\u53ef\u4ee5\u7075\u6d3b\u8fd0\u7528\u3002</li> </ul>"},{"location":"linux/shell/2.Shell%E5%8F%98%E9%87%8F/#7","title":"7. \u5c0f\u7ed3","text":"<p>\u53d8\u91cf\u5728\u6211\u4eec Shell \u7f16\u7a0b\u4e2d\u7684\u6709\u8fd9\u72ec\u7279\u7684\u5730\u4f4d\uff0c\u5176\u5c06\u6211\u4eec\u7684\u4e00\u4e9b\u6570\u636e\u901a\u8fc7\u4e00\u6b21\u6027\u7684\u8d4b\u503c\uff0c\u5927\u5927\u589e\u5f3a\u4e86\u811a\u672c\u7684\u7075\u6d3b\u6027\u4e0e\u540e\u671f\u53ef\u7ef4\u62a4\u6027\u3002\u6211\u4eec\u9700\u8981\u901a\u8fc7\u672c\u7ae0\u8282\u5145\u5206\u7406\u89e3 Shell \u7684\u57fa\u672c\u64cd\u4f5c\u53ca\u5176\u79cd\u7c7b\uff0c\u5728\u7f16\u5199 Shell \u4e2d\u7075\u6d3b\u8fd0\u7528\uff0c\u9075\u5faa\u5b9a\u4e49\u53ca\u4f7f\u7528\u89c4\u8303\uff0c\u53ef\u4ee5\u4f7f\u5f97\u6211\u4eec\u7f16\u5199\u7684 Shell \u66f4\u52a0\u53cb\u597d\u53ca\u5065\u58ee\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/","title":"3.Shell \u53c2\u6570","text":""},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#1-shell","title":"1. Shell \u53c2\u6570\u6982\u8ff0","text":"<p>\u5728 Shell \u811a\u672c\u7f16\u5199\u4e2d\uff0c\u6211\u4eec\u4e3a\u4e86\u4f7f\u5f97\u7a0b\u5e8f\u7075\u6d3b\u548c\u65e0\u72b6\u6001\uff0c\u6709\u4e9b\u53d8\u91cf\u6211\u4eec\u4e0d\u4fbf\u4e8e\u5728\u811a\u672c\u4e2d\u5199\u6b7b\uff0c\u9700\u8981\u8fd0\u7528\u5916\u90e8\u53c2\u6570\u4f20\u9012\u8fdb\u53bb\uff0c\u6bcf\u6b21\u4f20\u9012\u7684\u4e1c\u897f\u4e0d\u4e00\u6837\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e5f\u4e0d\u5c3d\u76f8\u540c\uff0c\u53c2\u6570\u662f\u4e0e\u53d8\u91cf\u76f8\u8f85\u76f8\u6210\u7684\uff0c\u5c06\u53c2\u6570\u4f20\u9012\u8fdb Shell \u811a\u672c\u4e2d\uff0c\u4e5f\u5c31\u6210\u4e86\u53d8\u91cf\uff0c\u53c2\u6570\u7684\u4f7f\u7528\u4f7f\u5f97\u6211\u4eec\u7684\u811a\u672c\u66f4\u52a0\u7684\u7075\u6d3b\u548c\u53ef\u6269\u5c55\uff0c\u540c\u6837\u4e5f\u66f4\u6613\u7ef4\u62a4\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#11-shell","title":"1.1 Shell \u53c2\u6570\u662f\u4ec0\u4e48","text":"<p>Shell \u53c2\u6570\u662f\u6211\u4eec\u5728\u811a\u672c\u6587\u4ef6\u5916\u90e8\u4f20\u5165\u7684\u4e00\u7cfb\u5217\u53c2\u6570\uff0c\u6216\u662f\u5728 Shell \u811a\u672c\u4e2d\u7ed9\u51fd\u6570\u4f20\u9012\u7684\u53c2\u6570\uff0c\u5176\u5b9e\u8d28\u4e5f\u5c31\u662f\u4e0a\u4e00\u8282\u6211\u4eec\u5b66\u4e60\u7684\u53d8\u91cf\uff0c\u5176\u4e0e\u53d8\u91cf\u76f8\u8f85\u76f8\u6210\uff0c\u5171\u540c\u7ec4\u6210 Shell \u811a\u672c\u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u53c2\u6570","text":"<p>\u6211\u4eec\u5728\u53d8\u91cf\u4e00\u8282\u77e5\u9053\u4e86\u4e3a\u4ec0\u4e48\u5229\u7528\u53d8\u91cf\uff0c\u5728\u6b64\u539f\u56e0\u4e0e\u53d8\u91cf\u7c7b\u4f3c\uff0c\u53c2\u6570\u7684\u4f7f\u7528\u4f7f\u5f97\u6211\u4eec\u7684 Shell \u811a\u672c\u66f4\u52a0\u7075\u6d3b\uff0c\u4e0d\u9700\u8981\u5728\u811a\u672c\u4e2d\u5199\u6b7b\u4e00\u4e9b\u540d\u79f0\uff0c\u6839\u636e\u7528\u6237\u7684\u8f93\u51fa\u5b8c\u6210\u7279\u5b9a\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u7f16\u5199\u811a\u672c\u8ba1\u7b97 100 \u5185\u6570\u5b57\u7684\u548c\uff0c\u4f46\u662f\u5982\u679c\u4e3a\u4eec\u60f3\u8ba1\u7b97 1000 \u5462\uff1f100000 \u5462\uff1f\u6bcf\u6b21\u90fd\u9700\u8981\u4fee\u6539\u811a\u672c\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u53c2\u6570\u4f20\u9012\u8fdb\u8ba1\u7b97\u811a\u672c\u4e2d\uff0c\u8fd9\u6837\u9700\u8981\u8ba1\u7b97\u591a\u5c11\u5c31\u53c8\u6211\u4eec\u81ea\u5df1\u63a7\u5236\uff0c\u8fd9\u6837\u7684\u811a\u672c\u4e5f\u66f4\u52a0\u7075\u6d3b\uff0c\u53c2\u6570\u8d4b\u4e88\u811a\u672c\u66f4\u5f3a\u5927\u7684\u529f\u80fd\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#2-shell","title":"2. Shell \u53c2\u6570\u5206\u7c7b","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 Shell \u4e2d\u53c2\u6570\u662f\u4ec0\u4e48\uff0c\u6765\u770b\u4e00\u4e0b Shell \u811a\u672c\u4e2d\u53c2\u6570\u7684\u5206\u7c7b\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#21","title":"2.1 \u4f4d\u7f6e\u53c2\u6570","text":"<p>\u4f4d\u7f6e\u53c2\u6570\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u4f20\u9012\u7ed9\u811a\u672c\u53c2\u6570\u7684\u4f4d\u7f6e\uff0c\u4f8b\u5982\u7ed9\u4e00\u4e2a\u811a\u672c\u4f20\u9012\u4e00\u4e2a\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 Shell \u811a\u672c\u5185\u90e8\u83b7\u53d6\u4f20\u5165\u7684\u4f4d\u7f6e\u53c2\u6570\uff0c\u83b7\u53d6\u53c2\u6570\u7684\u683c\u5f0f\u4e3a\uff1a<code>$n</code>\u3002n \u4ee3\u8868\u4e00\u4e2a\u6570\u5b57\u3002\u4f8b\u5982\u4f20\u9012\u7ed9\u811a\u672c\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c31\u4e3a <code>$1</code>\uff0c\u7b2c 2 \u4e2a\u53c2\u6570\u5c31\u4e3a <code>$2</code>, \u4ee5\u6b64\u7c7b\u63a8\u2026\u2026\uff0c\u5176\u4e2d <code>$0</code> \u4e3a\u8be5\u811a\u672c\u7684\u540d\u79f0\u3002</p> <p>\u5728\u6211\u4eec\u8bb2\u89e3\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u53d8\u91cf\u7684\u4e00\u6761\u89c4\u8303\u5c31\u662f\u540d\u5b57\u4e0d\u80fd\u4ee5\u6570\u5b57\u5f00\u5934\uff0c\u5728\u6b64\u5c31\u662f\u4e3a\u4e86\u907f\u514d\u4e0e Shell \u7684\u4f4d\u7f6e\u53c2\u6570\u76f8\u540c\u5f15\u53d1\u5f02\u5e38\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell_args]# cat args1.sh \n#!/bin/bash\n\necho \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: $1\"\necho \"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: $2\"\necho \"\u811a\u672c\u540d\u79f0\u4e3a: $0\"\n\n[root@master Shell_args]# bash args1.sh Shell linux\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: Shell\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: linux\n\u811a\u672c\u540d\u79f0\u4e3a: args1.sh\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4f20\u9012\u7ed9 <code>args1.sh</code> \u811a\u672c\u4e24\u4e2a\u4f4d\u7f6e\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u4e3a <code>python</code>, \u7b2c\u4e8c\u4e2a\u4e3a <code>go</code>, \u811a\u672c\u540d\u79f0\u4e3a <code>args1.sh</code></p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#22","title":"2.2 \u7279\u6b8a\u53c2\u6570","text":"<p>\u5728 Shell \u4e2d\u4e5f\u5b58\u5728\u7279\u6b8a\u542b\u4e49\u7684\u53c2\u6570\u5982\u4e0b\u8868\uff1a</p> \u53d8\u91cf \u542b\u4e49 $# \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u53c2\u6570\u4e2a\u6570\u603b\u548c $* \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6240\u6709\u7684\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u4e00\u4e2a\u5b57\u7b26\u4e32 $@ \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u72ec\u7acb\u7684\u5b57\u7b26\u4e32 $? \u4e0a\u4e2a\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\uff0c\u6216\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c0 \u4e3a\u6267\u884c\u6210\u529f\uff0c\u975e 0 \u5219\u4e3a\u6267\u884c\u5931\u8d25 $$ \u5f53\u524d Shell \u8fdb\u7a0b ID\u3002\u5bf9\u4e8e Shell \u811a\u672c\uff0c\u5c31\u662f\u8fd9\u4e9b\u811a\u672c\u6240\u5728\u7684\u8fdb\u7a0b ID\u3002 <p>\u793a\u4f8b\uff1a</p> <pre><code>[root@master Shell_args]# cat args2.sh                 \n#!/bin/bash\n\necho \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: $1\"\necho \"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: $2\"\necho \"\u811a\u672c\u540d\u79f0\u4e3a: $0\"\necho \"\u811a\u672c\u63a5\u53d7\u53c2\u6570\u603b\u6570\u4e3a: $#\"\n\ncurl -I baidu.com\necho \"\u8fd0\u884c\u547d\u4ee4\u7684\u72b6\u6001\u4e3a:$?\"\n\necho \"\u811a\u672c\u7684ID\u4e3a:$$\"\n\necho \"\\$*\u7684\u7ed3\u679c\u4e3a:$*\"\necho \"\\$@\u7684\u7ed3\u679c\u4e3a:$@\"\n\nfor i in \"$*\";\ndo\n        echo $i\ndone\n\nfor j in \"$@\";\ndo \n        echo $j\ndone\n\n# \u8fd0\u884c\u811a\u672c\u6765\u8fdb\u884c\u6d4b\u8bd5\n[root@master Shell_args]# bash args2.sh go python Shell\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: go\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: python\n\u811a\u672c\u540d\u79f0\u4e3a: args2.sh\n\u811a\u672c\u63a5\u53d7\u53c2\u6570\u603b\u6570\u4e3a: 3\nHTTP/1.1 200 OK\nDate: Sun, 08 Mar 2020 07:32:22 GMT\nServer: Apache\nLast-Modified: Tue, 12 Jan 2010 13:48:00 GMT\nETag: \"51-47cf7e6ee8400\"\nAccept-Ranges: bytes\nContent-Length: 81\nCache-Control: max-age=86400\nExpires: Mon, 09 Mar 2020 07:32:22 GMT\nConnection: Keep-Alive\nContent-Type: text/html\n\n\u8fd0\u884c\u547d\u4ee4\u7684\u72b6\u6001\u4e3a:0\n\u811a\u672c\u7684ID\u4e3a:23333\n$*\u7684\u7ed3\u679c\u4e3a:go python Shell\n$@\u7684\u7ed3\u679c\u4e3a:go python Shell\ngo python Shell\ngo\npython\nShell\n</code></pre> <p>\u6211\u4eec\u80fd\u591f\u901a\u8fc7\u4e0a\u8ff0\u4f8b\u5b50\u770b\u51fa\uff0c\u8fd0\u884c <code>curl -I baidu.com</code> \u7684\u8f93\u51fa\u4e3a 0\uff0c\u5373\u4e3a\u547d\u4ee4\u8fd0\u884c\u6b63\u5e38\uff0c\u83b7\u53d6\u5230\u4e86\u6b63\u5e38\u7684\u8fd4\u56de\u503c\uff1b</p> <p><code>$@</code>\u4e0e <code>$*</code> \u770b\u4e0a\u53bb\u5f88\u50cf\uff0c\u90fd\u662f\u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff1b</p> <p><code>$*</code> \u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6240\u6709\u7684\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u7528 for \u5faa\u73af\u904d\u5386\u7684\u65f6\u5019\u53ef\u4ee5\u770b\u5230\u8f93\u51fa\u4e3a\u4e00\u884c\uff1b</p> <p><code>$@</code>\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u72ec\u7acb\u7684\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u7528 for \u5faa\u73af\u904d\u5386\u7684\u65f6\u5019\u53ef\u4ee5\u770b\u5230\u4e3a\u6bcf\u4e2a\u5b57\u7b26\u4e32\u8f93\u51fa\u4e3a\u5355\u72ec\u7684\u4e00\u884c\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#3-shell","title":"3. Shell \u53c2\u6570\u7684\u4f7f\u7528","text":""},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#31","title":"3.1 \u811a\u672c\u4f20\u9012","text":"<p>\u811a\u672c\u4f20\u9012\u53c2\u6570\uff0c\u5c31\u662f\u5728\u8fd0\u884c\u811a\u672c\u7684\u65f6\u5019\u901a\u8fc7\u4f4d\u7f6e\u53c2\u6570\u4f20\u9012\u8fdb\u811a\u672c\u5185\uff0c\u6bcf\u4e2a\u53c2\u6570\u5229\u7528\u4e00\u4e2a\u7a7a\u683c\u6765\u8fdb\u884c\u5206\u5272\uff0c\u5982\u679c\u4f20\u9012\u7684\u53c2\u6570\u672c\u8eab\u5c31\u6709\u7a7a\u683c\uff0c\u5219\u53ef\u4ee5\u5229\u7528 <code>\"\"</code> \u6765\u5f15\u8d77\u6765\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u4f20\u9012\uff0c\u5728\u811a\u672c\u5185\u901a\u8fc7 <code>$n</code> \u6765\u83b7\u53d6\u3002</p> <pre><code>[root@master Shell_args]# cat args1.sh \n#!/bin/bash\n\necho \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: $1\"\necho \"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: $2\"\necho \"\u811a\u672c\u540d\u79f0\u4e3a: $0\"\n\n[root@master Shell_args]# bash args1.sh go \"python Shell java\"\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: go\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: python Shell java\n\u811a\u672c\u540d\u79f0\u4e3a: args1.sh\n</code></pre> <p>\u4f8b\u5982\u6211\u4eec\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u4e00\u4e2a\u5e26\u6709\u7a7a\u683c\u7684\u591a\u4e2a\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\u4f5c\u4e3a\u4e00\u4e2a\u4f4d\u7f6e\u53c2\u6570\u8fdb\u884c\u4f20\u5165\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#32","title":"3.2 \u51fd\u6570\u4f20\u9012","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u53c2\u6570\u4f20\u9012\u5c31\u662f\u5728\u51fd\u6570\u5916\u90e8\u8fdb\u884c\u53c2\u6570\u7684\u4f20\u5165\uff0c\u7531\u4e8e\u51fd\u6570\u90e8\u5206\u5728\u540e\u7eed\u6709\u4e13\u95e8\u7ae0\u8282\u8be6\u89e3\uff0c\u5728\u6b64\u6211\u4eec\u5c31\u4ee5\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\u8fdb\u884c\u8bf4\u660e\u3002\u51fd\u6570\u4f20\u9012\u4e0e\u811a\u672c\u4f20\u9012\u975e\u5e38\u7c7b\u4f3c\uff0c\u53ea\u662f\u5728\u8c03\u7528\u51fd\u6570\u7684\u65f6\u5019\u8fdb\u884c\u4f20\u9012\u4f4d\u7f6e\u53c2\u6570\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master Shell_args]# cat args_fun.sh \n#!/bin/bash\n# \u51fd\u6570\u5b9a\u4e49\nfunction show_args() {\n        echo \"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: $1\"\n        echo \"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: $2\"\n        echo \"\u811a\u672c\u540d\u79f0\u4e3a: $0\"\n}\n\n# \u51fd\u6570\u8c03\u7528\nshow_args go Shell\n[root@master Shell_args]# bash args_fun.sh \n\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: go\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: Shell\n\u811a\u672c\u540d\u79f0\u4e3a: args_fun.sh\n</code></pre> <p>\u5728\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6ca1\u6709\u901a\u8fc7\u5728\u811a\u672c\u5916\u90e8\u8fdb\u884c\u53c2\u6570\u4f20\u9012\uff0c\u800c\u662f\u5728\u8c03\u7528 <code>show_args</code> \u51fd\u6570\u7684\u65f6\u5019\u4f20\u5165\u6765\u4e24\u4e2a\u53c2\u6570\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#4","title":"4. \u5b9e\u4f8b","text":""},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#41","title":"4.1 \u9700\u6c42","text":"<p>\u6211\u4eec\u6765\u505a\u4e00\u4e2a\u5185\u7f51\u6279\u91cf\u626b\u63cf\u53ef\u7528 IP \u811a\u672c\uff0c\u7528\u6765\u5224\u65ad\u67d0\u4e00\u4e2a\u7f51\u6bb5\u4e2d\u7684\u7f51\u7edc\u53ef\u8fbe\u6027\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#42","title":"4.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>ping</code> \u547d\u4ee4\u6765\u68c0\u6d4b\u53ef\u4ee5 ping \u901a\u7684 IP\uff0c\u5c06\u8fd4\u56de\u6b63\u5e38\u7684\u5185\u5165\u8bb0\u5f55\u5728 <code>success.log</code> \u4e2d\uff0c\u5931\u8d25\u7684\u5185\u5bb9\u8bb0\u5f55\u5728 <code>fail.log</code> \u4e2d\u3002</p> <p>\u4f20\u9012\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u7f51\u7edc\u524d\u7f00\uff0c\u4f8b\u5982 <code>192.168.0.</code>\uff0c\u7136\u540e\u5728\u811a\u672c\u5185\u90e8\u5faa\u73af <code>1-255</code> \u6765\u68c0\u6d4b\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a ping \u5305\u7684\u4e2a\u6570\uff0c\u5982\u679c\u5305\u592a\u591a\uff0c\u65f6\u95f4\u82b1\u8d39\u592a\u957f\uff0c\u592a\u77ed\u6709\u53ef\u80fd\u9020\u6210\u8bef\u5224\uff0c\u5728\u6b64\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 2 \u4e2a\u5305\u6765\u5224\u65ad\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#43","title":"4.3 \u5b9e\u73b0","text":"<pre><code>[root@master Shell_args]# cat ping.sh \n#!/bin/bash\n# Description: net check scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: net check\n# Date: 2020-03-08 14:00\n# Version: 1.0\n\n# \u65e5\u5fd7\u76ee\u5f55\nLOG_DIR=\"/tmp/netlog/\"\n# \u5982\u679c\u65e5\u5fd7\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u521b\u5efa\n[ ! -d ${LOG_DIR} ] &amp;&amp; mkdir -p ${LOG_DIR}\n# \u5b9a\u4e49\u6210\u529f\u4e0e\u5931\u8d25\u65e5\u5fd7\u6587\u4ef6\nSUCCESS_LOGFILE=\"success.log\"\nFAIL_LOGFILE=\"fail.log\"\n\n# \u7f51\u7edc\u524d\u7f00\nNET_PREFIX=$1\n# \u68c0\u6d4b\u5305\u6570\u91cf\nPACKAGE_NUM=$2\n\n\nfor num in `seq 1 255`;\ndo\n        # \u8fdb\u884cping\u68c0\u6d4b\n        echo \"check ${NET_PREFIX}${num}...\"\n        ping -c ${PACKAGE_NUM} ${NET_PREFIX}${num} &amp;&gt;/dev/null\n        # \u5982\u679c\u8fd4\u56de\u6b63\u5e38\u5219\u8bb0\u5f55\u53ef\u4ee5ping\u901a\u7684ip\u5230successlog\u4e2d\n        [ $? -eq 0 ] &amp;&amp; echo ${NET_PREFIX}${num} &gt;&gt; ${LOG_DIR}${SUCCESS_LOGFILE} || echo ${NET_PREFIX}${num} &gt;&gt; ${LOG_DIR}${SUCCESS_LOGFILE}\ndone\n\n\n# \u6d4b\u8bd5\n[root@master Shell_args]# bash ping.sh 172.16.60. 2\ncheck 172.16.60.1...\ncheck 172.16.60.2...\ncheck 172.16.60.3...\ncheck 172.16.60.4...\ncheck 172.16.60.5...\ncheck 172.16.60.6...\n</code></pre> <p>\u5f53\u811a\u672c\u8fd0\u884c\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u5728 <code>/tmp/netlog/</code> \u76ee\u5f55\u4e0b\u67e5\u770b\u6210\u529f\u4e0e\u5931\u8d25\u7684 IP \u4fe1\u606f\u3002</p>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#5","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u9700\u8981\u5728\u5b9e\u6218\u4e2d\u7406\u89e3\u53c2\u6570\u7684\u7279\u6b8a\u7528\u5904\uff0c\u5728\u7f16\u5199\u811a\u672c\u4e2d\u5c3d\u53ef\u80fd\u591a\u7528\u53c2\u6570\uff0c\u4f7f\u5f97\u811a\u672c\u65e0\u72b6\u6001\uff1b</li> <li>\u9700\u8981\u7406\u89e3 <code>$@</code>\u4e8e <code>$*</code> \u4e24\u4e2a\u7684\u4e0d\u540c\u4e4b\u5904\uff0c\u5728\u4f7f\u7528\u5faa\u73af\u7684\u65f6\u5019\u9700\u8981\u683c\u5916\u6ce8\u610f\uff1b</li> <li>\u5728\u5229\u7528\u4f4d\u7f6e\u53c2\u6570\u4f20\u5165\u811a\u672c\u7684\u65f6\u5019\uff0c\u6700\u597d\u5229\u7528\u53d8\u91cf\u53bb\u63a5\u6536\u4f20\u9012\u7684\u5916\u90e8\u4f4d\u7f6e\u53c2\u6570\uff0c\u4fbf\u4e8e\u6211\u4eec\u5728\u811a\u672c\u5185\u8bc6\u522b\u53c2\u6570\u7684\u5177\u4f53\u542b\u4e49\u3002</li> </ul>"},{"location":"linux/shell/3.Shell%E5%8F%82%E6%95%B0/#6","title":"6. \u5c0f\u7ed3","text":"<p>\u53c2\u6570\u4e0e\u53d8\u91cf\u662f\u76f8\u8f85\u76f8\u6210\u7684\uff0c\u5c06\u53d8\u91cf\u4f20\u9012\u8fdb\u811a\u672c\u6216\u51fd\u6570\u5c31\u4e3a\u53c2\u6570\uff0c\u811a\u672c\u4e0e\u53d8\u91cf\u914d\u5408\u4f7f\u5f97\u6211\u4eec\u7684\u811a\u672c\u66f4\u52a0\u901a\u7528\uff0c\u9002\u5e94\u66f4\u5e7f\u7684\u9700\u6c42\u3002\u9700\u8981\u7262\u8bb0\u7279\u6b8a\u53c2\u6570\u7684\u5f62\u5f0f\uff0c\u5728\u540e\u671f\u7684 Shell \u7f16\u7a0b\u4e2d\uff0c\u8fd9\u4e9b\u53c2\u6570\u662f\u811a\u672c\u7f16\u7a0b\u7684\u57fa\u77f3\uff0c\u53ea\u6709\u57fa\u7840\u7262\u9760\uff0c\u540e\u7eed\u7684\u4f7f\u7528\u624d\u4f1a\u5f97\u5fc3\u5e94\u624b\uff0c\u5bf9\u4e0a\u8ff0\u7684\u4f8b\u5b50\u53ef\u4ee5\u4e3e\u4e00\u53cd\u4e09\uff0c\u4f8b\u5982\u63a2\u6d4b\u67d0\u4e00\u4e2a IP \u7684\u6240\u6709\u7aef\u53e3\u662f\u5426\u5f00\u653e\u7b49\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\u719f\u6089\u5404\u79cd\u53c2\u6570\u7684\u7528\u6cd5\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/","title":"4.Shell\u6570\u7ec4","text":""},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#4shell","title":"4.Shell \u6570\u7ec4","text":""},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#1-shell","title":"1. Shell \u6570\u7ec4\u6982\u8ff0","text":"<p>\u6211\u4eec\u5b66\u4e60\u4e86\u53d8\u91cf\uff0c\u77e5\u9053\u4e86\u53d8\u91cf\u4e3a\u5b58\u50a8\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5c0f\u5355\u5143\uff0c\u672c\u8282\u6211\u4eec\u6765\u5b66\u4e60\u6570\u7ec4\u6765\u5b58\u653e\u591a\u4e2a\u5143\u7d20\u7684\u96c6\u5408\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#11-shell","title":"1.1 Shell \u6570\u7ec4\u662f\u4ec0\u4e48","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u6570\u7ec4\u5c31\u662f\u4e00\u7cfb\u5217\u6570\u636e\u7684\u96c6\u5408\uff0c\u8fd9\u4e2a\u6570\u636e\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u5b66\u4e60\u7684\u5b58\u50a8\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5c0f\u5355\u5143\u53d8\u91cf\uff0c\u4e5f\u5c31\u662f\u8bf4\u5c06\u4e00\u4e9b\u5217\u7684\u5143\u7d20\u6574\u5408\u5230\u4e00\u4e2a\u96c6\u5408\u5185\uff0c\u8fd9\u4e2a\u96c6\u5408\u7684\u540d\u79f0\u5c31\u53eb\u6570\u7ec4\u3002\u5f53\u7136\u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0c\u6570\u7ec4\u5177\u5907\u51e0\u4e2a\u6761\u4ef6\uff0c\u5728 Shell \u4e2d\u6570\u7ec4\u4ec5\u652f\u6301\u4e00\u7ef4\u6570\u7ec4\uff0c\u6570\u7ec4\u5143\u7d20\u7684\u4e0b\u6807\u4ece 0 \u5f00\u59cb\uff0c\u6570\u7ec4\u5143\u7d20\u6ca1\u6709\u6700\u5927\u9650\u5236\u7b49\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u6570\u7ec4","text":"<p>\u4e0e\u53d8\u91cf\u7c7b\u4f3c\uff0c\u5f53\u6211\u4eec\u64cd\u4f5c\u6279\u91cf\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e00\u4e2a\u4e00\u4e2a\u53d8\u91cf\u64cd\u4f5c\u975e\u5e38\u4e0d\u4fbf\uff0c\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6570\u7ec4\u96c6\u5408\uff0c\u5bf9\u6574\u4e2a\u6570\u7ec4\u96c6\u5408\u8fdb\u884c\u904d\u5386\u6216\u5176\u4ed6\u64cd\u4f5c\uff0c\u6700\u7ec8\u5b9e\u73b0\u6279\u91cf\u7684\u6548\u679c\uff0c\u6570\u7ec4\u4f7f\u5f97\u6211\u4eec\u7684\u811a\u672c\u66f4\u5177\u6269\u5c55\u6027\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#13","title":"1.3 \u53d8\u91cf\u4e0e\u6570\u7ec4\u7684\u5dee\u5f02","text":"<p>\u53d8\u91cf\u662f\u5b58\u50a8\u5355\u4e2a\u6570\u636e\u7684\u5355\u5143\uff0c\u5176\u5728\u5185\u5b58\u4e2d\u662f\u968f\u673a\u5b58\u50a8\u7684\uff0c\u6570\u7ec4\u662f\u5b58\u50a8\u4e00\u7cfb\u5217\u6570\u636e\u7684\u96c6\u5408\uff0c\u662f\u4e8b\u5148\u5728\u5185\u5b58\u4e2d\u5f00\u8f9f\u8fde\u7eed\u7684\u4e00\u7cfb\u5217\u7a7a\u95f4\uff0c\u4e4b\u540e\u5c06\u6570\u7ec4\u5143\u7d20\u6709\u5e8f\u7684\u5b58\u50a8\u5728\u5176\u4e2d\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#2","title":"2. \u6570\u7ec4\u7684\u57fa\u672c\u4f7f\u7528","text":""},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#21","title":"2.1 \u6570\u7ec4\u7684\u5b9a\u4e49","text":"<p>\u6570\u7ec4\u7684\u5b9a\u4e49\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u53ef\u5206\u4e3a\u76f4\u63a5\u5b9a\u4e49\u548c\u5355\u5143\u7d20\u5b9a\u4e49\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#211","title":"2.1.1 \u76f4\u63a5\u5b9a\u4e49","text":"<p>\u6570\u7ec4\u7c7b\u4f3c\u4e8e\u53d8\u91cf\u5b9a\u4e49\uff0c\u53ea\u4e0d\u8fc7\u5c06\u91cc\u9762\u7684\u503c\u7528\u5c0f\u62ec\u53f7\u62ec\u8d77\u6765\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5143\u7d20\u4f7f\u7528\u7a7a\u683c\u5206\u5272\u3002Shell \u662f\u5f31\u7c7b\u578b\u7684\uff0c\u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u7c7b\u578b\u53ef\u4ee5\u4e0d\u4e00\u6837\uff0c\u4f8b\u5982\u5176\u4e2d\u53ef\u4ee5\u5305\u542b\u6570\u5b57\u4e0e\u5b57\u7b26\u4e32\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>ARG1=(1 2 3 \"hello Shell\")\n</code></pre> <p><code>ARG1</code> \u4e3a\u6570\u7ec4\u540d\u79f0\uff0c\u5176\u503c\u524d\u4e09\u4e2a\u4e3a\u6570\u5b57\uff0c\u6700\u540e\u4e00\u4e2a\u4e3a\u5b57\u7b26\u4e32\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#212","title":"2.1.2 \u5355\u5143\u7d20\u5b9a\u4e49","text":"<p>Shell \u4e2d\u6570\u7ec4\u4e0b\u6807\u4ece 0 \u5f00\u59cb\uff0c\u5229\u7528\u5355\u4e2a\u5143\u7d20\u6765\u5b9a\u4e49\u6570\u7ec4\u3002</p> <p>\u4f8b\u5982:</p> <pre><code>[root@master scripts]# ARG2[0]=1\n[root@master scripts]# ARG2[1]=2\n[root@master scripts]# ARG2[2]=3\n[root@master scripts]# ARG2[3]=\"hello Shell\" \n</code></pre>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#22","title":"2.2 \u5143\u7d20\u83b7\u53d6","text":""},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#221","title":"2.2.1 \u83b7\u53d6\u5355\u4e2a\u5143\u7d20","text":"<p>\u4e0e\u53d8\u91cf\u7684\u5f15\u7528\u4e00\u6837\uff0c\u6570\u7ec4\u53ef\u4ee5\u83b7\u53d6\u5355\u4e2a\u4f4d\u7f6e\u7684\u5143\u7d20\uff0c\u5229\u7528 <code>${ARG[num]}</code>\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[0]}          //\u83b7\u53d6AEG1\u6570\u7ec4\u4e2d\u7b2c\u4e00\u4e2a\u5143\u7d20\n1\n[root@master scripts]# echo ${ARG1[3]}          //\u83b7\u53d6AEG1\u6570\u7ec4\u4e2d\u7b2c\u56db\u4e2a\u5143\u7d20\nhello Shell\n</code></pre>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#222","title":"2.2.2 \u83b7\u53d6\u5168\u90e8\u5143\u7d20","text":"<ul> <li>\u83b7\u53d6\u6570\u7ec4\u503c</li> </ul> <p>\u83b7\u53d6\u6570\u7ec4\u5168\u90e8\u5143\u7d20\u4f7f\u7528 <code>${ARG[*]}</code> \u6216 <code>${ARG[@]}</code>\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[@]}\n1 2 3 hello Shell\n[root@master scripts]# echo ${ARG1[*]}\n1 2 3 hello Shell\n</code></pre> <ul> <li>\u83b7\u53d6\u6570\u7ec4\u4e0b\u6807</li> </ul> <p>\u83b7\u53d6\u6570\u7ec4\u5168\u90e8\u4e0b\u6807\u4f7f\u7528 <code>${!ARG[*]}</code> \u6216 <code>${!ARG[@]}</code>\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo ${!ARG1[@]}\n0 1 2 3\n[root@master ~]# echo ${!ARG1[*]}\n0 1 2 3\n</code></pre>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#223","title":"2.2.3 \u83b7\u53d6\u6570\u7ec4\u957f\u5ea6","text":"<ul> <li>\u83b7\u53d6\u6574\u4e2a\u6570\u7ec4\u957f\u5ea6</li> </ul> <p>\u6570\u7ec4\u957f\u5ea6\u53ca\u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u4e2a\u6570\uff0c\u53ef\u4ee5\u5229\u7528 <code>${#ARG[*]}</code> \u6216 <code>${#ARG[@]}</code>\uff0c\u6211\u4eec\u53d1\u73b0\u5176\u5b9e\u5c31\u662f\u5728\u83b7\u53d6\u6570\u7ec4\u5168\u90e8\u5143\u7d20\u524d\u6dfb\u52a0<code>#</code>\u6765\u83b7\u53d6\u6570\u7ec4\u4e2a\u6570\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${#ARG1[*]}\n4\n[root@master scripts]# echo ${#ARG1[@]}\n4\n</code></pre> <ul> <li>\u83b7\u53d6\u5355\u4e2a\u5143\u7d20\u7684\u957f\u5ea6</li> </ul> <p>\u5bf9\u4e8e\u6570\u7ec4\u4e2d\u7684\u67d0\u4e2a\u5143\u6211\u4eec\u4e5f\u53ef\u4ee5\u8fdb\u884c\u957f\u5ea6\u7684\u83b7\u53d6\uff0c\u53ef\u4ee5\u5229\u7528 <code>${#ARG1[num]}</code>\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[@]} \n100 2 3 hello Shell 10\n[root@master scripts]# echo ${ARG1[3]}      //\u83b7\u53d6\u7b2c\u56db\u4e2a\u5143\u7d20\u5185\u5bb9\u4e3a\uff1ahello Shell\nhello Shell\n[root@master scripts]# echo ${#ARG1[3]}     //\u83b7\u53d6\u56db\u4e2a\u5143\u7d20\u957f\u5ea6\u4e3a11\n11\n</code></pre>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#224","title":"2.2.4 \u6570\u7ec4\u5143\u7d20\u7684\u4fee\u6539","text":"<p>\u6570\u7ec4\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9b\u5217\u5bf9\u5176\u5143\u7d20\u7684\u64cd\u4f5c\u3002</p> <ul> <li>\u4fee\u6539</li> </ul> <p>\u5bf9\u6570\u7ec4\u5143\u7d20\u7684\u4fee\u6539\uff0c\u76f4\u63a5\u5bf9\u5355\u4e2a\u5143\u7d20\u4fee\u6539\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# AEG1[0]=100\n[root@master scripts]# echo ${ARG1[@]}\n100 2 3 hello Shell\n</code></pre> <ul> <li>\u589e\u52a0</li> </ul> <p>\u5bf9\u6570\u7ec4\u5143\u7d20\u7684\u589e\u52a0\uff0c\u548c\u5bf9\u4fee\u6539\u4e00\u81f4\uff0c\u76f4\u63a5\u5bf9\u5355\u4e2a\u4f4d\u7f6e\u5143\u7d20\u589e\u52a0\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# ARG1[10]=10\n[root@master scripts]# echo ${ARG1[@]}\n100 2 3 hello Shell 10\n[root@master scripts]# echo ${#ARG1[@]}\n5\n</code></pre> <p>Tips\uff1a\u5728\u6b64\u6211\u4eec\u53d1\u73b0\u5143\u7d20\u4e4b\u524d\u6709 4 \u4e2a\u5143\u7d20\uff0c\u6211\u4eec\u5c06\u4e0b\u6807 10 \u7684\u5143\u7d20\u8d4b\u503c\u4e3a 10\uff0c\u6570\u7ec4\u662f\u6309\u7167\u4ece\u524d\u5f80\u540e\u987a\u5e8f\u8d4b\u503c\u7684\u3002</p> <ul> <li>\u5220\u9664</li> </ul> <p>\u5220\u9664\u6570\u7ec4\u53ef\u4ee5\u4f7f\u7528 unset\uff0c<code>unset ARG1[num]</code> \u53ef\u4ee5\u5220\u9664\u5bf9\u5e94\u4e0b\u6807\u7684\u6570\u7ec4\u5143\u7d20\uff0c\u5982\u679c\u4e0d\u5e26\u4e0b\u6807\u5219\u5220\u9664\u6570\u7ec4\u7684\u5168\u90e8\u5143\u7d20\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[@]} \n100 3 hello Shell 10\n[root@master scripts]# unset ARG1[0]            //\u5220\u9664\u4e0b\u6807\u4e3a0\u7684\u5143\u7d20\n[root@master scripts]# echo ${ARG1[@]}\n3 hello Shell 10\n[root@master scripts]# unset ARG1           //\u5220\u9664\u6574\u4e2a\u6570\u7ec4\u5143\u7d20\n[root@master scripts]# echo ${ARG1[@]}\n</code></pre>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#225","title":"2.2.5 \u6570\u7ec4\u7684\u5207\u7247","text":"<p>\u548c\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0c\u53ef\u4ee5\u5bf9\u6570\u7ec4\u8fdb\u884c\u5207\u7247\u4e5f\u79f0\u622a\u53d6\u64cd\u4f5c\u3002\u53ef\u4ee5\u901a\u8fc7 <code>${AEG1[@\u6216*]:\u8d77\u59cb\u4f4d\u7f6e\uff1a\u957f\u5ea6}</code> \u5bf9\u539f\u6570\u7ec4\u8fdb\u884c\u5207\u7247\uff0c\u8fd4\u56de\u7684\u4e3a\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master scripts]# echo ${ARG1[@]}\n1 2 3 hello Shell\n[root@master scripts]# echo ${ARG1[@]:0:2}              //\u4ece\u7b2c1\u4e2a\u5143\u7d20\u5f80\u540e2\u4e2a\u5143\u7d20\u8fdb\u884c\u5207\u7247\n1 2\n</code></pre>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#226","title":"2.2.6 \u6570\u7ec4\u7684\u66ff\u6362","text":"<p>\u53ef\u4ee5\u66ff\u6362\u6570\u7ec4\u4e2d\u7684\u67d0\u4e00\u4e2a\u5143\u7d20\uff0c\u4f8b\u5982\u6211\u4eec\u5c06 <code>ARG1</code> \u6570\u7ec4\u4e2d\u7684\u7b2c 1 \u4e2a\u5143\u7d20\u66ff\u6362\u4e3a 110\u3002</p> <pre><code>[root@master scripts]# echo ${ARG1[@]}\n1 2 3 hello Shell\n[root@master scripts]# echo ${ARG1[@]/1/110}\n110 2 3 hello Shell\n</code></pre>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#3-shell","title":"3. Shell \u6570\u7ec4\u5206\u7c7b","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 Shell \u4e2d\u6570\u7ec4\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u6765\u770b\u4e00\u4e0b\u6570\u7ec4\u7684\u5206\u7c7b\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#31","title":"3.1 \u666e\u901a\u6570\u7ec4","text":"<p>\u666e\u901a\u6570\u7ec4\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u4ee5\u6570\u5b57\u4e3a\u4e0b\u6807\u7684\u6570\u7ec4\uff0c\u4e0a\u8ff0\u7684\u4f8b\u5b50\u90fd\u4e3a\u666e\u901a\u6570\u7ec4\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#32","title":"3.2 \u5173\u8054\u6570\u7ec4","text":"<p>\u5173\u8054\u6570\u7ec4\u662f\u53ef\u4ee5\u7528\u5b57\u7b26\u4e32\u5f53\u4f5c\u6570\u7ec4\u4e0b\u6807\u7684\u4e00\u7c7b\u6570\u7ec4\uff0c\u5728\u4f7f\u7528\u5173\u8054\u6570\u7ec4\u524d\uff0c\u5fc5\u987b\u5148\u4f7f\u7528 <code>declare -A</code> \u58f0\u660e\u5b83\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# declare -A ARGFILE                         //\u5b9a\u4e49\u7ba1\u7406\u6570\u7ec4\n[root@master ~]# ARGFILE=([name1]=Shell [name2]=linux [name3]=arg)      //\u5173\u8054\u6570\u7ec4\u5143\u7d20\u8d4b\u503c\n[root@master ~]# echo ${ARGFILE[@]}                         //\u67e5\u770b\u6240\u6709\u5143\u7d20\narg linux Shell\n[root@master ~]# echo ${ARGFILE[name1]}                 //\u67e5\u770b\u7d22\u5f15\u4e3aname1\u7684\u5143\u7d20\u503c\nShell\n</code></pre> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u5bf9\u5355\u4e2a\u5143\u7d20\u8fdb\u884c\u8d4b\u503c\u64cd\u4f5c\uff0c \u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5173\u8054\u6570\u7ec4\u5c31\u6ca1\u6709\u6392\u5e8f\u4e86\uff0c\u7c7b\u4f3c\u4e8e\u5176\u4ed6\u8bed\u8a00\u4e2d\u7684\u5b57\u5178\uff0ckey \u503c\u4e5f\u662f\u5b57\u7b26\u4e32\u5f62\u5f0f\u3002</p> <pre><code>[root@master ~]# declare -A ARGLIST\n[root@master ~]# ARGLIST[n1]=1\n[root@master ~]# ARGLIST[n2]=2\n[root@master ~]# ARGLIST[n3]=\"hello Shell\" \n[root@master ~]# echo ${ARGLIST[@]}                 //\u83b7\u53d6\u5173\u8054\u6570\u7ec4\u7684\u6240\u6709\u503c\n2 hello Shell 1\n[root@master ~]# echo ${#ARGLIST[@]}                //\u83b7\u53d6\u5173\u8054\u6570\u7ec4\u7684\u5143\u7d20\u4e2a\u6570\n3\n[root@master ~]# echo ${!ARGLIST[@]}                //\u83b7\u53d6\u5173\u8054\u6570\u7ec4\u7684\u4e0b\u6807\nn2 n3 n1\n</code></pre>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#4","title":"4. \u5b9e\u4f8b","text":""},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#41","title":"4.1 \u9700\u6c42","text":"<p>\u6211\u4eec\u60f3\u5229\u7528\u6570\u7ec4\u7edf\u8ba1 linux \u670d\u52a1\u5668\u7684\u6bcf 5 \u5206\u949f\u7684\u7f51\u7edc\u94fe\u63a5\u60c5\u51b5\uff0c\u67e5\u770b\u5904\u4e8e\u5404\u4e2a\u65f6\u95f4\u6bb5\u7684\u670d\u52a1\u5668 TCP \u94fe\u63a5\u7684\u60c5\u51b5\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#42","title":"4.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>netstat -ant</code> \u547d\u4ee4\u6765\u67e5\u770b\u7f51\u7edc\u94fe\u63a5\u60c5\u51b5\uff0c\u4f46\u662f\u8f93\u51fa\u7684\u5185\u5bb9\u6211\u4eec\u53ea\u5173\u5fc3\u6700\u540e\u4e00\u5217\u7684\u72b6\u6001\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5229\u7528 awk \u6765\u6253\u5370\u4ece\u7b2c\u4e8c\u884c\u5f00\u59cb\u5230\u6700\u540e\u4e00\u5217\u72b6\u6001\uff0c\u7531\u4e8e awk \u547d\u4ee4\u5728\u540e\u7eed\u6211\u4eec\u4f1a\u8be6\u89e3\uff0c\u5728\u6b64\u4ec5\u4f5c\u4e3a\u5de5\u5177\u4f7f\u7528\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# netstat -ant|awk 'NR&gt;2 {print $NF}'\nLISTEN\nLISTEN\nESTABLISHED\nTIME_WAIT\n</code></pre> <p>\u6253\u5370\u51fa\u6765\u7684\u5c31\u662f\u6700\u540e\u4e00\u5217\u7684\u72b6\u6001\uff0c\u6211\u4eec\u5c06\u5176\u5185\u5bb9\u4f5c\u4e3a\u6570\u7ec4\u7684\u4e0b\u6807\uff0c\u503c\u4e3a\u5176\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7edf\u8ba1 TCP \u94fe\u63a5\u5230\u72b6\u6001\uff0c\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u6765\u5b9a\u65f6\u7edf\u8ba1\u670d\u52a1\u5668\u7684 tcp \u94fe\u63a5\u72b6\u6001\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#43","title":"4.3 \u5b9e\u73b0","text":"<pre><code>[root@master Shell_args]# cat tcp_status.sh \n#!/bin/bash\n# Description: check tcp status\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: net check\n# Date: 2020-03-14 14:00\n# Version: 1.0\n\n# \u65e5\u5fd7\u76ee\u5f55\nLOG_FILE=\"/tmp/tcp_status.log\"\n\n# \u5b9a\u4e49\u7ba1\u7406\u6570\u7ec4\ndeclare -A TCP_STATUS\n\n# \u5bf9\u6570\u7ec4\u8fdb\u884c\u5185\u5bb9\u8d4b\u503c\n\n# \u5229\u7528netstat\u547d\u4ee4\u6765\u8fc7\u6ee4\u51fa\u5173\u7cfb\u7684\u4e00\u5217\u6570\u636e\nfor status in $(netstat -ant|awk 'NR&gt;2 {print $NF}')\ndo\n    # \u5bf9\u72b6\u6001\u76f8\u540c\u72b6\u6001\u7684TCP\u8fdb\u884c\u6570\u503c\u7d2f\u52a0\n    let TCP_STATUS[${status}]++\ndone\n\n# \u5c06\u7edf\u8ba1\u5b8c\u6210\u7684TCP\u94fe\u63a5\u72b6\u6001\u53ca\u6570\u636e\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\nfor i in ${!TCP_STATUS[@]}\ndo \n    echo \"$(date +%F\" \"%H:%m)  \u670d\u52a1\u5668\u7684TCP\u72b6\u6001\u4e3a: ${i} \u7684\u6570\u91cf\u4e3a: ${TCP_STATUS[${i}]}\" &gt;&gt; ${LOG_FILE}\ndone\n\n\n# \u6d4b\u8bd5\n[root@master ~]# bash tcp_status.sh \n[root@master ~]# cat /tmp/tcp_status.log \n2020-03-14 15:03  \u670d\u52a1\u5668\u7684TCP\u72b6\u6001\u4e3a: TIME_WAIT \u7684\u6570\u91cf\u4e3a: 138\n2020-03-14 15:03  \u670d\u52a1\u5668\u7684TCP\u72b6\u6001\u4e3a: ESTABLISHED \u7684\u6570\u91cf\u4e3a: 501\n2020-03-14 15:03  \u670d\u52a1\u5668\u7684TCP\u72b6\u6001\u4e3a: LISTEN \u7684\u6570\u91cf\u4e3a: 59\n</code></pre> <p>\u67e5\u770b\u6211\u4eec\u5355\u72ec\u8fd0\u884c\u811a\u672c\u5df2\u7ecf\u6210\u529f\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u811a\u672c\u52a0\u5165 crontab \u4e2d\uff0c\u6765\u5b9a\u65f6\u6267\u884c\uff0c\u540e\u671f\u5c31\u53ef\u4ee5\u901a\u8fc7\u65e5\u5fd7\u6765\u67e5\u770b\u5f53\u65f6\u670d\u52a1\u5668\u7684\u72b6\u6001\u4e86\u3002</p>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#5","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u9700\u8981\u5728\u5b9e\u6218\u4e2d\u7406\u89e3\u6570\u7ec4\u7684\u5177\u4f53\u7528\u9014\uff0c\u5c24\u5176\u6ce8\u610f\u5173\u8054\u6570\u7ec4\u7684\u7075\u6d3b\u8fd0\u7528\uff1b</li> <li>\u9700\u8981\u7406\u89e3\u6570\u7ec4\u7684\u5168\u90e8\u5143\u7d20\uff0c\u5143\u7d20\u4e0b\u6807\u4ee5\u53ca\u5143\u7d20\u7684\u5207\u7247\u548c\u66ff\u6362\uff0c\u5177\u4f53\u573a\u666f\u914d\u5408\u4f7f\u7528\uff1b</li> <li>\u6570\u7ec4\u4e00\u822c\u7528\u6765\u7edf\u8ba1\u6279\u91cf\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\u6279\u91cf\u6587\u4ef6\u7684\u8ba1\u7b97\u7b49\uff0c\u914d\u5408\u5176\u4ed6\u547d\u4ee4\u4f7f\u7528\u3002</li> </ul>"},{"location":"linux/shell/4.Shell%E6%95%B0%E7%BB%84/#6","title":"6. \u5c0f\u7ed3","text":"<p>\u6570\u7ec4\u53ef\u8c13\u4e3a\u6211\u4eec\u5728 Shell \u7f16\u7a0b\u4e2d\u63d0\u4f9b\u4e86\u96c6\u5408\u7c7b\u578b\u6570\u636e\u5b58\u50a8\u7684\u65b9\u6848\uff0c\u5bf9\u4e8e\u6279\u91cf\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u6570\u7ec4\u529f\u4e0d\u53ef\u6ca1\u3002\u5728\u5177\u4f53\u7684\u5b9e\u8df5\u4e2d\u6839\u636e\u6570\u636e\u7279\u5f81\uff0c\u660e\u786e\u9700\u6c42\u662f\u5229\u7528\u6570\u5b57\u4f5c\u4e3a\u4e0b\u6807\u7684\u6570\u7ec4\uff0c\u8fd8\u662f\u4f7f\u7528\u5173\u8054\u6570\u7ec4\uff0c\u6700\u540e\u5728\u5b9e\u8df5\u4e2d\u7075\u6d3b\u8fd0\u7528\u6570\u7ec4\u7684\u6574\u4f53\u957f\u5ea6\uff0c\u5207\u7247\uff0c\u66ff\u6362\u7b49\u64cd\u4f5c\uff0c\u914d\u5408\u5176\u4ed6\u547d\u4ee4\u5b9e\u73b0\u5177\u4f53\u4e1a\u52a1\u9700\u6c42\u3002</p>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/","title":"5.Shell \u8fd0\u7b97\u7b26","text":""},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#1-shell","title":"1. Shell \u8fd0\u7b97\u7b26\u6982\u8ff0","text":""},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#11-shell","title":"1.1 Shell \u8fd0\u7b97\u7b26\u662f\u4ec0\u4e48","text":"<p>\u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0cShell \u4e5f\u6709\u8fd0\u7b97\u7b26\uff0c\u5728 Shell \u4e2d\u5176\u6839\u636e\u7c7b\u578b\u4e0d\u540c\u4e5f\u6709\u4e0d\u5c11\u8fd0\u7b97\u7b26\u5206\u7c7b\uff0c\u90a3\u4e48\u4ec0\u4e48\u662f\u8fd0\u7b97\u7b26\u5462\uff1f\u4f8b\u5982\u5927\u5bb6\u90fd\u77e5\u9053\u5728\u7b97\u672f\u8fd0\u7b97\u4e2d\u7684\u52a0\u51cf\u4e58\u9664\uff0c<code>+</code> \u5c31\u662f\u6211\u4eec Shell \u4e2d\u7684\u7b97\u672f\u8fd0\u7b97\u7b26\u7684\u4e00\u79cd\uff0c\u5f53\u7136\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u7684\u529f\u80fd\u5404\u5f02\u7684\u8fd0\u7b97\u7b26\uff0c\u4f5c\u4e3a\u6761\u4ef6\u5224\u65ad\u4e0e\u7b97\u672f\u64cd\u4f5c\u7b49\u91cd\u8981\u529f\u80fd\uff0c\u6784\u6210\u4e86 Shell \u4e2d\u7684\u57fa\u672c\u5143\u7d20\u3002</p>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u8fd0\u7b97\u7b26","text":"<p>\u5f53\u6211\u4eec\u5bf9\u6570\u503c\u8fdb\u884c\u7b97\u672f\u8fd0\u7b97\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u6587\u4ef6\u8fdb\u884c\u5224\u65ad\uff0c\u5f53\u6211\u4eec\u9700\u8981\u591a\u903b\u8f91\u8fdb\u884c\u5224\u65ad\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u60c5\u51b5\u90fd\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7c7b\u578b\u7684\u8fd0\u7b97\u7b26\uff0c\u4f7f\u5f97\u6211\u4eec\u811a\u672c\u66f4\u4e3a\u7075\u6d3b\u4fbf\u6377\u3002</p>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#2-shell","title":"2. Shell \u8fd0\u7b97\u7b26\u5206\u7c7b","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 shell \u4e2d\u8fd0\u7b97\u7b26\u662f\u4ec0\u4e48\u53ca\u5176\u529f\u80fd\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u770b\u4e00\u4e0b Shell \u811a\u672c\u8fd0\u7b97\u7b26\u7684\u5206\u7c7b\u53ca\u6bcf\u79cd\u8fd0\u7b97\u7b26\u7684\u57fa\u672c\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#21","title":"2.1 \u7b97\u672f\u8fd0\u7b97\u7b26","text":"<p>\u7b97\u672f\u8fd0\u7b97\u7b26\u987e\u540d\u601d\u4e49\uff0c\u5176\u5c31\u662f\u8fdb\u884c\u52a0\u51cf\u4e58\u9664\u6570\u503c\u8fd0\u7b97\uff0c\u5728 shell \u4e2d\uff0cbash \u4e0d\u652f\u6301\u539f\u751f\u7684\u6570\u5b66\u8fd0\u7b97\uff0c\u9700\u8981\u5229\u7528\u7b2c\u4e09\u65b9\u5de5\u5177\u6765\u5982 <code>let</code>\uff0c<code>expr</code> \u7b49\u6765\u5b9e\u73b0\u3002</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b + \u52a0\u6cd5 <code>expr $a + $b</code> \u7ed3\u679c\u4e3a 30\u3002 - \u51cf\u6cd5 <code>expr $a - $b</code> \u7ed3\u679c\u4e3a -10\u3002 * \u4e58\u6cd5 <code>expr $a \\* $b</code> \u7ed3\u679c\u4e3a 200\u3002 / \u9664\u6cd5 <code>expr $b / $a</code> \u7ed3\u679c\u4e3a 2\u3002 % \u53d6\u4f59 <code>expr $b % $a</code> \u7ed3\u679c\u4e3a 0\u3002 = \u8d4b\u503c a=$b \u5c06\u628a\u53d8\u91cf b \u7684\u503c\u8d4b\u7ed9 a\u3002 == \u76f8\u7b49 \u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u6570\u5b57\uff0c\u76f8\u540c\u5219\u8fd4\u56de true\u3002 [$a == $b] \u8fd4\u56de false\u3002 != \u4e0d\u76f8\u7b49 \u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u6570\u5b57\uff0c\u4e0d\u76f8\u540c\u5219\u8fd4\u56de true\u3002 [$a != $b] \u8fd4\u56de true\u3002"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#211-let","title":"2.1.1 let","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>let</code> \u5bf9\u6570\u503c\u8fdb\u884c\u8fd0\u7b97\uff0c<code>let C=$A+$B</code>, \u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# A=1\n[root@master ~]# B=2\n[root@master ~]# let C=${A}+${B}\n[root@master ~]# echo $C\n3\n</code></pre> <p>\u6ce8\u610f\uff1a<code>let</code> \u8fd0\u7b97\u540e\u9700\u8981\u5c06\u5176\u8d4b\u503c\u7ed9\u4e00\u4e2a\u53d8\u91cf\u3002</p>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#212-expr","title":"2.1.2 expr","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>expr</code> \u5bf9\u6570\u7ec4\u8fdb\u884c\u8fd0\u7b97\uff0c<code>C=$(expr $A+$B)</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# C=`expr $A + $B`\n[root@master ~]# echo $C\n3\n</code></pre> <p>\u6ce8\u610f <code>+</code> \u53f7\u4e24\u8fb9\u9700\u8981\u6709\u7a7a\u683c\uff0c\u4e0d\u7136\u4f1a\u5c06\u5176\u5f53\u4f5c\u5b57\u7b26\u4e32\u8fde\u63a5</p>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#213","title":"2.1.3 []","text":"<p>\u53ef\u4ee5\u5229\u7528 <code>[]</code> \u6765\u5bf9\u6570\u503c\u8fdb\u884c\u8fd0\u7b97\uff0c<code>C=[A+B]</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# C=$[$A+$B]\n[root@master ~]# echo $C\n3\n</code></pre>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#214","title":"2.1.4 (())","text":"<p>\u5229\u7528 <code>(())</code> \u6765\u5bf9\u6570\u503c\u8fdb\u884c\u8fd0\u7b97\uff0c<code>C=$(($A+$B))</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# C=$(($A+$B))\n[root@master ~]# echo $C\n3\n</code></pre>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#22","title":"2.2 \u5173\u7cfb\u8fd0\u7b97\u7b26","text":"<p>\u4e86\u89e3\u4e86\u7b97\u672f\u8fd0\u7b97\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u5b66\u4e60\u5173\u7cfb\u8fd0\u7b97\u3002</p> \u6bd4\u8f83\u7b26 \u63cf\u8ff0 \u793a\u4f8b -eq\uff0cequal \u7b49\u4e8e [1 -eq 1] \u4e3a true -ne\uff0cnot equal \u4e0d\u7b49\u4e8e [ 1 -ne 1 \u4e3a false -gt\uff0cgreater than \u5927\u4e8e [2 -gt 1] \u4e3a true -lt\uff0clesser than \u5c0f\u4e8e [2 -lt 1] \u4e3a false -ge\uff0cgreater or equal \u5927\u4e8e\u6216\u7b49\u4e8e [2 -ge 1] \u4e3a true -le\uff0clesser or equal \u5c0f\u4e8e\u6216\u7b49\u4e8e [2 -le 1] \u4e3a false <p>\u5173\u7cfb\u8fd0\u7b97\u987e\u540d\u601d\u4e49\u5c31\u662f\u6bd4\u8f83\u6570\u5b57\u7684\u5927\u5c0f\uff0c\u6ce8\u610f\u5173\u7cfb\u8fd0\u7b97\u7b26\u4f5c\u7528\u7684\u4e3a\u6570\u5b57\uff0c\u4e0d\u80fd\u7528\u5176\u6765\u6bd4\u8f83\u5b57\u7b26\u4e32\u3002</p> <pre><code>#!/bin/bash\n\nnum1=1\nnum2=2\necho \"num1 \u4e3a\uff1a${num1}\"\necho \"num2 \u4e3a\uff1a${num2}\"\n\n\nif [ $num1 -eq $num2 ]\nthen\n   echo \"$num1 -eq $num2 : num1 \u7b49\u4e8e num2\"\nelse\n   echo \"$num1 -eq $num2: num1 \u4e0d\u7b49\u4e8e num2\"\nfi\nif [ $num1 -ne $num2 ]\nthen\n   echo \"$num1 -ne $num2: num1 \u4e0d\u7b49\u4e8e num2\"\nelse\n   echo \"$num1 -ne $num2 : num1 \u7b49\u4e8e num2\"\nfi\nif [ $num1 -gt $num2 ]\nthen\n   echo \"$num1 -gt $num2: num1 \u5927\u4e8e num2\"\nelse\n   echo \"$num1 -gt $num2: num1 \u4e0d\u5927\u4e8e num2\"\nfi\nif [ $num1 -lt $num2 ]\nthen\n   echo \"$num1 -lt $num2: num1 \u5c0f\u4e8e num2\"\nelse\n   echo \"$num1 -lt $num2: num1 \u4e0d\u5c0f\u4e8e num2\"\nfi\nif [ $num1 -ge $num2 ]\nthen\n   echo \"$num1 -ge $num2: num1 \u5927\u4e8e\u6216\u7b49\u4e8e num2\"\nelse\n   echo \"$num1 -ge $num2: num1 \u5c0f\u4e8e num2\"\nfi\nif [ $num1 -le $num2 ]\nthen\n   echo \"$num1 -le $num2: num1 \u5c0f\u4e8e\u6216\u7b49\u4e8e num2\"\nelse\n   echo \"$num1 -le $num2: num1 \u5927\u4e8e num2\"\nfi\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>num1 \u4e3a\uff1a1\nnum2 \u4e3a\uff1a2\n1 -eq 2: num1 \u4e0d\u7b49\u4e8e num2\n1 -ne 2: num1 \u4e0d\u7b49\u4e8e num2\n1 -gt 2: num1 \u4e0d\u5927\u4e8e num2\n1 -lt 2: num1 \u5c0f\u4e8e num2\n1 -ge 2: num1 \u5c0f\u4e8e num2\n1 -le 2: num1 \u5c0f\u4e8e\u6216\u7b49\u4e8e num2\n</code></pre>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#23","title":"2.3 \u5e03\u5c14\u8fd0\u7b97\u7b26","text":"<p>\u5e03\u5c14\u8fd0\u7b97\u7b26\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u4e0e\u6216\u975e</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b -a \u4e0e\u8fd0\u7b97\uff0c\u4e24\u4e2a\u8868\u8fbe\u5f0f\u90fd\u4e3a true \u624d\u8fd4\u56de true\u3002 [1 -lt 2 -a 10 -gt 2] \u8fd4\u56de true\u3002 -o \u6216\u8fd0\u7b97\uff0c\u6709\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e3a true \u5219\u8fd4\u56de true\u3002 [1 -lt 2 -o 2 -gt 10] \u8fd4\u56de true\u3002 ! \u975e\u8fd0\u7b97\uff0c\u8868\u8fbe\u5f0f\u4e3a true \u5219\u8fd4\u56de false\uff0c\u5426\u5219\u8fd4\u56de true\u3002 [! false] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\nnum1=10\nnum2=20\n\necho \"num1 \u4e3a\uff1a ${num1}\"\necho \"num2 \u4e3a\uff1a ${num2}\"\nif [ $num1 -lt 40 -a $num2 -gt 15 ];then\n   echo \"$num1 \u5c0f\u4e8e 40 \u4e14 $num2 \u5927\u4e8e 15 : \u8fd4\u56de true\"\nelse\n   echo \"$num1 \u5c0f\u4e8e 40 \u4e14 $num2 \u5927\u4e8e 15 : \u8fd4\u56de fnum1lse\"\nfi\necho \"\u6216\u8fd0\u7b97\"\nif [ $num1 -lt 40 -o $num2 -gt 40 ];then\n   echo \"$num1 \u5c0f\u4e8e 40 \u6216 $num2 \u5927\u4e8e 40 : \u8fd4\u56de true\"\nelse\n   echo \"$num1 \u5c0f\u4e8e 40 \u6216 $num2 \u5927\u4e8e 40 : \u8fd4\u56de fnum1lse\"\nfi\n\necho \"\u975e\u8fd0\u7b97\"\nif [ $num1 != $num2 ];then\n   echo \"$num1 != $num2 : num1 \u4e0d\u7b49\u4e8e num2\"\nelse\n   echo \"$num1 != $num2: num1 \u7b49\u4e8e num2\"\nfi\n</code></pre> <p>\u8fd4\u56de\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>num1 \u4e3a\uff1a 10\nnum2 \u4e3a\uff1a 20\n10 \u5c0f\u4e8e 40 \u4e14 20 \u5927\u4e8e 15 : \u8fd4\u56de true\n\u6216\u8fd0\u7b97\n10 \u5c0f\u4e8e 40 \u6216 20 \u5927\u4e8e 40 : \u8fd4\u56de true\n\u975e\u8fd0\u7b97\n10 != 20 : num1 \u4e0d\u7b49\u4e8e num2\n[root@master scripts]# vim 2.sh \n[root@master scripts]# bash 2.sh \nnum1 \u4e3a\uff1a 10\nnum2 \u4e3a\uff1a 20\n10 \u5c0f\u4e8e 40 \u4e14 20 \u5927\u4e8e 15 : \u8fd4\u56de true\n\u6216\u8fd0\u7b97\n10 \u5c0f\u4e8e 40 \u6216 20 \u5927\u4e8e 40 : \u8fd4\u56de true\n\u975e\u8fd0\u7b97\n10 != 20 : num1 \u4e0d\u7b49\u4e8e num2        \n</code></pre>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#24","title":"2.4 \u903b\u8f91\u8fd0\u7b97\u7b26","text":"<p>\u903b\u8f91\u8fd0\u7b97\u7b26\u4e3a\uff0c\u4ee5\u4e0b\u4ecb\u7ecd Shell \u7684\u903b\u8f91\u8fd0\u7b97\u7b26\uff0c\u5047\u5b9a\u53d8\u91cf A \u4e3a 1\uff0c\u53d8\u91cf b \u4e3a 2\uff1a</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b &amp;&amp; \u903b\u8f91\u7684 AND <code>[[ $A -lt 10 &amp;&amp; $B -gt 100 ]] \u8fd4\u56de false</code> || \u903b\u8f91\u7684 OR <code>[[ $A -lt 10 || $B -gt 100 ]] \u8fd4\u56de true</code> <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\n\nnum1=1\nnum2=2\n\necho \"num1 \u4e3a:${num1}\"\necho \"num2 \u4e3a:${num2}\"\n\nif [[ $num1 -lt 5 &amp;&amp; $num2 -gt 5 ]];then\n   echo \"\u8fd4\u56de true\"\nelse\n   echo \"\u8fd4\u56de false\"\nfi\n\nif [[ $num1 -lt 5 || $num2 -gt 5 ]];then\n   echo \"\u8fd4\u56de true\"\nelse\n   echo \"\u8fd4\u56de false\"\nfi\n</code></pre> <p>\u8fd4\u56de\uff1a</p> <pre><code>num1 \u4e3a:1\nnum2 \u4e3a:2\n\u8fd4\u56de false\n\u8fd4\u56de true\n</code></pre>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#25","title":"2.5 \u5b57\u7b26\u4e32\u8fd0\u7b97\u7b26","text":"<p>\u5bf9\u4e8e\u5b57\u7b26\u4e32\u8fdb\u884c\u4e00\u4e9b\u5224\u65ad\u64cd\u4f5c\uff0c\u5047\u5b9a\u53d8\u91cf a \u4e3a \u201clinux\u201d\uff0c\u53d8\u91cf b \u4e3a \u201cshell\u201d\uff1a</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b = \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\uff0c\u76f8\u7b49\u8fd4\u56de true\u3002 [$a = $b] \u8fd4\u56de false\u3002 != \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\uff0c\u4e0d\u76f8\u7b49\u8fd4\u56de true\u3002 [$a != $b] \u8fd4\u56de true\u3002 -z \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e3a 0\uff0c\u4e3a 0 \u8fd4\u56de true\u3002 [-z $a] \u8fd4\u56de false\u3002 -n \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e3a 0\uff0c\u4e0d\u4e3a 0 \u8fd4\u56de true\u3002 [-n \u201c$a\u201d ] \u8fd4\u56de true\u3002 $ \u68c0\u6d4b\u5b57\u7b26\u4e32\u662f\u5426\u4e3a\u7a7a\uff0c\u4e0d\u4e3a\u7a7a\u8fd4\u56de true\u3002 [$a] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\n\n\nstr1=\"linux\"\nstr2=\"shell\"\n\necho \"str1 \u4e3a\uff1a${str1}\"\necho \"str2 \u4e3a\uff1a${str2}\"\n\nif [ $str1 = $str2 ];then\n   echo \"$str1 = $str2 : str1 \u7b49\u4e8e str2\"\nelse\n   echo \"$str1 = $str2: str1 \u4e0d\u7b49\u4e8e str2\"\nfi\nif [ $str1 != $str2 ];then\n   echo \"$str1 != $str2 : str1 \u4e0d\u7b49\u4e8e str2\"\nelse\n   echo \"$str1 != $str2: str1 \u7b49\u4e8e str2\"\nfi\nif [ -z $str1 ];then\n   echo \"-z $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a 0\"\nelse\n   echo \"-z $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\"\nfi\nif [ -n \"$str1\" ];then\n   echo \"-n $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\"\nelse\n   echo \"-n $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a 0\"\nfi\nif [ ${str1} ];then\n   echo \"str1 : \u5b57\u7b26\u4e32\u4e0d\u4e3a\u7a7a\"\nelse\n   echo \"str1 : \u5b57\u7b26\u4e32\u4e3a\u7a7a\"\nfi\n</code></pre> <p>\u8fd4\u56de\u4e3a\uff1a</p> <pre><code>str1 \u4e3a\uff1alinux\nstr2 \u4e3a\uff1ashell\nlinux = shell: str1 \u4e0d\u7b49\u4e8e str2\nlinux != shell : str1 \u4e0d\u7b49\u4e8e str2\n-z linux : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\n-n linux : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\nstr1 : \u5b57\u7b26\u4e32\u4e0d\u4e3a\u7a7a   \n</code></pre>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#26","title":"2.6 \u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26","text":"<p>\u6587\u4ef6\u6d4b\u8bd5\u5728\u6211\u4eec\u7f16\u5199 shell \u4e2d\u4e0e\u6587\u4ef6\u64cd\u4f5c\u975e\u5e38\u5e38\u7528\uff0c\u719f\u7ec3\u638c\u63e1\u6587\u4ef6\u64cd\u4f5c\u53ef\u4ee5\u5728\u540e\u7eed\u7684 shell \u7f16\u5199\u4e2d\u5f97\u5fc3\u5e94\u624b\uff0c\u4f8b\u5982 file \u53d8\u91cf\u4e3a:</p> \u64cd\u4f5c\u7b26 \u8bf4\u660e \u4e3e\u4f8b -d file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u76ee\u5f55\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-d $file] \u8fd4\u56de false\u3002 -f file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u666e\u901a\u6587\u4ef6\uff08\u65e2\u4e0d\u662f\u76ee\u5f55\uff0c\u4e5f\u4e0d\u662f\u8bbe\u5907\u6587\u4ef6\uff09\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-f $file] \u8fd4\u56de true\u3002 -c file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5b57\u7b26\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-c $file] \u8fd4\u56de false\u3002 -b file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5757\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-b $file] \u8fd4\u56de false\u3002 -g file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SGID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-g $file] \u8fd4\u56de false\u3002 -u file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SUID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-u $file] \u8fd4\u56de false\u3002 -k file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86\u7c98\u7740\u4f4d (Sticky Bit)\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-k $file] \u8fd4\u56de false\u3002 -p file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u6709\u540d\u7ba1\u9053\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-p $file] \u8fd4\u56de false\u3002 -r file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u8bfb\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-r $file] \u8fd4\u56de true\u3002 -w file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u5199\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-w $file] \u8fd4\u56de true\u3002 -x file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u6267\u884c\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-x $file] \u8fd4\u56de true\u3002 -s file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u4e3a\u7a7a\uff08\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u5927\u4e8e 0\uff09\uff0c\u4e0d\u4e3a\u7a7a\u8fd4\u56de true\u3002 [-s $file] \u8fd4\u56de true\u3002 -e file \u68c0\u6d4b\u6587\u4ef6\uff08\u5305\u62ec\u76ee\u5f55\uff09\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-e $file] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\n\nTEST_FILE=\"/etc/fstab\"\necho \"\u68c0\u6d4b\u7684\u6587\u4ef6\u4e3a:${TEST_FILE}\"\necho \"\u6587\u4ef6\u4fe1\u606f\u4e3a:$(ls -l ${TEST_FILE})\"\n\n\nif [ -r $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u53ef\u8bfb\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u53ef\u8bfb\"\nfi\nif [ -w $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u53ef\u5199\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u53ef\u5199\"\nfi\nif [ -x $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u53ef\u6267\u884c\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u53ef\u6267\u884c\"\nfi\nif [ -f $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u4e3a\u666e\u901a\u6587\u4ef6\"\nelse\n   echo \"\u6587\u4ef6\u4e3a\u7279\u6b8a\u6587\u4ef6\"\nfi\nif [ -d $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u662f\u4e2a\u76ee\u5f55\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u662f\u4e2a\u76ee\u5f55\"\nfi\nif [ -s $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u4e0d\u4e3a\u7a7a\"\nelse\n   echo \"\u6587\u4ef6\u4e3a\u7a7a\"\nfi\nif [ -e $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u5b58\u5728\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u5b58\u5728\"\nfi\n</code></pre> <p>\u8fd4\u56de\u4e3a\uff1a</p> <pre><code>\u68c0\u6d4b\u7684\u6587\u4ef6\u4e3a:/etc/fstab\n\u6587\u4ef6\u4fe1\u606f\u4e3a:-rw-r--r--. 1 root root 500 Jan 17 14:23 /etc/fstab\n\u6587\u4ef6\u53ef\u8bfb\n\u6587\u4ef6\u53ef\u5199\n\u6587\u4ef6\u4e0d\u53ef\u6267\u884c\n\u6587\u4ef6\u4e3a\u666e\u901a\u6587\u4ef6\n\u6587\u4ef6\u4e0d\u662f\u4e2a\u76ee\u5f55\n\u6587\u4ef6\u4e0d\u4e3a\u7a7a\n\u6587\u4ef6\u5b58\u5728\n</code></pre>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#3","title":"3. \u5b9e\u4f8b","text":""},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#31","title":"3.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u4f20\u5165\u4e00\u4e2a linux \u6587\u4ef6\u7cfb\u7edf\u7684\u8def\u5f84\uff0c\u5224\u65ad\u5176\u4e0b\u9762\u6587\u4ef6\u53ca\u76ee\u5f55\u7684\u6570\u91cf\u3002</p>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#32","title":"3.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26\u6765\u5224\u65ad\u8f93\u51fa\u7684\u76ee\u5f55\u662f\u5426\u6b63\u786e\uff0c\u4e4b\u540e\u5229\u7528\u7b97\u672f\u8fd0\u7b97\u7b26\u914d\u5408\u6570\u7ec4\u5bf9\u6587\u4ef6\u6216\u76ee\u5f55\u8fdb\u884c\u7edf\u8ba1\u3002</p>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#33","title":"3.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# Description: count file scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: count file\n# Date: 2020-03-08 14:00\n# Version: 1.0\n\n# \u5224\u65ad\u8f93\u5165\u53c2\u6570\n[ $# -ne 1 ] &amp;&amp; echo \"\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c${0} check_dir\" &amp;&amp; exit 1\n\n# \u5224\u65ad\u8f93\u5165\u7684\u662f\u5426\u4e3a\u5b58\u5728\u7684\u76ee\u5f55,\u4e0d\u5b58\u5728\u5219\u9000\u51fa\nCHECK_DIR=$1\n\n[ ! -d ${CHECK_DIR} ] &amp;&amp; echo \"\u68c0\u6d4b\u7cfb\u7edf\u4e0d\u5b58\u5728\u76ee\u5f55\uff1a${CHECK_DIR}, \u8bf7\u8f93\u5165\u6b63\u786e\u7684\u76ee\u5f55\" &amp;&amp; exit 1\n\n# \u5bf9\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u7edf\u8ba1\nDIR_NUM=0\nFILE_NUM=0\nOTHER_NUM=0\n\n\nfor item in ${CHECK_DIR}/*\ndo\n        if [ -d ${item} ];then\n                # \u5982\u679c\u4e3a\u76ee\u5f55\uff0c\u5219\u76ee\u5f55\u603b\u6570\u52a0\u4e00\n                DIR_NUM=$((${DIR_NUM}+1))\n        elif [ -f ${item} ];then\n                FILE_NUM=$((${FILE_NUM}+1))\n        else\n                OTHER_NUM=$((${OTHER_NUM}+1))\n        fi\ndone\n\necho \"\u68c0\u6d4b\u76ee\u5f55\u4e3a\uff1a${CHECK_DIR}\"\necho \"\u6587\u4ef6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a${FILE_NUM}\"\necho \"\u76ee\u5f55\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a${DIR_NUM}\"\necho \"\u5176\u4ed6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a${OTHER_NUM}\"\n\n\n[root@master scripts]# bash count_file.sh \n\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0ccount_file.sh check_dir\n[root@master scripts]# bash count_file.sh aaaa\n\u68c0\u6d4b\u7cfb\u7edf\u4e0d\u5b58\u5728\u76ee\u5f55\uff1aaaaa, \u8bf7\u8f93\u5165\u6b63\u786e\u7684\u76ee\u5f55\n[root@master scripts]# bash count_file.sh /tmptmptmp\n\u68c0\u6d4b\u7cfb\u7edf\u4e0d\u5b58\u5728\u76ee\u5f55\uff1a/tmptmptmp, \u8bf7\u8f93\u5165\u6b63\u786e\u7684\u76ee\u5f55\n[root@master scripts]# bash count_file.sh /\n\u68c0\u6d4b\u76ee\u5f55\u4e3a\uff1a/\n\u6587\u4ef6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a0\n\u76ee\u5f55\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a23\n\u5176\u4ed6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a0\n[root@master scripts]# bash count_file.sh /root\n\u68c0\u6d4b\u76ee\u5f55\u4e3a\uff1a/root\n\u6587\u4ef6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a8\n\u76ee\u5f55\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a5\n\u5176\u4ed6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a0\n[root@master scripts]# bash count_file.sh /dev/\n\u68c0\u6d4b\u76ee\u5f55\u4e3a\uff1a/dev/\n\u6587\u4ef6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a1\n\u76ee\u5f55\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a19\n\u5176\u4ed6\u7c7b\u578b\u6570\u91cf\u4e3a\uff1a139\n</code></pre> <p>\u5f53\u6211\u4eec\u4e0d\u8f93\u5165\u4efb\u4f55\u53c2\u6570\u7684\u65f6\u5019\uff0c\u63d0\u793a\u9700\u8981\u8f93\u5165\u4e00\u4e2a\u8def\u5f84\u53c2\u6570\uff0c\u8f93\u5165\u4e86\u6587\u4ef6\u540d\u79f0\u6216\u4e0d\u5b58\u5728\u7684\u8def\u5f84\u65f6\uff0c\u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26\u5224\u65ad\u8f93\u5165\u5f02\u5e38\uff0c\u4e0d\u662f\u4e00\u4e2a\u6709\u6548\u7684\u6587\u4ef6\u76ee\u5f55\u3002</p> <p>\u5f53\u6211\u4eec\u8f93\u5165\u6b63\u5e38\u7684\u76ee\u5f55\u65f6\uff0c\u5373\u53ef\u83b7\u5f97\u6b63\u786e\u7684\u76ee\u5f55\u6216\u6587\u4ef6\u6570\u3002</p>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#4","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5bf9\u4e8e\u7b97\u672f\u8fd0\u7b97\uff0c\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u573a\u666f\u548c\u73af\u5883\u6765\u9009\u62e9\uff0c\u4f8b\u5982\u7cfb\u7edf\u5185\u6ca1\u6709\u8ba1\u7b97\u5de5\u5177\u7b49\uff0c\u53ef\u4ee5\u4f18\u5148\u9009\u62e9 <code>[]</code> \u548c <code>(())</code> \u6765\u8fdb\u884c\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u559c\u597d\u9009\u62e9\u3002</li> <li>\u5bf9\u4e8e\u5173\u7cfb\u8fd0\u7b97\uff0c\u6bd4\u8f83\u7684\u6570\u5b57\uff0c\u4e0d\u662f\u5b57\u7b26\u4e32\uff0c\u4e00\u5b9a\u8981\u7262\u8bb0\u8fd9\u4e2a\u6ce8\u610f\u70b9\uff0c\u5bf9\u4e8e\u5b57\u7b26\u4e32\u5224\u65ad\u53ef\u4ee5\u7528\u5b57\u7b26\u4e32\u8fd0\u7b97\u7b26\u3002</li> <li>\u5bf9\u4e8e\u5e03\u5c14\u8fd0\u7b97\u548c\u903b\u8f91\u8fd0\u7b97\u5176\u5b9e\u662f\u4e00\u4e2a\u4e1c\u897f\uff0c\u53ea\u4e0d\u8fc7\u5e03\u5c14\u8fd0\u7b97\u7b26\u6709\u4e00\u4e2a\u975e\u8fd0\u7b97\uff0c\u53ef\u4ee5\u8fdb\u884c\u7075\u6d3b\u8fd0\u7528\u3002</li> <li>\u6587\u4ef6\u6d4b\u8bd5\u7b26\u5e38\u7528\u4e0e\u5224\u65ad linux \u7cfb\u7edf\u6587\u4ef6\u7684\u64cd\u4f5c\uff0c\u5728\u540e\u671f shell \u7f16\u7a0b\u53ef\u8c13\u4e3e\u8db3\u8f7b\u91cd\uff0c\u7262\u8bb0\u6bcf\u4e2a\u6587\u4ef6\u8fd0\u7b97\u7b26\u4f1a\u4f7f\u5f97\u540e\u671f\u7f16\u7a0b\u5f97\u5fc3\u5e94\u624b\u3002</li> </ul>"},{"location":"linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/#5","title":"5. \u5c0f\u7ed3","text":"<p>\u8fd0\u7b97\u7b26\u53ef\u8c13 Shell \u811a\u672c\u7684\u7075\u9b42\uff0c\u540e\u671f\u6211\u4eec\u7684\u5faa\u73af\u548c\u5224\u65ad\u91cc\u9762\u7684\u6761\u4ef6\u90fd\u662f\u8fd9\u4e9b\u8fd0\u7b97\u7b26\u6784\u6210\uff0c\u5b83\u662f\u6d41\u7a0b\u6846\u67b6\u7684\u57fa\u7840\uff0c\u719f\u7ec3\u638c\u63e1\u8fd0\u7b97\u7b26\u7684\u5206\u7c7b\u53ca\u6bcf\u4e2a\u7684\u7528\u6cd5\uff0c\u901a\u8fc7\u52a8\u624b\u5b9e\u8df5\u533a\u5206\u5176\u7279\u5f81\uff0c\u4e3e\u4e00\u53cd\u4e09\u7075\u6d3b\u8fd0\u7528\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/","title":"6.Shell echo/printf \u547d\u4ee4","text":""},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#1-shell","title":"1. Shell \u663e\u793a\u547d\u4ee4","text":""},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#11-shell","title":"1.1 Shell \u663e\u793a\u547d\u4ee4","text":"<p>\u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0cShell \u4e5f\u6709\u5b57\u7b26\u4e32\u7684\u8f93\u51fa\u53ca\u683c\u5f0f\u5316\u5b57\u7b26\u7684\u9700\u6c42\uff0c\u5728\u672c\u7ae0\u8282\u6211\u4eec\u7740\u91cd\u8bb2\u89e3 Shell \u4e2d\u7684 echo \u4e0e printf \u547d\u4ee4\uff0c\u7075\u6d3b\u8fd0\u7528\u8fd9\u4e24\u4e2a\u547d\u4ee4\uff0c\u57fa\u672c\u4e0a\u5c31\u80fd\u6ee1\u8db3\u6211\u4eec\u5728 Shell \u7f16\u5199\u4e2d\u7684\u5927\u591a\u6570\u663e\u793a\u8f93\u51fa\u53ca\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7684\u9700\u6c42\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u663e\u793a\u547d\u4ee4","text":"<p>\u5728\u6211\u4eec\u7f16\u5199 Shell \u811a\u672c\u7684\u65f6\u5019\u9700\u8981\u4e3a\u7528\u6237\u63d0\u4f9b\u4fe1\u606f\u63d0\u793a\u4ee5\u53ca\u4ea4\u4e92\u5f0f\u663e\u793a\uff0c\u4e5f\u5b58\u5728\u9700\u8981\u8bb0\u5f55\u811a\u672c\u7684\u6267\u884c\u65e5\u5fd7\u7b49\uff0c\u6b64\u65f6\u90fd\u9700\u8981\u6211\u4eec\u6765\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\uff0c\u5229\u7528 Shell \u7684\u663e\u793a\u547d\u4ee4\u4e5f\u79f0\u8f93\u51fa\u547d\u4ee4\u6765\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#2-shell-echo","title":"2. Shell \u663e\u793a echo \u547d\u4ee4\u64cd\u4f5c","text":"<p>\u6211\u4eec\u660e\u786e\u4e86 Shell \u663e\u793a\u547d\u4ee4\u7684\u542b\u4e49\u53ca\u4f5c\u7528\uff0c\u9996\u9009\u8ba9\u6211\u4eec\u6765\u770b echo \u547d\u4ee4\u53ca\u57fa\u672c\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#21-echo","title":"2.1 echo \u8bed\u6cd5","text":"<p>echo \u547d\u4ee4\u8bed\u6cd5\u975e\u5e38\u7b80\u5355\uff1a<code>echo [option] [arguments]</code>\uff0c\u5176\u4e2d\u6839\u636e <code>option</code> \u7684\u4e0d\u540c\uff0c\u8d4b\u4e88\u4e86 echo \u5f88\u591a\u5f3a\u5927\u7684\u529f\u80fd\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#22-echo","title":"2.2 echo \u5e38\u7528\u64cd\u4f5c","text":""},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#221","title":"2.2.1 \u6253\u5370\u666e\u901a\u5b57\u7b26\u4e32","text":"<p>\u901a\u5e38\u9ed8\u8ba4\u4e0d\u5e26\u53c2\u6570\u5c31\u662f\u5904\u7406\u6253\u5370\u666e\u901a\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo \"hello shell\"\nhello shell\n</code></pre>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#222","title":"2.2.2 \u4e0d\u6362\u884c\u8f93\u51fa","text":"<p>\u9ed8\u8ba4 echo \u8f93\u51fa\u666e\u901a\u5b57\u7b26\u4e32\u4e3a\u81ea\u52a8\u6362\u884c\u7684\uff0c\u5982\u679c\u4e0d\u60f3\u8f93\u51fa\u81ea\u52a8\u6362\u884c\uff0c\u53ef\u4ee5\u6dfb\u52a0\u9009\u9879 <code>-n</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo -n \"hello shell\"\nhello shell[root@master ~]# \n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6b64\u65f6\u8f93\u51fa\u5c31\u4e0d\u81ea\u52a8\u6362\u884c\uff0c\u8be5\u9700\u6c42\u53ef\u4ee5\u5728\u6211\u4eec\u5199\u6587\u4ef6\u7684\u65f6\u5019\u4f7f\u7528\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#223","title":"2.2.3 \u8f93\u51fa\u53d8\u91cf","text":"<p>\u5728\u6211\u4eec\u524d\u9762\u8bb2\u89e3\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u6709\u63d0\u5230\u8fc7\u5728\u5f15\u7528\u53d8\u91cf\u7684\u65f6\u5019\u53ef\u4ee5\u5229\u7528 <code>echo</code> \u547d\u4ee4\uff0c\u4f46\u662f\u6b64\u65f6\u9700\u8981\u6211\u4eec\u6ce8\u610f\u5355\u5f15\u53f7\u4e0e\u53cc\u5f15\u53f7\u7684\u533a\u522b\u3002</p> <ul> <li>\u5355\u5f15\u53f7</li> </ul> <p>\u5355\u5f15\u53f7\u4e3a\u5c06\u53d8\u91cf\u540d\u539f\u6837\u8f93\u51fa\uff0c\u4e0d\u5f15\u7528\u5176\u7684\u503c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# STR1=\"hello shell\"\n[root@master ~]# echo '${STR1}'\n${STR1}\n</code></pre> <ul> <li>\u53cc\u5f15\u53f7</li> </ul> <p>\u53cc\u5f15\u53f7\u4e3a\u5f15\u7528\u53d8\u91cf\u7684\u503c\u8fdb\u884c\u8f93\u51fa\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# echo \"${STR1}\"\nhello shell\n[root@master ~]# echo ${STR1}\nhello shell\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5728\u7ec8\u7aef\u5982\u679c\u4e0d\u663e\u5f0f\u4e66\u5199\u5f15\u53f7\uff0c\u9ed8\u8ba4\u5c31\u4e3a\u53cc\u5f15\u53f7\uff0c\u4e5f\u5c31\u662f\u5f15\u7528\u6211\u4eec\u53d8\u91cf\u7684\u503c\uff0c\u4f46\u662f\u6211\u4eec\u5728\u7f16\u5199 Shell \u811a\u672c\u7684\u65f6\u5019\u5c3d\u53ef\u80fd\u5730\u663e\u793a\u5199\u4e0a\u5f15\u53f7\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u5f02\u5e38\u53d1\u751f\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#224-e","title":"2.2.4 -e \u8f6c\u4e49","text":"<p><code>echo</code> \u547d\u4ee4\u4f7f\u7528 <code>-e</code> \u9009\u9879\u53ef\u4ee5\u5f00\u542f\u8f6c\u4e49\uff0c\u5904\u7406\u7279\u6b8a\u5b57\u7b26\u3002</p> <ul> <li><code>\\n</code>: \u6362\u884c\u7b26\u53f7</li> </ul> <pre><code>[root@master ~]# echo -e \"hello\\nshell\" \nhello\nshell\n</code></pre> <ul> <li><code>\\t</code>: \u5236\u8868\u7b26\uff0c\u4e5f\u5c31\u662f\u6309\u6211\u4eec\u7684 tab \u952e</li> </ul> <pre><code>[root@master ~]# echo -e \"hello\\tshell\" \nhello   shell\n</code></pre> <ul> <li><code>\\r</code>: \u56de\u8f66\u952e\uff0cRETURN</li> </ul> <pre><code>[root@master ~]# echo -e \"hello\\r\"    \nhello       \n</code></pre> <ul> <li><code>\\a</code>: \u4ece\u7cfb\u7edf\u5587\u53ed\u9001\u51fa\u94c3\u58f0\uff0cALERT</li> </ul> <pre><code>    [root@master ~]# echo -e \"\\a\"\n</code></pre> <ul> <li><code>\\\\</code>\uff1a\u663e\u793a\u53cd\u659c\u7ebf\u672c\u8eab</li> </ul> <pre><code>[root@master ~]# echo -e \"hello \\\\ shell\"\nhello \\ shell\n</code></pre> <ul> <li><code>\\f</code>:FORMFEED\uff0c\u6362\u9875\u5b57\u7b26</li> </ul> <pre><code>[root@master ~]# echo -e \"hello\\fshell\" \nhello\n     shell\n</code></pre> <ul> <li><code>\\E</code>:ESCAPE\uff0c\u8df3\u8131\u952e</li> </ul> <pre><code>[root@master ~]# echo -e \"hello \\Eshell\"\nhello hell\n</code></pre>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#225","title":"2.2.5 \u6587\u4ef6\u64cd\u4f5c","text":"<ul> <li>\u521b\u5efa\u6587\u4ef6</li> </ul> <p>\u53ef\u4ee5\u5229\u7528 echo \u547d\u4ee4\u6765\u521b\u5efa\u6587\u4ef6\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# ls test.sh\nls: cannot access test.sh: No such file or directory\n[root@master ~]# echo \"hello shell\" &gt;test.sh\n[root@master ~]# cat test.sh \nhello shell\n[root@master ~]#\n</code></pre> <p>\u5982\u679c\u9700\u8981\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\u5199\u5165\u7b80\u5355\u5185\u5bb9\uff0c\u4e0d\u7528\u521b\u5efa\u6587\u4ef6\u7136\u540e\u6253\u5f00\uff0c\u53ef\u4ee5\u76f4\u63a5\u5229\u7528 echo \u547d\u4ee4\u5c06\u5185\u5bb9\u8f93\u5165\u5230\u6587\u4ef6\u4e2d\uff0c\u6587\u4ef6\u4f1a\u81ea\u52a8\u521b\u5efa\u3002</p> <ul> <li>\u6e05\u7a7a\u6587\u4ef6</li> </ul> <p>\u53ef\u4ee5\u5229\u7528 echo \u6765\u6e05\u7a7a\u6587\u4ef6\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master ~]# cat test.sh \nhello shell\n[root@master ~]# echo &gt;test.sh \n[root@master ~]# cat test.sh \n</code></pre>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#226","title":"2.2.6 \u611f\u53f9\u53f7","text":"<p>\u5728 echo \u4e2d\uff0c\u5982\u679c\u4f7f\u7528\u53cc\u5f15\u53f7\u5176\u4e2d\u5e26\u6709 <code>!</code> \u5219\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u8fd9\u662f\u56e0\u4e3a\u9ed8\u8ba4 Shell \u5f00\u542f\u4e86\u611f\u53f9\u53f7\u5f15\u7528\u5185\u5b58\u4e2d\u7684\u5386\u53f2\u547d\u4ee4\uff0c\u53ef\u4ee5\u5229\u7528 <code>set +H</code> \u8fdb\u884c\u5173\u95ed\uff0c\u5982\u679c\u4e0d\u5173\u95ed\u8be5\u8bbe\u7f6e\u8fd8\u60f3\u4f7f\u7528\u611f\u53f9\u53f7\uff0c\u53ef\u4ee5\u4f7f\u7528\u5355\u5f15\u53f7\u3002</p> <pre><code>[root@master ~]# echo \"hello !\"\n-bash: !\": event not found\n[root@master ~]# echo 'hello !'\nhello !\n</code></pre>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#227","title":"2.2.7 \u989c\u8272\u8f93\u51fa","text":"<p>\u5728 Shell \u4e2d\u6211\u4eec\u6709\u65f6\u5019\u9700\u8981\u4e0e\u7528\u6237\u8fdb\u884c\u4ea4\u4e92\u5f0f\u64cd\u4f5c\uff0c\u5982\u679c\u8f93\u51fa\u7684\u5185\u5bb9\u6709\u989c\u8272\uff0c\u5bf9\u4e8e\u7528\u6237\u8bc6\u522b\u66f4\u4e3a\u660e\u663e\u3002Shell \u4e2d echo \u53ef\u4ee5\u5bf9\u5b57\u4f53\u989c\u8272 / \u80cc\u666f / \u663e\u793a\u65b9\u5f0f\u8fdb\u884c\u63a7\u5236\uff0c\u5982\u4e0b\u8868\uff1a</p> \u5b57\u4f53\u989c\u8272 \u5b57\u4f53\u80cc\u666f\u989c\u8272 \u663e\u793a\u65b9\u5f0f 30\uff1a\u9ed1 40\uff1a\u9ed1 31\uff1a\u7ea2 41\uff1a\u6df1\u7ea2 0\uff1a\u7ec8\u7aef\u9ed8\u8ba4\u8bbe\u7f6e 32\uff1a\u7eff 42\uff1a\u7eff 1\uff1a\u9ad8\u4eae\u663e\u793a 33\uff1a\u9ec4 43\uff1a\u9ec4\u8272 4\uff1a\u4e0b\u5212\u7ebf 34\uff1a\u84dd\u8272 44\uff1a\u84dd\u8272 5\uff1a\u95ea\u70c1 35\uff1a\u7d2b\u8272 45\uff1a\u7d2b\u8272 7\uff1a\u53cd\u767d\u663e\u793a 36\uff1a\u6df1\u7eff 46\uff1a\u6df1\u7eff 8\uff1a\u9690\u85cf 37\uff1a\u767d\u8272 47\uff1a\u767d\u8272 \u683c\u5f0f\uff1a \\033[1;31;40m # 1 \u662f\u663e\u793a\u65b9\u5f0f\uff0c\u53ef\u9009\u300231 \u662f\u5b57\u4f53\u989c\u8272\u300240m \u662f\u5b57\u4f53\u80cc\u666f\u989c\u8272\u3002 \\033[0m # \u6062\u590d\u7ec8\u7aef\u9ed8\u8ba4\u989c\u8272\uff0c\u5373\u53d6\u6d88\u989c\u8272\u8bbe\u7f6e\u3002 <ul> <li>\u663e\u793a\u65b9\u5f0f</li> </ul> <pre><code>for i in {1..8};do echo -e \"\\033[$i;31;40m hello shell \\033[0m\";done\n</code></pre> <ul> <li>\u5b57\u4f53\u989c\u8272</li> </ul> <pre><code>for i in {30..37};do echo -e \"\\033[$i;40m hello shell \\033[0m\";done\n</code></pre> <ul> <li>\u80cc\u666f\u989c\u8272</li> </ul> <pre><code>for i in {40..47};do echo -e \"\\033[47;${i}m hello shell \\033[0m\";done\n</code></pre>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#3-shell-printf","title":"3. Shell \u4e2d printf \u547d\u4ee4\u64cd\u4f5c","text":"<p>\u6211\u4eec\u5b66\u4e60\u4e86 echo \u547d\u4ee4\uff0c\u5b83\u901a\u5e38\u7528\u4e8e\u5904\u7406\u5e38\u89c4\u7684\u9700\u6c42\uff0c\u8fd8\u6709\u4e00\u4e9b\u66f4\u9ad8\u7ea7\u7684\u9700\u6c42\uff0c\u4f8b\u5982\u6211\u4eec\u5e0c\u671b\u8f93\u51fa\u5185\u5bb9\u6307\u5b9a\u5b57\u7b26\u7684\u5bbd\u5ea6\uff0c\u5de6\u53f3\u5bf9\u9f50\uff0c\u683c\u5f0f\u5c0f\u6570\u8f93\u51fa\u7b49\uff0c\u6b64\u573a\u666f\u4e0b\u9700\u8981\u5229\u7528 <code>printf</code> \u547d\u4ee4\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#31-printf","title":"3.1 printf \u8bed\u6cd5","text":"<p>printf \u529f\u80fd\u4e3a\u683c\u5f0f\u5316\u6253\u5370\u6570\u636e\uff0c\u8bed\u6cd5\u4e3a\uff1a<code>printf format-string [arguments]</code>\u3002</p> <ul> <li>format-string: \u4e3a\u683c\u5f0f\u63a7\u5236\u5b57\u7b26\u4e32\uff1b</li> <li>arguments: \u4e3a\u53c2\u6570\u5217\u8868\u3002</li> </ul>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#32-printf","title":"3.2 printf \u6ce8\u610f\u70b9","text":"<p>\u5176\u5f15\u7528 C \u8bed\u8a00\u4e2d\u7684 <code>printf</code> \u547d\u4ee4\uff0c\u4f46 \u4e5f\u6709\u4e00\u4e9b\u533a\u522b\uff0c\u9700\u8981\u6ce8\u610f\uff1a</p> <ul> <li>printf \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u672b\u5c3e\u4e0d\u52a0\u6362\u884c\u7b26\u53f7\uff0c\u6240\u4ee5\u5982\u679c\u9700\u8981\u6362\u884c\uff0c\u9700\u8981\u663e\u793a\u624b\u52a8\u6dfb\u52a0 <code>\\n</code>;</li> <li>printf \u4e3a\u683c\u5f0f\u5316\u8f93\u51fa\u4e0d\u5bf9\u5185\u5bb9\u505a\u6539\u53d8\u64cd\u4f5c\uff0c\u5c24\u5176\u5728\u6d6e\u70b9\u6570\u8f93\u51fa\u7684\u65f6\u5019\uff0c\u5bf9\u5176\u7ed3\u679c\u4e0d\u8fdb\u884c\u6539\u53d8\uff0c\u8fd9\u662f\u73b0\u5b9e\u7ed3\u679c\u6709\u5dee\u5f02\uff1b</li> <li>\u5728 printf \u4e2d\u5e74 arguments \u4e3a\u53c2\u6570\u5217\u8868\uff0c\u4f8b\u5982\u5b57\u7b26\u4e32\u6216\u8005\u53d8\u91cf\uff0c\u5efa\u8bae\u4e2a\u6570\u4e0e format-string \u8981\u6c42\u7684\u6570\u91cf\u76f8\u540c\uff1b</li> <li>printf \u4e0d\u7528\u52a0\u62ec\u53f7\uff0carguments \u4f7f\u7528\u7a7a\u683c\u5206\u9694\uff0c\u4e0d\u7528\u9017\u53f7\u3002</li> </ul>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#33-printf","title":"3.3 printf \u5e38\u7528\u64cd\u4f5c","text":""},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#331","title":"3.3.1 \u6253\u5370\u666e\u901a\u5b57\u7b26\u4e32","text":"<pre><code>[root@master ~]# printf \"hello shell\"\nhello shell[root@master ~]# printf \"hello shell\\n\"\nhello shell\n</code></pre> <p>\u5982\u679c\u9700\u8981\u6362\u884c\uff0c\u9700\u8981\u624b\u52a8\u663e\u5f0f\u6dfb\u52a0 <code>\\n</code>\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#332","title":"3.3.2 \u683c\u5f0f\u5b57\u7b26\u4e32","text":"<p>\u5728\u638c\u63e1 printf \u524d\u9700\u8981\u5148\u4e86\u89e3 <code>format-string</code>\uff0c\u5176\u5bf9\u5e94\u7740\u4e0d\u540c\u7684\u542b\u4e49\uff0c\u5728\u6b64\u6211\u4eec\u4ecb\u7ecd\u6700\u5e38\u7528\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\u3002</p> <ul> <li><code>%s</code></li> </ul> <p>\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\uff0c\u5176\u4e2d <code>%s</code> \u5c31\u662f\u5f15\u7528\u540e\u9762\u7684\u5b57\u7b26 <code>shell</code></p> <pre><code>[root@master ~]# printf \"hello %s\\n\" shell\nhello shell\n</code></pre> <ul> <li><code>%d</code></li> </ul> <p>\u5341\u8fdb\u5236\u6574\u6570</p> <pre><code>[root@master ~]# printf \"age: %d\\n\" 20      \nage: 20\n</code></pre> <ul> <li>\u5de6\u5bf9\u9f50</li> </ul> <p>printf \u53ef\u4ee5\u4f7f\u5f97\u5de6\u5bf9\u9f50\uff0c\u4f8b\u5982 <code>%-10s</code> \u6307\u4e00\u4e2a\u5bbd\u5ea6\u4e3a 10 \u4e2a\u5b57\u7b26\uff0c\u5de6\u5bf9\u9f50\u5229\u7528 <code>-</code> \u8868\u793a\uff0c\u4efb\u4f55\u5b57\u7b26\u90fd\u4f1a\u88ab\u663e\u793a\u5728 10 \u4e2a\u5b57\u7b26\u5bbd\u7684\u5b57\u7b26\u5185\uff0c\u5982\u679c\u4e0d\u8db3\u5219\u81ea\u52a8\u4ee5\u7a7a\u683c\u586b\u5145\uff0c\u8d85\u8fc7\u4e5f\u4f1a\u5c06\u5185\u5bb9\u5168\u90e8\u663e\u793a\u51fa\u6765\u3002</p> <pre><code>[root@master ~]# printf \"hello %-10s%s\\n\" shell \u3002      \nhello shell     \u3002\n</code></pre> <ul> <li>\u53f3\u8fb9\u5bf9\u9f50</li> </ul> <p>\u53f3\u5bf9\u9f50\u5229\u7528 <code>+</code> \u8868\u793a\uff0c<code>%+10.2f</code> \u6307\u683c\u5f0f\u5316\u4e3a\u5c0f\u6570\uff0c\u5176\u4e2d 10 \u8868\u793a 4 \u4e2a\u5b57\u7b26\u5bbd\u5ea6\uff0c.2 \u6307\u4fdd\u7559 2 \u4f4d\u5c0f\u6570\u3002</p> <pre><code>[root@master ~]# printf \"hello %+10s%s\\n\" shell \u3002 \nhello      shell\u3002\n\n[root@master ~]# printf \"hello %+10.2f %s\\n\" 3.1415 \u3002   \nhello      +3.14 \u3002\n</code></pre> <ul> <li>\u5176\u4ed6</li> </ul> <p>\u5f53\u7136\u4e00\u4e9b\u5176\u4ed6\u683c\u5f0f\u5316\u5b57\u7b26\uff0c\u5728\u6b64\u4e3e\u4f8b\u6700\u5e38\u7528\u7684\uff0c\u5176\u4ed6\u7684\u53ef\u53c2\u8003\u5982\u4e0b\uff1a</p> <pre><code>%c ASCII\u5b57\u7b26.\u663e\u793a\u76f8\u5bf9\u5e94\u53c2\u6570\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\n%d,%i \u5341\u8fdb\u5236\u6574\u6570\uff08\u5e38\u7528\uff09\n%e \u6d6e\u70b9\u683c\u5f0f([-d].precisione [+-dd])\n%E \u6d6e\u70b9\u683c\u5f0f([-d].precisionE [+-dd])\n%g %e\u6216%f\u8f6c\u6362,\u770b\u54ea\u4e00\u4e2a\u8f83\u77ed,\u5219\u5220\u9664\u7ed3\u5c3e\u7684\u96f6\n%G %E\u6216%f\u8f6c\u6362,\u770b\u54ea\u4e00\u4e2a\u8f83\u77ed,\u5219\u5220\u9664\u7ed3\u5c3e\u7684\u96f6\n%s \u5b57\u7b26\u4e32\uff08\u5e38\u7528\uff09\n%u \u4e0d\u5e26\u6b63\u8d1f\u53f7\u7684\u5341\u8fdb\u5236\u503c\n%x \u4e0d\u5e26\u6b63\u8d1f\u53f7\u7684\u5341\u516d\u8fdb\u5236.\u4f7f\u7528a\u81f3f\u8868\u793a10\u81f315\n%% \u5b57\u9762\u610f\u4e49\u7684%\n%X \u4e0d\u5e26\u6b63\u8d1f\u53f7\u7684\u5341\u516d\u8fdb\u5236.\u4f7f\u7528A\u81f3F\u8868\u793a10\u81f315\n</code></pre>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#333","title":"3.3.3 \u5176\u4ed6","text":"<ul> <li>\u5355\u53cc\u5f15\u53f7</li> </ul> <p>\u5728 printf \u4e2d\uff0c\u5355\u53cc\u5f15\u53f7\u90fd\u4e00\u81f4\u3002</p> <pre><code>[root@master ~]# printf \"hello %s\\n\" shell\nhello shell\n[root@master ~]# printf 'hello %s\\n' shell \nhello shell\n</code></pre> <ul> <li>\u683c\u5f0f\u53ea\u6307\u5b9a\u4e86\u4e00\u4e2a\u53c2\u6570\uff0c\u4f46\u591a\u51fa\u7684\u53c2\u6570\u4ecd\u7136\u4f1a\u6309\u7167\u8be5\u683c\u5f0f\u8f93\u51fa\uff0cformat-string \u88ab\u91cd\u7528\u8fdb\u884c\u591a\u884c\u8f93\u51fa</li> </ul> <pre><code>[root@master ~]# printf 'hello %s\\n' shell python go\nhello shell\nhello python\nhello go\n\n[root@master ~]# printf \"%s %s %s %s\\n\" a b c d e f g h i j\na b c d\ne f g h\ni j  \n</code></pre> <ul> <li>\u5982\u679c\u6ca1\u6709 arguments\uff0c\u90a3\u4e48\u5219\u5bf9\u5e94\u4f7f\u7528\u9ed8\u8ba4\u503c\u8868\u793a\uff0c % s \u7528 NULL \u4ee3\u66ff\uff0c% d \u7528 0 \u4ee3\u66ff</li> </ul> <pre><code>[root@master ~]# printf \"%s default  %d \\n\" \n default  0 \n</code></pre>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#334-printf","title":"3.3.4 printf \u8f6c\u4e49","text":"<p>printf \u7684\u8f6c\u4e49\u4e0e echo \u4e2d\u7684\u4e00\u81f4\uff0c\u53ef\u53c2\u8003 echo \u4e2d\u7684\u8f6c\u4e49\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#4","title":"4. \u5b9e\u4f8b","text":""},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#41","title":"4.1 \u9700\u6c42","text":"<p>\u4f8b\u5982\u7ed9\u51fa\u5982\u4e0b nginx \u7684\u8bbf\u95ee\u65e5\u5fd7\uff0c\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u5206\u6790\u5e76\u4e14\u8f93\u51fa\u4e0d\u540c\u7684\u72b6\u6001\u5417\uff0c\u5229\u7528\u989c\u8272\u4e0d\u540c\u8fdb\u884c\u533a\u5206\u4e0d\u540c\u7684\u72b6\u6001\u7801\u3002</p> <pre><code>112.65.61.117 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/chunk-2eca3a5a.2f1d5ea3.js HTTP/1.1\" 200 5276 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/chunk-91d36e6e.a1444c20.js HTTP/1.1\" 200 12674 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/chunk-vendors.3a6c246c.js HTTP/1.1\" 404  260490 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) Apessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/app.ec4e6290.js HTTP/1.1\" 200 11149 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /js/chunk-vendors.3a6c246c.js HTTP/1.1\" 200 260482 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /api/2 HTTP/1.1\" 500 502 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /js/chunk-2eca3a5a.2f1d5ea3.js HTTP/1.1\" 200 5276 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /css/chunk-91d36e6e.a5cb4df4.css HTTP/1.1\" 200 1133 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /js/chunk-03341f87.78501520.js HTTP/1.1\" 200 1059 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:55 +0800] \"GET /js/chunk-91d36e6e.a1444c20.js HTTP/1.1\" 200 12674 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:56 +0800] \"GET /api/1 HTTP/1.1\" 500 39193 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:56 +0800] \"GET /img/download.f4b65200.png HTTP/1.1\" 200 7737 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:57 +0800] \"GET /img/background.fc2d80f1.png HTTP/1.1\" 200 57711 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:57 +0800] \"GET /img/peitu.a89ef99f.svg HTTP/1.1\" 301 106569 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n223.104.189.205 - - [05/Nov/2019:17:10:57 +0800] \"GET /fonts/element-icons.535877f5.woff HTTP/1.1\" 200 28200 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.5(0x17000523) NetType/4G Language/zh_CN\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:59 +0800] \"GET /img/download.f4b65200.png HTTP/1.1\" 200 7737 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:59 +0800] \"GET /img/scan.d3d981fc.png HTTP/1.1\" 404 39193 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:10:59 +0800] \"GET /img/background.fc2d80f1.png HTTP/1.1\" 200 57711 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n112.65.61.117 - - [05/Nov/2019:17:11:00 +0800] \"GET /img/peitu.a89ef99f.svg HTTP/1.1\" 200 106569 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n14.106.162.188 - - [05/Nov/2019:17:14:40 +0800] \"GET /index HTTP/1.1\" 200 535 \"-\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.8(0x17000820) NetType/4G Language/zh_CN\" \"-\"\n14.106.162.188 - - [05/Nov/2019:17:14:40 +0800] \"GET /css/app.7d918353.css HTTP/1.1\" 200 1290 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.8(0x17000820) NetType/4G Language/zh_CN\" \"-\"\n14.106.162.188 - - [05/Nov/2019:17:14:40 +0800] \"GET /js/app.ec4e6290.js HTTP/1.1\" 404 11149 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/7.0.8(0x17000820) NetType/4G Language/zh_CN\" \"-\"\n</code></pre>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#42","title":"4.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u4e0a\u8282\u8bfe\u7684\u6570\u7ec4\u8fdb\u884c\u72b6\u6001\u5b58\u50a8\uff0c\u4e4b\u540e\u5229\u7528\u7edf\u8ba1\u6bcf\u4e2a\u72b6\u6001\u7684\u6570\u91cf\u6765\u5229\u7528 echo \u989c\u8272\u8fdb\u884c\u533a\u5206\u663e\u793a\u3002</p>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#43","title":"4.3 \u5b9e\u73b0","text":"<ul> <li>\u5c06 nginx \u8bbf\u95ee\u65e5\u5fd7\u6587\u4ef6\u5b58\u50a8\u4e3a nginx.log\uff0c\u53ef\u4ee5\u5229\u7528 cat \u547d\u4ee4\u6765\u521b\u5efa\u6587\u4ef6</li> </ul> <pre><code>cat &gt; nginx.log &lt;&lt;EOF\n112.65.61.117 - - [05/Nov/2019:17:10:54 +0800] \"GET /js/chunk-2eca3a5a.2f1d5ea3.js HTTP/1.1\" 200 5276 \"https://smartsds.tools.anchnet.com/index\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 QBCore/4.0.1278.400 QQBrowser/9.0.2524.400 Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2875.116 Safari/537.36 NetType/WIFI MicroMessenger/7.0.5 WindowsWechat\" \"-\"\n...\nEOF\n</code></pre> <ul> <li>\u7f16\u5199\u4ee3\u7801\uff0c\u5176\u4e2d\u4e3a\u4eec\u5229\u7528 cut \u5bf9 nginx \u65e5\u5fd7\u6587\u4ef6\u8fdb\u884c\u5206\u5272\uff0c\u72b6\u6001\u7801\u7684\u5217\u5c3e\u7b2c\u4e5d\u5217\u3002</li> </ul> <pre><code>#!/bin/bash\n# Description: nginx status\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: nginx status check\n# Date: 2020-03-21 14:00\n# Version: 1.0\n\n# \u5bf9\u8f93\u5165\u7684nginx\u65e5\u5fd7\u6587\u4ef6\u8fdb\u884c\u5224\u65ad\nNGINX_LOG=$1\n\n# \u5b9a\u4e49\u7ba1\u7406\u6570\u7ec4\ndeclare -A HTTP_STATUS\n\n# \u5bf9\u6570\u7ec4\u8fdb\u884c\u5185\u5bb9\u8d4b\u503c\n\n# \u5229\u7528netstat\u547d\u4ee4\u6765\u8fc7\u6ee4\u51fa\u5173\u7cfb\u7684\u4e00\u5217\u6570\u636e\nfor status in $(cat ${NGINX_LOG} |cut -d\" \" -f9)\ndo\n        # \u5bf9\u72b6\u6001\u76f8\u540c\u72b6\u6001\u7684HTTP\u8fdb\u884c\u6570\u503c\u7d2f\u52a0\n        let HTTP_STATUS[${status}]++\ndone\n\n# \u5c06\u7edf\u8ba1\u5b8c\u6210\u7684TCP\u94fe\u63a5\u72b6\u6001\u53ca\u6570\u636e\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\nfor i in ${!HTTP_STATUS[@]}\ndo \n        if [ ${i} -eq 404 ];then\n                echo -e \"\\033[34;40m\u6587\u4ef6${NGINX_LOG}\u4e2d\u72b6\u6001\u7801\u4e3a${i}\u7684\u6570\u91cf\u4e3a${HTTP_STATUS[${i}]} \\033[0m\"\n        elif [ ${i} -eq 500 ];then\n                echo -e \"\\033[31;40m\u6587\u4ef6${NGINX_LOG}\u4e2d\u72b6\u6001\u7801\u4e3a${i}\u7684\u6570\u91cf\u4e3a${HTTP_STATUS[${i}]} \\033[0m\"\n        elif [ ${i} -eq 200 ];then\n                echo -e \"\\033[32;40m\u6587\u4ef6${NGINX_LOG}\u4e2d\u72b6\u6001\u7801\u4e3a${i}\u7684\u6570\u91cf\u4e3a${HTTP_STATUS[${i}]} \\033[0m\"\n        else\n                echo -e \"\\033[36;40m\u6587\u4ef6${NGINX_LOG}\u4e2d\u72b6\u6001\u7801\u4e3a${i}\u7684\u6570\u91cf\u4e3a${HTTP_STATUS[${i}]} \\033[0m\"\n        fi\ndone\n</code></pre> <ul> <li>\u6267\u884c\u7ed3\u679c</li> </ul> <pre><code>[root@master shell_echo]# bash nginx_status.sh nginx.log \n\u6587\u4ef6nginx.log\u4e2d\u72b6\u6001\u7801\u4e3a200\u7684\u6570\u91cf\u4e3a17 \n\u6587\u4ef6nginx.log\u4e2d\u72b6\u6001\u7801\u4e3a301\u7684\u6570\u91cf\u4e3a1 \n\u6587\u4ef6nginx.log\u4e2d\u72b6\u6001\u7801\u4e3a404\u7684\u6570\u91cf\u4e3a2 \n\u6587\u4ef6nginx.log\u4e2d\u72b6\u6001\u7801\u4e3a500\u7684\u6570\u91cf\u4e3a2 \n</code></pre>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#5","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5728 echo \u53d8\u91cf\u5f15\u7528\u65f6\uff0c\u6211\u4eec\u63a8\u8350\u52e4\u7528\u5f15\u53f7\uff0c\u5355\u5f15\u53f7\u4e3a\u539f\u6837\u8f93\u51fa\u5b57\u7b26\u4e32\uff0c\u53cc\u5f15\u53f7\u4e3a\u8f93\u51fa\u53d8\u91cf\u7684\u503c\uff1b</li> <li>printf \u7531 POSIX \u6807\u51c6\u6240\u5b9a\u4e49\uff0c\u56e0\u6b64\u4f7f\u7528 printf \u7684\u811a\u672c\u6bd4\u4f7f\u7528 echo \u79fb\u690d\u66f4\u597d\uff0c\u5982\u679c\u540e\u671f\u8003\u8651\u5e73\u53f0\u79fb\u690d\u95ee\u9898\uff0c\u5efa\u8bae\u4f7f\u7528 <code>printf</code>\u3002</li> </ul>"},{"location":"linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/#6","title":"6. \u5c0f\u7ed3","text":"<p>\u5728 shell \u4e2d\u6211\u4eec\u53ef\u4ee5\u5229\u7528 echo \u6765\u8bb0\u5f55\u7a0b\u5e8f\u7684\u65e5\u5fd7\uff0c\u6216\u5bf9\u6587\u4ef6\u8fdb\u884c\u65b0\u589e\u5185\u5bb9\u8f93\u5165\uff0c\u6216\u5229\u7528\u5176\u8fdb\u884c\u989c\u8272\u6253\u5370\uff0c\u53ef\u4ee5\u8f93\u51fa\u5e26\u6709\u989c\u8272\u7684\u6f02\u4eae\u63d0\u793a\u3002\u5728\u8bbe\u8ba1\u591a\u5e73\u53f0\u79fb\u690d\u6027\u95ee\u9898\u7684\u65f6\u5019\uff0c\u4e3a\u4eec\u53ef\u4ee5\u4f18\u5148\u8003\u8651 <code>printf</code>\uff0c\u5bf9\u4e8e\u6570\u7ec4\u663e\u53ef\u4ee5\u4f7f\u7528 <code>printf</code> \u6765\u5b8c\u6210\uff0c\u7075\u6d3b\u8fd0\u7528\u663e\u793a\u4f7f\u5f97\u811a\u672c\u7f16\u5199\u66f4\u4e3a\u65b9\u4fbf\u7075\u6d3b\u3002</p>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/","title":"7.Shell test \u547d\u4ee4","text":""},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#1-shell-test","title":"1. Shell test \u547d\u4ee4\u6982\u8ff0","text":""},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#11-shell-test","title":"1.1 Shell test \u547d\u4ee4\u7b80\u4ecb","text":"<p>\u5728\u6211\u4eec\u4e4b\u524d\u7ae0\u8282\u5b66\u4e60\u4e86 Shell \u7684\u8fd0\u7b97\u7b26\uff0c\u5176\u4e2d\u5927\u591a\u6570\u8fd0\u7b97\u90fd\u53ef\u4ee5\u7ed3\u5408 <code>test</code> \u547d\u4ee4\u6765\u5b8c\u6210\u6d4b\u8bd5\u4e0e\u6bd4\u8f83\u64cd\u4f5c\uff0c<code>test</code> \u547d\u4ee4\u914d\u5408\u5404\u64cd\u4f5c\u7b26\u53f7\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5b8c\u6210\u6d4b\u8bd5\u903b\u8f91\u8868\u8fbe\u5f0f\uff0c\u8fd8\u53ef\u4ee5\u8fdb\u884c\u6587\u4ef6\uff0c\u6570\u5b57\uff0c\u5b57\u7b26\u4e32\u7684\u6bd4\u8f83\u3002\u672c\u6587\u662f\u4e00\u4e9b\u5e38\u89c1\u7528\u6cd5\u7684\u5f52\u7eb3\u603b\u7ed3\u3002</p>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#12-test","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528 test \u547d\u4ee4","text":"<p>\u5728 Shell \u4e2d\u6bcf\u4e2a\u547d\u4ee4\u90fd\u6709\u5176\u5e94\u7528\u573a\u666f\uff0ctest \u547d\u4ee4\u4e5f\u4e0d\u4f8b\u5916\uff0c\u5176\u5e94\u7528\u573a\u666f\u51e0\u4e4e\u904d\u5e03\u6211\u4eec\u6574\u4e2a Shell \u811a\u672c\u7684\u751f\u547d\u5468\u671f\uff0c\u57fa\u672c\u4e0a Shell \u811a\u672c\u91cc\u9762\u90fd\u4f1a\u6709\u5176\u8eab\u5f71\u3002</p> <p>\u5f53\u6211\u4eec\u5bf9\u6570\u503c\u8fdb\u884c\u7b97\u672f\u8fd0\u7b97\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u6587\u4ef6\u8fdb\u884c\u5224\u65ad\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u903b\u8f91\u6216\u5b57\u7b26\u4e32\u8fdb\u884c\u5224\u65ad\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u60c5\u51b5\u90fd\u9700\u8981\u4f7f\u7528 test \u547d\u4ee4\u6765\u914d\u5408\u8fd0\u7b97\u7b26\u8fdb\u884c\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#2-shell-test","title":"2. Shell test \u547d\u4ee4\u7b80\u4ecb","text":""},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#21","title":"2.1 \u72b6\u6001\u8fd4\u56de\u503c","text":"<p>\u5728\u6211\u4eec\u5b66\u4e60 test \u547d\u4ee4\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u5728 Linux \u4e2d\u6267\u884c\u547d\u4ee4\u8fd4\u56de 0 \u4e3a\u6b63\u5e38\uff0c\u8fd4\u56de\u975e 0 \u8868\u793a\u5f02\u5e38\uff0c\u53ef\u4ee5\u5229\u7528 <code>$?</code> \u6765\u83b7\u53d6\u8fd4\u56de\u503c\u3002\u5728\u4e0b\u9762\u7684 test \u64cd\u4f5c\u4e2d\u6211\u4eec\u5c31\u4f1a\u8fd0\u7528\u6b64\u7279\u6027\u6765\u8fdb\u884c\u6d4b\u8bd5\u6bd4\u8f83\u3002</p>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#22-test","title":"2.2 test \u547d\u4ee4\u7b80\u4ecb","text":"<ul> <li>test \u547d\u4ee4</li> </ul> <p>test \u4e3a Shell \u5185\u7f6e\u547d\u4ee4\uff0c\u5176\u901a\u5e38\u9700\u8981\u4e0e if \u8bed\u53e5\u4e00\u5757\u4f7f\u7528\u3002</p> <ul> <li>\u8bed\u6cd5\u683c\u5f0f</li> </ul> <p>\u8bed\u6cd5\u683c\u5f0f\u4e3a <code>test expression</code>, \u5f53 test \u5224\u65ad expression \u4e3a\u6210\u7acb\u65f6\uff0c\u8fd4\u56de\u72b6\u6001\u4e3a 0\uff0c\u5426\u5219\u4e3a\u975e 0 \u503c\u3002</p> <p>test \u547d\u4ee4\u8fd8\u53ef\u4ee5\u7b80\u5199\u4e3a <code>[ ]</code>, \u9700\u8981\u5728\u4e24\u8fb9\u4e2d\u62ec\u53f7\u4e0e expression \u662f\u6709\u4e00\u4e2a\u7a7a\u683c\uff0c\u8fd9\u4e2a\u7a7a\u683c\u662f\u5fc5\u987b\u7684\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u8bed\u6cd5\u9519\u8bef\u3002<code>[]</code> \u7684\u5199\u6cd5\u66f4\u52a0\u7b80\u6d01\uff0c\u6bd4 test \u4f7f\u7528\u9891\u7387\u66f4\u9ad8\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u6765\u770b\u793a\u4f8b\uff1a</p> <pre><code>[root@master shell_test]# cat test1.sh \n#!/bin/bash\n// \u4f7f\u7528\u4e2d\u62ec\u53f7\nif test 10 -ne 1;then\n        echo \"true\"\nelse\n        echo \"false\"\nfi\n[root@master shell_test]# bash test1.sh \ntrue\n[root@master shell_test]# cat test2.sh \n#!/bin/bash\n// \u4f7f\u7528test\nif [ 10 -eq 1 ];then\n        echo \"true\"\nelse\n        echo \"false\"\nfi\n[root@master shell_test]# bash test2.sh \ntrue\n</code></pre>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#3-test","title":"3. test \u547d\u4ee4\u64cd\u4f5c","text":"<p>test \u547d\u4ee4\u64cd\u4f5c\u4e3b\u8981\u914d\u5408\u6bd4\u8f83\u8fd0\u7b97\u7b26\u8fdb\u884c\uff0c\u53ef\u5927\u4f53\u5206\u4e3a\u6587\u4ef6\u5224\u65ad / \u6570\u7ec4\u6bd4\u8f83 / \u5b57\u7b26\u4e32\u5224\u65ad / \u903b\u8f91\u8fd0\u7b97\u7b49\u3002</p>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#31","title":"3.1 \u6570\u503c\u6bd4\u8f83","text":"<p>\u6570\u7ec4\u6bd4\u8f83\u5176\u5b9e\u5c31\u662f test \u547d\u4ee4\u914d\u5408\u5173\u7cfb\u8fd0\u7b97\u7b26\u8fdb\u884c\u6570\u5b57\u6bd4\u8f83\u3002</p> \u6bd4\u8f83\u7b26 \u63cf\u8ff0 \u793a\u4f8b -eq\uff0cequal \u7b49\u4e8e [1 -eq 1] \u4e3a true -ne\uff0cnot equal \u4e0d\u7b49\u4e8e [ 1 -ne 1 \u4e3a false -gt\uff0cgreater than \u5927\u4e8e [2 -gt 1] \u4e3a true -lt\uff0clesser than \u5c0f\u4e8e [2 -lt 1] \u4e3a false -ge\uff0cgreater or equal \u5927\u4e8e\u6216\u7b49\u4e8e [2 -ge 1] \u4e3a true -le\uff0clesser or equal \u5c0f\u4e8e\u6216\u7b49\u4e8e [2 -le 1] \u4e3a false <p>\u5173\u7cfb\u8fd0\u7b97\u987e\u540d\u601d\u4e49\u5c31\u662f\u6bd4\u8f83\u6570\u5b57\u7684\u5927\u5c0f\uff0c\u6ce8\u610f\u5173\u7cfb\u8fd0\u7b97\u7b26\u4f5c\u7528\u7684\u5bf9\u8c61\u4e3a\u6570\u5b57\u3002</p> <pre><code>#!/bin/bash\n\nnum1=1\nnum2=2\necho \"num1 \u4e3a\uff1a${num1}\"\necho \"num2 \u4e3a\uff1a${num2}\"\n\n\nif [ $num1 -eq $num2 ]\nthen\n   echo \"$num1 -eq $num2 : num1 \u7b49\u4e8e num2\"\nelse\n   echo \"$num1 -eq $num2: num1 \u4e0d\u7b49\u4e8e num2\"\nfi\nif [ $num1 -ne $num2 ]\nthen\n   echo \"$num1 -ne $num2: num1 \u4e0d\u7b49\u4e8e num2\"\nelse\n   echo \"$num1 -ne $num2 : num1 \u7b49\u4e8e num2\"\nfi\nif [ $num1 -gt $num2 ]\nthen\n   echo \"$num1 -gt $num2: num1 \u5927\u4e8e num2\"\nelse\n   echo \"$num1 -gt $num2: num1 \u4e0d\u5927\u4e8e num2\"\nfi\nif [ $num1 -lt $num2 ]\nthen\n   echo \"$num1 -lt $num2: num1 \u5c0f\u4e8e num2\"\nelse\n   echo \"$num1 -lt $num2: num1 \u4e0d\u5c0f\u4e8e num2\"\nfi\nif [ $num1 -ge $num2 ]\nthen\n   echo \"$num1 -ge $num2: num1 \u5927\u4e8e\u6216\u7b49\u4e8e num2\"\nelse\n   echo \"$num1 -ge $num2: num1 \u5c0f\u4e8e num2\"\nfi\nif [ $num1 -le $num2 ]\nthen\n   echo \"$num1 -le $num2: num1 \u5c0f\u4e8e\u6216\u7b49\u4e8e num2\"\nelse\n   echo \"$num1 -le $num2: num1 \u5927\u4e8e num2\"\nfi\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\u4e3a\uff1a</p> <pre><code>num1 \u4e3a\uff1a1\nnum2 \u4e3a\uff1a2\n1 -eq 2: num1 \u4e0d\u7b49\u4e8e num2\n1 -ne 2: num1 \u4e0d\u7b49\u4e8e num2\n1 -gt 2: num1 \u4e0d\u5927\u4e8e num2\n1 -lt 2: num1 \u5c0f\u4e8e num2\n1 -ge 2: num1 \u5c0f\u4e8e num2\n1 -le 2: num1 \u5c0f\u4e8e\u6216\u7b49\u4e8e num\n</code></pre>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#32","title":"3.2 \u6587\u4ef6\u5224\u65ad","text":"<p>\u5728\u672c\u7ae0\u8282\u7531\u4e8e test \u547d\u4ee4\u4e0e\u8fd0\u7b97\u7b26\u914d\u5408\u4f7f\u7528\uff0c\u4e0e\u4e4b\u524d\u8fd0\u7b97\u7b26\u7ae0\u8282\u6709\u91cd\u590d\uff0c\u6211\u4eec\u5728\u6b64\u6e29\u6545\u77e5\u65b0\uff0c\u7740\u624b test \u547d\u4ee4\u6765\u5b66\u4e60\u6587\u4ef6\u5224\u65ad\u3002</p> <p>\u6587\u4ef6\u6d4b\u8bd5\u5728\u6211\u4eec\u7f16\u5199 Shell \u4e2d\u4e0e\u6587\u4ef6\u64cd\u4f5c\u975e\u5e38\u5e38\u7528\uff0c\u719f\u7ec3\u638c\u63e1\u6587\u4ef6\u64cd\u4f5c\u53ef\u4ee5\u5728\u540e\u7eed\u7684 Shell \u7f16\u5199\u4e2d\u5f97\u5fc3\u5e94\u624b\uff0c\u4f8b\u5982 file \u53d8\u91cf\u4e3a:</p> \u64cd\u4f5c\u7b26 \u8bf4\u660e \u4e3e\u4f8b -d file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u76ee\u5f55\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-d $file] \u8fd4\u56de false\u3002 -f file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u666e\u901a\u6587\u4ef6\uff08\u65e2\u4e0d\u662f\u76ee\u5f55\uff0c\u4e5f\u4e0d\u662f\u8bbe\u5907\u6587\u4ef6\uff09\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-f $file] \u8fd4\u56de true\u3002 -c file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5b57\u7b26\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-c $file] \u8fd4\u56de false\u3002 -b file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u5757\u8bbe\u5907\u6587\u4ef6\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-b $file] \u8fd4\u56de false\u3002 -g file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SGID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-g $file] \u8fd4\u56de false\u3002 -u file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86 SUID \u4f4d\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-u $file] \u8fd4\u56de false\u3002 -k file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u8bbe\u7f6e\u4e86\u7c98\u7740\u4f4d (Sticky Bit)\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-k $file] \u8fd4\u56de false\u3002 -p file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u662f\u6709\u540d\u7ba1\u9053\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-p $file] \u8fd4\u56de false\u3002 -r file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u8bfb\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-r $file] \u8fd4\u56de true\u3002 -w file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u5199\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-w $file] \u8fd4\u56de true\u3002 -x file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u53ef\u6267\u884c\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-x $file] \u8fd4\u56de true\u3002 -s file \u68c0\u6d4b\u6587\u4ef6\u662f\u5426\u4e3a\u7a7a\uff08\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u5927\u4e8e 0\uff09\uff0c\u4e0d\u4e3a\u7a7a\u8fd4\u56de true\u3002 [-s $file] \u8fd4\u56de true\u3002 -e file \u68c0\u6d4b\u6587\u4ef6\uff08\u5305\u62ec\u76ee\u5f55\uff09\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56de true\u3002 [-e $file] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\n\nTEST_FILE=\"/etc/fstab\"\necho \"\u68c0\u6d4b\u7684\u6587\u4ef6\u4e3a:${TEST_FILE}\"\necho \"\u6587\u4ef6\u4fe1\u606f\u4e3a:$(ls -l ${TEST_FILE})\"\n\n\nif [ -r $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u53ef\u8bfb\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u53ef\u8bfb\"\nfi\nif [ -w $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u53ef\u5199\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u53ef\u5199\"\nfi\nif [ -x $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u53ef\u6267\u884c\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u53ef\u6267\u884c\"\nfi\nif [ -f $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u4e3a\u666e\u901a\u6587\u4ef6\"\nelse\n   echo \"\u6587\u4ef6\u4e3a\u7279\u6b8a\u6587\u4ef6\"\nfi\nif [ -d $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u662f\u4e2a\u76ee\u5f55\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u662f\u4e2a\u76ee\u5f55\"\nfi\nif [ -s $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u4e0d\u4e3a\u7a7a\"\nelse\n   echo \"\u6587\u4ef6\u4e3a\u7a7a\"\nfi\nif [ -e $TEST_FILE ]\nthen\n   echo \"\u6587\u4ef6\u5b58\u5728\"\nelse\n   echo \"\u6587\u4ef6\u4e0d\u5b58\u5728\"\nfi\n</code></pre> <p>\u8fd4\u56de\u4e3a\uff1a</p> <pre><code>\u68c0\u6d4b\u7684\u6587\u4ef6\u4e3a:/etc/fstab\n\u6587\u4ef6\u4fe1\u606f\u4e3a:-rw-r--r--. 1 root root 500 Jan 17 14:23 /etc/fstab\n\u6587\u4ef6\u53ef\u8bfb\n\u6587\u4ef6\u53ef\u5199\n\u6587\u4ef6\u4e0d\u53ef\u6267\u884c\n\u6587\u4ef6\u4e3a\u666e\u901a\u6587\u4ef6\n\u6587\u4ef6\u4e0d\u662f\u4e2a\u76ee\u5f55\n\u6587\u4ef6\u4e0d\u4e3a\u7a7a\n\u6587\u4ef6\u5b58\u5728\n</code></pre>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#33","title":"3.3 \u5b57\u7b26\u4e32\u5224\u65ad","text":"<p>\u5bf9\u4e8e\u5b57\u7b26\u4e32\u5224\u65ad\u4e0e\u6570\u5b57\u5bf9\u6bd4\uff0c\u5176\u4f5c\u7528\u7684\u5bf9\u8c61\u4e0d\u540c\u9700\u8981\u683c\u5916\u6ce8\u610f\uff0c\u5229\u7528 test \u547d\u4ee4\u5bf9\u4e8e\u5b57\u7b26\u4e32\u8fdb\u884c\u4e00\u4e9b\u5224\u65ad\u64cd\u4f5c\uff0c\u5047\u5b9a\u53d8\u91cf a \u4e3a \u201clinux\u201d\uff0c\u53d8\u91cf b \u4e3a \u201cshell\u201d\uff1a</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b \u2260= \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\uff0c\u5176\u4e2d = \u548c == \u662f\u76f8\u540c\u7684\uff0c\u76f8\u7b49\u8fd4\u56de true\u3002 [$a = $b] \u8fd4\u56de false\u3002 != \u68c0\u6d4b\u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\uff0c\u4e0d\u76f8\u7b49\u8fd4\u56de true\u3002 [$a != $b] \u8fd4\u56de true\u3002 -z \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e3a 0\uff0c\u4e3a 0 \u8fd4\u56de true\u3002 [-z $a] \u8fd4\u56de false\u3002 -n \u68c0\u6d4b\u5b57\u7b26\u4e32\u957f\u5ea6\u662f\u5426\u4e3a 0\uff0c\u4e0d\u4e3a 0 \u8fd4\u56de true\u3002 [-n \u201c$a\u201d ] \u8fd4\u56de true\u3002 <p>\u4f8b\u5982\uff1a</p> <pre><code>#!/bin/bash\n\nstr1=\"linux\"\nstr2=\"shell\"\n\necho \"str1 \u4e3a\uff1a${str1}\"\necho \"str2 \u4e3a\uff1a${str2}\"\n\nif [ $str1 = $str2 ];then\n   echo \"$str1 = $str2 : str1 \u7b49\u4e8e str2\"\nelse\n   echo \"$str1 = $str2: str1 \u4e0d\u7b49\u4e8e str2\"\nfi\nif [ $str1 != $str2 ];then\n   echo \"$str1 != $str2 : str1 \u4e0d\u7b49\u4e8e str2\"\nelse\n   echo \"$str1 != $str2: str1 \u7b49\u4e8e str2\"\nfi\nif [ -z $str1 ];then\n   echo \"-z $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a 0\"\nelse\n   echo \"-z $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\"\nfi\nif [ -n \"$str1\" ];then\n   echo \"-n $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\"\nelse\n   echo \"-n $str1 : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e3a 0\"\nfi\nif [ ${str1} ];then\n   echo \"str1 : \u5b57\u7b26\u4e32\u4e0d\u4e3a\u7a7a\"\nelse\n   echo \"str1 : \u5b57\u7b26\u4e32\u4e3a\u7a7a\"\nfi\n</code></pre> <p>\u8fd4\u56de\u4e3a\uff1a</p> <pre><code>str1 \u4e3a\uff1alinux\nstr2 \u4e3a\uff1ashell\nlinux = shell: str1 \u4e0d\u7b49\u4e8e str2\nlinux != shell : str1 \u4e0d\u7b49\u4e8e str2\n-z linux : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\n-n linux : \u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u4e3a 0\nstr1 : \u5b57\u7b26\u4e32\u4e0d\u4e3a\u7a7a   \n</code></pre>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#34","title":"3.4 \u903b\u8f91\u8fd0\u7b97","text":"<p>\u5229\u7528 test \u547d\u4ee4\u53ef\u4ee5\u8fdb\u884c\u903b\u8f91\u5224\u65ad\uff0c\u4ee5\u4e0b\u4ecb\u7ecd Shell \u7684\u903b\u8f91\u8fd0\u7b97\u7b26\uff0c\u5047\u5b9a\u53d8\u91cf A \u4e3a 1\uff0c\u53d8\u91cf b \u4e3a 2\uff1a</p> <p>\u5982\u679c\u9700\u8981\u5728\u4e00\u4e2a test \u4e2d\u6267\u884c\u591a\u4e2a\u5224\u65ad\uff0c\u9700\u8981\u4f7f\u7528 <code>[[]]</code>, test \u662f Shell \u5185\u7f6e\u5173\u952e\u5b57\uff0c\u4e0d\u662f\u547d\u4ee4\uff0c\u514d\u9664\u51fd\u6570\u4f20\u9012\u8fc7\u7a0b\uff0c\u56e0\u6b64\u66f4\u52a0\u5efa\u8bae\u4f7f\u7528 <code>[[]]</code>\u3002\u53cc\u4e2d\u62ec\u53f7\u6709\u4e00\u4e0b\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u4e0d\u9700\u8981\u628a\u53d8\u91cf\u540d\u7528\u53cc\u5f15\u53f7 <code>\"\"</code> \u5305\u56f4\u8d77\u6765\uff0c\u5373\u4f7f\u53d8\u91cf\u662f\u7a7a\u503c\uff0c\u4e5f\u4e0d\u4f1a\u51fa\u9519\uff1b</li> <li>\u4e0d\u9700\u8981\u3001\u4e5f\u4e0d\u80fd\u5bf9 &gt;\u3001&lt; \u8fdb\u884c\u8f6c\u4e49\uff0c\u8f6c\u4e49\u540e\u4f1a\u51fa\u9519\uff1b</li> <li>\u5176\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u7ec4\u5408\u903b\u8f91\u53ef\u4ee5\u4e0d\u4f7f\u7528 test \u7684 - a,-o \u800c\u4f7f\u7528 &amp;&amp; ||\u3002</li> </ul> <p>\u4e0e\u903b\u8f91\u8fd0\u7b97\u7b26\u53f7\u5bf9\u5e94\u7684 <code>&amp;&amp;</code> \u53ef\u4ee5\u4f7f\u7528 <code>-a</code>\uff0c<code>||</code> \u53ef\u4ee5\u4f7f\u7528 <code>-o</code> \u6765\u66ff\u6362\u3002</p> \u8fd0\u7b97\u7b26 \u8bf4\u660e \u4e3e\u4f8b &amp;&amp; \u903b\u8f91\u7684 AND <code>[[ $A -lt 10 &amp;&amp; $B -gt 100 ]] \u8fd4\u56de false</code> || \u903b\u8f91\u7684 OR <code>[[ $A -lt 10 || $B -gt 100 ]] \u8fd4\u56de true</code> <p>\u4f8b\u5982:</p> <pre><code>#!/bin/bash\n\nnum1=1\nnum2=2\n\necho \"num1 \u4e3a:${num1}\"\necho \"num2 \u4e3a:${num2}\"\n\nif [[ $num1 -lt 5 &amp;&amp; $num2 -gt 5 ]];then\n   echo \"\u8fd4\u56de true\"\nelse\n   echo \"\u8fd4\u56de false\"\nfi\n\nif [[ $num1 -lt 5 || $num2 -gt 5 ]];then\n   echo \"\u8fd4\u56de true\"\nelse\n   echo \"\u8fd4\u56de false\"\nfi\n\nif [ $num1 -lt 5 ] &amp;&amp; [ $num2 -gt 5 ];then\n   echo \"\u8fd4\u56de true\"\nelse\n   echo \"\u8fd4\u56de false\"\nfi\n\nif [ $num1 -lt 5 ] || [ $num2 -gt 5 ];then\n   echo \"\u8fd4\u56de true\"\nelse\n   echo \"\u8fd4\u56de false\"\nfi\n\n\nif [ $num1 -lt 5  -a  $num2 -gt 5 ];then\n   echo \"\u8fd4\u56de true\"\nelse\n   echo \"\u8fd4\u56de false\"\nfi\n\nif [ $num1 -lt 5 -o  $num2 -gt 5 ];then\n   echo \"\u8fd4\u56de true\"\nelse\n   echo \"\u8fd4\u56de false\"\nfi\n</code></pre> <p>\u8fd4\u56de\uff1a</p> <pre><code>num1 \u4e3a:1\nnum2 \u4e3a:2\n\u8fd4\u56de false\n\u8fd4\u56de true\n\u8fd4\u56de false\n\u8fd4\u56de true\n\u8fd4\u56de false\n\u8fd4\u56de true\n</code></pre>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#4","title":"4. \u5b9e\u4f8b","text":""},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#41","title":"4.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u53ef\u4ee5\u4f20\u5165\u4efb\u610f\u591a\u4e2a\u6570\u503c\uff0c\u8981\u6c42\u8f93\u5165\u7684\u6570\u5b57\u5927\u4e8e\u7b49\u4e8e 0\uff0c\u811a\u672c\u6267\u884c\u8f93\u51fa\u6700\u5c0f\u7684\u548c\u6700\u5927\u7684\u6570\u5b57\u3002</p>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#42","title":"4.2 \u601d\u8def","text":"<p>\u53ef\u4ee5\u5229\u7528\u6587\u4ef6\u6d4b\u8bd5\u8fd0\u7b97\u7b26\u6765\u5224\u65ad\u8f93\u51fa\u7684\u76ee\u5f55\u662f\u5426\u6b63\u786e\uff0c\u4e4b\u540e\u5229\u7528\u7b97\u672f\u8fd0\u7b97\u7b26\u914d\u5408\u6570\u7ec4\u5bf9\u6587\u4ef6\u6216\u76ee\u5f55\u8fdb\u884c\u7edf\u8ba1\u3002</p>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#43","title":"4.3 \u5b9e\u73b0","text":"<pre><code>#!/bin/bash\n# Description: count file scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: count file\n# Date: 2020-03-21 14:00\n# Version: 1.0\n\n# \u5224\u65ad\u8f93\u5165\u81f3\u5c11\u4e00\u4e2a\u53c2\u6570\n[ $# -le 1 ] &amp;&amp; echo \"\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\" &amp;&amp; exit 1\nfor num in $*;\ndo\n        # \u5224\u65ad\u8f93\u5165\u7684\u90fd\u4e3a\u6570\u5b57\u4e14\u8f93\u5165\u6570\u5b57\u5927\u4e8e\u7b49\u4e8e0\n        [ \"${num}\" -ge 0 ] 2&gt;/dev/null\n        [ $? -ne 0 ] &amp;&amp; echo \"\u8f93\u5165\u7684${num}\u4e0d\u7b26\u5408\u53c2\u6570\u89c4\u8303\" &amp;&amp; exit 1\ndone\n\n# \u5bf9\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u7edf\u8ba1\nMIN_NUM=$1\nMAX_NUM=$1\n\nfor num in $*;\ndo\n        if [    ${num} -gt ${MAX_NUM}   ];then\n                MAX_NUM=${num}\n        elif [ ${num} -lt ${MIN_NUM} ];then\n                MIN_NUM=${num}\n        else\n                echo -e \"\"\n        fi\ndone\n\necho \"\u8f93\u5165\u7684\u53c2\u6570\u603b\u5171\u4e3a\uff1a$#\"\necho \"\u8f93\u5165\u7684\u6570\u5b57\u4e3a\uff1a$*\"\necho \"\u5176\u4e2d\u6700\u5927\u7684\u6570\u5b57\u4e3a\uff1a${MAX_NUM}\"\necho \"\u5176\u4e2d\u6700\u5c0f\u7684\u6570\u5b57\u4e3a\uff1a${MIN_NUM}\"\n</code></pre>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#44","title":"4.4 \u6d4b\u8bd5","text":"<p>\u5f53\u6211\u4eec\u4e0d\u8f93\u5165\u4efb\u4f55\u53c2\u6570\uff0c\u6216\u8f93\u5165\u5355\u4e2a\u53c2\u6570\u7684\u65f6\u5019\uff0c\u63d0\u793a\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\uff1b</p> <p>\u5982\u679c\u8f93\u5165\u6709\u5305\u542b\u5b57\u7b26\u4e32\uff0c\u5219\u63d0\u793a\u53c2\u6570\u4e0d\u89c4\u8303\uff1b</p> <p>\u5f53\u8f93\u5165\u4e00\u4e9b\u5217\u6570\u5b57\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\u3002</p> <pre><code>[root@master shell_test]# bash num_check.sh \n\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\n[root@master shell_test]# bash num_check.sh 1\n\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c\u81f3\u5c11\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\n[root@master shell_test]# bash num_check.sh 1 \"hell\"\n\u8f93\u5165\u7684hell\u4e0d\u7b26\u5408\u53c2\u6570\u89c4\u8303\n[root@master shell_test]# bash num_check.sh 12 13 32 435 0\n\n\u8f93\u5165\u7684\u53c2\u6570\u603b\u5171\u4e3a\uff1a5\n\u8f93\u5165\u7684\u6570\u5b57\u4e3a\uff1a12 13 32 435 0\n\u5176\u4e2d\u6700\u5927\u7684\u6570\u5b57\u4e3a\uff1a435\n\u5176\u4e2d\u6700\u5c0f\u7684\u6570\u5b57\u4e3a\uff1a\n</code></pre>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#4_1","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5bf9\u4e8e\u5173\u7cfb\u8fd0\u7b97\uff0ctest \u547d\u4ee4\u6bd4\u8f83\u7684\u5bf9\u8c61\u4e3a\u6570\u5b57\uff0c\u4e0d\u662f\u5b57\u7b26\u4e32\uff0c\u4e00\u5b9a\u8981\u7262\u8bb0\u8fd9\u4e2a\u6ce8\u610f\u70b9\uff1b</li> <li>\u5bf9\u4e8e\u5b57\u7b26\u4e32\u5224\u65ad\uff0ctest \u547d\u4ee4\u4f5c\u7528\u7684\u4e3a\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u60f3\u6bd4\u8f83\u6570\u5b57\uff0c\u53ef\u4ee5\u5229\u7528\u53cc\u5f15\u53f7\u5f15\u8d77\u6765\u901a\u8fc7\u5b57\u7b26\u4e32\u5224\u65ad\u3002</li> </ul>"},{"location":"linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/#5","title":"5. \u5c0f\u7ed3","text":"<p>\u5728\u672c\u7ae0\u8282\u7531\u4e8e test \u547d\u4ee4\u4e0e\u8fd0\u7b97\u7b26\u914d\u5408\u4f7f\u7528\uff0c\u4e0e\u4e4b\u524d\u8fd0\u7b97\u7b26\u7ae0\u8282\u6709\u91cd\u590d\uff0c\u5728\u6b64\u6e29\u6545\u77e5\u65b0\uff0c\u901a\u8fc7\u793a\u4f8b\u6765\u66f4\u52a0\u719f\u6089 test \u547d\u4ee4\u53ca\u76f8\u5173\u8fd0\u7b97\u7b26\uff0c\u5176\u662f\u540e\u671f Shell \u811a\u672c\u7f16\u5199\u7684\u6d41\u7a0b\u6846\u67b6\uff0c\u719f\u7ec3\u638c\u63e1 test \u547d\u4ee4\u7684\u6570\u503c\uff0c\u6587\u4ef6\uff0c\u5b57\u7b26\u4e32\u4e0e\u903b\u8f91\u8fd0\u7b97\uff0c\u4f7f\u5f97\u6211\u4eec\u7f16\u5199 Shell \u811a\u672c\u66f4\u52a0\u5f97\u5fc3\u5e94\u624b\u3002</p>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/","title":"8.Shell \u6d41\u7a0b\u63a7\u5236","text":""},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#1","title":"1. \u6d41\u7a0b\u63a7\u5236\u6982\u8ff0","text":""},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#11","title":"1.1 \u6d41\u7a0b\u63a7\u5236\u7b80\u4ecb","text":"<p>Shell \u811a\u672c\u9ed8\u8ba4\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u6267\u884c\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u4e2d\uff0c\u4f1a\u9047\u5230\u5f88\u591a\u79cd\u60c5\u51b5\uff0c\u5bf9\u5e94\u4e0d\u540c\u60c5\u51b5\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u5bf9\u4e8e\u4e00\u6279\u6570\u636e\u9700\u8981\u8fdb\u884c\u6267\u884c\u91cd\u590d\u5de5\u4f5c\uff0c\u8fd9\u4e9b\u90fd\u9700\u8981\u6211\u4eec\u4f7f\u7528\u7279\u5b9a\u7684\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u6765\u5b9e\u73b0\uff0c\u6211\u4eec\u60f3\u8981\u7a0b\u5e8f\u5b8c\u6210\u9884\u5b9a\u7684\u64cd\u4f5c\uff0c\u5c31\u9700\u8981\u719f\u7ec3\u638c\u63e1\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\uff0c\u4e0d\u540c\u7684\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u6709\u4e0d\u540c\u7684\u9002\u5e94\u573a\u666f\u3002</p>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u6d41\u7a0b\u63a7\u5236","text":"<p>\u6d41\u7a0b\u63a7\u5236\u662f\u6bcf\u79cd\u7f16\u7a0b\u8bed\u8a00\u63a7\u5236\u903b\u8f91\u8d70\u5411\u548c\u6267\u884c\u6b21\u5e8f\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u6d41\u7a0b\u63a7\u5236\u53ef\u4ee5\u8bf4\u662f\u4e00\u95e8\u8bed\u8a00\u7684 \u201c\u7ecf\u8109\u201d\uff0c\u5176\u63a7\u5236\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\u8d70\u5411\uff0c\u6240\u4ee5\u719f\u7ec3\u638c\u63e1\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u624d\u80fd\u66f4\u597d\u7684\u63a7\u5236\u6574\u4e2a\u811a\u672c\u7684\u8fd0\u884c\u7ed3\u679c\uff0c\u6765\u5b8c\u6210\u6211\u4eec\u7684\u9700\u6c42\u3002</p>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#2-shell","title":"2. Shell \u6d41\u7a0b\u63a7\u5236\u64cd\u4f5c","text":""},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#21","title":"2.1 \u6761\u4ef6\u8bed\u53e5","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u6267\u884c\u5bf9\u5e94\u64cd\u4f5c\uff0c\u6309\u7167\u987a\u5e8f\u4ece\u4e0a\u5230\u4e0b\uff0c\u6761\u4ef6\u8bed\u53e5 if \u901a\u5e38\u9700\u8981\u4e0e test \u547d\u4ee4\u914d\u5408\u4f7f\u7528\uff0c\u5f53\u6ee1\u8db3\u6761\u4ef6\u5219\u6267\u884c <code>then</code> \u540e\u7684 command\uff0c\u5426\u5219\u7ee7\u7eed\u5f80\u4e0b\u8fd0\u884c\u6267\u884c\u5bf9\u5e94\u7684 command\uff0c\u6761\u4ef6\u8bed\u53e5 if \u662f Shell \u7f16\u7a0b\u4e2d\u6700\u57fa\u7840\u7684\u6761\u4ef6\u5224\u65ad\u6d41\u7a0b\u8bed\u53e5\u3002</p>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#211-if","title":"2.1.1 \u5355\u5206\u652f if \u8bed\u53e5","text":"<p>\u987e\u540d\u601d\u4e49\u5c31\u662f\u53ea\u6709\u4e00\u4e2a if \u8bed\u53e5\u5757\u5305\u542b\u7684\u8bed\u53e5\uff0ccondition \u4e3a\u6b63\u786e\u5219\u6267\u884c then \u5185\u7684\u547d\u4ee4\uff0c\u8bed\u6cd5\uff1a</p> <pre><code>if condition\nthen\n    command1 \n    command2\n    ...\n    commandN \nfi\n</code></pre> <p>\u5bf9\u4e8e sshd \u8fdb\u7a0b\u662f\u5426\u5b58\u5728\uff0c\u53ef\u4ee5\u4f7f\u7528\u5355\u5206\u652f if \u8bed\u53e5\u6765\u5224\u65ad\uff0c\u4f8b\u5982\uff1a</p> <pre><code>if [ $(ps -ef |grep /usr/sbin/sshd|grep -v grep|wc -l) -eq 1 ];then \n    echo \"sshd server exist\"\nfi\n</code></pre>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#212-if","title":"2.1.2 \u53cc\u5206\u652f if \u8bed\u53e5","text":"<p>\u591a\u5206\u652f if \u8bed\u53e5\u5b58\u5728 else \u60c5\u51b5\uff0c\u8bed\u6cd5\uff1a</p> <pre><code>if condition\nthen\n    command1 \n    command2\n    ...\n    commandN\nelse\n    command\nfi\n</code></pre> <p>\u7edf\u4e00\u5224\u65ad sshd \u670d\u52a1\uff0c\u53ef\u4ee5\u5728 else \u4e2d\u8fdb\u884c\u4e00\u4e9b\u5217\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>if [ $(ps -ef |grep /usr/sbin/sshd|grep -v grep|wc -l) -eq 1 ];then \n    echo \"sshd server exist\"\nelse\n    service sshd start &amp;&amp; echo \"\u542f\u52a8sshd\u670d\u52a1\"\nfi\n</code></pre>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#213-if","title":"2.1.3 \u591a\u5206\u949f if \u8bed\u53e5","text":"<p>\u987e\u540d\u601d\u4e49\u6709\u591a\u4e2a if \u6761\u4ef6\uff0c\u5728\u6b64\u5229\u7528 elif \u6765\u8868\u793a\uff0c\u6ce8\u610f\u6700\u540e\u6709\u4e00\u4e2a else \u7ed3\u5c3e\u3002</p> <pre><code>if condition1;then\n    command1\nelif condition2;then \n    command2\n    ...\n...\nelif conditionN,then\n        commandN\nelse\n    command\nfi\n</code></pre> <p>\u6211\u4eec\u7684 linux \u7cfb\u7edf\u6709\u591a\u4e2a\u7248\u672c\uff0c\u53ef\u4ee5\u5229\u7528\u591a\u5206\u652f if \u8bed\u53e5\u6765\u8fdb\u884c\u5224\u65ad\uff0c\u4f8b\u5982\uff1a</p> <pre><code>#! /bin/bash\n\nsys_version=$(rpm -q centos-release|cut -d- -f3)\n\nif [ $sys_version -eq 6 ];then\n    echo \"sysversion is $sys_version\"\nelif [ $sys_version -eq 7 ];then\n    echo \"sysversion is $sys_version\"\nelse\n    echo \"sysversion is ${sys_version}\"\nfi\n</code></pre>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#22","title":"2.2 \u5faa\u73af\u8bed\u53e5","text":"<p>\u5bf9\u4e8e\u4e00\u6279\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5176\u91cd\u590d\u8fdb\u884c\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5229\u7528\u5faa\u73af\u8bed\u53e5\u6765\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#221-for","title":"2.2.1 for \u5faa\u73af","text":"<p>for \u5faa\u73af\u8bed\u53e5\u901a\u5e38\u5e94\u7528\u5728\u53ef\u9884\u4f30\u6570\u91cf\u7684\u4e00\u6279\u5bf9\u8c61\u64cd\u4f5c\u4e2d\uff0c\u9ed8\u8ba4 for \u5faa\u73af\u7684\u53d6\u503c\u5217\u8868\u662f\u4ee5 <code>$IFS</code> \u5206\u5272\uff0c\u9ed8\u8ba4 <code>$IFS</code> \u4e3a\u7a7a\u767d\u7b26\uff0c\u5982\u679c\u6211\u4eec\u6709\u5176\u4ed6\u9700\u6c42\u53ef\u4ee5\u66f4\u6539\uff0c\u8bed\u6cd5\u4e3a\uff1a</p> <pre><code>for var in item1 item2 ... itemN\ndo\n    command1\n    command2\n    ...\n    commandN\ndone\n</code></pre> <p>\u901a\u8fc7 for \u5faa\u73af\u6bcf\u6b21\u904d\u5386\u4e00\u4e2a\u540e\u9762\u8ddf\u7684\u5bf9\u8c61\uff0c\u5728 <code>do\u2026done</code> \u64cd\u4f5c\u5757\u4e2d\u5bf9\u5bf9\u8c61\u8fdb\u884c\u4e00\u4e9b\u5217\u64cd\u4f5c\u3002</p> <p>\u4f8b\u5982\u6211\u4eec\u6765\u6c42\u548c 1-10 \u7684\u548c\uff1a</p> <pre><code>SUM=0\nfor num in $(seq 1 10)\ndo\n        let SUM=${SUM}+${num}\ndone\necho \"1-10\u7684\u548c\u4e3a\uff1a${SUM}\"\n</code></pre> <p>\u5f53\u7136\u5728 for \u5faa\u73af\u8bed\u53e5\u91cc\u9762\u4e5f\u53ef\u4ee5\u914d\u5408 if \u6761\u4ef6\u5224\u65ad\u6216\u5176\u4ed6\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u5728\u6b64\u6211\u4eec\u4e3e\u4f8b\u4fee\u6539 <code>$IFS</code> \u7684\u5e94\u7528\u573a\u666f\uff0c\u9996\u9009\u5907\u4efd\u9ed8\u8ba4\u5f53\u524d\u7684 <code>$IFS</code>\uff0c\u4e4b\u540e\u4e3a\u5176\u8d4b\u503c\u65b0\u7684 <code>$IFS</code> \u4e3a<code>:</code>\uff0c\u5728\u5bf9 /etc/passwd \u8fdb\u884c\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u6062\u590d\u4e4b\u524d\u7684 <code>$IFS</code>, \u5728\u6b64\u6211\u4eec\u5c31\u5229\u7528\u6539\u53d8 <code>$IFS</code> \u5bf9 /etc/passwd \u7684\u5355\u4e2a\u5b57\u6bb5\u8fdb\u884c\u4e86\u53d8\u91cf\u64cd\u4f5c\u3002</p> <pre><code>#!/bin/bash\nOLD_IFS=$IFS\nIFS=\":\"\nfor i in $(head -1 /etc/passwd); do\necho $i\ndone\nIFS=${OLD_IFS}\n[root@xuel-terraform-cvm-0 ~]# bash 1.sh\nroot\nx\n0\n0\nroot\n/root\n/bin/bash\n[root@xuel-terraform-cvm-0 ~]# cat /etc/passwd |head -1\nroot:x:0:0:root:/root:/bin/bash\n</code></pre> <p>for \u5faa\u73af\u5982\u679c\u6761\u4ef6\u6c38\u8fdc\u6ee1\u8db3\u5219\uff0c\u4e00\u76f4\u6267\u884c\u5185\u90e8\u7684\u547d\u4ee4\u3002</p> <pre><code>for (( ; ; ))\n</code></pre>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#222-while","title":"2.2.2 while \u5faa\u73af","text":"<p>while \u5faa\u73af\u540c\u6837\u4e3a\u5faa\u73af\uff0c\u4e0e for \u5faa\u73af\u529f\u80fd\u4e00\u6837\uff0c\u5229\u7528 for \u5faa\u73af\u7684\u8bed\u53e5\u540c\u6837\u4e5f\u53ef\u4ee5\u4f7f\u7528 while \u5faa\u73af\u5b8c\u6210\uff0c\u4f46\u662f while \u5faa\u73af\u901a\u5e38\u7528\u4e8e\u5904\u7406\u672a\u77e5\u6570\u91cf\u5bf9\u8c61\u7684\u64cd\u4f5c\uff0c\u8bed\u6cd5\uff1a</p> <pre><code>while \u6761\u4ef6\u8868\u8fbe\u5f0f:do\n    command\ndone\n</code></pre> <p>while \u901a\u5e38\u4e0e test \u8bed\u53e5\u914d\u5408\u4f7f\u7528\uff0c\u5982\u679c\u6761\u4ef6\u8868\u8fbe\u5f0f\u6210\u7acb\uff0c\u5219\u4e00\u76f4\u6267\u884c\u3002</p> <p>\u4f8b\u5982\u6c42\u548c\u6253\u5370 1-5 \u4e2a\u6570\uff1a</p> <pre><code>#!/bin/bash\nN=0\nwhile [ $N -lt 5 ]; do\n  let N++\n  echo $N\ndone\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5229\u7528 read \u8bfb\u5165\u6587\u4ef6\uff0c\u4f8b\u5982\u6211\u4eec\u6765\u8bfb\u5165\u4e00\u4e2a\u5199\u6709 ip \u6216\u57df\u540d\u5217\u8868\u7684\u6587\u4ef6\uff0c\u6765\u5224\u65ad\u8be5\u6587\u4ef6\u5185\u7684\u57df\u540d\u6216 IP \u7f51\u7edc\u662f\u5426\u53ef\u8fbe\u3002</p> <pre><code>#!/bin/bash\n#function:check url\nfilename=urllist.txt\nfor url in $(cat $filename)\ndo\n  status=`curl -I --connect-timeout 5 $url -s|awk '/HTTP/{print $2}'`\n  if [[ $status == \"200\" ]];then\n          echo \"Url:$url is ok!   status is $status\"\n  else\n          echo \"Url:$url is error! status is $status\"\n  fi\ndone\n</code></pre> <p>\u7f16\u5199 <code>urllist.txt</code>\u3002</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# cat urllist.txt\nbaidu.com\n114.114.114.114\n[root@xuel-terraform-cvm-0 ~]# bash urlcheck.sh\nUrl:baidu.com is ok!   status is 200\nUrl:114.114.114.114 is error! status is\n</code></pre> <p>\u5982\u679c while \u7684\u5224\u65ad\u6761\u4ef6\u4e3a\u6c38\u8fdc\u4e3a true\uff0c\u5219\u79f0\u4e3a\u65e0\u9650\u5faa\u73af\uff0c\u4f1a\u4e00\u76f4\u6267\u884c\u5185\u90e8\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>while :\ndo\n    command\ndone\n\n\u6216\u8005\nwhile true\ndo\n    command\ndone\n</code></pre>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#223-until","title":"2.2.3 until \u5faa\u73af","text":"<p>until \u5faa\u73af\u4e0e while \u5faa\u73af\u521a\u597d\u76f8\u53cd\uff0c\u5176\u4e5f\u6709\u4e00\u5b9a\u7684\u5e94\u7528\u573a\u666f\uff0c\u5176\u4e3a\u6761\u4ef6\u8868\u8fbe\u5f0f\u4e3a true \u65f6\u505c\u6b62\uff0c\u5426\u5219\u4e00\u76f4\u8fd0\u884c\uff0c\u8bed\u6cd5\uff1a</p> <pre><code>until \u6761\u4ef6\u8868\u8fbe\u5f0f\ndo\n    command\ndone\n</code></pre> <p>\u4f8b\u5982\u6211\u4eec\u4f7f\u7528 until \u6765\u6253\u5370 1-5 \u6570\u5b57\uff1a</p> <pre><code>NUM=0\nuntil [ ${NUM} -ge 5 ]\ndo \n    let NUM++\n    echo $NUM\ndone\n</code></pre>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#224-break-continue","title":"2.2.4 break \u4e0e continue","text":"<p>\u4e0e\u4e0a\u9762\u4e09\u4e2a\u5faa\u73af\u8bed\u53e5\u4e0d\u540c\u7684\u662f\uff0cbreak \u4e3a\u8df3\u51fa\u5faa\u73af\uff0ccontinue \u5219\u4e3a\u4e0d\u6267\u884c\u4e0b\u4e00\u6b21\u64cd\u4f5c\uff0c\u76f4\u63a5\u8df3\u5230\u4e0b\u4e00\u6b21\u5faa\u73af\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6765\u5229\u7528 break \u6765\u8df3\u51fa\u7ec8\u6b62\u5faa\u73af\u3002</p> <ul> <li>break</li> </ul> <pre><code>#!/bin/bash\n\nN=0\nwhile true; do\n    let N++\n    if [ $N -eq 5 ]; then\n    break\n    fi\n    echo $N\ndone\n</code></pre> <ul> <li>continue</li> </ul> <pre><code>#!/bin/bash\nN=0\nwhile [ $N -lt 5 ]; do\n    let N++\n    if [ $N -eq 3 ]; then\n        continue\n    fi\n    echo $N\ndone\n</code></pre> <p>\u5229\u7528 continue \u6765\u8df3\u8fc7\u7279\u5b9a\u7684\u6761\u4ef6\u64cd\u4f5c\u3002</p>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#23","title":"2.3 \u9009\u62e9\u8bed\u53e5","text":""},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#231-case","title":"2.3.1 case \u8bed\u53e5","text":"<p>\u9009\u62e9\u8bed\u53e5 case \u53ef\u4ee5\u5728\u7279\u5b9a\u7684\u51e0\u4e2a\u6761\u4ef6\u4e2d\u9009\u62e9\u67d0\u4e00\u4e2a\u8fdb\u884c\u6267\u884c\uff0c\u5176\u4ed6 case \u53ef\u4ee5\u5229\u7528 if \u591a\u5206\u652f\u6765\u66ff\u4ee3\u3002</p> <pre><code>case \u6a21\u5f0f\u540d    in\n    \u6a21\u5f0f 1)\n        \u547d\u4ee4\n        ;;\n    \u6a21\u5f0f 2)\n        \u547d\u4ee4\n        ;;\n    *)\n        \u4e0d\u7b26\u5408\u4ee5\u4e0a\u6a21\u5f0f\u6267\u884c\u7684\u547d\u4ee4\nesac\n</code></pre> <p>\u4f8b\u5982\u6211\u4eec\u670d\u52a1\u7684\u542f\u52a8\u64cd\u4f5c\u811a\u672c\u5c31\u662f\u5229\u7528 case \u8bed\u53e5\u6765\uff0c\u5f53\u7528\u6237\u7684\u8f93\u5165\u4e0e\u6a21\u5f0f\u540d\u76f8\u5339\u914d\u5219\u6267\u884c\u5bf9\u5e94\u7684\u547d\u4ee4\u3002</p> <pre><code>#!/bin/bash\ncase $1 in\n    start)\n        echo \"start.\"   \n        ;;\n    stop)\n        echo \"stop.\"\n        ;;\n    restart)\n        echo \"restart.\"\n        ;;\n    *)\n        echo \"Usage: $0 {start|stop|restart}\"\nesac\n</code></pre>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#3","title":"3. \u5b9e\u4f8b","text":""},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#31","title":"3.1 \u9700\u6c42","text":"<p>\u7f16\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u6765\u5bf9\u5f53\u524d\u7cfb\u7edf <code>PATH</code> \u76ee\u5f55\u4e0b\u7684\u4e8c\u8fdb\u5236\u6267\u884c\u6587\u4ef6\u8fdb\u884c\uff0c\u6216\u8005\u5bf9\u6307\u5b9a\u5168\u76d8\u8fdb\u884c md5 \u626b\u63cf\uff0c\u540e\u671f\u53ef\u4ee5\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u6765\u76d1\u63a7\u6587\u4ef6\u662f\u5426\u53d8\u5316\uff0c\u7528\u4e8e\u6587\u4ef6\u6743\u9650\u53ca\u5185\u5bb9\u7684\u7ba1\u63a7\u3002</p>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#32","title":"3.2 \u601d\u8def","text":"<p>\u6587\u4ef6\u626b\u63cf\u53ef\u4ee5\u4f7f\u7528 md5sum \u5de5\u5177\u6267\u884c\uff0c\u5bf9\u76ee\u5f55\u904d\u5386\u9700\u8981\u4f7f\u7528 for \u5faa\u73af\uff0c\u73b0\u5728\u6267\u884c\u65b9\u5f0f\u53ef\u4ee5\u4f7f\u7528 case \u6765\u64cd\u4f5c\uff0c\u5176\u4e2d\u4e00\u4e9b\u64cd\u4f5c\u4f1a\u6d89\u53ca\u5230 sed \u7684\u547d\u4ee4\uff0c\u540e\u671f\u6211\u4eec\u4f1a\u9488\u5bf9\u8fd9\u4e9b\u547d\u4ee4\u8fdb\u884c\u5355\u72ec\u7ae0\u8282\u8be6\u7ec6\u8bb2\u89e3\uff0c\u5728\u672c\u9700\u6c42\u6848\u4f8b\u4e2d\u7740\u91cd\u601d\u8003 Shell \u4e2d\u6d41\u7a0b\u63a7\u5236\u7684\u4f5c\u7528\u3002</p>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#33","title":"3.3 \u5b9e\u73b0","text":"<ul> <li>\u5177\u4f53\u5b9e\u73b0 shell \u811a\u672c</li> </ul> <pre><code>#!/bin/bash\n# Description: count file scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: count file\n# Date: 2020-03-28 14:00\n# Version: 1.0\n\n# \u5b9a\u4e49\u6587\u4ef6\u626b\u63cf\u76ee\u5f55\n\nSCAN_DIR=`echo $PATH |sed 's/:/ /g'`\nSCAN_CMD=`which md5sum`\nSCAN_FILE_FAIL=\"/tmp/scan_$(date +%F%H%m)_fall.txt\"\nSCAN_FILE_BIN=\"/tmp/scan_$(date +%F%H%m)_bin.txt\"\n\nscan_fall_disk() {\n    echo \"\u6b63\u5728\u5168\u76d8\u626b\u63cf\uff0c\u8bf7\u7a0d\u7b49\uff01\u6587\u4ef6\u8def\u5f84:$SCAN_FILE_FALL\"\n    find / -type f ! -path \"/proc/*\" -exec $SCAN_CMD \\{\\} \\;&gt;&gt; $SCAN_FILE_FAIL 2&gt;/dev/null\n    echo \"\u626b\u63cf\u5b8c\u6210,\u53ef\u5229\u7528\u4ee5\u4e0b\u547d\u4ee4\u540e\u671f\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c\"\n    echo \"$SCAN_CMD -c $SCAN_FILE_FAIL |grep -v 'OK$'\"\n}\n\nscan_bin() {\n    echo \"\u6b63\u5728\u626b\u63cf$PATH\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8bf7\u7a0d\u7b49\uff0c\u6587\u4ef6\u8def\u5f84\uff1a$SCAN_FILE_BIN\"\n    for file in $SCAN_DIR\n    do\n        find $file -type f -exec $SCAN_CMD \\{\\} \\;&gt;&gt; $SCAN_FILE_BIN 2&gt;/dev/null\n    done\n    echo \"\u626b\u63cf\u5b8c\u6210,\u53ef\u5229\u7528\u4ee5\u4e0b\u547d\u4ee4\u540e\u671f\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c\"\n    echo \"$SCAN_CMD -c $SCAN_FILE_BIN |grep -v 'OK$'\"\n}\n\nclear\necho \"##########################################\"\necho \"#                                        #\"\necho \"#        \u5229\u7528md5sum\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c        #\"\necho \"#                                        #\"\necho \"##########################################\"\necho \"1: \u5168\u76d8\u626b\u63cf\"\necho \"2: bin path\u626b\u63cf\"\necho \"3: EXIT\"\n# \u9009\u62e9\u626b\u63cf\u65b9\u5f0f\nread -p \"Please input your choice:\" method\ncase $method in \n1)\n    scan_fall_disk;;\n2)\n    scan_bin;;\n3)\n        echo \"you choce channel!\" &amp;&amp; exit 1;;\n*)\n    echo \"input Error! Place input{1|2|3}\" &amp;&amp; exit 0;;\nesac\n</code></pre> <ul> <li>\u6d4b\u8bd5</li> </ul> <pre><code>[root@xuel-terraform-cvm-0 ~]# bash file_scan.sh\n##########################################\n#                                        #\n#        \u5229\u7528md5sum\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c        #\n#                                        #\n##########################################\n1: \u5168\u76d8\u626b\u63cf\n2: bin path\u626b\u63cf\n3: EXIT\nPlease input your choice:2\n\u6b63\u5728\u626b\u63cf/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8bf7\u7a0d\u7b49\uff0c\u6587\u4ef6\u8def\u5f84\uff1a/tmp/scan_2020-03-271703_bin.txt\n\u626b\u63cf\u5b8c\u6210,\u53ef\u5229\u7528\u4ee5\u4e0b\u547d\u4ee4\u540e\u671f\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c\n/usr/bin/md5sum -c /tmp/scan_2020-03-271703_bin.txt |grep -v 'OK$'\n[root@xuel-terraform-cvm-0 ~]# /usr/bin/md5sum -c /tmp/scan_2020-03-271703_bin.txt |grep -v 'OK$'\n/sbin/mii-tool: \u786e\u5b9a\n/sbin/wipefs: \u786e\u5b9a\n/sbin/blkdiscard: \u786e\u5b9a\n/sbin/rtmon: \u786e\u5b9a\n/sbin/shutdown: \u786e\u5b9a\n/sbin/aureport: \u786e\u5b9a\n/sbin/plymouthd: \u786e\u5b9a\n/sbin/udevd: \u786e\u5b9a\n/sbin/lvmetad: \u786e\u5b9a\n/sbin/e2undo: \u786e\u5b9a\n...\n</code></pre> <p>\u5f53\u6211\u4eec\u8f93\u5165\u6570\u5b57 2 \u7684\u65f6\u5019\u5373\u5bf9 bin \u8def\u5f84\u6267\u884c\u626b\u63cf\uff0c\u626b\u63cf\u5b8c\u6210\u540e\u4f1a\u751f\u6210\u5bf9\u5e94\u7684\u626b\u63cf\u6587\u4ef6\uff0c\u53ef\u4ee5\u6267\u884c <code>/usr/bin/md5sum -c /tmp/scan_2020-03-271703_bin.txt |grep -v 'OK$'</code> \u6765\u8fdb\u884c\u540e\u671f\u6587\u4ef6\u6821\u9a8c\u3002</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# bash file_scan.sh\n##########################################\n#                                        #\n#        \u5229\u7528md5sum\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c           #\n#                                        #\n##########################################\n1: \u5168\u76d8\u626b\u63cf\n2: bin path\u626b\u63cf\n3: EXIT\nPlease input your choice:3\nyou choce channel!\n</code></pre> <p>\u5f53\u8f93\u5165 3 \u7a0b\u5e8f\u9000\u51fa\uff0c\u5728\u6b64\u5c31\u662f\u4f7f\u7528 case \u6765\u5b8c\u6210\u3002</p> <pre><code>[root@xuel-terraform-cvm-0 ~]# bash file_scan.sh\n##########################################\n#                                        #\n#        \u5229\u7528md5sum\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c             #\n#                                        #\n##########################################\n1: \u5168\u76d8\u626b\u63cf\n2: bin path\u626b\u63cf\n3: EXIT\nPlease input your choice:1\n\u6b63\u5728\u5168\u76d8\u626b\u63cf\uff0c\u8bf7\u7a0d\u7b49\uff01\u6587\u4ef6\u8def\u5f84:\n\u626b\u63cf\u5b8c\u6210,\u53ef\u5229\u7528\u4ee5\u4e0b\u547d\u4ee4\u540e\u671f\u5bf9\u6587\u4ef6\u8fdb\u884c\u6821\u9a8c\n/usr/bin/md5sum -c /tmp/scan_2020-03-271703_fall.txt |grep -v 'OK$'\n[root@xuel-terraform-cvm-0 ~]# /usr/bin/md5sum -c /tmp/scan_2020-03-271703_fall.txt |grep -v 'OK$' |more\n/sys/devices/platform/uevent: \u786e\u5b9a\n/sys/devices/platform/power/control: \u786e\u5b9a\n/sys/devices/platform/power/wakeup: \u786e\u5b9a\n/sys/devices/platform/pcspkr/uevent: \u786e\u5b9a\n/sys/devices/platform/pcspkr/modalias: \u786e\u5b9a\n/sys/devices/platform/pcspkr/power/control: \u786e\u5b9a\n/sys/devices/platform/pcspkr/power/wakeup: \u786e\u5b9a\n/sys/devices/platform/platform-framebuffer.0/uevent: \u786e\u5b9a\n/sys/devices/platform/platform-framebuffer.0/modalias: \u786e\u5b9a\n/sys/devices/platform/platform-framebuffer.0/power/control: \u786e\u5b9a\n/sys/devices/platform/platform-framebuffer.0/power/wakeup: \u786e\u5b9a\n/sys/devices/platform/serial8250/uevent: \u786e\u5b9a\n/sys/devices/platform/serial8250/modalias: \u786e\u5b9a\n/sys/devices/platform/serial8250/power/control: \u786e\u5b9a\n/sys/devices/platform/serial8250/power/wakeup: \u786e\u5b9a\n/sys/devices/platform/serial8250/tty/ttyS1/uevent: \u786e\u5b9a\n/sys/devices/platform/serial8250/tty/ttyS1/dev: \u786e\u5b9a\n/sys/devices/platform/serial8250/tty/ttyS1/power/cont\n</code></pre>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#4","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5bf9\u4e8e\u6761\u4ef6\u8bed\u53e5\u4e2d\u7684\u591a\u5206\u652f if \u8bed\u53e5\uff0c\u7ed3\u5c3e\u80af\u5b9a\u662f\u6709\u4e00\u4e2a else \u6765\u5b8c\u6210\uff0c\u9700\u8981\u6ce8\u610f\u6b64\u70b9\uff1b</li> <li>\u5728\u7f16\u5199\u6d41\u7a0b\u63a7\u5236\u65f6\u5019\uff0c\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u4e60\u60ef\u5bf9\u4e8e <code>command</code> \u4e2d\u7684\u64cd\u4f5c\u8fdb\u884c\u7f29\u8fdb\uff0c\u53ef\u4ee5\u4e3a\u51e0\u4e2a\u7a7a\u683c\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u4e00\u4e2a tab \u952e\uff0c\u5efa\u8bae\u4f7f\u7528\u4e00\u4e2a\u5236\u8868\u7b26\uff1b</li> <li>\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u53ef\u4ee5\u76f8\u4e92\u5d4c\u5957\uff0c\u4f8b\u5982 for \u5faa\u73af\u4e2d\u53ef\u4ee5\u6709 if \u6761\u4ef6\u5224\u65ad\uff0cif \u6dfb\u52a0\u5224\u65ad\u4e2d\u4e5f\u53ef\u4ee5\u6dfb\u52a0 for \u5faa\u73af\u7b49\uff0c\u6839\u636e\u9700\u6c42\u5177\u4f53\u7075\u6d3b\u8fd0\u7528\uff1b</li> <li>case \u8bed\u53e5\u4e0e if \u591a\u5206\u652f\u8bed\u53e5\u4e00\u6837\uff0c\u4e0d\u540c\u70b9\u5728\u4e0e case \u8bed\u53e5\u53ea\u80fd\u5224\u65ad\u4e00\u79cd\u6761\u4ef6\u5173\u7cfb\uff0c\u800c if \u591a\u5206\u652f\u53ef\u4ee5\u5bf9\u591a\u79cd\u6761\u4ef6\u8fdb\u884c\u5224\u65ad\u3002</li> </ul>"},{"location":"linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/#5","title":"5. \u5c0f\u7ed3","text":"<p>\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u662f\u6211\u4eec Shell \u7f16\u5199\u7684\u7ecf\u7edc\uff0c\u5229\u7528\u5b83\u6765\u63a7\u5236\u7a0b\u5e8f\u7684\u8d70\u5411\uff0c\u9700\u8981\u6211\u4eec\u80fd\u719f\u7ec3\u638c\u63e1\u6700\u5e38\u7528\u7684\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\uff0c\u5e76\u77e5\u9053\u5176\u5bf9\u5e94\u7684\u9002\u5e94\u573a\u666f\uff0c\u7075\u6d3b\u914d\u5408\u4f7f\u7528\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/","title":"8.Shell \u51fd\u6570","text":""},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#1-shell","title":"1. Shell \u51fd\u6570\u6982\u8ff0","text":""},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#11-shell","title":"1.1 Shell \u51fd\u6570\u7b80\u4ecb","text":"<p>Shell \u548c\u5176\u4ed6\u8bed\u8a00\u4e00\u6837\uff0c\u4e5f\u6709\u51fd\u6570\uff0c\u5176\u672c\u8d28\u5c31\u662f\u4e00\u6bb5\u53ef\u4ee5\u590d\u7528\u7684\u4ee3\u7801\u3002\u5c06\u6570\u636e\u8fdb\u884c\u62bd\u79bb\u5904\u7406\uff0c\u4f20\u9012\u4e0d\u540c\u7684\u503c\u8f93\u51fa\u4e0d\u540c\u7684\u7ed3\u679c\uff0c\u5728\u6307\u5b9a\u7684\u5730\u65b9\u8fdb\u884c\u8c03\u7528\u5373\u53ef\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#12","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528\u51fd\u6570","text":"<p>\u5982\u679c\u6211\u4eec\u8981\u91cd\u590d\u6267\u884c\u4e00\u6279\u76f8\u540c\u7684\u64cd\u4f5c\uff0c\u4e0d\u60f3\u91cd\u590d\u53bb\u5199\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e00\u7cfb\u5217\u64cd\u4f5c\u62bd\u8c61\u4e3a\u4e00\u4e2a\u51fd\u6570\uff0c\u540e\u671f\u53ef\u4ee5\u5229\u7528\u53d8\u91cf\u4f20\u503c\u8c03\u8be5\u51fd\u6570\uff0c\u4ece\u800c\u5927\u5927\u51cf\u5c11\u91cd\u590d\u6027\u52b3\u52a8\uff0c\u63d0\u5347\u6548\u7387\u51cf\u5c11\u4ee3\u7801\u91cf\uff0c\u4f7f\u5f97 Shell \u811a\u672c\u66f4\u52a0\u7684\u7075\u6d3b\u548c\u901a\u7528\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#2-shell","title":"2. Shell \u51fd\u6570\u64cd\u4f5c","text":""},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#21","title":"2.1 \u51fd\u6570\u8bed\u6cd5","text":""},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#211","title":"2.1.1 \u6807\u51c6\u8bed\u6cd5","text":"<pre><code>function fnname() { \n    statements\n    return value\n}\n</code></pre> <p>\u5bf9\u5404\u4e2a\u90e8\u5206\u7684\u8bf4\u660e\uff1a</p> <ul> <li><code>function</code> \u662f Shell \u4e2d\u7684\u5173\u952e\u5b57\uff0c\u4e13\u95e8\u7528\u6765\u5b9a\u4e49\u51fd\u6570\uff1b</li> <li><code>fname</code> \u662f\u51fd\u6570\u540d\uff1b</li> <li><code>statements</code> \u662f\u51fd\u6570\u8981\u6267\u884c\u7684\u4ee3\u7801\uff0c\u4e5f\u5c31\u662f\u4e00\u7ec4\u8bed\u53e5\uff1b</li> <li><code>return value</code> \u8868\u793a\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u5176\u4e2d return \u662f Shell \u5173\u952e\u5b57\uff0c\u4e13\u95e8\u7528\u5728\u51fd\u6570\u4e2d\u8fd4\u56de\u4e00\u4e2a\u503c\uff0c\u8fd9\u4e00\u90e8\u5206\u53ef\u4ee5\u5199\u4e5f\u53ef\u4ee5\u4e0d\u5199\u3002</li> </ul> <p>\u7531\u5927\u62ec\u53f7\u5305\u56f4\u7684\u90e8\u5206\u79f0\u4e3a\u51fd\u6570\u4f53\uff0c\u8c03\u7528\u4e00\u4e2a\u51fd\u6570\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u6267\u884c\u51fd\u6570\u4f53\u4e2d\u7684\u4ee3\u7801\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>function checkuser() { \n    echo \"\u5f53\u524d\u7528\u6237\u4e3a:$USER\"\n    return 0\n}\n</code></pre> <p>\u5982\u4e0a\u5c31\u5b9a\u4e49\u4e86\u4e00\u4e2a <code>checkuser</code> \u51fd\u6570\uff0c\u5176\u8f93\u51fa\u5f53\u524d\u767b\u5f55\u7cfb\u7edf\u7684\u7528\u6237\u540d\uff0c\u8fd4\u56de\u503c\u4e3a 0\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#212","title":"2.1.2 \u7b80\u5316\u8bed\u6cd5","text":"<ul> <li>\u51fd\u6570\u540d\u540e\u65e0\u62ec\u53f7</li> </ul> <pre><code>#\u7b80\u5316\u5199\u6cd51\nfunction fname{ \n    statements\n    return n\n}\n</code></pre> <ul> <li>\u51fd\u6570\u4e0d\u5199 function</li> </ul> <pre><code>#\u7b80\u5316\u5199\u6cd52\uff1a\nfname() {\n    statements\n    return n\n}\n</code></pre> <p>\u4e0a\u8ff0\u4e24\u79cd\u5b9a\u4e49\u51fd\u6570\u7684\u65b9\u6cd5\u90fd\u53ef\u4ee5\uff0c\u4f46\u662f\u8fd8\u662f\u5efa\u8bae\u5728\u7f16\u5199 Shell \u7684\u65f6\u5019\uff0c\u4e5f\u4e0d\u5dee\u6d6a\u8d39\u8fd9\u70b9\u65f6\u95f4\uff0c\u5efa\u8bae\u5927\u5bb6\u90fd\u7528\u5b8c\u6574\u51fd\u6570\u5b9a\u4e49\uff0c\u5199 function \u5173\u952e\u5b57\uff0c\u5728\u4e3a\u51fd\u6570\u5b9a\u4e49\u5e26\u4e0a ()\uff0c\u8fd9\u6837\u66f4\u52a0\u89c4\u8303\uff0c\u800c\u4e14\u4fbf\u4e8e\u522b\u4eba\u9605\u8bfb\u4fee\u6539\u4f60\u7684\u811a\u672c\u3002</p> <p>Tips\uff1a\u5728\u51fd\u6570\u5b9a\u4e49\u4e2d\u9700\u8981\u51fd\u6570\u540d\u79f0\u540e\u53ef\u4ee5\u6709\u591a\u4e2a\u7a7a\u683c\uff0c\u62ec\u53f7\u5185\u4e5f\u53ef\u4ee5\u6709\u591a\u4e2a\u7a7a\u683c\uff0c\u5982\u679c\u51fd\u6570\u4f53\u5199\u5728\u4e00\u884c\uff0c\u9700\u8981\u5728\u8bed\u53e5\u672b\u5c3e\u52a0\u4e0a <code>;</code>\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#22","title":"2.2 \u51fd\u6570\u8c03\u7528","text":"<p>\u5f53\u51fd\u6570\u5b9a\u4e49\u597d\u4e86\uff0c\u5728\u9700\u8981\u4f7f\u7528\u51fd\u6570\u7684\u5730\u65b9\uff0c\u8c03\u7528\u5176\u51fd\u6570\u540d\u79f0\u5373\u53ef\uff0c\u6ce8\u610f\u51fd\u6570\u8c03\u7528\u9700\u8981\u5728\u51fd\u6570\u5b9a\u4e49\u4e4b\u540e\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#221","title":"2.2.1 \u65e0\u53c2\u6570\u8c03\u7528","text":"<p>\u5f53\u51fd\u6570\u6ca1\u6709\u53c2\u6570\u7684\u65f6\u5019\uff0c\u8c03\u7528\u975e\u5e38\u7b80\u5355\uff0c\u76f4\u63a5\u5199\u51fd\u6570\u540d\u79f0\u5373\u53ef\uff0c\u8c03\u7528\u51fd\u6570\u5c31\u662f\u5728\u7279\u5b9a\u5730\u65b9\u6267\u884c\u51fd\u6570\u4f53\u5185\u7684\u64cd\u4f5c\u3002</p> <pre><code>// \u5b9a\u4e49\u51fd\u6570\nfunction fnname() { \n    statements\n    return value\n}\n\n// \u8c03\u7528\u51fd\u6570\nfname\n</code></pre>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#222","title":"2.2.2 \u4f20\u9012\u53c2\u6570\u8c03\u7528","text":"<ul> <li>\u8bed\u6cd5</li> </ul> <p>\u6211\u4eec\u4e4b\u524d\u5728\u53d8\u91cf\u4e00\u7ae0\u8282\u4ecb\u7ecd\u4e86 Shell \u811a\u672c\u7684\u53c2\u6570\uff0c\u77e5\u9053\u4e86\u53c2\u6570\u7684\u91cd\u8981\u6027\u8d28\u53ca\u5176\u5404\u79cd\u7c7b\u7279\u5f81\uff0c\u4e0e Shell \u811a\u672c\u4f20\u9012\u53c2\u6570\u4e00\u6837\uff0c\u51fd\u6570\u4e5f\u53ef\u4ee5\u4f20\u9012\u53c2\u6570\uff0c\u4f8b\u5982\uff1a</p> <pre><code>// \u5b9a\u4e49\u51fd\u6570\nfunction fnname() { \n    statements\n    return value\n}\n\n// \u8c03\u7528\u51fd\u6570\nfname param1 param2 param3\n</code></pre> <p>\u5982\u4e0a\u6240\u793a\uff0c\u5728\u8c03\u7528\u51fd\u6570 <code>fname</code> \u7684\u65f6\u5019\uff0c\u6211\u4eec\u4f20\u9012\u4e86\u4e09\u4e2a\u53c2\u6570\uff0c\u53c2\u6570\u4e4b\u95f4\u5229\u7528\u7a7a\u683c\u5206\u5272\uff0c\u548c Shell \u811a\u672c\u4f20\u9012\u53c2\u6570\u4e00\u6837\uff0c\u4f46\u9700\u8981\u6ce8\u610f Shell \u811a\u672c\u4e2d\uff0c\u51fd\u6570\u5728\u5b9a\u4e49\u65f6\u5019\u4e0d\u80fd\u6307\u5b9a\u53c2\u6570\uff0c\u5728\u8c03\u7528\u7684\u65f6\u5019\u4f20\u9012\u53c2\u6570\u5373\u53ef\uff0c\u5e76\u4e14\u5728\u8c03\u7528\u51fd\u6570\u65f6\u4f20\u9012\u4ec0\u4e48\u53c2\u6570\u51fd\u6570\u5c31\u63a5\u53d7\u4ec0\u4e48\u53c2\u6570\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#23","title":"2.3 \u51fd\u6570\u53c2\u6570","text":"<p>\u4e0a\u8ff0\u6211\u4eec\u4e86\u89e3\u4e86\u51fd\u6570\u7684\u5b9a\u4e49\uff0c\u5728\u5176\u4e2d\u65e0\u53c2\u51fd\u6570\u8c03\u7528\u5373\u8c03\u7528\u51fd\u6570\u540d\u5373\u53ef\uff0c\u5bf9\u4e8e\u6709\u53c2\u51fd\u6570\uff0c\u9700\u8981\u4f20\u9012\u4e00\u5b9a\u7684\u53c2\u6570\u6765\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\uff0c\u51fd\u6570\u7684\u53c2\u6570\u548c\u811a\u672c\u7684\u53c2\u6570\u7c7b\u578b\u53ca\u7528\u6cd5\u4e00\u81f4\uff0c\u5728\u6b64\u6211\u4eec\u7b80\u5355\u56de\u987e\u4e0b\uff0c\u770b\u53c2\u6570\u5728\u51fd\u6570\u4e2d\u90fd\u6709\u54ea\u4e9b\u5206\u7c7b\uff0c\u53ca\u8be5\u5982\u4f55\u4f7f\u7528\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#231","title":"2.3.1 \u4f4d\u7f6e\u53c2\u6570","text":"<p>\u4f4d\u7f6e\u53c2\u6570\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u4f20\u9012\u7ed9\u51fd\u6570\u53c2\u6570\u7684\u4f4d\u7f6e\uff0c\u4f8b\u5982\u7ed9\u4e00\u4e2a\u51fd\u6570\u4f20\u9012\u4e00\u4e2a\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6267\u884c Shell \u811a\u672c\u83b7\u53d6\u5bf9\u5e94\u4f4d\u7f6e\u7684\u53c2\u6570\uff0c\u83b7\u53d6\u53c2\u6570\u7684\u683c\u5f0f\u4e3a\uff1a$n\u3002n \u4ee3\u8868\u4e00\u4e2a\u6570\u5b57\uff0c\u5728\u6b64\u9700\u8981\u6ce8\u610f\u4e0e\u811a\u672c\u4f20\u9012\u53c2\u6570\u4e0d\u4e00\u6837\uff0c<code>$0</code> \u4e3a\u4f9d\u65e7\u4e3a\u811a\u672c\u7684\u540d\u79f0\uff0c\u5728\u51fd\u6570\u53c2\u6570\u4f20\u9012\u4e2d\uff0c\u4f8b\u5982\u4f20\u9012\u7ed9\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u83b7\u53d6\u5c31\u4e3a <code>$1</code>\uff0c\u7b2c 2 \u4e2a\u53c2\u6570\u5c31\u4e3a <code>$2</code>, \u4ee5\u6b64\u7c7b\u63a8\u2026\u2026\uff0c\u9700\u8981\u5176 <code>$0</code> \u4e3a\u8be5\u51fd\u6570\u7684\u540d\u79f0\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>[root@master func]# cat f1.sh \n#!/bin/bash\n\nfunction f1() {\n        echo \"\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: ${1}\"\n        echo \"\u51fd\u6570\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: ${2}\"\n        echo \"\u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: ${3}\"\n}\n# \u8c03\u7528\u51fd\u6570\nf1 shell linux python go\n\n[root@master func]# bash f1.sh \n\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: shell\n\u51fd\u6570\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: linux\n\u51fd\u6570\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: python\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4f20\u9012\u7ed9 <code>f1</code> \u51fd\u6570\u5171 4 \u4e2a\u4f4d\u7f6e\u53c2\u6570\uff0c\u5728\u7ed3\u679c\u8f93\u51fa\u4e2d\u53ef\u4ee5\u770b\u5230\u7531\u4e8e\u51fd\u6570\u4f53\u5185\u90e8\u53ea\u5bf9\u4e09\u4e2a\u53c2\u6570\u8fdb\u884c\u4e86\u5904\u7406\uff0c\u540e\u7eed\u7684\u53c2\u6570\u4e5f\u5c31\u4e0d\u518d\u5904\u7406\u4e86\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#232","title":"2.3.2 \u7279\u6b8a\u53c2\u6570","text":"<p>\u5728 Shell \u4e2d\u4e5f\u5b58\u5728\u7279\u6b8a\u542b\u4e49\u7684\u53c2\u6570\u5982\u4e0b\u8868\uff1a</p> \u53d8\u91cf \u542b\u4e49 $# \u4f20\u9012\u7ed9\u51fd\u6570\u7684\u53c2\u6570\u4e2a\u6570\u603b\u548c $* \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6240\u6709\u7684\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u4e00\u4e2a\u5b57\u7b26\u4e32 $@ \u4f20\u9012\u7ed9\u811a\u672c\u6216\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c\u5f53\u88ab\u53cc\u5f15\u53f7 <code>\" \"</code> \u5305\u542b\u65f6\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u53c2\u6570\u88ab\u770b\u505a\u72ec\u7acb\u7684\u5b57\u7b26\u4e32 $? <code>$?</code> \u8868\u793a\u51fd\u6570\u7684\u9000\u51fa\u72b6\u6001\uff0c\u8fd4\u56de\u4e3a 0 \u4e3a\u6267\u884c\u6210\u529f\uff0c\u975e 0 \u5219\u4e3a\u6267\u884c\u5931\u8d25 <p>\u793a\u4f8b\uff1a</p> <pre><code>[root@master func]# cat f1.sh \n#!/bin/bash\n\nfunction fsum() {\n        echo \"\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: ${1}\"\n        echo \"\u51fd\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: ${2}\"\n        echo \"\u51fd\u6570\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: ${3}\"\n        echo \"\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: ${#}\"\n        echo \"\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: ${@}\"\n        local sum=0\n        for num in ${@};\n        do\n                let sum=${sum}+${num}\n        done\n        echo \"\u8ba1\u7b97\u7684\u603b\u548c\u4e3a: ${sum}\"\n        return 0\n}\n# \u8c03\u7528\u51fd\u6570\nfsum 10 20 1 2\necho $?\n\n[root@master func]# bash f1.sh \n\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: 10\n\u51fd\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: 20\n\u51fd\u6570\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: 1\n\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: 4\n\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: 10 20 1 2\n\u8ba1\u7b97\u7684\u603b\u548c\u4e3a: 33\n0\n</code></pre> <p>\u5982\u4e0a\u53ef\u4ee5\u770b\u5230\u7279\u6b8a\u53c2\u6570\u4e0e Shell \u811a\u672c\u4f20\u9012\u53c2\u6570\u4e00\u6837\u3002</p> <p>Tips\uff1a\u5c40\u90e8\u53d8\u91cf\u9700\u8981\u7279\u522b\u58f0\u660e\u5728\u51fd\u6570\u5185\u90e8\u5229\u7528 <code>local</code> \u5173\u952e\u5b57\u6765\u58f0\u660e\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#24","title":"2.4 \u51fd\u6570\u8fd4\u56de\u503c","text":"<p>\u51fd\u6570\u8fd4\u56de\u503c\u5229\u7528 <code>$?</code> \u6765\u63a5\u6536\uff0c\u5728\u4e0a\u8ff0\u793a\u4f8b\u4e2d\u6211\u4eec\u5c06\u8ba1\u7b97\u7684\u7ed3\u679c\u5229\u7528 echo \u547d\u4ee4\u6253\u5370\u51fa\u6765\uff0c\u5982\u679c\u6211\u4eec\u5728\u540e\u7eed\u7684\u811a\u672c\u4e2d\u9700\u8981\u5229\u7528\u6b64\u51fd\u6570\u7ed3\u7b97\u7684\u7ed3\u679c\uff0c\u5c31\u9700\u8981\u5f97\u5230\u8fd9\u4e2a\u8fd4\u56de\u503c\uff0c\u6b64\u523b\u5c31\u9700\u8981\u5c06\u8ba1\u7b97\u7684\u7ed3\u679c\u4e0d\u4ec5\u4ec5\u662f\u6253\u5370\u800c\u662f\u8fd4\u56de\u4e86\uff0c\u51fd\u6570\u4e2d\u8fd4\u56de\u5229\u7528 <code>return</code> \u5173\u952e\u5b57\uff0c\u5728\u51fd\u6570\u8c03\u7528\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5229\u7528 <code>$?</code> \u6765\u63a5\u53d7\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u4f8b\u5982\u5c06\u6211\u4eec\u4e0a\u9762\u7684\u793a\u4f8b\u6539\u9020\u6210\u8fd4\u56de\u7ed3\u6784\u7684\u51fd\u6570\u3002</p> <p>\u6ce8\u610f\uff1ashell \u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u53ea\u80fd\u662f\u6574\u5f62\uff0c\u5e76\u4e14\u5728 0-257 \u4e4b\u95f4\uff0c\u4e0d\u80fd\u662f\u5b57\u7b26\u4e32\u6216\u5176\u4ed6\u5f62\u5f0f\u3002\u5e76\u4e14\u5728\u8c03\u7528\u65b9\u6cd5\u548c\u53d6\u5f97\u8fd4\u56de\u503c\u4e4b\u95f4\uff0c\u4e0d\u80fd\u6709\u4efb\u4f55\u64cd\u4f5c\uff0c\u4e0d\u7136\u53d6\u4e0d\u5230 return \u7684\u503c\u3002</p> <pre><code>[root@master func]# cat f1.sh \n#!/bin/bash\n\nfunction fsum() {\n        echo \"\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: ${1}\"\n        echo \"\u51fd\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: ${2}\"\n        echo \"\u51fd\u6570\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: ${3}\"\n        echo \"\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: ${#}\"\n        echo \"\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: ${@}\"\n        local sum=0\n        for num in ${@};\n        do\n                let sum=${sum}+${num}\n        done\n        return $sum\n}\n\n\nfsum 10 20 1 2\necho $?\n[root@master func]# bash f1.sh \n\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a: 10\n\u51fd\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a: 20\n\u51fd\u6570\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a: 1\n\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: 4\n\u51fd\u6570\u7684\u53c2\u6570\u603b\u6570\u4e3a: 10 20 1 2\n33\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5c06\u5728\u51fd\u6570\u5185\u90e8\u8ba1\u7b97\u7684\u6570\u7ec4\u4e4b\u548c\uff0c\u5229\u7528 return \u4f5c\u4e3a\u8fd4\u56de\uff0c\u6b64\u523b\u5728\u51fd\u6570\u8c03\u7528\u7684\u65f6\u5019\uff0c\u5229\u7528 <code>$?</code> \u5c31\u53ef\u4ee5\u62ff\u5230\u51fd\u6570\u8fd4\u56de\u7684\u503c\u8fdb\u4e00\u6b65\u5904\u7406\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#25","title":"2.5 \u9012\u5f52\u51fd\u6570","text":"<p>Shell \u652f\u6301\u9012\u5f52\u51fd\u6570\uff0c\u9012\u5f52\u51fd\u6570\u4e5f\u5c31\u662f\u81ea\u5df1\u8c03\u7528\u81ea\u5df1\uff0c\u5373\u5728\u51fd\u6570\u4f53\u5185\u90e8\u53c8\u4e00\u6b21\u8c03\u7528\u51fd\u6570\u81ea\u5df1\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@master func]# cat recursion.sh \n#!/bin/bash\n\nfunction myecho() {\n        echo \"$(date)\"\n        sleep 1\n        myecho inner\n}\n\nmyecho\n[root@master func]# bash recursion.sh \nSat Mar 28 13:14:38 CST 2020\nSat Mar 28 13:14:39 CST 2020\nSat Mar 28 13:14:40 CST 2020\nSat Mar 28 13:14:41 CST 2020\nSat Mar 28 13:14:42 CST 2020\n...\n</code></pre> <p>\u5982\u4e0a\u5c31\u662f\u4e00\u4e2a\u9012\u5f52\u51fd\u6570\uff0c\u5728\u51fd\u6570\u4f53\u5185\u90e8\u53c8\u8c03\u7528\u4e86\u51fd\u6570 <code>myecho</code>\uff0c\u5728\u6267\u884c\u7684\u65f6\u5019\u5c31\u4f1a\u9677\u5165\u65e0\u9650\u5faa\u73af\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#3","title":"3. \u5b9e\u4f8b","text":""},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#31","title":"3.1 \u9700\u6c42","text":"<p>\u7cfb\u7edf\u7ecf\u5e38\u5728\u6267\u884c\u5b9a\u65f6\u811a\u672c\u671f\u95f4\u4f1a\u5c06 Linux \u7cfb\u7edf CPU \u5229\u7528\u7387\u8dd1\u6ee1\uff0c\u5bfc\u81f4\u5176\u4ed6\u670d\u52a1\u53d7\u5230\u5f71\u54cd\uff0c\u6545\u67e5\u9605\u8d44\u6599\u53d1\u73b0\u6709\u5927\u795e\u5199\u7684 CPU \u5229\u7528\u7387\u9650\u5236\u7a0b\u5e8f\u3002 \u5730\u5740\uff1aCPU Usage Limiter for Linux</p> <p>\u5229\u7528\u6b64\u5de5\u5177\u53ef\u4ee5\uff0c\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u653e\u7f6e\u5728\u670d\u52a1\u5668\u4e0a\uff0c\u8fbe\u5230\u9650\u5236\u7a0b\u5e8f CPU \u60c5\u51b5\uff0c\u53ef\u6839\u636e\u81ea\u5df1\u7cfb\u7edf CPU \u6838\u5fc3\u6570\u8fdb\u884c\u53c2\u6570\u914d\u7f6e\uff0c\u4f1a\u8bb0\u5f55 CPU \u8d85\u8fc7\u9600\u503c\u7684\u65e5\u5fd7\uff0c\u53ef\u4f9b\u540e\u671f\u8fdb\u884c\u67e5\u770b\u5206\u6790\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#32","title":"3.2 \u601d\u8def","text":"<p>\u5229\u7528\u51fd\u6570\u7f16\u5199\u5b89\u88c5 cpulimit \u5de5\u5177\u7684\u51fd\u6570\uff0c\u5982\u679c\u7cfb\u7edf\u4e0d\u5b58\u5728\u8be5\u547d\u4ee4\u5219\u5b89\u88c5\u5e76\u6267\u884c CPU \u9650\u5236\uff0c\u5982\u679c\u5b58\u5728\u5219\u6267\u884c cpulimit \u51fd\u6570\u5bf9\u8d85\u8fc7\u6307\u5b9a CPU \u7684\u8fdb\u7a0b\u8fdb\u884c\u9650\u5236\uff0c\u6700\u540e\u6267\u884c\u603b\u4f53 main \u51fd\u6570\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#33","title":"3.3 \u5b9e\u73b0","text":"<ul> <li>\u5b9e\u73b0\u811a\u672c</li> </ul> <pre><code>#!/bin/bash\n# Description: count file scripts\n# Auth: kaliarch\n# Email: kaliarch@163.com\n# function: count file\n# Date: 2020-03-29 14:00\n# Version: 1.0\n\n[ $(id -u) -gt 0 ] &amp;&amp; exit 1\n\n# cpu\u4f7f\u7528\u8d85\u8fc7\u767e\u5206\u4e4b\u591a\u5c11\u8fdb\u884c\u9650\u5236\nPEC_CPU=80\n\n# \u9650\u5236\u8fdb\u7a0b\u4f7f\u7528\u767e\u5206\u4e4b\u591a\u5c11,\u5982\u679c\u7a0b\u5e8f\u4e3a\u591a\u7ebf\u7a0b\uff0c\u5355\u4e2acpu\u9650\u5236\u4e3a85\uff0c\u5982\u679c\u4e3a\u591a\u6838\u5fc3\uff0c\u5c31\u9700\u8981\u6309\u7167\u6bd4\u4f8b\u5199\uff0c\u4f8b\u5982cpu\u4e3a2c\uff0c\u50cf\u9650\u5236\u591a\u7ebf\u7a0b\u5360\u6bd480%\uff0c\u5c31\u5199170\nLIMIT_CPU=85\n# \u65e5\u5fd7\nLOG_DIR=/var/log/cpulimit/\n\n# \u8d85\u8fc7\u9600\u503c\u8fdb\u7a0bpid\nPIDARG=$(ps -aux |awk -v CPU=${PEC_CPU} '{if($3 &gt; CPU) print $2}')\n\n# \u5b89\u88c5cpulimit \u51fd\u6570\ninstall_cpulimit() {\n    [ ! -d /tmp ] &amp;&amp; mkdir /tmp || cd /tmp\n    wget -c https://github.com/opsengine/cpulimit/archive/v0.2.tar.gz\n    tar -zxf v0.2.tar.gz\n    cd cpulimit-0.2 &amp;&amp; make\n    [ $? -eq 0 ] &amp;&amp; cp src/cpulimit /usr/bin/\n}\n# \u6267\u884ccpulimit\ndo_cpulimit() {\n[ ! -d ${LOG_DIR} ] &amp;&amp; mkdir -p ${LOG_DIR}\nfor i in ${PIDARG};\ndo\n    CPULIMITCMD=$(which cpulimit)\n        MSG=$(ps -aux |awk -v pid=$i '{if($2 == pid) print $0}')\n        echo ${MSG}\n    [ ! -d /tmp ] &amp;&amp; mkdir /tmp || cd /tmp\n    nohup ${CPULIMITCMD} -p $i -l ${LIMIT_CPU} &amp;\n        echo \"$(date) -- ${MSG}\" &gt;&gt; ${LOG_DIR}$(date +%F).log\ndone\n}\n# \u4e3b\u51fd\u6570\nmain() {\n    hash cpulimit\n    if [ $? -eq 0 ];then\n      # \u8c03\u7528\u51fd\u6570\n        do_cpulimit\n    else\n        install_cpulimit &amp;&amp; do_cpulimit\n    fi\n}\n\nmain\n</code></pre> <ul> <li>\u6d4b\u8bd5</li> </ul> <p>\u9700\u7f16\u5199 CPU \u538b\u529b\u6d4b\u8bd5 python \u811a\u672c\uff0c\u540e\u671f\u53ef\u4ee5\u653e\u5165\u8ba1\u5212\u4efb\u52a1\u6765\u76d1\u63a7\u5e76\u9650\u5236 CPU \u4f7f\u7528\u7387\u3002</p> <pre><code>#!/bin/env python\n\nimport math\nimport random\n\na=10000\nb=10000\nc=10000\n\nsum=0\n\nfor i in range(0,a):\n    for j in range(0,b):\n        randomfloat=random.uniform(1,10)\n        randompow=random.uniform(1,10)\n        sum+=math.pow(randomfloat, randompow)\n\nprint \"sum is %s\" % sum\n</code></pre> <p>\u5f53\u6211\u4eec\u6267\u884c python \u7684 CPU \u538b\u529b\u6d4b\u8bd5\u811a\u672c\u540e\uff0c\u53d1\u73b0\u5355\u6838\u670d\u52a1 CPU \u8dd1\u5230\u4e86 100%\u3002</p> <p></p> <p>\u4e4b\u540e\u8fd0\u884c\u6211\u4eec\u7684 CPU \u9650\u5236\u811a\u672c\uff0c\u53ef\u4ee5\u770b\u5230 CPU \u88ab\u6210\u529f\u9650\u5236\u3002</p> <p></p> <p>\u5728\u6b64\u6848\u4f8b\u4e2d\uff0c\u6211\u4eec\u7740\u91cd\u6765\u770b Shell \u51fd\u6570\uff0c\u5728\u5b9e\u4f8b\u4e2d\u6211\u4eec\u7f16\u5199\u4e86\u5b89\u88c5\u4e0e\u6267\u884c CPU \u9650\u5236\u4e24\u4e2a\u51fd\u6570\uff0c\u6700\u540e\u7f16\u5199\u4e3b\u51fd\u6570\uff0c\u5728\u4e3b\u51fd\u6570\u4e2d\u8c03\u7528\u5176\u4ed6\u51fd\u6570\uff0c\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u5c31\u80fd\u8fbe\u5230\u9650\u5236\u67d0\u8fdb\u7a0b\u7684 CPU\u3002</p>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#4","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u51fd\u6570\u5b9a\u4e49\u5efa\u8bae\u4f7f\u7528\u7b80\u660e\u77e5\u610f\u5e76\u9700\u8981\u6709\u4e00\u5b9a\u539f\u5219\uff0c\u4e0d\u4ec5\u4e3a\u4e86\u7f8e\u89c2\u66f4\u662f\u4e3a\u4e86\u89c4\u8303\uff0c\u4f7f\u5f97\u5176\u4ed6\u4eba\u66f4\u597d\u7406\u89e3\u4e0e\u9605\u8bfb\u4f60\u7684 Shell \u811a\u672c\uff0c\u589e\u5f3a\u811a\u672c\u53ef\u7ef4\u62a4\u6027\uff1b</li> <li>\u5bf9\u4e8e\u51fd\u6570\u8c03\u7528\uff0c\u5fc5\u987b\u5728\u51fd\u6570\u5b9a\u4e49\u4e4b\u540e\uff0cShell \u8fd0\u884c\u4e3a\u987a\u5e8f\u8fd0\u884c\uff0c\u6ca1\u6709\u5b9a\u4e49\u51fd\u6570\u5219\u8c03\u7528\u51fd\u6570\u4f1a\u6709\u5f02\u5e38\uff1b</li> <li>\u51fd\u6570\u5b9a\u4e49\u4e0d\u80fd\u6307\u5b9a\u53c2\u6570\uff0c\u5728\u8c03\u7528\u7684\u65f6\u5019\u4f20\u9012\u53c2\u6570\u5373\u53ef\uff0c\u5e76\u4e14\u8c03\u7528\u51fd\u6570\u4f20\u9012\u4ec0\u4e48\u53c2\u6570\uff0c\u51fd\u6570\u5c31\u63a5\u53d7\u4ec0\u4e48\u53c2\u6570\uff1b</li> <li>\u51fd\u6570\u4f20\u9012\u53c2\u6570\u4e0e Shell \u811a\u672c\u4f20\u9012\u53c2\u6570\u7684\u7c7b\u578b\u53ca\u7528\u6cd5\u4e00\u81f4\uff0c\u5728\u6b64\u53ef\u4ee5\u878d\u4f1a\u8d2f\u901a\uff0c\u5bf9\u6bd4\u7406\u89e3\u8bb0\u5fc6\uff1b</li> <li>shell \u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u53ea\u80fd\u662f\u6574\u5f62\uff0c\u5e76\u4e14\u5728 0-257 \u4e4b\u95f4\uff0c\u4e0d\u80fd\u4e3a\u5b57\u7b26\u4e32\u6216\u5176\u4ed6\u5f62\u5f0f\u3002</li> </ul>"},{"location":"linux/shell/9.Shell%E5%87%BD%E6%95%B0/#5","title":"5. \u5c0f\u7ed3","text":"<p>\u6211\u4eec\u7f16\u5199 Shell \u5c31\u662f\u4e3a\u4e86\u5b9e\u73b0\u7b80\u5316\u64cd\u4f5c\uff0c\u901a\u5e38\u5c06\u6570\u636e\u548c\u7a0b\u5e8f\u5206\u79bb\uff0c\u6211\u4eec\u5c06\u4e00\u7ec4\u5b9e\u73b0\u5177\u4f53\u4e1a\u52a1\u7684\u903b\u8f91\u7f16\u5199\u4e3a\u4e00\u4e2a\u51fd\u6570\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e3a\u4e00\u6bb5\u4ee3\u7801\u5757\uff0c\u5c06\u5176\u6a21\u5757\u5316\uff0c\u8d4b\u4e88\u51fd\u6570\u540d\u79f0\uff0c\u5229\u7528\u51fd\u6570\u53ef\u4ee5\u8fbe\u5230\u4ee3\u7801\u590d\u7528\uff0c\u4f7f\u5f97\u6570\u636e\u4e0e\u903b\u8f91\u5206\u79bb\uff0c\u811a\u672c\u66f4\u52a0\u4fbf\u4e8e\u7ef4\u62a4\u548c\u7ba1\u7406\u3002</p>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/","title":"Shell \u6559\u7a0b\u6982\u8ff0","text":""},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#1-shell","title":"1. Shell \u6982\u8ff0","text":""},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#11-shell","title":"1.1 Shell \u662f\u4ec0\u4e48","text":"<p>\u6211\u4eec\u8981\u7cfb\u7edf\u6027\u7684\u5b66\u4e60 Shell \u811a\u672c\uff0c\u9996\u5148\u9700\u8981\u77e5\u9053\u4ec0\u4e48\u662f Shell\uff0cShell \u7ffb\u8bd1\u8fc7\u6765\u4e3a\u58f3\uff0c\u4f8b\u5982\u5927\u5bb6\u5e38\u89c1\u7684\u58f3\u724c\u77f3\u6cb9\u7684\u56fe\u6807\u4e0a\u9762\u7684\u8d1d\u58f3\uff0c\u987e\u540d\u601d\u4e49\u5176\u5c31\u662f\u4e00\u4e2a\u5957\u5728\u64cd\u4f5c\u7cfb\u7edf\u5916\u5c42\u7684\u58f3\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u4e0e\u8fd9\u5c42\u58f3\u7684\u4ea4\u4e92\uff0c\u5c06\u81ea\u5df1\u7684\u9700\u6c42\u5229\u7528\u8fd9\u5c42 Shell \u6765\u6267\u884c\u6765\u5b9e\u73b0\u5bf9\u670d\u52a1\u5668\u7684\u64cd\u4f5c\u3002\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a Shell \u662f\u5c06\u7528\u6237\u7684\u547d\u4ee4\u89e3\u6790\u4e3a\u5185\u6838\u53ef\u4ee5\u6267\u884c\u7684\u547d\u4ee4\uff0c\u8d77\u5230\u547d\u4ee4\u89e3\u91ca\u7684\u4f5c\u7528\uff0c\u662f\u7528\u6237\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u76f4\u63a5\u7684\u4e00\u4e2a\u6865\u6881\u7ebd\u5e26\u3002</p> <p></p>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#12-shell","title":"1.2 \u4e3a\u4ec0\u4e48\u8981\u7528 Shell","text":"<p>\u6211\u4eec\u60f3\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u6211\u4eec\u5e72\u4e00\u4ef6\u4e8b\u60c5\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u53bb\u4e86\u89e3\u5185\u5728\u7684\u5185\u6838\u6307\u4ee4\uff0c\u800c\u662f\u53ea\u9700\u8981\u4e86\u89e3\u53ef\u4ee5\u64cd\u4f5c\u7cfb\u7edf\u7684 Shell \u547d\u4ee4\u5373\u53ef\uff0cShell \u4e3a\u6211\u4eec\u5c4f\u853d\u6765\u64cd\u4f5c\u7cfb\u7edf\u4f4e\u5c42\u7684\u7ec6\u8282\uff0c\u4e5f\u5904\u4e8e\u5b89\u5168\u6027\u8003\u8651\uff0c\u4e0d\u80fd\u8ba9\u7528\u6237\u968f\u4fbf\u7684\u8fdb\u884c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u64cd\u4f5c\uff0c\u901a\u4fd7\u6765\u8bf4\uff0cshell \u5c31\u662f\u8ba9\u7528\u6237\u66f4\u7b80\u5355\u7684\u64cd\u4f5c\u8ba1\u7b97\u673a\u3002</p>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#13-shell","title":"1.3 Shell \u811a\u672c\u662f\u4ec0\u4e48","text":"<p>\u6211\u4eec\u77e5\u9053\u4e86 Shell \u662f\u4e00\u4e2a\u7528\u6237\u4e0e Linux \u7cfb\u7edf\u5185\u6838\u7684\u901a\u8baf\u7684\u6865\u6881\u540e\uff0c\u90a3\u4e48 Shell \u811a\u672c\u662f\u4ec0\u4e48\u5462\uff1f</p> <p>Shell \u811a\u672c\u5c31\u662f\u64cd\u4f5c Shell \u7684\u6307\u4ee4\u96c6\u5408\u7f16\u5199\u6210\u7684\u4e00\u6bb5\u5b9e\u73b0\u76ee\u7684\u9700\u6c42\u7684\u4ee3\u7801\uff0c\u4e5f\u4e3a\u4e00\u79cd\u7ba1\u7406 Linux \u7cfb\u7edf\u7684\u811a\u672c\u8bed\u8a00\uff0c\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7684\u5c06\u5176\u7406\u89e3\u4e3a\uff0cLinux \u7684\u5404\u79cd\u6307\u4ee4\u52a0\u4e0a\u4e00\u4e9b\u6d41\u7a0b\u63a7\u5236\u548c\u6570\u636e\u7684\u96c6\u5408\uff0c\u56e0\u4e3a\u5b83\u8fd8\u6709\u4e0d\u5c11\u7684\u8bed\u6cd5\u53ca\u683c\u5f0f\uff0c\u540e\u9762\u6211\u4eec\u6765\u901a\u8fc7\u5b66\u4e60\uff0c\u8be6\u7ec6\u5256\u6790\u5176\u5185\u5728\u7cbe\u9ad3\u3002</p>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#14","title":"1.4 \u5e02\u573a\u4f4d\u7f6e","text":"<p>\u76ee\u524d Shell \u811a\u672c\u7531\u4e8e\u5176\u4f5c\u4e3a\u76f4\u63a5\u4e0e Linux \u7cfb\u7edf\u4ea4\u4e92\uff0c\u5728\u6279\u91cf / \u5b9a\u65f6\u4efb\u52a1\u4e2d\u6709\u7740\u72ec\u7279\u65e0\u53ef\u53d6\u4ee3\u7684\u4f5c\u7528\uff0c\u4e0d\u7ba1\u662f\u8fd0\u7ef4\u4eba\u5458\u8fd8\u662f\u5f00\u53d1\u4eba\u5458\u6570\u91cf\u638c\u63e1 Shell \u811a\u672c\uff0c\u90fd\u4f1a\u7ed9\u65e5\u540e\u7684\u5de5\u4f5c\u4ee3\u7406\u975e\u5e38\u5927\u7684\u4fbf\u5229\uff0cShell \u4f5c\u4e3a\u4e00\u79cd\u811a\u672c\u8bed\u8a00\uff0c\u7f16\u5199\u5b8c\u6e90\u7801\u540e\u4e0d\u7528\u7f16\u8bd1\uff0c\u76f4\u63a5\u8fd0\u884c\u6e90\u7801\u5373\u53ef\uff0c\u662f\u5b9e\u73b0 Linux/UNIX \u7cfb\u7edf\u7ba1\u7406\u53ca\u81ea\u52a8\u5316\u8fd0\u7ef4\u6240\u5fc5\u5907\u7684\u91cd\u8981\u5de5\u5177\uff0c \u53ea\u6709\u719f\u7ec3\u638c\u63e1 Shell \u624d\u80fd\u63d0\u5347\u8fd0\u7ef4\u4eba\u5458\u7684\u5de5\u4f5c\u6548\u7387\uff0c\u9002\u5e94\u66f0\u76ca\u590d\u6742\u7684\u5de5\u4f5c\u73af\u5883\uff0c\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u91cd\u590d\u5de5\u4f5c\uff0c\u4ece\u800c\u4e3a\u4e2a\u4eba\u7684\u804c\u573a\u53d1\u5c55\u5960\u5b9a\u8f83\u597d\u7684\u57fa\u7840\u3002</p>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#2-shell","title":"2. Shell \u5206\u7c7b","text":"<p>\u6211\u4eec\u77e5\u9053\u4e0e Linux \u5185\u6838\u6211\u4eec\u6253\u4ea4\u9053\u7684\u90fd\u6709\u4ec0\u4e48\u5462\uff1f\u901a\u5e38\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u5373\u56fe\u5f62\u754c\u9762 \uff08GUI Shell\uff09\u548c\u7ec8\u7aef\u547d\u4ee4\u884c \uff08CLI Shell\uff09\u3002</p>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#21-gui-shell","title":"2.1 GUI Shell","text":"<p>\u5982\u679c\u6211\u4eec\u4e0d\u719f\u6089 Linux \u547d\u4ee4\uff0c\u6211\u4eec\u901a\u8fc7 VNC \u767b\u5f55\u5230 Linux \u7cfb\u7edf\u540e\uff0c\u5229\u7528\u9f20\u6807\u53bb\u53cc\u51fb\u6587\u4ef6\u5939\u8fdb\u5165\u76ee\u5f55\uff0c\u6216\u65b0\u5efa\u6587\u4ef6\u5939\uff0c\u7f16\u8f91\u6587\u4ef6\uff0c\u5b89\u88c5 rpm \u5305\u7b49\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u662f\u5229\u7528 GUI Shell \u4e0e Linux \u7cfb\u7edf\u5185\u6838\u901a\u8baf\uff0c\u5b83\u4e3a\u6211\u4eec\u6784\u9020\u4e86\u4e00\u5957\u7c7b\u4f3c Windows \u7684\u754c\u9762\u4f18\u5316\u7684\u684c\u9762\u73af\u5883\uff0c\u76ee\u524d\u7684\u684c\u9762\u73af\u5883\u4f8b\u5982 Gnome/KDE \u7b49\uff0c\u6b64\u7c7b\u4e3a GUI Shell\u3002</p>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#22-cli-shell","title":"2.2 CLI Shell","text":"<p>Linux \u4f5c\u4e3a\u670d\u52a1\u5668\u7aef\uff0c\u8fd0\u884c\u684c\u9762\u73af\u5883\u975e\u5e38\u6d88\u8017\u8d44\u6e90\uff0c\u56e0\u6b64 CLI Shell \u624d\u662f\u6211\u4eec\u672c\u6b21\u7684\u91cd\u70b9\uff0c\u5176\u6839\u636e\u4e0d\u540c\u7684\u7cfb\u7edf\u6709\u5f88\u591a\u79cd\u7c7b\uff0c \u4f8b\u5982\u6211\u4eec\u6700\u5e38\u7528\u7684\u4e3b\u6d41\u7248\u672c\u7684 Linux \u7cfb\u7edf CentOS/RHEL \u7684\u9ed8\u8ba4 Shell \u4e3a <code>bash</code>\uff0c\u5f53\u7136\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u7684 Shell\uff0c\u4e3a\u4ec0\u4e48\u6709\u8fd9\u4e48\u591a\u7c7b\u578b\u7684 Shell \u5185\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u7c7b\u578b\uff0c\u5176\u5185\u6838\u90fd\u96be\u514d\u5b58\u5728\u5dee\u5f02\uff0c\u56e0\u6b64\u4e0e\u5185\u6838\u4ea4\u4e92\u7684 Shell \u4e5f\u5c31\u5206\u6765\u4e0d\u5c11\u79cd\u7c7b\uff0c\u76ee\u524d\u5728 Linux \u7cfb\u7edf\u4e0a\u4e3b\u6d41\u7684 CLI Shell \u90fd\u4e3a Bash\uff0c\u662f\u8bb8\u591a Linux \u53d1\u884c\u7248\u9ed8\u8ba4\u7684 Shell\u3002\u8fd8\u6709\u8bb8\u591a Unix \u4e0a Shell\u3002\u6211\u4eec\u53ef\u4ee5\u5728 Linux \u7cfb\u7edf\u4e0a <code>cat /etc/shells</code> \u6765\u67e5\u770b\u672c\u7248\u672c\u652f\u6301\u7684\u5404 Shell \u7c7b\u578b\uff0c\u540c\u65f6\u53ef\u4ee5\u5229\u7528\u547d\u4ee4 <code>echo $SHELL</code> \u6765\u67e5\u770b\u5f53\u524d\u73af\u5883\u4e2d\u7684\u9ed8\u8ba4 Shell\uff0c\u4e0d\u540c\u7684 Shell \u90fd\u6709\u5176\u5404\u81ea\u7684\u7279\u70b9\uff0c\u76ee\u524d\u4e3b\u6d41\u7684 Shell \u7c7b\u578b\u5982\u4e0b\uff1a</p> <ul> <li>Bourne Again Shell\uff08/bin/bash\uff09\uff1a\u5176\u4e3a\u76ee\u524d\u4e3b\u6d41 Linux \u53d1\u884c\u7248\u9ed8\u8ba4\u7684 Shell\uff0c\u5176\u4e5f\u662f Bourne shell \u6700\u65e9\u7684\u53d1\u578b\u5e76\u514d\u8d39\u7684\u7248\u672c\uff0c\u7528\u6237\u53ef\u4ee5\u5229\u7528\u5176 help \u547d\u4ee4\u6765\u67e5\u770b\u51e0\u4e4e Shell \u7684\u6240\u7528\u529f\u80fd\u3002</li> <li>Bourne Shell\uff08/usr/bin/sh \u6216 /bin/sh\uff09\uff1a\u662f\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\uff0c\u540e\u5df2\u7ecf\u88ab /bin/bash \u6240\u53d6\u4ee3\u3002</li> <li>C Shell\uff08/usr/bin/csh\uff09\uff1a\u7b80\u5355\u9ad8\u6548\uff0c\u5176\u4f7f\u7528\u7c7b\u4f3c C \u8bed\u8a00\u7684\u8bed\u6cd5\uff0c\u540e\u5df2\u88ab tcsh \u53d6\u4ee3\u3002</li> <li>K Shell\uff08/usr/bin/ksh\uff09\uff1aKorn shell \u7684\u8bed\u6cd5\u4e0e Bourne shell \u76f8\u540c\uff0c\u540c\u65f6\u5177\u5907\u4e86 C shell \u7684\u6613\u7528\u7279\u70b9\uff0c\u8bb8\u591a\u5b89\u88c5\u811a\u672c\u90fd\u4f7f\u7528 ksh\u3002</li> </ul>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#3","title":"3. \u5e94\u7528\u573a\u666f","text":"<ul> <li>\u5e94\u7528\u5b89\u88c5\uff1a\u6211\u4eec\u90fd\u77e5\u9053\u5728 Linux \u670d\u52a1\u5668\u7ecf\u5e38\u9700\u8981\u6211\u4eec\u5b89\u88c5\u7f6e\u4e00\u4e9b\u8f6f\u4ef6\u6216\u914d\u7f6e\u73af\u5883\uff0c\u4eba\u624b\u5de5\u7684\u4e00\u6761\u547d\u540d\u4e00\u6761\u547d\u4ee4\u6267\u884c\uff0c\u5f88\u5bb9\u6613\u51fa\u73b0\u9519\u8bef\uff0c\u800c\u4e14\u5982\u679c\u6210\u767e\u4e0a\u5343\u53f0\u670d\u52a1\u5668\uff0c\u90a3\u4e48\u6b64\u573a\u666f\u4e0b Shell \u811a\u672c\u5c31\u975e\u5e38\u9002\u5408\uff0c\u7f16\u5199\u4e00\u4e2a\u5e94\u7528\u5b89\u88c5\u914d\u7f6e\u811a\u672c\uff0c\u540e\u671f\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\uff0c\u4e14\u4e0d\u5bb9\u6613\u51fa\u9519\uff0cShell \u811a\u672c\u9002\u7528\u4e8e\u91cd\u590d\u6027\u7684\u5de5\u4f5c\u3002</li> <li>\u5b9a\u65f6\u4efb\u52a1\uff1a\u4f8b\u5982\u6211\u4eec\u9700\u8981\u6bcf\u5206\u4e0a\u62a5\u670d\u52a1\u5668\u7684\u5404\u9879\u6027\u80fd\u6307\u6807\u5230\u76d1\u63a7\u670d\u52a1\u7aef\uff0c\u6b64\u65f6\u53ef\u4ee5\u5199\u4e00\u4e2a\u91c7\u96c6\u7cfb\u7edf\u5404\u9879\u6307\u6807\u7684\u811a\u672c\uff0c\u7136\u540e\u914d\u5408\u5b9a\u65f6\u4efb\u52a1\u6765\u6bcf\u5206\u949f\u6267\u884c\u6307\u6807\u6570\u636e\u4e0a\u62a5\uff0cShell \u811a\u672c\u975e\u5e38\u9002\u7528\u4e8e\u5468\u671f\u6027\u7684\u5de5\u4f5c\u3002</li> <li>\u5e94\u7528\u64cd\u4f5c\uff1a\u4f8b\u5982\u6211\u4eec\u81ea\u5df1\u5199\u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u4e3a\u5176\u7f16\u5199\u542f\u52a8 / \u505c\u6b62 / \u91cd\u542f\u7b49\u64cd\u4f5c\u7684\u811a\u672c\uff0c\u5c06\u811a\u672c\u6dfb\u52a0\u8fdb\u7cfb\u7edf\u73af\u5883\u4e2d\uff0c\u540e\u671f\u5f88\u65b9\u4fbf\u8fdb\u884c\u670d\u52a1\u7ba1\u7406\u3002</li> <li>\u5907\u4efd\u6062\u590d\uff1a\u53ef\u4ee5\u5229\u7528\u811a\u672c\u6765\u8fdb\u884c\u7f51\u7ad9\u6587\u4ef6\u6216\u6570\u636e\u5e93\u7684\u5f02\u5730\u5907\u4efd\uff0c\u4ee5\u53ca\u6062\u590d\u5230\u6d4b\u8bd5\u73af\u5883\u8fdb\u884c\u9a8c\u8bc1\u7b49\u3002</li> <li>CI/CD: Shell \u811a\u672c\u9002\u7528\u4e0e DevOPS \u4e2d\u7684\u5728\u670d\u52a1\u5668\u4e2d\u6301\u7eed\u96c6\u6210\u6301\u7eed\u90e8\u7f72\u7684 pipeline \u6d41\u7a0b\u4e2d\uff0c\u9002\u7528\u4e8e\u5e94\u7528\u53d1\u5e03\u6700\u540e\u4e00\u516c\u91cc\u914d\u7f6e\u3002</li> <li>\u5176\u4ed6\uff1a\u5f53\u7136 Shell \u8fd8\u53ef\u4ee5\u505a\u4e00\u4e9b\u5176\u4ed6\u5de5\u4f5c\uff0c\u6bd4\u5982\u8fd0\u7b97 / \u751f\u6210\u62a5\u8868\uff0c\u751a\u81f3\u6709\u5927\u4f6c\u7528 Shell \u7f16\u5199\u6e38\u620f\u7b49\uff0c\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u6765\u5229\u7528\u597d Shell \u811a\u672c\u6765\u4e3a\u81ea\u5df1\u670d\u52a1\u3002</li> </ul>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#4","title":"4. \u5b66\u4e60\u524d\u63d0","text":"<p>\u5b66\u4e60 Shell \u811a\u672c\u975e\u5e38\u7b80\u5355\uff0c\u9700\u8981\u6709\u4e00\u53f0 Linux \u7cfb\u7edf\uff0c\u7cfb\u7edf\u7c7b\u578b\u53ef\u4ee5\u662f CentOS/RedHat \u6216 Ubuntu\uff0c\u7531\u4e8e\u4e0d\u540c\u7684\u7cfb\u7edf\u4f7f\u7528\u7684 Shell \u7c7b\u578b\u53ef\u80fd\u5b58\u5728\u5f02\u5e38\uff0c\u5efa\u8bae\u4f7f\u7528 CentOS 7 \u7cfb\u7edf\u6765\u5b66\u4e60\u672c\u793a\u4f8b\u3002</p>"},{"location":"linux/shell/Shell%E7%AE%80%E4%BB%8B/#5","title":"5. \u94fe\u63a5","text":"<ul> <li>https://github.com/fengyuhetao/shell</li> <li>https://github.com/daily-scripts/shell-scripts</li> </ul>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/","title":"Linux grub/grub2\u8be6\u89e3","text":""},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#grub","title":"\u4e00 grub\u662f\u4ec0\u4e48","text":"<p>GRUB\uff08GRand Unified Bootloader\uff09\u6307\u7684\u662f\u591a\u7cfb\u7edf\u5f15\u5bfc\u7ba1\u7406\u5668\uff0c\u5b83\u53ef\u4ee5\u5728\u591a\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5171\u5b58\u65f6\u9009\u62e9\u5f15\u5bfc\u67d0\u4e2a\u7cfb\u7edf\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#grub_1","title":"\u4e8c grub\u57fa\u7840\u6982\u5ff5","text":""},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#21-gurbgrub2","title":"2.1 gurb\u4e8egrub2\u7684\u533a\u522b","text":"<ul> <li>\u914d\u7f6e\u6587\u4ef6\u540d\u79f0\u6539\u53d8\uff1agurb\u4e2d\u4e3agrub.conf\u6216menu.lst(grub.conf\u7684\u4e00\u4e2a\u8f6f\u8fde\u63a5)\uff0cgurb2\u4e2d\u4e3agrub.cfg</li> <li>grub2\u4e2d\u65b0\u589e\u8bed\u6cd5\u66f4\u63a5\u8fd1\u811a\u672c\u8bed\u8a00\uff0c\u4f8b\u5982\u53d8\u91cf/\u6761\u4ef6\u5224\u65ad/\u5faa\u73af\u3002</li> <li>grub\u4e2d\u4ece0\u5f00\u59cb\uff0cgurb2\u4e2d\u8bbe\u5907\u5206\u533a\u4ece1\u5f00\u59cb\u3002</li> <li>grub2\u652f\u6301\u56fe\u5f62\u754c\u9762\u914d\u7f6e\uff0c\u4f46\u9700\u8981\u5b89\u88c5epel\u63d0\u4f9b\u7684grub-customizer\u5305</li> <li>\u4ee5\u8fdb\u5165\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\uff0c\u4e0d\u518d\u63d0\u4f9bgrub\u547d\u4ee4\uff0c\u5728gurb2\u4e2d\u6ca1\u6709find\u547d\u4ee4\u652f\u6301\u3002</li> <li>grub2\u80fd\u591f\u76f4\u63a5\u4ecelvm\u6216raid\u78c1\u76d8\u8bfb\u53d6\u6587\u4ef6\u76ee\u5f55</li> </ul>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#22","title":"2.2 \u547d\u540d\u4e0e\u6587\u4ef6\u8def\u5f84","text":"<ul> <li>(fd0) \u7b2c\u4e00\u5757\u8f6f\u76d8</li> <li>(hd0,msdos2):\u7b2c\u4e00\u5757\u786c\u76d8\u7684\u7b2c\u4e8c\u4e2ambr\u5206\u533a\uff0cgrub2\u4e2d\u5206\u533a\u4ece1\u5f00\u59cb\uff0c\u4f20\u7edfgrub\u5206\u533a\u4ece0\u5f00\u59cb</li> <li>(hd0,msdos5):\u7b2c\u4e00\u5757\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u5206\u533a</li> <li>(hd0,gpt1)\uff1a\u7b2c\u4e00\u5757\u786c\u76d8\u7684gpt\u5206\u533a</li> <li>/boot/vmlinux\uff1a\u76f8\u5bf9\u8def\u5f84\uff0c\u8868\u793a\u6839\u76ee\u5f55\u4e0b\u7684boot\u76ee\u5f55\u4e0b\u7684vmlinux</li> <li>(hd0,msdos1)/boot/vmlinux\uff1a\u7edd\u5bf9\u8def\u5f84\uff0c\u7b2c\u4e00\u5757\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a\u5206\u533a\u7684boot\u76ee\u5f55\u4e0b\u7684vmlinux\u6587\u4ef6</li> </ul>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#23-gurb2","title":"2.3 gurb2\u5f15\u5bfc\u64cd\u4f5c\u7cfb\u7edf\u65b9\u5f0f","text":"<ul> <li>\u76f4\u63a5\u5f15\u5bfc(direct-load)\uff1a\u76f4\u63a5\u4f7f\u7528\u9ed8\u8ba4grub2 boot loader\u6765\u5f15\u5bfc\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u4e2d\u64cd\u4f5c\u7cfb\u7edf</li> <li>\u94fe\u5f0f\u5f15\u5bfc(chain-load)\uff1a\u4f7f\u7528\u9ed8\u8ba4grub2 boot loader\u94fe\u5f0f\u5f15\u5bfc\u53e6\u4e00\u4e2aboot loader\uff0c\u6539boot loader\u5c06\u5f15\u5bfc\u5bf9\u5e94\u64cd\u4f5c\u7cfb\u7edf</li> </ul> <p>\u4e00\u822c\u4f7f\u7528\u7b2c\u4e00\u79cd\u76f4\u63a5\u5f15\u5bfc\uff0c\u53ea\u6709\u5f15\u5bfcgurb\u9ed8\u8ba4\u4e0d\u652f\u6301\u7684\u64cd\u4f5c\u7cfb\u7edf\u4f7f\u7528\u7b2c\u4e8c\u79cd</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#24-boot-loadergurb","title":"2.4 boot loader\u548cgurb\u5173\u7cfb","text":"<p>\u4f7f\u7528gurb\u6765\u7ba1\u7406\u542f\u52a8\u83dc\u5355\u65f6\uff0cboot loader\u90fd\u662fgrub\u7a0b\u5e8f\u5b89\u88c5\u7684\u3002</p> <ul> <li> <p>\u4f20\u7edfgurb\u5c06stage1\u8f6c\u6362\u540e\u7684\u5185\u5bb9\u5b89\u88c5\u5230MBR(VBR\u6216EBR)\u4e2d\u7684boot loader\u4e2d\uff0c\u5c06stage1_5\u8f6c\u6362\u540e\u7684\u5185\u5bb9\u5b89\u88c5\u5728\u7d27\u8ddf\u5728MBR\u540e\u7684\u6247\u533a\u4e2d\uff0c\u5c06stage2\u8f6c\u6362\u540e\u7684\u5185\u5bb9\u5b89\u88c5\u5728/boot\u5206\u533a\u4e2d</p> </li> <li> <p>gurb2\u5c06boot.img\u8f6c\u6362\u540e\u7684\u5185\u5bb9\u5b89\u88c5\u5230MBR(VBR\u6216EBR)\u4e2d\u7684boot loader\u90e8\u5206\uff0c\u5c06diskboot.img\u548ckernel.img\u7ed3\u5408\u6210\u4e3acore.img\uff0c\u540c\u65f6\u8fd8\u56de\u5d4c\u5165\u4e00\u4e9b\u6a21\u5757\u6216\u52a0\u8f7d\u6a21\u5757\u7684\u4ee3\u7801\u5230core.img\u4e2d\uff0c\u7136\u540e\u5c06core.img\u8f6c\u6362\u540e\u7684\u5185\u5bb9\u5b89\u88c5\u5230\u78c1\u76d8\u7684\u6307\u5b9a\u4f4d\u7f6e\u5904\u3002</p> </li> </ul>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#25-grub2","title":"2.5 grub2\u7684\u5b89\u88c5\u4f4d\u7f6e","text":"<p>core.img\u7684\u5b89\u88c5\u4f4d\u7f6e\u56e0\u4e3aboot.img\u4f4d\u7f6e\u662f\u56fa\u5b9a\u5728MBR\u6216VBR\u6216EBR\u4e0a</p> <ul> <li>MBR\u683c\u5f0f\u5206\u533a\u8868\u7528\u4e8ePC BIOS\u5e73\u53f0\uff0c\u8fd9\u79cd\u683c\u5f0f\u5141\u8bb8\u56db\u4e2a\u4e3b\u5206\u533a\u548c\u989d\u5916\u903b\u8f91\u5206\u533a\uff0c\u4f7f\u7528\u6b64\u79cd\u683c\u5f0f\u5206\u533a\u8868\uff0c\u4e24\u79cd\u65b9\u5f0f\u5b89\u88c5grub</li> <li>\u5d4c\u5165\u5230mbr\u548c\u7b2c\u4e00\u4e2a\u5206\u533a\u4e2d\u7ea7\u7684\u7a7a\u95f4\uff0c\u8fd9\u90e8\u5206\u5c31\u662f\u5927\u4f17\u6240\u8bf4\u7684\"boot track\"\uff0c\"MBR gap\"\u6216\"embedding area\"\uff0c\u5b83\u4eec\u5927\u81f4\u9700\u898131kB\u7a7a\u95f4,\u4f7f\u7528\u5d4c\u5165\u65b9\u5f0f\u5b89\u88c5grub\uff0c\u6ca1\u6709\u4fdd\u7559\u7684\u7a7a\u95f4\u6765\u4fdd\u8bc1\u5b89\u5168\u6027\uff0c\u4f8b\u5982\u6709\u4e9b\u4e13\u95e8\u8f6f\u4ef6\u5c31\u662f\u4f7f\u7528\u8fd9\u6bb5\u7a7a\u95f4\u5b9e\u73b0\u8bb8\u53ef\u9650\u5236\uff1b\u53e6\u5916\u5206\u533a\u7684\u65f6\u5019\uff0c\u867d\u8f6f\u56de\u5728mbr\u548c\u7b2c\u4e00\u4e2a\u5206\u533a\u4e2d\u95f4\u7559\u4e0b\u7a7a\u95f2\u7a7a\u95f4\uff0c\u4f46\u53ef\u80fd\u7559\u4e0b\u7684\u7a7a\u95f4\u6bd4\u8fd9\u4e2a\u66f4\u5c0f\u3002</li> <li>\u5c06core.img\u5b89\u88c5\u5230\u67d0\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u7136\u540e\u4f7f\u7528\u5206\u533a\u4e2d\u7b2c\u4e00\u4e2a\u6247\u533a(\u4e25\u683c\u6765\u8bf4\u4e0d\u662f\u7b2c\u4e00\u4e2a\u6247\u533a\uff0c\u800c\u662f\u7b2c\u4e00\u4e2ablock)\u5b58\u50a8\u542f\u52a8\u5b83\u7684\u4ee3\u7801\u3002\u8fd9\u79cd\u65b9\u5f0f\u5b89\u88c5grub\u5f88\u8106\u5f31\uff0c\u4f8b\u5982\u6587\u4ef6\u7cfb\u7edf\u67d0\u4e9b\u7279\u6027\u9700\u8981\u505a\u6210\u5c3e\u90e8\u5305\u88c5\uff0c\u751a\u81f3\u67d0\u4e9bfsck\u68c0\u6d4b\uff0c\u5b83\u4eec\u53ef\u80fd\u79fb\u52a8\u8fd9\u4e9bblock\u3002</li> </ul> <p>GRUB\u5f00\u53d1\u56e2\u961f\u5efa\u8bae\u5c06grub\u5d4c\u5165\u5230mbr\u548c\u7b2c\u4e00\u4e2a\u5206\u533a\u4e4b\u95f4\uff0c\u9664\u975e\u6709\u7279\u6b8a\u9700\u6c42\uff0c\u4f46\u4efb\u9700\u8981\u4fdd\u8bc1\u7b2c\u4e00\u4e2a\u5206\u533a\u81f3\u5c11\u4ece\u7b2c31kB\uff08\u7b2c63\u4e2a\u6247\u533a\uff09</p> <p>\u4e4b\u540e\u5f00\u59cb\u521b\u5efa\uff0c\u73b0\u5728\u7684\u78c1\u76d8\u8bbe\u5907\uff0c\u4e00\u822c\u90fd\u4f1a\u6709\u55ef\u53bb\u8fa9\u89e3\u5bf9\u9f50\u7684\u6027\u80fd\u4f18\u5316\u63d0\u9192\uff0c\u6240\u6709\u7b2c\u4e00\u4e2a\u5206\u533a\u53ef\u80fd\u81ea\u52a8\u4ece\u7b2c1MB\u5904\u5f00\u59cb\u521b\u5efa</p> <ul> <li>GPT</li> </ul>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#26-grub","title":"2.6 \u8fdb\u5165grub\u547d\u4ee4\u884c","text":"<p>\u4f20\u7edfgrub\u4e0a\uff0c\u53ef\u4ee5\u76f4\u63a5bash\u6572\u5165grub\u547d\u4ee4\u8fdb\u5165\u547d\u4ee4\u4ea4\u4e92\u6a21\u5f0f\uff0c\u4f46\u5728grub2\u53ea\u80fd\u5728\u7cfb\u7edf\u542f\u52a8\u524d\u8fdb\u5165grub\u4ea4\u4e92\u547d\u4ee4\u884c</p> <p>\u6309e\u53ef\u4ee5\u7f16\u8f91\u6240\u9009\u83dc\u5355\u5bf9\u5e94grub\u83dc\u5355\u914d\u7f6e\u9879\uff0c\u6309c\u53ef\u4ee5\u8fdb\u5165grub\u547d\u4ee4\u884c\u4ea4\u4e92\u6a21\u5f0f</p> <p>\u4fee\u6539\u5b8c\u6bd5\u540e\u53ef\u4ee5\u6309ctl+x\u542f\u52a8\u7cfb\u7edf\uff0c</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#grub_2","title":"\u4e09 grub\u6a21\u5757","text":"<p>\u5bf9\u4e8eGRUB-2.0.2\u7248\u672c\u6765\u8bf4\uff0c\u5b98\u65b9\u63d0\u4f9b\u7684\u6a21\u5757\u4e00\u5171\u6709200\u591a\u4e2a\uff0c\u8fd9\u4e9b\u6a21\u5757\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u7c7b(\u6a21\u5757\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u4f4d\u4e8e\"moddep.lst\"\u6587\u4ef6\u4e2d)\uff1a</p> <p></p> <ul> <li>\u547d\u4ee4\u6a21\u5757[command.lst]</li> </ul> <p>\u63d0\u4f9b\u4e86\u5404\u79cd\u4e0d\u540c\u7684\u529f\u80fd\uff0c\u7c7b\u4f3c\u6807\u51c6Unix\u547d\u4ee4\uff0c\u4e00\u5171\u5c06\u8fd1100\u4e2a\u3002\u4f8b\u5982\uff1acat cpuid echo halt lspci chainloader initrd linux password ...</p> <ul> <li>\u52a0\u5bc6\u6a21\u5757[crypto.lst]</li> </ul> <p>\u63d0\u4f9b\u4e86\u5404\u79cd\u6570\u636e\u5b8c\u6574\u6027\u6821\u9a8c\u4e0e\u5bc6\u7801\u7b97\u6cd5\u652f\u6301\uff0c\u4e00\u517120\u591a\u4e2a\u3002\u4f8b\u5982\uff1agcry_rijndael crc64 gcry_md5 ...</p> <ul> <li>\u6587\u4ef6\u7cfb\u7edf\u6a21\u5757[fs.lst]</li> </ul> <p>\u63d0\u4f9b\u4e86\u8bbf\u95ee\u5404\u79cd\u6587\u4ef6\u7cfb\u7edf\u7684\u529f\u80fd\uff0c\u4e00\u517130\u591a\u4e2a\u3002\u4f8b\u5982\uff1abtrfs cpio exfat ext2 fat iso9660 ntfs tar xfs zfs ...</p> <ul> <li>\u5206\u533a\u6a21\u5757[partmap.lst]</li> </ul> <p>\u63d0\u4f9b\u4e86\u8bc6\u522b\u5404\u79cd\u5206\u533a\u683c\u5f0f\u7684\u529f\u80fd\uff0c\u4e00\u517110\u591a\u4e2a\u3002\u4f8b\u5982\uff1apart_bsd part_gpt part_msdos ...</p> <ul> <li>\u5206\u533a\u5de5\u5177[parttool.lst]</li> </ul> <p>\u63d0\u4f9b\u4e86\u64cd\u4f5c\u5404\u79cd\u5206\u533a\u683c\u5f0f\u7684\u529f\u80fd\uff0c\u76ee\u524d\u53ea\u6709 msdospart \u8fd9\u4e00\u4e2a\u3002</p> <ul> <li>\u7ec8\u7aef\u6a21\u5757[terminal.lst]</li> </ul> <p>\u63d0\u4f9b\u4e86\u5404\u79cd\u4e0d\u540c\u7ec8\u7aef\u7684\u652f\u6301\uff0c\u4e00\u5171\u4e0d\u523010\u4e2a\u3002\u4f8b\u5982\uff1aserial gfxterm vga_text at_keyboard ...</p> <ul> <li>\u89c6\u9891\u6a21\u5757[video.lst]</li> </ul> <p>\u63d0\u4f9b\u4e86\u5404\u79cd\u4e0d\u540c\u7684\u89c6\u9891\u6a21\u5f0f\u652f\u6301\uff0c\u4e00\u51716\u4e2a\u3002\u4f8b\u5982\uff1avga vbe efi_gop efi_uga ...</p> <ul> <li>\u5176\u4ed6\u6a21\u5757</li> </ul> <p>\u6240\u6709\u672a\u5728\u4e0a\u8ff0\u5206\u7c7b\u6587\u4ef6\u4e2d\u5217\u51fa\u7684\u6a21\u5757\u90fd\u5f52\u4e3a\u8fd9\u4e00\u7c7b\uff0c\u4e00\u5171\u5c06\u8fd1100\u4e2a\u3002\u503c\u5f97\u5173\u6ce8\u7684\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff1a</p> <p>a. \"all_video\"\u53ef\u7528\u4e8e\u4e00\u6b21\u6027\u52a0\u8f7d\u5f53\u524d\u6240\u6709\u53ef\u7528\u7684\u89c6\u9891\u6a21\u5757\uff1b</p> <p>b. \"gfxmenu\"\u53ef\u7528\u4e8e\u63d0\u4f9b\u4e3b\u9898\u652f\u6301\uff1b</p> <p>c. \"jpeg png tga\"\u53ef\u7528\u4e8e\u63d0\u4f9b\u7279\u5b9a\u683c\u5f0f\u7684\u80cc\u666f\u56fe\u7247\u652f\u6301\uff1b</p> <p>d. \"xzio gzio lzopio\"\u53ef\u7528\u4e8e\u63d0\u4f9b\u7279\u5b9a\u538b\u7f29\u683c\u5f0f\u652f\u6301(\u5e38\u914d\u5408\"initrd\"\u547d\u4ee4\u4f7f\u7528)\uff1b</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#grub_3","title":"\u56db grub\u6551\u63f4\u6a21\u5f0f","text":""},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#41-grubbios","title":"4.1 grub\u5728BIOS\u5e73\u53f0\u542f\u52a8\u6d41\u7a0b","text":"<p>GRUB2\u5728BIOS\u5e73\u53f0\u4e0a\u7684\u5e38\u89c4\u542f\u52a8\u6b65\u9aa4\u662f\u8fd9\u6837\u7684\uff1aBIOS \u2192 boot.img[MBR] \u2192 core.img[MBR gap/embedding area/BIOS Boot Partition] \u2192 \u8bbe\u7f6e\"prefix root cmdpath\"\u73af\u5883\u53d8\u91cf \u2192 \u52a0\u8f7d\"normal.mod\"\u6a21\u5757[\u540c\u65f6\u8fd8\u5305\u62ec\u5b83\u6240\u4f9d\u8d56\u7684 terminal crypto extcmd boot gettext \u6a21\u5757] \u2192 \u6267\u884c\"normal $prefix/grub.cfg\"\u547d\u4ee4</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#42-grub2uefi","title":"4.2 GRUB2\u5728UEFI\u5e73\u53f0\u542f\u52a8\u6d41\u7a0b","text":"<p>GRUB2\u5728UEFI\u5e73\u53f0\u4e0a\u7684\u5e38\u89c4\u542f\u52a8\u6b65\u9aa4\u662f\u8fd9\u6837\u7684\uff1aUEFI \u2192 core.img[BOOTX64.EFI/BOOTX86.EFI] \u2192 \u8bbe\u7f6e\"prefix root cmdpath\"\u73af\u5883\u53d8\u91cf \u2192 \u52a0\u8f7d\"normal.mod\"\u6a21\u5757[\u540c\u65f6\u8fd8\u5305\u62ec\u5b83\u6240\u4f9d\u8d56\u7684 terminal crypto extcmd boot gettext \u6a21\u5757] \u2192 \u6267\u884c\"normal $prefix/grub.cfg\"\u547d\u4ee4</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#43","title":"4.3 \u666e\u901a\u6a21\u5f0f","text":"<p>\u5982\u679c\u4e0a\u8ff0\u6b65\u9aa4\u5168\u90e8\u6210\u529f\uff0c\u90a3\u4e48\u4f60\u5c06\u8fdb\u5165'\u666e\u901a\u6a21\u5f0f'\uff0c\u4e00\u822c\u662f\u663e\u793a\u4e00\u4e2a\u83dc\u5355(\u627e\u5230\u4e86'$prefix/grub.cfg')\uff0c\u6216\u8005\u76f4\u63a5\u8fdb\u5165GRUB SHELL(\u6ca1\u627e\u5230'$prefix/grub.cfg')\u3002\u5728\u666e\u901a\u6a21\u5f0f\u4e2d\uff0c\u547d\u4ee4\u6a21\u5757[command.lst]\u4e0e\u52a0\u5bc6\u6a21\u5757[crypto.lst]\u4f1a\u88ab\u81ea\u52a8\u6309\u9700\u8f7d\u5165(\u65e0\u9700\u4f7f\u7528\"insmod\"\u547d\u4ee4)\uff0c\u5e76\u4e14\u53ef\u4f7f\u7528\u5b8c\u6574\u7684GRUB\u811a\u672c\u529f\u80fd\u3002\u4f46\u662f\u5176\u4ed6\u6a21\u5757\u5219\u53ef\u80fd\u9700\u8981\u660e\u786e\u4f7f\u7528\"insmod\"\u547d\u4ee4\u6765\u8f7d\u5165\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#44","title":"4.4 \u6551\u63f4\u6a21\u5f0f","text":"<p>\u5982\u679c\u5728\u52a0\u8f7d\"normal.mod\"\u6a21\u5757\u8fd9\u4e00\u6b65\u51fa\u73b0\u6545\u969c\uff0c\u90a3\u4e48\u4f60\u5c06\u8fdb\u5165GRUB2\u7684'\u6551\u63f4\u6a21\u5f0f'\uff0c\u800c\u4e0d\u662f\u5e38\u89c4\u7684'\u666e\u901a\u6a21\u5f0f'\u3002\u5728\u6551\u63f4\u6a21\u5f0f\u4e2d\uff0cGRUB\u53ea\u81ea\u52a8\u8bbe\u7f6e\u4e86\"cmdpath prefix root\"\u4e09\u4e2a\u73af\u5883\u53d8\u91cf\uff0c\u5e76\u4e14\u53ea\u80fd\u4f7f\u7528\"insmod ls set unset\"\u56db\u4e2a\u547d\u4ee4\u3002\u53ea\u6709\u5f53\u989d\u5916\u7684\u6a21\u5757\u88ab\u52a0\u8f7d\u4e4b\u540e\uff0c\u624d\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u5176\u5b83\u7684\u547d\u4ee4,\u53d8\u91cf,\u89e3\u6790\u5668,\u9a71\u52a8\u7a0b\u5e8f\u3002\u901a\u5e38\u6765\u8bf4\uff0c\u8fdb\u5165\u6551\u63f4\u6a21\u5f0f\u53ef\u80fd\u610f\u5473\u7740\u4f60\u7684GRUB2\u6ca1\u6709\u6b63\u786e\u5b89\u88c5\u3002\u8bf7\u8ba4\u771f\u9605\u8bfb'grub-install --help'\u7684\u8f93\u51fa\u9009\u9879\uff0c\u5e76\u4f7f\u7528\u6b63\u786e\u7684\u9009\u9879\u91cd\u65b0\u5b89\u88c5\u3002\u66f4\u591a\u7ec6\u8282\u8bf7\u53c2\u8003GRUB2\u624b\u518c\u4e2d\u7684\"GRUB only offers a rescue shell\"\u90e8\u5206\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#grub2","title":"\u4e94 grub2\u547d\u540d\u89c4\u5219","text":""},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#51","title":"5.1 \u8bbe\u5907\u4e0e\u5206\u533a","text":"<p>GRUB2\u5bf9\u8bbe\u5907\u4e0e\u5206\u533a\u7684\u547d\u540d\u89c4\u5219\u4e3e\u4f8b\u5982\u4e0b\uff0c\u770b\u770b\u5c31\u80fd\u660e\u767d\u3002\u9700\u8981\u8bf4\u660e\u7684\u662f\u78c1\u76d8\u4ece\"0\"\u5f00\u59cb\u8ba1\u6570\uff0c\u5206\u533a\u4ece\"1\"\u5f00\u59cb\u8ba1\u6570\u3002</p> <p>GRUB2\u5bf9\u8bbe\u5907\u4e0e\u5206\u533a\u7684\u547d\u540d\u89c4\u5219\u4e3e\u4f8b\u5982\u4e0b\uff0c\u770b\u770b\u5c31\u80fd\u660e\u767d\u3002\u9700\u8981\u8bf4\u660e\u7684\u662f\u78c1\u76d8\u4ece\"0\"\u5f00\u59cb\u8ba1\u6570\uff0c\u5206\u533a\u4ece\"1\"\u5f00\u59cb\u8ba1\u6570\u3002</p> <pre><code>(fd0)          \u7b2c\u4e00\u8f6f\u76d8\n(hd0)          \u7b2c\u4e00\u786c\u76d8[\u5927\u591a\u6570U\u76d8\u4e0eUSB\u63a5\u53e3\u7684\u79fb\u52a8\u786c\u76d8\u4ee5\u53caSD\u5361\u4e5f\u90fd\u88ab\u5f53\u4f5c\u786c\u76d8\u770b\u5f85]\n(hd1,1)        \u7b2c\u4e8c\u786c\u76d8\u7684\u7b2c\u4e00\u5206\u533a(\u901a\u7528\u4e8eMBR\u4e0eGPT\u5206\u533a)\n(hd0,msdos2)   \u7b2c\u4e00\u786c\u76d8\u7684\u7b2c\u4e8cMBR\u5206\u533a\uff0c\u4e5f\u5c31\u662f\u4f20\u7edf\u7684DOS\u5206\u533a\u8868\n(hd1,msdos5)   \u7b2c\u4e8c\u786c\u76d8\u7684\u7b2c\u4e94MBR\u5206\u533a\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u4e2a\u903b\u8f91\u5206\u533a\n(hd0,gpt1)     \u7b2c\u4e00\u786c\u76d8\u7684\u7b2c\u4e00GPT\u5206\u533a\n(cd)           \u542f\u52a8\u5149\u76d8[\u4ec5\u5728\u4ece\u5149\u76d8\u542f\u52a8GRUB\u65f6\u53ef\u7528]\n(cd0)          \u7b2c\u4e00\u5149\u76d8\n</code></pre> <p>\u4e0a\u9762\u6240\u4e3e\u7684\u4f8b\u5b50\u4ec5\u662f\u6700\u5e38\u7528\u7684\u60c5\u5f62\uff0c\u66f4\u591a\u9ad8\u7ea7\u7684\u8bbe\u5907\u547d\u540d\u89c4\u5219\u8bf7\u53c2\u8003GRUB2\u624b\u518c\u4e2d\u7684\"Naming convention\"\u4e0e\"How to specify devices\"\u90e8\u5206\u3002\u6b64\u5916\uff0c\u5982\u679c\u4f60\u60f3\u770b\u770b\u5f53\u524d\u7cfb\u7edf\u4e0a\u6709\u54ea\u4e9b\u8bbe\u5907\u53ef\u7528\uff0c\u53ef\u4ee5\u5728GRUB SHELL\u4e2d\u4f7f\u7528\"ls\"\u547d\u4ee4(\u53ef\u80fd\u9700\u8981\u5148\u52a0\u8f7d\u5fc5\u8981\u7684\u9a71\u52a8\u6a21\u5757)\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#52","title":"5.2 \u6587\u4ef6","text":"<p>\u6587\u4ef6\u7684\u547d\u540d\u65b9\u6cd5\u6709\u4e24\u79cd\uff1a(1)\u7edd\u5bf9\u8def\u5f84\u8868\u793a\u6cd5\uff0c(2)\u76f8\u5bf9\u8def\u5f84\u8868\u793a\u6cd5\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#521","title":"5.2.1 \u7edd\u5bf9\u8def\u5f84","text":"<pre><code>(fd0)/grldr                 \u7b2c\u4e00\u8f6f\u76d8\u6839\u76ee\u5f55\u4e0b\u7684\"grldr\"\u6587\u4ef6[\u7edd\u5bf9\u8def\u5f84]\n(hd0,gpt1)/boot/vmlinuz     \u7b2c\u4e00\u786c\u76d8\u7684\u7b2c\u4e00GPT\u5206\u533a\"boot\"\u76ee\u5f55\u4e0b\u7684\"vmlinuz\"\u6587\u4ef6[\u7edd\u5bf9\u8def\u5f84]\n</code></pre>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#522","title":"5.2.2 \u76f8\u5bf9\u8def\u5f84","text":"<pre><code>/boot/vmlinuz               \u6839\u8bbe\u5907\"boot\"\u76ee\u5f55\u4e0b\u7684\"vmlinuz\"\u6587\u4ef6[\u76f8\u5bf9\u8def\u5f84]\uff0c\n                            \u5f53\"root\"\u73af\u5883\u53d8\u91cf\u7b49\u4e8e\"(hd0,gpt1)\"\u65f6\uff0c\u7b49\u4ef7\u4e8e\"(hd0,gpt1)/boot/vmlinuz\"\n</code></pre> <p>\u4e0a\u9762\u6240\u4e3e\u7684\u4f8b\u5b50\u4ec5\u662f\u6700\u5e38\u7528\u7684\u60c5\u5f62\uff0c\u66f4\u591a\u9ad8\u7ea7\u7684\u6587\u4ef6\u547d\u540d\u89c4\u5219\u8bf7\u53c2\u8003GRUB2\u624b\u518c\u4e2d\u7684\"How to specify files\"\u90e8\u5206\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#53","title":"5.3 \u78c1\u76d8\u5757","text":"<p>\u78c1\u76d8\u5757\u7684\u547d\u540d\u65b9\u6cd5\u540c\u6837\u4e5f\u6709\u4e24\u79cd\uff1a(1)\u7edd\u5bf9\u8def\u5f84\u8868\u793a\u6cd5\uff0c(2)\u76f8\u5bf9\u8def\u5f84\u8868\u793a\u6cd5</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#531","title":"5.3.1 \u7edd\u5bf9\u8def\u5f84","text":"<pre><code>(hd1,1)0+1  \u5728\u7b2c\u4e8c\u786c\u76d8\u7684\u7b2c\u4e00\u5206\u533a\u4e0a\uff0c\u4ece\u7b2c\"0\"\u4e2a\u78c1\u76d8\u5757(\u9996\u6247\u533a)\u8d77\uff0c\u957f\u5ea6\u4e3a\"1\"\u7684\u8fde\u7eed\u5757\u3002[\u7edd\u5bf9\u8def\u5f84]\n(hd1,1)+1   \u542b\u4e49\u4e0e\u4e0a\u4e00\u4e2a\u76f8\u540c\uff0c\u56e0\u4e3a\u5f53\u4ece\u7b2c\"0\"\u4e2a\u78c1\u76d8\u5757(\u9996\u6247\u533a)\u8d77\u65f6\uff0c\"0\"\u53ef\u4ee5\u7701\u7565\u4e0d\u5199\u3002[\u7edd\u5bf9\u8def\u5f84]\n</code></pre>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#532","title":"5.3.2 \u76f8\u5bf9\u8def\u5f84","text":"<pre><code>+1          \u5728\u6839\u8bbe\u5907\u4e0a\uff0c\u4ece\u7b2c\"0\"\u4e2a\u78c1\u76d8\u5757(\u9996\u6247\u533a)\u8d77\uff0c\u957f\u5ea6\u4e3a\"1\"\u7684\u8fde\u7eed\u5757\u3002[\u76f8\u5bf9\u8def\u5f84]\n            \u5f53\"root\"\u73af\u5883\u53d8\u91cf\u7b49\u4e8e\"(hd1,1)\"\u65f6\uff0c\u7b49\u4ef7\u4e8e\"(hd1,1)0+1\"\n</code></pre> <p>\u78c1\u76d8\u5757\u51e0\u4e4e\u53ea\u7528\u4e8e\u94fe\u5f0f\u5f15\u5bfc(chainloader)\u7684\u573a\u5408\u3002\u66f4\u591a\u9ad8\u7ea7\u7684\u78c1\u76d8\u5757\u547d\u540d\u89c4\u5219\u8bf7\u53c2\u8003GRUB2\u624b\u518c\u4e2d\u7684\"How to specify block lists\"\u90e8\u5206\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#grub2_1","title":"\u516d grub2\u73af\u5883\u53d8\u91cf","text":"<p>GRUB2\u7684\u73af\u5883\u53d8\u91cf\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b:</p> <p>\u7b2c\u4e00\u7c7b\u662f\u81ea\u52a8\u8bbe\u7f6e\u7684\u53d8\u91cf\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e9b\u53d8\u91cf\u7684\u521d\u59cb\u503c\u7531GRUB2\u81ea\u52a8\u8bbe\u7f6e\uff0c\u5176\u503c\u5fc5\u5b9a\u5b58\u5728\u4e14\u4e0d\u4e3a\u7a7a\u3002</p> <p>\u7b2c\u4e8c\u7c7b\u662f\u624b\u52a8\u8bbe\u7f6e\u7684\u53d8\u91cf\uff0c\u5b83\u4eec\u6ca1\u6709\u521d\u59cb\u503c(\u6216\u8005\u521d\u59cb\u503c\u4e3a\u7a7a)\uff0c\u9700\u8981\u7ecf\u8fc7\u624b\u52a8\u660e\u786e\u8bbe\u7f6e\u4e4b\u540e\u624d\u80fd\u4f7f\u7528\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#61","title":"6.1 \u4ece\u6a21\u5757\u89d2\u5ea6\u53d8\u91cf\u5206\u7c7b","text":"<p>\u5927\u591a\u6570\u6709\u7279\u5b9a\u542b\u4e49\u7684\u73af\u5883\u53d8\u91cf\u90fd\u662f\u9644\u5c5e\u4e8e\u7279\u5b9a\u9644\u52a0\u6a21\u5757\u7684\uff0c\u53ea\u6709\u52a0\u8f7d\u4e86\u8fd9\u4e9b\u6a21\u5757\u4e4b\u540e\uff0c\u8fd9\u4e9b\u73af\u5883\u53d8\u91cf\u624d\u53d8\u5f97\u6709\u610f\u4e49\u3002\u6240\u4ee5\u4ece\u6a21\u5757\u7684\u89d2\u5ea6\u770b\uff0cGRUB2\u7684\u73af\u5883\u53d8\u91cf\u53c8\u53ef\u4ee5\u5206\u4e3a\u4e09\u7c7b\uff1a</p> <p>(1)\u6838\u5fc3\u53d8\u91cf\uff0cGRUB2\u6838\u5fc3\u63d0\u4f9b\u7684\u53d8\u91cf\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u4efb\u4f55\u53ef\u52a0\u8f7d\u6a21\u5757\uff0c\u8fd9\u6837\u7684\u53d8\u91cf\u53ea\u6709\"cmdpath prefix root\"\u4e09\u4e2a\uff0c\u800c\u4e14\u5b83\u4eec\u7684\u521d\u59cb\u503c\u90fd\u7531GRUB2\u81ea\u52a8\u8bbe\u7f6e\u3002</p> <p>(2)\u6a21\u5757\u53d8\u91cf\uff0c\u7edd\u5927\u591a\u6570\u6709\u7279\u5b9a\u542b\u4e49\u7684\u73af\u5883\u53d8\u91cf\u90fd\u5c5e\u6b64\u7c7b\u3002</p> <p>(3)\u811a\u672c\u53d8\u91cf\uff0c\u8fd9\u662f\u4e3a\u4e86\u65b9\u4fbf\u7f16\u5199grub.cfg\u811a\u672c\u800c\u8bbe\u7f6e\u7684\u53d8\u91cf\uff0c\u6ca1\u6709\u7279\u6b8a\u542b\u4e49\uff0c\u4e5f\u4e0d\u4f9d\u8d56\u4e8e\u7279\u5b9a\u6a21\u5757\uff0c\u4e0e\u4e00\u822c\u7684bash\u811a\u672c\u4e2d\u7684\u53d8\u91cf\u7c7b\u4f3c\u3002</p> <p>\u6709\u5173GRUB2\u811a\u672c\u7684\u5b8c\u6574\u8bf4\u660e\u53ef\u4ee5\u53c2\u8003GRUB2\u624b\u518c\u4e2d\u7684\"Writing full configuration files directly\"\u90e8\u5206\uff0c\u57fa\u672c\u4e0a\u5176\u8bed\u6cd5\u4e0ebash\u811a\u672c\u5b8c\u5168\u4e00\u81f4\uff0c\u4e0a\u624b\u975e\u5e38\u5bb9\u6613\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#62","title":"6.2 \u7279\u6b8a\u53d8\u91cf","text":"<p>\u4e0b\u9762\u5217\u51fa\u7684\u53d8\u91cf\u90fd\u662f\u6709\u7279\u5b9a\u542b\u4e49\u7684\u53d8\u91cf\uff0c\u8fd9\u91cc\u53ea\u5217\u51fa\u5e38\u7528\u7684\u4e00\u4e9b\u53d8\u91cf\uff0c\u5b8c\u6574\u7684\u5217\u8868\u53ef\u4ee5\u53c2\u8003GRUB2\u624b\u518c\u4e2d\u7684\"Special environment variables\"\u90e8\u5206\u3002</p> <ul> <li>?\uff1a\u4e0a\u4e00\u6761\u547d\u4ee4\u7684\u8fd4\u56de\u503c\uff0c\u96f6\u8868\u793a\u6210\u529f\uff0c\u975e\u96f6\u8868\u793a\u5931\u8d25[\u4e0ebash\u4e00\u6837]\u3002\u7531GRUB2\u81ea\u52a8\u8bbe\u7f6e\u3002\u4f60\u53ea\u80fd\u4f7f\u7528\u6b64\u53d8\u91cf\uff0c\u800c\u4e0d\u80fd\u4fee\u6539\u5b83\u3002</li> <li>check_signatures\uff1a\u662f\u5426\u5728\u52a0\u8f7d\u6587\u4ef6\u65f6\u5f3a\u5236\u9a8c\u8bc1\u7b7e\u540d\uff0c\u53ef\u4ee5\u8bbe\u4e3a'enforce'\u6216'no'</li> <li>chosen\uff1a\u5f53\u524d\u88ab\u6267\u884c\u7684\u83dc\u5355\u9879\u540d\u79f0(\u7d27\u8ddf\"menuentry\"\u547d\u4ee4\u4e4b\u540e\u7684\u5b57\u7b26\u4e32\u6216\u8005'--id'\u9009\u9879\u7684\u53c2\u6570)\uff0c\u4f8b\u5982'Windows 7'\u3002\u7531GRUB2\u81ea\u52a8\u8bbe\u7f6e\u3002\u4f60\u53ea\u5e94\u8be5\u4f7f\u7528\u6b64\u53d8\u91cf\uff0c\u800c\u4e0d\u5e94\u8be5\u4fee\u6539\u5b83\u3002</li> <li>cmdpath\uff1a\u5f53\u524d\u88ab\u52a0\u8f7d\u7684\"core.img\"\u6240\u5728\u76ee\u5f55(\u7edd\u5bf9\u8def\u5f84)\u3002\u4f8b\u5982\uff1aUEFI\u542f\u52a8\u53ef\u80fd\u662f'(hd0,gpt1)/EFI/UBUNTU'\u6216'(cd0)/EFI/BOOT'\uff0cBIOS\u542f\u52a8\u53ef\u80fd\u662f'(hd0)'\u3002\u7531GRUB2\u81ea\u52a8\u8bbe\u7f6e\u3002\u4f60\u53ea\u5e94\u8be5\u4f7f\u7528\u6b64\u53d8\u91cf\uff0c\u800c\u4e0d\u5e94\u8be5\u4fee\u6539\u5b83\u3002</li> <li>debug\uff1a\u8bbe\u4e3a'all'\u65f6\u8868\u793a\u5f00\u542f\u8c03\u8bd5\u8f93\u51fa[\u4f1a\u663e\u793a\u5927\u91cf\u4fe1\u606f,\u8c28\u614e\u5f00\u542f]</li> <li>default\uff1a\u9ed8\u8ba4\u9009\u4e2d\u7b2c\u51e0\u4e2a\u83dc\u5355\u9879(\u4ece'0'\u5f00\u59cb\u8ba1\u6570)</li> <li>fallback\uff1a\u5982\u679c\u9ed8\u8ba4\u83dc\u5355\u9879\u542f\u52a8\u5931\u8d25\uff0c\u90a3\u4e48\u5c31\u542f\u52a8\u7b2c\u51e0\u4e2a\u83dc\u5355\u9879(\u4ece'0'\u5f00\u59cb\u8ba1\u6570)</li> <li>gfxmode\uff1a\u8bbe\u7f6e\"gfxterm\"\u6a21\u5757\u6240\u4f7f\u7528\u7684\u89c6\u9891\u6a21\u5f0f\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u7ec4\u7531\u9017\u53f7\u6216\u5206\u53f7\u5206\u9694\u7684\u6a21\u5f0f\u4ee5\u4f9b\u9010\u4e00\u5c1d\u8bd5\uff1a\u6bcf\u4e2a\u6a21\u5f0f\u7684\u683c\u5f0f\u5fc5\u987b\u662f\uff1a'auto'(\u81ea\u52a8\u68c0\u6d4b),'\u5bbdx\u9ad8','\u5bbdx\u9ad8x\u8272\u6df1'\u4e4b\u4e00\uff0c\u5e76\u4e14\u53ea\u80fd\u4f7f\u7528VBE\u6807\u51c6\u6307\u5b9a\u7684\u6a21\u5f0f[640x480,800x600,1024x768,1280x1024]x[16,24,32]\u3002\u53ef\u4ee5\u5728GRUB SHELL\u4e2d\u4f7f\u7528\"videoinfo\"\u547d\u4ee4\u5217\u51fa\u5f53\u524d\u6240\u6709\u53ef\u7528\u6a21\u5f0f\u3002\u9ed8\u8ba4\u503c\u662f'auto'\u3002</li> <li>gfxpayload: \u8bbe\u7f6eLinux\u5185\u6838\u542f\u52a8\u65f6\u7684\u89c6\u9891\u6a21\u5f0f\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u7ec4\u7531\u9017\u53f7\u6216\u5206\u53f7\u5206\u9694\u7684\u6a21\u5f0f\u4ee5\u4f9b\u9010\u4e00\u5c1d\u8bd5\uff1a\u6bcf\u4e2a\u6a21\u5f0f\u7684\u683c\u5f0f\u5fc5\u987b\u662f\uff1a'text'(\u666e\u901a\u6587\u672c\u6a21\u5f0f,\u4e0d\u80fd\u7528\u4e8eUEFI\u5e73\u53f0),'keep'(\u7ee7\u627f\"gfxmode\"\u7684\u503c),'auto'(\u81ea\u52a8\u68c0\u6d4b),'\u5bbdx\u9ad8','\u5bbdx\u9ad8x\u8272\u6df1'\u4e4b\u4e00\uff0c\u5e76\u4e14\u53ea\u80fd\u4f7f\u7528VBE\u6807\u51c6\u6307\u5b9a\u7684\u6a21\u5f0f[640x480,800x600,1024x768,1280x1024]x[16,24,32]\u3002\u5728BIOS\u5e73\u53f0\u4e0a\u7684\u9ed8\u8ba4\u503c\u662f'text'\uff0c\u5728UEFI\u5e73\u53f0\u4e0a\u7684\u9ed8\u8ba4\u503c\u662f'auto'\u3002\u9664\u975e\u4f60\u60f3\u660e\u786e\u8bbe\u7f6eLinux\u63a7\u5236\u53f0\u7684\u5206\u8fa8\u7387(\u8981\u6c42\u5185\u6838\u5fc5\u987b\"CONFIG_FRAMEBUFFER_CONSOLE=y\")\uff0c\u6216\u8005\u6253\u7b97\u5728BIOS\u5e73\u53f0\u4e0a\u4f7f\u7528\u56fe\u5f62\u63a7\u5236\u53f0(\u8981\u6c42\u5185\u6838\u5fc5\u987b\"CONFIG_FRAMEBUFFER_CONSOLE=y\")\uff0c\u5426\u5219\u4e0d\u8981\u8bbe\u7f6e\u6b64\u53d8\u91cf\u3002</li> <li>gfxterm_font\uff1a\u8bbe\u7f6e\"gfxterm\"\u6a21\u5757\u6240\u4f7f\u7528\u7684\u5b57\u4f53\uff0c\u9ed8\u8ba4\u4f7f\u7528\u6240\u6709\u53ef\u7528\u5b57\u4f53</li> <li>grub_cpu\uff1a\u6b64GRUB\u6240\u9002\u7528\u7684CPU\u7c7b\u578b\u3002\u4f8b\u5982\uff1a'i386', 'x86_64'\u3002\u7531GRUB2\u81ea\u52a8\u8bbe\u7f6e\u3002\u4f60\u53ea\u5e94\u8be5\u4f7f\u7528\u6b64\u53d8\u91cf\uff0c\u800c\u4e0d\u5e94\u8be5\u4fee\u6539\u5b83\u3002</li> <li>grub_platform\uff1a\u6b64GRUB\u6240\u9002\u7528\u7684\u5e73\u53f0\u7c7b\u578b\u3002\u4f8b\u5982\uff1a'pc', 'efi'\u3002\u7531GRUB2\u81ea\u52a8\u8bbe\u7f6e\u3002\u4f60\u53ea\u5e94\u8be5\u4f7f\u7528\u6b64\u53d8\u91cf\uff0c\u800c\u4e0d\u5e94\u8be5\u4fee\u6539\u5b83\u3002</li> <li>lang\uff1a\u8bbe\u7f6eGRUB2\u7684\u754c\u9762\u8bed\u8a00\uff0c\u5fc5\u987b\u642d\u914d\"locale_dir\"\u53d8\u91cf\u4e00\u8d77\u4f7f\u7528\u3002\u7b80\u4f53\u4e2d\u6587\u5e94\u8bbe\u4e3a'zh_CN'\u3002</li> <li>locale_dir\uff1a\u8bbe\u7f6e\u7ffb\u8bd1\u6587\u4ef6(*.mo)\u7684\u76ee\u5f55\uff0c\u901a\u5e38\u662f'$prefix/locale'\uff0c\u82e5\u672a\u660e\u786e\u8bbe\u7f6e\u6b64\u76ee\u5f55\uff0c\u5219\u7981\u6b62\u56fd\u9645\u5316\u3002</li> <li> <p>pager\uff1a\u5982\u679c\u8bbe\u4e3a'1'\uff0c\u90a3\u4e48\u6bcf\u4e00\u6ee1\u5c4f\u540e\u6682\u505c\u8f93\u51fa\uff0c\u7b49\u5f85\u952e\u76d8\u8f93\u5165\u3002\u7f3a\u7701\u662f' '\uff0c\u8868\u793a\u4e0d\u6682\u505c\u3002</p> </li> <li> <p>prefix\uff1a\u7edd\u5bf9\u8def\u5f84\u5f62\u5f0f\u7684'/boot/grub'\u76ee\u5f55\u4f4d\u7f6e(\u4e5f\u5c31\u662fGRUB2\u7684\u5b89\u88c5\u76ee\u5f55)\uff0c\u4f8b\u5982'(hd0,gpt1)/grub'\u6216'(hd0,msdos2)/boot/grub'\u3002\u521d\u59cb\u503c\u7531GRUB\u5728\u542f\u52a8\u65f6\u6839\u636e\"grub-install\"\u5728\u5b89\u88c5\u65f6\u63d0\u4f9b\u7684\u4fe1\u606f\u81ea\u52a8\u8bbe\u7f6e\u3002\u4f60\u53ea\u5e94\u8be5\u4f7f\u7528\u6b64\u53d8\u91cf\uff0c\u800c\u4e0d\u5e94\u8be5\u4fee\u6539\u5b83\u3002</p> </li> <li>root\uff1a\u8bbe\u7f6e\"\u6839\u8bbe\u5907\"\u3002\u4efb\u4f55\u672a\u6307\u5b9a\u8bbe\u5907\u540d\u7684\u6587\u4ef6\u90fd\u89c6\u4e3a\u4f4d\u4e8e\u6b64\u8bbe\u5907\u3002\u521d\u59cb\u503c\u7531GRUB\u5728\u542f\u52a8\u65f6\u6839\u636e\"prefix\"\u53d8\u91cf\u7684\u503c\u81ea\u52a8\u8bbe\u7f6e\u3002\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u4f60\u90fd\u9700\u8981\u4fee\u6539\u5b83\u3002</li> <li> <p>superusers\uff1a\u8bbe\u7f6e\u4e00\u7ec4\"\u8d85\u7ea7\u7528\u6237\"(\u4f7f\u7528\u7a7a\u683c/\u9017\u53f7/\u5206\u53f7\u8fdb\u884c\u5206\u9694)\uff0c\u4ee5\u5f00\u542f\u5b89\u5168\u8ba4\u8bc1\u7684\u529f\u80fd\u3002</p> </li> <li> <p>theme\uff1a\u8bbe\u7f6e\u83dc\u5355\u754c\u9762\u7684\u4e3b\u9898\u98ce\u683c\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c</p> </li> </ul> <p>\u4f8b\u5982\uff1a\"/boot/grub/themes/starfield/theme.txt\"\u3002\u5173\u4e8e\u5982\u4f55\u5b9a\u5236\u754c\u9762\u98ce\u683c(\u80cc\u666f\u56fe\u7247/\u5b57\u4f53/\u989c\u8272/\u56fe\u6807\u7b49)\u7684\u7ec6\u8282\uff0c\u53ef\u4ee5\u53c2\u8003GRUB2\u624b\u518c\u4e2d\u7684\"Theme file format\"\u90e8\u5206\u3002</p> <ul> <li>timeout\uff1a\u5728\u542f\u52a8\u9ed8\u8ba4\u83dc\u5355\u9879\u524d\uff0c\u7b49\u5f85\u952e\u76d8\u8f93\u5165\u7684\u79d2\u6570\u3002\u9ed8\u8ba4\u503c\u662f'5'\u79d2\u3002'0'\u8868\u793a\u76f4\u63a5\u542f\u52a8\u9ed8\u8ba4\u83dc\u5355\u9879(\u4e0d\u663e\u793a\u83dc\u5355)\uff0c'-1'\u8868\u793a\u6c38\u8fdc\u7b49\u5f85\u3002</li> </ul>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#grub2_2","title":"\u4e03 GRUB2\u547d\u4ee4","text":"<p>\u5bf9\u4e8eGRUB-2.0.2\u7248\u672c\u6765\u8bf4\uff0c\u6240\u6709\u53ef\u7528\u7684\u547d\u4ee4\u6709\u5927\u7ea6200\u4e2a\u4e4b\u591a\uff0c\u4ed6\u4eec\u4e2d\u7684\u7edd\u5927\u591a\u6570\u7531\u5404\u79cd\u5404\u6837\u7684\u6a21\u5757\u63d0\u4f9b\u3002\u6211\u4eec\u6ca1\u6709\u5fc5\u8981\u53bb\u4e86\u89e3\u6240\u6709\u8fd9\u4e9b200\u4e2a\u547d\u4ee4\uff0c\u53ea\u9700\u8981\u4e86\u89e3\u4e00\u4e9b\u5e38\u7528\u7684\u547d\u4ee4\u5373\u53ef(\u5b9e\u9645\u4e0a\u5c31\u8fde\u5b98\u65b9\u6587\u6863\u4e5f\u6ca1\u6709\u7ed9\u51fa\u5168\u90e8\u7684\u547d\u4ee4\u8bf4\u660e)\u3002\u66f4\u591a\u7684\u547d\u4ee4\u8bf4\u660e\u53ef\u4ee5\u53c2\u8003GRUB2\u624b\u518c\u4e2d\u7684\"The list of available commands\"\u9875\u9762\u4e2d\u5217\u51fa\u7684\u51e0\u4e2a\u4e8c\u7ea7\u9875\u9762\u3002</p> <ul> <li>menuentry \"title\" [--class=class \u2026] [--users=users] [--unrestricted] [--hotkey=key] [--id=id] [arg \u2026] { command; \u2026 }</li> </ul> <p>\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3a\"title\"\u7684\u83dc\u5355\u9879\u3002\u5f53\u6b64\u83dc\u5355\u9879\u88ab\u9009\u4e2d\u65f6\uff0cGRUB\u5c06\u4f1a\u628a\u73af\u5883\u53d8\u91cf\"chosen\"\u7684\u503c\u8bbe\u4e3a\"id\"(\u4f7f\u7528\u4e86[--id=id]\u9009\u9879)\u6216\"title\"(\u672a\u4f7f\u7528[--id=id]\u9009\u9879)\uff0c\u7136\u540e\u6267\u884c\u82b1\u62ec\u53f7\u4e2d\u7684\u547d\u4ee4\u5217\u8868\uff0c\u5982\u679c\u5217\u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u547d\u4ee4\u6267\u884c\u6210\u529f\uff0c\u5e76\u4e14\u5df2\u7ecf\u8f7d\u5165\u4e86\u4e00\u4e2a\u5185\u6838\uff0c\u90a3\u4e48\u5c06\u6267\u884c\"boot\"\u547d\u4ee4\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --class \u9009\u9879\u6307\u5b9a\u83dc\u5355\u9879\u6240\u5c5e\u7684\"\u6837\u5f0f\u7c7b\"\u3002\u4ece\u800c\u53ef\u4ee5\u4f7f\u7528\u6307\u5b9a\u7684\u4e3b\u9898\u6837\u5f0f\u663e\u793a\u83dc\u5355\u9879\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --users \u9009\u9879\u6307\u5b9a\u53ea\u5141\u8bb8\u7279\u5b9a\u7684\u7528\u6237\u8bbf\u95ee\u6b64\u83dc\u5355\u9879\u3002\u5982\u679c\u6ca1\u6709\u4f7f\u7528\u6b64\u9009\u9879\uff0c\u5219\u8868\u793a\u5141\u8bb8\u6240\u6709\u7528\u6237\u8bbf\u95ee\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --unrestricted \u9009\u9879\u6307\u660e\u5141\u8bb8\u6240\u6709\u7528\u6237\u8bbf\u95ee\u6b64\u83dc\u5355\u9879\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --hotkey \u9009\u9879\u8bbe\u7f6e\u8bbf\u95ee\u6b64\u83dc\u5355\u9879\u7684\u70ed\u952e(\u5feb\u6377\u952e)\u3002\"key\"\u53ef\u4ee5\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u5b57\u6bcd\uff0c\u6216\u8005'backspace','tab','delete'\u4e4b\u4e00\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --id \u9009\u9879\u4e3a\u6b64\u83dc\u5355\u9879\u8bbe\u7f6e\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684\u6807\u8bc6\u7b26\u3002\"id\"\u5fc5\u987b\u7531ASCII\u5b57\u6bcd/\u6570\u5b57/\u4e0b\u5212\u7ebf\u7ec4\u6210\uff0c\u4e14\u4e0d\u5f97\u4ee5\u6570\u5b57\u5f00\u5934\u3002</p> <p>[arg \u2026]\u662f\u53ef\u9009\u7684\u53c2\u6570\u5217\u8868\u3002\u4f60\u53ef\u4ee5\u628a\u5b83\u4eec\u7406\u89e3\u4e3a\u547d\u4ee4\u884c\u53c2\u6570\u3002\u5b9e\u9645\u4e0a\"title\"\u4e5f\u662f\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u53c2\u6570\u662f\u4e2a\u5fc5\u987b\u53c2\u6570\u800c\u5df2\u3002\u8fd9\u4e9b\u53c2\u6570\u90fd\u53ef\u4ee5\u5728\u82b1\u62ec\u53f7\u5185\u7684\u547d\u4ee4\u5217\u8868\u4e2d\u4f7f\u7528\uff0c\"title\"\u5bf9\u5e94\u7740\"$1\"\uff0c\u5176\u4f59\u7684\u4ee5\u6b64\u7c7b\u63a8\u3002</p> <ul> <li>terminal_input [--append|--remove] [terminal1] [terminal2] \u2026</li> </ul> <p>\u5982\u679c\u4e0d\u5e26\u4efb\u4f55\u9009\u9879\u4e0e\u53c2\u6570\uff0c\u5219\u8868\u793a\u5217\u51fa\u5f53\u524d\u6fc0\u6d3b\u7684\u8f93\u5165\u7ec8\u7aef\uff0c\u4ee5\u53ca\u6240\u6709\u5176\u4ed6\u53ef\u7528\u7684\u8f93\u5165\u7ec8\u7aef\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --append \u9009\u9879\u5c06\u6307\u5b9a\u7684\u7ec8\u7aef\u52a0\u5165\u5230\u6fc0\u6d3b\u7684\u8f93\u5165\u7ec8\u7aef\u5217\u8868\u4e2d\uff0c\u6240\u6709\u5217\u8868\u4e2d\u7684\u7ec8\u7aef\u90fd\u53ef\u4ee5\u7528\u4e8e\u5411GRUB\u63d0\u4f9b\u8f93\u5165\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --remove \u9009\u9879\u5c06\u6307\u5b9a\u7684\u7ec8\u7aef\u4ece\u6fc0\u6d3b\u7684\u8f93\u5165\u7ec8\u7aef\u5217\u8868\u4e2d\u5220\u9664\u3002</p> <p>\u5982\u679c\u4e0d\u4f7f\u7528\u4efb\u4f55\u9009\u9879\uff0c\u4f46\u662f\u6307\u5b9a\u4e86\u4e00\u4e2a\u6216\u591a\u4e2a\u7ec8\u7aef\u53c2\u6570\uff0c\u5219\u8868\u793a\u5c06\u5f53\u524d\u6fc0\u6d3b\u7684\u8f93\u5165\u7ec8\u7aef\u8bbe\u7f6e\u4e3a\u53c2\u6570\u6307\u5b9a\u7684\u7ec8\u7aef\u3002</p> <ul> <li>terminal_output [--append|--remove] [terminal1] [terminal2] \u2026</li> </ul> <p>\u5982\u679c\u4e0d\u5e26\u4efb\u4f55\u9009\u9879\u4e0e\u53c2\u6570\uff0c\u5219\u8868\u793a\u5217\u51fa\u5f53\u524d\u6fc0\u6d3b\u7684\u8f93\u51fa\u7ec8\u7aef\uff0c\u4ee5\u53ca\u6240\u6709\u5176\u4ed6\u53ef\u7528\u7684\u8f93\u51fa\u7ec8\u7aef\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --append \u9009\u9879\u5c06\u6307\u5b9a\u7684\u7ec8\u7aef\u52a0\u5165\u5230\u6fc0\u6d3b\u7684\u8f93\u51fa\u7ec8\u7aef\u5217\u8868\u4e2d\uff0c\u6240\u6709\u5217\u8868\u4e2d\u7684\u7ec8\u7aef\u90fd\u5c06\u63a5\u53d7\u5230GRUB\u7684\u8f93\u51fa\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --remove \u9009\u9879\u5c06\u6307\u5b9a\u7684\u7ec8\u7aef\u4ece\u6fc0\u6d3b\u7684\u8f93\u51fa\u7ec8\u7aef\u5217\u8868\u4e2d\u5220\u9664\u3002</p> <p>\u5982\u679c\u4e0d\u4f7f\u7528\u4efb\u4f55\u9009\u9879\uff0c\u4f46\u662f\u6307\u5b9a\u4e86\u4e00\u4e2a\u6216\u591a\u4e2a\u7ec8\u7aef\u53c2\u6570\uff0c\u5219\u8868\u793a\u5c06\u5f53\u524d\u6fc0\u6d3b\u7684\u8f93\u51fa\u7ec8\u7aef\u8bbe\u7f6e\u4e3a\u53c2\u6570\u6307\u5b9a\u7684\u7ec8\u7aef\u3002</p> <ul> <li>authenticate [userlist]</li> </ul> <p>\u68c0\u67e5\u5f53\u524d\u7528\u6237\u662f\u5426\u4f4d\u4e8e\"userlist\"\u6216\u73af\u5883\u53d8\u91cf\"superusers\"\u4e2d\u3002[\u6ce8\u610f]\u5982\u679c\u73af\u5883\u53d8\u91cf\"superusers\"\u7684\u503c\u4e3a\u7a7a\uff0c\u6b64\u547d\u4ee4\u5c06\u8fd4\u56de'\u771f'\u3002</p> <ul> <li>background_color color</li> </ul> <p>\u8bbe\u7f6e\u5f53\u524d\u6fc0\u6d3b\u7684\u8f93\u51fa\u7ec8\u7aef\u7684\u80cc\u666f\u989c\u8272\u3002\"color\"\u53ef\u4ee5\u4f7f\u7528HTML\u98ce\u683c\u7684\u989c\u8272\u8868\u793a\u6cd5(\"#RRGGBB\"\u6216\"#RGB\")\u3002</p> <p>[\u6ce8\u610f]\u4ec5\u5728\u4f7f\u7528'gfxterm'\u4f5c\u4e3a\u8f93\u51fa\u7ec8\u7aef\u7684\u65f6\u5019\uff0c\u624d\u80fd\u6539\u53d8\u80cc\u666f\u8272\u3002</p> <ul> <li>background_image [[--mode 'stretch'|'normal'] file]</li> </ul> <p>\u5c06\u5f53\u524d\u6fc0\u6d3b\u7684\u8f93\u51fa\u7ec8\u7aef\u7684\u80cc\u666f\u56fe\u7247\u8bbe\u7f6e\u4e3a\"file\"\u6587\u4ef6\u3002\u9664\u975e\u4f7f\u7528\u4e86\"--mode 'normal'\"\u9009\u9879\uff0c\u5426\u5219\u56fe\u7247\u5c06\u88ab\u81ea\u52a8\u7f29\u653e\u4ee5\u586b\u6ee1\u6574\u4e2a\u5c4f\u5e55\u3002</p> <p>\u5982\u679c\u4e0d\u5e26\u4efb\u4f55\u9009\u9879\u4e0e\u53c2\u6570\uff0c\u5219\u8868\u793a\u5220\u9664\u80cc\u666f\u56fe\u7247\u3002</p> <p>[\u6ce8\u610f]\u4ec5\u5728\u4f7f\u7528'gfxterm'\u4f5c\u4e3a\u8f93\u51fa\u7ec8\u7aef\u7684\u65f6\u5019\uff0c\u624d\u80fd\u6539\u53d8\u80cc\u666f\u56fe\u7247\u3002</p> <ul> <li>boot</li> </ul> <p>\u542f\u52a8\u5df2\u7ecf\u88ab\u8f7d\u5165\u7684OS\u6216\u94fe\u5f0f\u52a0\u8f7d\u5668\u3002\u4ec5\u5728\u8fd0\u884c\u4e8e\u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c\u7684\u65f6\u5019\u624d\u662f\u9700\u8981\u7684\u3002\u5728\u4e00\u4e2a\u83dc\u5355\u9879\u7ed3\u675f\u65f6\u662f\u9690\u542b\u7684\u3002</p> <ul> <li>cat [--dos] file</li> </ul> <p>\u663e\u793a\u6587\u4ef6\"file\"\u7684\u5185\u5bb9\u3002\u5982\u679c\u4f7f\u7528\u4e86\"--dos\"\u9009\u9879\uff0c\u90a3\u4e48\"\u56de\u8f66/\u6362\u884c\u7b26\"\u5c06\u88ab\u663e\u793a\u4e3a\u4e00\u4e2a\u7b80\u5355\u7684\u6362\u884c\u7b26\u3002\u5426\u5219\uff0c\u56de\u8f66\u7b26\u5c06\u88ab\u663e\u793a\u4e3a\u4e00\u4e2a\u63a7\u5236\u7b26()\u3002 <ul> <li>chainloader [--force] file</li> </ul> <p>\u94fe\u5f0f\u52a0\u8f7d\"file\"\u6587\u4ef6\u3002\u901a\u5e38\u4f7f\u7528\u78c1\u76d8\u5757\u8868\u793a\u6cd5\uff0c\u4f8b\u5982\u7528'+1'\u8868\u793a\u5f53\u524d\u6839\u5206\u533a\u7684\u7b2c\u4e00\u4e2a\u6247\u533a\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --force \u9009\u9879\u5f3a\u5236\u8f7d\u5165\u6587\u4ef6\uff0c\u800c\u4e0d\u7ba1\u5b83\u662f\u5426\u6709\u6b63\u786e\u7684\u7b7e\u540d\u3002\u901a\u5e38\u7528\u4e8e\u52a0\u8f7d\u6709\u7f3a\u9677\u7684\u542f\u52a8\u8f7d\u5165\u5668(\u4f8b\u5982 SCO UnixWare 7.1)\u3002</p> <ul> <li>configfile file</li> </ul> <p>\u5c06\"file\"\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u3002\u5982\u679c\"file\"\u4e2d\u5b9a\u4e49\u4e86\u83dc\u5355\u9879\uff0c\u90a3\u4e48\u7acb\u5373\u663e\u793a\u4e00\u4e2a\u5305\u542b\u5b83\u4eec\u7684\u83dc\u5355\u3002</p> <p>[\u6ce8\u610f]\"file\"\u6587\u4ef6\u5bf9\u73af\u5883\u53d8\u91cf\u6240\u505a\u7684\u4efb\u4f55\u53d8\u66f4\u90fd\u5c06\u5728\u4ece\u6b64\u6587\u4ef6\u8fd4\u56de\u540e\u5931\u6548\u3002</p> <ul> <li>cpuid [-l]</li> </ul> <p>\u68c0\u67e5CPU\u7279\u6027\u3002\u4ec5\u5728x86\u7cfb\u7edf\u4e0a\u53ef\u7528\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u4e86 -l \u9009\u9879\uff0c\u90a3\u4e48\u5982\u679cCPU\u662f64\u4f4d\u5219\u8fd4\u56de\u771f\uff0c\u5426\u5219\u8fd4\u56de\u5047\u3002</p> <ul> <li>drivemap -l|-r|[-s] from_drive to_drive</li> </ul> <p>\u5982\u679c\u4e0d\u4f7f\u7528\u4efb\u4f55\u9009\u9879\uff0c\u8868\u793a\u5c06\"from_drive\"\u6620\u5c04\u5230\"to_drive\"\u3002\u8fd9\u4e3b\u8981\u7528\u4e8e\u94fe\u5f0f\u52a0\u8f7dWindows\u4e4b\u7c7b\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u56e0\u4e3a\u5b83\u4eec\u53ea\u80fd\u4ece\u7b2c\u4e00\u4e2a\u786c\u76d8\u542f\u52a8\u3002\u51fa\u4e8e\u65b9\u4fbf\u7684\u539f\u56e0\uff0c\u5206\u533a\u540e\u7f00\u5c06\u88ab\u5ffd\u7565\uff0c\u56e0\u6b64\u4f60\u53ef\u7528\u5b89\u5168\u5730\u5c06\"${root}\"\u4f5c\u4e3a\u78c1\u76d8\u4f7f\u7528\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 -s \u9009\u9879\uff0c\u6267\u884c\u53cd\u5411\u6620\u5c04\uff0c\u4e5f\u5c31\u662f\u4ea4\u6362\u8fd9\u4e24\u4e2a\u78c1\u76d8\u3002\u4f8b\u5982\uff1a drivemap -s (hd0) (hd1)</p> <p>\u53ef\u4ee5\u4f7f\u7528 -l \u9009\u9879\uff0c\u5217\u51fa\u5f53\u524d\u5df2\u6709\u7684\u6620\u5c04\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 -r \u9009\u9879\uff0c\u628a\u6620\u5c04\u91cd\u7f6e\u4e3a\u9ed8\u8ba4\u503c\uff0c\u4e5f\u5c31\u662f\u64a4\u9500\u6240\u6709\u5f53\u524d\u5df2\u6709\u7684\u6620\u5c04\u3002</p> <ul> <li>echo [-n] [-e] string \u2026</li> </ul> <p>\u663e\u793a\u6240\u8981\u6c42\u7684\u6587\u672c\u5e76\u6362\u884c(\u9664\u975e\u4f7f\u7528\u4e86 -n \u9009\u9879)\u3002\u5982\u679c\u6709\u591a\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f9d\u6b21\u8f93\u51fa\u5b83\u4eec\uff0c\u5e76\u7528\u7a7a\u683c\u5206\u9694\u6bcf\u4e00\u4e2a\u3002</p> <p>\u548cbash\u7684\u4e60\u60ef\u4e00\u6837\uff0c\u53ef\u4ee5\u5728\u53cc\u5f15\u53f7\u5185\u4f7f\u7528\"${var}\"\u6765\u5f15\u7528\u53d8\u91cf\u7684\u503c\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 -e \u9009\u9879\u6fc0\u6d3b\u5bf9\u53cd\u659c\u6760\u8f6c\u4e49\u7b26\u7684\u89e3\u91ca( \\ \\a \\r \\n \\t ...)\u3002</p> <ul> <li>export envvar</li> </ul> <p>\u5bfc\u51fa\u73af\u5883\u53d8\u91cf\"envvar\"\uff0c\u4ee5\u4f7f\u5176\u5bf9\u4e8e\u4f7f\u7528\"configfile\"\u547d\u4ee4\u8f7d\u5165\u7684\u914d\u7f6e\u6587\u4ef6\u53ef\u89c1\u3002</p> <ul> <li>false</li> </ul> <p>\u4e0d\u505a\u4efb\u4f55\u4e8b\uff0c\u53ea\u8fd4\u56de\u4e00\u4e2a\u5931\u8d25\u7684\u7ed3\u679c\u3002\u4e3b\u8981\u7528\u5728if/while\u4e4b\u7c7b\u7684\u63a7\u5236\u6784\u9020\u4e2d\u3002</p> <ul> <li>gettext string</li> </ul> <p>\u628a\"string\"\u7ffb\u8bd1\u4e3a\u73af\u5883\u53d8\u91cf\"lang\"\u6307\u5b9a\u7684\u8bed\u8a00\u3002MO\u683c\u5f0f\u7684\u7ffb\u8bd1\u6587\u4ef6\u4ece\u73af\u5883\u53d8\u91cf\"locale_dir\"\u6307\u5b9a\u7684\u76ee\u5f55\u52a0\u8f7d\u3002</p> <ul> <li>halt [--no-apm]</li> </ul> <p>\u5173\u95ed\u8ba1\u7b97\u673a\u3002\u5982\u679c\u6307\u5b9a\u4e86 --no-apm \u9009\u9879\uff0c\u8868\u793a\u4e0d\u6267\u884cAPM BIOS\u8c03\u7528\u3002\u5426\u5219\uff0c\u8ba1\u7b97\u673a\u4f7f\u7528APM\u5173\u95ed\u3002</p> <ul> <li>help [pattern \u2026]</li> </ul> <p>\u663e\u793a\u5185\u5efa\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\"pattern\"\uff0c\u90a3\u4e48\u5c06\u663e\u793a\u6240\u6709\u53ef\u7528\u547d\u4ee4\u7684\u7b80\u77ed\u63cf\u8ff0\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u4e86\"pattern\"\uff0c\u90a3\u4e48\u5c06\u53ea\u663e\u793a\u540d\u5b57\u4ee5\u8fd9\u4e9b\"pattern\"\u5f00\u5934\u7684\u547d\u4ee4\u7684\u8be6\u7ec6\u5e2e\u52a9\u4fe1\u606f\u3002</p> <ul> <li>initrd file</li> </ul> <p>\u4e3a\u4ee532\u4f4d\u534f\u8bae\u542f\u52a8\u7684Linux\u5185\u6838\u8f7d\u5165\u4e00\u4e2a\"initial ramdisk\"\uff0c\u5e76\u5728\u5185\u5b58\u91cc\u7684Linux\u8bbe\u7f6e\u533a\u57df\u8bbe\u7f6e\u5408\u9002\u7684\u53c2\u6570\u3002</p> <p>[\u6ce8\u610f]\u8fd9\u4e2a\u547d\u4ee4\u5fc5\u987b\u653e\u5728\"linux\"\u547d\u4ee4\u4e4b\u540e\u4f7f\u7528\u3002</p> <ul> <li>initrd16 file</li> </ul> <p>\u4e3a\u4ee516\u4f4d\u534f\u8bae\u542f\u52a8\u7684Linux\u5185\u6838\u8f7d\u5165\u4e00\u4e2a\"initial ramdisk\"\uff0c\u5e76\u5728\u5185\u5b58\u91cc\u7684Linux\u8bbe\u7f6e\u533a\u57df\u8bbe\u7f6e\u5408\u9002\u7684\u53c2\u6570\u3002</p> <p>[\u6ce8\u610f]\u8fd9\u4e2a\u547d\u4ee4\u5fc5\u987b\u653e\u5728\"linux16\"\u547d\u4ee4\u4e4b\u540e\u4f7f\u7528\u3002</p> <ul> <li>insmod module</li> </ul> <p>\u8f7d\u5165\u540d\u4e3a\"module\"\u7684GRUB2\u6a21\u5757\u3002</p> <ul> <li>linux file \u2026</li> </ul> <p>\u4f7f\u752832\u4f4d\u542f\u52a8\u534f\u8bae\u4ece\"file\"\u8f7d\u5165\u4e00\u4e2aLinux\u5185\u6838\u6620\u50cf\uff0c\u5e76\u5c06\u5176\u4f59\u7684\u5b57\u7b26\u4f5c\u4e3a\u5185\u6838\u7684\u547d\u4ee4\u884c\u53c2\u6570\u9010\u5b57\u4f20\u5165\u3002</p> <p>[\u6ce8\u610f]\u4f7f\u752832\u4f4d\u542f\u52a8\u534f\u8bae\u610f\u5473\u7740'vga='\u542f\u52a8\u9009\u9879\u5c06\u4f1a\u5931\u6548\u3002\u5982\u679c\u4f60\u5e0c\u671b\u660e\u786e\u8bbe\u7f6e\u4e00\u4e2a\u7279\u5b9a\u7684\u89c6\u9891\u6a21\u5f0f\uff0c\u90a3\u4e48\u5e94\u8be5\u4f7f\u7528\"gfxpayload\"\u73af\u5883\u53d8\u91cf\u3002\u867d\u7136GRUB\u53ef\u4ee5\u81ea\u52a8\u5730\u68c0\u6d4b\u67d0\u4e9b'vga='\u53c2\u6570\uff0c\u5e76\u628a\u5b83\u4eec\u7ffb\u8bd1\u4e3a\u5408\u9002\u7684\"gfxpayload\"\u8bbe\u7f6e\uff0c\u4f46\u662f\u5e76\u4e0d\u5efa\u8bae\u8fd9\u6837\u505a\u3002</p> <ul> <li>linux16 file \u2026</li> </ul> <p>\u4ee5\u4f20\u7edf\u768416\u4f4d\u542f\u52a8\u534f\u8bae\u4ece\"file\"\u8f7d\u5165\u4e00\u4e2aLinux\u5185\u6838\u6620\u50cf\uff0c\u5e76\u5c06\u5176\u4f59\u7684\u5b57\u7b26\u4f5c\u4e3a\u5185\u6838\u7684\u547d\u4ee4\u884c\u53c2\u6570\u9010\u5b57\u4f20\u5165\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u542f\u52a8\u4e00\u4e9b\u9075\u5b88Linux\u542f\u52a8\u534f\u8bae\u7684\u7279\u6b8a\u5de5\u5177(\u4f8b\u5982MEMDISK)\u3002</p> <p>[\u6ce8\u610f]\u4f7f\u7528\u4f20\u7edf\u768416\u4f4d\u542f\u52a8\u534f\u8bae\u610f\u5473\u7740\uff1a(1)'vga='\u542f\u52a8\u9009\u9879\u4f9d\u7136\u6709\u6548\uff0c(2)\u4e0d\u80fd\u542f\u52a8\u7eaf64\u4f4d\u5185\u6838(\u4e5f\u5c31\u662f\u5185\u6838\u5fc5\u987b\u8981'CONFIG_IA32_EMULATION=y'\u624d\u884c)\u3002</p> <ul> <li>loadfont file \u2026</li> </ul> <p>\u4ece\u6307\u5b9a\u7684\"file\"\u52a0\u8f7d\u5b57\u4f53\uff0c\u9664\u975e\u4f7f\u7528\u4e86\u7edd\u5bf9\u8def\u5f84\uff0c\u5426\u5219\"file\"\u5c06\u88ab\u89c6\u4e3a\"$prefix/fonts/file.pf2\"\u6587\u4ef6\u3002</p> <ul> <li>loopback [-d] device file</li> </ul> <p>\u5c06\"file\"\u6587\u4ef6\u6620\u5c04\u4e3a\"device\"\u56de\u73af\u8bbe\u5907\u3002\u4f8b\u5982\uff1a</p> <p>loopback loop0 /path/to/image ls (loop0)/</p> <p>\u53ef\u4ee5\u4f7f\u7528 -d \u9009\u9879\uff0c\u5220\u9664\u5148\u524d\u4f7f\u7528\u8fd9\u4e2a\u547d\u4ee4\u521b\u5efa\u7684\u8bbe\u5907\u3002</p> <ul> <li>ls [arg \u2026]</li> </ul> <p>\u5982\u679c\u4e0d\u4f7f\u7528\u53c2\u6570\uff0c\u90a3\u4e48\u5217\u51fa\u6240\u6709\u5bf9GRUB\u5df2\u77e5\u7684\u8bbe\u5907\u3002</p> <p>\u5982\u679c\u53c2\u6570\u662f\u5305\u542b\u5728\u62ec\u53f7\u5185\u7684\u4e00\u4e2a\u8bbe\u5907\u540d\uff0c\u90a3\u4e48\u5217\u51fa\u8be5\u8bbe\u5907\u6839\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002</p> <p>\u5982\u679c\u53c2\u6570\u662f\u4ee5\u7edd\u5bf9\u8def\u5f84\u7ed9\u51fa\u7684\u76ee\u5f55\uff0c\u90a3\u4e48\u5217\u51fa\u8fd9\u4e2a\u76ee\u5f55\u7684\u5185\u5bb9\u3002</p> <ul> <li>lsfonts</li> </ul> <p>\u5217\u51fa\u5df2\u7ecf\u52a0\u8f7d\u7684\u6240\u6709\u5b57\u4f53</p> <ul> <li>lsmod</li> </ul> <p>\u5217\u51fa\u5df2\u7ecf\u52a0\u8f7d\u7684\u6240\u6709\u6a21\u5757</p> <ul> <li>normal [file]</li> </ul> <p>\u8fdb\u5165\u666e\u901a\u6a21\u5f0f\uff0c\u5e76\u663e\u793aGRUB\u83dc\u5355\u3002[\u8bf4\u660e]\u53ea\u8981\u5f53\u524d\u6ca1\u6709\u5904\u4e8e\u6551\u63f4\u6a21\u5f0f\uff0c\u5176\u5b9e\u5c31\u5df2\u7ecf\u662f\u5728\u666e\u901a\u6a21\u5f0f\u4e2d\u4e86\uff0c\u6240\u4ee5\u901a\u5e38\u5e76\u4e0d\u9700\u8981\u660e\u786e\u4f7f\u7528\u6b64\u547d\u4ee4\u3002</p> <p>\u5728\u666e\u901a\u6a21\u5f0f\u4e2d\uff0c\u547d\u4ee4\u6a21\u5757[command.lst]\u4e0e\u52a0\u5bc6\u6a21\u5757[crypto.lst]\u4f1a\u88ab\u81ea\u52a8\u6309\u9700\u8f7d\u5165(\u65e0\u9700\u4f7f\u7528\"insmod\"\u547d\u4ee4)\uff0c\u5e76\u4e14\u53ef\u4f7f\u7528\u5b8c\u6574\u7684GRUB\u811a\u672c\u529f\u80fd\u3002\u4f46\u662f\u5176\u4ed6\u6a21\u5757\u5219\u53ef\u80fd\u9700\u8981\u660e\u786e\u4f7f\u7528\"insmod\"\u547d\u4ee4\u6765\u8f7d\u5165\u3002</p> <p>\u5982\u679c\u7ed9\u51fa\u4e86\"file\"\u53c2\u6570\uff0c\u90a3\u4e48\u5c06\u4ece\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u8bfb\u5165\u547d\u4ee4(\u4e5f\u5c31\u662f\u4f5c\u4e3a\"grub.cfg\"\u7684\u66ff\u4ee3)\uff0c\u5426\u5219\u5c06\u4ece\"$prefix/grub.cfg\"\u4e2d\u8bfb\u5165\u547d\u4ee4(\u5982\u679c\u5b58\u5728\u7684\u8bdd)\u3002\u4f60\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\"file\"\u7684\u9ed8\u8ba4\u503c\u662f'$prefix/grub.cfg'\u3002</p> <p>\u53ef\u4ee5\u5728\u666e\u901a\u6a21\u5f0f\u4e2d\u5d4c\u5957\u8c03\u7528\u6b64\u547d\u4ee4\uff0c\u4ee5\u6784\u5efa\u4e00\u4e2a\u5d4c\u5957\u7684\u73af\u5883\u3002\u4e0d\u8fc7\u4e00\u822c\u4e0d\u8fd9\u4e48\u505a\uff0c\u800c\u662f\u4f7f\u7528\"configfile\"\u547d\u4ee4\u6765\u8fbe\u5230\u8fd9\u76ee\u7684\u3002</p> <ul> <li>normal_exit</li> </ul> <p>\u9000\u51fa\u5f53\u524d\u7684\u666e\u901a\u6a21\u5f0f\u3002\u5982\u679c\u8fd9\u4e2a\u666e\u901a\u6a21\u5f0f\u5b9e\u4f8b\u4e0d\u662f\u5d4c\u5957\u5728\u53e6\u4e00\u4e2a\u666e\u901a\u6a21\u5f0f\u91cc\u7684\u8bdd\uff0c\u5c31\u4f1a\u8fd4\u56de\u5230\u6551\u63f4\u6a21\u5f0f\u3002</p> <ul> <li>parttool partition commands</li> </ul> <p>\u5bf9\u5206\u533a\u8868\u8fdb\u884c\u5404\u79cd\u4fee\u6539\u3002\u76ee\u524d\u53ea\u80fd\u4f5c\u7528\u4e8eMBR\u5206\u533a\u8868(DOS\u5206\u533a\u8868)\uff0c\u800c\u4e0d\u80fd\u7528\u4e8eGPT\u5206\u533a\u8868\u3002\u76ee\u524d\u4ec5\u652f\u6301\u4ee5\u4e0b\u4e09\u79cd\u7528\u6cd5\uff1a</p> <p>(1)\u8bbe\u7f6e\u6216\u53bb\u6389\u5206\u533a\u7684\u6fc0\u6d3b\u6807\u8bb0(\u4ec5\u5bf9Windows\u7cfb\u7edf\u6709\u610f\u4e49)\u3002 \u4f8b\u5982\uff1a\"parttool (hd0,msdos2) +boot\"\u8868\u793a\u4e3a(hd0,msdos2)\u5206\u533a\u52a0\u4e0a\u6fc0\u6d3b\u6807\u8bb0\uff0c\u800c\"parttool (hd0,msdos2) -boot\"\u5219\u8868\u793a\u53bb\u6389(hd0,msdos2)\u5206\u533a\u7684\u6fc0\u6d3b\u6807\u8bb0\u3002</p> <p>(2)\u8bbe\u7f6e\u6216\u53bb\u6389\u5206\u533a\u7684\u9690\u85cf\u6807\u8bb0(\u4ec5\u5bf9Windows\u7cfb\u7edf\u6709\u610f\u4e49)\u3002 \u4f8b\u5982\uff1a\"parttool (hd0,msdos2) +hidden\"\u8868\u793a\u4e3a(hd0,msdos2)\u5206\u533a\u52a0\u4e0a\u9690\u85cf\u6807\u8bb0\uff0c\u800c\"parttool (hd0,msdos2) -hidden\"\u5219\u8868\u793a\u53bb\u6389(hd0,msdos2)\u5206\u533a\u7684\u9690\u85cf\u6807\u8bb0\u3002</p> <p>(3)\u66f4\u6539\u5206\u533a\u7684\u7c7b\u578b\u3002\u5176\u503c\u5fc5\u987b\u662f0x00-0xFF\u8303\u56f4\u5185\u7684\u503c\u3002\u4e14\u5e94\u8be5\u4f7f\u7528'0xNN'\u683c\u5f0f\u7684\u5341\u516d\u8fdb\u5236\u6570\u3002 \u4f8b\u5982\uff1a\"parttool (hd0,msdos2) type=0x83\"\u8868\u793a\u5c06(hd0,msdos2)\u5206\u533a\u7c7b\u578b\u4fee\u6539\u4e3a'0x83'(Linux\u5206\u533a)\u3002</p> <ul> <li>password user clear-password</li> </ul> <p>\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3auser\u7684\u7528\u6237\uff0c\u5e76\u4f7f\u7528\u660e\u6587\u53e3\u4ee4'clear-password'\u3002\u4e0d\u5efa\u8bae\u4f7f\u7528\u6b64\u547d\u4ee4\u3002</p> <ul> <li>password_pbkdf2 user hashed-password</li> </ul> <p>\u5b9a\u4e49\u4e00\u4e2a\u540d\u4e3auser\u7684\u7528\u6237\uff0c\u5e76\u4f7f\u7528\u54c8\u5e0c\u53e3\u4ee4'hashed-password'(\u901a\u8fc7\"grub-mkpasswd-pbkdf2\"\u5de5\u5177\u751f\u6210)\u3002\u8fd9\u662f\u5efa\u8bae\u4f7f\u7528\u7684\u547d\u4ee4\uff0c\u56e0\u4e3a\u5b83\u5b89\u5168\u6027\u66f4\u9ad8\u3002</p> <ul> <li>probe [--set var] --driver|--partmap|--fs|--fs-uuid|--label device</li> </ul> <p>\u63d0\u53d6\"device\"\u8bbe\u5907\u7684\u7279\u5b9a\u4fe1\u606f\u3002\u5982\u679c\u4f7f\u7528\u4e86 --set \u9009\u9879\uff0c\u5219\u8868\u793a\u5c06\u63d0\u53d6\u7684\u7ed3\u679c\u4fdd\u5b58\u5728\"var\"\u53d8\u91cf\u4e2d\uff0c\u5426\u5219\u5c06\u63d0\u53d6\u7684\u7ed3\u679c\u76f4\u63a5\u663e\u793a\u51fa\u6765\u3002</p> <ul> <li>read [var]</li> </ul> <p>\u4ece\u7528\u6237\u8bfb\u53d6\u4e00\u884c\u8f93\u5165\u3002\u5982\u679c\u7ed9\u5b9a\u73af\u5883\u53d8\u91cf\"var\"\uff0c\u5219\u628a\u5b83\u8bbe\u4e3a\u6240\u8bfb\u53d6\u7684\u884c(\u4e0d\u5305\u62ec\u7ed3\u5c3e\u7684\u6362\u884c\u7b26)\u3002</p> <ul> <li>reboot</li> </ul> <p>\u91cd\u65b0\u542f\u52a8</p> <ul> <li>rmmod module</li> </ul> <p>\u5378\u8f7d\"module\"\u6a21\u5757</p> <ul> <li>search [--file|--label|--fs-uuid] [--set [var]] [--no-floppy] name</li> </ul> <p>\u901a\u8fc7\u6587\u4ef6[--file]\u3001\u5377\u6807[--label]\u3001\u6587\u4ef6\u7cfb\u7edfUUID[--fs-uuid]\u6765\u67e5\u627e\u8bbe\u5907\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u4e86 --set \u9009\u9879\uff0c\u90a3\u4e48\u4f1a\u5c06\u7b2c\u4e00\u4e2a\u627e\u5230\u7684\u8bbe\u5907\u8bbe\u7f6e\u4e3a\u73af\u5883\u53d8\u91cf\"var\"\u7684\u503c\u3002\u9ed8\u8ba4\u7684\"var\"\u662f'root'\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 --no-floppy \u9009\u9879\u6765\u7981\u6b62\u67e5\u627e\u8f6f\u76d8\u8bbe\u5907\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u8bbe\u5907\u975e\u5e38\u6162\u3002</p> <ul> <li>set [envvar=value]</li> </ul> <p>\u5c06\u73af\u5883\u53d8\u91cf\"envvar\"\u7684\u503c\u8bbe\u4e3a'value'\u3002\u5982\u679c\u6ca1\u6709\u4f7f\u7528\u53c2\u6570\uff0c\u5219\u6253\u5370\u51fa\u6240\u6709\u73af\u5883\u53d8\u91cf\u53ca\u5176\u503c\u3002</p> <ul> <li>source file</li> </ul> <p>\u76f4\u63a5\u5c06\"file\"\u6587\u4ef6\u7684\u5185\u5bb9\u63d2\u5165\u5230\u5f53\u524d\u4f4d\u7f6e\u3002\u4e0e\"configfile\"\u4e0d\u540c\uff0c\u6b64\u547d\u4ee4\u65e2\u4e0d\u5207\u6362\u6267\u884c\u73af\u5883\uff0c\u4e5f\u4e0d\u4f1a\u663e\u793a\u4e00\u4e2a\u65b0\u7684\u83dc\u5355\u3002</p> <ul> <li>test expression [ expression ]</li> </ul> <p>\u8ba1\u7b97\"expression\"\u7684\u503c\uff0c\u5e76\u5728\u7ed3\u679c\u4e3a\u771f\u65f6\u8fd4\u56de\u96f6\u503c\uff0c\u6216\u8005\u5728\u7ed3\u679c\u4e3a\u5047\u65f6\u8fd4\u56de\u975e\u96f6\u503c\uff0c\u4e3b\u8981\u7528\u5728if/while\u4e4b\u7c7b\u7684\u63a7\u5236\u6784\u9020\u4e2d\u3002</p> <p>\u53ef\u7528\u7684\"expression\"\u6a21\u5f0f\u5982\u4e0b(\u4e0ebash\u7c7b\u4f3c)\uff1a</p> <pre><code>string1 == string2  [string1\u4e0estring2\u5b8c\u5168\u76f8\u540c]\nstring1 != string2  [string1\u4e0estring2\u4e0d\u5b8c\u5168\u76f8\u540c]\nstring1 &lt; string2  [string1\u5728\u5b57\u6bcd\u987a\u5e8f\u4e0a\u5c0f\u4e8estring2]\nstring1 &lt;= string2  [string1\u5728\u5b57\u6bcd\u987a\u5e8f\u4e0a\u5c0f\u4e8estring2\u6216\u4e0estring2\u5b8c\u5168\u76f8\u540c]\nstring1 &gt; string2  [string1\u5728\u5b57\u6bcd\u987a\u5e8f\u4e0a\u5927\u4e8estring2]\nstring1 &gt;= string2  [string1\u5728\u5b57\u6bcd\u987a\u5e8f\u4e0a\u5927\u4e8estring2\u6216\u4e0estring2\u5b8c\u5168\u76f8\u540c]\ninteger1 -eq integer2  [integer1\u7b49\u4e8einteger2]\ninteger1 -ge integer2  [integer1\u5927\u4e8e\u6216\u7b49\u4e8einteger2]\ninteger1 -gt integer2  [integer1\u5927\u4e8einteger2]\ninteger1 -le integer2  [integer1\u5c0f\u4e8e\u6216\u7b49\u4e8einteger2]\ninteger1 -lt integer2  [integer1\u5c0f\u4e8einteger2]\ninteger1 -ne integer2  [integer1\u4e0d\u7b49\u4e8einteger2]\nprefixinteger1 -pgt prefixinteger2  [\u5254\u9664\u975e\u6570\u5b57\u5b57\u7b26\u9996\u90e8\u4e4b\u540e\uff0cinteger1\u5927\u4e8einteger2]\nprefixinteger1 -plt prefixinteger2  [\u5254\u9664\u975e\u6570\u5b57\u5b57\u7b26\u9996\u90e8\u4e4b\u540e\uff0cinteger1\u5c0f\u4e8einteger2]\nfile1 -nt file2  [file1\u7684\u4fee\u6539\u65f6\u95f4\u6bd4file2\u65b0]\nfile1 -ot file2  [file1\u7684\u4fee\u6539\u65f6\u95f4\u6bd4file2\u65e7]\n-d file  [file\u5b58\u5728\u5e76\u4e14\u662f\u4e00\u4e2a\u76ee\u5f55]\n-e file  [file\u5b58\u5728]\n-f file  [file\u5b58\u5728\u5e76\u4e14\u4e0d\u662f\u4e00\u4e2a\u76ee\u5f55]\n-s file  [file\u5b58\u5728\u5e76\u4e14\u6587\u4ef6\u5c3a\u5bf8\u5927\u4e8e\u96f6]\n-n string  [string\u7684\u957f\u5ea6\u5927\u4e8e\u96f6]\nstring     [string\u7684\u957f\u5ea6\u5927\u4e8e\u96f6]\n-z string  [string\u7684\u957f\u5ea6\u7b49\u4e8e\u96f6]\n( expression )  \u5c06expression\u89c6\u4e3a\u4e00\u4e2a\u6574\u4f53(\u5206\u7ec4)\n! expression   \u975e(NOT)\nexpression1 -a expression2   \u4e0e(AND)\nexpression1 -o expression2   \u6216(OR)\n</code></pre> <ul> <li>true</li> </ul> <p>\u4e0d\u505a\u4efb\u4f55\u4e8b\uff0c\u53ea\u8fd4\u56de\u4e00\u4e2a\u6210\u529f\u7684\u7ed3\u679c\u3002\u4e3b\u8981\u7528\u5728if/while\u4e4b\u7c7b\u7684\u63a7\u5236\u6784\u9020\u4e2d\u3002</p> <ul> <li>unset envvars</li> </ul> <p>\u64a4\u9500\u73af\u5883\u53d8\u91cf\"envvar\"</p> <ul> <li>videoinfo [[WxH]xD]</li> </ul> <p>\u5217\u51fa\u6240\u6709\u5f53\u524d\u53ef\u7528\u7684\u89c6\u9891\u6a21\u5f0f\u3002\u5982\u679c\u6307\u5b9a\u4e86\u5206\u8fa8\u7387(\u6216\u8005\u8fd8\u9644\u52a0\u4e86\u8272\u6df1)\uff0c\u90a3\u4e48\u4ec5\u663e\u793a\u4e0e\u5176\u5339\u914d\u7684\u6a21\u5f0f\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#grub2_3","title":"\u516b grub2\u5b89\u5168","text":"<p>\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cGRUB\u5bf9\u4e8e\u6240\u6709\u53ef\u4ee5\u5728\u7269\u7406\u4e0a\u8fdb\u5165\u63a7\u5236\u53f0\u7684\u4eba\u90fd\u662f\u53ef\u8bbf\u95ee\u7684\u3002\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u9009\u62e9\u5e76\u7f16\u8f91\u4efb\u610f\u83dc\u5355\u9879\uff0c\u5e76\u4e14\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95eeGRUB SHELL\u3002\u8981\u542f\u7528\u8ba4\u8bc1\u652f\u6301\uff0c\u5fc5\u987b\u5c06\u73af\u5883\u53d8\u91cf\"superusers\"\u8bbe\u7f6e\u4e3a\u4e00\u7ec4\u7528\u6237\u540d(\u53ef\u7528\u7a7a\u683c/\u9017\u53f7/\u5206\u53f7\u4f5c\u4e3a\u5206\u9694\u7b26)\uff0c\u8fd9\u6837\uff0c\u5c06\u4ec5\u5141\u8bb8\"superusers\"\u4e2d\u7684\u7528\u6237\u4f7f\u7528GRUB\u547d\u4ee4\u884c\u3001\u7f16\u8f91\u83dc\u5355\u9879\u3001\u4ee5\u53ca\u6267\u884c\u4efb\u610f\u83dc\u5355\u9879\u3002\u800c\u5176\u4ed6\u975e\"superusers\"\u4e2d\u7684\u7528\u6237\uff0c\u53ea\u80fd\u6267\u884c\u90a3\u4e9b\u6ca1\u6709\u8bbe\u7f6e --users \u9009\u9879\u7684\u83dc\u5355\uff0c\u4ee5\u53ca\u90a3\u4e9b\u5728 --users \u9009\u9879\u4e2d\u5305\u542b\u4e86\u8be5\u7528\u6237\u7684\u83dc\u5355\uff0c\u4f46\u4e0d\u80fd\u4f7f\u7528GRUB\u547d\u4ee4\u884c\u3001\u7f16\u8f91\u83dc\u5355\u9879\u3002\u4e0b\u9762\u4f7f\u7528\u4e00\u4e2a\u914d\u7f6e\u7247\u6bb5\u4e3e\u4f8b\u8bf4\u660e\uff1a</p> <pre><code>set superusers=\"root\"\npassword_pbkdf2 root grub.pbkdf2.sha512.10000.biglongstring\npassword user1 insecure\n\nmenuentry \"\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u6267\u884c\u6b64\u83dc\u5355\" --unrestricted {\n    ...\n}\n\nmenuentry \"\u4ec5\u5141\u8bb8\u8d85\u7ea7\u7528\u6237\u6267\u884c\u6b64\u83dc\u5355\" --users \"\" {\n    ...\n}\n\nmenuentry \"\u5141\u8bb8 user1 \u548c\u8d85\u7ea7\u7528\u6237\u6267\u884c\u6b64\u83dc\u5355\" --users user1 {\n    ...\n}\n</code></pre> <p>\u6709\u5173GRUB2\u5b89\u5168\u7684\u66f4\u591a\u8be6\u60c5\uff0c\u8bf7\u53c2\u8003GRUB2\u624b\u518c\u4e2d\u7684\"Security\"\u90e8\u5206\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#gurb2","title":"\u4e5d gurb2\u5b9e\u7528\u6280\u5de7","text":""},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#91-grub2","title":"9.1 \u4e3agrub2\u83dc\u5355\u52a0\u4e0a\u80cc\u666f\u56fe","text":"<p>\u9996\u5148\u5236\u4f5c\u4e00\u5f20PNG\u683c\u5f0f\u7684\u56fe\u7247\uff0c\u5206\u8fa8\u7387\u6700\u597d\u662f\"1024x768\"\u4ee5\u4fdd\u8bc1\u8f83\u597d\u7684\u517c\u5bb9\u6027\u3002\u7136\u540e\u5c06\u8fd9\u5f20\u56fe\u7247\u653e\u5230\"$prefix/themes/1024x768.png\"(\"$prefix\"\u662fGRUB2\u7684\u5b89\u88c5\u76ee\u5f55)\u3002\u7136\u540e\u5728'grub.cfg'\u4e2d\u52a0\u5165\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>set gfxmode=1024x768,auto\ninsmod gfxterm\ninsmod png\nterminal_output  gfxterm\nbackground_image $prefix/themes/1024x768.png\n</code></pre>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#92-grub2","title":"9.2 \u8ba9grub2\u663e\u793a\u4e2d\u6587\u754c\u9762(\u5305\u62ec\u663e\u793a\u4e2d\u6587\u83dc\u5355\u9879)","text":"<p>\u7531\u4e8eGRUB2\u5728\u5185\u90e8\u4f7f\u7528**UTF-8**\u7f16\u7801\uff0c\u5e76\u4e14\u6240\u6709\u6587\u672c\u6587\u4ef6(\u5305\u62ec'grub.cfg')\u4e5f\u90fd\u88ab\u5047\u5b9a\u4e3a\u4f7f\u7528UTF-8\u7f16\u7801\uff0c\u4e3a\u4e86\u907f\u514d\u4e71\u7801\uff0c\u8bf7\u52a1\u5fc5\u4ee5UTF-8\u7f16\u7801\u4fdd\u5b58'grub.cfg'\u6587\u4ef6\u3002</p> <pre><code>set gfxterm_font=unicode\nset lang=zh_CN\nset locale_dir=$prefix/locale\ninsmod gfxterm\nterminal_output  gfxterm\nloadfont unicode\n</code></pre>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#93-grub2","title":"9.3 \u8bbe\u7f6egrub2\u5b57\u4f53","text":"<p>\u5982\u679c\u4f60\u8ba4\u4e3a\u9ed8\u8ba4\u7684unicode\u5b57\u4f53\u57281024x768\u6216\u66f4\u9ad8\u5206\u8fa8\u7387\u7684\u5c4f\u5e55\u4e0a\u663e\u5f97\u592a\u5c0f\uff0c\u6216\u8005\u4f60\u8ba4\u4e3a\u9ed8\u8ba4\u7684\u5b57\u4f53\u4e0d\u597d\u770b\uff0c\u60f3\u6362\u6362\u53e3\u5473\uff0c\u90a3\u4e48\u5982\u4f55\u81ea\u5df1\u52a8\u624b\u5236\u4f5c\u4e00\u4e2apf2\u5b57\u4f53\u5462\uff1f\u90a3\u5c31\u8981\u7528\u5230\"grub-mkfont\"\u5de5\u5177\u3002\u4e0b\u9762\u7684\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u4ece\u4e00\u4e2attc\u5b57\u4f53(\u6587\u6cc9\u9a7f\u7b49\u5bbd\u5fae\u7c73\u9ed1)\u5236\u4f5c\u4e00\u4e2a24px\u5927\u5c0f\u7684pf2\u5b57\u4f53\uff1a</p> <pre><code>grub-mkfont -i1 -n WenQuanYiMicroHeiMono24px -o WenQuanYiMicroHeiMono24px.pf2 -s24 -v wqy-microhei.ttc\n</code></pre> <p>\u5c06\u5236\u4f5c\u597d\u7684\u5b57\u4f53\u6587\u4ef6(WenQuanYiMicroHeiMono24px.pf2)\u653e\u5230\"$prefix/fonts\"\u76ee\u5f55\u4e2d\uff0c\u4fee\u6539'grub.cfg'\u6587\u4ef6\u4e2d\u7684\u4e24\u884c\uff1a</p> <pre><code>set gfxterm_font=WenQuanYiMicroHeiMono24px\nloadfont WenQuanYiMicroHeiMono24px\n</code></pre> <p>[\u6ce8\u610f]\u4f60\u6700\u597d\u4f7f\u7528\u7b49\u5bbd\u4e2d\u6587\u5b57\u4f53(\u63a8\u8350\u4f7f\u7528\u6587\u6cc9\u9a7f\u7b49\u5bbd\u6b63\u9ed1\u6216\u8005\u7b49\u5bbd\u5fae\u7c73\u9ed1)\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u8ba9GRUB2\u7684\u5b57\u4f53\u95f4\u8ddd\u8fc7\u5927\uff0c\u5341\u5206\u96be\u770b\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#94-grub2windows-peiso","title":"9.4 \u4f7f\u7528grub2\u5f15\u5bfcWindows PE\u7684ISO\u6587\u4ef6","text":"<p>GRUB4DOS\u6709\u4e00\u4e2a\u975e\u5e38\u9177\u7684'\u78c1\u76d8\u6620\u5c04'\u529f\u80fd\uff0c\u80fd\u591f\u7528\u4e8e\u542f\u52a8WinPE\u7684ISO\u6587\u4ef6\u3002\u5176\u5b9e\uff0c\u5c06GRUB2\u914d\u5408MEMDISK\u5de5\u5177\u4f7f\u7528\uff0c\u540c\u6837\u53ef\u4ee5\u5f15\u5bfc\u5404\u79cd\u6620\u50cf\u6587\u4ef6\uff0c\u5305\u62ecISO\u6587\u4ef6\u4e0e\u8f6f/\u786c\u76d8\u6620\u50cf\u3002</p> <p>\u9996\u5148\uff0c\u4f60\u5fc5\u987b\u5b89\u88c5\u6216\u8005\u4e0b\u8f7d\"syslinux\"\u8f6f\u4ef6\u5305\uff0c\u4ece\u4e2d\u63d0\u53d6\u51fa\"memdisk\"\u6587\u4ef6(\u53ef\u80fd\u4f4d\u4e8e'/usr/share/syslinux/memdisk'\u6216'bios/memdisk/memdisk')\uff0c\u7136\u540e\u5c06\u5b83\u590d\u5236\u5230GRUB2\u7684\u5b89\u88c5\u76ee\u5f55\u4e2d(\u672c\u6587\u5047\u5b9a\u5176\u4f4d\u4e8e\"winpe\"\u5b50\u76ee\u5f55\u4e2d\uff0c\u4e5f\u5c31\u662f\"$prefix/winpe/memdisk\")\u3002</p> <p>\u7136\u540e\uff0c\u5c06\u4f60\u60f3\u8981\u5f15\u5bfc\u7684WindowsPE\u7684ISO\u6587\u4ef6\u653e\u5230\u67d0\u4e2a\u5730\u65b9(\u672c\u6587\u5047\u5b9a\u5176\u4f4d\u4e8e\"$prefix/winpe/WinPE.ISO\")\u3002\u5f53\u7136\uff0c\u4e3a\u4e86\u8282\u7ea6\u78c1\u76d8\u7a7a\u95f4\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7528gzip\u5bf9ISO\u6587\u4ef6\u8fdb\u884c\u538b\u7f29\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u793a\u4f8b\u4e2d\u6ca1\u6709\u8fd9\u4e48\u505a\u3002</p> <p>\u6700\u540e\uff0c\u5728'grub.cfg'\u4e2d\u52a0\u5165\u5982\u4e0b\u83dc\u5355\u9879(\u5982\u679c\u4f60\u5bf9ISO\u8fdb\u884c\u4e86gzip\u538b\u7f29\uff0c\u90a3\u4e48\u8fd8\u9700\u8981\u989d\u5916\u518d\u52a0\u4e0a\"insmod gzio\"\u547d\u4ee4)\uff1a</p> <pre><code>menuentry \"[BIOS] Windows PE\" --unrestricted {\n    linux16  $prefix/winpe/memdisk iso raw\n    initrd16 $prefix/winpe/WinPE.ISO\n}\n</code></pre> <p>[\u6ce8\u610f]\u4e0eGRUB4DOS\u4e00\u6837\uff0c\u7531\u4e8eMEMDISK\u5bf9\u5404\u79cd\u6620\u50cf\u6587\u4ef6\u7684\u6a21\u62df\u662f\u901a\u8fc7\u5728\u5b9e\u6a21\u5f0f\u4e0b\u62e6\u622aBIOS\u7684 INT 13h \u4e0e INT 15h \u8c03\u7528\u6765\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6709\u5f88\u5927\u7684\u5c40\u9650\u6027\uff1a</p> <ul> <li>\u53ea\u80fd\u7528\u4e8eBIOS\u6a21\u5f0f\u542f\u52a8\uff0c\u4e0d\u80fd\u7528\u4e8eUEFI\u6a21\u5f0f\u542f\u52a8</li> <li>\u6a21\u62df\u51fa\u6765\u7684\u8f6f\u76d8/\u5149\u76d8/\u786c\u76d8\u8bbe\u5907\u53ea\u80fd\u88ab\u57fa\u4e8e\u5b9e\u6a21\u5f0f\u7684\u64cd\u4f5c\u7cfb\u7edf\u6240\u8bc6\u522b(DOS,FreeDOS)\uff0c\u4e0d\u80fd\u88ab\u57fa\u4e8e\u4fdd\u62a4\u6a21\u5f0f\u7684\u64cd\u4f5c\u7cfb\u7edf\u6240\u8bc6\u522b(Windows,Linux,BSD)</li> <li>\u4ece\u5b9e\u7528\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u53ea\u80fd\u7528\u4e8e\u5f15\u5bfcWinPE\u7684ISO\u4ee5\u53ca\u57fa\u4e8eDOS/FreeDOS\u7684\u6620\u50cf\uff0c\u4e0d\u80fd\u7528\u4e8e\u5f15\u5bfc\u5404\u79cdLinux\u7684LiveCD ISO\u4ee5\u53ca\u5fae\u8f6f\u539f\u7248\u7684Windows ISO\u5b89\u88c5\u5149\u76d8\u3002</li> </ul> <p>[\u91ca\u7591]\u4e0d\u8981\u5c06MEMDISK\u4e0eGRUB2\u7684\"memdisk.mod\"\u6a21\u5757\u6df7\u6dc6\uff0c\u4ed6\u4eec\u662f\u4e24\u4e2a\u6beb\u4e0d\u76f8\u5e72\u7684\u4e1c\u897f\u3002\"memdisk.mod\"\u6a21\u5757\u7684\u4f5c\u7528\u662f\u4e3a'core.img'\u63d0\u4f9b\u5185\u5b58\u76d8\u652f\u6301\uff0c\u5176\u76ee\u7684\u662f\u4e3a\u4e86\u8ba9GRUB2\u80fd\u591f\u6b63\u786e\u8bc6\u522b\u542f\u52a8\u8bbe\u5907\u3002\u5982\u679c\u628a'core.img'\u6bd4\u4f5cLinux\u5185\u6838\uff0c\u90a3\u4e48\"memdisk.mod\"\u6a21\u5757\u7684\u4f5c\u7528\u5c31\u76f8\u5f53\u4e8e\u4e3a'core.img'\u8fd9\u4e2a\"\u5185\u6838\"\u63d0\u4f9b\u4e86'initramdisk'\uff0c\u7528\u4ee5\u52a0\u8f7d\u78c1\u76d8\u4e0e\u6587\u4ef6\u7cfb\u7edf\u9a71\u52a8\uff0c\u4ece\u800c\u8ba9GRUB2\u53ef\u4ee5\u8bbf\u95ee\u78c1\u76d8\uff0c\u8fdb\u800c\u52a0\u8f7d\u5176\u4ed6\u7684\u6a21\u5757\u3002\u4f46\u662f\u5b9e\u9645\u4e0a\uff0c\u5728\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u66f4\u672c\u4e0d\u9700\u8981\u4f7f\u7528\"memdisk.mod\"\uff0c\u56e0\u4e3a\u5728'grub-install'\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u9a71\u52a8\u5df2\u7ecf\u88ab\u5d4c\u5165\u5230'core.img'\u4e2d\u4e86\u3002\u5982\u679c\u4f60\u8fd8\u662f\u4e0d\u660e\u767d\"memdisk.mod\"\u6a21\u5757\u7684\u4f5c\u7528\u7684\u8bdd\uff0c\u90a3\u5c31\u5fd8\u8bb0\u5b83\u7684\u5b58\u5728\u5427\uff0c\u56e0\u4e3a\u4f60\u66f4\u672c\u4e0d\u9700\u8981\u77e5\u9053\u6709\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5c31\u50cf\u4f60\u4e0d\u9700\u8981\u4e86\u89e3\u5168\u90e8GRUB2\u6a21\u5757\u4e00\u6837\u3002\u4ec5\u4ec5\u662f\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u4e1c\u897f\u7684\u540d\u5b57\u76f8\u540c\uff0c\u6211\u624d\u5728\u8fd9\u91cc\u591a\u7f57\u55e6\u4e86\u51e0\u53e5\u800c\u5df2\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#95-grub2windows-pewim","title":"9.5 \u4f7f\u7528grub2\u5f15\u5bfcWindows PE\u7684WIM\u6587\u4ef6","text":"<p>\u7531\u4e8eGRUB2\u4e0d\u80fd\u5728UEFI\u6a21\u5f0f\u4e0b\u5bf9ISO\u6587\u4ef6\u8fdb\u884c\u4eff\u771f\uff0c\u90a3\u4e48\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u5728UEFI\u6a21\u5f0f\u4e0b\u5f15\u5bfcWindowsPE\u5462\uff1f\u7b54\u6848\u662f\u5fc5\u987b\u4f7f\u7528WIM\u683c\u5f0f\u7684WindowsPE\u3002 \u5177\u4f53\u8bf4\u6765\u5c31\u662f\u9996\u5148\u7528GRUB2\u94fe\u5f0f\u52a0\u8f7d\u5fae\u8f6f\u7684\"bootmgfw.efi\"\u5f15\u5bfc\u7ba1\u7406\u5668\uff0c\u7136\u540e\u518d\u7531\"bootmgfw.efi\"\u6839\u636eBCD\u6587\u4ef6\u7684\u6307\u5f15\u53bb\u542f\u52a8WindowsPE\u3002</p> <p>\u7b2c\u4e00\u6b65\uff0c\u4ece\u4f8b\u5982\"\u5faePE\"\u8fd9\u6837\u7684\u4f5c\u54c1\u4e2d\u63d0\u53d6\"WEPE64.WIM\"\u4e0e\"WEPE.SDI\"(BOOT.SDI)\u6587\u4ef6\u3002 \u7b2c\u4e8c\u6b65\uff0c\u4eceWin10\u7684\u539f\u7248\u5b89\u88c5\u5149\u76d8\u4e2d\u63d0\u53d6\"bootmgfw.efi\"\u6587\u4ef6(/efi/boot/bootx64.efi)\u3002 \u7b2c\u4e09\u6b65\uff0c\u5c06\u63d0\u53d6\u7684\u4e09\u4e2a\u6587\u4ef6\u653e\u7f6e\u5230\u4e00\u4e2aFAT32\u6216NTFS\u78c1\u76d8\u5206\u533a\u4e0a\uff0c\u8fd9\u91cc\u5047\u5b9a\u653e\u5230'(hd0,gpt3)/winpe/'\u76ee\u5f55\u4e2d\u3002 \u7b2c\u56db\u6b65\uff0c\u4eff\u7167\u4e0b\u9762\u7684\u547d\u4ee4\u5e8f\u5217\u7f16\u5199\u4e00\u4e2aBCD\u6587\u4ef6\uff1a</p> <pre><code>bcdedit /createstore  BCD\n\nbcdedit /store BCD /create {dddddddd-dddd-dddd-dddd-dddddddddddd} /device\nbcdedit /store BCD /set {dddddddd-dddd-dddd-dddd-dddddddddddd} RAMDISKSDIDEVICE BOOT\nbcdedit /store BCD /set {dddddddd-dddd-dddd-dddd-dddddddddddd} RAMDISKSDIPATH \"\\winpe\\WEPE.SDI\"\n\nbcdedit /store BCD /create {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} /d \"UEFI Windows PE x64\" /application OSLOADER\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} DEVICE RAMDISK=[BOOT]\\winpe\\WEPE64.WIM,{dddddddd-dddd-dddd-dddd-dddddddddddd}\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} HIGHESTMODE YES\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} OSDEVICE RAMDISK=[BOOT]\\winpe\\WEPE64.WIM,{dddddddd-dddd-dddd-dddd-dddddddddddd}\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} SYSTEMROOT \"\\Windows\"\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} WINPE YES\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} LOCALE \"zh-CN\"\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} NX OptIn\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} PAE ForceEnable\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} detecthal Yes\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} DEBUGSTART DISABLE\nbcdedit /store BCD /set {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} RECOVERYENABLED NO\nbcdedit /store BCD /bootems {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} OFF\nbcdedit /store BCD /ems {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} OFF\nbcdedit /store BCD /bootdebug {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} OFF\nbcdedit /store BCD /debug {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} OFF\nbcdedit /store BCD /event {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa} OFF\n\nbcdedit /store BCD /create {bootmgr} /d \"Windows PE Boot Manager\"\nbcdedit /store BCD /set {bootmgr} DEVICE BOOT\nbcdedit /store BCD /set {bootmgr} LOCALE \"zh-CN\"\nbcdedit /store BCD /set {bootmgr} nointegritychecks Yes\nbcdedit /store BCD /displayorder {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa}\nbcdedit /store BCD /default {aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa}\nbcdedit /store BCD /timeout 10\n</code></pre> <p>\u7b2c\u4e94\u6b65\uff0c\u5c06\u751f\u6210\u7684BCD\u6587\u4ef6\u540c\u6837\u653e\u7f6e\u5230'(hd0,gpt3)/winpe/'\u76ee\u5f55\u4e2d\u3002 \u6700\u540e\uff0c\u5728'grub.cfg'\u4e2d\u52a0\u5165\u5982\u4e0b\u83dc\u5355\u9879\uff1a</p> <pre><code>menuentry 'UEFI Windows PE Boot Manager' --unrestricted {\n    chainloader (hd0,gpt3)/winpe/bootmgfw.efi\n}\n</code></pre>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#96-grub2gentoo-livecd-iso","title":"9.6 \u4f7f\u7528grub2\u5f15\u5bfc(\u786c\u76d8\u5b89\u88c5)Gentoo LiveCD \u7684ISO\u6587\u4ef6","text":"<p>\u4ee5\"install-amd64-minimal-*.iso\"\u4e3a\u4f8b\u3002 \u7b2c\u4e00\u6b65\uff0c\u5c06ISO\u4e2d\u7684'/boot/{gentoo,gentoo.igz}'\u3001'/image.squashfs'\u4e09\u4e2a\u6587\u4ef6\u653e\u5230'(hd0,gpt3)/os/gentoo/'\u76ee\u5f55\u4e2d\uff1b \u7b2c\u4e8c\u6b65\uff0c\u5c06ISO\u4e2d\u7684'/livecd'\u653e\u5230\u76f8\u540c\u5206\u533a(hd0,gpt3)\u7684\u6839\u76ee\u5f55\u4e0b\uff1b \u6700\u540e\uff0c\u5728'grub.cfg'\u4e2d\u52a0\u5165\u5982\u4e0b\u83dc\u5355\u9879\uff1a</p> <pre><code>menuentry \"Gentoo Minimal Install LiveCD\" --unrestricted {\n    linux  (hd0,gpt3)/os/gentoo/gentoo cdroot looptype=squashfs loop=/os/gentoo/image.squashfs\n    initrd (hd0,gpt3)/os/gentoo/gentoo.igz\n}\n</code></pre> <p>[\u63d0\u793a]'livecd'\u662f\u5bfb\u627e'image.squashfs'\u6240\u5728\u78c1\u76d8\u5206\u533a\u7684\u5173\u952e\u3002</p> <p>[\u63d0\u793a] Gentoo LiveCD \u4ea6\u53ef\u4f7f\u7528\u4e0e\u5176\u4ed6Linux\u53d1\u884c\u7248\u7684LiveCD\u7c7b\u4f3c\u7684\u65b9\u6cd5\u542f\u52a8(\u4e5f\u5c31\u662f\u4f7f\u7528\"isoboot=\"\u53c2\u6570)\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#97-grub2-linux-livecd-iso","title":"9.7 \u4f7f\u7528GRUB2\u5f15\u5bfc(\u786c\u76d8\u5b89\u88c5)\u5404\u79cd Linux LiveCD \u7684ISO\u6587\u4ef6","text":"<p>\u9996\u5148\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u8fd9\u91cc\u7ed9\u51fa\u7684\u65b9\u6cd5\uff0c\u53ea\u9002\u7528\u4e8e\u63d0\u4f9b\u4e86\"img_loop=\"\u6216\"iso-scan/filename=\"\u6216\"fromiso=\"\u6216\"isoboot=\"\u6216\"isoloop=\"\u4e4b\u7c7b\u53c2\u6570\u7684LiveCD\u3002</p> <p>\u4e0b\u9762\u4ee5 Ubuntu \u7684 LiveCD \u4e3a\u4f8b\u8bf4\u660e\u3002\u9996\u5148\uff0c\u5047\u5b9a\u4f60\u5c06ISO\u6587\u4ef6\u653e\u5728'(hd0,gpt3)/ISO/Ubuntu.iso'\uff1b\u7136\u540e\uff0c\u5728'grub.cfg'\u4e2d\u52a0\u5165\u5982\u4e0b\u83dc\u5355\u9879\uff1a</p> <pre><code>menuentry \"Ubuntu LiveCD\" --unrestricted {\n    loopback loop0 (hd0,gpt3)/ISO/Ubuntu.iso\n    linux  (loop0)/casper/vmlinuz boot=casper iso-scan/filename=/ISO/Ubuntu.iso\n    initrd (loop0)/casper/initrd.lz\n}\n</code></pre> <p>[\u8bf4\u660e]\u8fd9\u91cc\u7ed9\u51fa\u7684\u65b9\u6cd5\uff0c\u5176\u5b9e\u5c31\u662f\u5404\u79cd\"\u786c\u76d8\u5b89\u88c5 XX Linux\"\u7684\u7ffb\u7248\uff0c\u53ea\u4e0d\u8fc7\u4e0d\u518d\u9700\u8981\u5c06\"vmlinuz\"\u4e0e\"initrd\"\u4eceISO\u4e2d\u89e3\u538b\u51fa\u6765\u800c\u5df2\u3002</p> <p>\u66f4\u591a\u5176\u5b83\u53d1\u884c\u7248\u7684\u5b9e\u4f8b\uff0c\u8bf7\u7ee7\u7eed\u9605\u8bfb\u4e0b\u9762\u7684\u5185\u5bb9\u3002</p>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#grubcfg","title":"\u5341 grub.cfg \u5b9e\u4f8b","text":"<p>\u4e0b\u9762\u662f\u672c\u6587\u4f5c\u8005\u5b9e\u9645\u4f7f\u7528\u7684\u4e00\u4e2a\"grub.cfg\"\u6587\u4ef6\uff0c\u901a\u7528\u4e8eBIOS\u4e0eUEFI\u6a21\u5f0f\uff0c\u653e\u5728\u8fd9\u91cc\u5f53\u4f5c\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u4f9b\u8bfb\u8005\u53c2\u8003\uff1a</p> <pre><code>#\u7531\u4e8e\"$prefix\"\u7684\u503c\u662f\u5728\"grub-install\"\u5b89\u88c5\u65f6\u786e\u5b9a\u7684\uff0c\u5e76\u4e14\u5d4c\u5165'core.img'\u4e2d\u7684\u6a21\u5757\u4e5f\u662f\u968f\u786c\u4ef6\u53d8\u5316\u7684\uff0c\n#\u6240\u4ee5\u4e0d\u8981\u53ea\u662f\u7b80\u5355\u7684\u590d\u5236'grub'\u76ee\u5f55\u5230\u5904\u4f7f\u7528\uff0c\u800c\u5e94\u8be5\u5728\u6bcf\u4e00\u4e2a\u4ecb\u8d28\u4e0a\u90fd\u4f7f\u7528\"grub-install\"\u8fdb\u884c\u5b89\u88c5\u3002\n###############################################################################\n#(1)\u672c\u914d\u7f6e\u6587\u4ef6\u8981\u6c42\"grub\"\u76ee\u5f55\u6240\u5728\u5206\u533a\u7684\u5377\u6807\u5fc5\u987b\u662f\"GRUB2\"\u3002\n#(2)\u4e3a\u4e86\u4fdd\u6301\u6700\u5927\u7a0b\u5ea6\u7684BIOS\u517c\u5bb9\u6027\uff0c\"GRUB2\"\u5206\u533a\u5fc5\u987b\u4f4d\u4e8e\u78c1\u76d8\u7684\u524d 137GB \u8303\u56f4\u3002\n###############################################################################\n# \u5982\u679c\u8981\u5728windows\u4e0a\u5b89\u88c5GRUB2\u7684\u8bdd\uff0c\u5fc5\u987b\u9996\u5148\u4ee5\u7ba1\u7406\u5458\u8eab\u4efd\u6253\u5f00\u547d\u4ee4\u63d0\u793a\u7b26\uff0c\u7136\u540e\u8fd0\u884c\n# wmic diskdrive list brief\n# \u547d\u4ee4\u67e5\u770b\u5b89\u88c5\u76ee\u6807\uff0c\u6700\u540e\u518d\u4f7f\u7528\u4f8b\u5982\u4e0b\u9762\u8fd9\u6837\u7684\u547d\u4ee4\u8fdb\u884c\u5b89\u88c5\uff1a\n# grub-install.exe --boot-directory=g: --recheck --target=x86_64-efi --efi-directory=g: --no-nvram --removable \\\\.\\PHYSICALDRIVE5\n# grub-install.exe --boot-directory=g: --recheck --target=i386-pc \\\\.\\PHYSICALDRIVE5\n# \u5982\u679c\"GRUB2\"\u5206\u533a\u4e0d\u5728\u78c1\u76d8\u7684\u524d 137GB \u8303\u56f4\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5(\u4e0d\u5b8c\u7f8e\u7684\u8865\u6551\u63aa\u65bd)\uff1a\n# grub-install.exe --boot-directory=g: --recheck --target=i386-pc --disk-module=native \\\\.\\PHYSICALDRIVE5\n###############################################################################\n# binwalk initrd.img\n# https://unix.stackexchange.com/questions/163346/why-is-it-that-my-initrd-only-has-one-directory-namely-kernel\n\n\nset label=GRUB2\nset check_signatures=no\nset default=0\nset fallback=1\nset gfxmode=1024x768,auto\nset gfxterm_font=WenQuanYiMicroHeiMono\nset lang=zh_CN\nset locale_dir=$prefix/locale\nset pager=1\nset superusers=root\nset timeout=5\n\n\ninsmod part_gpt\ninsmod part_msdos\ninsmod fat\ninsmod exfat\ninsmod ntfs\ninsmod iso9660\ninsmod ext2\ninsmod xfs\ninsmod all_video\ninsmod gfxterm\ninsmod png\n\n\nterminal_output  gfxterm\nbackground_image $prefix/themes/wmoon.png\nloadfont  24px\npassword_pbkdf2 root grub.pbkdf2.sha512.69.3AE287EEFF7205CC.C0C0B1517369963D14FADE30BE588E56D88E86451C9D3FB9B51917DBBF2F8E8A\n\n\nmenuentry '\u6b63\u5e38\u542f\u52a8(Windows)' --unrestricted {\n    if [ 'pc' == $grub_platform ] ; then\n        if search --file --set /bootmgr ; then\n            chainloader +1\n        elif search --file --set /ntldr ; then\n            chainloader +1\n        fi\n    elif [ 'efi' == $grub_platform ] ; then\n        if search --file --set /EFI/Microsoft/Boot/bootmgfw.efi ; then\n            chainloader /EFI/Microsoft/Boot/bootmgfw.efi\n        fi\n    fi\n}\n\n\n#http://www.wepe.com.cn/download.html\nif [ 'pc' == $grub_platform -a -f $prefix/winpe/memdisk ] ; then\n    if [ -f $prefix/winpe/win8pe64.iso ] ; then\n        menuentry '[BIOS]\u542f\u52a864\u4f4d Win 8 PE (\u5faePE)' --unrestricted {\n            linux16  $prefix/winpe/memdisk iso raw\n            initrd16 $prefix/winpe/win8pe64.iso\n        }\n    fi\n    if [ -f $prefix/winpe/win10pe64.iso ] ; then\n        menuentry '[BIOS]\u542f\u52a864\u4f4d Win 10 PE (\u5faePE)' --unrestricted {\n            linux16  $prefix/winpe/memdisk iso raw\n            initrd16 $prefix/winpe/win10pe64.iso\n        }\n    fi\nfi\nif [ 'efi' == $grub_platform -a -f $prefix/winpe/bootmgfw.efi -a -f $prefix/winpe/BCD ] ; then\n    if [ -f $prefix/winpe/win10pe64.wim -a -f $prefix/winpe/win8pe64.wim ] ; then\n        menuentry '[UEFI]\u542f\u52a864\u4f4d Windows 8/10 PE \u2192' --unrestricted {\n            chainloader $prefix/winpe/bootmgfw.efi\n        }\n    fi\nfi\n\n\n#https://mirrors.tuna.tsinghua.edu.cn/archlinux/iso/latest/\nif [ -f $prefix/linux/archlinux.iso ] ; then\n    menuentry 'Arch Linux LiveCD [root/\u7a7a]' --unrestricted {\n        loopback loop0 $prefix/linux/archlinux.iso\n        linux  (loop0)/arch/boot/x86_64/vmlinuz img_label=$label img_loop=/grub/linux/archlinux.iso   systemd.wants=sshd.service\n        initrd (loop0)/arch/boot/x86_64/archiso.img\n    }\nfi\n\n#https://mirrors.163.com/gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/\nif [ -f $prefix/linux/install-amd64-minimal.iso ] ; then\n    menuentry 'Mini Gentoo LiveCD [root/123]' --unrestricted {\n        loopback loop0 $prefix/linux/install-amd64-minimal.iso\n        linux  (loop0)/boot/gentoo cdroot isoboot=/grub/linux/install-amd64-minimal.iso  dosshd nokeymap passwd=123\n        initrd (loop0)/boot/gentoo.igz\n    }\nfi\n\n#https://mirror-hk.koddos.net/calculate-linux/release/\n#https://www.calculate-linux.org/main/en/download\n# Calculate Linux Scratch \u662f\u57fa\u4e8eGentoo\u5236\u4f5c\u7684 LiveCD \uff0c\u5305\u542b\u7f16\u8bd1\u5de5\u5177\u3001\u652f\u6301WiFi\n# \u65e2\u53ef\u7528\u4f5cLFS(Linux From Scratch)\u7684\u5bbf\u4e3b\u7cfb\u7edf\u3001\u4e5f\u53ef\u7528\u4e8e\u5b89\u88c5 Gentoo\nif [ -f $prefix/linux/cls.iso ] ; then\n    menuentry 'Live GCC x64 [root/root]' --unrestricted {\n        loopback loop0 $prefix/linux/cls.iso\n        linux  (loop0)/boot/vmlinuz root=live iso-scan/filename=/grub/linux/cls.iso   vga=current nodevfs noresume nodmraid\n        initrd (loop0)/boot/initrd\n    }\nfi\n\n#https://mirrors.huaweicloud.com/centos/7/isos/x86_64/\nif [ -f $prefix/linux/CentOS-LiveGNOME.iso ] ; then\n    menuentry 'CentOS 7.8 GNOME LiveCD [root/\u7a7a](\u53ef\u9000\u51faliveuser\u540e\u518d\u7528root\u767b\u5f55)' --unrestricted {\n        loopback loop0 $prefix/linux/CentOS-LiveGNOME.iso\n        linux  (loop0)/isolinux/vmlinuz0 rd.live.image root=live:CDLABEL=CentOS-7-x86_64-LiveGNOME-2003 iso-scan/filename=/grub/linux/CentOS-LiveGNOME.iso   systemd.wants=sshd.service inst.lang=zh_CN\n        initrd (loop0)/isolinux/initrd0.img\n    }\nfi\n\n#https://ftp.sjtu.edu.cn/fedora/linux/releases/32/Spins/x86_64/iso/\n#\u53ea\u6709 Xfce LiveCD \u53ef\u4ee5\u8bbe\u7f6e\u4e2d\u6587\u754c\u9762\nif [ -f $prefix/linux/Fedora-Xfce-Live.iso ] ; then\n    menuentry 'Fedora 32 Xfce LiveCD [root/\u7a7a](\u81ea\u52a8liveuser\u767b\u5f55\u4f46\u53ef\u5207\u6362\u81f3root\u7528\u6237)' --unrestricted {\n        loopback loop0 $prefix/linux/Fedora-Xfce-Live.iso\n        linux  (loop0)/isolinux/vmlinuz rd.live.image root=live:CDLABEL=Fedora-Xfce-Live-32-1-6 iso-scan/filename=/grub/linux/Fedora-Xfce-Live.iso   systemd.wants=sshd.service locale.LANG=zh_CN.utf8 inst.lang=zh_CN\n        initrd (loop0)/isolinux/initrd.img\n    }\nfi\n\n#https://anaconda-installer.readthedocs.io/en/latest/boot-options.html\n#\u786c\u76d8\u5b89\u88c5\u901a\u7528\u4e8e\u6240\u6709\u5305\u542b\"Packages\"\u6216\"BaseOS\"\u76ee\u5f55\u7684 CentOS/Fedora ISO\u6620\u50cf(Minimal,DVD,Everything)\n#https://mirrors.zju.edu.cn/centos/8/isos/x86_64/\nif [ -f $prefix/linux/CentOS-dvd1.iso ] ; then\n    menuentry '\u786c\u76d8\u5b89\u88c5 CentOS' --unrestricted {\n        loopback loop0 $prefix/linux/CentOS-dvd1.iso\n        linux  (loop0)/isolinux/vmlinuz inst.repo=hd:LABEL=$label:/grub/linux/CentOS-dvd1.iso   inst.lang=zh_CN\n        initrd (loop0)/isolinux/initrd.img\n    }\nfi\n\n#\u7f51\u7edc\u5b89\u88c5\u901a\u7528\u4e8e\u6240\u6709\u5305\u542b\"images\"\u76ee\u5f55\u7684 CentOS/Fedora ISO\u6620\u50cf(Minimal,DVD,Everything,NetInstall,boot)\n#https://mirrors.cqu.edu.cn/CentOS/8/isos/x86_64/\nif [ -f $prefix/linux/CentOS-boot.iso ] ; then\n    menuentry '\u7f51\u7edc\u5b89\u88c5 CentOS [\u652f\u6301WiFi]' --unrestricted {\n        loopback loop0 $prefix/linux/CentOS-boot.iso\n        linux  (loop0)/images/pxeboot/vmlinuz inst.stage2=hd:LABEL=$label:/grub/linux/CentOS-boot.iso   inst.repo=https://mirrors.aliyun.com/centos/8/BaseOS/x86_64/os/ inst.lang=zh_CN ip=dhcp nameserver=223.6.6.6\n        initrd (loop0)/images/pxeboot/initrd.img\n    }\nfi\n\n#https://mirrors.ustc.edu.cn/debian-cd/current-live/amd64/iso-hybrid/\n#\u4e5f\u9002\u7528\u4e8e'Kali LiveCD [root/toor]'( username=root hostname=kali ) https://cdimage.kali.org/current/\nif [ -f $prefix/linux/debian-live-gnome.iso ] ; then\n    menuentry 'Debian 10.5 GNOME LiveCD (NO SSH)' --unrestricted {\n        loopback loop0 $prefix/linux/debian-live-gnome.iso\n        linux  (loop0)/live/vmlinuz-4.19.0-10-amd64 boot=live findiso=/grub/linux/debian-live-gnome.iso   components locales=zh_CN.UTF-8\n        initrd (loop0)/live/initrd.img-4.19.0-10-amd64\n    }\nfi\n\n#https://mirrors.cloud.tencent.com/ubuntu-cdimage/lubuntu/releases/\n#\u4e5f\u9002\u7528\u4e8e 'KDE neon LiveCD'(initrd.lz; apparmor=0) https://files.kde.org/neon/images/user/current/neon-user-current.iso\nif [ -f $prefix/linux/lubuntu.iso ] ; then\n    menuentry 'Ubuntu LXQt LiveCD (NO SSH)' --unrestricted {\n        loopback loop0 $prefix/linux/lubuntu.iso\n        linux  (loop0)/casper/vmlinuz boot=casper iso-scan/filename=/grub/linux/lubuntu.iso   username=root locale=zh_CN keyboard-configuration/layoutcode=us\n        initrd (loop0)/casper/initrd\n    }\nfi\n\n#https://www.debian.org/releases/stable/amd64/ch05s03.zh-cn.html\n#https://www.debian.org/releases/stable/amd64/ch06s03.zh-cn.html\n#\u6700\u597d\u5c06\u7528\u4e8e\u786c\u76d8\u5b89\u88c5\u7684ISO\u6620\u50cf(\u4f8b\u5982 debian-10.4.0-amd64-xfce-CD-1.iso)\u653e\u5728\u6587\u4ef6\u7cfb\u7edf\u7684\u6839\u76ee\u5f55\u6216\u7b2c\u4e00\u5c42\u5b50\u76ee\u5f55\u4e2d(\u53ef\u7b80\u5316ISO\u6620\u50cf\u7684\u641c\u7d22)\n#http://mirrors.yun-idc.com/debian/dists/stable/main/installer-amd64/current/images/hd-media/\n#[\u6ce8\u610f]\u6b64\u65b9\u6cd5\u4e0d\u9002\u7528\u4e8e Ubuntu\nif [ -f $prefix/linux/debian/vmlinuz -a -f $prefix/linux/debian/initrd.gz ] ; then\n    menuentry '\u786c\u76d8\u5b89\u88c5 Debian [\u81ea\u52a8\u641c\u7d22ISO\u6620\u50cf(\u6700\u597d\u653e\u5728\u6839\u76ee\u5f55)]' --unrestricted {\n        linux  $prefix/linux/debian/vmlinuz   priority=low vga=791 locale=zh_CN\n        initrd $prefix/linux/debian/initrd.gz\n    }\nfi\n\n#https://mirrors.163.com/debian/dists/stable/main/installer-amd64/current/images/netboot/\n#https://mirrors.163.com/ubuntu/dists/focal/main/installer-amd64/current/legacy-images/netboot/\n#\u7f51\u7edc\u5b89\u88c5\u4e5f\u9002\u7528\u4e8e Ubuntu \u7684 mini.iso \u6620\u50cf(\u652f\u6301WiFi)\nif [ -f $prefix/linux/debian/mini.iso ] ; then\n    menuentry '\u7f51\u7edc\u5b89\u88c5 Debian [\u4e0d\u652f\u6301WiFi]' --unrestricted {\n        loopback loop0 $prefix/linux/debian/mini.iso\n        linux  (loop0)/linux   priority=low vga=791 locale=zh_CN\n        initrd (loop0)/initrd.gz\n    }\nfi\n\n#https://mirrors.aliyun.com/opensuse/distribution/openSUSE-stable/live/\nif [ -f $prefix/linux/openSUSE-Leap-KDE-Live.iso ] ; then\n    menuentry 'openSUSE Leap 15.2 KDE LiveCD [root/\u7a7a]' --unrestricted {\n        loopback loop0 $prefix/linux/openSUSE-Leap-KDE-Live.iso\n        linux  (loop0)/boot/x86_64/loader/linux root=live:CDLABEL=openSUSE_Leap_15.2_KDE_Live iso-scan/filename=/grub/linux/openSUSE-Leap-KDE-Live.iso   systemd.wants=sshd.service lang=zh_CN\n        initrd (loop0)/boot/x86_64/loader/initrd\n    }\nfi\n\n#https://doc.opensuse.org/documentation/leap/startup/html/book.opensuse.startup/cha-boot-parameters.html\n#https://ftp.sjtu.edu.cn/opensuse/distribution/openSUSE-stable/iso/\nif [ -f $prefix/linux/openSUSE-Leap-DVD.iso ] ; then\n    menuentry '\u786c\u76d8\u5b89\u88c5 openSUSE Leap' --unrestricted {\n        loopback loop0 $prefix/linux/openSUSE-Leap-DVD.iso\n        linux  (loop0)/boot/x86_64/loader/linux install=hd:/grub/linux/openSUSE-Leap-DVD.iso   lang=zh_CN\n        initrd (loop0)/boot/x86_64/loader/initrd\n    }\nfi\ns\n#https://mirrors.nju.edu.cn/opensuse/distribution/openSUSE-stable/iso/\nif [ -f $prefix/linux/openSUSE-Leap-NET.iso ] ; then\n    menuentry '\u7f51\u7edc\u5b89\u88c5 openSUSE Leap [\u652f\u6301WiFi]' --unrestricted {\n        loopback loop0 $prefix/linux/openSUSE-Leap-NET.iso\n        linux  (loop0)/boot/x86_64/loader/linux install=https://ftp.sjtu.edu.cn/opensuse/distribution/openSUSE-stable/repo/oss/   lang=zh_CN netsetup=dhcp nameserver=223.6.6.6\n        initrd (loop0)/boot/x86_64/loader/initrd\n    }\nfi\n\nmenuentry '\u5173\u673a' --unrestricted { halt ; }\nmenuentry '\u91cd\u65b0\u542f\u52a8' --unrestricted { reboot ; }\n</code></pre>"},{"location":"linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/#_1","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>\u5b98\u65b9\u6587\u6863</li> <li>http://www.jinbuguo.com/linux/grub.cfg.html</li> </ul>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/","title":"Linux \u5185\u6838\u5f15\u5bfc\u8be6\u89e3","text":""},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#linux","title":"Linux \u5185\u6838\u5f15\u5bfc","text":""},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#_1","title":"\u4e00 \u6982\u8ff0","text":"<p>\u5185\u6838\u5f15\u5bfc\u9009\u9879\u5927\u4f53\u4e0a\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b\uff1a\u4e00\u7c7b\u4e0e\u8bbe\u5907\u65e0\u5173\u3001\u53e6\u4e00\u7c7b\u4e0e\u8bbe\u5907\u6709\u5173\u3002\u4e0e\u8bbe\u5907\u6709\u5173\u7684\u5f15\u5bfc\u9009\u9879\u591a\u5982\u725b\u6bdb\uff0c\u9700\u8981\u4f60\u81ea\u5df1\u9605\u8bfb\u5185\u6838\u4e2d\u7684\u76f8\u5e94\u9a71\u52a8\u7a0b\u5e8f\u6e90\u7801\u4ee5\u83b7\u53d6\u5176\u80fd\u591f\u63a5\u53d7\u7684\u5f15\u5bfc\u9009\u9879\u3002\u6bd4\u5982\uff0c\u5982\u679c\u4f60\u60f3\u77e5\u9053\u53ef\u4ee5\u5411 AHA1542 SCSI \u9a71\u52a8\u7a0b\u5e8f\u4f20\u9012\u54ea\u4e9b\u5f15\u5bfc\u9009\u9879\uff0c\u90a3\u4e48\u5c31\u67e5\u770b drivers/scsi/aha1542.c \u6587\u4ef6\uff0c\u4e00\u822c\u5728\u524d\u9762 100 \u884c\u6ce8\u91ca\u91cc\u5c31\u53ef\u4ee5\u627e\u5230\u6240\u63a5\u53d7\u7684\u5f15\u5bfc\u9009\u9879\u8bf4\u660e\u3002\u5927\u591a\u6570\u9009\u9879\u662f\u901a\u8fc7\"__setup()\"\u51fd\u6570\u8bbe\u7f6e\u7684\uff0c\u5c11\u90e8\u5206\u662f\u901a\u8fc7\"early_param()\"\u6216\"module_param()\"\u6216\"module_param_named()\"\u4e4b\u7c7b\u7684\u51fd\u6570\u8bbe\u7f6e\u7684\uff0c\u9017\u53f7\u524d\u7684\u90e8\u5206\u5c31\u662f\u5f15\u5bfc\u9009\u9879\u7684\u540d\u79f0\uff0c\u540e\u9762\u7684\u90e8\u5206\u5c31\u662f\u5904\u7406\u8fd9\u4e9b\u9009\u9879\u7684\u51fd\u6570\u540d\u3002</p> <p>[\u63d0\u793a]\u4f60\u53ef\u4ee5\u5728\u6e90\u7801\u6811\u7684\u6839\u76ee\u5f55\u4e0b\u8bd5\u4e00\u8bd5\u4e0b\u9762\u51e0\u4e2a\u547d\u4ee4\uff1a</p> <pre><code>grep -r '\\b__setup *(' *\ngrep -r '\\bearly_param *(' *\ngrep -r '\\bmodule_param *(' *\ngrep -r '\\bmodule_param_named *(' *\n</code></pre> <p>\u683c\u5f0f\u4e0a\uff0c\u591a\u4e2a\u9009\u9879\u4e4b\u95f4\u7528\u7a7a\u683c\u5206\u5272\uff0c\u9009\u9879\u503c\u662f\u4e00\u4e2a\u9017\u53f7\u5206\u5272\u7684\u5217\u8868\uff0c\u5e76\u4e14\u9009\u9879\u503c\u4e2d\u4e0d\u80fd\u5305\u542b\u7a7a\u767d\u3002</p> <pre><code>\u6b63\u786e\uff1aether=9,0x300,0xd0000,0xd4000,eth0  root=/dev/sda2\n\u9519\u8bef\uff1aether = 9, 0x300, 0xd0000, 0xd4000, eth0  root = /dev/sda2\n</code></pre> <p>\u6ce8\u610f\uff0c\u6240\u6709\u5f15\u5bfc\u9009\u9879\u90fd\u662f\u5927\u5c0f\u5199\u654f\u611f\u7684\uff01</p> <p>\u5728\u5185\u6838\u8fd0\u884c\u8d77\u6765\u4e4b\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 cat /proc/cmdline \u547d\u4ee4\u67e5\u770b\u5f53\u521d\u4f7f\u7528\u7684\u5f15\u5bfc\u9009\u9879\u4ee5\u53ca\u76f8\u5e94\u7684\u503c\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#_2","title":"\u4e8c \u5185\u6838\u6a21\u5757","text":"<p>\u5bf9\u4e8e\u6a21\u5757\u800c\u8a00\uff0c\u5f15\u5bfc\u9009\u9879\u53ea\u80fd\u7528\u4e8e\u76f4\u63a5\u7f16\u8bd1\u5230\u6838\u5fc3\u4e2d\u7684\u6a21\u5757\uff0c\u683c\u5f0f\u662f\"\u6a21\u5757\u540d.\u9009\u9879=\u503c\"\uff0c\u6bd4\u5982\"usbcore.blinkenlights=1\"\u3002\u52a8\u6001\u52a0\u8f7d\u7684\u6a21\u5757\u5219\u53ef\u4ee5\u5728 modprobe \u547d\u4ee4\u884c\u4e0a\u6307\u5b9a\u76f8\u5e94\u7684\u9009\u9879\u503c\uff0c\u6bd4\u5982\"modprobe usbcore blinkenlights=1\"\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528\"modinfo -p ${modulename}\"\u547d\u4ee4\u663e\u793a\u53ef\u52a0\u8f7d\u6a21\u5757\u7684\u6240\u6709\u53ef\u7528\u9009\u9879\u3002\u5df2\u7ecf\u52a0\u8f7d\u5230\u5185\u6838\u4e2d\u7684\u6a21\u5757\u4f1a\u5728 /sys/module/${modulename}/parameters/ \u4e2d\u663e\u793a\u51fa\u5176\u9009\u9879\uff0c\u5e76\u4e14\u67d0\u4e9b\u9009\u9879\u7684\u503c\u8fd8\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u901a\u8fc7\"echo -n \u200b${value} &gt; /sys/module/\u200b${modulename}/parameters/${parm}\"\u8fdb\u884c\u4fee\u6539\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#_3","title":"\u4e09 \u5185\u6838\u5982\u4f55\u5904\u7406\u5f15\u5bfc\u9879","text":"<p>\u7edd\u5927\u90e8\u5206\u7684\u5185\u6838\u5f15\u5bfc\u9009\u9879\u7684\u683c\u5f0f\u5982\u4e0b(\u6bcf\u4e2a\u9009\u9879\u7684\u503c\u5217\u8868\u4e2d\u6700\u591a\u53ea\u80fd\u6709\u5341\u9879)\uff1a</p> <pre><code>name[=value_1][,value_2]...[,value_10]\n</code></pre> <p>\u5982\u679c\"name\"\u4e0d\u80fd\u88ab\u8bc6\u522b\u5e76\u4e14\u6ee1\u8db3\"name=value\"\u7684\u683c\u5f0f\uff0c\u90a3\u4e48\u5c06\u88ab\u89e3\u8bd1\u4e3a\u4e00\u4e2a\u73af\u5883\u53d8\u91cf(\u6bd4\u5982\"TERM=linux\"\u6216\"BOOT_IMAGE=vmlinuz.bak\")\uff0c\u5426\u5219\u5c06\u88ab\u539f\u5c01\u4e0d\u52a8\u7684\u4f20\u9012\u7ed9 init \u7a0b\u5e8f(\u6bd4\u5982\"single\")\u3002</p> <p>\u5185\u6838\u53ef\u4ee5\u63a5\u53d7\u7684\u9009\u9879\u4e2a\u6570\u6ca1\u6709\u9650\u5236\uff0c\u4f46\u662f\u6574\u4e2a\u547d\u4ee4\u884c\u7684\u603b\u957f\u5ea6(\u9009\u9879/\u503c/\u7a7a\u683c\u5168\u90e8\u5305\u542b\u5728\u5185)\u5374\u662f\u6709\u9650\u5236\u7684\uff0c\u5b9a\u4e49\u5728 include/asm/setup.h \u4e2d\u7684 COMMAND_LINE_SIZE \u5b8f\u4e2d(\u5bf9\u4e8eX86_64\u800c\u8a00\u662f2048)\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#_4","title":"\u56db \u5185\u6838\u5f15\u5bfc\u9009\u9879\u7cbe\u9009","text":"<p>\u7531\u4e8e\u5f15\u5bfc\u9009\u9879\u591a\u5982\u725b\u6bdb\uff0c\u672c\u6587\u4e0d\u53ef\u80fd\u6d89\u53ca\u5168\u90e8\uff0c\u56e0\u6b64\u672c\u6587\u53ea\u57fa\u4e8e X86_64 \u5e73\u53f0\u4ee5\u53ca Linux-3.13.2 \u7cbe\u9009\u4e86\u4e00\u4e9b\u4e0e\u8bbe\u5907\u65e0\u5173\u7684\u5f15\u5bfc\u9009\u9879\u4ee5\u53ca\u5c11\u90e8\u5206\u4e0e\u8bbe\u5907\u6709\u5173\u7684\u5f15\u5bfc\u9009\u9879\uff0c\u8fc7\u65f6\u7684\u9009\u9879\u3001\u975ex86\u5e73\u53f0\u9009\u9879\u3001\u4e0e\u8bbe\u5907\u6709\u5173\u7684\u9009\u9879\uff0c\u57fa\u672c\u4e0a\u90fd\u88ab\u5ffd\u7565\u4e86\u3002</p> <p>[\u63d0\u793a]\u5185\u6838\u6e90\u7801\u6811\u4e0b\u7684 Documentation/admin-guide/kernel-parameters.txt \u548c Documentation/x86/x86_64/boot-options.rst \u6587\u4ef6\u5217\u51fa\u4e86\u6240\u6709\u53ef\u7528\u7684\u5f15\u5bfc\u9009\u9879\uff0c\u5e76\u4f5c\u4e86\u7b80\u8981\u8bf4\u660e\u3002</p> <p>\u7531\u4e8e\u5f15\u5bfc\u9009\u9879\u591a\u5982\u725b\u6bdb\uff0c\u672c\u6587\u4e0d\u53ef\u80fd\u6d89\u53ca\u5168\u90e8\uff0c\u56e0\u6b64\u672c\u6587\u53ea\u57fa\u4e8e X86_64 \u5e73\u53f0\u4ee5\u53ca Linux-3.13.2 \u7cbe\u9009\u4e86\u4e00\u4e9b\u4e0e\u8bbe\u5907\u65e0\u5173\u7684\u5f15\u5bfc\u9009\u9879\u4ee5\u53ca\u5c11\u90e8\u5206\u4e0e\u8bbe\u5907\u6709\u5173\u7684\u5f15\u5bfc\u9009\u9879\uff0c\u8fc7\u65f6\u7684\u9009\u9879\u3001\u975ex86\u5e73\u53f0\u9009\u9879\u3001\u4e0e\u8bbe\u5907\u6709\u5173\u7684\u9009\u9879\uff0c\u57fa\u672c\u4e0a\u90fd\u88ab\u5ffd\u7565\u4e86\u3002</p> <p>[\u63d0\u793a]\u5185\u6838\u6e90\u7801\u6811\u4e0b\u7684 Documentation/admin-guide/kernel-parameters.txt \u548c Documentation/x86/x86_64/boot-options.rst \u6587\u4ef6\u5217\u51fa\u4e86\u6240\u6709\u53ef\u7528\u7684\u5f15\u5bfc\u9009\u9879\uff0c\u5e76\u4f5c\u4e86\u7b80\u8981\u8bf4\u660e\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#41","title":"4.1 \u6807\u8bb0\u8bf4\u660e","text":"<p>\u5e76\u4e0d\u662f\u6240\u6709\u7684\u9009\u9879\u90fd\u662f\u6c38\u8fdc\u53ef\u7528\u7684\uff0c\u53ea\u6709\u5728\u7279\u5b9a\u7684\u6a21\u5757\u5b58\u5728\u5e76\u4e14\u76f8\u5e94\u7684\u786c\u4ef6\u4e5f\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\u624d\u53ef\u7528\u3002\u5f15\u5bfc\u9009\u9879\u4e0a\u9762\u7684\u65b9\u62ec\u53f7\u8bf4\u660e\u4e86\u5176\u4f9d\u8d56\u5173\u7cfb\uff0c\u5176\u4e2d\u4f7f\u7528\u7684\u6807\u8bb0\u89e3\u91ca\u5982\u4e0b\uff1a</p> <pre><code>ACPI     \u5f00\u542f\u4e86\u9ad8\u7ea7\u914d\u7f6e\u4e0e\u7535\u6e90\u63a5\u53e3(CONFIG_ACPI)\u652f\u6301\nAGP      \u5f00\u542f\u4e86AGP(CONFIG_AGP)\u652f\u6301\nAPIC     \u5f00\u542f\u4e86\u9ad8\u7ea7\u53ef\u7f16\u7a0b\u4e2d\u65ad\u63a7\u5236\u5668\u652f\u6301(2000\u5e74\u4ee5\u540e\u7684CPU\u90fd\u652f\u6301)\nAPPARMOR \u5f00\u542f\u4e86AppArmor(CONFIG_SECURITY_APPARMOR)\u652f\u6301\nDRM      \u5f00\u542f\u4e86Direct Rendering Manager(CONFIG_DRM)\u652f\u6301\nEFI      \u5f00\u542f\u4e86EFI\u5206\u533a(CONFIG_EFI_PARTITION)\u652f\u6301\nEVM      \u5f00\u542f\u4e86Extended Verification Module(CONFIG_EVM)\u652f\u6301\nFB       \u5f00\u542f\u4e86\u5e27\u7f13\u51b2\u8bbe\u5907(CONFIG_FB)\u652f\u6301\nHIBERNATION  \u5f00\u542f\u4e86\"\u4f11\u7720\u5230\u786c\u76d8\"(CONFIG_HIBERNATION)\u652f\u6301\nHPET_MMAP    \u5141\u8bb8\u5bf9HPET\u5bc4\u5b58\u5668\u8fdb\u884c\u6620\u5c04(CONFIG_HPET_MMAP)\nHW       \u5b58\u5728\u76f8\u5e94\u7684\u786c\u4ef6\u8bbe\u5907\nIOMMU    \u5f00\u542f\u4e86IOMMU(CONFIG_IOMMU_SUPPORT)\u652f\u6301\nIOSCHED  \u5f00\u542f\u4e86\u591a\u4e2a\u4e0d\u540c\u7684I/O\u8c03\u5ea6\u7a0b\u5e8f(CONFIG_IOSCHED_*)\nIPV6     \u5f00\u542f\u4e86IPv6(CONFIG_IPV6)\u652f\u6301\nIP_PNP   \u5f00\u542f\u4e86\u81ea\u52a8\u83b7\u53d6IP\u7684\u534f\u8bae(DHCP,BOOTP,RARP)\u652f\u6301\nIP_VS_FTP    \u5f00\u542f\u4e86IPVS FTP\u534f\u8bae\u8fde\u63a5\u8ffd\u8e2a(CONFIG_IP_VS_FTP)\u652f\u6301\nKVM      \u5f00\u542f\u4e86KVM(CONFIG_KVM_*)\u652f\u6301\nLIBATA   \u5f00\u542f\u4e86libata(CONFIG_ATA)\u9a71\u52a8\u652f\u6301\nLOOP     \u5f00\u542f\u4e86\u56de\u73af\u8bbe\u5907(CONFIG_BLK_DEV_LOOP)\u652f\u6301\nMCE      \u5f00\u542f\u4e86Machine Check Exception(CONFIG_X86_MCE)\u652f\u6301\nMOUSE    \u5f00\u542f\u4e86\u9f20\u6807(CONFIG_INPUT_MOUSEDEV)\u652f\u6301\nMSI      \u5f00\u542f\u4e86PCI MSI(CONFIG_PCI_MSI)\u652f\u6301\nNET      \u5f00\u542f\u4e86\u7f51\u7edc\u652f\u6301\nNETFILTER    \u5f00\u542f\u4e86Netfilter(CONFIG_NETFILTER)\u652f\u6301\nNFS      \u5f00\u542f\u4e86NFS(\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf)\u652f\u6301\nNUMA     \u5f00\u542f\u4e86NUMA(CONFIG_NUMA)\u652f\u6301\nPCI      \u5f00\u542f\u4e86PCI\u603b\u7ebf(CONFIG_PCI)\u652f\u6301\nPCIE     \u5f00\u542f\u4e86PCI-Express(CONFIG_PCIEPORTBUS)\u652f\u6301\nPNP      \u5f00\u542f\u4e86\u5373\u63d2\u5373\u7528(CONFIG_PNP)\u652f\u6301\nPV_OPS   \u5185\u6838\u672c\u8eab\u662f\u534a\u865a\u62df\u5316\u7684(paravirtualized)\nRAID     \u5f00\u542f\u4e86\u8f6fRAID(CONFIG_BLK_DEV_MD)\u652f\u6301\nSECURITY \u5f00\u542f\u4e86\u591a\u4e2a\u4e0d\u540c\u7684\u5b89\u5168\u6a21\u578b(CONFIG_SECURITY)\nSELINUX  \u5f00\u542f\u4e86SELinux(CONFIG_SECURITY_SELINUX)\u652f\u6301\nSLUB     \u5f00\u542f\u4e86SLUB\u5185\u5b58\u5206\u914d\u7ba1\u7406\u5668(CONFIG_SLUB)\nSMP      \u5f00\u542f\u4e86\u5bf9\u79f0\u591a\u5904\u7406\u5668(CONFIG_SMP)\u652f\u6301\nTPM      \u5f00\u542f\u4e86\u53ef\u4fe1\u8d56\u5e73\u53f0\u6a21\u5757(CONFIG_TCG_TPM)\u652f\u6301\nUMS      \u5f00\u542f\u4e86USB\u5927\u5bb9\u91cf\u5b58\u50a8\u8bbe\u5907(CONFIG_USB_STORAGE)\u652f\u6301\nUSB      \u5f00\u542f\u4e86USB(CONFIG_USB_SUPPORT)\u652f\u6301\nUSBHID   \u5f00\u542f\u4e86USB HID(CONFIG_USB_HID)\u652f\u6301\nVMMIO    \u5f00\u542f\u4e86\u4f7f\u7528\u5185\u5b58\u6620\u5c04\u673a\u5236\u7684virtio\u8bbe\u5907\u9a71\u52a8(CONFIG_VIRTIO_MMIO)\nVT       \u5f00\u542f\u4e86\u865a\u62df\u7ec8\u7aef(CONFIG_VT)\u652f\u6301\n</code></pre> <p>\u6b64\u5916\uff0c\u4e0b\u9762\u7684\u6807\u8bb0\u5728\u542b\u4e49\u4e0a\u4e0e\u4e0a\u9762\u7684\u6709\u6240\u4e0d\u540c\uff1a</p> <pre><code>BUGS    \u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u7279\u5b9a\u786c\u4ef6\u7684\u7f3a\u9677\nKNL     \u662f\u4e00\u4e2a\u5185\u6838\u542f\u52a8\u9009\u9879\nBOOT    \u662f\u4e00\u4e2a\u5f15\u5bfc\u7a0b\u5e8f\u9009\u9879\n</code></pre> <p>\u6807\u8bb0\u4e3a\"BOOT\"\u7684\u9009\u9879\u5b9e\u9645\u4e0a\u7531\u5f15\u5bfc\u7a0b\u5e8f(\u4f8b\u5982GRUB)\u4f7f\u7528\uff0c\u5bf9\u5185\u6838\u672c\u8eab\u6ca1\u6709\u76f4\u63a5\u7684\u610f\u4e49\u3002\u5982\u679c\u6ca1\u6709\u7279\u522b\u7684\u9700\u6c42\uff0c\u8bf7\u4e0d\u8981\u4fee\u6539\u6b64\u7c7b\u9009\u9879\u7684\u8bed\u6cd5\uff0c\u66f4\u591a\u4fe1\u606f\u8bf7\u9605\u8bfb Documentation/x86/boot.txt \u6587\u6863\u3002</p> <p>\u8bf4\u660e\uff1a\u4e0b\u6587\u4e2d\u7684 [KMG] \u540e\u7f00\u8868\u793a 210, 220, 230 \u7684\u542b\u4e49\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#42","title":"4.2 \u63a7\u5236\u53f0\u4e0e\u7ec8\u7aef","text":"<ul> <li>[KNL]   console=\u8bbe\u5907\u53ca\u9009\u9879</li> </ul> <p>\u8bbe\u7f6e\u8f93\u51fa\u63a7\u5236\u53f0\u4f7f\u7528\u7684\u8bbe\u5907\u53ca\u9009\u9879\u3002\u4f8b\u5982\uff1attyN \u8868\u793a\u4f7f\u7528\u7b2cN\u4e2a\u865a\u62df\u63a7\u5236\u53f0\u3002\u5176\u5b83\u7528\u6cd5\u4e3b\u8981\u9488\u5bf9\u5d4c\u5165\u5f0f\u73af\u5883(Documentation/serial-console.txt)\u3002</p> <ul> <li>[KNL]   consoleblank=\u79d2\u6570</li> </ul> <p>\u63a7\u5236\u53f0\u591a\u957f\u65f6\u95f4\u65e0\u64cd\u4f5c\u540e\u9ed1\u5c4f\uff0c\u9ed8\u8ba4\u503c\u662f600\u79d2\uff0c\u8bbe\u4e3a0\u8868\u793a\u7981\u6b62\u9ed1\u5c4f\u3002</p> <ul> <li>[HW]   no_console_suspend</li> </ul> <p>\u6c38\u8fdc\u4e5f\u4e0d\u8981\u5c06\u63a7\u5236\u53f0\u8fdb\u5165\u4f11\u7720\u72b6\u6001\u3002\u56e0\u4e3a\u5f53\u63a7\u5236\u53f0\u8fdb\u5165\u4f11\u7720\u4e4b\u540e\uff0c\u6240\u6709\u5185\u6838\u7684\u6d88\u606f\u5c31\u90fd\u770b\u4e0d\u89c1\u4e86(\u5305\u62ec\u4e32\u53e3\u4e0eVGA)\u3002\u5f00\u542f\u6b64\u9009\u9879\u6709\u52a9\u4e8e\u8c03\u8bd5\u7cfb\u7edf\u5728\u4f11\u7720/\u5524\u9192\u4e2d\u53d1\u751f\u7684\u6545\u969c\u3002</p> <ul> <li>[VT]   vt.default_utf8={0|1}</li> </ul> <p>\u662f\u5426\u5c06\u6240\u6709TTY\u90fd\u9ed8\u8ba4\u8bbe\u7f6e\u4e3aUTF-8\u6a21\u5f0f\u3002\u9ed8\u8ba4\u503c\"1\"\u8868\u793a\u5c06\u6240\u6709\u65b0\u6253\u5f00\u7684\u7ec8\u7aef\u90fd\u8bbe\u7f6e\u4e3aUTF-8\u6a21\u5f0f\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#43","title":"4.3 \u65e5\u5fd7\u4e0e\u8c03\u8bd5","text":"<ul> <li>earlyprintk=\u8bbe\u5907[,keep]</li> </ul> <p>\u4f7f\u7528\u54ea\u4e2a\u8bbe\u5907\u663e\u793a\u65e9\u671f\u7684\u5f15\u5bfc\u4fe1\u606f\uff0c\u4e3b\u8981\u7528\u4e8e\u8c03\u8bd5\u786c\u4ef6\u6545\u969c\u3002\u6b64\u9009\u9879\u9ed8\u8ba4\u5e76\u672a\u5f00\u542f\uff0c\u56e0\u4e3a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u5e76\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002 \u5728\u4f20\u7edf\u7684\u63a7\u5236\u53f0\u521d\u59cb\u5316\u4e4b\u524d\uff0c\u5728\u54ea\u4e2a\u8bbe\u5907\u4e0a\u663e\u793a\u5185\u6838\u65e5\u5fd7\u4fe1\u606f\u3002\u4e0d\u4f7f\u7528\u6b64\u9009\u9879\uff0c\u90a3\u4e48\u4f60\u5c06\u6c38\u8fdc\u6ca1\u673a\u4f1a\u770b\u89c1\u8fd9\u4e9b\u4fe1\u606f\u3002 \u5728\u5c3e\u90e8\u52a0\u4e0a\",keep\"\u9009\u9879\u8868\u793a\u5728\u771f\u6b63\u7684\u5185\u6838\u63a7\u5236\u53f0\u521d\u59cb\u5316\u5e76\u63a5\u7ba1\u7cfb\u7edf\u540e\uff0c\u4e0d\u4f1a\u62b9\u6389\u672c\u9009\u9879\u6d88\u606f\u7684\u663e\u793a\u3002 earlyprintk=vga \u8868\u793a\u5728VGA\u4e0a\u663e\u793a\u5185\u6838\u65e5\u5fd7\u4fe1\u606f\uff0c\u8fd9\u662f\u6700\u5e38\u7528\u7684\u9009\u9879\uff0c\u4f46\u4e0d\u80fd\u7528\u4e8eEFI\u73af\u5883\u3002 earlyprintk=efi v3.13\u65b0\u589e\uff0c\u8868\u793a\u5c06\u9519\u8bef\u65e5\u5fd7\u5199\u5165EFI framebuffer\uff0c\u4e13\u7528\u4e8eEFI\u73af\u5883\u3002 earlyprintk=xen \u4ec5\u53ef\u7528\u4e8eXEN\u7684\u534a\u865a\u62df\u5316\u5ba2\u6237\u673a\u3002</p> <ul> <li>loglevel={0|1|2|3|4|5|6|7}</li> </ul> <p>\u8bbe\u7f6e\u5185\u6838\u65e5\u5fd7\u7684\u7ea7\u522b\uff0c\u6240\u6709\u5c0f\u4e8e\u8be5\u6570\u5b57\u7684\u5185\u6838\u4fe1\u606f(\u5177\u6709\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u4fe1\u606f)\u90fd\u5c06\u5728\u63a7\u5236\u53f0\u4e0a\u663e\u793a\u51fa\u6765\u3002\u8fd9\u4e2a\u7ea7\u522b\u53ef\u4ee5\u4f7f\u7528 klogd \u7a0b\u5e8f\u6216\u8005\u4fee\u6539 /proc/sys/kernel/printk \u6587\u4ef6\u8fdb\u884c\u8c03\u6574\u3002\u53d6\u503c\u8303\u56f4\u662f\"0\"(\u4e0d\u663e\u793a\u4efb\u4f55\u4fe1\u606f)\u5230\"7\"(\u663e\u793a\u6240\u6709\u7ea7\u522b\u7684\u4fe1\u606f)\u3002\u5efa\u8bae\u81f3\u5c11\u8bbe\u4e3a\"4\"(WARNING)\u3002[\u63d0\u793a]\u7ea7\u522b\"7\"\u8981\u6c42\u7f16\u8bd1\u65f6\u52a0\u5165\u4e86\u8c03\u8bd5\u652f\u6301\u3002</p> <ul> <li>[KNL]   ignore_loglevel</li> </ul> <p>\u5ffd\u7565\u5185\u6838\u65e5\u5fd7\u7b49\u7ea7\u7684\u8bbe\u7f6e\uff0c\u5411\u63a7\u5236\u53f0\u8f93\u51fa\u6240\u6709\u5185\u6838\u6d88\u606f\u3002\u4ec5\u7528\u4e8e\u8c03\u8bd5\u76ee\u7684\u3002</p> <ul> <li>[KNL]   debug</li> </ul> <p>\u5c06\u5f15\u5bfc\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709\u8c03\u8bd5\u4fe1\u606f\u90fd\u663e\u793a\u5728\u63a7\u5236\u53f0\u4e0a\u3002\u76f8\u5f53\u4e8e\u8bbe\u7f6e\"loglevel=7\"(DEBUG)\u3002</p> <ul> <li>[KNL]   quiet</li> </ul> <p>\u9759\u9ed8\u6a21\u5f0f\u3002\u76f8\u5f53\u4e8e\u8bbe\u7f6e\"loglevel=4\"(WARNING)\u3002</p> <ul> <li>log_buf_len=n[KMG]</li> </ul> <p>\u5185\u6838\u65e5\u5fd7\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002\"n\"\u5fc5\u987b\u662f2\u7684\u6574\u6570\u500d(\u5426\u5219\u4f1a\u88ab\u81ea\u52a8\u4e0a\u8c03\u5230\u6700\u63a5\u8fd1\u76842\u7684\u6574\u6570\u500d)\u3002\u8be5\u503c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5185\u6838\u914d\u7f6e\u9009\u9879CONFIG_LOG_BUF_SHIFT\u6765\u8bbe\u7f6e\u3002</p> <ul> <li>[KNL]   initcall_debug</li> </ul> <p>\u8ddf\u8e2a\u6240\u6709\u5185\u6838\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u8c03\u7528\u7684\u51fd\u6570\u3002\u6709\u52a9\u4e8e\u8bca\u65ad\u5185\u6838\u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\u6b7b\u5728\u4e86\u90a3\u4e2a\u51fd\u6570\u4e0a\u9762\u3002</p> <ul> <li>kstack=N</li> </ul> <p>\u5728\u5185\u6838\u5f02\u5e38(oops)\u65f6\uff0c\u5e94\u8be5\u6253\u5370\u51fa\u5185\u6838\u6808\u4e2d\u591a\u5c11\u4e2a\u5b57(word)\u5230\u5f02\u5e38\u8f6c\u50a8\u4e2d\u3002\u4ec5\u4f9b\u8c03\u8bd5\u4f7f\u7528\u3002</p> <ul> <li>[KNL]   kmemleak={on|off}</li> </ul> <p>\u662f\u5426\u5f00\u542f\u68c0\u6d4b\u5185\u6838\u5185\u5b58\u6cc4\u6f0f\u7684\u529f\u80fd(CONFIG_DEBUG_KMEMLEAK)\uff0c\u9ed8\u8ba4\u4e3a\"on\"\uff0c\u4ec5\u4f9b\u8c03\u8bd5\u4f7f\u7528\u3002 \u68c0\u6d4b\u65b9\u6cd5\u7c7b\u4f3c\u4e8e\u8ddf\u8e2a\u5185\u5b58\u6536\u96c6\u5668\uff0c\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\u6bcf10\u5206\u949f(\u9ed8\u8ba4\u503c)\u626b\u63cf\u5185\u5b58\uff0c\u5e76\u6253\u5370\u53d1\u73b0\u65b0\u7684\u672a\u5f15\u7528\u7684\u5bf9\u8c61\u7684\u6570\u91cf\u3002</p> <ul> <li>[KNL]   memtest=\u6574\u6570</li> </ul> <p>\u8bbe\u7f6e\u5185\u5b58\u6d4b\u8bd5(CONFIG_MEMTEST)\u7684\u8f6e\u6570\u3002\"0\"\u8868\u793a\u7981\u6b62\u6d4b\u8bd5\u3002\u4ec5\u5728\u4f60\u786e\u5b9e\u77e5\u9053\u8fd9\u662f\u4ec0\u4e48\u4e1c\u897f\u5e76\u4e14\u786e\u5b9e\u9700\u8981\u7684\u65f6\u5019\u518d\u5f00\u542f\u3002</p> <ul> <li>norandmaps</li> </ul> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5185\u6838\u4f1a\u968f\u673a\u5316\u7a0b\u5e8f\u7684\u542f\u52a8\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e00\u6b21\u5206\u914d\u7ed9\u7a0b\u5e8f\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u90fd\u4e0d\u4e00\u6837\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u9632\u6b62\u7f13\u51b2\u533a\u6ea2\u51fa\u653b\u51fb\u3002\u4f46\u662f\u8fd9\u4e5f\u7ed9\u7a0b\u5e8f\u8c03\u8bd5\u589e\u52a0\u4e86\u9ebb\u70e6\uff0c\u6b64\u9009\u9879(\u76f8\u5f53\u4e8e\"echo 0 &gt; /proc/sys/kernel/randomize_va_space\")\u7684\u76ee\u7684\u5c31\u662f\u7981\u7528\u8be5\u529f\u80fd\u4ee5\u65b9\u4fbf\u8c03\u8bd5\u3002</p> <ul> <li>[PNP]   pnp.debug=1</li> </ul> <p>\u5f00\u542fPNP\u8c03\u8bd5\u4fe1\u606f(\u9700\u8981\u5185\u6838\u5df2\u5f00\u542fCONFIG_PNP_DEBUG_MESSAGES\u9009\u9879)\uff0c\u4ec5\u7528\u4e8e\u8c03\u8bd5\u76ee\u7684\u3002\u4e5f\u53ef\u5728\u8fd0\u884c\u65f6\u901a\u8fc7 /sys/module/pnp/parameters/debug \u6765\u63a7\u5236\u3002</p> <ul> <li>show_msr=CPU\u6570</li> </ul> <p>\u663e\u793a\u542f\u52a8\u65f6\u7531BIOS\u521d\u59cb\u5316\u7684MSR(Model-Specific Register)\u5bc4\u5b58\u5668\u8bbe\u7f6e\u3002CPU\u6570\u8bbe\u4e3a\"1\"\u8868\u793a\u4ec5\u663e\u793a\"boot CPU\"\u7684\u8bbe\u7f6e\u3002</p> <ul> <li>printk.time={0|1}</li> </ul> <p>\u662f\u5426\u5728\u6bcf\u4e00\u884cprintk\u8f93\u51fa\u524d\u90fd\u52a0\u4e0a\u65f6\u95f4\u6233\uff0c\u4ec5\u4f9b\u8c03\u8bd5\u4f7f\u7528\u3002\u9ed8\u8ba4\u503c\u662f\"0\"(\u4e0d\u6dfb\u52a0)</p> <ul> <li>boot_delay=\u6beb\u79d2\u6570</li> </ul> <p>\u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u4e3a\u6bcf\u4e00\u4e2aprintk\u52a8\u4f5c\u5ef6\u8fdf\u6307\u5b9a\u7684\u6beb\u79d2\u6570\uff0c\u53d6\u503c\u8303\u56f4\u662f0-10000\uff0c\u8d85\u51fa\u8fd9\u4e2a\u8303\u56f4\u5c06\u7b49\u4ef7\u4e8e\"0\"(\u65e0\u5ef6\u8fdf)\u3002\u4ec5\u7528\u4e8e\u8c03\u8bd5\u76ee\u7684\u3002</p> <ul> <li>pause_on_oops=\u79d2\u6570</li> </ul> <p>\u5f53\u5185\u6838\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u6302\u8d77\u6240\u6709CPU\u7684\u65f6\u95f4\u3002\u5f53\u5f02\u5e38\u4fe1\u606f\u592a\u591a\uff0c\u5c4f\u5e55\u6301\u7eed\u6eda\u52a8\u65f6\uff0c\u8fd9\u4e2a\u9009\u9879\u5c31\u5f88\u6709\u7528\u5904\u4e86\u3002\u4e3b\u8981\u7528\u4e8e\u8c03\u8bd5\u76ee\u7684\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#44","title":"4.4 \u5f02\u5e38\u68c0\u6d4b\u4e0e\u5904\u7406","text":"<ul> <li>[MCE] mce=off</li> </ul> <p>\u5f7b\u5e95\u7981\u7528MCE(CONFIG_X86_MCE)</p> <ul> <li>[MCE] mce=dont_log_ce</li> </ul> <p>\u4e0d\u4e3a\u5df2\u7ea0\u6b63\u9519\u8bef(corrected error)\u8bb0\u5f55\u65e5\u5fd7\u3002</p> <ul> <li>[MCE] mce=\u5bb9\u9519\u7ea7\u522b[,\u8d85\u65f6]</li> </ul> <p>\u5bb9\u9519\u7ea7\u522b(\u8fd8\u53ef\u901a\u8fc7sysfs\u8bbe\u7f6e)\uff1a 0 \u5728\u51fa\u73b0\u672a\u80fd\u7ea0\u6b63\u7684\u9519\u8bef\u65f6panic\uff0c\u8bb0\u5f55\u6240\u6709\u5df2\u7ea0\u6b63\u7684\u9519\u8bef 1(\u9ed8\u8ba4\u503c) \u5728\u51fa\u73b0\u672a\u80fd\u7ea0\u6b63\u7684\u9519\u8bef\u65f6panic\u6216SIGBUS\uff0c\u8bb0\u5f55\u6240\u6709\u5df2\u7ea0\u6b63\u7684\u9519\u8bef 2 \u5728\u51fa\u73b0\u672a\u80fd\u7ea0\u6b63\u7684\u9519\u8bef\u65f6SIGBUS\u6216\u8bb0\u5f55\u65e5\u5fd7\uff0c\u8bb0\u5f55\u6240\u6709\u5df2\u7ea0\u6b63\u7684\u9519\u8bef 3 \u4ece\u4e0dpanic\u6216SIGBUS\uff0c\u8bb0\u5f55\u6240\u6709\u65e5\u5fd7\u3002\u4ec5\u7528\u4e8e\u8c03\u8bd5\u76ee\u7684\u3002 \u8d85\u65f6(\u5355\u4f4d\u662f\u5fae\u79d2[\u767e\u4e07\u5206\u4e4b\u4e00\u79d2])\uff1a\u5728machine check\u65f6\u7b49\u5f85\u5176\u5b83CPU\u7684\u65f6\u957f\uff0c\"0\"\u8868\u793a\u4e0d\u7b49\u5f85\u3002</p> <ul> <li>[ACPI] erst_disable</li> </ul> <p>\u7981\u7528ERST(Error Record Serialization Table)\u652f\u6301\u3002\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684BIOS\u5bfc\u81f4\u7684ERST\u6545\u969c\u3002</p> <ul> <li>[ACPI] hest_disable</li> </ul> <p>\u7981\u7528HEST(Hardware Error Source Table)\u652f\u6301\u3002\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684BIOS\u5bfc\u81f4\u7684HEST\u6545\u969c\u3002</p> <ul> <li>[KNL] nosoftlockup</li> </ul> <p>\u7981\u6b62\u5185\u6838\u8fdb\u884c\u8f6f\u6b7b\u9501\u68c0\u6d4b</p> <ul> <li>[KNL] softlockup_panic={0|1}</li> </ul> <p>\u662f\u5426\u5728\u68c0\u6d4b\u5230\u8f6f\u6b7b\u9501(soft-lockup)\u7684\u65f6\u5019\u8ba9\u5185\u6838panic\uff0c\u5176\u9ed8\u8ba4\u503c\u7531 CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC_VALUE \u786e\u5b9a</p> <ul> <li>[KNL] nowatchdog</li> </ul> <p>\u7981\u6b62\u786c\u6b7b\u9501\u68c0\u6d4b(NMI watchdog)</p> <ul> <li>[KNL,BUGS] nmi_watchdog={0|panic|nopanic}</li> </ul> <p>\u914d\u7f6enmi_watchdog(\u4e0d\u53ef\u5c4f\u853d\u4e2d\u65ad\u770b\u95e8\u72d7)\u3002\u66f4\u591a\u4fe1\u606f\u53ef\u67e5\u770b\"lockup-watchdogs.txt\"\u6587\u6863\u3002 0 \u8868\u793a\u5173\u95ed\u770b\u95e8\u72d7\uff1b panic \u8868\u793a\u51fa\u73b0\u770b\u95e8\u72d7\u8d85\u65f6(\u957f\u65f6\u95f4\u6ca1\u5582\u72d7)\u7684\u65f6\u5019\u89e6\u53d1\u5185\u6838\u9519\u8bef\uff0c\u901a\u5e38\u548c\"panic=\"\u914d\u5408\u4f7f\u7528\uff0c\u4ee5\u5b9e\u73b0\u5728\u7cfb\u7edf\u51fa\u73b0\u9501\u6b7b\u7684\u65f6\u5019\u81ea\u52a8\u91cd\u542f\u3002 nopanic \u6b63\u597d\u76f8\u53cd\uff0c\u8868\u793a\u5373\u4f7f\u51fa\u73b0\u770b\u95e8\u72d7\u8d85\u65f6(\u957f\u65f6\u95f4\u6ca1\u5582\u72d7)\uff0c\u4e5f\u4e0d\u89e6\u53d1\u5185\u6838\u9519\u8bef\u3002</p> <ul> <li>unknown_nmi_panic</li> </ul> <p>\u5728\u6536\u5230\u672a\u77e5\u7684NMI(\u4e0d\u53ef\u5c4f\u853d\u4e2d\u65ad)\u65f6\u76f4\u63a5panic</p> <ul> <li>oops=panic</li> </ul> <p>\u5728\u5185\u6838oops\u65f6\u76f4\u63a5panic(\u800c\u9ed8\u8ba4\u662f\u4ec5\u4ec5\u6740\u6b7boops\u8fdb\u7a0b[\u8fd9\u6837\u505a\u4f1a\u6709\u5f88\u5c0f\u7684\u6982\u7387\u5bfc\u81f4\u6b7b\u9501])\uff0c\u800c\u4e14\u8fd9\u540c\u6837\u4e5f\u4f1a\u5bfc\u81f4\u5728\u53d1\u751fMCE(CONFIG_X86_MCE)\u65f6\u76f4\u63a5panic\u3002\u4e3b\u8981\u76ee\u7684\u662f\u548c\"panic=\"\u9009\u9879\u8fde\u7528\u4ee5\u5b9e\u73b0\u81ea\u52a8\u91cd\u542f\u3002</p> <ul> <li>[KNL] panic=\u79d2\u6570</li> </ul> <p>\u5185\u6838\u5728\u9047\u5230panic\u65f6\u7b49\u5f85\u91cd\u542f\u7684\u884c\u4e3a\uff1a</p> <p>\u79d2\u6570&gt;0 \u7b49\u5f85\u6307\u5b9a\u7684\u79d2\u6570\u540e\u91cd\u542f </p> <p>\u79d2\u6570=0(\u9ed8\u8ba4\u503c) \u53ea\u662f\u7b80\u5355\u7684\u6302\u8d77\uff0c\u800c\u6c38\u4e0d\u91cd\u542f </p> <p>\u79d2\u6570&lt;0 \u7acb\u5373\u91cd\u542f</p> <p>## 4.5 \u65f6\u949f(Timer)</p> <p>\u65f6\u949f(Timer)\u7684\u529f\u80fd\u6709\u4e24\u4e2a\uff1a(1)\u5b9a\u65f6\u89e6\u53d1\u4e2d\u65ad\uff1b(2)\u7ef4\u62a4\u548c\u8bfb\u53d6\u5f53\u524d\u65f6\u95f4\u3002x86_64\u5e73\u53f0\u5e38\u89c1\u7684\u65f6\u949f\u786c\u4ef6\u6709\u4ee5\u4e0b\u8fd9\u4e9b\uff1a   RTC(Real Time Clock) \u5b9e\u65f6\u65f6\u949f\u7684\u72ec\u7279\u4e4b\u5904\u5728\u4e8e\uff0cRTC\u662f\u4e3b\u677f\u4e0a\u4e00\u5757\u7535\u6c60\u4f9b\u7535\u7684CMOS\u82af\u7247(\u7cbe\u5ea6\u4e00\u822c\u53ea\u5230\u79d2\u7ea7)\uff0cRTC(Clock)\u5410\u51fa\u6765\u7684\u662f\"\u65f6\u523b\"(\u4f8b\u5982\"2014-2-22 23:38:44\")\uff0c\u800c\u5176\u4ed6\u786c\u4ef6\u65f6\u949f(Timer)\u5410\u51fa\u6765\u7684\u662f\"\u65f6\u957f\"(\u6211\u8d70\u8fc7\u4e86XX\u4e2a\u5468\u671f\uff0c\u6309\u7167\u6211\u7684\u9891\u7387\uff0c\u5e94\u8be5\u662f10\u79d2\u949f)\u3002   PIT(Programmable Interval Timer) PIT\u662f\u6700\u53e4\u8001\u7684\u65f6\u949f\u6e90\uff0c\u4ea7\u751f\u5468\u671f\u6027\u7684\u65f6\u949f\u4e2d\u65ad(IRQ0)\uff0c\u7cbe\u5ea6\u5728100-1000Hz\uff0c\u73b0\u5728\u57fa\u672c\u5df2\u7ecf\u88abHPET\u53d6\u4ee3\u3002   APIC Timer \u8fd9\u662fPIT\u9488\u5bf9\u591aCPU\u73af\u5883\u7684\u5347\u7ea7\uff0c\u6bcf\u4e2aCPU\u4e0a\u90fd\u6709\u4e00\u4e2aAPIC Timer(\u800cPIT\u5219\u662f\u6240\u6709CPU\u5171\u4eab\u7684)\uff0c\u4f46\u662f\u5b83\u7ecf\u5e38\u6709BUG\u4e14\u7cbe\u5ea6\u4e5f\u4e0d\u9ad8(3MHz\u5de6\u53f3)\uff0c\u6240\u5b9e\u9645\u5f88\u5c11\u4f7f\u7528\u3002   ACPI Timer(Power Management Timer) \u5b83\u552f\u4e00\u7684\u529f\u80fd\u5c31\u662f\u4e3a\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u63d0\u4f9b\u4e00\u4e2a\u65f6\u95f4\u6233\uff0c\u7528\u4e8e\u63d0\u4f9b\u4e0e\u5904\u7406\u5668\u901f\u5ea6\u65e0\u5173\u7684\u53ef\u9760\u65f6\u95f4\u6233\u3002\u4f46\u5176\u7cbe\u5ea6\u5e76\u4e0d\u9ad8(3.579545MHz)\u3002   HPET(High Precision Event Timer) HPET\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7684\u7cbe\u5ea6(14.31818MHz)\u4ee5\u53ca\u66f4\u5bbd\u7684\u8ba1\u6570\u5668(64\u4f4d)\u3002HPET\u53ef\u4ee5\u66ff\u4ee3\u524d\u8ff0\u9664RTC\u4e4b\u5916\u7684\u6240\u6709\u65f6\u949f\u786c\u4ef6(Timer)\uff0c\u56e0\u4e3a\u5b83\u65e2\u80fd\u5b9a\u65f6\u89e6\u53d1\u4e2d\u65ad\uff0c\u53c8\u80fd\u7ef4\u62a4\u548c\u8bfb\u53d6\u5f53\u524d\u65f6\u95f4\u3002\u4e00\u4e2aHPET\u5305\u542b\u4e86\u4e00\u4e2a\u56fa\u5b9a\u9891\u7387\u7684\u6570\u503c\u9012\u589e\u7684\u8ba1\u6570\u5668\u4ee5\u53ca3-32\u4e2a\u72ec\u7acb\u8ba1\u6570\u5668\uff0c\u6bcf\u4e2a\u8ba1\u6570\u5668\u53c8\u5305\u542b\u4e86\u4e00\u4e2a\u6bd4\u8f83\u5668\u548c\u4e00\u4e2a\u5bc4\u5b58\u5668\uff0c\u5f53\u4e24\u8005\u6570\u503c\u76f8\u7b49\u65f6\u5c31\u4f1a\u89e6\u53d1\u4e2d\u65ad\u3002HPET\u7684\u51fa\u73b0\u5c06\u5141\u8bb8\u5220\u9664\u82af\u7247\u7ec4\u4e2d\u7684\u4e00\u4e9b\u5197\u4f59\u7684\u65e7\u5f0f\u786c\u4ef6\u30022006\u5e74\u4e4b\u540e\u7684\u4e3b\u677f\u57fa\u672c\u90fd\u5df2\u652f\u6301HPET\u3002   TSC(Time Stamp Counter) TSC\u662f\u4f4d\u4e8eCPU\u91cc\u9762\u7684\u4e00\u4e2a64\u4f4d\u5bc4\u5b58\u5668\uff0c\u4e0e\u4f20\u7edf\u7684\u5468\u671f\u6027\u65f6\u949f\u4e0d\u540c\uff0cTSC\u5e76\u4e0d\u89e6\u53d1\u4e2d\u65ad\uff0c\u5b83\u662f\u4ee5\u8ba1\u6570\u5668\u5f62\u5f0f\u5b58\u5728\u7684\u5355\u6b65\u9012\u589e\u6027\u65f6\u949f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5468\u671f\u6027\u65f6\u949f\u662f\u901a\u8fc7\u5468\u671f\u6027\u89e6\u53d1\u4e2d\u65ad\u8fbe\u5230\u8ba1\u65f6\u76ee\u7684\uff0c\u5982\u5fc3\u8df3\u4e00\u822c\u3002\u800c\u5355\u6b65\u9012\u589e\u65f6\u949f\u5219\u4e0d\u53d1\u9001\u4e2d\u65ad\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u7531\u8f6f\u4ef6\u81ea\u5df1\u5728\u9700\u8981\u7684\u65f6\u5019\u53bb\u4e3b\u52a8\u8bfb\u53d6TSC\u5bc4\u5b58\u5668\u7684\u503c\u6765\u83b7\u5f97\u65f6\u95f4\u3002TSC\u7684\u7cbe\u5ea6(\u7eb3\u79d2\u7ea7)\u8fdc\u8d85HPET\u5e76\u4e14\u901f\u5ea6\u66f4\u5feb\uff0c\u4f46\u4ec5\u80fd\u5728\u8f83\u65b0\u7684CPU(Sandy Bridge\u4e4b\u540e)\u4e0a\u4f7f\u7528\u3002</p> <ul> <li>[HW,ACPI]   acpi_skip_timer_override</li> </ul> <p>\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684Nvidia nForce2 BIOS\u4e2d\u7684\u8ba1\u65f6\u5668\u8986\u76d6\u95ee\u9898(\u4f8b\u5982\u5f00\u542fACPI\u540e\u9891\u7e41\u6b7b\u673a\u6216\u65f6\u949f\u6545\u969c)\u3002</p> <ul> <li>[HW,ACPI]   acpi_use_timer_override</li> </ul> <p>\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684Nvidia nForce5 BIOS\u4e2d\u7684\u8ba1\u65f6\u5668\u8986\u76d6\u95ee\u9898(\u4f8b\u5982\u5f00\u542fACPI\u540e\u9891\u7e41\u6b7b\u673a\u6216\u65f6\u949f\u6545\u969c)\u3002</p> <ul> <li>[APIC]   no_timer_check</li> </ul> <p>\u7981\u6b62\u8fd0\u884c\u5185\u6838\u4e2d\u65f6\u949fIRQ\u6e90\u7f3a\u9677\u68c0\u6d4b\u4ee3\u7801\u3002\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9bAMD\u5e73\u53f0\u7684CPU\u5360\u7528\u8fc7\u9ad8\u4ee5\u53ca\u65f6\u949f\u8fc7\u5feb\u7684\u6545\u969c\u3002</p> <ul> <li>pmtmr=\u5341\u516d\u8fdb\u5236\u7aef\u53e3\u53f7</li> </ul> <p>\u624b\u52a8\u6307\u5b9apmtimer(CONFIG_X86_PM_TIMER)\u7684I/O\u7aef\u53e3(16\u8fdb\u5236\u503c)\uff0c\u4f8b\u5982\uff1apmtmr=0x508</p> <ul> <li>acpi_pm_good</li> </ul> <p>\u8df3\u8fc7pmtimer(CONFIG_X86_PM_TIMER)\u7684bug\u68c0\u6d4b\uff0c\u5f3a\u5236\u5185\u6838\u8ba4\u4e3a\u8fd9\u53f0\u673a\u5668\u7684pmtimer\u6ca1\u6709\u6bdb\u75c5\u3002\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684BIOS\u5bfc\u81f4\u7684\u6545\u969c\u3002</p> <ul> <li>[APIC]   apicpmtimer</li> </ul> <p>\u4f7f\u7528pmtimer(CONFIG_X86_PM_TIMER)\u6765\u6821\u51c6APIC timer\u3002\u6b64\u9009\u9879\u9690\u542b\u4e86\"apicmaintimer\"\u3002\u7528\u4e8ePIT timer\u5f7b\u5e95\u574f\u6389\u7684\u573a\u5408\u3002</p> <ul> <li>[APIC]   apicmaintimer   noapicmaintimer</li> </ul> <p>apicmaintimer \u5c06APIC timer\u7528\u4e8e\u8ba1\u65f6(\u800c\u4e0d\u662fPIT/HPET\u4e2d\u65ad)\u3002\u8fd9\u4e3b\u8981\u7528\u4e8ePIT/HPET\u4e2d\u65ad\u4e0d\u53ef\u9760\u7684\u573a\u5408\u3002 noapicmaintimer \u4e0d\u5c06APIC timer\u7528\u4e8e\u8ba1\u65f6(\u800c\u662f\u4f7f\u7528PIT/HPET\u4e2d\u65ad)\u3002\u8fd9\u662f\u9ed8\u8ba4\u503c\u3002\u4f46\u6709\u65f6\u5019\u4f9d\u7136\u9700\u8981\u660e\u786e\u6307\u5b9a\u3002</p> <ul> <li>[APIC]   lapic_timer_c2_ok</li> </ul> <p>\u6309\u7167ACPI\u89c4\u8303\u7684\u8981\u6c42\uff0clocal APIC Timer \u4e0d\u80fd\u5728C2\u4f11\u7720\u72b6\u6001\u4e0b\u5173\u95ed\uff0c\u4f46\u53ef\u4ee5\u5728C3\u4f11\u7720\u72b6\u6001\u4e0b\u5173\u95ed\u3002\u4f46\u67d0\u4e9bBIOS(\u4e3b\u8981\u662fAMD\u5e73\u53f0)\u4f1a\u5728\u5411\u64cd\u4f5c\u7cfb\u7edf\u62a5\u544aCPU\u8fdb\u5165C2\u4f11\u7720\u72b6\u6001\u65f6\uff0c\u5b9e\u9645\u8fdb\u5165C3\u4f11\u7720\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u5185\u6838\u9ed8\u8ba4\u91c7\u53d6\u4e86\u4fdd\u5b88\u7684\u5047\u5b9a\uff1a\u8ba4\u4e3a local APIC Timer \u5728C2/C3\u72b6\u6001\u65f6\u7686\u5904\u4e8e\u5173\u95ed\u72b6\u6001\u3002\u5982\u679c\u4f60\u786e\u5b9a\u4f60\u7684BIOS\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528\u6b64\u9009\u9879\u660e\u786e\u544a\u8bc9\u5185\u6838\uff0c\u5373\u4f7fCPU\u5728C2\u4f11\u7720\u72b6\u6001\uff0clocal APIC Timer \u4e5f\u4f9d\u7136\u53ef\u7528\u3002</p> <ul> <li>[APIC]   noapictimer</li> </ul> <p>\u7981\u7528CPU Local APIC Timer</p> <p>enable_timer_pin_1 disable_timer_pin_1</p> <p>\u5f00\u542f/\u5173\u95edAPIC\u5b9a\u65f6\u5668\u7684PIN1\uff0c\u5185\u6838\u5c06\u5c3d\u53ef\u80fd\u81ea\u52a8\u63a2\u6d4b\u6b63\u786e\u7684\u503c\u3002\u4f46\u6709\u65f6\u9700\u8981\u624b\u52a8\u6307\u5b9a\u4ee5\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684ATI\u82af\u7247\u7ec4\u6545\u969c\u3002</p> <ul> <li>clocksource={jiffies|acpi_pm|hpet|tsc}</li> </ul> <p>\u5f3a\u5236\u4f7f\u7528\u6307\u5b9a\u7684\u65f6\u949f\u6e90\uff0c\u4ee5\u4ee3\u66ff\u5185\u6838\u9ed8\u8ba4\u7684\u65f6\u949f\u6e90\u3002 jiffies \u6700\u5dee\u7684\u65f6\u949f\u6e90\uff0c\u53ea\u80fd\u4f5c\u4e3a\u6700\u540e\u7684\u9009\u62e9\u3002 acpi_pm [ACPI]\u7b26\u5408ACPI\u89c4\u8303\u7684\u4e3b\u677f\u90fd\u63d0\u4f9b\u7684\u786c\u4ef6\u65f6\u949f\u6e90(CONFIG_X86_PM_TIMER)\uff0c\u63d0\u4f9b3.579545MHz\u56fa\u5b9a\u9891\u7387\uff0c\u8fd9\u662f\u4f20\u7edf\u7684\u786c\u4ef6\u65f6\u949f\u53d1\u751f\u5668\u3002 hpet \u4e00\u79cd\u53d6\u4ee3\u4f20\u7edf\"acpi_pm\"\u7684\u9ad8\u7cbe\u5ea6\u786c\u4ef6\u65f6\u949f\u6e90(CONFIG_HPET)\uff0c\u63d0\u4f9b14.31818MHz\u56fa\u5b9a\u9891\u7387\u30022007\u5e74\u4ee5\u540e\u7684\u82af\u7247\u7ec4\u4e00\u822c\u90fd\u652f\u6301\u3002 tsc TSC(Time Stamp Counter)\u7684\u4e3b\u4f53\u662f\u4f4d\u4e8eCPU\u91cc\u9762\u7684\u4e00\u4e2a64\u4f4dTSC\u5bc4\u5b58\u5668\uff0c\u4e0e\u4f20\u7edf\u7684\u4ee5\u4e2d\u65ad\u5f62\u5f0f\u5b58\u5728\u7684\u5468\u671f\u6027\u65f6\u949f\u4e0d\u540c\uff0cTSC\u662f\u4ee5\u8ba1\u6570\u5668\u5f62\u5f0f\u5b58\u5728\u7684\u5355\u6b65\u9012\u589e\u6027\u65f6\u949f\uff0c\u4e24\u8005\u7684\u533a\u522b\u5728\u4e8e\uff0c\u5468\u671f\u6027\u65f6\u949f\u662f\u901a\u8fc7\u5468\u671f\u6027\u89e6\u53d1\u4e2d\u65ad\u8fbe\u5230\u8ba1\u65f6\u76ee\u7684\uff0c\u5982\u5fc3\u8df3\u4e00\u822c\u3002\u800c\u5355\u6b65\u9012\u589e\u65f6\u949f\u5219\u4e0d\u53d1\u9001\u4e2d\u65ad\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u7531\u8f6f\u4ef6\u81ea\u5df1\u5728\u9700\u8981\u7684\u65f6\u5019\u53bb\u4e3b\u52a8\u8bfb\u53d6TSC\u5bc4\u5b58\u5668\u7684\u503c\u6765\u83b7\u5f97\u65f6\u95f4\u3002TSC\u7684\u7cbe\u5ea6\u66f4\u9ad8\u5e76\u4e14\u901f\u5ea6\u66f4\u5feb\uff0c\u4f46\u4ec5\u80fd\u5728\u8f83\u65b0\u7684CPU(Sandy Bridge\u4e4b\u540e)\u4e0a\u4f7f\u7528\u3002</p> <ul> <li>[KNL]   highres={\"on\"|\"off\"}</li> </ul> <p>\u542f\u7528(\u9ed8\u8ba4\u503c)\u8fd8\u662f\u7981\u7528\u9ad8\u7cbe\u5ea6\u5b9a\u65f6\u5668\u6a21\u5f0f\u3002\u4e3b\u8981\u7528\u4e8e\u5173\u95ed\u4e3b\u677f\u4e0a\u6709\u6545\u969c\u7684\u9ad8\u7cbe\u5ea6\u65f6\u949f\u6e90\u3002</p> <ul> <li>nohpet</li> </ul> <p>\u7981\u7528HPET timer(CONFIG_HPET)</p> <ul> <li>[HPET_MMAP]   hpet_mmap</li> </ul> <p>v3.13\u65b0\u589e\uff0c\u9ed8\u8ba4\u5141\u8bb8\u5bf9HPET\u5bc4\u5b58\u5668\u8fdb\u884c\u6620\u5c04\uff0c\u76f8\u5f53\u4e8e\u5f00\u542f\u4e86\u5185\u6838CONFIG_HPET_MMAP_DEFAULT\u9009\u9879\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u67d0\u4e9b\u5305\u542bHPET\u786c\u4ef6\u5bc4\u5b58\u5668\u7684\u9875\u4e2d\u540c\u65f6\u8fd8\u542b\u6709\u5176\u4ed6\u4e0d\u8be5\u66b4\u9732\u7ed9\u7528\u6237\u7684\u4fe1\u606f\u3002</p> <ul> <li>notsc   tsc=reliable   tsc=noirqtime</li> </ul> <p>\u8bbe\u7f6eTSC\u65f6\u949f\u6e90\u7684\u5c5e\u6027\u3002 notsc \u8868\u793a\u4e0d\u5c06TSC\u7528\u4f5c\"wall time\"\u65f6\u949f\u6e90\uff0c\u4e3b\u8981\u7528\u4e8e\u4e0d\u80fd\u5728\u591a\u4e2aCPU\u4e4b\u95f4\u4fdd\u6301\u6b63\u786e\u540c\u6b65\u7684SMP\u7cfb\u7edf\u3002 tsc=reliable \u8868\u793aTSC\u65f6\u949f\u6e90\u662f\u7edd\u5bf9\u7a33\u5b9a\u7684\uff0c\u5173\u95ed\u542f\u52a8\u65f6\u548c\u8fd0\u884c\u65f6\u7684\u7a33\u5b9a\u6027\u68c0\u67e5\u3002\u7528\u4e8e\u5728\u67d0\u4e9b\u8001\u65e7\u786c\u4ef6/\u865a\u62df\u5316\u73af\u5883\u4f7f\u7528TSC\u65f6\u949f\u6e90\u3002 tsc=noirqtime \u4e0d\u5c06TSC\u7528\u4e8e\u7edf\u8ba1\u8fdb\u7a0bIRQ\u65f6\u95f4\u3002\u4e3b\u8981\u7528\u4e8e\u5728RDTSC\u901f\u5ea6\u8f83\u6162\u7684CPU\u4e0a\u7981\u6b62\u5185\u6838\u7684CONFIG_IRQ_TIME_ACCOUNTING\u529f\u80fd\u3002 \u5173\u4e8e\"TSC\u65f6\u949f\u6e90\"\uff0c\u8be6\u89c1\"clocksource=\"\u9009\u9879\u7684\u8bf4\u660e\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#46","title":"4.6 \u4e2d\u65ad","text":"<p>\u5e38\u89c1\u7684\u4e2d\u65ad\u63a7\u5236\u5668\u6709\u4e24\u79cd\uff1a\u4f20\u7edf\u76848259A\u548c\u65b0\u5f0f\u7684APIC\uff0c\u524d\u8005\u4e5f\u88ab\u79f0\u4e3a\"PIC\"\u30028259A\u53ea\u9002\u5408\u5355CPU\u7684\u573a\u5408\uff0c\u800cAPIC\u5219\u80fd\u591f\u628a\u4e2d\u65ad\u4f20\u9012\u7ed9\u7cfb\u7edf\u4e2d\u7684\u6bcf\u4e2aCPU\uff0c\u4ece\u800c\u5145\u5206\u6316\u6398SMP\u4f53\u7cfb\u7ed3\u6784\u7684\u5e76\u884c\u6027\u3002\u6240\u4ee58259A\u5df2\u7ecf\u88ab\u6dd8\u6c70\u4e86\u3002APIC\u7cfb\u7edf\u75313\u90e8\u5206\u7ec4\u6210\uff1aAPIC\u603b\u7ebf(\u524d\u7aef\u603b\u7ebf)\u3001IO-APIC(\u5357\u6865)\u3001\u672c\u5730APIC(CPU)\u3002\u6bcf\u4e2aCPU\u4e2d\u96c6\u6210\u4e86\u4e00\u4e2a\u672c\u5730APIC\uff0c\u8d1f\u8d23\u4f20\u9012\u4e2d\u65ad\u4fe1\u53f7\u5230\u5904\u7406\u5668\u3002\u800cIO-APIC\u662f\u7cfb\u7edf\u82af\u7247\u7ec4\u4e2d\u4e00\u90e8\u5206\uff0c\u8d1f\u8d23\u6536\u96c6\u6765\u81eaI/O\u8bbe\u5907\u7684\u4e2d\u65ad\u4fe1\u53f7\u5e76\u53d1\u9001\u5230\u672c\u5730APIC\u3002APIC\u603b\u7ebf\u5219\u662f\u8fde\u63a5IO-APIC\u548c\u5404\u4e2a\u672c\u5730APIC\u7684\u6865\u6881\u3002</p> <p>\u5e38\u89c1\u7684\u4e2d\u65ad\u63a7\u5236\u5668\u6709\u4e24\u79cd\uff1a\u4f20\u7edf\u76848259A\u548c\u65b0\u5f0f\u7684APIC\uff0c\u524d\u8005\u4e5f\u88ab\u79f0\u4e3a\"PIC\"\u30028259A\u53ea\u9002\u5408\u5355CPU\u7684\u573a\u5408\uff0c\u800cAPIC\u5219\u80fd\u591f\u628a\u4e2d\u65ad\u4f20\u9012\u7ed9\u7cfb\u7edf\u4e2d\u7684\u6bcf\u4e2aCPU\uff0c\u4ece\u800c\u5145\u5206\u6316\u6398SMP\u4f53\u7cfb\u7ed3\u6784\u7684\u5e76\u884c\u6027\u3002\u6240\u4ee58259A\u5df2\u7ecf\u88ab\u6dd8\u6c70\u4e86\u3002APIC\u7cfb\u7edf\u75313\u90e8\u5206\u7ec4\u6210\uff1aAPIC\u603b\u7ebf(\u524d\u7aef\u603b\u7ebf)\u3001IO-APIC(\u5357\u6865)\u3001\u672c\u5730APIC(CPU)\u3002\u6bcf\u4e2aCPU\u4e2d\u96c6\u6210\u4e86\u4e00\u4e2a\u672c\u5730APIC\uff0c\u8d1f\u8d23\u4f20\u9012\u4e2d\u65ad\u4fe1\u53f7\u5230\u5904\u7406\u5668\u3002\u800cIO-APIC\u662f\u7cfb\u7edf\u82af\u7247\u7ec4\u4e2d\u4e00\u90e8\u5206\uff0c\u8d1f\u8d23\u6536\u96c6\u6765\u81eaI/O\u8bbe\u5907\u7684\u4e2d\u65ad\u4fe1\u53f7\u5e76\u53d1\u9001\u5230\u672c\u5730APIC\u3002APIC\u603b\u7ebf\u5219\u662f\u8fde\u63a5IO-APIC\u548c\u5404\u4e2a\u672c\u5730APIC\u7684\u6865\u6881\u3002</p> <ul> <li>[SMP,APIC] noapic</li> </ul> <p>\u7981\u6b62\u4f7f\u7528IO-APIC(\u8f93\u5165\u8f93\u51fa\u9ad8\u7ea7\u53ef\u7f16\u7a0b\u8f93\u5165\u63a7\u5236\u5668)\uff0c\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684BIOS\u5bfc\u81f4\u7684APIC\u6545\u969c\u3002</p> <ul> <li>[APIC] nolapic disableapic</li> </ul> <p>\u7981\u6b62\u4f7f\u7528local APIC\u3002\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684BIOS\u5bfc\u81f4\u7684APIC\u6545\u969c\u3002\"nolapic\"\u662f\u4e3a\u4e86\u4fdd\u6301\u4f20\u7edf\u4e60\u60ef\u7684\u517c\u5bb9\u5199\u6cd5\uff0c\u4e0e\"disableapic\"\u7684\u542b\u4e49\u76f8\u540c\u3002</p> <ul> <li>[APIC] nox2apic</li> </ul> <p>\u5173\u95edx2APIC\u652f\u6301(CONFIG_X86_X2APIC)</p> <ul> <li>[APIC] x2apic_phys</li> </ul> <p>\u5728\u652f\u6301x2apic\u7684\u5e73\u53f0\u4e0a\u4f7f\u7528physical\u6a21\u5f0f\u4ee3\u66ff\u9ed8\u8ba4\u7684cluster\u6a21\u5f0f\u3002</p> <ul> <li>[KNL] threadirqs</li> </ul> <p>\u5f3a\u5236\u7ebf\u7a0b\u5316\u6240\u6709\u7684\u4e2d\u65ad\u5904\u7406\u5668(\u660e\u786e\u6807\u8bb0\u4e3aIRQF_NO_THREAD\u7684\u9664\u5916)</p> <ul> <li>[SMP,APIC] pirq=</li> </ul> <p>\u624b\u52a8\u6307\u5b9amp-table\u7684\u8bbe\u7f6e\u3002\u6b64\u9009\u9879\u4ec5\u5bf9\u67d0\u4e9b\u6709\u7f3a\u9677\u7684\u3001\u5177\u5907\u591a\u4e2aIO-APIC\u7684\u9ad8\u7aef\u4e3b\u677f\u6709\u610f\u4e49\u3002\u8be6\u89c1Documentation/x86/i386/IO-APIC.txt\u6587\u6863</p> <ul> <li>[HW] irqfixup</li> </ul> <p>\u7528\u4e8e\u4fee\u590d\u7b80\u5355\u7684\u4e2d\u65ad\u95ee\u9898\uff1a\u5f53\u4e00\u4e2a\u4e2d\u65ad\u6ca1\u6709\u88ab\u5904\u7406\u65f6\u641c\u7d22\u6240\u6709\u53ef\u7528\u7684\u4e2d\u65ad\u5904\u7406\u5668\u3002\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u7b80\u5355\u7684\u56fa\u4ef6\u7f3a\u9677\u3002</p> <ul> <li>[HW] irqpoll</li> </ul> <p>\u7528\u4e8e\u4fee\u590d\u9ad8\u7ea7\u7684\u4e2d\u65ad\u95ee\u9898\uff1a\u5f53\u4e00\u4e2a\u4e2d\u65ad\u6ca1\u6709\u88ab\u5904\u7406\u65f6\u641c\u7d22\u6240\u6709\u53ef\u7528\u7684\u4e2d\u65ad\u5904\u7406\u5668\uff0c\u5e76\u4e14\u5bf9\u6bcf\u4e2a\u65f6\u949f\u4e2d\u65ad\u90fd\u8fdb\u884c\u641c\u7d22\u3002\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u4e25\u91cd\u7684\u56fa\u4ef6\u7f3a\u9677\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#47-acpi","title":"4.7 ACPI","text":"<p>\u9ad8\u7ea7\u914d\u7f6e\u4e0e\u7535\u6e90\u7ba1\u7406\u63a5\u53e3(Advanced Configuration and Power Interface)\u662f\u63d0\u4f9b\u64cd\u4f5c\u7cfb\u7edf\u4e0e\u5e94\u7528\u7a0b\u5e8f\u7ba1\u7406\u6240\u6709\u7535\u6e90\u7ba1\u7406\u63a5\u53e3\uff0c\u5305\u62ec\u4e86\u5404\u79cd\u8f6f\u4ef6\u548c\u786c\u4ef6\u65b9\u9762\u7684\u89c4\u8303\u30022004\u5e74\u63a8\u51fa3.0\u89c4\u8303\uff1b2009\u5e74\u63a8\u51fa4.0\u89c4\u8303\uff1b2011\u5e74\u63a8\u51fa5.0\u89c4\u8303\u30022013\u5e74\u4e4b\u540e\u65b0\u7684ACPI\u89c4\u683c\u5c06\u7531UEFI\u8bba\u575b\u5236\u5b9a\u3002ACPI\u53ef\u4ee5\u5b9e\u73b0\u7684\u529f\u80fd\u5305\u62ec\uff1a\u7535\u6e90\u7ba1\u7406\uff1b\u6027\u80fd\u7ba1\u7406\uff1b\u914d\u7f6e\u4e0e\u5373\u63d2\u5373\u7528\uff1b\u7cfb\u7edf\u4e8b\u4ef6\uff1b\u6e29\u5ea6\u7ba1\u7406\uff1b\u7535\u6c60\u7ba1\u7406\uff1bSMBus\u63a7\u5236\u5668\uff1b\u5d4c\u5165\u5f0f\u63a7\u5236\u5668\u3002</p> <ul> <li>[HW,ACPI] acpi={force|off|noirq|strict|rsdt|nocmcff|copy_dsdt}</li> </ul> <p>ACPI\u7684\u603b\u5f00\u5173\u3002 force \u8868\u793a\u5f3a\u5236\u542f\u7528ACPI(\u5373\u4f7fBIOS\u4e2d\u5df2\u5173\u95ed)\uff1b off \u8868\u793a\u5f3a\u5236\u7981\u7528ACPI(\u5373\u4f7fBIOS\u4e2d\u5df2\u5f00\u542f)\uff1b noirq \u8868\u793a\u4e0d\u8981\u5c06ACPI\u7528\u4e8eIRQ\u8def\u7531\uff1b strict \u8868\u793a\u4e25\u683c\u8981\u6c42\u7cfb\u7edf\u9075\u5faaACPI\u89c4\u683c(\u964d\u4f4e\u517c\u5bb9\u6027)\uff1b rsdt \u8868\u793a\u4f7f\u7528\u8001\u65e7\u7684RSDT(Root System Description Table)\u4ee3\u66ff\u8f83\u65b0\u7684XSDT(Extended System Description Table)\uff1b copy_dsdt \u8868\u793a\u5c06DSDT(Differentiated System Description Table)\u590d\u5236\u5230\u5185\u5b58\u4e2d\u3002 \u66f4\u591a\u4fe1\u606f\u53ef\u53c2\u8003Documentation/power/runtime_pm.txt\u4ee5\u53ca\"pci=noacpi\"\u3002</p> <ul> <li>[HW,ACPI] acpi_backlight={vendor|video}</li> </ul> <p>\u9009\u62e9\u5c4f\u5e55\u80cc\u5149\u4eae\u5ea6\u8c03\u8282\u9a71\u52a8\u3002 video(\u9ed8\u8ba4\u503c)\u8868\u793a\u4f7f\u7528\u901a\u7528\u7684ACPI video.ko\u9a71\u52a8(CONFIG_ACPI_VIDEO)\uff0c\u8be5\u9a71\u52a8\u4ec5\u53ef\u7528\u4e8e\u96c6\u6210\u663e\u5361\u3002 vendor\u8868\u793a\u4f7f\u7528\u5382\u5546\u7279\u5b9a\u7684ACPI\u9a71\u52a8(thinkpad_acpi,sony_acpi\u7b49)\u3002 \u8be6\u89c1Documentation/acpi/video_extension.txt\u6587\u6863\u3002</p> <ul> <li>[HW,ACPI] acpi_os_name=\"\u5b57\u7b26\u4e32\"</li> </ul> <p>\u544a\u8bc9ACPI BIOS\u64cd\u4f5c\u7cfb\u7edf\u7684\u540d\u79f0\u3002 \u5e38\u7528\u4e8e\u54c4\u9a97\u6709\u7f3a\u9677\u7684BIOS\uff0c\u8ba9\u5176\u4ee5\u4e3a\u8fd0\u884c\u7684\u662fWindows\u7cfb\u7edf\u800c\u4e0d\u662fLinux\u7cfb\u7edf\u3002 \"Linux\" = Linux \"Microsoft Windows\" = Windows 98 \"Windows 2000\" = Windows 2000 \"Windows 2001\" = Windows XP \"Windows 2001 SP2\" = Windows XP SP2 \"Windows 2001.1\" = Windows Server 2003 \"Windows 2001.1 SP1\" = Windows Server 2003 SP1 \"Windows 2006\" = Windows Vista \"Windows 2006 SP1\" = Windows Vista SP1 \"Windows 2006.1\" = Windows Server 2008 \"Windows 2009\" = Windows 7 / Windows Server 2008 R2 \"Windows 2012\" = Windows 8 / Windows Server 2012 \"Windows 2013\" = Windows 8.1 / Windows Server 2012 R2</p> <ul> <li>[HW,ACPI] acpi_osi=\"\u5b57\u7b26\u4e32\"</li> </ul> <p>\u5bf9\u4e8e\u8f83\u65b0\u7684\u5185\u6838(Linux-2.6.23\u4e4b\u540e)\u800c\u8a00\uff0c\u5f53BIOS\u8be2\u95ee\u5185\u6838\uff1a\"\u4f60\u662fLinux\u5417?\"\uff0c\u5185\u6838\u90fd\u4f1a\u56de\u7b54\"No\"\uff0c\u4f46\u5386\u53f2\u4e0a(Linux-2.6.22\u53ca\u66f4\u65e9\u7248\u672c)\u5185\u6838\u4f1a\u5982\u5b9e\u56de\u7b54\"Yes\"\uff0c\u7ed3\u679c\u9020\u6210\u5f88\u591aBIOS\u517c\u5bb9\u6027\u95ee\u9898(\u4e3b\u8981\u662f\u7535\u6e90\u7ba1\u7406\u65b9\u9762)\u3002\u5177\u4f53\u6545\u4e8b\u7684\u7ec6\u8282\u8bf7\u5230\u5185\u6838\u6e90\u7801\u6587\u4ef6drivers/acpi/osl.c\u4e2d\u641c\u7d22\"The story of _OSI(Linux)\"\u6ce8\u91ca\u3002 \u6b64\u9009\u9879\u7528\u4e8e\u4fee\u6539\u5185\u6838\u4e2d\u7684\u64cd\u4f5c\u7cfb\u7edf\u63a5\u53e3\u5b57\u7b26\u4e32(_OSI string)\u5217\u8868\u9ed8\u8ba4\u503c\uff0c\u8fd9\u6837\u5f53BIOS\u5411\u5185\u6838\u8be2\u95ee\uff1a\"\u4f60\u662fxxx\u5417?\"\u7684\u65f6\u5019\uff0c\u5185\u6838\u5c31\u53ef\u4ee5\u6839\u636e\u4fee\u6539\u540e\u7684\u5217\u8868\u4e2d\u662f\u5426\u5b58\u5728\"xxx\"\u56de\u7b54\"Yes\"\u6216\"No\"\u4e86\uff0c\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3BIOS\u517c\u5bb9\u6027\u95ee\u9898\u5bfc\u81f4\u7684\u6545\u969c(\u4f8b\u5982\u5c4f\u5e55\u4eae\u5ea6\u8c03\u6574)\u3002 acpi_osi=\"Linux\"\u8868\u793a\u6dfb\u52a0\"Linux\"\uff1b acpi_osi=\"!Linux\"\u8868\u793a\u5220\u9664\"Linux\"\uff1b acpi_osi=!* \u8868\u793a\u5220\u9664\u6240\u6709\u5b57\u7b26\u4e32(v3.13\u65b0\u589e)\uff0c\u53ef\u4ee5\u548c\u591a\u4e2aacpi_osi=\"Linux\"\u683c\u5f0f\u8054\u5408\u4f7f\u7528\uff1b acpi_osi=! \u8868\u793a\u5220\u9664\u6240\u6709\u5185\u7f6e\u7684\u5b57\u7b26\u4e32(v3.13\u65b0\u589e)\uff0c\u53ef\u4ee5\u548c\u591a\u4e2aacpi_osi=\"Linux\"\u683c\u5f0f\u8054\u5408\u4f7f\u7528\uff1b acpi_osi= \u8868\u793a\u7981\u7528\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u4ec5\u53ef\u5355\u72ec\u4f7f\u7528(\u4e0d\u80fd\u8054\u5408\u4f7f\u7528)\u3002</p> <ul> <li>[HW,ACPI] acpi_serialize</li> </ul> <p>\u5f3a\u5236\u5185\u6838\u4ee5\u4e32\u884c\u65b9\u5f0f\u6267\u884cAML(ACPI Machine Language)\u5b57\u8282\u7801\u3002\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684BIOS\u5bfc\u81f4\u7684\u6545\u969c\u3002</p> <ul> <li>[ACPI] acpi_enforce_resources={strict|lax|no}</li> </ul> <p>\u68c0\u67e5\u9a71\u52a8\u7a0b\u5e8f\u548cACPI\u64cd\u4f5c\u533a\u57df(SystemIO,SystemMemory)\u4e4b\u95f4\u8d44\u6e90\u51b2\u7a81\u7684\u65b9\u5f0f\u3002 strict(\u9ed8\u8ba4\u503c)\u7981\u6b62\u4efb\u4f55\u9a71\u52a8\u7a0b\u5e8f\u8bbf\u95ee\u5df2\u88abACPI\u58f0\u660e\u4e3a\"\u53d7\u4fdd\u62a4\"\u7684\u64cd\u4f5c\u533a\u57df\uff0c\u8fd9\u662f\u6700\u5b89\u5168\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4ece\u6839\u672c\u4e0a\u907f\u514d\u51b2\u7a81\u3002 lax\u5141\u8bb8\u9a71\u52a8\u7a0b\u5e8f\u8bbf\u95ee\u5df2\u88abACPI\u58f0\u660e\u7684\u4fdd\u62a4\u533a\u57df(\u4f46\u4f1a\u663e\u793a\u4e00\u4e2a\u8b66\u544a)\u3002\u8fd9\u53ef\u80fd\u4f1a\u9020\u6210\u51b2\u7a81\uff0c\u4f46\u662f\u53ef\u4ee5\u517c\u5bb9\u67d0\u4e9b\u8001\u65e7\u4e14\u8111\u6b8b\u7684\u9a71\u52a8\u7a0b\u5e8f(\u4f8b\u5982\u67d0\u4e9b\u786c\u4ef6\u76d1\u63a7\u9a71\u52a8)\u3002 no\u8868\u793a\u6839\u672c\u4e0d\u58f0\u660e\u4efb\u4f55ACPI\u4fdd\u62a4\u533a\u57df\uff0c\u4e5f\u5c31\u662f\u5b8c\u5168\u5141\u8bb8\u4efb\u610f\u9a71\u52a8\u7a0b\u5e8f\u8bbf\u95eeACPI\u64cd\u4f5c\u533a\u57df\u3002</p> <ul> <li>[ACPI] pnpacpi=off</li> </ul> <p>\u7981\u7528ACPI\u7684\u5373\u63d2\u5373\u7528\u529f\u80fd\uff0c\u8f6c\u800c\u4f7f\u7528\u53e4\u8463\u7684PNPBIOS\u6765\u4ee3\u66ff\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#48","title":"4.8 \u4f11\u7720\u4e0e\u5524\u9192","text":"<ul> <li>[HW,ACPI]   acpi_sleep={s3_bios,s3_mode,s3_beep,s4_nohwsig,old_ordering,nonvs,sci_force_enable}</li> </ul> <p>ACPI\u4f11\u7720\u9009\u9879\u3002 (1)s3_bios\u548cs3_mode\u4e0e\u663e\u5361\u6709\u5173\u3002\u8ba1\u7b97\u673a\u4eceS3\u72b6\u6001(\u6302\u8d77\u5230\u5185\u5b58)\u6062\u590d\u65f6\uff0c\u786c\u4ef6\u9700\u8981\u88ab\u6b63\u786e\u7684\u521d\u59cb\u5316\u3002\u8fd9\u5bf9\u5927\u591a\u6570\u786c\u4ef6\u90fd\u4e0d\u662f\u95ee\u9898\uff0c\u4f46\u56e0\u4e3a\u663e\u5361\u662f\u7531BIOS\u521d\u59cb\u5316\u7684\uff0c\u5185\u6838\u65e0\u6cd5\u83b7\u53d6\u5fc5\u8981\u7684\u6062\u590d\u4fe1\u606f(\u4ec5\u5b58\u5728\u4e8eBIOS\u4e2d\uff0c\u5185\u6838\u65e0\u6cd5\u8bfb\u53d6)\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c31\u63d0\u4f9b\u4e86\u4e24\u4e2a\u9009\u9879\uff0c\u4ee5\u5141\u8bb8\u5185\u6838\u901a\u8fc7\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u6062\u590d\u663e\u5361\uff0c\u66f4\u591a\u7ec6\u8282\u8bf7\u53c2\u8003Documentation/power/video.txt\u6587\u6863\u3002 (2)s3_beep\u4e3b\u8981\u7528\u4e8e\u8c03\u8bd5\uff0c\u5b83\u8ba9PC\u5587\u53ed\u5728\u5185\u6838\u7684\u5b9e\u6a21\u5f0f\u5165\u53e3\u70b9\u88ab\u8c03\u7528\u65f6\u53d1\u51fa\u54cd\u58f0\u3002 (3)s4_nohwsig\u7528\u4e8e\u5173\u95edACPI\u786c\u4ef6\u7b7e\u540d\u529f\u80fd\uff0c\u67d0\u4e9b\u6709\u7f3a\u9677\u7684BIOS\u4f1a\u56e0\u4e3a\u8fd9\u4e2a\u539f\u56e0\u5bfc\u81f4\u4eceS4\u72b6\u6001(\u6302\u8d77\u5230\u786c\u76d8)\u5524\u9192\u65f6\u5931\u8d25\u3002 (4)old_ordering\u7528\u4e8e\u517c\u5bb9\u53e4\u8463\u7ea7\u7684ACPI 1.0 BIOS (5)nonvs\u8868\u793a\u963b\u6b62\u5185\u6838\u5728\u6302\u8d77/\u5524\u9192\u8fc7\u7a0b\u4e2d\u4fdd\u5b58/\u6062\u590dACPI NVS\u5185\u5b58\u4fe1\u606f\uff0c\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684BIOS\u5bfc\u81f4\u7684\u6302\u8d77/\u5524\u9192\u6545\u969c\u3002 (6)sci_force_enable\u8868\u793a\u7531\u5185\u6838\u76f4\u63a5\u8bbe\u7f6eSCI_EN(ACPI\u6a21\u5f0f\u5f00\u5173)\u7684\u72b6\u6001\uff0c\u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u67d0\u4e9b\u6709\u7f3a\u9677\u7684BIOS\u5bfc\u81f4\u7684\u4eceS1/S3\u72b6\u6001\u5524\u9192\u65f6\u7684\u6545\u969c\u3002</p> <ul> <li>[HIBERNATION]   noresume</li> </ul> <p>\u7981\u7528\u5185\u6838\u7684\u4f11\u7720\u5230\u786c\u76d8\u529f\u80fd(CONFIG_HIBERNATION)\uff0c\u4e5f\u5c31\u662f\u4e0d\u4ece\u5148\u524d\u7684\u4f11\u7720\u72b6\u6001\u4e2d\u6062\u590d(\u5373\u4f7f\u8be5\u72b6\u6001\u5df2\u7ecf\u88ab\u4fdd\u5b58\u5728\u4e86\u786c\u76d8\u7684swap\u5206\u533a\u4e0a)\uff0c\u5e76\u4e14\u6e05\u695a\u5148\u524d\u5df2\u7ecf\u4fdd\u5b58\u7684\u4f11\u7720\u72b6\u6001(\u5982\u679c\u6709\u7684\u8bdd)\u3002</p> <ul> <li>[HIBERNATION]   hibernate={noresume|nocompress}</li> </ul> <p>\u8bbe\u7f6e\u4f11\u7720/\u5524\u9192\u5c5e\u6027\uff1a noresume \u8868\u793a\u7981\u7528\u5524\u9192\uff0c\u4e5f\u5c31\u662f\u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\u65e0\u89c6\u4efb\u4f55\u5df2\u7ecf\u5b58\u5728\u7684\u4f11\u7720\u955c\u50cf\uff0c\u5b8c\u5168\u91cd\u65b0\u542f\u52a8\u3002 nocompress \u8868\u793a\u7981\u6b62\u5bf9\u4f11\u7720\u955c\u50cf\u8fdb\u884c\u538b\u7f29/\u89e3\u538b\u3002</p> <ul> <li>[HIBERNATION]   resume={ /dev/swap | PARTUUID=uuid | major:minor | hex }</li> </ul> <p>\u544a\u8bc9\u5185\u6838\u88ab\u6302\u8d77\u7684\u5185\u5b58\u955c\u50cf\u5b58\u653e\u5728\u90a3\u4e2a\u78c1\u76d8\u5206\u533a(\u9ed8\u8ba4\u503c\u662fCONFIG_PM_STD_PARTITION)\u3002 \u5047\u5b9a\u5185\u5b58\u955c\u50cf\u5b58\u653e\u5728\"/dev/sdc15\"\u5206\u533a\u4e0a\uff0c\u8be5\u5206\u533a\u7684 UUID=0123456789ABCDEF \uff0c\u5176\u4e3b\u8bbe\u5907\u53f7\u662f\"8\"\uff0c\u6b21\u8bbe\u5907\u53f7\u662f\"47\"\uff0c\u90a3\u4e48\u8fd94\u79cd\u8868\u793a\u6cd5\u5e94\u8be5\u5206\u522b\u8fd9\u6837\u8868\u793a\uff1a resume=/dev/sdc15 (\u8fd9\u662f\u5185\u6838\u8bbe\u5907\u540d\u79f0\uff0c\u6709\u53ef\u80fd\u4e0e\u7528\u6237\u7a7a\u95f4\u7684\u8bbe\u5907\u540d\u79f0\u4e0d\u540c) resume=PARTUUID=0123456789ABCDEF resume=08:47 resume=082F</p> <ul> <li>[HIBERNATION]   resume_offset=\u6574\u6570</li> </ul> <p>\u6307\u5b9aswap header\u6240\u5728\u4f4d\u7f6e\u7684\u504f\u79fb\u91cf(\u5355\u4f4d\u662fPAGE_SIZE)\uff0c\u504f\u79fb\u91cf\u7684\u8ba1\u7b97\u57fa\u51c6\u70b9\u662f\"resume=\"\u5206\u533a\u7684\u8d77\u70b9\u3002 \u4ec5\u5728\u4f7f\u7528swap\u6587\u4ef6(\u800c\u4e0d\u662f\u5206\u533a)\u7684\u65f6\u5019\u624d\u9700\u8981\u6b64\u9009\u9879\u3002\u8be6\u89c1Documentation/power/swsusp-and-swap-files.txt\u6587\u6863</p> <ul> <li>[HIBERNATION]   resumedelay=\u79d2\u6570</li> </ul> <p>\u5728\u8bfb\u53d6resume\u6587\u4ef6(\u8bbe\u5907)\u4e4b\u524d\u5ef6\u8fdf\u7684\u79d2\u6570\uff0c\u4e3b\u8981\u7528\u4e8e\u7b49\u5f85\u90a3\u4e9b\u53cd\u5e94\u901f\u5ea6\u8f83\u6162\u7684\u5f02\u6b65\u68c0\u6d4b\u7684\u8bbe\u5907\u5c31\u7eea(\u4f8b\u5982USB/MMC)\u3002</p> <ul> <li>[HIBERNATION]   resumewait</li> </ul> <p>\u5728resume\u8bbe\u5907\u6ca1\u6709\u5c31\u7eea\u4e4b\u524d\u65e0\u9650\u7b49\u5f85\uff0c\u4e3b\u8981\u7528\u4e8e\u7b49\u5f85\u90a3\u4e9b\u53cd\u5e94\u901f\u5ea6\u8f83\u6162\u7684\u5f02\u6b65\u68c0\u6d4b\u7684\u8bbe\u5907\u5c31\u7eea(\u4f8b\u5982USB/MMC)\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#49","title":"4.9 \u6e29\u5ea6\u63a7\u5236","text":"<ul> <li>[HW,ACPI]   thermal.act=\u6444\u6c0f\u5ea6</li> </ul> <p>-1 \u7981\u7528\u6240\u6709\"\u4e3b\u52a8\u6563\u70ed\"\u6807\u5fd7\u70b9(active trip point) \u6b63\u6574\u6570 \u5f3a\u5236\u8bbe\u7f6e\u6240\u6709\u7684\u6700\u4f4e\"\u4e3b\u52a8\u6563\u70ed\"\u6807\u5fd7\u70b9\u7684\u6e29\u5ea6\u503c\uff0c\u5355\u4f4d\u662f\u6444\u6c0f\u5ea6\u3002 \u8be6\u89c1Documentation/thermal/sysfs-api.txt\u6587\u6863\u3002</p> <ul> <li>[HW,ACPI]   thermal.psv=\u6444\u6c0f\u5ea6</li> </ul> <p>-1 \u7981\u7528\u6240\u6709\"\u88ab\u52a8\u6563\u70ed\"\u6807\u5fd7\u70b9(passive trip point) \u6b63\u6574\u6570 \u5f3a\u5236\u8bbe\u7f6e\u6240\u6709\u7684\"\u88ab\u52a8\u6563\u70ed\"\u6807\u5fd7\u70b9\u7684\u6e29\u5ea6\u503c\uff0c\u5355\u4f4d\u662f\u6444\u6c0f\u5ea6\u3002 \u8be6\u89c1Documentation/thermal/sysfs-api.txt\u6587\u6863\u3002</p> <ul> <li>[HW,ACPI]   thermal.crt=\u6444\u6c0f\u5ea6</li> </ul> <p>-1 \u7981\u7528\u6240\u6709\"\u7d27\u6025\"\u6807\u5fd7\u70b9(critical trip point) \u6b63\u6574\u6570 \u5f3a\u5236\u8bbe\u7f6e\u6240\u6709\u7684\"\u7d27\u6025\"\u6807\u5fd7\u70b9\u7684\u6e29\u5ea6\u503c\uff0c\u5355\u4f4d\u662f\u6444\u6c0f\u5ea6\u3002 \u8be6\u89c1Documentation/thermal/sysfs-api.txt\u6587\u6863\u3002</p> <ul> <li>[HW,ACPI]   thermal.nocrt=1</li> </ul> <p>\u7981\u6b62\u5728ACPI\u70ed\u533a(thermal zone)\u6e29\u5ea6\u8fbe\u5230\"\u7d27\u6025\"\u6807\u5fd7\u70b9\u65f6\u91c7\u53d6\u4efb\u4f55\u52a8\u4f5c\u3002</p> <ul> <li>[HW,ACPI]   thermal.off=1</li> </ul> <p>\u5f7b\u5e95\u5173\u95edACPI\u70ed\u91cf\u63a7\u5236(CONFIG_ACPI_THERMAL)</p> <ul> <li>[HW,ACPI]   thermal.tzp=\u6574\u6570</li> </ul> <p>\u8bbe\u7f6eACPI\u70ed\u533a(thermal zone)\u7684\u8f6e\u8be2\u901f\u5ea6\uff1a 0(\u9ed8\u8ba4\u503c) \u4e0d\u8f6e\u8be2 \u6b63\u6574\u6570 \u8f6e\u8be2\u95f4\u9694\uff0c\u5355\u4f4d\u662f\u5341\u5206\u4e4b\u4e00\u79d2\u3002</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#410-cpu","title":"4.10 CPU\u8282\u80fd","text":"<ul> <li>[KNL] nohz={on|off}</li> </ul> <p>\u542f\u7528/\u7981\u7528\u5185\u6838\u7684dynamic ticks\u7279\u6027\u3002\u9ed8\u8ba4\u503c\u662f\"on\"\u3002</p> <ul> <li>[KNL,BOOT] nohz_full=CPU\u5217\u8868</li> </ul> <p>\u5728\u5185\u6838\"CONFIG_NO_HZ_FULL=y\"\u7684\u524d\u63d0\u4e0b\uff0c\u6307\u5b9a\u54ea\u4e9bCPU\u6838\u5fc3\u53ef\u4ee5\u8fdb\u5165\u5b8c\u5168\u65e0\u6ef4\u7b54\u72b6\u6001\u3002 \"CPU\u5217\u8868\"\u662f\u4e00\u4e2a\u9017\u53f7\u5206\u9694\u7684CPU\u7f16\u53f7(\u4ece0\u5f00\u59cb\u8ba1\u6570)\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\"-\"\u754c\u5b9a\u4e00\u4e2a\u8303\u56f4\u3002\u4f8b\u5982\"0,2,4-7\"\u7b49\u4ef7\u4e8e\"0,2,4,5,6,7\" \u6ce8\u610f\"boot CPU\"(\u901a\u5e38\u90fd\u662f\"0\"\u53f7CPU)\u4f1a\u65e0\u6761\u4ef6\u7684\u4ece\u5217\u8868\u4e2d\u5254\u9664\u3002(2)\u8fd9\u91cc\u5217\u51fa\u7684CPU\u7f16\u53f7\u5fc5\u987b\u4e5f\u8981\u540c\u65f6\u5217\u8fdb\"rcu_nocbs=...\"\u9009\u9879\u4e2d\u3002</p> <ul> <li>[HW,ACPI] processor.nocst</li> </ul> <p>\u4e0d\u4f7f\u7528_CST\u65b9\u6cd5\u68c0\u6d4bC-states\uff0c\u800c\u662f\u7528\u8001\u65e7\u7684FADT\u65b9\u6cd5\u68c0\u6d4b\u3002</p> <ul> <li>[HW,ACPI] processor.max_cstate={0|1|2|3|4|5|6|7|8|9}</li> </ul> <p>\u65e0\u89c6ACPI\u8868\u62a5\u544a\u7684\u503c\uff0c\u5f3a\u5236\u6307\u5b9aCPU\u7684\u6700\u5927C-state\u503c(\u5fc5\u987b\u662f\u4e00\u4e2a\u6709\u6548\u503c)\uff1aC0\u4e3a\u6b63\u5e38\u72b6\u6001\uff0c\u5176\u4ed6\u5219\u4e3a\u4e0d\u540c\u7684\u7701\u7535\u6a21\u5f0f(\u6570\u5b57\u8d8a\u5927\u8868\u793aCPU\u4f11\u7720\u7684\u7a0b\u5ea6\u8d8a\u6df1/\u8d8a\u7701\u7535)\u3002\"9\"\u8868\u793a\u65e0\u89c6\u6240\u6709\u7684DMI\u9ed1\u540d\u5355\u9650\u5236\u3002</p> <ul> <li>[KNL,HW,ACPI] intel_idle.max_cstate=[0|\u6b63\u6574\u6570]</li> </ul> <p>\u8bbe\u7f6eintel_idle\u9a71\u52a8(CONFIG_INTEL_IDLE)\u5141\u8bb8\u4f7f\u7528\u7684\u6700\u5927C-state\u6df1\u5ea6\u3002\"0\"\u8868\u793a\u7981\u7528intel_idle\u9a71\u52a8\uff0c\u8f6c\u800c\u4f7f\u7528\u901a\u7528\u7684acpi_idle\u9a71\u52a8(CONFIG_CPU_IDLE)</p> <ul> <li>idle=poll idle=halt idle=nomwait</li> </ul> <p>\u5bf9CPU\u8fdb\u5165\u4f11\u7720\u72b6\u6001\u7684\u989d\u5916\u8bbe\u7f6e\u3002 poll \u4ece\u6839\u672c\u4e0a\u7981\u7528\u4f11\u7720\u529f\u80fd(\u4e5f\u5c31\u662f\u7981\u6b62\u8fdb\u5165C-states\u72b6\u6001)\uff0c\u53ef\u4ee5\u7565\u5fae\u63d0\u5347\u4e00\u4e9bCPU\u6027\u80fd\uff0c\u4f46\u662f\u5374\u9700\u8981\u591a\u6d88\u8017\u8bb8\u591a\u7535\u529b\uff0c\u5f97\u4e0d\u507f\u5931\u3002\u4e0d\u63a8\u8350\u4f7f\u7528\u3002 halt \u8868\u793a\u76f4\u63a5\u4f7f\u7528HALT\u6307\u4ee4\u8ba9CPU\u8fdb\u5165C1/C1E\u4f11\u7720\u72b6\u6001\uff0c\u4f46\u662f\u4e0d\u518d\u7ee7\u7eed\u8fdb\u5165C2/C3\u4ee5\u53ca\u66f4\u6df1\u7684\u4f11\u7720\u72b6\u6001\u3002\u6b64\u9009\u9879\u517c\u5bb9\u6027\u6700\u597d\uff0c\u5524\u9192\u901f\u5ea6\u4e5f\u6700\u5feb\u3002\u4f46\u662f\u7535\u529b\u6d88\u8017\u5e76\u4e0d\u6700\u4f4e\u3002 nomwait \u8868\u793a\u8fdb\u5165\u4f11\u7720\u72b6\u6001\u65f6\u7981\u6b62\u4f7f\u7528CPU\u7684MWAIT\u6307\u4ee4\u3002MWAIT\u662f\u4e13\u7528\u4e8eIntel\u8d85\u7ebf\u7a0b\u6280\u672f\u7684\u7ebf\u7a0b\u540c\u6b65\u6307\u4ee4\uff0c\u6709\u52a9\u4e8e\u63d0\u5347CPU\u7684\u8d85\u7ebf\u7a0b\u6548\u80fd\uff0c\u4f46\u5bf9\u4e8e\u4e0d\u5177\u5907\u8d85\u7ebf\u7a0b\u6280\u672f\u7684CPU\u6ca1\u6709\u610f\u4e49\u3002 [\u63d0\u793a]\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528halt\u548cnomwait\uff0c\u4e5f\u5c31\u662f\"idle=halt idle=nomwait\"(\u4f46\u4e0d\u662f\uff1aidle=halt,nomwait)</p> <ul> <li>intel_pstate=disable</li> </ul> <p>\u7981\u7528 Intel CPU \u7684 P-state \u9a71\u52a8(CONFIG_X86_INTEL_PSTATE)\uff0c\u4e5f\u5c31\u662fIntel CPU\u4e13\u7528\u7684\u9891\u7387\u8c03\u8282\u5668\u9a71\u52a8</p>"},{"location":"linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/#_5","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>http://www.jinbuguo.com/kernel/boot_parameters.html</li> <li>https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html</li> </ul>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/","title":"Linux \u7cfb\u7edf\u5b89\u5168\u52a0\u56fa\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_1","title":"\u524d\u8a00","text":"<p>\u5f53\u4e91\u8ba1\u7b97\u91cd\u6784IT\u4ea7\u4e1a\u7684\u540c\u65f6\uff0c\u4e5f\u8d4b\u4e88\u4e86\u4f01\u4e1a\u5d2d\u65b0\u7684\u589e\u957f\u673a\u9047\u3002\u901a\u8fc7\u5145\u5206\u5229\u7528\u4e91\u8ba1\u7b97\u7684\u80fd\u529b\uff0c\u4f01\u4e1a\u53ef\u4ee5\u91ca\u653e\u66f4\u591a\u7cbe\u529b\u4e13\u6ce8\u4e8e\u81ea\u5df1\u7684\u4e1a\u52a1\u3002\u4e91\u8ba1\u7b97\u6781\u5927\u5730\u964d\u4f4e\u4e86\u4f01\u4e1a\u7684\u6570\u5b57\u5316\u8f6c\u578b\u6210\u672c\uff0c\u91ca\u653e\u66f4\u591a\u6548\u80fd\u8fdb\u884c\u4e1a\u52a1\u521b\u65b0\uff0c\u4e91\u8ba1\u7b97\u4e3a\u4f01\u4e1a\u4e1a\u52a1\u521b\u65b0\u5e26\u6765\u65e0\u9650\u53ef\u80fd\u3002\u4f46\u662f\u5f53\u4eba\u4eec\u5728\u4eab\u53d7\u4f7f\u7528\u4e91\u8ba1\u7b97\u5e26\u6765\u7684\u4fbf\u5229\u7684\u540c\u65f6\uff0c\u670d\u52a1\u5668\u5b89\u5168\u4e5f\u4e0d\u5bb9\u5ffd\u89c6\u3002</p> <p>Linux\u662f\u4e00\u5957\u514d\u8d39\u4f7f\u7528\u548c\u81ea\u7531\u4f20\u64ad\u7684\u7c7bUnix\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5f00\u653e\u6e90\u4ee3\u7801\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0cLinux\u670d\u52a1\u5668\u4ee5\u5176\u5b89\u5168\u3001\u9ad8\u6548\u548c\u7a33\u5b9a\u7684\u663e\u8457\u4f18\u52bf\u800c\u5f97\u4ee5\u5e7f\u6cdb\u5e94\u7528\uff0c\u4f46\u5982\u679c\u4e0d\u505a\u597d\u6743\u9650\u7684\u5408\u7406\u5206\u914d\uff0cLinux\u7cfb\u7edf\u7684\u5b89\u5168\u6027\u8fd8\u662f\u4f1a\u5f97\u4e0d\u5230\u66f4\u597d\u7684\u4fdd\u969c\u3002</p> <p>\u4e0d\u8fc7\u7ecf\u8fc7\u5b89\u5168\u52a0\u56fa\u540e\u7684Linux\u7cfb\u7edf\u53ef\u8fbe\u5230B1\u7684\u5b89\u5168\u7ea7\u522b\uff0c\u76f8\u4fe1\u5927\u591a\u6570\u540c\u5b66\u90fd\u6709\u670d\u52a1\u5668\u88ab\u9ed1\u5ba2\u5165\u4fb5\u7684\u7ecf\u5386\uff0c\u901a\u8fc7\u672c\u6587Linux\u7cfb\u7edf\u4ece\u4e0d\u540c\u7ef4\u5ea6\u8fdb\u884c\u5b89\u5168\u52a0\u56fa\uff0c\u4e00\u5b9a\u7a0b\u5ea6\u589e\u52a0\u7cfb\u7edf\u7684\u5b89\u5168\u6027\uff0c\u6784\u7b51\u66f4\u52a0\u575a\u5b9e\u7684\u5b89\u5168\u58c1\u5792\u3002</p>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_2","title":"\u4e00 \u8eab\u4efd\u9274\u522b","text":""},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#11","title":"1.1 \u5bc6\u7801\u5b89\u5168\u7b56\u7565","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u548c\u6570\u636e\u5e93\u7cfb\u7edf\u7ba1\u7406\u7528\u6237\u8eab\u4efd\u9274\u522b\u4fe1\u606f\u5e94\u5177\u6709\u4e0d\u6613\u88ab\u5192\u7528\u7684\u7279\u70b9\uff0c\u53e3\u4ee4\u5e94\u6709\u590d\u6742\u5ea6\u8981\u6c42\u5e76\u5b9a\u671f\u66f4\u6362\u3002</p> <p>\u8bbe\u7f6e\u6709\u6548\u7684\u5bc6\u7801\u7b56\u7565\uff0c\u9632\u6b62\u653b\u51fb\u8005\u7834\u89e3\u51fa\u5bc6\u7801</p> <ul> <li>\u67e5\u770b\u7a7a\u53e3\u4ee4\u5e10\u53f7\u5e76\u4e3a\u5f31/\u7a7a\u53e3\u4ee4\u5e10\u53f7\u8bbe\u7f6e\u5f3a\u5bc6\u7801</li> </ul> <pre><code># awk -F: '($2 == \"\"){print $1}' /etc/shadow\n</code></pre> <p>\u53ef\u7528\u79bb\u7ebf\u7834\u89e3\u3001\u66b4\u529b\u5b57\u5178\u7834\u89e3\u6216\u8005\u5bc6\u7801\u7f51\u7ad9\u67e5\u8be2\u51fa\u5e10\u53f7\u5bc6\u94a5\u7684\u5bc6\u7801\u662f\u5426\u662f\u5f31\u53e3\u4ee4</p> <ul> <li>\u4fee\u6539vi /etc/login.defs\u914d\u7f6e\u5bc6\u7801\u5468\u671f\u7b56\u7565</li> </ul> <p></p> <p>\u6b64\u7b56\u7565\u53ea\u5bf9\u7b56\u7565\u5b9e\u65bd\u540e\u6240\u521b\u5efa\u7684\u5e10\u53f7\u751f\u6548\uff0c \u4ee5\u524d\u7684\u5e10\u53f7\u8fd8\u662f\u630999999\u5929\u5468\u671f\u65f6\u95f4\u6765\u7b97\u3002</p> <ul> <li>/etc/pam.d/system-auth\u914d\u7f6e\u5bc6\u7801\u590d\u6742\u5ea6\uff1a</li> </ul> <pre><code>password requisite  pam_cracklib.so retry=3 difok=2 minlen=8 lcredit=-1 dcredit=-1\n</code></pre> <p>\u53c2\u6570\u542b\u4e49\u5982\u4e0b\u6240\u793a\uff1a</p> <p>difok\uff1a\u672c\u6b21\u5bc6\u7801\u4e0e\u4e0a\u6b21\u5bc6\u7801\u81f3\u5c11\u4e0d\u540c\u5b57\u7b26\u6570</p> <p>minlen\uff1a\u5bc6\u7801\u6700\u5c0f\u957f\u5ea6\uff0c\u6b64\u914d\u7f6e\u4f18\u5148\u4e8elogin.defs\u4e2d\u7684PASS_MAX_DAYS</p> <p>ucredit\uff1a\u6700\u5c11\u5927\u5199\u5b57\u6bcd</p> <p>lcredit\uff1a\u6700\u5c11\u5c0f\u5199\u5b57\u6bcd</p> <p>dcredit\uff1a\u6700\u5c11\u6570\u5b57</p> <p>retry\uff1a\u91cd\u8bd5\u591a\u5c11\u6b21\u540e\u8fd4\u56de\u5bc6\u7801\u4fee\u6539\u9519\u8bef</p> <p>\u3010\u6ce8\u3011\u7528root\u4fee\u6539\u5176\u4ed6\u5e10\u53f7\u90fd\u4e0d\u53d7\u5bc6\u7801\u5468\u671f\u53ca\u590d\u6742\u5ea6\u914d\u7f6e\u7684\u5f71\u54cd\u3002</p>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#12","title":"1.2 \u767b\u5f55\u5931\u8d25\u7b56\u7565","text":"<p>\u5e94\u542f\u7528\u767b\u5f55\u5931\u8d25\u5904\u7406\u529f\u80fd\uff0c\u53ef\u91c7\u53d6\u7ed3\u675f\u4f1a\u8bdd\u3001\u9650\u5236\u975e\u6cd5\u767b\u5f55\u6b21\u6570\u548c\u81ea\u52a8\u9000\u51fa\u7b49\u63aa\u65bd\u3002</p> <p>\u906d\u9047\u5bc6\u7801\u7834\u89e3\u65f6\uff0c\u6682\u65f6\u9501\u5b9a\u5e10\u53f7\uff0c\u964d\u4f4e\u5bc6\u7801\u88ab\u731c\u89e3\u7684\u53ef\u80fd\u6027</p> <ul> <li>\u65b9\u6cd5\u4e00\uff1a/etc/pam.d/login\u4e2d\u8bbe\u5b9a\u63a7\u5236\u53f0\uff1b/etc/pam.d/sshd\u4e2d\u8bbe\u5b9aSSH</li> </ul> <p>/etc/pam.d/sshd\u4e2d\u7b2c\u4e8c\u884c\u6dfb\u52a0\u4e0b\u5217\u4fe1\u606f</p> <pre><code>auth required  pam_tally2.so deny=5 lock_time=2 even_deny_root unlock_time=60\n</code></pre> <p># pam_tally2 --user root</p> <p>\u89e3\u9501\u7528\u6237</p> <p># pam_tally2 -r -u root</p> <p>even_deny_root    \u4e5f\u9650\u5236root\u7528\u6237(\u9ed8\u8ba4\u914d\u7f6e\u5c31\u9501\u5b9aroot\u5e10\u53f7)\uff1b  deny     \u8bbe\u7f6e\u666e\u901a\u7528\u6237\u548croot\u7528\u6237\u8fde\u7eed\u9519\u8bef\u767b\u9646\u7684\u6700\u5927\u6b21\u6570\uff0c\u8d85\u8fc7\u6700\u5927\u6b21\u6570\uff0c\u5219\u9501\u5b9a\u8be5\u7528\u6237  unlock_time     \u8bbe\u5b9a\u666e\u901a\u7528\u6237\u9501\u5b9a\u540e\uff0c\u591a\u5c11\u65f6\u95f4\u540e\u89e3\u9501\uff0c\u5355\u4f4d\u662f\u79d2\uff1b </p> <p>root_unlock_time      \u8bbe\u5b9aroot\u7528\u6237\u9501\u5b9a\u540e\uff0c\u591a\u5c11\u65f6\u95f4\u540e\u89e3\u9501\uff0c\u5355\u4f4d\u662f\u79d2\uff1b</p>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#13","title":"1.3 \u5b89\u5168\u7684\u8fdc\u7a0b\u7ba1\u7406\u65b9\u5f0f","text":"<p>\u5f53\u5bf9\u670d\u52a1\u5668\u8fdb\u884c\u8fdc\u7a0b\u7ba1\u7406\u65f6\uff0c\u5e94\u91c7\u53d6\u5fc5\u8981\u63aa\u65bd\uff0c\u9632\u6b62\u9274\u522b\u4fe1\u606f\u5728\u7f51\u7edc\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u88ab\u7a83\u542c\u3002</p> <p>\u9632\u6b62\u8fdc\u7a0b\u7ba1\u7406\u8fc7\u7a0b\u4e2d\uff0c\u5bc6\u7801\u7b49\u654f\u611f\u4fe1\u606f\u88ab\u7a83\u542c</p> <p>\u6267\u884c\u5982\u4e0b\u8bed\u53e5\uff0c\u67e5\u770btelnet\u670d\u52a1\u662f\u5426\u5728\u8fd0\u884c</p> <p></p> <p>\u7981\u6b62telnet\u8fd0\u884c\uff0c\u7981\u6b62\u5f00\u673a\u542f\u52a8\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_3","title":"\u4e8c \u8bbf\u95ee\u63a7\u5236","text":""},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#21","title":"2.1 \u8d26\u53f7\u53ca\u5bc6\u7801","text":"<p>\u5e94\u53ca\u65f6\u5220\u9664\u591a\u4f59\u7684\u3001\u8fc7\u671f\u7684\u5e10\u6237\uff0c\u907f\u514d\u5171\u4eab\u5e10\u6237\u7684\u5b58\u5728\u3002</p> <p>\u5220\u9664\u6216\u7981\u7528\u4e34\u65f6\u3001\u8fc7\u671f\u53ca\u53ef\u7591\u7684\u5e10\u53f7\uff0c\u9632\u6b62\u88ab\u975e\u6cd5\u5229\u7528\u3002</p> <p>\u4e3b\u8981\u662f\u7ba1\u7406\u5458\u521b\u5efa\u7684\u666e\u901a\u5e10\u53f7\uff0c\u5982\uff1atest</p> <pre><code># usermod -L user \u7981\u7528\u5e10\u53f7\uff0c\u5e10\u53f7\u65e0\u6cd5\u767b\u5f55\uff0c/etc/shadow\u7b2c\u4e8c\u680f\u663e\u793a\u4e3a!\u5f00\u5934\n\n# userdel user \u5220\u9664user\u7528\u6237\n\n# userdel -r user\u5c06\u5220\u9664user\u7528\u6237\uff0c\u5e76\u4e14\u5c06/home\u76ee\u5f55\u4e0b\u7684user\u76ee\u5f55\u4e00\u5e76\u5220\u9664\n</code></pre>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#22","title":"2.2 \u68c0\u67e5\u7279\u6b8a\u8d26\u53f7","text":"<p>\u68c0\u67e5\u662f\u5426\u5b58\u5728\u7a7a\u53e3\u4ee4\u548croot\u6743\u9650\u7684\u8d26\u53f7\u3002</p> <p>\u64cd\u4f5c\u6b65\u9aa4</p> <ol> <li>\u67e5\u770b\u7a7a\u53e3\u4ee4\u548croot\u6743\u9650\u8d26\u53f7\uff0c\u786e\u8ba4\u662f\u5426\u5b58\u5728\u5f02\u5e38\u8d26\u53f7\uff1a</li> <li>\u4f7f\u7528\u547d\u4ee4 <code>awk -F: '($2==\"\")' /etc/shadow</code> \u67e5\u770b\u7a7a\u53e3\u4ee4\u8d26\u53f7\u3002</li> <li>\u4f7f\u7528\u547d\u4ee4 <code>awk -F: '($3==0)' /etc/passwd</code> \u67e5\u770bUID\u4e3a\u96f6\u7684\u8d26\u53f7\u3002</li> <li>\u52a0\u56fa\u7a7a\u53e3\u4ee4\u8d26\u53f7\uff1a</li> <li>\u4f7f\u7528\u547d\u4ee4 <code>passwd &lt;\u7528\u6237\u540d&gt;</code> \u4e3a\u7a7a\u53e3\u4ee4\u8d26\u53f7\u8bbe\u5b9a\u5bc6\u7801\u3002</li> <li>\u786e\u8ba4UID\u4e3a\u96f6\u7684\u8d26\u53f7\u53ea\u6709root\u8d26\u53f7\u3002</li> </ol>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#23","title":"2.3 \u6dfb\u52a0\u5bc6\u7801\u7b56\u7565","text":"<p>\u52a0\u5f3a\u53e3\u4ee4\u7684\u590d\u6742\u5ea6\u7b49\uff0c\u964d\u4f4e\u88ab\u731c\u89e3\u7684\u53ef\u80fd\u6027\u3002</p> <p>\u64cd\u4f5c\u6b65\u9aa4</p> <ol> <li>\u4f7f\u7528\u547d\u4ee4</li> </ol> <pre><code>vi /etc/login.defs \n</code></pre> <p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u3002</p> <ul> <li><code>PASS_MAX_DAYS 90 #\u65b0\u5efa\u7528\u6237\u7684\u5bc6\u7801\u6700\u957f\u4f7f\u7528\u5929\u6570</code></li> <li><code>PASS_MIN_DAYS 0 #\u65b0\u5efa\u7528\u6237\u7684\u5bc6\u7801\u6700\u77ed\u4f7f\u7528\u5929\u6570</code></li> <li> <p><code>PASS_WARN_AGE 7 #\u65b0\u5efa\u7528\u6237\u7684\u5bc6\u7801\u5230\u671f\u63d0\u524d\u63d0\u9192\u5929\u6570</code></p> </li> <li> <p>\u4f7f\u7528chage\u547d\u4ee4\u4fee\u6539\u7528\u6237\u8bbe\u7f6e\u3002    \u4f8b\u5982\uff0c<code>chage -m 0 -M 30 -E 2000-01-01 -W 7 &lt;\u7528\u6237\u540d&gt;</code>\u8868\u793a\u5c06\u6b64\u7528\u6237\u7684\u5bc6\u7801\u6700\u957f\u4f7f\u7528\u5929\u6570\u8bbe\u4e3a30\uff0c\u6700\u77ed\u4f7f\u7528\u5929\u6570\u8bbe\u4e3a0\uff0c\u5bc6\u78012000\u5e741\u67081\u65e5\u8fc7\u671f\uff0c\u8fc7\u671f\u524d\u4e03\u5929\u8b66\u544a\u7528\u6237\u3002</p> </li> <li> <p>\u8bbe\u7f6e\u8fde\u7eed\u8f93\u9519\u4e09\u6b21\u5bc6\u7801\uff0c\u8d26\u53f7\u9501\u5b9a\u4e94\u5206\u949f\u3002\u4f7f\u7528\u547d\u4ee4 <code>vi /etc/pam.d/common-auth</code>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0 <code>auth required pam_tally.so onerr=fail deny=3 unlock_time=300</code>\u3002</p> </li> </ul>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#24-surootroot","title":"2.4 \u9650\u5236\u80fdsu\u5230root\u7684\u7528\u6237\u53ca\u7981\u7528root\u767b\u9646","text":"<p>\u4f7f\u7528\u547d\u4ee4 <code>vi /etc/pam.d/su</code>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u884c\u3002\u4f8b\u5982\uff0c\u53ea\u5141\u8bb8test\u7ec4\u7528\u6237su\u5230root\uff0c\u5219\u6dfb\u52a0 <code>auth required pam_wheel.so group=test</code>\u3002</p> <p>\u7981\u6b62root\u76f4\u63a5\u767b\u9646\u3002</p> <ol> <li>\u521b\u5efa\u666e\u901a\u6743\u9650\u8d26\u53f7\u5e76\u914d\u7f6e\u5bc6\u7801,\u9632\u6b62\u65e0\u6cd5\u8fdc\u7a0b\u767b\u5f55;</li> <li>\u4f7f\u7528\u547d\u4ee4 <code>vi /etc/ssh/sshd_config</code>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u5c06PermitRootLogin\u7684\u503c\u6539\u6210no\uff0c\u5e76\u4fdd\u5b58\uff0c\u7136\u540e\u4f7f\u7528<code>service sshd restart</code>\u91cd\u542f\u670d\u52a1\u3002</li> </ol>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_4","title":"\u4e09 \u5b89\u5168\u5ba1\u8ba1","text":""},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#31","title":"3.1 \u5ba1\u6838\u7b56\u7565\u5f00\u542f","text":"<p>\u5ba1\u8ba1\u8303\u56f4\u5e94\u8986\u76d6\u5230\u670d\u52a1\u5668\u548c\u91cd\u8981\u5ba2\u6237\u7aef\u4e0a\u7684\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7528\u6237\u548c\u6570\u636e\u5e93\u7528\u6237\uff1b</p> <p>\u5f00\u542f\u5ba1\u6838\u7b56\u7565\uff0c\u82e5\u65e5\u540e\u7cfb\u7edf\u51fa\u73b0\u6545\u969c\u3001\u5b89\u5168\u4e8b\u6545\u5219\u53ef\u4ee5\u67e5\u770b\u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6\uff0c\u6392\u9664\u6545\u969c\u3001\u8ffd\u67e5\u5165\u4fb5\u8005\u7684\u4fe1\u606f\u7b49\u3002</p> <p>\u67e5\u770brsyslog\u4e0eauditd\u670d\u52a1\u662f\u5426\u5f00\u542f</p> <p>rsyslog\u4e00\u822c\u90fd\u4f1a\u5f00\u542f\uff0cauditd\u5982\u6ca1\u5f00\u542f\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a</p> <p>```shell</p>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#systemctl-start-auditd","title":"systemctl start auditd","text":"<p>```</p> <p>auditd\u670d\u52a1\u5f00\u673a\u542f\u52a8</p> <pre><code># systemctl start auditd\n</code></pre>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#32","title":"3.2 \u65e5\u5fd7\u5c5e\u6027\u8bbe\u7f6e","text":"<p>\u5e94\u4fdd\u62a4\u5ba1\u8ba1\u8bb0\u5f55\uff0c\u907f\u514d\u53d7\u5230\u672a\u9884\u671f\u7684\u5220\u9664\u3001\u4fee\u6539\u6216\u8986\u76d6\u7b49\u3002</p> <p>\u9632\u6b62\u91cd\u8981\u65e5\u5fd7\u4fe1\u606f\u88ab\u8986\u76d6</p> <p>\u8ba9\u65e5\u5fd7\u6587\u4ef6\u8f6c\u50a8\u4e00\u4e2a\u6708\uff0c\u4fdd\u75596\u4e2a\u6708\u7684\u4fe1\u606f\uff0c\u5148\u67e5\u770b\u76ee\u524d\u914d\u7f6e\uff0c</p> <pre><code># more /etc/logrotate.conf | grep -v \"^#\\|^$\"\n</code></pre> <p></p>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#33-syslog","title":"3.3 \u542f\u7528syslog","text":"<p>\u542f\u7528\u65e5\u5fd7\u529f\u80fd\uff0c\u5e76\u914d\u7f6e\u65e5\u5fd7\u8bb0\u5f55\u3002</p> <p>\u64cd\u4f5c\u6b65\u9aa4</p> <p>Linux\u7cfb\u7edf\u9ed8\u8ba4\u542f\u7528\u4ee5\u4e0b\u7c7b\u578b\u65e5\u5fd7\uff1a</p> <ul> <li>\u7cfb\u7edf\u65e5\u5fd7\uff08\u9ed8\u8ba4\uff09/var/log/messages</li> <li>cron\u65e5\u5fd7\uff08\u9ed8\u8ba4\uff09/var/log/cron</li> <li>\u5b89\u5168\u65e5\u5fd7\uff08\u9ed8\u8ba4\uff09/var/log/secure</li> </ul> <p>\u6ce8\u610f\uff1a\u90e8\u5206\u7cfb\u7edf\u53ef\u80fd\u4f7f\u7528syslog-ng\u65e5\u5fd7\uff0c\u914d\u7f6e\u6587\u4ef6\u4e3a\uff1a/etc/syslog-ng/syslog-ng.conf\u3002</p> <p>\u60a8\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u914d\u7f6e\u8be6\u7ec6\u65e5\u5fd7\u3002</p>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_5","title":"\u56db \u5165\u4fb5\u9632\u5fa1","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u9075\u5faa\u6700\u5c0f\u5b89\u88c5\u7684\u539f\u5219\uff0c\u4ec5\u5b89\u88c5\u9700\u8981\u7684\u7ec4\u4ef6\u548c\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u901a\u8fc7\u8bbe\u7f6e\u5347\u7ea7\u670d\u52a1\u5668\u7b49\u65b9\u5f0f\u4fdd\u6301\u7cfb\u7edf\u8865\u4e01\u53ca\u65f6\u5f97\u5230\u66f4\u65b0\u3002</p> <p>\u5173\u95ed\u4e0e\u7cfb\u7edf\u4e1a\u52a1\u65e0\u5173\u6216\u4e0d\u5fc5\u8981\u7684\u670d\u52a1\uff0c\u51cf\u5c0f\u7cfb\u7edf\u88ab\u9ed1\u5ba2\u88ab\u653b\u51fb\u3001\u6e17\u900f\u7684\u98ce\u9669\u3002</p> <p>\u7981\u7528\u84dd\u7259\u670d\u52a1</p> <pre><code># systemctl stop bluetooth\n</code></pre>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_6","title":"\u4e94 \u7cfb\u7edf\u8d44\u6e90\u63a7\u5236","text":""},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#51","title":"5.1 \u8bbf\u95ee\u63a7\u5236","text":"<p>\u5e94\u901a\u8fc7\u8bbe\u5b9a\u7ec8\u7aef\u63a5\u5165\u65b9\u5f0f\u3001\u7f51\u7edc\u5730\u5740\u8303\u56f4\u7b49\u6761\u4ef6\u9650\u5236\u7ec8\u7aef\u767b\u5f55\u3002</p> <p>\u5bf9\u63a5\u5165\u670d\u52a1\u5668\u7684IP\u3001\u65b9\u5f0f\u7b49\u8fdb\u884c\u9650\u5236\uff0c\u53ef\u4ee5\u963b\u6b62\u975e\u6cd5\u5165\u4fb5\u3002</p> <ul> <li>\u5728/etc/hosts.allow\u548c/etc/hosts.deny\u6587\u4ef6\u4e2d\u914d\u7f6e\u63a5\u5165\u9650\u5236</li> </ul> <p>\u6700\u597d\u7684\u7b56\u7565\u5c31\u662f\u963b\u6b62\u6240\u6709\u7684\u4e3b\u673a\u5728\u201c/etc/hosts.deny\u201d\u6587\u4ef6\u4e2d\u52a0\u5165\u201c ALL:ALL@ALL, PARANOID \u201d\uff0c\u7136\u540e\u518d\u5728\u201c/etc/hosts.allow\u201d \u6587\u4ef6\u4e2d\u52a0\u5165\u6240\u6709\u5141\u8bb8\u8bbf\u95ee\u7684\u4e3b\u673a\u5217\u8868\u3002\u5982\u4e0b\u64cd\u4f5c\uff1a</p> <p>\u7f16\u8f91 hosts.deny\u6587\u4ef6\uff08vi /etc/hosts.deny\uff09\uff0c\u52a0\u5165\u4e0b\u9762\u8be5\u884c\uff1a</p> <pre><code># Deny access to everyone. \nALL: ALL@ALL, PARANOID\n</code></pre> <p>\u7f16\u8f91hosts.allow \u6587\u4ef6\uff08vi /etc/hosts.allow\uff09\uff0c\u52a0\u5165\u5141\u8bb8\u8bbf\u95ee\u7684\u4e3b\u673a\u5217\u8868\uff0c\u6bd4\u5982\uff1a</p> <p>ftp: 202.54.15.99 foo.com    //202.54.15.99\u662f\u5141\u8bb8\u8bbf\u95ee ftp \u670d\u52a1\u7684 IP \u5730\u5740</p> <p>//foo.com \u662f\u5141\u8bb8\u8bbf\u95ee ftp \u670d\u52a1\u7684\u4e3b\u673a\u540d\u79f0\u3002</p> <ul> <li>\u4e5f\u53ef\u4ee5\u7528iptables\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236 </li> </ul>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#52","title":"5.2 \u8d85\u65f6\u9501\u5b9a","text":"<p>\u5e94\u6839\u636e\u5b89\u5168\u7b56\u7565\u8bbe\u7f6e\u767b\u5f55\u7ec8\u7aef\u7684\u64cd\u4f5c\u8d85\u65f6\u9501\u5b9a\u3002</p> <p>\u8bbe\u7f6e\u767b\u5f55\u8d85\u65f6\u65f6\u95f4\uff0c\u91ca\u653e\u7cfb\u7edf\u8d44\u6e90\uff0c\u4e5f\u63d0\u9ad8\u670d\u52a1\u5668\u7684\u5b89\u5168\u6027\u3002</p> <p>/etc/profile\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4e00\u884c</p> <pre><code>exprot TMOUT=900  //15\u5206\u949f# source /etc/profile\n</code></pre> <p>\u6539\u53d8\u8fd9\u9879\u8bbe\u7f6e\u540e\uff0c\u5fc5\u987b\u5148\u6ce8\u9500\u7528\u6237\uff0c\u518d\u7528\u8be5\u7528\u6237\u767b\u5f55\u624d\u80fd\u6fc0\u6d3b\u8fd9\u4e2a\u529f\u80fd\u3002</p> <p>\u5982\u679c\u6709\u9700\u8981\uff0c\u5f00\u542f\u5c4f\u5e55\u4fdd\u62a4\u529f\u80fd</p> <p>\u8bbe\u7f6e\u5c4f\u5e55\u4fdd\u62a4\uff1a\u8bbe\u7f6e -&gt; \u7cfb\u7edf\u8bbe\u7f6e -&gt; \u5c4f\u5e55\u4fdd\u62a4\u7a0b\u5e8f\uff0c\u8fdb\u884c\u64cd\u4f5c</p>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_7","title":"\u516d  \u6700\u4f73\u7ecf\u9a8c\u5b9e\u8df5","text":"<p>\u5bf9Linux\u7cfb\u7edf\u7684\u5b89\u5168\u6027\u63d0\u5347\u6709\u4e00\u5b9a\u5e2e\u52a9\u3002</p>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#61-dos","title":"6.1 DOS\u653b\u51fb\u9632\u5fa1","text":"<p>\u9632\u6b62\u62d2\u7edd\u670d\u52a1\u653b\u51fb</p> <p>TCP SYN\u4fdd\u62a4\u673a\u5236\u7b49\u8bbe\u7f6e</p> <ul> <li>\u6253\u5f00 syncookie\uff1a</li> </ul> <pre><code># echo\u201c1\u201d&gt;/proc/sys/net/ipv4/tcp_syncookies  //\u9ed8\u8ba4\u4e3a1\uff0c\u4e00\u822c\u4e0d\u7528\u8bbe\u7f6e\n</code></pre> <p>\u8868\u793a\u5f00\u542fSYN Cookies\u3002\u5f53\u51fa\u73b0SYN\u7b49\u5f85\u961f\u5217\u6ea2\u51fa\u65f6\uff0c\u542f\u7528cookies\u6765\u5904\u7406\uff0c\u53ef\u9632\u8303\u5c11\u91cfSYN\u653b\u51fb\uff0c\u9ed8\u8ba4\u4e3a0\uff0c\u8868\u793a\u5173\u95ed\uff1b</p> <ul> <li>\u9632syn \u653b\u51fb\u4f18\u5316</li> </ul> <p>\u7528vi\u7f16\u8f91/etc/sysctl.conf\uff0c\u6dfb\u52a0\u5982\u4e0b\u884c\uff1a</p> <pre><code>net.ipv4.tcp_max_syn_backlog = 2048\n</code></pre>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#62","title":"6.2 \u5386\u53f2\u547d\u4ee4","text":"<p>\u4e3a\u5386\u53f2\u7684\u547d\u4ee4\u589e\u52a0\u767b\u5f55\u7684IP\u5730\u5740\u3001\u6267\u884c\u547d\u4ee4\u65f6\u95f4\u7b49</p> <ul> <li>\u4fdd\u5b581\u4e07\u6761\u547d\u4ee4</li> </ul> <pre><code># sed -i 's/^HISTSIZE=1000/HISTSIZE=10000/g' /etc/profile\n</code></pre> <ul> <li>\u5728/etc/profile\u7684\u6587\u4ef6\u5c3e\u90e8\u6dfb\u52a0\u5982\u4e0b\u884c\u6570\u914d\u7f6e\u4fe1\u606f\uff1a</li> </ul> <pre><code>USER_IP=`who -u am i 2&gt;/dev/null| awk '{print $NF}' |sed -e 's/[()]//g'`if [ \"$USER_IP\" = \"\" ]thenUSER_IP=`hostname`fiexport HISTTIMEFORMAT=\"%F %T $USER_IP `whoami` \"shopt -s histappendexport PROMPT_COMMAND=\"history -a\"\n</code></pre>"},{"location":"linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_8","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://mp.weixin.qq.com/s/Sq1Kdl6OfIR_0VM7IXCHOA</li> </ul>"},{"location":"linux/system/virtio%E8%AF%A6%E8%A7%A3/","title":"Virtio \u8be6\u89e3","text":""},{"location":"linux/system/virtio%E8%AF%A6%E8%A7%A3/#_1","title":"\u4e00 \u7b80\u4ecb","text":"<p>virtio \u662f\u4e00\u79cd I/O \u534a\u865a\u62df\u5316\u89e3\u51b3\u65b9\u6848\uff0c\u662f\u4e00\u5957\u901a\u7528 I/O \u8bbe\u5907\u865a\u62df\u5316\u7684\u7a0b\u5e8f\uff0c\u662f\u5bf9\u534a\u865a\u62df\u5316 Hypervisor \u4e2d\u7684\u4e00\u7ec4\u901a\u7528 I/O \u8bbe\u5907\u7684\u62bd\u8c61\u3002\u63d0\u4f9b\u4e86\u4e00\u5957\u4e0a\u5c42\u5e94\u7528\u4e0e\u5404 Hypervisor \u865a\u62df\u5316\u8bbe\u5907\uff08KVM\uff0cXen\uff0cVMware\u7b49\uff09\u4e4b\u95f4\u7684\u901a\u4fe1\u6846\u67b6\u548c\u7f16\u7a0b\u63a5\u53e3\uff0c\u51cf\u5c11\u8de8\u5e73\u53f0\u6240\u5e26\u6765\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u5927\u5927\u63d0\u9ad8\u9a71\u52a8\u7a0b\u5e8f\u5f00\u53d1\u6548\u7387\u3002</p> <p></p>"},{"location":"linux/system/virtio%E8%AF%A6%E8%A7%A3/#virtio_1","title":"\u4e8c \u4e3a\u4ec0\u4e48\u662f virtio","text":"<p>\u5728\u5b8c\u5168\u865a\u62df\u5316\u7684\u89e3\u51b3\u65b9\u6848\u4e2d\uff0cguest VM \u8981\u4f7f\u7528\u5e95\u5c42 host \u8d44\u6e90\uff0c\u9700\u8981 Hypervisor \u6765\u622a\u83b7\u6240\u6709\u7684\u8bf7\u6c42\u6307\u4ee4\uff0c\u7136\u540e\u6a21\u62df\u51fa\u8fd9\u4e9b\u6307\u4ee4\u7684\u884c\u4e3a\uff0c\u8fd9\u6837\u52bf\u5fc5\u4f1a\u5e26\u6765\u5f88\u591a\u6027\u80fd\u4e0a\u7684\u5f00\u9500\u3002\u534a\u865a\u62df\u5316\u901a\u8fc7\u5e95\u5c42\u786c\u4ef6\u8f85\u52a9\u7684\u65b9\u5f0f\uff0c\u5c06\u90e8\u5206\u6ca1\u5fc5\u8981\u865a\u62df\u5316\u7684\u6307\u4ee4\u901a\u8fc7\u786c\u4ef6\u6765\u5b8c\u6210\uff0cHypervisor \u53ea\u8d1f\u8d23\u5b8c\u6210\u90e8\u5206\u6307\u4ee4\u7684\u865a\u62df\u5316\uff0c\u8981\u505a\u5230\u8fd9\u70b9\uff0c\u9700\u8981 guest \u6765\u914d\u5408\uff0cguest \u5b8c\u6210\u4e0d\u540c\u8bbe\u5907\u7684\u524d\u7aef\u9a71\u52a8\u7a0b\u5e8f\uff0cHypervisor \u914d\u5408 guest \u5b8c\u6210\u76f8\u5e94\u7684\u540e\u7aef\u9a71\u52a8\u7a0b\u5e8f\uff0c\u8fd9\u6837\u4e24\u8005\u4e4b\u95f4\u901a\u8fc7\u67d0\u79cd\u4ea4\u4e92\u673a\u5236\u5c31\u53ef\u4ee5\u5b9e\u73b0\u9ad8\u6548\u7684\u865a\u62df\u5316\u8fc7\u7a0b\u3002</p> <p>\u7531\u4e8e\u4e0d\u540c guest \u524d\u7aef\u8bbe\u5907\u5176\u5de5\u4f5c\u903b\u8f91\u5927\u540c\u5c0f\u5f02\uff08\u5982\u5757\u8bbe\u5907\u3001\u7f51\u7edc\u8bbe\u5907\u3001PCI\u8bbe\u5907\u3001balloon\u9a71\u52a8\u7b49\uff09\uff0c\u5355\u72ec\u4e3a\u6bcf\u4e2a\u8bbe\u5907\u5b9a\u4e49\u4e00\u5957\u63a5\u53e3\u5b9e\u5c5e\u6ca1\u6709\u5fc5\u8981\uff0c\u800c\u4e14\u8fd8\u8981\u8003\u8651\u6269\u5e73\u53f0\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u53e6\u5916\uff0c\u4e0d\u540c\u540e\u7aef Hypervisor \u7684\u5b9e\u73b0\u65b9\u5f0f\u4e5f\u5927\u540c\u5c0f\u5f02\uff08\u5982KVM\u3001Xen\u7b49\uff09\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u5c31\u9700\u8981\u4e00\u5957\u901a\u7528\u6846\u67b6\u548c\u6807\u51c6\u63a5\u53e3\uff08\u534f\u8bae\uff09\u6765\u5b8c\u6210\u4e24\u8005\u4e4b\u95f4\u7684\u4ea4\u4e92\u8fc7\u7a0b\uff0cvirtio \u5c31\u662f\u8fd9\u6837\u4e00\u5957\u6807\u51c6\uff0c\u5b83\u6781\u5927\u5730\u89e3\u51b3\u4e86\u8fd9\u4e9b\u4e0d\u901a\u7528\u7684\u95ee\u9898\u3002</p> <p></p>"},{"location":"linux/system/virtio%E8%AF%A6%E8%A7%A3/#virti","title":"\u4e09 Virti\u7279\u5f81","text":"<ul> <li>\u7b80\u5355\u6613\u5f00\u53d1</li> </ul> <p>virtio PCI \u8bbe\u5907\u4f7f\u7528\u901a\u7528\u7684 PCI \u7684\u4e2d\u65ad\u548c DMA \u673a\u5236\uff0c\u5bf9\u4e8e\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8005\u6765\u8bf4\u4e0d\u4f1a\u5e26\u6765\u56f0\u96be\u3002</p> <ul> <li>\u9ad8\u6548</li> </ul> <p>virtio PCI \u8bbe\u5907\u4f7f\u7528\u9488\u5bf9\u8f93\u5165\u548c\u8f93\u51fa\u4f7f\u7528\u4e0d\u540c\u7684 vring\uff0c\u89c4\u907f\u4e86\u53ef\u80fd\u7684\u7531\u9ad8\u901f\u7f13\u5b58\u5e26\u6765\u7684\u5f71\u54cd\u3002</p> <ul> <li>\u6807\u51c6</li> </ul> <p>virtio PCI \u4e0d\u5047\u5b9a\u5176\u6240\u5904\u7684\u73af\u5883\u4e00\u5b9a\u9700\u8981\u5bf9 PCI \u7684\u652f\u6301\uff0c\u5b9e\u9645\u4e0a\u5f53\u524d\u5f88\u591a virtio \u8bbe\u5907\u5df2\u7ecf\u5728\u975e PCI \u603b\u7ebf\u4e0a\u5b9e\u73b0\u4e86\uff0c\u8fd9\u4e9b\u8bbe\u5907\u6839\u672c\u4e0d\u9700\u8981 PCI\u3002</p> <ul> <li>\u53ef\u6269\u5c55</li> </ul> <p>virtio PCI \u8bbe\u5907\u5305\u542b\u4e00\u7ec4 Feature Bits,\u5728\u8bbe\u5907\u5b89\u88c5\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u544a\u77e5 guest OS\u3002\u8bbe\u5907\u548c\u9a71\u52a8\u4e4b\u95f4\u76f8\u4e92\u534f\u8c03\uff0c\u9a71\u52a8\u53ef\u4ee5\u6839\u636e\u8bbe\u5907\u63d0\u4f9b\u7684\u7279\u6027\u4ee5\u53ca\u9a71\u52a8\u81ea\u8eab\u80fd\u591f\u652f\u6301\u7684\u7279\u6027\u6765\u6700\u7ec8\u786e\u5b9a\u5728 guest OS \u91cc\u9762\u80fd\u591f\u4f7f\u7528\u7684\u8bbe\u5907\u7279\u6027\u3002\u8fd9\u6837\u53ef\u4ee5\u987e\u53ca\u5230\u8bbe\u5907\u7684\u524d\u540e\u517c\u5bb9\u6027\u3002\u56e0\u6b64\uff0c\u5bf9\u4e0e guest OS \u6765\u8bf4\uff0c\u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a PCI \u8bbe\u5907\u9a71\u52a8\uff0c\u7136\u540e Hypervisor \u6dfb\u52a0\u8bbe\u5907\u7684 vring \u652f\u6301\u5373\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a virtio \u8bbe\u5907\u3002</p>"},{"location":"linux/system/virtio%E8%AF%A6%E8%A7%A3/#virtio_2","title":"\u4e09 virtio \u7684\u67b6\u6784","text":"<p>\u4ece\u603b\u4f53\u4e0a\u770b\uff0cvirtio \u53ef\u4ee5\u5206\u4e3a\u56db\u5c42\uff0c\u5305\u62ec\u524d\u7aef guest \u4e2d\u5404\u79cd\u9a71\u52a8\u7a0b\u5e8f\u6a21\u5757\uff0c\u540e\u7aef Hypervisor \uff08\u5b9e\u73b0\u5728Qemu\u4e0a\uff09\u4e0a\u7684\u5904\u7406\u7a0b\u5e8f\u6a21\u5757\uff0c\u4e2d\u95f4\u7528\u4e8e\u524d\u540e\u7aef\u901a\u4fe1\u7684 virtio \u5c42\u548c virtio-ring \u5c42\uff0cvirtio \u8fd9\u4e00\u5c42\u5b9e\u73b0\u7684\u662f\u865a\u62df\u961f\u5217\u63a5\u53e3\uff0c\u7b97\u662f\u524d\u540e\u7aef\u901a\u4fe1\u7684\u6865\u6881\uff0c\u800c virtio-ring \u5219\u662f\u8be5\u6865\u6881\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u5b83\u5b9e\u73b0\u4e86\u4e24\u4e2a\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u5206\u522b\u7528\u4e8e\u4fdd\u5b58\u524d\u7aef\u9a71\u52a8\u7a0b\u5e8f\u548c\u540e\u7aef\u5904\u7406\u7a0b\u5e8f\u6267\u884c\u7684\u4fe1\u606f\u3002</p> <p></p> <p>\u4e25\u683c\u6765\u8bf4\uff0cvirtio \u548c virtio-ring \u53ef\u4ee5\u770b\u505a\u662f\u4e00\u5c42\uff0cvirtio-ring \u5b9e\u73b0\u4e86 virtio \u7684\u5177\u4f53\u901a\u4fe1\u673a\u5236\u548c\u6570\u636e\u6d41\u7a0b\u3002\u6216\u8005\u8fd9\u4e48\u7406\u89e3\u53ef\u80fd\u66f4\u597d\uff0cvirtio \u5c42\u5c5e\u4e8e\u63a7\u5236\u5c42\uff0c\u8d1f\u8d23\u524d\u540e\u7aef\u4e4b\u95f4\u7684\u901a\u77e5\u673a\u5236\uff08kick\uff0cnotify\uff09\u548c\u63a7\u5236\u6d41\u7a0b\uff0c\u800c virtio-vring \u5219\u8d1f\u8d23\u5177\u4f53\u6570\u636e\u6d41\u8f6c\u53d1\u3002</p>"},{"location":"linux/system/virtio%E8%AF%A6%E8%A7%A3/#virtio_3","title":"\u56db virtio \u6570\u636e\u6d41\u4ea4\u4e92\u673a\u5236","text":"<p>vring \u4e3b\u8981\u901a\u8fc7\u4e24\u4e2a\u73af\u5f62\u7f13\u51b2\u533a\u6765\u5b8c\u6210\u6570\u636e\u6d41\u7684\u8f6c\u53d1\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>vring \u5305\u542b\u4e09\u4e2a\u90e8\u5206\uff0c\u63cf\u8ff0\u7b26\u6570\u7ec4 desc\uff0c\u53ef\u7528\u7684 available ring \u548c\u4f7f\u7528\u8fc7\u7684 used ring\u3002</p> <p>desc \u7528\u4e8e\u5b58\u50a8\u4e00\u4e9b\u5173\u8054\u7684\u63cf\u8ff0\u7b26\uff0c\u6bcf\u4e2a\u63cf\u8ff0\u7b26\u8bb0\u5f55\u4e00\u4e2a\u5bf9 buffer \u7684\u63cf\u8ff0\uff0cavailable ring \u5219\u7528\u4e8e guest \u7aef\u8868\u793a\u5f53\u524d\u6709\u54ea\u4e9b\u63cf\u8ff0\u7b26\u662f\u53ef\u7528\u7684\uff0c\u800c used ring \u5219\u8868\u793a host \u7aef\u54ea\u4e9b\u63cf\u8ff0\u7b26\u5df2\u7ecf\u88ab\u4f7f\u7528\u3002</p> <p>Virtio \u4f7f\u7528 virtqueue \u6765\u5b9e\u73b0 I/O \u673a\u5236\uff0c\u6bcf\u4e2a virtqueue \u5c31\u662f\u4e00\u4e2a\u627f\u8f7d\u5927\u91cf\u6570\u636e\u7684\u961f\u5217\uff0c\u5177\u4f53\u4f7f\u7528\u591a\u5c11\u4e2a\u961f\u5217\u53d6\u51b3\u4e8e\u9700\u6c42\uff0c\u4f8b\u5982\uff0cvirtio \u7f51\u7edc\u9a71\u52a8\u7a0b\u5e8f\uff08virtio-net\uff09\u4f7f\u7528\u4e24\u4e2a\u961f\u5217\uff08\u4e00\u4e2a\u7528\u4e8e\u63a5\u53d7\uff0c\u53e6\u4e00\u4e2a\u7528\u4e8e\u53d1\u9001\uff09\uff0c\u800c virtio \u5757\u9a71\u52a8\u7a0b\u5e8f\uff08virtio-blk\uff09\u4ec5\u4f7f\u7528\u4e00\u4e2a\u961f\u5217\u3002</p> <p>\u5177\u4f53\u7684\uff0c\u5047\u8bbe guest \u8981\u5411 host \u53d1\u9001\u6570\u636e\uff0c\u9996\u5148\uff0cguest \u901a\u8fc7\u51fd\u6570 virtqueue_add_buf \u5c06\u5b58\u6709\u6570\u636e\u7684 buffer \u6dfb\u52a0\u5230 virtqueue \u4e2d\uff0c\u7136\u540e\u8c03\u7528 virtqueue_kick \u51fd\u6570\uff0cvirtqueue_kick \u8c03\u7528 virtqueue_notify \u51fd\u6570\uff0c\u901a\u8fc7\u5199\u5165\u5bc4\u5b58\u5668\u7684\u65b9\u5f0f\u6765\u901a\u77e5\u5230 host\u3002host \u8c03\u7528 virtqueue_get_buf \u6765\u83b7\u53d6 virtqueue \u4e2d\u6536\u5230\u7684\u6570\u636e\u3002</p> <p></p> <p>\u5b58\u653e\u6570\u636e\u7684 buffer \u662f\u4e00\u79cd\u5206\u6563-\u805a\u96c6\u7684\u6570\u7ec4\uff0c\u7531 desc \u7ed3\u6784\u6765\u627f\u8f7d\uff0c\u5982\u4e0b\u662f\u4e00\u79cd\u5e38\u7528\u7684 desc \u7684\u7ed3\u6784\uff1a</p> <p></p> <p>\u5f53 guest \u5411 virtqueue \u4e2d\u5199\u6570\u636e\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u5411 desc \u7ed3\u6784\u6307\u5411\u7684 buffer \u4e2d\u586b\u5145\u6570\u636e\uff0c\u5b8c\u4e86\u4f1a\u66f4\u65b0 available ring\uff0c\u7136\u540e\u518d\u901a\u77e5 host\u3002</p> <p>\u5f53 host \u6536\u5230\u63a5\u6536\u6570\u636e\u7684\u901a\u77e5\u65f6\uff0c\u9996\u5148\u4ece desc \u6307\u5411\u7684 buffer \u4e2d\u627e\u5230 available ring \u4e2d\u6dfb\u52a0\u7684 buffer\uff0c\u6620\u5c04\u5185\u5b58\uff0c\u540c\u65f6\u66f4\u65b0 used ring\uff0c\u5e76\u901a\u77e5 guest \u63a5\u6536\u6570\u636e\u5b8c\u6bd5\u3002</p>"},{"location":"linux/system/virtio%E8%AF%A6%E8%A7%A3/#_2","title":"\u4e94 \u603b\u7ed3","text":"<p>virtio \u662f guest \u4e0e host \u4e4b\u95f4\u901a\u4fe1\u7684\u6da6\u6ed1\u5242\uff0c\u63d0\u4f9b\u4e86\u4e00\u5957\u901a\u7528\u6846\u67b6\u548c\u6807\u51c6\u63a5\u53e3\u6216\u534f\u8bae\u6765\u5b8c\u6210\u4e24\u8005\u4e4b\u95f4\u7684\u4ea4\u4e92\u8fc7\u7a0b\uff0c\u6781\u5927\u5730\u89e3\u51b3\u4e86\u5404\u79cd\u9a71\u52a8\u7a0b\u5e8f\u548c\u4e0d\u540c\u865a\u62df\u5316\u89e3\u51b3\u65b9\u6848\u4e4b\u95f4\u7684\u9002\u914d\u95ee\u9898\u3002</p> <p>virtio \u62bd\u8c61\u4e86\u4e00\u5957 vring \u63a5\u53e3\u6765\u5b8c\u6210 guest \u548c host \u4e4b\u95f4\u7684\u6570\u636e\u6536\u53d1\u8fc7\u7a0b\uff0c\u7ed3\u6784\u65b0\u9896\uff0c\u63a5\u53e3\u6e05\u6670\u3002</p> <p>Virtio \u4f5c\u8005\u7684\u76ee\u6807\u662f\u8bbe\u8ba1\u4e00\u5957\u901a\u7528\u7684\uff0c\u9690\u85cf\u7ec6\u8282\u7684\uff0c\u524d\u540e\u7aef\u65b9\u4fbf\u5b9e\u73b0\uff0c\u5171\u4eab\u901a\u7528\u4ee3\u7801\u7684\u865a\u62df\u5316\u6846\u67b6\uff0c\u4ece\u5206\u6790\u770b\u6765\uff0c\u901a\u8fc7 PCI \u548c virtqueue \u7684\u62bd\u8c61\uff0c\u7684\u786e\u80fd\u8fbe\u5230\u76ee\u7684\u3002</p> <p>\u672c\u6587\u5bf9\u90e8\u5206\u7ec6\u8282\u53ea\u8fdb\u884c\u7b80\u5355\u7684\u8bf4\u660e\uff0c\u540e\u7eed\u4f1a\u5728\u4ee5\u4e0b\u51e0\u4e2a\u8bdd\u9898\u5f00\u5c55\uff1a</p> <ul> <li>Qemu \u548c virtio \u7684\u5185\u5b58\u6620\u5c04</li> <li>\u4e2d\u65ad\u6ce8\u5165\u7684\u5b9e\u73b0</li> <li>Virtio \u6d41\u63a7\u4ee5\u53ca\u6027\u80fd\u4f18\u5316</li> <li>Vhost-user</li> </ul>"},{"location":"linux/system/virtio%E8%AF%A6%E8%A7%A3/#_3","title":"\u94fe\u63a5","text":"<ul> <li> <p>http://www.linux-kvm.org/page/Virtio</p> </li> <li> <p>https://www.cnblogs.com/bakari/p/8309638.html</p> </li> </ul>"},{"location":"linux/system/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%8B%E6%B5%8B/","title":"\u6570\u636e\u5e93\u538b\u6d4b","text":"<p>https://help.aliyun.com/document_detail/129152.html</p>"},{"location":"linux/system/%E7%BA%A2%E6%97%97%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C/","title":"\u7ea2\u65d7\u7cfb\u7edf\u64cd\u4f5c","text":""},{"location":"linux/system/%E7%BA%A2%E6%97%97%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C/#_1","title":"\u7ea2\u65d7\u7cfb\u7edf\u64cd\u4f5c","text":""},{"location":"linux/system/%E7%BA%A2%E6%97%97%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C/#_2","title":"\u4e00 \u7ea2\u65d7\u7cfb\u7edf\u7b80\u4ecb","text":"<p>Red Flag Asianux Server\uff0c\u7ea2\u65d7Asianux\u670d\u52a1\u5668\u64cd\u4f5c\u7cfb\u7edf V 8.0</p> <p>\u7ea2\u65d7Asianux Server Linux 8.0\u662f\u4e3a\u4e91\u65f6\u4ee3\u91cd\u65b0\u8bbe\u8ba1\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e3a\u4e91\u65f6\u4ee3\u7684\u5230\u6765\u5f15\u5165\u4e86\u5927\u91cf\u65b0\u529f\u80fd\uff0c\u5305\u62ec\u7528\u4e8e\u914d\u7f6e\u7ba1\u7406\u3001\u5feb\u901f\u8fc1\u79fb\u6846\u67b6\u3001\u7f16\u7a0b\u8bed\u8a00\u548c\u8bf8\u591a\u5f00\u53d1\u8005\u5de5\u5177\uff0c\u5b83\u8fd8\u4e3a\u5bb9\u5668\u5de5\u5177\u5305\u63d0\u4f9b\u5168\u9762\u652f\u6301\uff0c\u7528\u4e8e\u521b\u5efa\uff0c\u8fd0\u884c\u548c\u5171\u4eab\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\uff0c\u65e8\u5728\u652f\u6301\u4ece\u4f01\u4e1a\u6570\u636e\u4e2d\u5fc3\u5230\u591a\u4e91\u8ba1\u7b97\u5e73\u53f0\u7684\u5de5\u4f5c\u8d1f\u8f7d\u548c\u5e94\u7528\u3002</p>"},{"location":"linux/system/%E7%BA%A2%E6%97%97%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C/#yum","title":"\u66f4\u6362yum\u6e90","text":""},{"location":"linux/system/%E7%BA%A2%E6%97%97%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C/#yum_1","title":"\u67e5\u770b\u7cfb\u7edf\u81ea\u5e26yum\u6e90","text":""},{"location":"linux/system/%E7%BA%A2%E6%97%97%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C/#yum_2","title":"\u66f4\u6539\u7cfb\u7edf\u5185yum\u6e90","text":"<pre><code>[root@src1 workspace]# rpm -aq | grep yum | xargs rpm -e --nodeps\n[root@src1 workspace]# whereis yum\nyum: /etc/yum /usr/share/man/man8/yum.8.gz\n[root@src1 workspace]# rm -rf /etc/yum\n[root@src1 workspace]# rm -rf /usr/share/man/man8/yum.8.gz\n</code></pre> <p>\u4e0b\u8f7dyum\u5305</p> <pre><code>wget http://mirrors.163.com/centos/7/os/x86_64/Packages/yum-3.4.3-168.el7.centos.noarch.rpm\nrpm -ivh yum-3.4.3-168.el7.centos.noarch.rpm\n</code></pre> <p></p> <p>\u4e0b\u8f7d\u5176\u4ed6yum\u4ee5\u6765\u5305</p> <pre><code>cat &gt; centos4yum.txt &lt;&lt;EOF\nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/pygpgme-0.3-9.el7.x86_64.rpm   \nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/pyliblzma-0.5.3-11.el7.x86_64.rpm     \nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/python-iniparse-0.4-9.el7.noarch.rpm    \nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/python-urlgrabber-3.10-10.el7.noarch.rpm \nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/pyxattr-0.5.1-5.el7.x86_64.rpm       \nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/yum-metadata-parser\nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.31-54.el7_8.noarch.rpm\n\n\nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/python-pycurl-7.19.0-19.el7.x86_64.rpm    \nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/rpm-python-4.11.3-45.el7.x86_64.rpm \nhttp://mirrors.163.com/centos/7/os/x86_64/Packages/yum-metadata-parser-1.1.4-10.el7.x86_64.rpm    \n\n\n\nEOF\n\nfor p in `cat centos4yum.txt`;do wget -ivh $p ;done \n</code></pre>"},{"location":"linux/system/%E7%BA%A2%E6%97%97%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C/#kylin","title":"\u4f7f\u7528kylin\u6e90","text":""},{"location":"linux/system/%E7%BA%A2%E6%97%97%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C/#_3","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li> <p>http://chinaredflag.cn/product/newproduct?ulink=&amp;tolink=redflag-web/AX8 </p> </li> <li> <p>http://update.cs2c.com.cn:8080/NS/V10/</p> </li> </ul>"},{"location":"other/FinOps/","title":"FinOps","text":""},{"location":"other/FinOps/#_1","title":"\u4e00 \u524d\u8a00","text":"<p>\u6839\u636e\u8c03\u7814\u673a\u6784 Gartner \u516c\u53f8\u7684\u8c03\u67e5\uff0c\u5230 2022 \u5e74\u5e95\uff0c\u5168\u7403\u5404\u5730\u7684\u4f01\u4e1a\u5728\u4e91\u8ba1\u7b97\u57fa\u7840\u8bbe\u65bd\u65b9\u9762\u7684\u652f\u51fa\u7ea6\u4e3a 3330 \u4ebf\u7f8e\u5143\u3002\u9ea6\u80af\u9521\u516c\u53f8\u5728\u8c03\u67e5\u62a5\u544a\u4e2d\u6307\u51fa\uff0c\u6bcf\u5bb6\u4f01\u4e1a\u7684\u4e91\u8ba1\u7b97\u9884\u7b97\u5e73\u5747\u8d85\u8fc7\u4e86 23 %\uff0c\u5e76\u4e14\u6d6a\u8d39\u4e8630 %\u7684\u652f\u51fa\u3002\u8fd9\u4e9b\u6570\u5b57\u4ee4\u4eba\u9707\u60ca\uff0c\u540c\u65f6\u4e5f\u5f15\u53d1\u4f01\u4e1a\u66f4\u5173\u6ce8\u5927\u91cf\u4e91\u6210\u672c\u652f\u51fa\u7684\u56de\u62a5\u3002\u4e91\u8ba1\u7b97\u6700\u7ec8\u662f\u589e\u52a0\u4e86\u4f01\u4e1a\u7684\u6210\u672c\u8fd8\u662f\u7269\u6709\u6240\u503c\uff1f\u5728\u4e1a\u52a1\u540c\u8d28\u5316\u7ade\u4e89\u7684\u5f62\u52bf\u4e0b\uff0c\u4e91\u57fa\u7840\u8bbe\u65bd\u7684\u6210\u672c\u53ca\u6295\u8d44\u3001\u8fd0\u8425\uff0c\u4e5f\u6210\u4e3a\u5f71\u54cd\u4f01\u4e1a\u4e91\u4e1a\u52a1\u5e02\u573a\u7ade\u4e89\u529b\u7684\u5173\u952e\u3002</p> <p>\u4e91\u6210\u672c\u5e76\u4e0d\u4e00\u5b9a\u610f\u5473\u7740\u53ea\u6709 IT \u6210\u672c\uff0c\u8fd8\u5305\u62ec\u67d0\u4e9b\u8fd0\u8425\u548c\u7ba1\u7406\u6210\u672c\u3002\u90a3\u4e48\uff0c\u4f01\u4e1a\u5982\u4f55\u8fdb\u884c\u4e0a\u4e91\u6210\u672c\u4f18\u5316\uff1f\u5728\u8fd9\u91cc\u6211\u4eec\u5c31\u9700\u8981\u5f15\u5165\u4e00\u4e2aFinOps\uff08\u4e91\u6210\u672c\u4f18\u5316\uff09\u7684\u6982\u5ff5\u4e86\u3002</p>"},{"location":"other/FinOps/#finops_1","title":"\u4e8c FinOps\u76f8\u5173\u6982\u5ff5","text":""},{"location":"other/FinOps/#21-finops","title":"2.1 FinOps\u5b9a\u4e49","text":"<p>FinOps is an evolving cloud financial management discipline and cultural practice that enables organizations to get maximum business value by helping engineering, finance, technology and business teams to collaborate on data-driven spending decisions.</p> <p>FinOps \u662f\u4e00\u4e2a\u4e0d\u65ad\u53d1\u5c55\u7684\u4e91\u8d22\u52a1\u7ba1\u7406\u7eaa\u5f8b\u548c\u6587\u5316\u5b9e\u8df5\uff0c\u5b83\u4f7f\u7ec4\u7ec7\u80fd\u591f\u901a\u8fc7\u5e2e\u52a9\u5de5\u7a0b\u3001\u91d1\u878d\u3001\u6280\u672f\u548c\u4e1a\u52a1\u56e2\u961f\u5728\u6570\u636e\u9a71\u52a8\u7684\u652f\u51fa\u51b3\u7b56\u4e0a\u8fdb\u884c\u534f\u4f5c\uff0c\u4ece\u800c\u83b7\u5f97\u6700\u5927\u7684\u4e1a\u52a1\u4ef7\u503c\u3002</p> <p>\u5728\u5176\u6838\u5fc3\uff0cFinOps \u662f\u4e00\u79cd\u6587\u5316\u5b9e\u8df5\u3002\u8fd9\u662f\u56e2\u961f\u7ba1\u7406\u4e91\u6210\u672c\u7684\u65b9\u5f0f\uff0c\u6bcf\u4e2a\u4eba\u90fd\u62e5\u6709\u4e00\u4e2a\u4e2d\u592e\u6700\u4f73\u5b9e\u8df5\u5c0f\u7ec4\u652f\u6301\u7684\u4e91\u4f7f\u7528\u3002\u5de5\u7a0b\u3001\u8d22\u52a1\u3001\u4ea7\u54c1\u7b49\u9886\u57df\u7684\u8de8\u804c\u80fd\u56e2\u961f\u5171\u540c\u52aa\u529b\uff0c\u4ee5\u52a0\u5feb\u4ea7\u54c1\u4ea4\u4ed8\u901f\u5ea6\uff0c\u540c\u65f6\u83b7\u5f97\u66f4\u591a\u7684\u8d22\u52a1\u63a7\u5236\u548c\u53ef\u9884\u6d4b\u6027\u3002</p>"},{"location":"other/FinOps/#22-finops","title":"2.2 \u4ec0\u4e48\u662fFinOps\uff1f","text":"<ul> <li>FinOps(FinancialOperations)\u57fa\u91d1\u4f1a\u96b6\u5c5e\u4e8eLinux\u57fa\u91d1\u4f1a\uff0c\u81f4\u529b\u63a8\u8fdb\u4f01\u4e1a\u7684\u4e91\u8d44\u4ea7\u7ba1\u7406</li> <li>FinOps\u6838\u5fc3\u662f\u786e\u4fdd\u4f01\u4e1a\u5728\u4e91\u4e2d\u82b1\u8d39\u7684\u6bcf\u4e00\u5206\u94b1\u90fd\u83b7\u5f97\u6700\u5927\u4ef7\u503c</li> <li>\u8f85\u52a9\u4f01\u4e1a\u505a\u6210\u672c\u4f18\u5316\uff0c\u964d\u672c\u589e\u6548\uff0c\u5951\u5408\u817e\u8baf\u79d1\u6280\u5411\u5584\u7684\u6838\u5fc3\u4ef7\u503c\u89c2</li> </ul>"},{"location":"other/FinOps/#23-finopscommunity","title":"2.3 FinOpsCommunity","text":""},{"location":"other/FinOps/#24-finops-slogan","title":"2.4 FinOps Slogan","text":"<p>\u770b\u8d77\u6765FinOps\u50cf\u662f\u5728\u6307\u5bfc\u5173\u4e8e\u5982\u4f55\u7701\u94b1\u7684\u65b9\u6cd5\uff0c\u5b9e\u9645\u4e0aFinOps\u662f\u5173\u4e8e\u6323\u94b1\u7684\u65b9\u6848\u3002</p> <ul> <li>\u4fdd\u8bc1\u9ad8\u4f18\u6838\u5fc3\u4e1a\u52a1\u8d44\u6e90\u7684\u4f9b\u5e94\u91cf</li> <li>\u53ef\u4ee5\u6709\u6548\u8861\u91cf\u4e1a\u52a1\u7684\u6295\u5165\u4ea7\u51fa\u6bd4\uff0c\u5e2e\u52a9\u51b3\u7b56</li> <li>\u51cf\u5c11\u5de5\u7a0b\u5e08\u5bf9\u8bbe\u5907\u9009\u578b/\u8fd0\u7ef4/\u5f39\u6027\u7684\u987e\u8651\uff0c\u589e\u52a0\u7814\u53d1/\u53d1\u5e03\u8fdb\u5ea6\uff0c\u589e\u52a0\u7cfb\u7edf\u7a33\u6001\u817e\u8baf\u4e91\u539f\u751f</li> </ul>"},{"location":"other/FinOps/#25","title":"2.5 \u6210\u719f\u5ea6\u6a21\u578b","text":"<p>FinOps \u7684\u5b9e\u8df5\u672c\u8d28\u4e0a\u662f\u8fed\u4ee3\u7684\uff0c\u4efb\u4f55\u7ed9\u5b9a\u7684\u8fc7\u7a0b\u3001\u529f\u80fd\u6d3b\u52a8\u3001\u80fd\u529b\u6216\u9886\u57df\u7684\u6210\u719f\u5ea6\u90fd\u4f1a\u968f\u7740\u91cd\u590d\u800c\u63d0\u9ad8\u3002\u5178\u578b\u7684\u201c\u722c\u884c\u201d\u9636\u6bb5\u7ec4\u7ec7\u662f\u9ad8\u5ea6\u53cd\u5e94\u6027\u7684\uff0c\u5e76\u4e14\u5728\u95ee\u9898\u53d1\u751f\u540e\u7740\u91cd\u4e8e\u89e3\u51b3\u95ee\u9898\uff0c\u800c\u8fd0\u884c\u9636\u6bb5\u5b9e\u8df5\u662f\u4e3b\u52a8\u5730\u5c06\u6210\u672c\u56e0\u7d20\u8003\u8651\u5230\u4ed6\u4eec\u7684\u67b6\u6784\u8bbe\u8ba1\u9009\u62e9\u548c\u6b63\u5728\u8fdb\u884c\u7684\u5de5\u7a0b\u6d41\u7a0b\u4e2d\u3002</p> <p>\u6267\u884c FinOps \u7684\u6210\u719f\u5ea6\u65b9\u6cd5\u201c\u722c\u884c\u3001\u884c\u8d70\u3001\u8fd0\u884c\u201d\u4f7f\u7ec4\u7ec7\u80fd\u591f\u4ece\u5c0f\u89c4\u6a21\u5f00\u59cb\uff0c\u5e76\u968f\u7740\u4e1a\u52a1\u4ef7\u503c\u4fdd\u8bc1\u529f\u80fd\u6d3b\u52a8\u7684\u6210\u719f\u800c\u5728\u89c4\u6a21\u3001\u8303\u56f4\u548c\u590d\u6742\u6027\u65b9\u9762\u4e0d\u65ad\u589e\u957f\u3002\u5728\u5c0f\u8303\u56f4\u548c\u6709\u9650\u7684\u8303\u56f4\u5185\u5feb\u901f\u91c7\u53d6\u884c\u52a8\uff0c\u4f7f FinOps \u56e2\u961f\u80fd\u591f\u8bc4\u4f30\u4ed6\u4eec\u884c\u52a8\u7684\u7ed3\u679c\uff0c\u5e76\u83b7\u5f97\u4ee5\u66f4\u5927\u3001\u66f4\u5feb\u3001\u66f4\u7ec6\u7c92\u5ea6\u7684\u65b9\u5f0f\u91c7\u53d6\u8fdb\u4e00\u6b65\u884c\u52a8\u7684\u4ef7\u503c\u7684\u6d1e\u5bdf\u529b\u3002</p>"},{"location":"other/FinOps/#_2","title":"\u4e09 \u4f01\u4e1a\u75db\u70b9","text":""},{"location":"other/FinOps/#31-it","title":"3.1 IT\u8d44\u6e90\u5229\u7528\u7387\u4f4e","text":""},{"location":"other/FinOps/#311","title":"3.1.1 \u884c\u4e1a\u6574\u4f53","text":""},{"location":"other/FinOps/#312","title":"3.1.2 \u5c40\u90e8\u4e1a\u52a1","text":""},{"location":"other/FinOps/#32","title":"3.2 \u771f\u5b9e\u75db\u70b9","text":""},{"location":"other/FinOps/#_3","title":"\u9636\u6bb5\u4e00","text":"<ul> <li>\u4e1a\u52a1\u589e\u957f\u8fc5\u901f\uff0cIT\u56e2\u961f\u5168\u529b\u4fdd\u969c\u4e1a\u52a1\uff0c\u8d44\u6e90\u7533\u8bf7\u6765\u8005\u4e0d\u62d2</li> </ul>"},{"location":"other/FinOps/#_4","title":"\u9636\u6bb5\u4e8c","text":"<ul> <li>IT\u8d44\u6e90\u6210\u672c\u652f\u51fa\u8fc5\u901f\u63d0\u5347\uff0c\u4e1a\u52a1\u589e\u957f\u653e\u7f13\uff0c\u8001\u677f\u8d23\u4ee4\u6210\u672c\u4f18\u5316</li> <li>IT\u56e2\u961f\u5411\u8001\u677f\u8981\u4eba\uff0c\u6ca1\u4eba\uff1b\u4e1a\u52a1\u56e2\u961f\u5411\u8001\u677f\u8981\u4eba\uff0c\u6ca1\u4eba\uff1b</li> <li>IT\u56e2\u961f\u767e\u5fd9\u4e4b\u4e2d\u5efa\u8bbe\u8d44\u6e90\u8fd0\u8425\u5e73\u53f0\u3001\u5f39\u6027\u5e73\u53f0\u3001\u63a8\u52a8\u4e1a\u52a1\u56e2\u961f\u6539\u9020</li> <li>\u4e1a\u52a1\u56e2\u961f\u5728\u767e\u5fd9\u4e4b\u4e2d\u6324\u51fa\u4eba\u529b\uff0c\u4f18\u5316\u67b6\u6784\u3001\u63d0\u5347\u5f39\u6027\u3001\u51cf\u5c11\u5197\u4f59</li> </ul>"},{"location":"other/FinOps/#_5","title":"\u9636\u6bb5\u4e09","text":"<ul> <li>\u67d0\u6b21\u751f\u4ea7\u73af\u5883\u91cd\u5927\u6545\u969c\uff0c\u5f71\u54cd\u5ba2\u6237</li> <li>\u4e1a\u52a1\u56e2\u961f\u590d\u76d8\u8ba4\u4e3a\u662fIT\u56e2\u961f\u63a8\u52a8\u6210\u672c\u4f18\u5316\uff0c\u67b6\u6784\u5197\u4f59\u51cf\u5c11\uff0c\u6324\u5360\u7814\u53d1\u4eba\u529b\u9020\u6210</li> <li>IT\u56e2\u961f\u8ba4\u4e3a\u662f\u4e1a\u52a1\u6280\u672f\u80fd\u529b\u5dee\u3001\u63d0\u51fa\u4e0d\u5408\u7406\u63a5\u5165\u9700\u6c42\u3001\u56e2\u961f\u4eba\u529b\u5c11\u9020\u6210</li> </ul>"},{"location":"other/FinOps/#_6","title":"\u9636\u6bb5\u56db","text":"<ul> <li>\u4e1a\u52a1\u4e0eIT\u56e2\u961f\u5173\u7cfb\u6781\u5ea6\u6076\u5316</li> <li>\u6240\u6709\u56e2\u961f\u89c9\u5f97\u6210\u672c\u4f18\u5316\u5403\u529b\u4e0d\u8ba8\u597d\u7ed3\u5c40</li> </ul>"},{"location":"other/FinOps/#_7","title":"\u7ed3\u5c40","text":"<ul> <li>\u4e1a\u52a1\u518d\u6b21\u51fa\u73b0\u6545\u969c-&gt;\u4f01\u4e1aIT\u8d44\u6e90\u4f18\u5316\u5931\u8d25</li> <li>IT\u56e2\u961f\u51cf\u5c11\u63a8\u52a8\u529b\u5ea6-&gt;\u4f01\u4e1aIT\u8d44\u6e90\u4f18\u5316\u5931\u8d25</li> <li>\u8001\u677f\u4fe1\u5fc3\u4e27\u5931-&gt;\u4f01\u4e1aIT\u8d44\u6e90\u4f18\u5316\u5931\u8d25</li> </ul>"},{"location":"other/FinOps/#_8","title":"\u56db \u6700\u4f73\u5b9e\u8df5","text":""},{"location":"other/FinOps/#41","title":"4.1 \u4f01\u4e1a\u4e0a\u4e91\u521d\u8877","text":""},{"location":"other/FinOps/#_9","title":"\u4e94 \u5de5\u5177","text":""},{"location":"other/FinOps/#51-crane","title":"5.1 \u817e\u8bafCrane","text":""},{"location":"other/FinOps/#511-crane","title":"5.1.1 Crane\u7b80\u4ecb","text":"<p>Crane\uff08CloudResourceAnalyticsandEconomics\uff09\u7531\u817e\u8baf\u4e3b\u5bfc\u7684\uff0c\u4ee5FinOps\u7406\u5ff5\u4e3a\u6307\u5bfc\u7684\uff0c\u9762\u5411\u4e91\u539f\u751f\u7684\uff0c\u4e00\u7ad9\u5f0f\u4e91\u6210\u672c\u4f18\u5316\u5f00\u6e90\u9879\u76ee\u3002</p>"},{"location":"other/FinOps/#512-crane","title":"5.1.2 Crane\u80fd\u529b\u7b80\u4ecb","text":""},{"location":"other/FinOps/#513-crane","title":"5.1.3 Crane\u67b6\u6784","text":"<ul> <li>\u9884\u6d4b\u4e3a\u738b</li> <li>\u53ef\u6269\u5c55\u7684\u9884\u6d4b\u7b97\u6cd5</li> <li>\u4f18\u5316\u4e3a\u672c</li> <li>\u57fa\u4e8e\u9884\u6d4b\u7684\u8d44\u6e90\u518d\u5206\u914d</li> <li>\u57fa\u4e8e\u9884\u6d4b\u7684\u6210\u672c\u53ef\u89c6\u5316</li> <li>\u57fa\u4e8e\u9884\u6d4b\u7684\u6a2a\u591a\u7ef4\u6269\u7f29\u5bb9</li> <li>\u8d28\u4fdd\u4e3a\u6839</li> <li>\u57fa\u4e8e\u4e1a\u52a1\u4f18\u5148\u7ea7\u7684\u589e\u5f3aQoS</li> <li>\u5e72\u6270\u68c0\u6d4b\u548c\u4e3b\u52a8\u56de\u907f</li> </ul>"},{"location":"other/FinOps/#514","title":"5.1.4 \u4fe1\u606f\u5c55\u793a","text":"<ul> <li>\u6210\u672c\u53ef\u89c6\u5316</li> <li>\u7528\u91cf</li> <li>\u57fa\u4e8e\u9884\u6d4b\u7684\u8d8b\u52bf\u5206\u6790</li> <li>\u6210\u672c\u548c\u6d6a\u8d39\u8bc6\u522b</li> <li>\u4e0e\u8ba1\u8d39API\u6574\u5408\u7684\u8d39\u7528\u5c55\u793a</li> <li>\u7075\u6d3b\u7684\u6c47\u805a\u7ef4\u5ea6</li> <li>\u6309\u90e8\u95e8</li> <li>\u6309\u9879\u76ee</li> <li>\u6309\u5e94\u7528\u7c7b\u578b</li> <li>\u6309\u81ea\u5b9a\u4e49\u6807\u7b7e</li> </ul>"},{"location":"other/FinOps/#515","title":"5.1.5 \u6210\u672c\u4f18\u5316","text":"<ul> <li>\u8d44\u6e90\u4f18\u5316</li> <li>\u9884\u6d4b\u7ed3\u679c\u9a71\u52a8</li> <li>\u4e3a\u5bb9\u5668\u5e94\u7528\u63a8\u8350\u8d44\u6e90\u8bf7\u6c42</li> <li>EffectiveHPA</li> <li>\u9884\u6d4b\u7ed3\u679c\u9a71\u52a8</li> <li>\u63a8\u8350\u6307\u6807</li> <li>\u4ee5\u81ea\u5b9a\u4e49\u6307\u6807\u9a71\u52a8HPA</li> <li>InstanceVPA</li> <li>\u5b9e\u65f6\u8d44\u6e90\u56de\u6536</li> <li>\u57fa\u4e8eLinux\u9694\u79bb\u6280\u672f\u7684\u52a8\u6001\u8d44\u6e90\u8c03\u6574</li> </ul>"},{"location":"other/FinOps/#516","title":"5.1.6 \u6743\u8861\u964d\u672c\u589e\u6548\u548c\u4e1a\u52a1\u7a33\u5b9a","text":"<ol> <li> <p>\u8c03\u5ea6\u624b\u6bb5</p> </li> <li> <p>\u52a8\u6001\u8c03\u5ea6\u5668DynamicScheduler</p> </li> </ol> <p>\u5e94\u7528\u573a\u666f:\u96c6\u7fa4\u8d1f\u8f7d\u4e0d\u5747\u539f\u751f\u8c03\u5ea6\u5668\u57fa\u4e8ePodRequest\u6765\u8fdb\u884c\u8c03\u5ea6\uff0c\u6ca1\u6709\u8003\u8651\u636eNode\u7684\u5f53\u524d\u7684\u771f\u5b9e\u4ee5\u53ca\u5386\u53f2\u8d1f\u8f7d\u60c5\u51b5\uff0c\u5bb9\u6613\u5bfc\u81f4\u96c6\u7fa4\u8d1f\u8f7d\u4e0d\u5747\uff0c</p> <p>\u7279\u70b9\uff1a</p> <ul> <li>\u907f\u514d\u8c03\u5ea6\u70ed\u70b9\u95ee\u9898\u5e95\u5c42\u4f9d\u8d56Prometheus\u91c7\u96c6\u771f\u5b9e\u8d1f\u8f7d\uff0c\u4ee3\u66ffrequest\u503c</li> <li>\u907f\u514d\u4e1a\u52a1\u9ad8\u5cf0\u8282\u70b9\u8d1f\u8f7d\u4e0d\u5747\u5f15\u5165\u8282\u70b9\u5386\u53f2\u8d1f\u8f7d\u6307\u6807(1h\u5185\u6700\u5927\u5229\u7528\u7387\uff0c1\u5929\u5185\u6700\u5927\u5229\u7528\u7387)\uff0c\u611f\u77e5\u4e1a\u52a1\u6ce2\u5cf0</li> <li>\u539f\u751f\u65e0\u4fb5\u5165\u57fa\u4e8e\u539f\u751fKubeScheduler-Extender\u673a\u5236\uff0c\u7248\u672c\u9ad8\u517c\u5bb9</li> </ul> <p></p> <ul> <li>\u91cd\u8c03\u5ea6\u5668Descheduler</li> </ul> <p>\u5e94\u7528\u573a\u666f:</p> <p>a. \u96c6\u7fa4\u5b58\u91cf\u8282\u70b9\u8d1f\u8f7d\u4e0d\u5747\uff0c\u9700\u8981\u8fdb\u884c\u8d44\u6e90\u518d\u5747\u8861</p> <p>b. \u96c6\u7fa4\u52a0\u5165\u65b0\u8282\u70b9\u65f6\uff0c\u65b0\u8282\u70b9\u5229\u7528\u7387\u8f83\u4f4e</p> <p>\u7279\u70b9</p> <ul> <li> <p>\u8d44\u6e90\u518d\u5747\u8861\u81ea\u52a8\u8bc6\u522b\u9ad8\u8d1f\u8f7d\u8282\u70b9\u4e0a\uff0c\u9a71\u9010pod\uff0c\u4fdd\u8bc1\u8282\u70b9\u8d1f\u8f7d\u5728\u76ee\u6807\u6c34\u4f4d\u3002</p> </li> <li> <p>\u5b89\u5168\u4fdd\u969cPod\u9a71\u9010\u65f6\u6267\u884c\u7b5b\u9009\u903b\u8f91\uff08\u91cd\u8981pod\u4e0d\u53ef\u88ab\u9a71\u9010\uff09\u7528\u6237\u624b\u52a8\u6807\u8bb0\u7684\u4e1a\u52a1\u624d\u4f1a\u88ab\u9a71\u9010</p> </li> <li> <p>\u9ad8\u53ef\u7528\u515c\u5e95\u63aa\u65bd\u4fdd\u969c\uff1a\u53ea\u5728workloadready\u7684pod\u6bd4\u4f8b&gt;50%\u65f6\u6267\u884c\u9a71\u9010</p> </li> <li> <p>QoS\u8d28\u91cf\u4fdd\u8bc1</p> </li> </ul> <p></p> <ul> <li>\u58f0\u660e\u5f0f\u7684\u589e\u5f3a\u8d28\u91cf\u4fdd\u8bc1</li> <li>\u57fa\u4e8ePriorityClass\u7684\u4e1a\u52a1\u5b9a\u7ea7</li> <li>\u8282\u70b9\u8d44\u6e90\u6c34\u4f4d\u5b9a\u4e49</li> <li>\u4e1a\u52a1SLO\u5b9a\u4e49</li> <li>\u5e72\u6270\u68c0\u6d4b</li> <li>\u8282\u70b9\u6307\u6807\u63a2\u6d4b</li> <li>\u4e1a\u52a1\u6307\u6807\u63a2\u6d4b</li> <li>\u7075\u6d3b\u7684\u4e3b\u52a8\u56de\u907f</li> <li>\u8282\u70b9\u8c03\u5ea6\u964d\u7ea7\u4e0e\u7981\u6b62</li> <li>\u57fa\u4e8e\u4e1a\u52a1\u4f18\u5148\u7ea7\u7684\u8d44\u6e90\u538b\u5236</li> <li>\u57fa\u4e8e\u4e1a\u52a1\u4f18\u5148\u7ea7\u7684\u4e3b\u52a8\u9a71\u9010</li> </ul>"},{"location":"other/FinOps/#_10","title":"\u53c2\u8003\u94fe\u63a5","text":"<ul> <li>https://www.finops.org/introduction/what-is-finops/</li> <li>https://github.com/gocrane/crane</li> </ul>"}]}