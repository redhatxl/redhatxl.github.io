<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=Kaliarch><link href=https://redhatxl.github.io/devops/IaC/Terraform/terraform-book/ rel=canonical><link href=../IaC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B9%8BTerratest/ rel=prev><link href=../Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.16"><title>Terraform book - Kaliarch Blog</title><link rel=stylesheet href=../../../../assets/stylesheets/main.bcfcd587.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-G9D2HRH134"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-G9D2HRH134",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-G9D2HRH134",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#terraform-book class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../.. title="Kaliarch Blog" class="md-header__button md-logo" aria-label="Kaliarch Blog" data-md-component=logo> <img src=../../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kaliarch Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Terraform book </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=light-blue data-md-color-accent=purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/redhatxl/redhatxl.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> redhatxl.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../../cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/ class=md-tabs__link> 云原生 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/ class=md-tabs__link> devops </a> </li> <li class=md-tabs__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/ class=md-tabs__link> 开发技术 </a> </li> <li class=md-tabs__item> <a href=../../../../linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../../other/ class=md-tabs__link> 其他 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title="Kaliarch Blog" class="md-nav__button md-logo" aria-label="Kaliarch Blog" data-md-component=logo> <img src=../../../../assets/images/logo.png alt=logo> </a> Kaliarch Blog </label> <div class=md-nav__source> <a href=https://github.com/redhatxl/redhatxl.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> redhatxl.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> 云原生 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 云原生 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 1.K8s 开发概念简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.K8s API访问方式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Client-go 的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 4.Cobra+Client-go实现K8s插件开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 5.Client-go源码分析之ListerWatcher </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 6.Client-go源码分析之Reflector </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 7.Client-go源码分析之DeltaFIFO </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 8.Client-go源码分析之Informer </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 9.Client-go源码分析之SharedInformer </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 10.Client-go源码分析之Indexer </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 11.Client-go源码分析之WorkQueue </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/12-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Controller/ class=md-nav__link> <span class=md-ellipsis> 12.自定义实现Controller </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/13-%E8%AE%A4%E8%AF%86CRD/ class=md-nav__link> <span class=md-ellipsis> 13.认识CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/x-Informer%E5%AE%9E%E6%88%98%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96K8s%E4%BA%8B%E4%BB%B6%E8%87%B3ElasticSearch/ class=md-nav__link> <span class=md-ellipsis> x-Informer实战之持久化K8s事件至ElasticSearch </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/develop/x-DeltaFIFO%E5%92%8Cindexer%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94/ class=md-nav__link> <span class=md-ellipsis> x-DeltaFIFO 与 Indexer关系 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 运维 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 运维 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_1> <label class=md-nav__link for=__nav_2_2_1 id=__nav_2_2_1_label tabindex=0> <span class=md-ellipsis> 工具 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_1> <span class="md-nav__icon md-icon"></span> 工具 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/ class=md-nav__link> <span class=md-ellipsis> K8s可视化工具之KUR8 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/ class=md-nav__link> <span class=md-ellipsis> K8s快捷操作工具之K9s </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/tools/K8s%E8%89%B2%E5%BD%A9%E8%BE%93%E5%87%BA%E5%B7%A5%E5%85%B7%E4%B9%8Bkubecolor/ class=md-nav__link> <span class=md-ellipsis> K8s色彩输出工具之kubecolor </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/ class=md-nav__link> <span class=md-ellipsis> K8s日志查看利器之kubetail </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/tools/K8s%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%E4%B9%8Bsniff/ class=md-nav__link> <span class=md-ellipsis> K8s 网络抓包之sniff </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> Kubernetes 六款备份还原工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/tools/k8s%E6%8F%92%E4%BB%B6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E4%B9%8Bkrew/ class=md-nav__link> <span class=md-ellipsis> k8s 插件管理工具之krew </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/ class=md-nav__link> <span class=md-ellipsis> 架构图神器DaC之Diagram </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 云原生备份恢复之velero实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2> <label class=md-nav__link for=__nav_2_2_2 id=__nav_2_2_2_label tabindex=0> <span class=md-ellipsis> 部署 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> 部署 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> Ceph机器安装部署 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之Minikube </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之K3s </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之Kind </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之MicroK8s </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3> <label class=md-nav__link for=__nav_2_2_3 id=__nav_2_2_3_label tabindex=0> <span class=md-ellipsis> servicemesh </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3> <span class="md-nav__icon md-icon"></span> servicemesh </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3_1> <label class=md-nav__link for=__nav_2_2_3_1 id=__nav_2_2_3_1_label tabindex=0> <span class=md-ellipsis> istio </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3_1> <span class="md-nav__icon md-icon"></span> istio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/Envoy%E7%AC%94%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> Envoy笔记 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/服务网格进阶实战.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/详解.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/Istio%E4%B9%8BXDS%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> Istio之XDS协议解析 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8BGateway/ class=md-nav__link> <span class=md-ellipsis> Istio笔记之Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/ class=md-nav__link> <span class=md-ellipsis> Istio笔记之pilot </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> Istio灰度发布 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/Istio之流量管理.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> Istio简介及架构 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/ class=md-nav__link> <span class=md-ellipsis> Istio微服务治理笔记(一) </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> Istio基础之服务网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/微服务金丝雀发布.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> istio笔记 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_4> <label class=md-nav__link for=__nav_2_2_4 id=__nav_2_2_4_label tabindex=0> <span class=md-ellipsis> 排错 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_4> <span class="md-nav__icon md-icon"></span> 排错 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cloud-native/operator/other/k8s%20%E9%9B%86%E7%BE%A4etcd%E6%8E%92%E9%94%99/ class=md-nav__link> <span class=md-ellipsis> k8s 集群etcd排错 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/other/CronHPA/ class=md-nav__link> <span class=md-ellipsis> CronHPA初探 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 记一次K8smaster 节点一次排错实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/ class=md-nav__link> <span class=md-ellipsis> 记一次线上k8s节点维护 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_5> <label class=md-nav__link for=__nav_2_2_5 id=__nav_2_2_5_label tabindex=0> <span class=md-ellipsis> 容器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_5> <span class="md-nav__icon md-icon"></span> 容器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> Dockerfile 最佳实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Docker底层原理 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Podman详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 利用katacoda实现拉取国外镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 镜像底层原理 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/ class=md-nav__link> <span class=md-ellipsis> Harbor/registry镜像仓库部署 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 安全 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 安全 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/ class=md-nav__link> <span class=md-ellipsis> K8s 安全之Kube-bench </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/Kubeeye%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> KubeEye源码分析 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全之KubeEye </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全之NPD </span> </a> </li> <li class=md-nav__item> <a href="../../../../cloud-native/安全/Kubernetes安全之Open/ Policy/ Agent.md" class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bopenebs/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全之openebs </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全分析 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/ class=md-nav__link> <span class=md-ellipsis> kubernetes安全之Polaris </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全扫描之kubescape </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/ class=md-nav__link> <span class=md-ellipsis> 镜像安全扫描之Trivy </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/ class=md-nav__link> <span class=md-ellipsis> 开源容器安全平台之NeuVector </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../cloud-native/other/inside-kubernetes%20controller/ class=md-nav__link> <span class=md-ellipsis> Inside Kubernetes controller </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/other/Kubectl插件开发及开业分享.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/other/KubeEdge/ class=md-nav__link> <span class=md-ellipsis> KubeEdge初探 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> Kubernetes开发排错杂记 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/ class=md-nav__link> <span class=md-ellipsis> Kubernetes生成kubeconfig </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 华为云原生CCE实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/ class=md-nav__link> <span class=md-ellipsis> 微服务API网关-Kong </span> </a> </li> <li class=md-nav__item> <a href=../../../../cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 微服务架构中10种常用设计模式 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> devops </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> GitLab CI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> GitLab CI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/ class=md-nav__link> <span class=md-ellipsis> 1.敏捷无敌之Gitlab CI </span> </a> </li> <li class=md-nav__item> <a href=../../../Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> 2.敏捷无敌之Gitlab CI架构流程详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 3.实战Gitlab CI + Supervisor 发布Python项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/ class=md-nav__link> <span class=md-ellipsis> 4.实战前后端项目及混合环境Gitlab CI </span> </a> </li> <li class=md-nav__item> <a href=../../../Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> 5.实战Kubernetes Gitlab CI </span> </a> </li> <li class=md-nav__item> <a href=../../../Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/ class=md-nav__link> <span class=md-ellipsis> Gitlab CI之单元测试和代码扫描 </span> </a> </li> <li class=md-nav__item> <a href=../../../Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Gitlab CI进阶之共享CI库 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> IaC </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> IaC </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/ class=md-nav__link> <span class=md-ellipsis> IaC扫描工具之Terrascan </span> </a> </li> <li class=md-nav__item> <a href=../IaC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B9%8BTerratest/ class=md-nav__link> <span class=md-ellipsis> IaC测试工具之Terratest </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Terraform book </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Terraform book </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#terraform-book class=md-nav__link> <span class=md-ellipsis> Terraform-Book </span> </a> </li> <li class=md-nav__item> <a href=#terraform class=md-nav__link> <span class=md-ellipsis> 一 Terraform概念 </span> </a> </li> <li class=md-nav__item> <a href=#terraform_1 class=md-nav__link> <span class=md-ellipsis> 二 Terraform核心功能 </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 三 安装部署 </span> </a> </li> <li class=md-nav__item> <a href=#terraform_2 class=md-nav__link> <span class=md-ellipsis> 四 Terraform关键概念 </span> </a> <nav class=md-nav aria-label="四 Terraform关键概念"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-configuration class=md-nav__link> <span class=md-ellipsis> 4.1 Configuration：基础设施的定义和描述 </span> </a> </li> <li class=md-nav__item> <a href=#42-provider class=md-nav__link> <span class=md-ellipsis> 4.2 Provider：基础设施管理组件 </span> </a> </li> <li class=md-nav__item> <a href=#43-resource class=md-nav__link> <span class=md-ellipsis> 4.3 Resource：基础设施资源和服务的管理 </span> </a> </li> <li class=md-nav__item> <a href=#44-data-source class=md-nav__link> <span class=md-ellipsis> 4.4 Data Source：基础设施资源和服务的查询 </span> </a> </li> <li class=md-nav__item> <a href=#45-state class=md-nav__link> <span class=md-ellipsis> 4.5 State：保存资源关系及其属性文件的数据库 </span> </a> </li> <li class=md-nav__item> <a href=#46-backend-state class=md-nav__link> <span class=md-ellipsis> 4.6 Backend：存放 State 文件的载体 </span> </a> </li> <li class=md-nav__item> <a href=#47-provisioner class=md-nav__link> <span class=md-ellipsis> 4.7 Provisioner：在机器上执行操作的组件 </span> </a> </li> <li class=md-nav__item> <a href=#48 class=md-nav__link> <span class=md-ellipsis> 4.8 变量 </span> </a> </li> <li class=md-nav__item> <a href=#49-terraform class=md-nav__link> <span class=md-ellipsis> 4.9 Terraform中输入变量 </span> </a> </li> <li class=md-nav__item> <a href=#410 class=md-nav__link> <span class=md-ellipsis> 4.10 变量赋值 </span> </a> <nav class=md-nav aria-label="4.10 变量赋值"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#4101 class=md-nav__link> <span class=md-ellipsis> 4.10.1 命令行声明 </span> </a> </li> <li class=md-nav__item> <a href=#4102 class=md-nav__link> <span class=md-ellipsis> 4.10.2 从文件导入 </span> </a> </li> <li class=md-nav__item> <a href=#4103 class=md-nav__link> <span class=md-ellipsis> 4.10.3 环境变量 </span> </a> </li> <li class=md-nav__item> <a href=#4104-default class=md-nav__link> <span class=md-ellipsis> 4.10.4 default值 </span> </a> </li> <li class=md-nav__item> <a href=#4105 class=md-nav__link> <span class=md-ellipsis> 4.10.5 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 五 资源管理常用命令 </span> </a> <nav class=md-nav aria-label="五 资源管理常用命令"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-terraform-plan class=md-nav__link> <span class=md-ellipsis> 5.1 terraform plan：资源的预览 </span> </a> </li> <li class=md-nav__item> <a href=#52-terraform-apply class=md-nav__link> <span class=md-ellipsis> 5.2 terraform apply：资源的新建和变更 </span> </a> </li> <li class=md-nav__item> <a href=#53-terraform-show class=md-nav__link> <span class=md-ellipsis> 5.3 terraform show：资源的展示 </span> </a> </li> <li class=md-nav__item> <a href=#54-terraform-destroy class=md-nav__link> <span class=md-ellipsis> 5.4 terraform destroy：资源的释放 </span> </a> </li> <li class=md-nav__item> <a href=#55-terraform-import class=md-nav__link> <span class=md-ellipsis> 5.5 terraform import：资源的导入 </span> </a> </li> <li class=md-nav__item> <a href=#56-terraform-taint class=md-nav__link> <span class=md-ellipsis> 5.6 terraform taint：标记资源为被污染 </span> </a> </li> <li class=md-nav__item> <a href=#57-terraform-untaint class=md-nav__link> <span class=md-ellipsis> 5.7 terraform untaint：取消被污染标记 </span> </a> </li> <li class=md-nav__item> <a href=#58-terraform-output class=md-nav__link> <span class=md-ellipsis> 5.8 terraform output：打印出参及其值 </span> </a> </li> <li class=md-nav__item> <a href=#59-terraform-state-liststate class=md-nav__link> <span class=md-ellipsis> 5.9 terraform state list：列出当前state中的所有资源 </span> </a> </li> <li class=md-nav__item> <a href=#510-terraform-state-show class=md-nav__link> <span class=md-ellipsis> 5.10 terraform state show：展示某一个资源的属性 </span> </a> </li> <li class=md-nav__item> <a href=#511-terraform-state-pullstate class=md-nav__link> <span class=md-ellipsis> 5.11 terraform state pull：获取当前state内容并展示 </span> </a> </li> <li class=md-nav__item> <a href=#512-terraform-state-rm class=md-nav__link> <span class=md-ellipsis> 5.12 terraform state rm：移除特定的资源 </span> </a> </li> <li class=md-nav__item> <a href=#513-terraform-state-mv class=md-nav__link> <span class=md-ellipsis> 5.13 terraform state mv：变更特定资源的存放地址 </span> </a> </li> <li class=md-nav__item> <a href=#514-terraform-refreshstate class=md-nav__link> <span class=md-ellipsis> 5.14 terraform refresh：刷新当前state </span> </a> </li> <li class=md-nav__item> <a href=#515-terraform-graph class=md-nav__link> <span class=md-ellipsis> 5.15 terraform graph：输出当前模板定义的资源关系图 </span> </a> </li> <li class=md-nav__item> <a href=#516-terraform-validate class=md-nav__link> <span class=md-ellipsis> 5.16 terraform validate：验证模板语法是否正确 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 参考链接 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> Terraform 相关概念及函数 </span> </a> </li> <li class=md-nav__item> <a href=../terraform%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> Terraform 最佳实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../other/Argo%20CD/ class=md-nav__link> <span class=md-ellipsis> Argo CD </span> </a> </li> <li class=md-nav__item> <a href=../../../other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/ class=md-nav__link> <span class=md-ellipsis> IaC之Terraform 与Pulumi使用对比 </span> </a> </li> <li class=md-nav__item> <a href=../../../other/Packer/ class=md-nav__link> <span class=md-ellipsis> 镜像定义工具Packer实战 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> 开发技术 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 开发技术 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 设计模式 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 设计模式 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1_1> <label class=md-nav__link for=__nav_4_1_1 id=__nav_4_1_1_label tabindex=0> <span class=md-ellipsis> 创建型 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_1> <span class="md-nav__icon md-icon"></span> 创建型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.简单工厂模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.工厂方法模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 3.抽象工厂模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4.建造者(生成器)模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 5.单例模式 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1_2> <label class=md-nav__link for=__nav_4_1_2 id=__nav_4_1_2_label tabindex=0> <span class=md-ellipsis> 结构型 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_2> <span class="md-nav__icon md-icon"></span> 结构型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.装饰器模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.代理模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 3.桥接模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4.适配器模式 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1_3> <label class=md-nav__link for=__nav_4_1_3 id=__nav_4_1_3_label tabindex=0> <span class=md-ellipsis> 行为型 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_3> <span class="md-nav__icon md-icon"></span> 行为型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.策略模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.观察者模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.模版模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4.职责链模式 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_1> <label class=md-nav__link for=__nav_4_2_1 id=__nav_4_2_1_label tabindex=0> <span class=md-ellipsis> Gin </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_1> <span class="md-nav__icon md-icon"></span> Gin </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/ class=md-nav__link> <span class=md-ellipsis> Gin框架热加载 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/Golang/gin/gin-swagger/ class=md-nav__link> <span class=md-ellipsis> Gin + Swagger快速生成API文档 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/Golang/gin/gin-validator%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/ class=md-nav__link> <span class=md-ellipsis> gin-validator参数校验 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/ class=md-nav__link> <span class=md-ellipsis> Gin框架优雅关机和重启 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_2> <label class=md-nav__link for=__nav_4_2_2 id=__nav_4_2_2_label tabindex=0> <span class=md-ellipsis> 开发规范 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_2> <span class="md-nav__icon md-icon"></span> 开发规范 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之性能01 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范01 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范02 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范03 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范04 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9901/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则01 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之编程模式01 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则02 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则03 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9904/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则04 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则05 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_3> <label class=md-nav__link for=__nav_4_2_3 id=__nav_4_2_3_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_3> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/ class=md-nav__link> <span class=md-ellipsis> Golang 分布式链路追踪之jaeger </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/Golang/golang%20%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/ class=md-nav__link> <span class=md-ellipsis> Go 内存对齐 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 系统相关 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 系统相关 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Linux grub/grub2详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Linux 内核引导详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> Linux 系统安全加固最佳实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/system/virtio%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Virtio 详解 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/2.Shell%E5%8F%98%E9%87%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Shell 变量 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell 参数 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell 运算符 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 7.Shell test 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell 流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 8.Shell 函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell输入/输出重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell 正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell 三剑客之grep </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell三剑客之sed </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell三剑客之awk </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 15.Shell常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../other/ class=md-nav__link> <span class=md-ellipsis> 工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../../other/ class=md-nav__link> <span class=md-ellipsis> 杂记 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#terraform-book class=md-nav__link> <span class=md-ellipsis> Terraform-Book </span> </a> </li> <li class=md-nav__item> <a href=#terraform class=md-nav__link> <span class=md-ellipsis> 一 Terraform概念 </span> </a> </li> <li class=md-nav__item> <a href=#terraform_1 class=md-nav__link> <span class=md-ellipsis> 二 Terraform核心功能 </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 三 安装部署 </span> </a> </li> <li class=md-nav__item> <a href=#terraform_2 class=md-nav__link> <span class=md-ellipsis> 四 Terraform关键概念 </span> </a> <nav class=md-nav aria-label="四 Terraform关键概念"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-configuration class=md-nav__link> <span class=md-ellipsis> 4.1 Configuration：基础设施的定义和描述 </span> </a> </li> <li class=md-nav__item> <a href=#42-provider class=md-nav__link> <span class=md-ellipsis> 4.2 Provider：基础设施管理组件 </span> </a> </li> <li class=md-nav__item> <a href=#43-resource class=md-nav__link> <span class=md-ellipsis> 4.3 Resource：基础设施资源和服务的管理 </span> </a> </li> <li class=md-nav__item> <a href=#44-data-source class=md-nav__link> <span class=md-ellipsis> 4.4 Data Source：基础设施资源和服务的查询 </span> </a> </li> <li class=md-nav__item> <a href=#45-state class=md-nav__link> <span class=md-ellipsis> 4.5 State：保存资源关系及其属性文件的数据库 </span> </a> </li> <li class=md-nav__item> <a href=#46-backend-state class=md-nav__link> <span class=md-ellipsis> 4.6 Backend：存放 State 文件的载体 </span> </a> </li> <li class=md-nav__item> <a href=#47-provisioner class=md-nav__link> <span class=md-ellipsis> 4.7 Provisioner：在机器上执行操作的组件 </span> </a> </li> <li class=md-nav__item> <a href=#48 class=md-nav__link> <span class=md-ellipsis> 4.8 变量 </span> </a> </li> <li class=md-nav__item> <a href=#49-terraform class=md-nav__link> <span class=md-ellipsis> 4.9 Terraform中输入变量 </span> </a> </li> <li class=md-nav__item> <a href=#410 class=md-nav__link> <span class=md-ellipsis> 4.10 变量赋值 </span> </a> <nav class=md-nav aria-label="4.10 变量赋值"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#4101 class=md-nav__link> <span class=md-ellipsis> 4.10.1 命令行声明 </span> </a> </li> <li class=md-nav__item> <a href=#4102 class=md-nav__link> <span class=md-ellipsis> 4.10.2 从文件导入 </span> </a> </li> <li class=md-nav__item> <a href=#4103 class=md-nav__link> <span class=md-ellipsis> 4.10.3 环境变量 </span> </a> </li> <li class=md-nav__item> <a href=#4104-default class=md-nav__link> <span class=md-ellipsis> 4.10.4 default值 </span> </a> </li> <li class=md-nav__item> <a href=#4105 class=md-nav__link> <span class=md-ellipsis> 4.10.5 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 五 资源管理常用命令 </span> </a> <nav class=md-nav aria-label="五 资源管理常用命令"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-terraform-plan class=md-nav__link> <span class=md-ellipsis> 5.1 terraform plan：资源的预览 </span> </a> </li> <li class=md-nav__item> <a href=#52-terraform-apply class=md-nav__link> <span class=md-ellipsis> 5.2 terraform apply：资源的新建和变更 </span> </a> </li> <li class=md-nav__item> <a href=#53-terraform-show class=md-nav__link> <span class=md-ellipsis> 5.3 terraform show：资源的展示 </span> </a> </li> <li class=md-nav__item> <a href=#54-terraform-destroy class=md-nav__link> <span class=md-ellipsis> 5.4 terraform destroy：资源的释放 </span> </a> </li> <li class=md-nav__item> <a href=#55-terraform-import class=md-nav__link> <span class=md-ellipsis> 5.5 terraform import：资源的导入 </span> </a> </li> <li class=md-nav__item> <a href=#56-terraform-taint class=md-nav__link> <span class=md-ellipsis> 5.6 terraform taint：标记资源为被污染 </span> </a> </li> <li class=md-nav__item> <a href=#57-terraform-untaint class=md-nav__link> <span class=md-ellipsis> 5.7 terraform untaint：取消被污染标记 </span> </a> </li> <li class=md-nav__item> <a href=#58-terraform-output class=md-nav__link> <span class=md-ellipsis> 5.8 terraform output：打印出参及其值 </span> </a> </li> <li class=md-nav__item> <a href=#59-terraform-state-liststate class=md-nav__link> <span class=md-ellipsis> 5.9 terraform state list：列出当前state中的所有资源 </span> </a> </li> <li class=md-nav__item> <a href=#510-terraform-state-show class=md-nav__link> <span class=md-ellipsis> 5.10 terraform state show：展示某一个资源的属性 </span> </a> </li> <li class=md-nav__item> <a href=#511-terraform-state-pullstate class=md-nav__link> <span class=md-ellipsis> 5.11 terraform state pull：获取当前state内容并展示 </span> </a> </li> <li class=md-nav__item> <a href=#512-terraform-state-rm class=md-nav__link> <span class=md-ellipsis> 5.12 terraform state rm：移除特定的资源 </span> </a> </li> <li class=md-nav__item> <a href=#513-terraform-state-mv class=md-nav__link> <span class=md-ellipsis> 5.13 terraform state mv：变更特定资源的存放地址 </span> </a> </li> <li class=md-nav__item> <a href=#514-terraform-refreshstate class=md-nav__link> <span class=md-ellipsis> 5.14 terraform refresh：刷新当前state </span> </a> </li> <li class=md-nav__item> <a href=#515-terraform-graph class=md-nav__link> <span class=md-ellipsis> 5.15 terraform graph：输出当前模板定义的资源关系图 </span> </a> </li> <li class=md-nav__item> <a href=#516-terraform-validate class=md-nav__link> <span class=md-ellipsis> 5.16 terraform validate：验证模板语法是否正确 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 参考链接 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Terraform book</h1> <h3 id=terraform-book>Terraform-Book<a class=headerlink href=#terraform-book title="Permanent link">&para;</a></h3> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20211209220240.png></p> <h2 id=terraform>一 Terraform概念<a class=headerlink href=#terraform title="Permanent link">&para;</a></h2> <p>Terraform 是一种安全有效地构建、更改和版本控制基础设施的工具(基础架构自动化的编排工具)。它的目标是 "Write, Plan, and create Infrastructure as Code", 基础架构即代码。Terraform 几乎可以支持所有市面上能见到的云服务。具体的说就是可以用代码来管理维护 IT 资源，把之前需要手动操作的一部分任务通过程序来自动化的完成，这样的做的结果非常明显：高效、不易出错。</p> <p>Terraform 提供了对资源和提供者的灵活抽象。该模型允许表示从物理硬件、虚拟机和容器到电子邮件和 DNS 提供者的所有内容。由于这种灵活性，Terraform 可以用来解决许多不同的问题。这意味着有许多现有的工具与Terraform 的功能重叠。但是需要注意的是，Terraform 与其他系统并不相互排斥。它可以用于管理小到单个应用程序或达到整个数据中心的不同对象。</p> <p>Terraform 使用配置文件描述管理的组件(小到单个应用程序，达到整个数据中心)。Terraform 生成一个执行计划，描述它将做什么来达到所需的状态，然后执行它来构建所描述的基础结构。随着配置的变化，Terraform 能够确定发生了什么变化，并创建可应用的增量执行计划。</p> <p>Terraform 是用 Go 语言开发的开源项目，你可以在 <a href=https://github.com/hashicorp/terraform>github</a> 上访问到它的源代码。</p> <h2 id=terraform_1>二 Terraform核心功能<a class=headerlink href=#terraform_1 title="Permanent link">&para;</a></h2> <ul> <li>基础架构即代码(Infrastructure as Code)</li> <li>执行计划(Execution Plans)</li> <li>资源图(Resource Graph)</li> <li>自动化变更(Change Automation)</li> </ul> <p><strong>基础架构即代码(Infrastructure as Code)</strong> 使用高级配置语法来描述基础架构，这样就可以对数据中心的蓝图进行版本控制，就像对待其他代码一样对待它。</p> <p><strong>执行计划(Execution Plans)</strong> Terraform 有一个 plan 步骤，它生成一个执行计划。执行计划显示了当执行 apply 命令时 Terraform 将做什么。通过 plan 进行提前检查，可以使 Terraform 操作真正的基础结构时避免意外。</p> <p><strong>资源图(Resource Graph)</strong> Terraform 构建的所有资源的图表，它能够并行地创建和修改任何没有相互依赖的资源。因此，Terraform 可以高效地构建基础设施，操作人员也可以通过图表深入地解其基础设施中的依赖关系。</p> <p><strong>自动化变更(Change Automation)</strong> 把复杂的变更集应用到基础设施中，而无需人工交互。通过前面提到的执行计划和资源图，我们可以确切地知道 Terraform 将会改变什么，以什么顺序改变，从而避免许多可能的人为错误。</p> <h2 id=_1>三 安装部署<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>https://www.terraform.io/downloads.html
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>unzip<span class=w> </span>terraform_0.13.5_linux_amd64.zip
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>mv<span class=w> </span>terraform<span class=w> </span>/usr/local/bin/
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>terraform<span class=w> </span>-version<span class=w>  </span><span class=c1># 查看Terraform版本和Provider的接口版本信息</span>
</code></pre></div> <p>Terraform是通过一个非常容易使用的命令行界面（CLI）来控制的，并且有且仅有一个命令行程序：<code>terraform</code>进行管理。输入<code>terraform</code>，可以看到当前版本可用的子命令列表，如<code>apply</code>，<code>plan</code>等。同时，<code>terraform</code>也响应<code>-h</code>和<code>help</code>，输入<code>terraform -h</code>或<code>terraform help</code>也可以查看所有可用命令。</p> <p>初始化provider，使用Terraform配置语法生成 .tf 资源文件，使用CLI实现资源管理；Terraform会将整个资源部署情况更新在 <code>*.tf.state</code> 文件中，让用户在前端控制台和后端平台都清晰的把控自己的云资源</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>vi k8smain.tf
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>provider &quot;kubernetes&quot; {}
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>terraform init  
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>ls -al
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a># 执行 terraform init 初始化Terraform。此步骤，Terraform会自动检测 .tf 文件中的 provider 字段，发送请求到Terraform官方GitHub下载最新版本相关资源的模块和插件，初始化成功时当前脚本的版本信息也会显示出来。
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a># 有新的版本发布时，可以通过 terraform init -upgrade 指令更新脚本，获取最新的应用。
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a># 同时，可以通过 terraform plan 预览将要完成的操作，准备好创建资源后，可以通过 terraform apply 进行资源部署。
</code></pre></div> <h2 id=terraform_2>四 Terraform关键概念<a class=headerlink href=#terraform_2 title="Permanent link">&para;</a></h2> <h3 id=41-configuration>4.1 <strong>Configuration：基础设施的定义和描述</strong><a class=headerlink href=#41-configuration title="Permanent link">&para;</a></h3> <p>“基础设施即代码（Infrastructure as Code）”，这里的Code就是对基础设施资源的代码定义和描述，也就是通过代码表达我们想要管理的资源。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># VPC 资源</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>resource<span class=w> </span><span class=s2>&quot;alicloud_vpc&quot;</span><span class=w> </span><span class=s2>&quot;vpc&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>        </span><span class=nv>name</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;tf_vpc&quot;</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>        </span><span class=nv>cidr_block</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;172.16.0.0/16&quot;</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=o>}</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=c1># VSwitch 资源</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>resource<span class=w> </span><span class=s2>&quot;alicloud_vswitch&quot;</span><span class=w> </span><span class=s2>&quot;vswitch&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>        </span><span class=nv>vpc_id</span><span class=w>            </span><span class=o>=</span><span class=w> </span>alicloud_vpc.vpc.id
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>        </span><span class=nv>cidr_block</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;172.16.1.0/24&quot;</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>        </span><span class=nv>availability_zone</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;cn-beijing-a&quot;</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=o>}</span>
</code></pre></div> <p>对所有资源的代码描述都需要定义在一个以 <code>tf</code> 结尾的文件用于Terraform加载和解析，这个文件我们称之为“Terraform模板”或者“Configuration”。</p> <h3 id=42-provider>4.2 <strong>Provider：基础设施管理组件</strong><a class=headerlink href=#42-provider title="Permanent link">&para;</a></h3> <p>Terraform 通常用于对云上基础设施，如虚拟机，网络资源，容器资源，存储资源等的创建，更新，查看，删除等管理动作，也可以实现对物理机的管理，如安装软件，部署应用等。</p> <p><a href="https://yq.aliyun.com/go/articleRenderRedirect?url=https%3A%2F%2Fwww.terraform.io%2Fdocs%2Fproviders%2Findex.html">【Provider】</a> 是一个与Open API直接交互的后端驱动，Terraform 就是通过Provider来完成对基础设施资源的管理的。不同的基础设施提供商都需要提供一个Provider来实现对自家基础设施的统一管理。目前Terraform目前支持超过160多种的providers，大多数云平台的Provider插件均已经实现了，阿里云对应的Provider为 <code>alicloud</code> 。</p> <p>在操作环境中，Terraform和Provider是两个独立存在的package，当运行Terraform时，Terraform会根据用户模板中指定的provider或者resource／datasource的标志自动的下载模板所用到的所有provider，并将其放在执行目录下的一个隐藏目录 <code>.terraform</code> 下。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nv>provider</span><span class=w> </span><span class=s2>&quot;alicloud&quot;</span><span class=w> </span><span class=k>{</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>  </span><span class=nv>version</span><span class=w>              </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;&gt;=1.56.0&quot;</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>  </span><span class=nv>region</span><span class=w>               </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;cn-hangzhou&quot;</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>  </span><span class=nv>configuration_source</span><span class=w> </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;terraform-alicloud-modules/classic-load-balance&quot;</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=k>}</span>
</code></pre></div> <p>模板中显示指定了一个阿里云的Provider，并显示设置了provider的版本为 <code>1.56.0+</code> （默认下载最新的版本），指定了需要管理资源的region，指定了当前这个模板的标识。 通常Provider都包含两个主要元素 resource 和 data source。</p> <h3 id=43-resource>4.3 <strong>Resource：基础设施资源和服务的管理</strong><a class=headerlink href=#43-resource title="Permanent link">&para;</a></h3> <p>在Terraform中，一个具体的资源或者服务称之为一个resource，比如一台ECS 实例，一个VPC网络，一个SLB实例。每个特定的resource包含了若干可用于描述对应资源或者服务的属性字段，通过这些字段来定义一个完整的资源或者服务，比如实例的名称（name），实例的规格（instance_type），VPC或者VSwitch的网段（cidr_block）等。</p> <p>定义一个Resource的语法非常简单，通过 <code>resource</code> 关键字声明，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># 定义一个ECS实例</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>resource<span class=w> </span><span class=s2>&quot;alicloud_instance&quot;</span><span class=w> </span><span class=s2>&quot;default&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>  </span><span class=nv>image_id</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;ubuntu_16_04_64_20G_alibase_20190620.vhd&quot;</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>  </span><span class=nv>instance_type</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;ecs.sn1ne.large&quot;</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>  </span><span class=nv>instance_name</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my-first-vm&quot;</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>  </span><span class=nv>system_disk_category</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;cloud_ssd&quot;</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>  </span>...
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=o>}</span>
</code></pre></div> <ul> <li>其中 <code>alicloud_instance</code> 为**资源类型（Resource Type)**，定义这个资源的类型，告诉Terraform这个Resource是阿里云的ECS实例还是阿里云的VPC。</li> <li><code>default</code> 为**资源名称(Resource Name)**，资源名称在同一个模块中必须唯一，主要用于供其他资源引用该资源。</li> <li>大括号里面的block块为**配置参数(Configuration Arguments)**，定义资源的属性，比如ECS 实例的规格、镜像、名称等。</li> </ul> <p>显然这个Terraform模板的功能为在阿里云上创建一个ECS实例，镜像ID为 <code>ubuntu_16_04_64_20G_alibase_20190620.vhd</code> ，规格为 <code>ecs.sn1ne.large</code> ，自定义了实例名称和系统盘的类型。</p> <p>除此之外，在Terraform中，一个资源与另一个资源的关系也定义为一个资源，如一块云盘与一台ECS实例的挂载，一个弹性IP（EIP）与一台ECS或者SLB实例的绑定关系。这样定义的好处是，一方面资源架构非常清晰，另一方面，当模板中有若干个EIP需要与若干台ECS实例绑定时，只需要通过Terraform的 <code>count</code> 功能就可以在无需编写大量重复代码的前提下实现绑定功能。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>resource<span class=w> </span><span class=s2>&quot;alicloud_instance&quot;</span><span class=w> </span><span class=s2>&quot;default&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>  </span><span class=nv>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>5</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>  </span>...
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=o>}</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>resource<span class=w> </span><span class=s2>&quot;alicloud_eip&quot;</span><span class=w> </span><span class=s2>&quot;default&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>    </span><span class=nv>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>5</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>  </span>...
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=o>}</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>resource<span class=w> </span><span class=s2>&quot;alicloud_eip_association&quot;</span><span class=w> </span><span class=s2>&quot;default&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>  </span><span class=nv>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>5</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>  </span><span class=nv>instance_id</span><span class=w> </span><span class=o>=</span><span class=w> </span>alicloud_instance.default<span class=o>[</span>count.index<span class=o>]</span>.id
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>  </span><span class=nv>allocation_id</span><span class=w> </span><span class=o>=</span><span class=w> </span>alicloud_eip.default<span class=o>[</span>count.index<span class=o>]</span>.id
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=o>}</span>
</code></pre></div> <p>显然这个Terraform模板的功能为在阿里云上创建5个ECS实例和5个弹性IP，并将它们一一绑定。</p> <h3 id=44-data-source>4.4 <strong>Data Source：基础设施资源和服务的查询</strong><a class=headerlink href=#44-data-source title="Permanent link">&para;</a></h3> <p>对资源的查询是运维人员或者系统最常使用的操作，比如，查看某个region下有哪些可用区，某个可用区下有哪些实例规格，每个region下有哪些镜像，当前账号下有多少机器等，通过对资源及其资源属性的查询可以帮助和引导开发者进行下一步的操作。</p> <p>除此之外，在编写Terraform模板时，Resource使用的参数有些是固定的静态变量，但有些情况下可能参数变量不确定或者参数可能随时变化。比如我们创建ECS 实例时，通常需要指定我们自己的镜像ID和实例规格，但我们的模板可能随时更新，如果在代码中指定ImageID和Instance，则一旦我们更新镜像模板就需要重新修改代码。 在Terraform 中，Data Source 提供的就是一个查询资源的功能，每个data source实现对一个资源的动态查询，Data Souce的结果可以认为是动态变量，只有在运行时才能知道变量的值。</p> <p>Data Sources通过 <code>data</code> 关键字声明，如下：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>//<span class=w> </span>Images<span class=w> </span>data<span class=w> </span><span class=nb>source</span><span class=w> </span><span class=k>for</span><span class=w> </span>image_id
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>data<span class=w> </span><span class=s2>&quot;alicloud_images&quot;</span><span class=w> </span><span class=s2>&quot;default&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>  </span><span class=nv>most_recent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span><span class=nv>owners</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;system&quot;</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>  </span><span class=nv>name_regex</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;^ubuntu_18.*_64&quot;</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=o>}</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>data<span class=w> </span><span class=s2>&quot;alicloud_zones&quot;</span><span class=w> </span><span class=s2>&quot;default&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>  </span><span class=nv>available_resource_creation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;VSwitch&quot;</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>  </span><span class=nv>enable_details</span><span class=w>              </span><span class=o>=</span><span class=w> </span><span class=nb>true</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=o>}</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>//<span class=w> </span>Instance_types<span class=w> </span>data<span class=w> </span><span class=nb>source</span><span class=w> </span><span class=k>for</span><span class=w> </span>instance_type
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>data<span class=w> </span><span class=s2>&quot;alicloud_instance_types&quot;</span><span class=w> </span><span class=s2>&quot;default&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=w>  </span><span class=nv>availability_zone</span><span class=w> </span><span class=o>=</span><span class=w> </span>data.alicloud_zones.default.zones.0.id
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=w>  </span><span class=nv>cpu_core_count</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=m>2</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=w>  </span><span class=nv>memory_size</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=m>4</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=o>}</span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>resource<span class=w> </span><span class=s2>&quot;alicloud_instance&quot;</span><span class=w> </span><span class=s2>&quot;web&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=w>  </span><span class=nv>image_id</span><span class=w>        </span><span class=o>=</span><span class=w> </span>data.alicloud_images.default.images<span class=o>[</span><span class=m>0</span><span class=o>]</span>.id
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=w>  </span><span class=nv>instance_type</span><span class=w>   </span><span class=o>=</span><span class=w> </span>data.alicloud_instance_types.default.instance_types<span class=o>[</span><span class=m>0</span><span class=o>]</span>.id
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=w>  </span><span class=nv>instance_name</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;my-first-vm&quot;</span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=w>  </span><span class=nv>system_disk_category</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;cloud_ssd&quot;</span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=w>  </span>...
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=o>}</span>
</code></pre></div> <p>如上例子中的ECS Instance 没有指定镜像ImageID和实例规格，而是通过 <code>data</code>引用，Terraform运行时将首先根据镜像名称前缀选择系统镜像，如果同时有多个镜像满足条件，则选择最新的镜像。实例规格也是类似，在某个可用区下选择2核4G的实例规格进行返回。</p> <h3 id=45-state>4.5 <strong>State：保存资源关系及其属性文件的数据库</strong><a class=headerlink href=#45-state title="Permanent link">&para;</a></h3> <p>Terraform创建和管理的所有资源都会保存到自己的数据库上，这个数据库不是通常意义上的数据库（MySQL，Redis等），而是一个文件名为 <code>terraform.tfstate</code> 的文件，在Terraform 中称之为 <a href="https://yq.aliyun.com/go/articleRenderRedirect?url=https%3A%2F%2Fwww.terraform.io%2Fdocs%2Fstate%2Findex.html"><code>state</code></a><a href="https://yq.aliyun.com/go/articleRenderRedirect?url=https%3A%2F%2Fwww.terraform.io%2Fdocs%2Fstate%2Findex.html"> </a>，默认存放在执行Terraform命令的本地目录下。这个 <code>state</code> 文件非常重要，如果该文件损坏，Terraform 将认为已创建的资源被破坏或者需要重建（实际的云资源通常不会受到影响），因为在执行Terraform命令是，Terraform将会利用该文件与当前目录下的模板做Diff比较，如果出现不一致，Terraform将按照模板中的定义重新创建或者修改已有资源，直到没有Diff，因此可以认为Terraform是一个有状态服务。</p> <p>当涉及多人协作时不仅需要拷贝模板，还需要拷贝 <code>state</code> 文件，这无形中增加了维护成本。幸运的是，目前Terraform支持把 <code>state</code> 文件放到远端的存储服务 <code>OSS</code> 上或者 <code>consul</code> 上，来实现 <code>state</code> 文件和模板代码的分离。具体细节可参考<a href="https://yq.aliyun.com/go/articleRenderRedirect?url=https%3A%2F%2Fwww.terraform.io%2Fdocs%2Fstate%2Fremote.html">官方文档Remote State</a>或者关注后续文章的详细介绍。</p> <h3 id=46-backend-state>4.6 <strong>Backend：存放 State 文件的载体</strong><a class=headerlink href=#46-backend-state title="Permanent link">&para;</a></h3> <p>正如上节提到，Terraform 在创建完资源后，会将资源的属性存放在一个 <code>state</code> 文件中，这个文件可以存放在本地也可以存放在远端。存放 <code>state</code> 文件的载体就是 <a href="https://yq.aliyun.com/go/articleRenderRedirect?url=https%3A%2F%2Fwww.terraform.io%2Fdocs%2Fbackends%2Findex.html"><code>Backend</code></a> 。 <code>Backend</code> 分为本地（local）和远端（remote）两类，默认为本地。远端的类型也非常多，目前官方网站提供的有13种，并且阿里云的<a href="https://yq.aliyun.com/go/articleRenderRedirect?url=https%3A%2F%2Fwww.terraform.io%2Fdocs%2Fbackends%2Ftypes%2Foss.html">OSS</a>就位列其中。</p> <p>使用远端的Backend，既可以降低多人协作时对state的维护成本，而且可以将一些敏感的数据存放在远端，保证了数据的安全性。</p> <h3 id=47-provisioner>4.7 <strong>Provisioner：在机器上执行操作的组件</strong><a class=headerlink href=#47-provisioner title="Permanent link">&para;</a></h3> <p><a href="https://yq.aliyun.com/go/articleRenderRedirect?url=https%3A%2F%2Fwww.terraform.io%2Fdocs%2Fprovisioners%2Findex.html">Provisioner</a> 通常用来在本地机器或者登陆远程主机执行相关的操作，如 <code>local-exec</code> provisioner 用来执行本地的命令， <code>chef</code> provisioner 用来在远程机器安装，配置和执行chef client， <code>remote-exec</code> provisioner 用来登录远程主机并在其上执行命令。</p> <p>Provisioner 通常跟 Provider一起配合使用，provider用来创建和管理资源，provisioner在创建好的机器上执行各种操作。</p> <h3 id=48>4.8 <strong>变量</strong><a class=headerlink href=#48 title="Permanent link">&para;</a></h3> <p>Terraform 运行时会读取工作目录中所有的 *.tf, *.tfvars 文件，所以我们不必把所有的东西都写在单个文件中去，应按职责分列在不同的文件中，例如：</p> <p>provider.tf -- provider 配置</p> <p>terraform.tfvars -- 配置 provider 要用到的变量</p> <p>varable.tf -- 通用变量</p> <p>resource.tf -- 资源定义</p> <p>data.tf -- 包文件定义</p> <p>output.tf -- 输出</p> <p>Terraform引用了一些环境变量来控制部分功能，这些环境变量都不是必需的，但是可以改变一些Terraform的默认行为，帮助用户适配更多应用场景</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a># 操作日志是重要的运维信息来源，用户可以通过设置日志类型TF_LOG和日志保存路径TF_LOG_PATH，将详细的日志打印到stderr，以获取调试信息。TF_LOG支持五种可用值，TRACE，DEBUG，INFO，WARN，ERROR，分别代表五种不同的日志级别，其中TRACE表示最详细的日志
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>export TF_LOG=TRACE   # DEBUG INFO WARN ERROR
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>export TF_LOG_PATH=/root/optf/tf.log
</code></pre></div> <h3 id=49-terraform>4.9 <strong>Terraform中输入变量</strong><a class=headerlink href=#49-terraform title="Permanent link">&para;</a></h3> <p><code>variable</code>是Terraform重要的配置文件类型之一，通过对变量的集中管理，用户可以在资源文件中直接引用变量名进行赋值。首先需要先定义(声明)变量，放到一个<code>.tf</code>文件中，如：</p> <p>创建<code>variable.tf</code>文件，配置参数的默认值</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>variable<span class=w> </span><span class=s2>&quot;access_key&quot;</span><span class=w> </span><span class=o>{}</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>variable<span class=w> </span><span class=s2>&quot;secret_key&quot;</span><span class=w> </span><span class=o>{}</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>variable<span class=w> </span><span class=s2>&quot;region&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>  </span><span class=nv>default</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;us-east-1&quot;</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=o>}</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>variable<span class=w> </span><span class=s2>&quot;f5user&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>  </span><span class=nb>type</span><span class=w> </span><span class=o>=</span><span class=w> </span>string
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>  </span><span class=nv>default</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;admin&quot;</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=o>}</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>variable<span class=w> </span><span class=s2>&quot;f5pass&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=w>  </span><span class=nb>type</span><span class=w> </span><span class=o>=</span><span class=w> </span>string
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>  </span><span class=nv>default</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;admin&quot;</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=o>}</span>
</code></pre></div> <p>上面定义了变量。前两个变量是空的，第三个给了一个默认值(默认参数)。此时运行<code>terraform plan</code>，Terraform会提示输入这些尚未定义的变量。</p> <p>引用变量，使用<code>${var.xxx}</code>的形式。这样在资源配置文件中，参数可以直接调用var.f5user</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>provider<span class=w> </span><span class=s2>&quot;aws&quot;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>  </span><span class=nv>access_key</span><span class=w>    </span><span class=o>=</span><span class=w>   </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>var</span><span class=p>.access_key</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>  </span><span class=nv>secret_key</span><span class=w>    </span><span class=o>=</span><span class=w>   </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>var</span><span class=p>.secret_key</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>  </span><span class=nv>region</span><span class=w>        </span><span class=o>=</span><span class=w>   </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>var</span><span class=p>.region</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=o>}</span>
</code></pre></div> <h3 id=410>4.10 <strong>变量赋值</strong><a class=headerlink href=#410 title="Permanent link">&para;</a></h3> <p>前面我们声明了变量，但是还没有给变量赋值，无法真正使用。给变量赋值，有以下几种方法，下面几种方法按照变量赋值的优先顺序排序。</p> <h4 id=4101>4.10.1 命令行声明<a class=headerlink href=#4101 title="Permanent link">&para;</a></h4> <p>使用terraform的各种命令时，使用<code>-var</code>选项，可以在后面直接跟变量的定义，如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>    # terraform apply \
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>      -var &#39;access_key=foo&#39; 
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>      -var &#39;secret_key=bar&#39;
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    # ...
</code></pre></div> <p>以这种方式赋值变量是一次性的，并不会保存它们的值，也就是说下一次重新执行命令时，需要重新赋值。</p> <p>在terraform apply中，直接设置变量值会覆盖掉<code>variable.tf</code>中设置的默认值</p> <h4 id=4102>4.10.2 从文件导入<a class=headerlink href=#4102 title="Permanent link">&para;</a></h4> <p>为永久性存储一个变量的值，可以将其放在文件中保存。Terraform会自动加载当前目录下扩展名为<code>.tfvars</code>和<code>.auto.tfvars</code>的文件来填充定义的变量。如果以其他格式存放，可以使用<code>-var-file</code>选项来手动指定需要加载的变量值文件。这些文件使用Terraform格式或JSON格式。</p> <p>使用文件也方便版本控制，但是用户名、密码这种东西就不要用版本控制管理的。因此可以将用户名和密码这类信息单独放在一个文件中，使用<code>-var-file</code>来手动指定。其他的，可以自动填充，方便使用版本控制管理的，可以直接放在<code>.tfvars</code>文件中，Terraform会自动加载。</p> <h4 id=4103>4.10.3 环境变量<a class=headerlink href=#4103 title="Permanent link">&para;</a></h4> <p>Terraform会读取<code>TF_VAR_name</code>这种格式的环境变量，用来填充定义好的变量。比如，环境变量中有一个<code>TF_VAR_access_key</code>的变量，Terraform就会读取到，并用于填充<code>access_key</code>变量。</p> <h4 id=4104-default>4.10.4 default值<a class=headerlink href=#4104-default title="Permanent link">&para;</a></h4> <p>如果某个变量没有采用以上任何一种方法来进行赋值，那么如果在变量的定义中有个<code>default</code>属性，那么Terraform就会使用<code>default</code>的值来对变量进行赋值。</p> <h4 id=4105>4.10.5<a class=headerlink href=#4105 title="Permanent link">&para;</a></h4> <p>没有使用任何方法来对变量赋值，在输入命令时使得Terraform不知道如何处理，此时就会出现交互界面，让用户手动输入变量值，来给变量赋值。</p> <p>也可以利用<code>TF_VAR_name</code>把变量设置在环境变量中</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>export TF_VAR_f5user=&quot;admin&quot;
</code></pre></div> <p>配置<code>TF_INPUT</code>，可以关闭对未指定值的变量的提示。将刚才的<code>variable.tf</code>中设置的参数删除</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>export export TF_INPUT=1
</code></pre></div> <p>执行Terraform指令，会要求写入参数值</p> <p>设置<code>TF_INPUT</code>为<code>false</code>或<code>0</code>，再次执行指令，系统报错：未指定变量的值</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>export export TF_INPUT=0
</code></pre></div> <p>CLI Config File</p> <p>用户可以通过CLI的配置文件对CLI进行一些设置，适用于所有Terraform的工作目录，与资源配置文件是区分开的。</p> <p>配置文件中支持的参数有：</p> <p>① 是否开启更新与安全检查：<code>disable_checkpoint</code></p> <p>② 允许更新与安全检查，但禁止使用匿名id删除警告消息：<code>disable_checkpoint_signature</code></p> <p>③ 启用插件缓存，以字符串的形式指定插件缓存目录的位置：<code>plugin_cache_dir</code></p> <p>④ Terraform企业版凭证：<code>credentials</code></p> <p>可以在环境变量中配置CLI Config File的位置</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>export TF_CLI_CONFIG_FILE=&quot;$HOME/.terraformrc-custom&quot;
</code></pre></div> <h2 id=_2>五 资源管理常用命令<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <h3 id=51-terraform-plan>5.1 <strong>terraform plan</strong>：资源的预览<a class=headerlink href=#51-terraform-plan title="Permanent link">&para;</a></h3> <p>在初始化目录下执行 <code>terraform plan</code> 查看部署计划；参数前面的<code>+</code>代表新添加的资源，当销毁资源时，参数前面对应的符号会变为<code>-</code>；更改一些参数需要重新部署资源时，该资源前面的符号为<code>-/+</code>；在旧参数和新参数内容之间有<code>→</code>符号标识。</p> <p>plan命令用于对模板中所定义资源的预览，主要用于以下几个场景：</p> <ul> <li> <p>预览当前模板中定义的资源是否符合管理预期，和Markdown的预览功能类似。</p> </li> <li> <p>如果当前模板已经存在对应的state文件，那么plan命令将会展示模板定义与state文件内容的diff结果，如果有变更，会将结果在下方显示出来。</p> </li> <li>对DataSource而言，执行plan命令，即可直接获取并输出所要查询的资源及其属性。</li> </ul> <h3 id=52-terraform-apply>5.2 <strong>terraform apply</strong>：资源的新建和变更<a class=headerlink href=#52-terraform-apply title="Permanent link">&para;</a></h3> <p>apply命令用于实际资源的新建和变更操作，为了安全起见，在命令运行过程中增加了人工交互的过程，即需要手动确认是否继续，当然也可以通过**--auto-approve**参数来跳过人工确认的过程。</p> <p>apply命令适用于以下几种场景：</p> <ul> <li>创建新的资源。</li> <li>通过修改模板参数来修改资源的属性。</li> <li>如果从当前模板中删除某个资源的定义，apply命令会将该资源彻底删除。可以理解为“资源的移除也是一种变更”。</li> </ul> <h3 id=53-terraform-show>5.3 <strong>terraform show</strong>：资源的展示<a class=headerlink href=#53-terraform-show title="Permanent link">&para;</a></h3> <p>show命令用于展示当前state中所有被管理的资源及其所有属性值。</p> <h3 id=54-terraform-destroy>5.4 <strong>terraform destroy</strong>：资源的释放<a class=headerlink href=#54-terraform-destroy title="Permanent link">&para;</a></h3> <p>destroy命令用于对资源的释放操作，为了安全起见，在命令执行过程中，也增加了人工交互的过程，如果想要跳过手动确认操作，可以通过**--force**参数来跳过。</p> <p>terraform destroy默认会释放当前模板中定义的所有资源，如果只想释放其中某个特定的资源，可以通过参数<code>-target=&lt;资源类型&gt;.&lt;资源名称&gt;</code>来指定。</p> <h3 id=55-terraform-import>5.5 <strong>terraform import</strong>：资源的导入<a class=headerlink href=#55-terraform-import title="Permanent link">&para;</a></h3> <p>import命令用于将存量的云资源导入到terraform state中，进而加入到Terraform的管理体系中</p> <h3 id=56-terraform-taint>5.6 <strong>terraform taint</strong>：标记资源为被污染<a class=headerlink href=#56-terraform-taint title="Permanent link">&para;</a></h3> <p>taint命令用于把某个资源标记为被污染状态，当再次执行apply命令时，这个被污染的资源将会被先释放，然后再创建一个新的，相当于对这个特定资源做了先删除后新建的操作。</p> <p>命令的详细格式为： <code>terraform taint &lt;资源类型&gt;.&lt;资源名称&gt;</code> ，如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>terraform taint bigip_ltm_pool_attachment.attach_nodeqat01
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>Resource instance bigip_ltm_pool_attachment.attach_nodeqat01 has been marked as tainted.
</code></pre></div> <h3 id=57-terraform-untaint>5.7 <strong>terraform untaint</strong>：取消被污染标记<a class=headerlink href=#57-terraform-untaint title="Permanent link">&para;</a></h3> <p>untaint命令是taint的逆向操作，用于取消被污染标记，使其恢复到正常的状态。命令的详细格式和taint类似为：<code>terraform untaint &lt;资源类型&gt;.&lt;资源名称&gt;</code> ，如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>terraform untaint untaint bigip_ltm_pool_attachment.attach_nodeqat01
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>Resource instance bigip_ltm_pool_attachment.attach_nodeqat01 has been successfully untainted.
</code></pre></div> <h3 id=58-terraform-output>5.8 <strong>terraform output</strong>：打印出参及其值<a class=headerlink href=#58-terraform-output title="Permanent link">&para;</a></h3> <p>如果在模板中显示定义了output参数，那么这个output的值将在apply命令之后展示，但plan命令并不会展示，如果想随时随地快速查看output的值，可以直接运行命令 terraform output</p> <p>Terraform对资源状态的管理，实际上是对State文件中数据的管理。State文件保存了当前Terraform管理的所有资源及其属性，内容都是由Terraform自动存储的，为了保证数据的完整性，不建议手动修改State内容。对State数据的操作可以通过**terraform state**命令来完成。</p> <h3 id=59-terraform-state-liststate>5.9 <strong>terraform state list</strong>：列出当前state中的所有资源<a class=headerlink href=#59-terraform-state-liststate title="Permanent link">&para;</a></h3> <p>**state list**命令会按照 <code>&lt;资源类型&gt;.&lt;资源名称&gt;</code> 的格式列出当前state中存在的所有资源（包括datasource），例如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>$ terraform state list
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>data.alicloud_slbs.default
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>alicloud_vpc.default
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>alicloud_vswitch.this
</code></pre></div> <h3 id=510-terraform-state-show>5.10 <strong>terraform state show</strong>：展示某一个资源的属性<a class=headerlink href=#510-terraform-state-show title="Permanent link">&para;</a></h3> <p>**state show**命令按照Key-Value的格式展示出特定资源的所有属性及其值，命令的完整格式为 <code>terraformstate show &lt;资源类型&gt;.&lt;资源名称&gt;</code> ，例如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>$ terraform state show alicloud_vswitch.this
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a># alicloud_vswitch.this:
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>resource &quot;alicloud_vswitch&quot; &quot;this&quot; {  
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>    availability_zone = &quot;eu-central-1a&quot;
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>    cidr_block        = &quot;172.16.0.0/24&quot;
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>    id                = &quot;vsw-gw8gl31wz******&quot;
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>    vpc_id            = &quot;vpc-gw8calnzt*******&quot;
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>}
</code></pre></div> <h3 id=511-terraform-state-pullstate>5.11 <strong>terraform state pull</strong>：获取当前state内容并展示<a class=headerlink href=#511-terraform-state-pullstate title="Permanent link">&para;</a></h3> <p>**state pull**命令用于原样展示当前state文件数据，类似与Shell下的cat命令，例如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>$ terraform state pull
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>{
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>    &quot;version&quot;: 4,
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>    &quot;terraform_version&quot;: &quot;0.12.8&quot;,
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>    &quot;serial&quot;: 615, 
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>    &quot;lineage&quot;: &quot;39aeeee2-b3bd-8130-c897-2cb8595cf8ec&quot;, 
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>    &quot;outputs&quot;: {
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>        ***
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>    }
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>  }, 
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>&quot;resources&quot;: [
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>    {     
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>        &quot;mode&quot;: &quot;data&quot;,    
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>        &quot;type&quot;: &quot;alicloud_slbs&quot;,     
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>        &quot;name&quot;: &quot;default&quot;,     
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>        &quot;provider&quot;: &quot;provider.alicloud&quot;,
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a>          ***
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>    },
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a>    {     
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a>        &quot;mode&quot;: &quot;managed&quot;,    
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a>        &quot;type&quot;: &quot;alicloud_vpc&quot;,     
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a>        &quot;name&quot;: &quot;default&quot;,    
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a>        &quot;provider&quot;: &quot;provider.alicloud&quot;,
<a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a>          ***
<a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a>    }
<a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a>  ]
<a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a>}
</code></pre></div> <h3 id=512-terraform-state-rm>5.12 <strong>terraform state rm</strong>：移除特定的资源<a class=headerlink href=#512-terraform-state-rm title="Permanent link">&para;</a></h3> <p>**state rm**命令用于将state中的某个资源移除，但是实际上并不会真正删除这个资源，命令格式为：<code>terraformstate rm &lt;资源类型&gt;.&lt;资源名称&gt;</code> ，例如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>$ terraform state rm alicloud_vswitch.this
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>Removed alicloud_vswitch.this
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>Successfully removed 1 resource instance(s).
</code></pre></div> <p>移除后，如果模板内容不变并且再次执行**apply**命令，将会新增一个同样的资源。移除后的资源可以再次通过**import**命令再次加入。</p> <h3 id=513-terraform-state-mv>5.13 <strong>terraform state mv</strong>：变更特定资源的存放地址<a class=headerlink href=#513-terraform-state-mv title="Permanent link">&para;</a></h3> <p>如果想调整某个资源所在的state文件，可以通过**state mv**命令来完成，类似于Shell下的**mv**命令，这个命令的使用有多种选项，可以通过命令 <strong>terraform state mv --help</strong> 来详细了解。本文只介绍最常用的一种：<code>terraform state mv --state=./terraform.tfstate --state-out=&lt;target path&gt;/terraform-target.tfstate &lt;资源类型&gt;.&lt;资源名称A&gt; &lt;资源类型&gt;.&lt;资源名称B&gt;</code> ，如：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>$ terraform state mv --state-out=../tf.tfstate alicloud_vswitch.this alicloud_vswitch.default
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>Move &quot;alicloud_vswitch.this&quot; to &quot;alicloud_vswitch.default&quot;
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>Successfully moved 1 object(s)
</code></pre></div> <p>如上命令省略了默认的<code>--state=./terraform.tfstate</code>选项，命令最终的结果是将当前State中的VSwitch资源移动到了上层目录下名为 <code>tf.tfstate</code> 的State中，并且将VSwitch的资源名称由“this”改为了“default”。</p> <h3 id=514-terraform-refreshstate>5.14 <strong>terraform refresh</strong>：刷新当前state<a class=headerlink href=#514-terraform-refreshstate title="Permanent link">&para;</a></h3> <p>**refresh**命令可以用来刷新当前State的内容，即再次调用API并拉取最新的数据写入到state文件中。</p> <h3 id=515-terraform-graph>5.15 <strong>terraform graph</strong>：输出当前模板定义的资源关系图<a class=headerlink href=#515-terraform-graph title="Permanent link">&para;</a></h3> <p>每个模板定义的资源之间都存在不同程度的关系，如果想看资源关系图，可以使用命令**terraform graph**:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>$ terraform graph
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>digraph {
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>        compound = &quot;true&quot;
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>        newrank = &quot;true&quot;
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>        subgraph &quot;root&quot; {
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>                &quot;[root] alicloud_vpc.default&quot; [label = &quot;alicloud_vpc.default&quot;, shape = &quot;box&quot;]
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>                &quot;[root] alicloud_vswitch.this&quot; [label = &quot;alicloud_vswitch.this&quot;, shape = &quot;box&quot;]             
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>                ******
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>                &quot;[root] output.vswitchId&quot; -&gt; &quot;[root] alicloud_vswitch.this&quot;
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>                &quot;[root] provider.alicloud (close)&quot; -&gt; &quot;[root] alicloud_vswitch.this&quot;
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>                ******
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>                &quot;[root] root&quot; -&gt; &quot;[root] provider.alicloud (close)&quot;
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>        }
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>} 
</code></pre></div> <p>该命令的结果还可以通过命令<code>terraform graph | dot -Tsvg &gt; graph.svg</code>直接导出为一张图片（需要提前安装graphviz： <code>brew install graphviz</code>）：</p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20211210134911.png></p> <h3 id=516-terraform-validate>5.16 <strong>terraform validate</strong>：验证模板语法是否正确<a class=headerlink href=#516-terraform-validate title="Permanent link">&para;</a></h3> <p>Terraform模板的编写需要遵循其自身定义的一套简单的语法规范，编写完成后，如果想要检查模板是否存在语法错误或者在运行**plan**和**apply**命令的时候报语法错误，可以通过执行命令**terraform validate**来检查和定位错误出现的详细位置和原因。</p> <p><em>详细介绍每一个具体的指令，包括如何使用和可能遇到的问题</em></p> <ul> <li>apply</li> </ul> <p><code>terraform apply</code> 用于应用所需的更改，以达到所需的配置状态，同时执行结果会保存在本地状态文件<code>terraform.tfstate</code>中。</p> <p><strong>标准语法：</strong><code>terraform apply [options] [dir-or-plan]</code></p> <ul> <li><code>options</code>用来填写<code>apply</code>的flags</li> <li><code>dir-or-plan</code>用来指定配置计划或计划的路径</li> </ul> <p>在当前目录只配置<code>provider.tf</code>，不添加任何资源文件，执行<code>terraform apply</code>，显示没有任何资源被部署</p> <p>在当前目录执行<code>terraform apply ./tftest</code>命令，创建在<code>/tftest</code>目录的资源文件将被部署</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>terraform apply ./tftest
</code></pre></div> <p>options</p> <ul> <li><code>-backup=path</code> - 备份文件的路径，设置为<code>-</code>时表示禁用</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>terraform apply -backup=-
</code></pre></div> <p>删除<code>terraform.tfstate.backup</code>，执行<code>terraform apply -backup=-</code>，不再自动保存备份</p> <ul> <li><code>-auto-approve</code> - 跳过部署计划前的审批过程，直接创建资源</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>terraform apply -auto-approve
</code></pre></div> <ul> <li><code>-no-color</code> - 禁用输出时字符的颜色</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>terraform apply -no-color
</code></pre></div> <ul> <li><code>-parallelism=n</code> - 限制并发操作的数量，默认是<code>10</code></li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>terraform apply -parallelism=5
</code></pre></div> <ul> <li><code>-refresh=true</code> - 在计划和应用之前，更新每一个资源的状态</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>terraform apply -refresh=true
</code></pre></div> <ul> <li><code>-state=path</code> - 状态文件的路径，默认为<code>terraform.tfstate</code></li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>terraform apply -state=./test_state
</code></pre></div> <p>删除<code>terraform.tfstate</code>，执行<code>terraform apply -state=./test_state</code>，将状态文件保存在当前文件夹下的<code>test_state</code>中</p> <ul> <li>console</li> </ul> <p><code>terraform console</code>提供了一个用于评估和验证表达式的交互控制台。</p> <p><strong>标准语法：</strong><code>terraform console [options] [dir]</code></p> <ul> <li><code>options</code>用来填写<code>console</code>的flags</li> <li><code>dir</code>用来指定要使用的目录，默认为当前目录</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>    // Evaluating and experimenting with expressions
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>    $ echo &quot;1 + 2&quot; | terraform console
</code></pre></div> <ul> <li>destroy</li> </ul> <p><code>terraform destroy</code>用于销毁terraform管理的基础设施。</p> <p><strong>标准语法：</strong><code>terraform destroy [options] [dir]</code></p> <p><code>options</code>用来填写<code>destroy</code>的flags</p> <ul> <li><code>dir</code>用来指定要使用的目录，默认为当前目录</li> <li> <p><code>-auto-approve</code> - 同<code>apply</code>命令中的<code>-auto-approve</code>，跳过销毁计划前的审批过程，直接销毁资源</p> </li> <li> <p>fmt</p> </li> </ul> <p><code>terraform fmt</code>用于将terraform配置文件重写为规范格式和样式，确保文件的一致性。在升级Terraform之后，建议您在模块上预先运行<code>Terraform fmt</code>，使之前的文件适配新版本。</p> <p><strong>标准语法：</strong><code>terraform fmt [options] [dir]</code></p> <ul> <li><code>options</code>用来填写<code>fmt</code>的flags</li> <li><code>dir</code>用来指定要使用的目录，默认为当前目录</li> <li><code>-list=false</code> - 不列出格式不一致的文件</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>    // Don&#39;t list the files containing formatting inconsistencies
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>    $ terraform fmt -list=false
</code></pre></div> <ul> <li><code>-diff</code> - 显示格式更改的差异</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>    // Display diffs of formatting changes
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>    $ terraform fmt -diff
</code></pre></div> <h2 id=_3>参考链接<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <ul> <li><a href=https://github.com/ilzj/terraform-book/blob/main/learn.md>https://github.com/ilzj/terraform-book/blob/main/learn.md</a></li> </ul> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/redhatxl/redhatxl.github.io/issues/new/?title=[Feedback]+Terraform%20book+-+/devops/IaC/Terraform/terraform-book/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2016 - 2024 kaliarch </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/redhatxl target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../../..", "features": ["content.code.annotate", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../../assets/javascripts/bundle.bd41221c.min.js></script> </body> </html>