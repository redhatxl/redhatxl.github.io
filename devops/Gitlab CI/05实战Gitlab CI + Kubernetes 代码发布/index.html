<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=Kaliarch><link href=https://redhatxl.github.io/devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/ rel=canonical><link href=../04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/ rel=prev><link href=../Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.16"><title>5.实战Kubernetes Gitlab CI - Kaliarch Blog</title><link rel=stylesheet href=../../../assets/stylesheets/main.bcfcd587.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-G9D2HRH134"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-G9D2HRH134",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-G9D2HRH134",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#5kubernetes-gitlab-ci class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title="Kaliarch Blog" class="md-header__button md-logo" aria-label="Kaliarch Blog" data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kaliarch Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 5.实战Kubernetes Gitlab CI </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=light-blue data-md-color-accent=purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/redhatxl/redhatxl.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> redhatxl.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../../cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/ class=md-tabs__link> 云原生 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/ class=md-tabs__link> devops </a> </li> <li class=md-tabs__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/ class=md-tabs__link> 开发技术 </a> </li> <li class=md-tabs__item> <a href=../../../linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../other/ class=md-tabs__link> 其他 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Kaliarch Blog" class="md-nav__button md-logo" aria-label="Kaliarch Blog" data-md-component=logo> <img src=../../../assets/images/logo.png alt=logo> </a> Kaliarch Blog </label> <div class=md-nav__source> <a href=https://github.com/redhatxl/redhatxl.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> redhatxl.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> 云原生 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 云原生 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-native/develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 1.K8s 开发概念简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.K8s API访问方式 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/03-Client-go%20%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Client-go 的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 4.Cobra+Client-go实现K8s插件开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 5.Client-go源码分析之ListerWatcher </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 6.Client-go源码分析之Reflector </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 7.Client-go源码分析之DeltaFIFO </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 8.Client-go源码分析之Informer </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 9.Client-go源码分析之SharedInformer </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 10.Client-go源码分析之Indexer </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 11.Client-go源码分析之WorkQueue </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/12-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Controller/ class=md-nav__link> <span class=md-ellipsis> 12.自定义实现Controller </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/13-%E8%AE%A4%E8%AF%86CRD/ class=md-nav__link> <span class=md-ellipsis> 13.认识CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/x-Informer%E5%AE%9E%E6%88%98%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96K8s%E4%BA%8B%E4%BB%B6%E8%87%B3ElasticSearch/ class=md-nav__link> <span class=md-ellipsis> x-Informer实战之持久化K8s事件至ElasticSearch </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/develop/x-DeltaFIFO%E5%92%8Cindexer%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94/ class=md-nav__link> <span class=md-ellipsis> x-DeltaFIFO 与 Indexer关系 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 运维 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 运维 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_1> <label class=md-nav__link for=__nav_2_2_1 id=__nav_2_2_1_label tabindex=0> <span class=md-ellipsis> 工具 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_1> <span class="md-nav__icon md-icon"></span> 工具 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-native/operator/tools/K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/ class=md-nav__link> <span class=md-ellipsis> K8s可视化工具之KUR8 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/tools/K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/ class=md-nav__link> <span class=md-ellipsis> K8s快捷操作工具之K9s </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/tools/K8s%E8%89%B2%E5%BD%A9%E8%BE%93%E5%87%BA%E5%B7%A5%E5%85%B7%E4%B9%8Bkubecolor/ class=md-nav__link> <span class=md-ellipsis> K8s色彩输出工具之kubecolor </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/tools/K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/ class=md-nav__link> <span class=md-ellipsis> K8s日志查看利器之kubetail </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/tools/K8s%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%E4%B9%8Bsniff/ class=md-nav__link> <span class=md-ellipsis> K8s 网络抓包之sniff </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/tools/Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> Kubernetes 六款备份还原工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/tools/k8s%E6%8F%92%E4%BB%B6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E4%B9%8Bkrew/ class=md-nav__link> <span class=md-ellipsis> k8s 插件管理工具之krew </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/tools/%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/ class=md-nav__link> <span class=md-ellipsis> 架构图神器DaC之Diagram </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 云原生备份恢复之velero实战 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2> <label class=md-nav__link for=__nav_2_2_2 id=__nav_2_2_2_label tabindex=0> <span class=md-ellipsis> 部署 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> 部署 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-native/operator/deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> Ceph机器安装部署 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之Minikube </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之K3s </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之Kind </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之MicroK8s </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3> <label class=md-nav__link for=__nav_2_2_3 id=__nav_2_2_3_label tabindex=0> <span class=md-ellipsis> servicemesh </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3> <span class="md-nav__icon md-icon"></span> servicemesh </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3_1> <label class=md-nav__link for=__nav_2_2_3_1 id=__nav_2_2_3_1_label tabindex=0> <span class=md-ellipsis> istio </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3_1> <span class="md-nav__icon md-icon"></span> istio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/Envoy%E7%AC%94%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> Envoy笔记 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/服务网格进阶实战.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/详解.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/Istio%E4%B9%8BXDS%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> Istio之XDS协议解析 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8BGateway/ class=md-nav__link> <span class=md-ellipsis> Istio笔记之Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/ class=md-nav__link> <span class=md-ellipsis> Istio笔记之pilot </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> Istio灰度发布 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/Istio之流量管理.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> Istio简介及架构 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/ class=md-nav__link> <span class=md-ellipsis> Istio微服务治理笔记(一) </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> Istio基础之服务网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/微服务金丝雀发布.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/servicemesh/istio/istio%E7%AC%94%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> istio笔记 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_4> <label class=md-nav__link for=__nav_2_2_4 id=__nav_2_2_4_label tabindex=0> <span class=md-ellipsis> 排错 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_4> <span class="md-nav__icon md-icon"></span> 排错 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-native/operator/other/k8s%20%E9%9B%86%E7%BE%A4etcd%E6%8E%92%E9%94%99/ class=md-nav__link> <span class=md-ellipsis> k8s 集群etcd排错 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/other/CronHPA/ class=md-nav__link> <span class=md-ellipsis> CronHPA初探 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 记一次K8smaster 节点一次排错实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/operator/other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/ class=md-nav__link> <span class=md-ellipsis> 记一次线上k8s节点维护 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_5> <label class=md-nav__link for=__nav_2_2_5 id=__nav_2_2_5_label tabindex=0> <span class=md-ellipsis> 容器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_5> <span class="md-nav__icon md-icon"></span> 容器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> Dockerfile 最佳实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Docker底层原理 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Podman详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 利用katacoda实现拉取国外镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 镜像底层原理 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/ class=md-nav__link> <span class=md-ellipsis> Harbor/registry镜像仓库部署 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 安全 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 安全 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/ class=md-nav__link> <span class=md-ellipsis> K8s 安全之Kube-bench </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/Kubeeye%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> KubeEye源码分析 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全之KubeEye </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全之NPD </span> </a> </li> <li class=md-nav__item> <a href="../../../cloud-native/安全/Kubernetes安全之Open/ Policy/ Agent.md" class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bopenebs/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全之openebs </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全分析 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/ class=md-nav__link> <span class=md-ellipsis> kubernetes安全之Polaris </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全扫描之kubescape </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/ class=md-nav__link> <span class=md-ellipsis> 镜像安全扫描之Trivy </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/ class=md-nav__link> <span class=md-ellipsis> 开源容器安全平台之NeuVector </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-native/other/inside-kubernetes%20controller/ class=md-nav__link> <span class=md-ellipsis> Inside Kubernetes controller </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/other/Kubectl插件开发及开业分享.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/other/KubeEdge/ class=md-nav__link> <span class=md-ellipsis> KubeEdge初探 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> Kubernetes开发排错杂记 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/ class=md-nav__link> <span class=md-ellipsis> Kubernetes生成kubeconfig </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 华为云原生CCE实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/ class=md-nav__link> <span class=md-ellipsis> 微服务API网关-Kong </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-native/other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 微服务架构中10种常用设计模式 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> devops </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> GitLab CI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> GitLab CI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/ class=md-nav__link> <span class=md-ellipsis> 1.敏捷无敌之Gitlab CI </span> </a> </li> <li class=md-nav__item> <a href=../02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> 2.敏捷无敌之Gitlab CI架构流程详解 </span> </a> </li> <li class=md-nav__item> <a href=../03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 3.实战Gitlab CI + Supervisor 发布Python项目 </span> </a> </li> <li class=md-nav__item> <a href=../04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/ class=md-nav__link> <span class=md-ellipsis> 4.实战前后端项目及混合环境Gitlab CI </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 5.实战Kubernetes Gitlab CI </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 5.实战Kubernetes Gitlab CI </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 一 背景 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 二 架构解析 </span> </a> <nav class=md-nav aria-label="二 架构解析"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-gitlab-ci class=md-nav__link> <span class=md-ellipsis> 2.1 Gitlab CI流程图 </span> </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> <span class=md-ellipsis> 2.2 流程详解 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 三 优点 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 四 实战 </span> </a> <nav class=md-nav aria-label="四 实战"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41 class=md-nav__link> <span class=md-ellipsis> 4.1 环境准备 </span> </a> <nav class=md-nav aria-label="4.1 环境准备"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#411 class=md-nav__link> <span class=md-ellipsis> 4.1.1 记录注册信息 </span> </a> </li> <li class=md-nav__item> <a href=#412-gitlab-runner class=md-nav__link> <span class=md-ellipsis> 4.1.2 获取gitlab-runner </span> </a> </li> <li class=md-nav__item> <a href=#413-dockersock class=md-nav__link> <span class=md-ellipsis> 4.1.3 绑定docker.sock </span> </a> </li> <li class=md-nav__item> <a href=#414 class=md-nav__link> <span class=md-ellipsis> 4.1.4 配置缓存 </span> </a> </li> <li class=md-nav__item> <a href=#415-gitlab-runner class=md-nav__link> <span class=md-ellipsis> 4.1.5 安装gitlab-runner </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#42-ci class=md-nav__link> <span class=md-ellipsis> 4.2 集成CI </span> </a> <nav class=md-nav aria-label="4.2 集成CI"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#421 class=md-nav__link> <span class=md-ellipsis> 4.2.1 定义文件 </span> </a> </li> <li class=md-nav__item> <a href=#422 class=md-nav__link> <span class=md-ellipsis> 4.2.2 注意事项 </span> </a> </li> <li class=md-nav__item> <a href=#423 class=md-nav__link> <span class=md-ellipsis> 4.2.3 配置变量 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#43 class=md-nav__link> <span class=md-ellipsis> 4.3 运行测试 </span> </a> <nav class=md-nav aria-label="4.3 运行测试"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#431-pipeline class=md-nav__link> <span class=md-ellipsis> 4.3.1 运行pipeline </span> </a> </li> <li class=md-nav__item> <a href=#432-pod class=md-nav__link> <span class=md-ellipsis> 4.3.2 查看运行POD </span> </a> </li> <li class=md-nav__item> <a href=#433-job class=md-nav__link> <span class=md-ellipsis> 4.3.3 查看Job </span> </a> </li> <li class=md-nav__item> <a href=#434 class=md-nav__link> <span class=md-ellipsis> 4.3.4 查看构建情况 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 五 注意事项 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 六 应用场景 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 七 反思 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/ class=md-nav__link> <span class=md-ellipsis> Gitlab CI之单元测试和代码扫描 </span> </a> </li> <li class=md-nav__item> <a href=../Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Gitlab CI进阶之共享CI库 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> IaC </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> IaC </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/ class=md-nav__link> <span class=md-ellipsis> IaC扫描工具之Terrascan </span> </a> </li> <li class=md-nav__item> <a href=../../IaC/Terraform/IaC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B9%8BTerratest/ class=md-nav__link> <span class=md-ellipsis> IaC测试工具之Terratest </span> </a> </li> <li class=md-nav__item> <a href=../../IaC/Terraform/terraform-book/ class=md-nav__link> <span class=md-ellipsis> Terraform book </span> </a> </li> <li class=md-nav__item> <a href=../../IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> Terraform 相关概念及函数 </span> </a> </li> <li class=md-nav__item> <a href=../../IaC/Terraform/terraform%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> Terraform 最佳实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../other/Argo%20CD/ class=md-nav__link> <span class=md-ellipsis> Argo CD </span> </a> </li> <li class=md-nav__item> <a href=../../other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/ class=md-nav__link> <span class=md-ellipsis> IaC之Terraform 与Pulumi使用对比 </span> </a> </li> <li class=md-nav__item> <a href=../../other/Packer/ class=md-nav__link> <span class=md-ellipsis> 镜像定义工具Packer实战 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> 开发技术 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 开发技术 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 设计模式 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 设计模式 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1_1> <label class=md-nav__link for=__nav_4_1_1 id=__nav_4_1_1_label tabindex=0> <span class=md-ellipsis> 创建型 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_1> <span class="md-nav__icon md-icon"></span> 创建型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.简单工厂模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.工厂方法模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 3.抽象工厂模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4.建造者(生成器)模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 5.单例模式 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1_2> <label class=md-nav__link for=__nav_4_1_2 id=__nav_4_1_2_label tabindex=0> <span class=md-ellipsis> 结构型 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_2> <span class="md-nav__icon md-icon"></span> 结构型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.装饰器模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.代理模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 3.桥接模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4.适配器模式 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1_3> <label class=md-nav__link for=__nav_4_1_3 id=__nav_4_1_3_label tabindex=0> <span class=md-ellipsis> 行为型 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_3> <span class="md-nav__icon md-icon"></span> 行为型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.策略模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.观察者模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.模版模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4.职责链模式 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_1> <label class=md-nav__link for=__nav_4_2_1 id=__nav_4_2_1_label tabindex=0> <span class=md-ellipsis> Gin </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_1> <span class="md-nav__icon md-icon"></span> Gin </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/ class=md-nav__link> <span class=md-ellipsis> Gin框架热加载 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/Golang/gin/gin-swagger/ class=md-nav__link> <span class=md-ellipsis> Gin + Swagger快速生成API文档 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/Golang/gin/gin-validator%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/ class=md-nav__link> <span class=md-ellipsis> gin-validator参数校验 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/ class=md-nav__link> <span class=md-ellipsis> Gin框架优雅关机和重启 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_2> <label class=md-nav__link for=__nav_4_2_2 id=__nav_4_2_2_label tabindex=0> <span class=md-ellipsis> 开发规范 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_2> <span class="md-nav__icon md-icon"></span> 开发规范 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之性能01 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范01 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范02 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范03 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范04 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9901/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则01 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之编程模式01 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则02 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则03 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9904/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则04 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则05 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_3> <label class=md-nav__link for=__nav_4_2_3 id=__nav_4_2_3_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_3> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/ class=md-nav__link> <span class=md-ellipsis> Golang 分布式链路追踪之jaeger </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/Golang/golang%20%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/ class=md-nav__link> <span class=md-ellipsis> Go 内存对齐 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 系统相关 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 系统相关 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Linux grub/grub2详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Linux 内核引导详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> Linux 系统安全加固最佳实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/system/virtio%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Virtio 详解 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/2.Shell%E5%8F%98%E9%87%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Shell 变量 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell 参数 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell 运算符 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 7.Shell test 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell 流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 8.Shell 函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell输入/输出重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell 正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell 三剑客之grep </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell三剑客之sed </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell三剑客之awk </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 15.Shell常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../other/ class=md-nav__link> <span class=md-ellipsis> 工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../other/ class=md-nav__link> <span class=md-ellipsis> 杂记 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 一 背景 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 二 架构解析 </span> </a> <nav class=md-nav aria-label="二 架构解析"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-gitlab-ci class=md-nav__link> <span class=md-ellipsis> 2.1 Gitlab CI流程图 </span> </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> <span class=md-ellipsis> 2.2 流程详解 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 三 优点 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 四 实战 </span> </a> <nav class=md-nav aria-label="四 实战"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41 class=md-nav__link> <span class=md-ellipsis> 4.1 环境准备 </span> </a> <nav class=md-nav aria-label="4.1 环境准备"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#411 class=md-nav__link> <span class=md-ellipsis> 4.1.1 记录注册信息 </span> </a> </li> <li class=md-nav__item> <a href=#412-gitlab-runner class=md-nav__link> <span class=md-ellipsis> 4.1.2 获取gitlab-runner </span> </a> </li> <li class=md-nav__item> <a href=#413-dockersock class=md-nav__link> <span class=md-ellipsis> 4.1.3 绑定docker.sock </span> </a> </li> <li class=md-nav__item> <a href=#414 class=md-nav__link> <span class=md-ellipsis> 4.1.4 配置缓存 </span> </a> </li> <li class=md-nav__item> <a href=#415-gitlab-runner class=md-nav__link> <span class=md-ellipsis> 4.1.5 安装gitlab-runner </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#42-ci class=md-nav__link> <span class=md-ellipsis> 4.2 集成CI </span> </a> <nav class=md-nav aria-label="4.2 集成CI"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#421 class=md-nav__link> <span class=md-ellipsis> 4.2.1 定义文件 </span> </a> </li> <li class=md-nav__item> <a href=#422 class=md-nav__link> <span class=md-ellipsis> 4.2.2 注意事项 </span> </a> </li> <li class=md-nav__item> <a href=#423 class=md-nav__link> <span class=md-ellipsis> 4.2.3 配置变量 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#43 class=md-nav__link> <span class=md-ellipsis> 4.3 运行测试 </span> </a> <nav class=md-nav aria-label="4.3 运行测试"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#431-pipeline class=md-nav__link> <span class=md-ellipsis> 4.3.1 运行pipeline </span> </a> </li> <li class=md-nav__item> <a href=#432-pod class=md-nav__link> <span class=md-ellipsis> 4.3.2 查看运行POD </span> </a> </li> <li class=md-nav__item> <a href=#433-job class=md-nav__link> <span class=md-ellipsis> 4.3.3 查看Job </span> </a> </li> <li class=md-nav__item> <a href=#434 class=md-nav__link> <span class=md-ellipsis> 4.3.4 查看构建情况 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 五 注意事项 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 六 应用场景 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 七 反思 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=5kubernetes-gitlab-ci>5.实战Kubernetes Gitlab CI<a class=headerlink href=#5kubernetes-gitlab-ci title="Permanent link">&para;</a></h1> <h2 id=_1>一 背景<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>在目前微服务大行其道的背景下，Gitlab CI集成kubernetes已经是不可或缺的基本操作，我们前几节系统的实战了前后端项目以及物理/K8s混合环境部署，这节课我们来学习Gitlab CI如何将应用发布进K8s，我们都知道在之前的将gitlab-runner部署在服务器上面是存在一定的风险，如果运行pipeline的服务器宕机，发布任务就没办法继续了，更可怕的时候如果common-runner发送故障，多个发布任务就都有问题，在微服务架构中，不可变的基础设施，容器的自包含环境使得我们发布变得更加简单快捷，不用在考虑担心runner的环境如何根据不同的项目区分，且动态的Job触发，我们会随时拉起一个Pod来运行我们的Job，运行完成后又进行销毁，这样不仅能实现动态运行节省资源，而且可以不用考虑多项目多任务并发构建的问题，这节课就让我们来尽情享受K8s+Gitlab CI为我们带来畅快淋漓的发布体验。</p> <h2 id=_2>二 架构解析<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>本文以构建一个Java软件项目并将其部署到阿里云容器服务Kubernetes集群中为例，说明如何使用GitLab CI在阿里云Kubernetes服务上运行GitLab Runner、配置Kubernetes类型的executor，并执行Pipeline。</p> <h3 id=21-gitlab-ci>2.1 Gitlab CI流程图<a class=headerlink href=#21-gitlab-ci title="Permanent link">&para;</a></h3> <p>​ </p> <h3 id=22>2.2 流程详解<a class=headerlink href=#22 title="Permanent link">&para;</a></h3> <p>如上图为一个简单的Gitlab CI部署进K8s流程图，同之前我们讲到的CI集成一致，只需要项目中存在.gitlab-ci.yml文件即可，与之前的差异为在集成kubernetes的时候，我们讲我们的gitlab-runner运行在我们K8s内，其为一个POD形式运行，其控制着后续的pipeline中各stage的执行，我们可以看到，当一个pipeline有多个stage，每个stage都是有一个单独的Pod去执行，这个Pod使用的镜像在我们CI的.gitlab-ci.yml 的每个stage的image中定义，如所示为一个部署Java项目的流程</p> <ul> <li>开发者或项目维护者merge request到特定分支，改分支存在CI文件，开始进行CI</li> <li>CI任务由已经注册在gitlab-server运行在K8s集群内的giitlab-runner进行下发</li> <li>第一个为package，对java项目利用maven镜像进行打包，生成war包制品到缓存目录中；</li> <li>利用docker镜像对根据项目中的Dockerfile对缓存中的制品进行镜像构建，构建完成后登录镜像仓库进行镜像推送；</li> <li>在此我们利用将部署文件托管在项目内，也体现了gitops的思想，将之前构建推送成功的镜像地址信息在deployment.yaml文件进行修改，之后apply进k8s中，java项目构建的镜像就运行在K8s集群内了，完成整个的发布。</li> </ul> <p>在流程中有一些注意事项：</p> <ul> <li>我们可以在stage中添加自己业务需求的内容，例如单元测试，代码扫描等。</li> <li>在部署文件中，我们可以将整个项目制作成helm的chart，替换其中的镜像，利用helm来进行整个应用的部署。</li> <li>应用在部署中单个stage利用的是不同的image，在各个stage中传递已经生成的制品例如war/jar包，需要使用到外部存储来缓存制品。</li> </ul> <h2 id=_3>三 优点<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p>通过上面的Gitlab CI流程我们能够看到将gitlab runner运行在K8s集群中，每个Job启动单独的POD运行操作，此种方式完全利用起了K8s的一些优点</p> <ul> <li>高可用：当某个节点出现故障时，Kubernetes 会自动创建一个新的 GitLab-Runner 容器，并挂载同样的 Runner 配置，使服务达到高可用。</li> <li>弹性伸缩：触发式任务，合理使用资源，每次运行脚本任务时，Gitlab-Runner 会自动创建一个或多个新的临时 Runner来运行Job。</li> <li>资源最大化利用：动态创建Pod运行Job，资源自动释放，而且 Kubernetes 会根据每个节点资源的使用情况，动态分配临时 Runner 到空闲的节点上创建，降低出现因某节点资源利用率高，还排队等待在该节点的情况。</li> <li>扩展性好：当 Kubernetes 集群的资源严重不足而导致临时 Runner 排队等待时，可以很容易的添加一个 Kubernetes Node 到集群中，从而实现横向扩展。</li> </ul> <p>如果您的业务目前运行环境为K8s，那么Gitlab CI完全契合您的业务场景，您只需要自定义gitlab-ci.yml中的各个自己需求的stage即可，配合gitops将配置也托管在项目内，跟随项目一块维护管理，实现端到端的CI工作流，使得运维工作也可通过git追溯，提高工作效能，敏捷开发上线部署。</p> <h2 id=_4>四 实战<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <p>我们在上面了解来Gitlab CI与Kubernetes的集成及其优点，下面就让我们通过实战来更具体的了解其流程。</p> <h3 id=41>4.1 环境准备<a class=headerlink href=#41 title="Permanent link">&para;</a></h3> <ul> <li> <p>需要有Gitlab 服务器，可以是部署在物理服务器上，当然也可以部署在K8s集群内部。</p> </li> <li> <p>我需要准备好K8s集群，可以为公有云的容器编排引擎，例如阿里的ACK，腾讯的TKE，华为的CCE等都适用这些方式。</p> </li> <li> <p>由于gitlab-runner安装较为复杂，我们在示例中使用helm来进行安装，helm版本为v2.14.3，如果有能力可以自己编写资源清单部署。</p> </li> </ul> <h4 id=411>4.1.1 记录注册信息<a class=headerlink href=#411 title="Permanent link">&para;</a></h4> <p>登录Gitlab 服务器记录gitlab 的 url 和注册令牌，在我们部署进K8s的gitlab-runnner的配置中需要填写该信息，运行在K8s中的Pod就利用此此信息在gitlab服务器进行注册。</p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200227201303.png></p> <h4 id=412-gitlab-runner>4.1.2 获取gitlab-<strong>runner</strong><a class=headerlink href=#412-gitlab-runner title="Permanent link">&para;</a></h4> <p>由于单独部署gitlab-runner进K8s中，自己去写资源清单文件难度较大，而且容易出错，我们在此利用官方的chart镜像通过helm来进行部署，仅修改其中我们关系的字段即可，首先在登录K8s集群进行gitlab-runner的helm repo的添加，之后将chart下载到本地，解压文件并修改其中的values.yml文件。</p> <ul> <li>添加repo获取charts</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>[root@master common-service]# helm repo add gitlab https://charts.gitlab.io
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>&quot;gitlab&quot; has been added to your repositories
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>[root@master common-service]# helm repo update
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>Hang tight while we grab the latest from your chart repositories...
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>...Skip local chart repository
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>...Successfully got an update from the &quot;aliyun&quot; chart repository
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>...Successfully got an update from the &quot;apphub&quot; chart repository
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>...Successfully got an update from the &quot;gitlab&quot; chart repository
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>...Successfully got an update from the &quot;stable&quot; chart repository
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>Update Complete.
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>[root@master common-service]# helm search gitlab-runner
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>NAME                    CHART VERSION   APP VERSION     DESCRIPTION  
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>gitlab/gitlab-runner    0.14.0          12.8.0          GitLab Runner
</code></pre></div> <p>我看已经看到了 gitlab-runner的chart，其是 helm 中描述相关的一组 Kubernetes 资源的文件集合，里面包含了一个 value.yaml 配置文件和一系列模板（deployment.yaml、svc.yaml 等）。当然如果我们能力够，可以自己去编写这些资源清单文件。</p> <p>在此有想去的伙伴可以查看之前K8s学习笔记，希望能对读者学习K8s有帮助：<a href=https://github.com/overnote/awesome-kubernetes-notes>awesome-kubernetes-notes</a></p> <ul> <li>创建角色并绑定权限</li> </ul> <p>gitlab-runner在运行的时候需要访问我们K8s的api，我们在此为期创建ServiceAccount并为其进行RBAC授权，首先创建一个gitlab-runners的名称空间，并创建对用的Role，将ServiceAccount于Role进行绑定。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=o>[</span>root@master<span class=w> </span>gitlab-runner<span class=o>]</span><span class=c1># cat &gt; rbac-runner-config.yaml &lt;&lt;EOF</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>apiVersion:<span class=w> </span>v1
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>kind:<span class=w> </span>ServiceAccount<span class=w>                                        </span><span class=c1># 在gitlab-runners名称空间下创建名为gitlab的serviceaccount</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>metadata:
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>  </span>name:<span class=w> </span>gitlab
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>  </span>namespace:<span class=w> </span>gitlab-runners
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>---
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>kind:<span class=w> </span>Role<span class=w>                                                              </span><span class=c1># 创建gitlab角色，</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>apiVersion:<span class=w> </span>rbac.authorization.k8s.io/v1
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>metadata:
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>  </span>namespace:<span class=w> </span>gitlab-runners
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>  </span>name:<span class=w> </span>gitlab
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>rules:
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>-<span class=w> </span>apiGroups:<span class=w> </span><span class=o>[</span><span class=s2>&quot;&quot;</span><span class=o>]</span><span class=w> </span><span class=c1>#&quot;&quot; indicates the core API group</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>  </span>resources:<span class=w> </span><span class=o>[</span><span class=s2>&quot;*&quot;</span><span class=o>]</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>  </span>verbs:<span class=w> </span><span class=o>[</span><span class=s2>&quot;*&quot;</span><span class=o>]</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>-<span class=w> </span>apiGroups:<span class=w> </span><span class=o>[</span><span class=s2>&quot;apps&quot;</span><span class=o>]</span><span class=w>                               </span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>  </span>resources:<span class=w> </span><span class=o>[</span><span class=s2>&quot;deployments&quot;</span><span class=o>]</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>  </span>verbs:<span class=w> </span><span class=o>[</span><span class=s2>&quot;*&quot;</span><span class=o>]</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>-<span class=w> </span>apiGroups:<span class=w> </span><span class=o>[</span><span class=s2>&quot;extensions&quot;</span><span class=o>]</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>  </span>resources:<span class=w> </span><span class=o>[</span><span class=s2>&quot;deployments&quot;</span><span class=o>]</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>  </span>verbs:<span class=w> </span><span class=o>[</span><span class=s2>&quot;*&quot;</span><span class=o>]</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a>---
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a>kind:<span class=w> </span>RoleBinding
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a>apiVersion:<span class=w> </span>rbac.authorization.k8s.io/v1
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a>metadata:
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>  </span>name:<span class=w> </span>gitlab<span class=w>                                                                      </span><span class=c1># 将sa与角色进行绑定</span>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>  </span>namespace:<span class=w> </span>gitlab-runners
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a>subjects:
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a>-<span class=w> </span>kind:<span class=w> </span>ServiceAccount
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>  </span>name:<span class=w> </span>gitlab<span class=w> </span><span class=c1># Name is case sensitive</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=w>  </span>apiGroup:<span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a>roleRef:
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>  </span>kind:<span class=w> </span>Role<span class=w> </span><span class=c1>#this must be Role or ClusterRole</span>
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>  </span>name:<span class=w> </span>gitlab<span class=w> </span><span class=c1># this must match the name of the Role or ClusterRole you wish to bind to</span>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>  </span>apiGroup:<span class=w> </span>rbac.authorization.k8s.io
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a>
<a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a>EOF
<a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=c1># 创建资源清单</span>
<a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a><span class=o>[</span>root@master<span class=w> </span>gitlab-runner<span class=o>]</span><span class=c1># kubectl create -f rbac-runner-config.yaml</span>
<a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a>serviceaccount/gitlab<span class=w> </span>created
<a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a>role.rbac.authorization.k8s.io/gitlab<span class=w> </span>created
<a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a>rolebinding.rbac.authorization.k8s.io/gitlab<span class=w> </span>created
</code></pre></div> <ul> <li>获取charts文件，并进行配置</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=o>[</span>root@master<span class=w> </span>gitlab-runner<span class=o>]</span><span class=c1># helm fetch gitlab/gitlab-runner                        </span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=o>[</span>root@master<span class=w> </span>gitlab-runner<span class=o>]</span><span class=c1># tar xf gitlab-runner-0.14.0.tgz</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=o>[</span>root@master<span class=w> </span>gitlab-runner<span class=o>]</span><span class=c1># vim gitlab-runner/values.yaml </span>
</code></pre></div> <p>helm为我们提供了一个配置文件可以在安装 runner 的时候为其注册一个默认的 runner。我们可以去 <a href=https://gitlab.com/gitlab-org/charts/gitlab-runner>gitlab-runner 的项目源码</a> 中获取到 <code>values.yaml</code> 这个配置文件。</p> <h4 id=413-dockersock>4.1.3 绑定docker.sock<a class=headerlink href=#413-dockersock title="Permanent link">&para;</a></h4> <p>由于在gitlab-runner中需要执行docker build 命令，需要docker服务端，我们可以来绑定K8s node节点的docker.sock来实现，编辑chart下面的template目录中的configmap.yaml，在大约42行修改</p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200224231644.png></p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># add volume and bind docker.sock</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class="l l-Scalar l-Scalar-Plain">cat &gt;&gt;/home/gitlab-runner/.gitlab-runner/config.toml &lt;&lt;EOF</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">[[runners.kubernetes.volumes.pvc]]</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">name = &quot;{{.Values.maven.cache.pvcName}}&quot;</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">mount_path = &quot;{{.Values.maven.cache.mountPath}}&quot;</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">[[runners.kubernetes.volumes.host_path]]</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">name = &quot;docker&quot;</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">mount_path = &quot;/var/run/docker.sock&quot;</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class="l l-Scalar l-Scalar-Plain">EOF</span>
</code></pre></div> <h4 id=414>4.1.4 配置缓存<a class=headerlink href=#414 title="Permanent link">&para;</a></h4> <p>在我们的流程详解中能够看到生成的war/jar包制品需要存储在一个地方，这个地方就需要我们挂载一块外置的存储设备，在k8s中我们需要为其提供PVC，如果你有NFS存储或者分布式ceph制成的存储类都可以。</p> <p>再此，我们机器中使用的为storageclass，演示利用存储类来声明PVC，在POD中进行挂载</p> <ul> <li>创建pvc声明文件gitlab-runner-pvc.yaml</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitlab-runner-pvc</span><span class=w>           </span><span class=c1># 创建名称为gitlab-runner-pvc的pvc</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitlab-runners</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span><span class=w>                     </span><span class=c1># 访问模式</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbd</span><span class=w>             </span><span class=c1># 存储类名称</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>    </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2Gi</span><span class=w>                      </span><span class=c1># 存储大小</span>
</code></pre></div> <ul> <li>创建pvc</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=o>[</span>root@master<span class=w> </span>gitlab-runner<span class=o>]</span><span class=c1># kubectl apply -f gitlab-runner-pvc.yaml                                         </span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>persistentvolumeclaim/gitlab-runner-pvc<span class=w> </span>created
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=o>[</span>root@master<span class=w> </span>gitlab-runner<span class=o>]</span><span class=c1># kubectl get pvc -n gitlab-runners       </span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>NAME<span class=w>                </span>STATUS<span class=w>   </span>VOLUME<span class=w>                                     </span>CAPACITY<span class=w>   </span>ACCESS<span class=w> </span>MODES<span class=w>   </span>STORAGECLASS<span class=w>   </span>AGE
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>gitlab-runner-pvc<span class=w>   </span>Bound<span class=w>    </span>pvc-a620cd43-f396-4626-8599-c973c19cddd3<span class=w>   </span>2Gi<span class=w>        </span>RWO<span class=w>            </span>rbd<span class=w>            </span>4s
</code></pre></div> <p>查看已经在gitlab-runners名称空间下已经创建好了PVC。</p> <ul> <li>配置values</li> </ul> <p>在上面我们配置绑定宿主机docker进程的时候也已经将pvc配置进去了，我们还需要在charts的values.yaml下面新添加配置 volume 的信息，并在 values.yaml 配置相应的变量</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a># 添加在values.yaml 的最后即可
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>maven:
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>  cache:
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>    pvcName: gitlab-runner-pvc
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>    mountPath: /home/cache/maven
</code></pre></div> <h4 id=415-gitlab-runner>4.1.5 安装gitlab-runner<a class=headerlink href=#415-gitlab-runner title="Permanent link">&para;</a></h4> <p>配置文件比较长，可以根据需要自己去配置，下面就贴下本文中需要配置的地方。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=o>[</span>root@master<span class=w> </span>gitlab-runner<span class=o>]</span><span class=c1># egrep &quot;^$|^#|^[[:space:]]+#&quot; -v values.yaml </span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>imagePullPolicy:<span class=w> </span>IfNotPresent
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>gitlabUrl:<span class=w> </span>http://43.xx.xx.xx/<span class=w>                                              </span><span class=c1># gitlab url</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>runnerRegistrationToken:<span class=w> </span><span class=s2>&quot;nnxxxxxxxxxxxxxxxS&quot;</span><span class=w>                   </span><span class=c1># gitlab token</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>unregisterRunners:<span class=w> </span><span class=nb>true</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>terminationGracePeriodSeconds:<span class=w> </span><span class=m>3600</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>concurrent:<span class=w> </span><span class=m>10</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>checkInterval:<span class=w> </span><span class=m>30</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>rbac:
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>  </span>create:<span class=w> </span><span class=nb>true</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>  </span>clusterWideAccess:<span class=w> </span><span class=nb>false</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>  </span>serviceAccountName:<span class=w> </span>gitlab<span class=w>                                                    </span><span class=c1># rbac的sa</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>metrics:
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>  </span>enabled:<span class=w> </span><span class=nb>true</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>runners:
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=w>  </span>image:<span class=w> </span>ubuntu:16.04<span class=w>                                                                   </span><span class=c1># 使用的镜像</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>  </span>tags:<span class=w> </span><span class=s2>&quot;gitlab-runner&quot;</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>  </span>privileged:<span class=w> </span><span class=nb>true</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>  </span>imagePullPolicy:<span class=w> </span><span class=s2>&quot;if-not-present&quot;</span><span class=w>                                     </span><span class=c1># 如果执行具体job的runner不存在则拉取</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w>  </span>pollTimeout:<span class=w> </span><span class=m>180</span>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=w>  </span>outputLimit:<span class=w> </span><span class=m>4096</span>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=w>  </span>cache:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=w>  </span>builds:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=w>  </span>services:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w>  </span>helpers:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>  </span>serviceAccountName:<span class=w> </span>gitlab<span class=w>                                                    </span><span class=c1># serviceaccount</span>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=w>  </span>nodeSelector:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a>securityContext:
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=w>  </span>fsGroup:<span class=w> </span><span class=m>65533</span>
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a><span class=w>  </span>runAsUser:<span class=w> </span><span class=m>100</span>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a>resources:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a>affinity:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>nodeSelector:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a>tolerations:<span class=w> </span><span class=o>[]</span>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>hostAliases:<span class=w> </span><span class=o>[]</span>
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>podAnnotations:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>podLabels:<span class=w> </span><span class=o>{}</span>
<a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>maven:<span class=w>                                                                                              </span><span class=c1># 配置maven缓存信息</span>
<a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=w>  </span>cache:
<a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=w>    </span>pvcName:<span class=w> </span>gitlab-runner-pvc<span class=w>                                              </span><span class=c1># pvc信息</span>
<a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a><span class=w>    </span>mountPath:<span class=w> </span>/home/cache/maven<span class=w>                                            </span><span class=c1># 挂载点</span>
</code></pre></div> <ul> <li>安装gitlab-runner</li> </ul> <p>在配置完成values.yaml相关的字段后，我们利用helm来其 进行安装，后期如果我们有变动，直接修改value.yml ，然后进行更新即可<code>helm upgrade gitlab-rujner gitlab-runner/</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class="p p-Indicator">[</span><span class=nv>root@master gitlab-runner</span><span class="p p-Indicator">]</span><span class=c1># helm install --name gitlab-runner -f gitlab-runner/values.yaml --namespace gitlab-runners gitlab-runner/</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=nt>NAME</span><span class=p>:</span><span class=w>   </span><span class="l l-Scalar l-Scalar-Plain">gitlab-runner</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=nt>LAST DEPLOYED</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Sun Feb 23 22:45:37 2020</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=nt>NAMESPACE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitlab-runners</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=nt>STATUS</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DEPLOYED</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=nt>RESOURCES</span><span class=p>:</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class="l l-Scalar l-Scalar-Plain">==&gt; v1/ConfigMap</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class="l l-Scalar l-Scalar-Plain">NAME                         DATA  AGE</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class="l l-Scalar l-Scalar-Plain">gitlab-runner-gitlab-runner  5     1s</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class="l l-Scalar l-Scalar-Plain">==&gt; v1/Deployment</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class="l l-Scalar l-Scalar-Plain">NAME                         READY  UP-TO-DATE  AVAILABLE  AGE</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class="l l-Scalar l-Scalar-Plain">gitlab-runner-gitlab-runner  0/1    1           0          1s</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class="l l-Scalar l-Scalar-Plain">==&gt; v1/Pod(related)</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class="l l-Scalar l-Scalar-Plain">NAME                                          READY  STATUS   RESTARTS  AGE</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class="l l-Scalar l-Scalar-Plain">gitlab-runner-gitlab-runner-6745dd4cd6-r9z28  0/1    Pending  0         0s</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class="l l-Scalar l-Scalar-Plain">==&gt; v1/Secret</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class="l l-Scalar l-Scalar-Plain">NAME                         TYPE    DATA  AGE</span>
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class="l l-Scalar l-Scalar-Plain">gitlab-runner-gitlab-runner  Opaque  2     1s</span>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a>
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=nt>NOTES</span><span class=p>:</span>
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>
<a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=nt>Your GitLab Runner should now be registered against the GitLab instance reachable at</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://43.254.54.93:88/&quot;</span>
</code></pre></div> <p>查看已经运行ok的相关pod资源，gitlab-runner的配置是通过configmap挂载进去，如果我们有新的配置可以修改，并删除之前的gitlab-runner的pod，其deployment控制器会进行创建Pod挂载新的配置文件。</p> <ul> <li>查看pod运行状态</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=o>[</span>root@master<span class=w> </span>~<span class=o>]</span><span class=c1># kubectl get po -n gitlab-runners </span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>NAME<span class=w>                                           </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>gitlab-runner-gitlab-runner-6745dd4cd6-r9z28<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>21h
</code></pre></div> <ul> <li>查看configmap及pod中挂载的配置</li> </ul> <p>这个时候可以进入 pod 看一下 runner 的配置文件（<code>/home/gitlab-runner/.gitlab-runner/config.toml</code>）了。这个文件就是根据之前配置的 values.yaml 自动生成的。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class="p p-Indicator">[</span><span class=nv>root@master ~</span><span class="p p-Indicator">]</span><span class=c1># kubectl get cm -n gitlab-runners  gitlab-runner-gitlab-runner </span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class="l l-Scalar l-Scalar-Plain">NAME                          DATA   AGE</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class="l l-Scalar l-Scalar-Plain">gitlab-runner-gitlab-runner   5      21h</span>
</code></pre></div> <ul> <li>登录gitlab控制台查看目前gitlab-runner已经注册上了。</li> </ul> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225211019.png></p> <ul> <li>当pod运行起来后，查看完整配置</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class="p p-Indicator">[</span><span class=nv>root@master gitlab-runner</span><span class="p p-Indicator">]</span><span class=c1># kubectl exec -it -n gitlab-runners gitlab-runner-gitlab-runner-6c7dfd859c-62dv5 -- cat /home/gitlab-runner/.gitlab-runner/config.toml</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class="l l-Scalar l-Scalar-Plain">listen_address = &quot;[::]:9252&quot;</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class="l l-Scalar l-Scalar-Plain">concurrent = 10</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class="l l-Scalar l-Scalar-Plain">check_interval = 30</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class="l l-Scalar l-Scalar-Plain">log_level = &quot;info&quot;</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class="l l-Scalar l-Scalar-Plain">[session_server]</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">session_timeout = 1800</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class="l l-Scalar l-Scalar-Plain">[[runners]]</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">name = &quot;gitlab-runner-gitlab-runner-6c7dfd859c-62dv5&quot;</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">output_limit = 4096</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">request_concurrency = 1</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">url = &quot;http://43.254.54.93:88/&quot;</span><span class=w>                                   </span><span class=c1># 注册的url</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">token = &quot;eRskGn8Q-g4FZnZib63q&quot;</span><span class=w>                                    </span><span class=c1># gitlab注册的token</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">executor = &quot;kubernetes&quot;</span><span class=w>                                                   </span><span class=c1># executor为kubernetes</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>  </span><span class="p p-Indicator">[</span><span class=nv>runners.custom_build_dir</span><span class="p p-Indicator">]</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>  </span><span class="p p-Indicator">[</span><span class=nv>runners.cache</span><span class="p p-Indicator">]</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>    </span><span class="p p-Indicator">[</span><span class=nv>runners.cache.s3</span><span class="p p-Indicator">]</span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>    </span><span class="p p-Indicator">[</span><span class=nv>runners.cache.gcs</span><span class="p p-Indicator">]</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>  </span><span class="p p-Indicator">[</span><span class=nv>runners.kubernetes</span><span class="p p-Indicator">]</span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">host = &quot;&quot;</span>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">bearer_token_overwrite_allowed = false</span>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">image = &quot;ubuntu:16.04&quot;</span><span class=w>                                              </span><span class=c1># 使用的镜像为ubuntu</span>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">namespace = &quot;gitlab-runners&quot;</span><span class=w>                                    </span><span class=c1># 使用的namespace为gitlab-runners</span>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">namespace_overwrite_allowed = &quot;&quot;</span>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">privileged = true</span>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">poll_timeout = 180</span>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">service_account = &quot;gitlab&quot;</span><span class=w>                                      </span><span class=c1># serviceaccont 为gitlab</span>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">service_account_overwrite_allowed = &quot;&quot;</span>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">pod_annotations_overwrite_allowed = &quot;&quot;</span>
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">[runners.kubernetes.pod_security_context]</span>
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">[runners.kubernetes.volumes]</span>
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">[[runners.kubernetes.volumes.pvc]]</span>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">name = &quot;gitlab-runner-pvc&quot;</span><span class=w>                                      </span><span class=c1># 挂载的pvc名称</span>
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">mount_path = &quot;/home/cache/maven&quot;</span><span class=w>                            </span><span class=c1># 挂载在pod下的缓存目录</span>
<a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a><span class=w>  </span><span class="p p-Indicator">[[</span><span class=nv>runners.kubernetes.volumes.host_path</span><span class="p p-Indicator">]]</span>
<a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">name = &quot;docker&quot;</span>
<a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">mount_path = &quot;/var/run/docker.sock&quot;</span><span class=w>                     </span><span class=c1># 绑定宿主机的docker.sock</span>
</code></pre></div> <p>至此我们已经将gitlab-runner在K8s集群中运行起来，接下来让我们来集成CI。</p> <h3 id=42-ci>4.2 集成CI<a class=headerlink href=#42-ci title="Permanent link">&para;</a></h3> <h4 id=421>4.2.1 定义文件<a class=headerlink href=#421 title="Permanent link">&para;</a></h4> <p>由于使用的 executor 不同，所以. gitlab-ci.yml 和之前服务器也有些不同，不如image，默认如果每个stage中没有写指定某个image则使用该image</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker:latest</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=nt>variables</span><span class=p>:</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>  </span><span class=nt>DOCKER_DRIVER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">overlay2</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>  </span><span class=c1># k8s 挂载本地卷作为 maven 的缓存</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>  </span><span class=nt>MAVEN_OPTS</span><span class=p>:</span><span class=w> </span><span class=s>&quot;-Dmaven.repo.local=/home/cache/maven&quot;</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=nt>stages</span><span class=p>:</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">package</span><span class=w>                         </span><span class=c1># 源码打包阶段</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker_build</span><span class=w>        </span><span class=c1># 镜像构建和打包推送阶段</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy_k8s</span><span class=w>                  </span><span class=c1># 应用部署阶段</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=nt>before_script</span><span class=p>:</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">export APP_TAG=&quot;${CI_COMMIT_TAG:-${CI_COMMIT_SHA::8}}&quot;</span><span class=w>              </span><span class=c1># 定义制作好的镜像tag</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=nt>maven-package</span><span class=p>:</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>  </span><span class=c1>#image: maven:3.5-jdk-8-alpine</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">registry.cn-beijing.aliyuncs.com/codepipeline/public-blueocean-codepipeline-slave-java:0.1-63b99a20</span><span class=w>        </span><span class=c1># maven镜像进行java源码的build</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=w>  </span><span class=nt>tags</span><span class=p>:</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitlab-runner</span><span class=w>             </span><span class=c1># 指定使用gitlab-runner来追寻</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">package</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mvn clean package -Dmaven.test.skip=true</span>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>                            </span><span class=c1># 将生成的war包上传到pvc挂载目录中</span>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=w>    </span><span class=nt>paths</span><span class=p>:</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">target/*.war</span>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=nt>docker-build</span><span class=p>:</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a><span class=w>  </span><span class=nt>tags</span><span class=p>:</span>
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitlab-runner</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
<a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Building Dockerfile-based application...&quot;</span>
<a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker build -t ${REGISTRY}/${QHUB_NAMESPACE}/${APP_NAME}:${APP_TAG} .</span><span class=w>                    </span><span class=c1># 构建镜像</span>
<a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker login --username=${DOCKER_USERNAME} ${REGISTRY} -p ${DOCKER_PASSWORD}</span><span class=w>      </span><span class=c1># 登录镜像仓</span>
<a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker push ${REGISTRY}/${QHUB_NAMESPACE}/${APP_NAME}:${APP_TAG}</span><span class=w>                              </span><span class=c1># push镜像</span>
<a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a><span class=w>  </span><span class=nt>only</span><span class=p>:</span>
<a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a><span class=nt>k8s-deploy</span><span class=p>:</span>
<a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/kubectl:latest</span><span class=w>             </span><span class=c1># 使用kubectl镜像来进行最终的部署</span>
<a id=__codelineno-12-39 name=__codelineno-12-39 href=#__codelineno-12-39></a><span class=w>  </span><span class=nt>tags</span><span class=p>:</span>
<a id=__codelineno-12-40 name=__codelineno-12-40 href=#__codelineno-12-40></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitlab-runner</span>
<a id=__codelineno-12-41 name=__codelineno-12-41 href=#__codelineno-12-41></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<a id=__codelineno-12-42 name=__codelineno-12-42 href=#__codelineno-12-42></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
<a id=__codelineno-12-43 name=__codelineno-12-43 href=#__codelineno-12-43></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;deploy to k8s cluster...&quot;</span>
<a id=__codelineno-12-44 name=__codelineno-12-44 href=#__codelineno-12-44></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sed -i &quot;s@$(grep -E &quot;^[[:space:]]+image:&quot; deployment.yaml | awk &#39;{print $2}&#39; |head -1)@${REGISTRY}/${QHUB_NAMESPACE}/${APP_NAME}:${APP_TAG}@g&quot;    deployment.yaml</span><span class=w>         </span><span class=c1># 替换deployment中的镜像</span>
<a id=__codelineno-12-45 name=__codelineno-12-45 href=#__codelineno-12-45></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubectl apply -f deployment.yaml</span><span class=w>                      </span><span class=c1># 应用资源清单文件</span>
<a id=__codelineno-12-46 name=__codelineno-12-46 href=#__codelineno-12-46></a><span class=w>  </span><span class=nt>only</span><span class=p>:</span>
<a id=__codelineno-12-47 name=__codelineno-12-47 href=#__codelineno-12-47></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
</code></pre></div> <p>可以看到CI文件中我们定义了三个stage：</p> <ol> <li>利用maven镜像进行打包，生成war包制品到缓存目录中。</li> <li>利用docker镜像对根据项目中的Dockerfile对缓存中的制品进行镜像构建，构建完成后登录镜像仓库进行镜像推送。</li> <li>利用kubectl镜像先对原有deployment文件进行镜像替换，之后进行将资源清单更新至K8s集群中。</li> <li>在为镜像打tag时，可以自行设置，也可以利用commit来进行与git版本对照。</li> </ol> <h4 id=422>4.2.2 注意事项<a class=headerlink href=#422 title="Permanent link">&para;</a></h4> <ul> <li>由于在镜像构建的stage中，需要使用docker命令来进行相关操作，需要绑定本地 Docker 守护进程。</li> <li>maven 仓库的缓存，在又需要生产制品并保存的构建中，需要外部存储来存放制品。</li> <li>在stage中引用的镜像最好能事先pull到各个node节点上，不然在第一次运行CI，如果网络有波动或带宽小，可能会因为镜像下载超时导致CI失败。</li> </ul> <h4 id=423>4.2.3 配置变量<a class=headerlink href=#423 title="Permanent link">&para;</a></h4> <p>由于在CI文件中又一些敏感信息，例如镜像仓库的登录信息以及后期可以更改的镜像名称等，利用环境注入的方式，使得CI文件脱敏而且更具灵活性和适用性。</p> <p>Project &rarr; Settings &rarr; CI/CD &rarr; Variables， 添加GitLab Runner可用的环境变量，本示例添加变量如下：</p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225222659.png></p> <ul> <li> <p>APP_NAME：制作完成后镜像的名称</p> </li> <li> <p>DOCKER_USERNAME： 镜像仓库用户名</p> </li> <li>DOCKER_PASSWORD 镜像仓库密码</li> <li>QHUB_NAMESPACE：镜像仓库的名称空间，在该项目中我们使用的腾讯的镜像仓库，当然可以自建harbor或使用其他公有云提供的镜像仓库或者dockerhub等。 </li> <li>REGISTRY：镜像仓库的地址</li> </ul> <h3 id=43>4.3 运行测试<a class=headerlink href=#43 title="Permanent link">&para;</a></h3> <p>在我们配置好了CI文件好，让我们来运行测试，提交代码，或者手动运行。</p> <h4 id=431-pipeline>4.3.1 运行pipeline<a class=headerlink href=#431-pipeline title="Permanent link">&para;</a></h4> <p>在项目CI/CD-&gt;Pipelines右上角有RunPipeline</p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225222632.png></p> <p>在图中我们可以看到在其中是可以并行运行多个pipeline，互不影响。</p> <p>选择对应的分支或者传入变量手动运行pipeline</p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225222602.png></p> <h4 id=432-pod>4.3.2 查看运行POD<a class=headerlink href=#432-pod title="Permanent link">&para;</a></h4> <p>登录K8s集群，查看此时运行的POD</p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225094722.png></p> <h4 id=433-job>4.3.3 查看Job<a class=headerlink href=#433-job title="Permanent link">&para;</a></h4> <ul> <li>打包镜像</li> </ul> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225222530.png></p> <ul> <li>镜像构建</li> </ul> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225222504.png></p> <ul> <li>部署进K8s</li> </ul> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225222420.png></p> <h4 id=434>4.3.4 查看构建情况<a class=headerlink href=#434 title="Permanent link">&para;</a></h4> <ul> <li>查看pipeline</li> </ul> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225222353.png></p> <ul> <li>查看构建应用</li> </ul> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200225222325.png></p> <p>至此我们就完成了示例Gitlab CI。</p> <h2 id=_5>五 注意事项<a class=headerlink href=#_5 title="Permanent link">&para;</a></h2> <ul> <li>在实战中的资源清单文件只写来deployment，读者可以根据自己的项目来，可以将service/configmap/hpa等资源清单文件也放在项目中托管，当然也可以制作成helm应用，每次发布利用helm来更新应用</li> <li>在Gitlab CI中注意将敏感信息例如镜像仓库的登录方式等进行脱敏，将有变化的字段设置为变量，为此进行传入是的CI更扩展性及灵活性。</li> <li>在此节中部分内容需要读者具备一定的K8s经验，例如其中的helm及相关的资源清单文件，如果前期了解后期业务微服务话后看本章节内容更为合适。</li> <li>注意在写rbac与pvc的资源清单的名称空间为你想部署业务的名称空间，即例如你想把资源清单部署在common名称空间下，你就需要把pvc和rbac创建在common名称空间下，将gitlab-runner注册在common名称空间下。</li> </ul> <h2 id=_6>六 应用场景<a class=headerlink href=#_6 title="Permanent link">&para;</a></h2> <ul> <li>业务容器微服务化，或半微服务化</li> <li>需要运维人员具有较强的K8s运维能力</li> <li>追求极致持续集成持续交付体验gitops追崇者</li> <li>有明确的流程规范，上线部署规范及明确可循的标准</li> </ul> <h2 id=_7>七 反思<a class=headerlink href=#_7 title="Permanent link">&para;</a></h2> <p>通过本次敏捷无敌之Gitlab CI实战，再次笔者感谢大家能够了解Gitlab的此特性，如果您的公司在使用Gitlab并且有使用其他的CI工具， 困于多套系统维护的复杂性，不妨尝试下Gitlab CI简单集成，Gitops的端到端运维工作，在云原生时代，将工具或中间件下沉到基础设施中，用户只需要专注于自身业务的开发,敏捷高效、文化中协作、快速试错、快速反馈、持续改进、不断迭代，以Git为来源打破研发与运维壁垒隔阂，实现产品更快、更频繁、更稳定的交付。</p> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/redhatxl/redhatxl.github.io/issues/new/?title=[Feedback]+5.%E5%AE%9E%E6%88%98Kubernetes%20Gitlab%20CI+-+/devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2016 - 2024 kaliarch </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/redhatxl target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../..", "features": ["content.code.annotate", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.bd41221c.min.js></script> </body> </html>