<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="stay hungry,stay foolish"><meta name=author content=Kaliarch><link href=https://redhatxl.github.io/cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/ rel=canonical><link href=../%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/ rel=prev><link href=../../deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.16"><title>云原生备份恢复之velero实战 - Kaliarch Blog</title><link rel=stylesheet href=../../../../assets/stylesheets/main.bcfcd587.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-G9D2HRH134"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-G9D2HRH134",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-G9D2HRH134",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#velero class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../.. title="Kaliarch Blog" class="md-header__button md-logo" aria-label="Kaliarch Blog" data-md-component=logo> <img src=../../../../assets/images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kaliarch Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 云原生备份恢复之velero实战 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=light-blue data-md-color-accent=purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/redhatxl/redhatxl.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> redhatxl.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> 首页 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/ class=md-tabs__link> 云原生 </a> </li> <li class=md-tabs__item> <a href=../../../../devops/Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/ class=md-tabs__link> devops </a> </li> <li class=md-tabs__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/ class=md-tabs__link> 开发技术 </a> </li> <li class=md-tabs__item> <a href=../../../../linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../../other/ class=md-tabs__link> 其他 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title="Kaliarch Blog" class="md-nav__button md-logo" aria-label="Kaliarch Blog" data-md-component=logo> <img src=../../../../assets/images/logo.png alt=logo> </a> Kaliarch Blog </label> <div class=md-nav__source> <a href=https://github.com/redhatxl/redhatxl.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> redhatxl.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> 云原生 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 云原生 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../develop/01-k8s%20%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D/ class=md-nav__link> <span class=md-ellipsis> 1.K8s 开发概念简介 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/02-K8s%20API%20%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.K8s API访问方式 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/03-Client-go%20%E4%BD%BF%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 3.Client-go 的使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/04-Cobra%20%2B%20Client-go%E5%AE%9E%E7%8E%B0K8s%E7%AE%80%E5%8D%95%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/ class=md-nav__link> <span class=md-ellipsis> 4.Cobra+Client-go实现K8s插件开发 </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/05-client-go%E4%B9%8BListWatcher%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 5.Client-go源码分析之ListerWatcher </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/06-client-go%E4%B9%8BReflector%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 6.Client-go源码分析之Reflector </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/07-client-go%E4%B9%8BDeltaFIFO%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 7.Client-go源码分析之DeltaFIFO </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/08-client-go%E4%B9%8BInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 8.Client-go源码分析之Informer </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/09-client-go%E4%B9%8BSharedInformer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 9.Client-go源码分析之SharedInformer </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/10-client-go%E4%B9%8BIndexer%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 10.Client-go源码分析之Indexer </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/11-client-go%E4%B9%8BWorkqueue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> 11.Client-go源码分析之WorkQueue </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/12-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Controller/ class=md-nav__link> <span class=md-ellipsis> 12.自定义实现Controller </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/13-%E8%AE%A4%E8%AF%86CRD/ class=md-nav__link> <span class=md-ellipsis> 13.认识CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/x-Informer%E5%AE%9E%E6%88%98%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96K8s%E4%BA%8B%E4%BB%B6%E8%87%B3ElasticSearch/ class=md-nav__link> <span class=md-ellipsis> x-Informer实战之持久化K8s事件至ElasticSearch </span> </a> </li> <li class=md-nav__item> <a href=../../../develop/x-DeltaFIFO%E5%92%8Cindexer%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94/ class=md-nav__link> <span class=md-ellipsis> x-DeltaFIFO 与 Indexer关系 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2 checked> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 运维 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 运维 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_1 checked> <label class=md-nav__link for=__nav_2_2_1 id=__nav_2_2_1_label tabindex=0> <span class=md-ellipsis> 工具 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_1_label aria-expanded=true> <label class=md-nav__title for=__nav_2_2_1> <span class="md-nav__icon md-icon"></span> 工具 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../K8s%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E4%B9%8BKUR8/ class=md-nav__link> <span class=md-ellipsis> K8s可视化工具之KUR8 </span> </a> </li> <li class=md-nav__item> <a href=../K8s%E5%BF%AB%E6%8D%B7%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E4%B9%8BK9s/ class=md-nav__link> <span class=md-ellipsis> K8s快捷操作工具之K9s </span> </a> </li> <li class=md-nav__item> <a href=../K8s%E8%89%B2%E5%BD%A9%E8%BE%93%E5%87%BA%E5%B7%A5%E5%85%B7%E4%B9%8Bkubecolor/ class=md-nav__link> <span class=md-ellipsis> K8s色彩输出工具之kubecolor </span> </a> </li> <li class=md-nav__item> <a href=../K8s%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E7%A5%9E%E5%99%A8%E4%B9%8Bkubetail/ class=md-nav__link> <span class=md-ellipsis> K8s日志查看利器之kubetail </span> </a> </li> <li class=md-nav__item> <a href=../K8s%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%E4%B9%8Bsniff/ class=md-nav__link> <span class=md-ellipsis> K8s 网络抓包之sniff </span> </a> </li> <li class=md-nav__item> <a href=../Kubernetes%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> Kubernetes 六款备份还原工具 </span> </a> </li> <li class=md-nav__item> <a href=../k8s%E6%8F%92%E4%BB%B6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E4%B9%8Bkrew/ class=md-nav__link> <span class=md-ellipsis> k8s 插件管理工具之krew </span> </a> </li> <li class=md-nav__item> <a href=../%E6%9E%B6%E6%9E%84%E5%9B%BE%E7%A5%9E%E5%99%A8DaC%E4%B9%8BDiagram/ class=md-nav__link> <span class=md-ellipsis> 架构图神器DaC之Diagram </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 云原生备份恢复之velero实战 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 云原生备份恢复之velero实战 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 一 背景 </span> </a> </li> <li class=md-nav__item> <a href=#velero_1 class=md-nav__link> <span class=md-ellipsis> 二 Velero概述 </span> </a> <nav class=md-nav aria-label="二 Velero概述"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-velero class=md-nav__link> <span class=md-ellipsis> 2.1 什么是Velero </span> </a> </li> <li class=md-nav__item> <a href=#22-velero class=md-nav__link> <span class=md-ellipsis> 2.2 Velero工作流程 </span> </a> <nav class=md-nav aria-label="2.2 Velero工作流程"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221 class=md-nav__link> <span class=md-ellipsis> 2.2.1 流程图 </span> </a> </li> <li class=md-nav__item> <a href=#222 class=md-nav__link> <span class=md-ellipsis> 2.2.2 备份过程 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23-velero class=md-nav__link> <span class=md-ellipsis> 2.3 Velero的特性 </span> </a> </li> <li class=md-nav__item> <a href=#24-velero class=md-nav__link> <span class=md-ellipsis> 2.4 Velero组建 </span> </a> </li> <li class=md-nav__item> <a href=#25 class=md-nav__link> <span class=md-ellipsis> 2.5 支持备份存储 </span> </a> </li> <li class=md-nav__item> <a href=#26 class=md-nav__link> <span class=md-ellipsis> 2.6 适应场景 </span> </a> </li> <li class=md-nav__item> <a href=#27-etcd class=md-nav__link> <span class=md-ellipsis> 2.7 与etcd的区别 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 三 备份过程 </span> </a> <nav class=md-nav aria-label="三 备份过程"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31 class=md-nav__link> <span class=md-ellipsis> 3.1 保障数据一致性 </span> </a> </li> <li class=md-nav__item> <a href=#32 class=md-nav__link> <span class=md-ellipsis> 3.2 支持的后端存储 </span> </a> <nav class=md-nav aria-label="3.2 支持的后端存储"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#321-backupstoragelocation class=md-nav__link> <span class=md-ellipsis> 3.2.1 BackupStorageLocation </span> </a> <nav class=md-nav aria-label="3.2.1 BackupStorageLocation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#3211-minio class=md-nav__link> <span class=md-ellipsis> 3.2.1.1 Minio </span> </a> </li> <li class=md-nav__item> <a href=#3212-oss class=md-nav__link> <span class=md-ellipsis> 3.2.1.2 阿里OSS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#322-volumesnapshotlocation class=md-nav__link> <span class=md-ellipsis> 3.2.2 VolumeSnapshotLocation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#velerominio class=md-nav__link> <span class=md-ellipsis> 四 实践velero备份minio </span> </a> <nav class=md-nav aria-label="四 实践velero备份minio"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41 class=md-nav__link> <span class=md-ellipsis> 4.1 环境要求 </span> </a> </li> <li class=md-nav__item> <a href=#42-velero class=md-nav__link> <span class=md-ellipsis> 4.2 部署velero </span> </a> <nav class=md-nav aria-label="4.2 部署velero"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#421-velero class=md-nav__link> <span class=md-ellipsis> 4.2.1 下载velero </span> </a> </li> <li class=md-nav__item> <a href=#422-minio class=md-nav__link> <span class=md-ellipsis> 4.2.2 安装minio </span> </a> </li> <li class=md-nav__item> <a href=#423-velero class=md-nav__link> <span class=md-ellipsis> 4.2.3 安装velero </span> </a> <nav class=md-nav aria-label="4.2.3 安装velero"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#4231 class=md-nav__link> <span class=md-ellipsis> 4.2.3.1 创建密钥 </span> </a> </li> <li class=md-nav__item> <a href=#4232-k8svelero class=md-nav__link> <span class=md-ellipsis> 4.2.3.2 K8s集群安装velero </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#43-velero class=md-nav__link> <span class=md-ellipsis> 4.3 velero命令 </span> </a> </li> <li class=md-nav__item> <a href=#44 class=md-nav__link> <span class=md-ellipsis> 4.4 测试 </span> </a> <nav class=md-nav aria-label="4.4 测试"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#441 class=md-nav__link> <span class=md-ellipsis> 4.4.1 创建测试应用 </span> </a> </li> <li class=md-nav__item> <a href=#442 class=md-nav__link> <span class=md-ellipsis> 4.4.2 执行备份 </span> </a> </li> <li class=md-nav__item> <a href=#443 class=md-nav__link> <span class=md-ellipsis> 4.4.3 查看备份信息 </span> </a> </li> <li class=md-nav__item> <a href=#444 class=md-nav__link> <span class=md-ellipsis> 4.4.4 进行恢复测试 </span> </a> <nav class=md-nav aria-label="4.4.4 进行恢复测试"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#4441-nginx class=md-nav__link> <span class=md-ellipsis> 4.4.4.1 删除nginx服务 </span> </a> </li> <li class=md-nav__item> <a href=#4442-nginx class=md-nav__link> <span class=md-ellipsis> 4.4.4.2 恢复nginx服务 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#velerooss class=md-nav__link> <span class=md-ellipsis> 五 实践velero备份OSS </span> </a> <nav class=md-nav aria-label="五 实践velero备份OSS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-oss-bucket class=md-nav__link> <span class=md-ellipsis> 5.1 创建OSS bucket </span> </a> </li> <li class=md-nav__item> <a href=#52-ram class=md-nav__link> <span class=md-ellipsis> 5.2 创建阿里云RAM用户 </span> </a> <nav class=md-nav aria-label="5.2 创建阿里云RAM用户"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#521 class=md-nav__link> <span class=md-ellipsis> 5.2.1 新建权限策略 </span> </a> </li> <li class=md-nav__item> <a href=#522 class=md-nav__link> <span class=md-ellipsis> 5.2.2 新建用户 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#53 class=md-nav__link> <span class=md-ellipsis> 5.3 部署服务端 </span> </a> <nav class=md-nav aria-label="5.3 部署服务端"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#531-velero class=md-nav__link> <span class=md-ellipsis> 5.3.1 拉取velero插件 </span> </a> </li> <li class=md-nav__item> <a href=#532 class=md-nav__link> <span class=md-ellipsis> 5.3.2 配置参数 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#oss-bucket-velero class=md-nav__link> <span class=md-ellipsis> 设置备份 OSS Bucket 与 可用区 并部署 velero </span> </a> </li> <li class=md-nav__item> <a href=#54 class=md-nav__link> <span class=md-ellipsis> 5.4 备份恢复 </span> </a> <nav class=md-nav aria-label="5.4 备份恢复"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#541 class=md-nav__link> <span class=md-ellipsis> 5.4.1 备份 </span> </a> </li> <li class=md-nav__item> <a href=#542 class=md-nav__link> <span class=md-ellipsis> 5.4.2 恢复 </span> </a> </li> <li class=md-nav__item> <a href=#543 class=md-nav__link> <span class=md-ellipsis> 5.4.3 周期性任务 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 六 注意事项 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 参考资料 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2> <label class=md-nav__link for=__nav_2_2_2 id=__nav_2_2_2_label tabindex=0> <span class=md-ellipsis> 部署 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> 部署 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../deploy/Ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> Ceph机器安装部署 </span> </a> </li> <li class=md-nav__item> <a href=../../deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E4%B9%8Bminikube/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之Minikube </span> </a> </li> <li class=md-nav__item> <a href=../../deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BK3s/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之K3s </span> </a> </li> <li class=md-nav__item> <a href=../../deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BKind/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之Kind </span> </a> </li> <li class=md-nav__item> <a href=../../deploy/%E6%9C%80%E5%B0%8F%E5%8C%96K8s%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E4%B9%8BMicroK8s/ class=md-nav__link> <span class=md-ellipsis> 最小化K8s环境部署之MicroK8s </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3> <label class=md-nav__link for=__nav_2_2_3 id=__nav_2_2_3_label tabindex=0> <span class=md-ellipsis> servicemesh </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3> <span class="md-nav__icon md-icon"></span> servicemesh </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3_1> <label class=md-nav__link for=__nav_2_2_3_1 id=__nav_2_2_3_1_label tabindex=0> <span class=md-ellipsis> istio </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3_1> <span class="md-nav__icon md-icon"></span> istio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../servicemesh/istio/Envoy%E7%AC%94%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> Envoy笔记 </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/服务网格进阶实战.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/详解.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/Istio%E4%B9%8BXDS%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> Istio之XDS协议解析 </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8BGateway/ class=md-nav__link> <span class=md-ellipsis> Istio笔记之Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/Istio%E7%AC%94%E8%AE%B0%E4%B9%8Bpilot/ class=md-nav__link> <span class=md-ellipsis> Istio笔记之pilot </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/Istio%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> Istio灰度发布 </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/Istio之流量管理.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/Istio%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> Istio简介及架构 </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/Istio%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%AC%94%E8%AE%B0%28%E4%B8%80%29/ class=md-nav__link> <span class=md-ellipsis> Istio微服务治理笔记(一) </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/Istio%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C/ class=md-nav__link> <span class=md-ellipsis> Istio基础之服务网络 </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/微服务金丝雀发布.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../servicemesh/istio/istio%E7%AC%94%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> istio笔记 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_4> <label class=md-nav__link for=__nav_2_2_4 id=__nav_2_2_4_label tabindex=0> <span class=md-ellipsis> 排错 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_4> <span class="md-nav__icon md-icon"></span> 排错 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../other/k8s%20%E9%9B%86%E7%BE%A4etcd%E6%8E%92%E9%94%99/ class=md-nav__link> <span class=md-ellipsis> k8s 集群etcd排错 </span> </a> </li> <li class=md-nav__item> <a href=../../other/CronHPA/ class=md-nav__link> <span class=md-ellipsis> CronHPA初探 </span> </a> </li> <li class=md-nav__item> <a href=../../other/%E8%AE%B0%E4%B8%80%E6%AC%A1K8smaster%20%E8%8A%82%E7%82%B9%E4%B8%80%E6%AC%A1%E6%8E%92%E9%94%99%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 记一次K8smaster 节点一次排错实战 </span> </a> </li> <li class=md-nav__item> <a href=../../other/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8Ak8s%E8%8A%82%E7%82%B9%E7%BB%B4%E6%8A%A4/ class=md-nav__link> <span class=md-ellipsis> 记一次线上k8s节点维护 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_5> <label class=md-nav__link for=__nav_2_2_5 id=__nav_2_2_5_label tabindex=0> <span class=md-ellipsis> 容器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_5> <span class="md-nav__icon md-icon"></span> 容器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../%E5%AE%B9%E5%99%A8/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> Dockerfile 最佳实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%B9%E5%99%A8/Docker%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> Docker底层原理 </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%B9%E5%99%A8/podman%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Podman详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%B9%E5%99%A8/%E5%88%A9%E7%94%A8katacoda%20%E5%AE%9E%E7%8E%B0%E6%8B%89%E5%8F%96%E5%9B%BD%E5%A4%96%E9%95%9C%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 利用katacoda实现拉取国外镜像 </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%B9%E5%99%A8/%E9%95%9C%E5%83%8F%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ class=md-nav__link> <span class=md-ellipsis> 镜像底层原理 </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%B9%E5%99%A8/Harbor%E5%92%8Cregistry%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/ class=md-nav__link> <span class=md-ellipsis> Harbor/registry镜像仓库部署 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 安全 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 安全 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKube-bench/ class=md-nav__link> <span class=md-ellipsis> K8s 安全之Kube-bench </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/Kubeeye%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> KubeEye源码分析 </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BKubeeye/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全之KubeEye </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BNPD/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全之NPD </span> </a> </li> <li class=md-nav__item> <a href="../../../安全/Kubernetes安全之Open/ Policy/ Agent.md" class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bopenebs/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全之openebs </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全分析 </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/kubernetes%E5%AE%89%E5%85%A8%E4%B9%8BPolaris/ class=md-nav__link> <span class=md-ellipsis> kubernetes安全之Polaris </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/Kubernetes%E5%AE%89%E5%85%A8%E4%B9%8Bkubescape/ class=md-nav__link> <span class=md-ellipsis> Kubernetes安全扫描之kubescape </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E4%B9%8BTrivy/ class=md-nav__link> <span class=md-ellipsis> 镜像安全扫描之Trivy </span> </a> </li> <li class=md-nav__item> <a href=../../../%E5%AE%89%E5%85%A8/%E5%BC%80%E6%BA%90%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E5%B9%B3%E5%8F%B0%E4%B9%8BNeuVector/ class=md-nav__link> <span class=md-ellipsis> 开源容器安全平台之NeuVector </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../other/inside-kubernetes%20controller/ class=md-nav__link> <span class=md-ellipsis> Inside Kubernetes controller </span> </a> </li> <li class=md-nav__item> <a href=../../../other/Kubectl插件开发及开业分享.md class=md-nav__link> <span class=md-ellipsis> None </span> </a> </li> <li class=md-nav__item> <a href=../../../other/KubeEdge/ class=md-nav__link> <span class=md-ellipsis> KubeEdge初探 </span> </a> </li> <li class=md-nav__item> <a href=../../../other/Kubernetes%E5%BC%80%E5%8F%91%E6%8E%92%E9%94%99%E6%9D%82%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> Kubernetes开发排错杂记 </span> </a> </li> <li class=md-nav__item> <a href=../../../other/Kubernetes%E7%94%9F%E6%88%90kubeconfig/ class=md-nav__link> <span class=md-ellipsis> Kubernetes生成kubeconfig </span> </a> </li> <li class=md-nav__item> <a href=../../../other/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%8E%9F%E7%94%9FCCE%E5%AE%9E%E6%88%98/ class=md-nav__link> <span class=md-ellipsis> 华为云原生CCE实战 </span> </a> </li> <li class=md-nav__item> <a href=../../../other/%E5%BE%AE%E6%9C%8D%E5%8A%A1API%E7%BD%91%E5%85%B3-Kong/ class=md-nav__link> <span class=md-ellipsis> 微服务API网关-Kong </span> </a> </li> <li class=md-nav__item> <a href=../../../other/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%AD10%E7%A7%8D%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 微服务架构中10种常用设计模式 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> devops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> devops </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> GitLab CI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> GitLab CI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../devops/Gitlab%20CI/01%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8B%E5%AE%9E%E6%88%98Gitlab%20CI/ class=md-nav__link> <span class=md-ellipsis> 1.敏捷无敌之Gitlab CI </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/Gitlab%20CI/02%E6%95%8F%E6%8D%B7%E6%97%A0%E6%95%8C%E4%B9%8BGitlab%20CI%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> 2.敏捷无敌之Gitlab CI架构流程详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/Gitlab%20CI/03%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Supervisor%20%E5%8F%91%E5%B8%83Python%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 3.实战Gitlab CI + Supervisor 发布Python项目 </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/Gitlab%20CI/04%E5%AE%9E%E6%88%98%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%8F%8A%E6%B7%B7%E5%90%88%E7%8E%AF%E5%A2%83Gitlab%20CI/ class=md-nav__link> <span class=md-ellipsis> 4.实战前后端项目及混合环境Gitlab CI </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/Gitlab%20CI/05%E5%AE%9E%E6%88%98Gitlab%20CI%20%2B%20Kubernetes%20%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83/ class=md-nav__link> <span class=md-ellipsis> 5.实战Kubernetes Gitlab CI </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/Gitlab%20CI/Gitlab%20CI%E4%B9%8B%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F/ class=md-nav__link> <span class=md-ellipsis> Gitlab CI之单元测试和代码扫描 </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/Gitlab%20CI/Gitlab%20CI%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%B1%E4%BA%ABCI%E5%BA%93/ class=md-nav__link> <span class=md-ellipsis> Gitlab CI进阶之共享CI库 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> IaC </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> IaC </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../devops/IaC/Terraform/IaC%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7%E4%B9%8BTerrascan/ class=md-nav__link> <span class=md-ellipsis> IaC扫描工具之Terrascan </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/IaC/Terraform/IaC%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B9%8BTerratest/ class=md-nav__link> <span class=md-ellipsis> IaC测试工具之Terratest </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/IaC/Terraform/terraform-book/ class=md-nav__link> <span class=md-ellipsis> Terraform book </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/IaC/Terraform/Terraform%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> Terraform 相关概念及函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/IaC/Terraform/terraform%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> Terraform 最佳实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../devops/other/Argo%20CD/ class=md-nav__link> <span class=md-ellipsis> Argo CD </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/other/IaC%E4%B9%8BTerraform%20%E4%B8%8EPulumi%E4%BD%BF%E7%94%A8%E5%AF%B9%E6%AF%94/ class=md-nav__link> <span class=md-ellipsis> IaC之Terraform 与Pulumi使用对比 </span> </a> </li> <li class=md-nav__item> <a href=../../../../devops/other/Packer/ class=md-nav__link> <span class=md-ellipsis> 镜像定义工具Packer实战 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> 开发技术 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 开发技术 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> 设计模式 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 设计模式 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1_1> <label class=md-nav__link for=__nav_4_1_1 id=__nav_4_1_1_label tabindex=0> <span class=md-ellipsis> 创建型 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_1> <span class="md-nav__icon md-icon"></span> 创建型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.简单工厂模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.工厂方法模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 3.抽象工厂模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4.建造者(生成器)模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%9B%E5%BB%BA%E5%9E%8B/05-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 5.单例模式 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1_2> <label class=md-nav__link for=__nav_4_1_2 id=__nav_4_1_2_label tabindex=0> <span class=md-ellipsis> 结构型 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_2> <span class="md-nav__icon md-icon"></span> 结构型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.装饰器模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.代理模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 3.桥接模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%93%E6%9E%84%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4.适配器模式 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1_3> <label class=md-nav__link for=__nav_4_1_3 id=__nav_4_1_3_label tabindex=0> <span class=md-ellipsis> 行为型 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_3> <span class="md-nav__icon md-icon"></span> 行为型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/01-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 1.策略模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/02-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.观察者模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/03-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A8%A1%E7%89%88%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2.模版模式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/04-golang%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 4.职责链模式 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Golang </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_1> <label class=md-nav__link for=__nav_4_2_1 id=__nav_4_2_1_label tabindex=0> <span class=md-ellipsis> Gin </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_1> <span class="md-nav__icon md-icon"></span> Gin </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/Golang/gin/gin%20%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0%E7%83%AD%E5%8A%A0%E8%BD%BD/ class=md-nav__link> <span class=md-ellipsis> Gin框架热加载 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/Golang/gin/gin-swagger/ class=md-nav__link> <span class=md-ellipsis> Gin + Swagger快速生成API文档 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/Golang/gin/gin-validator%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/ class=md-nav__link> <span class=md-ellipsis> gin-validator参数校验 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/Golang/gin/gin%E6%A1%86%E6%9E%B6%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA%E9%87%8D%E5%90%AF/ class=md-nav__link> <span class=md-ellipsis> Gin框架优雅关机和重启 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_2> <label class=md-nav__link for=__nav_4_2_2 id=__nav_4_2_2_label tabindex=0> <span class=md-ellipsis> 开发规范 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_2> <span class="md-nav__icon md-icon"></span> 开发规范 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%80%A7%E8%83%BD01/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之性能01 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8301/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范01 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8302/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范02 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8303/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范03 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E8%A7%84%E8%8C%8304/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之规范04 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9901/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则01 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F01/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之编程模式01 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9902/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则02 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9903/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则03 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9904/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则04 </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/%E8%A7%84%E8%8C%83/uber-go%20%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/Golang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E4%B9%8B%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%9905/ class=md-nav__link> <span class=md-ellipsis> Golang编码规范之指导原则05 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2_3> <label class=md-nav__link for=__nav_4_2_3 id=__nav_4_2_3_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_3> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../develop/Golang/golang%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF%E6%9C%80%E7%BB%88%E4%B9%8Bjaeger/ class=md-nav__link> <span class=md-ellipsis> Golang 分布式链路追踪之jaeger </span> </a> </li> <li class=md-nav__item> <a href=../../../../develop/Golang/golang%20%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/ class=md-nav__link> <span class=md-ellipsis> Go 内存对齐 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 系统相关 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 系统相关 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/system/Linux%20grub%3Agrub2%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Linux grub/grub2详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/system/Linux%20%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Linux 内核引导详解 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/system/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class=md-nav__link> <span class=md-ellipsis> Linux 系统安全加固最佳实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/system/virtio%E8%AF%A6%E8%A7%A3/ class=md-nav__link> <span class=md-ellipsis> Virtio 详解 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../linux/shell/Shell%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> Shell 教程概述 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/1.%E7%AC%AC%E4%B8%80%E4%B8%AAshell%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 1.第一个 Shell 程序 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/2.Shell%E5%8F%98%E9%87%8F/ class=md-nav__link> <span class=md-ellipsis> 2.Shell 变量 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/3.Shell%E5%8F%82%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 3.Shell 参数 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/4.Shell%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 4.Shell数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/5.Shell%E8%BF%90%E7%AE%97%E7%AC%A6/ class=md-nav__link> <span class=md-ellipsis> 5.Shell 运算符 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/6.Shell%20echo%3Aprintf%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 6.Shell echo/printf 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/7.Shell%20test%E5%91%BD%E4%BB%A4/ class=md-nav__link> <span class=md-ellipsis> 7.Shell test 命令 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/8.Shell%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 8.Shell 流程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/9.Shell%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 8.Shell 函数 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/10.Shell%E8%BE%93%E5%85%A5%3A%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91/ class=md-nav__link> <span class=md-ellipsis> 10.Shell输入/输出重定向 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/11.Shell%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 11.Shell 正则表达式 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/12.Shell%20%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/ class=md-nav__link> <span class=md-ellipsis> 12.Shell 三剑客之grep </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/13.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/ class=md-nav__link> <span class=md-ellipsis> 13.Shell三剑客之sed </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/14.Shell%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/ class=md-nav__link> <span class=md-ellipsis> 14.Shell三剑客之awk </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/15.Shell%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/ class=md-nav__link> <span class=md-ellipsis> 15.Shell常用工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../../linux/shell/16.Shell%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ class=md-nav__link> <span class=md-ellipsis> 16.Shell实战项目 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../other/ class=md-nav__link> <span class=md-ellipsis> 工具 </span> </a> </li> <li class=md-nav__item> <a href=../../../../other/ class=md-nav__link> <span class=md-ellipsis> 杂记 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 一 背景 </span> </a> </li> <li class=md-nav__item> <a href=#velero_1 class=md-nav__link> <span class=md-ellipsis> 二 Velero概述 </span> </a> <nav class=md-nav aria-label="二 Velero概述"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-velero class=md-nav__link> <span class=md-ellipsis> 2.1 什么是Velero </span> </a> </li> <li class=md-nav__item> <a href=#22-velero class=md-nav__link> <span class=md-ellipsis> 2.2 Velero工作流程 </span> </a> <nav class=md-nav aria-label="2.2 Velero工作流程"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221 class=md-nav__link> <span class=md-ellipsis> 2.2.1 流程图 </span> </a> </li> <li class=md-nav__item> <a href=#222 class=md-nav__link> <span class=md-ellipsis> 2.2.2 备份过程 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23-velero class=md-nav__link> <span class=md-ellipsis> 2.3 Velero的特性 </span> </a> </li> <li class=md-nav__item> <a href=#24-velero class=md-nav__link> <span class=md-ellipsis> 2.4 Velero组建 </span> </a> </li> <li class=md-nav__item> <a href=#25 class=md-nav__link> <span class=md-ellipsis> 2.5 支持备份存储 </span> </a> </li> <li class=md-nav__item> <a href=#26 class=md-nav__link> <span class=md-ellipsis> 2.6 适应场景 </span> </a> </li> <li class=md-nav__item> <a href=#27-etcd class=md-nav__link> <span class=md-ellipsis> 2.7 与etcd的区别 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 三 备份过程 </span> </a> <nav class=md-nav aria-label="三 备份过程"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31 class=md-nav__link> <span class=md-ellipsis> 3.1 保障数据一致性 </span> </a> </li> <li class=md-nav__item> <a href=#32 class=md-nav__link> <span class=md-ellipsis> 3.2 支持的后端存储 </span> </a> <nav class=md-nav aria-label="3.2 支持的后端存储"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#321-backupstoragelocation class=md-nav__link> <span class=md-ellipsis> 3.2.1 BackupStorageLocation </span> </a> <nav class=md-nav aria-label="3.2.1 BackupStorageLocation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#3211-minio class=md-nav__link> <span class=md-ellipsis> 3.2.1.1 Minio </span> </a> </li> <li class=md-nav__item> <a href=#3212-oss class=md-nav__link> <span class=md-ellipsis> 3.2.1.2 阿里OSS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#322-volumesnapshotlocation class=md-nav__link> <span class=md-ellipsis> 3.2.2 VolumeSnapshotLocation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#velerominio class=md-nav__link> <span class=md-ellipsis> 四 实践velero备份minio </span> </a> <nav class=md-nav aria-label="四 实践velero备份minio"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41 class=md-nav__link> <span class=md-ellipsis> 4.1 环境要求 </span> </a> </li> <li class=md-nav__item> <a href=#42-velero class=md-nav__link> <span class=md-ellipsis> 4.2 部署velero </span> </a> <nav class=md-nav aria-label="4.2 部署velero"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#421-velero class=md-nav__link> <span class=md-ellipsis> 4.2.1 下载velero </span> </a> </li> <li class=md-nav__item> <a href=#422-minio class=md-nav__link> <span class=md-ellipsis> 4.2.2 安装minio </span> </a> </li> <li class=md-nav__item> <a href=#423-velero class=md-nav__link> <span class=md-ellipsis> 4.2.3 安装velero </span> </a> <nav class=md-nav aria-label="4.2.3 安装velero"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#4231 class=md-nav__link> <span class=md-ellipsis> 4.2.3.1 创建密钥 </span> </a> </li> <li class=md-nav__item> <a href=#4232-k8svelero class=md-nav__link> <span class=md-ellipsis> 4.2.3.2 K8s集群安装velero </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#43-velero class=md-nav__link> <span class=md-ellipsis> 4.3 velero命令 </span> </a> </li> <li class=md-nav__item> <a href=#44 class=md-nav__link> <span class=md-ellipsis> 4.4 测试 </span> </a> <nav class=md-nav aria-label="4.4 测试"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#441 class=md-nav__link> <span class=md-ellipsis> 4.4.1 创建测试应用 </span> </a> </li> <li class=md-nav__item> <a href=#442 class=md-nav__link> <span class=md-ellipsis> 4.4.2 执行备份 </span> </a> </li> <li class=md-nav__item> <a href=#443 class=md-nav__link> <span class=md-ellipsis> 4.4.3 查看备份信息 </span> </a> </li> <li class=md-nav__item> <a href=#444 class=md-nav__link> <span class=md-ellipsis> 4.4.4 进行恢复测试 </span> </a> <nav class=md-nav aria-label="4.4.4 进行恢复测试"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#4441-nginx class=md-nav__link> <span class=md-ellipsis> 4.4.4.1 删除nginx服务 </span> </a> </li> <li class=md-nav__item> <a href=#4442-nginx class=md-nav__link> <span class=md-ellipsis> 4.4.4.2 恢复nginx服务 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#velerooss class=md-nav__link> <span class=md-ellipsis> 五 实践velero备份OSS </span> </a> <nav class=md-nav aria-label="五 实践velero备份OSS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-oss-bucket class=md-nav__link> <span class=md-ellipsis> 5.1 创建OSS bucket </span> </a> </li> <li class=md-nav__item> <a href=#52-ram class=md-nav__link> <span class=md-ellipsis> 5.2 创建阿里云RAM用户 </span> </a> <nav class=md-nav aria-label="5.2 创建阿里云RAM用户"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#521 class=md-nav__link> <span class=md-ellipsis> 5.2.1 新建权限策略 </span> </a> </li> <li class=md-nav__item> <a href=#522 class=md-nav__link> <span class=md-ellipsis> 5.2.2 新建用户 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#53 class=md-nav__link> <span class=md-ellipsis> 5.3 部署服务端 </span> </a> <nav class=md-nav aria-label="5.3 部署服务端"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#531-velero class=md-nav__link> <span class=md-ellipsis> 5.3.1 拉取velero插件 </span> </a> </li> <li class=md-nav__item> <a href=#532 class=md-nav__link> <span class=md-ellipsis> 5.3.2 配置参数 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#oss-bucket-velero class=md-nav__link> <span class=md-ellipsis> 设置备份 OSS Bucket 与 可用区 并部署 velero </span> </a> </li> <li class=md-nav__item> <a href=#54 class=md-nav__link> <span class=md-ellipsis> 5.4 备份恢复 </span> </a> <nav class=md-nav aria-label="5.4 备份恢复"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#541 class=md-nav__link> <span class=md-ellipsis> 5.4.1 备份 </span> </a> </li> <li class=md-nav__item> <a href=#542 class=md-nav__link> <span class=md-ellipsis> 5.4.2 恢复 </span> </a> </li> <li class=md-nav__item> <a href=#543 class=md-nav__link> <span class=md-ellipsis> 5.4.3 周期性任务 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 六 注意事项 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 参考资料 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=velero>云原生备份恢复之velero实战<a class=headerlink href=#velero title="Permanent link">&para;</a></h1> <h2 id=_1>一 背景<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>Kubernetes 集群备份是一大难点。虽然可以通过<a href="http://mp.weixin.qq.com/s?__biz=MzA4MzIwNTc4NQ==&mid=2247484108&idx=1&sn=9852f8a55ea1f494a2c3caeb7a6655b2&chksm=9ffb493aa88cc02c797611cf5a33246f7705287ac47dbd280a637e13c9e197310755d3adc44b&scene=21#wechat_redirect">Etcd v3备份与恢复</a>来实现K8S集群备份，但是这种备份很难恢复单个 <code>Namespace</code>。</p> <p>对于K8s集群数据的备份和恢复，以及复制当前集群数据到其他集群等都非常方便。可以在两个集群间克隆应用和命名空间，来创建一个临时性的开发环境。</p> <h2 id=velero_1>二 Velero概述<a class=headerlink href=#velero_1 title="Permanent link">&para;</a></h2> <h3 id=21-velero>2.1 什么是Velero<a class=headerlink href=#21-velero title="Permanent link">&para;</a></h3> <p>Velero 是一个云原生的灾难恢复和迁移工具，它本身也是开源的, 采用 Go 语言编写，可以安全的备份、恢复和迁移Kubernetes集群资源和持久卷。</p> <p>Velero 是西班牙语，意思是帆船，非常符合 Kubernetes 社区的命名风格。Velero 的开发公司 Heptio，之前已被 VMware 收购，其创始人2014就职于Google，当时被认为是 Kubernetes 核心成员。</p> <p>Velero 是一种云原生的Kubernetes优化方法，支持标准的K8S集群，既可以是私有云平台也可以是公有云。除了灾备之外它还能做资源移转，支持把容器应用从一个集群迁移到另一个集群。</p> <p>Heptio Velero ( 以前的名字为 ARK) 是一款用于 Kubernetes 集群资源和持久存储卷（PV）的备份、迁移以及灾难恢复等的开源工具。</p> <p>使用velero可以对集群进行备份和恢复，降低集群DR造成的影响。velero的基本原理就是将集群的数据备份到对象存储中，在恢复的时候将数据从对象存储中拉取下来。可以从官方文档查看可接收的对象存储，本地存储可以使用Minio。下面演示使用velero将openstack上的openshift集群备份恢复到阿里云的openshift上。</p> <h3 id=22-velero>2.2 Velero工作流程<a class=headerlink href=#22-velero title="Permanent link">&para;</a></h3> <h4 id=221>2.2.1 流程图<a class=headerlink href=#221 title="Permanent link">&para;</a></h4> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200811095018.png></p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200811094957.png></p> <h4 id=222>2.2.2 备份过程<a class=headerlink href=#222 title="Permanent link">&para;</a></h4> <ol> <li>本地 <code>Velero</code> 客户端发送备份指令。</li> <li><code>Kubernetes</code> 集群内就会创建一个 <code>Backup</code> 对象。</li> <li><code>BackupController</code> 监测 <code>Backup</code> 对象并开始备份过程。</li> <li><code>BackupController</code> 会向 <code>API Server</code> 查询相关数据。</li> <li><code>BackupController</code> 将查询到的数据备份到远端的对象存储。</li> </ol> <h3 id=23-velero>2.3 Velero的特性<a class=headerlink href=#23-velero title="Permanent link">&para;</a></h3> <p><code>Velero</code> 目前包含以下特性：</p> <ul> <li>支持 <code>Kubernetes</code> 集群数据备份和恢复</li> <li>支持复制当前 <code>Kubernetes</code> 集群的资源到其它 <code>Kubernetes</code> 集群</li> <li>支持复制生产环境到开发以及测试环境</li> </ul> <h3 id=24-velero>2.4 Velero组建<a class=headerlink href=#24-velero title="Permanent link">&para;</a></h3> <p><code>Velero</code> 组件一共分两部分，分别是服务端和客户端。</p> <ul> <li>服务端：运行在你 <code>Kubernetes</code> 的集群中</li> <li>客户端：是一些运行在本地的命令行的工具，需要已配置好 <code>kubectl</code> 及集群 <code>kubeconfig</code> 的机器上</li> </ul> <h3 id=25>2.5 支持备份存储<a class=headerlink href=#25 title="Permanent link">&para;</a></h3> <ul> <li>AWS S3 以及兼容 S3 的存储，比如：Minio</li> <li>Azure BloB 存储</li> <li>Google Cloud 存储</li> <li>Aliyun OSS 存储(<a href=https://github.com/AliyunContainerService/velero-plugin>https://github.com/AliyunContainerService/velero-plugin</a>)</li> </ul> <blockquote> <p>项目地址：<a href=https://github.com/heptio/velero>https://github.com/heptio/velero</a></p> </blockquote> <h3 id=26>2.6 适应场景<a class=headerlink href=#26 title="Permanent link">&para;</a></h3> <ul> <li><code>灾备场景</code>：提供备份恢复k8s集群的能力</li> <li><code>迁移场景</code>：提供拷贝集群资源到其他集群的能力（复制同步开发，测试，生产环境的集群配置，简化环境配置）</li> </ul> <h3 id=27-etcd>2.7 与etcd的区别<a class=headerlink href=#27-etcd title="Permanent link">&para;</a></h3> <p>与 Etcd 备份相比，直接备份 <code>Etcd</code> 是将集群的全部资源备份起来。而 <code>Velero</code> 就是可以对 <code>Kubernetes</code> 集群内对象级别进行备份。除了对 <code>Kubernetes</code> 集群进行整体备份外，<code>Velero</code> 还可以通过对 <code>Type</code>、<code>Namespace</code>、<code>Label</code> 等对象进行分类备份或者恢复。</p> <blockquote> <p>注意: 备份过程中创建的对象是不会被备份的。</p> </blockquote> <h2 id=_2>三 备份过程<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p><code>Velero</code> 在 <code>Kubernetes</code> 集群中创建了很多 <code>CRD</code> 以及相关的控制器，进行备份恢复等操作实质上是对相关 <code>CRD</code> 的操作。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Velero 在 Kubernetes 集群中创建的 CRD</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>velero<span class=w> </span>get<span class=w> </span>crds<span class=w> </span>-l<span class=w> </span><span class=nv>component</span><span class=o>=</span>velero
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>NAME<span class=w>                                </span>CREATED<span class=w> </span>AT
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>backups.velero.io<span class=w>                   </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>backupstoragelocations.velero.io<span class=w>    </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>deletebackuprequests.velero.io<span class=w>      </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>downloadrequests.velero.io<span class=w>          </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>podvolumebackups.velero.io<span class=w>          </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>podvolumerestores.velero.io<span class=w>         </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>resticrepositories.velero.io<span class=w>        </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>restores.velero.io<span class=w>                  </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>schedules.velero.io<span class=w>                 </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>serverstatusrequests.velero.io<span class=w>      </span><span class=m>2019</span>-08-28T03:19:56Z
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>volumesnapshotlocations.velero.io<span class=w>   </span><span class=m>2019</span>-08-28T03:19:56Z
</code></pre></div> <h3 id=31>3.1 保障数据一致性<a class=headerlink href=#31 title="Permanent link">&para;</a></h3> <p>对象存储的数据是唯一的数据源，也就是说 <code>Kubernetes</code> 集群内的控制器会检查远程的 <code>OSS</code> 存储，发现有备份就会在集群内创建相关 <code>CRD</code> 。如果发现远端存储没有当前集群内的 <code>CRD</code> 所关联的存储数据，那么就会删除当前集群内的 <code>CRD</code>。</p> <h3 id=32>3.2 支持的后端存储<a class=headerlink href=#32 title="Permanent link">&para;</a></h3> <p><code>Velero</code> 支持两种关于后端存储的 <code>CRD</code>，分别是 <code>BackupStorageLocation</code> 和 <code>VolumeSnapshotLocation</code>。</p> <h4 id=321-backupstoragelocation>3.2.1 BackupStorageLocation<a class=headerlink href=#321-backupstoragelocation title="Permanent link">&para;</a></h4> <p><code>BackupStorageLocation</code> 主要用来定义 <code>Kubernetes</code> 集群资源的数据存放位置，也就是集群对象数据，不是 <code>PVC</code> 的数据。主要支持的后端存储是 <code>S3</code> 兼容的存储，比如：<code>Mino</code> 和阿里云 <code>OSS</code> 等。</p> <h5 id=3211-minio>3.2.1.1 Minio<a class=headerlink href=#3211-minio title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">BackupStorageLocation</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=c1># 只有 aws gcp azure</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span><span class=c1># 存储主要配置</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>  </span><span class=nt>objectStorage</span><span class=p>:</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>  </span><span class=c1># bucket 的名称</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>    </span><span class=nt>bucket</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myBucket</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>    </span><span class=c1># bucket内的</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>    </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=c1># 不同的 provider 不同的配置</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>    </span><span class=c1>#bucket地区</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>    </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">us-west-2</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>    </span><span class=c1># s3认证信息</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>    </span><span class=nt>profile</span><span class=p>:</span><span class=w> </span><span class=s>&quot;default&quot;</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>    </span><span class=c1># 使用 Minio 的时候加上，默认为 false</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>    </span><span class=c1># AWS 的 S3 可以支持两种 Url Bucket URL</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>    </span><span class=c1># 1 Path style URL： http://s3endpoint/BUCKET</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>    </span><span class=c1># 2 Virtual-hosted style URL： http://oss-cn-beijing.s3endpoint 将 Bucker Name 放到了 Host Header中</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>    </span><span class=c1># 3 阿里云仅仅支持 Virtual hosted 如果下面写上 true, 阿里云 OSS 会报错 403</span>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>    </span><span class=nt>s3ForcePathStyle</span><span class=p>:</span><span class=w> </span><span class=s>&quot;false&quot;</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>    </span><span class=c1># s3的地址，格式为 http://minio:9000</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>    </span><span class=nt>s3Url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://minio:9000</span>
</code></pre></div> <h5 id=3212-oss>3.2.1.2 阿里OSS<a class=headerlink href=#3212-oss title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">BackupStorageLocation</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>    </span><span class=nt>region</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oss-cn-beijing</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>    </span><span class=nt>s3Url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://oss-cn-beijing.aliyuncs.com</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>    </span><span class=nt>s3ForcePathStyle</span><span class=p>:</span><span class=w> </span><span class=s>&quot;false&quot;</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>  </span><span class=nt>objectStorage</span><span class=p>:</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=w>    </span><span class=nt>bucket</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build-jenkins</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=w>    </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws</span>
</code></pre></div> <h4 id=322-volumesnapshotlocation>3.2.2 VolumeSnapshotLocation<a class=headerlink href=#322-volumesnapshotlocation title="Permanent link">&para;</a></h4> <p>VolumeSnapshotLocation 主要用来给 PV 做快照，需要云提供商提供插件。阿里云已经提供了插件，这个需要使用 CSI 等存储机制。你也可以使用专门的备份工具 <code>Restic</code>，把 PV 数据备份到阿里云 OSS 中去(安装时需要自定义选项)。</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># 安装时需要自定义选项</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class="l l-Scalar l-Scalar-Plain">--use-restic</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class="l l-Scalar l-Scalar-Plain"># 这里我们存储 PV 使用的是 OSS 也就是 BackupStorageLocation，因此不用创建 VolumeSnapshotLocation 对象</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class="l l-Scalar l-Scalar-Plain">--use-volume-snapshots=false</span>
</code></pre></div> <p>Restic 是一款 GO 语言开发的数据加密备份工具，顾名思义，可以将本地数据加密后传输到指定的仓库。支持的仓库有 Local、SFTP、Aws S3、Minio、OpenStack Swift、Backblaze B2、Azure BS、Google Cloud storage、Rest Server。</p> <p>项目地址：<a href=https://github.com/restic/restic>https://github.com/restic/restic</a></p> <h2 id=velerominio>四 实践velero备份minio<a class=headerlink href=#velerominio title="Permanent link">&para;</a></h2> <h3 id=41>4.1 环境要求<a class=headerlink href=#41 title="Permanent link">&para;</a></h3> <ul> <li>kubernetes &gt;1.7;</li> </ul> <h3 id=42-velero>4.2 部署velero<a class=headerlink href=#42-velero title="Permanent link">&para;</a></h3> <h4 id=421-velero>4.2.1 下载velero<a class=headerlink href=#421-velero title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>wget<span class=w> </span>https://github.com/vmware-tanzu/velero/releases/download/v1.4.2/velero-v1.4.2-linux-amd64.tar.gz
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>tar<span class=w> </span>-zxvf<span class=w> </span>velero-v1.4.2-linux-amd64.tar.gz
</code></pre></div> <h4 id=422-minio>4.2.2 安装minio<a class=headerlink href=#422-minio title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class="l l-Scalar l-Scalar-Plain">cd velero-v1.4.2-linux-amd64</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class="l l-Scalar l-Scalar-Plain">[root@master velero-v1.4.2-linux-amd64]# cat examples/minio/00-minio-deployment.yaml</span><span class=w> </span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nn>---</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=nn>---</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=w>      </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=w>        </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage</span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio</span>
<a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio/minio:latest</span>
<a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a><span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">server</span>
<a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/storage</span>
<a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--config-dir=/config</span>
<a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MINIO_ACCESS_KEY</span>
<a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;minio&quot;</span>
<a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MINIO_SECRET_KEY</span>
<a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;minio123&quot;</span>
<a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-5-49 name=__codelineno-5-49 href=#__codelineno-5-49></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage</span>
<a id=__codelineno-5-50 name=__codelineno-5-50 href=#__codelineno-5-50></a><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/storage&quot;</span>
<a id=__codelineno-5-51 name=__codelineno-5-51 href=#__codelineno-5-51></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<a id=__codelineno-5-52 name=__codelineno-5-52 href=#__codelineno-5-52></a><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/config&quot;</span>
<a id=__codelineno-5-53 name=__codelineno-5-53 href=#__codelineno-5-53></a>
<a id=__codelineno-5-54 name=__codelineno-5-54 href=#__codelineno-5-54></a><span class=nn>---</span>
<a id=__codelineno-5-55 name=__codelineno-5-55 href=#__codelineno-5-55></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-5-56 name=__codelineno-5-56 href=#__codelineno-5-56></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id=__codelineno-5-57 name=__codelineno-5-57 href=#__codelineno-5-57></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-58 name=__codelineno-5-58 href=#__codelineno-5-58></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<a id=__codelineno-5-59 name=__codelineno-5-59 href=#__codelineno-5-59></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio</span>
<a id=__codelineno-5-60 name=__codelineno-5-60 href=#__codelineno-5-60></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-5-61 name=__codelineno-5-61 href=#__codelineno-5-61></a><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio</span>
<a id=__codelineno-5-62 name=__codelineno-5-62 href=#__codelineno-5-62></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-5-63 name=__codelineno-5-63 href=#__codelineno-5-63></a><span class=w>  </span><span class=c1># ClusterIP is recommended for production environments.</span>
<a id=__codelineno-5-64 name=__codelineno-5-64 href=#__codelineno-5-64></a><span class=w>  </span><span class=c1># Change to NodePort if needed per documentation,</span>
<a id=__codelineno-5-65 name=__codelineno-5-65 href=#__codelineno-5-65></a><span class=w>  </span><span class=c1># but only if you run Minio in a test/trial environment, for example with Minikube.</span>
<a id=__codelineno-5-66 name=__codelineno-5-66 href=#__codelineno-5-66></a><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<a id=__codelineno-5-67 name=__codelineno-5-67 href=#__codelineno-5-67></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-5-68 name=__codelineno-5-68 href=#__codelineno-5-68></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<a id=__codelineno-5-69 name=__codelineno-5-69 href=#__codelineno-5-69></a><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
<a id=__codelineno-5-70 name=__codelineno-5-70 href=#__codelineno-5-70></a><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a id=__codelineno-5-71 name=__codelineno-5-71 href=#__codelineno-5-71></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-5-72 name=__codelineno-5-72 href=#__codelineno-5-72></a><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio</span>
<a id=__codelineno-5-73 name=__codelineno-5-73 href=#__codelineno-5-73></a>
<a id=__codelineno-5-74 name=__codelineno-5-74 href=#__codelineno-5-74></a><span class=nn>---</span>
<a id=__codelineno-5-75 name=__codelineno-5-75 href=#__codelineno-5-75></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
<a id=__codelineno-5-76 name=__codelineno-5-76 href=#__codelineno-5-76></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Job</span>
<a id=__codelineno-5-77 name=__codelineno-5-77 href=#__codelineno-5-77></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-78 name=__codelineno-5-78 href=#__codelineno-5-78></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<a id=__codelineno-5-79 name=__codelineno-5-79 href=#__codelineno-5-79></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio-setup</span>
<a id=__codelineno-5-80 name=__codelineno-5-80 href=#__codelineno-5-80></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-5-81 name=__codelineno-5-81 href=#__codelineno-5-81></a><span class=w>    </span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio</span>
<a id=__codelineno-5-82 name=__codelineno-5-82 href=#__codelineno-5-82></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-5-83 name=__codelineno-5-83 href=#__codelineno-5-83></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-5-84 name=__codelineno-5-84 href=#__codelineno-5-84></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-85 name=__codelineno-5-85 href=#__codelineno-5-85></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio-setup</span>
<a id=__codelineno-5-86 name=__codelineno-5-86 href=#__codelineno-5-86></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-5-87 name=__codelineno-5-87 href=#__codelineno-5-87></a><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
<a id=__codelineno-5-88 name=__codelineno-5-88 href=#__codelineno-5-88></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-5-89 name=__codelineno-5-89 href=#__codelineno-5-89></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<a id=__codelineno-5-90 name=__codelineno-5-90 href=#__codelineno-5-90></a><span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<a id=__codelineno-5-91 name=__codelineno-5-91 href=#__codelineno-5-91></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-5-92 name=__codelineno-5-92 href=#__codelineno-5-92></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mc</span>
<a id=__codelineno-5-93 name=__codelineno-5-93 href=#__codelineno-5-93></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">minio/mc:latest</span>
<a id=__codelineno-5-94 name=__codelineno-5-94 href=#__codelineno-5-94></a><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-5-95 name=__codelineno-5-95 href=#__codelineno-5-95></a><span class=w>        </span><span class=nt>command</span><span class=p>:</span>
<a id=__codelineno-5-96 name=__codelineno-5-96 href=#__codelineno-5-96></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
<a id=__codelineno-5-97 name=__codelineno-5-97 href=#__codelineno-5-97></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<a id=__codelineno-5-98 name=__codelineno-5-98 href=#__codelineno-5-98></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;mc</span><span class=nv> </span><span class=s>--config-dir=/config</span><span class=nv> </span><span class=s>config</span><span class=nv> </span><span class=s>host</span><span class=nv> </span><span class=s>add</span><span class=nv> </span><span class=s>velero</span><span class=nv> </span><span class=s>http://minio:9000</span><span class=nv> </span><span class=s>minio</span><span class=nv> </span><span class=s>minio123</span><span class=nv> </span><span class=s>&amp;&amp;</span><span class=nv> </span><span class=s>mc</span><span class=nv> </span><span class=s>--config-dir=/config</span><span class=nv> </span><span class=s>mb</span><span class=nv> </span><span class=s>-p</span><span class=nv> </span><span class=s>velero/velero&quot;</span>
<a id=__codelineno-5-99 name=__codelineno-5-99 href=#__codelineno-5-99></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-5-100 name=__codelineno-5-100 href=#__codelineno-5-100></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<a id=__codelineno-5-101 name=__codelineno-5-101 href=#__codelineno-5-101></a><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/config&quot;</span>
</code></pre></div> <p>由上面资源清淡我们可以看到，在安装minio的时候</p> <p>MINIO_ACCESS_KEY：minio</p> <p>MINIO_SECRET_KEY：minio123</p> <p>service的地址为：<a href=http://minio:9000>http://minio:9000</a>，类型为ClusterIP，我们可以映射为NodePort查看</p> <p>最后执行了一个job来创建一个名称为：velero/velero的bucket，在创建的时候适应了</p> <ul> <li>安装</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class="p p-Indicator">[</span><span class=nv>root@master velero-v1.4.2-linux-amd64</span><span class="p p-Indicator">]</span><span class=c1># kubectl apply -f examples/minio/00-minio-deployment.yaml </span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class="l l-Scalar l-Scalar-Plain">namespace/velero created</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class="l l-Scalar l-Scalar-Plain">deployment.apps/minio created</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class="l l-Scalar l-Scalar-Plain">service/minio created</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class="l l-Scalar l-Scalar-Plain">job.batch/minio-setup created</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class="l l-Scalar l-Scalar-Plain">[root@master velero-v1.4.2-linux-amd64]# kubectl get all -n velero</span><span class=w> </span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class="l l-Scalar l-Scalar-Plain">NAME                       READY   STATUS              RESTARTS   AGE</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class="l l-Scalar l-Scalar-Plain">pod/minio-fdd868c5-xv52k   0/1     ContainerCreating   0          14s</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class="l l-Scalar l-Scalar-Plain">pod/minio-setup-hktjb      0/1     ContainerCreating   0          14s</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class="l l-Scalar l-Scalar-Plain">NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class="l l-Scalar l-Scalar-Plain">service/minio   ClusterIP   10.233.39.204   &lt;none&gt;        9000/TCP   14s</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class="l l-Scalar l-Scalar-Plain">NAME                    READY   UP-TO-DATE   AVAILABLE   AGE</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class="l l-Scalar l-Scalar-Plain">deployment.apps/minio   0/1     1            0           14s</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class="l l-Scalar l-Scalar-Plain">NAME                             DESIRED   CURRENT   READY   AGE</span>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class="l l-Scalar l-Scalar-Plain">replicaset.apps/minio-fdd868c5   1         1         0       14s</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class="l l-Scalar l-Scalar-Plain">NAME                    COMPLETIONS   DURATION   AGE</span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class="l l-Scalar l-Scalar-Plain">job.batch/minio-setup   0/1           14s        14s</span>
</code></pre></div> <p>待服务都已经启动完毕，可以登录minio查看velero/velero的bucket是否创建成功。</p> <p>修改svc，登录查看</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=o>[</span>root@master<span class=w> </span>velero-v1.4.2-linux-amd64<span class=o>]</span><span class=c1># kubectl get svc -n velero minio </span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>NAME<span class=w>    </span>TYPE<span class=w>       </span>CLUSTER-IP<span class=w>      </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>          </span>AGE
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>minio<span class=w>   </span>NodePort<span class=w>   </span><span class=m>10</span>.233.39.204<span class=w>   </span>&lt;none&gt;<span class=w>        </span><span class=m>9000</span>:30401/TCP<span class=w>   </span>2m26s
</code></pre></div> <p><img alt=image-20200721172012554 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200721172012554.png"></p> <h4 id=423-velero>4.2.3 安装velero<a class=headerlink href=#423-velero title="Permanent link">&para;</a></h4> <h5 id=4231>4.2.3.1 创建密钥<a class=headerlink href=#4231 title="Permanent link">&para;</a></h5> <p>安装velero需要创建能正常登录minio的密钥</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>cat<span class=w> </span>&gt;<span class=w> </span>credentials-velero<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=s>[default]</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=s>aws_access_key_id = minio</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=s>aws_secret_access_key = minio123</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=s>EOF</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=c1># 安装velero</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>cp<span class=w> </span>velero<span class=w> </span>/usr/bin/
</code></pre></div> <h5 id=4232-k8svelero>4.2.3.2 K8s集群安装velero<a class=headerlink href=#4232-k8svelero title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># 启用快速补全</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>velero<span class=w> </span>completion<span class=w> </span>bash
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>velero<span class=w> </span>install<span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>     </span>--provider<span class=w> </span>aws<span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>     </span>--plugins<span class=w> </span>velero/velero-plugin-for-aws:v1.0.0<span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>     </span>--bucket<span class=w> </span>velero<span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>     </span>--secret-file<span class=w> </span>./credentials-velero<span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>     </span>--use-volume-snapshots<span class=o>=</span><span class=nb>false</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>     </span>--backup-location-config<span class=w> </span><span class=nv>region</span><span class=o>=</span>minio,s3ForcePathStyle<span class=o>=</span><span class=s2>&quot;true&quot;</span>,s3Url<span class=o>=</span>http://minio.velero.svc:9000
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=o>[</span>root@master<span class=w> </span>velero-v1.4.2-linux-amd64<span class=o>]</span><span class=c1># velero install      --provider aws      --plugins velero/velero-plugin-for-aws:v1.0.0      --bucket velero      --secret-file ./credentials-velero      --use-volume-snapshots=false      --backup-location-config region=minio,s3ForcePathStyle=&quot;true&quot;,s3Url=http://minio.velero.svc:9000</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>CustomResourceDefinition/backups.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>CustomResourceDefinition/backups.velero.io:<span class=w> </span>created
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>CustomResourceDefinition/backupstoragelocations.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>CustomResourceDefinition/backupstoragelocations.velero.io:<span class=w> </span>created
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>CustomResourceDefinition/deletebackuprequests.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a>CustomResourceDefinition/deletebackuprequests.velero.io:<span class=w> </span>created
<a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a>CustomResourceDefinition/downloadrequests.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>CustomResourceDefinition/downloadrequests.velero.io:<span class=w> </span>created
<a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a>CustomResourceDefinition/podvolumebackups.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a>CustomResourceDefinition/podvolumebackups.velero.io:<span class=w> </span>created
<a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a>CustomResourceDefinition/podvolumerestores.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a>CustomResourceDefinition/podvolumerestores.velero.io:<span class=w> </span>created
<a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a>CustomResourceDefinition/resticrepositories.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a>CustomResourceDefinition/resticrepositories.velero.io:<span class=w> </span>created
<a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a>CustomResourceDefinition/restores.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a>CustomResourceDefinition/restores.velero.io:<span class=w> </span>created
<a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a>CustomResourceDefinition/schedules.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a>CustomResourceDefinition/schedules.velero.io:<span class=w> </span>created
<a id=__codelineno-9-31 name=__codelineno-9-31 href=#__codelineno-9-31></a>CustomResourceDefinition/serverstatusrequests.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-32 name=__codelineno-9-32 href=#__codelineno-9-32></a>CustomResourceDefinition/serverstatusrequests.velero.io:<span class=w> </span>created
<a id=__codelineno-9-33 name=__codelineno-9-33 href=#__codelineno-9-33></a>CustomResourceDefinition/volumesnapshotlocations.velero.io:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-34 name=__codelineno-9-34 href=#__codelineno-9-34></a>CustomResourceDefinition/volumesnapshotlocations.velero.io:<span class=w> </span>created
<a id=__codelineno-9-35 name=__codelineno-9-35 href=#__codelineno-9-35></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>resources<span class=w> </span>to<span class=w> </span>be<span class=w> </span>ready<span class=w> </span><span class=k>in</span><span class=w> </span>cluster...
<a id=__codelineno-9-36 name=__codelineno-9-36 href=#__codelineno-9-36></a>Namespace/velero:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-37 name=__codelineno-9-37 href=#__codelineno-9-37></a>Namespace/velero:<span class=w> </span>already<span class=w> </span>exists,<span class=w> </span>proceeding
<a id=__codelineno-9-38 name=__codelineno-9-38 href=#__codelineno-9-38></a>Namespace/velero:<span class=w> </span>created
<a id=__codelineno-9-39 name=__codelineno-9-39 href=#__codelineno-9-39></a>ClusterRoleBinding/velero:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-40 name=__codelineno-9-40 href=#__codelineno-9-40></a>ClusterRoleBinding/velero:<span class=w> </span>created
<a id=__codelineno-9-41 name=__codelineno-9-41 href=#__codelineno-9-41></a>ServiceAccount/velero:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-42 name=__codelineno-9-42 href=#__codelineno-9-42></a>ServiceAccount/velero:<span class=w> </span>created
<a id=__codelineno-9-43 name=__codelineno-9-43 href=#__codelineno-9-43></a>Secret/cloud-credentials:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-44 name=__codelineno-9-44 href=#__codelineno-9-44></a>Secret/cloud-credentials:<span class=w> </span>created
<a id=__codelineno-9-45 name=__codelineno-9-45 href=#__codelineno-9-45></a>BackupStorageLocation/default:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-46 name=__codelineno-9-46 href=#__codelineno-9-46></a>BackupStorageLocation/default:<span class=w> </span>created
<a id=__codelineno-9-47 name=__codelineno-9-47 href=#__codelineno-9-47></a>Deployment/velero:<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>create<span class=w> </span>resource
<a id=__codelineno-9-48 name=__codelineno-9-48 href=#__codelineno-9-48></a>Deployment/velero:<span class=w> </span>created
<a id=__codelineno-9-49 name=__codelineno-9-49 href=#__codelineno-9-49></a>Velero<span class=w> </span>is<span class=w> </span>installed!<span class=w> </span>⛵<span class=w> </span>Use<span class=w> </span><span class=s1>&#39;kubectl logs deployment/velero -n velero&#39;</span><span class=w> </span>to<span class=w> </span>view<span class=w> </span>the<span class=w> </span>status.
<a id=__codelineno-9-50 name=__codelineno-9-50 href=#__codelineno-9-50></a>
<a id=__codelineno-9-51 name=__codelineno-9-51 href=#__codelineno-9-51></a><span class=o>[</span>root@master<span class=w> </span>velero-v1.4.2-linux-amd64<span class=o>]</span><span class=c1># kubectl api-versions |grep velero</span>
<a id=__codelineno-9-52 name=__codelineno-9-52 href=#__codelineno-9-52></a>velero.io/v1
<a id=__codelineno-9-53 name=__codelineno-9-53 href=#__codelineno-9-53></a>
<a id=__codelineno-9-54 name=__codelineno-9-54 href=#__codelineno-9-54></a><span class=o>[</span>root@master<span class=w> </span>velero-v1.4.2-linux-amd64<span class=o>]</span><span class=c1># kubectl get pod -n velero</span>
<a id=__codelineno-9-55 name=__codelineno-9-55 href=#__codelineno-9-55></a>NAME<span class=w>                      </span>READY<span class=w>   </span>STATUS<span class=w>      </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-9-56 name=__codelineno-9-56 href=#__codelineno-9-56></a>minio-fdd868c5-xv52k<span class=w>      </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>          </span>56m
<a id=__codelineno-9-57 name=__codelineno-9-57 href=#__codelineno-9-57></a>minio-setup-hktjb<span class=w>         </span><span class=m>0</span>/1<span class=w>     </span>Completed<span class=w>   </span><span class=m>0</span><span class=w>          </span>56m
<a id=__codelineno-9-58 name=__codelineno-9-58 href=#__codelineno-9-58></a>velero-56fbc5d69c-8v2q7<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>          </span>32m
</code></pre></div> <p>至此velero就已经全部部署完成。</p> <h3 id=43-velero>4.3 velero命令<a class=headerlink href=#43-velero title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class="l l-Scalar l-Scalar-Plain">$ velero create backup NAME [flags]</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class="l l-Scalar l-Scalar-Plain"># 剔除 namespace</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class="l l-Scalar l-Scalar-Plain">--exclude-namespaces stringArray                  namespaces to exclude from the backup</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class="l l-Scalar l-Scalar-Plain"># 剔除资源类型</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class="l l-Scalar l-Scalar-Plain">--exclude-resources stringArray                   resources to exclude from the backup, formatted as resource.group, such as storageclasses.storage.k8s.io</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class="l l-Scalar l-Scalar-Plain"># 包含集群资源类型</span><span class=w> </span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class="l l-Scalar l-Scalar-Plain">--include-cluster-resources optionalBool[=true]   include cluster-scoped resources in the backup</span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class="l l-Scalar l-Scalar-Plain"># 包含 namespace</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class="l l-Scalar l-Scalar-Plain">--include-namespaces stringArray                  namespaces to include in the backup (use &#39;*&#39; for all namespaces) (default *)</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class="l l-Scalar l-Scalar-Plain"># 包含 namespace 资源类型</span>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class="l l-Scalar l-Scalar-Plain">--include-resources stringArray                   resources to include in the backup, formatted as resource.group, such as storageclasses.storage.k8s.io (use &#39;*&#39; for all resources)</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class="l l-Scalar l-Scalar-Plain"># 给这个备份加上标签</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class="l l-Scalar l-Scalar-Plain">--labels mapStringString                          labels to apply to the backup</span>
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class="l l-Scalar l-Scalar-Plain">-o, --output string                               Output display format. For create commands, display the object but do not send it to the server. Valid formats are &#39;table&#39;, &#39;json&#39;, and &#39;yaml&#39;. &#39;table&#39; is not valid for the install command.</span>
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class="l l-Scalar l-Scalar-Plain"># 对指定标签的资源进行备份</span>
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class="l l-Scalar l-Scalar-Plain">-l, --selector labelSelector                      only back up resources matching this label selector (default &lt;none&gt;)</span>
<a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>
<a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class="l l-Scalar l-Scalar-Plain"># 对 PV 创建快照</span>
<a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class="l l-Scalar l-Scalar-Plain">--snapshot-volumes optionalBool[=true]            take snapshots of PersistentVolumes as part of the backup</span>
<a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a>
<a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class="l l-Scalar l-Scalar-Plain"># 指定备份的位置</span>
<a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class="l l-Scalar l-Scalar-Plain">--storage-location string                         location in which to store the backup</span>
<a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a>
<a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a><span class="l l-Scalar l-Scalar-Plain"># 备份数据多久删掉</span>
<a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a>
<a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class="l l-Scalar l-Scalar-Plain">--ttl duration                                    how long before the backup can be garbage collected (default 720h0m0s)</span>
<a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a>
<a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class="l l-Scalar l-Scalar-Plain"># 指定快照的位置，也就是哪一个公有云驱动</span>
<a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a><span class="l l-Scalar l-Scalar-Plain">--volume-snapshot-locations strings               list of locations (at most one per provider) where volume snapshots should be stored</span>
</code></pre></div> <h3 id=44>4.4 测试<a class=headerlink href=#44 title="Permanent link">&para;</a></h3> <p>velero非常的人性化，在安装包中已经为我们准备好了测试demo，我们可以利用测试demo来进行测试验证。</p> <h4 id=441>4.4.1 创建测试应用<a class=headerlink href=#441 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=o>[</span>root@master<span class=w> </span>velero-v1.4.2-linux-amd64<span class=o>]</span><span class=c1># kubectl apply -f examples/nginx-app/base.yaml</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>namespace/nginx-example<span class=w> </span>created
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>deployment.apps/nginx-deployment<span class=w> </span>created
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>service/my-nginx<span class=w> </span>created
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=o>[</span>root@master<span class=w> </span>velero-v1.4.2-linux-amd64<span class=o>]</span><span class=c1># kubectl get all -n nginx-example</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>NAME<span class=w>                                   </span>READY<span class=w>   </span>STATUS<span class=w>              </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>pod/nginx-deployment-f4769bfdf-8jrsz<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>ContainerCreating<span class=w>   </span><span class=m>0</span><span class=w>          </span>12s
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>pod/nginx-deployment-f4769bfdf-sqfp4<span class=w>   </span><span class=m>0</span>/1<span class=w>     </span>ContainerCreating<span class=w>   </span><span class=m>0</span><span class=w>          </span>12s
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>NAME<span class=w>               </span>TYPE<span class=w>           </span>CLUSTER-IP<span class=w>     </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>        </span>AGE
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>service/my-nginx<span class=w>   </span>LoadBalancer<span class=w>   </span><span class=m>10</span>.233.10.49<span class=w>   </span>&lt;pending&gt;<span class=w>     </span><span class=m>80</span>:32401/TCP<span class=w>   </span>13s
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>NAME<span class=w>                               </span>READY<span class=w>   </span>UP-TO-DATE<span class=w>   </span>AVAILABLE<span class=w>   </span>AGE
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>deployment.apps/nginx-deployment<span class=w>   </span><span class=m>0</span>/2<span class=w>     </span><span class=m>2</span><span class=w>            </span><span class=m>0</span><span class=w>           </span>14s
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>NAME<span class=w>                                         </span>DESIRED<span class=w>   </span>CURRENT<span class=w>   </span>READY<span class=w>   </span>AGE
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>replicaset.apps/nginx-deployment-f4769bfdf<span class=w>   </span><span class=m>2</span><span class=w>         </span><span class=m>2</span><span class=w>         </span><span class=m>0</span><span class=w>       </span>14s
</code></pre></div> <h4 id=442>4.4.2 执行备份<a class=headerlink href=#442 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class="p p-Indicator">[</span><span class=nv>root@master velero-v1.4.2-linux-amd64</span><span class="p p-Indicator">]</span><span class=c1># velero backup create nginx-backup --include-namespaces nginx-example</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class="l l-Scalar l-Scalar-Plain">Backup request &quot;nginx-backup&quot; submitted successfully.</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class="l l-Scalar l-Scalar-Plain">Run `velero backup describe nginx-backup` or `velero backup logs nginx-backup` for more details.</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class="l l-Scalar l-Scalar-Plain">[root@master velero-v1.4.2-linux-amd64]# velero backup describe nginx-backup</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="p p-Indicator">:</span><span class=w>         </span><span class="l l-Scalar l-Scalar-Plain">nginx-backup</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=nt>Namespace</span><span class=p>:</span><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">velero</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=nt>Labels</span><span class=p>:</span><span class=w>       </span><span class="l l-Scalar l-Scalar-Plain">velero.io/storage-location=default</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=nt>Annotations</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">velero.io/source-cluster-k8s-gitversion=v1.15.5</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>              </span><span class="l l-Scalar l-Scalar-Plain">velero.io/source-cluster-k8s-major-version=1</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>              </span><span class="l l-Scalar l-Scalar-Plain">velero.io/source-cluster-k8s-minor-version=1</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=nt>Phase</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">Completed</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=nt>Errors</span><span class=p>:</span><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=nt>Warnings</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=nt>Namespaces</span><span class=p>:</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>  </span><span class=nt>Included</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">nginx-example</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>  </span><span class=nt>Excluded</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=nt>Resources</span><span class=p>:</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=w>  </span><span class=nt>Included</span><span class=p>:</span><span class=w>        </span><span class=err>*</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=w>  </span><span class=nt>Excluded</span><span class=p>:</span><span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=w>  </span><span class=nt>Cluster-scoped</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=nt>Label selector</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=nt>Storage Location</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=nt>Velero-Native Snapshot PVs</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=nt>TTL</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">720h0m0s</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=nt>Hooks</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">&lt;none&gt;</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=nt>Backup Format Version</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a>
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a><span class=nt>Started</span><span class=p>:</span><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">2020-07-21 19:12:16 +0800 CST</span>
<a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a><span class=nt>Completed</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">2020-07-21 19:12:24 +0800 CST</span>
<a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a>
<a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a><span class=nt>Expiration</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">2020-08-20 19:12:16 +0800 CST</span>
<a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a>
<a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a><span class=nt>Total items to be backed up</span><span class=p>:</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">23</span>
<a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a><span class=nt>Items backed up</span><span class=p>:</span><span class=w>              </span><span class="l l-Scalar l-Scalar-Plain">23</span>
<a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a>
<a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a><span class=nt>Velero-Native Snapshots</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;none included&gt;</span>
</code></pre></div> <h4 id=443>4.4.3 查看备份信息<a class=headerlink href=#443 title="Permanent link">&para;</a></h4> <ul> <li>登录minio查看备份信息</li> </ul> <p><img alt=image-20200722133833271 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200722133833271.png"></p> <p><img alt=image-20200722133847864 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200722133847864.png"></p> <ul> <li>查看目录结构</li> </ul> <p><img alt=image-20200722134049185 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200722134049185.png"></p> <h4 id=444>4.4.4 进行恢复测试<a class=headerlink href=#444 title="Permanent link">&para;</a></h4> <h5 id=4441-nginx>4.4.4.1 删除nginx服务<a class=headerlink href=#4441-nginx title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=o>[</span>root@master<span class=w> </span>velero-v1.4.2-linux-amd64<span class=o>]</span><span class=c1># kubectl delete -f examples/nginx-app/base.yaml </span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>namespace<span class=w> </span><span class=s2>&quot;nginx-example&quot;</span><span class=w> </span>deleted
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>deployment.apps<span class=w> </span><span class=s2>&quot;nginx-deployment&quot;</span><span class=w> </span>deleted
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>service<span class=w> </span><span class=s2>&quot;my-nginx&quot;</span><span class=w> </span>deleted
</code></pre></div> <h5 id=4442-nginx>4.4.4.2 恢复nginx服务<a class=headerlink href=#4442-nginx title="Permanent link">&para;</a></h5> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=o>[</span>root@master<span class=w> </span>velero-v1.4.2-linux-amd64<span class=o>]</span><span class=c1># velero restore create --from-backup nginx-backup --wait</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>Restore<span class=w> </span>request<span class=w> </span><span class=s2>&quot;nginx-backup-20200722134728&quot;</span><span class=w> </span>submitted<span class=w> </span>successfully.
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>Waiting<span class=w> </span><span class=k>for</span><span class=w> </span>restore<span class=w> </span>to<span class=w> </span>complete.<span class=w> </span>You<span class=w> </span>may<span class=w> </span>safely<span class=w> </span>press<span class=w> </span>ctrl-c<span class=w> </span>to<span class=w> </span>stop<span class=w> </span>waiting<span class=w> </span>-<span class=w> </span>your<span class=w> </span>restore<span class=w> </span>will<span class=w> </span><span class=k>continue</span><span class=w> </span><span class=k>in</span><span class=w> </span>the<span class=w> </span>background.
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>Restore<span class=w> </span>completed<span class=w> </span>with<span class=w> </span>status:<span class=w> </span>Completed.<span class=w> </span>You<span class=w> </span>may<span class=w> </span>check<span class=w> </span><span class=k>for</span><span class=w> </span>more<span class=w> </span>information<span class=w> </span>using<span class=w> </span>the<span class=w> </span>commands<span class=w> </span><span class=sb>`</span>velero<span class=w> </span>restore<span class=w> </span>describe<span class=w> </span>nginx-backup-20200722134728<span class=sb>`</span><span class=w> </span>and<span class=w> </span><span class=sb>`</span>velero<span class=w> </span>restore<span class=w> </span>logs<span class=w> </span>nginx-backup-20200722134728<span class=sb>`</span>.
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=o>[</span>root@master<span class=w> </span>velero-v1.4.2-linux-amd64<span class=o>]</span><span class=c1># kubectl  get pods -n nginx-example</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>NAME<span class=w>                               </span>READY<span class=w>   </span>STATUS<span class=w>    </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>nginx-deployment-f4769bfdf-8jrsz<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>7s
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>nginx-deployment-f4769bfdf-sqfp4<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>   </span><span class=m>0</span><span class=w>          </span>7s
</code></pre></div> <p>注意：<code>velero restore</code> 恢复不会覆盖<code>已有的资源</code>，只恢复当前集群中<code>不存在的资源</code>。已有的资源不会回滚到之前的版本，如需要回滚，需在restore之前提前删除现有的资源。</p> <p><img alt=image-20200722135213502 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200722135213502.png"></p> <h2 id=velerooss>五 实践velero备份OSS<a class=headerlink href=#velerooss title="Permanent link">&para;</a></h2> <p>本实例实践如何在阿里云容器服务 ACK 使用 Velero 完成备份和迁移。</p> <p>ACK 插件地址：<a href=https://github.com/AliyunContainerService/velero-plugin>https://github.com/AliyunContainerService/velero-plugin</a></p> <h3 id=51-oss-bucket>5.1 创建OSS bucket<a class=headerlink href=#51-oss-bucket title="Permanent link">&para;</a></h3> <p>由于为低频存储，类型为低频访问存储，权限为私有</p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200811130353.png></p> <ul> <li>创建bucket，在配置velero 的prefix中用到</li> </ul> <p><img alt=image-20200811192355547 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200811192355547.png"></p> <ul> <li>配置对象存储生命周期</li> </ul> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200812093338.png></p> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200812105435.png></p> <h3 id=52-ram>5.2 创建阿里云RAM用户<a class=headerlink href=#52-ram title="Permanent link">&para;</a></h3> <p>在此需要创建一个阿里云RAM用户，用于操作OSS以及ACK资源。</p> <h4 id=521>5.2.1 新建权限策略<a class=headerlink href=#521 title="Permanent link">&para;</a></h4> <p><img alt=image-20200811131557344 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200811131557344.png"></p> <p>策略内容：</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>{
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>&quot;Version&quot;: &quot;1&quot;,
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>&quot;Statement&quot;: [
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    {
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>        &quot;Action&quot;: [
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>            &quot;ecs:DescribeSnapshots&quot;,
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>            &quot;ecs:CreateSnapshot&quot;,
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>            &quot;ecs:DeleteSnapshot&quot;,
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>            &quot;ecs:DescribeDisks&quot;,
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>            &quot;ecs:CreateDisk&quot;,
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>            &quot;ecs:Addtags&quot;,
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>            &quot;oss:PutObject&quot;,
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>            &quot;oss:GetObject&quot;,
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>            &quot;oss:DeleteObject&quot;,
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>            &quot;oss:GetBucket&quot;,
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>            &quot;oss:ListObjects&quot;
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>        ],
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>        &quot;Resource&quot;: [
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>            &quot;*&quot;
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a>        ],
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a>        &quot;Effect&quot;: &quot;Allow&quot;
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a>    }
<a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a>]
<a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a>}
</code></pre></div> <h4 id=522>5.2.2 新建用户<a class=headerlink href=#522 title="Permanent link">&para;</a></h4> <p>在新建用户的时候要选择 <code>编程访问</code>，来获取 <code>AccessKeyID</code> 和 <code>AccessKeySecret</code>，这里请创建一个新用于用于备份，不要使用老用户的 AK 和 AS。</p> <p><img alt=image-20200811131511712 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200811131511712.png"></p> <h3 id=53>5.3 部署服务端<a class=headerlink href=#53 title="Permanent link">&para;</a></h3> <h4 id=531-velero>5.3.1 拉取velero插件<a class=headerlink href=#531-velero title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/AliyunContainerService/velero-plugin
</code></pre></div> <h4 id=532>5.3.2 配置参数<a class=headerlink href=#532 title="Permanent link">&para;</a></h4> <ul> <li>修改 <code>install/credentials-velero</code> 文件，将新建用户中获得的 <code>AccessKeyID</code> 和 <code>AccessKeySecret</code> 填入。</li> </ul> <p><img alt=image-20200811131858889 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200811131858889.png"></p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nv>ALIBABA_CLOUD_ACCESS_KEY_ID</span><span class=o>=</span>&lt;ALIBABA_CLOUD_ACCESS_KEY_ID&gt;
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=nv>ALIBABA_CLOUD_ACCESS_KEY_SECRET</span><span class=o>=</span>&lt;ALIBABA_CLOUD_ACCESS_KEY_SECRET&gt;
</code></pre></div> <ul> <li> <h3 id=oss-bucket-velero>设置备份 OSS Bucket 与 可用区 并部署 velero<a class=headerlink href=#oss-bucket-velero title="Permanent link">&para;</a></h3> </li> </ul> <p>1.创建 velero 命名空间 和 阿里云 secret</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># 创建 velero 命名空间</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class="l l-Scalar l-Scalar-Plain">$ kubectl create namespace velero</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class="l l-Scalar l-Scalar-Plain"># 创建阿里云 secret</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class="l l-Scalar l-Scalar-Plain">$ kubectl create secret generic cloud-credentials --namespace velero --from-file cloud=install/credentials-velero</span>
</code></pre></div> <p>2.替换crd中对象存储信息，部署crd和velero</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># OSS Bucket 名称</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>$<span class=w> </span><span class=nv>BUCKET</span><span class=o>=</span>devops-k8s-backup
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1># OSS 所在可用区</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>$<span class=w> </span><span class=nv>REGION</span><span class=o>=</span>cn-shanghai
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=c1># bucket 名字</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>$<span class=w> </span><span class=nv>prefix</span><span class=o>=</span>velero
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=c1># 部署 velero CRD</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>install/00-crds.yaml
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=c1># 替换 OSS Bucket 与 OSS 所在可用区</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>$<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s#&lt;BUCKET&gt;#</span><span class=nv>$BUCKET</span><span class=s2>#&quot;</span><span class=w> </span>install/01-velero.yaml
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>$<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s#&lt;REGION&gt;#</span><span class=nv>$REGION</span><span class=s2>#&quot;</span><span class=w> </span>install/01-velero.yaml
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=c1># 替换bucket 中名字prifix</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=c1># 查看差异</span>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=o>[</span>root@master<span class=w> </span>velero-plugin<span class=o>]</span><span class=c1># git diff install/01-velero.yaml</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a>diff<span class=w> </span>--git<span class=w> </span>a/install/01-velero.yaml<span class=w> </span>b/install/01-velero.yaml
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a>index<span class=w> </span><span class=m>5669860</span>..7dd4c5a<span class=w> </span><span class=m>100644</span>
<a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a>---<span class=w> </span>a/install/01-velero.yaml
<a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a>+++<span class=w> </span>b/install/01-velero.yaml
<a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a>@@<span class=w> </span>-31,10<span class=w> </span>+31,10<span class=w> </span>@@<span class=w> </span>metadata:
<a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a><span class=w>   </span>namespace:<span class=w> </span>velero
<a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a><span class=w> </span>spec:
<a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a><span class=w>   </span>config:
<a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a>-<span class=w>    </span>region:<span class=w> </span>&lt;REGION&gt;
<a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a>+<span class=w>    </span>region:<span class=w> </span>cn-shanghai
<a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a><span class=w>   </span>objectStorage:
<a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a>-<span class=w>    </span>bucket:<span class=w> </span>&lt;BUCKET&gt;
<a id=__codelineno-19-34 name=__codelineno-19-34 href=#__codelineno-19-34></a>-<span class=w>    </span>prefix:<span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-19-35 name=__codelineno-19-35 href=#__codelineno-19-35></a>+<span class=w>    </span>bucket:<span class=w> </span>devops-k8s-backup
<a id=__codelineno-19-36 name=__codelineno-19-36 href=#__codelineno-19-36></a>+<span class=w>    </span>prefix:<span class=w> </span><span class=s2>&quot;velero&quot;</span>
<a id=__codelineno-19-37 name=__codelineno-19-37 href=#__codelineno-19-37></a><span class=w>   </span>provider:<span class=w> </span>alibabacloud
<a id=__codelineno-19-38 name=__codelineno-19-38 href=#__codelineno-19-38></a>
<a id=__codelineno-19-39 name=__codelineno-19-39 href=#__codelineno-19-39></a><span class=w> </span>---
<a id=__codelineno-19-40 name=__codelineno-19-40 href=#__codelineno-19-40></a>@@<span class=w> </span>-47,7<span class=w> </span>+47,7<span class=w> </span>@@<span class=w> </span>metadata:
<a id=__codelineno-19-41 name=__codelineno-19-41 href=#__codelineno-19-41></a><span class=w>   </span>namespace:<span class=w> </span>velero
<a id=__codelineno-19-42 name=__codelineno-19-42 href=#__codelineno-19-42></a><span class=w> </span>spec:
<a id=__codelineno-19-43 name=__codelineno-19-43 href=#__codelineno-19-43></a><span class=w>   </span>config:
<a id=__codelineno-19-44 name=__codelineno-19-44 href=#__codelineno-19-44></a>-<span class=w>    </span>region:<span class=w> </span>&lt;REGION&gt;
<a id=__codelineno-19-45 name=__codelineno-19-45 href=#__codelineno-19-45></a>+<span class=w>    </span>region:<span class=w> </span>cn-shanghai
<a id=__codelineno-19-46 name=__codelineno-19-46 href=#__codelineno-19-46></a><span class=w>   </span>provider:<span class=w> </span>alibabacloud
<a id=__codelineno-19-47 name=__codelineno-19-47 href=#__codelineno-19-47></a>
<a id=__codelineno-19-48 name=__codelineno-19-48 href=#__codelineno-19-48></a><span class=w> </span>---
<a id=__codelineno-19-49 name=__codelineno-19-49 href=#__codelineno-19-49></a>
<a id=__codelineno-19-50 name=__codelineno-19-50 href=#__codelineno-19-50></a><span class=c1># 创建认证secret</span>
<a id=__codelineno-19-51 name=__codelineno-19-51 href=#__codelineno-19-51></a>kubectl<span class=w> </span>create<span class=w> </span>namespace<span class=w> </span>velero
<a id=__codelineno-19-52 name=__codelineno-19-52 href=#__codelineno-19-52></a>
<a id=__codelineno-19-53 name=__codelineno-19-53 href=#__codelineno-19-53></a>
<a id=__codelineno-19-54 name=__codelineno-19-54 href=#__codelineno-19-54></a><span class=c1># 部署velero</span>
<a id=__codelineno-19-55 name=__codelineno-19-55 href=#__codelineno-19-55></a>$<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>install/
<a id=__codelineno-19-56 name=__codelineno-19-56 href=#__codelineno-19-56></a>
<a id=__codelineno-19-57 name=__codelineno-19-57 href=#__codelineno-19-57></a><span class=c1># 查看velero</span>
<a id=__codelineno-19-58 name=__codelineno-19-58 href=#__codelineno-19-58></a>$<span class=w> </span>kubectl<span class=w>  </span>get<span class=w> </span>pods<span class=w> </span>-n<span class=w> </span>velero
<a id=__codelineno-19-59 name=__codelineno-19-59 href=#__codelineno-19-59></a><span class=o>[</span>root@master<span class=w> </span>velero-plugin<span class=o>]</span><span class=c1># kubectl  get pods -n velero   </span>
<a id=__codelineno-19-60 name=__codelineno-19-60 href=#__codelineno-19-60></a>NAME<span class=w>                     </span>READY<span class=w>   </span>STATUS<span class=w>      </span>RESTARTS<span class=w>   </span>AGE
<a id=__codelineno-19-61 name=__codelineno-19-61 href=#__codelineno-19-61></a>velero-fcc8d77b8-569jz<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>Running<span class=w>     </span><span class=m>0</span><span class=w>          </span>45s
<a id=__codelineno-19-62 name=__codelineno-19-62 href=#__codelineno-19-62></a>
<a id=__codelineno-19-63 name=__codelineno-19-63 href=#__codelineno-19-63></a>
<a id=__codelineno-19-64 name=__codelineno-19-64 href=#__codelineno-19-64></a><span class=c1># 查看位置</span>
<a id=__codelineno-19-65 name=__codelineno-19-65 href=#__codelineno-19-65></a><span class=o>[</span>root@master<span class=w> </span>velero-plugin<span class=o>]</span><span class=c1># velero get backup-locations</span>
<a id=__codelineno-19-66 name=__codelineno-19-66 href=#__codelineno-19-66></a>NAME<span class=w>      </span>PROVIDER<span class=w>       </span>BUCKET/PREFIX<span class=w>              </span>ACCESS<span class=w> </span>MODE
<a id=__codelineno-19-67 name=__codelineno-19-67 href=#__codelineno-19-67></a>default<span class=w>   </span>alibabacloud<span class=w>   </span>devops-k8s-backup/velero<span class=w>   </span>ReadWrite
</code></pre></div> <h3 id=54>5.4 备份恢复<a class=headerlink href=#54 title="Permanent link">&para;</a></h3> <h4 id=541>5.4.1 备份<a class=headerlink href=#541 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>$<span class=w> </span>velero<span class=w> </span>backup<span class=w> </span>create<span class=w> </span>nginx-example<span class=w> </span>--include-namespaces<span class=w> </span>nginx-example
</code></pre></div> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200812093104.png></p> <h4 id=542>5.4.2 恢复<a class=headerlink href=#542 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=w> </span>velero<span class=w> </span>restore<span class=w> </span>create<span class=w> </span>--from-backup<span class=w> </span>nginx-example
</code></pre></div> <h4 id=543>5.4.3 周期性任务<a class=headerlink href=#543 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># Create a backup every 6 hours</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>velero<span class=w> </span>create<span class=w> </span>schedule<span class=w> </span>NAME<span class=w> </span>--schedule<span class=o>=</span><span class=s2>&quot;0 */6 * * *&quot;</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=c1># Create a backup every 6 hours with the @every notation</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>velero<span class=w> </span>create<span class=w> </span>schedule<span class=w> </span>NAME<span class=w> </span>--schedule<span class=o>=</span><span class=s2>&quot;@every 6h&quot;</span>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=c1># Create a daily backup of the web namespace</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>velero<span class=w> </span>create<span class=w> </span>schedule<span class=w> </span>NAME<span class=w> </span>--schedule<span class=o>=</span><span class=s2>&quot;@every 24h&quot;</span><span class=w> </span>--include-namespaces<span class=w> </span>web
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=c1># Create a weekly backup, each living for 90 days (2160 hours)</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>velero<span class=w> </span>create<span class=w> </span>schedule<span class=w> </span>NAME<span class=w> </span>--schedule<span class=o>=</span><span class=s2>&quot;@every 168h&quot;</span><span class=w> </span>--ttl<span class=w> </span>2160h0m0s
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=c1># 每日对anchnet-devops-dev/anchnet-devops-test/anchnet-devops-prod/anchnet-devops-common-test 名称空间进行备份</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>velero<span class=w> </span>create<span class=w> </span>schedule<span class=w> </span>anchnet-devops-dev<span class=w> </span>--schedule<span class=o>=</span><span class=s2>&quot;@every 24h&quot;</span><span class=w> </span>--include-namespaces<span class=w> </span>anchnet-devops-dev<span class=w> </span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a>velero<span class=w> </span>create<span class=w> </span>schedule<span class=w> </span>anchnet-devops-test<span class=w> </span>--schedule<span class=o>=</span><span class=s2>&quot;@every 24h&quot;</span><span class=w> </span>--include-namespaces<span class=w> </span>anchnet-devops-test
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a>velero<span class=w> </span>create<span class=w> </span>schedule<span class=w> </span>anchnet-devops-prod<span class=w> </span>--schedule<span class=o>=</span><span class=s2>&quot;@every 24h&quot;</span><span class=w> </span>--include-namespaces<span class=w> </span>anchnet-devops-prod<span class=w> </span>
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a>velero<span class=w> </span>create<span class=w> </span>schedule<span class=w> </span>anchnet-devops-common-test<span class=w> </span>--schedule<span class=o>=</span><span class=s2>&quot;@every 24h&quot;</span><span class=w> </span>--include-namespaces<span class=w> </span>anchnet-devops-common-test<span class=w> </span>
</code></pre></div> <p><img alt src=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20200812124047.png></p> <p><img alt=image-20200812124028229 src="/Users/xuel/Library/Application Support/typora-user-images/image-20200812124028229.png"></p> <h2 id=_3>六 注意事项<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <ul> <li>在velero备份的时候，备份过程中创建的对象是不会被备份的。</li> <li> <p><code>velero restore</code> 恢复不会覆盖<code>已有的资源</code>，只恢复当前集群中<code>不存在的资源</code>。已有的资源不会回滚到之前的版本，如需要回滚，需在restore之前提前删除现有的资源。</p> </li> <li> <p>后期可以讲velero作为一个crontjob来运行，定期备份数据。</p> </li> <li> <p>在高版本1.16.x中，报错<code>error: unable to recognize "filebeat.yml": no matches for kind "DaemonSet" in version "extensions/v1beta1"</code> ,将yml配置文件内的api接口修改为 apps/v1 ，导致原因为之间使用的kubernetes 版本是1.14.x版本，1.16.x 版本放弃部分API支持！</p> </li> </ul> <h2 id=_4>参考资料<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <ul> <li><a href=https://www.hi-linux.com/posts/60858.html>https://www.hi-linux.com/posts/60858.html</a></li> <li><a href=https://zhuanlan.zhihu.com/p/92853124>https://zhuanlan.zhihu.com/p/92853124</a></li> <li><a href=https://www.cnblogs.com/charlieroro/p/11738322.html>https://www.cnblogs.com/charlieroro/p/11738322.html</a></li> <li><a href=https://bingohuang.com/heptio-velero-intro/ >https://bingohuang.com/heptio-velero-intro/</a></li> <li><a href=https://mp.weixin.qq.com/s/2WEgLm717u9QNh6MI4_Sxw>https://mp.weixin.qq.com/s/2WEgLm717u9QNh6MI4_Sxw</a></li> <li><a href=https://velero.io/ >https://velero.io/</a></li> <li><a href=https://github.com/heptio/velero>https://github.com/heptio/velero</a></li> <li><a href=https://github.com/heptio/velero-community>https://github.com/heptio/velero-community</a></li> <li><a href=https://www.cncf.io/webinars/kubernetes-backup-and-migration-strategies-using-project-velero/ >https://www.cncf.io/webinars/kubernetes-backup-and-migration-strategies-using-project-velero/</a></li> <li><a href=https://developer.aliyun.com/article/705007>https://developer.aliyun.com/article/705007</a></li> <li><a href=https://github.com/AliyunContainerService/velero-plugin>https://github.com/AliyunContainerService/velero-plugin</a></li> <li><a href=https://developer.aliyun.com/article/726863>https://developer.aliyun.com/article/726863</a></li> <li><a href=https://cloud.tencent.com/developer/article/1653649>https://cloud.tencent.com/developer/article/1653649</a></li> </ul> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/redhatxl/redhatxl.github.io/issues/new/?title=[Feedback]+%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98+-+/cloud-native/operator/tools/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B9%8Bvelero%E5%AE%9E%E6%88%98/" target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2016 - 2024 kaliarch </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/redhatxl target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com/blog_img/20220125122524.png target=_blank rel=noopener title=kaliarch-bucket-1251990360.cos.ap-beijing.myqcloud.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">同意</button> <label class=md-button for=__settings>管理设定</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../../../..", "features": ["content.code.annotate", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../../assets/javascripts/bundle.bd41221c.min.js></script> </body> </html>